(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))h(p);new MutationObserver(p=>{for(const x of p)if(x.type==="childList")for(const S of x.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&h(S)}).observe(document,{childList:!0,subtree:!0});function c(p){const x={};return p.integrity&&(x.integrity=p.integrity),p.referrerPolicy&&(x.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?x.credentials="include":p.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function h(p){if(p.ep)return;p.ep=!0;const x=c(p);fetch(p.href,x)}})();var vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Cb(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function WI(o){if(Object.prototype.hasOwnProperty.call(o,"__esModule"))return o;var r=o.default;if(typeof r=="function"){var c=function h(){var p=!1;try{p=this instanceof h}catch{}return p?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};c.prototype=r.prototype}else c={};return Object.defineProperty(c,"__esModule",{value:!0}),Object.keys(o).forEach(function(h){var p=Object.getOwnPropertyDescriptor(o,h);Object.defineProperty(c,h,p.get?p:{enumerable:!0,get:function(){return o[h]}})}),c}var qw={exports:{}},kv={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ek;function ZI(){if(Ek)return kv;Ek=1;var o=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function c(h,p,x){var S=null;if(x!==void 0&&(S=""+x),p.key!==void 0&&(S=""+p.key),"key"in p){x={};for(var i in p)i!=="key"&&(x[i]=p[i])}else x=p;return p=x.ref,{$$typeof:o,type:h,key:S,ref:p!==void 0?p:null,props:x}}return kv.Fragment=r,kv.jsx=c,kv.jsxs=c,kv}var Ak;function XI(){return Ak||(Ak=1,qw.exports=ZI()),qw.exports}var C=XI(),Ww={exports:{}},Ka={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ck;function YI(){if(Ck)return Ka;Ck=1;var o=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),x=Symbol.for("react.consumer"),S=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),P=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),H=Symbol.iterator;function W(Ce){return Ce===null||typeof Ce!="object"?null:(Ce=H&&Ce[H]||Ce["@@iterator"],typeof Ce=="function"?Ce:null)}var K={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},re=Object.assign,ae={};function ce(Ce,_t,At){this.props=Ce,this.context=_t,this.refs=ae,this.updater=At||K}ce.prototype.isReactComponent={},ce.prototype.setState=function(Ce,_t){if(typeof Ce!="object"&&typeof Ce!="function"&&Ce!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ce,_t,"setState")},ce.prototype.forceUpdate=function(Ce){this.updater.enqueueForceUpdate(this,Ce,"forceUpdate")};function ve(){}ve.prototype=ce.prototype;function Se(Ce,_t,At){this.props=Ce,this.context=_t,this.refs=ae,this.updater=At||K}var Ee=Se.prototype=new ve;Ee.constructor=Se,re(Ee,ce.prototype),Ee.isPureReactComponent=!0;var Qe=Array.isArray,He={H:null,A:null,T:null,S:null,V:null},ke=Object.prototype.hasOwnProperty;function tt(Ce,_t,At,Ct,oi,Ci){return At=Ci.ref,{$$typeof:o,type:Ce,key:_t,ref:At!==void 0?At:null,props:Ci}}function Ke(Ce,_t){return tt(Ce.type,_t,void 0,void 0,void 0,Ce.props)}function lt(Ce){return typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===o}function ft(Ce){var _t={"=":"=0",":":"=2"};return"$"+Ce.replace(/[=:]/g,function(At){return _t[At]})}var gt=/\/+/g;function ni(Ce,_t){return typeof Ce=="object"&&Ce!==null&&Ce.key!=null?ft(""+Ce.key):_t.toString(36)}function Ft(){}function Vi(Ce){switch(Ce.status){case"fulfilled":return Ce.value;case"rejected":throw Ce.reason;default:switch(typeof Ce.status=="string"?Ce.then(Ft,Ft):(Ce.status="pending",Ce.then(function(_t){Ce.status==="pending"&&(Ce.status="fulfilled",Ce.value=_t)},function(_t){Ce.status==="pending"&&(Ce.status="rejected",Ce.reason=_t)})),Ce.status){case"fulfilled":return Ce.value;case"rejected":throw Ce.reason}}throw Ce}function Ri(Ce,_t,At,Ct,oi){var Ci=typeof Ce;(Ci==="undefined"||Ci==="boolean")&&(Ce=null);var li=!1;if(Ce===null)li=!0;else switch(Ci){case"bigint":case"string":case"number":li=!0;break;case"object":switch(Ce.$$typeof){case o:case r:li=!0;break;case N:return li=Ce._init,Ri(li(Ce._payload),_t,At,Ct,oi)}}if(li)return oi=oi(Ce),li=Ct===""?"."+ni(Ce,0):Ct,Qe(oi)?(At="",li!=null&&(At=li.replace(gt,"$&/")+"/"),Ri(oi,_t,At,"",function(qn){return qn})):oi!=null&&(lt(oi)&&(oi=Ke(oi,At+(oi.key==null||Ce&&Ce.key===oi.key?"":(""+oi.key).replace(gt,"$&/")+"/")+li)),_t.push(oi)),1;li=0;var Ba=Ct===""?".":Ct+":";if(Qe(Ce))for(var Un=0;Un<Ce.length;Un++)Ct=Ce[Un],Ci=Ba+ni(Ct,Un),li+=Ri(Ct,_t,At,Ci,oi);else if(Un=W(Ce),typeof Un=="function")for(Ce=Un.call(Ce),Un=0;!(Ct=Ce.next()).done;)Ct=Ct.value,Ci=Ba+ni(Ct,Un++),li+=Ri(Ct,_t,At,Ci,oi);else if(Ci==="object"){if(typeof Ce.then=="function")return Ri(Vi(Ce),_t,At,Ct,oi);throw _t=String(Ce),Error("Objects are not valid as a React child (found: "+(_t==="[object Object]"?"object with keys {"+Object.keys(Ce).join(", ")+"}":_t)+"). If you meant to render a collection of children, use an array instead.")}return li}function We(Ce,_t,At){if(Ce==null)return Ce;var Ct=[],oi=0;return Ri(Ce,Ct,"","",function(Ci){return _t.call(At,Ci,oi++)}),Ct}function Et(Ce){if(Ce._status===-1){var _t=Ce._result;_t=_t(),_t.then(function(At){(Ce._status===0||Ce._status===-1)&&(Ce._status=1,Ce._result=At)},function(At){(Ce._status===0||Ce._status===-1)&&(Ce._status=2,Ce._result=At)}),Ce._status===-1&&(Ce._status=0,Ce._result=_t)}if(Ce._status===1)return Ce._result.default;throw Ce._result}var jt=typeof reportError=="function"?reportError:function(Ce){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var _t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ce=="object"&&Ce!==null&&typeof Ce.message=="string"?String(Ce.message):String(Ce),error:Ce});if(!window.dispatchEvent(_t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ce);return}console.error(Ce)};function Gi(){}return Ka.Children={map:We,forEach:function(Ce,_t,At){We(Ce,function(){_t.apply(this,arguments)},At)},count:function(Ce){var _t=0;return We(Ce,function(){_t++}),_t},toArray:function(Ce){return We(Ce,function(_t){return _t})||[]},only:function(Ce){if(!lt(Ce))throw Error("React.Children.only expected to receive a single React element child.");return Ce}},Ka.Component=ce,Ka.Fragment=c,Ka.Profiler=p,Ka.PureComponent=Se,Ka.StrictMode=h,Ka.Suspense=M,Ka.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=He,Ka.__COMPILER_RUNTIME={__proto__:null,c:function(Ce){return He.H.useMemoCache(Ce)}},Ka.cache=function(Ce){return function(){return Ce.apply(null,arguments)}},Ka.cloneElement=function(Ce,_t,At){if(Ce==null)throw Error("The argument must be a React element, but you passed "+Ce+".");var Ct=re({},Ce.props),oi=Ce.key,Ci=void 0;if(_t!=null)for(li in _t.ref!==void 0&&(Ci=void 0),_t.key!==void 0&&(oi=""+_t.key),_t)!ke.call(_t,li)||li==="key"||li==="__self"||li==="__source"||li==="ref"&&_t.ref===void 0||(Ct[li]=_t[li]);var li=arguments.length-2;if(li===1)Ct.children=At;else if(1<li){for(var Ba=Array(li),Un=0;Un<li;Un++)Ba[Un]=arguments[Un+2];Ct.children=Ba}return tt(Ce.type,oi,void 0,void 0,Ci,Ct)},Ka.createContext=function(Ce){return Ce={$$typeof:S,_currentValue:Ce,_currentValue2:Ce,_threadCount:0,Provider:null,Consumer:null},Ce.Provider=Ce,Ce.Consumer={$$typeof:x,_context:Ce},Ce},Ka.createElement=function(Ce,_t,At){var Ct,oi={},Ci=null;if(_t!=null)for(Ct in _t.key!==void 0&&(Ci=""+_t.key),_t)ke.call(_t,Ct)&&Ct!=="key"&&Ct!=="__self"&&Ct!=="__source"&&(oi[Ct]=_t[Ct]);var li=arguments.length-2;if(li===1)oi.children=At;else if(1<li){for(var Ba=Array(li),Un=0;Un<li;Un++)Ba[Un]=arguments[Un+2];oi.children=Ba}if(Ce&&Ce.defaultProps)for(Ct in li=Ce.defaultProps,li)oi[Ct]===void 0&&(oi[Ct]=li[Ct]);return tt(Ce,Ci,void 0,void 0,null,oi)},Ka.createRef=function(){return{current:null}},Ka.forwardRef=function(Ce){return{$$typeof:i,render:Ce}},Ka.isValidElement=lt,Ka.lazy=function(Ce){return{$$typeof:N,_payload:{_status:-1,_result:Ce},_init:Et}},Ka.memo=function(Ce,_t){return{$$typeof:P,type:Ce,compare:_t===void 0?null:_t}},Ka.startTransition=function(Ce){var _t=He.T,At={};He.T=At;try{var Ct=Ce(),oi=He.S;oi!==null&&oi(At,Ct),typeof Ct=="object"&&Ct!==null&&typeof Ct.then=="function"&&Ct.then(Gi,jt)}catch(Ci){jt(Ci)}finally{He.T=_t}},Ka.unstable_useCacheRefresh=function(){return He.H.useCacheRefresh()},Ka.use=function(Ce){return He.H.use(Ce)},Ka.useActionState=function(Ce,_t,At){return He.H.useActionState(Ce,_t,At)},Ka.useCallback=function(Ce,_t){return He.H.useCallback(Ce,_t)},Ka.useContext=function(Ce){return He.H.useContext(Ce)},Ka.useDebugValue=function(){},Ka.useDeferredValue=function(Ce,_t){return He.H.useDeferredValue(Ce,_t)},Ka.useEffect=function(Ce,_t,At){var Ct=He.H;if(typeof At=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ct.useEffect(Ce,_t)},Ka.useId=function(){return He.H.useId()},Ka.useImperativeHandle=function(Ce,_t,At){return He.H.useImperativeHandle(Ce,_t,At)},Ka.useInsertionEffect=function(Ce,_t){return He.H.useInsertionEffect(Ce,_t)},Ka.useLayoutEffect=function(Ce,_t){return He.H.useLayoutEffect(Ce,_t)},Ka.useMemo=function(Ce,_t){return He.H.useMemo(Ce,_t)},Ka.useOptimistic=function(Ce,_t){return He.H.useOptimistic(Ce,_t)},Ka.useReducer=function(Ce,_t,At){return He.H.useReducer(Ce,_t,At)},Ka.useRef=function(Ce){return He.H.useRef(Ce)},Ka.useState=function(Ce){return He.H.useState(Ce)},Ka.useSyncExternalStore=function(Ce,_t,At){return He.H.useSyncExternalStore(Ce,_t,At)},Ka.useTransition=function(){return He.H.useTransition()},Ka.version="19.1.1",Ka}var Mk;function sS(){return Mk||(Mk=1,Ww.exports=YI()),Ww.exports}var ye=sS();const Np=Cb(ye);var Zw={exports:{}},Ev={},Xw={exports:{}},Yw={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pk;function KI(){return Pk||(Pk=1,(function(o){function r(We,Et){var jt=We.length;We.push(Et);e:for(;0<jt;){var Gi=jt-1>>>1,Ce=We[Gi];if(0<p(Ce,Et))We[Gi]=Et,We[jt]=Ce,jt=Gi;else break e}}function c(We){return We.length===0?null:We[0]}function h(We){if(We.length===0)return null;var Et=We[0],jt=We.pop();if(jt!==Et){We[0]=jt;e:for(var Gi=0,Ce=We.length,_t=Ce>>>1;Gi<_t;){var At=2*(Gi+1)-1,Ct=We[At],oi=At+1,Ci=We[oi];if(0>p(Ct,jt))oi<Ce&&0>p(Ci,Ct)?(We[Gi]=Ci,We[oi]=jt,Gi=oi):(We[Gi]=Ct,We[At]=jt,Gi=At);else if(oi<Ce&&0>p(Ci,jt))We[Gi]=Ci,We[oi]=jt,Gi=oi;else break e}}return Et}function p(We,Et){var jt=We.sortIndex-Et.sortIndex;return jt!==0?jt:We.id-Et.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var x=performance;o.unstable_now=function(){return x.now()}}else{var S=Date,i=S.now();o.unstable_now=function(){return S.now()-i}}var M=[],P=[],N=1,H=null,W=3,K=!1,re=!1,ae=!1,ce=!1,ve=typeof setTimeout=="function"?setTimeout:null,Se=typeof clearTimeout=="function"?clearTimeout:null,Ee=typeof setImmediate<"u"?setImmediate:null;function Qe(We){for(var Et=c(P);Et!==null;){if(Et.callback===null)h(P);else if(Et.startTime<=We)h(P),Et.sortIndex=Et.expirationTime,r(M,Et);else break;Et=c(P)}}function He(We){if(ae=!1,Qe(We),!re)if(c(M)!==null)re=!0,ke||(ke=!0,ni());else{var Et=c(P);Et!==null&&Ri(He,Et.startTime-We)}}var ke=!1,tt=-1,Ke=5,lt=-1;function ft(){return ce?!0:!(o.unstable_now()-lt<Ke)}function gt(){if(ce=!1,ke){var We=o.unstable_now();lt=We;var Et=!0;try{e:{re=!1,ae&&(ae=!1,Se(tt),tt=-1),K=!0;var jt=W;try{t:{for(Qe(We),H=c(M);H!==null&&!(H.expirationTime>We&&ft());){var Gi=H.callback;if(typeof Gi=="function"){H.callback=null,W=H.priorityLevel;var Ce=Gi(H.expirationTime<=We);if(We=o.unstable_now(),typeof Ce=="function"){H.callback=Ce,Qe(We),Et=!0;break t}H===c(M)&&h(M),Qe(We)}else h(M);H=c(M)}if(H!==null)Et=!0;else{var _t=c(P);_t!==null&&Ri(He,_t.startTime-We),Et=!1}}break e}finally{H=null,W=jt,K=!1}Et=void 0}}finally{Et?ni():ke=!1}}}var ni;if(typeof Ee=="function")ni=function(){Ee(gt)};else if(typeof MessageChannel<"u"){var Ft=new MessageChannel,Vi=Ft.port2;Ft.port1.onmessage=gt,ni=function(){Vi.postMessage(null)}}else ni=function(){ve(gt,0)};function Ri(We,Et){tt=ve(function(){We(o.unstable_now())},Et)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(We){We.callback=null},o.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ke=0<We?Math.floor(1e3/We):5},o.unstable_getCurrentPriorityLevel=function(){return W},o.unstable_next=function(We){switch(W){case 1:case 2:case 3:var Et=3;break;default:Et=W}var jt=W;W=Et;try{return We()}finally{W=jt}},o.unstable_requestPaint=function(){ce=!0},o.unstable_runWithPriority=function(We,Et){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var jt=W;W=We;try{return Et()}finally{W=jt}},o.unstable_scheduleCallback=function(We,Et,jt){var Gi=o.unstable_now();switch(typeof jt=="object"&&jt!==null?(jt=jt.delay,jt=typeof jt=="number"&&0<jt?Gi+jt:Gi):jt=Gi,We){case 1:var Ce=-1;break;case 2:Ce=250;break;case 5:Ce=1073741823;break;case 4:Ce=1e4;break;default:Ce=5e3}return Ce=jt+Ce,We={id:N++,callback:Et,priorityLevel:We,startTime:jt,expirationTime:Ce,sortIndex:-1},jt>Gi?(We.sortIndex=jt,r(P,We),c(M)===null&&We===c(P)&&(ae?(Se(tt),tt=-1):ae=!0,Ri(He,jt-Gi))):(We.sortIndex=Ce,r(M,We),re||K||(re=!0,ke||(ke=!0,ni()))),We},o.unstable_shouldYield=ft,o.unstable_wrapCallback=function(We){var Et=W;return function(){var jt=W;W=Et;try{return We.apply(this,arguments)}finally{W=jt}}}})(Yw)),Yw}var jk;function JI(){return jk||(jk=1,Xw.exports=KI()),Xw.exports}var Kw={exports:{}},uc={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zk;function QI(){if(zk)return uc;zk=1;var o=sS();function r(M){var P="https://react.dev/errors/"+M;if(1<arguments.length){P+="?args[]="+encodeURIComponent(arguments[1]);for(var N=2;N<arguments.length;N++)P+="&args[]="+encodeURIComponent(arguments[N])}return"Minified React error #"+M+"; visit "+P+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(){}var h={d:{f:c,r:function(){throw Error(r(522))},D:c,C:c,L:c,m:c,X:c,S:c,M:c},p:0,findDOMNode:null},p=Symbol.for("react.portal");function x(M,P,N){var H=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:p,key:H==null?null:""+H,children:M,containerInfo:P,implementation:N}}var S=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function i(M,P){if(M==="font")return"";if(typeof P=="string")return P==="use-credentials"?P:""}return uc.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=h,uc.createPortal=function(M,P){var N=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!P||P.nodeType!==1&&P.nodeType!==9&&P.nodeType!==11)throw Error(r(299));return x(M,P,null,N)},uc.flushSync=function(M){var P=S.T,N=h.p;try{if(S.T=null,h.p=2,M)return M()}finally{S.T=P,h.p=N,h.d.f()}},uc.preconnect=function(M,P){typeof M=="string"&&(P?(P=P.crossOrigin,P=typeof P=="string"?P==="use-credentials"?P:"":void 0):P=null,h.d.C(M,P))},uc.prefetchDNS=function(M){typeof M=="string"&&h.d.D(M)},uc.preinit=function(M,P){if(typeof M=="string"&&P&&typeof P.as=="string"){var N=P.as,H=i(N,P.crossOrigin),W=typeof P.integrity=="string"?P.integrity:void 0,K=typeof P.fetchPriority=="string"?P.fetchPriority:void 0;N==="style"?h.d.S(M,typeof P.precedence=="string"?P.precedence:void 0,{crossOrigin:H,integrity:W,fetchPriority:K}):N==="script"&&h.d.X(M,{crossOrigin:H,integrity:W,fetchPriority:K,nonce:typeof P.nonce=="string"?P.nonce:void 0})}},uc.preinitModule=function(M,P){if(typeof M=="string")if(typeof P=="object"&&P!==null){if(P.as==null||P.as==="script"){var N=i(P.as,P.crossOrigin);h.d.M(M,{crossOrigin:N,integrity:typeof P.integrity=="string"?P.integrity:void 0,nonce:typeof P.nonce=="string"?P.nonce:void 0})}}else P==null&&h.d.M(M)},uc.preload=function(M,P){if(typeof M=="string"&&typeof P=="object"&&P!==null&&typeof P.as=="string"){var N=P.as,H=i(N,P.crossOrigin);h.d.L(M,N,{crossOrigin:H,integrity:typeof P.integrity=="string"?P.integrity:void 0,nonce:typeof P.nonce=="string"?P.nonce:void 0,type:typeof P.type=="string"?P.type:void 0,fetchPriority:typeof P.fetchPriority=="string"?P.fetchPriority:void 0,referrerPolicy:typeof P.referrerPolicy=="string"?P.referrerPolicy:void 0,imageSrcSet:typeof P.imageSrcSet=="string"?P.imageSrcSet:void 0,imageSizes:typeof P.imageSizes=="string"?P.imageSizes:void 0,media:typeof P.media=="string"?P.media:void 0})}},uc.preloadModule=function(M,P){if(typeof M=="string")if(P){var N=i(P.as,P.crossOrigin);h.d.m(M,{as:typeof P.as=="string"&&P.as!=="script"?P.as:void 0,crossOrigin:N,integrity:typeof P.integrity=="string"?P.integrity:void 0})}else h.d.m(M)},uc.requestFormReset=function(M){h.d.r(M)},uc.unstable_batchedUpdates=function(M,P){return M(P)},uc.useFormState=function(M,P,N){return S.H.useFormState(M,P,N)},uc.useFormStatus=function(){return S.H.useHostTransitionStatus()},uc.version="19.1.1",uc}var Ik;function kC(){if(Ik)return Kw.exports;Ik=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(r){console.error(r)}}return o(),Kw.exports=QI(),Kw.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rk;function eR(){if(Rk)return Ev;Rk=1;var o=JI(),r=sS(),c=kC();function h(d){var y="https://react.dev/errors/"+d;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var k=2;k<arguments.length;k++)y+="&args[]="+encodeURIComponent(arguments[k])}return"Minified React error #"+d+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function p(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function x(d){var y=d,k=d;if(d.alternate)for(;y.return;)y=y.return;else{d=y;do y=d,(y.flags&4098)!==0&&(k=y.return),d=y.return;while(d)}return y.tag===3?k:null}function S(d){if(d.tag===13){var y=d.memoizedState;if(y===null&&(d=d.alternate,d!==null&&(y=d.memoizedState)),y!==null)return y.dehydrated}return null}function i(d){if(x(d)!==d)throw Error(h(188))}function M(d){var y=d.alternate;if(!y){if(y=x(d),y===null)throw Error(h(188));return y!==d?null:d}for(var k=d,R=y;;){var G=k.return;if(G===null)break;var Q=G.alternate;if(Q===null){if(R=G.return,R!==null){k=R;continue}break}if(G.child===Q.child){for(Q=G.child;Q;){if(Q===k)return i(G),d;if(Q===R)return i(G),y;Q=Q.sibling}throw Error(h(188))}if(k.return!==R.return)k=G,R=Q;else{for(var we=!1,$e=G.child;$e;){if($e===k){we=!0,k=G,R=Q;break}if($e===R){we=!0,R=G,k=Q;break}$e=$e.sibling}if(!we){for($e=Q.child;$e;){if($e===k){we=!0,k=Q,R=G;break}if($e===R){we=!0,R=Q,k=G;break}$e=$e.sibling}if(!we)throw Error(h(189))}}if(k.alternate!==R)throw Error(h(190))}if(k.tag!==3)throw Error(h(188));return k.stateNode.current===k?d:y}function P(d){var y=d.tag;if(y===5||y===26||y===27||y===6)return d;for(d=d.child;d!==null;){if(y=P(d),y!==null)return y;d=d.sibling}return null}var N=Object.assign,H=Symbol.for("react.element"),W=Symbol.for("react.transitional.element"),K=Symbol.for("react.portal"),re=Symbol.for("react.fragment"),ae=Symbol.for("react.strict_mode"),ce=Symbol.for("react.profiler"),ve=Symbol.for("react.provider"),Se=Symbol.for("react.consumer"),Ee=Symbol.for("react.context"),Qe=Symbol.for("react.forward_ref"),He=Symbol.for("react.suspense"),ke=Symbol.for("react.suspense_list"),tt=Symbol.for("react.memo"),Ke=Symbol.for("react.lazy"),lt=Symbol.for("react.activity"),ft=Symbol.for("react.memo_cache_sentinel"),gt=Symbol.iterator;function ni(d){return d===null||typeof d!="object"?null:(d=gt&&d[gt]||d["@@iterator"],typeof d=="function"?d:null)}var Ft=Symbol.for("react.client.reference");function Vi(d){if(d==null)return null;if(typeof d=="function")return d.$$typeof===Ft?null:d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case re:return"Fragment";case ce:return"Profiler";case ae:return"StrictMode";case He:return"Suspense";case ke:return"SuspenseList";case lt:return"Activity"}if(typeof d=="object")switch(d.$$typeof){case K:return"Portal";case Ee:return(d.displayName||"Context")+".Provider";case Se:return(d._context.displayName||"Context")+".Consumer";case Qe:var y=d.render;return d=d.displayName,d||(d=y.displayName||y.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case tt:return y=d.displayName||null,y!==null?y:Vi(d.type)||"Memo";case Ke:y=d._payload,d=d._init;try{return Vi(d(y))}catch{}}return null}var Ri=Array.isArray,We=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Et=c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,jt={pending:!1,data:null,method:null,action:null},Gi=[],Ce=-1;function _t(d){return{current:d}}function At(d){0>Ce||(d.current=Gi[Ce],Gi[Ce]=null,Ce--)}function Ct(d,y){Ce++,Gi[Ce]=d.current,d.current=y}var oi=_t(null),Ci=_t(null),li=_t(null),Ba=_t(null);function Un(d,y){switch(Ct(li,y),Ct(Ci,d),Ct(oi,null),y.nodeType){case 9:case 11:d=(d=y.documentElement)&&(d=d.namespaceURI)?Ex(d):0;break;default:if(d=y.tagName,y=y.namespaceURI)y=Ex(y),d=cm(y,d);else switch(d){case"svg":d=1;break;case"math":d=2;break;default:d=0}}At(oi),Ct(oi,d)}function qn(){At(oi),At(Ci),At(li)}function On(d){d.memoizedState!==null&&Ct(Ba,d);var y=oi.current,k=cm(y,d.type);y!==k&&(Ct(Ci,d),Ct(oi,k))}function Ja(d){Ci.current===d&&(At(oi),At(Ci)),Ba.current===d&&(At(Ba),ch._currentValue=jt)}var Qi=Object.prototype.hasOwnProperty,Fi=o.unstable_scheduleCallback,nn=o.unstable_cancelCallback,hn=o.unstable_shouldYield,ln=o.unstable_requestPaint,xn=o.unstable_now,za=o.unstable_getCurrentPriorityLevel,$c=o.unstable_ImmediatePriority,Zo=o.unstable_UserBlockingPriority,$s=o.unstable_NormalPriority,ws=o.unstable_LowPriority,Vs=o.unstable_IdlePriority,Vr=o.log,Xo=o.unstable_setDisableYieldValue,Kr=null,Qa=null;function us(d){if(typeof Vr=="function"&&Xo(d),Qa&&typeof Qa.setStrictMode=="function")try{Qa.setStrictMode(Kr,d)}catch{}}var mr=Math.clz32?Math.clz32:Hs,ul=Math.log,Jl=Math.LN2;function Hs(d){return d>>>=0,d===0?32:31-(ul(d)/Jl|0)|0}var Yo=256,yr=4194304;function zr(d){var y=d&42;if(y!==0)return y;switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return d&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return d}}function Ql(d,y,k){var R=d.pendingLanes;if(R===0)return 0;var G=0,Q=d.suspendedLanes,we=d.pingedLanes;d=d.warmLanes;var $e=R&134217727;return $e!==0?(R=$e&~Q,R!==0?G=zr(R):(we&=$e,we!==0?G=zr(we):k||(k=$e&~d,k!==0&&(G=zr(k))))):($e=R&~Q,$e!==0?G=zr($e):we!==0?G=zr(we):k||(k=R&~d,k!==0&&(G=zr(k)))),G===0?0:y!==0&&y!==G&&(y&Q)===0&&(Q=G&-G,k=y&-y,Q>=k||Q===32&&(k&4194048)!==0)?y:G}function Ss(d,y){return(d.pendingLanes&~(d.suspendedLanes&~d.pingedLanes)&y)===0}function mo(d,y){switch(d){case 1:case 2:case 4:case 8:case 64:return y+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ko(){var d=Yo;return Yo<<=1,(Yo&4194048)===0&&(Yo=256),d}function Gs(){var d=yr;return yr<<=1,(yr&62914560)===0&&(yr=4194304),d}function ec(d){for(var y=[],k=0;31>k;k++)y.push(d);return y}function po(d,y){d.pendingLanes|=y,y!==268435456&&(d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0)}function qa(d,y,k,R,G,Q){var we=d.pendingLanes;d.pendingLanes=k,d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0,d.expiredLanes&=k,d.entangledLanes&=k,d.errorRecoveryDisabledLanes&=k,d.shellSuspendCounter=0;var $e=d.entanglements,ct=d.expirationTimes,Jt=d.hiddenUpdates;for(k=we&~k;0<k;){var vi=31-mr(k),Ai=1<<vi;$e[vi]=0,ct[vi]=-1;var ii=Jt[vi];if(ii!==null)for(Jt[vi]=null,vi=0;vi<ii.length;vi++){var ri=ii[vi];ri!==null&&(ri.lane&=-536870913)}k&=~Ai}R!==0&&Fr(d,R,0),Q!==0&&G===0&&d.tag!==0&&(d.suspendedLanes|=Q&~(we&~y))}function Fr(d,y,k){d.pendingLanes|=y,d.suspendedLanes&=~y;var R=31-mr(y);d.entangledLanes|=y,d.entanglements[R]=d.entanglements[R]|1073741824|k&4194090}function tc(d,y){var k=d.entangledLanes|=y;for(d=d.entanglements;k;){var R=31-mr(k),G=1<<R;G&y|d[R]&y&&(d[R]|=y),k&=~G}}function jo(d){switch(d){case 2:d=1;break;case 8:d=4;break;case 32:d=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:d=128;break;case 268435456:d=134217728;break;default:d=0}return d}function go(d){return d&=-d,2<d?8<d?(d&134217727)!==0?32:268435456:8:2}function wu(){var d=Et.p;return d!==0?d:(d=window.event,d===void 0?32:E_(d.type))}function Pe(d,y){var k=Et.p;try{return Et.p=d,y()}finally{Et.p=k}}var zt=Math.random().toString(36).slice(2),Qt="__reactFiber$"+zt,Ei="__reactProps$"+zt,ui="__reactContainer$"+zt,qi="__reactEvents$"+zt,Si="__reactListeners$"+zt,pn="__reactHandles$"+zt,kn="__reactResources$"+zt,Ze="__reactMarker$"+zt;function ie(d){delete d[Qt],delete d[Ei],delete d[qi],delete d[Si],delete d[pn]}function ue(d){var y=d[Qt];if(y)return y;for(var k=d.parentNode;k;){if(y=k[ui]||k[Qt]){if(k=y.alternate,y.child!==null||k!==null&&k.child!==null)for(d=Ry(d);d!==null;){if(k=d[Qt])return k;d=Ry(d)}return y}d=k,k=d.parentNode}return null}function Te(d){if(d=d[Qt]||d[ui]){var y=d.tag;if(y===5||y===6||y===13||y===26||y===27||y===3)return d}return null}function Fe(d){var y=d.tag;if(y===5||y===26||y===27||y===6)return d.stateNode;throw Error(h(33))}function Be(d){var y=d[kn];return y||(y=d[kn]={hoistableStyles:new Map,hoistableScripts:new Map}),y}function qe(d){d[Ze]=!0}var rt=new Set,Je={};function ot(d,y){Rt(d,y),Rt(d+"Capture",y)}function Rt(d,y){for(Je[d]=y,d=0;d<y.length;d++)rt.add(y[d])}var St=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ci={},Oi={};function mi(d){return Qi.call(Oi,d)?!0:Qi.call(ci,d)?!1:St.test(d)?Oi[d]=!0:(ci[d]=!0,!1)}function tn(d,y,k){if(mi(y))if(k===null)d.removeAttribute(y);else{switch(typeof k){case"undefined":case"function":case"symbol":d.removeAttribute(y);return;case"boolean":var R=y.toLowerCase().slice(0,5);if(R!=="data-"&&R!=="aria-"){d.removeAttribute(y);return}}d.setAttribute(y,""+k)}}function rn(d,y,k){if(k===null)d.removeAttribute(y);else{switch(typeof k){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(y);return}d.setAttribute(y,""+k)}}function Zi(d,y,k,R){if(R===null)d.removeAttribute(k);else{switch(typeof R){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(k);return}d.setAttributeNS(y,k,""+R)}}var Ui,$n;function Ia(d){if(Ui===void 0)try{throw Error()}catch(k){var y=k.stack.trim().match(/\n( *(at )?)/);Ui=y&&y[1]||"",$n=-1<k.stack.indexOf(`
    at`)?" (<anonymous>)":-1<k.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ui+d+$n}var Ta=!1;function Yn(d,y){if(!d||Ta)return"";Ta=!0;var k=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var R={DetermineComponentFrameRoot:function(){try{if(y){var Ai=function(){throw Error()};if(Object.defineProperty(Ai.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ai,[])}catch(ri){var ii=ri}Reflect.construct(d,[],Ai)}else{try{Ai.call()}catch(ri){ii=ri}d.call(Ai.prototype)}}else{try{throw Error()}catch(ri){ii=ri}(Ai=d())&&typeof Ai.catch=="function"&&Ai.catch(function(){})}}catch(ri){if(ri&&ii&&typeof ri.stack=="string")return[ri.stack,ii.stack]}return[null,null]}};R.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var G=Object.getOwnPropertyDescriptor(R.DetermineComponentFrameRoot,"name");G&&G.configurable&&Object.defineProperty(R.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var Q=R.DetermineComponentFrameRoot(),we=Q[0],$e=Q[1];if(we&&$e){var ct=we.split(`
`),Jt=$e.split(`
`);for(G=R=0;R<ct.length&&!ct[R].includes("DetermineComponentFrameRoot");)R++;for(;G<Jt.length&&!Jt[G].includes("DetermineComponentFrameRoot");)G++;if(R===ct.length||G===Jt.length)for(R=ct.length-1,G=Jt.length-1;1<=R&&0<=G&&ct[R]!==Jt[G];)G--;for(;1<=R&&0<=G;R--,G--)if(ct[R]!==Jt[G]){if(R!==1||G!==1)do if(R--,G--,0>G||ct[R]!==Jt[G]){var vi=`
`+ct[R].replace(" at new "," at ");return d.displayName&&vi.includes("<anonymous>")&&(vi=vi.replace("<anonymous>",d.displayName)),vi}while(1<=R&&0<=G);break}}}finally{Ta=!1,Error.prepareStackTrace=k}return(k=d?d.displayName||d.name:"")?Ia(k):""}function fn(d){switch(d.tag){case 26:case 27:case 5:return Ia(d.type);case 16:return Ia("Lazy");case 13:return Ia("Suspense");case 19:return Ia("SuspenseList");case 0:case 15:return Yn(d.type,!1);case 11:return Yn(d.type.render,!1);case 1:return Yn(d.type,!0);case 31:return Ia("Activity");default:return""}}function an(d){try{var y="";do y+=fn(d),d=d.return;while(d);return y}catch(k){return`
Error generating stack: `+k.message+`
`+k.stack}}function ea(d){switch(typeof d){case"bigint":case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function ra(d){var y=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(y==="checkbox"||y==="radio")}function Sn(d){var y=ra(d)?"checked":"value",k=Object.getOwnPropertyDescriptor(d.constructor.prototype,y),R=""+d[y];if(!d.hasOwnProperty(y)&&typeof k<"u"&&typeof k.get=="function"&&typeof k.set=="function"){var G=k.get,Q=k.set;return Object.defineProperty(d,y,{configurable:!0,get:function(){return G.call(this)},set:function(we){R=""+we,Q.call(this,we)}}),Object.defineProperty(d,y,{enumerable:k.enumerable}),{getValue:function(){return R},setValue:function(we){R=""+we},stopTracking:function(){d._valueTracker=null,delete d[y]}}}}function Wa(d){d._valueTracker||(d._valueTracker=Sn(d))}function zn(d){if(!d)return!1;var y=d._valueTracker;if(!y)return!0;var k=y.getValue(),R="";return d&&(R=ra(d)?d.checked?"true":"false":d.value),d=R,d!==k?(y.setValue(d),!0):!1}function ka(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}var qs=/[\n"\\]/g;function rs(d){return d.replace(qs,function(y){return"\\"+y.charCodeAt(0).toString(16)+" "})}function er(d,y,k,R,G,Q,we,$e){d.name="",we!=null&&typeof we!="function"&&typeof we!="symbol"&&typeof we!="boolean"?d.type=we:d.removeAttribute("type"),y!=null?we==="number"?(y===0&&d.value===""||d.value!=y)&&(d.value=""+ea(y)):d.value!==""+ea(y)&&(d.value=""+ea(y)):we!=="submit"&&we!=="reset"||d.removeAttribute("value"),y!=null?Jr(d,we,ea(y)):k!=null?Jr(d,we,ea(k)):R!=null&&d.removeAttribute("value"),G==null&&Q!=null&&(d.defaultChecked=!!Q),G!=null&&(d.checked=G&&typeof G!="function"&&typeof G!="symbol"),$e!=null&&typeof $e!="function"&&typeof $e!="symbol"&&typeof $e!="boolean"?d.name=""+ea($e):d.removeAttribute("name")}function zo(d,y,k,R,G,Q,we,$e){if(Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"&&(d.type=Q),y!=null||k!=null){if(!(Q!=="submit"&&Q!=="reset"||y!=null))return;k=k!=null?""+ea(k):"",y=y!=null?""+ea(y):k,$e||y===d.value||(d.value=y),d.defaultValue=y}R=R??G,R=typeof R!="function"&&typeof R!="symbol"&&!!R,d.checked=$e?d.checked:!!R,d.defaultChecked=!!R,we!=null&&typeof we!="function"&&typeof we!="symbol"&&typeof we!="boolean"&&(d.name=we)}function Jr(d,y,k){y==="number"&&ka(d.ownerDocument)===d||d.defaultValue===""+k||(d.defaultValue=""+k)}function ss(d,y,k,R){if(d=d.options,y){y={};for(var G=0;G<k.length;G++)y["$"+k[G]]=!0;for(k=0;k<d.length;k++)G=y.hasOwnProperty("$"+d[k].value),d[k].selected!==G&&(d[k].selected=G),G&&R&&(d[k].defaultSelected=!0)}else{for(k=""+ea(k),y=null,G=0;G<d.length;G++){if(d[G].value===k){d[G].selected=!0,R&&(d[G].defaultSelected=!0);return}y!==null||d[G].disabled||(y=d[G])}y!==null&&(y.selected=!0)}}function xa(d,y,k){if(y!=null&&(y=""+ea(y),y!==d.value&&(d.value=y),k==null)){d.defaultValue!==y&&(d.defaultValue=y);return}d.defaultValue=k!=null?""+ea(k):""}function Io(d,y,k,R){if(y==null){if(R!=null){if(k!=null)throw Error(h(92));if(Ri(R)){if(1<R.length)throw Error(h(93));R=R[0]}k=R}k==null&&(k=""),y=k}k=ea(y),d.defaultValue=k,R=d.textContent,R===k&&R!==""&&R!==null&&(d.value=R)}function _o(d,y){if(y){var k=d.firstChild;if(k&&k===d.lastChild&&k.nodeType===3){k.nodeValue=y;return}}d.textContent=y}var Vc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Su(d,y,k){var R=y.indexOf("--")===0;k==null||typeof k=="boolean"||k===""?R?d.setProperty(y,""):y==="float"?d.cssFloat="":d[y]="":R?d.setProperty(y,k):typeof k!="number"||k===0||Vc.has(y)?y==="float"?d.cssFloat=k:d[y]=(""+k).trim():d[y]=k+"px"}function hc(d,y,k){if(y!=null&&typeof y!="object")throw Error(h(62));if(d=d.style,k!=null){for(var R in k)!k.hasOwnProperty(R)||y!=null&&y.hasOwnProperty(R)||(R.indexOf("--")===0?d.setProperty(R,""):R==="float"?d.cssFloat="":d[R]="");for(var G in y)R=y[G],y.hasOwnProperty(G)&&k[G]!==R&&Su(d,G,R)}else for(var Q in y)y.hasOwnProperty(Q)&&Su(d,Q,y[Q])}function fc(d){if(d.indexOf("-")===-1)return!1;switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dl=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ps=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function io(d){return Ps.test(""+d)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":d}var yo=null;function Ws(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var no=null,vo=null;function Hc(d){var y=Te(d);if(y&&(d=y.stateNode)){var k=d[Ei]||null;e:switch(d=y.stateNode,y.type){case"input":if(er(d,k.value,k.defaultValue,k.defaultValue,k.checked,k.defaultChecked,k.type,k.name),y=k.name,k.type==="radio"&&y!=null){for(k=d;k.parentNode;)k=k.parentNode;for(k=k.querySelectorAll('input[name="'+rs(""+y)+'"][type="radio"]'),y=0;y<k.length;y++){var R=k[y];if(R!==d&&R.form===d.form){var G=R[Ei]||null;if(!G)throw Error(h(90));er(R,G.value,G.defaultValue,G.defaultValue,G.checked,G.defaultChecked,G.type,G.name)}}for(y=0;y<k.length;y++)R=k[y],R.form===d.form&&zn(R)}break e;case"textarea":xa(d,k.value,k.defaultValue);break e;case"select":y=k.value,y!=null&&ss(d,!!k.multiple,y,!1)}}}var sa=!1;function Zs(d,y,k){if(sa)return d(y,k);sa=!0;try{var R=d(y);return R}finally{if(sa=!1,(no!==null||vo!==null)&&(mn(),no&&(y=no,d=vo,vo=no=null,Hc(y),d)))for(y=0;y<d.length;y++)Hc(d[y])}}function ar(d,y){var k=d.stateNode;if(k===null)return null;var R=k[Ei]||null;if(R===null)return null;k=R[y];e:switch(y){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(d=d.type,R=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!R;break e;default:d=!1}if(d)return null;if(k&&typeof k!="function")throw Error(h(231,y,typeof k));return k}var Dl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mc=!1;if(Dl)try{var ds={};Object.defineProperty(ds,"passive",{get:function(){mc=!0}}),window.addEventListener("test",ds,ds),window.removeEventListener("test",ds,ds)}catch{mc=!1}var Jo=null,xo=null,Ro=null;function Xu(){if(Ro)return Ro;var d,y=xo,k=y.length,R,G="value"in Jo?Jo.value:Jo.textContent,Q=G.length;for(d=0;d<k&&y[d]===G[d];d++);var we=k-d;for(R=1;R<=we&&y[k-R]===G[Q-R];R++);return Ro=G.slice(d,1<R?1-R:void 0)}function os(d){var y=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&y===13&&(d=13)):d=y,d===10&&(d=13),32<=d||d===13?d:0}function Do(){return!0}function Vn(){return!1}function js(d){function y(k,R,G,Q,we){this._reactName=k,this._targetInst=G,this.type=R,this.nativeEvent=Q,this.target=we,this.currentTarget=null;for(var $e in d)d.hasOwnProperty($e)&&(k=d[$e],this[$e]=k?k(Q):Q[$e]);return this.isDefaultPrevented=(Q.defaultPrevented!=null?Q.defaultPrevented:Q.returnValue===!1)?Do:Vn,this.isPropagationStopped=Vn,this}return N(y.prototype,{preventDefault:function(){this.defaultPrevented=!0;var k=this.nativeEvent;k&&(k.preventDefault?k.preventDefault():typeof k.returnValue!="unknown"&&(k.returnValue=!1),this.isDefaultPrevented=Do)},stopPropagation:function(){var k=this.nativeEvent;k&&(k.stopPropagation?k.stopPropagation():typeof k.cancelBubble!="unknown"&&(k.cancelBubble=!0),this.isPropagationStopped=Do)},persist:function(){},isPersistent:Do}),y}var pc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yu=js(pc),Gc=N({},pc,{view:0,detail:0}),qc=js(Gc),Wc,Aa,Tu,Xs=N({},Gc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zc,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Tu&&(Tu&&d.type==="mousemove"?(Wc=d.screenX-Tu.screenX,Aa=d.screenY-Tu.screenY):Aa=Wc=0,Tu=d),Wc)},movementY:function(d){return"movementY"in d?d.movementY:Aa}}),bo=js(Xs),Ku=N({},Xs,{dataTransfer:0}),bf=js(Ku),ic=N({},Gc,{relatedTarget:0}),gc=js(ic),zs=N({},pc,{animationName:0,elapsedTime:0,pseudoElement:0}),kh=js(zs),Fd=N({},pc,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Lo=js(Fd),ha=N({},pc,{data:0}),hl=js(ha),Em={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$i={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Eh(d){var y=this.nativeEvent;return y.getModifierState?y.getModifierState(d):(d=$i[d])?!!y[d]:!1}function Zc(){return Eh}var Oo=N({},Gc,{key:function(d){if(d.key){var y=Em[d.key]||d.key;if(y!=="Unidentified")return y}return d.type==="keypress"?(d=os(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?wf[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zc,charCode:function(d){return d.type==="keypress"?os(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?os(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),Ju=js(Oo),fl=N({},Xs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ii=js(fl),Nn=N({},Gc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zc}),pa=js(Nn),Ys=N({},pc,{propertyName:0,elapsedTime:0,pseudoElement:0}),nc=js(Ys),na=N({},Xs,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),Bd=js(na),Xc=N({},pc,{newState:0,oldState:0}),Ll=js(Xc),Is=[9,13,27,32],or=Dl&&"CompositionEvent"in window,ao=null;Dl&&"documentMode"in document&&(ao=document.documentMode);var _c=Dl&&"TextEvent"in window&&!ao,Ud=Dl&&(!or||ao&&8<ao&&11>=ao),Qu=" ",ku=!1;function ed(d,y){switch(d){case"keyup":return Is.indexOf(y.keyCode)!==-1;case"keydown":return y.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $d(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var ls=!1;function ac(d,y){switch(d){case"compositionend":return $d(y);case"keypress":return y.which!==32?null:(ku=!0,Qu);case"textInput":return d=y.data,d===Qu&&ku?null:d;default:return null}}function ro(d,y){if(ls)return d==="compositionend"||!or&&ed(d,y)?(d=Xu(),Ro=xo=Jo=null,ls=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(y.ctrlKey||y.altKey||y.metaKey)||y.ctrlKey&&y.altKey){if(y.char&&1<y.char.length)return y.char;if(y.which)return String.fromCharCode(y.which)}return null;case"compositionend":return Ud&&y.locale!=="ko"?null:y.data;default:return null}}var Ks={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ml(d){var y=d&&d.nodeName&&d.nodeName.toLowerCase();return y==="input"?!!Ks[d.type]:y==="textarea"}function Hr(d,y,k,R){no?vo?vo.push(R):vo=[R]:no=R,y=pg(y,"onChange"),0<y.length&&(k=new Yu("onChange","change",null,k,R),d.push({event:k,listeners:y}))}var Br=null,Qo=null;function wr(d){Sx(d,0)}function td(d){var y=Fe(d);if(zn(y))return d}function so(d,y){if(d==="change")return y}var pl=!1;if(Dl){var sn;if(Dl){var Pi="oninput"in document;if(!Pi){var gl=document.createElement("div");gl.setAttribute("oninput","return;"),Pi=typeof gl.oninput=="function"}sn=Pi}else sn=!1;pl=sn&&(!document.documentMode||9<document.documentMode)}function Ki(){Br&&(Br.detachEvent("onpropertychange",Eu),Qo=Br=null)}function Eu(d){if(d.propertyName==="value"&&td(Qo)){var y=[];Hr(y,Qo,d,Ws(d)),Zs(wr,y)}}function id(d,y,k){d==="focusin"?(Ki(),Br=y,Qo=k,Br.attachEvent("onpropertychange",Eu)):d==="focusout"&&Ki()}function en(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return td(Qo)}function Rs(d,y){if(d==="click")return td(y)}function Sf(d,y){if(d==="input"||d==="change")return td(y)}function yc(d,y){return d===y&&(d!==0||1/d===1/y)||d!==d&&y!==y}var Sr=typeof Object.is=="function"?Object.is:yc;function oo(d,y){if(Sr(d,y))return!0;if(typeof d!="object"||d===null||typeof y!="object"||y===null)return!1;var k=Object.keys(d),R=Object.keys(y);if(k.length!==R.length)return!1;for(R=0;R<k.length;R++){var G=k[R];if(!Qi.call(y,G)||!Sr(d[G],y[G]))return!1}return!0}function Ir(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function nd(d,y){var k=Ir(d);d=0;for(var R;k;){if(k.nodeType===3){if(R=d+k.textContent.length,d<=y&&R>=y)return{node:k,offset:y-d};d=R}e:{for(;k;){if(k.nextSibling){k=k.nextSibling;break e}k=k.parentNode}k=void 0}k=Ir(k)}}function No(d,y){return d&&y?d===y?!0:d&&d.nodeType===3?!1:y&&y.nodeType===3?No(d,y.parentNode):"contains"in d?d.contains(y):d.compareDocumentPosition?!!(d.compareDocumentPosition(y)&16):!1:!1}function Au(d){d=d!=null&&d.ownerDocument!=null&&d.ownerDocument.defaultView!=null?d.ownerDocument.defaultView:window;for(var y=ka(d.document);y instanceof d.HTMLIFrameElement;){try{var k=typeof y.contentWindow.location.href=="string"}catch{k=!1}if(k)d=y.contentWindow;else break;y=ka(d.document)}return y}function _l(d){var y=d&&d.nodeName&&d.nodeName.toLowerCase();return y&&(y==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||y==="textarea"||d.contentEditable==="true")}var wo=Dl&&"documentMode"in document&&11>=document.documentMode,So=null,ad=null,yl=null,Yc=!1;function rd(d,y,k){var R=k.window===k?k.document:k.nodeType===9?k:k.ownerDocument;Yc||So==null||So!==ka(R)||(R=So,"selectionStart"in R&&_l(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),yl&&oo(yl,R)||(yl=R,R=pg(ad,"onSelect"),0<R.length&&(y=new Yu("onSelect","select",null,y,k),d.push({event:y,listeners:R}),y.target=So)))}function Ds(d,y){var k={};return k[d.toLowerCase()]=y.toLowerCase(),k["Webkit"+d]="webkit"+y,k["Moz"+d]="moz"+y,k}var el={animationend:Ds("Animation","AnimationEnd"),animationiteration:Ds("Animation","AnimationIteration"),animationstart:Ds("Animation","AnimationStart"),transitionrun:Ds("Transition","TransitionRun"),transitionstart:Ds("Transition","TransitionStart"),transitioncancel:Ds("Transition","TransitionCancel"),transitionend:Ds("Transition","TransitionEnd")},Ah={},Ch={};Dl&&(Ch=document.createElement("div").style,"AnimationEvent"in window||(delete el.animationend.animation,delete el.animationiteration.animation,delete el.animationstart.animation),"TransitionEvent"in window||delete el.transitionend.transition);function Kc(d){if(Ah[d])return Ah[d];if(!el[d])return d;var y=el[d],k;for(k in y)if(y.hasOwnProperty(k)&&k in Ch)return Ah[d]=y[k];return d}var Tf=Kc("animationend"),vl=Kc("animationiteration"),Cu=Kc("animationstart"),Jc=Kc("transitionrun"),Vd=Kc("transitionstart"),Am=Kc("transitioncancel"),sd=Kc("transitionend"),vc=new Map,Ol="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ol.push("scrollEnd");function Qr(d,y){vc.set(d,y),ot(y,[d])}var Qc=new WeakMap;function Ls(d,y){if(typeof d=="object"&&d!==null){var k=Qc.get(d);return k!==void 0?k:(y={value:d,source:y,stack:an(y)},Qc.set(d,y),y)}return{value:d,source:y,stack:an(y)}}var Os=[],eu=0,Fo=0;function Js(){for(var d=eu,y=Fo=eu=0;y<d;){var k=Os[y];Os[y++]=null;var R=Os[y];Os[y++]=null;var G=Os[y];Os[y++]=null;var Q=Os[y];if(Os[y++]=null,R!==null&&G!==null){var we=R.pending;we===null?G.next=G:(G.next=we.next,we.next=G),R.pending=G}Q!==0&&nu(k,G,Q)}}function tu(d,y,k,R){Os[eu++]=d,Os[eu++]=y,Os[eu++]=k,Os[eu++]=R,Fo|=R,d.lanes|=R,d=d.alternate,d!==null&&(d.lanes|=R)}function Xt(d,y,k,R){return tu(d,y,k,R),Nl(d)}function iu(d,y){return tu(d,null,null,y),Nl(d)}function nu(d,y,k){d.lanes|=k;var R=d.alternate;R!==null&&(R.lanes|=k);for(var G=!1,Q=d.return;Q!==null;)Q.childLanes|=k,R=Q.alternate,R!==null&&(R.childLanes|=k),Q.tag===22&&(d=Q.stateNode,d===null||d._visibility&1||(G=!0)),d=Q,Q=Q.return;return d.tag===3?(Q=d.stateNode,G&&y!==null&&(G=31-mr(k),d=Q.hiddenUpdates,R=d[G],R===null?d[G]=[y]:R.push(y),y.lane=k|536870912),Q):null}function Nl(d){if(50<Pn)throw Pn=0,Jn=null,Error(h(185));for(var y=d.return;y!==null;)d=y,y=d.return;return d.tag===3?d.stateNode:null}var xc={};function od(d,y,k,R){this.tag=d,this.key=k,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function es(d,y,k,R){return new od(d,y,k,R)}function ld(d){return d=d.prototype,!(!d||!d.isReactComponent)}function lo(d,y){var k=d.alternate;return k===null?(k=es(d.tag,y,d.key,d.mode),k.elementType=d.elementType,k.type=d.type,k.stateNode=d.stateNode,k.alternate=d,d.alternate=k):(k.pendingProps=y,k.type=d.type,k.flags=0,k.subtreeFlags=0,k.deletions=null),k.flags=d.flags&65011712,k.childLanes=d.childLanes,k.lanes=d.lanes,k.child=d.child,k.memoizedProps=d.memoizedProps,k.memoizedState=d.memoizedState,k.updateQueue=d.updateQueue,y=d.dependencies,k.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},k.sibling=d.sibling,k.index=d.index,k.ref=d.ref,k.refCleanup=d.refCleanup,k}function bc(d,y){d.flags&=65011714;var k=d.alternate;return k===null?(d.childLanes=0,d.lanes=y,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=k.childLanes,d.lanes=k.lanes,d.child=k.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=k.memoizedProps,d.memoizedState=k.memoizedState,d.updateQueue=k.updateQueue,d.type=k.type,y=k.dependencies,d.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext}),d}function xl(d,y,k,R,G,Q){var we=0;if(R=d,typeof d=="function")ld(d)&&(we=1);else if(typeof d=="string")we=Pd(d,k,oi.current)?26:d==="html"||d==="head"||d==="body"?27:5;else e:switch(d){case lt:return d=es(31,k,y,G),d.elementType=lt,d.lanes=Q,d;case re:return Fl(k.children,G,Q,y);case ae:we=8,G|=24;break;case ce:return d=es(12,k,y,G|2),d.elementType=ce,d.lanes=Q,d;case He:return d=es(13,k,y,G),d.elementType=He,d.lanes=Q,d;case ke:return d=es(19,k,y,G),d.elementType=ke,d.lanes=Q,d;default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case ve:case Ee:we=10;break e;case Se:we=9;break e;case Qe:we=11;break e;case tt:we=14;break e;case Ke:we=16,R=null;break e}we=29,k=Error(h(130,d===null?"null":typeof d,"")),R=null}return y=es(we,k,y,G),y.elementType=d,y.type=R,y.lanes=Q,y}function Fl(d,y,k,R){return d=es(7,d,R,y),d.lanes=k,d}function Mh(d,y,k){return d=es(6,d,null,y),d.lanes=k,d}function Mu(d,y,k){return y=es(4,d.children!==null?d.children:[],d.key,y),y.lanes=k,y.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},y}var Pu=[],ju=0,b=null,I=0,$=[],te=0,me=null,Le=1,ut="";function Bt(d,y){Pu[ju++]=I,Pu[ju++]=b,b=d,I=y}function It(d,y,k){$[te++]=Le,$[te++]=ut,$[te++]=me,me=d;var R=Le;d=ut;var G=32-mr(R)-1;R&=~(1<<G),k+=1;var Q=32-mr(y)+G;if(30<Q){var we=G-G%5;Q=(R&(1<<we)-1).toString(32),R>>=we,G-=we,Le=1<<32-mr(y)+G|k<<G|R,ut=Q+d}else Le=1<<Q|k<<G|R,ut=d}function ji(d){d.return!==null&&(Bt(d,1),It(d,1,0))}function cn(d){for(;d===b;)b=Pu[--ju],Pu[ju]=null,I=Pu[--ju],Pu[ju]=null;for(;d===me;)me=$[--te],$[te]=null,ut=$[--te],$[te]=null,Le=$[--te],$[te]=null}var vn=null,En=null,oa=!1,pr=null,Ar=!1,hs=Error(h(519));function Qs(d){var y=Error(h(418,""));throw wc(Ls(y,d)),hs}function kf(d){var y=d.stateNode,k=d.type,R=d.memoizedProps;switch(y[Qt]=d,y[Ei]=R,k){case"dialog":rr("cancel",y),rr("close",y);break;case"iframe":case"object":case"embed":rr("load",y);break;case"video":case"audio":for(k=0;k<up.length;k++)rr(up[k],y);break;case"source":rr("error",y);break;case"img":case"image":case"link":rr("error",y),rr("load",y);break;case"details":rr("toggle",y);break;case"input":rr("invalid",y),zo(y,R.value,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name,!0),Wa(y);break;case"select":rr("invalid",y);break;case"textarea":rr("invalid",y),Io(y,R.value,R.defaultValue,R.children),Wa(y)}k=R.children,typeof k!="string"&&typeof k!="number"&&typeof k!="bigint"||y.textContent===""+k||R.suppressHydrationWarning===!0||jy(y.textContent,k)?(R.popover!=null&&(rr("beforetoggle",y),rr("toggle",y)),R.onScroll!=null&&rr("scroll",y),R.onScrollEnd!=null&&rr("scrollend",y),R.onClick!=null&&(y.onclick=dp),y=!0):y=!1,y||Qs(d)}function Ph(d){for(vn=d.return;vn;)switch(vn.tag){case 5:case 13:Ar=!1;return;case 27:case 3:Ar=!0;return;default:vn=vn.return}}function cd(d){if(d!==vn)return!1;if(!oa)return Ph(d),oa=!0,!1;var y=d.tag,k;if((k=y!==3&&y!==27)&&((k=y===5)&&(k=d.type,k=!(k!=="form"&&k!=="button")||p_(d.type,d.memoizedProps)),k=!k),k&&En&&Qs(d),Ph(d),y===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(h(317));e:{for(d=d.nextSibling,y=0;d;){if(d.nodeType===8)if(k=d.data,k==="/$"){if(y===0){En=br(d.nextSibling);break e}y--}else k!=="$"&&k!=="$!"&&k!=="$?"||y++;d=d.nextSibling}En=null}}else y===27?(y=En,af(d.type)?(d=rf,rf=null,En=d):En=y):En=vn?br(d.stateNode.nextSibling):null;return!0}function Bl(){En=vn=null,oa=!1}function Hd(){var d=pr;return d!==null&&(pt===null?pt=d:pt.push.apply(pt,d),pr=null),d}function wc(d){pr===null?pr=[d]:pr.push(d)}var Ur=_t(null),tl=null,il=null;function Sc(d,y,k){Ct(Ur,y._currentValue),y._currentValue=k}function rc(d){d._currentValue=Ur.current,At(Ur)}function ud(d,y,k){for(;d!==null;){var R=d.alternate;if((d.childLanes&y)!==y?(d.childLanes|=y,R!==null&&(R.childLanes|=y)):R!==null&&(R.childLanes&y)!==y&&(R.childLanes|=y),d===k)break;d=d.return}}function Tc(d,y,k,R){var G=d.child;for(G!==null&&(G.return=d);G!==null;){var Q=G.dependencies;if(Q!==null){var we=G.child;Q=Q.firstContext;e:for(;Q!==null;){var $e=Q;Q=G;for(var ct=0;ct<y.length;ct++)if($e.context===y[ct]){Q.lanes|=k,$e=Q.alternate,$e!==null&&($e.lanes|=k),ud(Q.return,k,d),R||(we=null);break e}Q=$e.next}}else if(G.tag===18){if(we=G.return,we===null)throw Error(h(341));we.lanes|=k,Q=we.alternate,Q!==null&&(Q.lanes|=k),ud(we,k,d),we=null}else we=G.child;if(we!==null)we.return=G;else for(we=G;we!==null;){if(we===d){we=null;break}if(G=we.sibling,G!==null){G.return=we.return,we=G;break}we=we.return}G=we}}function dd(d,y,k,R){d=null;for(var G=y,Q=!1;G!==null;){if(!Q){if((G.flags&524288)!==0)Q=!0;else if((G.flags&262144)!==0)break}if(G.tag===10){var we=G.alternate;if(we===null)throw Error(h(387));if(we=we.memoizedProps,we!==null){var $e=G.type;Sr(G.pendingProps.value,we.value)||(d!==null?d.push($e):d=[$e])}}else if(G===Ba.current){if(we=G.alternate,we===null)throw Error(h(387));we.memoizedState.memoizedState!==G.memoizedState.memoizedState&&(d!==null?d.push(ch):d=[ch])}G=G.return}d!==null&&Tc(y,d,k,R),y.flags|=262144}function Cm(d){for(d=d.firstContext;d!==null;){if(!Sr(d.context._currentValue,d.memoizedValue))return!0;d=d.next}return!1}function Gd(d){tl=d,il=null,d=d.dependencies,d!==null&&(d.firstContext=null)}function Bo(d){return Mm(tl,d)}function jh(d,y){return tl===null&&Gd(d),Mm(d,y)}function Mm(d,y){var k=y._currentValue;if(y={context:y,memoizedValue:k,next:null},il===null){if(d===null)throw Error(h(308));il=y,d.dependencies={lanes:0,firstContext:y},d.flags|=524288}else il=il.next=y;return k}var Wp=typeof AbortController<"u"?AbortController:function(){var d=[],y=this.signal={aborted:!1,addEventListener:function(k,R){d.push(R)}};this.abort=function(){y.aborted=!0,d.forEach(function(k){return k()})}},Zp=o.unstable_scheduleCallback,e_=o.unstable_NormalPriority,fs={$$typeof:Ee,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zh(){return{controller:new Wp,data:new Map,refCount:0}}function au(d){d.refCount--,d.refCount===0&&Zp(e_,function(){d.controller.abort()})}var zu=null,Pm=0,co=0,Iu=null;function Ef(d,y){if(zu===null){var k=zu=[];Pm=0,co=cp(),Iu={status:"pending",value:void 0,then:function(R){k.push(R)}}}return Pm++,y.then(ru,ru),y}function ru(){if(--Pm===0&&zu!==null){Iu!==null&&(Iu.status="fulfilled");var d=zu;zu=null,co=0,Iu=null;for(var y=0;y<d.length;y++)(0,d[y])()}}function jm(d,y){var k=[],R={status:"pending",value:null,reason:null,then:function(G){k.push(G)}};return d.then(function(){R.status="fulfilled",R.value=y;for(var G=0;G<k.length;G++)(0,k[G])(y)},function(G){for(R.status="rejected",R.reason=G,G=0;G<k.length;G++)(0,k[G])(void 0)}),R}var Af=We.S;We.S=function(d,y){typeof y=="object"&&y!==null&&typeof y.then=="function"&&Ef(d,y),Af!==null&&Af(d,y)};var Ru=_t(null);function hd(){var d=Ru.current;return d!==null?d:xe.pooledCache}function fd(d,y){y===null?Ct(Ru,Ru.current):Ct(Ru,y.pool)}function Ih(){var d=hd();return d===null?null:{parent:fs._currentValue,pool:d}}var md=Error(h(460)),zm=Error(h(474)),Rh=Error(h(542)),Cf={then:function(){}};function qd(d){return d=d.status,d==="fulfilled"||d==="rejected"}function Im(){}function t_(d,y,k){switch(k=d[k],k===void 0?d.push(y):k!==y&&(y.then(Im,Im),y=k),y.status){case"fulfilled":return y.value;case"rejected":throw d=y.reason,Mf(d),d;default:if(typeof y.status=="string")y.then(Im,Im);else{if(d=xe,d!==null&&100<d.shellSuspendCounter)throw Error(h(482));d=y,d.status="pending",d.then(function(R){if(y.status==="pending"){var G=y;G.status="fulfilled",G.value=R}},function(R){if(y.status==="pending"){var G=y;G.status="rejected",G.reason=R}})}switch(y.status){case"fulfilled":return y.value;case"rejected":throw d=y.reason,Mf(d),d}throw Dh=y,md}}var Dh=null;function Xp(){if(Dh===null)throw Error(h(459));var d=Dh;return Dh=null,d}function Mf(d){if(d===md||d===Rh)throw Error(h(483))}var pd=!1;function Lh(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Pf(d,y){d=d.updateQueue,y.updateQueue===d&&(y.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,callbacks:null})}function Du(d){return{lane:d,tag:0,payload:null,callback:null,next:null}}function Ul(d,y,k){var R=d.updateQueue;if(R===null)return null;if(R=R.shared,(pe&2)!==0){var G=R.pending;return G===null?y.next=y:(y.next=G.next,G.next=y),R.pending=y,y=Nl(d),nu(d,null,k),y}return tu(d,R,y,k),Nl(d)}function Wd(d,y,k){if(y=y.updateQueue,y!==null&&(y=y.shared,(k&4194048)!==0)){var R=y.lanes;R&=d.pendingLanes,k|=R,y.lanes=k,tc(d,k)}}function jf(d,y){var k=d.updateQueue,R=d.alternate;if(R!==null&&(R=R.updateQueue,k===R)){var G=null,Q=null;if(k=k.firstBaseUpdate,k!==null){do{var we={lane:k.lane,tag:k.tag,payload:k.payload,callback:null,next:null};Q===null?G=Q=we:Q=Q.next=we,k=k.next}while(k!==null);Q===null?G=Q=y:Q=Q.next=y}else G=Q=y;k={baseState:R.baseState,firstBaseUpdate:G,lastBaseUpdate:Q,shared:R.shared,callbacks:R.callbacks},d.updateQueue=k;return}d=k.lastBaseUpdate,d===null?k.firstBaseUpdate=y:d.next=y,k.lastBaseUpdate=y}var Rm=!1;function Zd(){if(Rm){var d=Iu;if(d!==null)throw d}}function sc(d,y,k,R){Rm=!1;var G=d.updateQueue;pd=!1;var Q=G.firstBaseUpdate,we=G.lastBaseUpdate,$e=G.shared.pending;if($e!==null){G.shared.pending=null;var ct=$e,Jt=ct.next;ct.next=null,we===null?Q=Jt:we.next=Jt,we=ct;var vi=d.alternate;vi!==null&&(vi=vi.updateQueue,$e=vi.lastBaseUpdate,$e!==we&&($e===null?vi.firstBaseUpdate=Jt:$e.next=Jt,vi.lastBaseUpdate=ct))}if(Q!==null){var Ai=G.baseState;we=0,vi=Jt=ct=null,$e=Q;do{var ii=$e.lane&-536870913,ri=ii!==$e.lane;if(ri?(je&ii)===ii:(R&ii)===ii){ii!==0&&ii===co&&(Rm=!0),vi!==null&&(vi=vi.next={lane:0,tag:$e.tag,payload:$e.payload,callback:null,next:null});e:{var ga=d,Kn=$e;ii=y;var Dr=k;switch(Kn.tag){case 1:if(ga=Kn.payload,typeof ga=="function"){Ai=ga.call(Dr,Ai,ii);break e}Ai=ga;break e;case 3:ga.flags=ga.flags&-65537|128;case 0:if(ga=Kn.payload,ii=typeof ga=="function"?ga.call(Dr,Ai,ii):ga,ii==null)break e;Ai=N({},Ai,ii);break e;case 2:pd=!0}}ii=$e.callback,ii!==null&&(d.flags|=64,ri&&(d.flags|=8192),ri=G.callbacks,ri===null?G.callbacks=[ii]:ri.push(ii))}else ri={lane:ii,tag:$e.tag,payload:$e.payload,callback:$e.callback,next:null},vi===null?(Jt=vi=ri,ct=Ai):vi=vi.next=ri,we|=ii;if($e=$e.next,$e===null){if($e=G.shared.pending,$e===null)break;ri=$e,$e=ri.next,ri.next=null,G.lastBaseUpdate=ri,G.shared.pending=null}}while(!0);vi===null&&(ct=Ai),G.baseState=ct,G.firstBaseUpdate=Jt,G.lastBaseUpdate=vi,Q===null&&(G.shared.lanes=0),dt|=we,d.lanes=we,d.memoizedState=Ai}}function gd(d,y){if(typeof d!="function")throw Error(h(191,d));d.call(y)}function zf(d,y){var k=d.callbacks;if(k!==null)for(d.callbacks=null,d=0;d<k.length;d++)gd(k[d],y)}var Xd=_t(null),kc=_t(0);function Dm(d,y){d=it,Ct(kc,d),Ct(Xd,y),it=d|y.baseLanes}function Yd(){Ct(kc,it),Ct(Xd,Xd.current)}function Lm(){it=kc.current,At(Xd),At(kc)}var Lu=0,Ca=null,vr=null,Ts=null,If=!1,nl=!1,Kd=!1,Om=0,Oh=0,Jd=null,Nm=0;function Gr(){throw Error(h(321))}function su(d,y){if(y===null)return!1;for(var k=0;k<y.length&&k<d.length;k++)if(!Sr(d[k],y[k]))return!1;return!0}function _d(d,y,k,R,G,Q){return Lu=Q,Ca=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,We.H=d===null||d.memoizedState===null?ko:sg,Kd=!1,Q=k(R,G),Kd=!1,nl&&(Q=Fm(y,k,R,G)),yd(d),Q}function yd(d){We.H=Vl;var y=vr!==null&&vr.next!==null;if(Lu=0,Ts=vr=Ca=null,If=!1,Oh=0,Jd=null,y)throw Error(h(300));d===null||Rr||(d=d.dependencies,d!==null&&Cm(d)&&(Rr=!0))}function Fm(d,y,k,R){Ca=d;var G=0;do{if(nl&&(Jd=null),Oh=0,nl=!1,25<=G)throw Error(h(301));if(G+=1,Ts=vr=null,d.updateQueue!=null){var Q=d.updateQueue;Q.lastEffect=null,Q.events=null,Q.stores=null,Q.memoCache!=null&&(Q.memoCache.index=0)}We.H=Wf,Q=y(k,R)}while(nl);return Q}function Bm(){var d=We.H,y=d.useState()[0];return y=typeof y.then=="function"?yi(y):y,d=d.useState()[0],(vr!==null?vr.memoizedState:null)!==d&&(Ca.flags|=1024),y}function $l(){var d=Om!==0;return Om=0,d}function Rf(d,y,k){y.updateQueue=d.updateQueue,y.flags&=-2053,d.lanes&=~k}function Um(d){if(If){for(d=d.memoizedState;d!==null;){var y=d.queue;y!==null&&(y.pending=null),d=d.next}If=!1}Lu=0,Ts=vr=Ca=null,nl=!1,Oh=Om=0,Jd=null}function al(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ts===null?Ca.memoizedState=Ts=d:Ts=Ts.next=d,Ts}function qr(){if(vr===null){var d=Ca.alternate;d=d!==null?d.memoizedState:null}else d=vr.next;var y=Ts===null?Ca.memoizedState:Ts.next;if(y!==null)Ts=y,vr=d;else{if(d===null)throw Ca.alternate===null?Error(h(467)):Error(h(310));vr=d,d={memoizedState:vr.memoizedState,baseState:vr.baseState,baseQueue:vr.baseQueue,queue:vr.queue,next:null},Ts===null?Ca.memoizedState=Ts=d:Ts=Ts.next=d}return Ts}function Ou(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function yi(d){var y=Oh;return Oh+=1,Jd===null&&(Jd=[]),d=t_(Jd,d,y),y=Ca,(Ts===null?y.memoizedState:Ts.next)===null&&(y=y.alternate,We.H=y===null||y.memoizedState===null?ko:sg),d}function vd(d){if(d!==null&&typeof d=="object"){if(typeof d.then=="function")return yi(d);if(d.$$typeof===Ee)return Bo(d)}throw Error(h(438,String(d)))}function Ec(d){var y=null,k=Ca.updateQueue;if(k!==null&&(y=k.memoCache),y==null){var R=Ca.alternate;R!==null&&(R=R.updateQueue,R!==null&&(R=R.memoCache,R!=null&&(y={data:R.data.map(function(G){return G.slice()}),index:0})))}if(y==null&&(y={data:[],index:0}),k===null&&(k=Ou(),Ca.updateQueue=k),k.memoCache=y,k=y.data[y.index],k===void 0)for(k=y.data[y.index]=Array(d),R=0;R<d;R++)k[R]=ft;return y.index++,k}function Uo(d,y){return typeof y=="function"?y(d):y}function Hi(d){var y=qr();return Qd(y,vr,d)}function Qd(d,y,k){var R=d.queue;if(R===null)throw Error(h(311));R.lastRenderedReducer=k;var G=d.baseQueue,Q=R.pending;if(Q!==null){if(G!==null){var we=G.next;G.next=Q.next,Q.next=we}y.baseQueue=G=Q,R.pending=null}if(Q=d.baseState,G===null)d.memoizedState=Q;else{y=G.next;var $e=we=null,ct=null,Jt=y,vi=!1;do{var Ai=Jt.lane&-536870913;if(Ai!==Jt.lane?(je&Ai)===Ai:(Lu&Ai)===Ai){var ii=Jt.revertLane;if(ii===0)ct!==null&&(ct=ct.next={lane:0,revertLane:0,action:Jt.action,hasEagerState:Jt.hasEagerState,eagerState:Jt.eagerState,next:null}),Ai===co&&(vi=!0);else if((Lu&ii)===ii){Jt=Jt.next,ii===co&&(vi=!0);continue}else Ai={lane:0,revertLane:Jt.revertLane,action:Jt.action,hasEagerState:Jt.hasEagerState,eagerState:Jt.eagerState,next:null},ct===null?($e=ct=Ai,we=Q):ct=ct.next=Ai,Ca.lanes|=ii,dt|=ii;Ai=Jt.action,Kd&&k(Q,Ai),Q=Jt.hasEagerState?Jt.eagerState:k(Q,Ai)}else ii={lane:Ai,revertLane:Jt.revertLane,action:Jt.action,hasEagerState:Jt.hasEagerState,eagerState:Jt.eagerState,next:null},ct===null?($e=ct=ii,we=Q):ct=ct.next=ii,Ca.lanes|=Ai,dt|=Ai;Jt=Jt.next}while(Jt!==null&&Jt!==y);if(ct===null?we=Q:ct.next=$e,!Sr(Q,d.memoizedState)&&(Rr=!0,vi&&(k=Iu,k!==null)))throw k;d.memoizedState=Q,d.baseState=we,d.baseQueue=ct,R.lastRenderedState=Q}return G===null&&(R.lanes=0),[d.memoizedState,R.dispatch]}function Df(d){var y=qr(),k=y.queue;if(k===null)throw Error(h(311));k.lastRenderedReducer=d;var R=k.dispatch,G=k.pending,Q=y.memoizedState;if(G!==null){k.pending=null;var we=G=G.next;do Q=d(Q,we.action),we=we.next;while(we!==G);Sr(Q,y.memoizedState)||(Rr=!0),y.memoizedState=Q,y.baseQueue===null&&(y.baseState=Q),k.lastRenderedState=Q}return[Q,R]}function Yp(d,y,k){var R=Ca,G=qr(),Q=oa;if(Q){if(k===void 0)throw Error(h(407));k=k()}else k=y();var we=!Sr((vr||G).memoizedState,k);we&&(G.memoizedState=k,Rr=!0),G=G.queue;var $e=Nf.bind(null,R,G,d);if(Ac(2048,8,$e,[d]),G.getSnapshot!==y||we||Ts!==null&&Ts.memoizedState.tag&1){if(R.flags|=2048,eh(9,Bf(),Of.bind(null,R,G,k,y),null),xe===null)throw Error(h(349));Q||(Lu&124)!==0||Lf(R,y,k)}return k}function Lf(d,y,k){d.flags|=16384,d={getSnapshot:y,value:k},y=Ca.updateQueue,y===null?(y=Ou(),Ca.updateQueue=y,y.stores=[d]):(k=y.stores,k===null?y.stores=[d]:k.push(d))}function Of(d,y,k,R){y.value=k,y.getSnapshot=R,$m(y)&&ou(d)}function Nf(d,y,k){return k(function(){$m(y)&&ou(d)})}function $m(d){var y=d.getSnapshot;d=d.value;try{var k=y();return!Sr(d,k)}catch{return!0}}function ou(d){var y=iu(d,2);y!==null&&Wi(y,d,2)}function Kp(d){var y=al();if(typeof d=="function"){var k=d;if(d=k(),Kd){us(!0);try{k()}finally{us(!1)}}}return y.memoizedState=y.baseState=d,y.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Uo,lastRenderedState:d},y}function rl(d,y,k,R){return d.baseState=k,Qd(d,vr,typeof R=="function"?R:Uo)}function Jp(d,y,k,R,G){if(qf(d))throw Error(h(485));if(d=y.action,d!==null){var Q={payload:G,action:d,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(we){Q.listeners.push(we)}};We.T!==null?k(!0):Q.isTransition=!1,R(Q),k=y.pending,k===null?(Q.next=y.pending=Q,To(y,Q)):(Q.next=k.next,y.pending=k.next=Q)}}function To(d,y){var k=y.action,R=y.payload,G=d.state;if(y.isTransition){var Q=We.T,we={};We.T=we;try{var $e=k(G,R),ct=We.S;ct!==null&&ct(we,$e),lu(d,y,$e)}catch(Jt){Fh(d,y,Jt)}finally{We.T=Q}}else try{Q=k(G,R),lu(d,y,Q)}catch(Jt){Fh(d,y,Jt)}}function lu(d,y,k){k!==null&&typeof k=="object"&&typeof k.then=="function"?k.then(function(R){Nh(d,y,R)},function(R){return Fh(d,y,R)}):Nh(d,y,k)}function Nh(d,y,k){y.status="fulfilled",y.value=k,Ff(y),d.state=k,y=d.pending,y!==null&&(k=y.next,k===y?d.pending=null:(k=k.next,y.next=k,To(d,k)))}function Fh(d,y,k){var R=d.pending;if(d.pending=null,R!==null){R=R.next;do y.status="rejected",y.reason=k,Ff(y),y=y.next;while(y!==R)}d.action=null}function Ff(d){d=d.listeners;for(var y=0;y<d.length;y++)(0,d[y])()}function Bh(d,y){return y}function Qp(d,y){if(oa){var k=xe.formState;if(k!==null){e:{var R=Ca;if(oa){if(En){t:{for(var G=En,Q=Ar;G.nodeType!==8;){if(!Q){G=null;break t}if(G=br(G.nextSibling),G===null){G=null;break t}}Q=G.data,G=Q==="F!"||Q==="F"?G:null}if(G){En=br(G.nextSibling),R=G.data==="F!";break e}}Qs(R)}R=!1}R&&(y=k[0])}}return k=al(),k.memoizedState=k.baseState=y,R={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bh,lastRenderedState:y},k.queue=R,k=Sd.bind(null,Ca,R),R.dispatch=k,R=Kp(!1),Q=Wm.bind(null,Ca,!1,R.queue),R=al(),G={state:y,dispatch:null,action:d,pending:null},R.queue=G,k=Jp.bind(null,Ca,G,Q,k),G.dispatch=k,R.memoizedState=d,[y,k,!1]}function cu(d){var y=qr();return Da(y,vr,d)}function Da(d,y,k){if(y=Qd(d,y,Bh)[0],d=Hi(Uo)[0],typeof y=="object"&&y!==null&&typeof y.then=="function")try{var R=yi(y)}catch(we){throw we===md?Rh:we}else R=y;y=qr();var G=y.queue,Q=G.dispatch;return k!==y.memoizedState&&(Ca.flags|=2048,eh(9,Bf(),Vm.bind(null,G,k),null)),[R,Q,d]}function Vm(d,y){d.action=y}function Hm(d){var y=qr(),k=vr;if(k!==null)return Da(y,k,d);qr(),y=y.memoizedState,k=qr();var R=k.queue.dispatch;return k.memoizedState=d,[y,R,!1]}function eh(d,y,k,R){return d={tag:d,create:k,deps:R,inst:y,next:null},y=Ca.updateQueue,y===null&&(y=Ou(),Ca.updateQueue=y),k=y.lastEffect,k===null?y.lastEffect=d.next=d:(R=k.next,k.next=d,d.next=R,y.lastEffect=d),d}function Bf(){return{destroy:void 0,resource:void 0}}function eg(){return qr().memoizedState}function Uf(d,y,k,R){var G=al();R=R===void 0?null:R,Ca.flags|=d,G.memoizedState=eh(1|y,Bf(),k,R)}function Ac(d,y,k,R){var G=qr();R=R===void 0?null:R;var Q=G.memoizedState.inst;vr!==null&&R!==null&&su(R,vr.memoizedState.deps)?G.memoizedState=eh(y,Q,k,R):(Ca.flags|=d,G.memoizedState=eh(1|y,Q,k,R))}function xd(d,y){Uf(8390656,8,d,y)}function Kt(d,y){Ac(2048,8,d,y)}function si(d,y){return Ac(4,2,d,y)}function bd(d,y){return Ac(4,4,d,y)}function ur(d,y){if(typeof y=="function"){d=d();var k=y(d);return function(){typeof k=="function"?k():y(null)}}if(y!=null)return d=d(),y.current=d,function(){y.current=null}}function at(d,y,k){k=k!=null?k.concat([d]):null,Ac(4,4,ur.bind(null,y,d),k)}function Gm(){}function $f(d,y){var k=qr();y=y===void 0?null:y;var R=k.memoizedState;return y!==null&&su(y,R[1])?R[0]:(k.memoizedState=[d,y],d)}function Cc(d,y){var k=qr();y=y===void 0?null:y;var R=k.memoizedState;if(y!==null&&su(y,R[1]))return R[0];if(R=d(),Kd){us(!0);try{d()}finally{us(!1)}}return k.memoizedState=[R,y],R}function Uh(d,y,k){return k===void 0||(Lu&1073741824)!==0?d.memoizedState=y:(d.memoizedState=k,d=Qn(),Ca.lanes|=d,dt|=d,k)}function wd(d,y,k,R){return Sr(k,y)?k:Xd.current!==null?(d=Uh(d,k,R),Sr(d,y)||(Rr=!0),d):(Lu&42)===0?(Rr=!0,d.memoizedState=k):(d=Qn(),Ca.lanes|=d,dt|=d,y)}function tg(d,y,k,R,G){var Q=Et.p;Et.p=Q!==0&&8>Q?Q:8;var we=We.T,$e={};We.T=$e,Wm(d,!1,y,k);try{var ct=G(),Jt=We.S;if(Jt!==null&&Jt($e,ct),ct!==null&&typeof ct=="object"&&typeof ct.then=="function"){var vi=jm(ct,R);sl(d,y,vi,wi(d))}else sl(d,y,R,wi(d))}catch(Ai){sl(d,y,{then:function(){},status:"rejected",reason:Ai},wi())}finally{Et.p=Q,We.T=we}}function $h(){}function ig(d,y,k,R){if(d.tag!==5)throw Error(h(476));var G=i_(d).queue;tg(d,G,y,jt,k===null?$h:function(){return ng(d),k(R)})}function i_(d){var y=d.memoizedState;if(y!==null)return y;y={memoizedState:jt,baseState:jt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Uo,lastRenderedState:jt},next:null};var k={};return y.next={memoizedState:k,baseState:k,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Uo,lastRenderedState:k},next:null},d.memoizedState=y,d=d.alternate,d!==null&&(d.memoizedState=y),y}function ng(d){var y=i_(d).next.queue;sl(d,y,{},wi())}function Vh(){return Bo(ch)}function Vf(){return qr().memoizedState}function Hf(){return qr().memoizedState}function qm(d){for(var y=d.return;y!==null;){switch(y.tag){case 24:case 3:var k=wi();d=Du(k);var R=Ul(y,d,k);R!==null&&(Wi(R,y,k),Wd(R,y,k)),y={cache:zh()},d.payload=y;return}y=y.return}}function Gf(d,y,k){var R=wi();k={lane:R,revertLane:0,action:k,hasEagerState:!1,eagerState:null,next:null},qf(d)?ag(y,k):(k=Xt(d,y,k,R),k!==null&&(Wi(k,d,R),rg(k,y,R)))}function Sd(d,y,k){var R=wi();sl(d,y,k,R)}function sl(d,y,k,R){var G={lane:R,revertLane:0,action:k,hasEagerState:!1,eagerState:null,next:null};if(qf(d))ag(y,G);else{var Q=d.alternate;if(d.lanes===0&&(Q===null||Q.lanes===0)&&(Q=y.lastRenderedReducer,Q!==null))try{var we=y.lastRenderedState,$e=Q(we,k);if(G.hasEagerState=!0,G.eagerState=$e,Sr($e,we))return tu(d,y,G,0),xe===null&&Js(),!1}catch{}finally{}if(k=Xt(d,y,G,R),k!==null)return Wi(k,d,R),rg(k,y,R),!0}return!1}function Wm(d,y,k,R){if(R={lane:2,revertLane:cp(),action:R,hasEagerState:!1,eagerState:null,next:null},qf(d)){if(y)throw Error(h(479))}else y=Xt(d,k,R,2),y!==null&&Wi(y,d,2)}function qf(d){var y=d.alternate;return d===Ca||y!==null&&y===Ca}function ag(d,y){nl=If=!0;var k=d.pending;k===null?y.next=y:(y.next=k.next,k.next=y),d.pending=y}function rg(d,y,k){if((k&4194048)!==0){var R=y.lanes;R&=d.pendingLanes,k|=R,y.lanes=k,tc(d,k)}}var Vl={readContext:Bo,use:vd,useCallback:Gr,useContext:Gr,useEffect:Gr,useImperativeHandle:Gr,useLayoutEffect:Gr,useInsertionEffect:Gr,useMemo:Gr,useReducer:Gr,useRef:Gr,useState:Gr,useDebugValue:Gr,useDeferredValue:Gr,useTransition:Gr,useSyncExternalStore:Gr,useId:Gr,useHostTransitionStatus:Gr,useFormState:Gr,useActionState:Gr,useOptimistic:Gr,useMemoCache:Gr,useCacheRefresh:Gr},ko={readContext:Bo,use:vd,useCallback:function(d,y){return al().memoizedState=[d,y===void 0?null:y],d},useContext:Bo,useEffect:xd,useImperativeHandle:function(d,y,k){k=k!=null?k.concat([d]):null,Uf(4194308,4,ur.bind(null,y,d),k)},useLayoutEffect:function(d,y){return Uf(4194308,4,d,y)},useInsertionEffect:function(d,y){Uf(4,2,d,y)},useMemo:function(d,y){var k=al();y=y===void 0?null:y;var R=d();if(Kd){us(!0);try{d()}finally{us(!1)}}return k.memoizedState=[R,y],R},useReducer:function(d,y,k){var R=al();if(k!==void 0){var G=k(y);if(Kd){us(!0);try{k(y)}finally{us(!1)}}}else G=y;return R.memoizedState=R.baseState=G,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:G},R.queue=d,d=d.dispatch=Gf.bind(null,Ca,d),[R.memoizedState,d]},useRef:function(d){var y=al();return d={current:d},y.memoizedState=d},useState:function(d){d=Kp(d);var y=d.queue,k=Sd.bind(null,Ca,y);return y.dispatch=k,[d.memoizedState,k]},useDebugValue:Gm,useDeferredValue:function(d,y){var k=al();return Uh(k,d,y)},useTransition:function(){var d=Kp(!1);return d=tg.bind(null,Ca,d.queue,!0,!1),al().memoizedState=d,[!1,d]},useSyncExternalStore:function(d,y,k){var R=Ca,G=al();if(oa){if(k===void 0)throw Error(h(407));k=k()}else{if(k=y(),xe===null)throw Error(h(349));(je&124)!==0||Lf(R,y,k)}G.memoizedState=k;var Q={value:k,getSnapshot:y};return G.queue=Q,xd(Nf.bind(null,R,Q,d),[d]),R.flags|=2048,eh(9,Bf(),Of.bind(null,R,Q,k,y),null),k},useId:function(){var d=al(),y=xe.identifierPrefix;if(oa){var k=ut,R=Le;k=(R&~(1<<32-mr(R)-1)).toString(32)+k,y=""+y+"R"+k,k=Om++,0<k&&(y+="H"+k.toString(32)),y+=""}else k=Nm++,y=""+y+"r"+k.toString(32)+"";return d.memoizedState=y},useHostTransitionStatus:Vh,useFormState:Qp,useActionState:Qp,useOptimistic:function(d){var y=al();y.memoizedState=y.baseState=d;var k={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return y.queue=k,y=Wm.bind(null,Ca,!0,k),k.dispatch=y,[d,y]},useMemoCache:Ec,useCacheRefresh:function(){return al().memoizedState=qm.bind(null,Ca)}},sg={readContext:Bo,use:vd,useCallback:$f,useContext:Bo,useEffect:Kt,useImperativeHandle:at,useInsertionEffect:si,useLayoutEffect:bd,useMemo:Cc,useReducer:Hi,useRef:eg,useState:function(){return Hi(Uo)},useDebugValue:Gm,useDeferredValue:function(d,y){var k=qr();return wd(k,vr.memoizedState,d,y)},useTransition:function(){var d=Hi(Uo)[0],y=qr().memoizedState;return[typeof d=="boolean"?d:yi(d),y]},useSyncExternalStore:Yp,useId:Vf,useHostTransitionStatus:Vh,useFormState:cu,useActionState:cu,useOptimistic:function(d,y){var k=qr();return rl(k,vr,d,y)},useMemoCache:Ec,useCacheRefresh:Hf},Wf={readContext:Bo,use:vd,useCallback:$f,useContext:Bo,useEffect:Kt,useImperativeHandle:at,useInsertionEffect:si,useLayoutEffect:bd,useMemo:Cc,useReducer:Df,useRef:eg,useState:function(){return Df(Uo)},useDebugValue:Gm,useDeferredValue:function(d,y){var k=qr();return vr===null?Uh(k,d,y):wd(k,vr.memoizedState,d,y)},useTransition:function(){var d=Df(Uo)[0],y=qr().memoizedState;return[typeof d=="boolean"?d:yi(d),y]},useSyncExternalStore:Yp,useId:Vf,useHostTransitionStatus:Vh,useFormState:Hm,useActionState:Hm,useOptimistic:function(d,y){var k=qr();return vr!==null?rl(k,vr,d,y):(k.baseState=d,[d,k.queue.dispatch])},useMemoCache:Ec,useCacheRefresh:Hf},Hh=null,La=0;function Mn(d){var y=La;return La+=1,Hh===null&&(Hh=[]),t_(Hh,d,y)}function Gh(d,y){y=y.props.ref,d.ref=y!==void 0?y:null}function Mc(d,y){throw y.$$typeof===H?Error(h(525)):(d=Object.prototype.toString.call(y),Error(h(31,d==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":d)))}function th(d){var y=d._init;return y(d._payload)}function ih(d){function y(Lt,kt){if(d){var Zt=Lt.deletions;Zt===null?(Lt.deletions=[kt],Lt.flags|=16):Zt.push(kt)}}function k(Lt,kt){if(!d)return null;for(;kt!==null;)y(Lt,kt),kt=kt.sibling;return null}function R(Lt){for(var kt=new Map;Lt!==null;)Lt.key!==null?kt.set(Lt.key,Lt):kt.set(Lt.index,Lt),Lt=Lt.sibling;return kt}function G(Lt,kt){return Lt=lo(Lt,kt),Lt.index=0,Lt.sibling=null,Lt}function Q(Lt,kt,Zt){return Lt.index=Zt,d?(Zt=Lt.alternate,Zt!==null?(Zt=Zt.index,Zt<kt?(Lt.flags|=67108866,kt):Zt):(Lt.flags|=67108866,kt)):(Lt.flags|=1048576,kt)}function we(Lt){return d&&Lt.alternate===null&&(Lt.flags|=67108866),Lt}function $e(Lt,kt,Zt,ki){return kt===null||kt.tag!==6?(kt=Mh(Zt,Lt.mode,ki),kt.return=Lt,kt):(kt=G(kt,Zt),kt.return=Lt,kt)}function ct(Lt,kt,Zt,ki){var jn=Zt.type;return jn===re?vi(Lt,kt,Zt.props.children,ki,Zt.key):kt!==null&&(kt.elementType===jn||typeof jn=="object"&&jn!==null&&jn.$$typeof===Ke&&th(jn)===kt.type)?(kt=G(kt,Zt.props),Gh(kt,Zt),kt.return=Lt,kt):(kt=xl(Zt.type,Zt.key,Zt.props,null,Lt.mode,ki),Gh(kt,Zt),kt.return=Lt,kt)}function Jt(Lt,kt,Zt,ki){return kt===null||kt.tag!==4||kt.stateNode.containerInfo!==Zt.containerInfo||kt.stateNode.implementation!==Zt.implementation?(kt=Mu(Zt,Lt.mode,ki),kt.return=Lt,kt):(kt=G(kt,Zt.children||[]),kt.return=Lt,kt)}function vi(Lt,kt,Zt,ki,jn){return kt===null||kt.tag!==7?(kt=Fl(Zt,Lt.mode,ki,jn),kt.return=Lt,kt):(kt=G(kt,Zt),kt.return=Lt,kt)}function Ai(Lt,kt,Zt){if(typeof kt=="string"&&kt!==""||typeof kt=="number"||typeof kt=="bigint")return kt=Mh(""+kt,Lt.mode,Zt),kt.return=Lt,kt;if(typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case W:return Zt=xl(kt.type,kt.key,kt.props,null,Lt.mode,Zt),Gh(Zt,kt),Zt.return=Lt,Zt;case K:return kt=Mu(kt,Lt.mode,Zt),kt.return=Lt,kt;case Ke:var ki=kt._init;return kt=ki(kt._payload),Ai(Lt,kt,Zt)}if(Ri(kt)||ni(kt))return kt=Fl(kt,Lt.mode,Zt,null),kt.return=Lt,kt;if(typeof kt.then=="function")return Ai(Lt,Mn(kt),Zt);if(kt.$$typeof===Ee)return Ai(Lt,jh(Lt,kt),Zt);Mc(Lt,kt)}return null}function ii(Lt,kt,Zt,ki){var jn=kt!==null?kt.key:null;if(typeof Zt=="string"&&Zt!==""||typeof Zt=="number"||typeof Zt=="bigint")return jn!==null?null:$e(Lt,kt,""+Zt,ki);if(typeof Zt=="object"&&Zt!==null){switch(Zt.$$typeof){case W:return Zt.key===jn?ct(Lt,kt,Zt,ki):null;case K:return Zt.key===jn?Jt(Lt,kt,Zt,ki):null;case Ke:return jn=Zt._init,Zt=jn(Zt._payload),ii(Lt,kt,Zt,ki)}if(Ri(Zt)||ni(Zt))return jn!==null?null:vi(Lt,kt,Zt,ki,null);if(typeof Zt.then=="function")return ii(Lt,kt,Mn(Zt),ki);if(Zt.$$typeof===Ee)return ii(Lt,kt,jh(Lt,Zt),ki);Mc(Lt,Zt)}return null}function ri(Lt,kt,Zt,ki,jn){if(typeof ki=="string"&&ki!==""||typeof ki=="number"||typeof ki=="bigint")return Lt=Lt.get(Zt)||null,$e(kt,Lt,""+ki,jn);if(typeof ki=="object"&&ki!==null){switch(ki.$$typeof){case W:return Lt=Lt.get(ki.key===null?Zt:ki.key)||null,ct(kt,Lt,ki,jn);case K:return Lt=Lt.get(ki.key===null?Zt:ki.key)||null,Jt(kt,Lt,ki,jn);case Ke:var Xa=ki._init;return ki=Xa(ki._payload),ri(Lt,kt,Zt,ki,jn)}if(Ri(ki)||ni(ki))return Lt=Lt.get(Zt)||null,vi(kt,Lt,ki,jn,null);if(typeof ki.then=="function")return ri(Lt,kt,Zt,Mn(ki),jn);if(ki.$$typeof===Ee)return ri(Lt,kt,Zt,jh(kt,ki),jn);Mc(kt,ki)}return null}function ga(Lt,kt,Zt,ki){for(var jn=null,Xa=null,Ln=kt,aa=kt=0,gs=null;Ln!==null&&aa<Zt.length;aa++){Ln.index>aa?(gs=Ln,Ln=null):gs=Ln.sibling;var sr=ii(Lt,Ln,Zt[aa],ki);if(sr===null){Ln===null&&(Ln=gs);break}d&&Ln&&sr.alternate===null&&y(Lt,Ln),kt=Q(sr,kt,aa),Xa===null?jn=sr:Xa.sibling=sr,Xa=sr,Ln=gs}if(aa===Zt.length)return k(Lt,Ln),oa&&Bt(Lt,aa),jn;if(Ln===null){for(;aa<Zt.length;aa++)Ln=Ai(Lt,Zt[aa],ki),Ln!==null&&(kt=Q(Ln,kt,aa),Xa===null?jn=Ln:Xa.sibling=Ln,Xa=Ln);return oa&&Bt(Lt,aa),jn}for(Ln=R(Ln);aa<Zt.length;aa++)gs=ri(Ln,Lt,aa,Zt[aa],ki),gs!==null&&(d&&gs.alternate!==null&&Ln.delete(gs.key===null?aa:gs.key),kt=Q(gs,kt,aa),Xa===null?jn=gs:Xa.sibling=gs,Xa=gs);return d&&Ln.forEach(function(pu){return y(Lt,pu)}),oa&&Bt(Lt,aa),jn}function Kn(Lt,kt,Zt,ki){if(Zt==null)throw Error(h(151));for(var jn=null,Xa=null,Ln=kt,aa=kt=0,gs=null,sr=Zt.next();Ln!==null&&!sr.done;aa++,sr=Zt.next()){Ln.index>aa?(gs=Ln,Ln=null):gs=Ln.sibling;var pu=ii(Lt,Ln,sr.value,ki);if(pu===null){Ln===null&&(Ln=gs);break}d&&Ln&&pu.alternate===null&&y(Lt,Ln),kt=Q(pu,kt,aa),Xa===null?jn=pu:Xa.sibling=pu,Xa=pu,Ln=gs}if(sr.done)return k(Lt,Ln),oa&&Bt(Lt,aa),jn;if(Ln===null){for(;!sr.done;aa++,sr=Zt.next())sr=Ai(Lt,sr.value,ki),sr!==null&&(kt=Q(sr,kt,aa),Xa===null?jn=sr:Xa.sibling=sr,Xa=sr);return oa&&Bt(Lt,aa),jn}for(Ln=R(Ln);!sr.done;aa++,sr=Zt.next())sr=ri(Ln,Lt,aa,sr.value,ki),sr!==null&&(d&&sr.alternate!==null&&Ln.delete(sr.key===null?aa:sr.key),kt=Q(sr,kt,aa),Xa===null?jn=sr:Xa.sibling=sr,Xa=sr);return d&&Ln.forEach(function(Yy){return y(Lt,Yy)}),oa&&Bt(Lt,aa),jn}function Dr(Lt,kt,Zt,ki){if(typeof Zt=="object"&&Zt!==null&&Zt.type===re&&Zt.key===null&&(Zt=Zt.props.children),typeof Zt=="object"&&Zt!==null){switch(Zt.$$typeof){case W:e:{for(var jn=Zt.key;kt!==null;){if(kt.key===jn){if(jn=Zt.type,jn===re){if(kt.tag===7){k(Lt,kt.sibling),ki=G(kt,Zt.props.children),ki.return=Lt,Lt=ki;break e}}else if(kt.elementType===jn||typeof jn=="object"&&jn!==null&&jn.$$typeof===Ke&&th(jn)===kt.type){k(Lt,kt.sibling),ki=G(kt,Zt.props),Gh(ki,Zt),ki.return=Lt,Lt=ki;break e}k(Lt,kt);break}else y(Lt,kt);kt=kt.sibling}Zt.type===re?(ki=Fl(Zt.props.children,Lt.mode,ki,Zt.key),ki.return=Lt,Lt=ki):(ki=xl(Zt.type,Zt.key,Zt.props,null,Lt.mode,ki),Gh(ki,Zt),ki.return=Lt,Lt=ki)}return we(Lt);case K:e:{for(jn=Zt.key;kt!==null;){if(kt.key===jn)if(kt.tag===4&&kt.stateNode.containerInfo===Zt.containerInfo&&kt.stateNode.implementation===Zt.implementation){k(Lt,kt.sibling),ki=G(kt,Zt.children||[]),ki.return=Lt,Lt=ki;break e}else{k(Lt,kt);break}else y(Lt,kt);kt=kt.sibling}ki=Mu(Zt,Lt.mode,ki),ki.return=Lt,Lt=ki}return we(Lt);case Ke:return jn=Zt._init,Zt=jn(Zt._payload),Dr(Lt,kt,Zt,ki)}if(Ri(Zt))return ga(Lt,kt,Zt,ki);if(ni(Zt)){if(jn=ni(Zt),typeof jn!="function")throw Error(h(150));return Zt=jn.call(Zt),Kn(Lt,kt,Zt,ki)}if(typeof Zt.then=="function")return Dr(Lt,kt,Mn(Zt),ki);if(Zt.$$typeof===Ee)return Dr(Lt,kt,jh(Lt,Zt),ki);Mc(Lt,Zt)}return typeof Zt=="string"&&Zt!==""||typeof Zt=="number"||typeof Zt=="bigint"?(Zt=""+Zt,kt!==null&&kt.tag===6?(k(Lt,kt.sibling),ki=G(kt,Zt),ki.return=Lt,Lt=ki):(k(Lt,kt),ki=Mh(Zt,Lt.mode,ki),ki.return=Lt,Lt=ki),we(Lt)):k(Lt,kt)}return function(Lt,kt,Zt,ki){try{La=0;var jn=Dr(Lt,kt,Zt,ki);return Hh=null,jn}catch(Ln){if(Ln===md||Ln===Rh)throw Ln;var Xa=es(29,Ln,null,Lt.mode);return Xa.lanes=ki,Xa.return=Lt,Xa}finally{}}}var bl=ih(!0),Zm=ih(!1),wl=_t(null),oc=null;function Pc(d){var y=d.alternate;Ct(ps,ps.current&1),Ct(wl,d),oc===null&&(y===null||Xd.current!==null||y.memoizedState!==null)&&(oc=d)}function Sl(d){if(d.tag===22){if(Ct(ps,ps.current),Ct(wl,d),oc===null){var y=d.alternate;y!==null&&y.memoizedState!==null&&(oc=d)}}else ms()}function ms(){Ct(ps,ps.current),Ct(wl,wl.current)}function ol(d){At(wl),oc===d&&(oc=null),At(ps)}var ps=_t(0);function qh(d){for(var y=d;y!==null;){if(y.tag===13){var k=y.memoizedState;if(k!==null&&(k=k.dehydrated,k===null||k.data==="$?"||um(k)))return y}else if(y.tag===19&&y.memoizedProps.revealOrder!==void 0){if((y.flags&128)!==0)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===d)break;for(;y.sibling===null;){if(y.return===null||y.return===d)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}function Zf(d,y,k,R){y=d.memoizedState,k=k(R,y),k=k==null?y:N({},y,k),d.memoizedState=k,d.lanes===0&&(d.updateQueue.baseState=k)}var uu={enqueueSetState:function(d,y,k){d=d._reactInternals;var R=wi(),G=Du(R);G.payload=y,k!=null&&(G.callback=k),y=Ul(d,G,R),y!==null&&(Wi(y,d,R),Wd(y,d,R))},enqueueReplaceState:function(d,y,k){d=d._reactInternals;var R=wi(),G=Du(R);G.tag=1,G.payload=y,k!=null&&(G.callback=k),y=Ul(d,G,R),y!==null&&(Wi(y,d,R),Wd(y,d,R))},enqueueForceUpdate:function(d,y){d=d._reactInternals;var k=wi(),R=Du(k);R.tag=2,y!=null&&(R.callback=y),y=Ul(d,R,k),y!==null&&(Wi(y,d,k),Wd(y,d,k))}};function Xf(d,y,k,R,G,Q,we){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(R,Q,we):y.prototype&&y.prototype.isPureReactComponent?!oo(k,R)||!oo(G,Q):!0}function Tl(d,y,k,R){d=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(k,R),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(k,R),y.state!==d&&uu.enqueueReplaceState(y,y.state,null)}function du(d,y){var k=y;if("ref"in y){k={};for(var R in y)R!=="ref"&&(k[R]=y[R])}if(d=d.defaultProps){k===y&&(k=N({},k));for(var G in d)k[G]===void 0&&(k[G]=d[G])}return k}var nh=typeof reportError=="function"?reportError:function(d){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof d=="object"&&d!==null&&typeof d.message=="string"?String(d.message):String(d),error:d});if(!window.dispatchEvent(y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",d);return}console.error(d)};function Yf(d){nh(d)}function Xm(d){console.error(d)}function Wr(d){nh(d)}function Nu(d,y){try{var k=d.onUncaughtError;k(y.value,{componentStack:y.stack})}catch(R){setTimeout(function(){throw R})}}function Ym(d,y,k){try{var R=d.onCaughtError;R(k.value,{componentStack:k.stack,errorBoundary:y.tag===1?y.stateNode:null})}catch(G){setTimeout(function(){throw G})}}function Kf(d,y,k){return k=Du(k),k.tag=3,k.payload={element:null},k.callback=function(){Nu(d,y)},k}function Td(d){return d=Du(d),d.tag=3,d}function Km(d,y,k,R){var G=k.type.getDerivedStateFromError;if(typeof G=="function"){var Q=R.value;d.payload=function(){return G(Q)},d.callback=function(){Ym(y,k,R)}}var we=k.stateNode;we!==null&&typeof we.componentDidCatch=="function"&&(d.callback=function(){Ym(y,k,R),typeof G!="function"&&(Wt===null?Wt=new Set([this]):Wt.add(this));var $e=R.stack;this.componentDidCatch(R.value,{componentStack:$e!==null?$e:""})})}function og(d,y,k,R,G){if(k.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){if(y=k.alternate,y!==null&&dd(y,k,G,!0),k=wl.current,k!==null){switch(k.tag){case 13:return oc===null?gn():k.alternate===null&&Ye===0&&(Ye=3),k.flags&=-257,k.flags|=65536,k.lanes=G,R===Cf?k.flags|=16384:(y=k.updateQueue,y===null?k.updateQueue=new Set([R]):y.add(R),ir(d,R,G)),!1;case 22:return k.flags|=65536,R===Cf?k.flags|=16384:(y=k.updateQueue,y===null?(y={transitions:null,markerInstances:null,retryQueue:new Set([R])},k.updateQueue=y):(k=y.retryQueue,k===null?y.retryQueue=new Set([R]):k.add(R)),ir(d,R,G)),!1}throw Error(h(435,k.tag))}return ir(d,R,G),gn(),!1}if(oa)return y=wl.current,y!==null?((y.flags&65536)===0&&(y.flags|=256),y.flags|=65536,y.lanes=G,R!==hs&&(d=Error(h(422),{cause:R}),wc(Ls(d,k)))):(R!==hs&&(y=Error(h(423),{cause:R}),wc(Ls(y,k))),d=d.current.alternate,d.flags|=65536,G&=-G,d.lanes|=G,R=Ls(R,k),G=Kf(d.stateNode,R,G),jf(d,G),Ye!==4&&(Ye=2)),!1;var Q=Error(h(520),{cause:R});if(Q=Ls(Q,k),Xe===null?Xe=[Q]:Xe.push(Q),Ye!==4&&(Ye=2),y===null)return!0;R=Ls(R,k),k=y;do{switch(k.tag){case 3:return k.flags|=65536,d=G&-G,k.lanes|=d,d=Kf(k.stateNode,R,d),jf(k,d),!1;case 1:if(y=k.type,Q=k.stateNode,(k.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(Wt===null||!Wt.has(Q))))return k.flags|=65536,G&=-G,k.lanes|=G,G=Td(G),Km(G,d,k,R),jf(k,G),!1}k=k.return}while(k!==null);return!1}var ah=Error(h(461)),Rr=!1;function xr(d,y,k,R){y.child=d===null?Zm(y,null,k,R):bl(y,d.child,k,R)}function Fu(d,y,k,R,G){k=k.render;var Q=y.ref;if("ref"in R){var we={};for(var $e in R)$e!=="ref"&&(we[$e]=R[$e])}else we=R;return Gd(y),R=_d(d,y,k,we,Q,G),$e=$l(),d!==null&&!Rr?(Rf(d,y,G),hu(d,y,G)):(oa&&$e&&ji(y),y.flags|=1,xr(d,y,R,G),y.child)}function Jm(d,y,k,R,G){if(d===null){var Q=k.type;return typeof Q=="function"&&!ld(Q)&&Q.defaultProps===void 0&&k.compare===null?(y.tag=15,y.type=Q,Jf(d,y,Q,R,G)):(d=xl(k.type,null,R,y,y.mode,G),d.ref=y.ref,d.return=y,y.child=d)}if(Q=d.child,!tr(d,G)){var we=Q.memoizedProps;if(k=k.compare,k=k!==null?k:oo,k(we,R)&&d.ref===y.ref)return hu(d,y,G)}return y.flags|=1,d=lo(Q,R),d.ref=y.ref,d.return=y,y.child=d}function Jf(d,y,k,R,G){if(d!==null){var Q=d.memoizedProps;if(oo(Q,R)&&d.ref===y.ref)if(Rr=!1,y.pendingProps=R=Q,tr(d,G))(d.flags&131072)!==0&&(Rr=!0);else return y.lanes=d.lanes,hu(d,y,G)}return ep(d,y,k,R,G)}function Qm(d,y,k){var R=y.pendingProps,G=R.children,Q=d!==null?d.memoizedState:null;if(R.mode==="hidden"){if((y.flags&128)!==0){if(R=Q!==null?Q.baseLanes|k:k,d!==null){for(G=y.child=d.child,Q=0;G!==null;)Q=Q|G.lanes|G.childLanes,G=G.sibling;y.childLanes=Q&~R}else y.childLanes=0,y.child=null;return Qf(d,y,R,k)}if((k&536870912)!==0)y.memoizedState={baseLanes:0,cachePool:null},d!==null&&fd(y,Q!==null?Q.cachePool:null),Q!==null?Dm(y,Q):Yd(),Sl(y);else return y.lanes=y.childLanes=536870912,Qf(d,y,Q!==null?Q.baseLanes|k:k,k)}else Q!==null?(fd(y,Q.cachePool),Dm(y,Q),ms(),y.memoizedState=null):(d!==null&&fd(y,null),Yd(),ms());return xr(d,y,G,k),y.child}function Qf(d,y,k,R){var G=hd();return G=G===null?null:{parent:fs._currentValue,pool:G},y.memoizedState={baseLanes:k,cachePool:G},d!==null&&fd(y,null),Yd(),Sl(y),d!==null&&dd(d,y,R,!0),null}function rh(d,y){var k=y.ref;if(k===null)d!==null&&d.ref!==null&&(y.flags|=4194816);else{if(typeof k!="function"&&typeof k!="object")throw Error(h(284));(d===null||d.ref!==k)&&(y.flags|=4194816)}}function ep(d,y,k,R,G){return Gd(y),k=_d(d,y,k,R,void 0,G),R=$l(),d!==null&&!Rr?(Rf(d,y,G),hu(d,y,G)):(oa&&R&&ji(y),y.flags|=1,xr(d,y,k,G),y.child)}function em(d,y,k,R,G,Q){return Gd(y),y.updateQueue=null,k=Fm(y,R,k,G),yd(d),R=$l(),d!==null&&!Rr?(Rf(d,y,Q),hu(d,y,Q)):(oa&&R&&ji(y),y.flags|=1,xr(d,y,k,Q),y.child)}function lg(d,y,k,R,G){if(Gd(y),y.stateNode===null){var Q=xc,we=k.contextType;typeof we=="object"&&we!==null&&(Q=Bo(we)),Q=new k(R,Q),y.memoizedState=Q.state!==null&&Q.state!==void 0?Q.state:null,Q.updater=uu,y.stateNode=Q,Q._reactInternals=y,Q=y.stateNode,Q.props=R,Q.state=y.memoizedState,Q.refs={},Lh(y),we=k.contextType,Q.context=typeof we=="object"&&we!==null?Bo(we):xc,Q.state=y.memoizedState,we=k.getDerivedStateFromProps,typeof we=="function"&&(Zf(y,k,we,R),Q.state=y.memoizedState),typeof k.getDerivedStateFromProps=="function"||typeof Q.getSnapshotBeforeUpdate=="function"||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(we=Q.state,typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount(),we!==Q.state&&uu.enqueueReplaceState(Q,Q.state,null),sc(y,R,Q,G),Zd(),Q.state=y.memoizedState),typeof Q.componentDidMount=="function"&&(y.flags|=4194308),R=!0}else if(d===null){Q=y.stateNode;var $e=y.memoizedProps,ct=du(k,$e);Q.props=ct;var Jt=Q.context,vi=k.contextType;we=xc,typeof vi=="object"&&vi!==null&&(we=Bo(vi));var Ai=k.getDerivedStateFromProps;vi=typeof Ai=="function"||typeof Q.getSnapshotBeforeUpdate=="function",$e=y.pendingProps!==$e,vi||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||($e||Jt!==we)&&Tl(y,Q,R,we),pd=!1;var ii=y.memoizedState;Q.state=ii,sc(y,R,Q,G),Zd(),Jt=y.memoizedState,$e||ii!==Jt||pd?(typeof Ai=="function"&&(Zf(y,k,Ai,R),Jt=y.memoizedState),(ct=pd||Xf(y,k,ct,R,ii,Jt,we))?(vi||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(y.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=R,y.memoizedState=Jt),Q.props=R,Q.state=Jt,Q.context=we,R=ct):(typeof Q.componentDidMount=="function"&&(y.flags|=4194308),R=!1)}else{Q=y.stateNode,Pf(d,y),we=y.memoizedProps,vi=du(k,we),Q.props=vi,Ai=y.pendingProps,ii=Q.context,Jt=k.contextType,ct=xc,typeof Jt=="object"&&Jt!==null&&(ct=Bo(Jt)),$e=k.getDerivedStateFromProps,(Jt=typeof $e=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(we!==Ai||ii!==ct)&&Tl(y,Q,R,ct),pd=!1,ii=y.memoizedState,Q.state=ii,sc(y,R,Q,G),Zd();var ri=y.memoizedState;we!==Ai||ii!==ri||pd||d!==null&&d.dependencies!==null&&Cm(d.dependencies)?(typeof $e=="function"&&(Zf(y,k,$e,R),ri=y.memoizedState),(vi=pd||Xf(y,k,vi,R,ii,ri,ct)||d!==null&&d.dependencies!==null&&Cm(d.dependencies))?(Jt||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(R,ri,ct),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(R,ri,ct)),typeof Q.componentDidUpdate=="function"&&(y.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof Q.componentDidUpdate!="function"||we===d.memoizedProps&&ii===d.memoizedState||(y.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||we===d.memoizedProps&&ii===d.memoizedState||(y.flags|=1024),y.memoizedProps=R,y.memoizedState=ri),Q.props=R,Q.state=ri,Q.context=ct,R=vi):(typeof Q.componentDidUpdate!="function"||we===d.memoizedProps&&ii===d.memoizedState||(y.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||we===d.memoizedProps&&ii===d.memoizedState||(y.flags|=1024),R=!1)}return Q=R,rh(d,y),R=(y.flags&128)!==0,Q||R?(Q=y.stateNode,k=R&&typeof k.getDerivedStateFromError!="function"?null:Q.render(),y.flags|=1,d!==null&&R?(y.child=bl(y,d.child,null,G),y.child=bl(y,null,k,G)):xr(d,y,k,G),y.memoizedState=Q.state,d=y.child):d=hu(d,y,G),d}function cg(d,y,k,R){return Bl(),y.flags|=256,xr(d,y,k,R),y.child}var tm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Wh(d){return{baseLanes:d,cachePool:Ih()}}function tp(d,y,k){return d=d!==null?d.childLanes&~k:0,y&&(d|=Ot),d}function ip(d,y,k){var R=y.pendingProps,G=!1,Q=(y.flags&128)!==0,we;if((we=Q)||(we=d!==null&&d.memoizedState===null?!1:(ps.current&2)!==0),we&&(G=!0,y.flags&=-129),we=(y.flags&32)!==0,y.flags&=-33,d===null){if(oa){if(G?Pc(y):ms(),oa){var $e=En,ct;if(ct=$e){e:{for(ct=$e,$e=Ar;ct.nodeType!==8;){if(!$e){$e=null;break e}if(ct=br(ct.nextSibling),ct===null){$e=null;break e}}$e=ct}$e!==null?(y.memoizedState={dehydrated:$e,treeContext:me!==null?{id:Le,overflow:ut}:null,retryLane:536870912,hydrationErrors:null},ct=es(18,null,null,0),ct.stateNode=$e,ct.return=y,y.child=ct,vn=y,En=null,ct=!0):ct=!1}ct||Qs(y)}if($e=y.memoizedState,$e!==null&&($e=$e.dehydrated,$e!==null))return um($e)?y.lanes=32:y.lanes=536870912,null;ol(y)}return $e=R.children,R=R.fallback,G?(ms(),G=y.mode,$e=nm({mode:"hidden",children:$e},G),R=Fl(R,G,k,null),$e.return=y,R.return=y,$e.sibling=R,y.child=$e,G=y.child,G.memoizedState=Wh(k),G.childLanes=tp(d,we,k),y.memoizedState=tm,R):(Pc(y),im(y,$e))}if(ct=d.memoizedState,ct!==null&&($e=ct.dehydrated,$e!==null)){if(Q)y.flags&256?(Pc(y),y.flags&=-257,y=Zh(d,y,k)):y.memoizedState!==null?(ms(),y.child=d.child,y.flags|=128,y=null):(ms(),G=R.fallback,$e=y.mode,R=nm({mode:"visible",children:R.children},$e),G=Fl(G,$e,k,null),G.flags|=2,R.return=y,G.return=y,R.sibling=G,y.child=R,bl(y,d.child,null,k),R=y.child,R.memoizedState=Wh(k),R.childLanes=tp(d,we,k),y.memoizedState=tm,y=G);else if(Pc(y),um($e)){if(we=$e.nextSibling&&$e.nextSibling.dataset,we)var Jt=we.dgst;we=Jt,R=Error(h(419)),R.stack="",R.digest=we,wc({value:R,source:null,stack:null}),y=Zh(d,y,k)}else if(Rr||dd(d,y,k,!1),we=(k&d.childLanes)!==0,Rr||we){if(we=xe,we!==null&&(R=k&-k,R=(R&42)!==0?1:jo(R),R=(R&(we.suspendedLanes|k))!==0?0:R,R!==0&&R!==ct.retryLane))throw ct.retryLane=R,iu(d,R),Wi(we,d,R),ah;$e.data==="$?"||gn(),y=Zh(d,y,k)}else $e.data==="$?"?(y.flags|=192,y.child=d.child,y=null):(d=ct.treeContext,En=br($e.nextSibling),vn=y,oa=!0,pr=null,Ar=!1,d!==null&&($[te++]=Le,$[te++]=ut,$[te++]=me,Le=d.id,ut=d.overflow,me=y),y=im(y,R.children),y.flags|=4096);return y}return G?(ms(),G=R.fallback,$e=y.mode,ct=d.child,Jt=ct.sibling,R=lo(ct,{mode:"hidden",children:R.children}),R.subtreeFlags=ct.subtreeFlags&65011712,Jt!==null?G=lo(Jt,G):(G=Fl(G,$e,k,null),G.flags|=2),G.return=y,R.return=y,R.sibling=G,y.child=R,R=G,G=y.child,$e=d.child.memoizedState,$e===null?$e=Wh(k):(ct=$e.cachePool,ct!==null?(Jt=fs._currentValue,ct=ct.parent!==Jt?{parent:Jt,pool:Jt}:ct):ct=Ih(),$e={baseLanes:$e.baseLanes|k,cachePool:ct}),G.memoizedState=$e,G.childLanes=tp(d,we,k),y.memoizedState=tm,R):(Pc(y),k=d.child,d=k.sibling,k=lo(k,{mode:"visible",children:R.children}),k.return=y,k.sibling=null,d!==null&&(we=y.deletions,we===null?(y.deletions=[d],y.flags|=16):we.push(d)),y.child=k,y.memoizedState=null,k)}function im(d,y){return y=nm({mode:"visible",children:y},d.mode),y.return=d,d.child=y}function nm(d,y){return d=es(22,d,null,y),d.lanes=0,d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},d}function Zh(d,y,k){return bl(y,d.child,null,k),d=im(y,y.pendingProps.children),d.flags|=2,y.memoizedState=null,d}function Xh(d,y,k){d.lanes|=y;var R=d.alternate;R!==null&&(R.lanes|=y),ud(d.return,y,k)}function np(d,y,k,R,G){var Q=d.memoizedState;Q===null?d.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:R,tail:k,tailMode:G}:(Q.isBackwards=y,Q.rendering=null,Q.renderingStartTime=0,Q.last=R,Q.tail=k,Q.tailMode=G)}function n_(d,y,k){var R=y.pendingProps,G=R.revealOrder,Q=R.tail;if(xr(d,y,R.children,k),R=ps.current,(R&2)!==0)R=R&1|2,y.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=y.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&Xh(d,k,y);else if(d.tag===19)Xh(d,k,y);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===y)break e;for(;d.sibling===null;){if(d.return===null||d.return===y)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}R&=1}switch(Ct(ps,R),G){case"forwards":for(k=y.child,G=null;k!==null;)d=k.alternate,d!==null&&qh(d)===null&&(G=k),k=k.sibling;k=G,k===null?(G=y.child,y.child=null):(G=k.sibling,k.sibling=null),np(y,!1,G,k,Q);break;case"backwards":for(k=null,G=y.child,y.child=null;G!==null;){if(d=G.alternate,d!==null&&qh(d)===null){y.child=G;break}d=G.sibling,G.sibling=k,k=G,G=d}np(y,!0,k,null,Q);break;case"together":np(y,!1,null,null,void 0);break;default:y.memoizedState=null}return y.child}function hu(d,y,k){if(d!==null&&(y.dependencies=d.dependencies),dt|=y.lanes,(k&y.childLanes)===0)if(d!==null){if(dd(d,y,k,!1),(k&y.childLanes)===0)return null}else return null;if(d!==null&&y.child!==d.child)throw Error(h(153));if(y.child!==null){for(d=y.child,k=lo(d,d.pendingProps),y.child=k,k.return=y;d.sibling!==null;)d=d.sibling,k=k.sibling=lo(d,d.pendingProps),k.return=y;k.sibling=null}return y.child}function tr(d,y){return(d.lanes&y)!==0?!0:(d=d.dependencies,!!(d!==null&&Cm(d)))}function ap(d,y,k){switch(y.tag){case 3:Un(y,y.stateNode.containerInfo),Sc(y,fs,d.memoizedState.cache),Bl();break;case 27:case 5:On(y);break;case 4:Un(y,y.stateNode.containerInfo);break;case 10:Sc(y,y.type,y.memoizedProps.value);break;case 13:var R=y.memoizedState;if(R!==null)return R.dehydrated!==null?(Pc(y),y.flags|=128,null):(k&y.child.childLanes)!==0?ip(d,y,k):(Pc(y),d=hu(d,y,k),d!==null?d.sibling:null);Pc(y);break;case 19:var G=(d.flags&128)!==0;if(R=(k&y.childLanes)!==0,R||(dd(d,y,k,!1),R=(k&y.childLanes)!==0),G){if(R)return n_(d,y,k);y.flags|=128}if(G=y.memoizedState,G!==null&&(G.rendering=null,G.tail=null,G.lastEffect=null),Ct(ps,ps.current),R)break;return null;case 22:case 23:return y.lanes=0,Qm(d,y,k);case 24:Sc(y,fs,d.memoizedState.cache)}return hu(d,y,k)}function a_(d,y,k){if(d!==null)if(d.memoizedProps!==y.pendingProps)Rr=!0;else{if(!tr(d,k)&&(y.flags&128)===0)return Rr=!1,ap(d,y,k);Rr=(d.flags&131072)!==0}else Rr=!1,oa&&(y.flags&1048576)!==0&&It(y,I,y.index);switch(y.lanes=0,y.tag){case 16:e:{d=y.pendingProps;var R=y.elementType,G=R._init;if(R=G(R._payload),y.type=R,typeof R=="function")ld(R)?(d=du(R,d),y.tag=1,y=lg(null,y,R,d,k)):(y.tag=0,y=ep(null,y,R,d,k));else{if(R!=null){if(G=R.$$typeof,G===Qe){y.tag=11,y=Fu(null,y,R,d,k);break e}else if(G===tt){y.tag=14,y=Jm(null,y,R,d,k);break e}}throw y=Vi(R)||R,Error(h(306,y,""))}}return y;case 0:return ep(d,y,y.type,y.pendingProps,k);case 1:return R=y.type,G=du(R,y.pendingProps),lg(d,y,R,G,k);case 3:e:{if(Un(y,y.stateNode.containerInfo),d===null)throw Error(h(387));R=y.pendingProps;var Q=y.memoizedState;G=Q.element,Pf(d,y),sc(y,R,null,k);var we=y.memoizedState;if(R=we.cache,Sc(y,fs,R),R!==Q.cache&&Tc(y,[fs],k,!0),Zd(),R=we.element,Q.isDehydrated)if(Q={element:R,isDehydrated:!1,cache:we.cache},y.updateQueue.baseState=Q,y.memoizedState=Q,y.flags&256){y=cg(d,y,R,k);break e}else if(R!==G){G=Ls(Error(h(424)),y),wc(G),y=cg(d,y,R,k);break e}else{switch(d=y.stateNode.containerInfo,d.nodeType){case 9:d=d.body;break;default:d=d.nodeName==="HTML"?d.ownerDocument.body:d}for(En=br(d.firstChild),vn=y,oa=!0,pr=null,Ar=!0,k=Zm(y,null,R,k),y.child=k;k;)k.flags=k.flags&-3|4096,k=k.sibling}else{if(Bl(),R===G){y=hu(d,y,k);break e}xr(d,y,R,k)}y=y.child}return y;case 26:return rh(d,y),d===null?(k=By(y.type,null,y.pendingProps,null))?y.memoizedState=k:oa||(k=y.type,d=y.pendingProps,R=m_(li.current).createElement(k),R[Qt]=y,R[Ei]=d,Vo(R,k,d),qe(R),y.stateNode=R):y.memoizedState=By(y.type,d.memoizedProps,y.pendingProps,d.memoizedState),null;case 27:return On(y),d===null&&oa&&(R=y.stateNode=vg(y.type,y.pendingProps,li.current),vn=y,Ar=!0,G=En,af(y.type)?(rf=G,En=br(R.firstChild)):En=G),xr(d,y,y.pendingProps.children,k),rh(d,y),d===null&&(y.flags|=4194304),y.child;case 5:return d===null&&oa&&((G=R=En)&&(R=Fb(R,y.type,y.pendingProps,Ar),R!==null?(y.stateNode=R,vn=y,En=br(R.firstChild),Ar=!1,G=!0):G=!1),G||Qs(y)),On(y),G=y.type,Q=y.pendingProps,we=d!==null?d.memoizedProps:null,R=Q.children,p_(G,Q)?R=null:we!==null&&p_(G,we)&&(y.flags|=32),y.memoizedState!==null&&(G=_d(d,y,Bm,null,null,k),ch._currentValue=G),rh(d,y),xr(d,y,R,k),y.child;case 6:return d===null&&oa&&((d=k=En)&&(k=Px(k,y.pendingProps,Ar),k!==null?(y.stateNode=k,vn=y,En=null,d=!0):d=!1),d||Qs(y)),null;case 13:return ip(d,y,k);case 4:return Un(y,y.stateNode.containerInfo),R=y.pendingProps,d===null?y.child=bl(y,null,R,k):xr(d,y,R,k),y.child;case 11:return Fu(d,y,y.type,y.pendingProps,k);case 7:return xr(d,y,y.pendingProps,k),y.child;case 8:return xr(d,y,y.pendingProps.children,k),y.child;case 12:return xr(d,y,y.pendingProps.children,k),y.child;case 10:return R=y.pendingProps,Sc(y,y.type,R.value),xr(d,y,R.children,k),y.child;case 9:return G=y.type._context,R=y.pendingProps.children,Gd(y),G=Bo(G),R=R(G),y.flags|=1,xr(d,y,R,k),y.child;case 14:return Jm(d,y,y.type,y.pendingProps,k);case 15:return Jf(d,y,y.type,y.pendingProps,k);case 19:return n_(d,y,k);case 31:return R=y.pendingProps,k=y.mode,R={mode:R.mode,children:R.children},d===null?(k=nm(R,k),k.ref=y.ref,y.child=k,k.return=y,y=k):(k=lo(d.child,R),k.ref=y.ref,y.child=k,k.return=y,y=k),y;case 22:return Qm(d,y,k);case 24:return Gd(y),R=Bo(fs),d===null?(G=hd(),G===null&&(G=xe,Q=zh(),G.pooledCache=Q,Q.refCount++,Q!==null&&(G.pooledCacheLanes|=k),G=Q),y.memoizedState={parent:R,cache:G},Lh(y),Sc(y,fs,G)):((d.lanes&k)!==0&&(Pf(d,y),sc(y,null,null,k),Zd()),G=d.memoizedState,Q=y.memoizedState,G.parent!==R?(G={parent:R,cache:R},y.memoizedState=G,y.lanes===0&&(y.memoizedState=y.updateQueue.baseState=G),Sc(y,fs,R)):(R=Q.cache,Sc(y,fs,R),R!==G.cache&&Tc(y,[fs],k,!0))),xr(d,y,y.pendingProps.children,k),y.child;case 29:throw y.pendingProps}throw Error(h(156,y.tag))}function Bu(d){d.flags|=4}function r_(d,y){if(y.type!=="stylesheet"||(y.state.loading&4)!==0)d.flags&=-16777217;else if(d.flags|=16777216,!$y(y)){if(y=wl.current,y!==null&&((je&4194048)===je?oc!==null:(je&62914560)!==je&&(je&536870912)===0||y!==oc))throw Dh=Cf,zm;d.flags|=8192}}function kd(d,y){y!==null&&(d.flags|=4),d.flags&16384&&(y=d.tag!==22?Gs():536870912,d.lanes|=y,st|=y)}function sh(d,y){if(!oa)switch(d.tailMode){case"hidden":y=d.tail;for(var k=null;y!==null;)y.alternate!==null&&(k=y),y=y.sibling;k===null?d.tail=null:k.sibling=null;break;case"collapsed":k=d.tail;for(var R=null;k!==null;)k.alternate!==null&&(R=k),k=k.sibling;R===null?y||d.tail===null?d.tail=null:d.tail.sibling=null:R.sibling=null}}function Zr(d){var y=d.alternate!==null&&d.alternate.child===d.child,k=0,R=0;if(y)for(var G=d.child;G!==null;)k|=G.lanes|G.childLanes,R|=G.subtreeFlags&65011712,R|=G.flags&65011712,G.return=d,G=G.sibling;else for(G=d.child;G!==null;)k|=G.lanes|G.childLanes,R|=G.subtreeFlags,R|=G.flags,G.return=d,G=G.sibling;return d.subtreeFlags|=R,d.childLanes=k,y}function rp(d,y,k){var R=y.pendingProps;switch(cn(y),y.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zr(y),null;case 1:return Zr(y),null;case 3:return k=y.stateNode,R=null,d!==null&&(R=d.memoizedState.cache),y.memoizedState.cache!==R&&(y.flags|=2048),rc(fs),qn(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(d===null||d.child===null)&&(cd(y)?Bu(y):d===null||d.memoizedState.isDehydrated&&(y.flags&256)===0||(y.flags|=1024,Hd())),Zr(y),null;case 26:return k=y.memoizedState,d===null?(Bu(y),k!==null?(Zr(y),r_(y,k)):(Zr(y),y.flags&=-16777217)):k?k!==d.memoizedState?(Bu(y),Zr(y),r_(y,k)):(Zr(y),y.flags&=-16777217):(d.memoizedProps!==R&&Bu(y),Zr(y),y.flags&=-16777217),null;case 27:Ja(y),k=li.current;var G=y.type;if(d!==null&&y.stateNode!=null)d.memoizedProps!==R&&Bu(y);else{if(!R){if(y.stateNode===null)throw Error(h(166));return Zr(y),null}d=oi.current,cd(y)?kf(y):(d=vg(G,R,k),y.stateNode=d,Bu(y))}return Zr(y),null;case 5:if(Ja(y),k=y.type,d!==null&&y.stateNode!=null)d.memoizedProps!==R&&Bu(y);else{if(!R){if(y.stateNode===null)throw Error(h(166));return Zr(y),null}if(d=oi.current,cd(y))kf(y);else{switch(G=m_(li.current),d){case 1:d=G.createElementNS("http://www.w3.org/2000/svg",k);break;case 2:d=G.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;default:switch(k){case"svg":d=G.createElementNS("http://www.w3.org/2000/svg",k);break;case"math":d=G.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;case"script":d=G.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof R.is=="string"?G.createElement("select",{is:R.is}):G.createElement("select"),R.multiple?d.multiple=!0:R.size&&(d.size=R.size);break;default:d=typeof R.is=="string"?G.createElement(k,{is:R.is}):G.createElement(k)}}d[Qt]=y,d[Ei]=R;e:for(G=y.child;G!==null;){if(G.tag===5||G.tag===6)d.appendChild(G.stateNode);else if(G.tag!==4&&G.tag!==27&&G.child!==null){G.child.return=G,G=G.child;continue}if(G===y)break e;for(;G.sibling===null;){if(G.return===null||G.return===y)break e;G=G.return}G.sibling.return=G.return,G=G.sibling}y.stateNode=d;e:switch(Vo(d,k,R),k){case"button":case"input":case"select":case"textarea":d=!!R.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Bu(y)}}return Zr(y),y.flags&=-16777217,null;case 6:if(d&&y.stateNode!=null)d.memoizedProps!==R&&Bu(y);else{if(typeof R!="string"&&y.stateNode===null)throw Error(h(166));if(d=li.current,cd(y)){if(d=y.stateNode,k=y.memoizedProps,R=null,G=vn,G!==null)switch(G.tag){case 27:case 5:R=G.memoizedProps}d[Qt]=y,d=!!(d.nodeValue===k||R!==null&&R.suppressHydrationWarning===!0||jy(d.nodeValue,k)),d||Qs(y)}else d=m_(d).createTextNode(R),d[Qt]=y,y.stateNode=d}return Zr(y),null;case 13:if(R=y.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(G=cd(y),R!==null&&R.dehydrated!==null){if(d===null){if(!G)throw Error(h(318));if(G=y.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(h(317));G[Qt]=y}else Bl(),(y.flags&128)===0&&(y.memoizedState=null),y.flags|=4;Zr(y),G=!1}else G=Hd(),d!==null&&d.memoizedState!==null&&(d.memoizedState.hydrationErrors=G),G=!0;if(!G)return y.flags&256?(ol(y),y):(ol(y),null)}if(ol(y),(y.flags&128)!==0)return y.lanes=k,y;if(k=R!==null,d=d!==null&&d.memoizedState!==null,k){R=y.child,G=null,R.alternate!==null&&R.alternate.memoizedState!==null&&R.alternate.memoizedState.cachePool!==null&&(G=R.alternate.memoizedState.cachePool.pool);var Q=null;R.memoizedState!==null&&R.memoizedState.cachePool!==null&&(Q=R.memoizedState.cachePool.pool),Q!==G&&(R.flags|=2048)}return k!==d&&k&&(y.child.flags|=8192),kd(y,y.updateQueue),Zr(y),null;case 4:return qn(),d===null&&Ey(y.stateNode.containerInfo),Zr(y),null;case 10:return rc(y.type),Zr(y),null;case 19:if(At(ps),G=y.memoizedState,G===null)return Zr(y),null;if(R=(y.flags&128)!==0,Q=G.rendering,Q===null)if(R)sh(G,!1);else{if(Ye!==0||d!==null&&(d.flags&128)!==0)for(d=y.child;d!==null;){if(Q=qh(d),Q!==null){for(y.flags|=128,sh(G,!1),d=Q.updateQueue,y.updateQueue=d,kd(y,d),y.subtreeFlags=0,d=k,k=y.child;k!==null;)bc(k,d),k=k.sibling;return Ct(ps,ps.current&1|2),y.child}d=d.sibling}G.tail!==null&&xn()>ti&&(y.flags|=128,R=!0,sh(G,!1),y.lanes=4194304)}else{if(!R)if(d=qh(Q),d!==null){if(y.flags|=128,R=!0,d=d.updateQueue,y.updateQueue=d,kd(y,d),sh(G,!0),G.tail===null&&G.tailMode==="hidden"&&!Q.alternate&&!oa)return Zr(y),null}else 2*xn()-G.renderingStartTime>ti&&k!==536870912&&(y.flags|=128,R=!0,sh(G,!1),y.lanes=4194304);G.isBackwards?(Q.sibling=y.child,y.child=Q):(d=G.last,d!==null?d.sibling=Q:y.child=Q,G.last=Q)}return G.tail!==null?(y=G.tail,G.rendering=y,G.tail=y.sibling,G.renderingStartTime=xn(),y.sibling=null,d=ps.current,Ct(ps,R?d&1|2:d&1),y):(Zr(y),null);case 22:case 23:return ol(y),Lm(),R=y.memoizedState!==null,d!==null?d.memoizedState!==null!==R&&(y.flags|=8192):R&&(y.flags|=8192),R?(k&536870912)!==0&&(y.flags&128)===0&&(Zr(y),y.subtreeFlags&6&&(y.flags|=8192)):Zr(y),k=y.updateQueue,k!==null&&kd(y,k.retryQueue),k=null,d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(k=d.memoizedState.cachePool.pool),R=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(R=y.memoizedState.cachePool.pool),R!==k&&(y.flags|=2048),d!==null&&At(Ru),null;case 24:return k=null,d!==null&&(k=d.memoizedState.cache),y.memoizedState.cache!==k&&(y.flags|=2048),rc(fs),Zr(y),null;case 25:return null;case 30:return null}throw Error(h(156,y.tag))}function Uu(d,y){switch(cn(y),y.tag){case 1:return d=y.flags,d&65536?(y.flags=d&-65537|128,y):null;case 3:return rc(fs),qn(),d=y.flags,(d&65536)!==0&&(d&128)===0?(y.flags=d&-65537|128,y):null;case 26:case 27:case 5:return Ja(y),null;case 13:if(ol(y),d=y.memoizedState,d!==null&&d.dehydrated!==null){if(y.alternate===null)throw Error(h(340));Bl()}return d=y.flags,d&65536?(y.flags=d&-65537|128,y):null;case 19:return At(ps),null;case 4:return qn(),null;case 10:return rc(y.type),null;case 22:case 23:return ol(y),Lm(),d!==null&&At(Ru),d=y.flags,d&65536?(y.flags=d&-65537|128,y):null;case 24:return rc(fs),null;case 25:return null;default:return null}}function am(d,y){switch(cn(y),y.tag){case 3:rc(fs),qn();break;case 26:case 27:case 5:Ja(y);break;case 4:qn();break;case 13:ol(y);break;case 19:At(ps);break;case 10:rc(y.type);break;case 22:case 23:ol(y),Lm(),d!==null&&At(Ru);break;case 24:rc(fs)}}function Cr(d,y){try{var k=y.updateQueue,R=k!==null?k.lastEffect:null;if(R!==null){var G=R.next;k=G;do{if((k.tag&d)===d){R=void 0;var Q=k.create,we=k.inst;R=Q(),we.destroy=R}k=k.next}while(k!==G)}}catch($e){Dn(y,y.return,$e)}}function Eo(d,y,k){try{var R=y.updateQueue,G=R!==null?R.lastEffect:null;if(G!==null){var Q=G.next;R=Q;do{if((R.tag&d)===d){var we=R.inst,$e=we.destroy;if($e!==void 0){we.destroy=void 0,G=y;var ct=k,Jt=$e;try{Jt()}catch(vi){Dn(G,ct,vi)}}}R=R.next}while(R!==Q)}}catch(vi){Dn(y,y.return,vi)}}function Yh(d){var y=d.updateQueue;if(y!==null){var k=d.stateNode;try{zf(y,k)}catch(R){Dn(d,d.return,R)}}}function rm(d,y,k){k.props=du(d.type,d.memoizedProps),k.state=d.memoizedState;try{k.componentWillUnmount()}catch(R){Dn(d,y,R)}}function $u(d,y){try{var k=d.ref;if(k!==null){switch(d.tag){case 26:case 27:case 5:var R=d.stateNode;break;case 30:R=d.stateNode;break;default:R=d.stateNode}typeof k=="function"?d.refCleanup=k(R):k.current=R}}catch(G){Dn(d,y,G)}}function fu(d,y){var k=d.ref,R=d.refCleanup;if(k!==null)if(typeof R=="function")try{R()}catch(G){Dn(d,y,G)}finally{d.refCleanup=null,d=d.alternate,d!=null&&(d.refCleanup=null)}else if(typeof k=="function")try{k(null)}catch(G){Dn(d,y,G)}else k.current=null}function Kh(d){var y=d.type,k=d.memoizedProps,R=d.stateNode;try{e:switch(y){case"button":case"input":case"select":case"textarea":k.autoFocus&&R.focus();break e;case"img":k.src?R.src=k.src:k.srcSet&&(R.srcset=k.srcSet)}}catch(G){Dn(d,d.return,G)}}function Jh(d,y,k){try{var R=d.stateNode;gg(R,d.type,k,y),R[Ei]=y}catch(G){Dn(d,d.return,G)}}function s_(d){return d.tag===5||d.tag===3||d.tag===26||d.tag===27&&af(d.type)||d.tag===4}function Qh(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||s_(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.tag===27&&af(d.type)||d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function sm(d,y,k){var R=d.tag;if(R===5||R===6)d=d.stateNode,y?(k.nodeType===9?k.body:k.nodeName==="HTML"?k.ownerDocument.body:k).insertBefore(d,y):(y=k.nodeType===9?k.body:k.nodeName==="HTML"?k.ownerDocument.body:k,y.appendChild(d),k=k._reactRootContainer,k!=null||y.onclick!==null||(y.onclick=dp));else if(R!==4&&(R===27&&af(d.type)&&(k=d.stateNode,y=null),d=d.child,d!==null))for(sm(d,y,k),d=d.sibling;d!==null;)sm(d,y,k),d=d.sibling}function Ed(d,y,k){var R=d.tag;if(R===5||R===6)d=d.stateNode,y?k.insertBefore(d,y):k.appendChild(d);else if(R!==4&&(R===27&&af(d.type)&&(k=d.stateNode),d=d.child,d!==null))for(Ed(d,y,k),d=d.sibling;d!==null;)Ed(d,y,k),d=d.sibling}function ef(d){var y=d.stateNode,k=d.memoizedProps;try{for(var R=d.type,G=y.attributes;G.length;)y.removeAttributeNode(G[0]);Vo(y,R,k),y[Qt]=d,y[Ei]=k}catch(Q){Dn(d,d.return,Q)}}var kl=!1,kr=!1,jc=!1,mu=typeof WeakSet=="function"?WeakSet:Set,Xr=null;function zc(d,y){if(d=d.containerInfo,zy=w_,d=Au(d),_l(d)){if("selectionStart"in d)var k={start:d.selectionStart,end:d.selectionEnd};else e:{k=(k=d.ownerDocument)&&k.defaultView||window;var R=k.getSelection&&k.getSelection();if(R&&R.rangeCount!==0){k=R.anchorNode;var G=R.anchorOffset,Q=R.focusNode;R=R.focusOffset;try{k.nodeType,Q.nodeType}catch{k=null;break e}var we=0,$e=-1,ct=-1,Jt=0,vi=0,Ai=d,ii=null;t:for(;;){for(var ri;Ai!==k||G!==0&&Ai.nodeType!==3||($e=we+G),Ai!==Q||R!==0&&Ai.nodeType!==3||(ct=we+R),Ai.nodeType===3&&(we+=Ai.nodeValue.length),(ri=Ai.firstChild)!==null;)ii=Ai,Ai=ri;for(;;){if(Ai===d)break t;if(ii===k&&++Jt===G&&($e=we),ii===Q&&++vi===R&&(ct=we),(ri=Ai.nextSibling)!==null)break;Ai=ii,ii=Ai.parentNode}Ai=ri}k=$e===-1||ct===-1?null:{start:$e,end:ct}}else k=null}k=k||{start:0,end:0}}else k=null;for(Iy={focusedElem:d,selectionRange:k},w_=!1,Xr=y;Xr!==null;)if(y=Xr,d=y.child,(y.subtreeFlags&1024)!==0&&d!==null)d.return=y,Xr=d;else for(;Xr!==null;){switch(y=Xr,Q=y.alternate,d=y.flags,y.tag){case 0:break;case 11:case 15:break;case 1:if((d&1024)!==0&&Q!==null){d=void 0,k=y,G=Q.memoizedProps,Q=Q.memoizedState,R=k.stateNode;try{var ga=du(k.type,G,k.elementType===k.type);d=R.getSnapshotBeforeUpdate(ga,Q),R.__reactInternalSnapshotBeforeUpdate=d}catch(Kn){Dn(k,k.return,Kn)}}break;case 3:if((d&1024)!==0){if(d=y.stateNode.containerInfo,k=d.nodeType,k===9)yg(d);else if(k===1)switch(d.nodeName){case"HEAD":case"HTML":case"BODY":yg(d);break;default:d.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((d&1024)!==0)throw Error(h(163))}if(d=y.sibling,d!==null){d.return=y.return,Xr=d;break}Xr=y.return}}function o_(d,y,k){var R=k.flags;switch(k.tag){case 0:case 11:case 15:Wl(d,k),R&4&&Cr(5,k);break;case 1:if(Wl(d,k),R&4)if(d=k.stateNode,y===null)try{d.componentDidMount()}catch(we){Dn(k,k.return,we)}else{var G=du(k.type,y.memoizedProps);y=y.memoizedState;try{d.componentDidUpdate(G,y,d.__reactInternalSnapshotBeforeUpdate)}catch(we){Dn(k,k.return,we)}}R&64&&Yh(k),R&512&&$u(k,k.return);break;case 3:if(Wl(d,k),R&64&&(d=k.updateQueue,d!==null)){if(y=null,k.child!==null)switch(k.child.tag){case 27:case 5:y=k.child.stateNode;break;case 1:y=k.child.stateNode}try{zf(d,y)}catch(we){Dn(k,k.return,we)}}break;case 27:y===null&&R&4&&ef(k);case 26:case 5:Wl(d,k),y===null&&R&4&&Kh(k),R&512&&$u(k,k.return);break;case 12:Wl(d,k);break;case 13:Wl(d,k),R&4&&Hl(d,k),R&64&&(d=k.memoizedState,d!==null&&(d=d.dehydrated,d!==null&&(k=Rc.bind(null,k),Bb(d,k))));break;case 22:if(R=k.memoizedState!==null||kl,!R){y=y!==null&&y.memoizedState!==null||kr,G=kl;var Q=kr;kl=R,(kr=y)&&!Q?t(d,k,(k.subtreeFlags&8772)!==0):Wl(d,k),kl=G,kr=Q}break;case 30:break;default:Wl(d,k)}}function l_(d){var y=d.alternate;y!==null&&(d.alternate=null,l_(y)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(y=d.stateNode,y!==null&&ie(y)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}var ts=null,El=!1;function Ic(d,y,k){for(k=k.child;k!==null;)eo(d,y,k),k=k.sibling}function eo(d,y,k){if(Qa&&typeof Qa.onCommitFiberUnmount=="function")try{Qa.onCommitFiberUnmount(Kr,k)}catch{}switch(k.tag){case 26:kr||fu(k,y),Ic(d,y,k),k.memoizedState?k.memoizedState.count--:k.stateNode&&(k=k.stateNode,k.parentNode.removeChild(k));break;case 27:kr||fu(k,y);var R=ts,G=El;af(k.type)&&(ts=k.stateNode,El=!1),Ic(d,y,k),sf(k.stateNode),ts=R,El=G;break;case 5:kr||fu(k,y);case 6:if(R=ts,G=El,ts=null,Ic(d,y,k),ts=R,El=G,ts!==null)if(El)try{(ts.nodeType===9?ts.body:ts.nodeName==="HTML"?ts.ownerDocument.body:ts).removeChild(k.stateNode)}catch(Q){Dn(k,y,Q)}else try{ts.removeChild(k.stateNode)}catch(Q){Dn(k,y,Q)}break;case 18:ts!==null&&(El?(d=ts,Mx(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,k.stateNode),hm(d)):Mx(ts,k.stateNode));break;case 4:R=ts,G=El,ts=k.stateNode.containerInfo,El=!0,Ic(d,y,k),ts=R,El=G;break;case 0:case 11:case 14:case 15:kr||Eo(2,k,y),kr||Eo(4,k,y),Ic(d,y,k);break;case 1:kr||(fu(k,y),R=k.stateNode,typeof R.componentWillUnmount=="function"&&rm(k,y,R)),Ic(d,y,k);break;case 21:Ic(d,y,k);break;case 22:kr=(R=kr)||k.memoizedState!==null,Ic(d,y,k),kr=R;break;default:Ic(d,y,k)}}function Hl(d,y){if(y.memoizedState===null&&(d=y.alternate,d!==null&&(d=d.memoizedState,d!==null&&(d=d.dehydrated,d!==null))))try{hm(d)}catch(k){Dn(y,y.return,k)}}function sp(d){switch(d.tag){case 13:case 19:var y=d.stateNode;return y===null&&(y=d.stateNode=new mu),y;case 22:return d=d.stateNode,y=d._retryCache,y===null&&(y=d._retryCache=new mu),y;default:throw Error(h(435,d.tag))}}function ug(d,y){var k=sp(d);y.forEach(function(R){var G=om.bind(null,d,R);k.has(R)||(k.add(R),R.then(G,G))})}function uo(d,y){var k=y.deletions;if(k!==null)for(var R=0;R<k.length;R++){var G=k[R],Q=d,we=y,$e=we;e:for(;$e!==null;){switch($e.tag){case 27:if(af($e.type)){ts=$e.stateNode,El=!1;break e}break;case 5:ts=$e.stateNode,El=!1;break e;case 3:case 4:ts=$e.stateNode.containerInfo,El=!0;break e}$e=$e.return}if(ts===null)throw Error(h(160));eo(Q,we,G),ts=null,El=!1,Q=G.alternate,Q!==null&&(Q.return=null),G.return=null}if(y.subtreeFlags&13878)for(y=y.child;y!==null;)ql(y,d),y=y.sibling}var Gl=null;function ql(d,y){var k=d.alternate,R=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:uo(y,d),is(d),R&4&&(Eo(3,d,d.return),Cr(3,d),Eo(5,d,d.return));break;case 1:uo(y,d),is(d),R&512&&(kr||k===null||fu(k,k.return)),R&64&&kl&&(d=d.updateQueue,d!==null&&(R=d.callbacks,R!==null&&(k=d.shared.hiddenCallbacks,d.shared.hiddenCallbacks=k===null?R:k.concat(R))));break;case 26:var G=Gl;if(uo(y,d),is(d),R&512&&(kr||k===null||fu(k,k.return)),R&4){var Q=k!==null?k.memoizedState:null;if(R=d.memoizedState,k===null)if(R===null)if(d.stateNode===null){e:{R=d.type,k=d.memoizedProps,G=G.ownerDocument||G;t:switch(R){case"title":Q=G.getElementsByTagName("title")[0],(!Q||Q[Ze]||Q[Qt]||Q.namespaceURI==="http://www.w3.org/2000/svg"||Q.hasAttribute("itemprop"))&&(Q=G.createElement(R),G.head.insertBefore(Q,G.querySelector("head > title"))),Vo(Q,R,k),Q[Qt]=d,qe(Q),R=Q;break e;case"link":var we=Uy("link","href",G).get(R+(k.href||""));if(we){for(var $e=0;$e<we.length;$e++)if(Q=we[$e],Q.getAttribute("href")===(k.href==null||k.href===""?null:k.href)&&Q.getAttribute("rel")===(k.rel==null?null:k.rel)&&Q.getAttribute("title")===(k.title==null?null:k.title)&&Q.getAttribute("crossorigin")===(k.crossOrigin==null?null:k.crossOrigin)){we.splice($e,1);break t}}Q=G.createElement(R),Vo(Q,R,k),G.head.appendChild(Q);break;case"meta":if(we=Uy("meta","content",G).get(R+(k.content||""))){for($e=0;$e<we.length;$e++)if(Q=we[$e],Q.getAttribute("content")===(k.content==null?null:""+k.content)&&Q.getAttribute("name")===(k.name==null?null:k.name)&&Q.getAttribute("property")===(k.property==null?null:k.property)&&Q.getAttribute("http-equiv")===(k.httpEquiv==null?null:k.httpEquiv)&&Q.getAttribute("charset")===(k.charSet==null?null:k.charSet)){we.splice($e,1);break t}}Q=G.createElement(R),Vo(Q,R,k),G.head.appendChild(Q);break;default:throw Error(h(468,R))}Q[Qt]=d,qe(Q),R=Q}d.stateNode=R}else Sg(G,d.type,d.stateNode);else d.stateNode=g_(G,R,d.memoizedProps);else Q!==R?(Q===null?k.stateNode!==null&&(k=k.stateNode,k.parentNode.removeChild(k)):Q.count--,R===null?Sg(G,d.type,d.stateNode):g_(G,R,d.memoizedProps)):R===null&&d.stateNode!==null&&Jh(d,d.memoizedProps,k.memoizedProps)}break;case 27:uo(y,d),is(d),R&512&&(kr||k===null||fu(k,k.return)),k!==null&&R&4&&Jh(d,d.memoizedProps,k.memoizedProps);break;case 5:if(uo(y,d),is(d),R&512&&(kr||k===null||fu(k,k.return)),d.flags&32){G=d.stateNode;try{_o(G,"")}catch(ri){Dn(d,d.return,ri)}}R&4&&d.stateNode!=null&&(G=d.memoizedProps,Jh(d,G,k!==null?k.memoizedProps:G)),R&1024&&(jc=!0);break;case 6:if(uo(y,d),is(d),R&4){if(d.stateNode===null)throw Error(h(162));R=d.memoizedProps,k=d.stateNode;try{k.nodeValue=R}catch(ri){Dn(d,d.return,ri)}}break;case 3:if(wg=null,G=Gl,Gl=xg(y.containerInfo),uo(y,d),Gl=G,is(d),R&4&&k!==null&&k.memoizedState.isDehydrated)try{hm(y.containerInfo)}catch(ri){Dn(d,d.return,ri)}jc&&(jc=!1,Ad(d));break;case 4:R=Gl,Gl=xg(d.stateNode.containerInfo),uo(y,d),is(d),Gl=R;break;case 12:uo(y,d),is(d);break;case 13:uo(y,d),is(d),d.child.flags&8192&&d.memoizedState!==null!=(k!==null&&k.memoizedState!==null)&&(Nt=xn()),R&4&&(R=d.updateQueue,R!==null&&(d.updateQueue=null,ug(d,R)));break;case 22:G=d.memoizedState!==null;var ct=k!==null&&k.memoizedState!==null,Jt=kl,vi=kr;if(kl=Jt||G,kr=vi||ct,uo(y,d),kr=vi,kl=Jt,is(d),R&8192)e:for(y=d.stateNode,y._visibility=G?y._visibility&-2:y._visibility|1,G&&(k===null||ct||kl||kr||f(d)),k=null,y=d;;){if(y.tag===5||y.tag===26){if(k===null){ct=k=y;try{if(Q=ct.stateNode,G)we=Q.style,typeof we.setProperty=="function"?we.setProperty("display","none","important"):we.display="none";else{$e=ct.stateNode;var Ai=ct.memoizedProps.style,ii=Ai!=null&&Ai.hasOwnProperty("display")?Ai.display:null;$e.style.display=ii==null||typeof ii=="boolean"?"":(""+ii).trim()}}catch(ri){Dn(ct,ct.return,ri)}}}else if(y.tag===6){if(k===null){ct=y;try{ct.stateNode.nodeValue=G?"":ct.memoizedProps}catch(ri){Dn(ct,ct.return,ri)}}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===d)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===d)break e;for(;y.sibling===null;){if(y.return===null||y.return===d)break e;k===y&&(k=null),y=y.return}k===y&&(k=null),y.sibling.return=y.return,y=y.sibling}R&4&&(R=d.updateQueue,R!==null&&(k=R.retryQueue,k!==null&&(R.retryQueue=null,ug(d,k))));break;case 19:uo(y,d),is(d),R&4&&(R=d.updateQueue,R!==null&&(d.updateQueue=null,ug(d,R)));break;case 30:break;case 21:break;default:uo(y,d),is(d)}}function is(d){var y=d.flags;if(y&2){try{for(var k,R=d.return;R!==null;){if(s_(R)){k=R;break}R=R.return}if(k==null)throw Error(h(160));switch(k.tag){case 27:var G=k.stateNode,Q=Qh(d);Ed(d,Q,G);break;case 5:var we=k.stateNode;k.flags&32&&(_o(we,""),k.flags&=-33);var $e=Qh(d);Ed(d,$e,we);break;case 3:case 4:var ct=k.stateNode.containerInfo,Jt=Qh(d);sm(d,Jt,ct);break;default:throw Error(h(161))}}catch(vi){Dn(d,d.return,vi)}d.flags&=-3}y&4096&&(d.flags&=-4097)}function Ad(d){if(d.subtreeFlags&1024)for(d=d.child;d!==null;){var y=d;Ad(y),y.tag===5&&y.flags&1024&&y.stateNode.reset(),d=d.sibling}}function Wl(d,y){if(y.subtreeFlags&8772)for(y=y.child;y!==null;)o_(d,y.alternate,y),y=y.sibling}function f(d){for(d=d.child;d!==null;){var y=d;switch(y.tag){case 0:case 11:case 14:case 15:Eo(4,y,y.return),f(y);break;case 1:fu(y,y.return);var k=y.stateNode;typeof k.componentWillUnmount=="function"&&rm(y,y.return,k),f(y);break;case 27:sf(y.stateNode);case 26:case 5:fu(y,y.return),f(y);break;case 22:y.memoizedState===null&&f(y);break;case 30:f(y);break;default:f(y)}d=d.sibling}}function t(d,y,k){for(k=k&&(y.subtreeFlags&8772)!==0,y=y.child;y!==null;){var R=y.alternate,G=d,Q=y,we=Q.flags;switch(Q.tag){case 0:case 11:case 15:t(G,Q,k),Cr(4,Q);break;case 1:if(t(G,Q,k),R=Q,G=R.stateNode,typeof G.componentDidMount=="function")try{G.componentDidMount()}catch(Jt){Dn(R,R.return,Jt)}if(R=Q,G=R.updateQueue,G!==null){var $e=R.stateNode;try{var ct=G.shared.hiddenCallbacks;if(ct!==null)for(G.shared.hiddenCallbacks=null,G=0;G<ct.length;G++)gd(ct[G],$e)}catch(Jt){Dn(R,R.return,Jt)}}k&&we&64&&Yh(Q),$u(Q,Q.return);break;case 27:ef(Q);case 26:case 5:t(G,Q,k),k&&R===null&&we&4&&Kh(Q),$u(Q,Q.return);break;case 12:t(G,Q,k);break;case 13:t(G,Q,k),k&&we&4&&Hl(G,Q);break;case 22:Q.memoizedState===null&&t(G,Q,k),$u(Q,Q.return);break;case 30:break;default:t(G,Q,k)}y=y.sibling}}function s(d,y){var k=null;d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(k=d.memoizedState.cachePool.pool),d=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(d=y.memoizedState.cachePool.pool),d!==k&&(d!=null&&d.refCount++,k!=null&&au(k))}function m(d,y){d=null,y.alternate!==null&&(d=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==d&&(y.refCount++,d!=null&&au(d))}function v(d,y,k,R){if(y.subtreeFlags&10256)for(y=y.child;y!==null;)T(d,y,k,R),y=y.sibling}function T(d,y,k,R){var G=y.flags;switch(y.tag){case 0:case 11:case 15:v(d,y,k,R),G&2048&&Cr(9,y);break;case 1:v(d,y,k,R);break;case 3:v(d,y,k,R),G&2048&&(d=null,y.alternate!==null&&(d=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==d&&(y.refCount++,d!=null&&au(d)));break;case 12:if(G&2048){v(d,y,k,R),d=y.stateNode;try{var Q=y.memoizedProps,we=Q.id,$e=Q.onPostCommit;typeof $e=="function"&&$e(we,y.alternate===null?"mount":"update",d.passiveEffectDuration,-0)}catch(ct){Dn(y,y.return,ct)}}else v(d,y,k,R);break;case 13:v(d,y,k,R);break;case 23:break;case 22:Q=y.stateNode,we=y.alternate,y.memoizedState!==null?Q._visibility&2?v(d,y,k,R):j(d,y):Q._visibility&2?v(d,y,k,R):(Q._visibility|=2,E(d,y,k,R,(y.subtreeFlags&10256)!==0)),G&2048&&s(we,y);break;case 24:v(d,y,k,R),G&2048&&m(y.alternate,y);break;default:v(d,y,k,R)}}function E(d,y,k,R,G){for(G=G&&(y.subtreeFlags&10256)!==0,y=y.child;y!==null;){var Q=d,we=y,$e=k,ct=R,Jt=we.flags;switch(we.tag){case 0:case 11:case 15:E(Q,we,$e,ct,G),Cr(8,we);break;case 23:break;case 22:var vi=we.stateNode;we.memoizedState!==null?vi._visibility&2?E(Q,we,$e,ct,G):j(Q,we):(vi._visibility|=2,E(Q,we,$e,ct,G)),G&&Jt&2048&&s(we.alternate,we);break;case 24:E(Q,we,$e,ct,G),G&&Jt&2048&&m(we.alternate,we);break;default:E(Q,we,$e,ct,G)}y=y.sibling}}function j(d,y){if(y.subtreeFlags&10256)for(y=y.child;y!==null;){var k=d,R=y,G=R.flags;switch(R.tag){case 22:j(k,R),G&2048&&s(R.alternate,R);break;case 24:j(k,R),G&2048&&m(R.alternate,R);break;default:j(k,R)}y=y.sibling}}var D=8192;function B(d){if(d.subtreeFlags&D)for(d=d.child;d!==null;)V(d),d=d.sibling}function V(d){switch(d.tag){case 26:B(d),d.flags&D&&d.memoizedState!==null&&Hb(Gl,d.memoizedState,d.memoizedProps);break;case 5:B(d);break;case 3:case 4:var y=Gl;Gl=xg(d.stateNode.containerInfo),B(d),Gl=y;break;case 22:d.memoizedState===null&&(y=d.alternate,y!==null&&y.memoizedState!==null?(y=D,D=16777216,B(d),D=y):B(d));break;default:B(d)}}function Y(d){var y=d.alternate;if(y!==null&&(d=y.child,d!==null)){y.child=null;do y=d.sibling,d.sibling=null,d=y;while(d!==null)}}function X(d){var y=d.deletions;if((d.flags&16)!==0){if(y!==null)for(var k=0;k<y.length;k++){var R=y[k];Xr=R,ne(R,d)}Y(d)}if(d.subtreeFlags&10256)for(d=d.child;d!==null;)J(d),d=d.sibling}function J(d){switch(d.tag){case 0:case 11:case 15:X(d),d.flags&2048&&Eo(9,d,d.return);break;case 3:X(d);break;case 12:X(d);break;case 22:var y=d.stateNode;d.memoizedState!==null&&y._visibility&2&&(d.return===null||d.return.tag!==13)?(y._visibility&=-3,se(d)):X(d);break;default:X(d)}}function se(d){var y=d.deletions;if((d.flags&16)!==0){if(y!==null)for(var k=0;k<y.length;k++){var R=y[k];Xr=R,ne(R,d)}Y(d)}for(d=d.child;d!==null;){switch(y=d,y.tag){case 0:case 11:case 15:Eo(8,y,y.return),se(y);break;case 22:k=y.stateNode,k._visibility&2&&(k._visibility&=-3,se(y));break;default:se(y)}d=d.sibling}}function ne(d,y){for(;Xr!==null;){var k=Xr;switch(k.tag){case 0:case 11:case 15:Eo(8,k,y);break;case 23:case 22:if(k.memoizedState!==null&&k.memoizedState.cachePool!==null){var R=k.memoizedState.cachePool.pool;R!=null&&R.refCount++}break;case 24:au(k.memoizedState.cache)}if(R=k.child,R!==null)R.return=k,Xr=R;else e:for(k=d;Xr!==null;){R=Xr;var G=R.sibling,Q=R.return;if(l_(R),R===k){Xr=null;break e}if(G!==null){G.return=Q,Xr=G;break e}Xr=Q}}}var he={getCacheForType:function(d){var y=Bo(fs),k=y.data.get(d);return k===void 0&&(k=d(),y.data.set(d,k)),k}},de=typeof WeakMap=="function"?WeakMap:Map,pe=0,xe=null,ge=null,je=0,Ae=0,De=null,ze=!1,Me=!1,Ve=!1,it=0,Ye=0,dt=0,mt=0,Tt=0,Ot=0,st=0,Xe=null,pt=null,ht=!1,Nt=0,ti=1/0,gi=null,Wt=null,Dt=0,Ti=null,bi=null,di=0,_i=0,Bi=null,dn=null,Pn=0,Jn=null;function wi(){if((pe&2)!==0&&je!==0)return je&-je;if(We.T!==null){var d=co;return d!==0?d:cp()}return wu()}function Qn(){Ot===0&&(Ot=(je&536870912)===0||oa?Ko():536870912);var d=wl.current;return d!==null&&(d.flags|=32),Ot}function Wi(d,y,k){(d===xe&&(Ae===2||Ae===9)||d.cancelPendingCommit!==null)&&(Va(d,0),Rn(d,je,Ot,!1)),po(d,k),((pe&2)===0||d!==xe)&&(d===xe&&((pe&2)===0&&(mt|=k),Ye===4&&Rn(d,je,Ot,!1)),ho(d))}function la(d,y,k){if((pe&6)!==0)throw Error(h(327));var R=!k&&(y&124)===0&&(y&d.expiredLanes)===0||Ss(d,y),G=R?lr(d,y):Oa(d,y,!0),Q=R;do{if(G===0){Me&&!R&&Rn(d,y,0,!1);break}else{if(k=d.current.alternate,Q&&!ya(k)){G=Oa(d,y,!1),Q=!1;continue}if(G===2){if(Q=y,d.errorRecoveryDisabledLanes&Q)var we=0;else we=d.pendingLanes&-536870913,we=we!==0?we:we&536870912?536870912:0;if(we!==0){y=we;e:{var $e=d;G=Xe;var ct=$e.current.memoizedState.isDehydrated;if(ct&&(Va($e,we).flags|=256),we=Oa($e,we,!1),we!==2){if(Ve&&!ct){$e.errorRecoveryDisabledLanes|=Q,mt|=Q,G=4;break e}Q=pt,pt=G,Q!==null&&(pt===null?pt=Q:pt.push.apply(pt,Q))}G=we}if(Q=!1,G!==2)continue}}if(G===1){Va(d,0),Rn(d,y,0,!0);break}e:{switch(R=d,Q=G,Q){case 0:case 1:throw Error(h(345));case 4:if((y&4194048)!==y)break;case 6:Rn(R,y,Ot,!ze);break e;case 2:pt=null;break;case 3:case 5:break;default:throw Error(h(329))}if((y&62914560)===y&&(G=Nt+300-xn(),10<G)){if(Rn(R,y,Ot,!ze),Ql(R,0,!0)!==0)break e;R.timeoutHandle=Ax(_a.bind(null,R,k,pt,gi,ht,y,Ot,mt,st,ze,Q,2,-0,0),G);break e}_a(R,k,pt,gi,ht,y,Ot,mt,st,ze,Q,0,-0,0)}}break}while(!0);ho(d)}function _a(d,y,k,R,G,Q,we,$e,ct,Jt,vi,Ai,ii,ri){if(d.timeoutHandle=-1,Ai=y.subtreeFlags,(Ai&8192||(Ai&16785408)===16785408)&&(Tg={stylesheets:null,count:0,unsuspend:Vb},V(y),Ai=Gb(),Ai!==null)){d.cancelPendingCommit=Ai(Es.bind(null,d,y,Q,k,R,G,we,$e,ct,vi,1,ii,ri)),Rn(d,Q,we,!Jt);return}Es(d,y,Q,k,R,G,we,$e,ct)}function ya(d){for(var y=d;;){var k=y.tag;if((k===0||k===11||k===15)&&y.flags&16384&&(k=y.updateQueue,k!==null&&(k=k.stores,k!==null)))for(var R=0;R<k.length;R++){var G=k[R],Q=G.getSnapshot;G=G.value;try{if(!Sr(Q(),G))return!1}catch{return!1}}if(k=y.child,y.subtreeFlags&16384&&k!==null)k.return=y,y=k;else{if(y===d)break;for(;y.sibling===null;){if(y.return===null||y.return===d)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function Rn(d,y,k,R){y&=~Tt,y&=~mt,d.suspendedLanes|=y,d.pingedLanes&=~y,R&&(d.warmLanes|=y),R=d.expirationTimes;for(var G=y;0<G;){var Q=31-mr(G),we=1<<Q;R[Q]=-1,G&=~we}k!==0&&Fr(d,k,y)}function mn(){return(pe&6)===0?(op(0),!1):!0}function ta(){if(ge!==null){if(Ae===0)var d=ge.return;else d=ge,il=tl=null,Um(d),Hh=null,La=0,d=ge;for(;d!==null;)am(d.alternate,d),d=d.return;ge=null}}function Va(d,y){var k=d.timeoutHandle;k!==-1&&(d.timeoutHandle=-1,Lb(k)),k=d.cancelPendingCommit,k!==null&&(d.cancelPendingCommit=null,k()),ta(),xe=d,ge=k=lo(d.current,null),je=y,Ae=0,De=null,ze=!1,Me=Ss(d,y),Ve=!1,st=Ot=Tt=mt=dt=Ye=0,pt=Xe=null,ht=!1,(y&8)!==0&&(y|=y&32);var R=d.entangledLanes;if(R!==0)for(d=d.entanglements,R&=y;0<R;){var G=31-mr(R),Q=1<<G;y|=d[G],R&=~Q}return it=y,Js(),k}function Za(d,y){Ca=null,We.H=Vl,y===md||y===Rh?(y=Xp(),Ae=3):y===zm?(y=Xp(),Ae=4):Ae=y===ah?8:y!==null&&typeof y=="object"&&typeof y.then=="function"?6:1,De=y,ge===null&&(Ye=1,Nu(d,Ls(y,d.current)))}function ca(){var d=We.H;return We.H=Vl,d===null?Vl:d}function Wn(){var d=We.A;return We.A=he,d}function gn(){Ye=4,ze||(je&4194048)!==je&&wl.current!==null||(Me=!0),(dt&134217727)===0&&(mt&134217727)===0||xe===null||Rn(xe,je,Ot,!1)}function Oa(d,y,k){var R=pe;pe|=2;var G=ca(),Q=Wn();(xe!==d||je!==y)&&(gi=null,Va(d,y)),y=!1;var we=Ye;e:do try{if(Ae!==0&&ge!==null){var $e=ge,ct=De;switch(Ae){case 8:ta(),we=6;break e;case 3:case 2:case 9:case 6:wl.current===null&&(y=!0);var Jt=Ae;if(Ae=0,De=null,Er(d,$e,ct,Jt),k&&Me){we=0;break e}break;default:Jt=Ae,Ae=0,De=null,Er(d,$e,ct,Jt)}}Tr(),we=Ye;break}catch(vi){Za(d,vi)}while(!0);return y&&d.shellSuspendCounter++,il=tl=null,pe=R,We.H=G,We.A=Q,ge===null&&(xe=null,je=0,Js()),we}function Tr(){for(;ge!==null;)Ao(ge)}function lr(d,y){var k=pe;pe|=2;var R=ca(),G=Wn();xe!==d||je!==y?(gi=null,ti=xn()+500,Va(d,y)):Me=Ss(d,y);e:do try{if(Ae!==0&&ge!==null){y=ge;var Q=De;t:switch(Ae){case 1:Ae=0,De=null,Er(d,y,Q,1);break;case 2:case 9:if(qd(Q)){Ae=0,De=null,Ns(y);break}y=function(){Ae!==2&&Ae!==9||xe!==d||(Ae=7),ho(d)},Q.then(y,y);break e;case 3:Ae=7;break e;case 4:Ae=5;break e;case 7:qd(Q)?(Ae=0,De=null,Ns(y)):(Ae=0,De=null,Er(d,y,Q,7));break;case 5:var we=null;switch(ge.tag){case 26:we=ge.memoizedState;case 5:case 27:var $e=ge;if(!we||$y(we)){Ae=0,De=null;var ct=$e.sibling;if(ct!==null)ge=ct;else{var Jt=$e.return;Jt!==null?(ge=Jt,ks(Jt)):ge=null}break t}}Ae=0,De=null,Er(d,y,Q,5);break;case 6:Ae=0,De=null,Er(d,y,Q,6);break;case 8:ta(),Ye=6;break e;default:throw Error(h(462))}}Ma();break}catch(vi){Za(d,vi)}while(!0);return il=tl=null,We.H=R,We.A=G,pe=k,ge!==null?0:(xe=null,je=0,Js(),Ye)}function Ma(){for(;ge!==null&&!hn();)Ao(ge)}function Ao(d){var y=a_(d.alternate,d,it);d.memoizedProps=d.pendingProps,y===null?ks(d):ge=y}function Ns(d){var y=d,k=y.alternate;switch(y.tag){case 15:case 0:y=em(k,y,y.pendingProps,y.type,void 0,je);break;case 11:y=em(k,y,y.pendingProps,y.type.render,y.ref,je);break;case 5:Um(y);default:am(k,y),y=ge=bc(y,it),y=a_(k,y,it)}d.memoizedProps=d.pendingProps,y===null?ks(d):ge=y}function Er(d,y,k,R){il=tl=null,Um(y),Hh=null,La=0;var G=y.return;try{if(og(d,G,y,k,je)){Ye=1,Nu(d,Ls(k,d.current)),ge=null;return}}catch(Q){if(G!==null)throw ge=G,Q;Ye=1,Nu(d,Ls(k,d.current)),ge=null;return}y.flags&32768?(oa||R===1?d=!0:Me||(je&536870912)!==0?d=!1:(ze=d=!0,(R===2||R===9||R===3||R===6)&&(R=wl.current,R!==null&&R.tag===13&&(R.flags|=16384))),to(y,d)):ks(y)}function ks(d){var y=d;do{if((y.flags&32768)!==0){to(y,ze);return}d=y.return;var k=rp(y.alternate,y,it);if(k!==null){ge=k;return}if(y=y.sibling,y!==null){ge=y;return}ge=y=d}while(y!==null);Ye===0&&(Ye=5)}function to(d,y){do{var k=Uu(d.alternate,d);if(k!==null){k.flags&=32767,ge=k;return}if(k=d.return,k!==null&&(k.flags|=32768,k.subtreeFlags=0,k.deletions=null),!y&&(d=d.sibling,d!==null)){ge=d;return}ge=d=k}while(d!==null);Ye=6,ge=null}function Es(d,y,k,R,G,Q,we,$e,ct){d.cancelPendingCommit=null;do gr();while(Dt!==0);if((pe&6)!==0)throw Error(h(327));if(y!==null){if(y===d.current)throw Error(h(177));if(Q=y.lanes|y.childLanes,Q|=Fo,qa(d,k,Q,we,$e,ct),d===xe&&(ge=xe=null,je=0),bi=y,Ti=d,di=k,_i=Q,Bi=G,dn=R,(y.subtreeFlags&10256)!==0||(y.flags&10256)!==0?(d.callbackNode=null,d.callbackPriority=0,nf($s,function(){return Ea(),null})):(d.callbackNode=null,d.callbackPriority=0),R=(y.flags&13878)!==0,(y.subtreeFlags&13878)!==0||R){R=We.T,We.T=null,G=Et.p,Et.p=2,we=pe,pe|=4;try{zc(d,y,k)}finally{pe=we,Et.p=G,We.T=R}}Dt=1,Al(),Zl(),$o()}}function Al(){if(Dt===1){Dt=0;var d=Ti,y=bi,k=(y.flags&13878)!==0;if((y.subtreeFlags&13878)!==0||k){k=We.T,We.T=null;var R=Et.p;Et.p=2;var G=pe;pe|=4;try{ql(y,d);var Q=Iy,we=Au(d.containerInfo),$e=Q.focusedElem,ct=Q.selectionRange;if(we!==$e&&$e&&$e.ownerDocument&&No($e.ownerDocument.documentElement,$e)){if(ct!==null&&_l($e)){var Jt=ct.start,vi=ct.end;if(vi===void 0&&(vi=Jt),"selectionStart"in $e)$e.selectionStart=Jt,$e.selectionEnd=Math.min(vi,$e.value.length);else{var Ai=$e.ownerDocument||document,ii=Ai&&Ai.defaultView||window;if(ii.getSelection){var ri=ii.getSelection(),ga=$e.textContent.length,Kn=Math.min(ct.start,ga),Dr=ct.end===void 0?Kn:Math.min(ct.end,ga);!ri.extend&&Kn>Dr&&(we=Dr,Dr=Kn,Kn=we);var Lt=nd($e,Kn),kt=nd($e,Dr);if(Lt&&kt&&(ri.rangeCount!==1||ri.anchorNode!==Lt.node||ri.anchorOffset!==Lt.offset||ri.focusNode!==kt.node||ri.focusOffset!==kt.offset)){var Zt=Ai.createRange();Zt.setStart(Lt.node,Lt.offset),ri.removeAllRanges(),Kn>Dr?(ri.addRange(Zt),ri.extend(kt.node,kt.offset)):(Zt.setEnd(kt.node,kt.offset),ri.addRange(Zt))}}}}for(Ai=[],ri=$e;ri=ri.parentNode;)ri.nodeType===1&&Ai.push({element:ri,left:ri.scrollLeft,top:ri.scrollTop});for(typeof $e.focus=="function"&&$e.focus(),$e=0;$e<Ai.length;$e++){var ki=Ai[$e];ki.element.scrollLeft=ki.left,ki.element.scrollTop=ki.top}}w_=!!zy,Iy=zy=null}finally{pe=G,Et.p=R,We.T=k}}d.current=y,Dt=2}}function Zl(){if(Dt===2){Dt=0;var d=Ti,y=bi,k=(y.flags&8772)!==0;if((y.subtreeFlags&8772)!==0||k){k=We.T,We.T=null;var R=Et.p;Et.p=2;var G=pe;pe|=4;try{o_(d,y.alternate,y)}finally{pe=G,Et.p=R,We.T=k}}Dt=3}}function $o(){if(Dt===4||Dt===3){Dt=0,ln();var d=Ti,y=bi,k=di,R=dn;(y.subtreeFlags&10256)!==0||(y.flags&10256)!==0?Dt=5:(Dt=0,bi=Ti=null,dr(d,d.pendingLanes));var G=d.pendingLanes;if(G===0&&(Wt=null),go(k),y=y.stateNode,Qa&&typeof Qa.onCommitFiberRoot=="function")try{Qa.onCommitFiberRoot(Kr,y,void 0,(y.current.flags&128)===128)}catch{}if(R!==null){y=We.T,G=Et.p,Et.p=2,We.T=null;try{for(var Q=d.onRecoverableError,we=0;we<R.length;we++){var $e=R[we];Q($e.value,{componentStack:$e.stack})}}finally{We.T=y,Et.p=G}}(di&3)!==0&&gr(),ho(d),G=d.pendingLanes,(k&4194090)!==0&&(G&42)!==0?d===Jn?Pn++:(Pn=0,Jn=d):Pn=0,op(0)}}function dr(d,y){(d.pooledCacheLanes&=y)===0&&(y=d.pooledCache,y!=null&&(d.pooledCache=null,au(y)))}function gr(d){return Al(),Zl(),$o(),Ea()}function Ea(){if(Dt!==5)return!1;var d=Ti,y=_i;_i=0;var k=go(di),R=We.T,G=Et.p;try{Et.p=32>k?32:k,We.T=null,k=Bi,Bi=null;var Q=Ti,we=di;if(Dt=0,bi=Ti=null,di=0,(pe&6)!==0)throw Error(h(331));var $e=pe;if(pe|=4,J(Q.current),T(Q,Q.current,we,k),pe=$e,op(0,!1),Qa&&typeof Qa.onPostCommitFiberRoot=="function")try{Qa.onPostCommitFiberRoot(Kr,Q)}catch{}return!0}finally{Et.p=G,We.T=R,dr(d,y)}}function Mr(d,y,k){y=Ls(k,y),y=Kf(d.stateNode,y,2),d=Ul(d,y,2),d!==null&&(po(d,2),ho(d))}function Dn(d,y,k){if(d.tag===3)Mr(d,d,k);else for(;y!==null;){if(y.tag===3){Mr(y,d,k);break}else if(y.tag===1){var R=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(Wt===null||!Wt.has(R))){d=Ls(k,d),k=Td(2),R=Ul(y,k,2),R!==null&&(Km(k,R,y,d),po(R,2),ho(R));break}}y=y.return}}function ir(d,y,k){var R=d.pingCache;if(R===null){R=d.pingCache=new de;var G=new Set;R.set(y,G)}else G=R.get(y),G===void 0&&(G=new Set,R.set(y,G));G.has(k)||(Ve=!0,G.add(k),d=lc.bind(null,d,y,k),y.then(d,d))}function lc(d,y,k){var R=d.pingCache;R!==null&&R.delete(y),d.pingedLanes|=d.suspendedLanes&k,d.warmLanes&=~k,xe===d&&(je&k)===k&&(Ye===4||Ye===3&&(je&62914560)===je&&300>xn()-Nt?(pe&2)===0&&Va(d,0):Tt|=k,st===je&&(st=0)),ho(d)}function tf(d,y){y===0&&(y=Gs()),d=iu(d,y),d!==null&&(po(d,y),ho(d))}function Rc(d){var y=d.memoizedState,k=0;y!==null&&(k=y.retryLane),tf(d,k)}function om(d,y){var k=0;switch(d.tag){case 13:var R=d.stateNode,G=d.memoizedState;G!==null&&(k=G.retryLane);break;case 19:R=d.stateNode;break;case 22:R=d.stateNode._retryCache;break;default:throw Error(h(314))}R!==null&&R.delete(y),tf(d,k)}function nf(d,y){return Fi(d,y)}var Xl=null,Cl=null,Cd=!1,Dc=!1,Lc=!1,Co=0;function ho(d){d!==Cl&&d.next===null&&(Cl===null?Xl=Cl=d:Cl=Cl.next=d),Dc=!0,Cd||(Cd=!0,xx())}function op(d,y){if(!Lc&&Dc){Lc=!0;do for(var k=!1,R=Xl;R!==null;){if(d!==0){var G=R.pendingLanes;if(G===0)var Q=0;else{var we=R.suspendedLanes,$e=R.pingedLanes;Q=(1<<31-mr(42|d)+1)-1,Q&=G&~(we&~$e),Q=Q&201326741?Q&201326741|1:Q?Q|2:0}Q!==0&&(k=!0,hg(R,Q))}else Q=je,Q=Ql(R,R===xe?Q:0,R.cancelPendingCommit!==null||R.timeoutHandle!==-1),(Q&3)===0||Ss(R,Q)||(k=!0,hg(R,Q));R=R.next}while(k);Lc=!1}}function vx(){dg()}function dg(){Dc=Cd=!1;var d=0;Co!==0&&(_g()&&(d=Co),Co=0);for(var y=xn(),k=null,R=Xl;R!==null;){var G=R.next,Q=c_(R,y);Q===0?(R.next=null,k===null?Xl=G:k.next=G,G===null&&(Cl=k)):(k=R,(d!==0||(Q&3)!==0)&&(Dc=!0)),R=G}op(d)}function c_(d,y){for(var k=d.suspendedLanes,R=d.pingedLanes,G=d.expirationTimes,Q=d.pendingLanes&-62914561;0<Q;){var we=31-mr(Q),$e=1<<we,ct=G[we];ct===-1?(($e&k)===0||($e&R)!==0)&&(G[we]=mo($e,y)):ct<=y&&(d.expiredLanes|=$e),Q&=~$e}if(y=xe,k=je,k=Ql(d,d===y?k:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),R=d.callbackNode,k===0||d===y&&(Ae===2||Ae===9)||d.cancelPendingCommit!==null)return R!==null&&R!==null&&nn(R),d.callbackNode=null,d.callbackPriority=0;if((k&3)===0||Ss(d,k)){if(y=k&-k,y===d.callbackPriority)return y;switch(R!==null&&nn(R),go(k)){case 2:case 8:k=Zo;break;case 32:k=$s;break;case 268435456:k=Vs;break;default:k=$s}return R=lp.bind(null,d),k=Fi(k,R),d.callbackPriority=y,d.callbackNode=k,y}return R!==null&&R!==null&&nn(R),d.callbackPriority=2,d.callbackNode=null,2}function lp(d,y){if(Dt!==0&&Dt!==5)return d.callbackNode=null,d.callbackPriority=0,null;var k=d.callbackNode;if(gr()&&d.callbackNode!==k)return null;var R=je;return R=Ql(d,d===xe?R:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),R===0?null:(la(d,R,y),c_(d,xn()),d.callbackNode!=null&&d.callbackNode===k?lp.bind(null,d):null)}function hg(d,y){if(gr())return null;la(d,y,!0)}function xx(){Ob(function(){(pe&6)!==0?Fi($c,vx):dg()})}function cp(){return Co===0&&(Co=Ko()),Co}function u_(d){return d==null||typeof d=="symbol"||typeof d=="boolean"?null:typeof d=="function"?d:io(""+d)}function d_(d,y){var k=y.ownerDocument.createElement("input");return k.name=y.name,k.value=y.value,d.id&&k.setAttribute("form",d.id),y.parentNode.insertBefore(k,y),d=new FormData(d),k.parentNode.removeChild(k),d}function bx(d,y,k,R,G){if(y==="submit"&&k&&k.stateNode===G){var Q=u_((G[Ei]||null).action),we=R.submitter;we&&(y=(y=we[Ei]||null)?u_(y.formAction):we.getAttribute("formAction"),y!==null&&(Q=y,we=null));var $e=new Yu("action","action",null,R,G);d.push({event:$e,listeners:[{instance:null,listener:function(){if(R.defaultPrevented){if(Co!==0){var ct=we?d_(G,we):new FormData(G);ig(k,{pending:!0,data:ct,method:G.method,action:Q},null,ct)}}else typeof Q=="function"&&($e.preventDefault(),ct=we?d_(G,we):new FormData(G),ig(k,{pending:!0,data:ct,method:G.method,action:Q},Q,ct))},currentTarget:G}]})}}for(var h_=0;h_<Ol.length;h_++){var Md=Ol[h_],wx=Md.toLowerCase(),ky=Md[0].toUpperCase()+Md.slice(1);Qr(wx,"on"+ky)}Qr(Tf,"onAnimationEnd"),Qr(vl,"onAnimationIteration"),Qr(Cu,"onAnimationStart"),Qr("dblclick","onDoubleClick"),Qr("focusin","onFocus"),Qr("focusout","onBlur"),Qr(Jc,"onTransitionRun"),Qr(Vd,"onTransitionStart"),Qr(Am,"onTransitionCancel"),Qr(sd,"onTransitionEnd"),Rt("onMouseEnter",["mouseout","mouseover"]),Rt("onMouseLeave",["mouseout","mouseover"]),Rt("onPointerEnter",["pointerout","pointerover"]),Rt("onPointerLeave",["pointerout","pointerover"]),ot("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ot("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ot("onBeforeInput",["compositionend","keypress","textInput","paste"]),ot("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ot("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ot("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var up="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Db=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(up));function Sx(d,y){y=(y&4)!==0;for(var k=0;k<d.length;k++){var R=d[k],G=R.event;R=R.listeners;e:{var Q=void 0;if(y)for(var we=R.length-1;0<=we;we--){var $e=R[we],ct=$e.instance,Jt=$e.currentTarget;if($e=$e.listener,ct!==Q&&G.isPropagationStopped())break e;Q=$e,G.currentTarget=Jt;try{Q(G)}catch(vi){nh(vi)}G.currentTarget=null,Q=ct}else for(we=0;we<R.length;we++){if($e=R[we],ct=$e.instance,Jt=$e.currentTarget,$e=$e.listener,ct!==Q&&G.isPropagationStopped())break e;Q=$e,G.currentTarget=Jt;try{Q(G)}catch(vi){nh(vi)}G.currentTarget=null,Q=ct}}}}function rr(d,y){var k=y[qi];k===void 0&&(k=y[qi]=new Set);var R=d+"__bubble";k.has(R)||(Ay(y,d,2,!1),k.add(R))}function f_(d,y,k){var R=0;y&&(R|=4),Ay(k,d,R,y)}var fg="_reactListening"+Math.random().toString(36).slice(2);function Ey(d){if(!d[fg]){d[fg]=!0,rt.forEach(function(k){k!=="selectionchange"&&(Db.has(k)||f_(k,!1,d),f_(k,!0,d))});var y=d.nodeType===9?d:d.ownerDocument;y===null||y[fg]||(y[fg]=!0,f_("selectionchange",!1,y))}}function Ay(d,y,k,R){switch(E_(y)){case 2:var G=Wy;break;case 8:G=Dx;break;default:G=S_}k=G.bind(null,y,k,d),G=void 0,!mc||y!=="touchstart"&&y!=="touchmove"&&y!=="wheel"||(G=!0),R?G!==void 0?d.addEventListener(y,k,{capture:!0,passive:G}):d.addEventListener(y,k,!0):G!==void 0?d.addEventListener(y,k,{passive:G}):d.addEventListener(y,k,!1)}function Cy(d,y,k,R,G){var Q=R;if((y&1)===0&&(y&2)===0&&R!==null)e:for(;;){if(R===null)return;var we=R.tag;if(we===3||we===4){var $e=R.stateNode.containerInfo;if($e===G)break;if(we===4)for(we=R.return;we!==null;){var ct=we.tag;if((ct===3||ct===4)&&we.stateNode.containerInfo===G)return;we=we.return}for(;$e!==null;){if(we=ue($e),we===null)return;if(ct=we.tag,ct===5||ct===6||ct===26||ct===27){R=Q=we;continue e}$e=$e.parentNode}}R=R.return}Zs(function(){var Jt=Q,vi=Ws(k),Ai=[];e:{var ii=vc.get(d);if(ii!==void 0){var ri=Yu,ga=d;switch(d){case"keypress":if(os(k)===0)break e;case"keydown":case"keyup":ri=Ju;break;case"focusin":ga="focus",ri=gc;break;case"focusout":ga="blur",ri=gc;break;case"beforeblur":case"afterblur":ri=gc;break;case"click":if(k.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ri=bo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ri=bf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ri=pa;break;case Tf:case vl:case Cu:ri=kh;break;case sd:ri=nc;break;case"scroll":case"scrollend":ri=qc;break;case"wheel":ri=Bd;break;case"copy":case"cut":case"paste":ri=Lo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ri=Ii;break;case"toggle":case"beforetoggle":ri=Ll}var Kn=(y&4)!==0,Dr=!Kn&&(d==="scroll"||d==="scrollend"),Lt=Kn?ii!==null?ii+"Capture":null:ii;Kn=[];for(var kt=Jt,Zt;kt!==null;){var ki=kt;if(Zt=ki.stateNode,ki=ki.tag,ki!==5&&ki!==26&&ki!==27||Zt===null||Lt===null||(ki=ar(kt,Lt),ki!=null&&Kn.push(mg(kt,ki,Zt))),Dr)break;kt=kt.return}0<Kn.length&&(ii=new ri(ii,ga,null,k,vi),Ai.push({event:ii,listeners:Kn}))}}if((y&7)===0){e:{if(ii=d==="mouseover"||d==="pointerover",ri=d==="mouseout"||d==="pointerout",ii&&k!==yo&&(ga=k.relatedTarget||k.fromElement)&&(ue(ga)||ga[ui]))break e;if((ri||ii)&&(ii=vi.window===vi?vi:(ii=vi.ownerDocument)?ii.defaultView||ii.parentWindow:window,ri?(ga=k.relatedTarget||k.toElement,ri=Jt,ga=ga?ue(ga):null,ga!==null&&(Dr=x(ga),Kn=ga.tag,ga!==Dr||Kn!==5&&Kn!==27&&Kn!==6)&&(ga=null)):(ri=null,ga=Jt),ri!==ga)){if(Kn=bo,ki="onMouseLeave",Lt="onMouseEnter",kt="mouse",(d==="pointerout"||d==="pointerover")&&(Kn=Ii,ki="onPointerLeave",Lt="onPointerEnter",kt="pointer"),Dr=ri==null?ii:Fe(ri),Zt=ga==null?ii:Fe(ga),ii=new Kn(ki,kt+"leave",ri,k,vi),ii.target=Dr,ii.relatedTarget=Zt,ki=null,ue(vi)===Jt&&(Kn=new Kn(Lt,kt+"enter",ga,k,vi),Kn.target=Zt,Kn.relatedTarget=Dr,ki=Kn),Dr=ki,ri&&ga)t:{for(Kn=ri,Lt=ga,kt=0,Zt=Kn;Zt;Zt=lm(Zt))kt++;for(Zt=0,ki=Lt;ki;ki=lm(ki))Zt++;for(;0<kt-Zt;)Kn=lm(Kn),kt--;for(;0<Zt-kt;)Lt=lm(Lt),Zt--;for(;kt--;){if(Kn===Lt||Lt!==null&&Kn===Lt.alternate)break t;Kn=lm(Kn),Lt=lm(Lt)}Kn=null}else Kn=null;ri!==null&&My(Ai,ii,ri,Kn,!1),ga!==null&&Dr!==null&&My(Ai,Dr,ga,Kn,!0)}}e:{if(ii=Jt?Fe(Jt):window,ri=ii.nodeName&&ii.nodeName.toLowerCase(),ri==="select"||ri==="input"&&ii.type==="file")var jn=so;else if(ml(ii))if(pl)jn=Sf;else{jn=en;var Xa=id}else ri=ii.nodeName,!ri||ri.toLowerCase()!=="input"||ii.type!=="checkbox"&&ii.type!=="radio"?Jt&&fc(Jt.elementType)&&(jn=so):jn=Rs;if(jn&&(jn=jn(d,Jt))){Hr(Ai,jn,k,vi);break e}Xa&&Xa(d,ii,Jt),d==="focusout"&&Jt&&ii.type==="number"&&Jt.memoizedProps.value!=null&&Jr(ii,"number",ii.value)}switch(Xa=Jt?Fe(Jt):window,d){case"focusin":(ml(Xa)||Xa.contentEditable==="true")&&(So=Xa,ad=Jt,yl=null);break;case"focusout":yl=ad=So=null;break;case"mousedown":Yc=!0;break;case"contextmenu":case"mouseup":case"dragend":Yc=!1,rd(Ai,k,vi);break;case"selectionchange":if(wo)break;case"keydown":case"keyup":rd(Ai,k,vi)}var Ln;if(or)e:{switch(d){case"compositionstart":var aa="onCompositionStart";break e;case"compositionend":aa="onCompositionEnd";break e;case"compositionupdate":aa="onCompositionUpdate";break e}aa=void 0}else ls?ed(d,k)&&(aa="onCompositionEnd"):d==="keydown"&&k.keyCode===229&&(aa="onCompositionStart");aa&&(Ud&&k.locale!=="ko"&&(ls||aa!=="onCompositionStart"?aa==="onCompositionEnd"&&ls&&(Ln=Xu()):(Jo=vi,xo="value"in Jo?Jo.value:Jo.textContent,ls=!0)),Xa=pg(Jt,aa),0<Xa.length&&(aa=new hl(aa,d,null,k,vi),Ai.push({event:aa,listeners:Xa}),Ln?aa.data=Ln:(Ln=$d(k),Ln!==null&&(aa.data=Ln)))),(Ln=_c?ac(d,k):ro(d,k))&&(aa=pg(Jt,"onBeforeInput"),0<aa.length&&(Xa=new hl("onBeforeInput","beforeinput",null,k,vi),Ai.push({event:Xa,listeners:aa}),Xa.data=Ln)),bx(Ai,d,Jt,k,vi)}Sx(Ai,y)})}function mg(d,y,k){return{instance:d,listener:y,currentTarget:k}}function pg(d,y){for(var k=y+"Capture",R=[];d!==null;){var G=d,Q=G.stateNode;if(G=G.tag,G!==5&&G!==26&&G!==27||Q===null||(G=ar(d,k),G!=null&&R.unshift(mg(d,G,Q)),G=ar(d,y),G!=null&&R.push(mg(d,G,Q))),d.tag===3)return R;d=d.return}return[]}function lm(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5&&d.tag!==27);return d||null}function My(d,y,k,R,G){for(var Q=y._reactName,we=[];k!==null&&k!==R;){var $e=k,ct=$e.alternate,Jt=$e.stateNode;if($e=$e.tag,ct!==null&&ct===R)break;$e!==5&&$e!==26&&$e!==27||Jt===null||(ct=Jt,G?(Jt=ar(k,Q),Jt!=null&&we.unshift(mg(k,Jt,ct))):G||(Jt=ar(k,Q),Jt!=null&&we.push(mg(k,Jt,ct)))),k=k.return}we.length!==0&&d.push({event:y,listeners:we})}var Tx=/\r\n?/g,kx=/\u0000|\uFFFD/g;function Py(d){return(typeof d=="string"?d:""+d).replace(Tx,`
`).replace(kx,"")}function jy(d,y){return y=Py(y),Py(d)===y}function dp(){}function hr(d,y,k,R,G,Q){switch(k){case"children":typeof R=="string"?y==="body"||y==="textarea"&&R===""||_o(d,R):(typeof R=="number"||typeof R=="bigint")&&y!=="body"&&_o(d,""+R);break;case"className":rn(d,"class",R);break;case"tabIndex":rn(d,"tabindex",R);break;case"dir":case"role":case"viewBox":case"width":case"height":rn(d,k,R);break;case"style":hc(d,R,Q);break;case"data":if(y!=="object"){rn(d,"data",R);break}case"src":case"href":if(R===""&&(y!=="a"||k!=="href")){d.removeAttribute(k);break}if(R==null||typeof R=="function"||typeof R=="symbol"||typeof R=="boolean"){d.removeAttribute(k);break}R=io(""+R),d.setAttribute(k,R);break;case"action":case"formAction":if(typeof R=="function"){d.setAttribute(k,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof Q=="function"&&(k==="formAction"?(y!=="input"&&hr(d,y,"name",G.name,G,null),hr(d,y,"formEncType",G.formEncType,G,null),hr(d,y,"formMethod",G.formMethod,G,null),hr(d,y,"formTarget",G.formTarget,G,null)):(hr(d,y,"encType",G.encType,G,null),hr(d,y,"method",G.method,G,null),hr(d,y,"target",G.target,G,null)));if(R==null||typeof R=="symbol"||typeof R=="boolean"){d.removeAttribute(k);break}R=io(""+R),d.setAttribute(k,R);break;case"onClick":R!=null&&(d.onclick=dp);break;case"onScroll":R!=null&&rr("scroll",d);break;case"onScrollEnd":R!=null&&rr("scrollend",d);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(h(61));if(k=R.__html,k!=null){if(G.children!=null)throw Error(h(60));d.innerHTML=k}}break;case"multiple":d.multiple=R&&typeof R!="function"&&typeof R!="symbol";break;case"muted":d.muted=R&&typeof R!="function"&&typeof R!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(R==null||typeof R=="function"||typeof R=="boolean"||typeof R=="symbol"){d.removeAttribute("xlink:href");break}k=io(""+R),d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",k);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":R!=null&&typeof R!="function"&&typeof R!="symbol"?d.setAttribute(k,""+R):d.removeAttribute(k);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":R&&typeof R!="function"&&typeof R!="symbol"?d.setAttribute(k,""):d.removeAttribute(k);break;case"capture":case"download":R===!0?d.setAttribute(k,""):R!==!1&&R!=null&&typeof R!="function"&&typeof R!="symbol"?d.setAttribute(k,R):d.removeAttribute(k);break;case"cols":case"rows":case"size":case"span":R!=null&&typeof R!="function"&&typeof R!="symbol"&&!isNaN(R)&&1<=R?d.setAttribute(k,R):d.removeAttribute(k);break;case"rowSpan":case"start":R==null||typeof R=="function"||typeof R=="symbol"||isNaN(R)?d.removeAttribute(k):d.setAttribute(k,R);break;case"popover":rr("beforetoggle",d),rr("toggle",d),tn(d,"popover",R);break;case"xlinkActuate":Zi(d,"http://www.w3.org/1999/xlink","xlink:actuate",R);break;case"xlinkArcrole":Zi(d,"http://www.w3.org/1999/xlink","xlink:arcrole",R);break;case"xlinkRole":Zi(d,"http://www.w3.org/1999/xlink","xlink:role",R);break;case"xlinkShow":Zi(d,"http://www.w3.org/1999/xlink","xlink:show",R);break;case"xlinkTitle":Zi(d,"http://www.w3.org/1999/xlink","xlink:title",R);break;case"xlinkType":Zi(d,"http://www.w3.org/1999/xlink","xlink:type",R);break;case"xmlBase":Zi(d,"http://www.w3.org/XML/1998/namespace","xml:base",R);break;case"xmlLang":Zi(d,"http://www.w3.org/XML/1998/namespace","xml:lang",R);break;case"xmlSpace":Zi(d,"http://www.w3.org/XML/1998/namespace","xml:space",R);break;case"is":tn(d,"is",R);break;case"innerText":case"textContent":break;default:(!(2<k.length)||k[0]!=="o"&&k[0]!=="O"||k[1]!=="n"&&k[1]!=="N")&&(k=dl.get(k)||k,tn(d,k,R))}}function Fs(d,y,k,R,G,Q){switch(k){case"style":hc(d,R,Q);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(h(61));if(k=R.__html,k!=null){if(G.children!=null)throw Error(h(60));d.innerHTML=k}}break;case"children":typeof R=="string"?_o(d,R):(typeof R=="number"||typeof R=="bigint")&&_o(d,""+R);break;case"onScroll":R!=null&&rr("scroll",d);break;case"onScrollEnd":R!=null&&rr("scrollend",d);break;case"onClick":R!=null&&(d.onclick=dp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Je.hasOwnProperty(k))e:{if(k[0]==="o"&&k[1]==="n"&&(G=k.endsWith("Capture"),y=k.slice(2,G?k.length-7:void 0),Q=d[Ei]||null,Q=Q!=null?Q[k]:null,typeof Q=="function"&&d.removeEventListener(y,Q,G),typeof R=="function")){typeof Q!="function"&&Q!==null&&(k in d?d[k]=null:d.hasAttribute(k)&&d.removeAttribute(k)),d.addEventListener(y,R,G);break e}k in d?d[k]=R:R===!0?d.setAttribute(k,""):tn(d,k,R)}}}function Vo(d,y,k){switch(y){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":rr("error",d),rr("load",d);var R=!1,G=!1,Q;for(Q in k)if(k.hasOwnProperty(Q)){var we=k[Q];if(we!=null)switch(Q){case"src":R=!0;break;case"srcSet":G=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(h(137,y));default:hr(d,y,Q,we,k,null)}}G&&hr(d,y,"srcSet",k.srcSet,k,null),R&&hr(d,y,"src",k.src,k,null);return;case"input":rr("invalid",d);var $e=Q=we=G=null,ct=null,Jt=null;for(R in k)if(k.hasOwnProperty(R)){var vi=k[R];if(vi!=null)switch(R){case"name":G=vi;break;case"type":we=vi;break;case"checked":ct=vi;break;case"defaultChecked":Jt=vi;break;case"value":Q=vi;break;case"defaultValue":$e=vi;break;case"children":case"dangerouslySetInnerHTML":if(vi!=null)throw Error(h(137,y));break;default:hr(d,y,R,vi,k,null)}}zo(d,Q,$e,ct,Jt,we,G,!1),Wa(d);return;case"select":rr("invalid",d),R=we=Q=null;for(G in k)if(k.hasOwnProperty(G)&&($e=k[G],$e!=null))switch(G){case"value":Q=$e;break;case"defaultValue":we=$e;break;case"multiple":R=$e;default:hr(d,y,G,$e,k,null)}y=Q,k=we,d.multiple=!!R,y!=null?ss(d,!!R,y,!1):k!=null&&ss(d,!!R,k,!0);return;case"textarea":rr("invalid",d),Q=G=R=null;for(we in k)if(k.hasOwnProperty(we)&&($e=k[we],$e!=null))switch(we){case"value":R=$e;break;case"defaultValue":G=$e;break;case"children":Q=$e;break;case"dangerouslySetInnerHTML":if($e!=null)throw Error(h(91));break;default:hr(d,y,we,$e,k,null)}Io(d,R,G,Q),Wa(d);return;case"option":for(ct in k)if(k.hasOwnProperty(ct)&&(R=k[ct],R!=null))switch(ct){case"selected":d.selected=R&&typeof R!="function"&&typeof R!="symbol";break;default:hr(d,y,ct,R,k,null)}return;case"dialog":rr("beforetoggle",d),rr("toggle",d),rr("cancel",d),rr("close",d);break;case"iframe":case"object":rr("load",d);break;case"video":case"audio":for(R=0;R<up.length;R++)rr(up[R],d);break;case"image":rr("error",d),rr("load",d);break;case"details":rr("toggle",d);break;case"embed":case"source":case"link":rr("error",d),rr("load",d);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Jt in k)if(k.hasOwnProperty(Jt)&&(R=k[Jt],R!=null))switch(Jt){case"children":case"dangerouslySetInnerHTML":throw Error(h(137,y));default:hr(d,y,Jt,R,k,null)}return;default:if(fc(y)){for(vi in k)k.hasOwnProperty(vi)&&(R=k[vi],R!==void 0&&Fs(d,y,vi,R,k,void 0));return}}for($e in k)k.hasOwnProperty($e)&&(R=k[$e],R!=null&&hr(d,y,$e,R,k,null))}function gg(d,y,k,R){switch(y){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var G=null,Q=null,we=null,$e=null,ct=null,Jt=null,vi=null;for(ri in k){var Ai=k[ri];if(k.hasOwnProperty(ri)&&Ai!=null)switch(ri){case"checked":break;case"value":break;case"defaultValue":ct=Ai;default:R.hasOwnProperty(ri)||hr(d,y,ri,null,R,Ai)}}for(var ii in R){var ri=R[ii];if(Ai=k[ii],R.hasOwnProperty(ii)&&(ri!=null||Ai!=null))switch(ii){case"type":Q=ri;break;case"name":G=ri;break;case"checked":Jt=ri;break;case"defaultChecked":vi=ri;break;case"value":we=ri;break;case"defaultValue":$e=ri;break;case"children":case"dangerouslySetInnerHTML":if(ri!=null)throw Error(h(137,y));break;default:ri!==Ai&&hr(d,y,ii,ri,R,Ai)}}er(d,we,$e,ct,Jt,vi,Q,G);return;case"select":ri=we=$e=ii=null;for(Q in k)if(ct=k[Q],k.hasOwnProperty(Q)&&ct!=null)switch(Q){case"value":break;case"multiple":ri=ct;default:R.hasOwnProperty(Q)||hr(d,y,Q,null,R,ct)}for(G in R)if(Q=R[G],ct=k[G],R.hasOwnProperty(G)&&(Q!=null||ct!=null))switch(G){case"value":ii=Q;break;case"defaultValue":$e=Q;break;case"multiple":we=Q;default:Q!==ct&&hr(d,y,G,Q,R,ct)}y=$e,k=we,R=ri,ii!=null?ss(d,!!k,ii,!1):!!R!=!!k&&(y!=null?ss(d,!!k,y,!0):ss(d,!!k,k?[]:"",!1));return;case"textarea":ri=ii=null;for($e in k)if(G=k[$e],k.hasOwnProperty($e)&&G!=null&&!R.hasOwnProperty($e))switch($e){case"value":break;case"children":break;default:hr(d,y,$e,null,R,G)}for(we in R)if(G=R[we],Q=k[we],R.hasOwnProperty(we)&&(G!=null||Q!=null))switch(we){case"value":ii=G;break;case"defaultValue":ri=G;break;case"children":break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(h(91));break;default:G!==Q&&hr(d,y,we,G,R,Q)}xa(d,ii,ri);return;case"option":for(var ga in k)if(ii=k[ga],k.hasOwnProperty(ga)&&ii!=null&&!R.hasOwnProperty(ga))switch(ga){case"selected":d.selected=!1;break;default:hr(d,y,ga,null,R,ii)}for(ct in R)if(ii=R[ct],ri=k[ct],R.hasOwnProperty(ct)&&ii!==ri&&(ii!=null||ri!=null))switch(ct){case"selected":d.selected=ii&&typeof ii!="function"&&typeof ii!="symbol";break;default:hr(d,y,ct,ii,R,ri)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Kn in k)ii=k[Kn],k.hasOwnProperty(Kn)&&ii!=null&&!R.hasOwnProperty(Kn)&&hr(d,y,Kn,null,R,ii);for(Jt in R)if(ii=R[Jt],ri=k[Jt],R.hasOwnProperty(Jt)&&ii!==ri&&(ii!=null||ri!=null))switch(Jt){case"children":case"dangerouslySetInnerHTML":if(ii!=null)throw Error(h(137,y));break;default:hr(d,y,Jt,ii,R,ri)}return;default:if(fc(y)){for(var Dr in k)ii=k[Dr],k.hasOwnProperty(Dr)&&ii!==void 0&&!R.hasOwnProperty(Dr)&&Fs(d,y,Dr,void 0,R,ii);for(vi in R)ii=R[vi],ri=k[vi],!R.hasOwnProperty(vi)||ii===ri||ii===void 0&&ri===void 0||Fs(d,y,vi,ii,R,ri);return}}for(var Lt in k)ii=k[Lt],k.hasOwnProperty(Lt)&&ii!=null&&!R.hasOwnProperty(Lt)&&hr(d,y,Lt,null,R,ii);for(Ai in R)ii=R[Ai],ri=k[Ai],!R.hasOwnProperty(Ai)||ii===ri||ii==null&&ri==null||hr(d,y,Ai,ii,R,ri)}var zy=null,Iy=null;function m_(d){return d.nodeType===9?d:d.ownerDocument}function Ex(d){switch(d){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function cm(d,y){if(d===0)switch(y){case"svg":return 1;case"math":return 2;default:return 0}return d===1&&y==="foreignObject"?0:d}function p_(d,y){return d==="textarea"||d==="noscript"||typeof y.children=="string"||typeof y.children=="number"||typeof y.children=="bigint"||typeof y.dangerouslySetInnerHTML=="object"&&y.dangerouslySetInnerHTML!==null&&y.dangerouslySetInnerHTML.__html!=null}var oh=null;function _g(){var d=window.event;return d&&d.type==="popstate"?d===oh?!1:(oh=d,!0):(oh=null,!1)}var Ax=typeof setTimeout=="function"?setTimeout:void 0,Lb=typeof clearTimeout=="function"?clearTimeout:void 0,Cx=typeof Promise=="function"?Promise:void 0,Ob=typeof queueMicrotask=="function"?queueMicrotask:typeof Cx<"u"?function(d){return Cx.resolve(null).then(d).catch(Nb)}:Ax;function Nb(d){setTimeout(function(){throw d})}function af(d){return d==="head"}function Mx(d,y){var k=y,R=0,G=0;do{var Q=k.nextSibling;if(d.removeChild(k),Q&&Q.nodeType===8)if(k=Q.data,k==="/$"){if(0<R&&8>R){k=R;var we=d.ownerDocument;if(k&1&&sf(we.documentElement),k&2&&sf(we.body),k&4)for(k=we.head,sf(k),we=k.firstChild;we;){var $e=we.nextSibling,ct=we.nodeName;we[Ze]||ct==="SCRIPT"||ct==="STYLE"||ct==="LINK"&&we.rel.toLowerCase()==="stylesheet"||k.removeChild(we),we=$e}}if(G===0){d.removeChild(Q),hm(y);return}G--}else k==="$"||k==="$?"||k==="$!"?G++:R=k.charCodeAt(0)-48;else R=0;k=Q}while(k);hm(y)}function yg(d){var y=d.firstChild;for(y&&y.nodeType===10&&(y=y.nextSibling);y;){var k=y;switch(y=y.nextSibling,k.nodeName){case"HTML":case"HEAD":case"BODY":yg(k),ie(k);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(k.rel.toLowerCase()==="stylesheet")continue}d.removeChild(k)}}function Fb(d,y,k,R){for(;d.nodeType===1;){var G=k;if(d.nodeName.toLowerCase()!==y.toLowerCase()){if(!R&&(d.nodeName!=="INPUT"||d.type!=="hidden"))break}else if(R){if(!d[Ze])switch(y){case"meta":if(!d.hasAttribute("itemprop"))break;return d;case"link":if(Q=d.getAttribute("rel"),Q==="stylesheet"&&d.hasAttribute("data-precedence"))break;if(Q!==G.rel||d.getAttribute("href")!==(G.href==null||G.href===""?null:G.href)||d.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin)||d.getAttribute("title")!==(G.title==null?null:G.title))break;return d;case"style":if(d.hasAttribute("data-precedence"))break;return d;case"script":if(Q=d.getAttribute("src"),(Q!==(G.src==null?null:G.src)||d.getAttribute("type")!==(G.type==null?null:G.type)||d.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin))&&Q&&d.hasAttribute("async")&&!d.hasAttribute("itemprop"))break;return d;default:return d}}else if(y==="input"&&d.type==="hidden"){var Q=G.name==null?null:""+G.name;if(G.type==="hidden"&&d.getAttribute("name")===Q)return d}else return d;if(d=br(d.nextSibling),d===null)break}return null}function Px(d,y,k){if(y==="")return null;for(;d.nodeType!==3;)if((d.nodeType!==1||d.nodeName!=="INPUT"||d.type!=="hidden")&&!k||(d=br(d.nextSibling),d===null))return null;return d}function um(d){return d.data==="$!"||d.data==="$?"&&d.ownerDocument.readyState==="complete"}function Bb(d,y){var k=d.ownerDocument;if(d.data!=="$?"||k.readyState==="complete")y();else{var R=function(){y(),k.removeEventListener("DOMContentLoaded",R)};k.addEventListener("DOMContentLoaded",R),d._reactRetry=R}}function br(d){for(;d!=null;d=d.nextSibling){var y=d.nodeType;if(y===1||y===3)break;if(y===8){if(y=d.data,y==="$"||y==="$!"||y==="$?"||y==="F!"||y==="F")break;if(y==="/$")return null}}return d}var rf=null;function Ry(d){d=d.previousSibling;for(var y=0;d;){if(d.nodeType===8){var k=d.data;if(k==="$"||k==="$!"||k==="$?"){if(y===0)return d;y--}else k==="/$"&&y++}d=d.previousSibling}return null}function vg(d,y,k){switch(y=m_(k),d){case"html":if(d=y.documentElement,!d)throw Error(h(452));return d;case"head":if(d=y.head,!d)throw Error(h(453));return d;case"body":if(d=y.body,!d)throw Error(h(454));return d;default:throw Error(h(451))}}function sf(d){for(var y=d.attributes;y.length;)d.removeAttributeNode(y[0]);ie(d)}var Ml=new Map,Dy=new Set;function xg(d){return typeof d.getRootNode=="function"?d.getRootNode():d.nodeType===9?d:d.ownerDocument}var Oc=Et.d;Et.d={f:Ly,r:bg,D:Ny,C:Fy,L:jx,m:lh,X:Yl,S:Ub,M:zx};function Ly(){var d=Oc.f(),y=mn();return d||y}function bg(d){var y=Te(d);y!==null&&y.tag===5&&y.type==="form"?ng(y):Oc.r(d)}var hp=typeof document>"u"?null:document;function Oy(d,y,k){var R=hp;if(R&&typeof y=="string"&&y){var G=rs(y);G='link[rel="'+d+'"][href="'+G+'"]',typeof k=="string"&&(G+='[crossorigin="'+k+'"]'),Dy.has(G)||(Dy.add(G),d={rel:d,crossOrigin:k,href:y},R.querySelector(G)===null&&(y=R.createElement("link"),Vo(y,"link",d),qe(y),R.head.appendChild(y)))}}function Ny(d){Oc.D(d),Oy("dns-prefetch",d,null)}function Fy(d,y){Oc.C(d,y),Oy("preconnect",d,y)}function jx(d,y,k){Oc.L(d,y,k);var R=hp;if(R&&d&&y){var G='link[rel="preload"][as="'+rs(y)+'"]';y==="image"&&k&&k.imageSrcSet?(G+='[imagesrcset="'+rs(k.imageSrcSet)+'"]',typeof k.imageSizes=="string"&&(G+='[imagesizes="'+rs(k.imageSizes)+'"]')):G+='[href="'+rs(d)+'"]';var Q=G;switch(y){case"style":Q=dm(d);break;case"script":Q=lf(d)}Ml.has(Q)||(d=N({rel:"preload",href:y==="image"&&k&&k.imageSrcSet?void 0:d,as:y},k),Ml.set(Q,d),R.querySelector(G)!==null||y==="style"&&R.querySelector(of(Q))||y==="script"&&R.querySelector(fp(Q))||(y=R.createElement("link"),Vo(y,"link",d),qe(y),R.head.appendChild(y)))}}function lh(d,y){Oc.m(d,y);var k=hp;if(k&&d){var R=y&&typeof y.as=="string"?y.as:"script",G='link[rel="modulepreload"][as="'+rs(R)+'"][href="'+rs(d)+'"]',Q=G;switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":Q=lf(d)}if(!Ml.has(Q)&&(d=N({rel:"modulepreload",href:d},y),Ml.set(Q,d),k.querySelector(G)===null)){switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(k.querySelector(fp(Q)))return}R=k.createElement("link"),Vo(R,"link",d),qe(R),k.head.appendChild(R)}}}function Ub(d,y,k){Oc.S(d,y,k);var R=hp;if(R&&d){var G=Be(R).hoistableStyles,Q=dm(d);y=y||"default";var we=G.get(Q);if(!we){var $e={loading:0,preload:null};if(we=R.querySelector(of(Q)))$e.loading=5;else{d=N({rel:"stylesheet",href:d,"data-precedence":y},k),(k=Ml.get(Q))&&__(d,k);var ct=we=R.createElement("link");qe(ct),Vo(ct,"link",d),ct._p=new Promise(function(Jt,vi){ct.onload=Jt,ct.onerror=vi}),ct.addEventListener("load",function(){$e.loading|=1}),ct.addEventListener("error",function(){$e.loading|=2}),$e.loading|=4,mp(we,y,R)}we={type:"stylesheet",instance:we,count:1,state:$e},G.set(Q,we)}}}function Yl(d,y){Oc.X(d,y);var k=hp;if(k&&d){var R=Be(k).hoistableScripts,G=lf(d),Q=R.get(G);Q||(Q=k.querySelector(fp(G)),Q||(d=N({src:d,async:!0},y),(y=Ml.get(G))&&y_(d,y),Q=k.createElement("script"),qe(Q),Vo(Q,"link",d),k.head.appendChild(Q)),Q={type:"script",instance:Q,count:1,state:null},R.set(G,Q))}}function zx(d,y){Oc.M(d,y);var k=hp;if(k&&d){var R=Be(k).hoistableScripts,G=lf(d),Q=R.get(G);Q||(Q=k.querySelector(fp(G)),Q||(d=N({src:d,async:!0,type:"module"},y),(y=Ml.get(G))&&y_(d,y),Q=k.createElement("script"),qe(Q),Vo(Q,"link",d),k.head.appendChild(Q)),Q={type:"script",instance:Q,count:1,state:null},R.set(G,Q))}}function By(d,y,k,R){var G=(G=li.current)?xg(G):null;if(!G)throw Error(h(446));switch(d){case"meta":case"title":return null;case"style":return typeof k.precedence=="string"&&typeof k.href=="string"?(y=dm(k.href),k=Be(G).hoistableStyles,R=k.get(y),R||(R={type:"style",instance:null,count:0,state:null},k.set(y,R)),R):{type:"void",instance:null,count:0,state:null};case"link":if(k.rel==="stylesheet"&&typeof k.href=="string"&&typeof k.precedence=="string"){d=dm(k.href);var Q=Be(G).hoistableStyles,we=Q.get(d);if(we||(G=G.ownerDocument||G,we={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},Q.set(d,we),(Q=G.querySelector(of(d)))&&!Q._p&&(we.instance=Q,we.state.loading=5),Ml.has(d)||(k={rel:"preload",as:"style",href:k.href,crossOrigin:k.crossOrigin,integrity:k.integrity,media:k.media,hrefLang:k.hrefLang,referrerPolicy:k.referrerPolicy},Ml.set(d,k),Q||$b(G,d,k,we.state))),y&&R===null)throw Error(h(528,""));return we}if(y&&R!==null)throw Error(h(529,""));return null;case"script":return y=k.async,k=k.src,typeof k=="string"&&y&&typeof y!="function"&&typeof y!="symbol"?(y=lf(k),k=Be(G).hoistableScripts,R=k.get(y),R||(R={type:"script",instance:null,count:0,state:null},k.set(y,R)),R):{type:"void",instance:null,count:0,state:null};default:throw Error(h(444,d))}}function dm(d){return'href="'+rs(d)+'"'}function of(d){return'link[rel="stylesheet"]['+d+"]"}function Ix(d){return N({},d,{"data-precedence":d.precedence,precedence:null})}function $b(d,y,k,R){d.querySelector('link[rel="preload"][as="style"]['+y+"]")?R.loading=1:(y=d.createElement("link"),R.preload=y,y.addEventListener("load",function(){return R.loading|=1}),y.addEventListener("error",function(){return R.loading|=2}),Vo(y,"link",k),qe(y),d.head.appendChild(y))}function lf(d){return'[src="'+rs(d)+'"]'}function fp(d){return"script[async]"+d}function g_(d,y,k){if(y.count++,y.instance===null)switch(y.type){case"style":var R=d.querySelector('style[data-href~="'+rs(k.href)+'"]');if(R)return y.instance=R,qe(R),R;var G=N({},k,{"data-href":k.href,"data-precedence":k.precedence,href:null,precedence:null});return R=(d.ownerDocument||d).createElement("style"),qe(R),Vo(R,"style",G),mp(R,k.precedence,d),y.instance=R;case"stylesheet":G=dm(k.href);var Q=d.querySelector(of(G));if(Q)return y.state.loading|=4,y.instance=Q,qe(Q),Q;R=Ix(k),(G=Ml.get(G))&&__(R,G),Q=(d.ownerDocument||d).createElement("link"),qe(Q);var we=Q;return we._p=new Promise(function($e,ct){we.onload=$e,we.onerror=ct}),Vo(Q,"link",R),y.state.loading|=4,mp(Q,k.precedence,d),y.instance=Q;case"script":return Q=lf(k.src),(G=d.querySelector(fp(Q)))?(y.instance=G,qe(G),G):(R=k,(G=Ml.get(Q))&&(R=N({},k),y_(R,G)),d=d.ownerDocument||d,G=d.createElement("script"),qe(G),Vo(G,"link",R),d.head.appendChild(G),y.instance=G);case"void":return null;default:throw Error(h(443,y.type))}else y.type==="stylesheet"&&(y.state.loading&4)===0&&(R=y.instance,y.state.loading|=4,mp(R,k.precedence,d));return y.instance}function mp(d,y,k){for(var R=k.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),G=R.length?R[R.length-1]:null,Q=G,we=0;we<R.length;we++){var $e=R[we];if($e.dataset.precedence===y)Q=$e;else if(Q!==G)break}Q?Q.parentNode.insertBefore(d,Q.nextSibling):(y=k.nodeType===9?k.head:k,y.insertBefore(d,y.firstChild))}function __(d,y){d.crossOrigin==null&&(d.crossOrigin=y.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=y.referrerPolicy),d.title==null&&(d.title=y.title)}function y_(d,y){d.crossOrigin==null&&(d.crossOrigin=y.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=y.referrerPolicy),d.integrity==null&&(d.integrity=y.integrity)}var wg=null;function Uy(d,y,k){if(wg===null){var R=new Map,G=wg=new Map;G.set(k,R)}else G=wg,R=G.get(k),R||(R=new Map,G.set(k,R));if(R.has(d))return R;for(R.set(d,null),k=k.getElementsByTagName(d),G=0;G<k.length;G++){var Q=k[G];if(!(Q[Ze]||Q[Qt]||d==="link"&&Q.getAttribute("rel")==="stylesheet")&&Q.namespaceURI!=="http://www.w3.org/2000/svg"){var we=Q.getAttribute(y)||"";we=d+we;var $e=R.get(we);$e?$e.push(Q):R.set(we,[Q])}}return R}function Sg(d,y,k){d=d.ownerDocument||d,d.head.insertBefore(k,y==="title"?d.querySelector("head > title"):null)}function Pd(d,y,k){if(k===1||y.itemProp!=null)return!1;switch(d){case"meta":case"title":return!0;case"style":if(typeof y.precedence!="string"||typeof y.href!="string"||y.href==="")break;return!0;case"link":if(typeof y.rel!="string"||typeof y.href!="string"||y.href===""||y.onLoad||y.onError)break;switch(y.rel){case"stylesheet":return d=y.disabled,typeof y.precedence=="string"&&d==null;default:return!0}case"script":if(y.async&&typeof y.async!="function"&&typeof y.async!="symbol"&&!y.onLoad&&!y.onError&&y.src&&typeof y.src=="string")return!0}return!1}function $y(d){return!(d.type==="stylesheet"&&(d.state.loading&3)===0)}var Tg=null;function Vb(){}function Hb(d,y,k){if(Tg===null)throw Error(h(475));var R=Tg;if(y.type==="stylesheet"&&(typeof k.media!="string"||matchMedia(k.media).matches!==!1)&&(y.state.loading&4)===0){if(y.instance===null){var G=dm(k.href),Q=d.querySelector(of(G));if(Q){d=Q._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(R.count++,R=v_.bind(R),d.then(R,R)),y.state.loading|=4,y.instance=Q,qe(Q);return}Q=d.ownerDocument||d,k=Ix(k),(G=Ml.get(G))&&__(k,G),Q=Q.createElement("link"),qe(Q);var we=Q;we._p=new Promise(function($e,ct){we.onload=$e,we.onerror=ct}),Vo(Q,"link",k),y.instance=Q}R.stylesheets===null&&(R.stylesheets=new Map),R.stylesheets.set(y,d),(d=y.state.preload)&&(y.state.loading&3)===0&&(R.count++,y=v_.bind(R),d.addEventListener("load",y),d.addEventListener("error",y))}}function Gb(){if(Tg===null)throw Error(h(475));var d=Tg;return d.stylesheets&&d.count===0&&Vy(d,d.stylesheets),0<d.count?function(y){var k=setTimeout(function(){if(d.stylesheets&&Vy(d,d.stylesheets),d.unsuspend){var R=d.unsuspend;d.unsuspend=null,R()}},6e4);return d.unsuspend=y,function(){d.unsuspend=null,clearTimeout(k)}}:null}function v_(){if(this.count--,this.count===0){if(this.stylesheets)Vy(this,this.stylesheets);else if(this.unsuspend){var d=this.unsuspend;this.unsuspend=null,d()}}}var x_=null;function Vy(d,y){d.stylesheets=null,d.unsuspend!==null&&(d.count++,x_=new Map,y.forEach(qb,d),x_=null,v_.call(d))}function qb(d,y){if(!(y.state.loading&4)){var k=x_.get(d);if(k)var R=k.get(null);else{k=new Map,x_.set(d,k);for(var G=d.querySelectorAll("link[data-precedence],style[data-precedence]"),Q=0;Q<G.length;Q++){var we=G[Q];(we.nodeName==="LINK"||we.getAttribute("media")!=="not all")&&(k.set(we.dataset.precedence,we),R=we)}R&&k.set(null,R)}G=y.instance,we=G.getAttribute("data-precedence"),Q=k.get(we)||R,Q===R&&k.set(null,G),k.set(we,G),this.count++,R=v_.bind(this),G.addEventListener("load",R),G.addEventListener("error",R),Q?Q.parentNode.insertBefore(G,Q.nextSibling):(d=d.nodeType===9?d.head:d,d.insertBefore(G,d.firstChild)),y.state.loading|=4}}var ch={$$typeof:Ee,Provider:null,Consumer:null,_currentValue:jt,_currentValue2:jt,_threadCount:0};function Rx(d,y,k,R,G,Q,we,$e){this.tag=1,this.containerInfo=d,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ec(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ec(0),this.hiddenUpdates=ec(null),this.identifierPrefix=R,this.onUncaughtError=G,this.onCaughtError=Q,this.onRecoverableError=we,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=$e,this.incompleteTransitions=new Map}function Hy(d,y,k,R,G,Q,we,$e,ct,Jt,vi,Ai){return d=new Rx(d,y,k,we,$e,ct,Jt,Ai),y=1,Q===!0&&(y|=24),Q=es(3,null,null,y),d.current=Q,Q.stateNode=d,y=zh(),y.refCount++,d.pooledCache=y,y.refCount++,Q.memoizedState={element:R,isDehydrated:k,cache:y},Lh(Q),d}function kg(d){return d?(d=xc,d):xc}function Gy(d,y,k,R,G,Q){G=kg(G),R.context===null?R.context=G:R.pendingContext=G,R=Du(y),R.payload={element:k},Q=Q===void 0?null:Q,Q!==null&&(R.callback=Q),k=Ul(d,R,y),k!==null&&(Wi(k,d,y),Wd(k,d,y))}function b_(d,y){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var k=d.retryLane;d.retryLane=k!==0&&k<y?k:y}}function pp(d,y){b_(d,y),(d=d.alternate)&&b_(d,y)}function qy(d){if(d.tag===13){var y=iu(d,67108864);y!==null&&Wi(y,d,67108864),pp(d,67108864)}}var w_=!0;function Wy(d,y,k,R){var G=We.T;We.T=null;var Q=Et.p;try{Et.p=2,S_(d,y,k,R)}finally{Et.p=Q,We.T=G}}function Dx(d,y,k,R){var G=We.T;We.T=null;var Q=Et.p;try{Et.p=8,S_(d,y,k,R)}finally{Et.p=Q,We.T=G}}function S_(d,y,k,R){if(w_){var G=T_(R);if(G===null)Cy(d,y,R,gp,k),yp(d,R);else if(A_(G,d,y,k,R))R.stopPropagation();else if(yp(d,R),y&4&&-1<Lx.indexOf(d)){for(;G!==null;){var Q=Te(G);if(Q!==null)switch(Q.tag){case 3:if(Q=Q.stateNode,Q.current.memoizedState.isDehydrated){var we=zr(Q.pendingLanes);if(we!==0){var $e=Q;for($e.pendingLanes|=2,$e.entangledLanes|=2;we;){var ct=1<<31-mr(we);$e.entanglements[1]|=ct,we&=~ct}ho(Q),(pe&6)===0&&(ti=xn()+500,op(0))}}break;case 13:$e=iu(Q,2),$e!==null&&Wi($e,Q,2),mn(),pp(Q,2)}if(Q=T_(R),Q===null&&Cy(d,y,R,gp,k),Q===G)break;G=Q}G!==null&&R.stopPropagation()}else Cy(d,y,R,null,k)}}function T_(d){return d=Ws(d),k_(d)}var gp=null;function k_(d){if(gp=null,d=ue(d),d!==null){var y=x(d);if(y===null)d=null;else{var k=y.tag;if(k===13){if(d=S(y),d!==null)return d;d=null}else if(k===3){if(y.stateNode.current.memoizedState.isDehydrated)return y.tag===3?y.stateNode.containerInfo:null;d=null}else y!==d&&(d=null)}}return gp=d,null}function E_(d){switch(d){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(za()){case $c:return 2;case Zo:return 8;case $s:case ws:return 32;case Vs:return 268435456;default:return 32}default:return 32}}var Zy=!1,cf=null,uf=null,df=null,_p=new Map,Nc=new Map,uh=[],Lx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yp(d,y){switch(d){case"focusin":case"focusout":cf=null;break;case"dragenter":case"dragleave":uf=null;break;case"mouseover":case"mouseout":df=null;break;case"pointerover":case"pointerout":_p.delete(y.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nc.delete(y.pointerId)}}function dh(d,y,k,R,G,Q){return d===null||d.nativeEvent!==Q?(d={blockedOn:y,domEventName:k,eventSystemFlags:R,nativeEvent:Q,targetContainers:[G]},y!==null&&(y=Te(y),y!==null&&qy(y)),d):(d.eventSystemFlags|=R,y=d.targetContainers,G!==null&&y.indexOf(G)===-1&&y.push(G),d)}function A_(d,y,k,R,G){switch(y){case"focusin":return cf=dh(cf,d,y,k,R,G),!0;case"dragenter":return uf=dh(uf,d,y,k,R,G),!0;case"mouseover":return df=dh(df,d,y,k,R,G),!0;case"pointerover":var Q=G.pointerId;return _p.set(Q,dh(_p.get(Q)||null,d,y,k,R,G)),!0;case"gotpointercapture":return Q=G.pointerId,Nc.set(Q,dh(Nc.get(Q)||null,d,y,k,R,G)),!0}return!1}function vp(d){var y=ue(d.target);if(y!==null){var k=x(y);if(k!==null){if(y=k.tag,y===13){if(y=S(k),y!==null){d.blockedOn=y,Pe(d.priority,function(){if(k.tag===13){var R=wi();R=jo(R);var G=iu(k,R);G!==null&&Wi(G,k,R),pp(k,R)}});return}}else if(y===3&&k.stateNode.current.memoizedState.isDehydrated){d.blockedOn=k.tag===3?k.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Eg(d){if(d.blockedOn!==null)return!1;for(var y=d.targetContainers;0<y.length;){var k=T_(d.nativeEvent);if(k===null){k=d.nativeEvent;var R=new k.constructor(k.type,k);yo=R,k.target.dispatchEvent(R),yo=null}else return y=Te(k),y!==null&&qy(y),d.blockedOn=k,!1;y.shift()}return!0}function Xy(d,y,k){Eg(d)&&k.delete(y)}function Ox(){Zy=!1,cf!==null&&Eg(cf)&&(cf=null),uf!==null&&Eg(uf)&&(uf=null),df!==null&&Eg(df)&&(df=null),_p.forEach(Xy),Nc.forEach(Xy)}function Ag(d,y){d.blockedOn===y&&(d.blockedOn=null,Zy||(Zy=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Ox)))}var C_=null;function Nx(d){C_!==d&&(C_=d,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){C_===d&&(C_=null);for(var y=0;y<d.length;y+=3){var k=d[y],R=d[y+1],G=d[y+2];if(typeof R!="function"){if(k_(R||k)===null)continue;break}var Q=Te(k);Q!==null&&(d.splice(y,3),y-=3,ig(Q,{pending:!0,data:G,method:k.method,action:R},R,G))}}))}function hm(d){function y(ct){return Ag(ct,d)}cf!==null&&Ag(cf,d),uf!==null&&Ag(uf,d),df!==null&&Ag(df,d),_p.forEach(y),Nc.forEach(y);for(var k=0;k<uh.length;k++){var R=uh[k];R.blockedOn===d&&(R.blockedOn=null)}for(;0<uh.length&&(k=uh[0],k.blockedOn===null);)vp(k),k.blockedOn===null&&uh.shift();if(k=(d.ownerDocument||d).$$reactFormReplay,k!=null)for(R=0;R<k.length;R+=3){var G=k[R],Q=k[R+1],we=G[Ei]||null;if(typeof Q=="function")we||Nx(k);else if(we){var $e=null;if(Q&&Q.hasAttribute("formAction")){if(G=Q,we=Q[Ei]||null)$e=we.formAction;else if(k_(G)!==null)continue}else $e=we.action;typeof $e=="function"?k[R+1]=$e:(k.splice(R,3),R-=3),Nx(k)}}}function xp(d){this._internalRoot=d}Cg.prototype.render=xp.prototype.render=function(d){var y=this._internalRoot;if(y===null)throw Error(h(409));var k=y.current,R=wi();Gy(k,R,d,y,null,null)},Cg.prototype.unmount=xp.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var y=d.containerInfo;Gy(d.current,2,null,d,null,null),mn(),y[ui]=null}};function Cg(d){this._internalRoot=d}Cg.prototype.unstable_scheduleHydration=function(d){if(d){var y=wu();d={blockedOn:null,target:d,priority:y};for(var k=0;k<uh.length&&y!==0&&y<uh[k].priority;k++);uh.splice(k,0,d),k===0&&vp(d)}};var Fx=r.version;if(Fx!=="19.1.1")throw Error(h(527,Fx,"19.1.1"));Et.findDOMNode=function(d){var y=d._reactInternals;if(y===void 0)throw typeof d.render=="function"?Error(h(188)):(d=Object.keys(d).join(","),Error(h(268,d)));return d=M(y),d=d!==null?P(d):null,d=d===null?null:d.stateNode,d};var Bx={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:We,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bp.isDisabled&&bp.supportsFiber)try{Kr=bp.inject(Bx),Qa=bp}catch{}}return Ev.createRoot=function(d,y){if(!p(d))throw Error(h(299));var k=!1,R="",G=Yf,Q=Xm,we=Wr,$e=null;return y!=null&&(y.unstable_strictMode===!0&&(k=!0),y.identifierPrefix!==void 0&&(R=y.identifierPrefix),y.onUncaughtError!==void 0&&(G=y.onUncaughtError),y.onCaughtError!==void 0&&(Q=y.onCaughtError),y.onRecoverableError!==void 0&&(we=y.onRecoverableError),y.unstable_transitionCallbacks!==void 0&&($e=y.unstable_transitionCallbacks)),y=Hy(d,1,!1,null,null,k,R,G,Q,we,$e,null),d[ui]=y.current,Ey(d),new xp(y)},Ev.hydrateRoot=function(d,y,k){if(!p(d))throw Error(h(299));var R=!1,G="",Q=Yf,we=Xm,$e=Wr,ct=null,Jt=null;return k!=null&&(k.unstable_strictMode===!0&&(R=!0),k.identifierPrefix!==void 0&&(G=k.identifierPrefix),k.onUncaughtError!==void 0&&(Q=k.onUncaughtError),k.onCaughtError!==void 0&&(we=k.onCaughtError),k.onRecoverableError!==void 0&&($e=k.onRecoverableError),k.unstable_transitionCallbacks!==void 0&&(ct=k.unstable_transitionCallbacks),k.formState!==void 0&&(Jt=k.formState)),y=Hy(d,1,!0,y,k??null,R,G,Q,we,$e,ct,Jt),y.context=kg(null),k=y.current,R=wi(),R=jo(R),G=Du(R),G.callback=null,Ul(k,G,R),k=R,y.current.lanes=k,po(y,k),ho(y),d[ui]=y.current,Ey(d),new Cg(y)},Ev.version="19.1.1",Ev}var Dk;function tR(){if(Dk)return Zw.exports;Dk=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(r){console.error(r)}}return o(),Zw.exports=eR(),Zw.exports}var iR=tR();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var EC=o=>{throw TypeError(o)},nR=(o,r,c)=>r.has(o)||EC("Cannot "+c),Jw=(o,r,c)=>(nR(o,r,"read from private field"),c?c.call(o):r.get(o)),aR=(o,r,c)=>r.has(o)?EC("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(o):r.set(o,c),Lk="popstate";function rR(o={}){function r(h,p){let{pathname:x,search:S,hash:i}=h.location;return Jv("",{pathname:x,search:S,hash:i},p.state&&p.state.usr||null,p.state&&p.state.key||"default")}function c(h,p){return typeof p=="string"?p:$p(p)}return oR(r,c,null,o)}function nr(o,r){if(o===!1||o===null||typeof o>"u")throw new Error(r)}function qo(o,r){if(!o){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function sR(){return Math.random().toString(36).substring(2,10)}function Ok(o,r){return{usr:o.state,key:o.key,idx:r}}function Jv(o,r,c=null,h){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof r=="string"?Gp(r):r,state:c,key:r&&r.key||h||sR()}}function $p({pathname:o="/",search:r="",hash:c=""}){return r&&r!=="?"&&(o+=r.charAt(0)==="?"?r:"?"+r),c&&c!=="#"&&(o+=c.charAt(0)==="#"?c:"#"+c),o}function Gp(o){let r={};if(o){let c=o.indexOf("#");c>=0&&(r.hash=o.substring(c),o=o.substring(0,c));let h=o.indexOf("?");h>=0&&(r.search=o.substring(h),o=o.substring(0,h)),o&&(r.pathname=o)}return r}function oR(o,r,c,h={}){let{window:p=document.defaultView,v5Compat:x=!1}=h,S=p.history,i="POP",M=null,P=N();P==null&&(P=0,S.replaceState({...S.state,idx:P},""));function N(){return(S.state||{idx:null}).idx}function H(){i="POP";let ce=N(),ve=ce==null?null:ce-P;P=ce,M&&M({action:i,location:ae.location,delta:ve})}function W(ce,ve){i="PUSH";let Se=Jv(ae.location,ce,ve);P=N()+1;let Ee=Ok(Se,P),Qe=ae.createHref(Se);try{S.pushState(Ee,"",Qe)}catch(He){if(He instanceof DOMException&&He.name==="DataCloneError")throw He;p.location.assign(Qe)}x&&M&&M({action:i,location:ae.location,delta:1})}function K(ce,ve){i="REPLACE";let Se=Jv(ae.location,ce,ve);P=N();let Ee=Ok(Se,P),Qe=ae.createHref(Se);S.replaceState(Ee,"",Qe),x&&M&&M({action:i,location:ae.location,delta:0})}function re(ce){return AC(ce)}let ae={get action(){return i},get location(){return o(p,S)},listen(ce){if(M)throw new Error("A history only accepts one active listener");return p.addEventListener(Lk,H),M=ce,()=>{p.removeEventListener(Lk,H),M=null}},createHref(ce){return r(p,ce)},createURL:re,encodeLocation(ce){let ve=re(ce);return{pathname:ve.pathname,search:ve.search,hash:ve.hash}},push:W,replace:K,go(ce){return S.go(ce)}};return ae}function AC(o,r=!1){let c="http://localhost";typeof window<"u"&&(c=window.location.origin!=="null"?window.location.origin:window.location.href),nr(c,"No window.location.(origin|href) available to create URL");let h=typeof o=="string"?o:$p(o);return h=h.replace(/ $/,"%20"),!r&&h.startsWith("//")&&(h=c+h),new URL(h,c)}var Bv,Nk=class{constructor(o){if(aR(this,Bv,new Map),o)for(let[r,c]of o)this.set(r,c)}get(o){if(Jw(this,Bv).has(o))return Jw(this,Bv).get(o);if(o.defaultValue!==void 0)return o.defaultValue;throw new Error("No value found for context")}set(o,r){Jw(this,Bv).set(o,r)}};Bv=new WeakMap;var lR=new Set(["lazy","caseSensitive","path","id","index","children"]);function cR(o){return lR.has(o)}var uR=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function dR(o){return uR.has(o)}function hR(o){return o.index===!0}function Qv(o,r,c=[],h={},p=!1){return o.map((x,S)=>{let i=[...c,String(S)],M=typeof x.id=="string"?x.id:i.join("-");if(nr(x.index!==!0||!x.children,"Cannot specify children on an index route"),nr(p||!h[M],`Found a route id collision on id "${M}".  Route id's must be globally unique within Data Router usages`),hR(x)){let P={...x,...r(x),id:M};return h[M]=P,P}else{let P={...x,...r(x),id:M,children:void 0};return h[M]=P,x.children&&(P.children=Qv(x.children,r,i,h,p)),P}})}function jp(o,r,c="/"){return Q0(o,r,c,!1)}function Q0(o,r,c,h){let p=typeof r=="string"?Gp(r):r,x=Ld(p.pathname||"/",c);if(x==null)return null;let S=CC(o);mR(S);let i=null;for(let M=0;i==null&&M<S.length;++M){let P=kR(x);i=SR(S[M],P,h)}return i}function fR(o,r){let{route:c,pathname:h,params:p}=o;return{id:c.id,pathname:h,params:p,data:r[c.id],loaderData:r[c.id],handle:c.handle}}function CC(o,r=[],c=[],h="",p=!1){let x=(S,i,M=p,P)=>{let N={relativePath:P===void 0?S.path||"":P,caseSensitive:S.caseSensitive===!0,childrenIndex:i,route:S};if(N.relativePath.startsWith("/")){if(!N.relativePath.startsWith(h)&&M)return;nr(N.relativePath.startsWith(h),`Absolute route path "${N.relativePath}" nested under path "${h}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),N.relativePath=N.relativePath.slice(h.length)}let H=vf([h,N.relativePath]),W=c.concat(N);S.children&&S.children.length>0&&(nr(S.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${H}".`),CC(S.children,r,W,H,M)),!(S.path==null&&!S.index)&&r.push({path:H,score:bR(H,S.index),routesMeta:W})};return o.forEach((S,i)=>{if(S.path===""||!S.path?.includes("?"))x(S,i);else for(let M of MC(S.path))x(S,i,!0,M)}),r}function MC(o){let r=o.split("/");if(r.length===0)return[];let[c,...h]=r,p=c.endsWith("?"),x=c.replace(/\?$/,"");if(h.length===0)return p?[x,""]:[x];let S=MC(h.join("/")),i=[];return i.push(...S.map(M=>M===""?x:[x,M].join("/"))),p&&i.push(...S),i.map(M=>o.startsWith("/")&&M===""?"/":M)}function mR(o){o.sort((r,c)=>r.score!==c.score?c.score-r.score:wR(r.routesMeta.map(h=>h.childrenIndex),c.routesMeta.map(h=>h.childrenIndex)))}var pR=/^:[\w-]+$/,gR=3,_R=2,yR=1,vR=10,xR=-2,Fk=o=>o==="*";function bR(o,r){let c=o.split("/"),h=c.length;return c.some(Fk)&&(h+=xR),r&&(h+=_R),c.filter(p=>!Fk(p)).reduce((p,x)=>p+(pR.test(x)?gR:x===""?yR:vR),h)}function wR(o,r){return o.length===r.length&&o.slice(0,-1).every((h,p)=>h===r[p])?o[o.length-1]-r[r.length-1]:0}function SR(o,r,c=!1){let{routesMeta:h}=o,p={},x="/",S=[];for(let i=0;i<h.length;++i){let M=h[i],P=i===h.length-1,N=x==="/"?r:r.slice(x.length)||"/",H=cb({path:M.relativePath,caseSensitive:M.caseSensitive,end:P},N),W=M.route;if(!H&&P&&c&&!h[h.length-1].route.index&&(H=cb({path:M.relativePath,caseSensitive:M.caseSensitive,end:!1},N)),!H)return null;Object.assign(p,H.params),S.push({params:p,pathname:vf([x,H.pathname]),pathnameBase:MR(vf([x,H.pathnameBase])),route:W}),H.pathnameBase!=="/"&&(x=vf([x,H.pathnameBase]))}return S}function cb(o,r){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[c,h]=TR(o.path,o.caseSensitive,o.end),p=r.match(c);if(!p)return null;let x=p[0],S=x.replace(/(.)\/+$/,"$1"),i=p.slice(1);return{params:h.reduce((P,{paramName:N,isOptional:H},W)=>{if(N==="*"){let re=i[W]||"";S=x.slice(0,x.length-re.length).replace(/(.)\/+$/,"$1")}const K=i[W];return H&&!K?P[N]=void 0:P[N]=(K||"").replace(/%2F/g,"/"),P},{}),pathname:x,pathnameBase:S,pattern:o}}function TR(o,r=!1,c=!0){qo(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let h=[],p="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(S,i,M)=>(h.push({paramName:i,isOptional:M!=null}),M?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return o.endsWith("*")?(h.push({paramName:"*"}),p+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):c?p+="\\/*$":o!==""&&o!=="/"&&(p+="(?:(?=\\/|$))"),[new RegExp(p,r?void 0:"i"),h]}function kR(o){try{return o.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return qo(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${r}).`),o}}function Ld(o,r){if(r==="/")return o;if(!o.toLowerCase().startsWith(r.toLowerCase()))return null;let c=r.endsWith("/")?r.length-1:r.length,h=o.charAt(c);return h&&h!=="/"?null:o.slice(c)||"/"}function ER({basename:o,pathname:r}){return r==="/"?o:vf([o,r])}function AR(o,r="/"){let{pathname:c,search:h="",hash:p=""}=typeof o=="string"?Gp(o):o;return{pathname:c?c.startsWith("/")?c:CR(c,r):r,search:PR(h),hash:jR(p)}}function CR(o,r){let c=r.replace(/\/+$/,"").split("/");return o.split("/").forEach(p=>{p===".."?c.length>1&&c.pop():p!=="."&&c.push(p)}),c.length>1?c.join("/"):"/"}function Qw(o,r,c,h){return`Cannot include a '${o}' character in a manually specified \`to.${r}\` field [${JSON.stringify(h)}].  Please separate it out to the \`to.${c}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function PC(o){return o.filter((r,c)=>c===0||r.route.path&&r.route.path.length>0)}function oS(o){let r=PC(o);return r.map((c,h)=>h===r.length-1?c.pathname:c.pathnameBase)}function lS(o,r,c,h=!1){let p;typeof o=="string"?p=Gp(o):(p={...o},nr(!p.pathname||!p.pathname.includes("?"),Qw("?","pathname","search",p)),nr(!p.pathname||!p.pathname.includes("#"),Qw("#","pathname","hash",p)),nr(!p.search||!p.search.includes("#"),Qw("#","search","hash",p)));let x=o===""||p.pathname==="",S=x?"/":p.pathname,i;if(S==null)i=c;else{let H=r.length-1;if(!h&&S.startsWith("..")){let W=S.split("/");for(;W[0]==="..";)W.shift(),H-=1;p.pathname=W.join("/")}i=H>=0?r[H]:"/"}let M=AR(p,i),P=S&&S!=="/"&&S.endsWith("/"),N=(x||S===".")&&c.endsWith("/");return!M.pathname.endsWith("/")&&(P||N)&&(M.pathname+="/"),M}var vf=o=>o.join("/").replace(/\/\/+/g,"/"),MR=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),PR=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,jR=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o,ub=class{constructor(o,r,c,h=!1){this.status=o,this.statusText=r||"",this.internal=h,c instanceof Error?(this.data=c.toString(),this.error=c):this.data=c}};function ex(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}var jC=["POST","PUT","PATCH","DELETE"],zR=new Set(jC),IR=["GET",...jC],RR=new Set(IR),DR=new Set([301,302,303,307,308]),LR=new Set([307,308]),e1={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},OR={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Av={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},NR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cS=o=>NR.test(o),FR=o=>({hasErrorBoundary:!!o.hasErrorBoundary}),zC="remix-router-transitions",IC=Symbol("ResetLoaderData");function BR(o){const r=o.window?o.window:typeof window<"u"?window:void 0,c=typeof r<"u"&&typeof r.document<"u"&&typeof r.document.createElement<"u";nr(o.routes.length>0,"You must provide a non-empty routes array to createRouter");let h=o.hydrationRouteProperties||[],p=o.mapRouteProperties||FR,x={},S=Qv(o.routes,p,void 0,x),i,M=o.basename||"/";M.startsWith("/")||(M=`/${M}`);let P=o.dataStrategy||GR,N={...o.future},H=null,W=new Set,K=null,re=null,ae=null,ce=o.hydrationData!=null,ve=jp(S,o.history.location,M),Se=!1,Ee=null,Qe;if(ve==null&&!o.patchRoutesOnNavigation){let Pe=Dd(404,{pathname:o.history.location.pathname}),{matches:zt,route:Qt}=w0(S);Qe=!0,ve=zt,Ee={[Qt.id]:Pe}}else if(ve&&!o.hydrationData&&tc(ve,S,o.history.location.pathname).active&&(ve=null),ve)if(ve.some(Pe=>Pe.route.lazy))Qe=!1;else if(!ve.some(Pe=>uS(Pe.route)))Qe=!0;else{let Pe=o.hydrationData?o.hydrationData.loaderData:null,zt=o.hydrationData?o.hydrationData.errors:null;if(zt){let Qt=ve.findIndex(Ei=>zt[Ei.route.id]!==void 0);Qe=ve.slice(0,Qt+1).every(Ei=>!N1(Ei.route,Pe,zt))}else Qe=ve.every(Qt=>!N1(Qt.route,Pe,zt))}else{Qe=!1,ve=[];let Pe=tc(null,S,o.history.location.pathname);Pe.active&&Pe.matches&&(Se=!0,ve=Pe.matches)}let He,ke={historyAction:o.history.action,location:o.history.location,matches:ve,initialized:Qe,navigation:e1,restoreScrollPosition:o.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:o.hydrationData&&o.hydrationData.loaderData||{},actionData:o.hydrationData&&o.hydrationData.actionData||null,errors:o.hydrationData&&o.hydrationData.errors||Ee,fetchers:new Map,blockers:new Map},tt="POP",Ke=!1,lt,ft=!1,gt=new Map,ni=null,Ft=!1,Vi=!1,Ri=new Set,We=new Map,Et=0,jt=-1,Gi=new Map,Ce=new Set,_t=new Map,At=new Map,Ct=new Set,oi=new Map,Ci,li=null;function Ba(){if(H=o.history.listen(({action:Pe,location:zt,delta:Qt})=>{if(Ci){Ci(),Ci=void 0;return}qo(oi.size===0||Qt!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Ei=Ko({currentLocation:ke.location,nextLocation:zt,historyAction:Pe});if(Ei&&Qt!=null){let ui=new Promise(qi=>{Ci=qi});o.history.go(Qt*-1),mo(Ei,{state:"blocked",location:zt,proceed(){mo(Ei,{state:"proceeding",proceed:void 0,reset:void 0,location:zt}),ui.then(()=>o.history.go(Qt))},reset(){let qi=new Map(ke.blockers);qi.set(Ei,Av),On({blockers:qi})}});return}return nn(Pe,zt)}),c){sD(r,gt);let Pe=()=>oD(r,gt);r.addEventListener("pagehide",Pe),ni=()=>r.removeEventListener("pagehide",Pe)}return ke.initialized||nn("POP",ke.location,{initialHydration:!0}),He}function Un(){H&&H(),ni&&ni(),W.clear(),lt&&lt.abort(),ke.fetchers.forEach((Pe,zt)=>ul(zt)),ke.blockers.forEach((Pe,zt)=>Ss(zt))}function qn(Pe){return W.add(Pe),()=>W.delete(Pe)}function On(Pe,zt={}){Pe.matches&&(Pe.matches=Pe.matches.map(ui=>{let qi=x[ui.route.id],Si=ui.route;return Si.element!==qi.element||Si.errorElement!==qi.errorElement||Si.hydrateFallbackElement!==qi.hydrateFallbackElement?{...ui,route:qi}:ui})),ke={...ke,...Pe};let Qt=[],Ei=[];ke.fetchers.forEach((ui,qi)=>{ui.state==="idle"&&(Ct.has(qi)?Qt.push(qi):Ei.push(qi))}),Ct.forEach(ui=>{!ke.fetchers.has(ui)&&!We.has(ui)&&Qt.push(ui)}),[...W].forEach(ui=>ui(ke,{deletedFetchers:Qt,viewTransitionOpts:zt.viewTransitionOpts,flushSync:zt.flushSync===!0})),Qt.forEach(ui=>ul(ui)),Ei.forEach(ui=>ke.fetchers.delete(ui))}function Ja(Pe,zt,{flushSync:Qt}={}){let Ei=ke.actionData!=null&&ke.navigation.formMethod!=null&&yu(ke.navigation.formMethod)&&ke.navigation.state==="loading"&&Pe.state?._isRedirect!==!0,ui;zt.actionData?Object.keys(zt.actionData).length>0?ui=zt.actionData:ui=null:Ei?ui=ke.actionData:ui=null;let qi=zt.loaderData?Xk(ke.loaderData,zt.loaderData,zt.matches||[],zt.errors):ke.loaderData,Si=ke.blockers;Si.size>0&&(Si=new Map(Si),Si.forEach((ie,ue)=>Si.set(ue,Av)));let pn=Ft?!1:Fr(Pe,zt.matches||ke.matches),kn=Ke===!0||ke.navigation.formMethod!=null&&yu(ke.navigation.formMethod)&&Pe.state?._isRedirect!==!0;i&&(S=i,i=void 0),Ft||tt==="POP"||(tt==="PUSH"?o.history.push(Pe,Pe.state):tt==="REPLACE"&&o.history.replace(Pe,Pe.state));let Ze;if(tt==="POP"){let ie=gt.get(ke.location.pathname);ie&&ie.has(Pe.pathname)?Ze={currentLocation:ke.location,nextLocation:Pe}:gt.has(Pe.pathname)&&(Ze={currentLocation:Pe,nextLocation:ke.location})}else if(ft){let ie=gt.get(ke.location.pathname);ie?ie.add(Pe.pathname):(ie=new Set([Pe.pathname]),gt.set(ke.location.pathname,ie)),Ze={currentLocation:ke.location,nextLocation:Pe}}On({...zt,actionData:ui,loaderData:qi,historyAction:tt,location:Pe,initialized:!0,navigation:e1,revalidation:"idle",restoreScrollPosition:pn,preventScrollReset:kn,blockers:Si},{viewTransitionOpts:Ze,flushSync:Qt===!0}),tt="POP",Ke=!1,ft=!1,Ft=!1,Vi=!1,li?.resolve(),li=null}async function Qi(Pe,zt){if(typeof Pe=="number"){o.history.go(Pe);return}let Qt=O1(ke.location,ke.matches,M,Pe,zt?.fromRouteId,zt?.relative),{path:Ei,submission:ui,error:qi}=Bk(!1,Qt,zt),Si=ke.location,pn=Jv(ke.location,Ei,zt&&zt.state);pn={...pn,...o.history.encodeLocation(pn)};let kn=zt&&zt.replace!=null?zt.replace:void 0,Ze="PUSH";kn===!0?Ze="REPLACE":kn===!1||ui!=null&&yu(ui.formMethod)&&ui.formAction===ke.location.pathname+ke.location.search&&(Ze="REPLACE");let ie=zt&&"preventScrollReset"in zt?zt.preventScrollReset===!0:void 0,ue=(zt&&zt.flushSync)===!0,Te=Ko({currentLocation:Si,nextLocation:pn,historyAction:Ze});if(Te){mo(Te,{state:"blocked",location:pn,proceed(){mo(Te,{state:"proceeding",proceed:void 0,reset:void 0,location:pn}),Qi(Pe,zt)},reset(){let Fe=new Map(ke.blockers);Fe.set(Te,Av),On({blockers:Fe})}});return}await nn(Ze,pn,{submission:ui,pendingError:qi,preventScrollReset:ie,replace:zt&&zt.replace,enableViewTransition:zt&&zt.viewTransition,flushSync:ue})}function Fi(){li||(li=lD()),Xo(),On({revalidation:"loading"});let Pe=li.promise;return ke.navigation.state==="submitting"?Pe:ke.navigation.state==="idle"?(nn(ke.historyAction,ke.location,{startUninterruptedRevalidation:!0}),Pe):(nn(tt||ke.historyAction,ke.navigation.location,{overrideNavigation:ke.navigation,enableViewTransition:ft===!0}),Pe)}async function nn(Pe,zt,Qt){lt&&lt.abort(),lt=null,tt=Pe,Ft=(Qt&&Qt.startUninterruptedRevalidation)===!0,qa(ke.location,ke.matches),Ke=(Qt&&Qt.preventScrollReset)===!0,ft=(Qt&&Qt.enableViewTransition)===!0;let Ei=i||S,ui=Qt&&Qt.overrideNavigation,qi=Qt?.initialHydration&&ke.matches&&ke.matches.length>0&&!Se?ke.matches:jp(Ei,zt,M),Si=(Qt&&Qt.flushSync)===!0;if(qi&&ke.initialized&&!Vi&&QR(ke.location,zt)&&!(Qt&&Qt.submission&&yu(Qt.submission.formMethod))){Ja(zt,{matches:qi},{flushSync:Si});return}let pn=tc(qi,Ei,zt.pathname);if(pn.active&&pn.matches&&(qi=pn.matches),!qi){let{error:qe,notFoundMatches:rt,route:Je}=Gs(zt.pathname);Ja(zt,{matches:rt,loaderData:{},errors:{[Je.id]:qe}},{flushSync:Si});return}lt=new AbortController;let kn=sy(o.history,zt,lt.signal,Qt&&Qt.submission),Ze=o.getContext?await o.getContext():new Nk,ie;if(Qt&&Qt.pendingError)ie=[zp(qi).route.id,{type:"error",error:Qt.pendingError}];else if(Qt&&Qt.submission&&yu(Qt.submission.formMethod)){let qe=await hn(kn,zt,Qt.submission,qi,Ze,pn.active,Qt&&Qt.initialHydration===!0,{replace:Qt.replace,flushSync:Si});if(qe.shortCircuited)return;if(qe.pendingActionResult){let[rt,Je]=qe.pendingActionResult;if(Wu(Je)&&ex(Je.error)&&Je.error.status===404){lt=null,Ja(zt,{matches:qe.matches,loaderData:{},errors:{[rt]:Je.error}});return}}qi=qe.matches||qi,ie=qe.pendingActionResult,ui=t1(zt,Qt.submission),Si=!1,pn.active=!1,kn=sy(o.history,kn.url,kn.signal)}let{shortCircuited:ue,matches:Te,loaderData:Fe,errors:Be}=await ln(kn,zt,qi,Ze,pn.active,ui,Qt&&Qt.submission,Qt&&Qt.fetcherSubmission,Qt&&Qt.replace,Qt&&Qt.initialHydration===!0,Si,ie);ue||(lt=null,Ja(zt,{matches:Te||qi,...Yk(ie),loaderData:Fe,errors:Be}))}async function hn(Pe,zt,Qt,Ei,ui,qi,Si,pn={}){Xo();let kn=aD(zt,Qt);if(On({navigation:kn},{flushSync:pn.flushSync===!0}),qi){let ue=await jo(Ei,zt.pathname,Pe.signal);if(ue.type==="aborted")return{shortCircuited:!0};if(ue.type==="error"){if(ue.partialMatches.length===0){let{matches:Fe,route:Be}=w0(S);return{matches:Fe,pendingActionResult:[Be.id,{type:"error",error:ue.error}]}}let Te=zp(ue.partialMatches).route.id;return{matches:ue.partialMatches,pendingActionResult:[Te,{type:"error",error:ue.error}]}}else if(ue.matches)Ei=ue.matches;else{let{notFoundMatches:Te,error:Fe,route:Be}=Gs(zt.pathname);return{matches:Te,pendingActionResult:[Be.id,{type:"error",error:Fe}]}}}let Ze,ie=eb(Ei,zt);if(!ie.route.action&&!ie.route.lazy)Ze={type:"error",error:Dd(405,{method:Pe.method,pathname:zt.pathname,routeId:ie.route.id})};else{let ue=uy(p,x,Pe,Ei,ie,Si?[]:h,ui),Te=await Vs(Pe,ue,ui,null);if(Ze=Te[ie.route.id],!Ze){for(let Fe of Ei)if(Te[Fe.route.id]){Ze=Te[Fe.route.id];break}}if(Pe.signal.aborted)return{shortCircuited:!0}}if(Gg(Ze)){let ue;return pn&&pn.replace!=null?ue=pn.replace:ue=qk(Ze.response.headers.get("Location"),new URL(Pe.url),M)===ke.location.pathname+ke.location.search,await ws(Pe,Ze,!0,{submission:Qt,replace:ue}),{shortCircuited:!0}}if(Wu(Ze)){let ue=zp(Ei,ie.route.id);return(pn&&pn.replace)!==!0&&(tt="PUSH"),{matches:Ei,pendingActionResult:[ue.route.id,Ze,ie.route.id]}}return{matches:Ei,pendingActionResult:[ie.route.id,Ze]}}async function ln(Pe,zt,Qt,Ei,ui,qi,Si,pn,kn,Ze,ie,ue){let Te=qi||t1(zt,Si),Fe=Si||pn||Jk(Te),Be=!Ft&&!Ze;if(ui){if(Be){let $n=xn(ue);On({navigation:Te,...$n!==void 0?{actionData:$n}:{}},{flushSync:ie})}let Ui=await jo(Qt,zt.pathname,Pe.signal);if(Ui.type==="aborted")return{shortCircuited:!0};if(Ui.type==="error"){if(Ui.partialMatches.length===0){let{matches:Ia,route:Ta}=w0(S);return{matches:Ia,loaderData:{},errors:{[Ta.id]:Ui.error}}}let $n=zp(Ui.partialMatches).route.id;return{matches:Ui.partialMatches,loaderData:{},errors:{[$n]:Ui.error}}}else if(Ui.matches)Qt=Ui.matches;else{let{error:$n,notFoundMatches:Ia,route:Ta}=Gs(zt.pathname);return{matches:Ia,loaderData:{},errors:{[Ta.id]:$n}}}}let qe=i||S,{dsMatches:rt,revalidatingFetchers:Je}=Uk(Pe,Ei,p,x,o.history,ke,Qt,Fe,zt,Ze?[]:h,Ze===!0,Vi,Ri,Ct,_t,Ce,qe,M,o.patchRoutesOnNavigation!=null,ue);if(jt=++Et,!o.dataStrategy&&!rt.some(Ui=>Ui.shouldLoad)&&!rt.some(Ui=>Ui.route.middleware&&Ui.route.middleware.length>0)&&Je.length===0){let Ui=yr();return Ja(zt,{matches:Qt,loaderData:{},errors:ue&&Wu(ue[1])?{[ue[0]]:ue[1].error}:null,...Yk(ue),...Ui?{fetchers:new Map(ke.fetchers)}:{}},{flushSync:ie}),{shortCircuited:!0}}if(Be){let Ui={};if(!ui){Ui.navigation=Te;let $n=xn(ue);$n!==void 0&&(Ui.actionData=$n)}Je.length>0&&(Ui.fetchers=za(Je)),On(Ui,{flushSync:ie})}Je.forEach(Ui=>{Hs(Ui.key),Ui.controller&&We.set(Ui.key,Ui.controller)});let ot=()=>Je.forEach(Ui=>Hs(Ui.key));lt&&lt.signal.addEventListener("abort",ot);let{loaderResults:Rt,fetcherResults:St}=await Vr(rt,Je,Pe,Ei);if(Pe.signal.aborted)return{shortCircuited:!0};lt&&lt.signal.removeEventListener("abort",ot),Je.forEach(Ui=>We.delete(Ui.key));let ci=S0(Rt);if(ci)return await ws(Pe,ci.result,!0,{replace:kn}),{shortCircuited:!0};if(ci=S0(St),ci)return Ce.add(ci.key),await ws(Pe,ci.result,!0,{replace:kn}),{shortCircuited:!0};let{loaderData:Oi,errors:mi}=Zk(ke,Qt,Rt,ue,Je,St);Ze&&ke.errors&&(mi={...ke.errors,...mi});let tn=yr(),rn=zr(jt),Zi=tn||rn||Je.length>0;return{matches:Qt,loaderData:Oi,errors:mi,...Zi?{fetchers:new Map(ke.fetchers)}:{}}}function xn(Pe){if(Pe&&!Wu(Pe[1]))return{[Pe[0]]:Pe[1].data};if(ke.actionData)return Object.keys(ke.actionData).length===0?null:ke.actionData}function za(Pe){return Pe.forEach(zt=>{let Qt=ke.fetchers.get(zt.key),Ei=Cv(void 0,Qt?Qt.data:void 0);ke.fetchers.set(zt.key,Ei)}),new Map(ke.fetchers)}async function $c(Pe,zt,Qt,Ei){Hs(Pe);let ui=(Ei&&Ei.flushSync)===!0,qi=i||S,Si=O1(ke.location,ke.matches,M,Qt,zt,Ei?.relative),pn=jp(qi,Si,M),kn=tc(pn,qi,Si);if(kn.active&&kn.matches&&(pn=kn.matches),!pn){Qa(Pe,zt,Dd(404,{pathname:Si}),{flushSync:ui});return}let{path:Ze,submission:ie,error:ue}=Bk(!0,Si,Ei);if(ue){Qa(Pe,zt,ue,{flushSync:ui});return}let Te=o.getContext?await o.getContext():new Nk,Fe=(Ei&&Ei.preventScrollReset)===!0;if(ie&&yu(ie.formMethod)){await Zo(Pe,zt,Ze,pn,Te,kn.active,ui,Fe,ie);return}_t.set(Pe,{routeId:zt,path:Ze}),await $s(Pe,zt,Ze,pn,Te,kn.active,ui,Fe,ie)}async function Zo(Pe,zt,Qt,Ei,ui,qi,Si,pn,kn){Xo(),_t.delete(Pe);let Ze=ke.fetchers.get(Pe);Kr(Pe,rD(kn,Ze),{flushSync:Si});let ie=new AbortController,ue=sy(o.history,Qt,ie.signal,kn);if(qi){let Yn=await jo(Ei,new URL(ue.url).pathname,ue.signal,Pe);if(Yn.type==="aborted")return;if(Yn.type==="error"){Qa(Pe,zt,Yn.error,{flushSync:Si});return}else if(Yn.matches)Ei=Yn.matches;else{Qa(Pe,zt,Dd(404,{pathname:Qt}),{flushSync:Si});return}}let Te=eb(Ei,Qt);if(!Te.route.action&&!Te.route.lazy){let Yn=Dd(405,{method:kn.formMethod,pathname:Qt,routeId:zt});Qa(Pe,zt,Yn,{flushSync:Si});return}We.set(Pe,ie);let Fe=Et,Be=uy(p,x,ue,Ei,Te,h,ui),rt=(await Vs(ue,Be,ui,Pe))[Te.route.id];if(ue.signal.aborted){We.get(Pe)===ie&&We.delete(Pe);return}if(Ct.has(Pe)){if(Gg(rt)||Wu(rt)){Kr(Pe,ym(void 0));return}}else{if(Gg(rt))if(We.delete(Pe),jt>Fe){Kr(Pe,ym(void 0));return}else return Ce.add(Pe),Kr(Pe,Cv(kn)),ws(ue,rt,!1,{fetcherSubmission:kn,preventScrollReset:pn});if(Wu(rt)){Qa(Pe,zt,rt.error);return}}let Je=ke.navigation.location||ke.location,ot=sy(o.history,Je,ie.signal),Rt=i||S,St=ke.navigation.state!=="idle"?jp(Rt,ke.navigation.location,M):ke.matches;nr(St,"Didn't find any matches after fetcher action");let ci=++Et;Gi.set(Pe,ci);let Oi=Cv(kn,rt.data);ke.fetchers.set(Pe,Oi);let{dsMatches:mi,revalidatingFetchers:tn}=Uk(ot,ui,p,x,o.history,ke,St,kn,Je,h,!1,Vi,Ri,Ct,_t,Ce,Rt,M,o.patchRoutesOnNavigation!=null,[Te.route.id,rt]);tn.filter(Yn=>Yn.key!==Pe).forEach(Yn=>{let fn=Yn.key,an=ke.fetchers.get(fn),ea=Cv(void 0,an?an.data:void 0);ke.fetchers.set(fn,ea),Hs(fn),Yn.controller&&We.set(fn,Yn.controller)}),On({fetchers:new Map(ke.fetchers)});let rn=()=>tn.forEach(Yn=>Hs(Yn.key));ie.signal.addEventListener("abort",rn);let{loaderResults:Zi,fetcherResults:Ui}=await Vr(mi,tn,ot,ui);if(ie.signal.aborted)return;if(ie.signal.removeEventListener("abort",rn),Gi.delete(Pe),We.delete(Pe),tn.forEach(Yn=>We.delete(Yn.key)),ke.fetchers.has(Pe)){let Yn=ym(rt.data);ke.fetchers.set(Pe,Yn)}let $n=S0(Zi);if($n)return ws(ot,$n.result,!1,{preventScrollReset:pn});if($n=S0(Ui),$n)return Ce.add($n.key),ws(ot,$n.result,!1,{preventScrollReset:pn});let{loaderData:Ia,errors:Ta}=Zk(ke,St,Zi,void 0,tn,Ui);zr(ci),ke.navigation.state==="loading"&&ci>jt?(nr(tt,"Expected pending action"),lt&&lt.abort(),Ja(ke.navigation.location,{matches:St,loaderData:Ia,errors:Ta,fetchers:new Map(ke.fetchers)})):(On({errors:Ta,loaderData:Xk(ke.loaderData,Ia,St,Ta),fetchers:new Map(ke.fetchers)}),Vi=!1)}async function $s(Pe,zt,Qt,Ei,ui,qi,Si,pn,kn){let Ze=ke.fetchers.get(Pe);Kr(Pe,Cv(kn,Ze?Ze.data:void 0),{flushSync:Si});let ie=new AbortController,ue=sy(o.history,Qt,ie.signal);if(qi){let Je=await jo(Ei,new URL(ue.url).pathname,ue.signal,Pe);if(Je.type==="aborted")return;if(Je.type==="error"){Qa(Pe,zt,Je.error,{flushSync:Si});return}else if(Je.matches)Ei=Je.matches;else{Qa(Pe,zt,Dd(404,{pathname:Qt}),{flushSync:Si});return}}let Te=eb(Ei,Qt);We.set(Pe,ie);let Fe=Et,Be=uy(p,x,ue,Ei,Te,h,ui),rt=(await Vs(ue,Be,ui,Pe))[Te.route.id];if(We.get(Pe)===ie&&We.delete(Pe),!ue.signal.aborted){if(Ct.has(Pe)){Kr(Pe,ym(void 0));return}if(Gg(rt))if(jt>Fe){Kr(Pe,ym(void 0));return}else{Ce.add(Pe),await ws(ue,rt,!1,{preventScrollReset:pn});return}if(Wu(rt)){Qa(Pe,zt,rt.error);return}Kr(Pe,ym(rt.data))}}async function ws(Pe,zt,Qt,{submission:Ei,fetcherSubmission:ui,preventScrollReset:qi,replace:Si}={}){zt.response.headers.has("X-Remix-Revalidate")&&(Vi=!0);let pn=zt.response.headers.get("Location");nr(pn,"Expected a Location header on the redirect Response"),pn=qk(pn,new URL(Pe.url),M);let kn=Jv(ke.location,pn,{_isRedirect:!0});if(c){let Be=!1;if(zt.response.headers.has("X-Remix-Reload-Document"))Be=!0;else if(cS(pn)){const qe=AC(pn,!0);Be=qe.origin!==r.location.origin||Ld(qe.pathname,M)==null}if(Be){Si?r.location.replace(pn):r.location.assign(pn);return}}lt=null;let Ze=Si===!0||zt.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:ie,formAction:ue,formEncType:Te}=ke.navigation;!Ei&&!ui&&ie&&ue&&Te&&(Ei=Jk(ke.navigation));let Fe=Ei||ui;if(LR.has(zt.response.status)&&Fe&&yu(Fe.formMethod))await nn(Ze,kn,{submission:{...Fe,formAction:pn},preventScrollReset:qi||Ke,enableViewTransition:Qt?ft:void 0});else{let Be=t1(kn,Ei);await nn(Ze,kn,{overrideNavigation:Be,fetcherSubmission:ui,preventScrollReset:qi||Ke,enableViewTransition:Qt?ft:void 0})}}async function Vs(Pe,zt,Qt,Ei){let ui,qi={};try{ui=await WR(P,Pe,zt,Ei,Qt,!1)}catch(Si){return zt.filter(pn=>pn.shouldLoad).forEach(pn=>{qi[pn.route.id]={type:"error",error:Si}}),qi}if(Pe.signal.aborted)return qi;for(let[Si,pn]of Object.entries(ui))if(iD(pn)){let kn=pn.result;qi[Si]={type:"redirect",response:KR(kn,Pe,Si,zt,M)}}else qi[Si]=await YR(pn);return qi}async function Vr(Pe,zt,Qt,Ei){let ui=Vs(Qt,Pe,Ei,null),qi=Promise.all(zt.map(async kn=>{if(kn.matches&&kn.match&&kn.request&&kn.controller){let ie=(await Vs(kn.request,kn.matches,Ei,kn.key))[kn.match.route.id];return{[kn.key]:ie}}else return Promise.resolve({[kn.key]:{type:"error",error:Dd(404,{pathname:kn.path})}})})),Si=await ui,pn=(await qi).reduce((kn,Ze)=>Object.assign(kn,Ze),{});return{loaderResults:Si,fetcherResults:pn}}function Xo(){Vi=!0,_t.forEach((Pe,zt)=>{We.has(zt)&&Ri.add(zt),Hs(zt)})}function Kr(Pe,zt,Qt={}){ke.fetchers.set(Pe,zt),On({fetchers:new Map(ke.fetchers)},{flushSync:(Qt&&Qt.flushSync)===!0})}function Qa(Pe,zt,Qt,Ei={}){let ui=zp(ke.matches,zt);ul(Pe),On({errors:{[ui.route.id]:Qt},fetchers:new Map(ke.fetchers)},{flushSync:(Ei&&Ei.flushSync)===!0})}function us(Pe){return At.set(Pe,(At.get(Pe)||0)+1),Ct.has(Pe)&&Ct.delete(Pe),ke.fetchers.get(Pe)||OR}function mr(Pe,zt){Hs(Pe,zt?.reason),Kr(Pe,ym(null))}function ul(Pe){let zt=ke.fetchers.get(Pe);We.has(Pe)&&!(zt&&zt.state==="loading"&&Gi.has(Pe))&&Hs(Pe),_t.delete(Pe),Gi.delete(Pe),Ce.delete(Pe),Ct.delete(Pe),Ri.delete(Pe),ke.fetchers.delete(Pe)}function Jl(Pe){let zt=(At.get(Pe)||0)-1;zt<=0?(At.delete(Pe),Ct.add(Pe)):At.set(Pe,zt),On({fetchers:new Map(ke.fetchers)})}function Hs(Pe,zt){let Qt=We.get(Pe);Qt&&(Qt.abort(zt),We.delete(Pe))}function Yo(Pe){for(let zt of Pe){let Qt=us(zt),Ei=ym(Qt.data);ke.fetchers.set(zt,Ei)}}function yr(){let Pe=[],zt=!1;for(let Qt of Ce){let Ei=ke.fetchers.get(Qt);nr(Ei,`Expected fetcher: ${Qt}`),Ei.state==="loading"&&(Ce.delete(Qt),Pe.push(Qt),zt=!0)}return Yo(Pe),zt}function zr(Pe){let zt=[];for(let[Qt,Ei]of Gi)if(Ei<Pe){let ui=ke.fetchers.get(Qt);nr(ui,`Expected fetcher: ${Qt}`),ui.state==="loading"&&(Hs(Qt),Gi.delete(Qt),zt.push(Qt))}return Yo(zt),zt.length>0}function Ql(Pe,zt){let Qt=ke.blockers.get(Pe)||Av;return oi.get(Pe)!==zt&&oi.set(Pe,zt),Qt}function Ss(Pe){ke.blockers.delete(Pe),oi.delete(Pe)}function mo(Pe,zt){let Qt=ke.blockers.get(Pe)||Av;nr(Qt.state==="unblocked"&&zt.state==="blocked"||Qt.state==="blocked"&&zt.state==="blocked"||Qt.state==="blocked"&&zt.state==="proceeding"||Qt.state==="blocked"&&zt.state==="unblocked"||Qt.state==="proceeding"&&zt.state==="unblocked",`Invalid blocker state transition: ${Qt.state} -> ${zt.state}`);let Ei=new Map(ke.blockers);Ei.set(Pe,zt),On({blockers:Ei})}function Ko({currentLocation:Pe,nextLocation:zt,historyAction:Qt}){if(oi.size===0)return;oi.size>1&&qo(!1,"A router only supports one blocker at a time");let Ei=Array.from(oi.entries()),[ui,qi]=Ei[Ei.length-1],Si=ke.blockers.get(ui);if(!(Si&&Si.state==="proceeding")&&qi({currentLocation:Pe,nextLocation:zt,historyAction:Qt}))return ui}function Gs(Pe){let zt=Dd(404,{pathname:Pe}),Qt=i||S,{matches:Ei,route:ui}=w0(Qt);return{notFoundMatches:Ei,route:ui,error:zt}}function ec(Pe,zt,Qt){if(K=Pe,ae=zt,re=Qt||null,!ce&&ke.navigation===e1){ce=!0;let Ei=Fr(ke.location,ke.matches);Ei!=null&&On({restoreScrollPosition:Ei})}return()=>{K=null,ae=null,re=null}}function po(Pe,zt){return re&&re(Pe,zt.map(Ei=>fR(Ei,ke.loaderData)))||Pe.key}function qa(Pe,zt){if(K&&ae){let Qt=po(Pe,zt);K[Qt]=ae()}}function Fr(Pe,zt){if(K){let Qt=po(Pe,zt),Ei=K[Qt];if(typeof Ei=="number")return Ei}return null}function tc(Pe,zt,Qt){if(o.patchRoutesOnNavigation)if(Pe){if(Object.keys(Pe[0].params).length>0)return{active:!0,matches:Q0(zt,Qt,M,!0)}}else return{active:!0,matches:Q0(zt,Qt,M,!0)||[]};return{active:!1,matches:null}}async function jo(Pe,zt,Qt,Ei){if(!o.patchRoutesOnNavigation)return{type:"success",matches:Pe};let ui=Pe;for(;;){let qi=i==null,Si=i||S,pn=x;try{await o.patchRoutesOnNavigation({signal:Qt,path:zt,matches:ui,fetcherKey:Ei,patch:(ie,ue)=>{Qt.aborted||$k(ie,ue,Si,pn,p,!1)}})}catch(ie){return{type:"error",error:ie,partialMatches:ui}}finally{qi&&!Qt.aborted&&(S=[...S])}if(Qt.aborted)return{type:"aborted"};let kn=jp(Si,zt,M);if(kn)return{type:"success",matches:kn};let Ze=Q0(Si,zt,M,!0);if(!Ze||ui.length===Ze.length&&ui.every((ie,ue)=>ie.route.id===Ze[ue].route.id))return{type:"success",matches:null};ui=Ze}}function go(Pe){x={},i=Qv(Pe,p,void 0,x)}function wu(Pe,zt,Qt=!1){let Ei=i==null;$k(Pe,zt,i||S,x,p,Qt),Ei&&(S=[...S],On({}))}return He={get basename(){return M},get future(){return N},get state(){return ke},get routes(){return S},get window(){return r},initialize:Ba,subscribe:qn,enableScrollRestoration:ec,navigate:Qi,fetch:$c,revalidate:Fi,createHref:Pe=>o.history.createHref(Pe),encodeLocation:Pe=>o.history.encodeLocation(Pe),getFetcher:us,resetFetcher:mr,deleteFetcher:Jl,dispose:Un,getBlocker:Ql,deleteBlocker:Ss,patchRoutes:wu,_internalFetchControllers:We,_internalSetRoutes:go,_internalSetStateDoNotUseOrYouWillBreakYourApp(Pe){On(Pe)}},He}function UR(o){return o!=null&&("formData"in o&&o.formData!=null||"body"in o&&o.body!==void 0)}function O1(o,r,c,h,p,x){let S,i;if(p){S=[];for(let P of r)if(S.push(P),P.route.id===p){i=P;break}}else S=r,i=r[r.length-1];let M=lS(h||".",oS(S),Ld(o.pathname,c)||o.pathname,x==="path");if(h==null&&(M.search=o.search,M.hash=o.hash),(h==null||h===""||h===".")&&i){let P=dS(M.search);if(i.route.index&&!P)M.search=M.search?M.search.replace(/^\?/,"?index&"):"?index";else if(!i.route.index&&P){let N=new URLSearchParams(M.search),H=N.getAll("index");N.delete("index"),H.filter(K=>K).forEach(K=>N.append("index",K));let W=N.toString();M.search=W?`?${W}`:""}}return c!=="/"&&(M.pathname=ER({basename:c,pathname:M.pathname})),$p(M)}function Bk(o,r,c){if(!c||!UR(c))return{path:r};if(c.formMethod&&!nD(c.formMethod))return{path:r,error:Dd(405,{method:c.formMethod})};let h=()=>({path:r,error:Dd(400,{type:"invalid-body"})}),x=(c.formMethod||"get").toUpperCase(),S=FC(r);if(c.body!==void 0){if(c.formEncType==="text/plain"){if(!yu(x))return h();let H=typeof c.body=="string"?c.body:c.body instanceof FormData||c.body instanceof URLSearchParams?Array.from(c.body.entries()).reduce((W,[K,re])=>`${W}${K}=${re}
`,""):String(c.body);return{path:r,submission:{formMethod:x,formAction:S,formEncType:c.formEncType,formData:void 0,json:void 0,text:H}}}else if(c.formEncType==="application/json"){if(!yu(x))return h();try{let H=typeof c.body=="string"?JSON.parse(c.body):c.body;return{path:r,submission:{formMethod:x,formAction:S,formEncType:c.formEncType,formData:void 0,json:H,text:void 0}}}catch{return h()}}}nr(typeof FormData=="function","FormData is not available in this environment");let i,M;if(c.formData)i=B1(c.formData),M=c.formData;else if(c.body instanceof FormData)i=B1(c.body),M=c.body;else if(c.body instanceof URLSearchParams)i=c.body,M=Wk(i);else if(c.body==null)i=new URLSearchParams,M=new FormData;else try{i=new URLSearchParams(c.body),M=Wk(i)}catch{return h()}let P={formMethod:x,formAction:S,formEncType:c&&c.formEncType||"application/x-www-form-urlencoded",formData:M,json:void 0,text:void 0};if(yu(P.formMethod))return{path:r,submission:P};let N=Gp(r);return o&&N.search&&dS(N.search)&&i.append("index",""),N.search=`?${i}`,{path:$p(N),submission:P}}function Uk(o,r,c,h,p,x,S,i,M,P,N,H,W,K,re,ae,ce,ve,Se,Ee){let Qe=Ee?Wu(Ee[1])?Ee[1].error:Ee[1].data:void 0,He=p.createURL(x.location),ke=p.createURL(M),tt;if(N&&x.errors){let Ft=Object.keys(x.errors)[0];tt=S.findIndex(Vi=>Vi.route.id===Ft)}else if(Ee&&Wu(Ee[1])){let Ft=Ee[0];tt=S.findIndex(Vi=>Vi.route.id===Ft)-1}let Ke=Ee?Ee[1].statusCode:void 0,lt=Ke&&Ke>=400,ft={currentUrl:He,currentParams:x.matches[0]?.params||{},nextUrl:ke,nextParams:S[0].params,...i,actionResult:Qe,actionStatus:Ke},gt=S.map((Ft,Vi)=>{let{route:Ri}=Ft,We=null;if(tt!=null&&Vi>tt?We=!1:Ri.lazy?We=!0:uS(Ri)?N?We=N1(Ri,x.loaderData,x.errors):$R(x.loaderData,x.matches[Vi],Ft)&&(We=!0):We=!1,We!==null)return F1(c,h,o,Ft,P,r,We);let Et=lt?!1:H||He.pathname+He.search===ke.pathname+ke.search||He.search!==ke.search||VR(x.matches[Vi],Ft),jt={...ft,defaultShouldRevalidate:Et},Gi=db(Ft,jt);return F1(c,h,o,Ft,P,r,Gi,jt)}),ni=[];return re.forEach((Ft,Vi)=>{if(N||!S.some(At=>At.route.id===Ft.routeId)||K.has(Vi))return;let Ri=x.fetchers.get(Vi),We=Ri&&Ri.state!=="idle"&&Ri.data===void 0,Et=jp(ce,Ft.path,ve);if(!Et){if(Se&&We)return;ni.push({key:Vi,routeId:Ft.routeId,path:Ft.path,matches:null,match:null,request:null,controller:null});return}if(ae.has(Vi))return;let jt=eb(Et,Ft.path),Gi=new AbortController,Ce=sy(p,Ft.path,Gi.signal),_t=null;if(W.has(Vi))W.delete(Vi),_t=uy(c,h,Ce,Et,jt,P,r);else if(We)H&&(_t=uy(c,h,Ce,Et,jt,P,r));else{let At={...ft,defaultShouldRevalidate:lt?!1:H};db(jt,At)&&(_t=uy(c,h,Ce,Et,jt,P,r,At))}_t&&ni.push({key:Vi,routeId:Ft.routeId,path:Ft.path,matches:_t,match:jt,request:Ce,controller:Gi})}),{dsMatches:gt,revalidatingFetchers:ni}}function uS(o){return o.loader!=null||o.middleware!=null&&o.middleware.length>0}function N1(o,r,c){if(o.lazy)return!0;if(!uS(o))return!1;let h=r!=null&&o.id in r,p=c!=null&&c[o.id]!==void 0;return!h&&p?!1:typeof o.loader=="function"&&o.loader.hydrate===!0?!0:!h&&!p}function $R(o,r,c){let h=!r||c.route.id!==r.route.id,p=!o.hasOwnProperty(c.route.id);return h||p}function VR(o,r){let c=o.route.path;return o.pathname!==r.pathname||c!=null&&c.endsWith("*")&&o.params["*"]!==r.params["*"]}function db(o,r){if(o.route.shouldRevalidate){let c=o.route.shouldRevalidate(r);if(typeof c=="boolean")return c}return r.defaultShouldRevalidate}function $k(o,r,c,h,p,x){let S;if(o){let P=h[o];nr(P,`No route found to patch children into: routeId = ${o}`),P.children||(P.children=[]),S=P.children}else S=c;let i=[],M=[];if(r.forEach(P=>{let N=S.find(H=>RC(P,H));N?M.push({existingRoute:N,newRoute:P}):i.push(P)}),i.length>0){let P=Qv(i,p,[o||"_","patch",String(S?.length||"0")],h);S.push(...P)}if(x&&M.length>0)for(let P=0;P<M.length;P++){let{existingRoute:N,newRoute:H}=M[P],W=N,[K]=Qv([H],p,[],{},!0);Object.assign(W,{element:K.element?K.element:W.element,errorElement:K.errorElement?K.errorElement:W.errorElement,hydrateFallbackElement:K.hydrateFallbackElement?K.hydrateFallbackElement:W.hydrateFallbackElement})}}function RC(o,r){return"id"in o&&"id"in r&&o.id===r.id?!0:o.index===r.index&&o.path===r.path&&o.caseSensitive===r.caseSensitive?(!o.children||o.children.length===0)&&(!r.children||r.children.length===0)?!0:o.children.every((c,h)=>r.children?.some(p=>RC(c,p))):!1}var Vk=new WeakMap,DC=({key:o,route:r,manifest:c,mapRouteProperties:h})=>{let p=c[r.id];if(nr(p,"No route found in manifest"),!p.lazy||typeof p.lazy!="object")return;let x=p.lazy[o];if(!x)return;let S=Vk.get(p);S||(S={},Vk.set(p,S));let i=S[o];if(i)return i;let M=(async()=>{let P=cR(o),H=p[o]!==void 0&&o!=="hasErrorBoundary";if(P)qo(!P,"Route property "+o+" is not a supported lazy route property. This property will be ignored."),S[o]=Promise.resolve();else if(H)qo(!1,`Route "${p.id}" has a static property "${o}" defined. The lazy property will be ignored.`);else{let W=await x();W!=null&&(Object.assign(p,{[o]:W}),Object.assign(p,h(p)))}typeof p.lazy=="object"&&(p.lazy[o]=void 0,Object.values(p.lazy).every(W=>W===void 0)&&(p.lazy=void 0))})();return S[o]=M,M},Hk=new WeakMap;function HR(o,r,c,h,p){let x=c[o.id];if(nr(x,"No route found in manifest"),!o.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof o.lazy=="function"){let N=Hk.get(x);if(N)return{lazyRoutePromise:N,lazyHandlerPromise:N};let H=(async()=>{nr(typeof o.lazy=="function","No lazy route function found");let W=await o.lazy(),K={};for(let re in W){let ae=W[re];if(ae===void 0)continue;let ce=dR(re),Se=x[re]!==void 0&&re!=="hasErrorBoundary";ce?qo(!ce,"Route property "+re+" is not a supported property to be returned from a lazy route function. This property will be ignored."):Se?qo(!Se,`Route "${x.id}" has a static property "${re}" defined but its lazy function is also returning a value for this property. The lazy route property "${re}" will be ignored.`):K[re]=ae}Object.assign(x,K),Object.assign(x,{...h(x),lazy:void 0})})();return Hk.set(x,H),H.catch(()=>{}),{lazyRoutePromise:H,lazyHandlerPromise:H}}let S=Object.keys(o.lazy),i=[],M;for(let N of S){if(p&&p.includes(N))continue;let H=DC({key:N,route:o,manifest:c,mapRouteProperties:h});H&&(i.push(H),N===r&&(M=H))}let P=i.length>0?Promise.all(i).then(()=>{}):void 0;return P?.catch(()=>{}),M?.catch(()=>{}),{lazyRoutePromise:P,lazyHandlerPromise:M}}async function Gk(o){let r=o.matches.filter(p=>p.shouldLoad),c={};return(await Promise.all(r.map(p=>p.resolve()))).forEach((p,x)=>{c[r[x].route.id]=p}),c}async function GR(o){return o.matches.some(r=>r.route.middleware)?LC(o,()=>Gk(o)):Gk(o)}function LC(o,r){return qR(o,r,h=>h,eD,c);function c(h,p,x){if(x)return Promise.resolve(Object.assign(x.value,{[p]:{type:"error",result:h}}));{let{matches:S}=o,i=Math.min(Math.max(S.findIndex(P=>P.route.id===p),0),Math.max(S.findIndex(P=>P.unstable_shouldCallHandler()),0)),M=zp(S,S[i].route.id).route.id;return Promise.resolve({[M]:{type:"error",result:h}})}}}async function qR(o,r,c,h,p){let{matches:x,request:S,params:i,context:M}=o,P=x.flatMap(H=>H.route.middleware?H.route.middleware.map(W=>[H.route.id,W]):[]);return await OC({request:S,params:i,context:M},P,r,c,h,p)}async function OC(o,r,c,h,p,x,S=0){let{request:i}=o;if(i.signal.aborted)throw i.signal.reason??new Error(`Request aborted: ${i.method} ${i.url}`);let M=r[S];if(!M)return await c();let[P,N]=M,H,W=async()=>{if(H)throw new Error("You may only call `next()` once per middleware");try{return H={value:await OC(o,r,c,h,p,x,S+1)},H.value}catch(K){return H={value:await x(K,P,H)},H.value}};try{let K=await N(o,W),re=K!=null?h(K):void 0;return p(re)?re:H?re??H.value:(H={value:await W()},H.value)}catch(K){return await x(K,P,H)}}function NC(o,r,c,h,p){let x=DC({key:"middleware",route:h.route,manifest:r,mapRouteProperties:o}),S=HR(h.route,yu(c.method)?"action":"loader",r,o,p);return{middleware:x,route:S.lazyRoutePromise,handler:S.lazyHandlerPromise}}function F1(o,r,c,h,p,x,S,i=null){let M=!1,P=NC(o,r,c,h,p);return{...h,_lazyPromises:P,shouldLoad:S,unstable_shouldRevalidateArgs:i,unstable_shouldCallHandler(N){return M=!0,i?typeof N=="boolean"?db(h,{...i,defaultShouldRevalidate:N}):db(h,i):S},resolve(N){let{lazy:H,loader:W,middleware:K}=h.route,re=M||S||N&&!yu(c.method)&&(H||W),ae=K&&K.length>0&&!W&&!H;return re&&!ae?ZR({request:c,match:h,lazyHandlerPromise:P?.handler,lazyRoutePromise:P?.route,handlerOverride:N,scopedContext:x}):Promise.resolve({type:"data",result:void 0})}}}function uy(o,r,c,h,p,x,S,i=null){return h.map(M=>M.route.id!==p.route.id?{...M,shouldLoad:!1,unstable_shouldRevalidateArgs:i,unstable_shouldCallHandler:()=>!1,_lazyPromises:NC(o,r,c,M,x),resolve:()=>Promise.resolve({type:"data",result:void 0})}:F1(o,r,c,M,x,S,!0,i))}async function WR(o,r,c,h,p,x){c.some(P=>P._lazyPromises?.middleware)&&await Promise.all(c.map(P=>P._lazyPromises?.middleware));let S={request:r,params:c[0].params,context:p,matches:c},M=await o({...S,fetcherKey:h,runClientMiddleware:P=>{let N=S;return LC(N,()=>P({...N,fetcherKey:h,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(c.flatMap(P=>[P._lazyPromises?.handler,P._lazyPromises?.route]))}catch{}return M}async function ZR({request:o,match:r,lazyHandlerPromise:c,lazyRoutePromise:h,handlerOverride:p,scopedContext:x}){let S,i,M=yu(o.method),P=M?"action":"loader",N=H=>{let W,K=new Promise((ce,ve)=>W=ve);i=()=>W(),o.signal.addEventListener("abort",i);let re=ce=>typeof H!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${P}" [routeId: ${r.route.id}]`)):H({request:o,params:r.params,context:x},...ce!==void 0?[ce]:[]),ae=(async()=>{try{return{type:"data",result:await(p?p(ve=>re(ve)):re())}}catch(ce){return{type:"error",result:ce}}})();return Promise.race([ae,K])};try{let H=M?r.route.action:r.route.loader;if(c||h)if(H){let W,[K]=await Promise.all([N(H).catch(re=>{W=re}),c,h]);if(W!==void 0)throw W;S=K}else{await c;let W=M?r.route.action:r.route.loader;if(W)[S]=await Promise.all([N(W),h]);else if(P==="action"){let K=new URL(o.url),re=K.pathname+K.search;throw Dd(405,{method:o.method,pathname:re,routeId:r.route.id})}else return{type:"data",result:void 0}}else if(H)S=await N(H);else{let W=new URL(o.url),K=W.pathname+W.search;throw Dd(404,{pathname:K})}}catch(H){return{type:"error",result:H}}finally{i&&o.signal.removeEventListener("abort",i)}return S}async function XR(o){let r=o.headers.get("Content-Type");return r&&/\bapplication\/json\b/.test(r)?o.body==null?null:o.json():o.text()}async function YR(o){let{result:r,type:c}=o;if(BC(r)){let h;try{h=await XR(r)}catch(p){return{type:"error",error:p}}return c==="error"?{type:"error",error:new ub(r.status,r.statusText,h),statusCode:r.status,headers:r.headers}:{type:"data",data:h,statusCode:r.status,headers:r.headers}}return c==="error"?Kk(r)?r.data instanceof Error?{type:"error",error:r.data,statusCode:r.init?.status,headers:r.init?.headers?new Headers(r.init.headers):void 0}:{type:"error",error:new ub(r.init?.status||500,void 0,r.data),statusCode:ex(r)?r.status:void 0,headers:r.init?.headers?new Headers(r.init.headers):void 0}:{type:"error",error:r,statusCode:ex(r)?r.status:void 0}:Kk(r)?{type:"data",data:r.data,statusCode:r.init?.status,headers:r.init?.headers?new Headers(r.init.headers):void 0}:{type:"data",data:r}}function KR(o,r,c,h,p){let x=o.headers.get("Location");if(nr(x,"Redirects returned/thrown from loaders/actions must have a Location header"),!cS(x)){let S=h.slice(0,h.findIndex(i=>i.route.id===c)+1);x=O1(new URL(r.url),S,p,x),o.headers.set("Location",x)}return o}function qk(o,r,c){if(cS(o)){let h=o,p=h.startsWith("//")?new URL(r.protocol+h):new URL(h),x=Ld(p.pathname,c)!=null;if(p.origin===r.origin&&x)return p.pathname+p.search+p.hash}return o}function sy(o,r,c,h){let p=o.createURL(FC(r)).toString(),x={signal:c};if(h&&yu(h.formMethod)){let{formMethod:S,formEncType:i}=h;x.method=S.toUpperCase(),i==="application/json"?(x.headers=new Headers({"Content-Type":i}),x.body=JSON.stringify(h.json)):i==="text/plain"?x.body=h.text:i==="application/x-www-form-urlencoded"&&h.formData?x.body=B1(h.formData):x.body=h.formData}return new Request(p,x)}function B1(o){let r=new URLSearchParams;for(let[c,h]of o.entries())r.append(c,typeof h=="string"?h:h.name);return r}function Wk(o){let r=new FormData;for(let[c,h]of o.entries())r.append(c,h);return r}function JR(o,r,c,h=!1,p=!1){let x={},S=null,i,M=!1,P={},N=c&&Wu(c[1])?c[1].error:void 0;return o.forEach(H=>{if(!(H.route.id in r))return;let W=H.route.id,K=r[W];if(nr(!Gg(K),"Cannot handle redirect results in processLoaderData"),Wu(K)){let re=K.error;if(N!==void 0&&(re=N,N=void 0),S=S||{},p)S[W]=re;else{let ae=zp(o,W);S[ae.route.id]==null&&(S[ae.route.id]=re)}h||(x[W]=IC),M||(M=!0,i=ex(K.error)?K.error.status:500),K.headers&&(P[W]=K.headers)}else x[W]=K.data,K.statusCode&&K.statusCode!==200&&!M&&(i=K.statusCode),K.headers&&(P[W]=K.headers)}),N!==void 0&&c&&(S={[c[0]]:N},c[2]&&(x[c[2]]=void 0)),{loaderData:x,errors:S,statusCode:i||200,loaderHeaders:P}}function Zk(o,r,c,h,p,x){let{loaderData:S,errors:i}=JR(r,c,h);return p.filter(M=>!M.matches||M.matches.some(P=>P.shouldLoad)).forEach(M=>{let{key:P,match:N,controller:H}=M;if(H&&H.signal.aborted)return;let W=x[P];if(nr(W,"Did not find corresponding fetcher result"),Wu(W)){let K=zp(o.matches,N?.route.id);i&&i[K.route.id]||(i={...i,[K.route.id]:W.error}),o.fetchers.delete(P)}else if(Gg(W))nr(!1,"Unhandled fetcher revalidation redirect");else{let K=ym(W.data);o.fetchers.set(P,K)}}),{loaderData:S,errors:i}}function Xk(o,r,c,h){let p=Object.entries(r).filter(([,x])=>x!==IC).reduce((x,[S,i])=>(x[S]=i,x),{});for(let x of c){let S=x.route.id;if(!r.hasOwnProperty(S)&&o.hasOwnProperty(S)&&x.route.loader&&(p[S]=o[S]),h&&h.hasOwnProperty(S))break}return p}function Yk(o){return o?Wu(o[1])?{actionData:{}}:{actionData:{[o[0]]:o[1].data}}:{}}function zp(o,r){return(r?o.slice(0,o.findIndex(h=>h.route.id===r)+1):[...o]).reverse().find(h=>h.route.hasErrorBoundary===!0)||o[0]}function w0(o){let r=o.length===1?o[0]:o.find(c=>c.index||!c.path||c.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:r}],route:r}}function Dd(o,{pathname:r,routeId:c,method:h,type:p,message:x}={}){let S="Unknown Server Error",i="Unknown @remix-run/router error";return o===400?(S="Bad Request",h&&r&&c?i=`You made a ${h} request to "${r}" but did not provide a \`loader\` for route "${c}", so there is no way to handle the request.`:p==="invalid-body"&&(i="Unable to encode submission body")):o===403?(S="Forbidden",i=`Route "${c}" does not match URL "${r}"`):o===404?(S="Not Found",i=`No route matches URL "${r}"`):o===405&&(S="Method Not Allowed",h&&r&&c?i=`You made a ${h.toUpperCase()} request to "${r}" but did not provide an \`action\` for route "${c}", so there is no way to handle the request.`:h&&(i=`Invalid request method "${h.toUpperCase()}"`)),new ub(o||500,S,new Error(i),!0)}function S0(o){let r=Object.entries(o);for(let c=r.length-1;c>=0;c--){let[h,p]=r[c];if(Gg(p))return{key:h,result:p}}}function FC(o){let r=typeof o=="string"?Gp(o):o;return $p({...r,hash:""})}function QR(o,r){return o.pathname!==r.pathname||o.search!==r.search?!1:o.hash===""?r.hash!=="":o.hash===r.hash?!0:r.hash!==""}function eD(o){return o!=null&&typeof o=="object"&&Object.entries(o).every(([r,c])=>typeof r=="string"&&tD(c))}function tD(o){return o!=null&&typeof o=="object"&&"type"in o&&"result"in o&&(o.type==="data"||o.type==="error")}function iD(o){return BC(o.result)&&DR.has(o.result.status)}function Wu(o){return o.type==="error"}function Gg(o){return(o&&o.type)==="redirect"}function Kk(o){return typeof o=="object"&&o!=null&&"type"in o&&"data"in o&&"init"in o&&o.type==="DataWithResponseInit"}function BC(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.headers=="object"&&typeof o.body<"u"}function nD(o){return RR.has(o.toUpperCase())}function yu(o){return zR.has(o.toUpperCase())}function dS(o){return new URLSearchParams(o).getAll("index").some(r=>r==="")}function eb(o,r){let c=typeof r=="string"?Gp(r).search:r.search;if(o[o.length-1].route.index&&dS(c||""))return o[o.length-1];let h=PC(o);return h[h.length-1]}function Jk(o){let{formMethod:r,formAction:c,formEncType:h,text:p,formData:x,json:S}=o;if(!(!r||!c||!h)){if(p!=null)return{formMethod:r,formAction:c,formEncType:h,formData:void 0,json:void 0,text:p};if(x!=null)return{formMethod:r,formAction:c,formEncType:h,formData:x,json:void 0,text:void 0};if(S!==void 0)return{formMethod:r,formAction:c,formEncType:h,formData:void 0,json:S,text:void 0}}}function t1(o,r){return r?{state:"loading",location:o,formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text}:{state:"loading",location:o,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function aD(o,r){return{state:"submitting",location:o,formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text}}function Cv(o,r){return o?{state:"loading",formMethod:o.formMethod,formAction:o.formAction,formEncType:o.formEncType,formData:o.formData,json:o.json,text:o.text,data:r}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:r}}function rD(o,r){return{state:"submitting",formMethod:o.formMethod,formAction:o.formAction,formEncType:o.formEncType,formData:o.formData,json:o.json,text:o.text,data:r?r.data:void 0}}function ym(o){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:o}}function sD(o,r){try{let c=o.sessionStorage.getItem(zC);if(c){let h=JSON.parse(c);for(let[p,x]of Object.entries(h||{}))x&&Array.isArray(x)&&r.set(p,new Set(x||[]))}}catch{}}function oD(o,r){if(r.size>0){let c={};for(let[h,p]of r)c[h]=[...p];try{o.sessionStorage.setItem(zC,JSON.stringify(c))}catch(h){qo(!1,`Failed to save applied view transitions in sessionStorage (${h}).`)}}}function lD(){let o,r,c=new Promise((h,p)=>{o=async x=>{h(x);try{await c}catch{}},r=async x=>{p(x);try{await c}catch{}}});return{promise:c,resolve:o,reject:r}}var Kg=ye.createContext(null);Kg.displayName="DataRouter";var ux=ye.createContext(null);ux.displayName="DataRouterState";ye.createContext(!1);var hS=ye.createContext({isTransitioning:!1});hS.displayName="ViewTransition";var UC=ye.createContext(new Map);UC.displayName="Fetchers";var cD=ye.createContext(null);cD.displayName="Await";var xf=ye.createContext(null);xf.displayName="Navigation";var Mb=ye.createContext(null);Mb.displayName="Location";var Th=ye.createContext({outlet:null,matches:[],isDataRoute:!1});Th.displayName="Route";var fS=ye.createContext(null);fS.displayName="RouteError";function uD(o,{relative:r}={}){nr(dx(),"useHref() may be used only in the context of a <Router> component.");let{basename:c,navigator:h}=ye.useContext(xf),{hash:p,pathname:x,search:S}=hx(o,{relative:r}),i=x;return c!=="/"&&(i=x==="/"?c:vf([c,x])),h.createHref({pathname:i,search:S,hash:p})}function dx(){return ye.useContext(Mb)!=null}function Uc(){return nr(dx(),"useLocation() may be used only in the context of a <Router> component."),ye.useContext(Mb).location}var $C="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function VC(o){ye.useContext(xf).static||ye.useLayoutEffect(o)}function $a(){let{isDataRoute:o}=ye.useContext(Th);return o?kD():dD()}function dD(){nr(dx(),"useNavigate() may be used only in the context of a <Router> component.");let o=ye.useContext(Kg),{basename:r,navigator:c}=ye.useContext(xf),{matches:h}=ye.useContext(Th),{pathname:p}=Uc(),x=JSON.stringify(oS(h)),S=ye.useRef(!1);return VC(()=>{S.current=!0}),ye.useCallback((M,P={})=>{if(qo(S.current,$C),!S.current)return;if(typeof M=="number"){c.go(M);return}let N=lS(M,JSON.parse(x),p,P.relative==="path");o==null&&r!=="/"&&(N.pathname=N.pathname==="/"?r:vf([r,N.pathname])),(P.replace?c.replace:c.push)(N,P.state,P)},[r,c,x,p,o])}var hD=ye.createContext(null);function fD(o){let r=ye.useContext(Th).outlet;return ye.useMemo(()=>r&&ye.createElement(hD.Provider,{value:o},r),[r,o])}function cl(){let{matches:o}=ye.useContext(Th),r=o[o.length-1];return r?r.params:{}}function hx(o,{relative:r}={}){let{matches:c}=ye.useContext(Th),{pathname:h}=Uc(),p=JSON.stringify(oS(c));return ye.useMemo(()=>lS(o,JSON.parse(p),h,r==="path"),[o,p,h,r])}function mD(o,r,c,h,p){nr(dx(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:x}=ye.useContext(xf),{matches:S}=ye.useContext(Th),i=S[S.length-1],M=i?i.params:{},P=i?i.pathname:"/",N=i?i.pathnameBase:"/",H=i&&i.route;{let Se=H&&H.path||"";HC(P,!H||Se.endsWith("*")||Se.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${P}" (under <Route path="${Se}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Se}"> to <Route path="${Se==="/"?"*":`${Se}/*`}">.`)}let W=Uc(),K;K=W;let re=K.pathname||"/",ae=re;if(N!=="/"){let Se=N.replace(/^\//,"").split("/");ae="/"+re.replace(/^\//,"").split("/").slice(Se.length).join("/")}let ce=jp(o,{pathname:ae});return qo(H||ce!=null,`No routes matched location "${K.pathname}${K.search}${K.hash}" `),qo(ce==null||ce[ce.length-1].route.element!==void 0||ce[ce.length-1].route.Component!==void 0||ce[ce.length-1].route.lazy!==void 0,`Matched leaf route at location "${K.pathname}${K.search}${K.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),vD(ce&&ce.map(Se=>Object.assign({},Se,{params:Object.assign({},M,Se.params),pathname:vf([N,x.encodeLocation?x.encodeLocation(Se.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Se.pathname]),pathnameBase:Se.pathnameBase==="/"?N:vf([N,x.encodeLocation?x.encodeLocation(Se.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Se.pathnameBase])})),S,c,h,p)}function pD(){let o=TD(),r=ex(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),c=o instanceof Error?o.stack:null,h="rgba(200,200,200, 0.5)",p={padding:"0.5rem",backgroundColor:h},x={padding:"2px 4px",backgroundColor:h},S=null;return console.error("Error handled by React Router default ErrorBoundary:",o),S=ye.createElement(ye.Fragment,null,ye.createElement("p",null," Hey developer "),ye.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ye.createElement("code",{style:x},"ErrorBoundary")," or"," ",ye.createElement("code",{style:x},"errorElement")," prop on your route.")),ye.createElement(ye.Fragment,null,ye.createElement("h2",null,"Unexpected Application Error!"),ye.createElement("h3",{style:{fontStyle:"italic"}},r),c?ye.createElement("pre",{style:p},c):null,S)}var gD=ye.createElement(pD,null),_D=class extends ye.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,r){return r.location!==o.location||r.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:r.error,location:r.location,revalidation:o.revalidation||r.revalidation}}componentDidCatch(o,r){this.props.unstable_onError?this.props.unstable_onError(o,r):console.error("React Router caught the following error during render",o)}render(){return this.state.error!==void 0?ye.createElement(Th.Provider,{value:this.props.routeContext},ye.createElement(fS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function yD({routeContext:o,match:r,children:c}){let h=ye.useContext(Kg);return h&&h.static&&h.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(h.staticContext._deepestRenderedBoundaryId=r.route.id),ye.createElement(Th.Provider,{value:o},c)}function vD(o,r=[],c=null,h=null,p=null){if(o==null){if(!c)return null;if(c.errors)o=c.matches;else if(r.length===0&&!c.initialized&&c.matches.length>0)o=c.matches;else return null}let x=o,S=c?.errors;if(S!=null){let P=x.findIndex(N=>N.route.id&&S?.[N.route.id]!==void 0);nr(P>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(S).join(",")}`),x=x.slice(0,Math.min(x.length,P+1))}let i=!1,M=-1;if(c)for(let P=0;P<x.length;P++){let N=x[P];if((N.route.HydrateFallback||N.route.hydrateFallbackElement)&&(M=P),N.route.id){let{loaderData:H,errors:W}=c,K=N.route.loader&&!H.hasOwnProperty(N.route.id)&&(!W||W[N.route.id]===void 0);if(N.route.lazy||K){i=!0,M>=0?x=x.slice(0,M+1):x=[x[0]];break}}}return x.reduceRight((P,N,H)=>{let W,K=!1,re=null,ae=null;c&&(W=S&&N.route.id?S[N.route.id]:void 0,re=N.route.errorElement||gD,i&&(M<0&&H===0?(HC("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),K=!0,ae=null):M===H&&(K=!0,ae=N.route.hydrateFallbackElement||null)));let ce=r.concat(x.slice(0,H+1)),ve=()=>{let Se;return W?Se=re:K?Se=ae:N.route.Component?Se=ye.createElement(N.route.Component,null):N.route.element?Se=N.route.element:Se=P,ye.createElement(yD,{match:N,routeContext:{outlet:P,matches:ce,isDataRoute:c!=null},children:Se})};return c&&(N.route.ErrorBoundary||N.route.errorElement||H===0)?ye.createElement(_D,{location:c.location,revalidation:c.revalidation,component:re,error:W,children:ve(),routeContext:{outlet:null,matches:ce,isDataRoute:!0},unstable_onError:h}):ve()},null)}function mS(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function xD(o){let r=ye.useContext(Kg);return nr(r,mS(o)),r}function bD(o){let r=ye.useContext(ux);return nr(r,mS(o)),r}function wD(o){let r=ye.useContext(Th);return nr(r,mS(o)),r}function pS(o){let r=wD(o),c=r.matches[r.matches.length-1];return nr(c.route.id,`${o} can only be used on routes that contain a unique "id"`),c.route.id}function SD(){return pS("useRouteId")}function TD(){let o=ye.useContext(fS),r=bD("useRouteError"),c=pS("useRouteError");return o!==void 0?o:r.errors?.[c]}function kD(){let{router:o}=xD("useNavigate"),r=pS("useNavigate"),c=ye.useRef(!1);return VC(()=>{c.current=!0}),ye.useCallback(async(p,x={})=>{qo(c.current,$C),c.current&&(typeof p=="number"?o.navigate(p):await o.navigate(p,{fromRouteId:r,...x}))},[o,r])}var Qk={};function HC(o,r,c){!r&&!Qk[o]&&(Qk[o]=!0,qo(!1,c))}var eE={};function tE(o,r){!o&&!eE[r]&&(eE[r]=!0,console.warn(r))}function ED(o){let r={hasErrorBoundary:o.hasErrorBoundary||o.ErrorBoundary!=null||o.errorElement!=null};return o.Component&&(o.element&&qo(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(r,{element:ye.createElement(o.Component),Component:void 0})),o.HydrateFallback&&(o.hydrateFallbackElement&&qo(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(r,{hydrateFallbackElement:ye.createElement(o.HydrateFallback),HydrateFallback:void 0})),o.ErrorBoundary&&(o.errorElement&&qo(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(r,{errorElement:ye.createElement(o.ErrorBoundary),ErrorBoundary:void 0})),r}var AD=["HydrateFallback","hydrateFallbackElement"],CD=class{constructor(){this.status="pending",this.promise=new Promise((r,c)=>{this.resolve=h=>{this.status==="pending"&&(this.status="resolved",r(h))},this.reject=h=>{this.status==="pending"&&(this.status="rejected",c(h))}})}};function MD({router:o,flushSync:r,unstable_onError:c}){let[h,p]=ye.useState(o.state),[x,S]=ye.useState(),[i,M]=ye.useState({isTransitioning:!1}),[P,N]=ye.useState(),[H,W]=ye.useState(),[K,re]=ye.useState(),ae=ye.useRef(new Map),ce=ye.useCallback(He=>{p(ke=>(He.errors&&c&&Object.entries(He.errors).forEach(([tt,Ke])=>{ke.errors?.[tt]!==Ke&&c(Ke)}),He))},[c]),ve=ye.useCallback((He,{deletedFetchers:ke,flushSync:tt,viewTransitionOpts:Ke})=>{He.fetchers.forEach((ft,gt)=>{ft.data!==void 0&&ae.current.set(gt,ft.data)}),ke.forEach(ft=>ae.current.delete(ft)),tE(tt===!1||r!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let lt=o.window!=null&&o.window.document!=null&&typeof o.window.document.startViewTransition=="function";if(tE(Ke==null||lt,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!Ke||!lt){r&&tt?r(()=>ce(He)):ye.startTransition(()=>ce(He));return}if(r&&tt){r(()=>{H&&(P&&P.resolve(),H.skipTransition()),M({isTransitioning:!0,flushSync:!0,currentLocation:Ke.currentLocation,nextLocation:Ke.nextLocation})});let ft=o.window.document.startViewTransition(()=>{r(()=>ce(He))});ft.finished.finally(()=>{r(()=>{N(void 0),W(void 0),S(void 0),M({isTransitioning:!1})})}),r(()=>W(ft));return}H?(P&&P.resolve(),H.skipTransition(),re({state:He,currentLocation:Ke.currentLocation,nextLocation:Ke.nextLocation})):(S(He),M({isTransitioning:!0,flushSync:!1,currentLocation:Ke.currentLocation,nextLocation:Ke.nextLocation}))},[o.window,r,H,P,ce]);ye.useLayoutEffect(()=>o.subscribe(ve),[o,ve]),ye.useEffect(()=>{i.isTransitioning&&!i.flushSync&&N(new CD)},[i]),ye.useEffect(()=>{if(P&&x&&o.window){let He=x,ke=P.promise,tt=o.window.document.startViewTransition(async()=>{ye.startTransition(()=>ce(He)),await ke});tt.finished.finally(()=>{N(void 0),W(void 0),S(void 0),M({isTransitioning:!1})}),W(tt)}},[x,P,o.window,ce]),ye.useEffect(()=>{P&&x&&h.location.key===x.location.key&&P.resolve()},[P,H,h.location,x]),ye.useEffect(()=>{!i.isTransitioning&&K&&(S(K.state),M({isTransitioning:!0,flushSync:!1,currentLocation:K.currentLocation,nextLocation:K.nextLocation}),re(void 0))},[i.isTransitioning,K]);let Se=ye.useMemo(()=>({createHref:o.createHref,encodeLocation:o.encodeLocation,go:He=>o.navigate(He),push:(He,ke,tt)=>o.navigate(He,{state:ke,preventScrollReset:tt?.preventScrollReset}),replace:(He,ke,tt)=>o.navigate(He,{replace:!0,state:ke,preventScrollReset:tt?.preventScrollReset})}),[o]),Ee=o.basename||"/",Qe=ye.useMemo(()=>({router:o,navigator:Se,static:!1,basename:Ee,unstable_onError:c}),[o,Se,Ee,c]);return ye.createElement(ye.Fragment,null,ye.createElement(Kg.Provider,{value:Qe},ye.createElement(ux.Provider,{value:h},ye.createElement(UC.Provider,{value:ae.current},ye.createElement(hS.Provider,{value:i},ye.createElement(ID,{basename:Ee,location:h.location,navigationType:h.historyAction,navigator:Se},ye.createElement(PD,{routes:o.routes,future:o.future,state:h,unstable_onError:c})))))),null)}var PD=ye.memo(jD);function jD({routes:o,future:r,state:c,unstable_onError:h}){return mD(o,void 0,c,h,r)}function zD(o){return fD(o.context)}function Sa(o){nr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function ID({basename:o="/",children:r=null,location:c,navigationType:h="POP",navigator:p,static:x=!1}){nr(!dx(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let S=o.replace(/^\/*/,"/"),i=ye.useMemo(()=>({basename:S,navigator:p,static:x,future:{}}),[S,p,x]);typeof c=="string"&&(c=Gp(c));let{pathname:M="/",search:P="",hash:N="",state:H=null,key:W="default"}=c,K=ye.useMemo(()=>{let re=Ld(M,S);return re==null?null:{location:{pathname:re,search:P,hash:N,state:H,key:W},navigationType:h}},[S,M,P,N,H,W,h]);return qo(K!=null,`<Router basename="${S}"> is not able to match the URL "${M}${P}${N}" because it does not start with the basename, so the <Router> won't render anything.`),K==null?null:ye.createElement(xf.Provider,{value:i},ye.createElement(Mb.Provider,{children:r,value:K}))}function U1(o,r=[]){let c=[];return ye.Children.forEach(o,(h,p)=>{if(!ye.isValidElement(h))return;let x=[...r,p];if(h.type===ye.Fragment){c.push.apply(c,U1(h.props.children,x));return}nr(h.type===Sa,`[${typeof h.type=="string"?h.type:h.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),nr(!h.props.index||!h.props.children,"An index route cannot have child routes.");let S={id:h.props.id||x.join("-"),caseSensitive:h.props.caseSensitive,element:h.props.element,Component:h.props.Component,index:h.props.index,path:h.props.path,middleware:h.props.middleware,loader:h.props.loader,action:h.props.action,hydrateFallbackElement:h.props.hydrateFallbackElement,HydrateFallback:h.props.HydrateFallback,errorElement:h.props.errorElement,ErrorBoundary:h.props.ErrorBoundary,hasErrorBoundary:h.props.hasErrorBoundary===!0||h.props.ErrorBoundary!=null||h.props.errorElement!=null,shouldRevalidate:h.props.shouldRevalidate,handle:h.props.handle,lazy:h.props.lazy};h.props.children&&(S.children=U1(h.props.children,x)),c.push(S)}),c}var RD=U1,tb="get",ib="application/x-www-form-urlencoded";function Pb(o){return o!=null&&typeof o.tagName=="string"}function DD(o){return Pb(o)&&o.tagName.toLowerCase()==="button"}function LD(o){return Pb(o)&&o.tagName.toLowerCase()==="form"}function OD(o){return Pb(o)&&o.tagName.toLowerCase()==="input"}function ND(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function FD(o,r){return o.button===0&&(!r||r==="_self")&&!ND(o)}var T0=null;function BD(){if(T0===null)try{new FormData(document.createElement("form"),0),T0=!1}catch{T0=!0}return T0}var UD=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function i1(o){return o!=null&&!UD.has(o)?(qo(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ib}"`),null):o}function $D(o,r){let c,h,p,x,S;if(LD(o)){let i=o.getAttribute("action");h=i?Ld(i,r):null,c=o.getAttribute("method")||tb,p=i1(o.getAttribute("enctype"))||ib,x=new FormData(o)}else if(DD(o)||OD(o)&&(o.type==="submit"||o.type==="image")){let i=o.form;if(i==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let M=o.getAttribute("formaction")||i.getAttribute("action");if(h=M?Ld(M,r):null,c=o.getAttribute("formmethod")||i.getAttribute("method")||tb,p=i1(o.getAttribute("formenctype"))||i1(i.getAttribute("enctype"))||ib,x=new FormData(i,o),!BD()){let{name:P,type:N,value:H}=o;if(N==="image"){let W=P?`${P}.`:"";x.append(`${W}x`,"0"),x.append(`${W}y`,"0")}else P&&x.append(P,H)}}else{if(Pb(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');c=tb,h=null,p=ib,S=o}return x&&p==="text/plain"&&(S=x,x=void 0),{action:h,method:c.toLowerCase(),encType:p,formData:x,body:S}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function gS(o,r){if(o===!1||o===null||typeof o>"u")throw new Error(r)}function VD(o,r,c){let h=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return h.pathname==="/"?h.pathname=`_root.${c}`:r&&Ld(h.pathname,r)==="/"?h.pathname=`${r.replace(/\/$/,"")}/_root.${c}`:h.pathname=`${h.pathname.replace(/\/$/,"")}.${c}`,h}async function HD(o,r){if(o.id in r)return r[o.id];try{let c=await import(o.module);return r[o.id]=c,c}catch(c){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(c),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function GD(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function qD(o,r,c){let h=await Promise.all(o.map(async p=>{let x=r.routes[p.route.id];if(x){let S=await HD(x,c);return S.links?S.links():[]}return[]}));return YD(h.flat(1).filter(GD).filter(p=>p.rel==="stylesheet"||p.rel==="preload").map(p=>p.rel==="stylesheet"?{...p,rel:"prefetch",as:"style"}:{...p,rel:"prefetch"}))}function iE(o,r,c,h,p,x){let S=(M,P)=>c[P]?M.route.id!==c[P].route.id:!0,i=(M,P)=>c[P].pathname!==M.pathname||c[P].route.path?.endsWith("*")&&c[P].params["*"]!==M.params["*"];return x==="assets"?r.filter((M,P)=>S(M,P)||i(M,P)):x==="data"?r.filter((M,P)=>{let N=h.routes[M.route.id];if(!N||!N.hasLoader)return!1;if(S(M,P)||i(M,P))return!0;if(M.route.shouldRevalidate){let H=M.route.shouldRevalidate({currentUrl:new URL(p.pathname+p.search+p.hash,window.origin),currentParams:c[0]?.params||{},nextUrl:new URL(o,window.origin),nextParams:M.params,defaultShouldRevalidate:!0});if(typeof H=="boolean")return H}return!0}):[]}function WD(o,r,{includeHydrateFallback:c}={}){return ZD(o.map(h=>{let p=r.routes[h.route.id];if(!p)return[];let x=[p.module];return p.clientActionModule&&(x=x.concat(p.clientActionModule)),p.clientLoaderModule&&(x=x.concat(p.clientLoaderModule)),c&&p.hydrateFallbackModule&&(x=x.concat(p.hydrateFallbackModule)),p.imports&&(x=x.concat(p.imports)),x}).flat(1))}function ZD(o){return[...new Set(o)]}function XD(o){let r={},c=Object.keys(o).sort();for(let h of c)r[h]=o[h];return r}function YD(o,r){let c=new Set;return new Set(r),o.reduce((h,p)=>{let x=JSON.stringify(XD(p));return c.has(x)||(c.add(x),h.push({key:x,link:p})),h},[])}function GC(){let o=ye.useContext(Kg);return gS(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function KD(){let o=ye.useContext(ux);return gS(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var _S=ye.createContext(void 0);_S.displayName="FrameworkContext";function qC(){let o=ye.useContext(_S);return gS(o,"You must render this element inside a <HydratedRouter> element"),o}function JD(o,r){let c=ye.useContext(_S),[h,p]=ye.useState(!1),[x,S]=ye.useState(!1),{onFocus:i,onBlur:M,onMouseEnter:P,onMouseLeave:N,onTouchStart:H}=r,W=ye.useRef(null);ye.useEffect(()=>{if(o==="render"&&S(!0),o==="viewport"){let ae=ve=>{ve.forEach(Se=>{S(Se.isIntersecting)})},ce=new IntersectionObserver(ae,{threshold:.5});return W.current&&ce.observe(W.current),()=>{ce.disconnect()}}},[o]),ye.useEffect(()=>{if(h){let ae=setTimeout(()=>{S(!0)},100);return()=>{clearTimeout(ae)}}},[h]);let K=()=>{p(!0)},re=()=>{p(!1),S(!1)};return c?o!=="intent"?[x,W,{}]:[x,W,{onFocus:Mv(i,K),onBlur:Mv(M,re),onMouseEnter:Mv(P,K),onMouseLeave:Mv(N,re),onTouchStart:Mv(H,K)}]:[!1,W,{}]}function Mv(o,r){return c=>{o&&o(c),c.defaultPrevented||r(c)}}function QD({page:o,...r}){let{router:c}=GC(),h=ye.useMemo(()=>jp(c.routes,o,c.basename),[c.routes,o,c.basename]);return h?ye.createElement(tL,{page:o,matches:h,...r}):null}function eL(o){let{manifest:r,routeModules:c}=qC(),[h,p]=ye.useState([]);return ye.useEffect(()=>{let x=!1;return qD(o,r,c).then(S=>{x||p(S)}),()=>{x=!0}},[o,r,c]),h}function tL({page:o,matches:r,...c}){let h=Uc(),{manifest:p,routeModules:x}=qC(),{basename:S}=GC(),{loaderData:i,matches:M}=KD(),P=ye.useMemo(()=>iE(o,r,M,p,h,"data"),[o,r,M,p,h]),N=ye.useMemo(()=>iE(o,r,M,p,h,"assets"),[o,r,M,p,h]),H=ye.useMemo(()=>{if(o===h.pathname+h.search+h.hash)return[];let re=new Set,ae=!1;if(r.forEach(ve=>{let Se=p.routes[ve.route.id];!Se||!Se.hasLoader||(!P.some(Ee=>Ee.route.id===ve.route.id)&&ve.route.id in i&&x[ve.route.id]?.shouldRevalidate||Se.hasClientLoader?ae=!0:re.add(ve.route.id))}),re.size===0)return[];let ce=VD(o,S,"data");return ae&&re.size>0&&ce.searchParams.set("_routes",r.filter(ve=>re.has(ve.route.id)).map(ve=>ve.route.id).join(",")),[ce.pathname+ce.search]},[S,i,h,p,P,r,o,x]),W=ye.useMemo(()=>WD(N,p),[N,p]),K=eL(N);return ye.createElement(ye.Fragment,null,H.map(re=>ye.createElement("link",{key:re,rel:"prefetch",as:"fetch",href:re,...c})),W.map(re=>ye.createElement("link",{key:re,rel:"modulepreload",href:re,...c})),K.map(({key:re,link:ae})=>ye.createElement("link",{key:re,nonce:c.nonce,...ae})))}function iL(...o){return r=>{o.forEach(c=>{typeof c=="function"?c(r):c!=null&&(c.current=r)})}}var WC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{WC&&(window.__reactRouterVersion="7.9.3")}catch{}function nL(o,r){return BR({basename:r?.basename,getContext:r?.getContext,future:r?.future,history:rR({window:r?.window}),hydrationData:aL(),routes:o,mapRouteProperties:ED,hydrationRouteProperties:AD,dataStrategy:r?.dataStrategy,patchRoutesOnNavigation:r?.patchRoutesOnNavigation,window:r?.window}).initialize()}function aL(){let o=window?.__staticRouterHydrationData;return o&&o.errors&&(o={...o,errors:rL(o.errors)}),o}function rL(o){if(!o)return null;let r=Object.entries(o),c={};for(let[h,p]of r)if(p&&p.__type==="RouteErrorResponse")c[h]=new ub(p.status,p.statusText,p.data,p.internal===!0);else if(p&&p.__type==="Error"){if(p.__subType){let x=window[p.__subType];if(typeof x=="function")try{let S=new x(p.message);S.stack="",c[h]=S}catch{}}if(c[h]==null){let x=new Error(p.message);x.stack="",c[h]=x}}else c[h]=p;return c}var ZC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,XC=ye.forwardRef(function({onClick:r,discover:c="render",prefetch:h="none",relative:p,reloadDocument:x,replace:S,state:i,target:M,to:P,preventScrollReset:N,viewTransition:H,...W},K){let{basename:re}=ye.useContext(xf),ae=typeof P=="string"&&ZC.test(P),ce,ve=!1;if(typeof P=="string"&&ae&&(ce=P,WC))try{let lt=new URL(window.location.href),ft=P.startsWith("//")?new URL(lt.protocol+P):new URL(P),gt=Ld(ft.pathname,re);ft.origin===lt.origin&&gt!=null?P=gt+ft.search+ft.hash:ve=!0}catch{qo(!1,`<Link to="${P}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Se=uD(P,{relative:p}),[Ee,Qe,He]=JD(h,W),ke=lL(P,{replace:S,state:i,target:M,preventScrollReset:N,relative:p,viewTransition:H});function tt(lt){r&&r(lt),lt.defaultPrevented||ke(lt)}let Ke=ye.createElement("a",{...W,...He,href:ce||Se,onClick:ve||x?r:tt,ref:iL(K,Qe),target:M,"data-discover":!ae&&c==="render"?"true":void 0});return Ee&&!ae?ye.createElement(ye.Fragment,null,Ke,ye.createElement(QD,{page:Se})):Ke});XC.displayName="Link";var fo=ye.forwardRef(function({"aria-current":r="page",caseSensitive:c=!1,className:h="",end:p=!1,style:x,to:S,viewTransition:i,children:M,...P},N){let H=hx(S,{relative:P.relative}),W=Uc(),K=ye.useContext(ux),{navigator:re,basename:ae}=ye.useContext(xf),ce=K!=null&&fL(H)&&i===!0,ve=re.encodeLocation?re.encodeLocation(H).pathname:H.pathname,Se=W.pathname,Ee=K&&K.navigation&&K.navigation.location?K.navigation.location.pathname:null;c||(Se=Se.toLowerCase(),Ee=Ee?Ee.toLowerCase():null,ve=ve.toLowerCase()),Ee&&ae&&(Ee=Ld(Ee,ae)||Ee);const Qe=ve!=="/"&&ve.endsWith("/")?ve.length-1:ve.length;let He=Se===ve||!p&&Se.startsWith(ve)&&Se.charAt(Qe)==="/",ke=Ee!=null&&(Ee===ve||!p&&Ee.startsWith(ve)&&Ee.charAt(ve.length)==="/"),tt={isActive:He,isPending:ke,isTransitioning:ce},Ke=He?r:void 0,lt;typeof h=="function"?lt=h(tt):lt=[h,He?"active":null,ke?"pending":null,ce?"transitioning":null].filter(Boolean).join(" ");let ft=typeof x=="function"?x(tt):x;return ye.createElement(XC,{...P,"aria-current":Ke,className:lt,ref:N,style:ft,to:S,viewTransition:i},typeof M=="function"?M(tt):M)});fo.displayName="NavLink";var sL=ye.forwardRef(({discover:o="render",fetcherKey:r,navigate:c,reloadDocument:h,replace:p,state:x,method:S=tb,action:i,onSubmit:M,relative:P,preventScrollReset:N,viewTransition:H,...W},K)=>{let re=dL(),ae=hL(i,{relative:P}),ce=S.toLowerCase()==="get"?"get":"post",ve=typeof i=="string"&&ZC.test(i),Se=Ee=>{if(M&&M(Ee),Ee.defaultPrevented)return;Ee.preventDefault();let Qe=Ee.nativeEvent.submitter,He=Qe?.getAttribute("formmethod")||S;re(Qe||Ee.currentTarget,{fetcherKey:r,method:He,navigate:c,replace:p,state:x,relative:P,preventScrollReset:N,viewTransition:H})};return ye.createElement("form",{ref:K,method:ce,action:ae,onSubmit:h?M:Se,...W,"data-discover":!ve&&o==="render"?"true":void 0})});sL.displayName="Form";function oL(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function YC(o){let r=ye.useContext(Kg);return nr(r,oL(o)),r}function lL(o,{target:r,replace:c,state:h,preventScrollReset:p,relative:x,viewTransition:S}={}){let i=$a(),M=Uc(),P=hx(o,{relative:x});return ye.useCallback(N=>{if(FD(N,r)){N.preventDefault();let H=c!==void 0?c:$p(M)===$p(P);i(o,{replace:H,state:h,preventScrollReset:p,relative:x,viewTransition:S})}},[M,i,P,c,h,r,o,p,x,S])}var cL=0,uL=()=>`__${String(++cL)}__`;function dL(){let{router:o}=YC("useSubmit"),{basename:r}=ye.useContext(xf),c=SD();return ye.useCallback(async(h,p={})=>{let{action:x,method:S,encType:i,formData:M,body:P}=$D(h,r);if(p.navigate===!1){let N=p.fetcherKey||uL();await o.fetch(N,c,p.action||x,{preventScrollReset:p.preventScrollReset,formData:M,body:P,formMethod:p.method||S,formEncType:p.encType||i,flushSync:p.flushSync})}else await o.navigate(p.action||x,{preventScrollReset:p.preventScrollReset,formData:M,body:P,formMethod:p.method||S,formEncType:p.encType||i,replace:p.replace,state:p.state,fromRouteId:c,flushSync:p.flushSync,viewTransition:p.viewTransition})},[o,r,c])}function hL(o,{relative:r}={}){let{basename:c}=ye.useContext(xf),h=ye.useContext(Th);nr(h,"useFormAction must be used inside a RouteContext");let[p]=h.matches.slice(-1),x={...hx(o||".",{relative:r})},S=Uc();if(o==null){x.search=S.search;let i=new URLSearchParams(x.search),M=i.getAll("index");if(M.some(N=>N==="")){i.delete("index"),M.filter(H=>H).forEach(H=>i.append("index",H));let N=i.toString();x.search=N?`?${N}`:""}}return(!o||o===".")&&p.route.index&&(x.search=x.search?x.search.replace(/^\?/,"?index&"):"?index"),c!=="/"&&(x.pathname=x.pathname==="/"?c:vf([c,x.pathname])),$p(x)}function fL(o,{relative:r}={}){let c=ye.useContext(hS);nr(c!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:h}=YC("useViewTransitionState"),p=hx(o,{relative:r});if(!c.isTransitioning)return!1;let x=Ld(c.currentLocation.pathname,h)||c.currentLocation.pathname,S=Ld(c.nextLocation.pathname,h)||c.nextLocation.pathname;return cb(p.pathname,S)!=null||cb(p.pathname,x)!=null}var mL=kC();function pL(o){return ye.createElement(MD,{flushSync:mL.flushSync,...o})}var KC={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},nE=Np.createContext&&Np.createContext(KC),gL=["attr","size","title"];function _L(o,r){if(o==null)return{};var c=yL(o,r),h,p;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(o);for(p=0;p<x.length;p++)h=x[p],!(r.indexOf(h)>=0)&&Object.prototype.propertyIsEnumerable.call(o,h)&&(c[h]=o[h])}return c}function yL(o,r){if(o==null)return{};var c={};for(var h in o)if(Object.prototype.hasOwnProperty.call(o,h)){if(r.indexOf(h)>=0)continue;c[h]=o[h]}return c}function hb(){return hb=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(o[h]=c[h])}return o},hb.apply(this,arguments)}function aE(o,r){var c=Object.keys(o);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(o);r&&(h=h.filter(function(p){return Object.getOwnPropertyDescriptor(o,p).enumerable})),c.push.apply(c,h)}return c}function fb(o){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?aE(Object(c),!0).forEach(function(h){vL(o,h,c[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(c)):aE(Object(c)).forEach(function(h){Object.defineProperty(o,h,Object.getOwnPropertyDescriptor(c,h))})}return o}function vL(o,r,c){return r=xL(r),r in o?Object.defineProperty(o,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[r]=c,o}function xL(o){var r=bL(o,"string");return typeof r=="symbol"?r:r+""}function bL(o,r){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var h=c.call(o,r);if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(o)}function JC(o){return o&&o.map((r,c)=>Np.createElement(r.tag,fb({key:c},r.attr),JC(r.child)))}function Cn(o){return r=>Np.createElement(wL,hb({attr:fb({},o.attr)},r),JC(o.child))}function wL(o){var r=c=>{var{attr:h,size:p,title:x}=o,S=_L(o,gL),i=p||c.size||"1em",M;return c.className&&(M=c.className),o.className&&(M=(M?M+" ":"")+o.className),Np.createElement("svg",hb({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},c.attr,h,S,{className:M,style:fb(fb({color:o.color||c.color},c.style),o.style),height:i,width:i,xmlns:"http://www.w3.org/2000/svg"}),x&&Np.createElement("title",null,x),o.children)};return nE!==void 0?Np.createElement(nE.Consumer,null,c=>r(c)):r(KC)}function SL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10 2l-.15 .005a2 2 0 0 0 -1.85 1.995v6.999l-2.586 .001a2 2 0 0 0 -1.414 3.414l6.586 6.586a2 2 0 0 0 2.828 0l6.586 -6.586a2 2 0 0 0 .434 -2.18l-.068 -.145a2 2 0 0 0 -1.78 -1.089l-2.586 -.001v-6.999a2 2 0 0 0 -2 -2h-4z"},child:[]}]})(o)}function TL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9.586 4l-6.586 6.586a2 2 0 0 0 0 2.828l6.586 6.586a2 2 0 0 0 2.18 .434l.145 -.068a2 2 0 0 0 1.089 -1.78v-2.586h7a2 2 0 0 0 2 -2v-4l-.005 -.15a2 2 0 0 0 -1.995 -1.85l-7 -.001v-2.585a2 2 0 0 0 -3.414 -1.414z"},child:[]}]})(o)}function kL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z"},child:[]}]})(o)}function EL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10.586 3l-6.586 6.586a2 2 0 0 0 -.434 2.18l.068 .145a2 2 0 0 0 1.78 1.089h2.586v7a2 2 0 0 0 2 2h4l.15 -.005a2 2 0 0 0 1.85 -1.995l-.001 -7h2.587a2 2 0 0 0 1.414 -3.414l-6.586 -6.586a2 2 0 0 0 -2.828 0z"},child:[]}]})(o)}function AL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M14 2a5 5 0 0 1 5 5v14a1 1 0 0 1 -1.555 .832l-5.445 -3.63l-5.444 3.63a1 1 0 0 1 -1.55 -.72l-.006 -.112v-14a5 5 0 0 1 5 -5h4z"},child:[]}]})(o)}function CL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18 9c.852 0 1.297 .986 .783 1.623l-.076 .084l-6 6a1 1 0 0 1 -1.32 .083l-.094 -.083l-6 -6l-.083 -.094l-.054 -.077l-.054 -.096l-.017 -.036l-.027 -.067l-.032 -.108l-.01 -.053l-.01 -.06l-.004 -.057v-.118l.005 -.058l.009 -.06l.01 -.052l.032 -.108l.027 -.067l.07 -.132l.065 -.09l.073 -.081l.094 -.083l.077 -.054l.096 -.054l.036 -.017l.067 -.027l.108 -.032l.053 -.01l.06 -.01l.057 -.004l12.059 -.002z"},child:[]}]})(o)}function ML(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11.293 7.293a1 1 0 0 1 1.32 -.083l.094 .083l6 6l.083 .094l.054 .077l.054 .096l.017 .036l.027 .067l.032 .108l.01 .053l.01 .06l.004 .057l.002 .059l-.002 .059l-.005 .058l-.009 .06l-.01 .052l-.032 .108l-.027 .067l-.07 .132l-.065 .09l-.073 .081l-.094 .083l-.077 .054l-.096 .054l-.036 .017l-.067 .027l-.108 .032l-.053 .01l-.06 .01l-.057 .004l-.059 .002h-12c-.852 0 -1.297 -.986 -.783 -1.623l.076 -.084l6 -6z"},child:[]}]})(o)}function PL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M7 3.34a10 10 0 1 1 -4.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 4.995 -8.336z"},child:[]}]})(o)}function QC(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z"},child:[]}]})(o)}function jL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 1a.993 .993 0 0 1 .823 .443l.067 .116l2.852 5.781l6.38 .925c.741 .108 1.08 .94 .703 1.526l-.07 .095l-.078 .086l-4.624 4.499l1.09 6.355a1.001 1.001 0 0 1 -1.249 1.135l-.101 -.035l-.101 -.046l-5.693 -3l-5.706 3c-.105 .055 -.212 .09 -.32 .106l-.106 .01a1.003 1.003 0 0 1 -1.038 -1.06l.013 -.11l1.09 -6.355l-4.623 -4.5a1.001 1.001 0 0 1 .328 -1.647l.113 -.036l.114 -.023l6.379 -.925l2.853 -5.78a.968 .968 0 0 1 .904 -.56zm0 3.274v12.476a1 1 0 0 1 .239 .029l.115 .036l.112 .05l4.363 2.299l-.836 -4.873a1 1 0 0 1 .136 -.696l.07 -.099l.082 -.09l3.546 -3.453l-4.891 -.708a1 1 0 0 1 -.62 -.344l-.073 -.097l-.06 -.106l-2.183 -4.424z"},child:[]}]})(o)}function Wo(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8.243 7.34l-6.38 .925l-.113 .023a1 1 0 0 0 -.44 1.684l4.622 4.499l-1.09 6.355l-.013 .11a1 1 0 0 0 1.464 .944l5.706 -3l5.693 3l.1 .046a1 1 0 0 0 1.352 -1.1l-1.091 -6.355l4.624 -4.5l.078 -.085a1 1 0 0 0 -.633 -1.62l-6.38 -.926l-2.852 -5.78a1 1 0 0 0 -1.794 0l-2.853 5.78z"},child:[]}]})(o)}function zL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M4 6l8 0"},child:[]},{tag:"path",attr:{d:"M16 6l4 0"},child:[]},{tag:"path",attr:{d:"M8 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M4 12l2 0"},child:[]},{tag:"path",attr:{d:"M10 12l10 0"},child:[]},{tag:"path",attr:{d:"M17 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M4 18l11 0"},child:[]},{tag:"path",attr:{d:"M19 18l1 0"},child:[]}]})(o)}function eM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12l14 0"},child:[]},{tag:"path",attr:{d:"M13 18l6 -6"},child:[]},{tag:"path",attr:{d:"M13 6l6 6"},child:[]}]})(o)}function IL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 5a2 2 0 1 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3h-16a4 4 0 0 0 2 -3v-3a7 7 0 0 1 4 -6"},child:[]},{tag:"path",attr:{d:"M9 17v1a3 3 0 0 0 6 0v-1"},child:[]}]})(o)}function tM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 7v14l-6 -4l-6 4v-14a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4z"},child:[]}]})(o)}function RL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12.4 3a5.34 5.34 0 0 1 4.906 3.239a5.333 5.333 0 0 1 -1.195 10.6a4.26 4.26 0 0 1 -5.28 1.863l-3.831 2.298v-3.134a2.668 2.668 0 0 1 -1.795 -3.773a4.8 4.8 0 0 1 2.908 -8.933a5.33 5.33 0 0 1 4.287 -2.16"},child:[]}]})(o)}function Tm(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 21l18 0"},child:[]},{tag:"path",attr:{d:"M3 7v1a3 3 0 0 0 6 0v-1m0 1a3 3 0 0 0 6 0v-1m0 1a3 3 0 0 0 6 0v-1h-18l2 -4h14l2 4"},child:[]},{tag:"path",attr:{d:"M5 21l0 -10.15"},child:[]},{tag:"path",attr:{d:"M19 21l0 -10.15"},child:[]},{tag:"path",attr:{d:"M9 21v-4a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v4"},child:[]}]})(o)}function DL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 13a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M15 9a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M9 5a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M4 20h14"},child:[]}]})(o)}function LL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 3.2a9 9 0 1 0 10.8 10.8a1 1 0 0 0 -1 -1h-6.8a2 2 0 0 1 -2 -2v-7a.9 .9 0 0 0 -1 -.8"},child:[]},{tag:"path",attr:{d:"M15 3.5a9 9 0 0 1 5.5 5.5h-4.5a1 1 0 0 1 -1 -1v-4.5"},child:[]}]})(o)}function iM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12l5 5l10 -10"},child:[]}]})(o)}function nM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6 9l6 6l6 -6"},child:[]}]})(o)}function km(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 6l-6 6l6 6"},child:[]}]})(o)}function yf(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 6l6 6l-6 6"},child:[]}]})(o)}function aM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6 15l6 -6l6 6"},child:[]}]})(o)}function OL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"},child:[]},{tag:"path",attr:{d:"M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z"},child:[]},{tag:"path",attr:{d:"M9 12l.01 0"},child:[]},{tag:"path",attr:{d:"M13 12l2 0"},child:[]},{tag:"path",attr:{d:"M9 16l.01 0"},child:[]},{tag:"path",attr:{d:"M13 16l2 0"},child:[]}]})(o)}function rM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"},child:[]},{tag:"path",attr:{d:"M12 7v5l3 3"},child:[]}]})(o)}function NL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 16l2 -6l6 -2l-2 6l-6 2"},child:[]},{tag:"path",attr:{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"},child:[]},{tag:"path",attr:{d:"M12 3l0 2"},child:[]},{tag:"path",attr:{d:"M12 19l0 2"},child:[]},{tag:"path",attr:{d:"M3 12l2 0"},child:[]},{tag:"path",attr:{d:"M19 12l2 0"},child:[]}]})(o)}function FL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"},child:[]},{tag:"path",attr:{d:"M12 12m-8 0a8 8 0 1 0 16 0a8 8 0 1 0 -16 0"},child:[]},{tag:"path",attr:{d:"M12 2l0 2"},child:[]},{tag:"path",attr:{d:"M12 20l0 2"},child:[]},{tag:"path",attr:{d:"M20 12l2 0"},child:[]},{tag:"path",attr:{d:"M2 12l2 0"},child:[]}]})(o)}function BL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"},child:[]},{tag:"path",attr:{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M14 4l0 4l-6 0l0 -4"},child:[]}]})(o)}function UL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"},child:[]},{tag:"path",attr:{d:"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"},child:[]},{tag:"path",attr:{d:"M16 5l3 3"},child:[]}]})(o)}function sM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 9c-2.4 2.667 -5.4 4 -9 4c-3.6 0 -6.6 -1.333 -9 -4"},child:[]},{tag:"path",attr:{d:"M3 15l2.5 -3.8"},child:[]},{tag:"path",attr:{d:"M21 14.976l-2.492 -3.776"},child:[]},{tag:"path",attr:{d:"M9 17l.5 -4"},child:[]},{tag:"path",attr:{d:"M15 17l-.5 -4"},child:[]}]})(o)}function yS(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10.585 10.587a2 2 0 0 0 2.829 2.828"},child:[]},{tag:"path",attr:{d:"M16.681 16.673a8.717 8.717 0 0 1 -4.681 1.327c-3.6 0 -6.6 -2 -9 -6c1.272 -2.12 2.712 -3.678 4.32 -4.674m2.86 -1.146a9.055 9.055 0 0 1 1.82 -.18c3.6 0 6.6 2 9 6c-.666 1.11 -1.379 2.067 -2.138 2.87"},child:[]},{tag:"path",attr:{d:"M3 3l18 18"},child:[]}]})(o)}function fx(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"},child:[]},{tag:"path",attr:{d:"M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6"},child:[]}]})(o)}function oM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 3v4a1 1 0 0 0 1 1h4"},child:[]},{tag:"path",attr:{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4"},child:[]},{tag:"path",attr:{d:"M5 18h1.5a1.5 1.5 0 0 0 0 -3h-1.5v6"},child:[]},{tag:"path",attr:{d:"M17 18h2"},child:[]},{tag:"path",attr:{d:"M20 15h-3v6"},child:[]},{tag:"path",attr:{d:"M11 15v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1z"},child:[]}]})(o)}function vS(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z"},child:[]}]})(o)}function $L(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 5a5 5 0 0 1 7 0a5 5 0 0 0 7 0v9a5 5 0 0 1 -7 0a5 5 0 0 0 -7 0v-9z"},child:[]},{tag:"path",attr:{d:"M5 21v-7"},child:[]}]})(o)}function VL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M12 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M19 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M12 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M19 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]}]})(o)}function lM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572"},child:[]}]})(o)}function HL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 20.777a8.942 8.942 0 0 1 -2.48 -.969"},child:[]},{tag:"path",attr:{d:"M14 3.223a9.003 9.003 0 0 1 0 17.554"},child:[]},{tag:"path",attr:{d:"M4.579 17.093a8.961 8.961 0 0 1 -1.227 -2.592"},child:[]},{tag:"path",attr:{d:"M3.124 10.5c.16 -.95 .468 -1.85 .9 -2.675l.169 -.305"},child:[]},{tag:"path",attr:{d:"M6.907 4.579a8.954 8.954 0 0 1 3.093 -1.356"},child:[]},{tag:"path",attr:{d:"M12 8v4l3 3"},child:[]}]})(o)}function GL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12l-2 0l9 -9l9 9l-2 0"},child:[]},{tag:"path",attr:{d:"M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"},child:[]},{tag:"path",attr:{d:"M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"},child:[]}]})(o)}function qL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6.5 7h11"},child:[]},{tag:"path",attr:{d:"M6.5 17h11"},child:[]},{tag:"path",attr:{d:"M6 20v-2a6 6 0 1 1 12 0v2a1 1 0 0 1 -1 1h-10a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M6 4v2a6 6 0 1 0 12 0v-2a1 1 0 0 0 -1 -1h-10a1 1 0 0 0 -1 1z"},child:[]}]})(o)}function my(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M14 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M4 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M14 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]}]})(o)}function rE(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 6l11 0"},child:[]},{tag:"path",attr:{d:"M9 12l11 0"},child:[]},{tag:"path",attr:{d:"M9 18l11 0"},child:[]},{tag:"path",attr:{d:"M5 6l0 .01"},child:[]},{tag:"path",attr:{d:"M5 12l0 .01"},child:[]},{tag:"path",attr:{d:"M5 18l0 .01"},child:[]}]})(o)}function WL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2"},child:[]},{tag:"path",attr:{d:"M9 12h12l-3 -3"},child:[]},{tag:"path",attr:{d:"M18 15l3 -3"},child:[]}]})(o)}function ZL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 18.5l-3 -1.5l-6 3v-13l6 -3l6 3l6 -3v7"},child:[]},{tag:"path",attr:{d:"M9 4v13"},child:[]},{tag:"path",attr:{d:"M15 7v5"},child:[]},{tag:"path",attr:{d:"M21.121 20.121a3 3 0 1 0 -4.242 0c.418 .419 1.125 1.045 2.121 1.879c1.051 -.89 1.759 -1.516 2.121 -1.879z"},child:[]},{tag:"path",attr:{d:"M19 18v.01"},child:[]}]})(o)}function xS(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"},child:[]},{tag:"path",attr:{d:"M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z"},child:[]}]})(o)}function XL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 6l16 0"},child:[]},{tag:"path",attr:{d:"M4 12l16 0"},child:[]},{tag:"path",attr:{d:"M4 18l16 0"},child:[]}]})(o)}function YL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 8l16 0"},child:[]},{tag:"path",attr:{d:"M4 16l16 0"},child:[]}]})(o)}function bS(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 20l1.3 -3.9c-2.324 -3.437 -1.426 -7.872 2.1 -10.374c3.526 -2.501 8.59 -2.296 11.845 .48c3.255 2.777 3.695 7.266 1.029 10.501c-2.666 3.235 -7.615 4.215 -11.574 2.293l-4.7 1"},child:[]}]})(o)}function KL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"},child:[]},{tag:"path",attr:{d:"M9 7l6 0"},child:[]},{tag:"path",attr:{d:"M9 11l6 0"},child:[]},{tag:"path",attr:{d:"M9 15l4 0"},child:[]}]})(o)}function tx(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 3l8 4.5l0 9l-8 4.5l-8 -4.5l0 -9l8 -4.5"},child:[]},{tag:"path",attr:{d:"M12 12l8 -4.5"},child:[]},{tag:"path",attr:{d:"M12 12l0 9"},child:[]},{tag:"path",attr:{d:"M12 12l-8 -4.5"},child:[]},{tag:"path",attr:{d:"M16 5.25l-8 4.5"},child:[]}]})(o)}function JL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4"},child:[]},{tag:"path",attr:{d:"M13.5 6.5l4 4"},child:[]}]})(o)}function cM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 8h.01"},child:[]},{tag:"path",attr:{d:"M12.5 21h-6.5a3 3 0 0 1 -3 -3v-12a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v6.5"},child:[]},{tag:"path",attr:{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l4 4"},child:[]},{tag:"path",attr:{d:"M14 14l1 -1c.67 -.644 1.45 -.824 2.182 -.54"},child:[]},{tag:"path",attr:{d:"M16 19h6"},child:[]},{tag:"path",attr:{d:"M19 16v6"},child:[]}]})(o)}function uM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 8h.01"},child:[]},{tag:"path",attr:{d:"M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z"},child:[]},{tag:"path",attr:{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5"},child:[]},{tag:"path",attr:{d:"M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3"},child:[]}]})(o)}function ix(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 5l0 14"},child:[]},{tag:"path",attr:{d:"M5 12l14 0"},child:[]}]})(o)}function sE(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"},child:[]},{tag:"path",attr:{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"},child:[]}]})(o)}function py(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"},child:[]},{tag:"path",attr:{d:"M21 21l-6 -6"},child:[]}]})(o)}function QL(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"},child:[]},{tag:"path",attr:{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"},child:[]}]})(o)}function dM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 9h-1a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-8a2 2 0 0 0 -2 -2h-1"},child:[]},{tag:"path",attr:{d:"M12 14v-11"},child:[]},{tag:"path",attr:{d:"M9 6l3 -3l3 3"},child:[]}]})(o)}function vy(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"},child:[]}]})(o)}function eO(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 5l0 2"},child:[]},{tag:"path",attr:{d:"M15 11l0 2"},child:[]},{tag:"path",attr:{d:"M15 17l0 2"},child:[]},{tag:"path",attr:{d:"M5 5h14a2 2 0 0 1 2 2v3a2 2 0 0 0 0 4v3a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-3a2 2 0 0 0 0 -4v-3a2 2 0 0 1 2 -2"},child:[]}]})(o)}function tO(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 7l16 0"},child:[]},{tag:"path",attr:{d:"M10 11l0 6"},child:[]},{tag:"path",attr:{d:"M14 11l0 6"},child:[]},{tag:"path",attr:{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"},child:[]},{tag:"path",attr:{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"},child:[]}]})(o)}function iO(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"},child:[]},{tag:"path",attr:{d:"M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"},child:[]},{tag:"path",attr:{d:"M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855"},child:[]}]})(o)}function nb(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"},child:[]},{tag:"path",attr:{d:"M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"},child:[]},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"},child:[]},{tag:"path",attr:{d:"M21 21v-2a4 4 0 0 0 -3 -3.85"},child:[]}]})(o)}function nO(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 4m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M7 21l3 -4"},child:[]},{tag:"path",attr:{d:"M16 21l-2 -4l-3 -3l1 -6"},child:[]},{tag:"path",attr:{d:"M6 12l2 -3l4 -1l3 3l3 1"},child:[]}]})(o)}function hM(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"},child:[]},{tag:"path",attr:{d:"M3.6 9h16.8"},child:[]},{tag:"path",attr:{d:"M3.6 15h16.8"},child:[]},{tag:"path",attr:{d:"M11.5 3a17 17 0 0 0 0 18"},child:[]},{tag:"path",attr:{d:"M12.5 3a17 17 0 0 1 0 18"},child:[]}]})(o)}function Od(o){return Cn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 6l-12 12"},child:[]},{tag:"path",attr:{d:"M6 6l12 12"},child:[]}]})(o)}const aO=()=>{ye.useEffect(()=>{const r=document.getElementById("navbar");if(r){const c=()=>{document.documentElement.style.setProperty("--navbar-height",`${r.offsetHeight}px`)};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)}},[]);const o=[{id:"home",label:"Home",icon:C.jsx(GL,{}),path:"/"},{id:"search",label:"Search",icon:C.jsx(py,{}),path:"/search"},{id:"map",label:"Map",icon:C.jsx(ZL,{}),path:"/map"},{id:"community",label:"Community",icon:C.jsx(RL,{}),path:"/community"},{id:"profile",label:"Profile",icon:C.jsx(iO,{}),path:"/profile"}];return C.jsx("nav",{id:"navbar",className:"fixed bottom-0 left-0 right-0 border-t border-gray-200 shadow-md bg-[var(--white)] font-inter z-50",children:C.jsx("ul",{className:"flex justify-around items-center py-2",children:o.map(r=>C.jsx("li",{className:"flex flex-col items-center",children:C.jsxs(fo,{to:r.path,className:({isActive:c})=>`flex flex-col items-center cursor-pointer transition-colors duration-200 ${c?"text-[var(--orange)]":"text-[var(--black)]"}`,children:[C.jsx("div",{className:"text-lg",children:r.icon}),C.jsx("span",{className:"text-[10px] mt-1",children:r.label})]})},r.id))})})};function rO({market:o,onClose:r}){const[c,h]=ye.useState(10),p=14,x=2*Math.PI*p,S=c/10*x;return ye.useEffect(()=>{const i=setInterval(()=>{h(M=>(M<=1&&(clearInterval(i),r()),M-1))},1e3);return()=>clearInterval(i)},[r]),C.jsxs("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",background:"white",padding:"16px 28px",borderRadius:"20px",boxShadow:"0 6px 25px rgba(0,0,0,0.18)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"space-between",minWidth:"360px",maxWidth:"90vw",gap:"18px"},children:[C.jsxs("div",{style:{flex:1},children:[C.jsxs("h3",{style:{margin:0,fontWeight:"bold"},children:["You're at ",o.name," "]}),C.jsx("p",{style:{marginTop:"6px",marginBottom:0},children:"Youve entered an open market area."})]}),C.jsxs("div",{onClick:r,style:{width:"36px",height:"36px",borderRadius:"50%",cursor:"pointer",position:"relative"},children:[C.jsxs("svg",{width:"36",height:"36",children:[C.jsx("circle",{cx:"18",cy:"18",r:p,fill:"none",stroke:"#e5e7eb",strokeWidth:"4"}),C.jsx("circle",{cx:"18",cy:"18",r:p,fill:"none",stroke:"#007bff",strokeWidth:"4",strokeDasharray:x,strokeDashoffset:x-S,strokeLinecap:"round",style:{transition:"stroke-dashoffset 1s linear"}})]}),C.jsx(Od,{size:20,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",pointerEvents:"none"}})]})]})}const fM=ye.createContext();function sO({children:o}){const[r,c]=ye.useState(null),[h,p]=ye.useState(!0);return ye.useEffect(()=>{navigator.geolocation.getCurrentPosition(x=>{const S={lat:x.coords.latitude,lng:x.coords.longitude};c(S),p(!1),console.log("[Global LocationContext] location set:",S)},x=>{console.error("[Global LocationContext] location error:",x),p(!1)})},[]),C.jsx(fM.Provider,{value:{location:r,loading:h,setLocation:c},children:o})}function mM(){return ye.useContext(fM)}const xy=(o=null,r=null)=>{const[c,h]=ye.useState([]),[p,x]=ye.useState(!1),[S,i]=ye.useState(null),M="/v1",{location:P,loading:N}=mM(),H=r||P;return ye.useEffect(()=>{if(N)return;if(!H){x(!1);return}(async()=>{try{x(!0),i(null);const{lat:K,lng:re}=H;let ae=`${M}/market?user_latitude=${K}&user_longitude=${re}`;o&&(ae+=`&limit=${o}`);const ce=await fetch(ae);if(!ce.ok)throw new Error(`HTTP error: ${ce.status}`);const ve=await ce.json();h(ve)}catch(K){i(K.message)}finally{x(!1)}})()},[M,o,H]),{markets:c,loading:p,error:S}},oO="modulepreload",lO=function(o){return"/"+o},oE={},mx=function(r,c,h){let p=Promise.resolve();if(c&&c.length>0){let P=function(N){return Promise.all(N.map(H=>Promise.resolve(H).then(W=>({status:"fulfilled",value:W}),W=>({status:"rejected",reason:W}))))};var S=P;document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),M=i?.nonce||i?.getAttribute("nonce");p=P(c.map(N=>{if(N=lO(N),N in oE)return;oE[N]=!0;const H=N.endsWith(".css"),W=H?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${N}"]${W}`))return;const K=document.createElement("link");if(K.rel=H?"stylesheet":oO,H||(K.as="script"),K.crossOrigin="",K.href=N,M&&K.setAttribute("nonce",M),document.head.appendChild(K),H)return new Promise((re,ae)=>{K.addEventListener("load",re),K.addEventListener("error",()=>ae(new Error(`Unable to preload CSS for ${N}`)))})}))}function x(i){const M=new Event("vite:preloadError",{cancelable:!0});if(M.payload=i,window.dispatchEvent(M),!M.defaultPrevented)throw i}return p.then(i=>{for(const M of i||[])M.status==="rejected"&&x(M.reason);return r().catch(x)})},cO=o=>{let r;return o?r=o:typeof fetch>"u"?r=(...c)=>mx(async()=>{const{default:h}=await Promise.resolve().then(()=>by);return{default:h}},[]).then(({default:h})=>h(...c)):r=fetch,(...c)=>r(...c)};class wS extends Error{constructor(r,c="FunctionsError",h){super(r),this.name=c,this.context=h}}class lE extends wS{constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class cE extends wS{constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class uE extends wS{constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}var $1;(function(o){o.Any="any",o.ApNortheast1="ap-northeast-1",o.ApNortheast2="ap-northeast-2",o.ApSouth1="ap-south-1",o.ApSoutheast1="ap-southeast-1",o.ApSoutheast2="ap-southeast-2",o.CaCentral1="ca-central-1",o.EuCentral1="eu-central-1",o.EuWest1="eu-west-1",o.EuWest2="eu-west-2",o.EuWest3="eu-west-3",o.SaEast1="sa-east-1",o.UsEast1="us-east-1",o.UsWest1="us-west-1",o.UsWest2="us-west-2"})($1||($1={}));var uO=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};class dO{constructor(r,{headers:c={},customFetch:h,region:p=$1.Any}={}){this.url=r,this.headers=c,this.region=p,this.fetch=cO(h)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r){return uO(this,arguments,void 0,function*(c,h={}){var p;try{const{headers:x,method:S,body:i,signal:M}=h;let P={},{region:N}=h;N||(N=this.region);const H=new URL(`${this.url}/${c}`);N&&N!=="any"&&(P["x-region"]=N,H.searchParams.set("forceFunctionRegion",N));let W;i&&(x&&!Object.prototype.hasOwnProperty.call(x,"Content-Type")||!x)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(P["Content-Type"]="application/octet-stream",W=i):typeof i=="string"?(P["Content-Type"]="text/plain",W=i):typeof FormData<"u"&&i instanceof FormData?W=i:(P["Content-Type"]="application/json",W=JSON.stringify(i)));const K=yield this.fetch(H.toString(),{method:S||"POST",headers:Object.assign(Object.assign(Object.assign({},P),this.headers),x),body:W,signal:M}).catch(ve=>{throw ve.name==="AbortError"?ve:new lE(ve)}),re=K.headers.get("x-relay-error");if(re&&re==="true")throw new cE(K);if(!K.ok)throw new uE(K);let ae=((p=K.headers.get("Content-Type"))!==null&&p!==void 0?p:"text/plain").split(";")[0].trim(),ce;return ae==="application/json"?ce=yield K.json():ae==="application/octet-stream"?ce=yield K.blob():ae==="text/event-stream"?ce=K:ae==="multipart/form-data"?ce=yield K.formData():ce=yield K.text(),{data:ce,error:null,response:K}}catch(x){return x instanceof Error&&x.name==="AbortError"?{data:null,error:new lE(x)}:{data:null,error:x,response:x instanceof uE||x instanceof cE?x.context:void 0}}})}}var jl={},W_={},Z_={},X_={},Y_={},K_={},hO=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},gy=hO();const fO=gy.fetch,pM=gy.fetch.bind(gy),gM=gy.Headers,mO=gy.Request,pO=gy.Response,by=Object.freeze(Object.defineProperty({__proto__:null,Headers:gM,Request:mO,Response:pO,default:pM,fetch:fO},Symbol.toStringTag,{value:"Module"})),gO=WI(by);var k0={},dE;function _M(){if(dE)return k0;dE=1,Object.defineProperty(k0,"__esModule",{value:!0});class o extends Error{constructor(c){super(c.message),this.name="PostgrestError",this.details=c.details,this.hint=c.hint,this.code=c.code}}return k0.default=o,k0}var hE;function yM(){if(hE)return K_;hE=1;var o=K_&&K_.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(K_,"__esModule",{value:!0});const r=o(gO),c=o(_M());class h{constructor(x){var S,i;this.shouldThrowOnError=!1,this.method=x.method,this.url=x.url,this.headers=new Headers(x.headers),this.schema=x.schema,this.body=x.body,this.shouldThrowOnError=(S=x.shouldThrowOnError)!==null&&S!==void 0?S:!1,this.signal=x.signal,this.isMaybeSingle=(i=x.isMaybeSingle)!==null&&i!==void 0?i:!1,x.fetch?this.fetch=x.fetch:typeof fetch>"u"?this.fetch=r.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(x,S){return this.headers=new Headers(this.headers),this.headers.set(x,S),this}then(x,S){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let M=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async P=>{var N,H,W,K;let re=null,ae=null,ce=null,ve=P.status,Se=P.statusText;if(P.ok){if(this.method!=="HEAD"){const ke=await P.text();ke===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((N=this.headers.get("Accept"))===null||N===void 0)&&N.includes("application/vnd.pgrst.plan+text"))?ae=ke:ae=JSON.parse(ke))}const Qe=(H=this.headers.get("Prefer"))===null||H===void 0?void 0:H.match(/count=(exact|planned|estimated)/),He=(W=P.headers.get("content-range"))===null||W===void 0?void 0:W.split("/");Qe&&He&&He.length>1&&(ce=parseInt(He[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(ae)&&(ae.length>1?(re={code:"PGRST116",details:`Results contain ${ae.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},ae=null,ce=null,ve=406,Se="Not Acceptable"):ae.length===1?ae=ae[0]:ae=null)}else{const Qe=await P.text();try{re=JSON.parse(Qe),Array.isArray(re)&&P.status===404&&(ae=[],re=null,ve=200,Se="OK")}catch{P.status===404&&Qe===""?(ve=204,Se="No Content"):re={message:Qe}}if(re&&this.isMaybeSingle&&(!((K=re?.details)===null||K===void 0)&&K.includes("0 rows"))&&(re=null,ve=200,Se="OK"),re&&this.shouldThrowOnError)throw new c.default(re)}return{error:re,data:ae,count:ce,status:ve,statusText:Se}});return this.shouldThrowOnError||(M=M.catch(P=>{var N,H,W;return{error:{message:`${(N=P?.name)!==null&&N!==void 0?N:"FetchError"}: ${P?.message}`,details:`${(H=P?.stack)!==null&&H!==void 0?H:""}`,hint:"",code:`${(W=P?.code)!==null&&W!==void 0?W:""}`},data:null,count:null,status:0,statusText:""}})),M.then(x,S)}returns(){return this}overrideTypes(){return this}}return K_.default=h,K_}var fE;function vM(){if(fE)return Y_;fE=1;var o=Y_&&Y_.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Y_,"__esModule",{value:!0});const r=o(yM());class c extends r.default{select(p){let x=!1;const S=(p??"*").split("").map(i=>/\s/.test(i)&&!x?"":(i==='"'&&(x=!x),i)).join("");return this.url.searchParams.set("select",S),this.headers.append("Prefer","return=representation"),this}order(p,{ascending:x=!0,nullsFirst:S,foreignTable:i,referencedTable:M=i}={}){const P=M?`${M}.order`:"order",N=this.url.searchParams.get(P);return this.url.searchParams.set(P,`${N?`${N},`:""}${p}.${x?"asc":"desc"}${S===void 0?"":S?".nullsfirst":".nullslast"}`),this}limit(p,{foreignTable:x,referencedTable:S=x}={}){const i=typeof S>"u"?"limit":`${S}.limit`;return this.url.searchParams.set(i,`${p}`),this}range(p,x,{foreignTable:S,referencedTable:i=S}={}){const M=typeof i>"u"?"offset":`${i}.offset`,P=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(M,`${p}`),this.url.searchParams.set(P,`${x-p+1}`),this}abortSignal(p){return this.signal=p,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:p=!1,verbose:x=!1,settings:S=!1,buffers:i=!1,wal:M=!1,format:P="text"}={}){var N;const H=[p?"analyze":null,x?"verbose":null,S?"settings":null,i?"buffers":null,M?"wal":null].filter(Boolean).join("|"),W=(N=this.headers.get("Accept"))!==null&&N!==void 0?N:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${P}; for="${W}"; options=${H};`),P==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(p){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${p}`),this}}return Y_.default=c,Y_}var mE;function SS(){if(mE)return X_;mE=1;var o=X_&&X_.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(X_,"__esModule",{value:!0});const r=o(vM());class c extends r.default{eq(p,x){return this.url.searchParams.append(p,`eq.${x}`),this}neq(p,x){return this.url.searchParams.append(p,`neq.${x}`),this}gt(p,x){return this.url.searchParams.append(p,`gt.${x}`),this}gte(p,x){return this.url.searchParams.append(p,`gte.${x}`),this}lt(p,x){return this.url.searchParams.append(p,`lt.${x}`),this}lte(p,x){return this.url.searchParams.append(p,`lte.${x}`),this}like(p,x){return this.url.searchParams.append(p,`like.${x}`),this}likeAllOf(p,x){return this.url.searchParams.append(p,`like(all).{${x.join(",")}}`),this}likeAnyOf(p,x){return this.url.searchParams.append(p,`like(any).{${x.join(",")}}`),this}ilike(p,x){return this.url.searchParams.append(p,`ilike.${x}`),this}ilikeAllOf(p,x){return this.url.searchParams.append(p,`ilike(all).{${x.join(",")}}`),this}ilikeAnyOf(p,x){return this.url.searchParams.append(p,`ilike(any).{${x.join(",")}}`),this}is(p,x){return this.url.searchParams.append(p,`is.${x}`),this}in(p,x){const S=Array.from(new Set(x)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(p,`in.(${S})`),this}contains(p,x){return typeof x=="string"?this.url.searchParams.append(p,`cs.${x}`):Array.isArray(x)?this.url.searchParams.append(p,`cs.{${x.join(",")}}`):this.url.searchParams.append(p,`cs.${JSON.stringify(x)}`),this}containedBy(p,x){return typeof x=="string"?this.url.searchParams.append(p,`cd.${x}`):Array.isArray(x)?this.url.searchParams.append(p,`cd.{${x.join(",")}}`):this.url.searchParams.append(p,`cd.${JSON.stringify(x)}`),this}rangeGt(p,x){return this.url.searchParams.append(p,`sr.${x}`),this}rangeGte(p,x){return this.url.searchParams.append(p,`nxl.${x}`),this}rangeLt(p,x){return this.url.searchParams.append(p,`sl.${x}`),this}rangeLte(p,x){return this.url.searchParams.append(p,`nxr.${x}`),this}rangeAdjacent(p,x){return this.url.searchParams.append(p,`adj.${x}`),this}overlaps(p,x){return typeof x=="string"?this.url.searchParams.append(p,`ov.${x}`):this.url.searchParams.append(p,`ov.{${x.join(",")}}`),this}textSearch(p,x,{config:S,type:i}={}){let M="";i==="plain"?M="pl":i==="phrase"?M="ph":i==="websearch"&&(M="w");const P=S===void 0?"":`(${S})`;return this.url.searchParams.append(p,`${M}fts${P}.${x}`),this}match(p){return Object.entries(p).forEach(([x,S])=>{this.url.searchParams.append(x,`eq.${S}`)}),this}not(p,x,S){return this.url.searchParams.append(p,`not.${x}.${S}`),this}or(p,{foreignTable:x,referencedTable:S=x}={}){const i=S?`${S}.or`:"or";return this.url.searchParams.append(i,`(${p})`),this}filter(p,x,S){return this.url.searchParams.append(p,`${x}.${S}`),this}}return X_.default=c,X_}var pE;function xM(){if(pE)return Z_;pE=1;var o=Z_&&Z_.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Z_,"__esModule",{value:!0});const r=o(SS());class c{constructor(p,{headers:x={},schema:S,fetch:i}){this.url=p,this.headers=new Headers(x),this.schema=S,this.fetch=i}select(p,x){const{head:S=!1,count:i}=x??{},M=S?"HEAD":"GET";let P=!1;const N=(p??"*").split("").map(H=>/\s/.test(H)&&!P?"":(H==='"'&&(P=!P),H)).join("");return this.url.searchParams.set("select",N),i&&this.headers.append("Prefer",`count=${i}`),new r.default({method:M,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(p,{count:x,defaultToNull:S=!0}={}){var i;const M="POST";if(x&&this.headers.append("Prefer",`count=${x}`),S||this.headers.append("Prefer","missing=default"),Array.isArray(p)){const P=p.reduce((N,H)=>N.concat(Object.keys(H)),[]);if(P.length>0){const N=[...new Set(P)].map(H=>`"${H}"`);this.url.searchParams.set("columns",N.join(","))}}return new r.default({method:M,url:this.url,headers:this.headers,schema:this.schema,body:p,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(p,{onConflict:x,ignoreDuplicates:S=!1,count:i,defaultToNull:M=!0}={}){var P;const N="POST";if(this.headers.append("Prefer",`resolution=${S?"ignore":"merge"}-duplicates`),x!==void 0&&this.url.searchParams.set("on_conflict",x),i&&this.headers.append("Prefer",`count=${i}`),M||this.headers.append("Prefer","missing=default"),Array.isArray(p)){const H=p.reduce((W,K)=>W.concat(Object.keys(K)),[]);if(H.length>0){const W=[...new Set(H)].map(K=>`"${K}"`);this.url.searchParams.set("columns",W.join(","))}}return new r.default({method:N,url:this.url,headers:this.headers,schema:this.schema,body:p,fetch:(P=this.fetch)!==null&&P!==void 0?P:fetch})}update(p,{count:x}={}){var S;const i="PATCH";return x&&this.headers.append("Prefer",`count=${x}`),new r.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:p,fetch:(S=this.fetch)!==null&&S!==void 0?S:fetch})}delete({count:p}={}){var x;const S="DELETE";return p&&this.headers.append("Prefer",`count=${p}`),new r.default({method:S,url:this.url,headers:this.headers,schema:this.schema,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}}return Z_.default=c,Z_}var gE;function _O(){if(gE)return W_;gE=1;var o=W_&&W_.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(W_,"__esModule",{value:!0});const r=o(xM()),c=o(SS());class h{constructor(x,{headers:S={},schema:i,fetch:M}={}){this.url=x,this.headers=new Headers(S),this.schemaName=i,this.fetch=M}from(x){const S=new URL(`${this.url}/${x}`);return new r.default(S,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(x){return new h(this.url,{headers:this.headers,schema:x,fetch:this.fetch})}rpc(x,S={},{head:i=!1,get:M=!1,count:P}={}){var N;let H;const W=new URL(`${this.url}/rpc/${x}`);let K;i||M?(H=i?"HEAD":"GET",Object.entries(S).filter(([ae,ce])=>ce!==void 0).map(([ae,ce])=>[ae,Array.isArray(ce)?`{${ce.join(",")}}`:`${ce}`]).forEach(([ae,ce])=>{W.searchParams.append(ae,ce)})):(H="POST",K=S);const re=new Headers(this.headers);return P&&re.set("Prefer",`count=${P}`),new c.default({method:H,url:W,headers:re,schema:this.schemaName,body:K,fetch:(N=this.fetch)!==null&&N!==void 0?N:fetch})}}return W_.default=h,W_}var _E;function yO(){if(_E)return jl;_E=1;var o=jl&&jl.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(jl,"__esModule",{value:!0}),jl.PostgrestError=jl.PostgrestBuilder=jl.PostgrestTransformBuilder=jl.PostgrestFilterBuilder=jl.PostgrestQueryBuilder=jl.PostgrestClient=void 0;const r=o(_O());jl.PostgrestClient=r.default;const c=o(xM());jl.PostgrestQueryBuilder=c.default;const h=o(SS());jl.PostgrestFilterBuilder=h.default;const p=o(vM());jl.PostgrestTransformBuilder=p.default;const x=o(yM());jl.PostgrestBuilder=x.default;const S=o(_M());return jl.PostgrestError=S.default,jl.default={PostgrestClient:r.default,PostgrestQueryBuilder:c.default,PostgrestFilterBuilder:h.default,PostgrestTransformBuilder:p.default,PostgrestBuilder:x.default,PostgrestError:S.default},jl}var vO=yO();const xO=Cb(vO),{PostgrestClient:bO,PostgrestQueryBuilder:bV,PostgrestFilterBuilder:wV,PostgrestTransformBuilder:SV,PostgrestBuilder:TV,PostgrestError:kV}=xO;class wO{static detectEnvironment(){var r;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((r=navigator.userAgent)===null||r===void 0)&&r.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const c=process.versions;if(c&&c.node){const h=c.node,p=parseInt(h.replace(/^v/,"").split(".")[0]);return p>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${p} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${p} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const r=this.detectEnvironment();if(r.constructor)return r.constructor;let c=r.error||"WebSocket not supported in this environment.";throw r.workaround&&(c+=`

Suggested solution: ${r.workaround}`),new Error(c)}static createWebSocket(r,c){const h=this.getWebSocketConstructor();return new h(r,c)}static isWebSocketSupported(){try{const r=this.detectEnvironment();return r.type==="native"||r.type==="ws"}catch{return!1}}}const SO="2.74.0",TO=`realtime-js/${SO}`,kO="1.0.0",V1=1e4,EO=1e3,AO=100;var qv;(function(o){o[o.connecting=0]="connecting",o[o.open=1]="open",o[o.closing=2]="closing",o[o.closed=3]="closed"})(qv||(qv={}));var ll;(function(o){o.closed="closed",o.errored="errored",o.joined="joined",o.joining="joining",o.leaving="leaving"})(ll||(ll={}));var xh;(function(o){o.close="phx_close",o.error="phx_error",o.join="phx_join",o.reply="phx_reply",o.leave="phx_leave",o.access_token="access_token"})(xh||(xh={}));var H1;(function(o){o.websocket="websocket"})(H1||(H1={}));var Vg;(function(o){o.Connecting="connecting",o.Open="open",o.Closing="closing",o.Closed="closed"})(Vg||(Vg={}));class CO{constructor(){this.HEADER_LENGTH=1}decode(r,c){return r.constructor===ArrayBuffer?c(this._binaryDecode(r)):c(typeof r=="string"?JSON.parse(r):{})}_binaryDecode(r){const c=new DataView(r),h=new TextDecoder;return this._decodeBroadcast(r,c,h)}_decodeBroadcast(r,c,h){const p=c.getUint8(1),x=c.getUint8(2);let S=this.HEADER_LENGTH+2;const i=h.decode(r.slice(S,S+p));S=S+p;const M=h.decode(r.slice(S,S+x));S=S+x;const P=JSON.parse(h.decode(r.slice(S,r.byteLength)));return{ref:null,topic:i,event:M,payload:P}}}class bM{constructor(r,c){this.callback=r,this.timerCalc=c,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=c}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var xs;(function(o){o.abstime="abstime",o.bool="bool",o.date="date",o.daterange="daterange",o.float4="float4",o.float8="float8",o.int2="int2",o.int4="int4",o.int4range="int4range",o.int8="int8",o.int8range="int8range",o.json="json",o.jsonb="jsonb",o.money="money",o.numeric="numeric",o.oid="oid",o.reltime="reltime",o.text="text",o.time="time",o.timestamp="timestamp",o.timestamptz="timestamptz",o.timetz="timetz",o.tsrange="tsrange",o.tstzrange="tstzrange"})(xs||(xs={}));const yE=(o,r,c={})=>{var h;const p=(h=c.skipTypes)!==null&&h!==void 0?h:[];return r?Object.keys(r).reduce((x,S)=>(x[S]=MO(S,o,r,p),x),{}):{}},MO=(o,r,c,h)=>{const p=r.find(i=>i.name===o),x=p?.type,S=c[o];return x&&!h.includes(x)?wM(x,S):G1(S)},wM=(o,r)=>{if(o.charAt(0)==="_"){const c=o.slice(1,o.length);return IO(r,c)}switch(o){case xs.bool:return PO(r);case xs.float4:case xs.float8:case xs.int2:case xs.int4:case xs.int8:case xs.numeric:case xs.oid:return jO(r);case xs.json:case xs.jsonb:return zO(r);case xs.timestamp:return RO(r);case xs.abstime:case xs.date:case xs.daterange:case xs.int4range:case xs.int8range:case xs.money:case xs.reltime:case xs.text:case xs.time:case xs.timestamptz:case xs.timetz:case xs.tsrange:case xs.tstzrange:return G1(r);default:return G1(r)}},G1=o=>o,PO=o=>{switch(o){case"t":return!0;case"f":return!1;default:return o}},jO=o=>{if(typeof o=="string"){const r=parseFloat(o);if(!Number.isNaN(r))return r}return o},zO=o=>{if(typeof o=="string")try{return JSON.parse(o)}catch(r){return console.log(`JSON parse error: ${r}`),o}return o},IO=(o,r)=>{if(typeof o!="string")return o;const c=o.length-1,h=o[c];if(o[0]==="{"&&h==="}"){let x;const S=o.slice(1,c);try{x=JSON.parse("["+S+"]")}catch{x=S?S.split(","):[]}return x.map(i=>wM(r,i))}return o},RO=o=>typeof o=="string"?o.replace(" ","T"):o,SM=o=>{let r=o;return r=r.replace(/^ws/i,"http"),r=r.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),r.replace(/\/+$/,"")+"/api/broadcast"};class n1{constructor(r,c,h={},p=V1){this.channel=r,this.event=c,this.payload=h,this.timeout=p,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,c){var h;return this._hasReceived(r)&&c((h=this.receivedResp)===null||h===void 0?void 0:h.response),this.recHooks.push({status:r,callback:c}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const r=c=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=c,this._matchReceive(c)};this.channel._on(this.refEvent,{},r),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(r,c){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:c})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:c}){this.recHooks.filter(h=>h.status===r).forEach(h=>h.callback(c))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}var vE;(function(o){o.SYNC="sync",o.JOIN="join",o.LEAVE="leave"})(vE||(vE={}));class Wv{constructor(r,c){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const h=c?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(h.state,{},p=>{const{onJoin:x,onLeave:S,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Wv.syncState(this.state,p,x,S),this.pendingDiffs.forEach(M=>{this.state=Wv.syncDiff(this.state,M,x,S)}),this.pendingDiffs=[],i()}),this.channel._on(h.diff,{},p=>{const{onJoin:x,onLeave:S,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(p):(this.state=Wv.syncDiff(this.state,p,x,S),i())}),this.onJoin((p,x,S)=>{this.channel._trigger("presence",{event:"join",key:p,currentPresences:x,newPresences:S})}),this.onLeave((p,x,S)=>{this.channel._trigger("presence",{event:"leave",key:p,currentPresences:x,leftPresences:S})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,c,h,p){const x=this.cloneDeep(r),S=this.transformState(c),i={},M={};return this.map(x,(P,N)=>{S[P]||(M[P]=N)}),this.map(S,(P,N)=>{const H=x[P];if(H){const W=N.map(ce=>ce.presence_ref),K=H.map(ce=>ce.presence_ref),re=N.filter(ce=>K.indexOf(ce.presence_ref)<0),ae=H.filter(ce=>W.indexOf(ce.presence_ref)<0);re.length>0&&(i[P]=re),ae.length>0&&(M[P]=ae)}else i[P]=N}),this.syncDiff(x,{joins:i,leaves:M},h,p)}static syncDiff(r,c,h,p){const{joins:x,leaves:S}={joins:this.transformState(c.joins),leaves:this.transformState(c.leaves)};return h||(h=()=>{}),p||(p=()=>{}),this.map(x,(i,M)=>{var P;const N=(P=r[i])!==null&&P!==void 0?P:[];if(r[i]=this.cloneDeep(M),N.length>0){const H=r[i].map(K=>K.presence_ref),W=N.filter(K=>H.indexOf(K.presence_ref)<0);r[i].unshift(...W)}h(i,N,M)}),this.map(S,(i,M)=>{let P=r[i];if(!P)return;const N=M.map(H=>H.presence_ref);P=P.filter(H=>N.indexOf(H.presence_ref)<0),r[i]=P,p(i,P,M),P.length===0&&delete r[i]}),r}static map(r,c){return Object.getOwnPropertyNames(r).map(h=>c(h,r[h]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((c,h)=>{const p=r[h];return"metas"in p?c[h]=p.metas.map(x=>(x.presence_ref=x.phx_ref,delete x.phx_ref,delete x.phx_ref_prev,x)):c[h]=p,c},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var xE;(function(o){o.ALL="*",o.INSERT="INSERT",o.UPDATE="UPDATE",o.DELETE="DELETE"})(xE||(xE={}));var Zv;(function(o){o.BROADCAST="broadcast",o.PRESENCE="presence",o.POSTGRES_CHANGES="postgres_changes",o.SYSTEM="system"})(Zv||(Zv={}));var wm;(function(o){o.SUBSCRIBED="SUBSCRIBED",o.TIMED_OUT="TIMED_OUT",o.CLOSED="CLOSED",o.CHANNEL_ERROR="CHANNEL_ERROR"})(wm||(wm={}));class TS{constructor(r,c={config:{}},h){var p,x;if(this.topic=r,this.params=c,this.socket=h,this.bindings={},this.state=ll.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=r.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},c.config),this.timeout=this.socket.timeout,this.joinPush=new n1(this,xh.join,this.params,this.timeout),this.rejoinTimer=new bM(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ll.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(S=>S.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ll.closed,this.socket._remove(this)}),this._onError(S=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,S),this.state=ll.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ll.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",S=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,S),this.state=ll.errored,this.rejoinTimer.scheduleTimeout())}),this._on(xh.reply,{},(S,i)=>{this._trigger(this._replyEventName(i),S)}),this.presence=new Wv(this),this.broadcastEndpointURL=SM(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((x=(p=this.params.config)===null||p===void 0?void 0:p.broadcast)===null||x===void 0)&&x.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(r,c=this.timeout){var h,p,x;if(this.socket.isConnected()||this.socket.connect(),this.state==ll.closed){const{config:{broadcast:S,presence:i,private:M}}=this.params,P=(p=(h=this.bindings.postgres_changes)===null||h===void 0?void 0:h.map(K=>K.filter))!==null&&p!==void 0?p:[],N=!!this.bindings[Zv.PRESENCE]&&this.bindings[Zv.PRESENCE].length>0||((x=this.params.config.presence)===null||x===void 0?void 0:x.enabled)===!0,H={},W={broadcast:S,presence:Object.assign(Object.assign({},i),{enabled:N}),postgres_changes:P,private:M};this.socket.accessTokenValue&&(H.access_token=this.socket.accessTokenValue),this._onError(K=>r?.(wm.CHANNEL_ERROR,K)),this._onClose(()=>r?.(wm.CLOSED)),this.updateJoinPayload(Object.assign({config:W},H)),this.joinedOnce=!0,this._rejoin(c),this.joinPush.receive("ok",async({postgres_changes:K})=>{var re;if(this.socket.setAuth(),K===void 0){r?.(wm.SUBSCRIBED);return}else{const ae=this.bindings.postgres_changes,ce=(re=ae?.length)!==null&&re!==void 0?re:0,ve=[];for(let Se=0;Se<ce;Se++){const Ee=ae[Se],{filter:{event:Qe,schema:He,table:ke,filter:tt}}=Ee,Ke=K&&K[Se];if(Ke&&Ke.event===Qe&&Ke.schema===He&&Ke.table===ke&&Ke.filter===tt)ve.push(Object.assign(Object.assign({},Ee),{id:Ke.id}));else{this.unsubscribe(),this.state=ll.errored,r?.(wm.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=ve,r&&r(wm.SUBSCRIBED);return}}).receive("error",K=>{this.state=ll.errored,r?.(wm.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(K).join(", ")||"error")))}).receive("timeout",()=>{r?.(wm.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(r,c={}){return await this.send({type:"presence",event:"track",payload:r},c.timeout||this.timeout)}async untrack(r={}){return await this.send({type:"presence",event:"untrack"},r)}on(r,c,h){return this.state===ll.joined&&r===Zv.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(r,c,h)}async send(r,c={}){var h,p;if(!this._canPush()&&r.type==="broadcast"){const{event:x,payload:S}=r,M={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:x,payload:S,private:this.private}]})};try{const P=await this._fetchWithTimeout(this.broadcastEndpointURL,M,(h=c.timeout)!==null&&h!==void 0?h:this.timeout);return await((p=P.body)===null||p===void 0?void 0:p.cancel()),P.ok?"ok":"error"}catch(P){return P.name==="AbortError"?"timed out":"error"}}else return new Promise(x=>{var S,i,M;const P=this._push(r.type,r,c.timeout||this.timeout);r.type==="broadcast"&&!(!((M=(i=(S=this.params)===null||S===void 0?void 0:S.config)===null||i===void 0?void 0:i.broadcast)===null||M===void 0)&&M.ack)&&x("ok"),P.receive("ok",()=>x("ok")),P.receive("error",()=>x("error")),P.receive("timeout",()=>x("timed out"))})}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=ll.leaving;const c=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(xh.close,"leave",this._joinRef())};this.joinPush.destroy();let h=null;return new Promise(p=>{h=new n1(this,xh.leave,{},r),h.receive("ok",()=>{c(),p("ok")}).receive("timeout",()=>{c(),p("timed out")}).receive("error",()=>{p("error")}),h.send(),this._canPush()||h.trigger("ok",{})}).finally(()=>{h?.destroy()})}teardown(){this.pushBuffer.forEach(r=>r.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ll.closed,this.bindings={}}async _fetchWithTimeout(r,c,h){const p=new AbortController,x=setTimeout(()=>p.abort(),h),S=await this.socket.fetch(r,Object.assign(Object.assign({},c),{signal:p.signal}));return clearTimeout(x),S}_push(r,c,h=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let p=new n1(this,r,c,h);return this._canPush()?p.send():this._addToPushBuffer(p),p}_addToPushBuffer(r){if(r.startTimeout(),this.pushBuffer.push(r),this.pushBuffer.length>AO){const c=this.pushBuffer.shift();c&&(c.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${c.event}`,c.payload))}}_onMessage(r,c,h){return c}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,c,h){var p,x;const S=r.toLocaleLowerCase(),{close:i,error:M,leave:P,join:N}=xh;if(h&&[i,M,P,N].indexOf(S)>=0&&h!==this._joinRef())return;let W=this._onMessage(S,c,h);if(c&&!W)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(S)?(p=this.bindings.postgres_changes)===null||p===void 0||p.filter(K=>{var re,ae,ce;return((re=K.filter)===null||re===void 0?void 0:re.event)==="*"||((ce=(ae=K.filter)===null||ae===void 0?void 0:ae.event)===null||ce===void 0?void 0:ce.toLocaleLowerCase())===S}).map(K=>K.callback(W,h)):(x=this.bindings[S])===null||x===void 0||x.filter(K=>{var re,ae,ce,ve,Se,Ee;if(["broadcast","presence","postgres_changes"].includes(S))if("id"in K){const Qe=K.id,He=(re=K.filter)===null||re===void 0?void 0:re.event;return Qe&&((ae=c.ids)===null||ae===void 0?void 0:ae.includes(Qe))&&(He==="*"||He?.toLocaleLowerCase()===((ce=c.data)===null||ce===void 0?void 0:ce.type.toLocaleLowerCase()))}else{const Qe=(Se=(ve=K?.filter)===null||ve===void 0?void 0:ve.event)===null||Se===void 0?void 0:Se.toLocaleLowerCase();return Qe==="*"||Qe===((Ee=c?.event)===null||Ee===void 0?void 0:Ee.toLocaleLowerCase())}else return K.type.toLocaleLowerCase()===S}).map(K=>{if(typeof W=="object"&&"ids"in W){const re=W.data,{schema:ae,table:ce,commit_timestamp:ve,type:Se,errors:Ee}=re;W=Object.assign(Object.assign({},{schema:ae,table:ce,commit_timestamp:ve,eventType:Se,new:{},old:{},errors:Ee}),this._getPayloadRecords(re))}K.callback(W,h)})}_isClosed(){return this.state===ll.closed}_isJoined(){return this.state===ll.joined}_isJoining(){return this.state===ll.joining}_isLeaving(){return this.state===ll.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,c,h){const p=r.toLocaleLowerCase(),x={type:p,filter:c,callback:h};return this.bindings[p]?this.bindings[p].push(x):this.bindings[p]=[x],this}_off(r,c){const h=r.toLocaleLowerCase();return this.bindings[h]&&(this.bindings[h]=this.bindings[h].filter(p=>{var x;return!(((x=p.type)===null||x===void 0?void 0:x.toLocaleLowerCase())===h&&TS.isEqual(p.filter,c))})),this}static isEqual(r,c){if(Object.keys(r).length!==Object.keys(c).length)return!1;for(const h in r)if(r[h]!==c[h])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(xh.close,{},r)}_onError(r){this._on(xh.error,{},c=>r(c))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ll.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const c={new:{},old:{}};return(r.type==="INSERT"||r.type==="UPDATE")&&(c.new=yE(r.columns,r.record)),(r.type==="UPDATE"||r.type==="DELETE")&&(c.old=yE(r.columns,r.old_record)),c}}const a1=()=>{},E0={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},DO=[1e3,2e3,5e3,1e4],LO=1e4,OO=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class NO{constructor(r,c){var h;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=V1,this.transport=null,this.heartbeatIntervalMs=E0.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=a1,this.ref=0,this.reconnectTimer=null,this.logger=a1,this.conn=null,this.sendBuffer=[],this.serializer=new CO,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=p=>{let x;return p?x=p:typeof fetch>"u"?x=(...S)=>mx(async()=>{const{default:i}=await Promise.resolve().then(()=>by);return{default:i}},void 0).then(({default:i})=>i(...S)).catch(i=>{throw new Error(`Failed to load @supabase/node-fetch: ${i.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):x=fetch,(...S)=>x(...S)},!(!((h=c?.params)===null||h===void 0)&&h.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=c.params.apikey,this.endPoint=`${r}/${H1.websocket}`,this.httpEndpoint=SM(r),this._initializeOptions(c),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(c?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=wO.createWebSocket(this.endpointURL())}catch(r){this._setConnectionState("disconnected");const c=r.message;throw c.includes("Node.js")?new Error(`${c}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${c}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:kO}))}disconnect(r,c){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const h=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(h),this._setConnectionState("disconnected")},r?this.conn.close(r,c??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(r){const c=await r.unsubscribe();return this.channels.length===0&&this.disconnect(),c}async removeAllChannels(){const r=await Promise.all(this.channels.map(c=>c.unsubscribe()));return this.channels=[],this.disconnect(),r}log(r,c,h){this.logger(r,c,h)}connectionState(){switch(this.conn&&this.conn.readyState){case qv.connecting:return Vg.Connecting;case qv.open:return Vg.Open;case qv.closing:return Vg.Closing;default:return Vg.Closed}}isConnected(){return this.connectionState()===Vg.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(r,c={config:{}}){const h=`realtime:${r}`,p=this.getChannels().find(x=>x.topic===h);if(p)return p;{const x=new TS(`realtime:${r}`,c,this);return this.channels.push(x),x}}push(r){const{topic:c,event:h,payload:p,ref:x}=r,S=()=>{this.encode(r,i=>{var M;(M=this.conn)===null||M===void 0||M.send(i)})};this.log("push",`${c} ${h} (${x})`,p),this.isConnected()?S():this.sendBuffer.push(S)}async setAuth(r=null){this._authPromise=this._performAuth(r);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var r;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(c){this.log("error","error in heartbeat callback",c)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(c){this.log("error","error in heartbeat callback",c)}this._wasManualDisconnect=!1,(r=this.conn)===null||r===void 0||r.close(EO,"heartbeat timeout"),setTimeout(()=>{var c;this.isConnected()||(c=this.reconnectTimer)===null||c===void 0||c.scheduleTimeout()},E0.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(c){this.log("error","error in heartbeat callback",c)}this._setAuthSafely("heartbeat")}onHeartbeat(r){this.heartbeatCallback=r}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_makeRef(){let r=this.ref+1;return r===this.ref?this.ref=0:this.ref=r,this.ref.toString()}_leaveOpenTopic(r){let c=this.channels.find(h=>h.topic===r&&(h._isJoined()||h._isJoining()));c&&(this.log("transport",`leaving duplicate topic "${r}"`),c.unsubscribe())}_remove(r){this.channels=this.channels.filter(c=>c.topic!==r.topic)}_onConnMessage(r){this.decode(r.data,c=>{if(c.topic==="phoenix"&&c.event==="phx_reply")try{this.heartbeatCallback(c.payload.status==="ok"?"ok":"error")}catch(P){this.log("error","error in heartbeat callback",P)}c.ref&&c.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:h,event:p,payload:x,ref:S}=c,i=S?`(${S})`:"",M=x.status||"";this.log("receive",`${M} ${h} ${p} ${i}`.trim(),x),this.channels.filter(P=>P._isMember(h)).forEach(P=>P._trigger(p,x,S)),this._triggerStateCallbacks("message",c)})}_clearTimer(r){var c;r==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):r==="reconnect"&&((c=this.reconnectTimer)===null||c===void 0||c.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(r=>r.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const r=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(r),this.workerRef.onerror=c=>{this.log("worker","worker error",c.message),this.workerRef.terminate()},this.workerRef.onmessage=c=>{c.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(r){var c;this._setConnectionState("disconnected"),this.log("transport","close",r),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(c=this.reconnectTimer)===null||c===void 0||c.scheduleTimeout(),this._triggerStateCallbacks("close",r)}_onConnError(r){this._setConnectionState("disconnected"),this.log("transport",`${r}`),this._triggerChanError(),this._triggerStateCallbacks("error",r)}_triggerChanError(){this.channels.forEach(r=>r._trigger(xh.error))}_appendParams(r,c){if(Object.keys(c).length===0)return r;const h=r.match(/\?/)?"&":"?",p=new URLSearchParams(c);return`${r}${h}${p}`}_workerObjectUrl(r){let c;if(r)c=r;else{const h=new Blob([OO],{type:"application/javascript"});c=URL.createObjectURL(h)}return c}_setConnectionState(r,c=!1){this._connectionState=r,r==="connecting"?this._wasManualDisconnect=!1:r==="disconnecting"&&(this._wasManualDisconnect=c)}async _performAuth(r=null){let c;r?c=r:this.accessToken?c=await this.accessToken():c=this.accessTokenValue,this.accessTokenValue!=c&&(this.accessTokenValue=c,this.channels.forEach(h=>{const p={access_token:c,version:TO};c&&h.updateJoinPayload(p),h.joinedOnce&&h._isJoined()&&h._push(xh.access_token,{access_token:c})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(r="general"){this.setAuth().catch(c=>{this.log("error",`error setting auth in ${r}`,c)})}_triggerStateCallbacks(r,c){try{this.stateChangeCallbacks[r].forEach(h=>{try{h(c)}catch(p){this.log("error",`error in ${r} callback`,p)}})}catch(h){this.log("error",`error triggering ${r} callbacks`,h)}}_setupReconnectionTimer(){this.reconnectTimer=new bM(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},E0.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(r){var c,h,p,x,S,i,M,P,N;if(this.transport=(c=r?.transport)!==null&&c!==void 0?c:null,this.timeout=(h=r?.timeout)!==null&&h!==void 0?h:V1,this.heartbeatIntervalMs=(p=r?.heartbeatIntervalMs)!==null&&p!==void 0?p:E0.HEARTBEAT_INTERVAL,this.worker=(x=r?.worker)!==null&&x!==void 0?x:!1,this.accessToken=(S=r?.accessToken)!==null&&S!==void 0?S:null,this.heartbeatCallback=(i=r?.heartbeatCallback)!==null&&i!==void 0?i:a1,r?.params&&(this.params=r.params),r?.logger&&(this.logger=r.logger),(r?.logLevel||r?.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(M=r?.reconnectAfterMs)!==null&&M!==void 0?M:(H=>DO[H-1]||LO),this.encode=(P=r?.encode)!==null&&P!==void 0?P:((H,W)=>W(JSON.stringify(H))),this.decode=(N=r?.decode)!==null&&N!==void 0?N:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=r?.workerUrl}}}class kS extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}}function Go(o){return typeof o=="object"&&o!==null&&"__isStorageError"in o}class FO extends kS{constructor(r,c,h){super(r),this.name="StorageApiError",this.status=c,this.statusCode=h}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class q1 extends kS{constructor(r,c){super(r),this.name="StorageUnknownError",this.originalError=c}}var BO=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};const TM=o=>{let r;return o?r=o:typeof fetch>"u"?r=(...c)=>mx(async()=>{const{default:h}=await Promise.resolve().then(()=>by);return{default:h}},void 0).then(({default:h})=>h(...c)):r=fetch,(...c)=>r(...c)},UO=()=>BO(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield mx(()=>Promise.resolve().then(()=>by),void 0)).Response:Response}),W1=o=>{if(Array.isArray(o))return o.map(c=>W1(c));if(typeof o=="function"||o!==Object(o))return o;const r={};return Object.entries(o).forEach(([c,h])=>{const p=c.replace(/([-_][a-z])/gi,x=>x.toUpperCase().replace(/[-_]/g,""));r[p]=W1(h)}),r},$O=o=>{if(typeof o!="object"||o===null)return!1;const r=Object.getPrototypeOf(o);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)};var Jg=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};const r1=o=>o.msg||o.message||o.error_description||o.error||JSON.stringify(o),VO=(o,r,c)=>Jg(void 0,void 0,void 0,function*(){const h=yield UO();o instanceof h&&!c?.noResolveJson?o.json().then(p=>{const x=o.status||500,S=p?.statusCode||x+"";r(new FO(r1(p),x,S))}).catch(p=>{r(new q1(r1(p),p))}):r(new q1(r1(o),o))}),HO=(o,r,c,h)=>{const p={method:o,headers:r?.headers||{}};return o==="GET"||!h?p:($O(h)?(p.headers=Object.assign({"Content-Type":"application/json"},r?.headers),p.body=JSON.stringify(h)):p.body=h,r?.duplex&&(p.duplex=r.duplex),Object.assign(Object.assign({},p),c))};function px(o,r,c,h,p,x){return Jg(this,void 0,void 0,function*(){return new Promise((S,i)=>{o(c,HO(r,h,p,x)).then(M=>{if(!M.ok)throw M;return h?.noResolveJson?M:M.json()}).then(M=>S(M)).catch(M=>VO(M,i,h))})})}function mb(o,r,c,h){return Jg(this,void 0,void 0,function*(){return px(o,"GET",r,c,h)})}function gf(o,r,c,h,p){return Jg(this,void 0,void 0,function*(){return px(o,"POST",r,h,p,c)})}function Z1(o,r,c,h,p){return Jg(this,void 0,void 0,function*(){return px(o,"PUT",r,h,p,c)})}function GO(o,r,c,h){return Jg(this,void 0,void 0,function*(){return px(o,"HEAD",r,Object.assign(Object.assign({},c),{noResolveJson:!0}),h)})}function kM(o,r,c,h,p){return Jg(this,void 0,void 0,function*(){return px(o,"DELETE",r,h,p,c)})}var qO=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};class WO{constructor(r,c){this.downloadFn=r,this.shouldThrowOnError=c}then(r,c){return this.execute().then(r,c)}execute(){return qO(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Go(r))return{data:null,error:r};throw r}})}}var ZO=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};class XO{constructor(r,c){this.downloadFn=r,this.shouldThrowOnError=c}asStream(){return new WO(this.downloadFn,this.shouldThrowOnError)}then(r,c){return this.execute().then(r,c)}execute(){return ZO(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Go(r))return{data:null,error:r};throw r}})}}var gu=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};const YO={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},bE={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class KO{constructor(r,c={},h,p){this.shouldThrowOnError=!1,this.url=r,this.headers=c,this.bucketId=h,this.fetch=TM(p)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(r,c,h,p){return gu(this,void 0,void 0,function*(){try{let x;const S=Object.assign(Object.assign({},bE),p);let i=Object.assign(Object.assign({},this.headers),r==="POST"&&{"x-upsert":String(S.upsert)});const M=S.metadata;typeof Blob<"u"&&h instanceof Blob?(x=new FormData,x.append("cacheControl",S.cacheControl),M&&x.append("metadata",this.encodeMetadata(M)),x.append("",h)):typeof FormData<"u"&&h instanceof FormData?(x=h,x.append("cacheControl",S.cacheControl),M&&x.append("metadata",this.encodeMetadata(M))):(x=h,i["cache-control"]=`max-age=${S.cacheControl}`,i["content-type"]=S.contentType,M&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(M)))),p?.headers&&(i=Object.assign(Object.assign({},i),p.headers));const P=this._removeEmptyFolders(c),N=this._getFinalPath(P),H=yield(r=="PUT"?Z1:gf)(this.fetch,`${this.url}/object/${N}`,x,Object.assign({headers:i},S?.duplex?{duplex:S.duplex}:{}));return{data:{path:P,id:H.Id,fullPath:H.Key},error:null}}catch(x){if(this.shouldThrowOnError)throw x;if(Go(x))return{data:null,error:x};throw x}})}upload(r,c,h){return gu(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,c,h)})}uploadToSignedUrl(r,c,h,p){return gu(this,void 0,void 0,function*(){const x=this._removeEmptyFolders(r),S=this._getFinalPath(x),i=new URL(this.url+`/object/upload/sign/${S}`);i.searchParams.set("token",c);try{let M;const P=Object.assign({upsert:bE.upsert},p),N=Object.assign(Object.assign({},this.headers),{"x-upsert":String(P.upsert)});typeof Blob<"u"&&h instanceof Blob?(M=new FormData,M.append("cacheControl",P.cacheControl),M.append("",h)):typeof FormData<"u"&&h instanceof FormData?(M=h,M.append("cacheControl",P.cacheControl)):(M=h,N["cache-control"]=`max-age=${P.cacheControl}`,N["content-type"]=P.contentType);const H=yield Z1(this.fetch,i.toString(),M,{headers:N});return{data:{path:x,fullPath:H.Key},error:null}}catch(M){if(this.shouldThrowOnError)throw M;if(Go(M))return{data:null,error:M};throw M}})}createSignedUploadUrl(r,c){return gu(this,void 0,void 0,function*(){try{let h=this._getFinalPath(r);const p=Object.assign({},this.headers);c?.upsert&&(p["x-upsert"]="true");const x=yield gf(this.fetch,`${this.url}/object/upload/sign/${h}`,{},{headers:p}),S=new URL(this.url+x.url),i=S.searchParams.get("token");if(!i)throw new kS("No token returned by API");return{data:{signedUrl:S.toString(),path:r,token:i},error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(Go(h))return{data:null,error:h};throw h}})}update(r,c,h){return gu(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,c,h)})}move(r,c,h){return gu(this,void 0,void 0,function*(){try{return{data:yield gf(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:c,destinationBucket:h?.destinationBucket},{headers:this.headers}),error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(Go(p))return{data:null,error:p};throw p}})}copy(r,c,h){return gu(this,void 0,void 0,function*(){try{return{data:{path:(yield gf(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:c,destinationBucket:h?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(Go(p))return{data:null,error:p};throw p}})}createSignedUrl(r,c,h){return gu(this,void 0,void 0,function*(){try{let p=this._getFinalPath(r),x=yield gf(this.fetch,`${this.url}/object/sign/${p}`,Object.assign({expiresIn:c},h?.transform?{transform:h.transform}:{}),{headers:this.headers});const S=h?.download?`&download=${h.download===!0?"":h.download}`:"";return x={signedUrl:encodeURI(`${this.url}${x.signedURL}${S}`)},{data:x,error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(Go(p))return{data:null,error:p};throw p}})}createSignedUrls(r,c,h){return gu(this,void 0,void 0,function*(){try{const p=yield gf(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:c,paths:r},{headers:this.headers}),x=h?.download?`&download=${h.download===!0?"":h.download}`:"";return{data:p.map(S=>Object.assign(Object.assign({},S),{signedUrl:S.signedURL?encodeURI(`${this.url}${S.signedURL}${x}`):null})),error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(Go(p))return{data:null,error:p};throw p}})}download(r,c){const p=typeof c?.transform<"u"?"render/image/authenticated":"object",x=this.transformOptsToQueryString(c?.transform||{}),S=x?`?${x}`:"",i=this._getFinalPath(r),M=()=>mb(this.fetch,`${this.url}/${p}/${i}${S}`,{headers:this.headers,noResolveJson:!0});return new XO(M,this.shouldThrowOnError)}info(r){return gu(this,void 0,void 0,function*(){const c=this._getFinalPath(r);try{const h=yield mb(this.fetch,`${this.url}/object/info/${c}`,{headers:this.headers});return{data:W1(h),error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(Go(h))return{data:null,error:h};throw h}})}exists(r){return gu(this,void 0,void 0,function*(){const c=this._getFinalPath(r);try{return yield GO(this.fetch,`${this.url}/object/${c}`,{headers:this.headers}),{data:!0,error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(Go(h)&&h instanceof q1){const p=h.originalError;if([400,404].includes(p?.status))return{data:!1,error:h}}throw h}})}getPublicUrl(r,c){const h=this._getFinalPath(r),p=[],x=c?.download?`download=${c.download===!0?"":c.download}`:"";x!==""&&p.push(x);const i=typeof c?.transform<"u"?"render/image":"object",M=this.transformOptsToQueryString(c?.transform||{});M!==""&&p.push(M);let P=p.join("&");return P!==""&&(P=`?${P}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${h}${P}`)}}}remove(r){return gu(this,void 0,void 0,function*(){try{return{data:yield kM(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Go(c))return{data:null,error:c};throw c}})}list(r,c,h){return gu(this,void 0,void 0,function*(){try{const p=Object.assign(Object.assign(Object.assign({},YO),c),{prefix:r||""});return{data:yield gf(this.fetch,`${this.url}/object/list/${this.bucketId}`,p,{headers:this.headers},h),error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(Go(p))return{data:null,error:p};throw p}})}listV2(r,c){return gu(this,void 0,void 0,function*(){try{const h=Object.assign({},r);return{data:yield gf(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,h,{headers:this.headers},c),error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(Go(h))return{data:null,error:h};throw h}})}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r.replace(/^\/+/,"")}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const c=[];return r.width&&c.push(`width=${r.width}`),r.height&&c.push(`height=${r.height}`),r.resize&&c.push(`resize=${r.resize}`),r.format&&c.push(`format=${r.format}`),r.quality&&c.push(`quality=${r.quality}`),c.join("&")}}const JO="2.74.0",QO={"X-Client-Info":`storage-js/${JO}`};var J_=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};class e3{constructor(r,c={},h,p){this.shouldThrowOnError=!1;const x=new URL(r);p?.useNewHostname&&/supabase\.(co|in|red)$/.test(x.hostname)&&!x.hostname.includes("storage.supabase.")&&(x.hostname=x.hostname.replace("supabase.","storage.supabase.")),this.url=x.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},QO),c),this.fetch=TM(h)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return J_(this,void 0,void 0,function*(){try{return{data:yield mb(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Go(r))return{data:null,error:r};throw r}})}getBucket(r){return J_(this,void 0,void 0,function*(){try{return{data:yield mb(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Go(c))return{data:null,error:c};throw c}})}createBucket(r){return J_(this,arguments,void 0,function*(c,h={public:!1}){try{return{data:yield gf(this.fetch,`${this.url}/bucket`,{id:c,name:c,type:h.type,public:h.public,file_size_limit:h.fileSizeLimit,allowed_mime_types:h.allowedMimeTypes},{headers:this.headers}),error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(Go(p))return{data:null,error:p};throw p}})}updateBucket(r,c){return J_(this,void 0,void 0,function*(){try{return{data:yield Z1(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:c.public,file_size_limit:c.fileSizeLimit,allowed_mime_types:c.allowedMimeTypes},{headers:this.headers}),error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(Go(h))return{data:null,error:h};throw h}})}emptyBucket(r){return J_(this,void 0,void 0,function*(){try{return{data:yield gf(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Go(c))return{data:null,error:c};throw c}})}deleteBucket(r){return J_(this,void 0,void 0,function*(){try{return{data:yield kM(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Go(c))return{data:null,error:c};throw c}})}}class t3 extends e3{constructor(r,c={},h,p){super(r,c,h,p)}from(r){return new KO(this.url,this.headers,r,this.fetch)}}const i3="2.74.0";let Uv="";typeof Deno<"u"?Uv="deno":typeof document<"u"?Uv="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Uv="react-native":Uv="node";const n3={"X-Client-Info":`supabase-js-${Uv}/${i3}`},a3={headers:n3},r3={schema:"public"},s3={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},o3={};var l3=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};const c3=o=>{let r;return o?r=o:typeof fetch>"u"?r=pM:r=fetch,(...c)=>r(...c)},u3=()=>typeof Headers>"u"?gM:Headers,d3=(o,r,c)=>{const h=c3(c),p=u3();return(x,S)=>l3(void 0,void 0,void 0,function*(){var i;const M=(i=yield r())!==null&&i!==void 0?i:o;let P=new p(S?.headers);return P.has("apikey")||P.set("apikey",o),P.has("Authorization")||P.set("Authorization",`Bearer ${M}`),h(x,Object.assign(Object.assign({},S),{headers:P}))})};var h3=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};function f3(o){return o.endsWith("/")?o:o+"/"}function m3(o,r){var c,h;const{db:p,auth:x,realtime:S,global:i}=o,{db:M,auth:P,realtime:N,global:H}=r,W={db:Object.assign(Object.assign({},M),p),auth:Object.assign(Object.assign({},P),x),realtime:Object.assign(Object.assign({},N),S),storage:{},global:Object.assign(Object.assign(Object.assign({},H),i),{headers:Object.assign(Object.assign({},(c=H?.headers)!==null&&c!==void 0?c:{}),(h=i?.headers)!==null&&h!==void 0?h:{})}),accessToken:()=>h3(this,void 0,void 0,function*(){return""})};return o.accessToken?W.accessToken=o.accessToken:delete W.accessToken,W}function p3(o){const r=o?.trim();if(!r)throw new Error("supabaseUrl is required.");if(!r.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(f3(r))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const EM="2.74.0",oy=30*1e3,X1=3,s1=X1*oy,g3="http://localhost:9999",_3="supabase.auth.token",y3={"X-Client-Info":`gotrue-js/${EM}`},Y1="X-Supabase-Api-Version",AM={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},v3=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,x3=600*1e3;class nx extends Error{constructor(r,c,h){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=c,this.code=h}}function ma(o){return typeof o=="object"&&o!==null&&"__isAuthError"in o}class b3 extends nx{constructor(r,c,h){super(r,c,h),this.name="AuthApiError",this.status=c,this.code=h}}function w3(o){return ma(o)&&o.name==="AuthApiError"}class Hg extends nx{constructor(r,c){super(r),this.name="AuthUnknownError",this.originalError=c}}class qp extends nx{constructor(r,c,h,p){super(r,h,p),this.name=c,this.status=h}}class Pp extends qp{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function S3(o){return ma(o)&&o.name==="AuthSessionMissingError"}class Q_ extends qp{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class A0 extends qp{constructor(r){super(r,"AuthInvalidCredentialsError",400,void 0)}}class C0 extends qp{constructor(r,c=null){super(r,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=c}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function T3(o){return ma(o)&&o.name==="AuthImplicitGrantRedirectError"}class wE extends qp{constructor(r,c=null){super(r,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=c}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class K1 extends qp{constructor(r,c){super(r,"AuthRetryableFetchError",c,void 0)}}function o1(o){return ma(o)&&o.name==="AuthRetryableFetchError"}class SE extends qp{constructor(r,c,h){super(r,"AuthWeakPasswordError",c,"weak_password"),this.reasons=h}}class J1 extends qp{constructor(r){super(r,"AuthInvalidJwtError",400,"invalid_jwt")}}const pb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),TE=` 	
\r=`.split(""),k3=(()=>{const o=new Array(128);for(let r=0;r<o.length;r+=1)o[r]=-1;for(let r=0;r<TE.length;r+=1)o[TE[r].charCodeAt(0)]=-2;for(let r=0;r<pb.length;r+=1)o[pb[r].charCodeAt(0)]=r;return o})();function kE(o,r,c){if(o!==null)for(r.queue=r.queue<<8|o,r.queuedBits+=8;r.queuedBits>=6;){const h=r.queue>>r.queuedBits-6&63;c(pb[h]),r.queuedBits-=6}else if(r.queuedBits>0)for(r.queue=r.queue<<6-r.queuedBits,r.queuedBits=6;r.queuedBits>=6;){const h=r.queue>>r.queuedBits-6&63;c(pb[h]),r.queuedBits-=6}}function CM(o,r,c){const h=k3[o];if(h>-1)for(r.queue=r.queue<<6|h,r.queuedBits+=6;r.queuedBits>=8;)c(r.queue>>r.queuedBits-8&255),r.queuedBits-=8;else{if(h===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(o)}"`)}}function EE(o){const r=[],c=S=>{r.push(String.fromCodePoint(S))},h={utf8seq:0,codepoint:0},p={queue:0,queuedBits:0},x=S=>{C3(S,h,c)};for(let S=0;S<o.length;S+=1)CM(o.charCodeAt(S),p,x);return r.join("")}function E3(o,r){if(o<=127){r(o);return}else if(o<=2047){r(192|o>>6),r(128|o&63);return}else if(o<=65535){r(224|o>>12),r(128|o>>6&63),r(128|o&63);return}else if(o<=1114111){r(240|o>>18),r(128|o>>12&63),r(128|o>>6&63),r(128|o&63);return}throw new Error(`Unrecognized Unicode codepoint: ${o.toString(16)}`)}function A3(o,r){for(let c=0;c<o.length;c+=1){let h=o.charCodeAt(c);if(h>55295&&h<=56319){const p=(h-55296)*1024&65535;h=(o.charCodeAt(c+1)-56320&65535|p)+65536,c+=1}E3(h,r)}}function C3(o,r,c){if(r.utf8seq===0){if(o<=127){c(o);return}for(let h=1;h<6;h+=1)if((o>>7-h&1)===0){r.utf8seq=h;break}if(r.utf8seq===2)r.codepoint=o&31;else if(r.utf8seq===3)r.codepoint=o&15;else if(r.utf8seq===4)r.codepoint=o&7;else throw new Error("Invalid UTF-8 sequence");r.utf8seq-=1}else if(r.utf8seq>0){if(o<=127)throw new Error("Invalid UTF-8 sequence");r.codepoint=r.codepoint<<6|o&63,r.utf8seq-=1,r.utf8seq===0&&c(r.codepoint)}}function dy(o){const r=[],c={queue:0,queuedBits:0},h=p=>{r.push(p)};for(let p=0;p<o.length;p+=1)CM(o.charCodeAt(p),c,h);return new Uint8Array(r)}function M3(o){const r=[];return A3(o,c=>r.push(c)),new Uint8Array(r)}function qg(o){const r=[],c={queue:0,queuedBits:0},h=p=>{r.push(p)};return o.forEach(p=>kE(p,c,h)),kE(null,c,h),r.join("")}function P3(o){return Math.round(Date.now()/1e3)+o}function j3(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){const r=Math.random()*16|0;return(o=="x"?r:r&3|8).toString(16)})}const Hu=()=>typeof window<"u"&&typeof document<"u",Dg={tested:!1,writable:!1},MM=()=>{if(!Hu())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Dg.tested)return Dg.writable;const o=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(o,o),globalThis.localStorage.removeItem(o),Dg.tested=!0,Dg.writable=!0}catch{Dg.tested=!0,Dg.writable=!1}return Dg.writable};function z3(o){const r={},c=new URL(o);if(c.hash&&c.hash[0]==="#")try{new URLSearchParams(c.hash.substring(1)).forEach((p,x)=>{r[x]=p})}catch{}return c.searchParams.forEach((h,p)=>{r[p]=h}),r}const PM=o=>{let r;return o?r=o:typeof fetch>"u"?r=(...c)=>mx(async()=>{const{default:h}=await Promise.resolve().then(()=>by);return{default:h}},void 0).then(({default:h})=>h(...c)):r=fetch,(...c)=>r(...c)},I3=o=>typeof o=="object"&&o!==null&&"status"in o&&"ok"in o&&"json"in o&&typeof o.json=="function",ly=async(o,r,c)=>{await o.setItem(r,JSON.stringify(c))},Lg=async(o,r)=>{const c=await o.getItem(r);if(!c)return null;try{return JSON.parse(c)}catch{return c}},Ap=async(o,r)=>{await o.removeItem(r)};class jb{constructor(){this.promise=new jb.promiseConstructor((r,c)=>{this.resolve=r,this.reject=c})}}jb.promiseConstructor=Promise;function l1(o){const r=o.split(".");if(r.length!==3)throw new J1("Invalid JWT structure");for(let h=0;h<r.length;h++)if(!v3.test(r[h]))throw new J1("JWT not in base64url format");return{header:JSON.parse(EE(r[0])),payload:JSON.parse(EE(r[1])),signature:dy(r[2]),raw:{header:r[0],payload:r[1]}}}async function R3(o){return await new Promise(r=>{setTimeout(()=>r(null),o)})}function D3(o,r){return new Promise((h,p)=>{(async()=>{for(let x=0;x<1/0;x++)try{const S=await o(x);if(!r(x,null,S)){h(S);return}}catch(S){if(!r(x,S)){p(S);return}}})()})}function L3(o){return("0"+o.toString(16)).substr(-2)}function O3(){const r=new Uint32Array(56);if(typeof crypto>"u"){const c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",h=c.length;let p="";for(let x=0;x<56;x++)p+=c.charAt(Math.floor(Math.random()*h));return p}return crypto.getRandomValues(r),Array.from(r,L3).join("")}async function N3(o){const c=new TextEncoder().encode(o),h=await crypto.subtle.digest("SHA-256",c),p=new Uint8Array(h);return Array.from(p).map(x=>String.fromCharCode(x)).join("")}async function F3(o){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),o;const c=await N3(o);return btoa(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ey(o,r,c=!1){const h=O3();let p=h;c&&(p+="/PASSWORD_RECOVERY"),await ly(o,`${r}-code-verifier`,p);const x=await F3(h);return[x,h===x?"plain":"s256"]}const B3=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function U3(o){const r=o.headers.get(Y1);if(!r||!r.match(B3))return null;try{return new Date(`${r}T00:00:00.0Z`)}catch{return null}}function $3(o){if(!o)throw new Error("Missing exp claim");const r=Math.floor(Date.now()/1e3);if(o<=r)throw new Error("JWT has expired")}function V3(o){switch(o){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const H3=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ty(o){if(!H3.test(o))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function c1(){const o={};return new Proxy(o,{get:(r,c)=>{if(c==="__isUserNotAvailableProxy")return!0;if(typeof c=="symbol"){const h=c.toString();if(h==="Symbol(Symbol.toPrimitive)"||h==="Symbol(Symbol.toStringTag)"||h==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${c}" property of the session object is not supported. Please use getUser() instead.`)},set:(r,c)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${c}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(r,c)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${c}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function AE(o){return JSON.parse(JSON.stringify(o))}var G3=function(o,r){var c={};for(var h in o)Object.prototype.hasOwnProperty.call(o,h)&&r.indexOf(h)<0&&(c[h]=o[h]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,h=Object.getOwnPropertySymbols(o);p<h.length;p++)r.indexOf(h[p])<0&&Object.prototype.propertyIsEnumerable.call(o,h[p])&&(c[h[p]]=o[h[p]]);return c};const Ug=o=>o.msg||o.message||o.error_description||o.error||JSON.stringify(o),q3=[502,503,504];async function CE(o){var r;if(!I3(o))throw new K1(Ug(o),0);if(q3.includes(o.status))throw new K1(Ug(o),o.status);let c;try{c=await o.json()}catch(x){throw new Hg(Ug(x),x)}let h;const p=U3(o);if(p&&p.getTime()>=AM["2024-01-01"].timestamp&&typeof c=="object"&&c&&typeof c.code=="string"?h=c.code:typeof c=="object"&&c&&typeof c.error_code=="string"&&(h=c.error_code),h){if(h==="weak_password")throw new SE(Ug(c),o.status,((r=c.weak_password)===null||r===void 0?void 0:r.reasons)||[]);if(h==="session_not_found")throw new Pp}else if(typeof c=="object"&&c&&typeof c.weak_password=="object"&&c.weak_password&&Array.isArray(c.weak_password.reasons)&&c.weak_password.reasons.length&&c.weak_password.reasons.reduce((x,S)=>x&&typeof S=="string",!0))throw new SE(Ug(c),o.status,c.weak_password.reasons);throw new b3(Ug(c),o.status||500,h)}const W3=(o,r,c,h)=>{const p={method:o,headers:r?.headers||{}};return o==="GET"?p:(p.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},r?.headers),p.body=JSON.stringify(h),Object.assign(Object.assign({},p),c))};async function Fa(o,r,c,h){var p;const x=Object.assign({},h?.headers);x[Y1]||(x[Y1]=AM["2024-01-01"].name),h?.jwt&&(x.Authorization=`Bearer ${h.jwt}`);const S=(p=h?.query)!==null&&p!==void 0?p:{};h?.redirectTo&&(S.redirect_to=h.redirectTo);const i=Object.keys(S).length?"?"+new URLSearchParams(S).toString():"",M=await Z3(o,r,c+i,{headers:x,noResolveJson:h?.noResolveJson},{},h?.body);return h?.xform?h?.xform(M):{data:Object.assign({},M),error:null}}async function Z3(o,r,c,h,p,x){const S=W3(r,h,p,x);let i;try{i=await o(c,Object.assign({},S))}catch(M){throw console.error(M),new K1(Ug(M),0)}if(i.ok||await CE(i),h?.noResolveJson)return i;try{return await i.json()}catch(M){await CE(M)}}function vh(o){var r;let c=null;K3(o)&&(c=Object.assign({},o),o.expires_at||(c.expires_at=P3(o.expires_in)));const h=(r=o.user)!==null&&r!==void 0?r:o;return{data:{session:c,user:h},error:null}}function ME(o){const r=vh(o);return!r.error&&o.weak_password&&typeof o.weak_password=="object"&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.message&&typeof o.weak_password.message=="string"&&o.weak_password.reasons.reduce((c,h)=>c&&typeof h=="string",!0)&&(r.data.weak_password=o.weak_password),r}function Ip(o){var r;return{data:{user:(r=o.user)!==null&&r!==void 0?r:o},error:null}}function X3(o){return{data:o,error:null}}function Y3(o){const{action_link:r,email_otp:c,hashed_token:h,redirect_to:p,verification_type:x}=o,S=G3(o,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),i={action_link:r,email_otp:c,hashed_token:h,redirect_to:p,verification_type:x},M=Object.assign({},S);return{data:{properties:i,user:M},error:null}}function PE(o){return o}function K3(o){return o.access_token&&o.refresh_token&&o.expires_in}const u1=["global","local","others"];var J3=function(o,r){var c={};for(var h in o)Object.prototype.hasOwnProperty.call(o,h)&&r.indexOf(h)<0&&(c[h]=o[h]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,h=Object.getOwnPropertySymbols(o);p<h.length;p++)r.indexOf(h[p])<0&&Object.prototype.propertyIsEnumerable.call(o,h[p])&&(c[h[p]]=o[h[p]]);return c};class Q3{constructor({url:r="",headers:c={},fetch:h}){this.url=r,this.headers=c,this.fetch=PM(h),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(r,c=u1[0]){if(u1.indexOf(c)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${u1.join(", ")}`);try{return await Fa(this.fetch,"POST",`${this.url}/logout?scope=${c}`,{headers:this.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(h){if(ma(h))return{data:null,error:h};throw h}}async inviteUserByEmail(r,c={}){try{return await Fa(this.fetch,"POST",`${this.url}/invite`,{body:{email:r,data:c.data},headers:this.headers,redirectTo:c.redirectTo,xform:Ip})}catch(h){if(ma(h))return{data:{user:null},error:h};throw h}}async generateLink(r){try{const{options:c}=r,h=J3(r,["options"]),p=Object.assign(Object.assign({},h),c);return"newEmail"in h&&(p.new_email=h?.newEmail,delete p.newEmail),await Fa(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:p,headers:this.headers,xform:Y3,redirectTo:c?.redirectTo})}catch(c){if(ma(c))return{data:{properties:null,user:null},error:c};throw c}}async createUser(r){try{return await Fa(this.fetch,"POST",`${this.url}/admin/users`,{body:r,headers:this.headers,xform:Ip})}catch(c){if(ma(c))return{data:{user:null},error:c};throw c}}async listUsers(r){var c,h,p,x,S,i,M;try{const P={nextPage:null,lastPage:0,total:0},N=await Fa(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(h=(c=r?.page)===null||c===void 0?void 0:c.toString())!==null&&h!==void 0?h:"",per_page:(x=(p=r?.perPage)===null||p===void 0?void 0:p.toString())!==null&&x!==void 0?x:""},xform:PE});if(N.error)throw N.error;const H=await N.json(),W=(S=N.headers.get("x-total-count"))!==null&&S!==void 0?S:0,K=(M=(i=N.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&M!==void 0?M:[];return K.length>0&&(K.forEach(re=>{const ae=parseInt(re.split(";")[0].split("=")[1].substring(0,1)),ce=JSON.parse(re.split(";")[1].split("=")[1]);P[`${ce}Page`]=ae}),P.total=parseInt(W)),{data:Object.assign(Object.assign({},H),P),error:null}}catch(P){if(ma(P))return{data:{users:[]},error:P};throw P}}async getUserById(r){ty(r);try{return await Fa(this.fetch,"GET",`${this.url}/admin/users/${r}`,{headers:this.headers,xform:Ip})}catch(c){if(ma(c))return{data:{user:null},error:c};throw c}}async updateUserById(r,c){ty(r);try{return await Fa(this.fetch,"PUT",`${this.url}/admin/users/${r}`,{body:c,headers:this.headers,xform:Ip})}catch(h){if(ma(h))return{data:{user:null},error:h};throw h}}async deleteUser(r,c=!1){ty(r);try{return await Fa(this.fetch,"DELETE",`${this.url}/admin/users/${r}`,{headers:this.headers,body:{should_soft_delete:c},xform:Ip})}catch(h){if(ma(h))return{data:{user:null},error:h};throw h}}async _listFactors(r){ty(r.userId);try{const{data:c,error:h}=await Fa(this.fetch,"GET",`${this.url}/admin/users/${r.userId}/factors`,{headers:this.headers,xform:p=>({data:{factors:p},error:null})});return{data:c,error:h}}catch(c){if(ma(c))return{data:null,error:c};throw c}}async _deleteFactor(r){ty(r.userId),ty(r.id);try{return{data:await Fa(this.fetch,"DELETE",`${this.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:this.headers}),error:null}}catch(c){if(ma(c))return{data:null,error:c};throw c}}async _listOAuthClients(r){var c,h,p,x,S,i,M;try{const P={nextPage:null,lastPage:0,total:0},N=await Fa(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(h=(c=r?.page)===null||c===void 0?void 0:c.toString())!==null&&h!==void 0?h:"",per_page:(x=(p=r?.perPage)===null||p===void 0?void 0:p.toString())!==null&&x!==void 0?x:""},xform:PE});if(N.error)throw N.error;const H=await N.json(),W=(S=N.headers.get("x-total-count"))!==null&&S!==void 0?S:0,K=(M=(i=N.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&M!==void 0?M:[];return K.length>0&&(K.forEach(re=>{const ae=parseInt(re.split(";")[0].split("=")[1].substring(0,1)),ce=JSON.parse(re.split(";")[1].split("=")[1]);P[`${ce}Page`]=ae}),P.total=parseInt(W)),{data:Object.assign(Object.assign({},H),P),error:null}}catch(P){if(ma(P))return{data:{clients:[]},error:P};throw P}}async _createOAuthClient(r){try{return await Fa(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:r,headers:this.headers,xform:c=>({data:c,error:null})})}catch(c){if(ma(c))return{data:null,error:c};throw c}}async _getOAuthClient(r){try{return await Fa(this.fetch,"GET",`${this.url}/admin/oauth/clients/${r}`,{headers:this.headers,xform:c=>({data:c,error:null})})}catch(c){if(ma(c))return{data:null,error:c};throw c}}async _deleteOAuthClient(r){try{return await Fa(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${r}`,{headers:this.headers,xform:c=>({data:c,error:null})})}catch(c){if(ma(c))return{data:null,error:c};throw c}}async _regenerateOAuthClientSecret(r){try{return await Fa(this.fetch,"POST",`${this.url}/admin/oauth/clients/${r}/regenerate_secret`,{headers:this.headers,xform:c=>({data:c,error:null})})}catch(c){if(ma(c))return{data:null,error:c};throw c}}}function jE(o={}){return{getItem:r=>o[r]||null,setItem:(r,c)=>{o[r]=c},removeItem:r=>{delete o[r]}}}const iy={debug:!!(globalThis&&MM()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class jM extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}class eN extends jM{}async function tN(o,r,c){iy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",o,r);const h=new globalThis.AbortController;return r>0&&setTimeout(()=>{h.abort(),iy.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",o)},r),await Promise.resolve().then(()=>globalThis.navigator.locks.request(o,r===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:h.signal},async p=>{if(p){iy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",o,p.name);try{return await c()}finally{iy.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",o,p.name)}}else{if(r===0)throw iy.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",o),new eN(`Acquiring an exclusive Navigator LockManager lock "${o}" immediately failed`);if(iy.debug)try{const x=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(x,null,"  "))}catch(x){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",x)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await c()}}))}function iN(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function zM(o){if(!/^0x[a-fA-F0-9]{40}$/.test(o))throw new Error(`@supabase/auth-js: Address "${o}" is invalid.`);return o.toLowerCase()}function nN(o){return parseInt(o,16)}function aN(o){const r=new TextEncoder().encode(o);return"0x"+Array.from(r,h=>h.toString(16).padStart(2,"0")).join("")}function rN(o){var r;const{chainId:c,domain:h,expirationTime:p,issuedAt:x=new Date,nonce:S,notBefore:i,requestId:M,resources:P,scheme:N,uri:H,version:W}=o;{if(!Number.isInteger(c))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${c}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(S&&S.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${S}`);if(!H)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(W!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${W}`);if(!((r=o.statement)===null||r===void 0)&&r.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${o.statement}`)}const K=zM(o.address),re=N?`${N}://${h}`:h,ae=o.statement?`${o.statement}
`:"",ce=`${re} wants you to sign in with your Ethereum account:
${K}

${ae}`;let ve=`URI: ${H}
Version: ${W}
Chain ID: ${c}${S?`
Nonce: ${S}`:""}
Issued At: ${x.toISOString()}`;if(p&&(ve+=`
Expiration Time: ${p.toISOString()}`),i&&(ve+=`
Not Before: ${i.toISOString()}`),M&&(ve+=`
Request ID: ${M}`),P){let Se=`
Resources:`;for(const Ee of P){if(!Ee||typeof Ee!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${Ee}`);Se+=`
- ${Ee}`}ve+=Se}return`${ce}
${ve}`}class Ho extends Error{constructor({message:r,code:c,cause:h,name:p}){var x;super(r,{cause:h}),this.__isWebAuthnError=!0,this.name=(x=p??(h instanceof Error?h.name:void 0))!==null&&x!==void 0?x:"Unknown Error",this.code=c}}class gb extends Ho{constructor(r,c){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c,message:r}),this.name="WebAuthnUnknownError",this.originalError=c}}function sN({error:o,options:r}){var c,h,p;const{publicKey:x}=r;if(!x)throw Error("options was missing required publicKey property");if(o.name==="AbortError"){if(r.signal instanceof AbortSignal)return new Ho({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:o})}else if(o.name==="ConstraintError"){if(((c=x.authenticatorSelection)===null||c===void 0?void 0:c.requireResidentKey)===!0)return new Ho({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:o});if(r.mediation==="conditional"&&((h=x.authenticatorSelection)===null||h===void 0?void 0:h.userVerification)==="required")return new Ho({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:o});if(((p=x.authenticatorSelection)===null||p===void 0?void 0:p.userVerification)==="required")return new Ho({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:o})}else{if(o.name==="InvalidStateError")return new Ho({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:o});if(o.name==="NotAllowedError")return new Ho({message:o.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o});if(o.name==="NotSupportedError")return x.pubKeyCredParams.filter(i=>i.type==="public-key").length===0?new Ho({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:o}):new Ho({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:o});if(o.name==="SecurityError"){const S=window.location.hostname;if(RM(S)){if(x.rp.id!==S)return new Ho({message:`The RP ID "${x.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:o})}else return new Ho({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:o})}else if(o.name==="TypeError"){if(x.user.id.byteLength<1||x.user.id.byteLength>64)return new Ho({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:o})}else if(o.name==="UnknownError")return new Ho({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:o})}return new Ho({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o})}function oN({error:o,options:r}){const{publicKey:c}=r;if(!c)throw Error("options was missing required publicKey property");if(o.name==="AbortError"){if(r.signal instanceof AbortSignal)return new Ho({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:o})}else{if(o.name==="NotAllowedError")return new Ho({message:o.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o});if(o.name==="SecurityError"){const h=window.location.hostname;if(RM(h)){if(c.rpId!==h)return new Ho({message:`The RP ID "${c.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:o})}else return new Ho({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:o})}else if(o.name==="UnknownError")return new Ho({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:o})}return new Ho({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o})}var IM=function(o,r){var c={};for(var h in o)Object.prototype.hasOwnProperty.call(o,h)&&r.indexOf(h)<0&&(c[h]=o[h]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,h=Object.getOwnPropertySymbols(o);p<h.length;p++)r.indexOf(h[p])<0&&Object.prototype.propertyIsEnumerable.call(o,h[p])&&(c[h[p]]=o[h[p]]);return c};class lN{createNewAbortSignal(){if(this.controller){const c=new Error("Cancelling existing WebAuthn API call for new one");c.name="AbortError",this.controller.abort(c)}const r=new AbortController;return this.controller=r,r.signal}cancelCeremony(){if(this.controller){const r=new Error("Manually cancelling existing WebAuthn API call");r.name="AbortError",this.controller.abort(r),this.controller=void 0}}}const cN=new lN;function uN(o){if(!o)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(o);const{challenge:r,user:c,excludeCredentials:h}=o,p=IM(o,["challenge","user","excludeCredentials"]),x=dy(r).buffer,S=Object.assign(Object.assign({},c),{id:dy(c.id).buffer}),i=Object.assign(Object.assign({},p),{challenge:x,user:S});if(h&&h.length>0){i.excludeCredentials=new Array(h.length);for(let M=0;M<h.length;M++){const P=h[M];i.excludeCredentials[M]=Object.assign(Object.assign({},P),{id:dy(P.id).buffer,type:P.type||"public-key",transports:P.transports})}}return i}function dN(o){if(!o)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(o);const{challenge:r,allowCredentials:c}=o,h=IM(o,["challenge","allowCredentials"]),p=dy(r).buffer,x=Object.assign(Object.assign({},h),{challenge:p});if(c&&c.length>0){x.allowCredentials=new Array(c.length);for(let S=0;S<c.length;S++){const i=c[S];x.allowCredentials[S]=Object.assign(Object.assign({},i),{id:dy(i.id).buffer,type:i.type||"public-key",transports:i.transports})}}return x}function hN(o){var r;if("toJSON"in o&&typeof o.toJSON=="function")return o.toJSON();const c=o;return{id:o.id,rawId:o.id,response:{attestationObject:qg(new Uint8Array(o.response.attestationObject)),clientDataJSON:qg(new Uint8Array(o.response.clientDataJSON))},type:"public-key",clientExtensionResults:o.getClientExtensionResults(),authenticatorAttachment:(r=c.authenticatorAttachment)!==null&&r!==void 0?r:void 0}}function fN(o){var r;if("toJSON"in o&&typeof o.toJSON=="function")return o.toJSON();const c=o,h=o.getClientExtensionResults(),p=o.response;return{id:o.id,rawId:o.id,response:{authenticatorData:qg(new Uint8Array(p.authenticatorData)),clientDataJSON:qg(new Uint8Array(p.clientDataJSON)),signature:qg(new Uint8Array(p.signature)),userHandle:p.userHandle?qg(new Uint8Array(p.userHandle)):void 0},type:"public-key",clientExtensionResults:h,authenticatorAttachment:(r=c.authenticatorAttachment)!==null&&r!==void 0?r:void 0}}function RM(o){return o==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(o)}function zE(){var o,r;return!!(Hu()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((o=navigator?.credentials)===null||o===void 0?void 0:o.create)=="function"&&typeof((r=navigator?.credentials)===null||r===void 0?void 0:r.get)=="function")}async function mN(o){try{const r=await navigator.credentials.create(o);return r?r instanceof PublicKeyCredential?{data:r,error:null}:{data:null,error:new gb("Browser returned unexpected credential type",r)}:{data:null,error:new gb("Empty credential response",r)}}catch(r){return{data:null,error:sN({error:r,options:o})}}}async function pN(o){try{const r=await navigator.credentials.get(o);return r?r instanceof PublicKeyCredential?{data:r,error:null}:{data:null,error:new gb("Browser returned unexpected credential type",r)}:{data:null,error:new gb("Empty credential response",r)}}catch(r){return{data:null,error:oN({error:r,options:o})}}}const gN={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},_N={userVerification:"preferred",hints:["security-key"]};function _b(...o){const r=p=>p!==null&&typeof p=="object"&&!Array.isArray(p),c=p=>p instanceof ArrayBuffer||ArrayBuffer.isView(p),h={};for(const p of o)if(p)for(const x in p){const S=p[x];if(S!==void 0)if(Array.isArray(S))h[x]=S;else if(c(S))h[x]=S;else if(r(S)){const i=h[x];r(i)?h[x]=_b(i,S):h[x]=_b(S)}else h[x]=S}return h}function yN(o,r){return _b(gN,o,r||{})}function vN(o,r){return _b(_N,o,r||{})}class xN{constructor(r){this.client=r,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(r){return this.client.mfa.enroll(Object.assign(Object.assign({},r),{factorType:"webauthn"}))}async _challenge({factorId:r,webauthn:c,friendlyName:h,signal:p},x){try{const{data:S,error:i}=await this.client.mfa.challenge({factorId:r,webauthn:c});if(!S)return{data:null,error:i};const M=p??cN.createNewAbortSignal();if(S.webauthn.type==="create"){const{user:P}=S.webauthn.credential_options.publicKey;P.name||(P.name=`${P.id}:${h}`),P.displayName||(P.displayName=P.name)}switch(S.webauthn.type){case"create":{const P=yN(S.webauthn.credential_options.publicKey,x?.create),{data:N,error:H}=await mN({publicKey:P,signal:M});return N?{data:{factorId:r,challengeId:S.id,webauthn:{type:S.webauthn.type,credential_response:N}},error:null}:{data:null,error:H}}case"request":{const P=vN(S.webauthn.credential_options.publicKey,x?.request),{data:N,error:H}=await pN(Object.assign(Object.assign({},S.webauthn.credential_options),{publicKey:P,signal:M}));return N?{data:{factorId:r,challengeId:S.id,webauthn:{type:S.webauthn.type,credential_response:N}},error:null}:{data:null,error:H}}}}catch(S){return ma(S)?{data:null,error:S}:{data:null,error:new Hg("Unexpected error in challenge",S)}}}async _verify({challengeId:r,factorId:c,webauthn:h}){return this.client.mfa.verify({factorId:c,challengeId:r,webauthn:h})}async _authenticate({factorId:r,webauthn:{rpId:c=typeof window<"u"?window.location.hostname:void 0,rpOrigins:h=typeof window<"u"?[window.location.origin]:void 0,signal:p}},x){if(!c)return{data:null,error:new nx("rpId is required for WebAuthn authentication")};try{if(!zE())return{data:null,error:new Hg("Browser does not support WebAuthn",null)};const{data:S,error:i}=await this.challenge({factorId:r,webauthn:{rpId:c,rpOrigins:h},signal:p},{request:x});if(!S)return{data:null,error:i};const{webauthn:M}=S;return this._verify({factorId:r,challengeId:S.challengeId,webauthn:{type:M.type,rpId:c,rpOrigins:h,credential_response:M.credential_response}})}catch(S){return ma(S)?{data:null,error:S}:{data:null,error:new Hg("Unexpected error in authenticate",S)}}}async _register({friendlyName:r,rpId:c=typeof window<"u"?window.location.hostname:void 0,rpOrigins:h=typeof window<"u"?[window.location.origin]:void 0,signal:p},x){if(!c)return{data:null,error:new nx("rpId is required for WebAuthn registration")};try{if(!zE())return{data:null,error:new Hg("Browser does not support WebAuthn",null)};const{data:S,error:i}=await this._enroll({friendlyName:r});if(!S)return await this.client.mfa.listFactors().then(N=>{var H;return(H=N.data)===null||H===void 0?void 0:H.all.find(W=>W.factor_type==="webauthn"&&W.friendly_name===r&&W.status!=="unverified")}).then(N=>N?this.client.mfa.unenroll({factorId:N?.id}):void 0),{data:null,error:i};const{data:M,error:P}=await this._challenge({factorId:S.id,friendlyName:S.friendly_name,webauthn:{rpId:c,rpOrigins:h},signal:p},{create:x});return M?this._verify({factorId:S.id,challengeId:M.challengeId,webauthn:{rpId:c,rpOrigins:h,type:M.webauthn.type,credential_response:M.webauthn.credential_response}}):{data:null,error:P}}catch(S){return ma(S)?{data:null,error:S}:{data:null,error:new Hg("Unexpected error in register",S)}}}}iN();const bN={url:g3,storageKey:_3,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:y3,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function IE(o,r,c){return await c()}const ny={};class ax{get jwks(){var r,c;return(c=(r=ny[this.storageKey])===null||r===void 0?void 0:r.jwks)!==null&&c!==void 0?c:{keys:[]}}set jwks(r){ny[this.storageKey]=Object.assign(Object.assign({},ny[this.storageKey]),{jwks:r})}get jwks_cached_at(){var r,c;return(c=(r=ny[this.storageKey])===null||r===void 0?void 0:r.cachedAt)!==null&&c!==void 0?c:Number.MIN_SAFE_INTEGER}set jwks_cached_at(r){ny[this.storageKey]=Object.assign(Object.assign({},ny[this.storageKey]),{cachedAt:r})}constructor(r){var c,h;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ax.nextInstanceID,ax.nextInstanceID+=1,this.instanceID>0&&Hu()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const p=Object.assign(Object.assign({},bN),r);if(this.logDebugMessages=!!p.debug,typeof p.debug=="function"&&(this.logger=p.debug),this.persistSession=p.persistSession,this.storageKey=p.storageKey,this.autoRefreshToken=p.autoRefreshToken,this.admin=new Q3({url:p.url,headers:p.headers,fetch:p.fetch}),this.url=p.url,this.headers=p.headers,this.fetch=PM(p.fetch),this.lock=p.lock||IE,this.detectSessionInUrl=p.detectSessionInUrl,this.flowType=p.flowType,this.hasCustomAuthorizationHeader=p.hasCustomAuthorizationHeader,p.lock?this.lock=p.lock:Hu()&&(!((c=globalThis?.navigator)===null||c===void 0)&&c.locks)?this.lock=tN:this.lock=IE,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new xN(this)},this.persistSession?(p.storage?this.storage=p.storage:MM()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=jE(this.memoryStorage)),p.userStorage&&(this.userStorage=p.userStorage)):(this.memoryStorage={},this.storage=jE(this.memoryStorage)),Hu()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(x){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",x)}(h=this.broadcastChannel)===null||h===void 0||h.addEventListener("message",async x=>{this._debug("received broadcast notification from other tab or client",x),await this._notifyAllSubscribers(x.data.event,x.data.session,!1)})}this.initialize()}_debug(...r){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${EM}) ${new Date().toISOString()}`,...r),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var r;try{const c=z3(window.location.href);let h="none";if(this._isImplicitGrantCallback(c)?h="implicit":await this._isPKCECallback(c)&&(h="pkce"),Hu()&&this.detectSessionInUrl&&h!=="none"){const{data:p,error:x}=await this._getSessionFromURL(c,h);if(x){if(this._debug("#_initialize()","error detecting session from URL",x),T3(x)){const M=(r=x.details)===null||r===void 0?void 0:r.code;if(M==="identity_already_exists"||M==="identity_not_found"||M==="single_identity_not_deletable")return{error:x}}return await this._removeSession(),{error:x}}const{session:S,redirectType:i}=p;return this._debug("#_initialize()","detected session in URL",S,"redirect type",i),await this._saveSession(S),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",S):await this._notifyAllSubscribers("SIGNED_IN",S)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(c){return ma(c)?{error:c}:{error:new Hg("Unexpected error during initialization",c)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(r){var c,h,p;try{const x=await Fa(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(h=(c=r?.options)===null||c===void 0?void 0:c.data)!==null&&h!==void 0?h:{},gotrue_meta_security:{captcha_token:(p=r?.options)===null||p===void 0?void 0:p.captchaToken}},xform:vh}),{data:S,error:i}=x;if(i||!S)return{data:{user:null,session:null},error:i};const M=S.session,P=S.user;return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",M)),{data:{user:P,session:M},error:null}}catch(x){if(ma(x))return{data:{user:null,session:null},error:x};throw x}}async signUp(r){var c,h,p;try{let x;if("email"in r){const{email:N,password:H,options:W}=r;let K=null,re=null;this.flowType==="pkce"&&([K,re]=await ey(this.storage,this.storageKey)),x=await Fa(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:W?.emailRedirectTo,body:{email:N,password:H,data:(c=W?.data)!==null&&c!==void 0?c:{},gotrue_meta_security:{captcha_token:W?.captchaToken},code_challenge:K,code_challenge_method:re},xform:vh})}else if("phone"in r){const{phone:N,password:H,options:W}=r;x=await Fa(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:N,password:H,data:(h=W?.data)!==null&&h!==void 0?h:{},channel:(p=W?.channel)!==null&&p!==void 0?p:"sms",gotrue_meta_security:{captcha_token:W?.captchaToken}},xform:vh})}else throw new A0("You must provide either an email or phone number and a password");const{data:S,error:i}=x;if(i||!S)return{data:{user:null,session:null},error:i};const M=S.session,P=S.user;return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",M)),{data:{user:P,session:M},error:null}}catch(x){if(ma(x))return{data:{user:null,session:null},error:x};throw x}}async signInWithPassword(r){try{let c;if("email"in r){const{email:x,password:S,options:i}=r;c=await Fa(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:x,password:S,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:ME})}else if("phone"in r){const{phone:x,password:S,options:i}=r;c=await Fa(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:x,password:S,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:ME})}else throw new A0("You must provide either an email or phone number and a password");const{data:h,error:p}=c;return p?{data:{user:null,session:null},error:p}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new Q_}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:Object.assign({user:h.user,session:h.session},h.weak_password?{weakPassword:h.weak_password}:null),error:p})}catch(c){if(ma(c))return{data:{user:null,session:null},error:c};throw c}}async signInWithOAuth(r){var c,h,p,x;return await this._handleProviderSignIn(r.provider,{redirectTo:(c=r.options)===null||c===void 0?void 0:c.redirectTo,scopes:(h=r.options)===null||h===void 0?void 0:h.scopes,queryParams:(p=r.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:(x=r.options)===null||x===void 0?void 0:x.skipBrowserRedirect})}async exchangeCodeForSession(r){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(r))}async signInWithWeb3(r){const{chain:c}=r;switch(c){case"ethereum":return await this.signInWithEthereum(r);case"solana":return await this.signInWithSolana(r);default:throw new Error(`@supabase/auth-js: Unsupported chain "${c}"`)}}async signInWithEthereum(r){var c,h,p,x,S,i,M,P,N,H,W;let K,re;if("message"in r)K=r.message,re=r.signature;else{const{chain:ae,wallet:ce,statement:ve,options:Se}=r;let Ee;if(Hu())if(typeof ce=="object")Ee=ce;else{const lt=window;if("ethereum"in lt&&typeof lt.ethereum=="object"&&"request"in lt.ethereum&&typeof lt.ethereum.request=="function")Ee=lt.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof ce!="object"||!Se?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Ee=ce}const Qe=new URL((c=Se?.url)!==null&&c!==void 0?c:window.location.href),He=await Ee.request({method:"eth_requestAccounts"}).then(lt=>lt).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!He||He.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const ke=zM(He[0]);let tt=(h=Se?.signInWithEthereum)===null||h===void 0?void 0:h.chainId;if(!tt){const lt=await Ee.request({method:"eth_chainId"});tt=nN(lt)}const Ke={domain:Qe.host,address:ke,statement:ve,uri:Qe.href,version:"1",chainId:tt,nonce:(p=Se?.signInWithEthereum)===null||p===void 0?void 0:p.nonce,issuedAt:(S=(x=Se?.signInWithEthereum)===null||x===void 0?void 0:x.issuedAt)!==null&&S!==void 0?S:new Date,expirationTime:(i=Se?.signInWithEthereum)===null||i===void 0?void 0:i.expirationTime,notBefore:(M=Se?.signInWithEthereum)===null||M===void 0?void 0:M.notBefore,requestId:(P=Se?.signInWithEthereum)===null||P===void 0?void 0:P.requestId,resources:(N=Se?.signInWithEthereum)===null||N===void 0?void 0:N.resources};K=rN(Ke),re=await Ee.request({method:"personal_sign",params:[aN(K),ke]})}try{const{data:ae,error:ce}=await Fa(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:K,signature:re},!((H=r.options)===null||H===void 0)&&H.captchaToken?{gotrue_meta_security:{captcha_token:(W=r.options)===null||W===void 0?void 0:W.captchaToken}}:null),xform:vh});if(ce)throw ce;return!ae||!ae.session||!ae.user?{data:{user:null,session:null},error:new Q_}:(ae.session&&(await this._saveSession(ae.session),await this._notifyAllSubscribers("SIGNED_IN",ae.session)),{data:Object.assign({},ae),error:ce})}catch(ae){if(ma(ae))return{data:{user:null,session:null},error:ae};throw ae}}async signInWithSolana(r){var c,h,p,x,S,i,M,P,N,H,W,K;let re,ae;if("message"in r)re=r.message,ae=r.signature;else{const{chain:ce,wallet:ve,statement:Se,options:Ee}=r;let Qe;if(Hu())if(typeof ve=="object")Qe=ve;else{const ke=window;if("solana"in ke&&typeof ke.solana=="object"&&("signIn"in ke.solana&&typeof ke.solana.signIn=="function"||"signMessage"in ke.solana&&typeof ke.solana.signMessage=="function"))Qe=ke.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof ve!="object"||!Ee?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Qe=ve}const He=new URL((c=Ee?.url)!==null&&c!==void 0?c:window.location.href);if("signIn"in Qe&&Qe.signIn){const ke=await Qe.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Ee?.signInWithSolana),{version:"1",domain:He.host,uri:He.href}),Se?{statement:Se}:null));let tt;if(Array.isArray(ke)&&ke[0]&&typeof ke[0]=="object")tt=ke[0];else if(ke&&typeof ke=="object"&&"signedMessage"in ke&&"signature"in ke)tt=ke;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in tt&&"signature"in tt&&(typeof tt.signedMessage=="string"||tt.signedMessage instanceof Uint8Array)&&tt.signature instanceof Uint8Array)re=typeof tt.signedMessage=="string"?tt.signedMessage:new TextDecoder().decode(tt.signedMessage),ae=tt.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Qe)||typeof Qe.signMessage!="function"||!("publicKey"in Qe)||typeof Qe!="object"||!Qe.publicKey||!("toBase58"in Qe.publicKey)||typeof Qe.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");re=[`${He.host} wants you to sign in with your Solana account:`,Qe.publicKey.toBase58(),...Se?["",Se,""]:[""],"Version: 1",`URI: ${He.href}`,`Issued At: ${(p=(h=Ee?.signInWithSolana)===null||h===void 0?void 0:h.issuedAt)!==null&&p!==void 0?p:new Date().toISOString()}`,...!((x=Ee?.signInWithSolana)===null||x===void 0)&&x.notBefore?[`Not Before: ${Ee.signInWithSolana.notBefore}`]:[],...!((S=Ee?.signInWithSolana)===null||S===void 0)&&S.expirationTime?[`Expiration Time: ${Ee.signInWithSolana.expirationTime}`]:[],...!((i=Ee?.signInWithSolana)===null||i===void 0)&&i.chainId?[`Chain ID: ${Ee.signInWithSolana.chainId}`]:[],...!((M=Ee?.signInWithSolana)===null||M===void 0)&&M.nonce?[`Nonce: ${Ee.signInWithSolana.nonce}`]:[],...!((P=Ee?.signInWithSolana)===null||P===void 0)&&P.requestId?[`Request ID: ${Ee.signInWithSolana.requestId}`]:[],...!((H=(N=Ee?.signInWithSolana)===null||N===void 0?void 0:N.resources)===null||H===void 0)&&H.length?["Resources",...Ee.signInWithSolana.resources.map(tt=>`- ${tt}`)]:[]].join(`
`);const ke=await Qe.signMessage(new TextEncoder().encode(re),"utf8");if(!ke||!(ke instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");ae=ke}}try{const{data:ce,error:ve}=await Fa(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:re,signature:qg(ae)},!((W=r.options)===null||W===void 0)&&W.captchaToken?{gotrue_meta_security:{captcha_token:(K=r.options)===null||K===void 0?void 0:K.captchaToken}}:null),xform:vh});if(ve)throw ve;return!ce||!ce.session||!ce.user?{data:{user:null,session:null},error:new Q_}:(ce.session&&(await this._saveSession(ce.session),await this._notifyAllSubscribers("SIGNED_IN",ce.session)),{data:Object.assign({},ce),error:ve})}catch(ce){if(ma(ce))return{data:{user:null,session:null},error:ce};throw ce}}async _exchangeCodeForSession(r){const c=await Lg(this.storage,`${this.storageKey}-code-verifier`),[h,p]=(c??"").split("/");try{const{data:x,error:S}=await Fa(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:r,code_verifier:h},xform:vh});if(await Ap(this.storage,`${this.storageKey}-code-verifier`),S)throw S;return!x||!x.session||!x.user?{data:{user:null,session:null,redirectType:null},error:new Q_}:(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),{data:Object.assign(Object.assign({},x),{redirectType:p??null}),error:S})}catch(x){if(ma(x))return{data:{user:null,session:null,redirectType:null},error:x};throw x}}async signInWithIdToken(r){try{const{options:c,provider:h,token:p,access_token:x,nonce:S}=r,i=await Fa(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:h,id_token:p,access_token:x,nonce:S,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:vh}),{data:M,error:P}=i;return P?{data:{user:null,session:null},error:P}:!M||!M.session||!M.user?{data:{user:null,session:null},error:new Q_}:(M.session&&(await this._saveSession(M.session),await this._notifyAllSubscribers("SIGNED_IN",M.session)),{data:M,error:P})}catch(c){if(ma(c))return{data:{user:null,session:null},error:c};throw c}}async signInWithOtp(r){var c,h,p,x,S;try{if("email"in r){const{email:i,options:M}=r;let P=null,N=null;this.flowType==="pkce"&&([P,N]=await ey(this.storage,this.storageKey));const{error:H}=await Fa(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:(c=M?.data)!==null&&c!==void 0?c:{},create_user:(h=M?.shouldCreateUser)!==null&&h!==void 0?h:!0,gotrue_meta_security:{captcha_token:M?.captchaToken},code_challenge:P,code_challenge_method:N},redirectTo:M?.emailRedirectTo});return{data:{user:null,session:null},error:H}}if("phone"in r){const{phone:i,options:M}=r,{data:P,error:N}=await Fa(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:i,data:(p=M?.data)!==null&&p!==void 0?p:{},create_user:(x=M?.shouldCreateUser)!==null&&x!==void 0?x:!0,gotrue_meta_security:{captcha_token:M?.captchaToken},channel:(S=M?.channel)!==null&&S!==void 0?S:"sms"}});return{data:{user:null,session:null,messageId:P?.message_id},error:N}}throw new A0("You must provide either an email or phone number.")}catch(i){if(ma(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(r){var c,h;try{let p,x;"options"in r&&(p=(c=r.options)===null||c===void 0?void 0:c.redirectTo,x=(h=r.options)===null||h===void 0?void 0:h.captchaToken);const{data:S,error:i}=await Fa(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},r),{gotrue_meta_security:{captcha_token:x}}),redirectTo:p,xform:vh});if(i)throw i;if(!S)throw new Error("An error occurred on token verification.");const M=S.session,P=S.user;return M?.access_token&&(await this._saveSession(M),await this._notifyAllSubscribers(r.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",M)),{data:{user:P,session:M},error:null}}catch(p){if(ma(p))return{data:{user:null,session:null},error:p};throw p}}async signInWithSSO(r){var c,h,p;try{let x=null,S=null;return this.flowType==="pkce"&&([x,S]=await ey(this.storage,this.storageKey)),await Fa(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in r?{provider_id:r.providerId}:null),"domain"in r?{domain:r.domain}:null),{redirect_to:(h=(c=r.options)===null||c===void 0?void 0:c.redirectTo)!==null&&h!==void 0?h:void 0}),!((p=r?.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:r.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:x,code_challenge_method:S}),headers:this.headers,xform:X3})}catch(x){if(ma(x))return{data:null,error:x};throw x}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async r=>{const{data:{session:c},error:h}=r;if(h)throw h;if(!c)throw new Pp;const{error:p}=await Fa(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:c.access_token});return{data:{user:null,session:null},error:p}})}catch(r){if(ma(r))return{data:{user:null,session:null},error:r};throw r}}async resend(r){try{const c=`${this.url}/resend`;if("email"in r){const{email:h,type:p,options:x}=r,{error:S}=await Fa(this.fetch,"POST",c,{headers:this.headers,body:{email:h,type:p,gotrue_meta_security:{captcha_token:x?.captchaToken}},redirectTo:x?.emailRedirectTo});return{data:{user:null,session:null},error:S}}else if("phone"in r){const{phone:h,type:p,options:x}=r,{data:S,error:i}=await Fa(this.fetch,"POST",c,{headers:this.headers,body:{phone:h,type:p,gotrue_meta_security:{captcha_token:x?.captchaToken}}});return{data:{user:null,session:null,messageId:S?.message_id},error:i}}throw new A0("You must provide either an email or phone number and a type")}catch(c){if(ma(c))return{data:{user:null,session:null},error:c};throw c}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async c=>c))}async _acquireLock(r,c){this._debug("#_acquireLock","begin",r);try{if(this.lockAcquired){const h=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),p=(async()=>(await h,await c()))();return this.pendingInLock.push((async()=>{try{await p}catch{}})()),p}return await this.lock(`lock:${this.storageKey}`,r,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const h=c();for(this.pendingInLock.push((async()=>{try{await h}catch{}})()),await h;this.pendingInLock.length;){const p=[...this.pendingInLock];await Promise.all(p),this.pendingInLock.splice(0,p.length)}return await h}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(r){this._debug("#_useSession","begin");try{const c=await this.__loadSession();return await r(c)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let r=null;const c=await Lg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",c),c!==null&&(this._isValidSession(c)?r=c:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!r)return{data:{session:null},error:null};const h=r.expires_at?r.expires_at*1e3-Date.now()<s1:!1;if(this._debug("#__loadSession()",`session has${h?"":" not"} expired`,"expires_at",r.expires_at),!h){if(this.userStorage){const S=await Lg(this.userStorage,this.storageKey+"-user");S?.user?r.user=S.user:r.user=c1()}if(this.storage.isServer&&r.user){let S=this.suppressGetSessionWarning;r=new Proxy(r,{get:(M,P,N)=>(!S&&P==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),S=!0,this.suppressGetSessionWarning=!0),Reflect.get(M,P,N))})}return{data:{session:r},error:null}}const{data:p,error:x}=await this._callRefreshToken(r.refresh_token);return x?{data:{session:null},error:x}:{data:{session:p},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(r){return r?await this._getUser(r):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(r){try{return r?await Fa(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:r,xform:Ip}):await this._useSession(async c=>{var h,p,x;const{data:S,error:i}=c;if(i)throw i;return!(!((h=S.session)===null||h===void 0)&&h.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Pp}:await Fa(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(x=(p=S.session)===null||p===void 0?void 0:p.access_token)!==null&&x!==void 0?x:void 0,xform:Ip})})}catch(c){if(ma(c))return S3(c)&&(await this._removeSession(),await Ap(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:c};throw c}}async updateUser(r,c={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(r,c))}async _updateUser(r,c={}){try{return await this._useSession(async h=>{const{data:p,error:x}=h;if(x)throw x;if(!p.session)throw new Pp;const S=p.session;let i=null,M=null;this.flowType==="pkce"&&r.email!=null&&([i,M]=await ey(this.storage,this.storageKey));const{data:P,error:N}=await Fa(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:c?.emailRedirectTo,body:Object.assign(Object.assign({},r),{code_challenge:i,code_challenge_method:M}),jwt:S.access_token,xform:Ip});if(N)throw N;return S.user=P.user,await this._saveSession(S),await this._notifyAllSubscribers("USER_UPDATED",S),{data:{user:S.user},error:null}})}catch(h){if(ma(h))return{data:{user:null},error:h};throw h}}async setSession(r){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(r))}async _setSession(r){try{if(!r.access_token||!r.refresh_token)throw new Pp;const c=Date.now()/1e3;let h=c,p=!0,x=null;const{payload:S}=l1(r.access_token);if(S.exp&&(h=S.exp,p=h<=c),p){const{data:i,error:M}=await this._callRefreshToken(r.refresh_token);if(M)return{data:{user:null,session:null},error:M};if(!i)return{data:{user:null,session:null},error:null};x=i}else{const{data:i,error:M}=await this._getUser(r.access_token);if(M)throw M;x={access_token:r.access_token,refresh_token:r.refresh_token,user:i.user,token_type:"bearer",expires_in:h-c,expires_at:h},await this._saveSession(x),await this._notifyAllSubscribers("SIGNED_IN",x)}return{data:{user:x.user,session:x},error:null}}catch(c){if(ma(c))return{data:{session:null,user:null},error:c};throw c}}async refreshSession(r){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(r))}async _refreshSession(r){try{return await this._useSession(async c=>{var h;if(!r){const{data:S,error:i}=c;if(i)throw i;r=(h=S.session)!==null&&h!==void 0?h:void 0}if(!r?.refresh_token)throw new Pp;const{data:p,error:x}=await this._callRefreshToken(r.refresh_token);return x?{data:{user:null,session:null},error:x}:p?{data:{user:p.user,session:p},error:null}:{data:{user:null,session:null},error:null}})}catch(c){if(ma(c))return{data:{user:null,session:null},error:c};throw c}}async _getSessionFromURL(r,c){try{if(!Hu())throw new C0("No browser detected.");if(r.error||r.error_description||r.error_code)throw new C0(r.error_description||"Error in URL with unspecified error_description",{error:r.error||"unspecified_error",code:r.error_code||"unspecified_code"});switch(c){case"implicit":if(this.flowType==="pkce")throw new wE("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new C0("Not a valid implicit grant flow url.");break;default:}if(c==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!r.code)throw new wE("No code detected.");const{data:Se,error:Ee}=await this._exchangeCodeForSession(r.code);if(Ee)throw Ee;const Qe=new URL(window.location.href);return Qe.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Qe.toString()),{data:{session:Se.session,redirectType:null},error:null}}const{provider_token:h,provider_refresh_token:p,access_token:x,refresh_token:S,expires_in:i,expires_at:M,token_type:P}=r;if(!x||!i||!S||!P)throw new C0("No session defined in URL");const N=Math.round(Date.now()/1e3),H=parseInt(i);let W=N+H;M&&(W=parseInt(M));const K=W-N;K*1e3<=oy&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${K}s, should have been closer to ${H}s`);const re=W-H;N-re>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",re,W,N):N-re<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",re,W,N);const{data:ae,error:ce}=await this._getUser(x);if(ce)throw ce;const ve={provider_token:h,provider_refresh_token:p,access_token:x,expires_in:H,expires_at:W,refresh_token:S,token_type:P,user:ae.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:ve,redirectType:r.type},error:null}}catch(h){if(ma(h))return{data:{session:null,redirectType:null},error:h};throw h}}_isImplicitGrantCallback(r){return!!(r.access_token||r.error_description)}async _isPKCECallback(r){const c=await Lg(this.storage,`${this.storageKey}-code-verifier`);return!!(r.code&&c)}async signOut(r={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(r))}async _signOut({scope:r}={scope:"global"}){return await this._useSession(async c=>{var h;const{data:p,error:x}=c;if(x)return{error:x};const S=(h=p.session)===null||h===void 0?void 0:h.access_token;if(S){const{error:i}=await this.admin.signOut(S,r);if(i&&!(w3(i)&&(i.status===404||i.status===401||i.status===403)))return{error:i}}return r!=="others"&&(await this._removeSession(),await Ap(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(r){const c=j3(),h={id:c,callback:r,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",c),this.stateChangeEmitters.delete(c)}};return this._debug("#onAuthStateChange()","registered callback with id",c),this.stateChangeEmitters.set(c,h),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(c)})))(),{data:{subscription:h}}}async _emitInitialSession(r){return await this._useSession(async c=>{var h,p;try{const{data:{session:x},error:S}=c;if(S)throw S;await((h=this.stateChangeEmitters.get(r))===null||h===void 0?void 0:h.callback("INITIAL_SESSION",x)),this._debug("INITIAL_SESSION","callback id",r,"session",x)}catch(x){await((p=this.stateChangeEmitters.get(r))===null||p===void 0?void 0:p.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",r,"error",x),console.error(x)}})}async resetPasswordForEmail(r,c={}){let h=null,p=null;this.flowType==="pkce"&&([h,p]=await ey(this.storage,this.storageKey,!0));try{return await Fa(this.fetch,"POST",`${this.url}/recover`,{body:{email:r,code_challenge:h,code_challenge_method:p,gotrue_meta_security:{captcha_token:c.captchaToken}},headers:this.headers,redirectTo:c.redirectTo})}catch(x){if(ma(x))return{data:null,error:x};throw x}}async getUserIdentities(){var r;try{const{data:c,error:h}=await this.getUser();if(h)throw h;return{data:{identities:(r=c.user.identities)!==null&&r!==void 0?r:[]},error:null}}catch(c){if(ma(c))return{data:null,error:c};throw c}}async linkIdentity(r){return"token"in r?this.linkIdentityIdToken(r):this.linkIdentityOAuth(r)}async linkIdentityOAuth(r){var c;try{const{data:h,error:p}=await this._useSession(async x=>{var S,i,M,P,N;const{data:H,error:W}=x;if(W)throw W;const K=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,r.provider,{redirectTo:(S=r.options)===null||S===void 0?void 0:S.redirectTo,scopes:(i=r.options)===null||i===void 0?void 0:i.scopes,queryParams:(M=r.options)===null||M===void 0?void 0:M.queryParams,skipBrowserRedirect:!0});return await Fa(this.fetch,"GET",K,{headers:this.headers,jwt:(N=(P=H.session)===null||P===void 0?void 0:P.access_token)!==null&&N!==void 0?N:void 0})});if(p)throw p;return Hu()&&!(!((c=r.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(h?.url),{data:{provider:r.provider,url:h?.url},error:null}}catch(h){if(ma(h))return{data:{provider:r.provider,url:null},error:h};throw h}}async linkIdentityIdToken(r){return await this._useSession(async c=>{var h;try{const{error:p,data:{session:x}}=c;if(p)throw p;const{options:S,provider:i,token:M,access_token:P,nonce:N}=r,H=await Fa(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(h=x?.access_token)!==null&&h!==void 0?h:void 0,body:{provider:i,id_token:M,access_token:P,nonce:N,link_identity:!0,gotrue_meta_security:{captcha_token:S?.captchaToken}},xform:vh}),{data:W,error:K}=H;return K?{data:{user:null,session:null},error:K}:!W||!W.session||!W.user?{data:{user:null,session:null},error:new Q_}:(W.session&&(await this._saveSession(W.session),await this._notifyAllSubscribers("USER_UPDATED",W.session)),{data:W,error:K})}catch(p){if(ma(p))return{data:{user:null,session:null},error:p};throw p}})}async unlinkIdentity(r){try{return await this._useSession(async c=>{var h,p;const{data:x,error:S}=c;if(S)throw S;return await Fa(this.fetch,"DELETE",`${this.url}/user/identities/${r.identity_id}`,{headers:this.headers,jwt:(p=(h=x.session)===null||h===void 0?void 0:h.access_token)!==null&&p!==void 0?p:void 0})})}catch(c){if(ma(c))return{data:null,error:c};throw c}}async _refreshAccessToken(r){const c=`#_refreshAccessToken(${r.substring(0,5)}...)`;this._debug(c,"begin");try{const h=Date.now();return await D3(async p=>(p>0&&await R3(200*Math.pow(2,p-1)),this._debug(c,"refreshing attempt",p),await Fa(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:r},headers:this.headers,xform:vh})),(p,x)=>{const S=200*Math.pow(2,p);return x&&o1(x)&&Date.now()+S-h<oy})}catch(h){if(this._debug(c,"error",h),ma(h))return{data:{session:null,user:null},error:h};throw h}finally{this._debug(c,"end")}}_isValidSession(r){return typeof r=="object"&&r!==null&&"access_token"in r&&"refresh_token"in r&&"expires_at"in r}async _handleProviderSignIn(r,c){const h=await this._getUrlForProvider(`${this.url}/authorize`,r,{redirectTo:c.redirectTo,scopes:c.scopes,queryParams:c.queryParams});return this._debug("#_handleProviderSignIn()","provider",r,"options",c,"url",h),Hu()&&!c.skipBrowserRedirect&&window.location.assign(h),{data:{provider:r,url:h},error:null}}async _recoverAndRefresh(){var r,c;const h="#_recoverAndRefresh()";this._debug(h,"begin");try{const p=await Lg(this.storage,this.storageKey);if(p&&this.userStorage){let S=await Lg(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!S&&(S={user:p.user},await ly(this.userStorage,this.storageKey+"-user",S)),p.user=(r=S?.user)!==null&&r!==void 0?r:c1()}else if(p&&!p.user&&!p.user){const S=await Lg(this.storage,this.storageKey+"-user");S&&S?.user?(p.user=S.user,await Ap(this.storage,this.storageKey+"-user"),await ly(this.storage,this.storageKey,p)):p.user=c1()}if(this._debug(h,"session from storage",p),!this._isValidSession(p)){this._debug(h,"session is not valid"),p!==null&&await this._removeSession();return}const x=((c=p.expires_at)!==null&&c!==void 0?c:1/0)*1e3-Date.now()<s1;if(this._debug(h,`session has${x?"":" not"} expired with margin of ${s1}s`),x){if(this.autoRefreshToken&&p.refresh_token){const{error:S}=await this._callRefreshToken(p.refresh_token);S&&(console.error(S),o1(S)||(this._debug(h,"refresh failed with a non-retryable error, removing the session",S),await this._removeSession()))}}else if(p.user&&p.user.__isUserNotAvailableProxy===!0)try{const{data:S,error:i}=await this._getUser(p.access_token);!i&&S?.user?(p.user=S.user,await this._saveSession(p),await this._notifyAllSubscribers("SIGNED_IN",p)):this._debug(h,"could not get user data, skipping SIGNED_IN notification")}catch(S){console.error("Error getting user data:",S),this._debug(h,"error getting user data, skipping SIGNED_IN notification",S)}else await this._notifyAllSubscribers("SIGNED_IN",p)}catch(p){this._debug(h,"error",p),console.error(p);return}finally{this._debug(h,"end")}}async _callRefreshToken(r){var c,h;if(!r)throw new Pp;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const p=`#_callRefreshToken(${r.substring(0,5)}...)`;this._debug(p,"begin");try{this.refreshingDeferred=new jb;const{data:x,error:S}=await this._refreshAccessToken(r);if(S)throw S;if(!x.session)throw new Pp;await this._saveSession(x.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",x.session);const i={data:x.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(x){if(this._debug(p,"error",x),ma(x)){const S={data:null,error:x};return o1(x)||await this._removeSession(),(c=this.refreshingDeferred)===null||c===void 0||c.resolve(S),S}throw(h=this.refreshingDeferred)===null||h===void 0||h.reject(x),x}finally{this.refreshingDeferred=null,this._debug(p,"end")}}async _notifyAllSubscribers(r,c,h=!0){const p=`#_notifyAllSubscribers(${r})`;this._debug(p,"begin",c,`broadcast = ${h}`);try{this.broadcastChannel&&h&&this.broadcastChannel.postMessage({event:r,session:c});const x=[],S=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(r,c)}catch(M){x.push(M)}});if(await Promise.all(S),x.length>0){for(let i=0;i<x.length;i+=1)console.error(x[i]);throw x[0]}}finally{this._debug(p,"end")}}async _saveSession(r){this._debug("#_saveSession()",r),this.suppressGetSessionWarning=!0;const c=Object.assign({},r),h=c.user&&c.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!h&&c.user&&await ly(this.userStorage,this.storageKey+"-user",{user:c.user});const p=Object.assign({},c);delete p.user;const x=AE(p);await ly(this.storage,this.storageKey,x)}else{const p=AE(c);await ly(this.storage,this.storageKey,p)}}async _removeSession(){this._debug("#_removeSession()"),await Ap(this.storage,this.storageKey),await Ap(this.storage,this.storageKey+"-code-verifier"),await Ap(this.storage,this.storageKey+"-user"),this.userStorage&&await Ap(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const r=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{r&&Hu()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",r)}catch(c){console.error("removing visibilitychange callback failed",c)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const r=setInterval(()=>this._autoRefreshTokenTick(),oy);this.autoRefreshTicker=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const r=this.autoRefreshTicker;this.autoRefreshTicker=null,r&&clearInterval(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const r=Date.now();try{return await this._useSession(async c=>{const{data:{session:h}}=c;if(!h||!h.refresh_token||!h.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const p=Math.floor((h.expires_at*1e3-r)/oy);this._debug("#_autoRefreshTokenTick()",`access token expires in ${p} ticks, a tick lasts ${oy}ms, refresh threshold is ${X1} ticks`),p<=X1&&await this._callRefreshToken(h.refresh_token)})}catch(c){console.error("Auto refresh tick failed with error. This is likely a transient error.",c)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(r){if(r.isAcquireTimeout||r instanceof jM)this._debug("auto refresh token tick lock not available");else throw r}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Hu()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(r){console.error("_handleVisibilityChange",r)}}async _onVisibilityChanged(r){const c=`#_onVisibilityChanged(${r})`;this._debug(c,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),r||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(c,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(r,c,h){const p=[`provider=${encodeURIComponent(c)}`];if(h?.redirectTo&&p.push(`redirect_to=${encodeURIComponent(h.redirectTo)}`),h?.scopes&&p.push(`scopes=${encodeURIComponent(h.scopes)}`),this.flowType==="pkce"){const[x,S]=await ey(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(x)}`,code_challenge_method:`${encodeURIComponent(S)}`});p.push(i.toString())}if(h?.queryParams){const x=new URLSearchParams(h.queryParams);p.push(x.toString())}return h?.skipBrowserRedirect&&p.push(`skip_http_redirect=${h.skipBrowserRedirect}`),`${r}?${p.join("&")}`}async _unenroll(r){try{return await this._useSession(async c=>{var h;const{data:p,error:x}=c;return x?{data:null,error:x}:await Fa(this.fetch,"DELETE",`${this.url}/factors/${r.factorId}`,{headers:this.headers,jwt:(h=p?.session)===null||h===void 0?void 0:h.access_token})})}catch(c){if(ma(c))return{data:null,error:c};throw c}}async _enroll(r){try{return await this._useSession(async c=>{var h,p;const{data:x,error:S}=c;if(S)return{data:null,error:S};const i=Object.assign({friendly_name:r.friendlyName,factor_type:r.factorType},r.factorType==="phone"?{phone:r.phone}:r.factorType==="totp"?{issuer:r.issuer}:{}),{data:M,error:P}=await Fa(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:(h=x?.session)===null||h===void 0?void 0:h.access_token});return P?{data:null,error:P}:(r.factorType==="totp"&&M.type==="totp"&&(!((p=M?.totp)===null||p===void 0)&&p.qr_code)&&(M.totp.qr_code=`data:image/svg+xml;utf-8,${M.totp.qr_code}`),{data:M,error:null})})}catch(c){if(ma(c))return{data:null,error:c};throw c}}async _verify(r){return this._acquireLock(-1,async()=>{try{return await this._useSession(async c=>{var h;const{data:p,error:x}=c;if(x)return{data:null,error:x};const S=Object.assign({challenge_id:r.challengeId},"webauthn"in r?{webauthn:Object.assign(Object.assign({},r.webauthn),{credential_response:r.webauthn.type==="create"?hN(r.webauthn.credential_response):fN(r.webauthn.credential_response)})}:{code:r.code}),{data:i,error:M}=await Fa(this.fetch,"POST",`${this.url}/factors/${r.factorId}/verify`,{body:S,headers:this.headers,jwt:(h=p?.session)===null||h===void 0?void 0:h.access_token});return M?{data:null,error:M}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:M})})}catch(c){if(ma(c))return{data:null,error:c};throw c}})}async _challenge(r){return this._acquireLock(-1,async()=>{try{return await this._useSession(async c=>{var h;const{data:p,error:x}=c;if(x)return{data:null,error:x};const S=await Fa(this.fetch,"POST",`${this.url}/factors/${r.factorId}/challenge`,{body:r,headers:this.headers,jwt:(h=p?.session)===null||h===void 0?void 0:h.access_token});if(S.error)return S;const{data:i}=S;if(i.type!=="webauthn")return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:uN(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:dN(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(c){if(ma(c))return{data:null,error:c};throw c}})}async _challengeAndVerify(r){const{data:c,error:h}=await this._challenge({factorId:r.factorId});return h?{data:null,error:h}:await this._verify({factorId:r.factorId,challengeId:c.id,code:r.code})}async _listFactors(){var r;const{data:{user:c},error:h}=await this.getUser();if(h)return{data:null,error:h};const p={all:[],phone:[],totp:[],webauthn:[]};for(const x of(r=c?.factors)!==null&&r!==void 0?r:[])p.all.push(x),x.status==="verified"&&p[x.factor_type].push(x);return{data:p,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async r=>{var c,h;const{data:{session:p},error:x}=r;if(x)return{data:null,error:x};if(!p)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:S}=l1(p.access_token);let i=null;S.aal&&(i=S.aal);let M=i;((h=(c=p.user.factors)===null||c===void 0?void 0:c.filter(H=>H.status==="verified"))!==null&&h!==void 0?h:[]).length>0&&(M="aal2");const N=S.amr||[];return{data:{currentLevel:i,nextLevel:M,currentAuthenticationMethods:N},error:null}}))}async fetchJwk(r,c={keys:[]}){let h=c.keys.find(i=>i.kid===r);if(h)return h;const p=Date.now();if(h=this.jwks.keys.find(i=>i.kid===r),h&&this.jwks_cached_at+x3>p)return h;const{data:x,error:S}=await Fa(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(S)throw S;return!x.keys||x.keys.length===0||(this.jwks=x,this.jwks_cached_at=p,h=x.keys.find(i=>i.kid===r),!h)?null:h}async getClaims(r,c={}){try{let h=r;if(!h){const{data:K,error:re}=await this.getSession();if(re||!K.session)return{data:null,error:re};h=K.session.access_token}const{header:p,payload:x,signature:S,raw:{header:i,payload:M}}=l1(h);c?.allowExpired||$3(x.exp);const P=!p.alg||p.alg.startsWith("HS")||!p.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(p.kid,c?.keys?{keys:c.keys}:c?.jwks);if(!P){const{error:K}=await this.getUser(h);if(K)throw K;return{data:{claims:x,header:p,signature:S},error:null}}const N=V3(p.alg),H=await crypto.subtle.importKey("jwk",P,N,!0,["verify"]);if(!await crypto.subtle.verify(N,H,S,M3(`${i}.${M}`)))throw new J1("Invalid JWT signature");return{data:{claims:x,header:p,signature:S},error:null}}catch(h){if(ma(h))return{data:null,error:h};throw h}}}ax.nextInstanceID=0;const wN=ax;class SN extends wN{constructor(r){super(r)}}var TN=function(o,r,c,h){function p(x){return x instanceof c?x:new c(function(S){S(x)})}return new(c||(c=Promise))(function(x,S){function i(N){try{P(h.next(N))}catch(H){S(H)}}function M(N){try{P(h.throw(N))}catch(H){S(H)}}function P(N){N.done?x(N.value):p(N.value).then(i,M)}P((h=h.apply(o,r||[])).next())})};class kN{constructor(r,c,h){var p,x,S;this.supabaseUrl=r,this.supabaseKey=c;const i=p3(r);if(!c)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const M=`sb-${i.hostname.split(".")[0]}-auth-token`,P={db:r3,realtime:o3,auth:Object.assign(Object.assign({},s3),{storageKey:M}),global:a3},N=m3(h??{},P);this.storageKey=(p=N.auth.storageKey)!==null&&p!==void 0?p:"",this.headers=(x=N.global.headers)!==null&&x!==void 0?x:{},N.accessToken?(this.accessToken=N.accessToken,this.auth=new Proxy({},{get:(H,W)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(W)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((S=N.auth)!==null&&S!==void 0?S:{},this.headers,N.global.fetch),this.fetch=d3(c,this._getAccessToken.bind(this),N.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},N.realtime)),this.rest=new bO(new URL("rest/v1",i).href,{headers:this.headers,schema:N.db.schema,fetch:this.fetch}),this.storage=new t3(this.storageUrl.href,this.headers,this.fetch,h?.storage),N.accessToken||this._listenForAuthEvents()}get functions(){return new dO(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,c={},h={}){return this.rest.rpc(r,c,h)}channel(r,c={config:{}}){return this.realtime.channel(r,c)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return TN(this,void 0,void 0,function*(){var r,c;if(this.accessToken)return yield this.accessToken();const{data:h}=yield this.auth.getSession();return(c=(r=h.session)===null||r===void 0?void 0:r.access_token)!==null&&c!==void 0?c:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:c,detectSessionInUrl:h,storage:p,userStorage:x,storageKey:S,flowType:i,lock:M,debug:P},N,H){const W={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SN({url:this.authUrl.href,headers:Object.assign(Object.assign({},W),N),storageKey:S,autoRefreshToken:r,persistSession:c,detectSessionInUrl:h,storage:p,userStorage:x,flowType:i,lock:M,debug:P,fetch:H,hasCustomAuthorizationHeader:Object.keys(this.headers).some(K=>K.toLowerCase()==="authorization")})}_initRealtimeClient(r){return new NO(this.realtimeUrl.href,Object.assign(Object.assign({},r),{params:Object.assign({apikey:this.supabaseKey},r?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((c,h)=>{this._handleTokenChanged(c,"CLIENT",h?.access_token)})}_handleTokenChanged(r,c,h){(r==="TOKEN_REFRESHED"||r==="SIGNED_IN")&&this.changedAccessToken!==h?(this.changedAccessToken=h,this.realtime.setAuth(h)):r==="SIGNED_OUT"&&(this.realtime.setAuth(),c=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const EN=(o,r,c)=>new kN(o,r,c);function AN(){if(typeof window<"u"||typeof process>"u")return!1;const o=process.version;if(o==null)return!1;const r=o.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}AN()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const CN="https://jraryrxoyhdjsbojezow.supabase.co",MN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyYXJ5cnhveWhkanNib2plem93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1Njk2NjAsImV4cCI6MjA2MjE0NTY2MH0.j42O4xJQodo3pIinATA3C4aylhRdmIemPHMBr6FWRic",bs=EN(CN,MN),$r=(o=!1,r="/auth")=>{const[c,h]=ye.useState(null),p=$a();return ye.useEffect(()=>{(async()=>{try{const{data:S,error:i}=await bs.auth.getSession();if(i){console.error("Error fetching session:",i);return}h(S.session||null),o&&!S.session&&p(r,{replace:!0})}catch(S){console.error(S)}})()},[p,o,r]),c};function Q1(o,r,c,h){const x=N=>N*Math.PI/180,S=x(c-o),i=x(h-r),M=Math.sin(S/2)**2+Math.cos(x(o))*Math.cos(x(c))*Math.sin(i/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)))}function PN(){const{location:o,setLocation:r}=mM(),c=Uc(),{markets:h}=xy(null),p=$r(),[x,S]=ye.useState(null);return ye.useEffect(()=>{if(c.pathname==="/map")return;navigator.geolocation.getCurrentPosition(M=>{const P={lat:M.coords.latitude,lng:M.coords.longitude};r(P)});const i=setInterval(()=>{navigator.geolocation.getCurrentPosition(M=>{const P={lat:M.coords.latitude,lng:M.coords.longitude};r(P)})},6e4);return()=>clearInterval(i)},[c.pathname,r]),ye.useEffect(()=>{if(!o||!h?.length||!p?.user)return;const i=5e3,M=p.user.id;(async()=>{for(const N of h)if(Q1(o.lat,o.lng,N.latitude,N.longitude)<=i)try{(await(await fetch(`/v1/market/${N.id}/visit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:M})})).json())?.created_at&&S(N)}catch(W){console.error("[CheckIn] Error:",W)}})()},[o,h,p]),C.jsx(C.Fragment,{children:x&&C.jsx(rO,{market:x,onClose:()=>S(null)})})}const jN=()=>C.jsxs("div",{className:"bg-[var(--white)] min-h-screen flex flex-col",children:[C.jsx(PN,{}),C.jsx("div",{className:"flex-1",children:C.jsx(zD,{})}),C.jsx(aO,{})]});let eS={},DM;function d1(o={}){eS={animate:!0,allowClose:!0,overlayClickBehavior:"close",overlayOpacity:.7,smoothScroll:!1,disableActiveInteraction:!1,showProgress:!1,stagePadding:10,stageRadius:5,popoverOffset:10,showButtons:["next","previous","close"],disableButtons:[],overlayColor:"#000",...o}}function In(o){return o?eS[o]:eS}function zN(o){DM=o}function Zu(){return DM}let yb={};function M0(o,r){yb[o]=r}function Zg(o){var r;(r=yb[o])==null||r.call(yb)}function IN(){yb={}}function P0(o,r,c,h){return(o/=h/2)<1?c/2*o*o+r:-c/2*(--o*(o-2)-1)+r}function LM(o){const r='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])';return o.flatMap(c=>{const h=c.matches(r),p=Array.from(c.querySelectorAll(r));return[...h?[c]:[],...p]}).filter(c=>getComputedStyle(c).pointerEvents!=="none"&&LN(c))}function OM(o){if(!o||DN(o))return;const r=In("smoothScroll"),c=o.offsetHeight>window.innerHeight;o.scrollIntoView({behavior:!r||RN(o)?"auto":"smooth",inline:"center",block:c?"start":"center"})}function RN(o){if(!o||!o.parentElement)return;const r=o.parentElement;return r.scrollHeight>r.clientHeight}function DN(o){const r=o.getBoundingClientRect();return r.top>=0&&r.left>=0&&r.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&r.right<=(window.innerWidth||document.documentElement.clientWidth)}function LN(o){return!!(o.offsetWidth||o.offsetHeight||o.getClientRects().length)}let vb={};function Il(o,r){vb[o]=r}function Gn(o){return o?vb[o]:vb}function RE(){vb={}}function ON(o,r,c,h){let p=Gn("__activeStagePosition");const x=p||c.getBoundingClientRect(),S=h.getBoundingClientRect(),i=P0(o,x.x,S.x-x.x,r),M=P0(o,x.y,S.y-x.y,r),P=P0(o,x.width,S.width-x.width,r),N=P0(o,x.height,S.height-x.height,r);p={x:i,y:M,width:P,height:N},FM(p),Il("__activeStagePosition",p)}function NM(o){if(!o)return;const r=o.getBoundingClientRect(),c={x:r.x,y:r.y,width:r.width,height:r.height};Il("__activeStagePosition",c),FM(c)}function NN(){const o=Gn("__activeStagePosition"),r=Gn("__overlaySvg");if(!o)return;if(!r){console.warn("No stage svg found.");return}const c=window.innerWidth,h=window.innerHeight;r.setAttribute("viewBox",`0 0 ${c} ${h}`)}function FN(o){const r=BN(o);document.body.appendChild(r),$M(r,c=>{c.target.tagName==="path"&&Zg("overlayClick")}),Il("__overlaySvg",r)}function FM(o){const r=Gn("__overlaySvg");if(!r){FN(o);return}const c=r.firstElementChild;if(c?.tagName!=="path")throw new Error("no path element found in stage svg");c.setAttribute("d",BM(o))}function BN(o){const r=window.innerWidth,c=window.innerHeight,h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.classList.add("driver-overlay","driver-overlay-animated"),h.setAttribute("viewBox",`0 0 ${r} ${c}`),h.setAttribute("xmlSpace","preserve"),h.setAttribute("xmlnsXlink","http://www.w3.org/1999/xlink"),h.setAttribute("version","1.1"),h.setAttribute("preserveAspectRatio","xMinYMin slice"),h.style.fillRule="evenodd",h.style.clipRule="evenodd",h.style.strokeLinejoin="round",h.style.strokeMiterlimit="2",h.style.zIndex="10000",h.style.position="fixed",h.style.top="0",h.style.left="0",h.style.width="100%",h.style.height="100%";const p=document.createElementNS("http://www.w3.org/2000/svg","path");return p.setAttribute("d",BM(o)),p.style.fill=In("overlayColor")||"rgb(0,0,0)",p.style.opacity=`${In("overlayOpacity")}`,p.style.pointerEvents="auto",p.style.cursor="auto",h.appendChild(p),h}function BM(o){const r=window.innerWidth,c=window.innerHeight,h=In("stagePadding")||0,p=In("stageRadius")||0,x=o.width+h*2,S=o.height+h*2,i=Math.min(p,x/2,S/2),M=Math.floor(Math.max(i,0)),P=o.x-h+M,N=o.y-h,H=x-M*2,W=S-M*2;return`M${r},0L0,0L0,${c}L${r},${c}L${r},0Z
    M${P},${N} h${H} a${M},${M} 0 0 1 ${M},${M} v${W} a${M},${M} 0 0 1 -${M},${M} h-${H} a${M},${M} 0 0 1 -${M},-${M} v-${W} a${M},${M} 0 0 1 ${M},-${M} z`}function UN(){const o=Gn("__overlaySvg");o&&o.remove()}function $N(){const o=document.getElementById("driver-dummy-element");if(o)return o;let r=document.createElement("div");return r.id="driver-dummy-element",r.style.width="0",r.style.height="0",r.style.pointerEvents="none",r.style.opacity="0",r.style.position="fixed",r.style.top="50%",r.style.left="50%",document.body.appendChild(r),r}function DE(o){const{element:r}=o;let c=typeof r=="function"?r():typeof r=="string"?document.querySelector(r):r;c||(c=$N()),HN(c,o)}function VN(){const o=Gn("__activeElement"),r=Gn("__activeStep");o&&(NM(o),NN(),HM(o,r))}function HN(o,r){var c;const h=Date.now(),p=Gn("__activeStep"),x=Gn("__activeElement")||o,S=!x||x===o,i=o.id==="driver-dummy-element",M=x.id==="driver-dummy-element",P=In("animate"),N=r.onHighlightStarted||In("onHighlightStarted"),H=r?.onHighlighted||In("onHighlighted"),W=p?.onDeselected||In("onDeselected"),K=In(),re=Gn();!S&&W&&W(M?void 0:x,p,{config:K,state:re,driver:Zu()}),N&&N(i?void 0:o,r,{config:K,state:re,driver:Zu()});const ae=!S&&P;let ce=!1;XN(),Il("previousStep",p),Il("previousElement",x),Il("activeStep",r),Il("activeElement",o);const ve=()=>{if(Gn("__transitionCallback")!==ve)return;const Se=Date.now()-h,Ee=400-Se<=400/2;r.popover&&Ee&&!ce&&ae&&(LE(o,r),ce=!0),In("animate")&&Se<400?ON(Se,400,x,o):(NM(o),H&&H(i?void 0:o,r,{config:In(),state:Gn(),driver:Zu()}),Il("__transitionCallback",void 0),Il("__previousStep",p),Il("__previousElement",x),Il("__activeStep",r),Il("__activeElement",o)),window.requestAnimationFrame(ve)};Il("__transitionCallback",ve),window.requestAnimationFrame(ve),OM(o),!ae&&r.popover&&LE(o,r),x.classList.remove("driver-active-element","driver-no-interaction"),x.removeAttribute("aria-haspopup"),x.removeAttribute("aria-expanded"),x.removeAttribute("aria-controls"),((c=r.disableActiveInteraction)!=null?c:In("disableActiveInteraction"))&&o.classList.add("driver-no-interaction"),o.classList.add("driver-active-element"),o.setAttribute("aria-haspopup","dialog"),o.setAttribute("aria-expanded","true"),o.setAttribute("aria-controls","driver-popover-content")}function GN(){var o;(o=document.getElementById("driver-dummy-element"))==null||o.remove(),document.querySelectorAll(".driver-active-element").forEach(r=>{r.classList.remove("driver-active-element","driver-no-interaction"),r.removeAttribute("aria-haspopup"),r.removeAttribute("aria-expanded"),r.removeAttribute("aria-controls")})}function rx(){const o=Gn("__resizeTimeout");o&&window.cancelAnimationFrame(o),Il("__resizeTimeout",window.requestAnimationFrame(VN))}function qN(o){var r;if(!Gn("isInitialized")||!(o.key==="Tab"||o.keyCode===9))return;const c=Gn("__activeElement"),h=(r=Gn("popover"))==null?void 0:r.wrapper,p=LM([...h?[h]:[],...c?[c]:[]]),x=p[0],S=p[p.length-1];if(o.preventDefault(),o.shiftKey){const i=p[p.indexOf(document.activeElement)-1]||S;i?.focus()}else{const i=p[p.indexOf(document.activeElement)+1]||x;i?.focus()}}function UM(o){var r;((r=In("allowKeyboardControl"))==null||r)&&(o.key==="Escape"?Zg("escapePress"):o.key==="ArrowRight"?Zg("arrowRightPress"):o.key==="ArrowLeft"&&Zg("arrowLeftPress"))}function $M(o,r,c){const h=(p,x)=>{const S=p.target;o.contains(S)&&((!c||c(S))&&(p.preventDefault(),p.stopPropagation(),p.stopImmediatePropagation()),x?.(p))};document.addEventListener("pointerdown",h,!0),document.addEventListener("mousedown",h,!0),document.addEventListener("pointerup",h,!0),document.addEventListener("mouseup",h,!0),document.addEventListener("click",p=>{h(p,r)},!0)}function WN(){window.addEventListener("keyup",UM,!1),window.addEventListener("keydown",qN,!1),window.addEventListener("resize",rx),window.addEventListener("scroll",rx)}function ZN(){window.removeEventListener("keyup",UM),window.removeEventListener("resize",rx),window.removeEventListener("scroll",rx)}function XN(){const o=Gn("popover");o&&(o.wrapper.style.display="none")}function LE(o,r){var c,h;let p=Gn("popover");p&&document.body.removeChild(p.wrapper),p=KN(),document.body.appendChild(p.wrapper);const{title:x,description:S,showButtons:i,disableButtons:M,showProgress:P,nextBtnText:N=In("nextBtnText")||"Next &rarr;",prevBtnText:H=In("prevBtnText")||"&larr; Previous",progressText:W=In("progressText")||"{current} of {total}"}=r.popover||{};p.nextButton.innerHTML=N,p.previousButton.innerHTML=H,p.progress.innerHTML=W,x?(p.title.innerHTML=x,p.title.style.display="block"):p.title.style.display="none",S?(p.description.innerHTML=S,p.description.style.display="block"):p.description.style.display="none";const K=i||In("showButtons"),re=P||In("showProgress")||!1,ae=K?.includes("next")||K?.includes("previous")||re;p.closeButton.style.display=K.includes("close")?"block":"none",ae?(p.footer.style.display="flex",p.progress.style.display=re?"block":"none",p.nextButton.style.display=K.includes("next")?"block":"none",p.previousButton.style.display=K.includes("previous")?"block":"none"):p.footer.style.display="none";const ce=M||In("disableButtons")||[];ce!=null&&ce.includes("next")&&(p.nextButton.disabled=!0,p.nextButton.classList.add("driver-popover-btn-disabled")),ce!=null&&ce.includes("previous")&&(p.previousButton.disabled=!0,p.previousButton.classList.add("driver-popover-btn-disabled")),ce!=null&&ce.includes("close")&&(p.closeButton.disabled=!0,p.closeButton.classList.add("driver-popover-btn-disabled"));const ve=p.wrapper;ve.style.display="block",ve.style.left="",ve.style.top="",ve.style.bottom="",ve.style.right="",ve.id="driver-popover-content",ve.setAttribute("role","dialog"),ve.setAttribute("aria-labelledby","driver-popover-title"),ve.setAttribute("aria-describedby","driver-popover-description");const Se=p.arrow;Se.className="driver-popover-arrow";const Ee=((c=r.popover)==null?void 0:c.popoverClass)||In("popoverClass")||"";ve.className=`driver-popover ${Ee}`.trim(),$M(p.wrapper,tt=>{var Ke,lt,ft;const gt=tt.target,ni=((Ke=r.popover)==null?void 0:Ke.onNextClick)||In("onNextClick"),Ft=((lt=r.popover)==null?void 0:lt.onPrevClick)||In("onPrevClick"),Vi=((ft=r.popover)==null?void 0:ft.onCloseClick)||In("onCloseClick");if(gt.closest(".driver-popover-next-btn"))return ni?ni(o,r,{config:In(),state:Gn(),driver:Zu()}):Zg("nextClick");if(gt.closest(".driver-popover-prev-btn"))return Ft?Ft(o,r,{config:In(),state:Gn(),driver:Zu()}):Zg("prevClick");if(gt.closest(".driver-popover-close-btn"))return Vi?Vi(o,r,{config:In(),state:Gn(),driver:Zu()}):Zg("closeClick")},tt=>!(p!=null&&p.description.contains(tt))&&!(p!=null&&p.title.contains(tt))&&typeof tt.className=="string"&&tt.className.includes("driver-popover")),Il("popover",p);const Qe=((h=r.popover)==null?void 0:h.onPopoverRender)||In("onPopoverRender");Qe&&Qe(p,{config:In(),state:Gn(),driver:Zu()}),HM(o,r),OM(ve);const He=o.classList.contains("driver-dummy-element"),ke=LM([ve,...He?[]:[o]]);ke.length>0&&ke[0].focus()}function VM(){const o=Gn("popover");if(!(o!=null&&o.wrapper))return;const r=o.wrapper.getBoundingClientRect(),c=In("stagePadding")||0,h=In("popoverOffset")||0;return{width:r.width+c+h,height:r.height+c+h,realWidth:r.width,realHeight:r.height}}function OE(o,r){const{elementDimensions:c,popoverDimensions:h,popoverPadding:p,popoverArrowDimensions:x}=r;return o==="start"?Math.max(Math.min(c.top-p,window.innerHeight-h.realHeight-x.width),x.width):o==="end"?Math.max(Math.min(c.top-h?.realHeight+c.height+p,window.innerHeight-h?.realHeight-x.width),x.width):o==="center"?Math.max(Math.min(c.top+c.height/2-h?.realHeight/2,window.innerHeight-h?.realHeight-x.width),x.width):0}function NE(o,r){const{elementDimensions:c,popoverDimensions:h,popoverPadding:p,popoverArrowDimensions:x}=r;return o==="start"?Math.max(Math.min(c.left-p,window.innerWidth-h.realWidth-x.width),x.width):o==="end"?Math.max(Math.min(c.left-h?.realWidth+c.width+p,window.innerWidth-h?.realWidth-x.width),x.width):o==="center"?Math.max(Math.min(c.left+c.width/2-h?.realWidth/2,window.innerWidth-h?.realWidth-x.width),x.width):0}function HM(o,r){const c=Gn("popover");if(!c)return;const{align:h="start",side:p="left"}=r?.popover||{},x=h,S=o.id==="driver-dummy-element"?"over":p,i=In("stagePadding")||0,M=VM(),P=c.arrow.getBoundingClientRect(),N=o.getBoundingClientRect(),H=N.top-M.height;let W=H>=0;const K=window.innerHeight-(N.bottom+M.height);let re=K>=0;const ae=N.left-M.width;let ce=ae>=0;const ve=window.innerWidth-(N.right+M.width);let Se=ve>=0;const Ee=!W&&!re&&!ce&&!Se;let Qe=S;if(S==="top"&&W?Se=ce=re=!1:S==="bottom"&&re?Se=ce=W=!1:S==="left"&&ce?Se=W=re=!1:S==="right"&&Se&&(ce=W=re=!1),S==="over"){const He=window.innerWidth/2-M.realWidth/2,ke=window.innerHeight/2-M.realHeight/2;c.wrapper.style.left=`${He}px`,c.wrapper.style.right="auto",c.wrapper.style.top=`${ke}px`,c.wrapper.style.bottom="auto"}else if(Ee){const He=window.innerWidth/2-M?.realWidth/2,ke=10;c.wrapper.style.left=`${He}px`,c.wrapper.style.right="auto",c.wrapper.style.bottom=`${ke}px`,c.wrapper.style.top="auto"}else if(ce){const He=Math.min(ae,window.innerWidth-M?.realWidth-P.width),ke=OE(x,{elementDimensions:N,popoverDimensions:M,popoverPadding:i,popoverArrowDimensions:P});c.wrapper.style.left=`${He}px`,c.wrapper.style.top=`${ke}px`,c.wrapper.style.bottom="auto",c.wrapper.style.right="auto",Qe="left"}else if(Se){const He=Math.min(ve,window.innerWidth-M?.realWidth-P.width),ke=OE(x,{elementDimensions:N,popoverDimensions:M,popoverPadding:i,popoverArrowDimensions:P});c.wrapper.style.right=`${He}px`,c.wrapper.style.top=`${ke}px`,c.wrapper.style.bottom="auto",c.wrapper.style.left="auto",Qe="right"}else if(W){const He=Math.min(H,window.innerHeight-M.realHeight-P.width);let ke=NE(x,{elementDimensions:N,popoverDimensions:M,popoverPadding:i,popoverArrowDimensions:P});c.wrapper.style.top=`${He}px`,c.wrapper.style.left=`${ke}px`,c.wrapper.style.bottom="auto",c.wrapper.style.right="auto",Qe="top"}else if(re){const He=Math.min(K,window.innerHeight-M?.realHeight-P.width);let ke=NE(x,{elementDimensions:N,popoverDimensions:M,popoverPadding:i,popoverArrowDimensions:P});c.wrapper.style.left=`${ke}px`,c.wrapper.style.bottom=`${He}px`,c.wrapper.style.top="auto",c.wrapper.style.right="auto",Qe="bottom"}Ee?c.arrow.classList.add("driver-popover-arrow-none"):YN(x,Qe,o)}function YN(o,r,c){const h=Gn("popover");if(!h)return;const p=c.getBoundingClientRect(),x=VM(),S=h.arrow,i=x.width,M=window.innerWidth,P=p.width,N=p.left,H=x.height,W=window.innerHeight,K=p.top,re=p.height;S.className="driver-popover-arrow";let ae=r,ce=o;if(r==="top"?(N+P<=0?(ae="right",ce="end"):N+P-i<=0&&(ae="top",ce="start"),N>=M?(ae="left",ce="end"):N+i>=M&&(ae="top",ce="end")):r==="bottom"?(N+P<=0?(ae="right",ce="start"):N+P-i<=0&&(ae="bottom",ce="start"),N>=M?(ae="left",ce="start"):N+i>=M&&(ae="bottom",ce="end")):r==="left"?(K+re<=0?(ae="bottom",ce="end"):K+re-H<=0&&(ae="left",ce="start"),K>=W?(ae="top",ce="end"):K+H>=W&&(ae="left",ce="end")):r==="right"&&(K+re<=0?(ae="bottom",ce="start"):K+re-H<=0&&(ae="right",ce="start"),K>=W?(ae="top",ce="start"):K+H>=W&&(ae="right",ce="end")),!ae)S.classList.add("driver-popover-arrow-none");else{S.classList.add(`driver-popover-arrow-side-${ae}`),S.classList.add(`driver-popover-arrow-align-${ce}`);const ve=c.getBoundingClientRect(),Se=S.getBoundingClientRect(),Ee=In("stagePadding")||0,Qe=ve.left-Ee<window.innerWidth&&ve.right+Ee>0&&ve.top-Ee<window.innerHeight&&ve.bottom+Ee>0;r==="bottom"&&Qe&&(Se.x>ve.x&&Se.x+Se.width<ve.x+ve.width?h.wrapper.style.transform="translateY(0)":(S.classList.remove(`driver-popover-arrow-align-${ce}`),S.classList.add("driver-popover-arrow-none"),h.wrapper.style.transform=`translateY(-${Ee/2}px)`))}}function KN(){const o=document.createElement("div");o.classList.add("driver-popover");const r=document.createElement("div");r.classList.add("driver-popover-arrow");const c=document.createElement("header");c.id="driver-popover-title",c.classList.add("driver-popover-title"),c.style.display="none",c.innerText="Popover Title";const h=document.createElement("div");h.id="driver-popover-description",h.classList.add("driver-popover-description"),h.style.display="none",h.innerText="Popover description is here";const p=document.createElement("button");p.type="button",p.classList.add("driver-popover-close-btn"),p.setAttribute("aria-label","Close"),p.innerHTML="&times;";const x=document.createElement("footer");x.classList.add("driver-popover-footer");const S=document.createElement("span");S.classList.add("driver-popover-progress-text"),S.innerText="";const i=document.createElement("span");i.classList.add("driver-popover-navigation-btns");const M=document.createElement("button");M.type="button",M.classList.add("driver-popover-prev-btn"),M.innerHTML="&larr; Previous";const P=document.createElement("button");return P.type="button",P.classList.add("driver-popover-next-btn"),P.innerHTML="Next &rarr;",i.appendChild(M),i.appendChild(P),x.appendChild(S),x.appendChild(i),o.appendChild(p),o.appendChild(r),o.appendChild(c),o.appendChild(h),o.appendChild(x),{wrapper:o,arrow:r,title:c,description:h,footer:x,previousButton:M,nextButton:P,closeButton:p,footerButtons:i,progress:S}}function JN(){var o;const r=Gn("popover");r&&((o=r.wrapper.parentElement)==null||o.removeChild(r.wrapper))}function GM(o={}){d1(o);function r(){In("allowClose")&&N()}function c(){const W=In("overlayClickBehavior");if(In("allowClose")&&W==="close"){N();return}if(typeof W=="function"){const K=Gn("__activeStep"),re=Gn("__activeElement");W(re,K,{config:In(),state:Gn(),driver:Zu()});return}W==="nextStep"&&h()}function h(){const W=Gn("activeIndex"),K=In("steps")||[];if(typeof W>"u")return;const re=W+1;K[re]?P(re):N()}function p(){const W=Gn("activeIndex"),K=In("steps")||[];if(typeof W>"u")return;const re=W-1;K[re]?P(re):N()}function x(W){(In("steps")||[])[W]?P(W):N()}function S(){var W;if(Gn("__transitionCallback"))return;const K=Gn("activeIndex"),re=Gn("__activeStep"),ae=Gn("__activeElement");if(typeof K>"u"||typeof re>"u"||typeof Gn("activeIndex")>"u")return;const ce=((W=re.popover)==null?void 0:W.onPrevClick)||In("onPrevClick");if(ce)return ce(ae,re,{config:In(),state:Gn(),driver:Zu()});p()}function i(){var W;if(Gn("__transitionCallback"))return;const K=Gn("activeIndex"),re=Gn("__activeStep"),ae=Gn("__activeElement");if(typeof K>"u"||typeof re>"u")return;const ce=((W=re.popover)==null?void 0:W.onNextClick)||In("onNextClick");if(ce)return ce(ae,re,{config:In(),state:Gn(),driver:Zu()});h()}function M(){Gn("isInitialized")||(Il("isInitialized",!0),document.body.classList.add("driver-active",In("animate")?"driver-fade":"driver-simple"),WN(),M0("overlayClick",c),M0("escapePress",r),M0("arrowLeftPress",S),M0("arrowRightPress",i))}function P(W=0){var K,re,ae,ce,ve,Se,Ee,Qe;const He=In("steps");if(!He){console.error("No steps to drive through"),N();return}if(!He[W]){N();return}Il("__activeOnDestroyed",document.activeElement),Il("activeIndex",W);const ke=He[W],tt=He[W+1],Ke=He[W-1],lt=((K=ke.popover)==null?void 0:K.doneBtnText)||In("doneBtnText")||"Done",ft=In("allowClose"),gt=typeof((re=ke.popover)==null?void 0:re.showProgress)<"u"?(ae=ke.popover)==null?void 0:ae.showProgress:In("showProgress"),ni=(((ce=ke.popover)==null?void 0:ce.progressText)||In("progressText")||"{{current}} of {{total}}").replace("{{current}}",`${W+1}`).replace("{{total}}",`${He.length}`),Ft=((ve=ke.popover)==null?void 0:ve.showButtons)||In("showButtons"),Vi=["next","previous",...ft?["close"]:[]].filter(jt=>!(Ft!=null&&Ft.length)||Ft.includes(jt)),Ri=((Se=ke.popover)==null?void 0:Se.onNextClick)||In("onNextClick"),We=((Ee=ke.popover)==null?void 0:Ee.onPrevClick)||In("onPrevClick"),Et=((Qe=ke.popover)==null?void 0:Qe.onCloseClick)||In("onCloseClick");DE({...ke,popover:{showButtons:Vi,nextBtnText:tt?void 0:lt,disableButtons:[...Ke?[]:["previous"]],showProgress:gt,progressText:ni,onNextClick:Ri||(()=>{tt?P(W+1):N()}),onPrevClick:We||(()=>{P(W-1)}),onCloseClick:Et||(()=>{N()}),...ke?.popover||{}}})}function N(W=!0){const K=Gn("__activeElement"),re=Gn("__activeStep"),ae=Gn("__activeOnDestroyed"),ce=In("onDestroyStarted");if(W&&ce){const Ee=!K||K?.id==="driver-dummy-element";ce(Ee?void 0:K,re,{config:In(),state:Gn(),driver:Zu()});return}const ve=re?.onDeselected||In("onDeselected"),Se=In("onDestroyed");if(document.body.classList.remove("driver-active","driver-fade","driver-simple"),ZN(),JN(),GN(),UN(),IN(),RE(),K&&re){const Ee=K.id==="driver-dummy-element";ve&&ve(Ee?void 0:K,re,{config:In(),state:Gn(),driver:Zu()}),Se&&Se(Ee?void 0:K,re,{config:In(),state:Gn(),driver:Zu()})}ae&&ae.focus()}const H={isActive:()=>Gn("isInitialized")||!1,refresh:rx,drive:(W=0)=>{M(),P(W)},setConfig:d1,setSteps:W=>{RE(),d1({...In(),steps:W})},getConfig:In,getState:Gn,getActiveIndex:()=>Gn("activeIndex"),isFirstStep:()=>Gn("activeIndex")===0,isLastStep:()=>{const W=In("steps")||[],K=Gn("activeIndex");return K!==void 0&&K===W.length-1},getActiveStep:()=>Gn("activeStep"),getActiveElement:()=>Gn("activeElement"),getPreviousElement:()=>Gn("previousElement"),getPreviousStep:()=>Gn("previousStep"),moveNext:h,movePrevious:p,moveTo:x,hasNextStep:()=>{const W=In("steps")||[],K=Gn("activeIndex");return K!==void 0&&!!W[K+1]},hasPreviousStep:()=>{const W=In("steps")||[],K=Gn("activeIndex");return K!==void 0&&!!W[K-1]},highlight:W=>{M(),DE({...W,popover:W.popover?{showButtons:[],showProgress:!1,progressText:"",...W.popover}:void 0})},destroy:()=>{N(!1)}};return zN(H),H}const wy=()=>{const[o,r]=ye.useState(null);return ye.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(c=>{r([c.coords.latitude,c.coords.longitude])},c=>{console.error("Error getting location:",c),r(null)})},[]),o};function ES(o,r,c){const[h,p]=ye.useState(null),[x,S]=ye.useState(!0),[i,M]=ye.useState(null),P=wy();return ye.useEffect(()=>{if(!P||!o||!r)return;(async()=>{const[H,W]=P,ae=`https://api.openrouteservice.org/v2/directions/foot-walking?api_key=eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6Ijk2YjUyZGU4NzRiNDQyMWVhODZjZDhhZjkzNmFkODNmIiwiaCI6Im11cm11cjY0In0=&start=${W},${H}&end=${r},${o}`;try{const ve=await(await fetch(ae)).json();if(!ve.features?.[0]?.properties?.summary?.distance)throw new Error("Invalid response from routing API");const Se=ve.features[0].properties.summary.distance;p((Se/1e3).toFixed(1))}catch(ce){console.error("Error fetching distance:",ce),M(ce)}finally{S(!1)}})()},[P,o,r]),{distance:h,loading:x,error:i}}const qM=({market:o,height:r=250})=>{const{distance:c,loading:h}=ES(o.latitude,o.longitude),p=new Date,x=p.getDay()+1,S=N=>{if(!N)return 0;const[H,W]=N.split(":").map(Number);return H*60+W},i=(o.schedules||[]).filter(N=>!!(N.daily_day&&N.daily_day===x||N.weekly_day&&N.weekly_day===x||N.once_date&&new Date(N.once_date).toDateString()===p.toDateString()));let M=!1,P="";if(i.length>0){const N=i[0],H=S(N.open_time),W=S(N.close_time),K=p.getHours()*60+p.getMinutes();H<=W?M=K>=H&&K<=W:M=K>=H||K<=W;const ae=M?W>=K?W-K:1440-K+W:H>=K?H-K:1440-K+H,ce=Math.floor(ae/60),ve=ae%60;P=M?ce>0?`Closes in ${ce}h ${ve}m`:`Closes in ${ve}m`:ce>0?`Opens in ${ce}h ${ve}m`:`Opens in ${ve}m`}else{const N=p.getTime(),H=(o.schedules||[]).map(W=>{if(W.daily_day)return{...W,type:"daily",dayOfWeek:W.daily_day};if(W.weekly_day)return{...W,type:"weekly",dayOfWeek:W.weekly_day};if(W.once_date){const K=new Date(W.once_date);return{...W,type:"once",onceDate:K.getTime(),originalDate:K}}return null}).filter(Boolean);if(H.length>0){const W=H.filter(re=>re.type==="once"&&re.onceDate<N),K=H.filter(re=>re.type!=="once"||re.onceDate>=N);if(K.length>0){const ae=K.sort((ce,ve)=>{const Se=ce.type==="once"?ce.onceDate-N:(ce.dayOfWeek+7-(p.getDay()+1))%7*24*60*60*1e3,Ee=ve.type==="once"?ve.onceDate-N:(ve.dayOfWeek+7-(p.getDay()+1))%7*24*60*60*1e3;return Se-Ee})[0];if(ae.type==="once"){const ce={weekday:"long",month:"short",day:"numeric"};P=`Opens on ${ae.originalDate.toLocaleDateString("en-US",ce)}`}else P=`Opens on ${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][ae.dayOfWeek%7]}`}else if(W.length>0){const re=W.sort((ce,ve)=>ve.onceDate-ce.onceDate)[0],ae={weekday:"long",month:"short",day:"numeric"};P=`Market has ended on ${re.originalDate.toLocaleDateString("en-US",ae)}`}else P="No upcoming schedule"}else P="No upcoming schedule"}return C.jsxs(fo,{to:`/market/${o.id}`,className:`\r
        relative rounded-2xl overflow-hidden\r
        hover:scale-[1.01] active:scale-[0.99]\r
        transition-all duration-300 block\r
        snap-start flex-shrink-0 shadow-md\r
      `,style:{height:`${r}px`},children:[C.jsx("img",{src:o.image,alt:o.name,className:"w-full h-full object-cover"}),C.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/85 via-black/20 to-transparent"}),C.jsx("div",{className:"absolute top-3 left-3 flex flex-col gap-1",children:C.jsx("div",{className:"bg-black/40 backdrop-blur px-2 py-1 rounded-lg flex items-center text-white text-xs gap-1 shadow",children:o.total_reviews>0?C.jsxs(C.Fragment,{children:[C.jsx(Wo,{className:"text-yellow-300 w-3.5 h-3.5"}),C.jsx("span",{className:"font-medium",children:o.average_rating.toFixed(1)})]}):C.jsx("span",{className:"text-white/70",children:"No reviews yet"})})}),C.jsxs("div",{className:"absolute top-3 right-3 text-xs bg-black/40 backdrop-blur px-2 py-1 rounded-lg flex items-center gap-1 text-white shadow",children:[C.jsx(nO,{className:"w-3.5 h-3.5 opacity-80"}),h?"...":`${c} km`]}),C.jsxs("div",{className:"absolute bottom-3 left-3 right-3 text-white flex flex-col gap-2",children:[C.jsx("h2",{className:"font-semibold text-lg drop-shadow leading-tight line-clamp-1",children:o.name}),C.jsxs("div",{className:"flex items-center gap-2 text-[11px] bg-white/20 backdrop-blur px-2 py-1 rounded-full w-fit",children:[C.jsx(PL,{className:`w-3 h-3 ${M?"text-green-400":"text-red-400"}`}),C.jsxs("span",{className:"font-medium",children:[M?"Open now":"Closed","  ",P]})]})]}),C.jsx(eM,{className:"absolute bottom-3 right-3 w-6 h-6 text-white opacity-80 group-hover:translate-x-1 transition-all"})]})},QN=({height:o=250})=>C.jsxs("div",{className:`\r
        relative rounded-2xl overflow-hidden\r
        block snap-start flex-shrink-0 shadow-md\r
        animate-pulse\r
      `,style:{height:`${o}px`},children:[C.jsx("div",{className:"w-full h-full bg-gray-300"}),C.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/85 via-black/20 to-transparent"}),C.jsx("div",{className:"absolute top-3 left-3 flex flex-col gap-1",children:C.jsx("div",{className:"bg-black/40 px-2 py-1 rounded-lg w-16 h-4"})}),C.jsx("div",{className:"absolute top-3 right-3 text-xs bg-black/40 px-2 py-1 rounded-lg w-12 h-4"}),C.jsxs("div",{className:"absolute bottom-3 left-3 right-3 flex flex-col gap-2",children:[C.jsx("div",{className:"h-5 w-3/4 bg-gray-400 rounded"})," ",C.jsx("div",{className:"h-4 w-1/2 bg-gray-400 rounded-full flex items-center"})," "]}),C.jsx("div",{className:"absolute bottom-3 right-3 w-6 h-6 bg-gray-400 rounded-full"})]}),WM=(o,r="/v1")=>{const[c,h]=ye.useState([]),[p,x]=ye.useState(!0),[S,i]=ye.useState(null);return ye.useEffect(()=>{(async()=>{if(!o?.user){h([]),x(!1);return}try{x(!0),i(null);const P=await fetch(`${r}/user/${o.user.id}/roles`);if(!P.ok)throw new Error("Failed to fetch user roles");const N=await P.json();h(N.roles||[])}catch(P){console.error("Error fetching roles:",P),i(P.message),h([])}finally{x(!1)}})()},[o,r]),{roles:c,loading:p,error:S,isVendor:c.includes("Vendor"),isOrganizer:c.includes("Organizer"),isAdmin:c.includes("Admin")}},eF=[{id:1,name:"Fresh Produce",emoji:""},{id:2,name:"Street Food",emoji:""},{id:3,name:"Snacks & Drinks",emoji:""},{id:4,name:"Clothing",emoji:""},{id:5,name:"Handicrafts",emoji:""},{id:6,name:"Fruits",emoji:""},{id:7,name:"Seafood",emoji:""},{id:8,name:"Performance",emoji:""}],tF=["Food","Fresh Produce","Handicraft","Fashion","Local Snack"],iF=()=>{const o=$r(!1),r=$a(),c=localStorage.getItem("signupRole");c&&o?.user?.id&&(localStorage.removeItem("signupRole"),r(`/${c}/registration`));const{markets:h,loading:p}=xy(),x=wy(),[S,i]=ye.useState(!1),[M,P]=ye.useState({distance:null,rating:null,openNow:!1,tags:[]}),N=()=>{GM({showProgress:!0,allowClose:!0,overlayOpacity:.5,steps:[{element:"#tour-categories",popover:{title:"Product Categories",description:"Browse food, crafts, fashion, and more from local vendors by category.",side:"bottom",align:"start"}},{element:"#tour-markets",popover:{title:"Street Markets",description:"Explore nearby street markets and tamu. Filter by distance, rating, and availability.",side:"top",align:"start"}}],onDestroyed:()=>{localStorage.setItem("home_tour_seen","true")}}).drive()};ye.useEffect(()=>{!localStorage.getItem("home_tour_seen")&&!p&&h?.length>0&&N()},[p,h]);const H=ae=>{if(!ae?.open_time||!ae?.close_time)return!1;const ce=new Date().getHours(),ve=new Date(ae.open_time).getHours(),Se=new Date(ae.close_time).getHours();return ve<=Se?ce>=ve&&ce<=Se:ce>=ve||ce<=Se},K=(h||[]).filter(ae=>!(M.openNow&&!H(ae)||M.rating&&ae.average_rating<M.rating||M.distance&&ae.distance>M.distance||M.tags.length>0&&!M.tags.some(ce=>ae.tags?.includes(ce)))),re=ae=>{P(ce=>({...ce,tags:ce.tags.includes(ae)?ce.tags.filter(ve=>ve!==ae):[...ce.tags,ae]}))};return C.jsxs("div",{className:"relative min-h-screen bg-[var(--white)]",children:[C.jsx("header",{className:"w-full bg-[var(--white)]",children:C.jsxs("div",{className:"w-full px-4 sm:px-6 py-3 flex items-center justify-between gap-3",children:[C.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[C.jsx("img",{src:"/tamulokal.png",alt:"Tamukinabalu logo",className:"h-8 w-8 sm:h-10 sm:w-10 object-contain"}),C.jsx("span",{className:"text-base sm:text-xl font-semibold text-[var(--black)]",children:"TamuKinabalu"})]}),C.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 shrink-0",children:[C.jsxs("button",{type:"button",className:`inline-flex items-center gap-1.5 px-3 py-2 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm font-semibold transition shadow-sm hover:shadow-md border bg-[var(--white)] ${x?"border-[var(--green)] text-[var(--green)]":"border-[var(--red)] text-[var(--red)]"}`,title:x?"Location enabled":"Location disabled",children:[C.jsx(xS,{className:"text-sm sm:text-base"}),C.jsx("p",{children:x?"Enabled":"Disabled"})]}),C.jsxs("button",{onClick:()=>{},className:"inline-flex items-center gap-1.5 px-3 py-2 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm font-semibold transition shadow-sm hover:shadow-md border border-[var(--gray)] bg-[color-mix(in srgb,var(--white) 70%,transparent)] text-[var(--black)]",children:[C.jsx(hM,{className:"text-base sm:text-lg"}),"EN"]})]})]})}),C.jsxs("main",{className:"max-w-6xl mx-auto w-full pt-4 pb-24",children:[C.jsxs("div",{id:"tour-categories",className:"px-4 pt-2",children:[C.jsx("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-2",children:C.jsxs("div",{children:[C.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:"Product Categories"}),C.jsx("p",{className:"text-sm text-[var(--gray)] max-w-2xl mt-1",children:"Browse by category to quickly find food, crafts, fashion, and more from local vendors."})]})}),C.jsx("div",{className:"w-full grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-3 mt-4",children:eF.map(ae=>C.jsxs(fo,{to:`/category/${ae.id}`,className:`\r
                  bg-[var(--white)] rounded-xl shadow-sm border border-[var(--gray)]\r
                  flex flex-col items-center justify-center\r
                  aspect-square\r
                  hover:border-[var(--orange)] hover:shadow-md transition\r
                `,children:[C.jsx("span",{className:"text-2xl mb-1",children:ae.emoji}),C.jsx("span",{className:"text-xs font-medium text-[var(--black)] text-center px-1",children:ae.name})]},ae.id))})]}),C.jsxs("div",{id:"tour-markets",className:"px-4 mt-8",children:[C.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:"Street Markets"}),C.jsx("p",{className:"text-sm text-[var(--gray)] max-w-2xl mt-1",children:"Filter by distance, ratings, whats open now, and tags to find the perfect market to visit."})]}),C.jsx("div",{className:"grid grid-cols-1 sm:flex sm:flex-row gap-2 w-full sm:w-auto",children:C.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center justify-center gap-2 px-3 py-2 rounded-full bg-[var(--orange)] text-white text-sm font-semibold shadow-sm hover:shadow-md transition border border-[var(--orange)]",children:[C.jsx(vS,{size:16}),"Filters"]})})]}),C.jsx("div",{className:"mt-4",children:C.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[!p&&K.length===0&&C.jsx("p",{className:"text-gray-600 text-center col-span-full",children:"No markets found with selected filters."}),p?Array.from({length:6}).map((ae,ce)=>C.jsx("div",{className:"w-full h-[350px]",children:C.jsx(QN,{height:350})},ce)):K.map(ae=>C.jsx("div",{className:"w-full h-[350px]",children:C.jsx(qM,{market:ae,height:350})},ae.id))]})})]})]}),S&&C.jsx("div",{className:"fixed inset-0 bg-black/50 z-[80] flex items-end justify-center lg:items-stretch lg:justify-start",children:C.jsxs("div",{className:"bg-white w-full max-w-xl rounded-t-2xl p-6 shadow-lg lg:h-full lg:max-w-md lg:rounded-none lg:rounded-r-2xl lg:shadow-2xl lg:overflow-y-auto",children:[C.jsxs("div",{className:"flex justify-between items-center mb-4",children:[C.jsx("button",{onClick:()=>P({distance:null,rating:null,openNow:!1,tags:[]}),className:"text-sm text-gray-500 font-medium",children:"Reset"}),C.jsx("h3",{className:"text-lg font-semibold",children:"Filter"}),C.jsx("button",{onClick:()=>i(!1),className:"text-sm text-[var(--orange)] font-medium",children:"Apply"})]}),C.jsxs("div",{className:"mb-5",children:[C.jsxs("p",{className:"font-medium mb-2",children:["Distance ",M.distance?`( ${M.distance} km )`:"Any"]}),C.jsx("input",{type:"range",min:5,max:20,step:5,value:M.distance||20,onChange:ae=>P({...M,distance:Number(ae.target.value)}),className:"w-full accent-orange-500"})]}),C.jsxs("div",{className:"mb-5",children:[C.jsxs("p",{className:"font-medium mb-2 flex items-center gap-1",children:["Rating",M.rating?C.jsxs("span",{className:"flex items-center gap-0.5",children:["( ",M.rating," ",C.jsx(Wo,{className:"text-yellow-400"})," )"]}):" Any"]}),C.jsx("input",{type:"range",min:1,max:5,step:1,value:M.rating||1,onChange:ae=>P({...M,rating:Number(ae.target.value)}),className:"w-full accent-orange-500"})]}),C.jsxs("div",{className:"mb-5 flex items-center justify-between",children:[C.jsx("p",{className:"font-medium mb-0",children:"Open Only"}),C.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[C.jsx("input",{type:"checkbox",checked:M.openNow,onChange:()=>P({...M,openNow:!M.openNow}),className:"sr-only peer"}),C.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-orange-300 rounded-full peer peer-checked:bg-orange-500 transition-colors"}),C.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-md peer-checked:translate-x-5 transition-transform"})]})]}),C.jsxs("div",{className:"mb-2",children:[C.jsx("p",{className:"font-medium mb-2",children:"Tags"}),C.jsx("div",{className:"flex flex-wrap gap-2",children:tF.map(ae=>C.jsx("button",{onClick:()=>re(ae),className:`px-3 py-1 rounded-full text-xs border ${M.tags.includes(ae)?"bg-orange-500 text-white border-orange-500":"bg-white text-gray-700 border-gray-300"}`,children:ae},ae))})]})]})})]})},nF=()=>{const[o,r]=ye.useState(""),[c,h]=ye.useState(o),[p,x]=ye.useState([]),[S,i]=ye.useState(!1),[M,P]=ye.useState({sortBy:"Relevance",selectedEntities:["All"]}),N=ye.useRef(null),H=ye.useRef(null),W="/v1",K=$a(),re=()=>{GM({showProgress:!0,allowClose:!0,overlayOpacity:.5,steps:[{element:"#search-input",popover:{title:"Search Input",description:"Type here to search for markets, vendors, or visitors.",side:"bottom",align:"start"}},{element:"#filter-button",popover:{title:"Filters",description:"Click here to filter your search results.",side:"top",align:"start"}}],onDestroyed:()=>{localStorage.setItem("search_tour_seen","true")}}).drive()};ye.useEffect(()=>{localStorage.getItem("search_tour_seen")||re()},[]),ye.useEffect(()=>{const ve=setTimeout(()=>N.current?.focus(),50);return()=>clearTimeout(ve)},[]),ye.useEffect(()=>{const ve=setTimeout(()=>h(o),500);return()=>clearTimeout(ve)},[o]),ye.useEffect(()=>{if(!c){x([]),i(!1);return}(async()=>{try{const Ee=await(await fetch(`${W}/user?search=${c}`)).json();x(Ee||[]),i(!0)}catch(Se){console.error(Se)}})()},[c,W]),ye.useEffect(()=>{const ve=Se=>{H.current&&!H.current.contains(Se.target)&&i(!1)};return document.addEventListener("mousedown",ve),()=>document.removeEventListener("mousedown",ve)},[]);const ae=ve=>{if(r(ve.name),i(!1),!(!ve?.id||!ve?.type))switch(ve.type){case"market":K(`/market/${ve.id}`);break;case"vendor":K(`/vendor/${ve.id}`);break;case"visitor":K(`/visitor/${ve.id}`);break;case"organizer":K(`/organizer/${ve.id}`);break;default:console.warn("Unknown type:",ve.type)}},ce=p.filter(ve=>M.selectedEntities.includes("All")?!0:M.selectedEntities.map(Se=>Se.toLowerCase()).includes(ve.type));return C.jsx("div",{className:"px-4 py-4 relative",ref:H,children:C.jsxs("div",{className:"flex gap-2 items-start relative",children:[C.jsxs("div",{className:"flex-1 relative",children:[C.jsxs("div",{id:"search-input",className:"flex items-center bg-[var(--white)] border border-[var(--black)] rounded-xl shadow-md px-4 py-4 gap-2",children:[C.jsx(py,{className:"text-[var(--gray)]"}),C.jsx("input",{ref:N,value:o,onChange:ve=>r(ve.target.value),placeholder:"Search by market or visitor",className:"flex-1 bg-transparent outline-none text-[var(--gray)]"})]}),S&&C.jsx("div",{className:"fixed z-10 mt-4 left-0 right-0 max-h-64 overflow-y-auto px-4",children:ce.length>0?ce.map((ve,Se)=>C.jsxs("div",{onClick:()=>ae(ve),className:"py-2 cursor-pointer flex items-center gap-2",children:[C.jsx("img",{src:ve.image===""?"/profile.png":ve.image,alt:ve.name,className:"w-8 h-8 rounded-full object-cover"}),C.jsx("span",{className:"text-[var(--black)]",children:ve.name})]},ve.id)):C.jsx("div",{className:"py-2 text-[var(--gray)]",children:"No results found."})})]}),C.jsx(aF,{filters:M,setFilters:P})]})})},aF=({filters:o,setFilters:r})=>{const[c,h]=ye.useState(!1),p=["Relevance","Newest","Oldest","Popular"],x=["Visitor","Vendor","Organizer","Market"],[S,i]=ye.useState(o.sortBy),[M,P]=ye.useState(o.selectedEntities);ye.useEffect(()=>{r({sortBy:S,selectedEntities:M})},[S,M,r]);const N=H=>{if(H==="All")return P(["All"]);let W=M.includes("All")?[]:[...M];W=W.includes(H)?W.filter(K=>K!==H):[...W,H],W.length===0&&(W=["All"]),P(W)};return C.jsxs(C.Fragment,{children:[C.jsx("button",{id:"filter-button",onClick:()=>h(!c),className:"w-14 h-14 bg-[var(--orange)] rounded-xl shadow-md flex items-center justify-center",children:C.jsx(zL,{className:"text-[var(--white)]"})}),c&&C.jsx("div",{className:"fixed inset-0 bg-[var(--black)]/40 z-40",onClick:()=>h(!1)}),C.jsxs("div",{className:`
          fixed bg-[var(--white)] rounded-t-2xl p-6 shadow-xl transition-all duration-300 z-70
          w-full lg:w-96
          ${c?"bottom-0 left-0 rounded-t-2xl lg:rounded-r-2xl lg:rounded-t-none":"-bottom-[60%] lg:-left-96"}
          lg:top-0
          lg:h-full
          lg:rounded-t-none
        `,children:[C.jsxs("div",{className:"flex justify-between items-center mb-4",children:[C.jsx("button",{onClick:()=>{i("Relevance"),P(["All"])},className:"text-sm text-[var(--gray)]",children:"Reset"}),C.jsx("h3",{className:"text-lg font-semibold",children:"Filter"}),C.jsx("button",{onClick:()=>h(!1),className:"text-sm text-[var(--orange)]",children:"Apply"})]}),C.jsx("p",{className:"font-medium mb-2",children:"Sort By"}),C.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:p.map(H=>C.jsx("button",{onClick:()=>i(H),className:`px-3 py-1 rounded-full border border-[var(--black)] ${S===H?"bg-[var(--orange)] text-[var(--white)]":""}`,children:H},H))}),C.jsx("p",{className:"font-medium mb-2",children:"Search Target"}),C.jsxs("div",{className:"flex flex-wrap gap-2",children:[C.jsx("button",{onClick:()=>N("All"),className:`px-3 py-1 rounded-full border ${M.includes("All")?"bg-[var(--orange)] text-[var(--white)]":""}`,children:"All"}),x.map(H=>C.jsx("button",{onClick:()=>N(H),className:`px-3 py-1 rounded-full border ${M.includes(H)?"bg-[var(--orange)] text-[var(--white)]":""}`,children:H},H))]})]})]})},rF=({schedules:o=[],isOpen:r,onToggle:c})=>{const h=new Date,p=h.getDay()===0?7:h.getDay(),x=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],S=H=>{if(!H)return"";const[W,K]=H.split(":").map(Number),re=new Date;return re.setHours(W,K,0,0),re.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})},i=H=>{if(!H)return!1;const W=h.getHours()*60+h.getMinutes(),K=H.open_time.split(":").map(Number),re=H.close_time.split(":").map(Number);let ae=K[0]*60+K[1],ce=re[0]*60+re[1];return ce<=ae&&(ce+=1440),W>=ae&&W<ce},M=o.find(H=>H.weekly_day===p),P=M?i(M)?`Open until ${S(M.close_time)}`:"Closed":"Closed today",N=M&&i(M)?"var(--green)":"var(--red)";return C.jsxs("div",{className:"w-full overflow-hidden font-inter mt-2 border-b border-gray-200",children:[C.jsxs("button",{onClick:c,className:"w-full flex justify-between items-center px-4 py-3 text-sm font-medium transition-colors",style:{color:N},children:[C.jsxs("span",{className:"flex items-center gap-2",children:[C.jsx(rM,{className:"w-4 h-4",style:{color:N}}),P]}),r?C.jsx(aM,{className:"w-4 h-4 text-[var(--gray)]"}):C.jsx(nM,{className:"w-4 h-4 text-[var(--gray)]"})]}),r&&C.jsxs("div",{className:"px-4 py-2 text-sm text-[var(--black)] space-y-1",children:[x.map((H,W)=>{const K=W+1,re=o.find(Se=>Se.weekly_day===K),ae=K===p;let ce="var(--black)";ae&&(ce=re?"var(--green)":"var(--red)");const ve=re?`${S(re.open_time)} - ${S(re.close_time)}`:"Closed";return C.jsxs("p",{className:`flex justify-between ${ae?"font-semibold":""}`,style:{color:ce},children:[C.jsx("span",{className:"capitalize",children:H}),C.jsx("span",{children:ve})]},H)}),o.filter(H=>H.once_date).map(H=>C.jsxs("p",{className:"flex justify-between font-medium text-[var(--blue)]",children:[C.jsxs("span",{children:["Special: ",new Date(H.once_date).toLocaleDateString()]}),C.jsxs("span",{children:[S(H.open_time)," - ",S(H.close_time)]})]},H.id))]})]})};var $v={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var sF=$v.exports,FE;function oF(){return FE||(FE=1,(function(o,r){(function(c,h){h(r)})(sF,(function(c){var h="1.9.4";function p(b){var I,$,te,me;for($=1,te=arguments.length;$<te;$++){me=arguments[$];for(I in me)b[I]=me[I]}return b}var x=Object.create||(function(){function b(){}return function(I){return b.prototype=I,new b}})();function S(b,I){var $=Array.prototype.slice;if(b.bind)return b.bind.apply(b,$.call(arguments,1));var te=$.call(arguments,2);return function(){return b.apply(I,te.length?te.concat($.call(arguments)):arguments)}}var i=0;function M(b){return"_leaflet_id"in b||(b._leaflet_id=++i),b._leaflet_id}function P(b,I,$){var te,me,Le,ut;return ut=function(){te=!1,me&&(Le.apply($,me),me=!1)},Le=function(){te?me=arguments:(b.apply($,arguments),setTimeout(ut,I),te=!0)},Le}function N(b,I,$){var te=I[1],me=I[0],Le=te-me;return b===te&&$?b:((b-me)%Le+Le)%Le+me}function H(){return!1}function W(b,I){if(I===!1)return b;var $=Math.pow(10,I===void 0?6:I);return Math.round(b*$)/$}function K(b){return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")}function re(b){return K(b).split(/\s+/)}function ae(b,I){Object.prototype.hasOwnProperty.call(b,"options")||(b.options=b.options?x(b.options):{});for(var $ in I)b.options[$]=I[$];return b.options}function ce(b,I,$){var te=[];for(var me in b)te.push(encodeURIComponent($?me.toUpperCase():me)+"="+encodeURIComponent(b[me]));return(!I||I.indexOf("?")===-1?"?":"&")+te.join("&")}var ve=/\{ *([\w_ -]+) *\}/g;function Se(b,I){return b.replace(ve,function($,te){var me=I[te];if(me===void 0)throw new Error("No value provided for variable "+$);return typeof me=="function"&&(me=me(I)),me})}var Ee=Array.isArray||function(b){return Object.prototype.toString.call(b)==="[object Array]"};function Qe(b,I){for(var $=0;$<b.length;$++)if(b[$]===I)return $;return-1}var He="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function ke(b){return window["webkit"+b]||window["moz"+b]||window["ms"+b]}var tt=0;function Ke(b){var I=+new Date,$=Math.max(0,16-(I-tt));return tt=I+$,window.setTimeout(b,$)}var lt=window.requestAnimationFrame||ke("RequestAnimationFrame")||Ke,ft=window.cancelAnimationFrame||ke("CancelAnimationFrame")||ke("CancelRequestAnimationFrame")||function(b){window.clearTimeout(b)};function gt(b,I,$){if($&&lt===Ke)b.call(I);else return lt.call(window,S(b,I))}function ni(b){b&&ft.call(window,b)}var Ft={__proto__:null,extend:p,create:x,bind:S,get lastId(){return i},stamp:M,throttle:P,wrapNum:N,falseFn:H,formatNum:W,trim:K,splitWords:re,setOptions:ae,getParamString:ce,template:Se,isArray:Ee,indexOf:Qe,emptyImageUrl:He,requestFn:lt,cancelFn:ft,requestAnimFrame:gt,cancelAnimFrame:ni};function Vi(){}Vi.extend=function(b){var I=function(){ae(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},$=I.__super__=this.prototype,te=x($);te.constructor=I,I.prototype=te;for(var me in this)Object.prototype.hasOwnProperty.call(this,me)&&me!=="prototype"&&me!=="__super__"&&(I[me]=this[me]);return b.statics&&p(I,b.statics),b.includes&&(Ri(b.includes),p.apply(null,[te].concat(b.includes))),p(te,b),delete te.statics,delete te.includes,te.options&&(te.options=$.options?x($.options):{},p(te.options,b.options)),te._initHooks=[],te.callInitHooks=function(){if(!this._initHooksCalled){$.callInitHooks&&$.callInitHooks.call(this),this._initHooksCalled=!0;for(var Le=0,ut=te._initHooks.length;Le<ut;Le++)te._initHooks[Le].call(this)}},I},Vi.include=function(b){var I=this.prototype.options;return p(this.prototype,b),b.options&&(this.prototype.options=I,this.mergeOptions(b.options)),this},Vi.mergeOptions=function(b){return p(this.prototype.options,b),this},Vi.addInitHook=function(b){var I=Array.prototype.slice.call(arguments,1),$=typeof b=="function"?b:function(){this[b].apply(this,I)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push($),this};function Ri(b){if(!(typeof L>"u"||!L||!L.Mixin)){b=Ee(b)?b:[b];for(var I=0;I<b.length;I++)b[I]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var We={on:function(b,I,$){if(typeof b=="object")for(var te in b)this._on(te,b[te],I);else{b=re(b);for(var me=0,Le=b.length;me<Le;me++)this._on(b[me],I,$)}return this},off:function(b,I,$){if(!arguments.length)delete this._events;else if(typeof b=="object")for(var te in b)this._off(te,b[te],I);else{b=re(b);for(var me=arguments.length===1,Le=0,ut=b.length;Le<ut;Le++)me?this._off(b[Le]):this._off(b[Le],I,$)}return this},_on:function(b,I,$,te){if(typeof I!="function"){console.warn("wrong listener type: "+typeof I);return}if(this._listens(b,I,$)===!1){$===this&&($=void 0);var me={fn:I,ctx:$};te&&(me.once=!0),this._events=this._events||{},this._events[b]=this._events[b]||[],this._events[b].push(me)}},_off:function(b,I,$){var te,me,Le;if(this._events&&(te=this._events[b],!!te)){if(arguments.length===1){if(this._firingCount)for(me=0,Le=te.length;me<Le;me++)te[me].fn=H;delete this._events[b];return}if(typeof I!="function"){console.warn("wrong listener type: "+typeof I);return}var ut=this._listens(b,I,$);if(ut!==!1){var Bt=te[ut];this._firingCount&&(Bt.fn=H,this._events[b]=te=te.slice()),te.splice(ut,1)}}},fire:function(b,I,$){if(!this.listens(b,$))return this;var te=p({},I,{type:b,target:this,sourceTarget:I&&I.sourceTarget||this});if(this._events){var me=this._events[b];if(me){this._firingCount=this._firingCount+1||1;for(var Le=0,ut=me.length;Le<ut;Le++){var Bt=me[Le],It=Bt.fn;Bt.once&&this.off(b,It,Bt.ctx),It.call(Bt.ctx||this,te)}this._firingCount--}}return $&&this._propagateEvent(te),this},listens:function(b,I,$,te){typeof b!="string"&&console.warn('"string" type argument expected');var me=I;typeof I!="function"&&(te=!!I,me=void 0,$=void 0);var Le=this._events&&this._events[b];if(Le&&Le.length&&this._listens(b,me,$)!==!1)return!0;if(te){for(var ut in this._eventParents)if(this._eventParents[ut].listens(b,I,$,te))return!0}return!1},_listens:function(b,I,$){if(!this._events)return!1;var te=this._events[b]||[];if(!I)return!!te.length;$===this&&($=void 0);for(var me=0,Le=te.length;me<Le;me++)if(te[me].fn===I&&te[me].ctx===$)return me;return!1},once:function(b,I,$){if(typeof b=="object")for(var te in b)this._on(te,b[te],I,!0);else{b=re(b);for(var me=0,Le=b.length;me<Le;me++)this._on(b[me],I,$,!0)}return this},addEventParent:function(b){return this._eventParents=this._eventParents||{},this._eventParents[M(b)]=b,this},removeEventParent:function(b){return this._eventParents&&delete this._eventParents[M(b)],this},_propagateEvent:function(b){for(var I in this._eventParents)this._eventParents[I].fire(b.type,p({layer:b.target,propagatedFrom:b.target},b),!0)}};We.addEventListener=We.on,We.removeEventListener=We.clearAllEventListeners=We.off,We.addOneTimeEventListener=We.once,We.fireEvent=We.fire,We.hasEventListeners=We.listens;var Et=Vi.extend(We);function jt(b,I,$){this.x=$?Math.round(b):b,this.y=$?Math.round(I):I}var Gi=Math.trunc||function(b){return b>0?Math.floor(b):Math.ceil(b)};jt.prototype={clone:function(){return new jt(this.x,this.y)},add:function(b){return this.clone()._add(Ce(b))},_add:function(b){return this.x+=b.x,this.y+=b.y,this},subtract:function(b){return this.clone()._subtract(Ce(b))},_subtract:function(b){return this.x-=b.x,this.y-=b.y,this},divideBy:function(b){return this.clone()._divideBy(b)},_divideBy:function(b){return this.x/=b,this.y/=b,this},multiplyBy:function(b){return this.clone()._multiplyBy(b)},_multiplyBy:function(b){return this.x*=b,this.y*=b,this},scaleBy:function(b){return new jt(this.x*b.x,this.y*b.y)},unscaleBy:function(b){return new jt(this.x/b.x,this.y/b.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Gi(this.x),this.y=Gi(this.y),this},distanceTo:function(b){b=Ce(b);var I=b.x-this.x,$=b.y-this.y;return Math.sqrt(I*I+$*$)},equals:function(b){return b=Ce(b),b.x===this.x&&b.y===this.y},contains:function(b){return b=Ce(b),Math.abs(b.x)<=Math.abs(this.x)&&Math.abs(b.y)<=Math.abs(this.y)},toString:function(){return"Point("+W(this.x)+", "+W(this.y)+")"}};function Ce(b,I,$){return b instanceof jt?b:Ee(b)?new jt(b[0],b[1]):b==null?b:typeof b=="object"&&"x"in b&&"y"in b?new jt(b.x,b.y):new jt(b,I,$)}function _t(b,I){if(b)for(var $=I?[b,I]:b,te=0,me=$.length;te<me;te++)this.extend($[te])}_t.prototype={extend:function(b){var I,$;if(!b)return this;if(b instanceof jt||typeof b[0]=="number"||"x"in b)I=$=Ce(b);else if(b=At(b),I=b.min,$=b.max,!I||!$)return this;return!this.min&&!this.max?(this.min=I.clone(),this.max=$.clone()):(this.min.x=Math.min(I.x,this.min.x),this.max.x=Math.max($.x,this.max.x),this.min.y=Math.min(I.y,this.min.y),this.max.y=Math.max($.y,this.max.y)),this},getCenter:function(b){return Ce((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,b)},getBottomLeft:function(){return Ce(this.min.x,this.max.y)},getTopRight:function(){return Ce(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(b){var I,$;return typeof b[0]=="number"||b instanceof jt?b=Ce(b):b=At(b),b instanceof _t?(I=b.min,$=b.max):I=$=b,I.x>=this.min.x&&$.x<=this.max.x&&I.y>=this.min.y&&$.y<=this.max.y},intersects:function(b){b=At(b);var I=this.min,$=this.max,te=b.min,me=b.max,Le=me.x>=I.x&&te.x<=$.x,ut=me.y>=I.y&&te.y<=$.y;return Le&&ut},overlaps:function(b){b=At(b);var I=this.min,$=this.max,te=b.min,me=b.max,Le=me.x>I.x&&te.x<$.x,ut=me.y>I.y&&te.y<$.y;return Le&&ut},isValid:function(){return!!(this.min&&this.max)},pad:function(b){var I=this.min,$=this.max,te=Math.abs(I.x-$.x)*b,me=Math.abs(I.y-$.y)*b;return At(Ce(I.x-te,I.y-me),Ce($.x+te,$.y+me))},equals:function(b){return b?(b=At(b),this.min.equals(b.getTopLeft())&&this.max.equals(b.getBottomRight())):!1}};function At(b,I){return!b||b instanceof _t?b:new _t(b,I)}function Ct(b,I){if(b)for(var $=I?[b,I]:b,te=0,me=$.length;te<me;te++)this.extend($[te])}Ct.prototype={extend:function(b){var I=this._southWest,$=this._northEast,te,me;if(b instanceof Ci)te=b,me=b;else if(b instanceof Ct){if(te=b._southWest,me=b._northEast,!te||!me)return this}else return b?this.extend(li(b)||oi(b)):this;return!I&&!$?(this._southWest=new Ci(te.lat,te.lng),this._northEast=new Ci(me.lat,me.lng)):(I.lat=Math.min(te.lat,I.lat),I.lng=Math.min(te.lng,I.lng),$.lat=Math.max(me.lat,$.lat),$.lng=Math.max(me.lng,$.lng)),this},pad:function(b){var I=this._southWest,$=this._northEast,te=Math.abs(I.lat-$.lat)*b,me=Math.abs(I.lng-$.lng)*b;return new Ct(new Ci(I.lat-te,I.lng-me),new Ci($.lat+te,$.lng+me))},getCenter:function(){return new Ci((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ci(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ci(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(b){typeof b[0]=="number"||b instanceof Ci||"lat"in b?b=li(b):b=oi(b);var I=this._southWest,$=this._northEast,te,me;return b instanceof Ct?(te=b.getSouthWest(),me=b.getNorthEast()):te=me=b,te.lat>=I.lat&&me.lat<=$.lat&&te.lng>=I.lng&&me.lng<=$.lng},intersects:function(b){b=oi(b);var I=this._southWest,$=this._northEast,te=b.getSouthWest(),me=b.getNorthEast(),Le=me.lat>=I.lat&&te.lat<=$.lat,ut=me.lng>=I.lng&&te.lng<=$.lng;return Le&&ut},overlaps:function(b){b=oi(b);var I=this._southWest,$=this._northEast,te=b.getSouthWest(),me=b.getNorthEast(),Le=me.lat>I.lat&&te.lat<$.lat,ut=me.lng>I.lng&&te.lng<$.lng;return Le&&ut},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(b,I){return b?(b=oi(b),this._southWest.equals(b.getSouthWest(),I)&&this._northEast.equals(b.getNorthEast(),I)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function oi(b,I){return b instanceof Ct?b:new Ct(b,I)}function Ci(b,I,$){if(isNaN(b)||isNaN(I))throw new Error("Invalid LatLng object: ("+b+", "+I+")");this.lat=+b,this.lng=+I,$!==void 0&&(this.alt=+$)}Ci.prototype={equals:function(b,I){if(!b)return!1;b=li(b);var $=Math.max(Math.abs(this.lat-b.lat),Math.abs(this.lng-b.lng));return $<=(I===void 0?1e-9:I)},toString:function(b){return"LatLng("+W(this.lat,b)+", "+W(this.lng,b)+")"},distanceTo:function(b){return Un.distance(this,li(b))},wrap:function(){return Un.wrapLatLng(this)},toBounds:function(b){var I=180*b/40075017,$=I/Math.cos(Math.PI/180*this.lat);return oi([this.lat-I,this.lng-$],[this.lat+I,this.lng+$])},clone:function(){return new Ci(this.lat,this.lng,this.alt)}};function li(b,I,$){return b instanceof Ci?b:Ee(b)&&typeof b[0]!="object"?b.length===3?new Ci(b[0],b[1],b[2]):b.length===2?new Ci(b[0],b[1]):null:b==null?b:typeof b=="object"&&"lat"in b?new Ci(b.lat,"lng"in b?b.lng:b.lon,b.alt):I===void 0?null:new Ci(b,I,$)}var Ba={latLngToPoint:function(b,I){var $=this.projection.project(b),te=this.scale(I);return this.transformation._transform($,te)},pointToLatLng:function(b,I){var $=this.scale(I),te=this.transformation.untransform(b,$);return this.projection.unproject(te)},project:function(b){return this.projection.project(b)},unproject:function(b){return this.projection.unproject(b)},scale:function(b){return 256*Math.pow(2,b)},zoom:function(b){return Math.log(b/256)/Math.LN2},getProjectedBounds:function(b){if(this.infinite)return null;var I=this.projection.bounds,$=this.scale(b),te=this.transformation.transform(I.min,$),me=this.transformation.transform(I.max,$);return new _t(te,me)},infinite:!1,wrapLatLng:function(b){var I=this.wrapLng?N(b.lng,this.wrapLng,!0):b.lng,$=this.wrapLat?N(b.lat,this.wrapLat,!0):b.lat,te=b.alt;return new Ci($,I,te)},wrapLatLngBounds:function(b){var I=b.getCenter(),$=this.wrapLatLng(I),te=I.lat-$.lat,me=I.lng-$.lng;if(te===0&&me===0)return b;var Le=b.getSouthWest(),ut=b.getNorthEast(),Bt=new Ci(Le.lat-te,Le.lng-me),It=new Ci(ut.lat-te,ut.lng-me);return new Ct(Bt,It)}},Un=p({},Ba,{wrapLng:[-180,180],R:6371e3,distance:function(b,I){var $=Math.PI/180,te=b.lat*$,me=I.lat*$,Le=Math.sin((I.lat-b.lat)*$/2),ut=Math.sin((I.lng-b.lng)*$/2),Bt=Le*Le+Math.cos(te)*Math.cos(me)*ut*ut,It=2*Math.atan2(Math.sqrt(Bt),Math.sqrt(1-Bt));return this.R*It}}),qn=6378137,On={R:qn,MAX_LATITUDE:85.0511287798,project:function(b){var I=Math.PI/180,$=this.MAX_LATITUDE,te=Math.max(Math.min($,b.lat),-$),me=Math.sin(te*I);return new jt(this.R*b.lng*I,this.R*Math.log((1+me)/(1-me))/2)},unproject:function(b){var I=180/Math.PI;return new Ci((2*Math.atan(Math.exp(b.y/this.R))-Math.PI/2)*I,b.x*I/this.R)},bounds:(function(){var b=qn*Math.PI;return new _t([-b,-b],[b,b])})()};function Ja(b,I,$,te){if(Ee(b)){this._a=b[0],this._b=b[1],this._c=b[2],this._d=b[3];return}this._a=b,this._b=I,this._c=$,this._d=te}Ja.prototype={transform:function(b,I){return this._transform(b.clone(),I)},_transform:function(b,I){return I=I||1,b.x=I*(this._a*b.x+this._b),b.y=I*(this._c*b.y+this._d),b},untransform:function(b,I){return I=I||1,new jt((b.x/I-this._b)/this._a,(b.y/I-this._d)/this._c)}};function Qi(b,I,$,te){return new Ja(b,I,$,te)}var Fi=p({},Un,{code:"EPSG:3857",projection:On,transformation:(function(){var b=.5/(Math.PI*On.R);return Qi(b,.5,-b,.5)})()}),nn=p({},Fi,{code:"EPSG:900913"});function hn(b){return document.createElementNS("http://www.w3.org/2000/svg",b)}function ln(b,I){var $="",te,me,Le,ut,Bt,It;for(te=0,Le=b.length;te<Le;te++){for(Bt=b[te],me=0,ut=Bt.length;me<ut;me++)It=Bt[me],$+=(me?"L":"M")+It.x+" "+It.y;$+=I?Si.svg?"z":"x":""}return $||"M0 0"}var xn=document.documentElement.style,za="ActiveXObject"in window,$c=za&&!document.addEventListener,Zo="msLaunchUri"in navigator&&!("documentMode"in document),$s=qi("webkit"),ws=qi("android"),Vs=qi("android 2")||qi("android 3"),Vr=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Xo=ws&&qi("Google")&&Vr<537&&!("AudioNode"in window),Kr=!!window.opera,Qa=!Zo&&qi("chrome"),us=qi("gecko")&&!$s&&!Kr&&!za,mr=!Qa&&qi("safari"),ul=qi("phantom"),Jl="OTransition"in xn,Hs=navigator.platform.indexOf("Win")===0,Yo=za&&"transition"in xn,yr="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Vs,zr="MozPerspective"in xn,Ql=!window.L_DISABLE_3D&&(Yo||yr||zr)&&!Jl&&!ul,Ss=typeof orientation<"u"||qi("mobile"),mo=Ss&&$s,Ko=Ss&&yr,Gs=!window.PointerEvent&&window.MSPointerEvent,ec=!!(window.PointerEvent||Gs),po="ontouchstart"in window||!!window.TouchEvent,qa=!window.L_NO_TOUCH&&(po||ec),Fr=Ss&&Kr,tc=Ss&&us,jo=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,go=(function(){var b=!1;try{var I=Object.defineProperty({},"passive",{get:function(){b=!0}});window.addEventListener("testPassiveEventSupport",H,I),window.removeEventListener("testPassiveEventSupport",H,I)}catch{}return b})(),wu=(function(){return!!document.createElement("canvas").getContext})(),Pe=!!(document.createElementNS&&hn("svg").createSVGRect),zt=!!Pe&&(function(){var b=document.createElement("div");return b.innerHTML="<svg/>",(b.firstChild&&b.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Qt=!Pe&&(function(){try{var b=document.createElement("div");b.innerHTML='<v:shape adj="1"/>';var I=b.firstChild;return I.style.behavior="url(#default#VML)",I&&typeof I.adj=="object"}catch{return!1}})(),Ei=navigator.platform.indexOf("Mac")===0,ui=navigator.platform.indexOf("Linux")===0;function qi(b){return navigator.userAgent.toLowerCase().indexOf(b)>=0}var Si={ie:za,ielt9:$c,edge:Zo,webkit:$s,android:ws,android23:Vs,androidStock:Xo,opera:Kr,chrome:Qa,gecko:us,safari:mr,phantom:ul,opera12:Jl,win:Hs,ie3d:Yo,webkit3d:yr,gecko3d:zr,any3d:Ql,mobile:Ss,mobileWebkit:mo,mobileWebkit3d:Ko,msPointer:Gs,pointer:ec,touch:qa,touchNative:po,mobileOpera:Fr,mobileGecko:tc,retina:jo,passiveEvents:go,canvas:wu,svg:Pe,vml:Qt,inlineSvg:zt,mac:Ei,linux:ui},pn=Si.msPointer?"MSPointerDown":"pointerdown",kn=Si.msPointer?"MSPointerMove":"pointermove",Ze=Si.msPointer?"MSPointerUp":"pointerup",ie=Si.msPointer?"MSPointerCancel":"pointercancel",ue={touchstart:pn,touchmove:kn,touchend:Ze,touchcancel:ie},Te={touchstart:Oi,touchmove:ci,touchend:ci,touchcancel:ci},Fe={},Be=!1;function qe(b,I,$){return I==="touchstart"&&St(),Te[I]?($=Te[I].bind(this,$),b.addEventListener(ue[I],$,!1),$):(console.warn("wrong event specified:",I),H)}function rt(b,I,$){if(!ue[I]){console.warn("wrong event specified:",I);return}b.removeEventListener(ue[I],$,!1)}function Je(b){Fe[b.pointerId]=b}function ot(b){Fe[b.pointerId]&&(Fe[b.pointerId]=b)}function Rt(b){delete Fe[b.pointerId]}function St(){Be||(document.addEventListener(pn,Je,!0),document.addEventListener(kn,ot,!0),document.addEventListener(Ze,Rt,!0),document.addEventListener(ie,Rt,!0),Be=!0)}function ci(b,I){if(I.pointerType!==(I.MSPOINTER_TYPE_MOUSE||"mouse")){I.touches=[];for(var $ in Fe)I.touches.push(Fe[$]);I.changedTouches=[I],b(I)}}function Oi(b,I){I.MSPOINTER_TYPE_TOUCH&&I.pointerType===I.MSPOINTER_TYPE_TOUCH&&os(I),ci(b,I)}function mi(b){var I={},$,te;for(te in b)$=b[te],I[te]=$&&$.bind?$.bind(b):$;return b=I,I.type="dblclick",I.detail=2,I.isTrusted=!1,I._simulated=!0,I}var tn=200;function rn(b,I){b.addEventListener("dblclick",I);var $=0,te;function me(Le){if(Le.detail!==1){te=Le.detail;return}if(!(Le.pointerType==="mouse"||Le.sourceCapabilities&&!Le.sourceCapabilities.firesTouchEvents)){var ut=Vn(Le);if(!(ut.some(function(It){return It instanceof HTMLLabelElement&&It.attributes.for})&&!ut.some(function(It){return It instanceof HTMLInputElement||It instanceof HTMLSelectElement}))){var Bt=Date.now();Bt-$<=tn?(te++,te===2&&I(mi(Le))):te=1,$=Bt}}}return b.addEventListener("click",me),{dblclick:I,simDblclick:me}}function Zi(b,I){b.removeEventListener("dblclick",I.dblclick),b.removeEventListener("click",I.simDblclick)}var Ui=Jr(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),$n=Jr(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ia=$n==="webkitTransition"||$n==="OTransition"?$n+"End":"transitionend";function Ta(b){return typeof b=="string"?document.getElementById(b):b}function Yn(b,I){var $=b.style[I]||b.currentStyle&&b.currentStyle[I];if((!$||$==="auto")&&document.defaultView){var te=document.defaultView.getComputedStyle(b,null);$=te?te[I]:null}return $==="auto"?null:$}function fn(b,I,$){var te=document.createElement(b);return te.className=I||"",$&&$.appendChild(te),te}function an(b){var I=b.parentNode;I&&I.removeChild(b)}function ea(b){for(;b.firstChild;)b.removeChild(b.firstChild)}function ra(b){var I=b.parentNode;I&&I.lastChild!==b&&I.appendChild(b)}function Sn(b){var I=b.parentNode;I&&I.firstChild!==b&&I.insertBefore(b,I.firstChild)}function Wa(b,I){if(b.classList!==void 0)return b.classList.contains(I);var $=rs(b);return $.length>0&&new RegExp("(^|\\s)"+I+"(\\s|$)").test($)}function zn(b,I){if(b.classList!==void 0)for(var $=re(I),te=0,me=$.length;te<me;te++)b.classList.add($[te]);else if(!Wa(b,I)){var Le=rs(b);qs(b,(Le?Le+" ":"")+I)}}function ka(b,I){b.classList!==void 0?b.classList.remove(I):qs(b,K((" "+rs(b)+" ").replace(" "+I+" "," ")))}function qs(b,I){b.className.baseVal===void 0?b.className=I:b.className.baseVal=I}function rs(b){return b.correspondingElement&&(b=b.correspondingElement),b.className.baseVal===void 0?b.className:b.className.baseVal}function er(b,I){"opacity"in b.style?b.style.opacity=I:"filter"in b.style&&zo(b,I)}function zo(b,I){var $=!1,te="DXImageTransform.Microsoft.Alpha";try{$=b.filters.item(te)}catch{if(I===1)return}I=Math.round(I*100),$?($.Enabled=I!==100,$.Opacity=I):b.style.filter+=" progid:"+te+"(opacity="+I+")"}function Jr(b){for(var I=document.documentElement.style,$=0;$<b.length;$++)if(b[$]in I)return b[$];return!1}function ss(b,I,$){var te=I||new jt(0,0);b.style[Ui]=(Si.ie3d?"translate("+te.x+"px,"+te.y+"px)":"translate3d("+te.x+"px,"+te.y+"px,0)")+($?" scale("+$+")":"")}function xa(b,I){b._leaflet_pos=I,Si.any3d?ss(b,I):(b.style.left=I.x+"px",b.style.top=I.y+"px")}function Io(b){return b._leaflet_pos||new jt(0,0)}var _o,Vc,Su;if("onselectstart"in document)_o=function(){sa(window,"selectstart",os)},Vc=function(){ar(window,"selectstart",os)};else{var hc=Jr(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);_o=function(){if(hc){var b=document.documentElement.style;Su=b[hc],b[hc]="none"}},Vc=function(){hc&&(document.documentElement.style[hc]=Su,Su=void 0)}}function fc(){sa(window,"dragstart",os)}function dl(){ar(window,"dragstart",os)}var Ps,io;function yo(b){for(;b.tabIndex===-1;)b=b.parentNode;b.style&&(Ws(),Ps=b,io=b.style.outlineStyle,b.style.outlineStyle="none",sa(window,"keydown",Ws))}function Ws(){Ps&&(Ps.style.outlineStyle=io,Ps=void 0,io=void 0,ar(window,"keydown",Ws))}function no(b){do b=b.parentNode;while((!b.offsetWidth||!b.offsetHeight)&&b!==document.body);return b}function vo(b){var I=b.getBoundingClientRect();return{x:I.width/b.offsetWidth||1,y:I.height/b.offsetHeight||1,boundingClientRect:I}}var Hc={__proto__:null,TRANSFORM:Ui,TRANSITION:$n,TRANSITION_END:Ia,get:Ta,getStyle:Yn,create:fn,remove:an,empty:ea,toFront:ra,toBack:Sn,hasClass:Wa,addClass:zn,removeClass:ka,setClass:qs,getClass:rs,setOpacity:er,testProp:Jr,setTransform:ss,setPosition:xa,getPosition:Io,get disableTextSelection(){return _o},get enableTextSelection(){return Vc},disableImageDrag:fc,enableImageDrag:dl,preventOutline:yo,restoreOutline:Ws,getSizedParentNode:no,getScale:vo};function sa(b,I,$,te){if(I&&typeof I=="object")for(var me in I)ds(b,me,I[me],$);else{I=re(I);for(var Le=0,ut=I.length;Le<ut;Le++)ds(b,I[Le],$,te)}return this}var Zs="_leaflet_events";function ar(b,I,$,te){if(arguments.length===1)Dl(b),delete b[Zs];else if(I&&typeof I=="object")for(var me in I)Jo(b,me,I[me],$);else if(I=re(I),arguments.length===2)Dl(b,function(Bt){return Qe(I,Bt)!==-1});else for(var Le=0,ut=I.length;Le<ut;Le++)Jo(b,I[Le],$,te);return this}function Dl(b,I){for(var $ in b[Zs]){var te=$.split(/\d/)[0];(!I||I(te))&&Jo(b,te,null,null,$)}}var mc={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function ds(b,I,$,te){var me=I+M($)+(te?"_"+M(te):"");if(b[Zs]&&b[Zs][me])return this;var Le=function(Bt){return $.call(te||b,Bt||window.event)},ut=Le;!Si.touchNative&&Si.pointer&&I.indexOf("touch")===0?Le=qe(b,I,Le):Si.touch&&I==="dblclick"?Le=rn(b,Le):"addEventListener"in b?I==="touchstart"||I==="touchmove"||I==="wheel"||I==="mousewheel"?b.addEventListener(mc[I]||I,Le,Si.passiveEvents?{passive:!1}:!1):I==="mouseenter"||I==="mouseleave"?(Le=function(Bt){Bt=Bt||window.event,Gc(b,Bt)&&ut(Bt)},b.addEventListener(mc[I],Le,!1)):b.addEventListener(I,ut,!1):b.attachEvent("on"+I,Le),b[Zs]=b[Zs]||{},b[Zs][me]=Le}function Jo(b,I,$,te,me){me=me||I+M($)+(te?"_"+M(te):"");var Le=b[Zs]&&b[Zs][me];if(!Le)return this;!Si.touchNative&&Si.pointer&&I.indexOf("touch")===0?rt(b,I,Le):Si.touch&&I==="dblclick"?Zi(b,Le):"removeEventListener"in b?b.removeEventListener(mc[I]||I,Le,!1):b.detachEvent("on"+I,Le),b[Zs][me]=null}function xo(b){return b.stopPropagation?b.stopPropagation():b.originalEvent?b.originalEvent._stopped=!0:b.cancelBubble=!0,this}function Ro(b){return ds(b,"wheel",xo),this}function Xu(b){return sa(b,"mousedown touchstart dblclick contextmenu",xo),b._leaflet_disable_click=!0,this}function os(b){return b.preventDefault?b.preventDefault():b.returnValue=!1,this}function Do(b){return os(b),xo(b),this}function Vn(b){if(b.composedPath)return b.composedPath();for(var I=[],$=b.target;$;)I.push($),$=$.parentNode;return I}function js(b,I){if(!I)return new jt(b.clientX,b.clientY);var $=vo(I),te=$.boundingClientRect;return new jt((b.clientX-te.left)/$.x-I.clientLeft,(b.clientY-te.top)/$.y-I.clientTop)}var pc=Si.linux&&Si.chrome?window.devicePixelRatio:Si.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Yu(b){return Si.edge?b.wheelDeltaY/2:b.deltaY&&b.deltaMode===0?-b.deltaY/pc:b.deltaY&&b.deltaMode===1?-b.deltaY*20:b.deltaY&&b.deltaMode===2?-b.deltaY*60:b.deltaX||b.deltaZ?0:b.wheelDelta?(b.wheelDeltaY||b.wheelDelta)/2:b.detail&&Math.abs(b.detail)<32765?-b.detail*20:b.detail?b.detail/-32765*60:0}function Gc(b,I){var $=I.relatedTarget;if(!$)return!0;try{for(;$&&$!==b;)$=$.parentNode}catch{return!1}return $!==b}var qc={__proto__:null,on:sa,off:ar,stopPropagation:xo,disableScrollPropagation:Ro,disableClickPropagation:Xu,preventDefault:os,stop:Do,getPropagationPath:Vn,getMousePosition:js,getWheelDelta:Yu,isExternalTarget:Gc,addListener:sa,removeListener:ar},Wc=Et.extend({run:function(b,I,$,te){this.stop(),this._el=b,this._inProgress=!0,this._duration=$||.25,this._easeOutPower=1/Math.max(te||.5,.2),this._startPos=Io(b),this._offset=I.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=gt(this._animate,this),this._step()},_step:function(b){var I=+new Date-this._startTime,$=this._duration*1e3;I<$?this._runFrame(this._easeOut(I/$),b):(this._runFrame(1),this._complete())},_runFrame:function(b,I){var $=this._startPos.add(this._offset.multiplyBy(b));I&&$._round(),xa(this._el,$),this.fire("step")},_complete:function(){ni(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(b){return 1-Math.pow(1-b,this._easeOutPower)}}),Aa=Et.extend({options:{crs:Fi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(b,I){I=ae(this,I),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(b),this._initLayout(),this._onResize=S(this._onResize,this),this._initEvents(),I.maxBounds&&this.setMaxBounds(I.maxBounds),I.zoom!==void 0&&(this._zoom=this._limitZoom(I.zoom)),I.center&&I.zoom!==void 0&&this.setView(li(I.center),I.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=$n&&Si.any3d&&!Si.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),sa(this._proxy,Ia,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(b,I,$){if(I=I===void 0?this._zoom:this._limitZoom(I),b=this._limitCenter(li(b),I,this.options.maxBounds),$=$||{},this._stop(),this._loaded&&!$.reset&&$!==!0){$.animate!==void 0&&($.zoom=p({animate:$.animate},$.zoom),$.pan=p({animate:$.animate,duration:$.duration},$.pan));var te=this._zoom!==I?this._tryAnimatedZoom&&this._tryAnimatedZoom(b,I,$.zoom):this._tryAnimatedPan(b,$.pan);if(te)return clearTimeout(this._sizeTimer),this}return this._resetView(b,I,$.pan&&$.pan.noMoveStart),this},setZoom:function(b,I){return this._loaded?this.setView(this.getCenter(),b,{zoom:I}):(this._zoom=b,this)},zoomIn:function(b,I){return b=b||(Si.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+b,I)},zoomOut:function(b,I){return b=b||(Si.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-b,I)},setZoomAround:function(b,I,$){var te=this.getZoomScale(I),me=this.getSize().divideBy(2),Le=b instanceof jt?b:this.latLngToContainerPoint(b),ut=Le.subtract(me).multiplyBy(1-1/te),Bt=this.containerPointToLatLng(me.add(ut));return this.setView(Bt,I,{zoom:$})},_getBoundsCenterZoom:function(b,I){I=I||{},b=b.getBounds?b.getBounds():oi(b);var $=Ce(I.paddingTopLeft||I.padding||[0,0]),te=Ce(I.paddingBottomRight||I.padding||[0,0]),me=this.getBoundsZoom(b,!1,$.add(te));if(me=typeof I.maxZoom=="number"?Math.min(I.maxZoom,me):me,me===1/0)return{center:b.getCenter(),zoom:me};var Le=te.subtract($).divideBy(2),ut=this.project(b.getSouthWest(),me),Bt=this.project(b.getNorthEast(),me),It=this.unproject(ut.add(Bt).divideBy(2).add(Le),me);return{center:It,zoom:me}},fitBounds:function(b,I){if(b=oi(b),!b.isValid())throw new Error("Bounds are not valid.");var $=this._getBoundsCenterZoom(b,I);return this.setView($.center,$.zoom,I)},fitWorld:function(b){return this.fitBounds([[-90,-180],[90,180]],b)},panTo:function(b,I){return this.setView(b,this._zoom,{pan:I})},panBy:function(b,I){if(b=Ce(b).round(),I=I||{},!b.x&&!b.y)return this.fire("moveend");if(I.animate!==!0&&!this.getSize().contains(b))return this._resetView(this.unproject(this.project(this.getCenter()).add(b)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Wc,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),I.noMoveStart||this.fire("movestart"),I.animate!==!1){zn(this._mapPane,"leaflet-pan-anim");var $=this._getMapPanePos().subtract(b).round();this._panAnim.run(this._mapPane,$,I.duration||.25,I.easeLinearity)}else this._rawPanBy(b),this.fire("move").fire("moveend");return this},flyTo:function(b,I,$){if($=$||{},$.animate===!1||!Si.any3d)return this.setView(b,I,$);this._stop();var te=this.project(this.getCenter()),me=this.project(b),Le=this.getSize(),ut=this._zoom;b=li(b),I=I===void 0?ut:I;var Bt=Math.max(Le.x,Le.y),It=Bt*this.getZoomScale(ut,I),ji=me.distanceTo(te)||1,cn=1.42,vn=cn*cn;function En(Ur){var tl=Ur?-1:1,il=Ur?It:Bt,Sc=It*It-Bt*Bt+tl*vn*vn*ji*ji,rc=2*il*vn*ji,ud=Sc/rc,Tc=Math.sqrt(ud*ud+1)-ud,dd=Tc<1e-9?-18:Math.log(Tc);return dd}function oa(Ur){return(Math.exp(Ur)-Math.exp(-Ur))/2}function pr(Ur){return(Math.exp(Ur)+Math.exp(-Ur))/2}function Ar(Ur){return oa(Ur)/pr(Ur)}var hs=En(0);function Qs(Ur){return Bt*(pr(hs)/pr(hs+cn*Ur))}function kf(Ur){return Bt*(pr(hs)*Ar(hs+cn*Ur)-oa(hs))/vn}function Ph(Ur){return 1-Math.pow(1-Ur,1.5)}var cd=Date.now(),Bl=(En(1)-hs)/cn,Hd=$.duration?1e3*$.duration:1e3*Bl*.8;function wc(){var Ur=(Date.now()-cd)/Hd,tl=Ph(Ur)*Bl;Ur<=1?(this._flyToFrame=gt(wc,this),this._move(this.unproject(te.add(me.subtract(te).multiplyBy(kf(tl)/ji)),ut),this.getScaleZoom(Bt/Qs(tl),ut),{flyTo:!0})):this._move(b,I)._moveEnd(!0)}return this._moveStart(!0,$.noMoveStart),wc.call(this),this},flyToBounds:function(b,I){var $=this._getBoundsCenterZoom(b,I);return this.flyTo($.center,$.zoom,I)},setMaxBounds:function(b){return b=oi(b),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),b.isValid()?(this.options.maxBounds=b,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(b){var I=this.options.minZoom;return this.options.minZoom=b,this._loaded&&I!==b&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(b):this},setMaxZoom:function(b){var I=this.options.maxZoom;return this.options.maxZoom=b,this._loaded&&I!==b&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(b):this},panInsideBounds:function(b,I){this._enforcingBounds=!0;var $=this.getCenter(),te=this._limitCenter($,this._zoom,oi(b));return $.equals(te)||this.panTo(te,I),this._enforcingBounds=!1,this},panInside:function(b,I){I=I||{};var $=Ce(I.paddingTopLeft||I.padding||[0,0]),te=Ce(I.paddingBottomRight||I.padding||[0,0]),me=this.project(this.getCenter()),Le=this.project(b),ut=this.getPixelBounds(),Bt=At([ut.min.add($),ut.max.subtract(te)]),It=Bt.getSize();if(!Bt.contains(Le)){this._enforcingBounds=!0;var ji=Le.subtract(Bt.getCenter()),cn=Bt.extend(Le).getSize().subtract(It);me.x+=ji.x<0?-cn.x:cn.x,me.y+=ji.y<0?-cn.y:cn.y,this.panTo(this.unproject(me),I),this._enforcingBounds=!1}return this},invalidateSize:function(b){if(!this._loaded)return this;b=p({animate:!1,pan:!0},b===!0?{animate:!0}:b);var I=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var $=this.getSize(),te=I.divideBy(2).round(),me=$.divideBy(2).round(),Le=te.subtract(me);return!Le.x&&!Le.y?this:(b.animate&&b.pan?this.panBy(Le):(b.pan&&this._rawPanBy(Le),this.fire("move"),b.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(S(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:I,newSize:$}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(b){if(b=this._locateOptions=p({timeout:1e4,watch:!1},b),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var I=S(this._handleGeolocationResponse,this),$=S(this._handleGeolocationError,this);return b.watch?this._locationWatchId=navigator.geolocation.watchPosition(I,$,b):navigator.geolocation.getCurrentPosition(I,$,b),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(b){if(this._container._leaflet_id){var I=b.code,$=b.message||(I===1?"permission denied":I===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:I,message:"Geolocation error: "+$+"."})}},_handleGeolocationResponse:function(b){if(this._container._leaflet_id){var I=b.coords.latitude,$=b.coords.longitude,te=new Ci(I,$),me=te.toBounds(b.coords.accuracy*2),Le=this._locateOptions;if(Le.setView){var ut=this.getBoundsZoom(me);this.setView(te,Le.maxZoom?Math.min(ut,Le.maxZoom):ut)}var Bt={latlng:te,bounds:me,timestamp:b.timestamp};for(var It in b.coords)typeof b.coords[It]=="number"&&(Bt[It]=b.coords[It]);this.fire("locationfound",Bt)}},addHandler:function(b,I){if(!I)return this;var $=this[b]=new I(this);return this._handlers.push($),this.options[b]&&$.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),an(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ni(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var b;for(b in this._layers)this._layers[b].remove();for(b in this._panes)an(this._panes[b]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(b,I){var $="leaflet-pane"+(b?" leaflet-"+b.replace("Pane","")+"-pane":""),te=fn("div",$,I||this._mapPane);return b&&(this._panes[b]=te),te},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var b=this.getPixelBounds(),I=this.unproject(b.getBottomLeft()),$=this.unproject(b.getTopRight());return new Ct(I,$)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(b,I,$){b=oi(b),$=Ce($||[0,0]);var te=this.getZoom()||0,me=this.getMinZoom(),Le=this.getMaxZoom(),ut=b.getNorthWest(),Bt=b.getSouthEast(),It=this.getSize().subtract($),ji=At(this.project(Bt,te),this.project(ut,te)).getSize(),cn=Si.any3d?this.options.zoomSnap:1,vn=It.x/ji.x,En=It.y/ji.y,oa=I?Math.max(vn,En):Math.min(vn,En);return te=this.getScaleZoom(oa,te),cn&&(te=Math.round(te/(cn/100))*(cn/100),te=I?Math.ceil(te/cn)*cn:Math.floor(te/cn)*cn),Math.max(me,Math.min(Le,te))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new jt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(b,I){var $=this._getTopLeftPoint(b,I);return new _t($,$.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(b){return this.options.crs.getProjectedBounds(b===void 0?this.getZoom():b)},getPane:function(b){return typeof b=="string"?this._panes[b]:b},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(b,I){var $=this.options.crs;return I=I===void 0?this._zoom:I,$.scale(b)/$.scale(I)},getScaleZoom:function(b,I){var $=this.options.crs;I=I===void 0?this._zoom:I;var te=$.zoom(b*$.scale(I));return isNaN(te)?1/0:te},project:function(b,I){return I=I===void 0?this._zoom:I,this.options.crs.latLngToPoint(li(b),I)},unproject:function(b,I){return I=I===void 0?this._zoom:I,this.options.crs.pointToLatLng(Ce(b),I)},layerPointToLatLng:function(b){var I=Ce(b).add(this.getPixelOrigin());return this.unproject(I)},latLngToLayerPoint:function(b){var I=this.project(li(b))._round();return I._subtract(this.getPixelOrigin())},wrapLatLng:function(b){return this.options.crs.wrapLatLng(li(b))},wrapLatLngBounds:function(b){return this.options.crs.wrapLatLngBounds(oi(b))},distance:function(b,I){return this.options.crs.distance(li(b),li(I))},containerPointToLayerPoint:function(b){return Ce(b).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(b){return Ce(b).add(this._getMapPanePos())},containerPointToLatLng:function(b){var I=this.containerPointToLayerPoint(Ce(b));return this.layerPointToLatLng(I)},latLngToContainerPoint:function(b){return this.layerPointToContainerPoint(this.latLngToLayerPoint(li(b)))},mouseEventToContainerPoint:function(b){return js(b,this._container)},mouseEventToLayerPoint:function(b){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(b))},mouseEventToLatLng:function(b){return this.layerPointToLatLng(this.mouseEventToLayerPoint(b))},_initContainer:function(b){var I=this._container=Ta(b);if(I){if(I._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");sa(I,"scroll",this._onScroll,this),this._containerId=M(I)},_initLayout:function(){var b=this._container;this._fadeAnimated=this.options.fadeAnimation&&Si.any3d,zn(b,"leaflet-container"+(Si.touch?" leaflet-touch":"")+(Si.retina?" leaflet-retina":"")+(Si.ielt9?" leaflet-oldie":"")+(Si.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var I=Yn(b,"position");I!=="absolute"&&I!=="relative"&&I!=="fixed"&&I!=="sticky"&&(b.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var b=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),xa(this._mapPane,new jt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(zn(b.markerPane,"leaflet-zoom-hide"),zn(b.shadowPane,"leaflet-zoom-hide"))},_resetView:function(b,I,$){xa(this._mapPane,new jt(0,0));var te=!this._loaded;this._loaded=!0,I=this._limitZoom(I),this.fire("viewprereset");var me=this._zoom!==I;this._moveStart(me,$)._move(b,I)._moveEnd(me),this.fire("viewreset"),te&&this.fire("load")},_moveStart:function(b,I){return b&&this.fire("zoomstart"),I||this.fire("movestart"),this},_move:function(b,I,$,te){I===void 0&&(I=this._zoom);var me=this._zoom!==I;return this._zoom=I,this._lastCenter=b,this._pixelOrigin=this._getNewPixelOrigin(b),te?$&&$.pinch&&this.fire("zoom",$):((me||$&&$.pinch)&&this.fire("zoom",$),this.fire("move",$)),this},_moveEnd:function(b){return b&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ni(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(b){xa(this._mapPane,this._getMapPanePos().subtract(b))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(b){this._targets={},this._targets[M(this._container)]=this;var I=b?ar:sa;I(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&I(window,"resize",this._onResize,this),Si.any3d&&this.options.transform3DLimit&&(b?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ni(this._resizeRequest),this._resizeRequest=gt(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var b=this._getMapPanePos();Math.max(Math.abs(b.x),Math.abs(b.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(b,I){for(var $=[],te,me=I==="mouseout"||I==="mouseover",Le=b.target||b.srcElement,ut=!1;Le;){if(te=this._targets[M(Le)],te&&(I==="click"||I==="preclick")&&this._draggableMoved(te)){ut=!0;break}if(te&&te.listens(I,!0)&&(me&&!Gc(Le,b)||($.push(te),me))||Le===this._container)break;Le=Le.parentNode}return!$.length&&!ut&&!me&&this.listens(I,!0)&&($=[this]),$},_isClickDisabled:function(b){for(;b&&b!==this._container;){if(b._leaflet_disable_click)return!0;b=b.parentNode}},_handleDOMEvent:function(b){var I=b.target||b.srcElement;if(!(!this._loaded||I._leaflet_disable_events||b.type==="click"&&this._isClickDisabled(I))){var $=b.type;$==="mousedown"&&yo(I),this._fireDOMEvent(b,$)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(b,I,$){if(b.type==="click"){var te=p({},b);te.type="preclick",this._fireDOMEvent(te,te.type,$)}var me=this._findEventTargets(b,I);if($){for(var Le=[],ut=0;ut<$.length;ut++)$[ut].listens(I,!0)&&Le.push($[ut]);me=Le.concat(me)}if(me.length){I==="contextmenu"&&os(b);var Bt=me[0],It={originalEvent:b};if(b.type!=="keypress"&&b.type!=="keydown"&&b.type!=="keyup"){var ji=Bt.getLatLng&&(!Bt._radius||Bt._radius<=10);It.containerPoint=ji?this.latLngToContainerPoint(Bt.getLatLng()):this.mouseEventToContainerPoint(b),It.layerPoint=this.containerPointToLayerPoint(It.containerPoint),It.latlng=ji?Bt.getLatLng():this.layerPointToLatLng(It.layerPoint)}for(ut=0;ut<me.length;ut++)if(me[ut].fire(I,It,!0),It.originalEvent._stopped||me[ut].options.bubblingMouseEvents===!1&&Qe(this._mouseEvents,I)!==-1)return}},_draggableMoved:function(b){return b=b.dragging&&b.dragging.enabled()?b:this,b.dragging&&b.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var b=0,I=this._handlers.length;b<I;b++)this._handlers[b].disable()},whenReady:function(b,I){return this._loaded?b.call(I||this,{target:this}):this.on("load",b,I),this},_getMapPanePos:function(){return Io(this._mapPane)||new jt(0,0)},_moved:function(){var b=this._getMapPanePos();return b&&!b.equals([0,0])},_getTopLeftPoint:function(b,I){var $=b&&I!==void 0?this._getNewPixelOrigin(b,I):this.getPixelOrigin();return $.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(b,I){var $=this.getSize()._divideBy(2);return this.project(b,I)._subtract($)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(b,I,$){var te=this._getNewPixelOrigin($,I);return this.project(b,I)._subtract(te)},_latLngBoundsToNewLayerBounds:function(b,I,$){var te=this._getNewPixelOrigin($,I);return At([this.project(b.getSouthWest(),I)._subtract(te),this.project(b.getNorthWest(),I)._subtract(te),this.project(b.getSouthEast(),I)._subtract(te),this.project(b.getNorthEast(),I)._subtract(te)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(b){return this.latLngToLayerPoint(b).subtract(this._getCenterLayerPoint())},_limitCenter:function(b,I,$){if(!$)return b;var te=this.project(b,I),me=this.getSize().divideBy(2),Le=new _t(te.subtract(me),te.add(me)),ut=this._getBoundsOffset(Le,$,I);return Math.abs(ut.x)<=1&&Math.abs(ut.y)<=1?b:this.unproject(te.add(ut),I)},_limitOffset:function(b,I){if(!I)return b;var $=this.getPixelBounds(),te=new _t($.min.add(b),$.max.add(b));return b.add(this._getBoundsOffset(te,I))},_getBoundsOffset:function(b,I,$){var te=At(this.project(I.getNorthEast(),$),this.project(I.getSouthWest(),$)),me=te.min.subtract(b.min),Le=te.max.subtract(b.max),ut=this._rebound(me.x,-Le.x),Bt=this._rebound(me.y,-Le.y);return new jt(ut,Bt)},_rebound:function(b,I){return b+I>0?Math.round(b-I)/2:Math.max(0,Math.ceil(b))-Math.max(0,Math.floor(I))},_limitZoom:function(b){var I=this.getMinZoom(),$=this.getMaxZoom(),te=Si.any3d?this.options.zoomSnap:1;return te&&(b=Math.round(b/te)*te),Math.max(I,Math.min($,b))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){ka(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(b,I){var $=this._getCenterOffset(b)._trunc();return(I&&I.animate)!==!0&&!this.getSize().contains($)?!1:(this.panBy($,I),!0)},_createAnimProxy:function(){var b=this._proxy=fn("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(b),this.on("zoomanim",function(I){var $=Ui,te=this._proxy.style[$];ss(this._proxy,this.project(I.center,I.zoom),this.getZoomScale(I.zoom,1)),te===this._proxy.style[$]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){an(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var b=this.getCenter(),I=this.getZoom();ss(this._proxy,this.project(b,I),this.getZoomScale(I,1))},_catchTransitionEnd:function(b){this._animatingZoom&&b.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(b,I,$){if(this._animatingZoom)return!0;if($=$||{},!this._zoomAnimated||$.animate===!1||this._nothingToAnimate()||Math.abs(I-this._zoom)>this.options.zoomAnimationThreshold)return!1;var te=this.getZoomScale(I),me=this._getCenterOffset(b)._divideBy(1-1/te);return $.animate!==!0&&!this.getSize().contains(me)?!1:(gt(function(){this._moveStart(!0,$.noMoveStart||!1)._animateZoom(b,I,!0)},this),!0)},_animateZoom:function(b,I,$,te){this._mapPane&&($&&(this._animatingZoom=!0,this._animateToCenter=b,this._animateToZoom=I,zn(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:b,zoom:I,noUpdate:te}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(S(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&ka(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Tu(b,I){return new Aa(b,I)}var Xs=Vi.extend({options:{position:"topright"},initialize:function(b){ae(this,b)},getPosition:function(){return this.options.position},setPosition:function(b){var I=this._map;return I&&I.removeControl(this),this.options.position=b,I&&I.addControl(this),this},getContainer:function(){return this._container},addTo:function(b){this.remove(),this._map=b;var I=this._container=this.onAdd(b),$=this.getPosition(),te=b._controlCorners[$];return zn(I,"leaflet-control"),$.indexOf("bottom")!==-1?te.insertBefore(I,te.firstChild):te.appendChild(I),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(an(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(b){this._map&&b&&b.screenX>0&&b.screenY>0&&this._map.getContainer().focus()}}),bo=function(b){return new Xs(b)};Aa.include({addControl:function(b){return b.addTo(this),this},removeControl:function(b){return b.remove(),this},_initControlPos:function(){var b=this._controlCorners={},I="leaflet-",$=this._controlContainer=fn("div",I+"control-container",this._container);function te(me,Le){var ut=I+me+" "+I+Le;b[me+Le]=fn("div",ut,$)}te("top","left"),te("top","right"),te("bottom","left"),te("bottom","right")},_clearControlPos:function(){for(var b in this._controlCorners)an(this._controlCorners[b]);an(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ku=Xs.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(b,I,$,te){return $<te?-1:te<$?1:0}},initialize:function(b,I,$){ae(this,$),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var te in b)this._addLayer(b[te],te);for(te in I)this._addLayer(I[te],te,!0)},onAdd:function(b){this._initLayout(),this._update(),this._map=b,b.on("zoomend",this._checkDisabledLayers,this);for(var I=0;I<this._layers.length;I++)this._layers[I].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(b){return Xs.prototype.addTo.call(this,b),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var b=0;b<this._layers.length;b++)this._layers[b].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(b,I){return this._addLayer(b,I),this._map?this._update():this},addOverlay:function(b,I){return this._addLayer(b,I,!0),this._map?this._update():this},removeLayer:function(b){b.off("add remove",this._onLayerChange,this);var I=this._getLayer(M(b));return I&&this._layers.splice(this._layers.indexOf(I),1),this._map?this._update():this},expand:function(){zn(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var b=this._map.getSize().y-(this._container.offsetTop+50);return b<this._section.clientHeight?(zn(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=b+"px"):ka(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return ka(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var b="leaflet-control-layers",I=this._container=fn("div",b),$=this.options.collapsed;I.setAttribute("aria-haspopup",!0),Xu(I),Ro(I);var te=this._section=fn("section",b+"-list");$&&(this._map.on("click",this.collapse,this),sa(I,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var me=this._layersLink=fn("a",b+"-toggle",I);me.href="#",me.title="Layers",me.setAttribute("role","button"),sa(me,{keydown:function(Le){Le.keyCode===13&&this._expandSafely()},click:function(Le){os(Le),this._expandSafely()}},this),$||this.expand(),this._baseLayersList=fn("div",b+"-base",te),this._separator=fn("div",b+"-separator",te),this._overlaysList=fn("div",b+"-overlays",te),I.appendChild(te)},_getLayer:function(b){for(var I=0;I<this._layers.length;I++)if(this._layers[I]&&M(this._layers[I].layer)===b)return this._layers[I]},_addLayer:function(b,I,$){this._map&&b.on("add remove",this._onLayerChange,this),this._layers.push({layer:b,name:I,overlay:$}),this.options.sortLayers&&this._layers.sort(S(function(te,me){return this.options.sortFunction(te.layer,me.layer,te.name,me.name)},this)),this.options.autoZIndex&&b.setZIndex&&(this._lastZIndex++,b.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ea(this._baseLayersList),ea(this._overlaysList),this._layerControlInputs=[];var b,I,$,te,me=0;for($=0;$<this._layers.length;$++)te=this._layers[$],this._addItem(te),I=I||te.overlay,b=b||!te.overlay,me+=te.overlay?0:1;return this.options.hideSingleBase&&(b=b&&me>1,this._baseLayersList.style.display=b?"":"none"),this._separator.style.display=I&&b?"":"none",this},_onLayerChange:function(b){this._handlingClick||this._update();var I=this._getLayer(M(b.target)),$=I.overlay?b.type==="add"?"overlayadd":"overlayremove":b.type==="add"?"baselayerchange":null;$&&this._map.fire($,I)},_createRadioElement:function(b,I){var $='<input type="radio" class="leaflet-control-layers-selector" name="'+b+'"'+(I?' checked="checked"':"")+"/>",te=document.createElement("div");return te.innerHTML=$,te.firstChild},_addItem:function(b){var I=document.createElement("label"),$=this._map.hasLayer(b.layer),te;b.overlay?(te=document.createElement("input"),te.type="checkbox",te.className="leaflet-control-layers-selector",te.defaultChecked=$):te=this._createRadioElement("leaflet-base-layers_"+M(this),$),this._layerControlInputs.push(te),te.layerId=M(b.layer),sa(te,"click",this._onInputClick,this);var me=document.createElement("span");me.innerHTML=" "+b.name;var Le=document.createElement("span");I.appendChild(Le),Le.appendChild(te),Le.appendChild(me);var ut=b.overlay?this._overlaysList:this._baseLayersList;return ut.appendChild(I),this._checkDisabledLayers(),I},_onInputClick:function(){if(!this._preventClick){var b=this._layerControlInputs,I,$,te=[],me=[];this._handlingClick=!0;for(var Le=b.length-1;Le>=0;Le--)I=b[Le],$=this._getLayer(I.layerId).layer,I.checked?te.push($):I.checked||me.push($);for(Le=0;Le<me.length;Le++)this._map.hasLayer(me[Le])&&this._map.removeLayer(me[Le]);for(Le=0;Le<te.length;Le++)this._map.hasLayer(te[Le])||this._map.addLayer(te[Le]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var b=this._layerControlInputs,I,$,te=this._map.getZoom(),me=b.length-1;me>=0;me--)I=b[me],$=this._getLayer(I.layerId).layer,I.disabled=$.options.minZoom!==void 0&&te<$.options.minZoom||$.options.maxZoom!==void 0&&te>$.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var b=this._section;this._preventClick=!0,sa(b,"click",os),this.expand();var I=this;setTimeout(function(){ar(b,"click",os),I._preventClick=!1})}}),bf=function(b,I,$){return new Ku(b,I,$)},ic=Xs.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(b){var I="leaflet-control-zoom",$=fn("div",I+" leaflet-bar"),te=this.options;return this._zoomInButton=this._createButton(te.zoomInText,te.zoomInTitle,I+"-in",$,this._zoomIn),this._zoomOutButton=this._createButton(te.zoomOutText,te.zoomOutTitle,I+"-out",$,this._zoomOut),this._updateDisabled(),b.on("zoomend zoomlevelschange",this._updateDisabled,this),$},onRemove:function(b){b.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(b){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(b.shiftKey?3:1))},_zoomOut:function(b){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(b.shiftKey?3:1))},_createButton:function(b,I,$,te,me){var Le=fn("a",$,te);return Le.innerHTML=b,Le.href="#",Le.title=I,Le.setAttribute("role","button"),Le.setAttribute("aria-label",I),Xu(Le),sa(Le,"click",Do),sa(Le,"click",me,this),sa(Le,"click",this._refocusOnMap,this),Le},_updateDisabled:function(){var b=this._map,I="leaflet-disabled";ka(this._zoomInButton,I),ka(this._zoomOutButton,I),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||b._zoom===b.getMinZoom())&&(zn(this._zoomOutButton,I),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||b._zoom===b.getMaxZoom())&&(zn(this._zoomInButton,I),this._zoomInButton.setAttribute("aria-disabled","true"))}});Aa.mergeOptions({zoomControl:!0}),Aa.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ic,this.addControl(this.zoomControl))});var gc=function(b){return new ic(b)},zs=Xs.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(b){var I="leaflet-control-scale",$=fn("div",I),te=this.options;return this._addScales(te,I+"-line",$),b.on(te.updateWhenIdle?"moveend":"move",this._update,this),b.whenReady(this._update,this),$},onRemove:function(b){b.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(b,I,$){b.metric&&(this._mScale=fn("div",I,$)),b.imperial&&(this._iScale=fn("div",I,$))},_update:function(){var b=this._map,I=b.getSize().y/2,$=b.distance(b.containerPointToLatLng([0,I]),b.containerPointToLatLng([this.options.maxWidth,I]));this._updateScales($)},_updateScales:function(b){this.options.metric&&b&&this._updateMetric(b),this.options.imperial&&b&&this._updateImperial(b)},_updateMetric:function(b){var I=this._getRoundNum(b),$=I<1e3?I+" m":I/1e3+" km";this._updateScale(this._mScale,$,I/b)},_updateImperial:function(b){var I=b*3.2808399,$,te,me;I>5280?($=I/5280,te=this._getRoundNum($),this._updateScale(this._iScale,te+" mi",te/$)):(me=this._getRoundNum(I),this._updateScale(this._iScale,me+" ft",me/I))},_updateScale:function(b,I,$){b.style.width=Math.round(this.options.maxWidth*$)+"px",b.innerHTML=I},_getRoundNum:function(b){var I=Math.pow(10,(Math.floor(b)+"").length-1),$=b/I;return $=$>=10?10:$>=5?5:$>=3?3:$>=2?2:1,I*$}}),kh=function(b){return new zs(b)},Fd='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Lo=Xs.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Si.inlineSvg?Fd+" ":"")+"Leaflet</a>"},initialize:function(b){ae(this,b),this._attributions={}},onAdd:function(b){b.attributionControl=this,this._container=fn("div","leaflet-control-attribution"),Xu(this._container);for(var I in b._layers)b._layers[I].getAttribution&&this.addAttribution(b._layers[I].getAttribution());return this._update(),b.on("layeradd",this._addAttribution,this),this._container},onRemove:function(b){b.off("layeradd",this._addAttribution,this)},_addAttribution:function(b){b.layer.getAttribution&&(this.addAttribution(b.layer.getAttribution()),b.layer.once("remove",function(){this.removeAttribution(b.layer.getAttribution())},this))},setPrefix:function(b){return this.options.prefix=b,this._update(),this},addAttribution:function(b){return b?(this._attributions[b]||(this._attributions[b]=0),this._attributions[b]++,this._update(),this):this},removeAttribution:function(b){return b?(this._attributions[b]&&(this._attributions[b]--,this._update()),this):this},_update:function(){if(this._map){var b=[];for(var I in this._attributions)this._attributions[I]&&b.push(I);var $=[];this.options.prefix&&$.push(this.options.prefix),b.length&&$.push(b.join(", ")),this._container.innerHTML=$.join(' <span aria-hidden="true">|</span> ')}}});Aa.mergeOptions({attributionControl:!0}),Aa.addInitHook(function(){this.options.attributionControl&&new Lo().addTo(this)});var ha=function(b){return new Lo(b)};Xs.Layers=Ku,Xs.Zoom=ic,Xs.Scale=zs,Xs.Attribution=Lo,bo.layers=bf,bo.zoom=gc,bo.scale=kh,bo.attribution=ha;var hl=Vi.extend({initialize:function(b){this._map=b},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});hl.addTo=function(b,I){return b.addHandler(I,this),this};var Em={Events:We},wf=Si.touch?"touchstart mousedown":"mousedown",$i=Et.extend({options:{clickTolerance:3},initialize:function(b,I,$,te){ae(this,te),this._element=b,this._dragStartTarget=I||b,this._preventOutline=$},enable:function(){this._enabled||(sa(this._dragStartTarget,wf,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&($i._dragging===this&&this.finishDrag(!0),ar(this._dragStartTarget,wf,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(b){if(this._enabled&&(this._moved=!1,!Wa(this._element,"leaflet-zoom-anim"))){if(b.touches&&b.touches.length!==1){$i._dragging===this&&this.finishDrag();return}if(!($i._dragging||b.shiftKey||b.which!==1&&b.button!==1&&!b.touches)&&($i._dragging=this,this._preventOutline&&yo(this._element),fc(),_o(),!this._moving)){this.fire("down");var I=b.touches?b.touches[0]:b,$=no(this._element);this._startPoint=new jt(I.clientX,I.clientY),this._startPos=Io(this._element),this._parentScale=vo($);var te=b.type==="mousedown";sa(document,te?"mousemove":"touchmove",this._onMove,this),sa(document,te?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(b){if(this._enabled){if(b.touches&&b.touches.length>1){this._moved=!0;return}var I=b.touches&&b.touches.length===1?b.touches[0]:b,$=new jt(I.clientX,I.clientY)._subtract(this._startPoint);!$.x&&!$.y||Math.abs($.x)+Math.abs($.y)<this.options.clickTolerance||($.x/=this._parentScale.x,$.y/=this._parentScale.y,os(b),this._moved||(this.fire("dragstart"),this._moved=!0,zn(document.body,"leaflet-dragging"),this._lastTarget=b.target||b.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),zn(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add($),this._moving=!0,this._lastEvent=b,this._updatePosition())}},_updatePosition:function(){var b={originalEvent:this._lastEvent};this.fire("predrag",b),xa(this._element,this._newPos),this.fire("drag",b)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(b){ka(document.body,"leaflet-dragging"),this._lastTarget&&(ka(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ar(document,"mousemove touchmove",this._onMove,this),ar(document,"mouseup touchend touchcancel",this._onUp,this),dl(),Vc();var I=this._moved&&this._moving;this._moving=!1,$i._dragging=!1,I&&this.fire("dragend",{noInertia:b,distance:this._newPos.distanceTo(this._startPos)})}});function Eh(b,I,$){var te,me=[1,4,2,8],Le,ut,Bt,It,ji,cn,vn,En;for(Le=0,cn=b.length;Le<cn;Le++)b[Le]._code=Ll(b[Le],I);for(Bt=0;Bt<4;Bt++){for(vn=me[Bt],te=[],Le=0,cn=b.length,ut=cn-1;Le<cn;ut=Le++)It=b[Le],ji=b[ut],It._code&vn?ji._code&vn||(En=Xc(ji,It,vn,I,$),En._code=Ll(En,I),te.push(En)):(ji._code&vn&&(En=Xc(ji,It,vn,I,$),En._code=Ll(En,I),te.push(En)),te.push(It));b=te}return b}function Zc(b,I){var $,te,me,Le,ut,Bt,It,ji,cn;if(!b||b.length===0)throw new Error("latlngs not passed");ao(b)||(console.warn("latlngs are not flat! Only the first ring will be used"),b=b[0]);var vn=li([0,0]),En=oi(b),oa=En.getNorthWest().distanceTo(En.getSouthWest())*En.getNorthEast().distanceTo(En.getNorthWest());oa<1700&&(vn=Oo(b));var pr=b.length,Ar=[];for($=0;$<pr;$++){var hs=li(b[$]);Ar.push(I.project(li([hs.lat-vn.lat,hs.lng-vn.lng])))}for(Bt=It=ji=0,$=0,te=pr-1;$<pr;te=$++)me=Ar[$],Le=Ar[te],ut=me.y*Le.x-Le.y*me.x,It+=(me.x+Le.x)*ut,ji+=(me.y+Le.y)*ut,Bt+=ut*3;Bt===0?cn=Ar[0]:cn=[It/Bt,ji/Bt];var Qs=I.unproject(Ce(cn));return li([Qs.lat+vn.lat,Qs.lng+vn.lng])}function Oo(b){for(var I=0,$=0,te=0,me=0;me<b.length;me++){var Le=li(b[me]);I+=Le.lat,$+=Le.lng,te++}return li([I/te,$/te])}var Ju={__proto__:null,clipPolygon:Eh,polygonCenter:Zc,centroid:Oo};function fl(b,I){if(!I||!b.length)return b.slice();var $=I*I;return b=nc(b,$),b=pa(b,$),b}function Ii(b,I,$){return Math.sqrt(or(b,I,$,!0))}function Nn(b,I,$){return or(b,I,$)}function pa(b,I){var $=b.length,te=typeof Uint8Array<"u"?Uint8Array:Array,me=new te($);me[0]=me[$-1]=1,Ys(b,me,I,0,$-1);var Le,ut=[];for(Le=0;Le<$;Le++)me[Le]&&ut.push(b[Le]);return ut}function Ys(b,I,$,te,me){var Le=0,ut,Bt,It;for(Bt=te+1;Bt<=me-1;Bt++)It=or(b[Bt],b[te],b[me],!0),It>Le&&(ut=Bt,Le=It);Le>$&&(I[ut]=1,Ys(b,I,$,te,ut),Ys(b,I,$,ut,me))}function nc(b,I){for(var $=[b[0]],te=1,me=0,Le=b.length;te<Le;te++)Is(b[te],b[me])>I&&($.push(b[te]),me=te);return me<Le-1&&$.push(b[Le-1]),$}var na;function Bd(b,I,$,te,me){var Le=te?na:Ll(b,$),ut=Ll(I,$),Bt,It,ji;for(na=ut;;){if(!(Le|ut))return[b,I];if(Le&ut)return!1;Bt=Le||ut,It=Xc(b,I,Bt,$,me),ji=Ll(It,$),Bt===Le?(b=It,Le=ji):(I=It,ut=ji)}}function Xc(b,I,$,te,me){var Le=I.x-b.x,ut=I.y-b.y,Bt=te.min,It=te.max,ji,cn;return $&8?(ji=b.x+Le*(It.y-b.y)/ut,cn=It.y):$&4?(ji=b.x+Le*(Bt.y-b.y)/ut,cn=Bt.y):$&2?(ji=It.x,cn=b.y+ut*(It.x-b.x)/Le):$&1&&(ji=Bt.x,cn=b.y+ut*(Bt.x-b.x)/Le),new jt(ji,cn,me)}function Ll(b,I){var $=0;return b.x<I.min.x?$|=1:b.x>I.max.x&&($|=2),b.y<I.min.y?$|=4:b.y>I.max.y&&($|=8),$}function Is(b,I){var $=I.x-b.x,te=I.y-b.y;return $*$+te*te}function or(b,I,$,te){var me=I.x,Le=I.y,ut=$.x-me,Bt=$.y-Le,It=ut*ut+Bt*Bt,ji;return It>0&&(ji=((b.x-me)*ut+(b.y-Le)*Bt)/It,ji>1?(me=$.x,Le=$.y):ji>0&&(me+=ut*ji,Le+=Bt*ji)),ut=b.x-me,Bt=b.y-Le,te?ut*ut+Bt*Bt:new jt(me,Le)}function ao(b){return!Ee(b[0])||typeof b[0][0]!="object"&&typeof b[0][0]<"u"}function _c(b){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ao(b)}function Ud(b,I){var $,te,me,Le,ut,Bt,It,ji;if(!b||b.length===0)throw new Error("latlngs not passed");ao(b)||(console.warn("latlngs are not flat! Only the first ring will be used"),b=b[0]);var cn=li([0,0]),vn=oi(b),En=vn.getNorthWest().distanceTo(vn.getSouthWest())*vn.getNorthEast().distanceTo(vn.getNorthWest());En<1700&&(cn=Oo(b));var oa=b.length,pr=[];for($=0;$<oa;$++){var Ar=li(b[$]);pr.push(I.project(li([Ar.lat-cn.lat,Ar.lng-cn.lng])))}for($=0,te=0;$<oa-1;$++)te+=pr[$].distanceTo(pr[$+1])/2;if(te===0)ji=pr[0];else for($=0,Le=0;$<oa-1;$++)if(ut=pr[$],Bt=pr[$+1],me=ut.distanceTo(Bt),Le+=me,Le>te){It=(Le-te)/me,ji=[Bt.x-It*(Bt.x-ut.x),Bt.y-It*(Bt.y-ut.y)];break}var hs=I.unproject(Ce(ji));return li([hs.lat+cn.lat,hs.lng+cn.lng])}var Qu={__proto__:null,simplify:fl,pointToSegmentDistance:Ii,closestPointOnSegment:Nn,clipSegment:Bd,_getEdgeIntersection:Xc,_getBitCode:Ll,_sqClosestPointOnSegment:or,isFlat:ao,_flat:_c,polylineCenter:Ud},ku={project:function(b){return new jt(b.lng,b.lat)},unproject:function(b){return new Ci(b.y,b.x)},bounds:new _t([-180,-90],[180,90])},ed={R:6378137,R_MINOR:6356752314245179e-9,bounds:new _t([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(b){var I=Math.PI/180,$=this.R,te=b.lat*I,me=this.R_MINOR/$,Le=Math.sqrt(1-me*me),ut=Le*Math.sin(te),Bt=Math.tan(Math.PI/4-te/2)/Math.pow((1-ut)/(1+ut),Le/2);return te=-$*Math.log(Math.max(Bt,1e-10)),new jt(b.lng*I*$,te)},unproject:function(b){for(var I=180/Math.PI,$=this.R,te=this.R_MINOR/$,me=Math.sqrt(1-te*te),Le=Math.exp(-b.y/$),ut=Math.PI/2-2*Math.atan(Le),Bt=0,It=.1,ji;Bt<15&&Math.abs(It)>1e-7;Bt++)ji=me*Math.sin(ut),ji=Math.pow((1-ji)/(1+ji),me/2),It=Math.PI/2-2*Math.atan(Le*ji)-ut,ut+=It;return new Ci(ut*I,b.x*I/$)}},$d={__proto__:null,LonLat:ku,Mercator:ed,SphericalMercator:On},ls=p({},Un,{code:"EPSG:3395",projection:ed,transformation:(function(){var b=.5/(Math.PI*ed.R);return Qi(b,.5,-b,.5)})()}),ac=p({},Un,{code:"EPSG:4326",projection:ku,transformation:Qi(1/180,1,-1/180,.5)}),ro=p({},Ba,{projection:ku,transformation:Qi(1,0,-1,0),scale:function(b){return Math.pow(2,b)},zoom:function(b){return Math.log(b)/Math.LN2},distance:function(b,I){var $=I.lng-b.lng,te=I.lat-b.lat;return Math.sqrt($*$+te*te)},infinite:!0});Ba.Earth=Un,Ba.EPSG3395=ls,Ba.EPSG3857=Fi,Ba.EPSG900913=nn,Ba.EPSG4326=ac,Ba.Simple=ro;var Ks=Et.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(b){return b.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(b){return b&&b.removeLayer(this),this},getPane:function(b){return this._map.getPane(b?this.options[b]||b:this.options.pane)},addInteractiveTarget:function(b){return this._map._targets[M(b)]=this,this},removeInteractiveTarget:function(b){return delete this._map._targets[M(b)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(b){var I=b.target;if(I.hasLayer(this)){if(this._map=I,this._zoomAnimated=I._zoomAnimated,this.getEvents){var $=this.getEvents();I.on($,this),this.once("remove",function(){I.off($,this)},this)}this.onAdd(I),this.fire("add"),I.fire("layeradd",{layer:this})}}});Aa.include({addLayer:function(b){if(!b._layerAdd)throw new Error("The provided object is not a Layer.");var I=M(b);return this._layers[I]?this:(this._layers[I]=b,b._mapToAdd=this,b.beforeAdd&&b.beforeAdd(this),this.whenReady(b._layerAdd,b),this)},removeLayer:function(b){var I=M(b);return this._layers[I]?(this._loaded&&b.onRemove(this),delete this._layers[I],this._loaded&&(this.fire("layerremove",{layer:b}),b.fire("remove")),b._map=b._mapToAdd=null,this):this},hasLayer:function(b){return M(b)in this._layers},eachLayer:function(b,I){for(var $ in this._layers)b.call(I,this._layers[$]);return this},_addLayers:function(b){b=b?Ee(b)?b:[b]:[];for(var I=0,$=b.length;I<$;I++)this.addLayer(b[I])},_addZoomLimit:function(b){(!isNaN(b.options.maxZoom)||!isNaN(b.options.minZoom))&&(this._zoomBoundLayers[M(b)]=b,this._updateZoomLevels())},_removeZoomLimit:function(b){var I=M(b);this._zoomBoundLayers[I]&&(delete this._zoomBoundLayers[I],this._updateZoomLevels())},_updateZoomLevels:function(){var b=1/0,I=-1/0,$=this._getZoomSpan();for(var te in this._zoomBoundLayers){var me=this._zoomBoundLayers[te].options;b=me.minZoom===void 0?b:Math.min(b,me.minZoom),I=me.maxZoom===void 0?I:Math.max(I,me.maxZoom)}this._layersMaxZoom=I===-1/0?void 0:I,this._layersMinZoom=b===1/0?void 0:b,$!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ml=Ks.extend({initialize:function(b,I){ae(this,I),this._layers={};var $,te;if(b)for($=0,te=b.length;$<te;$++)this.addLayer(b[$])},addLayer:function(b){var I=this.getLayerId(b);return this._layers[I]=b,this._map&&this._map.addLayer(b),this},removeLayer:function(b){var I=b in this._layers?b:this.getLayerId(b);return this._map&&this._layers[I]&&this._map.removeLayer(this._layers[I]),delete this._layers[I],this},hasLayer:function(b){var I=typeof b=="number"?b:this.getLayerId(b);return I in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(b){var I=Array.prototype.slice.call(arguments,1),$,te;for($ in this._layers)te=this._layers[$],te[b]&&te[b].apply(te,I);return this},onAdd:function(b){this.eachLayer(b.addLayer,b)},onRemove:function(b){this.eachLayer(b.removeLayer,b)},eachLayer:function(b,I){for(var $ in this._layers)b.call(I,this._layers[$]);return this},getLayer:function(b){return this._layers[b]},getLayers:function(){var b=[];return this.eachLayer(b.push,b),b},setZIndex:function(b){return this.invoke("setZIndex",b)},getLayerId:function(b){return M(b)}}),Hr=function(b,I){return new ml(b,I)},Br=ml.extend({addLayer:function(b){return this.hasLayer(b)?this:(b.addEventParent(this),ml.prototype.addLayer.call(this,b),this.fire("layeradd",{layer:b}))},removeLayer:function(b){return this.hasLayer(b)?(b in this._layers&&(b=this._layers[b]),b.removeEventParent(this),ml.prototype.removeLayer.call(this,b),this.fire("layerremove",{layer:b})):this},setStyle:function(b){return this.invoke("setStyle",b)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var b=new Ct;for(var I in this._layers){var $=this._layers[I];b.extend($.getBounds?$.getBounds():$.getLatLng())}return b}}),Qo=function(b,I){return new Br(b,I)},wr=Vi.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(b){ae(this,b)},createIcon:function(b){return this._createIcon("icon",b)},createShadow:function(b){return this._createIcon("shadow",b)},_createIcon:function(b,I){var $=this._getIconUrl(b);if(!$){if(b==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var te=this._createImg($,I&&I.tagName==="IMG"?I:null);return this._setIconStyles(te,b),(this.options.crossOrigin||this.options.crossOrigin==="")&&(te.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),te},_setIconStyles:function(b,I){var $=this.options,te=$[I+"Size"];typeof te=="number"&&(te=[te,te]);var me=Ce(te),Le=Ce(I==="shadow"&&$.shadowAnchor||$.iconAnchor||me&&me.divideBy(2,!0));b.className="leaflet-marker-"+I+" "+($.className||""),Le&&(b.style.marginLeft=-Le.x+"px",b.style.marginTop=-Le.y+"px"),me&&(b.style.width=me.x+"px",b.style.height=me.y+"px")},_createImg:function(b,I){return I=I||document.createElement("img"),I.src=b,I},_getIconUrl:function(b){return Si.retina&&this.options[b+"RetinaUrl"]||this.options[b+"Url"]}});function td(b){return new wr(b)}var so=wr.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(b){return typeof so.imagePath!="string"&&(so.imagePath=this._detectIconPath()),(this.options.imagePath||so.imagePath)+wr.prototype._getIconUrl.call(this,b)},_stripUrl:function(b){var I=function($,te,me){var Le=te.exec($);return Le&&Le[me]};return b=I(b,/^url\((['"])?(.+)\1\)$/,2),b&&I(b,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var b=fn("div","leaflet-default-icon-path",document.body),I=Yn(b,"background-image")||Yn(b,"backgroundImage");if(document.body.removeChild(b),I=this._stripUrl(I),I)return I;var $=document.querySelector('link[href$="leaflet.css"]');return $?$.href.substring(0,$.href.length-11-1):""}}),pl=hl.extend({initialize:function(b){this._marker=b},addHooks:function(){var b=this._marker._icon;this._draggable||(this._draggable=new $i(b,b,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),zn(b,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&ka(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(b){var I=this._marker,$=I._map,te=this._marker.options.autoPanSpeed,me=this._marker.options.autoPanPadding,Le=Io(I._icon),ut=$.getPixelBounds(),Bt=$.getPixelOrigin(),It=At(ut.min._subtract(Bt).add(me),ut.max._subtract(Bt).subtract(me));if(!It.contains(Le)){var ji=Ce((Math.max(It.max.x,Le.x)-It.max.x)/(ut.max.x-It.max.x)-(Math.min(It.min.x,Le.x)-It.min.x)/(ut.min.x-It.min.x),(Math.max(It.max.y,Le.y)-It.max.y)/(ut.max.y-It.max.y)-(Math.min(It.min.y,Le.y)-It.min.y)/(ut.min.y-It.min.y)).multiplyBy(te);$.panBy(ji,{animate:!1}),this._draggable._newPos._add(ji),this._draggable._startPos._add(ji),xa(I._icon,this._draggable._newPos),this._onDrag(b),this._panRequest=gt(this._adjustPan.bind(this,b))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(b){this._marker.options.autoPan&&(ni(this._panRequest),this._panRequest=gt(this._adjustPan.bind(this,b)))},_onDrag:function(b){var I=this._marker,$=I._shadow,te=Io(I._icon),me=I._map.layerPointToLatLng(te);$&&xa($,te),I._latlng=me,b.latlng=me,b.oldLatLng=this._oldLatLng,I.fire("move",b).fire("drag",b)},_onDragEnd:function(b){ni(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",b)}}),sn=Ks.extend({options:{icon:new so,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(b,I){ae(this,I),this._latlng=li(b)},onAdd:function(b){this._zoomAnimated=this._zoomAnimated&&b.options.markerZoomAnimation,this._zoomAnimated&&b.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(b){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&b.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(b){var I=this._latlng;return this._latlng=li(b),this.update(),this.fire("move",{oldLatLng:I,latlng:this._latlng})},setZIndexOffset:function(b){return this.options.zIndexOffset=b,this.update()},getIcon:function(){return this.options.icon},setIcon:function(b){return this.options.icon=b,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var b=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(b)}return this},_initIcon:function(){var b=this.options,I="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),$=b.icon.createIcon(this._icon),te=!1;$!==this._icon&&(this._icon&&this._removeIcon(),te=!0,b.title&&($.title=b.title),$.tagName==="IMG"&&($.alt=b.alt||"")),zn($,I),b.keyboard&&($.tabIndex="0",$.setAttribute("role","button")),this._icon=$,b.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&sa($,"focus",this._panOnFocus,this);var me=b.icon.createShadow(this._shadow),Le=!1;me!==this._shadow&&(this._removeShadow(),Le=!0),me&&(zn(me,I),me.alt=""),this._shadow=me,b.opacity<1&&this._updateOpacity(),te&&this.getPane().appendChild(this._icon),this._initInteraction(),me&&Le&&this.getPane(b.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ar(this._icon,"focus",this._panOnFocus,this),an(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&an(this._shadow),this._shadow=null},_setPos:function(b){this._icon&&xa(this._icon,b),this._shadow&&xa(this._shadow,b),this._zIndex=b.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(b){this._icon&&(this._icon.style.zIndex=this._zIndex+b)},_animateZoom:function(b){var I=this._map._latLngToNewLayerPoint(this._latlng,b.zoom,b.center).round();this._setPos(I)},_initInteraction:function(){if(this.options.interactive&&(zn(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),pl)){var b=this.options.draggable;this.dragging&&(b=this.dragging.enabled(),this.dragging.disable()),this.dragging=new pl(this),b&&this.dragging.enable()}},setOpacity:function(b){return this.options.opacity=b,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var b=this.options.opacity;this._icon&&er(this._icon,b),this._shadow&&er(this._shadow,b)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var b=this._map;if(b){var I=this.options.icon.options,$=I.iconSize?Ce(I.iconSize):Ce(0,0),te=I.iconAnchor?Ce(I.iconAnchor):Ce(0,0);b.panInside(this._latlng,{paddingTopLeft:te,paddingBottomRight:$.subtract(te)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Pi(b,I){return new sn(b,I)}var gl=Ks.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(b){this._renderer=b.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(b){return ae(this,b),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&b&&Object.prototype.hasOwnProperty.call(b,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ki=gl.extend({options:{fill:!0,radius:10},initialize:function(b,I){ae(this,I),this._latlng=li(b),this._radius=this.options.radius},setLatLng:function(b){var I=this._latlng;return this._latlng=li(b),this.redraw(),this.fire("move",{oldLatLng:I,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(b){return this.options.radius=this._radius=b,this.redraw()},getRadius:function(){return this._radius},setStyle:function(b){var I=b&&b.radius||this._radius;return gl.prototype.setStyle.call(this,b),this.setRadius(I),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var b=this._radius,I=this._radiusY||b,$=this._clickTolerance(),te=[b+$,I+$];this._pxBounds=new _t(this._point.subtract(te),this._point.add(te))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(b){return b.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Eu(b,I){return new Ki(b,I)}var id=Ki.extend({initialize:function(b,I,$){if(typeof I=="number"&&(I=p({},$,{radius:I})),ae(this,I),this._latlng=li(b),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(b){return this._mRadius=b,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var b=[this._radius,this._radiusY||this._radius];return new Ct(this._map.layerPointToLatLng(this._point.subtract(b)),this._map.layerPointToLatLng(this._point.add(b)))},setStyle:gl.prototype.setStyle,_project:function(){var b=this._latlng.lng,I=this._latlng.lat,$=this._map,te=$.options.crs;if(te.distance===Un.distance){var me=Math.PI/180,Le=this._mRadius/Un.R/me,ut=$.project([I+Le,b]),Bt=$.project([I-Le,b]),It=ut.add(Bt).divideBy(2),ji=$.unproject(It).lat,cn=Math.acos((Math.cos(Le*me)-Math.sin(I*me)*Math.sin(ji*me))/(Math.cos(I*me)*Math.cos(ji*me)))/me;(isNaN(cn)||cn===0)&&(cn=Le/Math.cos(Math.PI/180*I)),this._point=It.subtract($.getPixelOrigin()),this._radius=isNaN(cn)?0:It.x-$.project([ji,b-cn]).x,this._radiusY=It.y-ut.y}else{var vn=te.unproject(te.project(this._latlng).subtract([this._mRadius,0]));this._point=$.latLngToLayerPoint(this._latlng),this._radius=this._point.x-$.latLngToLayerPoint(vn).x}this._updateBounds()}});function en(b,I,$){return new id(b,I,$)}var Rs=gl.extend({options:{smoothFactor:1,noClip:!1},initialize:function(b,I){ae(this,I),this._setLatLngs(b)},getLatLngs:function(){return this._latlngs},setLatLngs:function(b){return this._setLatLngs(b),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(b){for(var I=1/0,$=null,te=or,me,Le,ut=0,Bt=this._parts.length;ut<Bt;ut++)for(var It=this._parts[ut],ji=1,cn=It.length;ji<cn;ji++){me=It[ji-1],Le=It[ji];var vn=te(b,me,Le,!0);vn<I&&(I=vn,$=te(b,me,Le))}return $&&($.distance=Math.sqrt(I)),$},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ud(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(b,I){return I=I||this._defaultShape(),b=li(b),I.push(b),this._bounds.extend(b),this.redraw()},_setLatLngs:function(b){this._bounds=new Ct,this._latlngs=this._convertLatLngs(b)},_defaultShape:function(){return ao(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(b){for(var I=[],$=ao(b),te=0,me=b.length;te<me;te++)$?(I[te]=li(b[te]),this._bounds.extend(I[te])):I[te]=this._convertLatLngs(b[te]);return I},_project:function(){var b=new _t;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,b),this._bounds.isValid()&&b.isValid()&&(this._rawPxBounds=b,this._updateBounds())},_updateBounds:function(){var b=this._clickTolerance(),I=new jt(b,b);this._rawPxBounds&&(this._pxBounds=new _t([this._rawPxBounds.min.subtract(I),this._rawPxBounds.max.add(I)]))},_projectLatlngs:function(b,I,$){var te=b[0]instanceof Ci,me=b.length,Le,ut;if(te){for(ut=[],Le=0;Le<me;Le++)ut[Le]=this._map.latLngToLayerPoint(b[Le]),$.extend(ut[Le]);I.push(ut)}else for(Le=0;Le<me;Le++)this._projectLatlngs(b[Le],I,$)},_clipPoints:function(){var b=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(b))){if(this.options.noClip){this._parts=this._rings;return}var I=this._parts,$,te,me,Le,ut,Bt,It;for($=0,me=0,Le=this._rings.length;$<Le;$++)for(It=this._rings[$],te=0,ut=It.length;te<ut-1;te++)Bt=Bd(It[te],It[te+1],b,te,!0),Bt&&(I[me]=I[me]||[],I[me].push(Bt[0]),(Bt[1]!==It[te+1]||te===ut-2)&&(I[me].push(Bt[1]),me++))}},_simplifyPoints:function(){for(var b=this._parts,I=this.options.smoothFactor,$=0,te=b.length;$<te;$++)b[$]=fl(b[$],I)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(b,I){var $,te,me,Le,ut,Bt,It=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(b))return!1;for($=0,Le=this._parts.length;$<Le;$++)for(Bt=this._parts[$],te=0,ut=Bt.length,me=ut-1;te<ut;me=te++)if(!(!I&&te===0)&&Ii(b,Bt[me],Bt[te])<=It)return!0;return!1}});function Sf(b,I){return new Rs(b,I)}Rs._flat=_c;var yc=Rs.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Zc(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(b){var I=Rs.prototype._convertLatLngs.call(this,b),$=I.length;return $>=2&&I[0]instanceof Ci&&I[0].equals(I[$-1])&&I.pop(),I},_setLatLngs:function(b){Rs.prototype._setLatLngs.call(this,b),ao(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ao(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var b=this._renderer._bounds,I=this.options.weight,$=new jt(I,I);if(b=new _t(b.min.subtract($),b.max.add($)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(b))){if(this.options.noClip){this._parts=this._rings;return}for(var te=0,me=this._rings.length,Le;te<me;te++)Le=Eh(this._rings[te],b,!0),Le.length&&this._parts.push(Le)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(b){var I=!1,$,te,me,Le,ut,Bt,It,ji;if(!this._pxBounds||!this._pxBounds.contains(b))return!1;for(Le=0,It=this._parts.length;Le<It;Le++)for($=this._parts[Le],ut=0,ji=$.length,Bt=ji-1;ut<ji;Bt=ut++)te=$[ut],me=$[Bt],te.y>b.y!=me.y>b.y&&b.x<(me.x-te.x)*(b.y-te.y)/(me.y-te.y)+te.x&&(I=!I);return I||Rs.prototype._containsPoint.call(this,b,!0)}});function Sr(b,I){return new yc(b,I)}var oo=Br.extend({initialize:function(b,I){ae(this,I),this._layers={},b&&this.addData(b)},addData:function(b){var I=Ee(b)?b:b.features,$,te,me;if(I){for($=0,te=I.length;$<te;$++)me=I[$],(me.geometries||me.geometry||me.features||me.coordinates)&&this.addData(me);return this}var Le=this.options;if(Le.filter&&!Le.filter(b))return this;var ut=Ir(b,Le);return ut?(ut.feature=ad(b),ut.defaultOptions=ut.options,this.resetStyle(ut),Le.onEachFeature&&Le.onEachFeature(b,ut),this.addLayer(ut)):this},resetStyle:function(b){return b===void 0?this.eachLayer(this.resetStyle,this):(b.options=p({},b.defaultOptions),this._setLayerStyle(b,this.options.style),this)},setStyle:function(b){return this.eachLayer(function(I){this._setLayerStyle(I,b)},this)},_setLayerStyle:function(b,I){b.setStyle&&(typeof I=="function"&&(I=I(b.feature)),b.setStyle(I))}});function Ir(b,I){var $=b.type==="Feature"?b.geometry:b,te=$?$.coordinates:null,me=[],Le=I&&I.pointToLayer,ut=I&&I.coordsToLatLng||No,Bt,It,ji,cn;if(!te&&!$)return null;switch($.type){case"Point":return Bt=ut(te),nd(Le,b,Bt,I);case"MultiPoint":for(ji=0,cn=te.length;ji<cn;ji++)Bt=ut(te[ji]),me.push(nd(Le,b,Bt,I));return new Br(me);case"LineString":case"MultiLineString":return It=Au(te,$.type==="LineString"?0:1,ut),new Rs(It,I);case"Polygon":case"MultiPolygon":return It=Au(te,$.type==="Polygon"?1:2,ut),new yc(It,I);case"GeometryCollection":for(ji=0,cn=$.geometries.length;ji<cn;ji++){var vn=Ir({geometry:$.geometries[ji],type:"Feature",properties:b.properties},I);vn&&me.push(vn)}return new Br(me);case"FeatureCollection":for(ji=0,cn=$.features.length;ji<cn;ji++){var En=Ir($.features[ji],I);En&&me.push(En)}return new Br(me);default:throw new Error("Invalid GeoJSON object.")}}function nd(b,I,$,te){return b?b(I,$):new sn($,te&&te.markersInheritOptions&&te)}function No(b){return new Ci(b[1],b[0],b[2])}function Au(b,I,$){for(var te=[],me=0,Le=b.length,ut;me<Le;me++)ut=I?Au(b[me],I-1,$):($||No)(b[me]),te.push(ut);return te}function _l(b,I){return b=li(b),b.alt!==void 0?[W(b.lng,I),W(b.lat,I),W(b.alt,I)]:[W(b.lng,I),W(b.lat,I)]}function wo(b,I,$,te){for(var me=[],Le=0,ut=b.length;Le<ut;Le++)me.push(I?wo(b[Le],ao(b[Le])?0:I-1,$,te):_l(b[Le],te));return!I&&$&&me.length>0&&me.push(me[0].slice()),me}function So(b,I){return b.feature?p({},b.feature,{geometry:I}):ad(I)}function ad(b){return b.type==="Feature"||b.type==="FeatureCollection"?b:{type:"Feature",properties:{},geometry:b}}var yl={toGeoJSON:function(b){return So(this,{type:"Point",coordinates:_l(this.getLatLng(),b)})}};sn.include(yl),id.include(yl),Ki.include(yl),Rs.include({toGeoJSON:function(b){var I=!ao(this._latlngs),$=wo(this._latlngs,I?1:0,!1,b);return So(this,{type:(I?"Multi":"")+"LineString",coordinates:$})}}),yc.include({toGeoJSON:function(b){var I=!ao(this._latlngs),$=I&&!ao(this._latlngs[0]),te=wo(this._latlngs,$?2:I?1:0,!0,b);return I||(te=[te]),So(this,{type:($?"Multi":"")+"Polygon",coordinates:te})}}),ml.include({toMultiPoint:function(b){var I=[];return this.eachLayer(function($){I.push($.toGeoJSON(b).geometry.coordinates)}),So(this,{type:"MultiPoint",coordinates:I})},toGeoJSON:function(b){var I=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(I==="MultiPoint")return this.toMultiPoint(b);var $=I==="GeometryCollection",te=[];return this.eachLayer(function(me){if(me.toGeoJSON){var Le=me.toGeoJSON(b);if($)te.push(Le.geometry);else{var ut=ad(Le);ut.type==="FeatureCollection"?te.push.apply(te,ut.features):te.push(ut)}}}),$?So(this,{geometries:te,type:"GeometryCollection"}):{type:"FeatureCollection",features:te}}});function Yc(b,I){return new oo(b,I)}var rd=Yc,Ds=Ks.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(b,I,$){this._url=b,this._bounds=oi(I),ae(this,$)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(zn(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){an(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(b){return this.options.opacity=b,this._image&&this._updateOpacity(),this},setStyle:function(b){return b.opacity&&this.setOpacity(b.opacity),this},bringToFront:function(){return this._map&&ra(this._image),this},bringToBack:function(){return this._map&&Sn(this._image),this},setUrl:function(b){return this._url=b,this._image&&(this._image.src=b),this},setBounds:function(b){return this._bounds=oi(b),this._map&&this._reset(),this},getEvents:function(){var b={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(b.zoomanim=this._animateZoom),b},setZIndex:function(b){return this.options.zIndex=b,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var b=this._url.tagName==="IMG",I=this._image=b?this._url:fn("img");if(zn(I,"leaflet-image-layer"),this._zoomAnimated&&zn(I,"leaflet-zoom-animated"),this.options.className&&zn(I,this.options.className),I.onselectstart=H,I.onmousemove=H,I.onload=S(this.fire,this,"load"),I.onerror=S(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(I.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),b){this._url=I.src;return}I.src=this._url,I.alt=this.options.alt},_animateZoom:function(b){var I=this._map.getZoomScale(b.zoom),$=this._map._latLngBoundsToNewLayerBounds(this._bounds,b.zoom,b.center).min;ss(this._image,$,I)},_reset:function(){var b=this._image,I=new _t(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),$=I.getSize();xa(b,I.min),b.style.width=$.x+"px",b.style.height=$.y+"px"},_updateOpacity:function(){er(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var b=this.options.errorOverlayUrl;b&&this._url!==b&&(this._url=b,this._image.src=b)},getCenter:function(){return this._bounds.getCenter()}}),el=function(b,I,$){return new Ds(b,I,$)},Ah=Ds.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var b=this._url.tagName==="VIDEO",I=this._image=b?this._url:fn("video");if(zn(I,"leaflet-image-layer"),this._zoomAnimated&&zn(I,"leaflet-zoom-animated"),this.options.className&&zn(I,this.options.className),I.onselectstart=H,I.onmousemove=H,I.onloadeddata=S(this.fire,this,"load"),b){for(var $=I.getElementsByTagName("source"),te=[],me=0;me<$.length;me++)te.push($[me].src);this._url=$.length>0?te:[I.src];return}Ee(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(I.style,"objectFit")&&(I.style.objectFit="fill"),I.autoplay=!!this.options.autoplay,I.loop=!!this.options.loop,I.muted=!!this.options.muted,I.playsInline=!!this.options.playsInline;for(var Le=0;Le<this._url.length;Le++){var ut=fn("source");ut.src=this._url[Le],I.appendChild(ut)}}});function Ch(b,I,$){return new Ah(b,I,$)}var Kc=Ds.extend({_initImage:function(){var b=this._image=this._url;zn(b,"leaflet-image-layer"),this._zoomAnimated&&zn(b,"leaflet-zoom-animated"),this.options.className&&zn(b,this.options.className),b.onselectstart=H,b.onmousemove=H}});function Tf(b,I,$){return new Kc(b,I,$)}var vl=Ks.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(b,I){b&&(b instanceof Ci||Ee(b))?(this._latlng=li(b),ae(this,I)):(ae(this,b),this._source=I),this.options.content&&(this._content=this.options.content)},openOn:function(b){return b=arguments.length?b:this._source._map,b.hasLayer(this)||b.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(b){return this._map?this.close():(arguments.length?this._source=b:b=this._source,this._prepareOpen(),this.openOn(b._map)),this},onAdd:function(b){this._zoomAnimated=b._zoomAnimated,this._container||this._initLayout(),b._fadeAnimated&&er(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),b._fadeAnimated&&er(this._container,1),this.bringToFront(),this.options.interactive&&(zn(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(b){b._fadeAnimated?(er(this._container,0),this._removeTimeout=setTimeout(S(an,void 0,this._container),200)):an(this._container),this.options.interactive&&(ka(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(b){return this._latlng=li(b),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(b){return this._content=b,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var b={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(b.zoomanim=this._animateZoom),b},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ra(this._container),this},bringToBack:function(){return this._map&&Sn(this._container),this},_prepareOpen:function(b){var I=this._source;if(!I._map)return!1;if(I instanceof Br){I=null;var $=this._source._layers;for(var te in $)if($[te]._map){I=$[te];break}if(!I)return!1;this._source=I}if(!b)if(I.getCenter)b=I.getCenter();else if(I.getLatLng)b=I.getLatLng();else if(I.getBounds)b=I.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(b),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var b=this._contentNode,I=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof I=="string")b.innerHTML=I;else{for(;b.hasChildNodes();)b.removeChild(b.firstChild);b.appendChild(I)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var b=this._map.latLngToLayerPoint(this._latlng),I=Ce(this.options.offset),$=this._getAnchor();this._zoomAnimated?xa(this._container,b.add($)):I=I.add(b).add($);var te=this._containerBottom=-I.y,me=this._containerLeft=-Math.round(this._containerWidth/2)+I.x;this._container.style.bottom=te+"px",this._container.style.left=me+"px"}},_getAnchor:function(){return[0,0]}});Aa.include({_initOverlay:function(b,I,$,te){var me=I;return me instanceof b||(me=new b(te).setContent(I)),$&&me.setLatLng($),me}}),Ks.include({_initOverlay:function(b,I,$,te){var me=$;return me instanceof b?(ae(me,te),me._source=this):(me=I&&!te?I:new b(te,this),me.setContent($)),me}});var Cu=vl.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(b){return b=arguments.length?b:this._source._map,!b.hasLayer(this)&&b._popup&&b._popup.options.autoClose&&b.removeLayer(b._popup),b._popup=this,vl.prototype.openOn.call(this,b)},onAdd:function(b){vl.prototype.onAdd.call(this,b),b.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof gl||this._source.on("preclick",xo))},onRemove:function(b){vl.prototype.onRemove.call(this,b),b.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof gl||this._source.off("preclick",xo))},getEvents:function(){var b=vl.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(b.preclick=this.close),this.options.keepInView&&(b.moveend=this._adjustPan),b},_initLayout:function(){var b="leaflet-popup",I=this._container=fn("div",b+" "+(this.options.className||"")+" leaflet-zoom-animated"),$=this._wrapper=fn("div",b+"-content-wrapper",I);if(this._contentNode=fn("div",b+"-content",$),Xu(I),Ro(this._contentNode),sa(I,"contextmenu",xo),this._tipContainer=fn("div",b+"-tip-container",I),this._tip=fn("div",b+"-tip",this._tipContainer),this.options.closeButton){var te=this._closeButton=fn("a",b+"-close-button",I);te.setAttribute("role","button"),te.setAttribute("aria-label","Close popup"),te.href="#close",te.innerHTML='<span aria-hidden="true">&#215;</span>',sa(te,"click",function(me){os(me),this.close()},this)}},_updateLayout:function(){var b=this._contentNode,I=b.style;I.width="",I.whiteSpace="nowrap";var $=b.offsetWidth;$=Math.min($,this.options.maxWidth),$=Math.max($,this.options.minWidth),I.width=$+1+"px",I.whiteSpace="",I.height="";var te=b.offsetHeight,me=this.options.maxHeight,Le="leaflet-popup-scrolled";me&&te>me?(I.height=me+"px",zn(b,Le)):ka(b,Le),this._containerWidth=this._container.offsetWidth},_animateZoom:function(b){var I=this._map._latLngToNewLayerPoint(this._latlng,b.zoom,b.center),$=this._getAnchor();xa(this._container,I.add($))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var b=this._map,I=parseInt(Yn(this._container,"marginBottom"),10)||0,$=this._container.offsetHeight+I,te=this._containerWidth,me=new jt(this._containerLeft,-$-this._containerBottom);me._add(Io(this._container));var Le=b.layerPointToContainerPoint(me),ut=Ce(this.options.autoPanPadding),Bt=Ce(this.options.autoPanPaddingTopLeft||ut),It=Ce(this.options.autoPanPaddingBottomRight||ut),ji=b.getSize(),cn=0,vn=0;Le.x+te+It.x>ji.x&&(cn=Le.x+te-ji.x+It.x),Le.x-cn-Bt.x<0&&(cn=Le.x-Bt.x),Le.y+$+It.y>ji.y&&(vn=Le.y+$-ji.y+It.y),Le.y-vn-Bt.y<0&&(vn=Le.y-Bt.y),(cn||vn)&&(this.options.keepInView&&(this._autopanning=!0),b.fire("autopanstart").panBy([cn,vn]))}},_getAnchor:function(){return Ce(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Jc=function(b,I){return new Cu(b,I)};Aa.mergeOptions({closePopupOnClick:!0}),Aa.include({openPopup:function(b,I,$){return this._initOverlay(Cu,b,I,$).openOn(this),this},closePopup:function(b){return b=arguments.length?b:this._popup,b&&b.close(),this}}),Ks.include({bindPopup:function(b,I){return this._popup=this._initOverlay(Cu,this._popup,b,I),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(b){return this._popup&&(this instanceof Br||(this._popup._source=this),this._popup._prepareOpen(b||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(b){return this._popup&&this._popup.setContent(b),this},getPopup:function(){return this._popup},_openPopup:function(b){if(!(!this._popup||!this._map)){Do(b);var I=b.layer||b.target;if(this._popup._source===I&&!(I instanceof gl)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(b.latlng);return}this._popup._source=I,this.openPopup(b.latlng)}},_movePopup:function(b){this._popup.setLatLng(b.latlng)},_onKeyPress:function(b){b.originalEvent.keyCode===13&&this._openPopup(b)}});var Vd=vl.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(b){vl.prototype.onAdd.call(this,b),this.setOpacity(this.options.opacity),b.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(b){vl.prototype.onRemove.call(this,b),b.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var b=vl.prototype.getEvents.call(this);return this.options.permanent||(b.preclick=this.close),b},_initLayout:function(){var b="leaflet-tooltip",I=b+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=fn("div",I),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+M(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(b){var I,$,te=this._map,me=this._container,Le=te.latLngToContainerPoint(te.getCenter()),ut=te.layerPointToContainerPoint(b),Bt=this.options.direction,It=me.offsetWidth,ji=me.offsetHeight,cn=Ce(this.options.offset),vn=this._getAnchor();Bt==="top"?(I=It/2,$=ji):Bt==="bottom"?(I=It/2,$=0):Bt==="center"?(I=It/2,$=ji/2):Bt==="right"?(I=0,$=ji/2):Bt==="left"?(I=It,$=ji/2):ut.x<Le.x?(Bt="right",I=0,$=ji/2):(Bt="left",I=It+(cn.x+vn.x)*2,$=ji/2),b=b.subtract(Ce(I,$,!0)).add(cn).add(vn),ka(me,"leaflet-tooltip-right"),ka(me,"leaflet-tooltip-left"),ka(me,"leaflet-tooltip-top"),ka(me,"leaflet-tooltip-bottom"),zn(me,"leaflet-tooltip-"+Bt),xa(me,b)},_updatePosition:function(){var b=this._map.latLngToLayerPoint(this._latlng);this._setPosition(b)},setOpacity:function(b){this.options.opacity=b,this._container&&er(this._container,b)},_animateZoom:function(b){var I=this._map._latLngToNewLayerPoint(this._latlng,b.zoom,b.center);this._setPosition(I)},_getAnchor:function(){return Ce(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Am=function(b,I){return new Vd(b,I)};Aa.include({openTooltip:function(b,I,$){return this._initOverlay(Vd,b,I,$).openOn(this),this},closeTooltip:function(b){return b.close(),this}}),Ks.include({bindTooltip:function(b,I){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Vd,this._tooltip,b,I),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(b){if(!(!b&&this._tooltipHandlersAdded)){var I=b?"off":"on",$={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?$.add=this._openTooltip:($.mouseover=this._openTooltip,$.mouseout=this.closeTooltip,$.click=this._openTooltip,this._map?this._addFocusListeners():$.add=this._addFocusListeners),this._tooltip.options.sticky&&($.mousemove=this._moveTooltip),this[I]($),this._tooltipHandlersAdded=!b}},openTooltip:function(b){return this._tooltip&&(this instanceof Br||(this._tooltip._source=this),this._tooltip._prepareOpen(b)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(b){return this._tooltip&&this._tooltip.setContent(b),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(b){var I=typeof b.getElement=="function"&&b.getElement();I&&(sa(I,"focus",function(){this._tooltip._source=b,this.openTooltip()},this),sa(I,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(b){var I=typeof b.getElement=="function"&&b.getElement();I&&I.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(b){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var I=this;this._map.once("moveend",function(){I._openOnceFlag=!1,I._openTooltip(b)});return}this._tooltip._source=b.layer||b.target,this.openTooltip(this._tooltip.options.sticky?b.latlng:void 0)}},_moveTooltip:function(b){var I=b.latlng,$,te;this._tooltip.options.sticky&&b.originalEvent&&($=this._map.mouseEventToContainerPoint(b.originalEvent),te=this._map.containerPointToLayerPoint($),I=this._map.layerPointToLatLng(te)),this._tooltip.setLatLng(I)}});var sd=wr.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(b){var I=b&&b.tagName==="DIV"?b:document.createElement("div"),$=this.options;if($.html instanceof Element?(ea(I),I.appendChild($.html)):I.innerHTML=$.html!==!1?$.html:"",$.bgPos){var te=Ce($.bgPos);I.style.backgroundPosition=-te.x+"px "+-te.y+"px"}return this._setIconStyles(I,"icon"),I},createShadow:function(){return null}});function vc(b){return new sd(b)}wr.Default=so;var Ol=Ks.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Si.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(b){ae(this,b)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(b){b._addZoomLimit(this)},onRemove:function(b){this._removeAllTiles(),an(this._container),b._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ra(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Sn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(b){return this.options.opacity=b,this._updateOpacity(),this},setZIndex:function(b){return this.options.zIndex=b,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var b=this._clampZoom(this._map.getZoom());b!==this._tileZoom&&(this._tileZoom=b,this._updateLevels()),this._update()}return this},getEvents:function(){var b={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=P(this._onMoveEnd,this.options.updateInterval,this)),b.move=this._onMove),this._zoomAnimated&&(b.zoomanim=this._animateZoom),b},createTile:function(){return document.createElement("div")},getTileSize:function(){var b=this.options.tileSize;return b instanceof jt?b:new jt(b,b)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(b){for(var I=this.getPane().children,$=-b(-1/0,1/0),te=0,me=I.length,Le;te<me;te++)Le=I[te].style.zIndex,I[te]!==this._container&&Le&&($=b($,+Le));isFinite($)&&(this.options.zIndex=$+b(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Si.ielt9){er(this._container,this.options.opacity);var b=+new Date,I=!1,$=!1;for(var te in this._tiles){var me=this._tiles[te];if(!(!me.current||!me.loaded)){var Le=Math.min(1,(b-me.loaded)/200);er(me.el,Le),Le<1?I=!0:(me.active?$=!0:this._onOpaqueTile(me),me.active=!0)}}$&&!this._noPrune&&this._pruneTiles(),I&&(ni(this._fadeFrame),this._fadeFrame=gt(this._updateOpacity,this))}},_onOpaqueTile:H,_initContainer:function(){this._container||(this._container=fn("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var b=this._tileZoom,I=this.options.maxZoom;if(b!==void 0){for(var $ in this._levels)$=Number($),this._levels[$].el.children.length||$===b?(this._levels[$].el.style.zIndex=I-Math.abs(b-$),this._onUpdateLevel($)):(an(this._levels[$].el),this._removeTilesAtZoom($),this._onRemoveLevel($),delete this._levels[$]);var te=this._levels[b],me=this._map;return te||(te=this._levels[b]={},te.el=fn("div","leaflet-tile-container leaflet-zoom-animated",this._container),te.el.style.zIndex=I,te.origin=me.project(me.unproject(me.getPixelOrigin()),b).round(),te.zoom=b,this._setZoomTransform(te,me.getCenter(),me.getZoom()),H(te.el.offsetWidth),this._onCreateLevel(te)),this._level=te,te}},_onUpdateLevel:H,_onRemoveLevel:H,_onCreateLevel:H,_pruneTiles:function(){if(this._map){var b,I,$=this._map.getZoom();if($>this.options.maxZoom||$<this.options.minZoom){this._removeAllTiles();return}for(b in this._tiles)I=this._tiles[b],I.retain=I.current;for(b in this._tiles)if(I=this._tiles[b],I.current&&!I.active){var te=I.coords;this._retainParent(te.x,te.y,te.z,te.z-5)||this._retainChildren(te.x,te.y,te.z,te.z+2)}for(b in this._tiles)this._tiles[b].retain||this._removeTile(b)}},_removeTilesAtZoom:function(b){for(var I in this._tiles)this._tiles[I].coords.z===b&&this._removeTile(I)},_removeAllTiles:function(){for(var b in this._tiles)this._removeTile(b)},_invalidateAll:function(){for(var b in this._levels)an(this._levels[b].el),this._onRemoveLevel(Number(b)),delete this._levels[b];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(b,I,$,te){var me=Math.floor(b/2),Le=Math.floor(I/2),ut=$-1,Bt=new jt(+me,+Le);Bt.z=+ut;var It=this._tileCoordsToKey(Bt),ji=this._tiles[It];return ji&&ji.active?(ji.retain=!0,!0):(ji&&ji.loaded&&(ji.retain=!0),ut>te?this._retainParent(me,Le,ut,te):!1)},_retainChildren:function(b,I,$,te){for(var me=2*b;me<2*b+2;me++)for(var Le=2*I;Le<2*I+2;Le++){var ut=new jt(me,Le);ut.z=$+1;var Bt=this._tileCoordsToKey(ut),It=this._tiles[Bt];if(It&&It.active){It.retain=!0;continue}else It&&It.loaded&&(It.retain=!0);$+1<te&&this._retainChildren(me,Le,$+1,te)}},_resetView:function(b){var I=b&&(b.pinch||b.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),I,I)},_animateZoom:function(b){this._setView(b.center,b.zoom,!0,b.noUpdate)},_clampZoom:function(b){var I=this.options;return I.minNativeZoom!==void 0&&b<I.minNativeZoom?I.minNativeZoom:I.maxNativeZoom!==void 0&&I.maxNativeZoom<b?I.maxNativeZoom:b},_setView:function(b,I,$,te){var me=Math.round(I);this.options.maxZoom!==void 0&&me>this.options.maxZoom||this.options.minZoom!==void 0&&me<this.options.minZoom?me=void 0:me=this._clampZoom(me);var Le=this.options.updateWhenZooming&&me!==this._tileZoom;(!te||Le)&&(this._tileZoom=me,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),me!==void 0&&this._update(b),$||this._pruneTiles(),this._noPrune=!!$),this._setZoomTransforms(b,I)},_setZoomTransforms:function(b,I){for(var $ in this._levels)this._setZoomTransform(this._levels[$],b,I)},_setZoomTransform:function(b,I,$){var te=this._map.getZoomScale($,b.zoom),me=b.origin.multiplyBy(te).subtract(this._map._getNewPixelOrigin(I,$)).round();Si.any3d?ss(b.el,me,te):xa(b.el,me)},_resetGrid:function(){var b=this._map,I=b.options.crs,$=this._tileSize=this.getTileSize(),te=this._tileZoom,me=this._map.getPixelWorldBounds(this._tileZoom);me&&(this._globalTileRange=this._pxBoundsToTileRange(me)),this._wrapX=I.wrapLng&&!this.options.noWrap&&[Math.floor(b.project([0,I.wrapLng[0]],te).x/$.x),Math.ceil(b.project([0,I.wrapLng[1]],te).x/$.y)],this._wrapY=I.wrapLat&&!this.options.noWrap&&[Math.floor(b.project([I.wrapLat[0],0],te).y/$.x),Math.ceil(b.project([I.wrapLat[1],0],te).y/$.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(b){var I=this._map,$=I._animatingZoom?Math.max(I._animateToZoom,I.getZoom()):I.getZoom(),te=I.getZoomScale($,this._tileZoom),me=I.project(b,this._tileZoom).floor(),Le=I.getSize().divideBy(te*2);return new _t(me.subtract(Le),me.add(Le))},_update:function(b){var I=this._map;if(I){var $=this._clampZoom(I.getZoom());if(b===void 0&&(b=I.getCenter()),this._tileZoom!==void 0){var te=this._getTiledPixelBounds(b),me=this._pxBoundsToTileRange(te),Le=me.getCenter(),ut=[],Bt=this.options.keepBuffer,It=new _t(me.getBottomLeft().subtract([Bt,-Bt]),me.getTopRight().add([Bt,-Bt]));if(!(isFinite(me.min.x)&&isFinite(me.min.y)&&isFinite(me.max.x)&&isFinite(me.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var ji in this._tiles){var cn=this._tiles[ji].coords;(cn.z!==this._tileZoom||!It.contains(new jt(cn.x,cn.y)))&&(this._tiles[ji].current=!1)}if(Math.abs($-this._tileZoom)>1){this._setView(b,$);return}for(var vn=me.min.y;vn<=me.max.y;vn++)for(var En=me.min.x;En<=me.max.x;En++){var oa=new jt(En,vn);if(oa.z=this._tileZoom,!!this._isValidTile(oa)){var pr=this._tiles[this._tileCoordsToKey(oa)];pr?pr.current=!0:ut.push(oa)}}if(ut.sort(function(hs,Qs){return hs.distanceTo(Le)-Qs.distanceTo(Le)}),ut.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Ar=document.createDocumentFragment();for(En=0;En<ut.length;En++)this._addTile(ut[En],Ar);this._level.el.appendChild(Ar)}}}},_isValidTile:function(b){var I=this._map.options.crs;if(!I.infinite){var $=this._globalTileRange;if(!I.wrapLng&&(b.x<$.min.x||b.x>$.max.x)||!I.wrapLat&&(b.y<$.min.y||b.y>$.max.y))return!1}if(!this.options.bounds)return!0;var te=this._tileCoordsToBounds(b);return oi(this.options.bounds).overlaps(te)},_keyToBounds:function(b){return this._tileCoordsToBounds(this._keyToTileCoords(b))},_tileCoordsToNwSe:function(b){var I=this._map,$=this.getTileSize(),te=b.scaleBy($),me=te.add($),Le=I.unproject(te,b.z),ut=I.unproject(me,b.z);return[Le,ut]},_tileCoordsToBounds:function(b){var I=this._tileCoordsToNwSe(b),$=new Ct(I[0],I[1]);return this.options.noWrap||($=this._map.wrapLatLngBounds($)),$},_tileCoordsToKey:function(b){return b.x+":"+b.y+":"+b.z},_keyToTileCoords:function(b){var I=b.split(":"),$=new jt(+I[0],+I[1]);return $.z=+I[2],$},_removeTile:function(b){var I=this._tiles[b];I&&(an(I.el),delete this._tiles[b],this.fire("tileunload",{tile:I.el,coords:this._keyToTileCoords(b)}))},_initTile:function(b){zn(b,"leaflet-tile");var I=this.getTileSize();b.style.width=I.x+"px",b.style.height=I.y+"px",b.onselectstart=H,b.onmousemove=H,Si.ielt9&&this.options.opacity<1&&er(b,this.options.opacity)},_addTile:function(b,I){var $=this._getTilePos(b),te=this._tileCoordsToKey(b),me=this.createTile(this._wrapCoords(b),S(this._tileReady,this,b));this._initTile(me),this.createTile.length<2&&gt(S(this._tileReady,this,b,null,me)),xa(me,$),this._tiles[te]={el:me,coords:b,current:!0},I.appendChild(me),this.fire("tileloadstart",{tile:me,coords:b})},_tileReady:function(b,I,$){I&&this.fire("tileerror",{error:I,tile:$,coords:b});var te=this._tileCoordsToKey(b);$=this._tiles[te],$&&($.loaded=+new Date,this._map._fadeAnimated?(er($.el,0),ni(this._fadeFrame),this._fadeFrame=gt(this._updateOpacity,this)):($.active=!0,this._pruneTiles()),I||(zn($.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:$.el,coords:b})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Si.ielt9||!this._map._fadeAnimated?gt(this._pruneTiles,this):setTimeout(S(this._pruneTiles,this),250)))},_getTilePos:function(b){return b.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(b){var I=new jt(this._wrapX?N(b.x,this._wrapX):b.x,this._wrapY?N(b.y,this._wrapY):b.y);return I.z=b.z,I},_pxBoundsToTileRange:function(b){var I=this.getTileSize();return new _t(b.min.unscaleBy(I).floor(),b.max.unscaleBy(I).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var b in this._tiles)if(!this._tiles[b].loaded)return!1;return!0}});function Qr(b){return new Ol(b)}var Qc=Ol.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(b,I){this._url=b,I=ae(this,I),I.detectRetina&&Si.retina&&I.maxZoom>0?(I.tileSize=Math.floor(I.tileSize/2),I.zoomReverse?(I.zoomOffset--,I.minZoom=Math.min(I.maxZoom,I.minZoom+1)):(I.zoomOffset++,I.maxZoom=Math.max(I.minZoom,I.maxZoom-1)),I.minZoom=Math.max(0,I.minZoom)):I.zoomReverse?I.minZoom=Math.min(I.maxZoom,I.minZoom):I.maxZoom=Math.max(I.minZoom,I.maxZoom),typeof I.subdomains=="string"&&(I.subdomains=I.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(b,I){return this._url===b&&I===void 0&&(I=!0),this._url=b,I||this.redraw(),this},createTile:function(b,I){var $=document.createElement("img");return sa($,"load",S(this._tileOnLoad,this,I,$)),sa($,"error",S(this._tileOnError,this,I,$)),(this.options.crossOrigin||this.options.crossOrigin==="")&&($.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&($.referrerPolicy=this.options.referrerPolicy),$.alt="",$.src=this.getTileUrl(b),$},getTileUrl:function(b){var I={r:Si.retina?"@2x":"",s:this._getSubdomain(b),x:b.x,y:b.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var $=this._globalTileRange.max.y-b.y;this.options.tms&&(I.y=$),I["-y"]=$}return Se(this._url,p(I,this.options))},_tileOnLoad:function(b,I){Si.ielt9?setTimeout(S(b,this,null,I),0):b(null,I)},_tileOnError:function(b,I,$){var te=this.options.errorTileUrl;te&&I.getAttribute("src")!==te&&(I.src=te),b($,I)},_onTileRemove:function(b){b.tile.onload=null},_getZoomForUrl:function(){var b=this._tileZoom,I=this.options.maxZoom,$=this.options.zoomReverse,te=this.options.zoomOffset;return $&&(b=I-b),b+te},_getSubdomain:function(b){var I=Math.abs(b.x+b.y)%this.options.subdomains.length;return this.options.subdomains[I]},_abortLoading:function(){var b,I;for(b in this._tiles)if(this._tiles[b].coords.z!==this._tileZoom&&(I=this._tiles[b].el,I.onload=H,I.onerror=H,!I.complete)){I.src=He;var $=this._tiles[b].coords;an(I),delete this._tiles[b],this.fire("tileabort",{tile:I,coords:$})}},_removeTile:function(b){var I=this._tiles[b];if(I)return I.el.setAttribute("src",He),Ol.prototype._removeTile.call(this,b)},_tileReady:function(b,I,$){if(!(!this._map||$&&$.getAttribute("src")===He))return Ol.prototype._tileReady.call(this,b,I,$)}});function Ls(b,I){return new Qc(b,I)}var Os=Qc.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(b,I){this._url=b;var $=p({},this.defaultWmsParams);for(var te in I)te in this.options||($[te]=I[te]);I=ae(this,I);var me=I.detectRetina&&Si.retina?2:1,Le=this.getTileSize();$.width=Le.x*me,$.height=Le.y*me,this.wmsParams=$},onAdd:function(b){this._crs=this.options.crs||b.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var I=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[I]=this._crs.code,Qc.prototype.onAdd.call(this,b)},getTileUrl:function(b){var I=this._tileCoordsToNwSe(b),$=this._crs,te=At($.project(I[0]),$.project(I[1])),me=te.min,Le=te.max,ut=(this._wmsVersion>=1.3&&this._crs===ac?[me.y,me.x,Le.y,Le.x]:[me.x,me.y,Le.x,Le.y]).join(","),Bt=Qc.prototype.getTileUrl.call(this,b);return Bt+ce(this.wmsParams,Bt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+ut},setParams:function(b,I){return p(this.wmsParams,b),I||this.redraw(),this}});function eu(b,I){return new Os(b,I)}Qc.WMS=Os,Ls.wms=eu;var Fo=Ks.extend({options:{padding:.1},initialize:function(b){ae(this,b),M(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),zn(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var b={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(b.zoomanim=this._onAnimZoom),b},_onAnimZoom:function(b){this._updateTransform(b.center,b.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(b,I){var $=this._map.getZoomScale(I,this._zoom),te=this._map.getSize().multiplyBy(.5+this.options.padding),me=this._map.project(this._center,I),Le=te.multiplyBy(-$).add(me).subtract(this._map._getNewPixelOrigin(b,I));Si.any3d?ss(this._container,Le,$):xa(this._container,Le)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var b in this._layers)this._layers[b]._reset()},_onZoomEnd:function(){for(var b in this._layers)this._layers[b]._project()},_updatePaths:function(){for(var b in this._layers)this._layers[b]._update()},_update:function(){var b=this.options.padding,I=this._map.getSize(),$=this._map.containerPointToLayerPoint(I.multiplyBy(-b)).round();this._bounds=new _t($,$.add(I.multiplyBy(1+b*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Js=Fo.extend({options:{tolerance:0},getEvents:function(){var b=Fo.prototype.getEvents.call(this);return b.viewprereset=this._onViewPreReset,b},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Fo.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var b=this._container=document.createElement("canvas");sa(b,"mousemove",this._onMouseMove,this),sa(b,"click dblclick mousedown mouseup contextmenu",this._onClick,this),sa(b,"mouseout",this._handleMouseOut,this),b._leaflet_disable_events=!0,this._ctx=b.getContext("2d")},_destroyContainer:function(){ni(this._redrawRequest),delete this._ctx,an(this._container),ar(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var b;this._redrawBounds=null;for(var I in this._layers)b=this._layers[I],b._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Fo.prototype._update.call(this);var b=this._bounds,I=this._container,$=b.getSize(),te=Si.retina?2:1;xa(I,b.min),I.width=te*$.x,I.height=te*$.y,I.style.width=$.x+"px",I.style.height=$.y+"px",Si.retina&&this._ctx.scale(2,2),this._ctx.translate(-b.min.x,-b.min.y),this.fire("update")}},_reset:function(){Fo.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(b){this._updateDashArray(b),this._layers[M(b)]=b;var I=b._order={layer:b,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=I),this._drawLast=I,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(b){this._requestRedraw(b)},_removePath:function(b){var I=b._order,$=I.next,te=I.prev;$?$.prev=te:this._drawLast=te,te?te.next=$:this._drawFirst=$,delete b._order,delete this._layers[M(b)],this._requestRedraw(b)},_updatePath:function(b){this._extendRedrawBounds(b),b._project(),b._update(),this._requestRedraw(b)},_updateStyle:function(b){this._updateDashArray(b),this._requestRedraw(b)},_updateDashArray:function(b){if(typeof b.options.dashArray=="string"){var I=b.options.dashArray.split(/[, ]+/),$=[],te,me;for(me=0;me<I.length;me++){if(te=Number(I[me]),isNaN(te))return;$.push(te)}b.options._dashArray=$}else b.options._dashArray=b.options.dashArray},_requestRedraw:function(b){this._map&&(this._extendRedrawBounds(b),this._redrawRequest=this._redrawRequest||gt(this._redraw,this))},_extendRedrawBounds:function(b){if(b._pxBounds){var I=(b.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new _t,this._redrawBounds.extend(b._pxBounds.min.subtract([I,I])),this._redrawBounds.extend(b._pxBounds.max.add([I,I]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var b=this._redrawBounds;if(b){var I=b.getSize();this._ctx.clearRect(b.min.x,b.min.y,I.x,I.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var b,I=this._redrawBounds;if(this._ctx.save(),I){var $=I.getSize();this._ctx.beginPath(),this._ctx.rect(I.min.x,I.min.y,$.x,$.y),this._ctx.clip()}this._drawing=!0;for(var te=this._drawFirst;te;te=te.next)b=te.layer,(!I||b._pxBounds&&b._pxBounds.intersects(I))&&b._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(b,I){if(this._drawing){var $,te,me,Le,ut=b._parts,Bt=ut.length,It=this._ctx;if(Bt){for(It.beginPath(),$=0;$<Bt;$++){for(te=0,me=ut[$].length;te<me;te++)Le=ut[$][te],It[te?"lineTo":"moveTo"](Le.x,Le.y);I&&It.closePath()}this._fillStroke(It,b)}}},_updateCircle:function(b){if(!(!this._drawing||b._empty())){var I=b._point,$=this._ctx,te=Math.max(Math.round(b._radius),1),me=(Math.max(Math.round(b._radiusY),1)||te)/te;me!==1&&($.save(),$.scale(1,me)),$.beginPath(),$.arc(I.x,I.y/me,te,0,Math.PI*2,!1),me!==1&&$.restore(),this._fillStroke($,b)}},_fillStroke:function(b,I){var $=I.options;$.fill&&(b.globalAlpha=$.fillOpacity,b.fillStyle=$.fillColor||$.color,b.fill($.fillRule||"evenodd")),$.stroke&&$.weight!==0&&(b.setLineDash&&b.setLineDash(I.options&&I.options._dashArray||[]),b.globalAlpha=$.opacity,b.lineWidth=$.weight,b.strokeStyle=$.color,b.lineCap=$.lineCap,b.lineJoin=$.lineJoin,b.stroke())},_onClick:function(b){for(var I=this._map.mouseEventToLayerPoint(b),$,te,me=this._drawFirst;me;me=me.next)$=me.layer,$.options.interactive&&$._containsPoint(I)&&(!(b.type==="click"||b.type==="preclick")||!this._map._draggableMoved($))&&(te=$);this._fireEvent(te?[te]:!1,b)},_onMouseMove:function(b){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var I=this._map.mouseEventToLayerPoint(b);this._handleMouseHover(b,I)}},_handleMouseOut:function(b){var I=this._hoveredLayer;I&&(ka(this._container,"leaflet-interactive"),this._fireEvent([I],b,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(b,I){if(!this._mouseHoverThrottled){for(var $,te,me=this._drawFirst;me;me=me.next)$=me.layer,$.options.interactive&&$._containsPoint(I)&&(te=$);te!==this._hoveredLayer&&(this._handleMouseOut(b),te&&(zn(this._container,"leaflet-interactive"),this._fireEvent([te],b,"mouseover"),this._hoveredLayer=te)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,b),this._mouseHoverThrottled=!0,setTimeout(S(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(b,I,$){this._map._fireDOMEvent(I,$||I.type,b)},_bringToFront:function(b){var I=b._order;if(I){var $=I.next,te=I.prev;if($)$.prev=te;else return;te?te.next=$:$&&(this._drawFirst=$),I.prev=this._drawLast,this._drawLast.next=I,I.next=null,this._drawLast=I,this._requestRedraw(b)}},_bringToBack:function(b){var I=b._order;if(I){var $=I.next,te=I.prev;if(te)te.next=$;else return;$?$.prev=te:te&&(this._drawLast=te),I.prev=null,I.next=this._drawFirst,this._drawFirst.prev=I,this._drawFirst=I,this._requestRedraw(b)}}});function tu(b){return Si.canvas?new Js(b):null}var Xt=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(b){return document.createElement("<lvml:"+b+' class="lvml">')}}catch{}return function(b){return document.createElement("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),iu={_initContainer:function(){this._container=fn("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Fo.prototype._update.call(this),this.fire("update"))},_initPath:function(b){var I=b._container=Xt("shape");zn(I,"leaflet-vml-shape "+(this.options.className||"")),I.coordsize="1 1",b._path=Xt("path"),I.appendChild(b._path),this._updateStyle(b),this._layers[M(b)]=b},_addPath:function(b){var I=b._container;this._container.appendChild(I),b.options.interactive&&b.addInteractiveTarget(I)},_removePath:function(b){var I=b._container;an(I),b.removeInteractiveTarget(I),delete this._layers[M(b)]},_updateStyle:function(b){var I=b._stroke,$=b._fill,te=b.options,me=b._container;me.stroked=!!te.stroke,me.filled=!!te.fill,te.stroke?(I||(I=b._stroke=Xt("stroke")),me.appendChild(I),I.weight=te.weight+"px",I.color=te.color,I.opacity=te.opacity,te.dashArray?I.dashStyle=Ee(te.dashArray)?te.dashArray.join(" "):te.dashArray.replace(/( *, *)/g," "):I.dashStyle="",I.endcap=te.lineCap.replace("butt","flat"),I.joinstyle=te.lineJoin):I&&(me.removeChild(I),b._stroke=null),te.fill?($||($=b._fill=Xt("fill")),me.appendChild($),$.color=te.fillColor||te.color,$.opacity=te.fillOpacity):$&&(me.removeChild($),b._fill=null)},_updateCircle:function(b){var I=b._point.round(),$=Math.round(b._radius),te=Math.round(b._radiusY||$);this._setPath(b,b._empty()?"M0 0":"AL "+I.x+","+I.y+" "+$+","+te+" 0,"+65535*360)},_setPath:function(b,I){b._path.v=I},_bringToFront:function(b){ra(b._container)},_bringToBack:function(b){Sn(b._container)}},nu=Si.vml?Xt:hn,Nl=Fo.extend({_initContainer:function(){this._container=nu("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=nu("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){an(this._container),ar(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Fo.prototype._update.call(this);var b=this._bounds,I=b.getSize(),$=this._container;(!this._svgSize||!this._svgSize.equals(I))&&(this._svgSize=I,$.setAttribute("width",I.x),$.setAttribute("height",I.y)),xa($,b.min),$.setAttribute("viewBox",[b.min.x,b.min.y,I.x,I.y].join(" ")),this.fire("update")}},_initPath:function(b){var I=b._path=nu("path");b.options.className&&zn(I,b.options.className),b.options.interactive&&zn(I,"leaflet-interactive"),this._updateStyle(b),this._layers[M(b)]=b},_addPath:function(b){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(b._path),b.addInteractiveTarget(b._path)},_removePath:function(b){an(b._path),b.removeInteractiveTarget(b._path),delete this._layers[M(b)]},_updatePath:function(b){b._project(),b._update()},_updateStyle:function(b){var I=b._path,$=b.options;I&&($.stroke?(I.setAttribute("stroke",$.color),I.setAttribute("stroke-opacity",$.opacity),I.setAttribute("stroke-width",$.weight),I.setAttribute("stroke-linecap",$.lineCap),I.setAttribute("stroke-linejoin",$.lineJoin),$.dashArray?I.setAttribute("stroke-dasharray",$.dashArray):I.removeAttribute("stroke-dasharray"),$.dashOffset?I.setAttribute("stroke-dashoffset",$.dashOffset):I.removeAttribute("stroke-dashoffset")):I.setAttribute("stroke","none"),$.fill?(I.setAttribute("fill",$.fillColor||$.color),I.setAttribute("fill-opacity",$.fillOpacity),I.setAttribute("fill-rule",$.fillRule||"evenodd")):I.setAttribute("fill","none"))},_updatePoly:function(b,I){this._setPath(b,ln(b._parts,I))},_updateCircle:function(b){var I=b._point,$=Math.max(Math.round(b._radius),1),te=Math.max(Math.round(b._radiusY),1)||$,me="a"+$+","+te+" 0 1,0 ",Le=b._empty()?"M0 0":"M"+(I.x-$)+","+I.y+me+$*2+",0 "+me+-$*2+",0 ";this._setPath(b,Le)},_setPath:function(b,I){b._path.setAttribute("d",I)},_bringToFront:function(b){ra(b._path)},_bringToBack:function(b){Sn(b._path)}});Si.vml&&Nl.include(iu);function xc(b){return Si.svg||Si.vml?new Nl(b):null}Aa.include({getRenderer:function(b){var I=b.options.renderer||this._getPaneRenderer(b.options.pane)||this.options.renderer||this._renderer;return I||(I=this._renderer=this._createRenderer()),this.hasLayer(I)||this.addLayer(I),I},_getPaneRenderer:function(b){if(b==="overlayPane"||b===void 0)return!1;var I=this._paneRenderers[b];return I===void 0&&(I=this._createRenderer({pane:b}),this._paneRenderers[b]=I),I},_createRenderer:function(b){return this.options.preferCanvas&&tu(b)||xc(b)}});var od=yc.extend({initialize:function(b,I){yc.prototype.initialize.call(this,this._boundsToLatLngs(b),I)},setBounds:function(b){return this.setLatLngs(this._boundsToLatLngs(b))},_boundsToLatLngs:function(b){return b=oi(b),[b.getSouthWest(),b.getNorthWest(),b.getNorthEast(),b.getSouthEast()]}});function es(b,I){return new od(b,I)}Nl.create=nu,Nl.pointsToPath=ln,oo.geometryToLayer=Ir,oo.coordsToLatLng=No,oo.coordsToLatLngs=Au,oo.latLngToCoords=_l,oo.latLngsToCoords=wo,oo.getFeature=So,oo.asFeature=ad,Aa.mergeOptions({boxZoom:!0});var ld=hl.extend({initialize:function(b){this._map=b,this._container=b._container,this._pane=b._panes.overlayPane,this._resetStateTimeout=0,b.on("unload",this._destroy,this)},addHooks:function(){sa(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ar(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){an(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(b){if(!b.shiftKey||b.which!==1&&b.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),_o(),fc(),this._startPoint=this._map.mouseEventToContainerPoint(b),sa(document,{contextmenu:Do,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(b){this._moved||(this._moved=!0,this._box=fn("div","leaflet-zoom-box",this._container),zn(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(b);var I=new _t(this._point,this._startPoint),$=I.getSize();xa(this._box,I.min),this._box.style.width=$.x+"px",this._box.style.height=$.y+"px"},_finish:function(){this._moved&&(an(this._box),ka(this._container,"leaflet-crosshair")),Vc(),dl(),ar(document,{contextmenu:Do,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(b){if(!(b.which!==1&&b.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(S(this._resetState,this),0);var I=new Ct(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(I).fire("boxzoomend",{boxZoomBounds:I})}},_onKeyDown:function(b){b.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Aa.addInitHook("addHandler","boxZoom",ld),Aa.mergeOptions({doubleClickZoom:!0});var lo=hl.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(b){var I=this._map,$=I.getZoom(),te=I.options.zoomDelta,me=b.originalEvent.shiftKey?$-te:$+te;I.options.doubleClickZoom==="center"?I.setZoom(me):I.setZoomAround(b.containerPoint,me)}});Aa.addInitHook("addHandler","doubleClickZoom",lo),Aa.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var bc=hl.extend({addHooks:function(){if(!this._draggable){var b=this._map;this._draggable=new $i(b._mapPane,b._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),b.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),b.on("zoomend",this._onZoomEnd,this),b.whenReady(this._onZoomEnd,this))}zn(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){ka(this._map._container,"leaflet-grab"),ka(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var b=this._map;if(b._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var I=oi(this._map.options.maxBounds);this._offsetLimit=At(this._map.latLngToContainerPoint(I.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(I.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;b.fire("movestart").fire("dragstart"),b.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(b){if(this._map.options.inertia){var I=this._lastTime=+new Date,$=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push($),this._times.push(I),this._prunePositions(I)}this._map.fire("move",b).fire("drag",b)},_prunePositions:function(b){for(;this._positions.length>1&&b-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var b=this._map.getSize().divideBy(2),I=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=I.subtract(b).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(b,I){return b-(b-I)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var b=this._draggable._newPos.subtract(this._draggable._startPos),I=this._offsetLimit;b.x<I.min.x&&(b.x=this._viscousLimit(b.x,I.min.x)),b.y<I.min.y&&(b.y=this._viscousLimit(b.y,I.min.y)),b.x>I.max.x&&(b.x=this._viscousLimit(b.x,I.max.x)),b.y>I.max.y&&(b.y=this._viscousLimit(b.y,I.max.y)),this._draggable._newPos=this._draggable._startPos.add(b)}},_onPreDragWrap:function(){var b=this._worldWidth,I=Math.round(b/2),$=this._initialWorldOffset,te=this._draggable._newPos.x,me=(te-I+$)%b+I-$,Le=(te+I+$)%b-I-$,ut=Math.abs(me+$)<Math.abs(Le+$)?me:Le;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=ut},_onDragEnd:function(b){var I=this._map,$=I.options,te=!$.inertia||b.noInertia||this._times.length<2;if(I.fire("dragend",b),te)I.fire("moveend");else{this._prunePositions(+new Date);var me=this._lastPos.subtract(this._positions[0]),Le=(this._lastTime-this._times[0])/1e3,ut=$.easeLinearity,Bt=me.multiplyBy(ut/Le),It=Bt.distanceTo([0,0]),ji=Math.min($.inertiaMaxSpeed,It),cn=Bt.multiplyBy(ji/It),vn=ji/($.inertiaDeceleration*ut),En=cn.multiplyBy(-vn/2).round();!En.x&&!En.y?I.fire("moveend"):(En=I._limitOffset(En,I.options.maxBounds),gt(function(){I.panBy(En,{duration:vn,easeLinearity:ut,noMoveStart:!0,animate:!0})}))}}});Aa.addInitHook("addHandler","dragging",bc),Aa.mergeOptions({keyboard:!0,keyboardPanDelta:80});var xl=hl.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(b){this._map=b,this._setPanDelta(b.options.keyboardPanDelta),this._setZoomDelta(b.options.zoomDelta)},addHooks:function(){var b=this._map._container;b.tabIndex<=0&&(b.tabIndex="0"),sa(b,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ar(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var b=document.body,I=document.documentElement,$=b.scrollTop||I.scrollTop,te=b.scrollLeft||I.scrollLeft;this._map._container.focus(),window.scrollTo(te,$)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(b){var I=this._panKeys={},$=this.keyCodes,te,me;for(te=0,me=$.left.length;te<me;te++)I[$.left[te]]=[-1*b,0];for(te=0,me=$.right.length;te<me;te++)I[$.right[te]]=[b,0];for(te=0,me=$.down.length;te<me;te++)I[$.down[te]]=[0,b];for(te=0,me=$.up.length;te<me;te++)I[$.up[te]]=[0,-1*b]},_setZoomDelta:function(b){var I=this._zoomKeys={},$=this.keyCodes,te,me;for(te=0,me=$.zoomIn.length;te<me;te++)I[$.zoomIn[te]]=b;for(te=0,me=$.zoomOut.length;te<me;te++)I[$.zoomOut[te]]=-b},_addHooks:function(){sa(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ar(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(b){if(!(b.altKey||b.ctrlKey||b.metaKey)){var I=b.keyCode,$=this._map,te;if(I in this._panKeys){if(!$._panAnim||!$._panAnim._inProgress)if(te=this._panKeys[I],b.shiftKey&&(te=Ce(te).multiplyBy(3)),$.options.maxBounds&&(te=$._limitOffset(Ce(te),$.options.maxBounds)),$.options.worldCopyJump){var me=$.wrapLatLng($.unproject($.project($.getCenter()).add(te)));$.panTo(me)}else $.panBy(te)}else if(I in this._zoomKeys)$.setZoom($.getZoom()+(b.shiftKey?3:1)*this._zoomKeys[I]);else if(I===27&&$._popup&&$._popup.options.closeOnEscapeKey)$.closePopup();else return;Do(b)}}});Aa.addInitHook("addHandler","keyboard",xl),Aa.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Fl=hl.extend({addHooks:function(){sa(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ar(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(b){var I=Yu(b),$=this._map.options.wheelDebounceTime;this._delta+=I,this._lastMousePos=this._map.mouseEventToContainerPoint(b),this._startTime||(this._startTime=+new Date);var te=Math.max($-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(S(this._performZoom,this),te),Do(b)},_performZoom:function(){var b=this._map,I=b.getZoom(),$=this._map.options.zoomSnap||0;b._stop();var te=this._delta/(this._map.options.wheelPxPerZoomLevel*4),me=4*Math.log(2/(1+Math.exp(-Math.abs(te))))/Math.LN2,Le=$?Math.ceil(me/$)*$:me,ut=b._limitZoom(I+(this._delta>0?Le:-Le))-I;this._delta=0,this._startTime=null,ut&&(b.options.scrollWheelZoom==="center"?b.setZoom(I+ut):b.setZoomAround(this._lastMousePos,I+ut))}});Aa.addInitHook("addHandler","scrollWheelZoom",Fl);var Mh=600;Aa.mergeOptions({tapHold:Si.touchNative&&Si.safari&&Si.mobile,tapTolerance:15});var Mu=hl.extend({addHooks:function(){sa(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ar(this._map._container,"touchstart",this._onDown,this)},_onDown:function(b){if(clearTimeout(this._holdTimeout),b.touches.length===1){var I=b.touches[0];this._startPos=this._newPos=new jt(I.clientX,I.clientY),this._holdTimeout=setTimeout(S(function(){this._cancel(),this._isTapValid()&&(sa(document,"touchend",os),sa(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",I))},this),Mh),sa(document,"touchend touchcancel contextmenu",this._cancel,this),sa(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function b(){ar(document,"touchend",os),ar(document,"touchend touchcancel",b)},_cancel:function(){clearTimeout(this._holdTimeout),ar(document,"touchend touchcancel contextmenu",this._cancel,this),ar(document,"touchmove",this._onMove,this)},_onMove:function(b){var I=b.touches[0];this._newPos=new jt(I.clientX,I.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(b,I){var $=new MouseEvent(b,{bubbles:!0,cancelable:!0,view:window,screenX:I.screenX,screenY:I.screenY,clientX:I.clientX,clientY:I.clientY});$._simulated=!0,I.target.dispatchEvent($)}});Aa.addInitHook("addHandler","tapHold",Mu),Aa.mergeOptions({touchZoom:Si.touch,bounceAtZoomLimits:!0});var Pu=hl.extend({addHooks:function(){zn(this._map._container,"leaflet-touch-zoom"),sa(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){ka(this._map._container,"leaflet-touch-zoom"),ar(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(b){var I=this._map;if(!(!b.touches||b.touches.length!==2||I._animatingZoom||this._zooming)){var $=I.mouseEventToContainerPoint(b.touches[0]),te=I.mouseEventToContainerPoint(b.touches[1]);this._centerPoint=I.getSize()._divideBy(2),this._startLatLng=I.containerPointToLatLng(this._centerPoint),I.options.touchZoom!=="center"&&(this._pinchStartLatLng=I.containerPointToLatLng($.add(te)._divideBy(2))),this._startDist=$.distanceTo(te),this._startZoom=I.getZoom(),this._moved=!1,this._zooming=!0,I._stop(),sa(document,"touchmove",this._onTouchMove,this),sa(document,"touchend touchcancel",this._onTouchEnd,this),os(b)}},_onTouchMove:function(b){if(!(!b.touches||b.touches.length!==2||!this._zooming)){var I=this._map,$=I.mouseEventToContainerPoint(b.touches[0]),te=I.mouseEventToContainerPoint(b.touches[1]),me=$.distanceTo(te)/this._startDist;if(this._zoom=I.getScaleZoom(me,this._startZoom),!I.options.bounceAtZoomLimits&&(this._zoom<I.getMinZoom()&&me<1||this._zoom>I.getMaxZoom()&&me>1)&&(this._zoom=I._limitZoom(this._zoom)),I.options.touchZoom==="center"){if(this._center=this._startLatLng,me===1)return}else{var Le=$._add(te)._divideBy(2)._subtract(this._centerPoint);if(me===1&&Le.x===0&&Le.y===0)return;this._center=I.unproject(I.project(this._pinchStartLatLng,this._zoom).subtract(Le),this._zoom)}this._moved||(I._moveStart(!0,!1),this._moved=!0),ni(this._animRequest);var ut=S(I._move,I,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=gt(ut,this,!0),os(b)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ni(this._animRequest),ar(document,"touchmove",this._onTouchMove,this),ar(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Aa.addInitHook("addHandler","touchZoom",Pu),Aa.BoxZoom=ld,Aa.DoubleClickZoom=lo,Aa.Drag=bc,Aa.Keyboard=xl,Aa.ScrollWheelZoom=Fl,Aa.TapHold=Mu,Aa.TouchZoom=Pu,c.Bounds=_t,c.Browser=Si,c.CRS=Ba,c.Canvas=Js,c.Circle=id,c.CircleMarker=Ki,c.Class=Vi,c.Control=Xs,c.DivIcon=sd,c.DivOverlay=vl,c.DomEvent=qc,c.DomUtil=Hc,c.Draggable=$i,c.Evented=Et,c.FeatureGroup=Br,c.GeoJSON=oo,c.GridLayer=Ol,c.Handler=hl,c.Icon=wr,c.ImageOverlay=Ds,c.LatLng=Ci,c.LatLngBounds=Ct,c.Layer=Ks,c.LayerGroup=ml,c.LineUtil=Qu,c.Map=Aa,c.Marker=sn,c.Mixin=Em,c.Path=gl,c.Point=jt,c.PolyUtil=Ju,c.Polygon=yc,c.Polyline=Rs,c.Popup=Cu,c.PosAnimation=Wc,c.Projection=$d,c.Rectangle=od,c.Renderer=Fo,c.SVG=Nl,c.SVGOverlay=Kc,c.TileLayer=Qc,c.Tooltip=Vd,c.Transformation=Ja,c.Util=Ft,c.VideoOverlay=Ah,c.bind=S,c.bounds=At,c.canvas=tu,c.circle=en,c.circleMarker=Eu,c.control=bo,c.divIcon=vc,c.extend=p,c.featureGroup=Qo,c.geoJSON=Yc,c.geoJson=rd,c.gridLayer=Qr,c.icon=td,c.imageOverlay=el,c.latLng=li,c.latLngBounds=oi,c.layerGroup=Hr,c.map=Tu,c.marker=Pi,c.point=Ce,c.polygon=Sr,c.polyline=Sf,c.popup=Jc,c.rectangle=es,c.setOptions=ae,c.stamp=M,c.svg=xc,c.svgOverlay=Tf,c.tileLayer=Ls,c.tooltip=Am,c.transformation=Qi,c.version=h,c.videoOverlay=Ch;var ju=window.L;c.noConflict=function(){return window.L=ju,this},window.L=c}))})($v,$v.exports)),$v.exports}var lF=oF();const qu=Cb(lF);function j0(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var BE={},UE;function cF(){return UE||(UE=1,(function(){function o(r,c,h){function p(i,M){if(!c[i]){if(!r[i]){var P=typeof j0=="function"&&j0;if(!M&&P)return P(i,!0);if(x)return x(i,!0);var N=new Error("Cannot find module '"+i+"'");throw N.code="MODULE_NOT_FOUND",N}var H=c[i]={exports:{}};r[i][0].call(H.exports,function(W){var K=r[i][1][W];return p(K||W)},H,H.exports,o,r,c,h)}return c[i].exports}for(var x=typeof j0=="function"&&j0,S=0;S<h.length;S++)p(h[S]);return p}return o})()({1:[function(o,r,c){function h(p,x,S){var i=!1;if(typeof window.XMLHttpRequest>"u")return x(Error("Browser not supported"));if(typeof S>"u"){var M=p.match(/^\s*https?:\/\/[^\/]*/);S=M&&M[0]!==location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}var P=new window.XMLHttpRequest;function N(K){return K>=200&&K<300||K===304}if(S&&!("withCredentials"in P)){P=new window.XDomainRequest;var H=x;x=function(){if(i)H.apply(this,arguments);else{var K=this,re=arguments;setTimeout(function(){H.apply(K,re)},0)}}}function W(){P.status===void 0||N(P.status)?x.call(P,null,P):x.call(P,P,null)}return"onload"in P?P.onload=W:P.onreadystatechange=function(){P.readyState===4&&W()},P.onerror=function(re){x.call(this,re||!0,null),x=function(){}},P.onprogress=function(){},P.ontimeout=function(K){x.call(this,K,null),x=function(){}},P.onabort=function(K){x.call(this,K,null),x=function(){}},P.open("GET",p,!0),P.send(null),i=!0,P}typeof r<"u"&&(r.exports=h)},{}],2:[function(o,r,c){var h={};function p(i){return Math.floor(Math.abs(i)+.5)*Math.sign(i)}function x(i,M,P){i=p(i*P),M=p(M*P);var N=i-M;N<<=1,i-M<0&&(N=~N);for(var H="";N>=32;)H+=String.fromCharCode((32|N&31)+63),N>>=5;return H+=String.fromCharCode(N+63),H}h.decode=function(i,M){for(var P=0,N=0,H=0,W=[],K=0,re=0,ae=null,ce,ve,Se=Math.pow(10,M||5);P<i.length;){ae=null,K=0,re=0;do ae=i.charCodeAt(P++)-63,re|=(ae&31)<<K,K+=5;while(ae>=32);ce=re&1?~(re>>1):re>>1,K=re=0;do ae=i.charCodeAt(P++)-63,re|=(ae&31)<<K,K+=5;while(ae>=32);ve=re&1?~(re>>1):re>>1,N+=ce,H+=ve,W.push([N/Se,H/Se])}return W},h.encode=function(i,M){if(!i.length)return"";for(var P=Math.pow(10,M||5),N=x(i[0][0],0,P)+x(i[0][1],0,P),H=1;H<i.length;H++){var W=i[H],K=i[H-1];N+=x(W[0],K[0],P),N+=x(W[1],K[1],P)}return N};function S(i){for(var M=[],P=0;P<i.length;P++)M.push(i[P].slice().reverse());return M}h.fromGeoJSON=function(i,M){if(i&&i.type==="Feature"&&(i=i.geometry),!i||i.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return h.encode(S(i.coordinates),M)},h.toGeoJSON=function(i,M){var P=h.decode(i,M);return{type:"LineString",coordinates:S(P)}},typeof r=="object"&&r.exports&&(r.exports=h)},{}],3:[function(o,r,c){var h=o("./languages"),p=h.instructions,x=h.grammars,S=h.abbreviations;r.exports=function(i){return Object.keys(p).forEach(function(M){if(!p[M][i])throw"invalid version "+i+": "+M+" not supported"}),{capitalizeFirstLetter:function(M,P){return P.charAt(0).toLocaleUpperCase(M)+P.slice(1)},ordinalize:function(M,P){if(!M)throw new Error("No language code provided");return p[M][i].constants.ordinalize[P.toString()]||""},directionFromDegree:function(M,P){if(!M)throw new Error("No language code provided");if(!P&&P!==0)return"";if(P>=0&&P<=20)return p[M][i].constants.direction.north;if(P>20&&P<70)return p[M][i].constants.direction.northeast;if(P>=70&&P<=110)return p[M][i].constants.direction.east;if(P>110&&P<160)return p[M][i].constants.direction.southeast;if(P>=160&&P<=200)return p[M][i].constants.direction.south;if(P>200&&P<250)return p[M][i].constants.direction.southwest;if(P>=250&&P<=290)return p[M][i].constants.direction.west;if(P>290&&P<340)return p[M][i].constants.direction.northwest;if(P>=340&&P<=360)return p[M][i].constants.direction.north;throw new Error("Degree "+P+" invalid")},laneConfig:function(M){if(!M.intersections||!M.intersections[0].lanes)throw new Error("No lanes object");var P=[],N=null;return M.intersections[0].lanes.forEach(function(H){(N===null||N!==H.valid)&&(H.valid?P.push("o"):P.push("x"),N=H.valid)}),P.join("")},getWayName:function(M,P,N){var H=N?N.classes||[]:[];if(typeof P!="object")throw new Error("step must be an Object");if(!M)throw new Error("No language code provided");if(!Array.isArray(H))throw new Error("classes must be an Array or undefined");var W,K=P.name||"",re=(P.ref||"").split(";")[0];K===P.ref&&(K=""),K=K.replace(" ("+P.ref+")","");var ae=H.indexOf("motorway")!==-1;if(K&&re&&K!==re&&!ae){var ce=p[M][i].phrase["name and ref"]||p.en[i].phrase["name and ref"];W=this.tokenize(M,ce,{name:K,ref:re},N)}else K&&re&&ae&&/\d/.test(re)||!K&&re?W=N&&N.formatToken?N.formatToken("ref",re):re:W=N&&N.formatToken?N.formatToken("name",K):K;return W},compile:function(M,P,N){if(!M)throw new Error("No language code provided");if(h.supportedCodes.indexOf(M)===-1)throw new Error("language code "+M+" not loaded");if(!P.maneuver)throw new Error("No step maneuver provided");var H=N||{},W=P.maneuver.type,K=P.maneuver.modifier,re=P.mode,ae=P.driving_side;if(!W)throw new Error("Missing step maneuver type");if(W!=="depart"&&W!=="arrive"&&!K)throw new Error("Missing step maneuver modifier");p[M][i][W]||(console.log("Encountered unknown instruction type: "+W),W="turn");var ce;if(p[M][i].modes[re])ce=p[M][i].modes[re];else{var ve=W==="off ramp"&&K.indexOf(ae)>=0;p[M][i][W][K]&&!ve?ce=p[M][i][W][K]:ce=p[M][i][W].default}var Se;switch(W){case"use lane":Se=p[M][i].constants.lanes[this.laneConfig(P)],Se||(ce=p[M][i]["use lane"].no_lanes);break;case"rotary":case"roundabout":P.rotary_name&&P.maneuver.exit&&ce.name_exit?ce=ce.name_exit:P.rotary_name&&ce.name?ce=ce.name:P.maneuver.exit&&ce.exit?ce=ce.exit:ce=ce.default;break}var Ee=this.getWayName(M,P,H),Qe;P.destinations&&P.exits&&ce.exit_destination?Qe=ce.exit_destination:P.destinations&&ce.destination?Qe=ce.destination:P.exits&&ce.exit?Qe=ce.exit:Ee&&ce.name?Qe=ce.name:H.waypointName&&ce.named?Qe=ce.named:Qe=ce.default;var He=P.destinations&&P.destinations.split(": "),ke=He&&He[0].split(",")[0],tt=He&&He[1]&&He[1].split(",")[0],Ke;tt&&ke?Ke=ke+": "+tt:Ke=ke||tt||"";var lt=H.legIndex>=0&&H.legIndex!==H.legCount-1?this.ordinalize(M,H.legIndex+1):"",ft={way_name:Ee,destination:Ke,exit:(P.exits||"").split(";")[0],exit_number:this.ordinalize(M,P.maneuver.exit||1),rotary_name:P.rotary_name,lane_instruction:Se,modifier:p[M][i].constants.modifier[K],direction:this.directionFromDegree(M,P.maneuver.bearing_after),nth:lt,waypoint_name:H.waypointName};return this.tokenize(M,Qe,ft,H)},grammarize:function(M,P,N){if(!M)throw new Error("No language code provided");if(P&&N&&x&&x[M]&&x[M][i]){var H=x[M][i][N];if(H){var W=" "+P+" ",K=x[M].meta.regExpFlags||"";return H.forEach(function(re){var ae=new RegExp(re[0],K);W=W.replace(ae,re[1])}),W.trim()}}return P},abbreviations:S,tokenize:function(M,P,N,H){if(!M)throw new Error("No language code provided");var W=this,K=!1,re=P.replace(/\{(\w+)(?::(\w+))?\}/g,function(ae,ce,ve,Se){var Ee=N[ce];return typeof Ee>"u"?ae:(Ee=W.grammarize(M,Ee,ve),Se===0&&p[M].meta.capitalizeFirstLetter&&(K=!0,Ee=W.capitalizeFirstLetter(M,Ee)),H&&H.formatToken&&(Ee=H.formatToken(ce,Ee)),Ee)}).replace(/ {2}/g," ");return!K&&p[M].meta.capitalizeFirstLetter?this.capitalizeFirstLetter(M,re):re}}}},{"./languages":4}],4:[function(o,r,c){var h=o("./languages/translations/da.json"),p=o("./languages/translations/de.json"),x=o("./languages/translations/en.json"),S=o("./languages/translations/eo.json"),i=o("./languages/translations/es.json"),M=o("./languages/translations/es-ES.json"),P=o("./languages/translations/fi.json"),N=o("./languages/translations/fr.json"),H=o("./languages/translations/he.json"),W=o("./languages/translations/id.json"),K=o("./languages/translations/it.json"),re=o("./languages/translations/ko.json"),ae=o("./languages/translations/my.json"),ce=o("./languages/translations/nl.json"),ve=o("./languages/translations/no.json"),Se=o("./languages/translations/pl.json"),Ee=o("./languages/translations/pt-BR.json"),Qe=o("./languages/translations/pt-PT.json"),He=o("./languages/translations/ro.json"),ke=o("./languages/translations/ru.json"),tt=o("./languages/translations/sv.json"),Ke=o("./languages/translations/tr.json"),lt=o("./languages/translations/uk.json"),ft=o("./languages/translations/vi.json"),gt=o("./languages/translations/zh-Hans.json"),ni=o("./languages/grammar/fr.json"),Ft=o("./languages/grammar/ru.json"),Vi=o("./languages/abbreviations/bg.json"),Ri=o("./languages/abbreviations/ca.json"),We=o("./languages/abbreviations/da.json"),Et=o("./languages/abbreviations/de.json"),jt=o("./languages/abbreviations/en.json"),Gi=o("./languages/abbreviations/es.json"),Ce=o("./languages/abbreviations/fr.json"),_t=o("./languages/abbreviations/he.json"),At=o("./languages/abbreviations/hu.json"),Ct=o("./languages/abbreviations/lt.json"),oi=o("./languages/abbreviations/nl.json"),Ci=o("./languages/abbreviations/ru.json"),li=o("./languages/abbreviations/sl.json"),Ba=o("./languages/abbreviations/sv.json"),Un=o("./languages/abbreviations/uk.json"),qn=o("./languages/abbreviations/vi.json"),On={da:h,de:p,en:x,eo:S,es:i,"es-ES":M,fi:P,fr:N,he:H,id:W,it:K,ko:re,my:ae,nl:ce,no:ve,pl:Se,"pt-BR":Ee,"pt-PT":Qe,ro:He,ru:ke,sv:tt,tr:Ke,uk:lt,vi:ft,"zh-Hans":gt},Ja={fr:ni,ru:Ft},Qi={bg:Vi,ca:Ri,da:We,de:Et,en:jt,es:Gi,fr:Ce,he:_t,hu:At,lt:Ct,nl:oi,ru:Ci,sl:li,sv:Ba,uk:Un,vi:qn};r.exports={supportedCodes:Object.keys(On),instructions:On,grammars:Ja,abbreviations:Qi}},{"./languages/abbreviations/bg.json":5,"./languages/abbreviations/ca.json":6,"./languages/abbreviations/da.json":7,"./languages/abbreviations/de.json":8,"./languages/abbreviations/en.json":9,"./languages/abbreviations/es.json":10,"./languages/abbreviations/fr.json":11,"./languages/abbreviations/he.json":12,"./languages/abbreviations/hu.json":13,"./languages/abbreviations/lt.json":14,"./languages/abbreviations/nl.json":15,"./languages/abbreviations/ru.json":16,"./languages/abbreviations/sl.json":17,"./languages/abbreviations/sv.json":18,"./languages/abbreviations/uk.json":19,"./languages/abbreviations/vi.json":20,"./languages/grammar/fr.json":21,"./languages/grammar/ru.json":22,"./languages/translations/da.json":23,"./languages/translations/de.json":24,"./languages/translations/en.json":25,"./languages/translations/eo.json":26,"./languages/translations/es-ES.json":27,"./languages/translations/es.json":28,"./languages/translations/fi.json":29,"./languages/translations/fr.json":30,"./languages/translations/he.json":31,"./languages/translations/id.json":32,"./languages/translations/it.json":33,"./languages/translations/ko.json":34,"./languages/translations/my.json":35,"./languages/translations/nl.json":36,"./languages/translations/no.json":37,"./languages/translations/pl.json":38,"./languages/translations/pt-BR.json":39,"./languages/translations/pt-PT.json":40,"./languages/translations/ro.json":41,"./languages/translations/ru.json":42,"./languages/translations/sv.json":43,"./languages/translations/tr.json":44,"./languages/translations/uk.json":45,"./languages/translations/vi.json":46,"./languages/translations/zh-Hans.json":47}],5:[function(o,r,c){r.exports={abbreviations:{:"",:"",:"",:"Mkt",:"",:"",:"",:"",:"",:"",:"-",:"",:"-",:"",:"",:"",:"",:"-",:"-",:"-",:"",:"",:"",:"",:"",:".",:"",:"",:"-",:"",:""},classifications:{:"",:"",:"",:"",:"-",:"",:"",:"-",:"-",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},directions:{:"",:"",:"",:"",:"",:"",:""}}},{}],6:[function(o,r,c){r.exports={abbreviations:{comunicacions:"Com.","entitat de poblaci":"Nucli",disseminat:"Diss.","cap de municipi":"Cap",indret:"Indr.",comarca:"Cca.","relleu del litoral":"Lit.",municipi:"Mun.","xarxa hidrogrfica":"Curs Fluv.",equipament:"Equip.",orografia:"Orogr.",barri:"Barri",edificaci:"Edif.","edificaci histrica":"Edif. Hist.","entitat descentralitzada":"E.M.D.","element hidrogrfic":"Hidr."},classifications:{rotonda:"Rot.",carrerada:"Ca.",jard:"J.",paratge:"Pge.",pont:"Pont",lloc:"Lloc",rambla:"Rbla.",cases:"Cses.",barranc:"Bnc.",plana:"Plana",polgon:"Pol.",muralla:"Mur.",enlla:"Ella","antiga carretera":"Actra",glorieta:"Glor.",autovia:"Autv.",prolongaci:"Prol.",calada:"Cda.",carretera:"Ctra.",pujada:"Pda.",torrent:"T.",disseminat:"Disse",barri:"B.",cintur:"Cinto",passera:"Psera",sender:"Send.",carrer:"C.",squia:"Sq.",blocs:"Bloc",rambleta:"Rblt.",partida:"Par.",costa:"Cos.",sector:"Sec.",corral:"Crral",urbanitzaci:"Urb.",autopista:"Autp.",grup:"Gr.",platja:"Pja.",jardins:"J.",complex:"Comp.",portals:"Ptals",finca:"Fin.",travessera:"Trav.",plaa:"Pl.",travessia:"Trv.","polgon industrial":"PI.",passatge:"Ptge.",apartaments:"Apmt.",mirador:"Mira.",antic:"Antic",accs:"Acc.",colnia:"Col.",corriol:"Crol.",portal:"Ptal.",porta:"Pta.",port:"Port",carrer:"Cr.",riera:"Ra.","circumvallaci":"Cval.",baixada:"Bda.",placeta:"Plta.",escala:"Esc.","gran via":"GV",rial:"Rial",conjunt:"Conj.",avinguda:"Av.",esplanada:"Esp.",cantonada:"Cant.",ronda:"Rda.",corredor:"Cdor.",drecera:"Drec.",passads:"Pds.",viaducte:"Vdct.",passeig:"Pg.",venat:"Ve."},directions:{sudest:"SE",sudoest:"SO",nordest:"NE",nordoest:"NO",est:"E",nord:"N",oest:"O",sud:"S"}}},{}],7:[function(o,r,c){r.exports={abbreviations:{skole:"Sk.",ved:"v.",centrum:"C.",sankt:"Skt.",vestre:"v.",hospital:"Hosp.",strde:"Str.",nordre:"Nr.",plads:"Pl.",universitet:"Uni.",vnge:"vg.",station:"St."},classifications:{avenue:"Ave",gammel:"Gl.",dronning:"Dronn.",snder:"Sdr.",nrre:"Nr.",vester:"V.",vestre:"V.",ster:".",stre:".",boulevard:"Boul."},directions:{sydst:"S",nordvest:"NV",syd:"S",nordst:"N",sydvest:"SV",vest:"V",nord:"N",st:""}}},{}],8:[function(o,r,c){r.exports={abbreviations:{},classifications:{},directions:{osten:"O",nordosten:"NO",sden:"S",nordwest:"NW",norden:"N",sdost:"SO",sdwest:"SW",westen:"W"}}},{}],9:[function(o,r,c){r.exports={abbreviations:{square:"Sq",centre:"Ctr",sister:"Sr",lake:"Lk",fort:"Ft",route:"Rte",william:"Wm",national:"Natl",junction:"Jct",center:"Ctr",saint:"St",saints:"SS",station:"Sta",mount:"Mt",junior:"Jr",mountain:"Mtn",heights:"Hts",university:"Univ",school:"Sch",international:"Intl",apartments:"Apts",crossing:"Xing",creek:"Crk",township:"Twp",downtown:"Dtwn",father:"Fr",senior:"Sr",point:"Pt",river:"Riv",market:"Mkt",village:"Vil",park:"Pk",memorial:"Mem"},classifications:{place:"Pl",circle:"Cir",bypass:"Byp",motorway:"Mwy",crescent:"Cres",road:"Rd",cove:"Cv",lane:"Ln",square:"Sq",street:"St",freeway:"Fwy",walk:"Wk",plaza:"Plz",parkway:"Pky",avenue:"Ave",pike:"Pk",drive:"Dr",highway:"Hwy",footway:"Ftwy",point:"Pt",court:"Ct",terrace:"Ter",walkway:"Wky",alley:"Aly",expressway:"Expy",bridge:"Br",boulevard:"Blvd",turnpike:"Tpk"},directions:{southeast:"SE",northwest:"NW",south:"S",west:"W",southwest:"SW",north:"N",east:"E",northeast:"NE"}}},{}],10:[function(o,r,c){r.exports={abbreviations:{segunda:"2",octubre:"8bre",doctores:"Drs",doctora:"Dra",internacional:"Intl",doctor:"Dr",segundo:"2",seorita:"Srta",doctoras:"Drs",primera:"1",primero:"1",san:"S",colonia:"Col",doa:"Da",septiembre:"7bre",diciembre:"10bre",seor:"Sr",ayuntamiento:"Ayto",seora:"Sra",tercera:"3",tercero:"3",don:"D",santa:"Sta",ciudad:"Cdad",noviembre:"9bre",departamento:"Dep"},classifications:{camino:"Cmno",avenida:"Av",paseo:"P",autopista:"Auto",calle:"C",plaza:"Pza",carretera:"Crta"},directions:{este:"E",noreste:"NE",sur:"S",suroeste:"SO",noroeste:"NO",oeste:"O",sureste:"SE",norte:"N"}}},{}],11:[function(o,r,c){r.exports={abbreviations:{alle:"All",arodrome:"Arod",aroport:"Arop"},classifications:{centrale:"Ctrale",campings:"Camp.",urbains:"Urb.",mineure:"Min.",publique:"Publ.",suprieur:"Sup.",fdration:"Fd.","notre-dame":"ND",saint:"St","centre hospitalier rgional":"CHR",exploitation:"Exploit.",gnral:"Gal",civiles:"Civ.",maritimes:"Marit.",aviation:"Aviat.",iii:"3",archologique:"Archo.",musical:"Music.",musicale:"Music.",immeuble:"Imm.",xv:"15",htel:"Ht.",alpine:"Alp.",communale:"Commun.",v:"5",global:"Glob.",universit:"Univ.",confdral:"Confd.",xx:"20",x:"10",piscine:"Pisc.",dimanche:"di.",fleuve:"Flv",postaux:"Post.",musicienne:"Music.",dpartement:"Dpt",fvrier:"Fvr.",municipales:"Munic.",province:"Prov.",communauts:"Commts",barrage:"Barr.",mercredi:"me.",prsidentes:"Pdtes",caftrias:"Caft.",thtral:"Th.",viticulteur:"Vitic.",poste:"Post.",spcialise:"Spc.",agriculture:"Agric.",infirmier:"Infirm.",animation:"Anim.",mondiale:"Mond.",arrt:"Arr.",zone:"zon.",municipaux:"Munic.",grand:"Gd",janvier:"Janv.",fondateur:"Fond.",premire:"1re",municipale:"Munic.",direction:"Dir.",anonyme:"Anon.",dpartementale:"Dpt",moyens:"Moy.",novembre:"Nov.",jardin:"Jard.",petites:"Pet.",priv:"Priv.",centres:"Ctres",forestier:"Forest.",xiv:"14",africaines:"Afric.",sergent:"Sgt",europenne:"Eur.",prive:"Priv.",caf:"Cf",xix:"19",hautes:"Htes",major:"Mjr",vendredi:"ve.",municipalit:"Munic.","sous-prfecture":"Ss-prf.",spciales:"Spc.",secondaires:"Second.",viie:"7e",moyenne:"Moy.",commerciale:"Commerc.",rgion:"Rg.",amricaines:"Amr.",amricains:"Amr.",service:"Sce",professeur:"Prof.",dpartemental:"Dpt",htels:"Ht.",mondiales:"Mond.",ire:"1re",caporal:"Capo.",militaire:"Milit.","lyce d'enseignement professionnel":"LEP",adjudant:"Adj.",mdicale:"Md.",confrences:"Confr.",universelle:"Univ.",xiie:"12e",suprieures:"Sup.",naturel:"Natur.","socit nationale":"SN",hospitalier:"Hosp.",culturelle:"Cult.",amricain:"Amr.","son altesse royale":"S.A.R.",infirmire:"Infirm.",viii:"8",fondatrice:"Fond.",madame:"Mme",mtropolitain:"Mtrop.",ophtalmologues:"Ophtalmos",xviie:"18e",viiie:"8e",commerante:"Commer.","centre d'enseignement du second degr":"CES",septembre:"Sept.",agriculteur:"Agric.",xiii:"13",pontifical:"Pontif.",caftria:"Caft.",prince:"Pce",vie:"6e",archiduchesse:"Archid.",occidental:"Occ.",spectacles:"Spect.",camping:"Camp.",mtro:"M",arrondissement:"Arrond.",viticole:"Vitic.",ii:"2",sicle:"Si.",chapelles:"Chap.",centre:"Ctre","sapeur-pompiers":"Sap.-pomp.",tablissements:"tabts","socit anonyme":"SA",directeurs:"Dir.",vii:"7",culturel:"Cult.",central:"Ctral",mtropolitaine:"Mtrop.",administrations:"Admin.",amiraux:"Amir.",sur:"s/",premiers:"1ers","provence-alpes-cte d'azur":"PACA",cathdrale:"Cathd.",iv:"4",postale:"Post.",social:"Soc.",spcialis:"Spc.",district:"Distr.",technologique:"Techno.",viticoles:"Vitic.",ix:"9",protgs:"Prot.",historiques:"Hist.",sous:"s/s",national:"Nal",ambassade:"Amb.",cafs:"Cfs",agronomie:"Agro.",sapeurs:"Sap.",petits:"Pet.",monsieur:"M.",boucher:"Bouch.",restaurant:"Restau.",lyce:"Lyc.",urbaine:"Urb.",prfecture:"Prf.",districts:"Distr.",civil:"Civ.",protges:"Prot.",sapeur:"Sap.",thtre:"Th.",collge:"Coll.",mardi:"ma.",mmorial:"Mmor.",africain:"Afric.",rpublicaine:"Rpubl.",sociale:"Soc.",spcial:"Spc.",technologie:"Techno.",charcuterie:"Charc.",commerces:"Commerc.",fluviale:"Flv",parachutistes:"Para.",primaires:"Prim.",directions:"Dir.",prsidentiel:"Pdtl",nationales:"Nales",aprs:"apr.",samedi:"sa.",unit:"U.",xxiii:"23",associ:"Assoc.",lectrique:"lectr.",populaire:"Pop.",asiatique:"Asiat.",navigable:"Navig.",prsidente:"Pdte",xive:"14e",associs:"Assoc.",pompiers:"Pomp.",agricoles:"Agric.",lm:"lm.",dcembre:"Dc.","son altesse":"S.Alt.","aprs-midi":"a.-m.",mineures:"Min.",juillet:"Juil.",aviatrices:"Aviat.",fondation:"Fond.",pontificaux:"Pontif.",temple:"Tple",europennes:"Eur.",rgionale:"Rg.",informations:"Infos",mondiaux:"Mond.",infanterie:"Infant.",archologie:"Archo.",dans:"d/",hospice:"Hosp.",spectacle:"Spect.","htels-restaurants":"Ht.-Rest.","htel-restaurant":"Ht.-Rest.",hlicoptre:"hlico",xixe:"19e",cliniques:"Clin.",docteur:"Dr",secondaire:"Second.",municipal:"Munic.",gnrale:"Gale",chteau:"Cht.",commerant:"Commer.",avril:"Avr.",clinique:"Clin.",urbaines:"Urb.",navale:"Nav.",navigation:"Navig.",asiatiques:"Asiat.",pontificales:"Pontif.",administrative:"Admin.",syndicat:"Synd.",lundi:"lu.",petite:"Pet.",maritime:"Marit.",mtros:"M",enseignement:"Enseign.",fluviales:"Flv",historique:"Hist.",comts:"Cts",rsidentiel:"Rsid.",international:"Int.",suprieure:"Sup.","centre hospitalier universitaire":"CHU",confdration:"Confd.",boucherie:"Bouch.",fondatrices:"Fond.",mdicaux:"Md.",europens:"Eur.",orientaux:"Ori.",naval:"Nav.",tang:"tg",provincial:"Prov.",junior:"Jr",dpartementales:"Dpt",musique:"Musiq.",directrices:"Dir.",marchal:"Mal",civils:"Civ.",protg:"Prot.",tablissement:"tabt",trafic:"Traf.",aviateur:"Aviat.",archives:"Arch.",africains:"Afric.",maternelle:"Matern.",industrielle:"Ind.",administratif:"Admin.",oriental:"Ori.",universitaire:"Univ.",majeur:"Maj.",haute:"Hte",communal:"Commun.",petit:"Pet.",commune:"Commun.",exploitant:"Exploit.",confrence:"Confr.",monseigneur:"Mgr",pharmacien:"Pharm.",jeudi:"je.",primaire:"Prim.",hlicoptres:"hlicos",agronomique:"Agro.",mdecin:"Md.",ve:"5e",pontificale:"Pontif.",ier:"1er",cinma:"Cin",fluvial:"Flv",occidentaux:"Occ.",commerants:"Commer.",banque:"Bq",moyennes:"Moy.",pharmacienne:"Pharm.",dmocratique:"Dm.",cinmas:"Cins",spciale:"Spc.",prsidents:"Pdts",directrice:"Dir.",vi:"6",basse:"Bas.",xve:"15e",tat:".",aviateurs:"Aviat.",majeurs:"Maj.",infirmiers:"Infirm.",glise:"gl.",confdrale:"Confd.",xxie:"21e",comte:"Cte",europen:"Eur.",union:"U.",pharmacie:"Pharm.",infirmires:"Infirm.",comt:"Ct",sportive:"Sport.",deuxime:"2e",xvi:"17",haut:"Ht",mdicales:"Md.",dvelopp:"Dvelop.",btiment:"Bt.",commerce:"Commerc.",ive:"4e",associatif:"Assoc.",rural:"Rur.",cimetire:"Cim.",rgional:"Rg.",ferroviaire:"Ferr.",vers:"v/",mosque:"Mosq.",mineurs:"Min.",nautique:"Naut.",chteaux:"Cht.",sportif:"Sport.",mademoiselle:"Mle",cole:"c.",doyen:"Doy.",industriel:"Ind.",chapelle:"Chap.",socits:"Sts",internationale:"Int.",coopratif:"Coop.",hospices:"Hosp.",xxii:"22",parachutiste:"Para.",alpines:"Alp.",civile:"Civ.",xvie:"17e",tats:".",muse:"Mse",centrales:"Ctrales",globaux:"Glob.",suprieurs:"Sup.",syndicats:"Synd.",archevque:"Archev.",docteurs:"Drs",bibliothque:"Biblio.",lieutenant:"Lieut.",rpublique:"Rp.",vtrinaire:"Vt.",dpartementaux:"Dpt",premier:"1er",fluviaux:"Flv",anim:"Anim.",orientales:"Ori.",technologiques:"Techno.",princesse:"Pse",routire:"Rout.",cooprative:"Coop.",scolaire:"Scol.",coles:"c.",football:"Foot",territoriale:"Territ.",commercial:"Commerc.",mineur:"Min.",millnaires:"Mill.",association:"Assoc.",catholique:"Cathol.",administration:"Admin.",mairie:"Mair.",portuaire:"Port.",tertiaires:"Terti.",thtrale:"Th.",palais:"Pal.",troisime:"3e",directeur:"Dir.",vtrinaires:"Vt.",facult:"Fac.",occidentales:"Occ.",viticulteurs:"Vitic.",xvii:"18",occidentale:"Occ.",amiral:"Amir.",professionnel:"Profess.",administratives:"Admin.",commerciales:"Commerc.",saints:"Sts",agronomes:"Agro.",stade:"Std","sous-prfet":"Ss-prf.",senior:"Sr",agronome:"Agro.",terrain:"Terr.",catholiques:"Cathol.",rsidentielle:"Rsid.",grands:"Gds",exploitants:"Exploit.",xiiie:"13e",croix:"Cx",gnraux:"Gaux",crdit:"Crd.",cimetires:"Cim.",antenne:"Ant.",mdical:"Md.",collges:"Coll.",musicien:"Music.",apostolique:"Apost.",postal:"Post.",territorial:"Territ.",urbanisme:"Urb.",prfectorale:"Prf.",fondateurs:"Fond.",information:"Info.",glises:"gl.",ophtalmologue:"Ophtalmo",congrgation:"Congrg.",charcutier:"Charc.",tage:"t.",consulat:"Consul.",public:"Publ.",ferre:"Ferr.",matin:"mat.","socit anonyme  responsabilit limite":"SARL",monuments:"Mmts",protection:"Prot.",universel:"Univ.",nationale:"Nale",prsident:"Pdt",provinciale:"Prov.",agriculteurs:"Agric.",prfectoral:"Prf.",xxe:"20e",alpins:"Alp.",avant:"av.",infirmerie:"Infirm.","deux mil":"2000",rurale:"Rur.",administratifs:"Admin.",octobre:"Oct.",archipel:"Archip.",communaut:"Commt",globales:"Glob.",alpin:"Alp.",numros:"N","lieutenant-colonel":"Lieut.-Col.","jsus-christ":"J.-C.",agricole:"Agric.","sa majest":"S.Maj.",associative:"Assoc.",xxi:"21",prsidentielle:"Pdtle",moyen:"Moy.",fdral:"Fd.",professionnelle:"Profess.",tertiaire:"Terti.",ixe:"9e",hpital:"Hp.",technologies:"Techno.",iiie:"3e",dveloppement:"Dvelop.",monument:"Mmt",forestire:"Forest.",numro:"N",viticulture:"Vitic.",traversire:"Traver.",technique:"Tech.",lectriques:"lectr.",militaires:"Milit.",pompier:"Pomp.",amricaine:"Amr.",prfet:"Prf.",congrgations:"Congrg.",ptissier:"Ptiss.",mondial:"Mond.",ophtalmologie:"Ophtalm.",sainte:"Ste",africaine:"Afric.",aviatrice:"Aviat.",doyens:"Doy.",socit:"St",majeures:"Maj.",orientale:"Ori.",ministre:"Min.",archiduc:"Archid.",territoire:"Territ.",techniques:"Tech.","le-de-france":"IDF",globale:"Glob.",xe:"10e",xie:"11e",majeure:"Maj.",commerciaux:"Commerc.",maire:"Mair.",spciaux:"Spc.",grande:"Gde",messieurs:"MM",colonel:"Col.",millnaire:"Mill.",xi:"11",urbain:"Urb.",fdrale:"Fd.",ferr:"Ferr.",rivire:"Riv.",rpublicain:"Rpubl.",grandes:"Gdes",rgiment:"Rgim.",hauts:"Hts",catgorie:"Catg.",basses:"Bas.",xii:"12",agronomiques:"Agro.",iie:"2e",protge:"Prot.","sapeur-pompier":"Sap.-pomp."},directions:{"est-nord-est":"ENE","nord-est":"NE",ouest:"O","sud-est":"SE","est-sud-est":"ESE","nord-nord-est":"NNE",sud:"S","nord-nord-ouest":"NNO","nord-ouest":"NO",nord:"N","ouest-sud-ouest":"OSO","ouest-nord-ouest":"ONO","sud-ouest":"SO","sud-sud-est":"SSE","sud-sud-ouest":"SSO",est:"E"}}},{}],12:[function(o,r,c){r.exports={abbreviations:{:"'"},classifications:{},directions:{}}},{}],13:[function(o,r,c){r.exports={abbreviations:{},classifications:{},directions:{kelet:"K",szakkelet:"K",dl:"D",szaknyugat:"NY",szak:"",dlkelet:"DK",dlnyugat:"DNY",nyugat:"NY"}}},{}],14:[function(o,r,c){r.exports={abbreviations:{apartamentai:"Apt",auktumos:"Auk",centras:"Ctr",eeras:"E",fortas:"Ft",greitkelis:"Grtkl",juosta:"Jst",kaimas:"Km",kalnas:"Kln",kelias:"Kl",kiemelis:"Kml",miestelis:"Mstl","miesto centras":"M.Ctr",mokykla:"Mok",nacionalinis:"Nac",paminklas:"Pmkl",parkas:"Pk",pusratis:"Psrt",sankrya:"Skr",ses:"Ses",skveras:"Skv",stotis:"St",v:"v",tarptautinis:"Trptaut",takas:"Tk",tvas:"Tv",turgus:"Tgs",universitetas:"Univ",up:"Up",upelis:"Up",vieta:"Vt"},classifications:{aikt:"a.",alja:"al.",aplinkkelis:"aplinkl.",autostrada:"auto.",bulvaras:"b.",gatv:"g.",kelias:"kel.",krantin:"krant.",prospektas:"pr.",plentas:"pl.",skersgatvis:"skg.",takas:"tak.",tiltas:"tlt."},directions:{piets:"P",vakarai:"V",iaur:"","iaurs vakarai":"V",pietryiai:"PR","iaurs rytai":"R",rytai:"R",pietvakariai:"PV"}}},{}],15:[function(o,r,c){r.exports={abbreviations:{centrum:"Cntrm",nationaal:"Natl",berg:"Brg",meer:"Mr",kruising:"Krsng",toetreden:"Ttrdn"},classifications:{bypass:"Pass",brug:"Br",straat:"Str",rechtbank:"Rbank",snoek:"Snk",autobaan:"Baan",terras:"Trrs",punt:"Pt",plaza:"Plz",rijden:"Rijd",parkway:"Pky",inham:"Nham",snelweg:"Weg","halve maan":"Maan",cirkel:"Crkl",laan:"Ln",rijbaan:"Strook",weg:"Weg",lopen:"Lpn",autoweg:"Weg",boulevard:"Blvd",plaats:"Plts",steeg:"Stg",voetpad:"Stoep"},directions:{noordoost:"NO",westen:"W",zuiden:"Z",zuidwest:"ZW",oost:"O",zuidoost:"ZO",noordwest:"NW",noorden:"N"}}},{}],16:[function(o,r,c){r.exports={abbreviations:{:".",:".",:"",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:"."},classifications:{:"-",:".",:".",:".",:".",:".",:".",:".",:"."},directions:{:"","-":"","-":"","-":"","-":"",:"",:"",:""}}},{}],17:[function(o,r,c){r.exports={abbreviations:{},classifications:{},directions:{vzhod:"V",severovzhod:"SV",jug:"J",severozahod:"SZ",sever:"S",jugovzhod:"JV",jugozahod:"JZ",zahod:"Z"}}},{}],18:[function(o,r,c){r.exports={abbreviations:{sankta:"s:ta",gamla:"G:la",sankt:"s:t"},classifications:{Bro:"Br"},directions:{norr:"N",sydst:"SO",vster:"V",ster:"O",nordvst:"NV",sydvst:"SV",sder:"S",nordst:"NO"}}},{}],19:[function(o,r,c){r.exports={abbreviations:{},classifications:{},directions:{:""," ":"",:""," ":"",:""," ":""," ":"",:""}}},{}],20:[function(o,r,c){r.exports={abbreviations:{"vin bo tng":"VBT","th trn":"Tt","i hc":"H","cn c khng quan":"CCKQ","cu lc b":"CLB","bu in":"B","khch sn":"KS","khu du lch":"KDL","khu cng nghip":"KCN","khu ngh mt":"KNM","th x":"Tx","khu chung c":"KCC","phi trng":"PT","trung tm":"TT","tng cng ty":"TCty","trung hc c s":"THCS","sn bay quc t":"SBQT","trung hc ph thng":"THPT","cao ng":"C","cng ty":"Cty","sn bay":"SB","thnh ph":"Tp","cng vin":"CV","sn vn ng":"SV","linh mc":"LM","vn quc gia":"VQG"},classifications:{"huyn l":"HL","ng tnh":"T","quc l":"QL","xa l":"XL","hng l":"HL","tnh l":"TL","ng huyn":"H","ng cao tc":"CT","i l":"L","vit nam":"VN","qung trng":"QT","ng b":"B"},directions:{ty:"T",nam:"N","ng nam":"N","ng bc":"B","ty nam":"TN",ng:"",bc:"B"}}},{}],21:[function(o,r,c){r.exports={meta:{regExpFlags:"gi"},v5:{article:[["^ Acc[e]s "," laccs "],["^ Aire "," laire "],["^ All[e]e "," lalle "],["^ Anse "," lanse "],["^ (L['])?Autoroute "," lautoroute "],["^ Avenue "," lavenue "],["^ Barreau "," le barreau "],["^ Boulevard "," le boulevard "],["^ Chemin "," le chemin "],["^ Petit[\\- ]Chemin "," le petit chemin "],["^ Cit[e] "," la cit "],["^ Clos "," le clos "],["^ Corniche "," la corniche "],["^ Cour "," la cour "],["^ Cours "," le cours "],["^ D[e]viation "," la dviation "],["^ Entr[e]e "," lentre "],["^ Esplanade "," lesplanade "],["^ Galerie "," la galerie "],["^ Impasse "," limpasse "],["^ Lotissement "," le lotissement "],["^ Mont[e]e "," la monte "],["^ Parc "," le parc "],["^ Parvis "," le parvis "],["^ Passage "," le passage "],["^ Place "," la place "],["^ Petit[\\- ]Pont "," le petit-pont "],["^ Pont "," le pont "],["^ Promenade "," la promenade "],["^ Quai "," le quai "],["^ Rocade "," la rocade "],["^ Rond[\\- ]?Point "," le rond-point "],["^ Route "," la route "],["^ Rue "," la rue "],["^ Grande Rue "," la grande rue "],["^ Sente "," la sente "],["^ Sentier "," le sentier "],["^ Sortie "," la sortie "],["^ Souterrain "," le souterrain "],["^ Square "," le square "],["^ Terrasse "," la terrasse "],["^ Traverse "," la traverse "],["^ Tunnel "," le tunnel "],["^ Viaduc "," le viaduc "],["^ Villa "," la villa "],["^ Village "," le village "],["^ Voie "," la voie "],[" ([dl])'"," $1"]],preposition:[["^ Le ","  du "],["^ Les ","  des "],["^ La ","  de La "],["^ Acc[e]s ","  de laccs "],["^ Aire ","  de laire "],["^ All[e]e ","  de lalle "],["^ Anse ","  de lanse "],["^ (L['])?Autoroute ","  de lautoroute "],["^ Avenue ","  de lavenue "],["^ Barreau ","  du barreau "],["^ Boulevard ","  du boulevard "],["^ Chemin ","  du chemin "],["^ Petit[\\- ]Chemin ","  du petit chemin "],["^ Cit[e] ","  de la cit "],["^ Clos ","  du clos "],["^ Corniche ","  de la corniche "],["^ Cour ","  de la cour "],["^ Cours ","  du cours "],["^ D[e]viation ","  de la dviation "],["^ Entr[e]e ","  de lentre "],["^ Esplanade ","  de lesplanade "],["^ Galerie ","  de la galerie "],["^ Impasse ","  de limpasse "],["^ Lotissement ","  du lotissement "],["^ Mont[e]e ","  de la monte "],["^ Parc ","  du parc "],["^ Parvis ","  du parvis "],["^ Passage ","  du passage "],["^ Place ","  de la place "],["^ Petit[\\- ]Pont ","  du petit-pont "],["^ Pont ","  du pont "],["^ Promenade ","  de la promenade "],["^ Quai ","  du quai "],["^ Rocade ","  de la rocade "],["^ Rond[\\- ]?Point ","  du rond-point "],["^ Route ","  de la route "],["^ Rue ","  de la rue "],["^ Grande Rue ","  de la grande rue "],["^ Sente ","  de la sente "],["^ Sentier ","  du sentier "],["^ Sortie ","  de la sortie "],["^ Souterrain ","  du souterrain "],["^ Square ","  du square "],["^ Terrasse ","  de la terrasse "],["^ Traverse ","  de la traverse "],["^ Tunnel ","  du tunnel "],["^ Viaduc ","  du viaduc "],["^ Villa ","  de la villa "],["^ Village ","  du village "],["^ Voie ","  de la voie "],["^ ([AEIOUY])","  d$1"],["^ (\\S)","  de $1"],[" ([dl])'"," $1"]],rotary:[["^ Le ","  le rond-point du "],["^ Les ","  le rond-point des "],["^ La ","  le rond-point de La "],["^ Acc[e]s "," le rond-point de laccs "],["^ Aire ","  le rond-point de laire "],["^ All[e]e ","  le rond-point de lalle "],["^ Anse ","  le rond-point de lanse "],["^ (L['])?Autoroute ","  le rond-point de lautoroute "],["^ Avenue ","  le rond-point de lavenue "],["^ Barreau ","  le rond-point du barreau "],["^ Boulevard ","  le rond-point du boulevard "],["^ Chemin ","  le rond-point du chemin "],["^ Petit[\\- ]Chemin ","  le rond-point du petit chemin "],["^ Cit[e] ","  le rond-point de la cit "],["^ Clos ","  le rond-point du clos "],["^ Corniche ","  le rond-point de la corniche "],["^ Cour ","  le rond-point de la cour "],["^ Cours ","  le rond-point du cours "],["^ D[e]viation ","  le rond-point de la dviation "],["^ Entr[e]e ","  le rond-point de lentre "],["^ Esplanade ","  le rond-point de lesplanade "],["^ Galerie ","  le rond-point de la galerie "],["^ Impasse ","  le rond-point de limpasse "],["^ Lotissement ","  le rond-point du lotissement "],["^ Mont[e]e ","  le rond-point de la monte "],["^ Parc ","  le rond-point du parc "],["^ Parvis ","  le rond-point du parvis "],["^ Passage ","  le rond-point du passage "],["^ Place ","  le rond-point de la place "],["^ Petit[\\- ]Pont ","  le rond-point du petit-pont "],["^ Pont ","  le rond-point du pont "],["^ Promenade ","  le rond-point de la promenade "],["^ Quai ","  le rond-point du quai "],["^ Rocade ","  le rond-point de la rocade "],["^ Rond[\\- ]?Point ","  le rond-point "],["^ Route ","  le rond-point de la route "],["^ Rue ","  le rond-point de la rue "],["^ Grande Rue ","  le rond-point de la grande rue "],["^ Sente ","  le rond-point de la sente "],["^ Sentier ","  le rond-point du sentier "],["^ Sortie ","  le rond-point de la sortie "],["^ Souterrain ","  le rond-point du souterrain "],["^ Square ","  le rond-point du square "],["^ Terrasse ","  le rond-point de la terrasse "],["^ Traverse ","  le rond-point de la traverse "],["^ Tunnel ","  le rond-point du tunnel "],["^ Viaduc ","  le rond-point du viaduc "],["^ Villa ","  le rond-point de la villa "],["^ Village ","  le rond-point du village "],["^ Voie ","  le rond-point de la voie "],["^ ([AEIOUY])","  le rond-point d$1"],["^ (\\S)","  le rond-point de $1"],[" ([dl])'"," $1"]],arrival:[["^ Le ","  au "],["^ Les ","  aux "],["^ La ","   La "],["^ (\\S)","   $1"],[" ([dl])'"," $1"]]}}},{}],22:[function(o,r,c){r.exports={meta:{regExpFlags:""},v5:{accusative:[['^ (["])',"  $1"],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)-(\\S+) [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^  [] ","   "],["^  [] ","   "],["^  [] ","   "],["^ [] ","  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) (\\S+) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ [][] ","  "]],dative:[['^ (["])',"  $1"],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)-(\\S+) [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^  [] ","   "],["^  [] ","   "],["^  [] ","   "],["^ [] ","  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) (\\S+) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)[]-(\\S+)[] [] "," $1-$2  "],["^ (\\d+)- (\\S+)[]-(\\S+)[] [] "," $1- $2-$3  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [] ","  "],["^ (\\S+[])-(\\S+)[] [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) (\\S+)[] [] "," $1- $2 $3  "],["^ (\\d+)- (\\S+)[] (\\S+)[] [] "," $1- $2 $3  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [][] "," $1  "],["^ (\\S+)[] [][] "," $1  "],["^ (\\S+[]) [][] "," $1  "],["^ (\\S+)[] (\\S+) [][] "," $1 $2  "],["^ (\\S+) (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [][] "," $1 $2  "],["^ (\\d+)- (\\S+) [][] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [][] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [][] "," $1- $2  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+[]) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+[]) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\S+) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+[]) ([])?[] "," $1- $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) (\\S+[]) [] "," $1 $2  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],[" ([]) "," $1 "],["([]) ","$1 "],["([]) ","$1 "]],genitive:[['^ (["])',"  $1"],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)-(\\S+) [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^  [] ","   "],["^  [] ","   "],["^  [] ","   "],["^ [] ","  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) (\\S+) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)[]-(\\S+)[] [] "," $1-$2  "],["^ (\\d+)- (\\S+)[]-(\\S+)[] [] "," $1- $2-$3  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [] ","  "],["^ (\\S+[])-(\\S+)[] [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) (\\S+)[] [] "," $1- $2 $3  "],["^ (\\d+)- (\\S+)[] (\\S+)[] [] "," $1- $2 $3  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [][] "," $1  "],["^ (\\S+)[] [][] "," $1  "],["^ (\\S+[]) [][] "," $1  "],["^ (\\S+)[] (\\S+) [][] "," $1 $2  "],["^ (\\S+) (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [][] "," $1 $2  "],["^ (\\d+)- (\\S+) [][] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [][] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [][] "," $1- $2  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+[]) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+[]) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\S+) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+[]) ([])?[] "," $1- $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) (\\S+[]) [] "," $1 $2  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],[" ([]) "," $1 "],["([]) ","$1 "]],prepositional:[['^ (["])',"  $1"],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)-(\\S+) [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^  [] ","   "],["^  [] ","   "],["^  [] ","   "],["^ [] ","  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) (\\S+) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)[]-(\\S+)[] [] "," $1-$2  "],["^ (\\d+)- (\\S+)[]-(\\S+)[] [] "," $1- $2-$3  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [] ","  "],["^ (\\S+[])-(\\S+)[] [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) (\\S+)[] [] "," $1- $2 $3  "],["^ (\\d+)- (\\S+)[] (\\S+)[] [] "," $1- $2 $3  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [][] "," $1  "],["^ (\\S+)[] [][] "," $1  "],["^ (\\S+[]) [][] "," $1  "],["^ (\\S+)[] (\\S+) [][] "," $1 $2  "],["^ (\\S+) (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [][] "," $1 $2  "],["^ (\\d+)- (\\S+) [][] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [][] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [][] "," $1- $2  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+[]) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+[]) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\S+) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+[]) ([])?[] "," $1- $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) (\\S+[]) [] "," $1 $2  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],[" ([]) "," $1 "],["([]) ","$1 "]]}}},{}],23:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"frste",2:"anden",3:"tredje",4:"fjerde",5:"femte",6:"sjette",7:"syvende",8:"ottende",9:"niende",10:"tiende"},direction:{north:"Nord",northeast:"Nordst",east:"st",southeast:"Sydst",south:"Syd",southwest:"Sydvest",west:"Vest",northwest:"Nordvest"},modifier:{left:"venstresving",right:"hjresving","sharp left":"skarpt venstresving","sharp right":"skarpt hjresving","slight left":"svagt venstresving","slight right":"svagt hjresving",straight:"ligeud",uturn:"U-vending"},lanes:{xo:"Hold til hjre",ox:"Hold til venstre",xox:"Benyt midterste spor",oxo:"Hold til hjre eller venstre"}},modes:{ferry:{default:"Tag frgen",name:"Tag frgen {way_name}",destination:"Tag frgen i retning {destination}"}},phrase:{"two linked by distance":"{instruction_one} derefter, efter {distance}, {instruction_two}","two linked":"{instruction_one}, derefter {instruction_two}","one in distance":"Efter {distance} {instruction_one}","name and ref":"{name} ({ref})","exit with number":"afkrsel {exit}"},arrive:{default:{default:"Du er ankommet til din {nth} destination",upcoming:"Du vil ankomme til din {nth} destination",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}"},left:{default:"Du er ankommet til din {nth} destination, som befinder sig til venstre",upcoming:"Du vil ankomme til din {nth} destination p venstre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til venstre"},right:{default:"Du er ankommet til din {nth} destination, som befinder sig til hjre",upcoming:"Du vil ankomme til din {nth} destination p hjre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til hjre"},"sharp left":{default:"Du er ankommet til din {nth} destination, som befinder sig til venstre",upcoming:"Du vil ankomme til din {nth} destination p venstre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til venstre"},"sharp right":{default:"Du er ankommet til din {nth} destination, som befinder sig til hjre",upcoming:"Du vil ankomme til din {nth} destination p hjre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til hjre"},"slight right":{default:"Du er ankommet til din {nth} destination, som befinder sig til hjre",upcoming:"Du vil ankomme til din {nth} destination p hjre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til hjre"},"slight left":{default:"Du er ankommet til din {nth} destination, som befinder sig til venstre",upcoming:"Du vil ankomme til din {nth} destination p venstre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til venstre"},straight:{default:"Du er ankommet til din {nth} destination, der befinder sig lige frem",upcoming:"Du vil ankomme til din {nth} destination foran dig",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, der befinder sig lige frem"}},continue:{default:{default:"Drej til {modifier}",name:"Drej til {modifier} videre ad {way_name}",destination:"Drej til {modifier} mod {destination}",exit:"Drej til {modifier} ad {way_name}"},straight:{default:"Fortst ligeud",name:"Fortst ligeud ad {way_name}",destination:"Fortst mod {destination}",distance:"Fortst {distance} ligeud",namedistance:"Fortst {distance} ad {way_name}"},"sharp left":{default:"Drej skarpt til venstre",name:"Drej skarpt til venstre videre ad {way_name}",destination:"Drej skarpt til venstre mod {destination}"},"sharp right":{default:"Drej skarpt til hjre",name:"Drej skarpt til hjre videre ad {way_name}",destination:"Drej skarpt til hjre mod {destination}"},"slight left":{default:"Drej left til venstre",name:"Drej let til venstre videre ad {way_name}",destination:"Drej let til venstre mod {destination}"},"slight right":{default:"Drej let til hjre",name:"Drej let til hjre videre ad {way_name}",destination:"Drej let til hjre mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending tilbage ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},depart:{default:{default:"Kr mod {direction}",name:"Kr mod {direction} ad {way_name}",namedistance:"Fortst {distance} ad {way_name}mod {direction}"}},"end of road":{default:{default:"Drej til {modifier}",name:"Drej til {modifier} ad {way_name}",destination:"Drej til {modifier} mof {destination}"},straight:{default:"Fortst ligeud",name:"Fortst ligeud ad {way_name}",destination:"Fortst ligeud mod {destination}"},uturn:{default:"Foretag en U-vending for enden af vejen",name:"Foretag en U-vending ad {way_name} for enden af vejen",destination:"Foretag en U-vending mod {destination} for enden af vejen"}},fork:{default:{default:"Hold til {modifier} ved udfletningen",name:"Hold mod {modifier} p {way_name}",destination:"Hold mod {modifier} mod {destination}"},"slight left":{default:"Hold til venstre ved udfletningen",name:"Hold til venstre p {way_name}",destination:"Hold til venstre mod {destination}"},"slight right":{default:"Hold til hjre ved udfletningen",name:"Hold til hjre p {way_name}",destination:"Hold til hjre mod {destination}"},"sharp left":{default:"Drej skarpt til venstre ved udfletningen",name:"Drej skarpt til venstre ad {way_name}",destination:"Drej skarpt til venstre mod {destination}"},"sharp right":{default:"Drej skarpt til hjre ved udfletningen",name:"Drej skarpt til hjre ad {way_name}",destination:"Drej skarpt til hjre mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},merge:{default:{default:"Flet til {modifier}",name:"Flet til {modifier} ad {way_name}",destination:"Flet til {modifier} mod {destination}"},straight:{default:"Flet",name:"Flet ind p {way_name}",destination:"Flet ind mod {destination}"},"slight left":{default:"Flet til venstre",name:"Flet til venstre ad {way_name}",destination:"Flet til venstre mod {destination}"},"slight right":{default:"Flet til hjre",name:"Flet til hjre ad {way_name}",destination:"Flet til hjre mod {destination}"},"sharp left":{default:"Flet til venstre",name:"Flet til venstre ad {way_name}",destination:"Flet til venstre mod {destination}"},"sharp right":{default:"Flet til hjre",name:"Flet til hjre ad {way_name}",destination:"Flet til hjre mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},"new name":{default:{default:"Fortst {modifier}",name:"Fortst {modifier} ad {way_name}",destination:"Fortst {modifier} mod {destination}"},straight:{default:"Fortst ligeud",name:"Fortst ad {way_name}",destination:"Fortst mod {destination}"},"sharp left":{default:"Drej skarpt til venstre",name:"Drej skarpt til venstre ad {way_name}",destination:"Drej skarpt til venstre mod {destination}"},"sharp right":{default:"Drej skarpt til hjre",name:"Drej skarpt til hjre ad {way_name}",destination:"Drej skarpt til hjre mod {destination}"},"slight left":{default:"Fortst til venstre",name:"Fortst til venstre ad {way_name}",destination:"Fortst til venstre mod {destination}"},"slight right":{default:"Fortst til hjre",name:"Fortst til hjre ad {way_name}",destination:"Fortst til hjre mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},notification:{default:{default:"Fortst {modifier}",name:"Fortst {modifier} ad {way_name}",destination:"Fortst {modifier} mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},"off ramp":{default:{default:"Tag afkrslen",name:"Tag afkrslen ad {way_name}",destination:"Tag afkrslen mod {destination}",exit:"Vlg afkrsel {exit}",exit_destination:"Vlg afkrsel {exit} mod {destination}"},left:{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}",exit:"Vlg afkrsel {exit} til venstre",exit_destination:`Vlg afkrsel {exit} til venstre mod {destination}
`},right:{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}",exit:"Vlg afkrsel {exit} til hjre",exit_destination:"Vlg afkrsel {exit} til hjre mod {destination}"},"sharp left":{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}",exit:"Vlg afkrsel {exit} til venstre",exit_destination:`Vlg afkrsel {exit} til venstre mod {destination}
`},"sharp right":{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}",exit:"Vlg afkrsel {exit} til hjre",exit_destination:"Vlg afkrsel {exit} til hjre mod {destination}"},"slight left":{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}",exit:"Vlg afkrsel {exit} til venstre",exit_destination:`Vlg afkrsel {exit} til venstre mod {destination}
`},"slight right":{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}",exit:"Vlg afkrsel {exit} til hjre",exit_destination:"Vlg afkrsel {exit} til hjre mod {destination}"}},"on ramp":{default:{default:"Tag afkrslen",name:"Tag afkrslen ad {way_name}",destination:"Tag afkrslen mod {destination}"},left:{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}"},right:{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}"},"sharp left":{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}"},"sharp right":{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}"},"slight left":{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}"},"slight right":{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}"}},rotary:{default:{default:{default:"Kr ind i rundkrslen",name:"Tag rundkrslen og kr fra ad {way_name}",destination:"Tag rundkrslen og kr mod {destination}"},name:{default:"Kr ind i {rotary_name}",name:"Kr ind i {rotary_name} og kr ad {way_name} ",destination:"Kr ind i {rotary_name} og kr mod {destination}"},exit:{default:"Tag rundkrslen og forlad ved {exit_number} afkrsel",name:"Tag rundkrslen og forlad ved {exit_number} afkrsel ad {way_name}",destination:"Tag rundkrslen og forlad ved {exit_number} afkrsel mod {destination}"},name_exit:{default:"Kr ind i {rotary_name} og forlad ved {exit_number} afkrsel",name:"Kr ind i {rotary_name} og forlad ved {exit_number} afkrsel ad {way_name}",destination:"Kr ind i {rotary_name} og forlad ved {exit_number} afkrsel mod {destination}"}}},roundabout:{default:{exit:{default:"Tag rundkrslen og forlad ved {exit_number} afkrsel",name:"Tag rundkrslen og forlad ved {exit_number} afkrsel ad {way_name}",destination:"Tag rundkrslen og forlad ved {exit_number} afkrsel mod {destination}"},default:{default:"Kr ind i rundkrslen",name:"Tag rundkrslen og kr fra ad {way_name}",destination:"Tag rundkrslen og kr mod {destination}"}}},"roundabout turn":{default:{default:"Foretag et {modifier}",name:"Foretag et {modifier} ad {way_name}",destination:"Foretag et {modifier} mod {destination}"},left:{default:"Drej til venstre",name:"Drej til venstre ad {way_name}",destination:"Drej til venstre mod {destination}"},right:{default:"Drej til hjre",name:"Drej til hjre ad {way_name}",destination:"Drej til hjre mod {destination}"},straight:{default:"Fortst ligeud",name:"Fortst ligeud ad {way_name}",destination:"Fortst ligeud mod {destination}"}},"exit roundabout":{default:{default:"Forlad rundkrslen",name:"Forlad rundkrslen ad {way_name}",destination:"Forlad rundkrslen mod  {destination}"}},"exit rotary":{default:{default:"Forlad rundkrslen",name:"Forlad rundkrslen ad {way_name}",destination:"Forlad rundkrslen mod {destination}"}},turn:{default:{default:"Foretag et {modifier}",name:"Foretag et {modifier} ad {way_name}",destination:"Foretag et {modifier} mod {destination}"},left:{default:"Drej til venstre",name:"Drej til venstre ad {way_name}",destination:"Drej til venstre mod {destination}"},right:{default:"Drej til hjre",name:"Drej til hjre ad {way_name}",destination:"Drej til hjre mod {destination}"},straight:{default:"Fortst ligeud",name:"Kr ligeud ad {way_name}",destination:"Kr ligeud mod {destination}"}},"use lane":{no_lanes:{default:"Fortst ligeud"},default:{default:"{lane_instruction}"}}}}},{}],24:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"erste",2:"zweite",3:"dritte",4:"vierte",5:"fnfte",6:"sechste",7:"siebente",8:"achte",9:"neunte",10:"zehnte"},direction:{north:"Norden",northeast:"Nordosten",east:"Osten",southeast:"Sdosten",south:"Sden",southwest:"Sdwesten",west:"Westen",northwest:"Nordwesten"},modifier:{left:"links",right:"rechts","sharp left":"scharf links","sharp right":"scharf rechts","slight left":"leicht links","slight right":"leicht rechts",straight:"geradeaus",uturn:"180-Wendung"},lanes:{xo:"Rechts halten",ox:"Links halten",xox:"Mittlere Spur nutzen",oxo:"Rechts oder links halten"}},modes:{ferry:{default:"Fhre nehmen",name:"Fhre nehmen {way_name}",destination:"Fhre nehmen Richtung {destination}"}},phrase:{"two linked by distance":"{instruction_one} danach in {distance} {instruction_two}","two linked":"{instruction_one} danach {instruction_two}","one in distance":"In {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Sie haben Ihr {nth} Ziel erreicht",upcoming:"Sie haben Ihr {nth} Ziel erreicht",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}"},left:{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich links"},right:{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich rechts"},"sharp left":{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich links"},"sharp right":{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich rechts"},"slight right":{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich rechts"},"slight left":{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich links"},straight:{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich geradeaus",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich geradeaus",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich geradeaus"}},continue:{default:{default:"{modifier} abbiegen",name:"{modifier} weiterfahren auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}",exit:"{modifier} abbiegen auf {way_name}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Weiterfahren in Richtung {destination}",distance:"Geradeaus weiterfahren fr {distance}",namedistance:"Geradeaus weiterfahren auf {way_name} fr {distance}"},"sharp left":{default:"Scharf links",name:"Scharf links weiterfahren auf {way_name}",destination:"Scharf links Richtung {destination}"},"sharp right":{default:"Scharf rechts",name:"Scharf rechts weiterfahren auf {way_name}",destination:"Scharf rechts Richtung {destination}"},"slight left":{default:"Leicht links",name:"Leicht links weiter auf {way_name}",destination:"Leicht links weiter Richtung {destination}"},"slight right":{default:"Leicht rechts weiter",name:"Leicht rechts weiter auf {way_name}",destination:"Leicht rechts weiter Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},depart:{default:{default:"Fahren Sie Richtung {direction}",name:"Fahren Sie Richtung {direction} auf {way_name}",namedistance:"Fahren Sie Richtung {direction} auf {way_name} fr {distance}"}},"end of road":{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"},uturn:{default:"180-Wendung am Ende der Strae",name:"180-Wendung auf {way_name} am Ende der Strae",destination:"180-Wendung Richtung {destination} am Ende der Strae"}},fork:{default:{default:"{modifier} halten an der Gabelung",name:"{modifier} halten an der Gabelung auf {way_name}",destination:"{modifier}  halten an der Gabelung Richtung {destination}"},"slight left":{default:"Links halten an der Gabelung",name:"Links halten an der Gabelung auf {way_name}",destination:"Links halten an der Gabelung Richtung {destination}"},"slight right":{default:"Rechts halten an der Gabelung",name:"Rechts halten an der Gabelung auf {way_name}",destination:"Rechts halten an der Gabelung Richtung {destination}"},"sharp left":{default:"Scharf links abbiegen an der Gabelung",name:"Scharf links auf {way_name}",destination:"Scharf links Richtung {destination}"},"sharp right":{default:"Scharf rechts abbiegen an der Gabelung",name:"Scharf rechts auf {way_name}",destination:"Scharf rechts Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},merge:{default:{default:"{modifier} auffahren",name:"{modifier} auffahren auf {way_name}",destination:"{modifier} auffahren Richtung {destination}"},straight:{default:"geradeaus auffahren",name:"geradeaus auffahren auf {way_name}",destination:"geradeaus auffahren Richtung {destination}"},"slight left":{default:"Leicht links auffahren",name:"Leicht links auffahren auf {way_name}",destination:"Leicht links auffahren Richtung {destination}"},"slight right":{default:"Leicht rechts auffahren",name:"Leicht rechts auffahren auf {way_name}",destination:"Leicht rechts auffahren Richtung {destination}"},"sharp left":{default:"Scharf links auffahren",name:"Scharf links auffahren auf {way_name}",destination:"Scharf links auffahren Richtung {destination}"},"sharp right":{default:"Scharf rechts auffahren",name:"Scharf rechts auffahren auf {way_name}",destination:"Scharf rechts auffahren Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},"new name":{default:{default:"{modifier} weiterfahren",name:"{modifier} weiterfahren auf {way_name}",destination:"{modifier} weiterfahren Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Weiterfahren auf {way_name}",destination:"Weiterfahren in Richtung {destination}"},"sharp left":{default:"Scharf links",name:"Scharf links auf {way_name}",destination:"Scharf links Richtung {destination}"},"sharp right":{default:"Scharf rechts",name:"Scharf rechts auf {way_name}",destination:"Scharf rechts Richtung {destination}"},"slight left":{default:"Leicht links weiter",name:"Leicht links weiter auf {way_name}",destination:"Leicht links weiter Richtung {destination}"},"slight right":{default:"Leicht rechts weiter",name:"Leicht rechts weiter auf {way_name}",destination:"Leicht rechts weiter Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},notification:{default:{default:"{modifier} weiterfahren",name:"{modifier} weiterfahren auf {way_name}",destination:"{modifier} weiterfahren Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},"off ramp":{default:{default:"Ausfahrt nehmen",name:"Ausfahrt nehmen auf {way_name}",destination:"Ausfahrt nehmen Richtung {destination}",exit:"Ausfahrt {exit} nehmen",exit_destination:"Ausfahrt {exit} nehmen Richtung {destination}"},left:{default:"Ausfahrt links nehmen",name:"Ausfahrt links nehmen auf {way_name}",destination:"Ausfahrt links nehmen Richtung {destination}",exit:"Ausfahrt {exit} links nehmen",exit_destination:"Ausfahrt {exit} links nehmen Richtung {destination}"},right:{default:"Ausfahrt rechts nehmen",name:"Ausfahrt rechts nehmen Richtung {way_name}",destination:"Ausfahrt rechts nehmen Richtung {destination}",exit:"Ausfahrt {exit} rechts nehmen",exit_destination:"Ausfahrt {exit} nehmen Richtung {destination}"},"sharp left":{default:"Ausfahrt links nehmen",name:"Ausfahrt links Seite nehmen auf {way_name}",destination:"Ausfahrt links nehmen Richtung {destination}",exit:"Ausfahrt {exit} links nehmen",exit_destination:"Ausfahrt{exit} links nehmen Richtung {destination}"},"sharp right":{default:"Ausfahrt rechts nehmen",name:"Ausfahrt rechts nehmen auf {way_name}",destination:"Ausfahrt rechts nehmen Richtung {destination}",exit:"Ausfahrt {exit} rechts nehmen",exit_destination:"Ausfahrt {exit} nehmen Richtung {destination}"},"slight left":{default:"Ausfahrt links nehmen",name:"Ausfahrt links nehmen auf {way_name}",destination:"Ausfahrt links nehmen Richtung {destination}",exit:"Ausfahrt {exit} nehmen",exit_destination:"Ausfahrt {exit} links nehmen Richtung {destination}"},"slight right":{default:"Ausfahrt rechts nehmen",name:"Ausfahrt rechts nehmen auf {way_name}",destination:"Ausfahrt rechts nehmen Richtung {destination}",exit:"Ausfahrt {exit} rechts nehmen",exit_destination:"Ausfahrt {exit} nehmen Richtung {destination}"}},"on ramp":{default:{default:"Auffahrt nehmen",name:"Auffahrt nehmen auf {way_name}",destination:"Auffahrt nehmen Richtung {destination}"},left:{default:"Auffahrt links nehmen",name:"Auffahrt links nehmen auf {way_name}",destination:"Auffahrt links nehmen Richtung {destination}"},right:{default:"Auffahrt rechts nehmen",name:"Auffahrt rechts nehmen auf {way_name}",destination:"Auffahrt rechts nehmen Richtung {destination}"},"sharp left":{default:"Auffahrt links nehmen",name:"Auffahrt links nehmen auf {way_name}",destination:"Auffahrt links nehmen Richtung {destination}"},"sharp right":{default:"Auffahrt rechts nehmen",name:"Auffahrt rechts nehmen auf {way_name}",destination:"Auffahrt rechts nehmen Richtung {destination}"},"slight left":{default:"Auffahrt links Seite nehmen",name:"Auffahrt links nehmen auf {way_name}",destination:"Auffahrt links nehmen Richtung {destination}"},"slight right":{default:"Auffahrt rechts nehmen",name:"Auffahrt rechts nehmen auf {way_name}",destination:"Auffahrt rechts nehmen Richtung {destination}"}},rotary:{default:{default:{default:"In den Kreisverkehr fahren",name:"Im Kreisverkehr die Ausfahrt auf {way_name} nehmen",destination:"Im Kreisverkehr die Ausfahrt Richtung {destination} nehmen"},name:{default:"In {rotary_name} fahren",name:"In {rotary_name} die Ausfahrt auf {way_name} nehmen",destination:"In {rotary_name} die Ausfahrt Richtung {destination} nehmen"},exit:{default:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen",name:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen auf {way_name}",destination:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen Richtung {destination}"},name_exit:{default:"In den Kreisverkehr fahren und {exit_number} Ausfahrt nehmen",name:"In den Kreisverkehr fahren und {exit_number} Ausfahrt nehmen auf {way_name}",destination:"In den Kreisverkehr fahren und {exit_number} Ausfahrt nehmen Richtung {destination}"}}},roundabout:{default:{exit:{default:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen",name:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen auf {way_name}",destination:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen Richtung {destination}"},default:{default:"In den Kreisverkehr fahren",name:"Im Kreisverkehr die Ausfahrt auf {way_name} nehmen",destination:"Im Kreisverkehr die Ausfahrt Richtung {destination} nehmen"}}},"roundabout turn":{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},left:{default:"Links abbiegen",name:"Links abbiegen auf {way_name}",destination:"Links abbiegen Richtung {destination}"},right:{default:"Rechts abbiegen",name:"Rechts abbiegen auf {way_name}",destination:"Rechts abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"}},"exit roundabout":{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},left:{default:"Links abbiegen",name:"Links abbiegen auf {way_name}",destination:"Links abbiegen Richtung {destination}"},right:{default:"Rechts abbiegen",name:"Rechts abbiegen auf {way_name}",destination:"Rechts abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"}},"exit rotary":{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},left:{default:"Links abbiegen",name:"Links abbiegen auf {way_name}",destination:"Links abbiegen Richtung {destination}"},right:{default:"Rechts abbiegen",name:"Rechts abbiegen auf {way_name}",destination:"Rechts abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"}},turn:{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},left:{default:"Links abbiegen",name:"Links abbiegen auf {way_name}",destination:"Links abbiegen Richtung {destination}"},right:{default:"Rechts abbiegen",name:"Rechts abbiegen auf {way_name}",destination:"Rechts abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"}},"use lane":{no_lanes:{default:"Geradeaus weiterfahren"},default:{default:"{lane_instruction}"}}}}},{}],25:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1st",2:"2nd",3:"3rd",4:"4th",5:"5th",6:"6th",7:"7th",8:"8th",9:"9th",10:"10th"},direction:{north:"north",northeast:"northeast",east:"east",southeast:"southeast",south:"south",southwest:"southwest",west:"west",northwest:"northwest"},modifier:{left:"left",right:"right","sharp left":"sharp left","sharp right":"sharp right","slight left":"slight left","slight right":"slight right",straight:"straight",uturn:"U-turn"},lanes:{xo:"Keep right",ox:"Keep left",xox:"Keep in the middle",oxo:"Keep left or right"}},modes:{ferry:{default:"Take the ferry",name:"Take the ferry {way_name}",destination:"Take the ferry towards {destination}"}},phrase:{"two linked by distance":"{instruction_one}, then, in {distance}, {instruction_two}","two linked":"{instruction_one}, then {instruction_two}","one in distance":"In {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"You have arrived at your {nth} destination",upcoming:"You will arrive at your {nth} destination",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}"},left:{default:"You have arrived at your {nth} destination, on the left",upcoming:"You will arrive at your {nth} destination, on the left",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the left"},right:{default:"You have arrived at your {nth} destination, on the right",upcoming:"You will arrive at your {nth} destination, on the right",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the right"},"sharp left":{default:"You have arrived at your {nth} destination, on the left",upcoming:"You will arrive at your {nth} destination, on the left",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the left"},"sharp right":{default:"You have arrived at your {nth} destination, on the right",upcoming:"You will arrive at your {nth} destination, on the right",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the right"},"slight right":{default:"You have arrived at your {nth} destination, on the right",upcoming:"You will arrive at your {nth} destination, on the right",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the right"},"slight left":{default:"You have arrived at your {nth} destination, on the left",upcoming:"You will arrive at your {nth} destination, on the left",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the left"},straight:{default:"You have arrived at your {nth} destination, straight ahead",upcoming:"You will arrive at your {nth} destination, straight ahead",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, straight ahead"}},continue:{default:{default:"Turn {modifier}",name:"Turn {modifier} to stay on {way_name}",destination:"Turn {modifier} towards {destination}",exit:"Turn {modifier} onto {way_name}"},straight:{default:"Continue straight",name:"Continue straight to stay on {way_name}",destination:"Continue towards {destination}",distance:"Continue straight for {distance}",namedistance:"Continue on {way_name} for {distance}"},"sharp left":{default:"Make a sharp left",name:"Make a sharp left to stay on {way_name}",destination:"Make a sharp left towards {destination}"},"sharp right":{default:"Make a sharp right",name:"Make a sharp right to stay on {way_name}",destination:"Make a sharp right towards {destination}"},"slight left":{default:"Make a slight left",name:"Make a slight left to stay on {way_name}",destination:"Make a slight left towards {destination}"},"slight right":{default:"Make a slight right",name:"Make a slight right to stay on {way_name}",destination:"Make a slight right towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn and continue on {way_name}",destination:"Make a U-turn towards {destination}"}},depart:{default:{default:"Head {direction}",name:"Head {direction} on {way_name}",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"Turn {modifier}",name:"Turn {modifier} onto {way_name}",destination:"Turn {modifier} towards {destination}"},straight:{default:"Continue straight",name:"Continue straight onto {way_name}",destination:"Continue straight towards {destination}"},uturn:{default:"Make a U-turn at the end of the road",name:"Make a U-turn onto {way_name} at the end of the road",destination:"Make a U-turn towards {destination} at the end of the road"}},fork:{default:{default:"Keep {modifier} at the fork",name:"Keep {modifier} onto {way_name}",destination:"Keep {modifier} towards {destination}"},"slight left":{default:"Keep left at the fork",name:"Keep left onto {way_name}",destination:"Keep left towards {destination}"},"slight right":{default:"Keep right at the fork",name:"Keep right onto {way_name}",destination:"Keep right towards {destination}"},"sharp left":{default:"Take a sharp left at the fork",name:"Take a sharp left onto {way_name}",destination:"Take a sharp left towards {destination}"},"sharp right":{default:"Take a sharp right at the fork",name:"Take a sharp right onto {way_name}",destination:"Take a sharp right towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn onto {way_name}",destination:"Make a U-turn towards {destination}"}},merge:{default:{default:"Merge {modifier}",name:"Merge {modifier} onto {way_name}",destination:"Merge {modifier} towards {destination}"},straight:{default:"Merge",name:"Merge onto {way_name}",destination:"Merge towards {destination}"},"slight left":{default:"Merge left",name:"Merge left onto {way_name}",destination:"Merge left towards {destination}"},"slight right":{default:"Merge right",name:"Merge right onto {way_name}",destination:"Merge right towards {destination}"},"sharp left":{default:"Merge left",name:"Merge left onto {way_name}",destination:"Merge left towards {destination}"},"sharp right":{default:"Merge right",name:"Merge right onto {way_name}",destination:"Merge right towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn onto {way_name}",destination:"Make a U-turn towards {destination}"}},"new name":{default:{default:"Continue {modifier}",name:"Continue {modifier} onto {way_name}",destination:"Continue {modifier} towards {destination}"},straight:{default:"Continue straight",name:"Continue onto {way_name}",destination:"Continue towards {destination}"},"sharp left":{default:"Take a sharp left",name:"Take a sharp left onto {way_name}",destination:"Take a sharp left towards {destination}"},"sharp right":{default:"Take a sharp right",name:"Take a sharp right onto {way_name}",destination:"Take a sharp right towards {destination}"},"slight left":{default:"Continue slightly left",name:"Continue slightly left onto {way_name}",destination:"Continue slightly left towards {destination}"},"slight right":{default:"Continue slightly right",name:"Continue slightly right onto {way_name}",destination:"Continue slightly right towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn onto {way_name}",destination:"Make a U-turn towards {destination}"}},notification:{default:{default:"Continue {modifier}",name:"Continue {modifier} onto {way_name}",destination:"Continue {modifier} towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn onto {way_name}",destination:"Make a U-turn towards {destination}"}},"off ramp":{default:{default:"Take the ramp",name:"Take the ramp onto {way_name}",destination:"Take the ramp towards {destination}",exit:"Take exit {exit}",exit_destination:"Take exit {exit} towards {destination}"},left:{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},right:{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"},"sharp left":{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},"sharp right":{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"},"slight left":{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},"slight right":{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"}},"on ramp":{default:{default:"Take the ramp",name:"Take the ramp onto {way_name}",destination:"Take the ramp towards {destination}"},left:{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}"},right:{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}"},"sharp left":{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}"},"sharp right":{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}"},"slight left":{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}"},"slight right":{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}"}},rotary:{default:{default:{default:"Enter the traffic circle",name:"Enter the traffic circle and exit onto {way_name}",destination:"Enter the traffic circle and exit towards {destination}"},name:{default:"Enter {rotary_name}",name:"Enter {rotary_name} and exit onto {way_name}",destination:"Enter {rotary_name} and exit towards {destination}"},exit:{default:"Enter the traffic circle and take the {exit_number} exit",name:"Enter the traffic circle and take the {exit_number} exit onto {way_name}",destination:"Enter the traffic circle and take the {exit_number} exit towards {destination}"},name_exit:{default:"Enter {rotary_name} and take the {exit_number} exit",name:"Enter {rotary_name} and take the {exit_number} exit onto {way_name}",destination:"Enter {rotary_name} and take the {exit_number} exit towards {destination}"}}},roundabout:{default:{exit:{default:"Enter the traffic circle and take the {exit_number} exit",name:"Enter the traffic circle and take the {exit_number} exit onto {way_name}",destination:"Enter the traffic circle and take the {exit_number} exit towards {destination}"},default:{default:"Enter the traffic circle",name:"Enter the traffic circle and exit onto {way_name}",destination:"Enter the traffic circle and exit towards {destination}"}}},"roundabout turn":{default:{default:"Make a {modifier}",name:"Make a {modifier} onto {way_name}",destination:"Make a {modifier} towards {destination}"},left:{default:"Turn left",name:"Turn left onto {way_name}",destination:"Turn left towards {destination}"},right:{default:"Turn right",name:"Turn right onto {way_name}",destination:"Turn right towards {destination}"},straight:{default:"Continue straight",name:"Continue straight onto {way_name}",destination:"Continue straight towards {destination}"}},"exit roundabout":{default:{default:"Exit the traffic circle",name:"Exit the traffic circle onto {way_name}",destination:"Exit the traffic circle towards {destination}"}},"exit rotary":{default:{default:"Exit the traffic circle",name:"Exit the traffic circle onto {way_name}",destination:"Exit the traffic circle towards {destination}"}},turn:{default:{default:"Make a {modifier}",name:"Make a {modifier} onto {way_name}",destination:"Make a {modifier} towards {destination}"},left:{default:"Turn left",name:"Turn left onto {way_name}",destination:"Turn left towards {destination}"},right:{default:"Turn right",name:"Turn right onto {way_name}",destination:"Turn right towards {destination}"},straight:{default:"Go straight",name:"Go straight onto {way_name}",destination:"Go straight towards {destination}"}},"use lane":{no_lanes:{default:"Continue straight"},default:{default:"{lane_instruction}"}}}}},{}],26:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1.",2:"2.",3:"3.",4:"4.",5:"5.",6:"6.",7:"7.",8:"8.",9:"9.",10:"10."},direction:{north:"norden",northeast:"nord-orienten",east:"orienten",southeast:"sud-orienten",south:"suden",southwest:"sud-okcidenten",west:"okcidenten",northwest:"nord-okcidenten"},modifier:{left:"maldekstren",right:"dekstren","sharp left":"maldekstregen","sharp right":"dekstregen","slight left":"maldekstreten","slight right":"dekstreten",straight:"rekten",uturn:"turniu malantaen"},lanes:{xo:"Veturu dekstre",ox:"Veturu maldekstre",xox:"Veturu meze",oxo:"Veturu dekstre a maldekstre"}},modes:{ferry:{default:"Enpramiu",name:"Enpramiu {way_name}",destination:"Enpramiu direkte al {destination}"}},phrase:{"two linked by distance":"{instruction_one} kaj post {distance} {instruction_two}","two linked":"{instruction_one} kaj sekve {instruction_two}","one in distance":"Post {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"elveturejo {exit}"},arrive:{default:{default:"Vi atingis vian {nth} celon",upcoming:"Vi atingos vian {nth} celon",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}"},left:{default:"Vi atingis vian {nth} celon e maldekstre",upcoming:"Vi atingos vian {nth} celon e maldekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e maldekstre"},right:{default:"Vi atingis vian {nth} celon e dekstre",upcoming:"Vi atingos vian {nth} celon e dekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e dekstre"},"sharp left":{default:"Vi atingis vian {nth} celon e maldekstre",upcoming:"Vi atingos vian {nth} celon e maldekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e maldekstre"},"sharp right":{default:"Vi atingis vian {nth} celon e dekstre",upcoming:"Vi atingos vian {nth} celon e dekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e dekstre"},"slight right":{default:"Vi atingis vian {nth} celon e dekstre",upcoming:"Vi atingos vian {nth} celon e dekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e dekstre"},"slight left":{default:"Vi atingis vian {nth} celon e maldekstre",upcoming:"Vi atingos vian {nth} celon e maldekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e maldekstre"},straight:{default:"Vi atingis vian {nth} celon",upcoming:"Vi atingos vian {nth} celon rekte",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name} antae"}},continue:{default:{default:"Veturu {modifier}",name:"Veturu {modifier} al {way_name}",destination:"Veturu {modifier} direkte al {destination}",exit:"Veturu {modifier} direkte al {way_name}"},straight:{default:"Veturu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}",distance:"Veturu rekten dum {distance}",namedistance:"Veturu rekten al {way_name} dum {distance}"},"sharp left":{default:"Turniu ege maldekstren",name:"Turniu ege maldekstren al {way_name}",destination:"Turniu ege maldekstren direkte al {destination}"},"sharp right":{default:"Turniu ege dekstren",name:"Turniu ege dekstren al {way_name}",destination:"Turniu ege dekstren direkte al {destination}"},"slight left":{default:"Turniu ete maldekstren",name:"Turniu ete maldekstren al {way_name}",destination:"Turniu ete maldekstren direkte al {destination}"},"slight right":{default:"Turniu ete dekstren",name:"Turniu ete dekstren al {way_name}",destination:"Turniu ete dekstren direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},depart:{default:{default:"Direktiu {direction}",name:"Direktiu {direction} al {way_name}",namedistance:"Direktiu {direction} al {way_name} tra {distance}"}},"end of road":{default:{default:"Veturu {modifier}",name:"Veturu {modifier} direkte al {way_name}",destination:"Veturu {modifier} direkte al {destination}"},straight:{default:"Veturu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}"},uturn:{default:"Turniu malantaen e fino de la vojo",name:"Turniu malantaen al {way_name} e fino de la vojo",destination:"Turniu malantaen direkte al {destination} e fino de la vojo"}},fork:{default:{default:"Daru {modifier} e la vojforko",name:"Pluu {modifier} al {way_name}",destination:"Pluu {modifier} direkte al {destination}"},"slight left":{default:"Maldekstren e la vojforko",name:"Pluu maldekstren al {way_name}",destination:"Pluu maldekstren direkte al {destination}"},"slight right":{default:"Dekstren e la vojforko",name:"Pluu dekstren al {way_name}",destination:"Pluu dekstren direkte al {destination}"},"sharp left":{default:"Ege maldekstren e la vojforko",name:"Turniu ege maldekstren al {way_name}",destination:"Turniu ege maldekstren direkte al {destination}"},"sharp right":{default:"Ege dekstren e la vojforko",name:"Turniu ege dekstren al {way_name}",destination:"Turniu ege dekstren direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},merge:{default:{default:"Enveturu {modifier}",name:"Enveturu {modifier} al {way_name}",destination:"Enveturu {modifier} direkte al {destination}"},straight:{default:"Enveturu",name:"Enveturu al {way_name}",destination:"Enveturu direkte al {destination}"},"slight left":{default:"Enveturu de maldekstre",name:"Enveturu de maldekstre al {way_name}",destination:"Enveturu de maldekstre direkte al {destination}"},"slight right":{default:"Enveturu de dekstre",name:"Enveturu de dekstre al {way_name}",destination:"Enveturu de dekstre direkte al {destination}"},"sharp left":{default:"Enveturu de maldekstre",name:"Enveture de maldekstre al {way_name}",destination:"Enveturu de maldekstre direkte al {destination}"},"sharp right":{default:"Enveturu de dekstre",name:"Enveturu de dekstre al {way_name}",destination:"Enveturu de dekstre direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},"new name":{default:{default:"Pluu {modifier}",name:"Pluu {modifier} al {way_name}",destination:"Pluu {modifier} direkte al {destination}"},straight:{default:"Veturu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}"},"sharp left":{default:"Turniu ege maldekstren",name:"Turniu ege maldekstren al {way_name}",destination:"Turniu ege maldekstren direkte al {destination}"},"sharp right":{default:"Turniu ege dekstren",name:"Turniu ege dekstren al {way_name}",destination:"Turniu ege dekstren direkte al {destination}"},"slight left":{default:"Pluu ete maldekstren",name:"Pluu ete maldekstren al {way_name}",destination:"Pluu ete maldekstren direkte al {destination}"},"slight right":{default:"Pluu ete dekstren",name:"Pluu ete dekstren al {way_name}",destination:"Pluu ete dekstren direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},notification:{default:{default:"Pluu {modifier}",name:"Pluu {modifier} al {way_name}",destination:"Pluu {modifier} direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},"off ramp":{default:{default:"Direktiu al enveturejo",name:"Direktiu al enveturejo al {way_name}",destination:"Direktiu al enveturejo direkte al {destination}",exit:"Direktiu al elveturejo {exit}",exit_destination:"Direktiu al elveturejo {exit} direkte al {destination}"},left:{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}",exit:"Direktiu al elveturejo {exit} e maldekstre",exit_destination:"Direktiu al elveturejo {exit} e maldekstre direkte al {destination}"},right:{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}",exit:"Direktiu al {exit} elveturejo e ldekstre",exit_destination:"Direktiu al elveturejo {exit} e dekstre direkte al {destination}"},"sharp left":{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}",exit:"Direktiu al {exit} elveturejo e maldekstre",exit_destination:"Direktiu al elveturejo {exit} e maldekstre direkte al {destination}"},"sharp right":{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}",exit:"Direktiu al elveturejo {exit} e dekstre",exit_destination:"Direktiu al elveturejo {exit} e dekstre direkte al {destination}"},"slight left":{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}",exit:"Direktiu al {exit} elveturejo e maldekstre",exit_destination:"Direktiu al elveturejo {exit} e maldekstre direkte al {destination}"},"slight right":{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}",exit:"Direktiu al {exit} elveturejo e ldekstre",exit_destination:"Direktiu al elveturejo {exit} e dekstre direkte al {destination}"}},"on ramp":{default:{default:"Direktiu al enveturejo",name:"Direktiu al enveturejo al {way_name}",destination:"Direktiu al enveturejo direkte al {destination}"},left:{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}"},right:{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}"},"sharp left":{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}"},"sharp right":{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}"},"slight left":{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}"},"slight right":{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}"}},rotary:{default:{default:{default:"Enveturu trafikcirklegon",name:"Enveturu trafikcirklegon kaj elveturu al {way_name}",destination:"Enveturu trafikcirklegon kaj elveturu direkte al {destination}"},name:{default:"Enveturu {rotary_name}",name:"Enveturu {rotary_name} kaj elveturu al {way_name}",destination:"Enveturu {rotary_name} kaj elveturu direkte al {destination}"},exit:{default:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo",name:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo al {way_name}",destination:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo direkte al {destination}"},name_exit:{default:"Enveturu {rotary_name} kaj sekve al {exit_number} elveturejo",name:"Enveturu {rotary_name} kaj sekve al {exit_number} elveturejo al {way_name}",destination:"Enveturu {rotary_name} kaj sekve al {exit_number} elveturejo direkte al {destination}"}}},roundabout:{default:{exit:{default:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo",name:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo al {way_name}",destination:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo direkte al {destination}"},default:{default:"Enveturu trafikcirklegon",name:"Enveturu trafikcirklegon kaj elveturu al {way_name}",destination:"Enveturu trafikcirklegon kaj elveturu direkte al {destination}"}}},"roundabout turn":{default:{default:"Veturu {modifier}",name:"Veturu {modifier} al {way_name}",destination:"Veturu {modifier} direkte al {destination}"},left:{default:"Turniu maldekstren",name:"Turniu maldekstren al {way_name}",destination:"Turniu maldekstren direkte al {destination}"},right:{default:"Turniu dekstren",name:"Turniu dekstren al {way_name}",destination:"Turniu dekstren direkte al {destination}"},straight:{default:"Pluu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}"}},"exit roundabout":{default:{default:"Elveturu trafikcirklegon",name:"Elveturu trafikcirklegon al {way_name}",destination:"Elveturu trafikcirklegon direkte al {destination}"}},"exit rotary":{default:{default:"Eliru trafikcirklegon",name:"Elveturu trafikcirklegon al {way_name}",destination:"Elveturu trafikcirklegon direkte al {destination}"}},turn:{default:{default:"Veturu {modifier}",name:"Veturu {modifier} al {way_name}",destination:"Veturu {modifier} direkte al {destination}"},left:{default:"Turniu maldekstren",name:"Turniu maldekstren al {way_name}",destination:"Turniu maldekstren direkte al {destination}"},right:{default:"Turniu dekstren",name:"Turniu dekstren al {way_name}",destination:"Turniu dekstren direkte al {destination}"},straight:{default:"Veturu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}"}},"use lane":{no_lanes:{default:"Pluu rekten"},default:{default:"{lane_instruction}"}}}}},{}],27:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"norte",northeast:"noreste",east:"este",southeast:"sureste",south:"sur",southwest:"suroeste",west:"oeste",northwest:"noroeste"},modifier:{left:"a la izquierda",right:"a la derecha","sharp left":"cerrada a la izquierda","sharp right":"cerrada a la derecha","slight left":"ligeramente a la izquierda","slight right":"ligeramente a la derecha",straight:"recto",uturn:"cambio de sentido"},lanes:{xo:"Mantente a la derecha",ox:"Mantente a la izquierda",xox:"Mantente en el medio",oxo:"Mantente a la izquierda o a la derecha"}},modes:{ferry:{default:"Coge el ferry",name:"Coge el ferry {way_name}",destination:"Coge el ferry hacia {destination}"}},phrase:{"two linked by distance":"{instruction_one} y luego en {distance}, {instruction_two}","two linked":"{instruction_one} y luego {instruction_two}","one in distance":"A {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"salida {exit}"},arrive:{default:{default:"Has llegado a tu {nth} destino",upcoming:"Vas a llegar a tu {nth} destino",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}"},left:{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},right:{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"sharp left":{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},"sharp right":{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"slight right":{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"slight left":{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},straight:{default:"Has llegado a tu {nth} destino, en frente",upcoming:"Vas a llegar a tu {nth} destino, en frente",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, en frente"}},continue:{default:{default:"Gire {modifier}",name:"Cruce {modifier} en {way_name}",destination:"Gire {modifier} hacia {destination}",exit:"Gire {modifier} en {way_name}"},straight:{default:"Contina recto",name:"Contina en {way_name}",destination:"Contina hacia {destination}",distance:"Contina recto por {distance}",namedistance:"Contina recto en {way_name} por {distance}"},"sharp left":{default:"Gire a la izquierda",name:"Gire a la izquierda en {way_name}",destination:"Gire a la izquierda hacia {destination}"},"sharp right":{default:"Gire a la derecha",name:"Gire a la derecha en {way_name}",destination:"Gire a la derecha hacia {destination}"},"slight left":{default:"Gire a la izquierda",name:"Doble levementea la izquierda en {way_name}",destination:"Gire a la izquierda hacia {destination}"},"slight right":{default:"Gire a la izquierda",name:"Doble levemente a la derecha en {way_name}",destination:"Gire a la izquierda hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido y contina en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},depart:{default:{default:"Dirgete al {direction}",name:"Dirgete al {direction} por {way_name}",namedistance:"Dirgete al {direction} en {way_name} por {distance}"}},"end of road":{default:{default:"Al final de la calle gira {modifier}",name:"Al final de la calle gira {modifier} por {way_name}",destination:"Al final de la calle gira {modifier} hacia {destination}"},straight:{default:"Al final de la calle contina recto",name:"Al final de la calle contina recto por {way_name}",destination:"Al final de la calle contina recto hacia {destination}"},uturn:{default:"Al final de la calle haz un cambio de sentido",name:"Al final de la calle haz un cambio de sentido en {way_name}",destination:"Al final de la calle haz un cambio de sentido hacia {destination}"}},fork:{default:{default:"Mantente {modifier} en el cruce",name:"Mantente {modifier} por {way_name}",destination:"Mantente {modifier} hacia {destination}"},"slight left":{default:"Mantente a la izquierda en el cruce",name:"Mantente a la izquierda por {way_name}",destination:"Mantente a la izquierda hacia {destination}"},"slight right":{default:"Mantente a la derecha en el cruce",name:"Mantente a la derecha por {way_name}",destination:"Mantente a la derecha hacia {destination}"},"sharp left":{default:"Gira la izquierda en el cruce",name:"Gira a la izquierda por {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha en el cruce",name:"Gira a la derecha por {way_name}",destination:"Gira a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},merge:{default:{default:"Incorprate {modifier}",name:"Incorprate {modifier} por {way_name}",destination:"Incorprate {modifier} hacia {destination}"},straight:{default:"Incorprate",name:"Incorprate por {way_name}",destination:"Incorprate hacia {destination}"},"slight left":{default:"Incorprate a la izquierda",name:"Incorprate a la izquierda por {way_name}",destination:"Incorprate a la izquierda hacia {destination}"},"slight right":{default:"Incorprate a la derecha",name:"Incorprate a la derecha por {way_name}",destination:"Incorprate a la derecha hacia {destination}"},"sharp left":{default:"Incorprate a la izquierda",name:"Incorprate a la izquierda por {way_name}",destination:"Incorprate a la izquierda hacia {destination}"},"sharp right":{default:"Incorprate a la derecha",name:"Incorprate a la derecha por {way_name}",destination:"Incorprate a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},"new name":{default:{default:"Contina {modifier}",name:"Contina {modifier} por {way_name}",destination:"Contina {modifier} hacia {destination}"},straight:{default:"Contina recto",name:"Contina por {way_name}",destination:"Contina hacia {destination}"},"sharp left":{default:"Gira a la izquierda",name:"Gira a la izquierda por {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha",name:"Gira a la derecha por {way_name}",destination:"Gira a la derecha hacia {destination}"},"slight left":{default:"Contina ligeramente por la izquierda",name:"Contina ligeramente por la izquierda por {way_name}",destination:"Contina ligeramente por la izquierda hacia {destination}"},"slight right":{default:"Contina ligeramente por la derecha",name:"Contina ligeramente por la derecha por {way_name}",destination:"Contina ligeramente por la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},notification:{default:{default:"Contina {modifier}",name:"Contina {modifier} por {way_name}",destination:"Contina {modifier} hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},"off ramp":{default:{default:"Coge la cuesta abajo",name:"Coge la cuesta abajo por {way_name}",destination:"Coge la cuesta abajo hacia {destination}",exit:"Coge la cuesta abajo {exit}",exit_destination:"Coge la cuesta abajo {exit} hacia {destination}"},left:{default:"Coge la cuesta abajo de la izquierda",name:"Coge la cuesta abajo de la izquierda por {way_name}",destination:"Coge la cuesta abajo de la izquierda hacia {destination}",exit:"Coge la cuesta abajo {exit} a tu izquierda",exit_destination:"Coge la cuesta abajo {exit} a tu izquierda hacia {destination}"},right:{default:"Coge la cuesta abajo de la derecha",name:"Coge la cuesta abajo de la derecha por {way_name}",destination:"Coge la cuesta abajo de la derecha hacia {destination}",exit:"Coge la cuesta abajo {exit}",exit_destination:"Coge la cuesta abajo {exit} hacia {destination}"},"sharp left":{default:"Coge la cuesta abajo de la izquierda",name:"Coge la cuesta abajo de la izquierda por {way_name}",destination:"Coge la cuesta abajo de la izquierda hacia {destination}",exit:"Coge la cuesta abajo {exit} a tu izquierda",exit_destination:"Coge la cuesta abajo {exit} a tu izquierda hacia {destination}"},"sharp right":{default:"Coge la cuesta abajo de la derecha",name:"Coge la cuesta abajo de la derecha por {way_name}",destination:"Coge la cuesta abajo de la derecha hacia {destination}",exit:"Coge la cuesta abajo {exit}",exit_destination:"Coge la cuesta abajo {exit} hacia {destination}"},"slight left":{default:"Coge la cuesta abajo de la izquierda",name:"Coge la cuesta abajo de la izquierda por {way_name}",destination:"Coge la cuesta abajo de la izquierda hacia {destination}",exit:"Coge la cuesta abajo {exit} a tu izquierda",exit_destination:"Coge la cuesta abajo{exit} a tu izquierda hacia {destination}"},"slight right":{default:"Coge la cuesta abajo de la derecha",name:"Coge la cuesta abajo de la derecha por {way_name}",destination:"Coge la cuesta abajo de la derecha hacia {destination}",exit:"Coge la cuesta abajo {exit}",exit_destination:"Coge la cuesta abajo {exit} hacia {destination}"}},"on ramp":{default:{default:"Coge la cuesta",name:"Coge la cuesta por {way_name}",destination:"Coge la cuesta hacia {destination}"},left:{default:"Coge la cuesta de la izquierda",name:"Coge la cuesta de la izquierda por {way_name}",destination:"Coge la cuesta de la izquierda hacia {destination}"},right:{default:"Coge la cuesta de la derecha",name:"Coge la cuesta de la derecha por {way_name}",destination:"Coge la cuesta de la derecha hacia {destination}"},"sharp left":{default:"Coge la cuesta de la izquierda",name:"Coge la cuesta de la izquierda por {way_name}",destination:"Coge la cuesta de la izquierda hacia {destination}"},"sharp right":{default:"Coge la cuesta de la derecha",name:"Coge la cuesta de la derecha por {way_name}",destination:"Coge la cuesta de la derecha hacia {destination}"},"slight left":{default:"Coge la cuesta de la izquierda",name:"Coge la cuesta de la izquierda por {way_name}",destination:"Coge la cuesta de la izquierda hacia {destination}"},"slight right":{default:"Coge la cuesta de la derecha",name:"Coge la cuesta de la derecha por {way_name}",destination:"Coge la cuesta de la derecha hacia {destination}"}},rotary:{default:{default:{default:"Incorprate en la rotonda",name:"En la rotonda sal por {way_name}",destination:"En la rotonda sal hacia {destination}"},name:{default:"En {rotary_name}",name:"En {rotary_name} sal por {way_name}",destination:"En {rotary_name} sal hacia {destination}"},exit:{default:"En la rotonda toma la {exit_number} salida",name:"En la rotonda toma la {exit_number} salida por {way_name}",destination:"En la rotonda toma la {exit_number} salida hacia {destination}"},name_exit:{default:"En {rotary_name} toma la {exit_number} salida",name:"En {rotary_name} toma la {exit_number} salida por {way_name}",destination:"En {rotary_name} toma la {exit_number} salida hacia {destination}"}}},roundabout:{default:{exit:{default:"En la rotonda toma la {exit_number} salida",name:"En la rotonda toma la {exit_number} salida por {way_name}",destination:"En la rotonda toma la {exit_number} salida hacia {destination}"},default:{default:"Incorprate en la rotonda",name:"Incorprate en la rotonda y sal en {way_name}",destination:"Incorprate en la rotonda y sal hacia {destination}"}}},"roundabout turn":{default:{default:"Siga {modifier}",name:"Siga {modifier} en {way_name}",destination:"Siga {modifier} hacia {destination}"},left:{default:"Gire a la izquierda",name:"Gire a la izquierda en {way_name}",destination:"Gire a la izquierda hacia {destination}"},right:{default:"Gire a la derecha",name:"Gire a la derecha en {way_name}",destination:"Gire a la derecha hacia {destination}"},straight:{default:"Contina recto",name:"Contina recto por {way_name}",destination:"Contina recto hacia {destination}"}},"exit roundabout":{default:{default:"Sal la rotonda",name:"Toma la salida por {way_name}",destination:"Toma la salida hacia {destination}"}},"exit rotary":{default:{default:"Sal la rotonda",name:"Toma la salida por {way_name}",destination:"Toma la salida hacia {destination}"}},turn:{default:{default:"Gira {modifier}",name:"Gira {modifier} por {way_name}",destination:"Gira {modifier} hacia {destination}"},left:{default:"Gira a la izquierda",name:"Gira a la izquierda por {way_name}",destination:"Gira a la izquierda hacia {destination}"},right:{default:"Gira a la derecha",name:"Gira a la derecha por {way_name}",destination:"Gira a la derecha hacia {destination}"},straight:{default:"Contina recto",name:"Contina recto por {way_name}",destination:"Contina recto hacia {destination}"}},"use lane":{no_lanes:{default:"Contina recto"},default:{default:"{lane_instruction}"}}}}},{}],28:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"norte",northeast:"noreste",east:"este",southeast:"sureste",south:"sur",southwest:"suroeste",west:"oeste",northwest:"noroeste"},modifier:{left:"izquierda",right:"derecha","sharp left":"cerrada a la izquierda","sharp right":"cerrada a la derecha","slight left":"levemente a la izquierda","slight right":"levemente a la derecha",straight:"recto",uturn:"cambio de sentido"},lanes:{xo:"Mantente a la derecha",ox:"Mantente a la izquierda",xox:"Mantente en el medio",oxo:"Mantente a la izquierda o derecha"}},modes:{ferry:{default:"Coge el ferry",name:"Coge el ferry {way_name}",destination:"Coge el ferry a {destination}"}},phrase:{"two linked by distance":"{instruction_one} y luego a {distance}, {instruction_two}","two linked":"{instruction_one} y luego {instruction_two}","one in distance":"A {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"salida {exit}"},arrive:{default:{default:"Has llegado a tu {nth} destino",upcoming:"Vas a llegar a tu {nth} destino",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}"},left:{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},right:{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"sharp left":{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},"sharp right":{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"slight right":{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"slight left":{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},straight:{default:"Has llegado a tu {nth} destino, en frente",upcoming:"Vas a llegar a tu {nth} destino, en frente",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, en frente"}},continue:{default:{default:"Gira a {modifier}",name:"Cruza a la{modifier}  en {way_name}",destination:"Gira a {modifier} hacia {destination}",exit:"Gira a {modifier} en {way_name}"},straight:{default:"Contina recto",name:"Contina en {way_name}",destination:"Contina hacia {destination}",distance:"Contina recto por {distance}",namedistance:"Contina recto en {way_name} por {distance}"},"sharp left":{default:"Gira a la izquierda",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},"slight left":{default:"Gira a la izquierda",name:"Dobla levemente a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},"slight right":{default:"Gira a la izquierda",name:"Dobla levemente a la derecha en {way_name}",destination:"Gira a la izquierda hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido y contina en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},depart:{default:{default:"Ve a {direction}",name:"Ve a {direction} en {way_name}",namedistance:"Ve a {direction} en {way_name} por {distance}"}},"end of road":{default:{default:"Gira  a {modifier}",name:"Gira a {modifier} en {way_name}",destination:"Gira a {modifier} hacia {destination}"},straight:{default:"Contina recto",name:"Contina recto en {way_name}",destination:"Contina recto hacia {destination}"},uturn:{default:"Haz un cambio de sentido al final de la via",name:"Haz un cambio de sentido en {way_name} al final de la via",destination:"Haz un cambio de sentido hacia {destination} al final de la via"}},fork:{default:{default:"Mantente  {modifier} en el cruza",name:"Mantente {modifier} en {way_name}",destination:"Mantente {modifier} hacia {destination}"},"slight left":{default:"Mantente a la izquierda en el cruza",name:"Mantente a la izquierda en {way_name}",destination:"Mantente a la izquierda hacia {destination}"},"slight right":{default:"Mantente a la derecha en el cruza",name:"Mantente a la derecha en {way_name}",destination:"Mantente a la derecha hacia {destination}"},"sharp left":{default:"Gira a la izquierda en el cruza",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha en el cruza",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},merge:{default:{default:"Incorprate a {modifier}",name:"Incorprate a {modifier} en {way_name}",destination:"Incorprate a {modifier} hacia {destination}"},straight:{default:"Incorprate",name:"Incorprate a {way_name}",destination:"Incorprate hacia {destination}"},"slight left":{default:"Incorprate a la izquierda",name:"Incorprate a la izquierda en {way_name}",destination:"Incorprate a la izquierda hacia {destination}"},"slight right":{default:"Incorprate a la derecha",name:"Incorprate a la derecha en {way_name}",destination:"Incorprate a la derecha hacia {destination}"},"sharp left":{default:"Incorprate a la izquierda",name:"Incorprate a la izquierda en {way_name}",destination:"Incorprate a la izquierda hacia {destination}"},"sharp right":{default:"Incorprate a la derecha",name:"Incorprate a la derecha en {way_name}",destination:"Incorprate a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},"new name":{default:{default:"Contina {modifier}",name:"Contina {modifier} en {way_name}",destination:"Contina {modifier} hacia {destination}"},straight:{default:"Contina recto",name:"Contina en {way_name}",destination:"Contina hacia {destination}"},"sharp left":{default:"Gira a la izquierda",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},"slight left":{default:"Contina levemente a la izquierda",name:"Contina levemente a la izquierda en {way_name}",destination:"Contina levemente a la izquierda hacia {destination}"},"slight right":{default:"Contina levemente a la derecha",name:"Contina levemente a la derecha en {way_name}",destination:"Contina levemente a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},notification:{default:{default:"Contina {modifier}",name:"Contina {modifier} en {way_name}",destination:"Contina {modifier} hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},"off ramp":{default:{default:"Toma la salida",name:"Toma la salida en {way_name}",destination:"Toma la salida hacia {destination}",exit:"Toma la salida {exit}",exit_destination:"Toma la salida {exit} hacia {destination}"},left:{default:"Toma la salida en la izquierda",name:"Toma la salida en la izquierda en {way_name}",destination:"Toma la salida en la izquierda en {destination}",exit:"Toma la salida {exit} en la izquierda",exit_destination:"Toma la salida {exit} en la izquierda hacia {destination}"},right:{default:"Toma la salida en la derecha",name:"Toma la salida en la derecha en {way_name}",destination:"Toma la salida en la derecha hacia {destination}",exit:"Toma la salida {exit} en la derecha",exit_destination:"Toma la salida {exit} en la derecha hacia {destination}"},"sharp left":{default:"Ve cuesta abajo en la izquierda",name:"Ve cuesta abajo en la izquierda en {way_name}",destination:"Ve cuesta abajo en la izquierda hacia {destination}",exit:"Toma la salida {exit} en la izquierda",exit_destination:"Toma la salida {exit} en la izquierda hacia {destination}"},"sharp right":{default:"Ve cuesta abajo en la derecha",name:"Ve cuesta abajo en la derecha en {way_name}",destination:"Ve cuesta abajo en la derecha hacia {destination}",exit:"Toma la salida {exit} en la derecha",exit_destination:"Toma la salida {exit} en la derecha hacia {destination}"},"slight left":{default:"Ve cuesta abajo en la izquierda",name:"Ve cuesta abajo en la izquierda en {way_name}",destination:"Ve cuesta abajo en la izquierda hacia {destination}",exit:"Toma la salida {exit} en la izquierda",exit_destination:"Toma la salida {exit} en la izquierda hacia {destination}"},"slight right":{default:"Toma la salida en la derecha",name:"Toma la salida en la derecha en {way_name}",destination:"Toma la salida en la derecha hacia {destination}",exit:"Toma la salida {exit} en la derecha",exit_destination:"Toma la salida {exit} en la derecha hacia {destination}"}},"on ramp":{default:{default:"Toma la rampa",name:"Toma la rampa en {way_name}",destination:"Toma la rampa hacia {destination}"},left:{default:"Toma la rampa en la izquierda",name:"Toma la rampa en la izquierda en {way_name}",destination:"Toma la rampa en la izquierda hacia {destination}"},right:{default:"Toma la rampa en la derecha",name:"Toma la rampa en la derecha en {way_name}",destination:"Toma la rampa en la derecha hacia {destination}"},"sharp left":{default:"Toma la rampa en la izquierda",name:"Toma la rampa en la izquierda en {way_name}",destination:"Toma la rampa en la izquierda hacia {destination}"},"sharp right":{default:"Toma la rampa en la derecha",name:"Toma la rampa en la derecha en {way_name}",destination:"Toma la rampa en la derecha hacia {destination}"},"slight left":{default:"Toma la rampa en la izquierda",name:"Toma la rampa en la izquierda en {way_name}",destination:"Toma la rampa en la izquierda hacia {destination}"},"slight right":{default:"Toma la rampa en la derecha",name:"Toma la rampa en la derecha en {way_name}",destination:"Toma la rampa en la derecha hacia {destination}"}},rotary:{default:{default:{default:"Entra en la rotonda",name:"Entra en la rotonda y sal en {way_name}",destination:"Entra en la rotonda y sal hacia {destination}"},name:{default:"Entra en {rotary_name}",name:"Entra en {rotary_name} y sal en {way_name}",destination:"Entra en {rotary_name} y sal hacia {destination}"},exit:{default:"Entra en la rotonda y toma la {exit_number} salida",name:"Entra en la rotonda y toma la {exit_number} salida a {way_name}",destination:"Entra en la rotonda y toma la {exit_number} salida hacia {destination}"},name_exit:{default:"Entra en {rotary_name} y coge la {exit_number} salida",name:"Entra en {rotary_name} y coge la {exit_number} salida en {way_name}",destination:"Entra en {rotary_name} y coge la {exit_number} salida hacia {destination}"}}},roundabout:{default:{exit:{default:"Entra en la rotonda y toma la {exit_number} salida",name:"Entra en la rotonda y toma la {exit_number} salida a {way_name}",destination:"Entra en la rotonda y toma la {exit_number} salida hacia {destination}"},default:{default:"Entra en la rotonda",name:"Entra en la rotonda y sal en {way_name}",destination:"Entra en la rotonda y sal hacia {destination}"}}},"roundabout turn":{default:{default:"Sigue {modifier}",name:"Sigue {modifier} en {way_name}",destination:"Sigue {modifier} hacia {destination}"},left:{default:"Gira a la izquierda",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},right:{default:"Gira a la derecha",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},straight:{default:"Contina recto",name:"Contina recto en {way_name}",destination:"Contina recto hacia {destination}"}},"exit roundabout":{default:{default:"Sal la rotonda",name:"Sal la rotonda en {way_name}",destination:"Sal la rotonda hacia {destination}"}},"exit rotary":{default:{default:"Sal la rotonda",name:"Sal la rotonda en {way_name}",destination:"Sal la rotonda hacia {destination}"}},turn:{default:{default:"Sigue {modifier}",name:"Sigue {modifier} en {way_name}",destination:"Sigue {modifier} hacia {destination}"},left:{default:"Gira a la izquierda",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},right:{default:"Gira a la derecha",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},straight:{default:"Ve recto",name:"Ve recto en {way_name}",destination:"Ve recto hacia {destination}"}},"use lane":{no_lanes:{default:"Contina recto"},default:{default:"{lane_instruction}"}}}}},{}],29:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1.",2:"2.",3:"3.",4:"4.",5:"5.",6:"6.",7:"7.",8:"8.",9:"9.",10:"10."},direction:{north:"pohjoiseen",northeast:"koilliseen",east:"itn",southeast:"kaakkoon",south:"eteln",southwest:"lounaaseen",west:"lnteen",northwest:"luoteeseen"},modifier:{left:"vasemmall(e/a)",right:"oikeall(e/a)","sharp left":"jyrksti vasempaan","sharp right":"jyrksti oikeaan","slight left":"loivasti vasempaan","slight right":"loivasti oikeaan",straight:"suoraan eteenpin",uturn:"U-knns"},lanes:{xo:"Pysy oikealla",ox:"Pysy vasemmalla",xox:"Pysy keskell",oxo:"Pysy vasemmalla tai oikealla"}},modes:{ferry:{default:"Aja lautalle",name:"Aja lautalle {way_name}",destination:"Aja lautalle, jonka mrnp on {destination}"}},phrase:{"two linked by distance":"{instruction_one}, sitten {distance} pst, {instruction_two}","two linked":"{instruction_one}, sitten {instruction_two}","one in distance":"{distance} pst, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"{exit}"},arrive:{default:{default:"Olet saapunut {nth} mrnphsi",upcoming:"Saavut {nth} mrnphsi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}"},left:{default:"Olet saapunut {nth} mrnphsi, joka on vasemmalla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on vasemmalla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on vasemmalla puolellasi"},right:{default:"Olet saapunut {nth} mrnphsi, joka on oikealla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on oikealla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on oikealla puolellasi"},"sharp left":{default:"Olet saapunut {nth} mrnphsi, joka on vasemmalla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on vasemmalla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on vasemmalla puolellasi"},"sharp right":{default:"Olet saapunut {nth} mrnphsi, joka on oikealla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on oikealla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on oikealla puolellasi"},"slight right":{default:"Olet saapunut {nth} mrnphsi, joka on oikealla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on oikealla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on oikealla puolellasi"},"slight left":{default:"Olet saapunut {nth} mrnphsi, joka on vasemmalla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on vasemmalla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on vasemmalla puolellasi"},straight:{default:"Olet saapunut {nth} mrnphsi, joka on suoraan edesssi",upcoming:"Saavut {nth} mrnphsi, suoraan edess",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on suoraan edesssi"}},continue:{default:{default:"Knny {modifier}",name:"Knny {modifier} pysyksesi tiell {way_name}",destination:"Knny {modifier} suuntana {destination}",exit:"Knny {modifier} tielle {way_name}"},straight:{default:"Jatka suoraan eteenpin",name:"Jatka suoraan pysyksesi tiell {way_name}",destination:"Jatka suuntana {destination}",distance:"Jatka suoraan {distance}",namedistance:"Jatka tiell {way_name} {distance}"},"sharp left":{default:"Jatka jyrksti vasempaan",name:"Jatka jyrksti vasempaan pysyksesi tiell {way_name}",destination:"Jatka jyrksti vasempaan suuntana {destination}"},"sharp right":{default:"Jatka jyrksti oikeaan",name:"Jatka jyrksti oikeaan pysyksesi tiell {way_name}",destination:"Jatka jyrksti oikeaan suuntana {destination}"},"slight left":{default:"Jatka loivasti vasempaan",name:"Jatka loivasti vasempaan pysyksesi tiell {way_name}",destination:"Jatka loivasti vasempaan suuntana {destination}"},"slight right":{default:"Jatka loivasti oikeaan",name:"Jatka loivasti oikeaan pysyksesi tiell {way_name}",destination:"Jatka loivasti oikeaan suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns ja jatka tiet {way_name}",destination:"Tee U-knns suuntana {destination}"}},depart:{default:{default:"Aja {direction}",name:"Aja tiet {way_name} {direction}",namedistance:"Aja {distance} {direction} tiet {way_name} "}},"end of road":{default:{default:"Knny {modifier}",name:"Knny {modifier} tielle {way_name}",destination:"Knny {modifier} suuntana {destination}"},straight:{default:"Jatka suoraan eteenpin",name:"Jatka suoraan eteenpin tielle {way_name}",destination:"Jatka suoraan eteenpin suuntana {destination}"},uturn:{default:"Tien pss tee U-knns",name:"Tien pss tee U-knns tielle {way_name}",destination:"Tien pss tee U-knns suuntana {destination}"}},fork:{default:{default:"Jatka tienhaarassa {modifier}",name:"Jatka {modifier} tielle {way_name}",destination:"Jatka {modifier} suuntana {destination}"},"slight left":{default:"Pysy vasemmalla tienhaarassa",name:"Pysy vasemmalla tielle {way_name}",destination:"Pysy vasemmalla suuntana {destination}"},"slight right":{default:"Pysy oikealla tienhaarassa",name:"Pysy oikealla tielle {way_name}",destination:"Pysy oikealla suuntana {destination}"},"sharp left":{default:"Knny tienhaarassa jyrksti vasempaan",name:"Knny tienhaarassa jyrksti vasempaan tielle {way_name}",destination:"Knny tienhaarassa jyrksti vasempaan suuntana {destination}"},"sharp right":{default:"Knny tienhaarassa jyrksti oikeaan",name:"Knny tienhaarassa jyrksti oikeaan tielle {way_name}",destination:"Knny tienhaarassa jyrksti oikeaan suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns tielle {way_name}",destination:"Tee U-knns suuntana {destination}"}},merge:{default:{default:"Liity {modifier}",name:"Liity {modifier}, tielle {way_name}",destination:"Liity {modifier}, suuntana {destination}"},straight:{default:"Liity",name:"Liity tielle {way_name}",destination:"Liity suuntana {destination}"},"slight left":{default:"Liity vasemmalle",name:"Liity vasemmalle, tielle {way_name}",destination:"Liity vasemmalle, suuntana {destination}"},"slight right":{default:"Liity oikealle",name:"Liity oikealle, tielle {way_name}",destination:"Liity oikealle, suuntana {destination}"},"sharp left":{default:"Liity vasemmalle",name:"Liity vasemmalle, tielle {way_name}",destination:"Liity vasemmalle, suuntana {destination}"},"sharp right":{default:"Liity oikealle",name:"Liity oikealle, tielle {way_name}",destination:"Liity oikealle, suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns tielle {way_name}",destination:"Tee U-knns suuntana {destination}"}},"new name":{default:{default:"Jatka {modifier}",name:"Jatka {modifier} tielle {way_name}",destination:"Jatka {modifier} suuntana {destination}"},straight:{default:"Jatka suoraan eteenpin",name:"Jatka tielle {way_name}",destination:"Jatka suuntana {destination}"},"sharp left":{default:"Knny jyrksti vasempaan",name:"Knny jyrksti vasempaan tielle {way_name}",destination:"Knny jyrksti vasempaan suuntana {destination}"},"sharp right":{default:"Knny jyrksti oikeaan",name:"Knny jyrksti oikeaan tielle {way_name}",destination:"Knny jyrksti oikeaan suuntana {destination}"},"slight left":{default:"Jatka loivasti vasempaan",name:"Jatka loivasti vasempaan tielle {way_name}",destination:"Jatka loivasti vasempaan suuntana {destination}"},"slight right":{default:"Jatka loivasti oikeaan",name:"Jatka loivasti oikeaan tielle {way_name}",destination:"Jatka loivasti oikeaan suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns tielle {way_name}",destination:"Tee U-knns suuntana {destination}"}},notification:{default:{default:"Jatka {modifier}",name:"Jatka {modifier} tielle {way_name}",destination:"Jatka {modifier} suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns tielle {way_name}",destination:"Tee U-knns suuntana {destination}"}},"off ramp":{default:{default:"Aja erkanemiskaistalle",name:"Aja erkanemiskaistaa tielle {way_name}",destination:"Aja erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit}",exit_destination:"Ota poistuminen {exit}, suuntana {destination}"},left:{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} vasemmalla",exit_destination:"Ota poistuminen {exit} vasemmalla, suuntana {destination}"},right:{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} oikealla",exit_destination:"Ota poistuminen {exit} oikealla, suuntana {destination}"},"sharp left":{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} vasemmalla",exit_destination:"Ota poistuminen {exit} vasemmalla, suuntana {destination}"},"sharp right":{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} oikealla",exit_destination:"Ota poistuminen {exit} oikealla, suuntana {destination}"},"slight left":{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} vasemmalla",exit_destination:"Ota poistuminen {exit} vasemmalla, suuntana {destination}"},"slight right":{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} oikealla",exit_destination:"Ota poistuminen {exit} oikealla, suuntana {destination}"}},"on ramp":{default:{default:"Aja erkanemiskaistalle",name:"Aja erkanemiskaistaa tielle {way_name}",destination:"Aja erkanemiskaistalle suuntana {destination}"},left:{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}"},right:{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}"},"sharp left":{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}"},"sharp right":{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}"},"slight left":{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}"},"slight right":{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}"}},rotary:{default:{default:{default:"Aja liikenneympyrn",name:"Aja liikenneympyrn ja valitse erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn ja valitse erkanemiskaista suuntana {destination}"},name:{default:"Aja liikenneympyrn {rotary_name}",name:"Aja liikenneympyrn {rotary_name} ja valitse erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn {rotary_name} ja valitse erkanemiskaista suuntana {destination}"},exit:{default:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista",name:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista suuntana {destination}"},name_exit:{default:"Aja liikenneympyrn {rotary_name} ja valitse {exit_number} erkanemiskaista",name:"Aja liikenneympyrn {rotary_name} ja valitse {exit_number} erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn {rotary_name} ja valitse {exit_number} erkanemiskaista suuntana {destination}"}}},roundabout:{default:{exit:{default:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista",name:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista suuntana {destination}"},default:{default:"Aja liikenneympyrn",name:"Aja liikenneympyrn ja valitse erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn ja valitse erkanemiskaista suuntana {destination}"}}},"roundabout turn":{default:{default:"Knny {modifier}",name:"Knny {modifier} tielle {way_name}",destination:"Knny {modifier} suuntana {destination}"},left:{default:"Knny vasempaan",name:"Knny vasempaan tielle {way_name}",destination:"Knny vasempaan suuntana {destination}"},right:{default:"Knny oikeaan",name:"Knny oikeaan tielle {way_name}",destination:"Knny oikeaan suuntana {destination}"},straight:{default:"Jatka suoraan eteenpin",name:"Jatka suoraan eteenpin tielle {way_name}",destination:"Jatka suoraan eteenpin suuntana {destination}"}},"exit roundabout":{default:{default:"Poistu liikenneympyrst",name:"Poistu liikenneympyrst tielle {way_name}",destination:"Poistu liikenneympyrst suuntana {destination}"}},"exit rotary":{default:{default:"Poistu liikenneympyrst",name:"Poistu liikenneympyrst tielle {way_name}",destination:"Poistu liikenneympyrst suuntana {destination}"}},turn:{default:{default:"Knny {modifier}",name:"Knny {modifier} tielle {way_name}",destination:"Knny {modifier} suuntana {destination}"},left:{default:"Knny vasempaan",name:"Knny vasempaan tielle {way_name}",destination:"Knny vasempaan suuntana {destination}"},right:{default:"Knny oikeaan",name:"Knny oikeaan tielle {way_name}",destination:"Knny oikeaan suuntana {destination}"},straight:{default:"Aja suoraan eteenpin",name:"Aja suoraan eteenpin tielle {way_name}",destination:"Aja suoraan eteenpin suuntana {destination}"}},"use lane":{no_lanes:{default:"Jatka suoraan eteenpin"},default:{default:"{lane_instruction}"}}}}},{}],30:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"premire",2:"seconde",3:"troisime",4:"quatrime",5:"cinquime",6:"sixime",7:"septime",8:"huitime",9:"neuvime",10:"dixime"},direction:{north:"le nord",northeast:"le nord-est",east:"lest",southeast:"le sud-est",south:"le sud",southwest:"le sud-ouest",west:"louest",northwest:"le nord-ouest"},modifier:{left:" gauche",right:" droite","sharp left":"franchement  gauche","sharp right":"franchement  droite","slight left":"lgrement  gauche","slight right":"lgrement  droite",straight:"tout droit",uturn:"demi-tour"},lanes:{xo:"Tenir la droite",ox:"Tenir la gauche",xox:"Rester au milieu",oxo:"Tenir la gauche ou la droite"}},modes:{ferry:{default:"Prendre le ferry",name:"Prendre le ferry {way_name:article}",destination:"Prendre le ferry en direction {destination:preposition}"}},phrase:{"two linked by distance":"{instruction_one}, puis, dans {distance}, {instruction_two}","two linked":"{instruction_one}, puis {instruction_two}","one in distance":"Dans {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"sortie n{exit}"},arrive:{default:{default:"Vous tes arriv  votre {nth} destination",upcoming:"Vous arriverez  votre {nth} destination",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}"},left:{default:"Vous tes arriv  votre {nth} destination, sur la gauche",upcoming:"Vous arriverez  votre {nth} destination, sur la gauche",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}, sur la gauche"},right:{default:"Vous tes arriv  votre {nth} destination, sur la droite",upcoming:"Vous arriverez  votre {nth} destination, sur la droite",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv   {waypoint_name:arrival}, sur la droite"},"sharp left":{default:"Vous tes arriv  votre {nth} destination, sur la gauche",upcoming:"Vous arriverez  votre {nth} destination, sur la gauche",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}, sur la gauche"},"sharp right":{default:"Vous tes arriv  votre {nth} destination, sur la droite",upcoming:"Vous arriverez  votre {nth} destination, sur la droite",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}, sur la droite"},"slight right":{default:"Vous tes arriv  votre {nth} destination, sur la droite",upcoming:"Vous arriverez  votre {nth} destination, sur la droite",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}, sur la droite"},"slight left":{default:"Vous tes arriv  votre {nth} destination, sur la gauche",upcoming:"Vous arriverez  votre {nth} destination, sur la gauche",short:"Vous tes arriv","short-upcoming":"Vous tes arriv",named:"Vous tes arriv {waypoint_name:arrival}, sur la gauche"},straight:{default:"Vous tes arriv  votre {nth} destination, droit devant",upcoming:"Vous arriverez  votre {nth} destination, droit devant",short:"Vous tes arriv","short-upcoming":"Vous tes arriv",named:"Vous tes arriv {waypoint_name:arrival}, droit devant"}},continue:{default:{default:"Tourner {modifier}",name:"Tourner {modifier} pour rester sur {way_name:article}",destination:"Tourner {modifier} en direction {destination:preposition}",exit:"Tourner {modifier} sur {way_name:article}"},straight:{default:"Continuer tout droit",name:"Continuer tout droit pour rester sur {way_name:article}",destination:"Continuer tout droit en direction {destination:preposition}",distance:"Continuer tout droit sur {distance}",namedistance:"Continuer sur {way_name:article} sur {distance}"},"sharp left":{default:"Tourner franchement  gauche",name:"Tourner franchement  gauche pour rester sur {way_name:article}",destination:"Tourner franchement  gauche en direction {destination:preposition}"},"sharp right":{default:"Tourner franchement  droite",name:"Tourner franchement  droite pour rester sur {way_name:article}",destination:"Tourner franchement  droite en direction {destination:preposition}"},"slight left":{default:"Tourner lgrement  gauche",name:"Tourner lgrement  gauche pour rester sur {way_name:article}",destination:"Tourner lgrement  gauche en direction {destination:preposition}"},"slight right":{default:"Tourner lgrement  droite",name:"Tourner lgrement  droite pour rester sur {way_name:article}",destination:"Tourner lgrement  droite en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour et continuer sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},depart:{default:{default:"Se diriger vers {direction}",name:"Se diriger vers {direction} sur {way_name:article}",namedistance:"Se diriger vers {direction} sur {way_name:article} sur {distance}"}},"end of road":{default:{default:"Tourner {modifier}",name:"Tourner {modifier} sur {way_name:article}",destination:"Tourner {modifier} en direction {destination:preposition}"},straight:{default:"Continuer tout droit",name:"Continuer tout droit sur {way_name:article}",destination:"Continuer tout droit en direction {destination:preposition}"},uturn:{default:"Faire demi-tour  la fin de la route",name:"Faire demi-tour  la fin {way_name:preposition}",destination:"Faire demi-tour  la fin de la route en direction {destination:preposition}"}},fork:{default:{default:"Tenir {modifier}  lembranchement",name:"Tenir {modifier} sur {way_name:article}",destination:"Tenir {modifier} en direction {destination:preposition}"},"slight left":{default:"Tenir la gauche  lembranchement",name:"Tenir la gauche sur {way_name:article}",destination:"Tenir la gauche en direction {destination:preposition}"},"slight right":{default:"Tenir la droite  lembranchement",name:"Tenir la droite sur {way_name:article}",destination:"Tenir la droite en direction {destination:preposition}"},"sharp left":{default:"Tourner franchement  gauche  lembranchement",name:"Tourner franchement  gauche sur {way_name:article}",destination:"Tourner franchement  gauche en direction {destination:preposition}"},"sharp right":{default:"Tourner franchement  droite  lembranchement",name:"Tourner franchement  droite sur {way_name:article}",destination:"Tourner franchement  droite en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},merge:{default:{default:"Sinsrer {modifier}",name:"Sinsrer {modifier} sur {way_name:article}",destination:"Sinsrer {modifier} en direction {destination:preposition}"},straight:{default:"Sinsrer",name:"Sinsrer sur {way_name:article}",destination:"Sinsrer en direction {destination:preposition}"},"slight left":{default:"Sinsrer lgrement  gauche",name:"Sinsrer lgrement  gauche sur {way_name:article}",destination:"Sinsrer lgrement  gauche en direction {destination:preposition}"},"slight right":{default:"Sinsrer lgrement  droite",name:"Sinsrer lgrement  droite sur {way_name:article}",destination:"Sinsrer  droite en direction {destination:preposition}"},"sharp left":{default:"Sinsrer  gauche",name:"Sinsrer  gauche sur {way_name:article}",destination:"Sinsrer  gauche en direction {destination:preposition}"},"sharp right":{default:"Sinsrer  droite",name:"Sinsrer  droite sur {way_name:article}",destination:"Sinsrer  droite en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},"new name":{default:{default:"Continuer {modifier}",name:"Continuer {modifier} sur {way_name:article}",destination:"Continuer {modifier} en direction {destination:preposition}"},straight:{default:"Continuer tout droit",name:"Continuer tout droit sur {way_name:article}",destination:"Continuer tout droit en direction {destination:preposition}"},"sharp left":{default:"Tourner franchement  gauche",name:"Tourner franchement  gauche sur {way_name:article}",destination:"Tourner franchement  gauche en direction {destination:preposition}"},"sharp right":{default:"Tourner franchement  droite",name:"Tourner franchement  droite sur {way_name:article}",destination:"Tourner franchement  droite en direction {destination:preposition}"},"slight left":{default:"Continuer lgrement  gauche",name:"Continuer lgrement  gauche sur {way_name:article}",destination:"Continuer lgrement  gauche en direction {destination:preposition}"},"slight right":{default:"Continuer lgrement  droite",name:"Continuer lgrement  droite sur {way_name:article}",destination:"Continuer lgrement  droite en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},notification:{default:{default:"Continuer {modifier}",name:"Continuer {modifier} sur {way_name:article}",destination:"Continuer {modifier} en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},"off ramp":{default:{default:"Prendre la sortie",name:"Prendre la sortie sur {way_name:article}",destination:"Prendre la sortie en direction {destination:preposition}",exit:"Prendre la sortie {exit}",exit_destination:"Prendre la sortie {exit} en direction {destination:preposition}"},left:{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la gauche",exit_destination:"Prendre la sortie {exit} sur la gauche en direction {destination:preposition}"},right:{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la droite",exit_destination:"Prendre la sortie {exit} sur la droite en direction {destination:preposition}"},"sharp left":{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la gauche",exit_destination:"Prendre la sortie {exit} sur la gauche en direction {destination:preposition}"},"sharp right":{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la droite",exit_destination:"Prendre la sortie {exit} sur la droite en direction {destination:preposition}"},"slight left":{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la gauche",exit_destination:"Prendre la sortie {exit} sur la gauche en direction {destination:preposition}"},"slight right":{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la droite",exit_destination:"Prendre la sortie {exit} sur la droite en direction {destination:preposition}"}},"on ramp":{default:{default:"Prendre la sortie",name:"Prendre la sortie sur {way_name:article}",destination:"Prendre la sortie en direction {destination:preposition}"},left:{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}"},right:{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}"},"sharp left":{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}"},"sharp right":{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}"},"slight left":{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}"},"slight right":{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}"}},rotary:{default:{default:{default:"Prendre le rond-point",name:"Prendre le rond-point, puis sortir sur {way_name:article}",destination:"Prendre le rond-point, puis sortir en direction {destination:preposition}"},name:{default:"Prendre {rotary_name:rotary}",name:"Prendre {rotary_name:rotary}, puis sortir par {way_name:article}",destination:"Prendre {rotary_name:rotary}, puis sortir en direction {destination:preposition}"},exit:{default:"Prendre le rond-point, puis la {exit_number} sortie",name:"Prendre le rond-point, puis la {exit_number} sortie sur {way_name:article}",destination:"Prendre le rond-point, puis la {exit_number} sortie en direction {destination:preposition}"},name_exit:{default:"Prendre {rotary_name:rotary}, puis la {exit_number} sortie",name:"Prendre {rotary_name:rotary}, puis la {exit_number} sortie sur {way_name:article}",destination:"Prendre {rotary_name:rotary}, puis la {exit_number} sortie en direction {destination:preposition}"}}},roundabout:{default:{exit:{default:"Prendre le rond-point, puis la {exit_number} sortie",name:"Prendre le rond-point, puis la {exit_number} sortie sur {way_name:article}",destination:"Prendre le rond-point, puis la {exit_number} sortie en direction {destination:preposition}"},default:{default:"Prendre le rond-point",name:"Prendre le rond-point, puis sortir sur {way_name:article}",destination:"Prendre le rond-point, puis sortir en direction {destination:preposition}"}}},"roundabout turn":{default:{default:"Tourner {modifier}",name:"Tourner {modifier} sur {way_name:article}",destination:"Tourner {modifier} en direction {destination:preposition}"},left:{default:"Tourner  gauche",name:"Tourner  gauche sur {way_name:article}",destination:"Tourner  gauche en direction {destination:preposition}"},right:{default:"Tourner  droite",name:"Tourner  droite sur {way_name:article}",destination:"Tourner  droite en direction {destination:preposition}"},straight:{default:"Continuer tout droit",name:"Continuer tout droit sur {way_name:article}",destination:"Continuer tout droit en direction {destination:preposition}"}},"exit roundabout":{default:{default:"Sortir du rond-point",name:"Sortir du rond-point sur {way_name:article}",destination:"Sortir du rond-point en direction {destination:preposition}"}},"exit rotary":{default:{default:"Sortir du rond-point",name:"Sortir du rond-point sur {way_name:article}",destination:"Sortir du rond-point en direction {destination:preposition}"}},turn:{default:{default:"Tourner {modifier}",name:"Tourner {modifier} sur {way_name:article}",destination:"Tourner {modifier} en direction {destination:preposition}"},left:{default:"Tourner  gauche",name:"Tourner  gauche sur {way_name:article}",destination:"Tourner  gauche en direction {destination:preposition}"},right:{default:"Tourner  droite",name:"Tourner  droite sur {way_name:article}",destination:"Tourner  droite en direction {destination:preposition}"},straight:{default:"Aller tout droit",name:"Aller tout droit sur {way_name:article}",destination:"Aller tout droit en direction {destination:preposition}"}},"use lane":{no_lanes:{default:"Continuer tout droit"},default:{default:"{lane_instruction}"}}}}},{}],31:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:" ",east:"",southeast:" ",south:"",southwest:" ",west:"",northwest:" "},modifier:{left:"",right:"","sharp left":" ","sharp right":" ","slight left":" ","slight right":" ",straight:"",uturn:" "},lanes:{xo:" ",ox:" ",xox:"  ",oxo:"   "}},modes:{ferry:{default:"  ",name:"   {way_name}",destination:"    {destination}"}},phrase:{"two linked by distance":"{instruction_one}, , {distance}, {instruction_two}","two linked":"{instruction_one},  {instruction_two}","one in distance":" {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":" {exit}"},arrive:{default:{default:"   {nth} ",upcoming:"    {nth} ",short:"","short-upcoming":"",named:"  {waypoint_name}"},left:{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},right:{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},"sharp left":{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},"sharp right":{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},"slight right":{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},"slight left":{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},straight:{default:"   {nth} , ",upcoming:"    {nth} , ",short:"","short-upcoming":"",named:"  {waypoint_name}, "}},continue:{default:{default:" {modifier}",name:" {modifier}   {way_name}",destination:" {modifier}  {destination}",exit:" {modifier}  {way_name}"},straight:{default:" ",name:"     {way_name}",destination:"  {destination}",distance:"   {distance}",namedistance:"  {way_name}  {distance}"},"sharp left":{default:"  ",name:"      {way_name}",destination:"    {destination}"},"sharp right":{default:"  ",name:"      {way_name}",destination:"    {destination}"},"slight left":{default:"  ",name:"      {way_name}",destination:"    {destination}"},"slight right":{default:"  ",name:"      {way_name}",destination:"    {destination}"},uturn:{default:"  ",name:"     {way_name}",destination:"    {destination}"}},depart:{default:{default:" {direction}",name:" {direction}  {way_name}",namedistance:" {direction}  {way_name}  {distance}"}},"end of road":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},straight:{default:" ",name:"   {way_name}",destination:"   {destination}"},uturn:{default:"    ",name:"    {way_name}  ",destination:"    {destination}  "}},fork:{default:{default:" {modifier} ",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},"slight left":{default:"  ",name:"   {way_name}",destination:"   {destination}"},"slight right":{default:"  ",name:"   {way_name}",destination:"   {destination}"},"sharp left":{default:"   ",name:"    {way_name}",destination:"    {destination}"},"sharp right":{default:"   ",name:"    {way_name}",destination:"    {destination}"},uturn:{default:"  ",name:"    {way_name}",destination:"    {destination}"}},merge:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},straight:{default:"",name:"  {way_name}",destination:"  {destination}"},"slight left":{default:" ",name:"   {way_name}",destination:"   {destination}"},"slight right":{default:" ",name:"   {way_name}",destination:"   {destination}"},"sharp left":{default:" ",name:"   {way_name}",destination:"   {destination}"},"sharp right":{default:" ",name:"   {way_name}",destination:"   {destination}"},uturn:{default:"  ",name:"    {way_name}",destination:"    {destination}"}},"new name":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},straight:{default:" ",name:"  {way_name}",destination:"  {destination}"},"sharp left":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"sharp right":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"     {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"     {destination}"},uturn:{default:"  ",name:"    {way_name}",destination:"    {destination}"}},notification:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},uturn:{default:"  ",name:"    {way_name}",destination:"    {destination}"}},"off ramp":{default:{default:" ",name:"   {way_name}",destination:"   {destination}",exit:"  {exit}",exit_destination:"  {exit}  {destination}"},left:{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},right:{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},"sharp left":{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},"sharp right":{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},"slight left":{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},"slight right":{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"}},"on ramp":{default:{default:" ",name:"   {way_name}",destination:"   {destination}"},left:{default:"  ",name:"    {way_name}",destination:"    {destination}"},right:{default:"  ",name:"    {way_name}",destination:"    {destination}"},"sharp left":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"sharp right":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"slight left":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"slight right":{default:"  ",name:"    {way_name}",destination:"    {destination}"}},rotary:{default:{default:{default:"  ",name:"     {way_name}",destination:"     {destination}"},name:{default:" {rotary_name}",name:" {rotary_name}   {way_name}",destination:" {rotary_name}   {destination}"},exit:{default:"     {exit_number}",name:"     {exit_number} {way_name}",destination:"     {exit_number}  {destination}"},name_exit:{default:" {rotary_name}   {exit_number}",name:" {rotary_name}   {exit_number} {way_name}",destination:" {rotary_name}   {exit_number}  {destination}"}}},roundabout:{default:{exit:{default:"     {exit_number}",name:"     {exit_number} {way_name}",destination:"     {exit_number}  {destination}"},default:{default:"  ",name:"     {way_name}",destination:"     {destination}"}}},"roundabout turn":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},left:{default:" ",name:"  {way_name}",destination:"   {destination}"},right:{default:" ",name:"  {way_name}",destination:"   {destination}"},straight:{default:" ",name:"   {way_name}",destination:"   {destination}"}},"exit roundabout":{default:{default:"  ",name:"   {way_name}",destination:"    {destination}"}},"exit rotary":{default:{default:"  ",name:"   {way_name}",destination:"    {destination}"}},turn:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},left:{default:" ",name:"  {way_name}",destination:"   {destination}"},right:{default:" ",name:"  {way_name}",destination:"   {destination}"},straight:{default:" ",name:"  {way_name}",destination:"   {destination}"}},"use lane":{no_lanes:{default:" "},default:{default:"{lane_instruction}"}}}}},{}],32:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"utara",northeast:"timur laut",east:"timur",southeast:"tenggara",south:"selatan",southwest:"barat daya",west:"barat",northwest:"barat laut"},modifier:{left:"kiri",right:"kanan","sharp left":"tajam kiri","sharp right":"tajam kanan","slight left":"agak ke kiri","slight right":"agak ke kanan",straight:"lurus",uturn:"putar balik"},lanes:{xo:"Tetap di kanan",ox:"Tetap di kiri",xox:"Tetap di tengah",oxo:"Tetap di kiri atau kanan"}},modes:{ferry:{default:"Naik ferry",name:"Naik ferry di {way_name}",destination:"Naik ferry menuju {destination}"}},phrase:{"two linked by distance":"{instruction_one}, then, in {distance}, {instruction_two}","two linked":"{instruction_one}, then {instruction_two}","one in distance":"In {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Anda telah tiba di tujuan ke-{nth}",upcoming:"Anda telah tiba di tujuan ke-{nth}",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}"},left:{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kiri"},right:{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kanan"},"sharp left":{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kiri"},"sharp right":{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kanan"},"slight right":{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kanan"},"slight left":{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kiri"},straight:{default:"Anda telah tiba di tujuan ke-{nth}, lurus saja",upcoming:"Anda telah tiba di tujuan ke-{nth}, lurus saja",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, lurus saja"}},continue:{default:{default:"Belok {modifier}",name:"Terus {modifier} ke {way_name}",destination:"Belok {modifier} menuju {destination}",exit:"Belok {modifier} ke {way_name}"},straight:{default:"Lurus terus",name:"Terus ke {way_name}",destination:"Terus menuju {destination}",distance:"Continue straight for {distance}",namedistance:"Continue on {way_name} for {distance}"},"sharp left":{default:"Belok kiri tajam",name:"Make a sharp left to stay on {way_name}",destination:"Belok kiri tajam menuju {destination}"},"sharp right":{default:"Belok kanan tajam",name:"Make a sharp right to stay on {way_name}",destination:"Belok kanan tajam menuju {destination}"},"slight left":{default:"Tetap agak di kiri",name:"Tetap agak di kiri ke {way_name}",destination:"Tetap agak di kiri menuju {destination}"},"slight right":{default:"Tetap agak di kanan",name:"Tetap agak di kanan ke {way_name}",destination:"Tetap agak di kanan menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},depart:{default:{default:"Arah {direction}",name:"Arah {direction} di {way_name}",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"Belok {modifier}",name:"Belok {modifier} ke {way_name}",destination:"Belok {modifier} menuju {destination}"},straight:{default:"Lurus terus",name:"Tetap lurus ke {way_name} ",destination:"Tetap lurus menuju {destination}"},uturn:{default:"Putar balik di akhir jalan",name:"Putar balik di {way_name} di akhir jalan",destination:"Putar balik menuju {destination} di akhir jalan"}},fork:{default:{default:"Tetap {modifier} di pertigaan",name:"Tetap {modifier} di pertigaan ke {way_name}",destination:"Tetap {modifier} di pertigaan menuju {destination}"},"slight left":{default:"Tetap di kiri pada pertigaan",name:"Tetap di kiri pada pertigaan ke arah {way_name}",destination:"Tetap di kiri pada pertigaan menuju {destination}"},"slight right":{default:"Tetap di kanan pada pertigaan",name:"Tetap di kanan pada pertigaan ke arah {way_name}",destination:"Tetap di kanan pada pertigaan menuju {destination}"},"sharp left":{default:"Belok kiri pada pertigaan",name:"Belok kiri tajam ke arah {way_name}",destination:"Belok kiri tajam menuju {destination}"},"sharp right":{default:"Belok kanan pada pertigaan",name:"Belok kanan tajam ke arah {way_name}",destination:"Belok kanan tajam menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},merge:{default:{default:"Bergabung {modifier}",name:"Bergabung {modifier} ke arah {way_name}",destination:"Bergabung {modifier} menuju {destination}"},straight:{default:"Bergabung lurus",name:"Bergabung lurus ke arah {way_name}",destination:"Bergabung lurus menuju {destination}"},"slight left":{default:"Bergabung di kiri",name:"Bergabung di kiri ke arah {way_name}",destination:"Bergabung di kiri menuju {destination}"},"slight right":{default:"Bergabung di kanan",name:"Bergabung di kanan ke arah {way_name}",destination:"Bergabung di kanan menuju {destination}"},"sharp left":{default:"Bergabung di kiri",name:"Bergabung di kiri ke arah {way_name}",destination:"Bergabung di kiri menuju {destination}"},"sharp right":{default:"Bergabung di kanan",name:"Bergabung di kanan ke arah {way_name}",destination:"Bergabung di kanan menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},"new name":{default:{default:"Lanjutkan {modifier}",name:"Lanjutkan {modifier} menuju {way_name}",destination:"Lanjutkan {modifier} menuju {destination}"},straight:{default:"Lurus terus",name:"Terus ke {way_name}",destination:"Terus menuju {destination}"},"sharp left":{default:"Belok kiri tajam",name:"Belok kiri tajam ke arah {way_name}",destination:"Belok kiri tajam menuju {destination}"},"sharp right":{default:"Belok kanan tajam",name:"Belok kanan tajam ke arah {way_name}",destination:"Belok kanan tajam menuju {destination}"},"slight left":{default:"Lanjut dengan agak ke kiri",name:"Lanjut dengan agak di kiri ke {way_name}",destination:"Tetap agak di kiri menuju {destination}"},"slight right":{default:"Tetap agak di kanan",name:"Tetap agak di kanan ke {way_name}",destination:"Tetap agak di kanan menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},notification:{default:{default:"Lanjutkan {modifier}",name:"Lanjutkan {modifier} menuju {way_name}",destination:"Lanjutkan {modifier} menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},"off ramp":{default:{default:"Ambil jalan melandai",name:"Ambil jalan melandai ke {way_name}",destination:"Ambil jalan melandai menuju {destination}",exit:"Take exit {exit}",exit_destination:"Take exit {exit} towards {destination}"},left:{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},right:{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan menuju {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"},"sharp left":{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},"sharp right":{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan menuju {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"},"slight left":{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},"slight right":{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan  menuju {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"}},"on ramp":{default:{default:"Ambil jalan melandai",name:"Ambil jalan melandai ke {way_name}",destination:"Ambil jalan melandai menuju {destination}"},left:{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}"},right:{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan  menuju {destination}"},"sharp left":{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}"},"sharp right":{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan  menuju {destination}"},"slight left":{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}"},"slight right":{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan  menuju {destination}"}},rotary:{default:{default:{default:"Masuk bundaran",name:"Masuk bundaran dan keluar arah {way_name}",destination:"Masuk bundaran dan keluar menuju {destination}"},name:{default:"Masuk {rotary_name}",name:"Masuk {rotary_name} dan keluar arah {way_name}",destination:"Masuk {rotary_name} dan keluar menuju {destination}"},exit:{default:"Masuk bundaran dan ambil jalan keluar {exit_number}",name:"Masuk bundaran dan ambil jalan keluar {exit_number} arah {way_name}",destination:"Masuk bundaran dan ambil jalan keluar {exit_number} menuju {destination}"},name_exit:{default:"Masuk {rotary_name} dan ambil jalan keluar {exit_number}",name:"Masuk {rotary_name} dan ambil jalan keluar {exit_number} arah {way_name}",destination:"Masuk {rotary_name} dan ambil jalan keluar {exit_number} menuju {destination}"}}},roundabout:{default:{exit:{default:"Masuk bundaran dan ambil jalan keluar {exit_number}",name:"Masuk bundaran dan ambil jalan keluar {exit_number} arah {way_name}",destination:"Masuk bundaran dan ambil jalan keluar {exit_number} menuju {destination}"},default:{default:"Masuk bundaran",name:"Masuk bundaran dan keluar arah {way_name}",destination:"Masuk bundaran dan keluar menuju {destination}"}}},"roundabout turn":{default:{default:"Lakukan {modifier}",name:"Lakukan {modifier} ke arah {way_name}",destination:"Lakukan {modifier} menuju {destination}"},left:{default:"Belok kiri",name:"Belok kiri ke {way_name}",destination:"Belok kiri menuju {destination}"},right:{default:"Belok kanan",name:"Belok kanan ke {way_name}",destination:"Belok kanan menuju {destination}"},straight:{default:"Lurus terus",name:"Tetap lurus ke {way_name} ",destination:"Tetap lurus menuju {destination}"}},"exit roundabout":{default:{default:"Lakukan {modifier}",name:"Lakukan {modifier} ke arah {way_name}",destination:"Lakukan {modifier} menuju {destination}"},left:{default:"Belok kiri",name:"Belok kiri ke {way_name}",destination:"Belok kiri menuju {destination}"},right:{default:"Belok kanan",name:"Belok kanan ke {way_name}",destination:"Belok kanan menuju {destination}"},straight:{default:"Lurus terus",name:"Tetap lurus ke {way_name} ",destination:"Tetap lurus menuju {destination}"}},"exit rotary":{default:{default:"Lakukan {modifier}",name:"Lakukan {modifier} ke arah {way_name}",destination:"Lakukan {modifier} menuju {destination}"},left:{default:"Belok kiri",name:"Belok kiri ke {way_name}",destination:"Belok kiri menuju {destination}"},right:{default:"Belok kanan",name:"Belok kanan ke {way_name}",destination:"Belok kanan menuju {destination}"},straight:{default:"Lurus",name:"Lurus arah {way_name}",destination:"Lurus menuju {destination}"}},turn:{default:{default:"Lakukan {modifier}",name:"Lakukan {modifier} ke arah {way_name}",destination:"Lakukan {modifier} menuju {destination}"},left:{default:"Belok kiri",name:"Belok kiri ke {way_name}",destination:"Belok kiri menuju {destination}"},right:{default:"Belok kanan",name:"Belok kanan ke {way_name}",destination:"Belok kanan menuju {destination}"},straight:{default:"Lurus",name:"Lurus arah {way_name}",destination:"Lurus menuju {destination}"}},"use lane":{no_lanes:{default:"Lurus terus"},default:{default:"{lane_instruction}"}}}}},{}],33:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"nord",northeast:"nord-est",east:"est",southeast:"sud-est",south:"sud",southwest:"sud-ovest",west:"ovest",northwest:"nord-ovest"},modifier:{left:"sinistra",right:"destra","sharp left":"sinistra","sharp right":"destra","slight left":"sinistra leggermente","slight right":"destra leggermente",straight:"dritto",uturn:"inversione a U"},lanes:{xo:"Mantieni la destra",ox:"Mantieni la sinistra",xox:"Rimani in mezzo",oxo:"Mantieni la destra o la sinistra"}},modes:{ferry:{default:"Prendi il traghetto",name:"Prendi il traghetto {way_name}",destination:"Prendi il traghetto verso {destination}"}},phrase:{"two linked by distance":"{instruction_one}, poi tra {distance},{instruction_two}","two linked":"{instruction_one}, poi {instruction_two}","one in distance":"tra {distance} {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Sei arrivato alla tua {nth} destinazione",upcoming:"Sei arrivato alla tua {nth} destinazione",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"Sei arrivato a {waypoint_name}"},left:{default:"sei arrivato alla tua {nth} destinazione, sulla sinistra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla sinistra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla sinistra"},right:{default:"sei arrivato alla tua {nth} destinazione, sulla destra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla destra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla destra"},"sharp left":{default:"sei arrivato alla tua {nth} destinazione, sulla sinistra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla sinistra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla sinistra"},"sharp right":{default:"sei arrivato alla tua {nth} destinazione, sulla destra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla destra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla destra"},"slight right":{default:"sei arrivato alla tua {nth} destinazione, sulla destra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla destra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla destra"},"slight left":{default:"sei arrivato alla tua {nth} destinazione, sulla sinistra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla sinistra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla sinistra"},straight:{default:"sei arrivato alla tua {nth} destinazione, si trova davanti a te",upcoming:"sei arrivato alla tua {nth} destinazione, si trova davanti a te",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, si trova davanti a te"}},continue:{default:{default:"Gira a {modifier}",name:"Gira a {modifier} per stare su {way_name}",destination:"Gira a {modifier} verso {destination}",exit:"Gira a {modifier} in {way_name}"},straight:{default:"Continua dritto",name:"Continua dritto per stare su {way_name}",destination:"Continua verso {destination}",distance:"Continua dritto per {distance}",namedistance:"Continua su {way_name} per {distance}"},"sharp left":{default:"Svolta a sinistra",name:"Fai una stretta curva a sinistra per stare su {way_name}",destination:"Svolta a sinistra verso {destination}"},"sharp right":{default:"Svolta a destra",name:"Fau una stretta curva a destra per stare su {way_name}",destination:"Svolta a destra verso {destination}"},"slight left":{default:"Fai una leggera curva a sinistra",name:"Fai una leggera curva a sinistra per stare su {way_name}",destination:"Fai una leggera curva a sinistra verso {destination}"},"slight right":{default:"Fai una leggera curva a destra",name:"Fai una leggera curva a destra per stare su {way_name}",destination:"Fai una leggera curva a destra verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione ad U poi continua su {way_name}",destination:"Fai un'inversione a U verso {destination}"}},depart:{default:{default:"Continua verso {direction}",name:"Continua verso {direction} in {way_name}",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"Gira a {modifier}",name:"Gira a {modifier} in {way_name}",destination:"Gira a {modifier} verso {destination}"},straight:{default:"Continua dritto",name:"Continua dritto in {way_name}",destination:"Continua dritto verso {destination}"},uturn:{default:"Fai un'inversione a U alla fine della strada",name:"Fai un'inversione a U in {way_name} alla fine della strada",destination:"Fai un'inversione a U verso {destination} alla fine della strada"}},fork:{default:{default:"Mantieni la {modifier} al bivio",name:"Mantieni la {modifier} al bivio in {way_name}",destination:"Mantieni la {modifier} al bivio verso {destination}"},"slight left":{default:"Mantieni la sinistra al bivio",name:"Mantieni la sinistra al bivio in {way_name}",destination:"Mantieni la sinistra al bivio verso {destination}"},"slight right":{default:"Mantieni la destra al bivio",name:"Mantieni la destra al bivio in {way_name}",destination:"Mantieni la destra al bivio verso {destination}"},"sharp left":{default:"Svolta a sinistra al bivio",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},"sharp right":{default:"Svolta a destra al bivio",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione a U in {way_name}",destination:"Fai un'inversione a U verso {destination}"}},merge:{default:{default:"Immettiti a {modifier}",name:"Immettiti {modifier} in {way_name}",destination:"Immettiti {modifier} verso {destination}"},straight:{default:"Immettiti a dritto",name:"Immettiti dritto in {way_name}",destination:"Immettiti dritto verso {destination}"},"slight left":{default:"Immettiti a sinistra",name:"Immettiti a sinistra in {way_name}",destination:"Immettiti a sinistra verso {destination}"},"slight right":{default:"Immettiti a destra",name:"Immettiti a destra in {way_name}",destination:"Immettiti a destra verso {destination}"},"sharp left":{default:"Immettiti a sinistra",name:"Immettiti a sinistra in {way_name}",destination:"Immettiti a sinistra verso {destination}"},"sharp right":{default:"Immettiti a destra",name:"Immettiti a destra in {way_name}",destination:"Immettiti a destra verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione a U in {way_name}",destination:"Fai un'inversione a U verso {destination}"}},"new name":{default:{default:"Continua a {modifier}",name:"Continua a {modifier} in {way_name}",destination:"Continua a {modifier} verso {destination}"},straight:{default:"Continua dritto",name:"Continua in {way_name}",destination:"Continua verso {destination}"},"sharp left":{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},"sharp right":{default:"Svolta a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},"slight left":{default:"Continua leggermente a sinistra",name:"Continua leggermente a sinistra in {way_name}",destination:"Continua leggermente a sinistra verso {destination}"},"slight right":{default:"Continua leggermente a destra",name:"Continua leggermente a destra in {way_name} ",destination:"Continua leggermente a destra verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione a U in {way_name}",destination:"Fai un'inversione a U verso {destination}"}},notification:{default:{default:"Continua a {modifier}",name:"Continua a {modifier} in {way_name}",destination:"Continua a {modifier} verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione a U in {way_name}",destination:"Fai un'inversione a U verso {destination}"}},"off ramp":{default:{default:"Prendi la rampa",name:"Prendi la rampa in {way_name}",destination:"Prendi la rampa verso {destination}",exit:"Prendi l'uscita {exit}",exit_destination:"Prendi l'uscita  {exit} verso {destination}"},left:{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}",exit:"Prendi l'uscita {exit} a sinistra",exit_destination:"Prendi la {exit}  uscita a sinistra verso {destination}"},right:{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}",exit:"Prendi la {exit} uscita a destra",exit_destination:"Prendi la {exit} uscita a destra verso {destination}"},"sharp left":{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}",exit:"Prendi l'uscita {exit} a sinistra",exit_destination:"Prendi la {exit}  uscita a sinistra verso {destination}"},"sharp right":{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}",exit:"Prendi la {exit} uscita a destra",exit_destination:"Prendi la {exit} uscita a destra verso {destination}"},"slight left":{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}",exit:"Prendi l'uscita {exit} a sinistra",exit_destination:"Prendi la {exit}  uscita a sinistra verso {destination}"},"slight right":{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}",exit:"Prendi la {exit} uscita a destra",exit_destination:"Prendi la {exit} uscita a destra verso {destination}"}},"on ramp":{default:{default:"Prendi la rampa",name:"Prendi la rampa in {way_name}",destination:"Prendi la rampa verso {destination}"},left:{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}"},right:{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}"},"sharp left":{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}"},"sharp right":{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}"},"slight left":{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}"},"slight right":{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}"}},rotary:{default:{default:{default:"Immettiti nella rotonda",name:"Immettiti nella ritonda ed esci in {way_name}",destination:"Immettiti nella ritonda ed esci verso {destination}"},name:{default:"Immettiti in {rotary_name}",name:"Immettiti in {rotary_name} ed esci su {way_name}",destination:"Immettiti in {rotary_name} ed esci verso {destination}"},exit:{default:"Immettiti nella rotonda e prendi la {exit_number} uscita",name:"Immettiti nella rotonda e prendi la {exit_number} uscita in {way_name}",destination:"Immettiti nella rotonda e prendi la {exit_number} uscita verso   {destination}"},name_exit:{default:"Immettiti in {rotary_name} e prendi la {exit_number} uscita",name:"Immettiti in {rotary_name} e prendi la {exit_number} uscita in {way_name}",destination:"Immettiti in {rotary_name} e prendi la {exit_number}  uscita verso {destination}"}}},roundabout:{default:{exit:{default:"Immettiti nella rotonda e prendi la {exit_number} uscita",name:"Immettiti nella rotonda e prendi la {exit_number} uscita in {way_name}",destination:"Immettiti nella rotonda e prendi la {exit_number} uscita verso {destination}"},default:{default:"Entra nella rotonda",name:"Entra nella rotonda e prendi l'uscita in {way_name}",destination:"Entra nella rotonda e prendi l'uscita verso {destination}"}}},"roundabout turn":{default:{default:"Fai una {modifier}",name:"Fai una {modifier} in {way_name}",destination:"Fai una {modifier} verso {destination}"},left:{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},right:{default:"Gira a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},straight:{default:"Continua dritto",name:"Continua dritto in {way_name}",destination:"Continua dritto verso {destination}"}},"exit roundabout":{default:{default:"Fai una {modifier}",name:"Fai una {modifier} in {way_name}",destination:"Fai una {modifier} verso {destination}"},left:{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},right:{default:"Gira a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},straight:{default:"Continua dritto",name:"Continua dritto in {way_name}",destination:"Continua dritto verso {destination}"}},"exit rotary":{default:{default:"Fai una {modifier}",name:"Fai una {modifier} in {way_name}",destination:"Fai una {modifier} verso {destination}"},left:{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},right:{default:"Gira a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},straight:{default:"Prosegui dritto",name:"Continua su {way_name}",destination:"Continua verso {destination}"}},turn:{default:{default:"Fai una {modifier}",name:"Fai una {modifier} in {way_name}",destination:"Fai una {modifier} verso {destination}"},left:{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},right:{default:"Gira a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},straight:{default:"Prosegui dritto",name:"Continua su {way_name}",destination:"Continua verso {destination}"}},"use lane":{no_lanes:{default:"Continua dritto"},default:{default:"{lane_instruction}"}}}}},{}],34:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!1},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:"",east:"",southeast:"",south:"",southwest:"",west:"",northwest:""},modifier:{left:"",right:"","sharp left":"","sharp right":"","slight left":"","slight right":"",straight:"",uturn:""},lanes:{xo:" ",ox:" ",xox:"",oxo:"    "}},modes:{ferry:{default:" ",name:"  {way_name}",destination:"  {destination} ."}},phrase:{"two linked by distance":"{instruction_one}, , {distance} , {instruction_two}","two linked":"{instruction_one},  {instruction_two}","one in distance":"{distance} , {instruction_one}","name and ref":"{name} ({ref})","exit with number":"{exit} ."},arrive:{default:{default:" {nth} .",upcoming:"{nth}   .",short:"","short-upcoming":" .",named:" {waypoint_name} ."},left:{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},right:{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},"sharp left":{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},"sharp right":{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},"slight right":{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},"slight left":{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},straight:{default:"  {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."}},continue:{default:{default:"{modifier} ",name:"{modifier}  {way_name}  .",destination:"{modifier}  {destination} .",exit:"{way_name}  {modifier}  ."},straight:{default:"  .",name:"{way_name}    .",destination:"{destination}  .",distance:"{distance}  .",namedistance:"{distance} {way_name} ."},"sharp left":{default:" .",name:"   {way_name} .",destination:"   {destination} ."},"sharp right":{default:" .",name:"  {way_name} .",destination:"   {destination} ."},"slight left":{default:" .",name:"   {way_name} .",destination:"    {destination} ."},"slight right":{default:" .",name:"   {way_name} .",destination:"    {destination} ."},uturn:{default:" ",name:" {way_name} .",destination:"  {destination} ."}},depart:{default:{default:"{direction} ",name:"{direction}   {way_name}  . ",namedistance:"{direction} {way_name}  {distance} ."}},"end of road":{default:{default:"{modifier} .",name:"{modifier} {way_name} .",destination:"{modifier}   {destination} ."},straight:{default:"  .",name:"{way_name}   .",destination:"{destination}  ."},uturn:{default:"    .",name:"    {way_name} .",destination:"    {destination}  ."}},fork:{default:{default:" {modifier}  .",name:"{modifier} {way_name} .",destination:"{modifier} {destination} ."},"slight left":{default:"  .",name:"  {way_name} .",destination:"  {destination} ."},"slight right":{default:"  .",name:"  {way_name} .",destination:"  {destination} ."},"sharp left":{default:"  .",name:"  {way_name} .",destination:"  {destination} ."},"sharp right":{default:"  .",name:"  {way_name} .",destination:"  {destination} ."},uturn:{default:".",name:" {way_name} .",destination:" {destination} ."}},merge:{default:{default:"{modifier} ",name:"{modifier}  {way_name} .",destination:"{modifier}  {destination} ."},straight:{default:"",name:"{way_name} .",destination:"{destination} ."},"slight left":{default:" .",name:"{way_name} .",destination:"  {destination} ."},"slight right":{default:" .",name:"{way_name} .",destination:"  {destination} ."},"sharp left":{default:" .",name:"{way_name} .",destination:"  {destination} ."},"sharp right":{default:" .",name:"{way_name} .",destination:"  {destination} ."},uturn:{default:".",name:" {way_name} .",destination:" {destination} ."}},"new name":{default:{default:"{modifier} .",name:"{modifier}  {way_name} .",destination:"{modifier}  {destination} ."},straight:{default:".",name:"{way_name}  .",destination:"{destination}  ."},"sharp left":{default:" .",name:"  {way_name} .",destination:"  {destination} ."},"sharp right":{default:" .",name:"  {way_name} .",destination:"  {destination} ."},"slight left":{default:"  .",name:"  {way_name} .",destination:"   {destination} ."},"slight right":{default:"  .",name:"  {way_name} .",destination:"   {destination} ."},uturn:{default:".",name:" {way_name} .",destination:" {destination} ."}},notification:{default:{default:"{modifier} .",name:"{modifier} {way_name} .",destination:"{modifier} {destination} ."},uturn:{default:".",name:" {way_name} .",destination:" {destination} ."}},"off ramp":{default:{default:"  ..",name:"  {way_name} .",destination:"  {destination} .",exit:"{exit}  .",exit_destination:"{exit}   {destination} ."},left:{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},right:{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},"sharp left":{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},"sharp right":{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},"slight left":{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},"slight right":{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."}},"on ramp":{default:{default:"  ..",name:"  {way_name} .",destination:"  {destination} ."},left:{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},right:{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},"sharp left":{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},"sharp right":{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},"slight left":{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},"slight right":{default:"   .",name:"   {way_name} .",destination:"   {destination} ."}},rotary:{default:{default:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},name:{default:"{rotary_name} .",name:"{rotary_name}  {way_name} .",destination:"{rotary_name}  {destination} ."},exit:{default:"  {exit_number}  .",name:"  {exit_number}   {way_name} .",destination:"  {exit_number}   {destination} ."},name_exit:{default:"{rotary_name}  {exit_number}  .",name:"{rotary_name}  {exit_number}   {way_name} .",destination:"{rotary_name}  {exit_number}   {destination} ."}}},roundabout:{default:{exit:{default:"  {exit_number} .",name:"  {exit_number}  {way_name} .",destination:"  {exit_number}  {destination} ."},default:{default:" .",name:"  {way_name} .",destination:"  {destination} ."}}},"roundabout turn":{default:{default:"{modifier} .",name:"{modifier}  {way_name} .",destination:"{modifier}  {destination} ."},left:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},right:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},straight:{default:" .",name:" {way_name} .",destination:" {destination} ."}},"exit roundabout":{default:{default:" .",name:"  {way_name} .",destination:"  {destination} ."}},"exit rotary":{default:{default:" .",name:"  {way_name} .",destination:"  {destination} ."}},turn:{default:{default:"{modifier} .",name:"{modifier}  {way_name} .",destination:"{modifier}  {destination} ."},left:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},right:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},straight:{default:" .",name:" {way_name} .",destination:" {destination} ."}},"use lane":{no_lanes:{default:"."},default:{default:"{lane_instruction}"}}}}},{}],35:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!1},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:"",east:"",southeast:"",south:"",southwest:"",west:"",northwest:""},modifier:{left:"",right:"","sharp left":" ","sharp right":" ","slight left":" ","slight right":" ",straight:"",uturn:"-"},lanes:{xo:"",ox:"",xox:"",oxo:"   "}},modes:{ferry:{default:" ",name:"{way_name} ",destination:"{destination} "}},phrase:{"two linked by distance":"{instruction_one} {distance} {instruction_two}","two linked":"{instruction_one} {instruction_two}","one in distance":"{distance} {instruction_one}","name and ref":"{name}( {ref})","exit with number":"{exit}"},arrive:{default:{default:"{nth}  ",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name}  "},left:{default:"  {nth}",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name} "},right:{default:"  {nth}  ",upcoming:" {nth}   ",short:"  ","short-upcoming":"  ",named:"  {waypoint_name}  "},"sharp left":{default:"  {nth}",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name} "},"sharp right":{default:"  {nth}  ",upcoming:" {nth}   ",short:"  ","short-upcoming":"  ",named:"  {waypoint_name}  "},"slight right":{default:"  {nth}  ",upcoming:" {nth}   ",short:"  ","short-upcoming":"  ",named:"  {waypoint_name}  "},"slight left":{default:"  {nth}",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name} "},straight:{default:"  {nth}",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name} "}},continue:{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} ",exit:"{way_name} {modifier}"},straight:{default:" ",name:"{way_name}",destination:"{destination}",distance:"{distance}  ",namedistance:"{way_name}{distance}"},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} "},"sharp right":{default:" ",name:"{way_name} ",destination:"{destination} "},"slight left":{default:" ",name:"{way_name} ",destination:"{destination} "},"slight right":{default:" ",name:"{way_name} ",destination:"{destination} "},uturn:{default:"- ",name:"{way_name} -",destination:"{destination} "}},depart:{default:{default:"{direction} ",name:"{direction} {way_name} ",namedistance:"{direction} {way_name}{distance} "}},"end of road":{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},straight:{default:" ",name:"{way_name}",destination:"{destination}"},uturn:{default:" -",name:" {way_name}-",destination:"{destination} "}},fork:{default:{default:" {modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},"slight left":{default:"",name:"{way_name}",destination:"{destination} "},"slight right":{default:"",name:"{way_name}",destination:"{destination} "},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} "},"sharp right":{default:"",name:"{way_name} ",destination:"{destination} "},uturn:{default:"- ",name:"{way_name}-",destination:"{destination} "}},merge:{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},straight:{default:"",name:"{way_name}",destination:"{destination} "},"slight left":{default:"",name:"{way_name}",destination:"{destination} "},"slight right":{default:"",name:"{way_name}",destination:"{destination} "},"sharp left":{default:"",name:"{way_name}",destination:"{destination} "},"sharp right":{default:"",name:"{way_name}",destination:"{destination} "},uturn:{default:"- ",name:"{way_name} -  ",destination:"{destination} "}},"new name":{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},straight:{default:" ",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} "},"sharp right":{default:" ",name:"{way_name} ",destination:"{destination} "},"slight left":{default:" ",name:"{way_name} ",destination:"{destination}"},"slight right":{default:" ",name:"{way_name} ",destination:"{destination}"},uturn:{default:"- ",name:"{way_name} - ",destination:"{destination} "}},notification:{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},uturn:{default:"- ",name:"{way_name} - ",destination:"{destination} "}},"off ramp":{default:{default:"",name:"{way_name}",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},left:{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},right:{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},"sharp right":{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},"slight left":{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},"slight right":{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "}},"on ramp":{default:{default:"",name:"{way_name}",destination:"{destination} "},left:{default:"",name:"{way_name} ",destination:"{destination} "},right:{default:"",name:"{way_name} ",destination:"{destination} "},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} "},"sharp right":{default:"",name:"{way_name} ",destination:"{destination} "},"slight left":{default:"",name:"{way_name} ",destination:"{destination} "},"slight right":{default:"",name:"{way_name} ",destination:"{destination} "}},rotary:{default:{default:{default:"",name:"{way_name}",destination:"{destination}"},name:{default:"{rotary_name}",name:"{rotary_name}{way_name}",destination:"{rotary_name}{destination}"},exit:{default:"{exit_number}",name:"{exit_number}{way_name}",destination:"{exit_number}{destination}"},name_exit:{default:"{rotary_name} {exit_number}",name:"{rotary_name}{exit_number}{way_name}",destination:"{rotary_name}{exit_number}{destination}"}}},roundabout:{default:{exit:{default:"{exit_number}",name:"{exit_number}{way_name}",destination:"{exit_number}{destination}"},default:{default:"",name:"{way_name}",destination:"{destination}"}}},"roundabout turn":{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination} "},left:{default:"",name:"{way_name}",destination:"{destination} "},right:{default:"",name:"{way_name}",destination:"{destination} "},straight:{default:" ",name:"{way_name}",destination:"{destination}"}},"exit roundabout":{default:{default:"",name:"{way_name}",destination:"{destination}"}},"exit rotary":{default:{default:"",name:"{way_name}",destination:"{destination}"}},turn:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination} "},left:{default:"",name:"{way_name}",destination:"{destination} "},right:{default:"",name:"{way_name}",destination:"{destination} "},straight:{default:"",name:"{way_name}",destination:"{destination}"}},"use lane":{no_lanes:{default:" "},default:{default:"{lane_instruction}"}}}}},{}],36:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1e",2:"2e",3:"3e",4:"4e",5:"5e",6:"6e",7:"7e",8:"8e",9:"9e",10:"10e"},direction:{north:"noord",northeast:"noordoost",east:"oost",southeast:"zuidoost",south:"zuid",southwest:"zuidwest",west:"west",northwest:"noordwest"},modifier:{left:"links",right:"rechts","sharp left":"scherpe bocht naar links","sharp right":"scherpe bocht naar rechts","slight left":"iets naar links","slight right":"iets naar rechts",straight:"rechtdoor",uturn:"omkeren"},lanes:{xo:"Rechts aanhouden",ox:"Links aanhouden",xox:"In het midden blijven",oxo:"Links of rechts blijven"}},modes:{ferry:{default:"Neem de veerpont",name:"Neem de veerpont {way_name}",destination:"Neem de veerpont richting {destination}"}},phrase:{"two linked by distance":"{instruction_one}, dan na {distance}, {instruction_two}","two linked":"{instruction_one}, daarna {instruction_two}","one in distance":"Over {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"afslag {exit}"},arrive:{default:{default:"Je bent gearriveerd op de {nth} bestemming.",upcoming:"U arriveert op de {nth} bestemming",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}"},left:{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich links.",upcoming:"Uw {nth} bestemming bevindt zich aan de linkerkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}, de bestemming is aan de linkerkant"},right:{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich rechts.",upcoming:"Uw {nth} bestemming bevindt zich aan de rechterkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}, de bestemming is aan de  rechterkant"},"sharp left":{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich links.",upcoming:"Uw {nth} bestemming bevindt zich aan de linkerkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}, de bestemming is aan de linkerkant"},"sharp right":{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich rechts.",upcoming:"Uw {nth} bestemming bevindt zich aan de rechterkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name},  de bestemming is aan de rechterkant"},"slight right":{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich rechts.",upcoming:"Uw {nth} bestemming bevindt zich aan de rechterkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name},  de bestemming is aan de rechterkant"},"slight left":{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich links.",upcoming:"Uw {nth} bestemming bevindt zich aan de linkerkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name},  de bestemming is aan de linkerkant"},straight:{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich voor je.",upcoming:"Uw {nth} bestemming is recht voor u",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}, de bestemming is recht voor u"}},continue:{default:{default:"Ga {modifier}",name:"Sla {modifier} om op {way_name} te blijven",destination:"Ga {modifier} richting {destination}",exit:"Ga {modifier} naar {way_name}"},straight:{default:"Ga rechtdoor",name:"Blijf rechtdoor gaan op {way_name}",destination:"Ga rechtdoor richting {destination}",distance:"Ga rechtdoor voor {distance}",namedistance:"Ga verder op {way_name} voor {distance}"},"sharp left":{default:"Linksaf",name:"Sla scherp links af om op {way_name} te blijven",destination:"Linksaf richting {destination}"},"sharp right":{default:"Rechtsaf",name:"Sla scherp rechts af om op {way_name} te blijven",destination:"Rechtsaf richting {destination}"},"slight left":{default:"Ga links",name:"Links afbuigen om op {way_name} te blijven",destination:"Rechts afbuigen om op {destination} te blijven"},"slight right":{default:"Rechts afbuigen",name:"Rechts afbuigen om op {way_name} te blijven",destination:"Rechts afbuigen richting {destination}"},uturn:{default:"Keer om",name:"Draai om en ga verder op {way_name}",destination:"Keer om richting {destination}"}},depart:{default:{default:"Vertrek in {direction}elijke richting",name:"Neem {way_name} in {direction}elijke richting",namedistance:"Ga richting {direction} op {way_name} voor {distance}"}},"end of road":{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},straight:{default:"Ga in de aangegeven richting",name:"Ga naar {way_name}",destination:"Ga richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},fork:{default:{default:"Ga {modifier} op de splitsing",name:"Houd {modifier} aan, tot {way_name}",destination:"Houd {modifier}, in de richting van {destination}"},"slight left":{default:"Links aanhouden op de splitsing",name:"Houd links aan, tot {way_name}",destination:"Houd links aan, richting {destination}"},"slight right":{default:"Rechts aanhouden op de splitsing",name:"Houd rechts aan, tot {way_name}",destination:"Houd rechts aan, richting {destination}"},"sharp left":{default:"Neem bij de splitsing, een scherpe bocht, naar links ",name:"Neem een scherpe bocht naar links, tot aan {way_name}",destination:"Neem een scherpe bocht naar links, richting {destination}"},"sharp right":{default:"Neem  op de splitsing, een scherpe bocht, naar rechts",name:"Neem een scherpe bocht naar rechts, tot aan {way_name}",destination:"Neem een scherpe bocht naar rechts, richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},merge:{default:{default:"Bij de splitsing {modifier}",name:"Bij de splitsing {modifier} naar {way_name}",destination:"Bij de splitsing {modifier} richting {destination}"},straight:{default:"Samenvoegen",name:"Ga verder op {way_name}",destination:"Ga verder richting {destination}"},"slight left":{default:"Bij de splitsing links aanhouden",name:"Bij de splitsing links aanhouden naar {way_name}",destination:"Bij de splitsing links aanhouden richting {destination}"},"slight right":{default:"Bij de splitsing rechts aanhouden",name:"Bij de splitsing rechts aanhouden naar {way_name}",destination:"Bij de splitsing rechts aanhouden richting {destination}"},"sharp left":{default:"Bij de splitsing linksaf",name:"Bij de splitsing linksaf naar {way_name}",destination:"Bij de splitsing linksaf richting {destination}"},"sharp right":{default:"Bij de splitsing rechtsaf",name:"Bij de splitsing rechtsaf naar {way_name}",destination:"Bij de splitsing rechtsaf richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},"new name":{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},straight:{default:"Ga in de aangegeven richting",name:"Ga rechtdoor naar {way_name}",destination:"Ga rechtdoor richting {destination}"},"sharp left":{default:"Neem een scherpe bocht, naar links",name:"Linksaf naar {way_name}",destination:"Linksaf richting {destination}"},"sharp right":{default:"Neem een scherpe bocht, naar rechts",name:"Rechtsaf naar {way_name}",destination:"Rechtsaf richting {destination}"},"slight left":{default:"Links aanhouden",name:"Links aanhouden naar {way_name}",destination:"Links aanhouden richting {destination}"},"slight right":{default:"Rechts aanhouden",name:"Rechts aanhouden naar {way_name}",destination:"Rechts aanhouden richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},notification:{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},"off ramp":{default:{default:"Neem de afrit",name:"Neem de afrit naar {way_name}",destination:"Neem de afrit richting {destination}",exit:"Neem afslag {exit}",exit_destination:"Neem afslag {exit} richting {destination}"},left:{default:"Neem de afrit links",name:"Neem de afrit links naar {way_name}",destination:"Neem de afrit links richting {destination}",exit:"Neem afslag {exit} aan de linkerkant",exit_destination:"Neem afslag {exit} aan de linkerkant richting {destination}"},right:{default:"Neem de afrit rechts",name:"Neem de afrit rechts naar {way_name}",destination:"Neem de afrit rechts richting {destination}",exit:"Neem afslag {exit} aan de rechterkant",exit_destination:"Neem afslag {exit} aan de rechterkant richting {destination}"},"sharp left":{default:"Neem de afrit links",name:"Neem de afrit links naar {way_name}",destination:"Neem de afrit links richting {destination}",exit:"Neem afslag {exit} aan de linkerkant",exit_destination:"Neem afslag {exit} aan de linkerkant richting {destination}"},"sharp right":{default:"Neem de afrit rechts",name:"Neem de afrit rechts naar {way_name}",destination:"Neem de afrit rechts richting {destination}",exit:"Neem afslag {exit} aan de rechterkant",exit_destination:"Neem afslag {exit} aan de rechterkant richting {destination}"},"slight left":{default:"Neem de afrit links",name:"Neem de afrit links naar {way_name}",destination:"Neem de afrit links richting {destination}",exit:"Neem afslag {exit} aan de linkerkant",exit_destination:"Neem afslag {exit} aan de linkerkant richting {destination}"},"slight right":{default:"Neem de afrit rechts",name:"Neem de afrit rechts naar {way_name}",destination:"Neem de afrit rechts richting {destination}",exit:"Neem afslag {exit} aan de rechterkant",exit_destination:"Neem afslag {exit} aan de rechterkant richting {destination}"}},"on ramp":{default:{default:"Neem de oprit",name:"Neem de oprit naar {way_name}",destination:"Neem de oprit richting {destination}"},left:{default:"Neem de oprit links",name:"Neem de oprit links naar {way_name}",destination:"Neem de oprit links richting {destination}"},right:{default:"Neem de oprit rechts",name:"Neem de oprit rechts naar {way_name}",destination:"Neem de oprit rechts richting {destination}"},"sharp left":{default:"Neem de oprit links",name:"Neem de oprit links naar {way_name}",destination:"Neem de oprit links richting {destination}"},"sharp right":{default:"Neem de oprit rechts",name:"Neem de oprit rechts naar {way_name}",destination:"Neem de oprit rechts richting {destination}"},"slight left":{default:"Neem de oprit links",name:"Neem de oprit links naar {way_name}",destination:"Neem de oprit links richting {destination}"},"slight right":{default:"Neem de oprit rechts",name:"Neem de oprit rechts naar {way_name}",destination:"Neem de oprit rechts richting {destination}"}},rotary:{default:{default:{default:"Betreedt de rotonde",name:"Betreedt rotonde en sla af op {way_name}",destination:"Betreedt rotonde en sla af richting {destination}"},name:{default:"Ga het knooppunt {rotary_name} op",name:"Verlaat het knooppunt {rotary_name} naar {way_name}",destination:"Verlaat het knooppunt {rotary_name} richting {destination}"},exit:{default:"Betreedt rotonde en neem afslag {exit_number}",name:"Betreedt rotonde en neem afslag {exit_number} naar {way_name}",destination:"Betreedt rotonde en neem afslag {exit_number} richting {destination}"},name_exit:{default:"Ga het knooppunt {rotary_name} op en neem afslag {exit_number}",name:"Ga het knooppunt {rotary_name} op en neem afslag {exit_number} naar {way_name}",destination:"Ga het knooppunt {rotary_name} op en neem afslag {exit_number} richting {destination}"}}},roundabout:{default:{exit:{default:"Betreedt rotonde en neem afslag {exit_number}",name:"Betreedt rotonde en neem afslag {exit_number} naar {way_name}",destination:"Betreedt rotonde en neem afslag {exit_number} richting {destination}"},default:{default:"Betreedt de rotonde",name:"Betreedt rotonde en sla af op {way_name}",destination:"Betreedt rotonde en sla af richting {destination}"}}},"roundabout turn":{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},left:{default:"Ga linksaf",name:"Ga linksaf naar {way_name}",destination:"Ga linksaf richting {destination}"},right:{default:"Ga rechtsaf",name:"Ga rechtsaf naar {way_name}",destination:"Ga rechtsaf richting {destination}"},straight:{default:"Ga in de aangegeven richting",name:"Ga naar {way_name}",destination:"Ga richting {destination}"}},"exit roundabout":{default:{default:"Verlaat de rotonde",name:"Verlaat de rotonde en ga verder op {way_name}",destination:"Verlaat de rotonde richting {destination}"}},"exit rotary":{default:{default:"Verlaat de rotonde",name:"Verlaat de rotonde en ga verder op {way_name}",destination:"Verlaat de rotonde richting {destination}"}},turn:{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},left:{default:"Ga linksaf",name:"Ga linksaf naar {way_name}",destination:"Ga linksaf richting {destination}"},right:{default:"Ga rechtsaf",name:"Ga rechtsaf naar {way_name}",destination:"Ga rechtsaf richting {destination}"},straight:{default:"Ga rechtdoor",name:"Ga rechtdoor naar {way_name}",destination:"Ga rechtdoor richting {destination}"}},"use lane":{no_lanes:{default:"Rechtdoor"},default:{default:"{lane_instruction}"}}}}},{}],37:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1.",2:"2.",3:"3.",4:"4.",5:"5.",6:"6.",7:"7.",8:"8.",9:"9.",10:"10."},direction:{north:"nord",northeast:"nordst",east:"st",southeast:"srst",south:"sr",southwest:"srvest",west:"vest",northwest:"nordvest"},modifier:{left:"venstre",right:"hyre","sharp left":"skarp venstre","sharp right":"skarp hyre","slight left":"litt til venstre","slight right":"litt til hyre",straight:"rett frem",uturn:"U-sving"},lanes:{xo:"Hold til hyre",ox:"Hold til venstre",xox:"Hold deg i midten",oxo:"Hold til venstre eller hyre"}},modes:{ferry:{default:"Ta ferja",name:"Ta ferja {way_name}",destination:"Ta ferja til {destination}"}},phrase:{"two linked by distance":"{instruction_one}, deretter {instruction_two} om {distance}","two linked":"{instruction_one}, deretter {instruction_two}","one in distance":"Om {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"avkjrsel {exit}"},arrive:{default:{default:"Du har ankommet din {nth} destinasjon",upcoming:"Du vil ankomme din {nth} destinasjon",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}"},left:{default:"Du har ankommet din {nth} destinasjon, p din venstre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din venstre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din venstre side"},right:{default:"Du har ankommet din {nth} destinasjon, p din hyre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din hyre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din hyre side"},"sharp left":{default:"Du har ankommet din {nth} destinasjon, p din venstre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din venstre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din venstre side"},"sharp right":{default:"Du har ankommet din {nth} destinasjon, p din hyre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din hyre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din hyre side"},"slight right":{default:"Du har ankommet din {nth} destinasjon, p din hyre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din hyre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din hyre side"},"slight left":{default:"Du har ankommet din {nth} destinasjon, p din venstre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din venstre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din venstre side"},straight:{default:"Du har ankommet din {nth} destinasjon, rett forut",upcoming:"Du vil ankomme din {nth} destinasjon, rett forut",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, rett forut"}},continue:{default:{default:"Ta til {modifier}",name:"Ta til {modifier} for  bli vrende p {way_name}",destination:"Ta til {modifier} mot {destination}",exit:"Ta til {modifier} inn p {way_name}"},straight:{default:"Fortsett rett frem",name:"Fortsett rett frem for  bli vrende p {way_name}",destination:"Fortsett mot {destination}",distance:"Fortsett rett frem, {distance} ",namedistance:"Fortsett p {way_name}, {distance}"},"sharp left":{default:"Sving skarpt til venstre",name:"Sving skarpt til venstre for  bli vrende p {way_name}",destination:"Sving skarpt til venstre mot {destination}"},"sharp right":{default:"Sving skarpt til hyre",name:"Sving skarpt til hyre for  bli vrende p {way_name}",destination:"Sving skarpt mot {destination}"},"slight left":{default:"Sving svakt til venstre",name:"Sving svakt til venstre for  bli vrende p {way_name}",destination:"Sving svakt til venstre mot {destination}"},"slight right":{default:"Sving svakt til hyre",name:"Sving svakt til hyre for  bli vrende p {way_name}",destination:"Sving svakt til hyre mot {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving og fortsett p {way_name}",destination:"Ta en U-sving mot {destination}"}},depart:{default:{default:"Kjr i retning {direction}",name:"Kjr i retning {direction} p {way_name}",namedistance:"Kjr i retning {direction} p {way_name}, {distance}"}},"end of road":{default:{default:"Sving {modifier}",name:"Ta til {modifier} inn p {way_name}",destination:"Sving {modifier} mot {destination}"},straight:{default:"Fortsett rett frem",name:"Fortsett rett frem til  {way_name}",destination:"Fortsett rett frem mot {destination}"},uturn:{default:"Ta en U-sving i enden av veien",name:"Ta en U-sving til {way_name} i enden av veien",destination:"Ta en U-sving mot {destination} i enden av veien"}},fork:{default:{default:"Hold til {modifier} i veikrysset",name:"Hold til {modifier} inn p {way_name}",destination:"Hold til {modifier} mot {destination}"},"slight left":{default:"Hold til venstre i veikrysset",name:"Hold til venstre inn p {way_name}",destination:"Hold til venstre mot {destination}"},"slight right":{default:"Hold til hyre i veikrysset",name:"Hold til hyre inn p {way_name}",destination:"Hold til hyre mot {destination}"},"sharp left":{default:"Sving skarpt til venstre i veikrysset",name:"Sving skarpt til venstre inn p {way_name}",destination:"Sving skarpt til venstre mot {destination}"},"sharp right":{default:"Sving skarpt til hyre i veikrysset",name:"Sving skarpt til hyre inn p {way_name}",destination:"Svings skarpt til hyre mot {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving til {way_name}",destination:"Ta en U-sving mot {destination}"}},merge:{default:{default:"Hold {modifier} kjrefelt",name:"Hold {modifier} kjrefelt inn p {way_name}",destination:"Hold {modifier} kjrefelt mot {destination}"},straight:{default:"Hold kjrefelt",name:"Hold kjrefelt inn p {way_name}",destination:"Hold kjrefelt mot {destination}"},"slight left":{default:"Hold venstre kjrefelt",name:"Hold venstre kjrefelt inn p {way_name}",destination:"Hold venstre kjrefelt mot {destination}"},"slight right":{default:"Hold hyre kjrefelt",name:"Hold hyre kjrefelt inn p {way_name}",destination:"Hold hyre kjrefelt mot {destination}"},"sharp left":{default:"Hold venstre kjrefelt",name:"Hold venstre kjrefelt inn p {way_name}",destination:"Hold venstre kjrefelt mot {destination}"},"sharp right":{default:"Hold hyre kjrefelt",name:"Hold hyre kjrefelt inn p {way_name}",destination:"Hold hyre kjrefelt mot {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving til {way_name}",destination:"Ta en U-sving mot {destination}"}},"new name":{default:{default:"Fortsett {modifier}",name:"Fortsett {modifier} til {way_name}",destination:"Fortsett {modifier} mot  {destination}"},straight:{default:"Fortsett rett frem",name:"Fortsett inn p {way_name}",destination:"Fortsett mot {destination}"},"sharp left":{default:"Sving skarpt til venstre",name:"Sving skarpt til venstre inn p {way_name}",destination:"Sving skarpt til venstre mot {destination}"},"sharp right":{default:"Sving skarpt til hyre",name:"Sving skarpt til hyre inn p {way_name}",destination:"Svings skarpt til hyre mot {destination}"},"slight left":{default:"Fortsett litt mot venstre",name:"Fortsett litt mot venstre til {way_name}",destination:"Fortsett litt mot venstre mot {destination}"},"slight right":{default:"Fortsett litt mot hyre",name:"Fortsett litt mot hyre til {way_name}",destination:"Fortsett litt mot hyre mot {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving til {way_name}",destination:"Ta en U-sving mot {destination}"}},notification:{default:{default:"Fortsett {modifier}",name:"Fortsett {modifier} til {way_name}",destination:"Fortsett {modifier} mot  {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving til {way_name}",destination:"Ta en U-sving mot {destination}"}},"off ramp":{default:{default:"Ta avkjrselen",name:"Ta avkjrselen inn p {way_name}",destination:"Ta avkjrselen mot {destination}",exit:"Ta avkjrsel {exit}",exit_destination:"Ta avkjrsel {exit} mot {destination}"},left:{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}",exit:"Ta avkjrsel {exit} p venstre side",exit_destination:"Ta avkjrsel {exit} p venstre side mot {destination}"},right:{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}",exit:"Ta avkjrsel {exit} p hyre side",exit_destination:"Ta avkjrsel {exit} p hyre side mot {destination}"},"sharp left":{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}",exit:"Ta avkjrsel {exit} p venstre side",exit_destination:"Ta avkjrsel {exit} p venstre side mot {destination}"},"sharp right":{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}",exit:"Ta avkjrsel {exit} p hyre side",exit_destination:"Ta avkjrsel {exit} p hyre side mot {destination}"},"slight left":{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}",exit:"Ta avkjrsel {exit} p venstre side",exit_destination:"Ta avkjrsel {exit} p venstre side mot {destination}"},"slight right":{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}",exit:"Ta avkjrsel {exit} p hyre side",exit_destination:"Ta avkjrsel {exit} p hyre side mot {destination}"}},"on ramp":{default:{default:"Ta avkjrselen",name:"Ta avkjrselen inn p {way_name}",destination:"Ta avkjrselen mot {destination}"},left:{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}"},right:{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}"},"sharp left":{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}"},"sharp right":{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}"},"slight left":{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}"},"slight right":{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}"}},rotary:{default:{default:{default:"Kjr inn i rundkjringen",name:"Kjr inn i rundkjringen og deretter ut p {way_name}",destination:"Kjr inn i rundkjringen og deretter ut mot {destination}"},name:{default:"Kjr inn i {rotary_name}",name:"Kjr inn i {rotary_name} og deretter ut p {way_name}",destination:"Kjr inn i {rotary_name} og deretter ut mot {destination}"},exit:{default:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel",name:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel ut p {way_name}",destination:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel ut mot {destination} "},name_exit:{default:"Kjr inn i {rotary_name} og ta {exit_number} avkjrsel",name:"Kjr inn i {rotary_name} og ta {exit_number} avkjrsel inn p {way_name}",destination:"Kjr inn i {rotary_name} og ta {exit_number} avkjrsel mot {destination}"}}},roundabout:{default:{exit:{default:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel",name:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel inn p {way_name}",destination:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel ut mot {destination} "},default:{default:"Kjr inn i rundkjringen",name:"Kjr inn i rundkjringen og deretter ut p {way_name}",destination:"Kjr inn i rundkjringen og deretter ut mot {destination}"}}},"roundabout turn":{default:{default:"Ta en {modifier}",name:"Ta en {modifier} inn p {way_name}",destination:"Ta en {modifier} mot {destination}"},left:{default:"Sving til venstre",name:"Sving til venstre inn p {way_name}",destination:"Sving til venstre mot {destination}"},right:{default:"Sving til hyre",name:"Sving til hyre inn p {way_name}",destination:"Sving til hyre mot {destination}"},straight:{default:"Fortsett rett frem",name:"Fortsett rett frem til  {way_name}",destination:"Fortsett rett frem mot {destination}"}},"exit roundabout":{default:{default:"Kjr ut av rundkjringen",name:"Kjr ut av rundkjringen og inn p {way_name}",destination:"Kjr ut av rundkjringen mot {destination}"}},"exit rotary":{default:{default:"Kjr ut av rundkjringen",name:"Kjr ut av rundkjringen og inn p {way_name}",destination:"Kjr ut av rundkjringen mot {destination}"}},turn:{default:{default:"Ta en {modifier}",name:"Ta en {modifier} inn p {way_name}",destination:"Ta en {modifier} mot {destination}"},left:{default:"Sving til venstre",name:"Sving til venstre inn p {way_name}",destination:"Sving til venstre mot {destination}"},right:{default:"Sving til hyre",name:"Sving til hyre inn p {way_name}",destination:"Sving til hyre mot {destination}"},straight:{default:"Kjr rett frem",name:"Kjr rett frem og inn p {way_name}",destination:"Kjr rett frem mot {destination}"}},"use lane":{no_lanes:{default:"Fortsett rett frem"},default:{default:"{lane_instruction}"}}}}},{}],38:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1.",2:"2.",3:"3.",4:"4.",5:"5.",6:"6.",7:"7.",8:"8.",9:"9.",10:"10."},direction:{north:"pnoc",northeast:"pnocny wschd",east:"wschd",southeast:"poudniowy wschd",south:"poudnie",southwest:"poudniowy zachd",west:"zachd",northwest:"pnocny zachd"},modifier:{left:"lewo",right:"prawo","sharp left":"ostro w lewo","sharp right":"ostro w prawo","slight left":"agodnie w lewo","slight right":"agodnie w prawo",straight:"prosto",uturn:"zawr"},lanes:{xo:"Trzymaj si prawej strony",ox:"Trzymaj si lewej strony",xox:"Trzymaj si rodka",oxo:"Trzymaj si lewej lub prawej strony"}},modes:{ferry:{default:"We prom",name:"We prom {way_name}",destination:"We prom w kierunku {destination}"}},phrase:{"two linked by distance":"{instruction_one}, nastpnie za {distance} {instruction_two}","two linked":"{instruction_one}, nastpnie {instruction_two}","one in distance":"Za {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Dojechano do miejsca docelowego {nth}",upcoming:"Dojechano do miejsca docelowego {nth}",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}"},left:{default:"Dojechano do miejsca docelowego {nth}, po lewej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po lewej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po lewej stronie"},right:{default:"Dojechano do miejsca docelowego {nth}, po prawej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po prawej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po prawej stronie"},"sharp left":{default:"Dojechano do miejsca docelowego {nth}, po lewej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po lewej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po lewej stronie"},"sharp right":{default:"Dojechano do miejsca docelowego {nth}, po prawej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po prawej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po prawej stronie"},"slight right":{default:"Dojechano do miejsca docelowego {nth}, po prawej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po prawej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po prawej stronie"},"slight left":{default:"Dojechano do miejsca docelowego {nth}, po lewej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po lewej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po lewej stronie"},straight:{default:"Dojechano do miejsca docelowego {nth} , prosto",upcoming:"Dojechano do miejsca docelowego {nth} , prosto",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, prosto"}},continue:{default:{default:"Skr {modifier}",name:"Skr w {modifier}, aby pozosta na {way_name}",destination:"Skr {modifier} w kierunku {destination}",exit:"Skr {modifier} na {way_name}"},straight:{default:"Kontynuuj prosto",name:"Jed dalej prosto, aby pozosta na {way_name}",destination:"Kontynuuj w kierunku {destination}",distance:"Jed dalej prosto przez {distance}",namedistance:"Jed dalej {way_name} przez {distance}"},"sharp left":{default:"Skr ostro w lewo",name:"Skr w lewo w ostry zakrt, aby pozosta na {way_name}",destination:"Skr ostro w lewo w kierunku {destination}"},"sharp right":{default:"Skr ostro w prawo",name:"Skr w prawo w ostry zakrt, aby pozosta na {way_name}",destination:"Skr ostro w prawo w kierunku {destination}"},"slight left":{default:"Skr w lewo w agodny zakrt",name:"Skr w lewo w agodny zakrt, aby pozosta na {way_name}",destination:"Skr w lewo w agodny zakrt na {destination}"},"slight right":{default:"Skr w prawo w agodny zakrt",name:"Skr w prawo w agodny zakrt, aby pozosta na {way_name}",destination:"Skr w prawo w agodny zakrt na {destination}"},uturn:{default:"Zawr",name:"Zawr i jed dalej {way_name}",destination:"Zawr w kierunku {destination}"}},depart:{default:{default:"Kieruj si {direction}",name:"Kieruj si {direction} na {way_name}",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"Skr {modifier}",name:"Skr {modifier} na {way_name}",destination:"Skr {modifier} w kierunku {destination}"},straight:{default:"Kontynuuj prosto",name:"Kontynuuj prosto na {way_name}",destination:"Kontynuuj prosto w kierunku {destination}"},uturn:{default:"Zawr na kocu ulicy",name:"Zawr na kocu ulicy na {way_name}",destination:"Zawr na kocu ulicy w kierunku {destination}"}},fork:{default:{default:"Na rozwidleniu trzymaj si {modifier}",name:"Na rozwidleniu trzymaj si {modifier} na {way_name}",destination:"Na rozwidleniu trzymaj si {modifier} w kierunku {destination}"},"slight left":{default:"Na rozwidleniu trzymaj si lewej strony",name:"Na rozwidleniu trzymaj si lewej strony w {way_name}",destination:"Na rozwidleniu trzymaj si lewej strony w kierunku {destination}"},"slight right":{default:"Na rozwidleniu trzymaj si prawej strony",name:"Na rozwidleniu trzymaj si prawej strony na {way_name}",destination:"Na rozwidleniu trzymaj si prawej strony w kierunku {destination}"},"sharp left":{default:"Na rozwidleniu skr ostro w lewo",name:"Skr ostro w lewo w {way_name}",destination:"Skr ostro w lewo w kierunku {destination}"},"sharp right":{default:"Na rozwidleniu skr ostro w prawo",name:"Skr ostro w prawo na {way_name}",destination:"Skr ostro w prawo w kierunku {destination}"},uturn:{default:"Zawr",name:"Zawr na {way_name}",destination:"Zawr w kierunku {destination}"}},merge:{default:{default:"Wcz si {modifier}",name:"Wcz si {modifier} na {way_name}",destination:"Wcz si {modifier} w kierunku {destination}"},straight:{default:"Wcz si prosto",name:"Wcz si prosto na {way_name}",destination:"Wcz si prosto w kierunku {destination}"},"slight left":{default:"Wcz si z lewej strony",name:"Wcz si z lewej strony na {way_name}",destination:"Wcz si z lewej strony w kierunku {destination}"},"slight right":{default:"Wcz si z prawej strony",name:"Wcz si z prawej strony na {way_name}",destination:"Wcz si z prawej strony w kierunku {destination}"},"sharp left":{default:"Wcz si z lewej strony",name:"Wcz si z lewej strony na {way_name}",destination:"Wcz si z lewej strony w kierunku {destination}"},"sharp right":{default:"Wcz si z prawej strony",name:"Wcz si z prawej strony na {way_name}",destination:"Wcz si z prawej strony w kierunku {destination}"},uturn:{default:"Zawr",name:"Zawr na {way_name}",destination:"Zawr w kierunku {destination}"}},"new name":{default:{default:"Kontynuuj {modifier}",name:"Kontynuuj {modifier} na {way_name}",destination:"Kontynuuj {modifier} w kierunku {destination}"},straight:{default:"Kontynuuj prosto",name:"Kontynuuj na {way_name}",destination:"Kontynuuj w kierunku {destination}"},"sharp left":{default:"Skr ostro w lewo",name:"Skr ostro w lewo w {way_name}",destination:"Skr ostro w lewo w kierunku {destination}"},"sharp right":{default:"Skr ostro w prawo",name:"Skr ostro w prawo na {way_name}",destination:"Skr ostro w prawo w kierunku {destination}"},"slight left":{default:"Kontynuuj agodnie w lewo",name:"Kontynuuj agodnie w lewo na {way_name}",destination:"Kontynuuj agodnie w lewo w kierunku {destination}"},"slight right":{default:"Kontynuuj agodnie w prawo",name:"Kontynuuj agodnie w prawo na {way_name}",destination:"Kontynuuj agodnie w prawo w kierunku {destination}"},uturn:{default:"Zawr",name:"Zawr na {way_name}",destination:"Zawr w kierunku {destination}"}},notification:{default:{default:"Kontynuuj {modifier}",name:"Kontynuuj {modifier} na {way_name}",destination:"Kontynuuj {modifier} w kierunku {destination}"},uturn:{default:"Zawr",name:"Zawr na {way_name}",destination:"Zawr w kierunku {destination}"}},"off ramp":{default:{default:"Zjed",name:"We zjazd na {way_name}",destination:"We zjazd w kierunku {destination}",exit:"Zjed zjazdem {exit}",exit_destination:"Zjed zjazdem {exit} na {destination}"},left:{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}",exit:"Zjed zjazdem {exit} po lewej stronie",exit_destination:"Zjed zjazdem {exit} po lewej stronie na {destination}"},right:{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}",exit:"Zjed zjazdem {exit} po prawej stronie",exit_destination:"Zjed zjazdem {exit} po prawej stronie na {destination}"},"sharp left":{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}",exit:"Zjed zjazdem {exit} po lewej stronie",exit_destination:"Zjed zjazdem {exit} po lewej stronie na {destination}"},"sharp right":{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}",exit:"Zjed zjazdem {exit} po prawej stronie",exit_destination:"Zjed zjazdem {exit} po prawej stronie na {destination}"},"slight left":{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}",exit:"Zjed zjazdem {exit} po lewej stronie",exit_destination:"Zjed zjazdem {exit} po lewej stronie na {destination}"},"slight right":{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}",exit:"Zjed zjazdem {exit} po prawej stronie",exit_destination:"Zjed zjazdem {exit} po prawej stronie na {destination}"}},"on ramp":{default:{default:"We zjazd",name:"We zjazd na {way_name}",destination:"We zjazd w kierunku {destination}"},left:{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}"},right:{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}"},"sharp left":{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}"},"sharp right":{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}"},"slight left":{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}"},"slight right":{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}"}},rotary:{default:{default:{default:"Wjed na rondo",name:"Wjed na rondo i skr na {way_name}",destination:"Wjed na rondo i skr w kierunku {destination}"},name:{default:"Wjed na {rotary_name}",name:"Wjed na {rotary_name} i skr na {way_name}",destination:"Wjed na {rotary_name} i skr w kierunku {destination}"},exit:{default:"Wjed na rondo i wyjed {exit_number} zjazdem",name:"Wjed na rondo i wyjed {exit_number} zjazdem na {way_name}",destination:"Wjed na rondo i wyjed {exit_number} zjazdem w kierunku {destination}"},name_exit:{default:"Wjed na {rotary_name} i wyjed {exit_number} zjazdem",name:"Wjed na {rotary_name} i wyjed {exit_number} zjazdem na {way_name}",destination:"Wjed na {rotary_name} i wyjed {exit_number} zjazdem w kierunku {destination}"}}},roundabout:{default:{exit:{default:"Wjed na rondo i wyjed {exit_number} zjazdem",name:"Wjed na rondo i wyjed {exit_number} zjazdem na {way_name}",destination:"Wjed na rondo i wyjed {exit_number} zjazdem w kierunku {destination}"},default:{default:"Wjed na rondo",name:"Wjed na rondo i wyjed na {way_name}",destination:"Wjed na rondo i wyjed w kierunku {destination}"}}},"roundabout turn":{default:{default:"{modifier}",name:"{modifier} na {way_name}",destination:"{modifier} w kierunku {destination}"},left:{default:"Skr w lewo",name:"Skr w lewo na {way_name}",destination:"Skr w lewo w kierunku {destination}"},right:{default:"Skr w prawo",name:"Skr w prawo na {way_name}",destination:"Skr w prawo w kierunku {destination}"},straight:{default:"Kontynuuj prosto",name:"Kontynuuj prosto na {way_name}",destination:"Kontynuuj prosto w kierunku {destination}"}},"exit roundabout":{default:{default:"{modifier}",name:"{modifier} na {way_name}",destination:"{modifier} w kierunku {destination}"},left:{default:"Skr w lewo",name:"Skr w lewo na {way_name}",destination:"Skr w lewo w kierunku {destination}"},right:{default:"Skr w prawo",name:"Skr w prawo na {way_name}",destination:"Skr w prawo w kierunku {destination}"},straight:{default:"Kontynuuj prosto",name:"Kontynuuj prosto na {way_name}",destination:"Kontynuuj prosto w kierunku {destination}"}},"exit rotary":{default:{default:"{modifier}",name:"{modifier} na {way_name}",destination:"{modifier} w kierunku {destination}"},left:{default:"Skr w lewo",name:"Skr w lewo na {way_name}",destination:"Skr w lewo w kierunku {destination}"},right:{default:"Skr w prawo",name:"Skr w prawo na {way_name}",destination:"Skr w prawo w kierunku {destination}"},straight:{default:"Jed prosto",name:"Jed prosto na {way_name}",destination:"Jed prosto w kierunku {destination}"}},turn:{default:{default:"{modifier}",name:"{modifier} na {way_name}",destination:"{modifier} w kierunku {destination}"},left:{default:"Skr w lewo",name:"Skr w lewo na {way_name}",destination:"Skr w lewo w kierunku {destination}"},right:{default:"Skr w prawo",name:"Skr w prawo na {way_name}",destination:"Skr w prawo w kierunku {destination}"},straight:{default:"Jed prosto",name:"Jed prosto na {way_name}",destination:"Jed prosto w kierunku {destination}"}},"use lane":{no_lanes:{default:"Kontynuuj prosto"},default:{default:"{lane_instruction}"}}}}},{}],39:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"norte",northeast:"nordeste",east:"leste",southeast:"sudeste",south:"sul",southwest:"sudoeste",west:"oeste",northwest:"noroeste"},modifier:{left:" esquerda",right:" direita","sharp left":"fechada  esquerda","sharp right":"fechada  direita","slight left":"suave  esquerda","slight right":"suave  direita",straight:"em frente",uturn:"retorno"},lanes:{xo:"Mantenha-se  direita",ox:"Mantenha-se  esquerda",xox:"Mantenha-se ao centro",oxo:"Mantenha-se  esquerda ou direita"}},modes:{ferry:{default:"Pegue a balsa",name:"Pegue a balsa {way_name}",destination:"Pegue a balsa sentido {destination}"}},phrase:{"two linked by distance":"{instruction_one}, ento, em {distance}, {instruction_two}","two linked":"{instruction_one}, ento {instruction_two}","one in distance":"Em {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"sada {exit}"},arrive:{default:{default:"Voc chegou ao seu {nth} destino",upcoming:"Voc chegar ao seu {nth} destino",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou a {waypoint_name}"},left:{default:"Voc chegou ao seu {nth} destino,  esquerda",upcoming:"Voc chegar ao seu {nth} destino,  esquerda",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  esquerda"},right:{default:"Voc chegou ao seu {nth} destino,  direita",upcoming:"Voc chegar ao seu {nth} destino,  direita",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  direita"},"sharp left":{default:"Voc chegou ao seu {nth} destino,  esquerda",upcoming:"Voc chegar ao seu {nth} destino,  esquerda",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  esquerda"},"sharp right":{default:"Voc chegou ao seu {nth} destino,  direita",upcoming:"Voc chegar ao seu {nth} destino,  direita",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  direita"},"slight right":{default:"Voc chegou ao seu {nth} destino,  direita",upcoming:"Voc chegar ao seu {nth} destino,  direita",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  direita"},"slight left":{default:"Voc chegou ao seu {nth} destino,  esquerda",upcoming:"Voc chegar ao seu {nth} destino,  esquerda",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  esquerda"},straight:{default:"Voc chegou ao seu {nth} destino, em frente",upcoming:"Voc vai chegar ao seu {nth} destino, em frente",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"You have arrived at {waypoint_name}, straight ahead"}},continue:{default:{default:"Vire {modifier}",name:"Vire {modifier} para manter-se na {way_name}",destination:"Vire {modifier} sentido {destination}",exit:"Vire {modifier} em {way_name}"},straight:{default:"Continue em frente",name:"Continue em frente para manter-se na {way_name}",destination:"Continue em direo  {destination}",distance:"Continue em frente por {distance}",namedistance:"Continue na {way_name} por {distance}"},"sharp left":{default:"Faa uma curva fechada a esquerda",name:"Faa uma curva fechada a esquerda para manter-se na {way_name}",destination:"Faa uma curva fechada a esquerda sentido {destination}"},"sharp right":{default:"Faa uma curva fechada a direita",name:"Faa uma curva fechada a direita para manter-se na {way_name}",destination:"Faa uma curva fechada a direita sentido {destination}"},"slight left":{default:"Faa uma curva suave a esquerda",name:"Faa uma curva suave a esquerda para manter-se na {way_name}",destination:"Faa uma curva suave a esquerda em direo a {destination}"},"slight right":{default:"Faa uma curva suave a direita",name:"Faa uma curva suave a direita para manter-se na {way_name}",destination:"Faa uma curva suave a direita em direo a {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno e continue em {way_name}",destination:"Faa o retorno sentido {destination}"}},depart:{default:{default:"Siga {direction}",name:"Siga {direction} em {way_name}",namedistance:"Siga {direction} na {way_name} por {distance}"}},"end of road":{default:{default:"Vire {modifier}",name:"Vire {modifier} em {way_name}",destination:"Vire {modifier} sentido {destination}"},straight:{default:"Continue em frente",name:"Continue em frente em {way_name}",destination:"Continue em frente sentido {destination}"},uturn:{default:"Faa o retorno no fim da rua",name:"Faa o retorno em {way_name} no fim da rua",destination:"Faa o retorno sentido {destination} no fim da rua"}},fork:{default:{default:"Mantenha-se {modifier} na bifurcao",name:"Mantenha-se {modifier} na bifurcao em {way_name}",destination:"Mantenha-se {modifier} na bifurcao sentido {destination}"},"slight left":{default:"Mantenha-se  esquerda na bifurcao",name:"Mantenha-se  esquerda na bifurcao em {way_name}",destination:"Mantenha-se  esquerda na bifurcao sentido {destination}"},"slight right":{default:"Mantenha-se  direita na bifurcao",name:"Mantenha-se  direita na bifurcao em {way_name}",destination:"Mantenha-se  direita na bifurcao sentido {destination}"},"sharp left":{default:"Faa uma curva fechada  esquerda na bifurcao",name:"Faa uma curva fechada  esquerda em {way_name}",destination:"Faa uma curva fechada  esquerda sentido {destination}"},"sharp right":{default:"Faa uma curva fechada  direita na bifurcao",name:"Faa uma curva fechada  direita em {way_name}",destination:"Faa uma curva fechada  direita sentido {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno em {way_name}",destination:"Faa o retorno sentido {destination}"}},merge:{default:{default:"Entre {modifier}",name:"Entre {modifier} na {way_name}",destination:"Entre {modifier} em direo  {destination}"},straight:{default:"Mesclar",name:"Entre reto na {way_name}",destination:"Entre reto em direo  {destination}"},"slight left":{default:"Entre  esquerda",name:"Entre  esquerda na {way_name}",destination:"Entre  esquerda em direo  {destination}"},"slight right":{default:"Entre  direita",name:"Entre  direita na {way_name}",destination:"Entre  direita em direo  {destination}"},"sharp left":{default:"Entre  esquerda",name:"Entre  esquerda na {way_name}",destination:"Entre  esquerda em direo  {destination}"},"sharp right":{default:"Entre  direita",name:"Entre  direita na {way_name}",destination:"Entre  direita em direo  {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno em {way_name}",destination:"Faa o retorno sentido {destination}"}},"new name":{default:{default:"Continue {modifier}",name:"Continue {modifier} em {way_name}",destination:"Continue {modifier} sentido {destination}"},straight:{default:"Continue em frente",name:"Continue em {way_name}",destination:"Continue em direo  {destination}"},"sharp left":{default:"Faa uma curva fechada  esquerda",name:"Faa uma curva fechada  esquerda em {way_name}",destination:"Faa uma curva fechada  esquerda sentido {destination}"},"sharp right":{default:"Faa uma curva fechada  direita",name:"Faa uma curva fechada  direita em {way_name}",destination:"Faa uma curva fechada  direita sentido {destination}"},"slight left":{default:"Continue ligeiramente  esquerda",name:"Continue ligeiramente  esquerda em {way_name}",destination:"Continue ligeiramente  esquerda sentido {destination}"},"slight right":{default:"Continue ligeiramente  direita",name:"Continue ligeiramente  direita em {way_name}",destination:"Continue ligeiramente  direita sentido {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno em {way_name}",destination:"Faa o retorno sentido {destination}"}},notification:{default:{default:"Continue {modifier}",name:"Continue {modifier} em {way_name}",destination:"Continue {modifier} sentido {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno em {way_name}",destination:"Faa o retorno sentido {destination}"}},"off ramp":{default:{default:"Pegue a rampa",name:"Pegue a rampa em {way_name}",destination:"Pegue a rampa sentido {destination}",exit:"Pegue a sada {exit}",exit_destination:"Pegue a sada {exit} em direo  {destination}"},left:{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}",exit:"Pegue a sada {exit}  esquerda",exit_destination:"Pegue a sada {exit}   esquerda em direo  {destination}"},right:{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}",exit:"Pegue a sada {exit}  direita",exit_destination:"Pegue a sada {exit}  direita em direo  {destination}"},"sharp left":{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}",exit:"Pegue a sada {exit}  esquerda",exit_destination:"Pegue a sada {exit}   esquerda em direo  {destination}"},"sharp right":{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}",exit:"Pegue a sada {exit}  direita",exit_destination:"Pegue a sada {exit}  direita em direo  {destination}"},"slight left":{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}",exit:"Pegue a sada {exit}  esquerda",exit_destination:"Pegue a sada {exit}   esquerda em direo  {destination}"},"slight right":{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}",exit:"Pegue a sada {exit}  direita",exit_destination:"Pegue a sada {exit}  direita em direo  {destination}"}},"on ramp":{default:{default:"Pegue a rampa",name:"Pegue a rampa em {way_name}",destination:"Pegue a rampa sentido {destination}"},left:{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}"},right:{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentid {destination}"},"sharp left":{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}"},"sharp right":{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}"},"slight left":{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}"},"slight right":{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}"}},rotary:{default:{default:{default:"Entre na rotatria",name:"Entre na rotatria e saia na {way_name}",destination:"Entre na rotatria e saia sentido {destination}"},name:{default:"Entre em {rotary_name}",name:"Entre em {rotary_name} e saia em {way_name}",destination:"Entre em {rotary_name} e saia sentido {destination}"},exit:{default:"Entre na rotatria e pegue a {exit_number} sada",name:"Entre na rotatria e pegue a {exit_number} sada na {way_name}",destination:"Entre na rotatria e pegue a {exit_number} sada sentido {destination}"},name_exit:{default:"Entre em {rotary_name} e saia na {exit_number} sada",name:"Entre em {rotary_name} e saia na {exit_number} sada em {way_name}",destination:"Entre em {rotary_name} e saia na {exit_number} sada sentido {destination}"}}},roundabout:{default:{exit:{default:"Entre na rotatria e pegue a {exit_number} sada",name:"Entre na rotatria e pegue a {exit_number} sada na {way_name}",destination:"Entre na rotatria e pegue a {exit_number} sada sentido {destination}"},default:{default:"Entre na rotatria",name:"Entre na rotatria e saia na {way_name}",destination:"Entre na rotatria e saia sentido {destination}"}}},"roundabout turn":{default:{default:"Siga {modifier}",name:"Siga {modifier} em {way_name}",destination:"Siga {modifier} sentido {destination}"},left:{default:"Vire  esquerda",name:"Vire  esquerda em {way_name}",destination:"Vire  esquerda sentido {destination}"},right:{default:"Vire  direita",name:"Vire  direita em {way_name}",destination:"Vire  direita sentido {destination}"},straight:{default:"Continue em frente",name:"Continue em frente em {way_name}",destination:"Continue em frente sentido {destination}"}},"exit roundabout":{default:{default:"Saia da rotatria",name:"Exit the traffic circle onto {way_name}",destination:"Exit the traffic circle towards {destination}"}},"exit rotary":{default:{default:"Saia da rotatria",name:"Exit the traffic circle onto {way_name}",destination:"Exit the traffic circle towards {destination}"}},turn:{default:{default:"Siga {modifier}",name:"Siga {modifier} em {way_name}",destination:"Siga {modifier} sentido {destination}"},left:{default:"Vire  esquerda",name:"Vire  esquerda em {way_name}",destination:"Vire  esquerda sentido {destination}"},right:{default:"Vire  direita",name:"Vire  direita em {way_name}",destination:"Vire  direita sentido {destination}"},straight:{default:"Siga em frente",name:"Siga em frente em {way_name}",destination:"Siga em frente sentido {destination}"}},"use lane":{no_lanes:{default:"Continue em frente"},default:{default:"{lane_instruction}"}}}}},{}],40:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"norte",northeast:"nordeste",east:"este",southeast:"sudeste",south:"sul",southwest:"sudoeste",west:"oeste",northwest:"noroeste"},modifier:{left:" esquerda",right:" direita","sharp left":"acentuadamente  esquerda","sharp right":"acentuadamente  direita","slight left":"ligeiramente  esquerda","slight right":"ligeiramente  direita",straight:"em frente",uturn:"inverso de marcha"},lanes:{xo:"Mantenha-se  direita",ox:"Mantenha-se  esquerda",xox:"Mantenha-se ao meio",oxo:"Mantenha-se  esquerda ou  direita"}},modes:{ferry:{default:"Apanhe o ferry",name:"Apanhe o ferry {way_name}",destination:"Apanhe o ferry para {destination}"}},phrase:{"two linked by distance":"{instruction_one}, depois, a {distance}, {instruction_two}","two linked":"{instruction_one}, depois {instruction_two}","one in distance":"A {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"sada {exit}"},arrive:{default:{default:"Chegou ao seu {nth} destino",upcoming:"Est a chegar ao seu {nth} destino",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name}"},left:{default:"Chegou ao seu {nth} destino,  esquerda",upcoming:"Est a chegar ao seu {nth} destino,  esquerda",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  esquerda"},right:{default:"Chegou ao seu {nth} destino,  direita",upcoming:"Est a chegar ao seu {nth} destino,  direita",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  direita"},"sharp left":{default:"Chegou ao seu {nth} destino,  esquerda",upcoming:"Est a chegar ao seu {nth} destino,  esquerda",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  esquerda"},"sharp right":{default:"Chegou ao seu {nth} destino,  direita",upcoming:"Est a chegar ao seu {nth} destino,  direita",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  direita"},"slight right":{default:"Chegou ao seu {nth} destino,  direita",upcoming:"Est a chegar ao seu {nth} destino,  direita",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  direita"},"slight left":{default:"Chegou ao seu {nth} destino,  esquerda",upcoming:"Est a chegar ao seu {nth} destino,  esquerda",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  esquerda"},straight:{default:"Chegou ao seu {nth} destino, em frente",upcoming:"Est a chegar ao seu {nth} destino, em frente",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name}, em frente"}},continue:{default:{default:"Vire {modifier}",name:"Vire {modifier} para se manter em {way_name}",destination:"Vire {modifier} em direo a {destination}",exit:"Vire {modifier} para {way_name}"},straight:{default:"Continue em frente",name:"Continue em frente para se manter em {way_name}",destination:"Continue em direo a {destination}",distance:"Continue em frente por {distance}",namedistance:"Continue em {way_name} por {distance}"},"sharp left":{default:"Vire acentuadamente  esquerda",name:"Vire acentuadamente  esquerda para se manter em {way_name}",destination:"Vire acentuadamente  esquerda em direo a {destination}"},"sharp right":{default:"Vire acentuadamente  direita",name:"Vire acentuadamente  direita para se manter em {way_name}",destination:"Vire acentuadamente  direita em direo a {destination}"},"slight left":{default:"Vire ligeiramente  esquerda",name:"Vire ligeiramente  esquerda para se manter em {way_name}",destination:"Vire ligeiramente  esquerda em direo a {destination}"},"slight right":{default:"Vire ligeiramente  direita",name:"Vire ligeiramente  direita para se manter em {way_name}",destination:"Vire ligeiramente  direita em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha e continue em {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},depart:{default:{default:"Dirija-se para {direction}",name:"Dirija-se para {direction} em {way_name}",namedistance:"Dirija-se para {direction} em {way_name} por {distance}"}},"end of road":{default:{default:"Vire {modifier}",name:"Vire {modifier} para {way_name}",destination:"Vire {modifier} em direo a {destination}"},straight:{default:"Continue em frente",name:"Continue em frente para {way_name}",destination:"Continue em frente em direo a {destination}"},uturn:{default:"No final da estrada faa uma inverso de marcha",name:"No final da estrada faa uma inverso de marcha para {way_name} ",destination:"No final da estrada faa uma inverso de marcha em direo a {destination}"}},fork:{default:{default:"Na bifurcao mantenha-se {modifier}",name:"Mantenha-se {modifier} para {way_name}",destination:"Mantenha-se {modifier} em direo a {destination}"},"slight left":{default:"Na bifurcao mantenha-se  esquerda",name:"Mantenha-se  esquerda para {way_name}",destination:"Mantenha-se  esquerda em direo a {destination}"},"slight right":{default:"Na bifurcao mantenha-se  direita",name:"Mantenha-se  direita para {way_name}",destination:"Mantenha-se  direita em direo a {destination}"},"sharp left":{default:"Na bifurcao vire acentuadamente  esquerda",name:"Vire acentuadamente  esquerda para {way_name}",destination:"Vire acentuadamente  esquerda em direo a {destination}"},"sharp right":{default:"Na bifurcao vire acentuadamente  direita",name:"Vire acentuadamente  direita para {way_name}",destination:"Vire acentuadamente  direita em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha para {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},merge:{default:{default:"Una-se ao trfego {modifier}",name:"Una-se ao trfego {modifier} para {way_name}",destination:"Una-se ao trfego {modifier} em direo a {destination}"},straight:{default:"Una-se ao trfego",name:" Una-se ao trfego para {way_name}",destination:"Una-se ao trfego em direo a {destination}"},"slight left":{default:"Una-se ao trfego  esquerda",name:"Una-se ao trfego  esquerda para {way_name}",destination:"Una-se ao trfego  esquerda em direo a {destination}"},"slight right":{default:"Una-se ao trfego  direita",name:"Una-se ao trfego  direita para {way_name}",destination:"Una-se ao trfego  direita em direo a {destination}"},"sharp left":{default:"Una-se ao trfego  esquerda",name:"Una-se ao trfego  esquerda para {way_name}",destination:"Una-se ao trfego  esquerda em direo a {destination}"},"sharp right":{default:"Una-se ao trfego  direita",name:"Una-se ao trfego  direita para {way_name}",destination:"Una-se ao trfego  direita em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha para {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},"new name":{default:{default:"Continue {modifier}",name:"Continue {modifier} para {way_name}",destination:"Continue {modifier} em direo a {destination}"},straight:{default:"Continue em frente",name:"Continue para {way_name}",destination:"Continue em direo a {destination}"},"sharp left":{default:"Vire acentuadamente  esquerda",name:"Vire acentuadamente  esquerda para {way_name}",destination:"Vire acentuadamente  esquerda em direo a{destination}"},"sharp right":{default:"Vire acentuadamente  direita",name:"Vire acentuadamente  direita para {way_name}",destination:"Vire acentuadamente  direita em direo a {destination}"},"slight left":{default:"Continue ligeiramente  esquerda",name:"Continue ligeiramente  esquerda para {way_name}",destination:"Continue ligeiramente  esquerda em direo a {destination}"},"slight right":{default:"Continue ligeiramente  direita",name:"Continue ligeiramente  direita para {way_name}",destination:"Continue ligeiramente  direita em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha para {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},notification:{default:{default:"Continue {modifier}",name:"Continue {modifier} para {way_name}",destination:"Continue {modifier} em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha para {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},"off ramp":{default:{default:"Saia na sada",name:"Saia na sada para {way_name}",destination:"Saia na sada em direo a {destination}",exit:"Saia na sada {exit}",exit_destination:"Saia na sada {exit} em direo a {destination}"},left:{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}",exit:"Saia na sada {exit}  esquerda",exit_destination:"Saia na sada {exit}  esquerda em direo a {destination}"},right:{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}",exit:"Saia na sada {exit}  direita",exit_destination:"Saia na sada {exit}  direita em direo a {destination}"},"sharp left":{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}",exit:"Saia na sada {exit}  esquerda",exit_destination:"Saia na sada {exit}  esquerda em direo a {destination}"},"sharp right":{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}",exit:"Saia na sada {exit}  direita",exit_destination:"Saia na sada {exit}  direita em direo a {destination}"},"slight left":{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}",exit:"Saia na sada {exit}  esquerda",exit_destination:"Saia na sada {exit}  esquerda em direo a {destination}"},"slight right":{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}",exit:"Saia na sada {exit}  direita",exit_destination:"Saia na sada {exit}  direita em direo a {destination}"}},"on ramp":{default:{default:"Saia na sada",name:"Saia na sada para {way_name}",destination:"Saia na sada em direo a {destination}"},left:{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}"},right:{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}"},"sharp left":{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}"},"sharp right":{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}"},"slight left":{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}"},"slight right":{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}"}},rotary:{default:{default:{default:"Entre na rotunda",name:"Entre na rotunda e saia para {way_name}",destination:"Entre na rotunda e saia em direo a {destination}"},name:{default:"Entre em {rotary_name}",name:"Entre em {rotary_name} e saia para {way_name}",destination:"Entre em {rotary_name} e saia em direo a {destination}"},exit:{default:"Entre na rotunda e saia na sada {exit_number}",name:"Entre na rotunda e saia na sada {exit_number} para {way_name}",destination:"Entre na rotunda e saia na sada {exit_number} em direo a {destination}"},name_exit:{default:"Entre em {rotary_name} e saia na sada {exit_number}",name:"Entre em {rotary_name} e saia na sada {exit_number} para {way_name}",destination:"Entre em{rotary_name} e saia na sada {exit_number} em direo a {destination}"}}},roundabout:{default:{exit:{default:"Entre na rotunda e saia na sada {exit_number}",name:"Entre na rotunda e saia na sada {exit_number} para {way_name}",destination:"Entre na rotunda e saia na sada {exit_number} em direo a {destination}"},default:{default:"Entre na rotunda",name:"Entre na rotunda e saia para {way_name}",destination:"Entre na rotunda e saia em direo a {destination}"}}},"roundabout turn":{default:{default:"Siga {modifier}",name:"Siga {modifier} para {way_name}",destination:"Siga {modifier} em direo a {destination}"},left:{default:"Vire  esquerda",name:"Vire  esquerda para {way_name}",destination:"Vire  esquerda em direo a {destination}"},right:{default:"Vire  direita",name:"Vire  direita para {way_name}",destination:"Vire  direita em direo a {destination}"},straight:{default:"Continue em frente",name:"Continue em frente para {way_name}",destination:"Continue em frente em direo a {destination}"}},"exit roundabout":{default:{default:"Saia da rotunda",name:"Saia da rotunda para {way_name}",destination:"Saia da rotunda em direo a {destination}"}},"exit rotary":{default:{default:"Saia da rotunda",name:"Saia da rotunda para {way_name}",destination:"Saia da rotunda em direo a {destination}"}},turn:{default:{default:"Siga {modifier}",name:"Siga {modifier} para{way_name}",destination:"Siga {modifier} em direo a {destination}"},left:{default:"Vire  esquerda",name:"Vire  esquerda para {way_name}",destination:"Vire  esquerda em direo a {destination}"},right:{default:"Vire  direita",name:"Vire  direita para {way_name}",destination:"Vire  direita em direo a {destination}"},straight:{default:"V em frente",name:"V em frente para {way_name}",destination:"V em frente em direo a {destination}"}},"use lane":{no_lanes:{default:"Continue em frente"},default:{default:"{lane_instruction}"}}}}},{}],41:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"prima",2:"a doua",3:"a treia",4:"a patra",5:"a cincea",6:"a asea",7:"a aptea",8:"a opta",9:"a noua",10:"a zecea"},direction:{north:"nord",northeast:"nord-est",east:"est",southeast:"sud-est",south:"sud",southwest:"sud-vest",west:"vest",northwest:"nord-vest"},modifier:{left:"stnga",right:"dreapta","sharp left":"puternic stnga","sharp right":"puternic dreapta","slight left":"uor stnga","slight right":"uor dreapta",straight:"nainte",uturn:"ntoarcere"},lanes:{xo:"inei stnga",ox:"inei dreapta",xox:"inei pe mijloc",oxo:"inei pe laterale"}},modes:{ferry:{default:"Luai feribotul",name:"Luai feribotul {way_name}",destination:"Luai feribotul spre {destination}"}},phrase:{"two linked by distance":"{instruction_one}, apoi n {distance}, {instruction_two}","two linked":"{instruction_one} apoi {instruction_two}","one in distance":"n {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"ieirea {exit}"},arrive:{default:{default:"Ai ajuns la {nth} destinaie",upcoming:"Ai ajuns la {nth} destinaie",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}"},left:{default:"Ai ajuns la {nth} destinaie, pe stnga",upcoming:"Ai ajuns la {nth} destinaie, pe stnga",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe stnga"},right:{default:"Ai ajuns la {nth} destinaie, pe dreapta",upcoming:"Ai ajuns la {nth} destinaie, pe dreapta",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe dreapta"},"sharp left":{default:"Ai ajuns la {nth} destinaie, pe stnga",upcoming:"Ai ajuns la {nth} destinaie, pe stnga",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe stnga"},"sharp right":{default:"Ai ajuns la {nth} destinaie, pe dreapta",upcoming:"Ai ajuns la {nth} destinaie, pe dreapta",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe dreapta"},"slight right":{default:"Ai ajuns la {nth} destinaie, pe dreapta",upcoming:"Ai ajuns la {nth} destinaie, pe dreapta",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe dreapta"},"slight left":{default:"Ai ajuns la {nth} destinaie, pe stnga",upcoming:"Ai ajuns la {nth} destinaie, pe stnga",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe stnga"},straight:{default:"Ai ajuns la {nth} destinaie, n fa",upcoming:"Ai ajuns la {nth} destinaie, n fa",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, n fa"}},continue:{default:{default:"Virai {modifier}",name:"Virai {modifier} pe {way_name}",destination:"Virai {modifier} spre {destination}",exit:"Virai {modifier} pe {way_name}"},straight:{default:"Mergei nainte",name:"Mergei nainte pe {way_name}",destination:"Continuai spre {destination}",distance:"Mergei nainte pentru {distance}",namedistance:"Continuai pe {way_name} pentru {distance}"},"sharp left":{default:"Virai puternic la stnga",name:"Virai puternic la stnga pe {way_name}",destination:"Virai puternic la stnga spre {destination}"},"sharp right":{default:"Virai puternic la dreapta",name:"Virai puternic la dreapta pe {way_name}",destination:"Virai puternic la dreapta spre {destination}"},"slight left":{default:"Virai uor la stnga",name:"Virai uor la stnga pe {way_name}",destination:"Virai uor la stnga spre {destination}"},"slight right":{default:"Virai uor la dreapta",name:"Virai uor la dreapta pe {way_name}",destination:"Virai uor la dreapta spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v i continuai pe {way_name}",destination:"ntoarcei-v spre {destination}"}},depart:{default:{default:"Mergei spre {direction}",name:"Mergei spre {direction} pe {way_name}",namedistance:"Mergei spre {direction} pe {way_name} pentru {distance}"}},"end of road":{default:{default:"Virai {modifier}",name:"Virai {modifier} pe {way_name}",destination:"Virai {modifier} spre {destination}"},straight:{default:"Continuai nainte",name:"Continuai nainte pe {way_name}",destination:"Continuai nainte spre {destination}"},uturn:{default:"ntoarcei-v la sfritul drumului",name:"ntoarcei-v pe {way_name} la sfritul drumului",destination:"ntoarcei-v spre {destination} la sfritul drumului"}},fork:{default:{default:"inei {modifier} la bifurcaie",name:"inei {modifier} la bifurcaie pe {way_name}",destination:"inei {modifier} la bifurcaie spre {destination}"},"slight left":{default:"inei pe stnga la bifurcaie",name:"inei pe stnga la bifurcaie pe {way_name}",destination:"inei pe stnga la bifurcaie spre {destination}"},"slight right":{default:"inei pe dreapta la bifurcaie",name:"inei pe dreapta la bifurcaie pe {way_name}",destination:"inei pe dreapta la bifurcaie spre {destination}"},"sharp left":{default:"Virai puternic stnga la bifurcaie",name:"Virai puternic stnga la bifurcaie pe {way_name}",destination:"Virai puternic stnga la bifurcaie spre {destination}"},"sharp right":{default:"Virai puternic dreapta la bifurcaie",name:"Virai puternic dreapta la bifurcaie pe {way_name}",destination:"Virai puternic dreapta la bifurcaie spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v pe {way_name}",destination:"ntoarcei-v spre {destination}"}},merge:{default:{default:"Intrai n {modifier}",name:"Intrai n {modifier} pe {way_name}",destination:"Intrai n {modifier} spre {destination}"},straight:{default:"Intrai",name:"Intrai pe {way_name}",destination:"Intrai spre {destination}"},"slight left":{default:"Intrai n stnga",name:"Intrai n stnga pe {way_name}",destination:"Intrai n stnga spre {destination}"},"slight right":{default:"Intrai n dreapta",name:"Intrai n dreapta pe {way_name}",destination:"Intrai n dreapta spre {destination}"},"sharp left":{default:"Intrai n stnga",name:"Intrai n stnga pe {way_name}",destination:"Intrai n stnga spre {destination}"},"sharp right":{default:"Intrai n dreapta",name:"Intrai n dreapta pe {way_name}",destination:"Intrai n dreapta spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v pe {way_name}",destination:"ntoarcei-v spre {destination}"}},"new name":{default:{default:"Continuai {modifier}",name:"Continuai {modifier} pe {way_name}",destination:"Continuai {modifier} spre {destination}"},straight:{default:"Continuai nainte",name:"Continuai pe {way_name}",destination:"Continuai spre {destination}"},"sharp left":{default:"Virai puternic la stnga",name:"Virai puternic la stnga pe {way_name}",destination:"Virai puternic la stnga spre {destination}"},"sharp right":{default:"Virai puternic la dreapta",name:"Virai puternic la dreapta pe {way_name}",destination:"Virai puternic la dreapta spre {destination}"},"slight left":{default:"Continuai uor la stnga",name:"Continuai uor la stnga pe {way_name}",destination:"Continuai uor la stnga spre {destination}"},"slight right":{default:"Continuai uor la dreapta",name:"Continuai uor la dreapta pe {way_name}",destination:"Continuai uor la dreapta spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v pe {way_name}",destination:"ntoarcei-v spre {destination}"}},notification:{default:{default:"Continuai {modifier}",name:"Continuai {modifier} pe {way_name}",destination:"Continuai {modifier} spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v pe {way_name}",destination:"ntoarcei-v spre {destination}"}},"off ramp":{default:{default:"Urmai breteaua",name:"Urmai breteaua pe {way_name}",destination:"Urmai breteaua spre {destination}",exit:"Urmai ieirea {exit}",exit_destination:"Urmai ieirea {exit} spre {destination}"},left:{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}",exit:"Urmai ieirea {exit} pe stnga",exit_destination:"Urmai ieirea {exit} pe stnga spre {destination}"},right:{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}",exit:"Urmai ieirea {exit} pe dreapta",exit_destination:"Urmai ieirea {exit} pe dreapta spre {destination}"},"sharp left":{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}",exit:"Urmai ieirea {exit} pe stnga",exit_destination:"Urmai ieirea {exit} pe stnga spre {destination}"},"sharp right":{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}",exit:"Urmai ieirea {exit} pe dreapta",exit_destination:"Urmai ieirea {exit} pe dreapta spre {destination}"},"slight left":{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}",exit:"Urmai ieirea {exit} pe stnga",exit_destination:"Urmai ieirea {exit} pe stnga spre {destination}"},"slight right":{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}",exit:"Urmai ieirea {exit} pe dreapta",exit_destination:"Urmai ieirea {exit} pe dreapta spre {destination}"}},"on ramp":{default:{default:"Urmai breteaua de intrare",name:"Urmai breteaua pe {way_name}",destination:"Urmai breteaua spre {destination}"},left:{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}"},right:{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}"},"sharp left":{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}"},"sharp right":{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}"},"slight left":{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}"},"slight right":{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}"}},rotary:{default:{default:{default:"Intrai n sensul giratoriu",name:"Intrai n sensul giratoriu i ieii pe {way_name}",destination:"Intrai n sensul giratoriu i ieii spre {destination}"},name:{default:"Intrai n {rotary_name}",name:"Intrai n {rotary_name} i ieii pe {way_name}",destination:"Intrai n {rotary_name} i ieii spre {destination}"},exit:{default:"Intrai n sensul giratoriu i urmai {exit_number} ieire",name:"Intrai n sensul giratoriu i urmai {exit_number} ieire pe {way_name}",destination:"Intrai n sensul giratoriu i urmai {exit_number} ieire spre {destination}"},name_exit:{default:"Intrai n {rotary_name} i urmai {exit_number} ieire",name:"Intrai n {rotary_name} i urmai {exit_number} ieire pe {way_name}",destination:"Intrai n  {rotary_name} i urmai {exit_number} ieire spre {destination}"}}},roundabout:{default:{exit:{default:"Intrai n sensul giratoriu i urmai {exit_number} ieire",name:"Intrai n sensul giratoriu i urmai {exit_number} ieire pe {way_name}",destination:"Intrai n sensul giratoriu i urmai {exit_number} ieire spre {destination}"},default:{default:"Intrai n sensul giratoriu",name:"Intrai n sensul giratoriu i ieii pe {way_name}",destination:"Intrai n sensul giratoriu i ieii spre {destination}"}}},"roundabout turn":{default:{default:"La sensul giratoriu virai {modifier}",name:"La sensul giratoriu virai {modifier} pe {way_name}",destination:"La sensul giratoriu virai {modifier} spre {destination}"},left:{default:"La sensul giratoriu virai la stnga",name:"La sensul giratoriu virai la stnga pe {way_name}",destination:"La sensul giratoriu virai la stnga spre {destination}"},right:{default:"La sensul giratoriu virai la dreapta",name:"La sensul giratoriu virai la dreapta pe {way_name}",destination:"La sensul giratoriu virai la dreapta spre {destination}"},straight:{default:"La sensul giratoriu continuai nainte",name:"La sensul giratoriu continuai nainte pe {way_name}",destination:"La sensul giratoriu continuai nainte spre {destination}"}},"exit roundabout":{default:{default:"Ieii din sensul giratoriu",name:"Ieii din sensul giratoriu pe {way_name}",destination:"Ieii din sensul giratoriu spre {destination}"}},"exit rotary":{default:{default:"Ieii din sensul giratoriu",name:"Ieii din sensul giratoriu pe {way_name}",destination:"Ieii din sensul giratoriu spre {destination}"}},turn:{default:{default:"Virai {modifier}",name:"Virai {modifier} pe {way_name}",destination:"Virai {modifier} spre {destination}"},left:{default:"Virai la stnga",name:"Virai la stnga pe {way_name}",destination:"Virai la stnga spre {destination}"},right:{default:"Virai la dreapta",name:"Virai la dreapta pe {way_name}",destination:"Virai la dreapta spre {destination}"},straight:{default:"Mergei nainte",name:"Mergei nainte pe {way_name}",destination:"Mergei nainte spre {destination}"}},"use lane":{no_lanes:{default:"Mergei nainte"},default:{default:"{lane_instruction}"}}}}},{}],42:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:"-",east:"",southeast:"-",south:"",southwest:"-",west:"",northwest:"-"},modifier:{left:"",right:"","sharp left":"","sharp right":"","slight left":"","slight right":"",straight:"",uturn:" "},lanes:{xo:" ",ox:" ",xox:" ",oxo:"   "}},modes:{ferry:{default:"  ",name:"   {way_name}",destination:"     {destination}"}},phrase:{"two linked by distance":"{instruction_one},   {distance} {instruction_two}","two linked":"{instruction_one},  {instruction_two}","one in distance":" {distance} {instruction_one}","name and ref":"{name} ({ref})","exit with number":" {exit}"},arrive:{default:{default:"   {nth}  ",upcoming:"   {nth}  ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name}"},left:{default:"   {nth}  ,   ",upcoming:"   {nth}  ,   ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},   "},right:{default:"   {nth}  ,   ",upcoming:"   {nth}  ,   ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},   "},"sharp left":{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "},"sharp right":{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "},"slight right":{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "},"slight left":{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "},straight:{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "}},continue:{default:{default:" {modifier}",name:" {modifier}  {way_name:dative}",destination:" {modifier}   {destination}",exit:" {modifier}  {way_name:accusative}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}",distance:"  {distance}",namedistance:"  {distance}  {way_name:dative}"},"sharp left":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},"sharp right":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},"slight left":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},"slight right":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},uturn:{default:"",name:"     {way_name:dative}",destination:"   {destination}"}},depart:{default:{default:"  {direction} ",name:"  {direction}   {way_name:dative}",namedistance:" {distance}  {direction}   {way_name:dative}"}},"end of road":{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}   {destination}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}"},uturn:{default:"   ",name:"   {way_name:genitive}",destination:"      {destination}"}},fork:{default:{default:"   {modifier}",name:"   {modifier}  {way_name:accusative}",destination:"   {modifier}   {destination}"},"slight left":{default:"   ",name:"     {way_name:accusative}",destination:"         {destination}"},"slight right":{default:"   ",name:"     {way_name:accusative}",destination:"         {destination}"},"sharp left":{default:"    ",name:"    {way_name:accusative}",destination:"        {destination}"},"sharp right":{default:"    ",name:"    {way_name:accusative}",destination:"        {destination}"},uturn:{default:"  ",name:"    {way_name:prepositional}",destination:"        {destination}"}},merge:{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}   {destination}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}"},"slight left":{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},"slight right":{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},"sharp left":{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},"sharp right":{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},uturn:{default:"",name:"  {way_name:prepositional}",destination:"   {destination}"}},"new name":{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}   {destination}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}"},"sharp left":{default:"  ",name:"    {way_name:accusative}",destination:"        {destination}"},"sharp right":{default:"  ",name:"    {way_name:accusative}",destination:"        {destination}"},"slight left":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},"slight right":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},uturn:{default:"",name:"  {way_name:prepositional}",destination:"      {destination}"}},notification:{default:{default:" {modifier}",name:" {modifier}  {way_name:dative}",destination:" {modifier}   {destination}"},uturn:{default:"",name:"  {way_name:prepositional}",destination:"      {destination}"}},"off ramp":{default:{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}",exit:"   {exit}",exit_destination:"   {exit}   {destination}"},left:{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"   {exit} ",exit_destination:"   {exit}    {destination}"},right:{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"   {exit} ",exit_destination:"   {exit}    {destination}"},"sharp left":{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"    {exit}",exit_destination:"    {exit}   {destination}"},"sharp right":{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"    {exit}",exit_destination:"    {exit}   {destination}"},"slight left":{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"   {exit}",exit_destination:"    {exit}   {destination}"},"slight right":{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"    {exit}",exit_destination:"    {exit}   {destination}"}},"on ramp":{default:{default:"  ",name:"    {way_name:accusative}",destination:"       {destination}"},left:{default:"     ",name:"     {way_name:accusative}",destination:"        {destination}"},right:{default:"     ",name:"     {way_name:accusative}",destination:"        {destination}"},"sharp left":{default:"     ",name:"     {way_name:accusative}",destination:"        {destination}"},"sharp right":{default:"     ",name:"     {way_name:accusative}",destination:"        {destination}"},"slight left":{default:"     ",name:"   {way_name:accusative}",destination:"      {destination}"},"slight right":{default:"     ",name:"   {way_name:accusative}",destination:"      {destination}"}},rotary:{default:{default:{default:"    ",name:"     {way_name:accusative}",destination:"      {destination}"},name:{default:"   {rotary_name:dative}",name:" {rotary_name:prepositional}   {way_name:accusative}",destination:" {rotary_name:prepositional}    {destination}"},exit:{default:"     {exit_number} ",name:"     {exit_number}   {way_name:accusative}",destination:"     {exit_number}    {destination}"},name_exit:{default:" {rotary_name:prepositional}   {exit_number} ",name:" {rotary_name:prepositional}   {exit_number}   {way_name:accusative}",destination:" {rotary_name:prepositional}   {exit_number}    {destination}"}}},roundabout:{default:{exit:{default:"     {exit_number} ",name:"     {exit_number}   {way_name:accusative}",destination:"     {exit_number}    {destination}"},default:{default:"    ",name:"     {way_name:accusative}",destination:"      {destination}"}}},"roundabout turn":{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}   {destination}"},left:{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},right:{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}"}},"exit roundabout":{default:{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}"}},"exit rotary":{default:{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}"}},turn:{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}    {destination}"},left:{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},right:{default:" ",name:"   {way_name:accusative}",destination:"     {destination}"},straight:{default:" ",name:"  {way_name:dative}",destination:"   {destination}"}},"use lane":{no_lanes:{default:"  "},default:{default:"{lane_instruction}"}}}}},{}],43:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1:a",2:"2:a",3:"3:e",4:"4:e",5:"5:e",6:"6:e",7:"7:e",8:"8:e",9:"9:e",10:"10:e"},direction:{north:"norr",northeast:"nordost",east:"ster",southeast:"sydost",south:"sder",southwest:"sydvst",west:"vster",northwest:"nordvst"},modifier:{left:"vnster",right:"hger","sharp left":"vnster","sharp right":"hger","slight left":"vnster","slight right":"hger",straight:"rakt fram",uturn:"U-svng"},lanes:{xo:"Hll till hger",ox:"Hll till vnster",xox:"Hll till mitten",oxo:"Hll till vnster eller hger"}},modes:{ferry:{default:"Ta frjan",name:"Ta frjan p {way_name}",destination:"Ta frjan mot {destination}"}},phrase:{"two linked by distance":"{instruction_one}, sedan efter {distance}, {instruction_two}","two linked":"{instruction_one}, sedan {instruction_two}","one in distance":"Om {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Du r framme vid din {nth} destination",upcoming:"Du r snart framme vid din {nth} destination",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}"},left:{default:"Du r framme vid din {nth} destination, till vnster",upcoming:"Du r snart framme vid din {nth} destination, till vnster",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till vnster"},right:{default:"Du r framme vid din {nth} destination, till hger",upcoming:"Du r snart framme vid din {nth} destination, till hger",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till hger"},"sharp left":{default:"Du r framme vid din {nth} destination, till vnster",upcoming:"Du r snart framme vid din {nth} destination, till vnster",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till vnster"},"sharp right":{default:"Du r framme vid din {nth} destination, till hger",upcoming:"Du r snart framme vid din {nth} destination, till hger",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till hger"},"slight right":{default:"Du r framme vid din {nth} destination, till hger",upcoming:"Du r snart framme vid din {nth} destination, till hger",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till hger"},"slight left":{default:"Du r framme vid din {nth} destination, till vnster",upcoming:"Du r snart framme vid din {nth} destination, till vnster",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till vnster"},straight:{default:"Du r framme vid din {nth} destination, rakt fram",upcoming:"Du r snart framme vid din {nth} destination, rakt fram",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, rakt fram"}},continue:{default:{default:"Svng {modifier}",name:"Svng {modifier} och fortstt p {way_name}",destination:"Svng {modifier} mot {destination}",exit:"Svng {modifier} in p {way_name}"},straight:{default:"Fortstt rakt fram",name:"Kr rakt fram och fortstt p {way_name}",destination:"Fortstt mot {destination}",distance:"Fortstt rakt fram i {distance}",namedistance:"Fortstt p {way_name} i {distance}"},"sharp left":{default:"Svng vnster",name:"Svng vnster och fortstt p {way_name}",destination:"Svng vnster mot {destination}"},"sharp right":{default:"Svng hger",name:"Svng hger och fortstt p {way_name}",destination:"Svng hger mot {destination}"},"slight left":{default:"Svng vnster",name:"Svng vnster och fortstt p {way_name}",destination:"Svng vnster mot {destination}"},"slight right":{default:"Svng hger",name:"Svng hger och fortstt p {way_name}",destination:"Svng hger mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng och fortstt p {way_name}",destination:"Gr en U-svng mot {destination}"}},depart:{default:{default:"Kr t {direction}",name:"Kr t {direction} p {way_name}",namedistance:"Kr {distance} t {direction} p {way_name}"}},"end of road":{default:{default:"Svng {modifier}",name:"Svng {modifier} in p {way_name}",destination:"Svng {modifier} mot {destination}"},straight:{default:"Fortstt rakt fram",name:"Fortstt rakt fram in p {way_name}",destination:"Fortstt rakt fram mot {destination}"},uturn:{default:"Gr en U-svng i slutet av vgen",name:"Gr en U-svng in p {way_name} i slutet av vgen",destination:"Gr en U-svng mot {destination} i slutet av vgen"}},fork:{default:{default:"Hll till {modifier} dr vgen delar sig",name:"Hll till {modifier} in p {way_name}",destination:"Hll till {modifier} mot {destination}"},"slight left":{default:"Hll till vnster dr vgen delar sig",name:"Hll till vnster in p {way_name}",destination:"Hll till vnster mot {destination}"},"slight right":{default:"Hll till hger dr vgen delar sig",name:"Hll till hger in p {way_name}",destination:"Hll till hger mot {destination}"},"sharp left":{default:"Svng vnster dr vgen delar sig",name:"Svng vnster in p {way_name}",destination:"Svng vnster mot {destination}"},"sharp right":{default:"Svng hger dr vgen delar sig",name:"Svng hger in p {way_name}",destination:"Svng hger mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng in p {way_name}",destination:"Gr en U-svng mot {destination}"}},merge:{default:{default:"Byt till {modifier} krflt",name:"Byt till {modifier} krflt, in p {way_name}",destination:"Byt till {modifier} krflt, mot {destination}"},straight:{default:"Fortstt",name:"Kr in p {way_name}",destination:"Kr mot {destination}"},"slight left":{default:"Byt till vnstra krfltet",name:"Byt till vnstra krfltet, in p {way_name}",destination:"Byt till vnstra krfltet, mot {destination}"},"slight right":{default:"Byt till hgra krfltet",name:"Byt till hgra krfltet, in p {way_name}",destination:"Byt till hgra krfltet, mot {destination}"},"sharp left":{default:"Byt till vnstra krfltet",name:"Byt till vnstra krfltet, in p {way_name}",destination:"Byt till vnstra krfltet, mot {destination}"},"sharp right":{default:"Byt till hgra krfltet",name:"Byt till hgra krfltet, in p {way_name}",destination:"Byt till hgra krfltet, mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng in p {way_name}",destination:"Gr en U-svng mot {destination}"}},"new name":{default:{default:"Fortstt {modifier}",name:"Fortstt {modifier} p {way_name}",destination:"Fortstt {modifier} mot {destination}"},straight:{default:"Fortstt rakt fram",name:"Fortstt in p {way_name}",destination:"Fortstt mot {destination}"},"sharp left":{default:"Gr en skarp vnstersvng",name:"Gr en skarp vnstersvng in p {way_name}",destination:"Gr en skarp vnstersvng mot {destination}"},"sharp right":{default:"Gr en skarp hgersvng",name:"Gr en skarp hgersvng in p {way_name}",destination:"Gr en skarp hgersvng mot {destination}"},"slight left":{default:"Fortstt med ltt vnstersvng",name:"Fortstt med ltt vnstersvng in p {way_name}",destination:"Fortstt med ltt vnstersvng mot {destination}"},"slight right":{default:"Fortstt med ltt hgersvng",name:"Fortstt med ltt hgersvng in p {way_name}",destination:"Fortstt med ltt hgersvng mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng in p {way_name}",destination:"Gr en U-svng mot {destination}"}},notification:{default:{default:"Fortstt {modifier}",name:"Fortstt {modifier} p {way_name}",destination:"Fortstt {modifier} mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng in p {way_name}",destination:"Gr en U-svng mot {destination}"}},"off ramp":{default:{default:"Ta avfarten",name:"Ta avfarten in p {way_name}",destination:"Ta avfarten mot {destination}",exit:"Ta avfart {exit} ",exit_destination:"Ta avfart {exit} mot {destination}"},left:{default:"Ta avfarten till vnster",name:"Ta avfarten till vnster in p {way_name}",destination:"Ta avfarten till vnster mot {destination}",exit:"Ta avfart {exit} till vnster",exit_destination:"Ta avfart {exit} till vnster mot {destination}"},right:{default:"Ta avfarten till hger",name:"Ta avfarten till hger in p {way_name}",destination:"Ta avfarten till hger mot {destination}",exit:"Ta avfart {exit} till hger",exit_destination:"Ta avfart {exit} till hger mot {destination}"},"sharp left":{default:"Ta avfarten till vnster",name:"Ta avfarten till vnster in p {way_name}",destination:"Ta avfarten till vnster mot {destination}",exit:"Ta avfart {exit} till vnster",exit_destination:"Ta avfart {exit} till vnster mot {destination}"},"sharp right":{default:"Ta avfarten till hger",name:"Ta avfarten till hger in p {way_name}",destination:"Ta avfarten till hger mot {destination}",exit:"Ta avfart {exit} till hger",exit_destination:"Ta avfart {exit} till hger mot {destination}"},"slight left":{default:"Ta avfarten till vnster",name:"Ta avfarten till vnster in p {way_name}",destination:"Ta avfarten till vnster mot {destination}",exit:"Ta avfart {exit} till vnster",exit_destination:"Ta avfart{exit} till vnster mot {destination}"},"slight right":{default:"Ta avfarten till hger",name:"Ta avfarten till hger in p {way_name}",destination:"Ta avfarten till hger mot {destination}",exit:"Ta avfart {exit} till hger",exit_destination:"Ta avfart {exit} till hger mot {destination}"}},"on ramp":{default:{default:"Ta pfarten",name:"Ta pfarten in p {way_name}",destination:"Ta pfarten mot {destination}"},left:{default:"Ta pfarten till vnster",name:"Ta pfarten till vnster in p {way_name}",destination:"Ta pfarten till vnster mot {destination}"},right:{default:"Ta pfarten till hger",name:"Ta pfarten till hger in p {way_name}",destination:"Ta pfarten till hger mot {destination}"},"sharp left":{default:"Ta pfarten till vnster",name:"Ta pfarten till vnster in p {way_name}",destination:"Ta pfarten till vnster mot {destination}"},"sharp right":{default:"Ta pfarten till hger",name:"Ta pfarten till hger in p {way_name}",destination:"Ta pfarten till hger mot {destination}"},"slight left":{default:"Ta pfarten till vnster",name:"Ta pfarten till vnster in p {way_name}",destination:"Ta pfarten till vnster mot {destination}"},"slight right":{default:"Ta pfarten till hger",name:"Ta pfarten till hger in p {way_name}",destination:"Ta pfarten till hger mot {destination}"}},rotary:{default:{default:{default:"Kr in i rondellen",name:"I rondellen, ta avfarten in p {way_name}",destination:"I rondellen, ta av mot {destination}"},name:{default:"Kr in i {rotary_name}",name:"I {rotary_name}, ta av in p {way_name}",destination:"I {rotary_name}, ta av mot {destination}"},exit:{default:"I rondellen, ta {exit_number} avfarten",name:"I rondellen, ta {exit_number} avfarten in p {way_name}",destination:"I rondellen, ta {exit_number} avfarten mot {destination}"},name_exit:{default:"I {rotary_name}, ta {exit_number} avfarten",name:"I {rotary_name}, ta {exit_number}  avfarten in p {way_name}",destination:"I {rotary_name}, ta {exit_number} avfarten mot {destination}"}}},roundabout:{default:{exit:{default:"I rondellen, ta {exit_number} avfarten",name:"I rondellen, ta {exit_number} avfarten in p {way_name}",destination:"I rondellen, ta {exit_number} avfarten mot {destination}"},default:{default:"Kr in i rondellen",name:"I rondellen, ta avfarten in p {way_name}",destination:"I rondellen, ta av mot {destination}"}}},"roundabout turn":{default:{default:"Svng {modifier}",name:"Svng {modifier} in p {way_name}",destination:"Svng {modifier} mot {destination}"},left:{default:"Svng vnster",name:"Svng vnster in p {way_name}",destination:"Svng vnster mot {destination}"},right:{default:"Svng hger",name:"Svng hger in p {way_name}",destination:"Svng hger mot {destination}"},straight:{default:"Fortstt rakt fram",name:"Fortstt rakt fram in p {way_name}",destination:"Fortstt rakt fram mot {destination}"}},"exit roundabout":{default:{default:"Kr ut ur rondellen",name:"Kr ut ur rondellen in p {way_name}",destination:"Kr ut ur rondellen mot {destination}"}},"exit rotary":{default:{default:"Kr ut ur rondellen",name:"Kr ut ur rondellen in p {way_name}",destination:"Kr ut ur rondellen mot {destination}"}},turn:{default:{default:"Svng {modifier}",name:"Svng {modifier} in p {way_name}",destination:"Svng {modifier} mot {destination}"},left:{default:"Svng vnster",name:"Svng vnster in p {way_name}",destination:"Svng vnster mot {destination}"},right:{default:"Svng hger",name:"Svng hger in p {way_name}",destination:"Svng hger mot {destination}"},straight:{default:"Kr rakt fram",name:"Kr rakt fram in p {way_name}",destination:"Kr rakt fram mot {destination}"}},"use lane":{no_lanes:{default:"Fortstt rakt fram"},default:{default:"{lane_instruction}"}}}}},{}],44:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"birinci",2:"ikinci",3:"nc",4:"drdnc",5:"beinci",6:"altnc",7:"yedinci",8:"sekizinci",9:"dokuzuncu",10:"onuncu"},direction:{north:"kuzey",northeast:"kuzeydou",east:"dou",southeast:"gneydou",south:"gney",southwest:"gneybat",west:"bat",northwest:"kuzeybat"},modifier:{left:"sol",right:"sa","sharp left":"keskin sol","sharp right":"keskin sa","slight left":"hafif sol","slight right":"hafif sa",straight:"dz",uturn:"U dn"},lanes:{xo:"Sada kaln",ox:"Solda kaln",xox:"Ortada kaln",oxo:"Solda veya sada kaln"}},modes:{ferry:{default:"Vapur kullan",name:"{way_name} vapurunu kullan",destination:"{destination} istikametine giden vapuru kullan"}},phrase:{"two linked by distance":"{instruction_one} ve {distance} sonra {instruction_two}","two linked":"{instruction_one} ve sonra {instruction_two}","one in distance":"{distance} sonra, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"{nth} hedefinize ulatnz",upcoming:"{nth} hedefinize ulatnz",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz"},left:{default:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz solunuzdadr"},right:{default:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz sanzdadr"},"sharp left":{default:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz solunuzdadr"},"sharp right":{default:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz sanzdadr"},"slight right":{default:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz sanzdadr"},"slight left":{default:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz solunuzdadr"},straight:{default:"{nth} hedefinize ulatnz, hedefiniz karnzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz karnzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz karnzdadr"}},continue:{default:{default:"{modifier} yne dn",name:"{way_name} zerinde kalmak iin {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn",exit:"{way_name} zerinde {modifier} yne dn"},straight:{default:"Dz devam edin",name:"{way_name} zerinde kalmak iin dz devam et",destination:"{destination} istikametinde devam et",distance:"{distance} boyunca dz devam et",namedistance:"{distance} boyunca {way_name} zerinde devam et"},"sharp left":{default:"Sola keskin dn yap",name:"{way_name} zerinde kalmak iin sola keskin dn yap",destination:"{destination} istikametinde sola keskin dn yap"},"sharp right":{default:"Saa keskin dn yap",name:"{way_name} zerinde kalmak iin saa keskin dn yap",destination:"{destination} istikametinde saa keskin dn yap"},"slight left":{default:"Sola hafif dn yap",name:"{way_name} zerinde kalmak iin sola hafif dn yap",destination:"{destination} istikametinde sola hafif dn yap"},"slight right":{default:"Saa hafif dn yap",name:"{way_name} zerinde kalmak iin saa hafif dn yap",destination:"{destination} istikametinde saa hafif dn yap"},uturn:{default:"U dn yapn",name:"Bir U-dn yap ve {way_name} devam et",destination:"{destination} istikametinde bir U-dn yap"}},depart:{default:{default:"{direction} tarafna ynelin",name:"{way_name} zerinde {direction} yne git",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"{modifier} tarafa dnn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},straight:{default:"Dz devam edin",name:"{way_name} zerinde dz devam et",destination:"{destination} istikametinde dz devam et"},uturn:{default:"Yolun sonunda U dn yapn",name:"Yolun sonunda {way_name} zerinde bir U-dn yap",destination:"Yolun sonunda {destination} istikametinde bir U-dn yap"}},fork:{default:{default:"Yol ayrmnda {modifier} ynde kal",name:"{way_name} zerindeki yol ayrmnda {modifier} ynde kal",destination:"{destination} istikametindeki yol ayrmnda {modifier} ynde kal"},"slight left":{default:"ataln solundan devam edin",name:"ataln solundan {way_name} yoluna doru ",destination:"{destination} istikametindeki yol ayrmnda solda kal"},"slight right":{default:"ataln sandan devam edin",name:"{way_name} zerindeki yol ayrmnda sada kal",destination:"{destination} istikametindeki yol ayrmnda sada kal"},"sharp left":{default:"atalda keskin sola dnn",name:"{way_name} yoluna doru sola keskin dn yapn",destination:"{destination} istikametinde sola keskin dn yap"},"sharp right":{default:"atalda keskin saa dnn",name:"{way_name} yoluna doru saa keskin dn yapn",destination:"{destination} istikametinde saa keskin dn yap"},uturn:{default:"U dn yapn",name:"{way_name} yoluna U dn yapn",destination:"{destination} istikametinde bir U-dn yap"}},merge:{default:{default:"{modifier} yne gir",name:"{way_name} zerinde {modifier} yne gir",destination:"{destination} istikametinde {modifier} yne gir"},straight:{default:"dz yne gir",name:"{way_name} zerinde dz yne gir",destination:"{destination} istikametinde dz yne gir"},"slight left":{default:"Sola gir",name:"{way_name} zerinde sola gir",destination:"{destination} istikametinde sola gir"},"slight right":{default:"Saa gir",name:"{way_name} zerinde saa gir",destination:"{destination} istikametinde saa gir"},"sharp left":{default:"Sola gir",name:"{way_name} zerinde sola gir",destination:"{destination} istikametinde sola gir"},"sharp right":{default:"Saa gir",name:"{way_name} zerinde saa gir",destination:"{destination} istikametinde saa gir"},uturn:{default:"U dn yapn",name:"{way_name} yoluna U dn yapn",destination:"{destination} istikametinde bir U-dn yap"}},"new name":{default:{default:"{modifier} ynde devam et",name:"{way_name} zerinde {modifier} ynde devam et",destination:"{destination} istikametinde {modifier} ynde devam et"},straight:{default:"Dz devam et",name:"{way_name} zerinde devam et",destination:"{destination} istikametinde devam et"},"sharp left":{default:"Sola keskin dn yapn",name:"{way_name} yoluna doru sola keskin dn yapn",destination:"{destination} istikametinde sola keskin dn yap"},"sharp right":{default:"Saa keskin dn yapn",name:"{way_name} yoluna doru saa keskin dn yapn",destination:"{destination} istikametinde saa keskin dn yap"},"slight left":{default:"Hafif soldan devam edin",name:"{way_name} zerinde hafif solda devam et",destination:"{destination} istikametinde hafif solda devam et"},"slight right":{default:"Hafif sadan devam edin",name:"{way_name} zerinde hafif sada devam et",destination:"{destination} istikametinde hafif sada devam et"},uturn:{default:"U dn yapn",name:"{way_name} yoluna U dn yapn",destination:"{destination} istikametinde bir U-dn yap"}},notification:{default:{default:"{modifier} ynde devam et",name:"{way_name} zerinde {modifier} ynde devam et",destination:"{destination} istikametinde {modifier} ynde devam et"},uturn:{default:"U dn yapn",name:"{way_name} yoluna U dn yapn",destination:"{destination} istikametinde bir U-dn yap"}},"off ramp":{default:{default:"Balant yoluna ge",name:"{way_name} zerindeki balant yoluna ge",destination:"{destination} istikametine giden balant yoluna ge",exit:"{exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} k yoluna ge"},left:{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge",exit:"Soldaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sol k yoluna ge"},right:{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge",exit:"Sadaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sa k yoluna ge"},"sharp left":{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge",exit:"Soldaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sol k yoluna ge"},"sharp right":{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge",exit:"Sadaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sa k yoluna ge"},"slight left":{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge",exit:"Soldaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sol k yoluna ge"},"slight right":{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge",exit:"Sadaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sa k yoluna ge"}},"on ramp":{default:{default:"Balant yoluna ge",name:"{way_name} zerindeki balant yoluna ge",destination:"{destination} istikametine giden balant yoluna ge"},left:{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge"},right:{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge"},"sharp left":{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge"},"sharp right":{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge"},"slight left":{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge"},"slight right":{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge"}},rotary:{default:{default:{default:"Dnel kavaa gir",name:"Dnel kavaa gir ve {way_name} zerinde k",destination:"Dnel kavaa gir ve {destination} istikametinde k"},name:{default:"{rotary_name} dnel kavaa gir",name:"{rotary_name} dnel kavaa gir ve {way_name} zerinde k",destination:"{rotary_name} dnel kavaa gir ve {destination} istikametinde k"},exit:{default:"Dnel kavaa gir ve {exit_number} numaral ka gir",name:"Dnel kavaa gir ve {way_name} zerindeki {exit_number} numaral ka gir",destination:"Dnel kavaa gir ve {destination} istikametindeki {exit_number} numaral ka gir"},name_exit:{default:"{rotary_name} dnel kavaa gir ve {exit_number} numaral ka gir",name:"{rotary_name} dnel kavaa gir ve {way_name} zerindeki {exit_number} numaral ka gir",destination:"{rotary_name} dnel kavaa gir ve {destination} istikametindeki {exit_number} numaral ka gir"}}},roundabout:{default:{exit:{default:"Gbekli kavaa gir ve {exit_number} numaral ka gir",name:"Gbekli kavaa gir ve {way_name} zerindeki {exit_number} numaral ka gir",destination:"Gbekli kavaa gir ve {destination} istikametindeki {exit_number} numaral ka gir"},default:{default:"Gbekli kavaa gir",name:"Gbekli kavaa gir ve {way_name} zerinde k",destination:"Gbekli kavaa gir ve {destination} istikametinde k"}}},"roundabout turn":{default:{default:"{modifier} yne dn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},left:{default:"Sola dn",name:"{way_name} zerinde sola dn",destination:"{destination} istikametinde sola dn"},right:{default:"Saa dn",name:"{way_name} zerinde saa dn",destination:"{destination} istikametinde saa dn"},straight:{default:"Dz devam et",name:"{way_name} zerinde dz devam et",destination:"{destination} istikametinde dz devam et"}},"exit roundabout":{default:{default:"{modifier} yne dn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},left:{default:"Sola dn",name:"{way_name} zerinde sola dn",destination:"{destination} istikametinde sola dn"},right:{default:"Saa dn",name:"{way_name} zerinde saa dn",destination:"{destination} istikametinde saa dn"},straight:{default:"Dz devam et",name:"{way_name} zerinde dz devam et",destination:"{destination} istikametinde dz devam et"}},"exit rotary":{default:{default:"{modifier} yne dn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},left:{default:"Sola dn",name:"{way_name} zerinde sola dn",destination:"{destination} istikametinde sola dn"},right:{default:"Saa dn",name:"{way_name} zerinde saa dn",destination:"{destination} istikametinde saa dn"},straight:{default:"Dz devam et",name:"{way_name} zerinde dz devam et",destination:"{destination} istikametinde dz devam et"}},turn:{default:{default:"{modifier} yne dn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},left:{default:"Sola dnn",name:"{way_name} zerinde sola dn",destination:"{destination} istikametinde sola dn"},right:{default:"Saa dnn",name:"{way_name} zerinde saa dn",destination:"{destination} istikametinde saa dn"},straight:{default:"Dz git",name:"{way_name} zerinde dz git",destination:"{destination} istikametinde dz git"}},"use lane":{no_lanes:{default:"Dz devam edin"},default:{default:"{lane_instruction}"}}}}},{}],45:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"",northeast:" ",east:"",southeast:" ",south:"",southwest:" ",west:"",northwest:" "},modifier:{left:"",right:"","sharp left":" ","sharp right":" ","slight left":" ","slight right":" ",straight:"",uturn:""},lanes:{xo:" ",ox:" ",xox:"  ",oxo:"   "}},modes:{ferry:{default:" ",name:"  {way_name}",destination:"    {destination}"}},phrase:{"two linked by distance":"{instruction_one}, ,  {distance}, {instruction_two}","two linked":"{instruction_one},  {instruction_two}","one in distance":" {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"' {exit}"},arrive:{default:{default:"    {nth}  ",upcoming:"    {nth}  ",short:" ","short-upcoming":" ",named:"   {waypoint_name}"},left:{default:"    {nth}  ,  ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},right:{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},"sharp left":{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},"sharp right":{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},"slight right":{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},"slight left":{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},straight:{default:"    {nth}  ,     ",upcoming:"    {nth}  ,   ",short:" ","short-upcoming":" ",named:"   {waypoint_name}   "}},continue:{default:{default:" {modifier}",name:"{modifier}   {way_name}",destination:" {modifier}   {destination}",exit:" {modifier}  {way_name}"},straight:{default:"  ",name:"     {way_name}",destination:"   {destination}",distance:"   {distance}",namedistance:"   {way_name} {distance}"},"sharp left":{default:"  ",name:"      {way_name}",destination:"     {destination}"},"sharp right":{default:"  ",name:"      {way_name}",destination:"     {destination}"},"slight left":{default:"  ",name:"      {way_name}",destination:"     {destination}"},"slight right":{default:"  ",name:"      {way_name}",destination:"     {destination}"},uturn:{default:" ",name:"     {way_name}",destination:"    {destination}"}},depart:{default:{default:"  {direction}",name:"  {direction}  {way_name}",namedistance:"  {direction}  {way_name} {distance}"}},"end of road":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},straight:{default:"  ",name:"    {way_name}",destination:"     {destination}"},uturn:{default:"    ",name:"   {way_name}   ",destination:"    {destination}   "}},fork:{default:{default:"   {modifier}",name:" {modifier}    {way_name}",destination:" {modifier}   {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"    {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"    {destination}"},"sharp left":{default:"    ",name:"    {way_name}",destination:"     {destination}"},"sharp right":{default:"    ",name:"    {way_name}",destination:"     {destination}"},uturn:{default:" ",name:"   {way_name}",destination:"    {destination}"}},merge:{default:{default:"   {modifier}",name:"   {modifier}  {way_name}",destination:"   {modifier}   {destination}"},straight:{default:"  ",name:"    {way_name}",destination:"     {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"sharp left":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"sharp right":{default:"   ",name:"     {way_name}",destination:"      {destination}"},uturn:{default:" ",name:"   {way_name}",destination:"    {destination}"}},"new name":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},straight:{default:" ",name:"  {way_name}",destination:"   {destination}"},"sharp left":{default:"  ",name:"    {way_name}",destination:"     {destination}"},"sharp right":{default:"  ",name:"    {way_name}",destination:"     {destination}"},"slight left":{default:"  ",name:"    {way_name}",destination:"     {destination}"},"slight right":{default:"  ",name:"    {way_name}",destination:"     {destination}"},uturn:{default:" ",name:"   {way_name}",destination:"    {destination}"}},notification:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},uturn:{default:" ",name:"   {way_name}",destination:"    {destination}"}},"off ramp":{default:{default:"  ",name:"    {way_name}",destination:"     {destination}",exit:" ' {exit}",exit_destination:" ' {exit}   {destination}"},left:{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},right:{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},"sharp left":{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},"sharp right":{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"}},"on ramp":{default:{default:"  ",name:"    {way_name}",destination:"     {destination}"},left:{default:"   ",name:"     {way_name}",destination:"      {destination}"},right:{default:"   ",name:"     {way_name}",destination:"      {destination}"},"sharp left":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"sharp right":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"      {destination}"}},rotary:{default:{default:{default:"  ",name:"    {way_name}",destination:"     {destination}"},name:{default:"  {rotary_name}",name:"  {rotary_name}    {way_name}",destination:"  {rotary_name}     {destination}"},exit:{default:"      {exit_number} '",name:"      {exit_number} '  {way_name}",destination:"      {exit_number} '   {destination}"},name_exit:{default:"  {rotary_name}    {exit_number} '",name:"  {rotary_name}    {exit_number} '  {way_name}",destination:"  {rotary_name}    {exit_number} '   {destination}"}}},roundabout:{default:{exit:{default:"      {exit_number} '",name:"      {exit_number} '  {way_name}",destination:"      {exit_number} '   {destination}"},default:{default:"  ",name:"    {way_name}",destination:"     {destination}"}}},"roundabout turn":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},left:{default:" ",name:"   {way_name}",destination:"    {destination}"},right:{default:" ",name:"   {way_name}",destination:"    {destination}"},straight:{default:" ",name:"    {way_name}",destination:"     {destination}"}},"exit roundabout":{default:{default:" ",name:"   {way_name} ",destination:"    {destination}"}},"exit rotary":{default:{default:" ",name:"   {way_name} ",destination:"    {destination}"}},turn:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},left:{default:" ",name:"   {way_name}",destination:"    {destination}"},right:{default:" ",name:"   {way_name}",destination:"    {destination}"},straight:{default:" ",name:"   {way_name}",destination:"    {destination}"}},"use lane":{no_lanes:{default:"  "},default:{default:"{lane_instruction}"}}}}},{}],46:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"u tin",2:"th 2",3:"th 3",4:"th 4",5:"th 5",6:"th 6",7:"th 7",8:"th 8",9:"th 9",10:"th 10"},direction:{north:"bc",northeast:"ng bc",east:"ng",southeast:"ng nam",south:"nam",southwest:"ty nam",west:"ty",northwest:"ty bc"},modifier:{left:"tri",right:"phi","sharp left":"tri gt","sharp right":"phi gt","slight left":"tri nghing","slight right":"phi nghing",straight:"thng",uturn:"ngc"},lanes:{xo:"i bn phi",ox:"i bn tri",xox:"i vo gia",oxo:"i bn tri hay bn phi"}},modes:{ferry:{default:"Ln ph",name:"Ln ph {way_name}",destination:"Ln ph i {destination}"}},phrase:{"two linked by distance":"{instruction_one}, ri {distance} na th {instruction_two}","two linked":"{instruction_one}, ri {instruction_two}","one in distance":"{distance} na th {instruction_one}","name and ref":"{name} ({ref})","exit with number":"li ra {exit}"},arrive:{default:{default:"n ni {nth}",upcoming:"n ni {nth}",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}"},left:{default:"n ni {nth}  bn tri",upcoming:"n ni {nth}  bn tri",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn tri"},right:{default:"n ni {nth}  bn phi",upcoming:"n ni {nth}  bn phi",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn phi"},"sharp left":{default:"n ni {nth}  bn tri",upcoming:"n ni {nth}  bn tri",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn tri"},"sharp right":{default:"n ni {nth}  bn phi",upcoming:"n ni {nth}  bn phi",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn phi"},"slight right":{default:"n ni {nth}  bn phi",upcoming:"n ni {nth}  bn phi",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn phi"},"slight left":{default:"n ni {nth}  bn tri",upcoming:"n ni {nth}  bn tri",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn tri"},straight:{default:"n ni {nth}  trc mt",upcoming:"n ni {nth}  trc mt",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  trc mt"}},continue:{default:{default:"Quo {modifier}",name:"Quo {modifier}  chy tip trn {way_name}",destination:"Quo {modifier} v {destination}",exit:"Quo {modifier} vo {way_name}"},straight:{default:"Chy thng",name:"Chy tip trn {way_name}",destination:"Chy tip v {destination}",distance:"Chy thng cho {distance}",namedistance:"Chy tip trn {way_name} cho {distance}"},"sharp left":{default:"Quo gt bn tri",name:"Quo gt bn tri  chy tip trn {way_name}",destination:"Quo gt bn tri v {destination}"},"sharp right":{default:"Quo gt bn phi",name:"Quo gt bn phi  chy tip trn {way_name}",destination:"Quo gt bn phi v {destination}"},"slight left":{default:"Nghing v bn tri",name:"Nghing v bn tri  chy tip trn {way_name}",destination:"Nghing v bn tri v {destination}"},"slight right":{default:"Nghing v bn phi",name:"Nghing v bn phi  chy tip trn {way_name}",destination:"Nghing v bn phi v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li trn {way_name}",destination:"Quo ngc v {destination}"}},depart:{default:{default:"i v hng {direction}",name:"i v hng {direction} trn {way_name}",namedistance:"i v hng {direction} trn {way_name} cho {distance}"}},"end of road":{default:{default:"Quo {modifier}",name:"Quo {modifier} vo {way_name}",destination:"Quo {modifier} v {destination}"},straight:{default:"Chy thng",name:"Chy tip trn {way_name}",destination:"Chy tip v {destination}"},uturn:{default:"Quo ngc li ti cui ng",name:"Quo ngc vo {way_name} ti cui ng",destination:"Quo ngc v {destination} ti cui ng"}},fork:{default:{default:"i bn {modifier}  ng ba",name:"Gi bn {modifier} vo {way_name}",destination:"Gi bn {modifier} v {destination}"},"slight left":{default:"Nghing v bn tri  ng ba",name:"Gi bn tri vo {way_name}",destination:"Gi bn tri v {destination}"},"slight right":{default:"Nghing v bn phi  ng ba",name:"Gi bn phi vo {way_name}",destination:"Gi bn phi v {destination}"},"sharp left":{default:"Quo gt bn tri  ng ba",name:"Quo gt bn tri vo {way_name}",destination:"Quo gt bn tri v {destination}"},"sharp right":{default:"Quo gt bn phi  ng ba",name:"Quo gt bn phi vo {way_name}",destination:"Quo gt bn phi v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li {way_name}",destination:"Quo ngc li v {destination}"}},merge:{default:{default:"Nhp sang {modifier}",name:"Nhp sang {modifier} vo {way_name}",destination:"Nhp sang {modifier} v {destination}"},straight:{default:"Nhp ng",name:"Nhp vo {way_name}",destination:"Nhp ng v {destination}"},"slight left":{default:"Nhp sang tri",name:"Nhp sang tri vo {way_name}",destination:"Nhp sang tri v {destination}"},"slight right":{default:"Nhp sang phi",name:"Nhp sang phi vo {way_name}",destination:"Nhp sang phi v {destination}"},"sharp left":{default:"Nhp sang tri",name:"Nhp sang tri vo {way_name}",destination:"Nhp sang tri v {destination}"},"sharp right":{default:"Nhp sang phi",name:"Nhp sang phi vo {way_name}",destination:"Nhp sang phi v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li {way_name}",destination:"Quo ngc li v {destination}"}},"new name":{default:{default:"Chy tip bn {modifier}",name:"Chy tip bn {modifier} trn {way_name}",destination:"Chy tip bn {modifier} v {destination}"},straight:{default:"Chy thng",name:"Chy tip trn {way_name}",destination:"Chy tip v {destination}"},"sharp left":{default:"Quo gt bn tri",name:"Quo gt bn tri vo {way_name}",destination:"Quo gt bn tri v {destination}"},"sharp right":{default:"Quo gt bn phi",name:"Quo gt bn phi vo {way_name}",destination:"Quo gt bn phi v {destination}"},"slight left":{default:"Nghing v bn tri",name:"Nghing v bn tri vo {way_name}",destination:"Nghing v bn tri v {destination}"},"slight right":{default:"Nghing v bn phi",name:"Nghing v bn phi vo {way_name}",destination:"Nghing v bn phi v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li {way_name}",destination:"Quo ngc li v {destination}"}},notification:{default:{default:"Chy tip bn {modifier}",name:"Chy tip bn {modifier} trn {way_name}",destination:"Chy tip bn {modifier} v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li {way_name}",destination:"Quo ngc li v {destination}"}},"off ramp":{default:{default:"i ng nhnh",name:"i ng nhnh {way_name}",destination:"i ng nhnh v {destination}",exit:"i theo li ra {exit}",exit_destination:"i theo li ra {exit} v {destination}"},left:{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}",exit:"i theo li ra {exit} bn tri",exit_destination:"i theo li ra {exit} bn tri v {destination}"},right:{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}",exit:"i theo li ra {exit} bn phi",exit_destination:"i theo li ra {exit} bn phi v {destination}"},"sharp left":{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}",exit:"i theo li ra {exit} bn tri",exit_destination:"i theo li ra {exit} bn tri v {destination}"},"sharp right":{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}",exit:"i theo li ra {exit} bn phi",exit_destination:"i theo li ra {exit} bn phi v {destination}"},"slight left":{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}",exit:"i theo li ra {exit} bn tri",exit_destination:"i theo li ra {exit} bn tri v {destination}"},"slight right":{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}",exit:"i theo li ra {exit} bn phi",exit_destination:"i theo li ra {exit} bn phi v {destination}"}},"on ramp":{default:{default:"i ng nhnh",name:"i ng nhnh {way_name}",destination:"i ng nhnh v {destination}"},left:{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}"},right:{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}"},"sharp left":{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}"},"sharp right":{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}"},"slight left":{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}"},"slight right":{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}"}},rotary:{default:{default:{default:"i vo bng binh",name:"i vo bng binh v ra ti {way_name}",destination:"i vo bng binh v ra v {destination}"},name:{default:"i vo {rotary_name}",name:"i vo {rotary_name} v ra ti {way_name}",destination:"i v {rotary_name} v ra v {destination}"},exit:{default:"i vo bng binh v ra ti ng {exit_number}",name:"i vo bng binh v ra ti ng {exit_number} tc {way_name}",destination:"i vo bng binh v ra ti ng {exit_number} v {destination}"},name_exit:{default:"i vo {rotary_name} v ra ti ng {exit_number}",name:"i vo {rotary_name} v ra ti ng {exit_number} tc {way_name}",destination:"i vo {rotary_name} v ra ti ng {exit_number} v {destination}"}}},roundabout:{default:{exit:{default:"i vo bng binh v ra ti ng {exit_number}",name:"i vo bng binh v ra ti ng {exit_number} tc {way_name}",destination:"i vo bng binh v ra ti ng {exit_number} v {destination}"},default:{default:"i vo bng binh",name:"i vo bng binh v ra ti {way_name}",destination:"i vo bng binh v ra v {destination}"}}},"roundabout turn":{default:{default:"Quo {modifier}",name:"Quo {modifier} vo {way_name}",destination:"Quo {modifier} v {destination}"},left:{default:"Quo tri",name:"Quo tri vo {way_name}",destination:"Quo tri v {destination}"},right:{default:"Quo phi",name:"Quo phi vo {way_name}",destination:"Quo phi v {destination}"},straight:{default:"Chy thng",name:"Chy tip trn {way_name}",destination:"Chy tip v {destination}"}},"exit roundabout":{default:{default:"Ra bng binh",name:"Ra bng binh vo {way_name}",destination:"Ra bng binh v {destination}"}},"exit rotary":{default:{default:"Ra bng binh",name:"Ra bng binh vo {way_name}",destination:"Ra bng binh v {destination}"}},turn:{default:{default:"Quo {modifier}",name:"Quo {modifier} vo {way_name}",destination:"Quo {modifier} v {destination}"},left:{default:"Quo tri",name:"Quo tri vo {way_name}",destination:"Quo tri v {destination}"},right:{default:"Quo phi",name:"Quo phi vo {way_name}",destination:"Quo phi v {destination}"},straight:{default:"Chy thng",name:"Chy thng vo {way_name}",destination:"Chy thng v {destination}"}},"use lane":{no_lanes:{default:"Chy thng"},default:{default:"{lane_instruction}"}}}}},{}],47:[function(o,r,c){r.exports={meta:{capitalizeFirstLetter:!1},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:"",east:"",southeast:"",south:"",southwest:"",west:"",northwest:""},modifier:{left:"",right:"","sharp left":"","sharp right":"","slight left":"","slight right":"",straight:"",uturn:""},lanes:{xo:"",ox:"",xox:"",oxo:""}},modes:{ferry:{default:"",name:"{way_name}",destination:"{destination}"}},phrase:{"two linked by distance":"{instruction_one}{distance}{instruction_two}","two linked":"{instruction_one}{instruction_two}","one in distance":"{distance}{instruction_one}","name and ref":"{name}{ref}","exit with number":"{exit}"},arrive:{default:{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},left:{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},right:{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},"sharp left":{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},"sharp right":{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},"slight right":{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},"slight left":{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},straight:{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"}},continue:{default:{default:"{modifier}",name:"{way_name}{modifier}",destination:"{modifier}{destination}",exit:"{modifier}{way_name}"},straight:{default:"",name:"{way_name}",destination:"{destination}",distance:"{distance}",namedistance:"{way_name}{distance}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},depart:{default:{default:"{direction}",name:"{direction}{way_name}",namedistance:"{direction}{way_name}{distance}"}},"end of road":{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},fork:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},merge:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},"new name":{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},notification:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},"off ramp":{default:{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},left:{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},right:{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"}},"on ramp":{default:{default:"",name:"{way_name}",destination:"{destination}"},left:{default:"",name:"{way_name}",destination:"{destination}"},right:{default:"",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"}},rotary:{default:{default:{default:"",name:"{way_name}",destination:"{destination}"},name:{default:"{rotary_name}",name:"{rotary_name}{way_name}",destination:"{rotary_name}{destination}"},exit:{default:"{exit_number}",name:"{exit_number}{way_name}",destination:"{exit_number}{destination}"},name_exit:{default:"{rotary_name}{exit_number}",name:"{rotary_name}{exit_number}{way_name}",destination:"{rotary_name}{exit_number}{destination}"}}},roundabout:{default:{exit:{default:"{exit_number}",name:"{exit_number}{way_name}",destination:"{exit_number}{destination}"},default:{default:"",name:"{way_name}",destination:"{destination}"}}},"roundabout turn":{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},left:{default:"",name:"{way_name}",destination:"{destination}"},right:{default:"",name:"{way_name}",destination:"{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"}},"exit roundabout":{default:{default:"",name:"{way_name}",destination:"{destination}"}},"exit rotary":{default:{default:"",name:"{way_name}",destination:"{destination}"}},turn:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},left:{default:"",name:"{way_name}",destination:"{destination}"},right:{default:"",name:"{way_name}",destination:"{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"}},"use lane":{no_lanes:{default:""},default:{default:"{lane_instruction}"}}}}},{}],48:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null;r.exports=p.Class.extend({options:{timeout:500,blurTimeout:100,noResultsMessage:"No results found."},initialize:function(x,S,i,M){p.setOptions(this,M),this._elem=x,this._resultFn=M.resultFn?p.Util.bind(M.resultFn,M.resultContext):null,this._autocomplete=M.autocompleteFn?p.Util.bind(M.autocompleteFn,M.autocompleteContext):null,this._selectFn=p.Util.bind(S,i),this._container=p.DomUtil.create("div","leaflet-routing-geocoder-result"),this._resultTable=p.DomUtil.create("table","",this._container),p.DomEvent.addListener(this._elem,"input",this._keyPressed,this),p.DomEvent.addListener(this._elem,"keypress",this._keyPressed,this),p.DomEvent.addListener(this._elem,"keydown",this._keyDown,this),p.DomEvent.addListener(this._elem,"blur",function(){this._isOpen&&this.close()},this)},close:function(){p.DomUtil.removeClass(this._container,"leaflet-routing-geocoder-result-open"),this._isOpen=!1},_open:function(){var x=this._elem.getBoundingClientRect();if(!this._container.parentElement){var S=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,i=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;this._container.style.left=x.left+S+"px",this._container.style.top=x.bottom+i+"px",this._container.style.width=x.right-x.left+"px",document.body.appendChild(this._container)}p.DomUtil.addClass(this._container,"leaflet-routing-geocoder-result-open"),this._isOpen=!0},_setResults:function(x){var S,i,M,P;for(delete this._selection,this._results=x;this._resultTable.firstChild;)this._resultTable.removeChild(this._resultTable.firstChild);for(S=0;S<x.length;S++)i=p.DomUtil.create("tr","",this._resultTable),i.setAttribute("data-result-index",S),M=p.DomUtil.create("td","",i),P=document.createTextNode(x[S].name),M.appendChild(P),p.DomEvent.addListener(M,"mousedown",p.DomEvent.preventDefault),p.DomEvent.addListener(M,"click",this._createClickListener(x[S]));S||(i=p.DomUtil.create("tr","",this._resultTable),M=p.DomUtil.create("td","leaflet-routing-geocoder-no-results",i),M.innerHTML=this.options.noResultsMessage),this._open(),x.length>0&&this._select(1)},_createClickListener:function(x){var S=this._resultSelected(x);return p.bind(function(){this._elem.blur(),S()},this)},_resultSelected:function(x){return p.bind(function(){this.close(),this._elem.value=x.name,this._lastCompletedText=x.name,this._selectFn(x)},this)},_keyPressed:function(x){var S;if(this._isOpen&&x.keyCode===13&&this._selection){S=parseInt(this._selection.getAttribute("data-result-index"),10),this._resultSelected(this._results[S])(),p.DomEvent.preventDefault(x);return}if(x.keyCode===13){p.DomEvent.preventDefault(x),this._complete(this._resultFn,!0);return}if(this._autocomplete&&document.activeElement===this._elem){this._timer&&clearTimeout(this._timer),this._timer=setTimeout(p.Util.bind(function(){this._complete(this._autocomplete)},this),this.options.timeout);return}this._unselect()},_select:function(x){var S=this._selection;S&&(p.DomUtil.removeClass(S.firstChild,"leaflet-routing-geocoder-selected"),S=S[x>0?"nextSibling":"previousSibling"]),S||(S=this._resultTable[x>0?"firstChild":"lastChild"]),S&&(p.DomUtil.addClass(S.firstChild,"leaflet-routing-geocoder-selected"),this._selection=S)},_unselect:function(){this._selection&&p.DomUtil.removeClass(this._selection.firstChild,"leaflet-routing-geocoder-selected"),delete this._selection},_keyDown:function(x){if(this._isOpen)switch(x.keyCode){case 27:this.close(),p.DomEvent.preventDefault(x);return;case 38:this._select(-1),p.DomEvent.preventDefault(x);return;case 40:this._select(1),p.DomEvent.preventDefault(x);return}},_complete:function(x,S){var i=this._elem.value;function M(P){this._lastCompletedText=i,S&&P.length===1?this._resultSelected(P[0])():this._setResults(P)}i&&(i!==this._lastCompletedText?x(i,M,this):S&&M.call(this,this._results))}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],49:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null,x=o("./itinerary"),S=o("./line"),i=o("./plan"),M=o("./osrm-v1");r.exports=x.extend({options:{fitSelectedRoutes:"smart",routeLine:function(P,N){return new S(P,N)},autoRoute:!0,routeWhileDragging:!1,routeDragInterval:500,waypointMode:"connect",showAlternatives:!1,defaultErrorHandler:function(P){console.error("Routing error:",P.error)}},initialize:function(P){p.Util.setOptions(this,P),this._router=this.options.router||new M(P),this._plan=this.options.plan||new i(this.options.waypoints,P),this._requestCount=0,x.prototype.initialize.call(this,P),this.on("routeselected",this._routeSelected,this),this.options.defaultErrorHandler&&this.on("routingerror",this.options.defaultErrorHandler),this._plan.on("waypointschanged",this._onWaypointsChanged,this),P.routeWhileDragging&&this._setupRouteDragging()},_onZoomEnd:function(){if(!(!this._selectedRoute||!this._router.requiresMoreDetail)){var P=this._map;this._router.requiresMoreDetail(this._selectedRoute,P.getZoom(),P.getBounds())&&this.route({callback:p.bind(function(N,H){var W;if(!N){for(W=0;W<H.length;W++)this._routes[W].properties=H[W].properties;this._updateLineCallback(N,H)}},this),simplifyGeometry:!1,geometryOnly:!0})}},onAdd:function(P){this.options.autoRoute&&this.route();var N=x.prototype.onAdd.call(this,P);return this._map=P,this._map.addLayer(this._plan),this._map.on("zoomend",this._onZoomEnd,this),this._plan.options.geocoder&&N.insertBefore(this._plan.createGeocoders(),N.firstChild),N},onRemove:function(P){if(P.off("zoomend",this._onZoomEnd,this),this._line&&P.removeLayer(this._line),P.removeLayer(this._plan),this._alternatives&&this._alternatives.length>0)for(var N=0,H=this._alternatives.length;N<H;N++)P.removeLayer(this._alternatives[N]);return x.prototype.onRemove.call(this,P)},getWaypoints:function(){return this._plan.getWaypoints()},setWaypoints:function(P){return this._plan.setWaypoints(P),this},spliceWaypoints:function(){var P=this._plan.spliceWaypoints.apply(this._plan,arguments);return P},getPlan:function(){return this._plan},getRouter:function(){return this._router},_routeSelected:function(P){var N=this._selectedRoute=P.route,H=this.options.showAlternatives&&P.alternatives,W=this.options.fitSelectedRoutes,K=W==="smart"&&!this._waypointsVisible()||W!=="smart"&&W;this._updateLines({route:N,alternatives:H}),K&&this._map.fitBounds(this._line.getBounds()),this.options.waypointMode==="snap"&&(this._plan.off("waypointschanged",this._onWaypointsChanged,this),this.setWaypoints(N.waypoints),this._plan.on("waypointschanged",this._onWaypointsChanged,this))},_waypointsVisible:function(){var P=this.getWaypoints(),N,H,W,K,re;try{for(N=this._map.getSize(),K=0;K<P.length;K++)re=this._map.latLngToLayerPoint(P[K].latLng),H?H.extend(re):H=p.bounds([re]);return W=H.getSize(),(W.x>N.x/5||W.y>N.y/5)&&this._waypointsInViewport()}catch{return!1}},_waypointsInViewport:function(){var P=this.getWaypoints(),N,H;try{N=this._map.getBounds()}catch{return!1}for(H=0;H<P.length;H++)if(N.contains(P[H].latLng))return!0;return!1},_updateLines:function(P){var N=this.options.addWaypoints!==void 0?this.options.addWaypoints:!0;this._clearLines(),this._alternatives=[],P.alternatives&&P.alternatives.forEach(function(H,W){this._alternatives[W]=this.options.routeLine(H,p.extend({isAlternative:!0},this.options.altLineOptions||this.options.lineOptions)),this._alternatives[W].addTo(this._map),this._hookAltEvents(this._alternatives[W])},this),this._line=this.options.routeLine(P.route,p.extend({addWaypoints:N,extendToWaypoints:this.options.waypointMode==="connect"},this.options.lineOptions)),this._line.addTo(this._map),this._hookEvents(this._line)},_hookEvents:function(P){P.on("linetouched",function(N){this._plan.dragNewWaypoint(N)},this)},_hookAltEvents:function(P){P.on("linetouched",function(N){var H=this._routes.slice(),W=H.splice(N.target._route.routesIndex,1)[0];this.fire("routeselected",{route:W,alternatives:H})},this)},_onWaypointsChanged:function(P){this.options.autoRoute&&this.route({}),this._plan.isReady()||(this._clearLines(),this._clearAlts()),this.fire("waypointschanged",{waypoints:P.waypoints})},_setupRouteDragging:function(){var P=0,N;this._plan.on("waypointdrag",p.bind(function(H){N=H.waypoints,P||(P=setTimeout(p.bind(function(){this.route({waypoints:N,geometryOnly:!0,callback:p.bind(this._updateLineCallback,this)}),P=void 0},this),this.options.routeDragInterval))},this)),this._plan.on("waypointdragend",function(){P&&(clearTimeout(P),P=void 0),this.route()},this)},_updateLineCallback:function(P,N){if(P)P.type!=="abort"&&this._clearLines();else{N=N.slice();var H=N.splice(this._selectedRoute.routesIndex,1)[0];this._updateLines({route:H,alternatives:this.options.showAlternatives?N:[]})}},route:function(P){var N=++this._requestCount,H;this._pendingRequest&&this._pendingRequest.abort&&(this._pendingRequest.abort(),this._pendingRequest=null),P=P||{},this._plan.isReady()&&(this.options.useZoomParameter&&(P.z=this._map&&this._map.getZoom()),H=P&&P.waypoints||this._plan.getWaypoints(),this.fire("routingstart",{waypoints:H}),this._pendingRequest=this._router.route(H,function(W,K){if(this._pendingRequest=null,P.callback)return P.callback.call(this,W,K);if(N===this._requestCount){if(this._clearLines(),this._clearAlts(),W&&W.type!=="abort"){this.fire("routingerror",{error:W});return}if(K.forEach(function(ae,ce){ae.routesIndex=ce}),!P.geometryOnly)this.fire("routesfound",{waypoints:H,routes:K}),this.setAlternatives(K);else{var re=K.splice(0,1)[0];this._routeSelected({route:re,alternatives:K})}}},this,P))},_clearLines:function(){if(this._line&&(this._map.removeLayer(this._line),delete this._line),this._alternatives&&this._alternatives.length){for(var P in this._alternatives)this._map.removeLayer(this._alternatives[P]);this._alternatives=[]}}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./itinerary":55,"./line":56,"./osrm-v1":59,"./plan":60}],50:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null;r.exports=p.Control.extend({options:{header:"Routing error",formatMessage:function(x){return x.status<0?"Calculating the route caused an error. Technical description follows: <code><pre>"+x.message+"</pre></code":"The route could not be calculated. "+x.message}},initialize:function(x,S){p.Control.prototype.initialize.call(this,S),x.on("routingerror",p.bind(function(i){this._element&&(this._element.children[1].innerHTML=this.options.formatMessage(i.error),this._element.style.visibility="visible")},this)).on("routingstart",p.bind(function(){this._element&&(this._element.style.visibility="hidden")},this))},onAdd:function(){var x;return this._element=p.DomUtil.create("div","leaflet-bar leaflet-routing-error"),this._element.style.visibility="hidden",x=p.DomUtil.create("h3",null,this._element),p.DomUtil.create("span",null,this._element),x.innerHTML=this.options.header,this._element},onRemove:function(){delete this._element}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],51:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null,x=o("./localization");r.exports=p.Class.extend({options:{units:"metric",unitNames:null,language:"en",roundingSensitivity:1,distanceTemplate:"{value} {unit}"},initialize:function(S){p.setOptions(this,S);var i=p.Util.isArray(this.options.language)?this.options.language:[this.options.language,"en"];this._localization=new x(i)},formatDistance:function(S,i){var M=this.options.unitNames||this._localization.localize("units"),P=i<=0,N=P?function(re){return re}:p.bind(this._round,this),H,W,K;return this.options.units==="imperial"?(W=S/.9144,W>=1e3?K={value:N(S/1609.344,i),unit:M.miles}:K={value:N(W,i),unit:M.yards}):(H=N(S,i),K={value:H>=1e3?H/1e3:H,unit:H>=1e3?M.kilometers:M.meters}),P&&(K.value=K.value.toFixed(-i)),p.Util.template(this.options.distanceTemplate,K)},_round:function(S,i){var M=i||this.options.roundingSensitivity,P=Math.pow(10,(Math.floor(S/M)+"").length-1),N=Math.floor(S/P),H=N>5?P:P/2;return Math.round(S/H)*H},formatTime:function(S){var i=this.options.unitNames||this._localization.localize("units");return S=Math.round(S/30)*30,S>86400?Math.round(S/3600)+" "+i.hours:S>3600?Math.floor(S/3600)+" "+i.hours+" "+Math.round(S%3600/60)+" "+i.minutes:S>300?Math.round(S/60)+" "+i.minutes:S>60?Math.floor(S/60)+" "+i.minutes+(S%60!==0?" "+S%60+" "+i.seconds:""):S+" "+i.seconds},formatInstruction:function(S,i){return S.text===void 0?this.capitalize(p.Util.template(this._getInstructionTemplate(S,i),p.extend({},S,{exitStr:S.exit?this._localization.localize("formatOrder")(S.exit):"",dir:this._localization.localize(["directions",S.direction]),modifier:this._localization.localize(["directions",S.modifier])}))):S.text},getIconName:function(S,i){switch(S.type){case"Head":if(i===0)return"depart";break;case"WaypointReached":return"via";case"Roundabout":return"enter-roundabout";case"DestinationReached":return"arrive"}switch(S.modifier){case"Straight":return"continue";case"SlightRight":return"bear-right";case"Right":return"turn-right";case"SharpRight":return"sharp-right";case"TurnAround":case"Uturn":return"u-turn";case"SharpLeft":return"sharp-left";case"Left":return"turn-left";case"SlightLeft":return"bear-left"}},capitalize:function(S){return S.charAt(0).toUpperCase()+S.substring(1)},_getInstructionTemplate:function(S,i){var M=S.type==="Straight"?i===0?"Head":"Continue":S.type,P=this._localization.localize(["instructions",M]);return P||(P=[this._localization.localize(["directions",M])," "+this._localization.localize(["instructions","Onto"])]),P[0]+(P.length>1&&S.road?P[1]:"")}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./localization":57}],52:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null,x=o("./autocomplete"),S=o("./localization");function i(M){M.setSelectionRange?M.setSelectionRange(0,9999):M.select()}r.exports=p.Class.extend({includes:typeof p.Evented<"u"&&p.Evented.prototype||p.Mixin.Events,options:{createGeocoder:function(M,P,N){var H=p.DomUtil.create("div","leaflet-routing-geocoder"),W=p.DomUtil.create("input","",H),K=N.addWaypoints?p.DomUtil.create("span","leaflet-routing-remove-waypoint",H):void 0;return W.disabled=!N.addWaypoints,{container:H,input:W,closeButton:K}},geocoderPlaceholder:function(M,P,N){var H=new S(N.options.language).localize("ui");return M===0?H.startPlaceholder:M<P-1?p.Util.template(H.viaPlaceholder,{viaNumber:M}):H.endPlaceholder},geocoderClass:function(){return""},waypointNameFallback:function(M){var P=M.lat<0?"S":"N",N=M.lng<0?"W":"E",H=(Math.round(Math.abs(M.lat)*1e4)/1e4).toString(),W=(Math.round(Math.abs(M.lng)*1e4)/1e4).toString();return P+H+", "+N+W},maxGeocoderTolerance:200,autocompleteOptions:{},language:"en"},initialize:function(M,P,N,H){p.setOptions(this,H);var W=this.options.createGeocoder(P,N,this.options),K=W.closeButton,re=W.input;re.setAttribute("placeholder",this.options.geocoderPlaceholder(P,N,this)),re.className=this.options.geocoderClass(P,N),this._element=W,this._waypoint=M,this.update(),re.value=M.name,p.DomEvent.addListener(re,"click",function(){i(this)},re),K&&p.DomEvent.addListener(K,"click",function(){this.fire("delete",{waypoint:this._waypoint})},this),new x(re,function(ae){re.value=ae.name,M.name=ae.name,M.latLng=ae.center,this.fire("geocoded",{waypoint:M,value:ae})},this,p.extend({resultFn:this.options.geocoder.geocode,resultContext:this.options.geocoder,autocompleteFn:this.options.geocoder.suggest,autocompleteContext:this.options.geocoder},this.options.autocompleteOptions))},getContainer:function(){return this._element.container},setValue:function(M){this._element.input.value=M},update:function(M){var P=this._waypoint,N;P.name=P.name||"",P.latLng&&(M||!P.name)&&(N=this.options.waypointNameFallback(P.latLng),this.options.geocoder&&this.options.geocoder.reverse?this.options.geocoder.reverse(P.latLng,67108864,function(H){H.length>0&&H[0].center.distanceTo(P.latLng)<this.options.maxGeocoderTolerance?P.name=H[0].name:P.name=N,this._update()},this):(P.name=N,this._update()))},focus:function(){var M=this._element.input;M.focus(),i(M)},_update:function(){var M=this._waypoint,P=M&&M.name?M.name:"";this.setValue(P),this.fire("reversegeocoded",{waypoint:M,value:P})}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./autocomplete":48,"./localization":57}],53:[function(o,r,c){(function(h){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null,x=o("./control"),S=o("./itinerary"),i=o("./line"),M=o("./osrm-v1"),P=o("./plan"),N=o("./waypoint"),H=o("./autocomplete"),W=o("./formatter"),K=o("./geocoder-element"),re=o("./localization"),ae=o("./itinerary-builder"),ce=o("./mapbox"),ve=o("./error-control");p.routing={control:function(Se){return new x(Se)},itinerary:function(Se){return S(Se)},line:function(Se,Ee){return new i(Se,Ee)},plan:function(Se,Ee){return new P(Se,Ee)},waypoint:function(Se,Ee,Qe){return new N(Se,Ee,Qe)},osrmv1:function(Se){return new M(Se)},localization:function(Se){return new re(Se)},formatter:function(Se){return new W(Se)},geocoderElement:function(Se,Ee,Qe,He){return new p.Routing.GeocoderElement(Se,Ee,Qe,He)},itineraryBuilder:function(Se){return new ae(Se)},mapbox:function(Se,Ee){return new ce(Se,Ee)},errorControl:function(Se,Ee){return new ve(Se,Ee)},autocomplete:function(Se,Ee,Qe,He){return new H(Se,Ee,Qe,He)}},r.exports=p.Routing={Control:x,Itinerary:S,Line:i,OSRMv1:M,Plan:P,Waypoint:N,Autocomplete:H,Formatter:W,GeocoderElement:K,Localization:re,Formatter:W,ItineraryBuilder:ae,control:p.routing.control,itinerary:p.routing.itinerary,line:p.routing.line,plan:p.routing.plan,waypoint:p.routing.waypoint,osrmv1:p.routing.osrmv1,geocoderElement:p.routing.geocoderElement,mapbox:p.routing.mapbox,errorControl:p.routing.errorControl}}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./autocomplete":48,"./control":49,"./error-control":50,"./formatter":51,"./geocoder-element":52,"./itinerary":55,"./itinerary-builder":54,"./line":56,"./localization":57,"./mapbox":58,"./osrm-v1":59,"./plan":60,"./waypoint":61}],54:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null;r.exports=p.Class.extend({options:{containerClassName:""},initialize:function(x){p.setOptions(this,x)},createContainer:function(x){var S=p.DomUtil.create("table",(x||"")+" "+this.options.containerClassName),i=p.DomUtil.create("colgroup","",S);return p.DomUtil.create("col","leaflet-routing-instruction-icon",i),p.DomUtil.create("col","leaflet-routing-instruction-text",i),p.DomUtil.create("col","leaflet-routing-instruction-distance",i),S},createStepsContainer:function(){return p.DomUtil.create("tbody","")},createStep:function(x,S,i,M){var P=p.DomUtil.create("tr","",M),N,H;return H=p.DomUtil.create("td","",P),N=p.DomUtil.create("span","leaflet-routing-icon leaflet-routing-icon-"+i,H),H.appendChild(N),H=p.DomUtil.create("td","",P),H.appendChild(document.createTextNode(x)),H=p.DomUtil.create("td","",P),H.appendChild(document.createTextNode(S)),P}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],55:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null,x=o("./formatter"),S=o("./itinerary-builder");r.exports=p.Control.extend({includes:typeof p.Evented<"u"&&p.Evented.prototype||p.Mixin.Events,options:{pointMarkerStyle:{radius:5,color:"#03f",fillColor:"white",opacity:1,fillOpacity:.7},summaryTemplate:"<h2>{name}</h2><h3>{distance}, {time}</h3>",timeTemplate:"{time}",containerClassName:"",alternativeClassName:"",minimizedClassName:"",itineraryClassName:"",totalDistanceRoundingSensitivity:-1,show:!0,collapsible:void 0,collapseBtn:function(i){var M=p.DomUtil.create("span",i.options.collapseBtnClass);p.DomEvent.on(M,"click",i._toggle,i),i._container.insertBefore(M,i._container.firstChild)},collapseBtnClass:"leaflet-routing-collapse-btn"},initialize:function(i){p.setOptions(this,i),this._formatter=this.options.formatter||new x(this.options),this._itineraryBuilder=this.options.itineraryBuilder||new S({containerClassName:this.options.itineraryClassName})},onAdd:function(i){var M=this.options.collapsible;return M=M||M===void 0&&i.getSize().x<=640,this._container=p.DomUtil.create("div","leaflet-routing-container leaflet-bar "+(this.options.show?"":"leaflet-routing-container-hide ")+(M?"leaflet-routing-collapsible ":"")+this.options.containerClassName),this._altContainer=this.createAlternativesContainer(),this._container.appendChild(this._altContainer),p.DomEvent.disableClickPropagation(this._container),p.DomEvent.addListener(this._container,"mousewheel",function(P){p.DomEvent.stopPropagation(P)}),M&&this.options.collapseBtn(this),this._container},onRemove:function(){},createAlternativesContainer:function(){return p.DomUtil.create("div","leaflet-routing-alternatives-container")},setAlternatives:function(i){var M,P,N;for(this._clearAlts(),this._routes=i,M=0;M<this._routes.length;M++)P=this._routes[M],N=this._createAlternative(P,M),this._altContainer.appendChild(N),this._altElements.push(N);return this._selectRoute({route:this._routes[0],alternatives:this._routes.slice(1)}),this},show:function(){p.DomUtil.removeClass(this._container,"leaflet-routing-container-hide")},hide:function(){p.DomUtil.addClass(this._container,"leaflet-routing-container-hide")},_toggle:function(){var i=p.DomUtil.hasClass(this._container,"leaflet-routing-container-hide");this[i?"show":"hide"]()},_createAlternative:function(i,M){var P=p.DomUtil.create("div","leaflet-routing-alt "+this.options.alternativeClassName+(M>0?" leaflet-routing-alt-minimized "+this.options.minimizedClassName:"")),N=this.options.summaryTemplate,H=p.extend({name:i.name,distance:this._formatter.formatDistance(i.summary.totalDistance,this.options.totalDistanceRoundingSensitivity),time:this._formatter.formatTime(i.summary.totalTime)},i);return P.innerHTML=typeof N=="function"?N(H):p.Util.template(N,H),p.DomEvent.addListener(P,"click",this._onAltClicked,this),this.on("routeselected",this._selectAlt,this),P.appendChild(this._createItineraryContainer(i)),P},_clearAlts:function(){for(var i=this._altContainer;i&&i.firstChild;)i.removeChild(i.firstChild);this._altElements=[]},_createItineraryContainer:function(i){var M=this._itineraryBuilder.createContainer(),P=this._itineraryBuilder.createStepsContainer(),N,H,W,K,re,ae;for(M.appendChild(P),N=0;N<i.instructions.length;N++)H=i.instructions[N],re=this._formatter.formatInstruction(H,N),K=this._formatter.formatDistance(H.distance),ae=this._formatter.getIconName(H,N),W=this._itineraryBuilder.createStep(re,K,ae,P),H.index&&this._addRowListeners(W,i.coordinates[H.index]);return M},_addRowListeners:function(i,M){p.DomEvent.addListener(i,"mouseover",function(){this._marker=p.circleMarker(M,this.options.pointMarkerStyle).addTo(this._map)},this),p.DomEvent.addListener(i,"mouseout",function(){this._marker&&(this._map.removeLayer(this._marker),delete this._marker)},this),p.DomEvent.addListener(i,"click",function(P){this._map.panTo(M),p.DomEvent.stopPropagation(P)},this)},_onAltClicked:function(i){for(var M=i.target||window.event.srcElement;!p.DomUtil.hasClass(M,"leaflet-routing-alt");)M=M.parentElement;var P=this._altElements.indexOf(M),N=this._routes.slice(),H=N.splice(P,1)[0];this.fire("routeselected",{route:H,alternatives:N})},_selectAlt:function(i){var M,P,N,H;if(M=this._altElements[i.route.routesIndex],p.DomUtil.hasClass(M,"leaflet-routing-alt-minimized"))for(P=0;P<this._altElements.length;P++)N=this._altElements[P],H=P===i.route.routesIndex?"removeClass":"addClass",p.DomUtil[H](N,"leaflet-routing-alt-minimized"),this.options.minimizedClassName&&p.DomUtil[H](N,this.options.minimizedClassName),P!==i.route.routesIndex&&(N.scrollTop=0);p.DomEvent.stop(i)},_selectRoute:function(i){this._marker&&(this._map.removeLayer(this._marker),delete this._marker),this.fire("routeselected",i)}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./formatter":51,"./itinerary-builder":54}],56:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null;r.exports=p.LayerGroup.extend({includes:typeof p.Evented<"u"&&p.Evented.prototype||p.Mixin.Events,options:{styles:[{color:"black",opacity:.15,weight:9},{color:"white",opacity:.8,weight:6},{color:"red",opacity:1,weight:2}],missingRouteStyles:[{color:"black",opacity:.15,weight:7},{color:"white",opacity:.6,weight:4},{color:"gray",opacity:.8,weight:2,dashArray:"7,12"}],addWaypoints:!0,extendToWaypoints:!0,missingRouteTolerance:10},initialize:function(x,S){p.setOptions(this,S),p.LayerGroup.prototype.initialize.call(this,S),this._route=x,this.options.extendToWaypoints&&this._extendToWaypoints(),this._addSegment(x.coordinates,this.options.styles,this.options.addWaypoints)},getBounds:function(){return p.latLngBounds(this._route.coordinates)},_findWaypointIndices:function(){var x=this._route.inputWaypoints,S=[],i;for(i=0;i<x.length;i++)S.push(this._findClosestRoutePoint(x[i].latLng));return S},_findClosestRoutePoint:function(x){var S=Number.MAX_VALUE,i,M,P;for(M=this._route.coordinates.length-1;M>=0;M--)P=x.distanceTo(this._route.coordinates[M]),P<S&&(i=M,S=P);return i},_extendToWaypoints:function(){var x=this._route.inputWaypoints,S=this._getWaypointIndices(),i,M,P;for(i=0;i<x.length;i++)M=x[i].latLng,P=p.latLng(this._route.coordinates[S[i]]),M.distanceTo(P)>this.options.missingRouteTolerance&&this._addSegment([M,P],this.options.missingRouteStyles)},_addSegment:function(x,S,i){var M,P;for(M=0;M<S.length;M++)P=p.polyline(x,S[M]),this.addLayer(P),i&&P.on("mousedown",this._onLineTouched,this)},_findNearestWpBefore:function(x){for(var S=this._getWaypointIndices(),i=S.length-1;i>=0&&S[i]>x;)i--;return i},_onLineTouched:function(x){var S=this._findNearestWpBefore(this._findClosestRoutePoint(x.latlng));this.fire("linetouched",{afterIndex:S,latlng:x.latlng}),p.DomEvent.stop(x)},_getWaypointIndices:function(){return this._wpIndices||(this._wpIndices=this._route.waypointIndices||this._findWaypointIndices()),this._wpIndices}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],57:[function(o,r,c){(function(){var h={directions:{N:"norte",NE:"noreste",E:"este",SE:"sureste",S:"sur",SW:"suroeste",W:"oeste",NW:"noroeste",SlightRight:"leve giro a la derecha",Right:"derecha",SharpRight:"giro pronunciado a la derecha",SlightLeft:"leve giro a la izquierda",Left:"izquierda",SharpLeft:"giro pronunciado a la izquierda",Uturn:"media vuelta"},instructions:{Head:["Derecho {dir}"," sobre {road}"],Continue:["Continuar {dir}"," en {road}"],TurnAround:["Dar vuelta"],WaypointReached:["Lleg a un punto del camino"],Roundabout:["Tomar {exitStr} salida en la rotonda"," en {road}"],DestinationReached:["Llegada a destino"],Fork:["En el cruce gira a {modifier}"," hacia {road}"],Merge:["Incorprate {modifier}"," hacia {road}"],OnRamp:["Gira {modifier} en la salida"," hacia {road}"],OffRamp:["Toma la salida {modifier}"," hacia {road}"],EndOfRoad:["Gira {modifier} al final de la carretera"," hacia {road}"],Onto:"hacia {road}"},formatOrder:function(x){return x+""},ui:{startPlaceholder:"Inicio",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Destino"},units:{meters:"m",kilometers:"km",yards:"yd",miles:"mi",hours:"h",minutes:"min",seconds:"s"}};L.Routing=L.Routing||{};var p=L.Class.extend({initialize:function(x){this._langs=L.Util.isArray(x)?x.slice():[x,"en"];for(var S=0,i=this._langs.length;S<i;S++){var M=/([A-Za-z]+)/.exec(this._langs[S])[1];if(!p[this._langs[S]])if(p[M])this._langs[S]=M;else throw new Error('No localization for language "'+this._langs[S]+'".')}},localize:function(x){var S,i,M;x=L.Util.isArray(x)?x:[x];for(var P=0,N=this._langs.length;P<N;P++){S=p[this._langs[P]];for(var H=0,W=x.length;S&&H<W;H++)i=x[H],M=S[i],S=M;if(M)return M}}});r.exports=L.extend(p,{en:{directions:{N:"north",NE:"northeast",E:"east",SE:"southeast",S:"south",SW:"southwest",W:"west",NW:"northwest",SlightRight:"slight right",Right:"right",SharpRight:"sharp right",SlightLeft:"slight left",Left:"left",SharpLeft:"sharp left",Uturn:"Turn around"},instructions:{Head:["Head {dir}"," on {road}"],Continue:["Continue {dir}"],TurnAround:["Turn around"],WaypointReached:["Waypoint reached"],Roundabout:["Take the {exitStr} exit in the roundabout"," onto {road}"],DestinationReached:["Destination reached"],Fork:["At the fork, turn {modifier}"," onto {road}"],Merge:["Merge {modifier}"," onto {road}"],OnRamp:["Turn {modifier} on the ramp"," onto {road}"],OffRamp:["Take the ramp on the {modifier}"," onto {road}"],EndOfRoad:["Turn {modifier} at the end of the road"," onto {road}"],Onto:"onto {road}"},formatOrder:function(x){var S=x%10-1,i=["st","nd","rd"];return i[S]?x+i[S]:x+"th"},ui:{startPlaceholder:"Start",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"End"},units:{meters:"m",kilometers:"km",yards:"yd",miles:"mi",hours:"h",minutes:"min",seconds:"s"}},de:{directions:{N:"Norden",NE:"Nordosten",E:"Osten",SE:"Sdosten",S:"Sden",SW:"Sdwesten",W:"Westen",NW:"Nordwesten",SlightRight:"leicht rechts",Right:"rechts",SharpRight:"scharf rechts",SlightLeft:"leicht links",Left:"links",SharpLeft:"scharf links",Uturn:"Wenden"},instructions:{Head:["Richtung {dir}"," auf {road}"],Continue:["Geradeaus Richtung {dir}"," auf {road}"],SlightRight:["Leicht rechts abbiegen"," auf {road}"],Right:["Rechts abbiegen"," auf {road}"],SharpRight:["Scharf rechts abbiegen"," auf {road}"],TurnAround:["Wenden"],SharpLeft:["Scharf links abbiegen"," auf {road}"],Left:["Links abbiegen"," auf {road}"],SlightLeft:["Leicht links abbiegen"," auf {road}"],WaypointReached:["Zwischenhalt erreicht"],Roundabout:["Nehmen Sie die {exitStr} Ausfahrt im Kreisverkehr"," auf {road}"],DestinationReached:["Sie haben ihr Ziel erreicht"],Fork:["An der Kreuzung {modifier}"," auf {road}"],Merge:["Fahren Sie {modifier} weiter"," auf {road}"],OnRamp:["Fahren Sie {modifier} auf die Auffahrt"," auf {road}"],OffRamp:["Nehmen Sie die Ausfahrt {modifier}"," auf {road}"],EndOfRoad:["Fahren Sie {modifier} am Ende der Strae"," auf {road}"],Onto:"auf {road}"},formatOrder:function(x){return x+"."},ui:{startPlaceholder:"Start",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Ziel"}},sv:{directions:{N:"norr",NE:"nordost",E:"st",SE:"sydost",S:"syd",SW:"sydvst",W:"vst",NW:"nordvst",SlightRight:"svagt hger",Right:"hger",SharpRight:"skarpt hger",SlightLeft:"svagt vnster",Left:"vnster",SharpLeft:"skarpt vnster",Uturn:"Vnd"},instructions:{Head:["k t {dir}"," till {road}"],Continue:["Fortstt {dir}"],SlightRight:["Svagt hger"," till {road}"],Right:["Svng hger"," till {road}"],SharpRight:["Skarpt hger"," till {road}"],TurnAround:["Vnd"],SharpLeft:["Skarpt vnster"," till {road}"],Left:["Svng vnster"," till {road}"],SlightLeft:["Svagt vnster"," till {road}"],WaypointReached:["Viapunkt ndd"],Roundabout:["Tag {exitStr} avfarten i rondellen"," till {road}"],DestinationReached:["Framme vid resans ml"],Fork:["Tag av {modifier}"," till {road}"],Merge:["Anslut {modifier} "," till {road}"],OnRamp:["Tag pfarten {modifier}"," till {road}"],OffRamp:["Tag avfarten {modifier}"," till {road}"],EndOfRoad:["Svng {modifier} vid vgens slut"," till {road}"],Onto:"till {road}"},formatOrder:function(x){return["frsta","andra","tredje","fjrde","femte","sjtte","sjunde","ttonde","nionde","tionde"][x-1]},ui:{startPlaceholder:"Frn",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Till"}},es:h,sp:h,nl:{directions:{N:"noordelijke",NE:"noordoostelijke",E:"oostelijke",SE:"zuidoostelijke",S:"zuidelijke",SW:"zuidewestelijke",W:"westelijke",NW:"noordwestelijke"},instructions:{Head:["Vertrek in {dir} richting"," de {road} op"],Continue:["Ga in {dir} richting"," de {road} op"],SlightRight:["Volg de weg naar rechts"," de {road} op"],Right:["Ga rechtsaf"," de {road} op"],SharpRight:["Ga scherpe bocht naar rechts"," de {road} op"],TurnAround:["Keer om"],SharpLeft:["Ga scherpe bocht naar links"," de {road} op"],Left:["Ga linksaf"," de {road} op"],SlightLeft:["Volg de weg naar links"," de {road} op"],WaypointReached:["Aangekomen bij tussenpunt"],Roundabout:["Neem de {exitStr} afslag op de rotonde"," de {road} op"],DestinationReached:["Aangekomen op eindpunt"]},formatOrder:function(x){return x===1||x>=20?x+"ste":x+"de"},ui:{startPlaceholder:"Vertrekpunt",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Bestemming"}},fr:{directions:{N:"nord",NE:"nord-est",E:"est",SE:"sud-est",S:"sud",SW:"sud-ouest",W:"ouest",NW:"nord-ouest"},instructions:{Head:["Tout droit au {dir}"," sur {road}"],Continue:["Continuer au {dir}"," sur {road}"],SlightRight:["Lgrement  droite"," sur {road}"],Right:["A droite"," sur {road}"],SharpRight:["Compltement  droite"," sur {road}"],TurnAround:["Faire demi-tour"],SharpLeft:["Compltement  gauche"," sur {road}"],Left:["A gauche"," sur {road}"],SlightLeft:["Lgrement  gauche"," sur {road}"],WaypointReached:["Point d'tape atteint"],Roundabout:["Au rond-point, prenez la {exitStr} sortie"," sur {road}"],DestinationReached:["Destination atteinte"]},formatOrder:function(x){return x+""},ui:{startPlaceholder:"Dpart",viaPlaceholder:"Intermdiaire {viaNumber}",endPlaceholder:"Arrive"}},it:{directions:{N:"nord",NE:"nord-est",E:"est",SE:"sud-est",S:"sud",SW:"sud-ovest",W:"ovest",NW:"nord-ovest"},instructions:{Head:["Dritto verso {dir}"," su {road}"],Continue:["Continuare verso {dir}"," su {road}"],SlightRight:["Mantenere la destra"," su {road}"],Right:["A destra"," su {road}"],SharpRight:["Strettamente a destra"," su {road}"],TurnAround:["Fare inversione di marcia"],SharpLeft:["Strettamente a sinistra"," su {road}"],Left:["A sinistra"," sur {road}"],SlightLeft:["Mantenere la sinistra"," su {road}"],WaypointReached:["Punto di passaggio raggiunto"],Roundabout:["Alla rotonda, prendere la {exitStr} uscita"],DestinationReached:["Destinazione raggiunta"]},formatOrder:function(x){return x+""},ui:{startPlaceholder:"Partenza",viaPlaceholder:"Intermedia {viaNumber}",endPlaceholder:"Destinazione"}},pt:{directions:{N:"norte",NE:"nordeste",E:"leste",SE:"sudeste",S:"sul",SW:"sudoeste",W:"oeste",NW:"noroeste",SlightRight:"curva ligeira a direita",Right:"direita",SharpRight:"curva fechada a direita",SlightLeft:"ligeira a esquerda",Left:"esquerda",SharpLeft:"curva fechada a esquerda",Uturn:"Meia volta"},instructions:{Head:["Siga {dir}"," na {road}"],Continue:["Continue {dir}"," na {road}"],SlightRight:["Curva ligeira a direita"," na {road}"],Right:["Curva a direita"," na {road}"],SharpRight:["Curva fechada a direita"," na {road}"],TurnAround:["Retorne"],SharpLeft:["Curva fechada a esquerda"," na {road}"],Left:["Curva a esquerda"," na {road}"],SlightLeft:["Curva ligueira a esquerda"," na {road}"],WaypointReached:["Ponto de interesse atingido"],Roundabout:["Pegue a {exitStr} sada na rotatria"," na {road}"],DestinationReached:["Destino atingido"],Fork:["Na encruzilhada, vire a {modifier}"," na {road}"],Merge:["Entre  {modifier}"," na {road}"],OnRamp:["Vire {modifier} na rampa"," na {road}"],OffRamp:["Entre na rampa na {modifier}"," na {road}"],EndOfRoad:["Vire {modifier} no fim da rua"," na {road}"],Onto:"na {road}"},formatOrder:function(x){return x+""},ui:{startPlaceholder:"Origem",viaPlaceholder:"Intermdio {viaNumber}",endPlaceholder:"Destino"}},sk:{directions:{N:"sever",NE:"serverovchod",E:"vchod",SE:"juhovchod",S:"juh",SW:"juhozpad",W:"zpad",NW:"serverozpad"},instructions:{Head:["Mierte na {dir}"," na {road}"],Continue:["Pokraujte na {dir}"," na {road}"],SlightRight:["Mierne doprava"," na {road}"],Right:["Doprava"," na {road}"],SharpRight:["Prudko doprava"," na {road}"],TurnAround:["Otote sa"],SharpLeft:["Prudko doava"," na {road}"],Left:["Doava"," na {road}"],SlightLeft:["Mierne doava"," na {road}"],WaypointReached:["Ste v prejazdovom bode."],Roundabout:["Odbote na {exitStr} vjazde"," na {road}"],DestinationReached:["Prili ste do ciea."]},formatOrder:function(x){var S=x%10-1,i=[".",".","."];return i[S]?x+i[S]:x+"."},ui:{startPlaceholder:"Zaiatok",viaPlaceholder:"Cez {viaNumber}",endPlaceholder:"Koniec"}},el:{directions:{N:"",NE:"",E:"",SE:"",S:"",SW:"",W:"",NW:""},instructions:{Head:[" {dir}","  {road}"],Continue:[" {dir}","  {road}"],SlightRight:[" ","  {road}"],Right:["","  {road}"],SharpRight:["  ","  {road}"],TurnAround:[" "],SharpLeft:["  ","  {road}"],Left:["","  {road}"],SlightLeft:[" ","  {road}"],WaypointReached:["   "],Roundabout:["  {exitStr}    ","  {road}"],DestinationReached:["   "]},formatOrder:function(x){return x+""},ui:{startPlaceholder:"",viaPlaceholder:" {viaNumber}",endPlaceholder:""}},ca:{directions:{N:"nord",NE:"nord-est",E:"est",SE:"sud-est",S:"sud",SW:"sud-oest",W:"oest",NW:"nord-oest",SlightRight:"lleu gir a la dreta",Right:"dreta",SharpRight:"gir pronunciat a la dreta",SlightLeft:"gir pronunciat a l'esquerra",Left:"esquerra",SharpLeft:"lleu gir a l'esquerra",Uturn:"mitja volta"},instructions:{Head:["Recte {dir}"," sobre {road}"],Continue:["Continuar {dir}"],TurnAround:["Donar la volta"],WaypointReached:["Ha arribat a un punt del cam"],Roundabout:["Agafar {exitStr} sortida a la rotonda"," a {road}"],DestinationReached:["Arribada al dest"],Fork:["A la crulla gira a la {modifier}"," cap a {road}"],Merge:["Incorpora't {modifier}"," a {road}"],OnRamp:["Gira {modifier} a la sortida"," cap a {road}"],OffRamp:["Pren la sortida {modifier}"," cap a {road}"],EndOfRoad:["Gira {modifier} al final de la carretera"," cap a {road}"],Onto:"cap a {road}"},formatOrder:function(x){return x+""},ui:{startPlaceholder:"Origen",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Dest"},units:{meters:"m",kilometers:"km",yards:"yd",miles:"mi",hours:"h",minutes:"min",seconds:"s"}},ru:{directions:{N:"",NE:"",E:"",SE:"",S:"",SW:"",W:"",NW:"",SlightRight:" ",Right:"",SharpRight:" ",SlightLeft:" ",Left:"",SharpLeft:" ",Uturn:""},instructions:{Head:["   {dir}","  {road}"],Continue:["   {dir}","  {road}"],SlightRight:["  ","  {road}"],Right:["","  {road}"],SharpRight:["  ","  {road}"],TurnAround:[""],SharpLeft:["  ","  {road}"],Left:[" ","  {road}"],SlightLeft:["  ","  {road}"],WaypointReached:[" "],Roundabout:["{exitStr}   ","  {road}"],DestinationReached:[" "],Fork:["   {modifier}","  {road}"],Merge:[" {modifier}","  {road}"],OnRamp:[" {modifier}  ","  {road}"],OffRamp:["  {modifier}","  {road}"],EndOfRoad:[" {modifier}   ","  {road}"],Onto:" {road}"},formatOrder:function(x){return x+"-"},ui:{startPlaceholder:"",viaPlaceholder:" {viaNumber}",endPlaceholder:""},units:{meters:"",kilometers:"",yards:"",miles:"",hours:"",minutes:"",seconds:""}},pl:{directions:{N:"pnoc",NE:"pnocny wschd",E:"wschd",SE:"poudniowy wschd",S:"poudnie",SW:"poudniowy zachd",W:"zachd",NW:"pnocny zachd",SlightRight:"lekko w prawo",Right:"w prawo",SharpRight:"ostro w prawo",SlightLeft:"lekko w lewo",Left:"w lewo",SharpLeft:"ostro w lewo",Uturn:"zawr"},instructions:{Head:["Kieruj si na {dir}"," na {road}"],Continue:["Jed dalej przez {dir}"],TurnAround:["Zawr"],WaypointReached:["Punkt poredni"],Roundabout:["Wyjed {exitStr} zjazdem na rondzie"," na {road}"],DestinationReached:["Dojechano do miejsca docelowego"],Fork:["Na rozwidleniu {modifier}"," na {road}"],Merge:["Zjed {modifier}"," na {road}"],OnRamp:["Wjazd {modifier}"," na {road}"],OffRamp:["Zjazd {modifier}"," na {road}"],EndOfRoad:["Skr {modifier} na kocu drogi"," na {road}"],Onto:"na {road}"},formatOrder:function(x){return x+"."},ui:{startPlaceholder:"Pocztek",viaPlaceholder:"Przez {viaNumber}",endPlaceholder:"Koniec"},units:{meters:"m",kilometers:"km",yards:"yd",miles:"mi",hours:"godz",minutes:"min",seconds:"s"}}})})()},{}],58:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null,x=o("./osrm-v1");r.exports=x.extend({options:{serviceUrl:"https://api.mapbox.com/directions/v5",profile:"mapbox/driving",useHints:!1},initialize:function(S,i){p.Routing.OSRMv1.prototype.initialize.call(this,i),this.options.requestParameters=this.options.requestParameters||{},this.options.requestParameters.access_token=S}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./osrm-v1":59}],59:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null,x=o("@mapbox/corslite"),S=o("@mapbox/polyline"),i=o("osrm-text-instructions")("v5"),M=o("./waypoint");r.exports=p.Class.extend({options:{serviceUrl:"https://router.project-osrm.org/route/v1",profile:"driving",timeout:30*1e3,routingOptions:{alternatives:!0,steps:!0},polylinePrecision:5,useHints:!0,suppressDemoServerWarning:!1,language:"en"},initialize:function(P){p.Util.setOptions(this,P),this._hints={locations:{}},!this.options.suppressDemoServerWarning&&this.options.serviceUrl.indexOf("//router.project-osrm.org")>=0&&console.warn(`You are using OSRM's demo server. Please note that it is **NOT SUITABLE FOR PRODUCTION USE**.
Refer to the demo server's usage policy: https://github.com/Project-OSRM/osrm-backend/wiki/Api-usage-policy

To change, set the serviceUrl option.

Please do not report issues with this server to neither Leaflet Routing Machine or OSRM - it's for
demo only, and will sometimes not be available, or work in unexpected ways.

Please set up your own OSRM server, or use a paid service provider for production.`)},route:function(P,N,H,W){var K=!1,re=[],ae,ce,ve,Se,Ee;for(W=p.extend({},this.options.routingOptions,W),ae=this.buildRouteUrl(P,W),this.options.requestParameters&&(ae+=p.Util.getParamString(this.options.requestParameters,ae)),ce=setTimeout(function(){K=!0,N.call(H||N,{status:-1,message:"OSRM request timed out."})},this.options.timeout),Se=0;Se<P.length;Se++)ve=P[Se],re.push(new M(ve.latLng,ve.name,ve.options));return Ee=x(ae,p.bind(function(Qe,He){var ke,tt={};if(clearTimeout(ce),K)Ee.abort();else{if(Qe)tt.message="HTTP request failed: "+Qe.type+(Qe.target&&Qe.target.status?" HTTP "+Qe.target.status+": "+Qe.target.statusText:""),tt.url=ae,tt.status=-1,tt.target=Qe;else try{ke=JSON.parse(He.responseText);try{return this._routeDone(ke,re,W,N,H)}catch(Ke){tt.status=-3,tt.message=Ke.toString()}}catch(Ke){tt.status=-2,tt.message="Error parsing OSRM response: "+Ke.toString()}N.call(H||N,tt)}},this))},requiresMoreDetail:function(P,N,H){if(!P.properties.isSimplified)return!1;var W=P.inputWaypoints,K;for(K=0;K<W.length;++K)if(!H.contains(W[K].latLng))return!0;return!1},_routeDone:function(P,N,H,W,K){var re=[],ae,ce,ve;if(K=K||W,P.code!=="Ok"){W.call(K,{status:P.code});return}for(ae=this._toWaypoints(N,P.waypoints),ce=0;ce<P.routes.length;ce++)ve=this._convertRoute(P.routes[ce]),ve.inputWaypoints=N,ve.waypoints=ae,ve.properties={isSimplified:!H||!H.geometryOnly||H.simplifyGeometry},re.push(ve);this._saveHintData(P.waypoints,N),W.call(K,null,re)},_convertRoute:function(P){var N={name:"",coordinates:[],instructions:[],summary:{totalDistance:P.distance,totalTime:P.duration}},H=[],W=[],K=0,re=P.legs.length,ae=P.legs[0].steps.length>0,ce,ve,Se,Ee,Qe,He,ke,tt,Ke;for(this.options.stepToText?Ke=this.options.stepToText:Ke=p.bind(i.compile,i,this.options.language),ce=0;ce<re;ce++)for(Se=P.legs[ce],H.push(Se.summary&&Se.summary.charAt(0).toUpperCase()+Se.summary.substring(1)),ve=0;ve<Se.steps.length;ve++)Ee=Se.steps[ve],Qe=this._decodePolyline(Ee.geometry),N.coordinates.push.apply(N.coordinates,Qe),He=this._maneuverToInstructionType(Ee.maneuver,ce===re-1),ke=this._maneuverToModifier(Ee.maneuver),tt=Ke(Ee,{legCount:re,legIndex:ce}),He&&((ce==0&&Ee.maneuver.type=="depart"||Ee.maneuver.type=="arrive")&&W.push(K),N.instructions.push({type:He,distance:Ee.distance,time:Ee.duration,road:Ee.name,direction:this._bearingToDirection(Ee.maneuver.bearing_after),exit:Ee.maneuver.exit,index:K,mode:Ee.mode,modifier:ke,text:tt})),K+=Qe.length;return N.name=H.join(", "),ae?N.waypointIndices=W:N.coordinates=this._decodePolyline(P.geometry),N},_bearingToDirection:function(P){var N=Math.round(P/45)%8;return["N","NE","E","SE","S","SW","W","NW"][N]},_maneuverToInstructionType:function(P,N){switch(P.type){case"new name":return"Continue";case"depart":return"Head";case"arrive":return N?"DestinationReached":"WaypointReached";case"roundabout":case"rotary":return"Roundabout";case"merge":case"fork":case"on ramp":case"off ramp":case"end of road":return this._camelCase(P.type);default:return this._camelCase(P.modifier)}},_maneuverToModifier:function(P){var N=P.modifier;switch(P.type){case"merge":case"fork":case"on ramp":case"off ramp":case"end of road":N=this._leftOrRight(N)}return N&&this._camelCase(N)},_camelCase:function(P){for(var N=P.split(" "),H="",W=0,K=N.length;W<K;W++)H+=N[W].charAt(0).toUpperCase()+N[W].substring(1);return H},_leftOrRight:function(P){return P.indexOf("left")>=0?"Left":"Right"},_decodePolyline:function(P){var N=S.decode(P,this.options.polylinePrecision),H=new Array(N.length),W;for(W=N.length-1;W>=0;W--)H[W]=p.latLng(N[W]);return H},_toWaypoints:function(P,N){var H=[],W,K;for(W=0;W<N.length;W++)K=N[W].location,H.push(new M(p.latLng(K[1],K[0]),P[W].name,P[W].options));return H},buildRouteUrl:function(P,N){for(var H=[],W=[],K,re,ae,ce=!0,ve=0;ve<P.length;ve++)K=P[ve],re=K.latLng,H.push(re.lng+","+re.lat),W.push(this._hints.locations[this._locationKey(re)]||"");return ae=!0,this.options.serviceUrl+"/"+this.options.profile+"/"+H.join(";")+"?"+(N.geometryOnly?N.simplifyGeometry?"":"overview=full":"overview=false")+"&alternatives="+ce.toString()+"&steps="+ae.toString()+(this.options.useHints?"&hints="+W.join(";"):"")+(N.allowUTurns?"&continue_straight="+!N.allowUTurns:"")},_locationKey:function(P){return P.lat+","+P.lng},_saveHintData:function(P,N){var H;this._hints={locations:{}};for(var W=P.length-1;W>=0;W--)H=N[W].latLng,this._hints.locations[this._locationKey(H)]=P[W].hint}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./waypoint":61,"@mapbox/corslite":1,"@mapbox/polyline":2,"osrm-text-instructions":3}],60:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null,x=o("./geocoder-element"),S=o("./waypoint");r.exports=(p.Layer||p.Class).extend({includes:typeof p.Evented<"u"&&p.Evented.prototype||p.Mixin.Events,options:{dragStyles:[{color:"black",opacity:.15,weight:9},{color:"white",opacity:.8,weight:6},{color:"red",opacity:1,weight:2,dashArray:"7,12"}],draggableWaypoints:!0,routeWhileDragging:!1,addWaypoints:!0,reverseWaypoints:!1,addButtonClassName:"",language:"en",createGeocoderElement:function(i,M,P,N){return new x(i,M,P,N)},createMarker:function(i,M){var P={draggable:this.draggableWaypoints},N=p.marker(M.latLng,P);return N},geocodersClassName:""},initialize:function(i,M){p.Util.setOptions(this,M),this._waypoints=[],this.setWaypoints(i)},isReady:function(){var i;for(i=0;i<this._waypoints.length;i++)if(!this._waypoints[i].latLng)return!1;return!0},getWaypoints:function(){var i,M=[];for(i=0;i<this._waypoints.length;i++)M.push(this._waypoints[i]);return M},setWaypoints:function(i){var M=[0,this._waypoints.length].concat(i);return this.spliceWaypoints.apply(this,M),this},spliceWaypoints:function(){var i=[arguments[0],arguments[1]],M;for(M=2;M<arguments.length;M++)i.push(arguments[M]&&arguments[M].hasOwnProperty("latLng")?arguments[M]:new S(arguments[M]));for([].splice.apply(this._waypoints,i);this._waypoints.length<2;)this.spliceWaypoints(this._waypoints.length,0,null);this._updateMarkers(),this._fireChanged.apply(this,i)},onAdd:function(i){this._map=i,this._updateMarkers()},onRemove:function(){var i;if(this._removeMarkers(),this._newWp)for(i=0;i<this._newWp.lines.length;i++)this._map.removeLayer(this._newWp.lines[i]);delete this._map},createGeocoders:function(){var i=p.DomUtil.create("div","leaflet-routing-geocoders "+this.options.geocodersClassName),M=this._waypoints,P,N;return this._geocoderContainer=i,this._geocoderElems=[],this.options.addWaypoints&&(P=p.DomUtil.create("button","leaflet-routing-add-waypoint "+this.options.addButtonClassName,i),P.setAttribute("type","button"),p.DomEvent.addListener(P,"click",function(){this.spliceWaypoints(M.length,0,null)},this)),this.options.reverseWaypoints&&(N=p.DomUtil.create("button","leaflet-routing-reverse-waypoints",i),N.setAttribute("type","button"),p.DomEvent.addListener(N,"click",function(){this._waypoints.reverse(),this.setWaypoints(this._waypoints)},this)),this._updateGeocoders(),this.on("waypointsspliced",this._updateGeocoders),i},_createGeocoder:function(i){var M=this.options.createGeocoderElement(this._waypoints[i],i,this._waypoints.length,this.options);return M.on("delete",function(){i>0||this._waypoints.length>2?this.spliceWaypoints(i,1):this.spliceWaypoints(i,1,new S)},this).on("geocoded",function(P){this._updateMarkers(),this._fireChanged(),this._focusGeocoder(i+1),this.fire("waypointgeocoded",{waypointIndex:i,waypoint:P.waypoint})},this).on("reversegeocoded",function(P){this.fire("waypointgeocoded",{waypointIndex:i,waypoint:P.waypoint})},this),M},_updateGeocoders:function(){var i=[],M,P;for(M=0;M<this._geocoderElems.length;M++)this._geocoderContainer.removeChild(this._geocoderElems[M].getContainer());for(M=this._waypoints.length-1;M>=0;M--)P=this._createGeocoder(M),this._geocoderContainer.insertBefore(P.getContainer(),this._geocoderContainer.firstChild),i.push(P);this._geocoderElems=i.reverse()},_removeMarkers:function(){var i;if(this._markers)for(i=0;i<this._markers.length;i++)this._markers[i]&&this._map.removeLayer(this._markers[i]);this._markers=[]},_updateMarkers:function(){var i,M;if(this._map)for(this._removeMarkers(),i=0;i<this._waypoints.length;i++)this._waypoints[i].latLng?(M=this.options.createMarker(i,this._waypoints[i],this._waypoints.length),M&&(M.addTo(this._map),this.options.draggableWaypoints&&this._hookWaypointEvents(M,i))):M=null,this._markers.push(M)},_fireChanged:function(){this.fire("waypointschanged",{waypoints:this.getWaypoints()}),arguments.length>=2&&this.fire("waypointsspliced",{index:Array.prototype.shift.call(arguments),nRemoved:Array.prototype.shift.call(arguments),added:arguments})},_hookWaypointEvents:function(i,M,P){var N=function(ce){return P?ce.latlng:ce.target.getLatLng()},H=p.bind(function(ce){this.fire("waypointdragstart",{index:M,latlng:N(ce)})},this),W=p.bind(function(ce){this._waypoints[M].latLng=N(ce),this.fire("waypointdrag",{index:M,latlng:N(ce)})},this),K=p.bind(function(ce){this._waypoints[M].latLng=N(ce),this._waypoints[M].name="",this._geocoderElems&&this._geocoderElems[M].update(!0),this.fire("waypointdragend",{index:M,latlng:N(ce)}),this._fireChanged()},this),re,ae;P?(re=p.bind(function(ce){this._markers[M].setLatLng(ce.latlng),W(ce)},this),ae=p.bind(function(ce){this._map.dragging.enable(),this._map.off("mouseup",ae),this._map.off("mousemove",re),K(ce)},this),this._map.dragging.disable(),this._map.on("mousemove",re),this._map.on("mouseup",ae),H({latlng:this._waypoints[M].latLng})):(i.on("dragstart",H),i.on("drag",W),i.on("dragend",K))},dragNewWaypoint:function(i){var M=i.afterIndex+1;this.options.routeWhileDragging?(this.spliceWaypoints(M,0,i.latlng),this._hookWaypointEvents(this._markers[M],M,!0)):this._dragNewWaypoint(M,i.latlng)},_dragNewWaypoint:function(i,M){var P=new S(M),N=this._waypoints[i-1],H=this._waypoints[i],W=this.options.createMarker(i,P,this._waypoints.length+1),K=[],re=this._map.dragging.enabled(),ae=p.bind(function(Se){var Ee,Qe;for(W&&W.setLatLng(Se.latlng),Ee=0;Ee<K.length;Ee++)Qe=K[Ee].getLatLngs(),Qe.splice(1,1,Se.latlng),K[Ee].setLatLngs(Qe);p.DomEvent.stop(Se)},this),ce=p.bind(function(Se){var Ee;for(W&&this._map.removeLayer(W),Ee=0;Ee<K.length;Ee++)this._map.removeLayer(K[Ee]);this._map.off("mousemove",ae),this._map.off("mouseup",ce),this.spliceWaypoints(i,0,Se.latlng),re&&this._map.dragging.enable(),p.DomEvent.stop(Se)},this),ve;for(W&&W.addTo(this._map),ve=0;ve<this.options.dragStyles.length;ve++)K.push(p.polyline([N.latLng,M,H.latLng],this.options.dragStyles[ve]).addTo(this._map));re&&this._map.dragging.disable(),this._map.on("mousemove",ae),this._map.on("mouseup",ce)},_focusGeocoder:function(i){this._geocoderElems[i]?this._geocoderElems[i].focus():document.activeElement.blur()}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./geocoder-element":52,"./waypoint":61}],61:[function(o,r,c){(function(h){(function(){var p=typeof window<"u"?window.L:typeof h<"u"?h.L:null;r.exports=p.Class.extend({options:{allowUTurn:!1},initialize:function(x,S,i){p.Util.setOptions(this,i),this.latLng=p.latLng(x),this.name=S}})})()}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[53])),BE}cF();const uF="/assets/tamulokal-uwfeNl1Q.png",dF=({address:o,userLat:r,userLng:c,marketLat:h,marketLng:p,isOpen:x,onToggle:S,markerSize:i=40})=>{const M=ye.useRef(null),P=`market-map-${h}-${p}`,{distance:N,loading:H}=ES(h,p);return ye.useEffect(()=>{if(!x||!r||!c||!h||!p)return;M.current&&M.current.remove();const W=qu.map(P);M.current=W,qu.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/">OSM</a> contributors'}).addTo(W),qu.marker([r,c]).addTo(W).bindPopup("You");const K=ae=>qu.divIcon({html:`
          <div class="flex items-center justify-center rounded-full border-2 border-blue-500 bg-white"
               style="width: ${i}px; height: ${i}px;">
            <img src="${ae}" class="w-3/4 h-3/4 object-contain" />
          </div>
        `,className:"",iconSize:[i,i],iconAnchor:[i/2,i],popupAnchor:[0,-i]}),re=qu.latLngBounds([r,c],[h,p]);W.fitBounds(re,{padding:[50,50]}),qu.Routing.control({waypoints:[qu.latLng(r,c),qu.latLng(h,p)],lineOptions:{styles:[{color:"#FF8225",weight:4}]},show:!1,addWaypoints:!1,draggableWaypoints:!1,routeWhileDragging:!1,fitSelectedRoutes:!1,createMarker:(ae,ce)=>ae===0?qu.marker(ce.latLng):qu.marker(ce.latLng,{icon:K(uF)})}).addTo(W)},[x,r,c,h,p,i]),C.jsxs("div",{className:"w-full overflow-hidden font-inter mt-2 border-b border-gray-200",children:[C.jsxs("button",{onClick:S,className:"w-full flex justify-between items-center px-4 py-3 text-sm font-medium transition-colors",children:[x?C.jsx("span",{children:"Market Address"}):C.jsxs("span",{className:"flex items-center gap-2",children:[C.jsx(xS,{className:"text-[var(--black)]"}),H?"Calculating...":`${N} km from you`]}),x?C.jsx(aM,{className:"text-[var(--black)]"}):C.jsx(nM,{className:"text-[var(--black)]"})]}),x&&C.jsxs("div",{className:"px-4 py-2 text-sm text-[#585858] flex flex-col gap-3",children:[C.jsx("p",{className:"mb-2",children:o}),C.jsx("div",{id:P,className:"h-64 w-full rounded-lg shadow-sm"}),C.jsx("button",{className:"bg-[#FF8225] text-white rounded-xl text-sm font-medium hover:bg-[#e6731f] transition-colors w-full h-[35px]",onClick:()=>console.log("Get Direction clicked"),children:"Get Direction"})]})]})},ZM=({review:o,onToggleHide:r,isOwnProfile:c=!1})=>{const h=new Date(o.created_at),p=()=>{const i=new Date,P=(i-h)/(1e3*60*60);if(P<24){const N=Math.floor(P);return N===0?"Just now":`${N} hour${N>1?"s":""} ago`}return P<48?"Yesterday":i.getFullYear()===h.getFullYear()?h.toLocaleDateString(void 0,{day:"numeric",month:"short"}):h.toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"})},x=o.hide,S=`
    relative border rounded-lg p-4 shadow-sm transition
    ${x&&!c?"hidden":""}
    ${x&&c?"bg-gray-50 border-dashed opacity-80":"bg-white border-gray-200"}
  `;return C.jsxs("div",{className:S,children:[c&&C.jsx("button",{onClick:()=>r(o.id,!o.hide),className:"absolute top-3 right-3 bg-white p-1.5 rounded-full shadow hover:bg-gray-100 transition",title:x?"Unhide review":"Hide review",children:x?C.jsx(yS,{className:"text-red-500",size:18}):C.jsx(fx,{className:"text-green-600",size:18})}),x&&c&&C.jsx("span",{className:"absolute top-3 left-3 text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded-full",children:"Hidden from public"}),C.jsxs("div",{className:"flex items-center mb-2",children:[C.jsx("img",{src:o.visitor.image||"/default-avatar.png",alt:o.visitor.username||"Visitor",className:"w-10 h-10 rounded-full mr-3 object-cover"}),C.jsxs("div",{className:"flex-1",children:[C.jsx("p",{className:"font-semibold text-gray-800",children:o.visitor.fullname||"Anonymous"}),o.visitor.username&&C.jsxs("p",{className:"text-xs text-gray-500",children:["@",o.visitor.username]}),C.jsxs("div",{className:"flex justify-between items-center mt-1",children:[C.jsx("div",{className:"flex",children:[1,2,3,4,5].map(i=>i<=o.rating?C.jsx(Wo,{className:"text-yellow-400 text-sm"},i):C.jsx(vy,{className:"text-gray-300 text-sm"},i))}),C.jsx("p",{className:"text-xs text-gray-500",children:p()})]})]})]}),C.jsx("p",{className:"text-gray-700 text-sm mt-2",children:o.review}),o.image&&C.jsx("img",{src:o.image,alt:"Review",className:"w-full max-w-xs h-auto mt-2 rounded-lg object-cover"})]})},hF=({marketId:o})=>{const[r,c]=ye.useState([]),h="/v1";return ye.useEffect(()=>{(async()=>{try{const S=await(await fetch(`${h}/market/${o}/review`)).json();c(S)}catch(x){console.error("Error fetching reviews:",x)}})()},[o]),C.jsx("div",{className:"space-y-4",children:r.length>0?r.map(p=>C.jsx(ZM,{review:p},p.id)):C.jsx("p",{className:"text-center text-gray-500 py-8",children:"No reviews yet."})})},z0="/v1",$E=250,XM=({market_id:o,review_id:r})=>{const h=$r(!0)?.user?.id,[p,x]=ye.useState(null),[S,i]=ye.useState(0),[M,P]=ye.useState(""),[N,H]=ye.useState(null),[W,K]=ye.useState(null),[re,ae]=ye.useState(!1),ce=r!=null&&o==null;ye.useEffect(()=>{if(!h||!ce)return;(async()=>{try{const ke=await fetch(`${z0}/visitor/${h}/market-review?id=${r}`);if(!ke.ok)return;const tt=await ke.json();i(tt.rating),P(tt.review),K(tt.image||null),x(tt.market_id)}catch(ke){console.error("Failed to fetch review",ke)}})()},[h,r,ce]);const ve=He=>{const ke=He.target.files[0];ke&&(H(ke),K(URL.createObjectURL(ke)))},Se=async He=>{try{const ke=await He.json();return ke?.id||ke?.review_id||ke?.data?.id||ke?.data?.review_id}catch{return null}},Ee=async He=>{if(He.preventDefault(),!(!S||!M)){ae(!0);try{let ke=r;if(ce){if(!(await fetch(`${z0}/visitor/${h}/market-review?id=${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:S,review:M})})).ok)throw new Error("Failed to update review")}else{const tt=await fetch(`${z0}/market/${o}/review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:h,rating:S,review:M})});if(!tt.ok)throw new Error("Failed to create review");ke=await Se(tt)}if(N&&ke){const tt=await createImageBitmap(N),Ke=document.createElement("canvas");Ke.width=tt.width,Ke.height=tt.height,Ke.getContext("2d").drawImage(tt,0,0);const ft=await new Promise(We=>Ke.toBlob(We,"image/jpeg",.9)),gt=o||p;if(!gt)throw new Error("Market ID is required for image upload");const ni=`markets/${gt}/${ke}.jpg`,{error:Ft}=await bs.storage.from("tamulokal").upload(ni,ft,{upsert:!0,contentType:"image/jpeg"});if(Ft)throw Ft;const{data:Vi}=bs.storage.from("tamulokal").getPublicUrl(ni),Ri=`${Vi.publicUrl}?t=${new Date().getTime()}`;await fetch(`${z0}/visitor/${h}/market-review?id=${ke}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:Ri})})}}catch(ke){console.error("Failed to submit review",ke)}finally{ae(!1)}}},Qe=M.length>$E?"text-red-500":"text-gray-500";return C.jsxs("form",{onSubmit:Ee,className:"py-6 md:py-8",children:[C.jsx("div",{className:"bg-white md:rounded-xl md:border md:border-gray-200 md:shadow-sm px-4 md:px-6 py-4 md:py-6",children:C.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[C.jsx("div",{className:"md:w-1/2",children:C.jsxs("label",{className:"block cursor-pointer",children:[C.jsx("input",{type:"file",accept:"image/*",onChange:ve,className:"hidden"}),C.jsx("div",{className:"w-full aspect-square overflow-hidden rounded-lg border border-dashed border-gray-300 bg-gray-50 flex items-center justify-center",children:W?C.jsx("img",{src:W,alt:"Review",className:"w-full h-full object-cover"}):C.jsxs("div",{className:"flex flex-col items-center text-gray-400",children:[C.jsx(uM,{className:"text-3xl mb-2"}),C.jsx("span",{className:"text-sm md:text-base",children:"No image"})]})})]})}),C.jsxs("div",{className:"md:w-1/2 flex flex-col items-center md:justify-between gap-6",children:[C.jsx("div",{className:"w-full flex justify-center md:justify-center gap-3 md:gap-4 md:mt-10",children:[1,2,3,4,5].map(He=>C.jsx("button",{type:"button",onClick:()=>i(He),className:"text-3xl md:text-4xl text-orange-500",children:S>=He?C.jsx(Wo,{}):C.jsx(vy,{})},He))}),C.jsxs("div",{className:"w-full max-w-xl",children:[C.jsx("textarea",{value:M,onChange:He=>P(He.target.value),rows:6,placeholder:"Share your experience...",className:"w-full border border-gray-300 rounded-lg px-3 py-3 text-sm md:text-base bg-white focus:outline-none focus:ring-2 focus:ring-orange-400"}),C.jsxs("div",{className:`mt-2 text-xs md:text-sm text-right ${Qe}`,children:[M.length," / ",$E]})]})]})]})}),C.jsx("div",{className:"mt-6 flex justify-end px-4 md:px-0",children:C.jsx("button",{type:"submit",disabled:re,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-3.5 bg-[#FF8225] text-white rounded-md font-semibold text-sm md:text-base hover:bg-[#e6731f] transition disabled:opacity-60",children:re?"Saving...":ce?"Save":"Create"})})]})},fF=({marketId:o})=>{const[r,c]=ye.useState(null),h="/v1";if(ye.useEffect(()=>{(async()=>{try{const Ee=await(await fetch(`${h}/market/${o}/rating`)).json();c(Ee)}catch(Se){console.error("Error fetching market rating:",Se)}})()},[o]),!r)return C.jsx("p",{className:"text-gray-500 text-center",children:"Loading rating..."});const{average_rating:p=0,total_reviews:x=0,rating_counts:S,rating_1:i,rating_2:M,rating_3:P,rating_4:N,rating_5:H}=r;let W;S&&typeof S=="object"?W=[S[5]||0,S[4]||0,S[3]||0,S[2]||0,S[1]||0]:W=[Number(H||0),Number(N||0),Number(P||0),Number(M||0),Number(i||0)];const re=W.reduce((ve,Se)=>ve+Se,0)||x||1,ae=Math.round((Number(p)||0)*2)/2,ce=()=>{const ve=[];for(let Se=1;Se<=5;Se++)Se<=Math.floor(ae)?ve.push(C.jsx(Wo,{className:"text-[var(--orange)] text-lg"},Se)):Se-.5===ae?ve.push(C.jsx(jL,{className:"text-[var(--orange)] text-lg"},Se)):ve.push(C.jsx(vy,{className:"text-[var(--orange)] text-lg"},Se));return ve};return C.jsxs("div",{className:"flex items-center justify-between p-2 gap-4",children:[C.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[100px]",children:[C.jsx("h2",{className:"text-4xl font-bold text-[var(--black)]",children:Number(p).toFixed(1)}),C.jsx("div",{className:"flex gap-1 mt-1",children:ce()}),C.jsxs("p",{className:"text-sm text-[var(--gray)] mt-1",children:[x," reviews"]})]}),C.jsx("div",{className:"h-20 w-px bg-[var(--gray)]"}),C.jsx("div",{className:"flex flex-col justify-between w-full space-y-1",children:[5,4,3,2,1].map((ve,Se)=>{const Qe=(W[Se]||0)/re*100;return C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx("span",{className:"w-4 text-sm text-[var(--gray)]",children:ve}),C.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 overflow-hidden",children:C.jsx("div",{className:"bg-[var(--orange)] h-full rounded-full transition-all duration-500",style:{width:`${Qe}%`}})})]},ve)})})]})},mF=({vendor:o})=>{const{name:r,image:c,avg_rating:h,total_reviews:p,lot:x}=o,S=h>0&&p>0,i=["Fresh Produce","Street Food","Snacks & Drinks"];return C.jsxs("div",{className:"flex flex-col",children:[C.jsx("img",{src:c||"/placeholder.jpg",alt:r,className:"w-full h-36 object-cover rounded-lg border border-gray-200 shadow-md"}),C.jsx("h3",{className:"mt-2 text-base font-semibold text-gray-800 line-clamp-1",children:r}),C.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:i.map((M,P)=>C.jsx("span",{className:"text-[10px] bg-orange-100 text-orange-700 px-1 py-0.5 rounded-full whitespace-nowrap",children:M},P))}),C.jsxs("div",{className:"mt-1 flex justify-between items-center text-sm text-gray-700",children:[C.jsxs("span",{className:"font-medium",children:["Lot ",x," "]}),C.jsx("span",{className:"flex items-center",children:S?C.jsxs(C.Fragment,{children:[C.jsx(Wo,{className:"text-orange-400 text-base mr-1"}),h.toFixed(1)," (",p,")"]}):"No reviews yet"})]})]})},pF=({marketId:o})=>{const[r,c]=ye.useState([]),[h,p]=ye.useState(!0),x="/v1";return ye.useEffect(()=>{(async()=>{try{const M=await(await fetch(`${x}/market/${o}/vendor`)).json();c(M||[])}catch(i){console.error("Error fetching vendors:",i)}finally{p(!1)}})()},[o]),h?C.jsx("p",{className:"text-gray-500 text-center",children:"Loading vendors..."}):r.length===0?C.jsx("p",{className:"text-gray-500 text-center",children:"No vendors found."}):C.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:r.map(S=>C.jsx(mF,{vendor:S},S.vendor_id))})},gF=()=>{const o=wy(),c=$r(!0)?.user?.id,{id:h}=cl(),p=$a(),[x,S]=ye.useState(null),[i,M]=ye.useState("detail"),[P,N]=ye.useState(null),[H,W]=ye.useState(!1),[K,re]=ye.useState(!1),[ae,ce]=ye.useState(!1),ve="/v1";ye.useEffect(()=>{(async()=>{try{const Ke=await fetch(`${ve}/market/${h}`);if(!Ke.ok)throw new Error(`HTTP error: ${Ke.status}`);const lt=await Ke.json();S(lt)}catch(Ke){console.log("Error fetching market",Ke)}})()},[h,ve]),ye.useEffect(()=>{if(!c||!h)return;(async()=>{try{const Ke=await fetch(`${ve}/market/${h}/bookmark?visitor_id=${c}`);if(!Ke.ok)return;const lt=await Ke.json();re(lt.hasBookmarked)}catch(Ke){console.error("Failed to fetch bookmark status",Ke)}})()},[h,c,ve]),ye.useEffect(()=>{if(!c||!h)return;(async()=>{try{await fetch(`${ve}/market/${h}/click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({viewer_id:c})})}catch(Ke){console.error("Failed to record market click",Ke)}})()},[h,c,ve]);const Se=async()=>{if(!(!c||!h||ae)){ce(!0);try{if(K){if(!(await fetch(`${ve}/market/${h}/bookmark`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:c})})).ok)throw new Error("Failed to remove bookmark");re(!1)}else{if(!(await fetch(`${ve}/market/${h}/bookmark`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:c})})).ok)throw new Error("Failed to add bookmark");re(!0)}}catch(tt){console.error("Bookmark toggle error:",tt)}finally{ce(!1)}}};if(!x||!o||!o[0]||!o[1])return C.jsx("div",{className:"flex justify-center items-center h-screen",children:C.jsx("p",{className:"text-gray-600",children:"Loading..."})});const Ee=new Date,Qe=Ee.getDay()===0?7:Ee.getDay(),He=x.schedules?.find(tt=>tt.daily_day===Qe),ke=[{id:"detail",label:"Detail"},{id:"vendors",label:"Vendors"},{id:"reviews",label:"Reviews"}];return C.jsxs("div",{className:"relative bg-[var(--white)] min-h-screen",children:[C.jsxs("div",{className:"max-w-6xl mx-auto w-full px-0 md:px-6 pb-8 md:pt-6",children:[C.jsx("div",{className:"hidden md:flex justify-end px-4 md:px-0 mb-3",children:C.jsx("button",{onClick:()=>p(-1),className:" rounded-full w-9 h-9 flex items-center justify-center shadow-md hover:bg-gray-100 transition-colors",children:C.jsx(Od,{className:"w-5 h-10"})})}),C.jsxs("div",{className:"flex flex-col md:flex-row md:gap-6",children:[C.jsxs("div",{className:"relative md:w-2/5 w-full",children:[C.jsx("div",{className:"w-full aspect-[16/9] md:rounded-xl overflow-hidden bg-gray-100",children:C.jsx("img",{src:x.image,alt:x.name,className:"w-full h-full object-cover"})}),C.jsx("button",{onClick:()=>p(-1),className:"md:hidden absolute top-4 right-4 bg-[var(--white)] rounded-full w-8 h-8 flex items-center justify-center shadow-md hover:bg-gray-100 transition-colors",children:C.jsx(Od,{size:20,className:"text-[var(--black)]"})}),C.jsx("button",{onClick:Se,disabled:ae||!c,className:"md:hidden absolute top-4 left-4 bg-[var(--white)] rounded-full w-8 h-8 flex items-center justify-center shadow-md hover:bg-gray-100 transition-colors",title:K?"Remove bookmark":"Bookmark",children:K?C.jsx(AL,{size:20,className:"text-orange-500"}):C.jsx(tM,{size:20,className:"text-gray-700"})})]}),C.jsx("div",{className:`flex-1 mt-4 md:mt-0  md:rounded-xl md:border md:border-gray-200 md:shadow-sm\r
                      md:flex md:flex-col md:justify-center`,style:{minHeight:"0"},children:C.jsxs("div",{className:"px-4 md:px-6 py-4",children:[C.jsx("h1",{className:"font-bold text-[var(--black)] text-xl md:text-2xl mb-2",children:x.name}),C.jsx(fF,{marketId:h})]})})]}),C.jsxs("div",{className:"mt-4  md:rounded-xl md:border md:border-gray-200 md:shadow-sm",children:[C.jsx("div",{className:"px-4 md:px-6",children:C.jsx("div",{className:"flex justify-around py-2 z-10",children:ke.map(tt=>C.jsx("button",{onClick:()=>M(tt.id),className:`text-sm font-medium px-4 py-2 transition-colors ${i===tt.id?"text-[var(--orange)] border-b-2 border-[var(--orange)]":"text-[var(--gray)]"}`,children:tt.label},tt.id))})}),C.jsxs("div",{className:"px-4 md:px-6 pb-6 flex flex-col",children:[i==="detail"&&C.jsxs(C.Fragment,{children:[C.jsx("p",{className:"text-gray-700 mt-4",children:x.description}),C.jsx(rF,{schedules:x.schedules,frequency:x.recurrence_type,todaysSchedule:He,isOpen:P==="time",onToggle:()=>N(P==="time"?null:"time")}),C.jsx(dF,{address:x.address,userLat:o[0],userLng:o[1],marketLat:x.latitude,marketLng:x.longitude,isOpen:P==="distance",onToggle:()=>N(P==="distance"?null:"distance")})]}),i==="vendors"&&C.jsx("div",{className:"mt-4",children:C.jsx(pF,{marketId:h})}),i==="reviews"&&C.jsx("div",{className:"relative pb-10 mt-4",children:C.jsx(hF,{marketId:h})})]})]})]}),H&&C.jsx(XM,{market:x,type:"new",onClose:()=>W(!1)})]})};function YM(o){return Cn({attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"},child:[]}]})(o)}const _F=()=>{const o=$a(),[r,c]=ye.useState(!1),[h,p]=ye.useState({username:"",email:"",password:""}),[x,S]=ye.useState(!1),[i,M]=ye.useState(null),[P,N]=ye.useState(!1),[H,W]=ye.useState(null),K=ye.useRef(null),re=async Se=>{if(!Se){M(null);return}N(!0);const{data:Ee,error:Qe}=await bs.from("visitor").select("username").eq("username",Se).maybeSingle();Qe&&console.error(Qe),M(!Ee),N(!1)},ae=Se=>{p({...h,[Se.target.name]:Se.target.value}),Se.target.name==="username"&&(K.current&&clearTimeout(K.current),K.current=setTimeout(()=>{re(Se.target.value)},500))},ce=()=>c(!r),ve=async Se=>{Se.preventDefault(),S(!0);try{const{data:Ee,error:Qe}=await bs.auth.signUp({email:h.email,password:h.password,options:{data:{username:h.username}}});if(Qe)throw Qe;if(!Ee.user)throw new Error("Signup failed: user not created.");alert("Signup successful! Please check your email for verification."),o("/")}catch(Ee){console.error("Signup failed:",Ee),alert(Ee.message||"Signup failed. Please try again.")}finally{S(!1)}};return C.jsxs("div",{className:"flex flex-col items-center font-inter",children:[C.jsx("h1",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Create your account"}),C.jsxs("form",{onSubmit:ve,className:"flex flex-col items-center gap-2 w-[300px]",children:[C.jsxs("div",{className:"w-full",children:[C.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),C.jsx("input",{id:"username",type:"text",name:"username",value:h.username,onChange:ae,onFocus:()=>W("username"),onBlur:()=>W(null),placeholder:"Enter your username",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                       text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]`,required:!0}),H==="username"&&C.jsxs(C.Fragment,{children:[P&&C.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Checking username..."}),i===!1&&!P&&C.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Username already taken"}),i===!0&&!P&&C.jsx("p",{className:"text-xs text-green-500 mt-1",children:"Username available"})]})]}),C.jsxs("div",{className:"w-full",children:[C.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),C.jsx("input",{id:"email",type:"email",name:"email",value:h.email,onChange:ae,onFocus:()=>W("email"),placeholder:"example@gmail.com",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                       text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]`,required:!0})]}),C.jsxs("div",{className:"w-full mb-4",children:[C.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),C.jsxs("div",{className:"relative",children:[C.jsx("input",{id:"password",type:r?"text":"password",name:"password",value:h.password,onChange:ae,onFocus:()=>W("password"),placeholder:"Enter your password",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                         text-sm pr-10 focus:outline-none focus:ring-2 focus:ring-[#FF8225]`,required:!0}),C.jsx("button",{type:"button",onClick:ce,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:r?C.jsx(fx,{}):C.jsx(sM,{})})]})]}),C.jsx("button",{type:"submit",disabled:x,className:`w-full h-[40px] rounded-xl bg-[#FF8225] text-white \r
                     font-medium text-sm hover:bg-[#e6731f] transition-colors disabled:opacity-50`,children:x?"Signing Up...":"Sign Up"}),C.jsxs("div",{className:"flex items-center w-full my-2",children:[C.jsx("hr",{className:"flex-grow border-gray-300"}),C.jsx("span",{className:"px-2 text-sm text-gray-500",children:"or"}),C.jsx("hr",{className:"flex-grow border-gray-300"})]}),C.jsxs("button",{type:"button",className:`w-full h-[40px] rounded-xl border border-gray-300 \r
                     flex items-center justify-center gap-2 text-sm font-medium \r
                     hover:bg-gray-50 transition-colors`,onClick:async()=>{const{data:Se,error:Ee}=await bs.auth.signInWithOAuth({provider:"google"});Ee&&console.error(Ee)},children:[C.jsx(YM,{className:"text-[#DB4437]"}),"Continue with Google"]})]})]})},yF=()=>{const[o,r]=ye.useState(!1),[c,h]=ye.useState({email:"",password:""}),p=$a(),x=M=>{h({...c,[M.target.name]:M.target.value})},S=()=>r(!o),i=async M=>{M.preventDefault();try{const{data:P,error:N}=await bs.auth.signInWithPassword({email:c.email,password:c.password});if(N)throw N;console.log(" Signed in successfully:",P),console.log("Access token:",P.session?.access_token),p("/",{replace:!0})}catch(P){console.error(P),alert("Sign in failed. Please check your credentials.")}};return C.jsxs("div",{className:"flex flex-col items-center font-inter",children:[C.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Sign into your account"}),C.jsxs("form",{onSubmit:i,className:"flex flex-col items-center gap-4 w-[300px]",children:[C.jsxs("div",{className:"w-full",children:[C.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),C.jsx("input",{id:"email",type:"email",name:"email",value:c.email,onChange:x,placeholder:"example@gmail.com",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                       text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]`})]}),C.jsxs("div",{className:"w-full",children:[C.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),C.jsxs("div",{className:"relative",children:[C.jsx("input",{id:"password",type:o?"text":"password",name:"password",value:c.password,onChange:x,placeholder:"Enter your password",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                         text-sm pr-10 focus:outline-none focus:ring-2 focus:ring-[#FF8225]`}),C.jsx("button",{type:"button",onClick:S,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:o?C.jsx(fx,{}):C.jsx(sM,{})})]})]}),C.jsx("button",{type:"submit",className:`w-full h-[40px] rounded-xl bg-[#FF8225] text-white \r
                     font-medium text-sm hover:bg-[#e6731f] transition-colors`,children:"Sign In"}),C.jsxs("div",{className:"flex items-center w-full my-2",children:[C.jsx("hr",{className:"flex-grow border-gray-300"}),C.jsx("span",{className:"px-2 text-sm text-gray-500",children:"or"}),C.jsx("hr",{className:"flex-grow border-gray-300"})]}),C.jsxs("button",{type:"button",className:`w-full h-[40px] rounded-xl border border-gray-300 \r
                     flex items-center justify-center gap-2 text-sm font-medium \r
                     hover:bg-gray-50 transition-colors`,onClick:async()=>{const{data:M,error:P}=await bs.auth.signInWithOAuth({provider:"google"});P&&console.error(P),console.log(M)},children:[C.jsx(YM,{className:"text-[#DB4437]"}),"Continue with Google"]})]})]})},vF=()=>{const[o,r]=ye.useState(!0),c=Uc(),h=$a(),p=c.state?.from||"/",x=$r(!1,"/");ye.useEffect(()=>(document.body.style.overflow="hidden",console.log("AuthPage opened from:",p),x&&(console.log("Existing session found, redirecting..."),h("/",{replace:!0})),()=>{document.body.style.overflow="auto"}),[p,h,x]);const S=()=>{console.log("Closing auth, going back to:",p),h(p,{replace:!0})},i=()=>r(!o);return C.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[100dvh] bg-[#FFFDFA] px-4 font-inter relative",children:[C.jsxs("button",{onClick:S,className:"absolute top-4 right-4 w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center text-gray-600 hover:bg-gray-100",children:[C.jsx(Od,{className:"w-5 h-5"})," "]}),C.jsx("img",{src:"/tamulokal.png",alt:"tamulokal",className:"w-16 h-16"}),o?C.jsx(_F,{}):C.jsx(yF,{}),C.jsx("div",{className:"mt-4 text-sm text-gray-600 text-center",children:o?C.jsxs(C.Fragment,{children:["Already have an account?"," ",C.jsx("button",{type:"button",onClick:i,className:"text-[#FF8225] font-medium hover:underline",children:"Login"})]}):C.jsxs(C.Fragment,{children:["Dont have an account?"," ",C.jsx("button",{type:"button",onClick:i,className:"text-[#FF8225] font-medium hover:underline",children:"Sign Up"})]})})]})},xF=({userId:o,isOwnProfile:r=!0})=>{const[c,h]=ye.useState(null),[p,x]=ye.useState({fullname:"",username:"",image:""}),[S,i]=ye.useState(null),[M,P]=ye.useState(null),[N,H]=ye.useState(!1),[W,K]=ye.useState(!0),[re,ae]=ye.useState(!1),ce="/v1",Se=$r()?.user?.id;console.log(c),ye.useEffect(()=>{if(!o)return;(async()=>{try{const ft=await fetch(`${ce}/user/${o}/profile`);if(!ft.ok)throw new Error("Failed to fetch profile");const gt=await ft.json();h(gt),x({fullname:gt.fullname||gt.name||"",username:gt.username||"",image:gt.image||""})}catch(ft){console.error("Error fetching profile:",ft)}finally{K(!1)}})()},[o,ce]),ye.useEffect(()=>{(async()=>{if(!(!Se||!o))try{const gt=await(await fetch(`${ce}/user/follow?follower_id=${Se}&following_id=${o}`)).json();ae(gt.length>0)}catch(ft){console.error("Follow status check failed:",ft)}})()},[Se,o,ce]);const Ee=lt=>{const{name:ft,value:gt}=lt.target;x(ni=>({...ni,[ft]:gt}))},Qe=lt=>{const ft=lt.target.files[0];ft&&(P(ft),i(URL.createObjectURL(ft)))},He=async()=>{try{let lt=p.image;if(M){const ni=await createImageBitmap(M),Ft=document.createElement("canvas");Ft.width=ni.width,Ft.height=ni.height,Ft.getContext("2d").drawImage(ni,0,0);const Ri=await new Promise(Gi=>Ft.toBlob(Gi,"image/jpeg",.9)),We=`$visitors/${o}/${o}.jpg`,{error:Et}=await bs.storage.from("tamulokal").upload(We,Ri,{upsert:!0,contentType:"image/jpeg"});if(Et)throw Et;const{data:{publicUrl:jt}}=bs.storage.from("tamulokal").getPublicUrl(We);lt=`${jt}?t=${new Date().getTime()}`}const ft=await fetch(`${ce}/visitor/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullname:p.fullname,username:p.username,image:lt})});if(!ft.ok)throw new Error("Failed to update profile");const gt=await ft.json();h(gt),x({fullname:gt.fullname,username:gt.username,image:gt.image}),i(null),P(null),H(!1)}catch(lt){console.error("Error saving profile:",lt),alert("Failed to save changes")}},ke=()=>{x({fullname:c.fullname,username:c.username,image:c.image}),i(null),P(null),H(!1)},tt=async()=>{if(!Se)return alert("You must be logged in.");try{if(re){if(!(await fetch(`${ce}/user/follow?follower_id=${Se}&following_id=${o}`,{method:"DELETE"})).ok)throw new Error("Failed to unfollow");ae(!1),h(ft=>({...ft,follower_count:ft.follower_count-1}))}else{if(!(await fetch(`${ce}/user/follow`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({follower_id:Se,following_id:o})})).ok)throw new Error("Failed to follow");ae(!0),h(ft=>({...ft,follower_count:ft.follower_count+1}))}}catch(lt){console.error(lt),alert("Failed to update follow status")}};if(W)return C.jsx("div",{className:"text-center text-gray-500 mt-10",children:"Loading profile..."});const Ke=S||p.image||"/profile.png";return C.jsxs("div",{className:"flex flex-col items-start w-full px-4",children:[C.jsxs("div",{className:"flex items-center gap-4 w-full",children:[C.jsxs("div",{className:"relative",children:[C.jsx("img",{src:Ke,alt:"Profile",className:"w-20 h-20 rounded-full object-cover border shadow-md"}),N&&r&&C.jsxs("label",{className:"absolute bottom-0 right-0 bg-[#FF8225] text-white text-xs px-2 py-1 rounded-full cursor-pointer hover:bg-[#e6731f]",children:["Edit",C.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:Qe})]})]}),C.jsx("div",{className:"flex flex-col items-start justify-center",children:N?C.jsxs(C.Fragment,{children:[C.jsx("input",{type:"text",name:"fullname",value:p.fullname,onChange:Ee,className:"border rounded-lg px-2 py-1 text-sm w-[150px]"}),C.jsx("input",{type:"text",name:"username",value:p.username,onChange:Ee,placeholder:"@username",className:"border rounded-lg px-2 py-1 text-sm w-[150px] mt-2"})]}):C.jsxs(C.Fragment,{children:[C.jsx("h2",{className:"text-lg font-semibold text-gray-800 max-w-[200px]",children:c.fullname}),C.jsxs("p",{className:"text-sm text-gray-500",children:["@",c.username]})]})})]}),C.jsxs("div",{className:"flex justify-between items-center w-full mt-6",children:[C.jsxs("div",{className:"flex items-center gap-8",children:[C.jsxs("div",{className:"flex flex-col items-left",children:[C.jsx("span",{className:"text-sm text-gray-500",children:"Following"}),C.jsx("span",{className:"font-semibold text-gray-900",children:c.following_count})]}),C.jsxs("div",{className:"flex flex-col items-left",children:[C.jsx("span",{className:"text-sm text-gray-500",children:"Followers"}),C.jsx("span",{className:"font-semibold text-gray-900",children:c.follower_count})]})]}),r?C.jsx("div",{className:"flex gap-2",children:N?C.jsxs(C.Fragment,{children:[C.jsx("button",{onClick:ke,className:"px-4 py-1.5 rounded-full text-sm font-medium border border-gray-300 text-gray-600 hover:bg-gray-100",children:"Cancel"}),C.jsx("button",{onClick:He,className:"px-4 py-1.5 rounded-full text-sm font-medium bg-[#4CAF50] text-white hover:bg-[#45a049]",children:"Save"})]}):C.jsx("button",{onClick:()=>H(!0),className:"px-4 py-1.5 rounded-xl text-sm font-medium border border-[#FF8225] text-[#FF8225] bg-white hover:bg-[#FF8225] hover:text-white transition-colors duration-200",children:"Edit Profile"})}):C.jsx("button",{onClick:tt,className:`px-4 py-1.5 rounded-xl text-sm font-medium border transition-colors duration-200 ${re?"border-gray-300 text-gray-600 bg-gray-100":"border-[#FF8225] text-[#FF8225] bg-white hover:bg-[#FF8225] hover:text-white"}`,children:re?"Following":"Follow"})]})]})},h1="/v1",bF=({product:o,isOwnProfile:r,showAvailabilityToggle:c=!1})=>{console.log(o);const h=$a(),{id:p}=cl(),x=Uc(),[S,i]=ye.useState(!0),[M,P]=ye.useState(!1),[N,H]=ye.useState(!1);ye.useEffect(()=>{if(!c||!p)return;(async()=>{P(!0);try{const re=await fetch(`${h1}/marketspace/${p}/product?product_id=${o.id}`);if(!re.ok)throw new Error("Failed to check availability");const ae=await re.json();i(!!ae)}catch(re){console.error("Failed to check availability",re),i(!1)}finally{P(!1)}})()},[c,p,o.id]);const W=async K=>{if(K.stopPropagation(),N||M)return;const re=!S;i(re),H(!0);try{let ae;if(re?ae=await fetch(`${h1}/marketspace/${p}/product`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:o.id})}):ae=await fetch(`${h1}/marketspace/${p}/product?product_id=${o.id}`,{method:"DELETE"}),!ae.ok)throw new Error("Availability update failed")}catch(ae){console.error(ae),i(!re),alert("Failed to update product availability")}finally{H(!1)}};return C.jsxs("div",{className:`relative rounded-xl overflow-hidden transition
        ${S?"bg-white shadow-sm hover:shadow-md":"bg-gray-100 opacity-60"}
      `,children:[C.jsx("div",{className:"w-full aspect-square bg-gray-100",children:C.jsx("img",{src:o.image||"/default-product.png",alt:o.name,className:"w-full h-full object-cover"})}),!S&&C.jsx("div",{className:"absolute top-2 left-2 text-xs bg-black/70 text-white px-2 py-0.5 rounded",children:"Unavailable"}),C.jsx("div",{onClick:()=>{r&&h(`/business/product/${o.id}`)},className:`absolute top-2 left-2 bg-white/90 backdrop-blur px-2 py-0.5 rounded-full shadow
          flex items-center gap-1 text-xs
          ${r?"cursor-pointer hover:bg-white":""}
        `,children:o.review_count>0?C.jsxs(C.Fragment,{children:[C.jsx(Wo,{className:"text-yellow-500",size:14}),C.jsxs("span",{className:"font-medium text-gray-700",children:[o.avg_rating," (",o.review_count,")"]})]}):C.jsx("span",{className:"text-gray-500",children:"No reviews"})}),C.jsxs("div",{className:"p-3",children:[C.jsx("h3",{className:"text-sm font-semibold text-gray-800 truncate",children:o.name}),C.jsxs("p",{className:"text-[#FF8225] font-medium text-sm mt-1",children:["RM ",o.price||"0.00"]})]}),c&&!M&&C.jsx("button",{onClick:W,disabled:N,className:"absolute top-2 right-2 bg-white/90 backdrop-blur p-1.5 rounded-full shadow hover:bg-white transition",title:S?"Set Unavailable":"Set Available",children:S?C.jsx(fx,{className:"text-green-600",size:18}):C.jsx(yS,{className:"text-red-500",size:18})}),r&&C.jsx("button",{onClick:()=>h(`/business/product/${o.id}/edit`),className:"absolute bottom-2 right-2 bg-white rounded-full p-1 shadow hover:bg-gray-100 transition",children:C.jsx(JL,{className:"text-gray-600",size:20})}),!r&&C.jsx("button",{onClick:()=>h(`${x.pathname}/product/${o.id}`),className:"absolute bottom-2 right-2 p-1 transition",title:"Leave a review",children:C.jsx(yf,{className:"text-yellow-500",size:20})})]})},dc=({title:o,backPath:r=-1})=>{const c=$a();return C.jsx("div",{className:"px-4 py-4",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("button",{onClick:()=>c(r),className:"text-[var(--black)] hover:text-[var(--orange)] transition",children:C.jsx(km,{className:"text-2xl"})}),C.jsx("h1",{className:"text-xl font-semibold text-[var(--black)]",children:o})]})})},wF="/v1",AS=({vendorId:o,isOwnProfile:r,showAvailabilityToggle:c=!1})=>{const[h,p]=ye.useState([]),[x,S]=ye.useState(!0),i=$a();return ye.useEffect(()=>{if(!o)return;(async()=>{try{const P=await fetch(`${wF}/product?vendor_id=${o}`);if(!P.ok)throw new Error("Failed to fetch products");const N=await P.json();p(N||[])}catch(P){console.error(P)}finally{S(!1)}})()},[o]),x?C.jsx("div",{className:"text-gray-500 text-center mt-4",children:"Loading products..."}):C.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 pb-12 max-w-6xl",children:[r&&C.jsxs("div",{onClick:()=>i("/business/product/add"),className:"flex flex-col border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-[#FF8225] transition-colors overflow-hidden",children:[C.jsx("div",{className:"w-full aspect-square flex items-center justify-center bg-gray-100",children:C.jsx(ix,{className:"text-4xl text-gray-400"})}),C.jsx("div",{className:"p-3 flex-1 flex items-center justify-center",children:C.jsx("span",{className:"text-gray-500 text-sm text-center",children:"Add Product"})})]}),h.map(M=>C.jsx(bF,{product:M,isOwnProfile:r,showAvailabilityToggle:c},M.id))]})},SF=()=>{const[o,r]=ye.useState(!1),[c,h]=ye.useState(!0),[p,x]=ye.useState(!1),[S,i]=ye.useState(!0),[M,P]=ye.useState([]),[N,H]=ye.useState(!1),W=$a();Uc();const K=$r(!0),re=()=>r(Ee=>!Ee);ye.useEffect(()=>{(async()=>{if(!K||!K.user)return;const Qe=K.user.id;try{const He=await fetch(`/v1/user/${Qe}/roles`),ke=await He.json();let tt=[];if(He.ok&&ke.roles?(tt=ke.roles,P(tt)):P([]),tt.includes("Vendor")){const lt=await(await fetch(`/v1/vendor/${Qe}/verify`)).json();H(lt.verified)}if(tt.includes("Organizer")){const lt=await(await fetch(`/v1/organizer/${Qe}/verify`)).json();H(lt.verified)}}catch(He){console.error("Error fetching roles or verification:",He),P([])}})()},[K]);const ae=async()=>{try{r(!1),localStorage.clear();const{error:Ee}=await bs.auth.signOut();if(Ee)throw Ee;W("/auth",{replace:!0})}catch(Ee){console.error("Sign-out error:",Ee.message),alert("Failed to sign out: "+Ee.message)}},ce=M.includes("Vendor"),ve=M.includes("Organizer"),Se=ce||ve;return C.jsxs("div",{className:"relative z-[60]",children:[C.jsx("button",{onClick:re,className:`text-3xl text-gray-800 hover:text-[#FF8225] transition-colors duration-200 relative z-[70]
          ${o?"md:hidden":""}
        `,children:o?C.jsx(Od,{}):C.jsx(XL,{})}),o&&C.jsxs("div",{className:"fixed inset-0 bg-[var(--white)] z-[60] flex flex-col justify-between transition-all duration-300",children:[C.jsx("button",{onClick:re,className:"absolute top-4 right-4 text-3xl text-gray-800 hover:text-[#FF8225] transition-colors duration-200",children:C.jsx(Od,{})}),C.jsxs("div",{className:"flex flex-col mt-16 px-6 gap-8 overflow-y-auto",children:[C.jsxs("div",{children:[C.jsx("h2",{className:"text-sm uppercase tracking-wide text-gray-400 mb-3",children:"My Account"}),C.jsxs("button",{onClick:()=>{W("/market/history"),r(!1)},className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[C.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[C.jsx(HL,{className:"text-xl"}),"Market History"]}),C.jsx(yf,{className:"text-gray-400 ml-auto"})]}),C.jsxs("button",{onClick:()=>{W("/notifications"),r(!1)},className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[C.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[C.jsx(IL,{className:"text-xl"}),"Notifications"]}),C.jsx(yf,{className:"text-gray-400 ml-auto"})]}),C.jsxs("button",{onClick:()=>{W("/market/bookmark"),r(!1)},className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[C.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[C.jsx(tM,{className:"text-xl"}),"Bookmarks"]}),C.jsx(yf,{className:"text-gray-400 ml-auto"})]}),!ce&&!ve&&C.jsxs(C.Fragment,{children:[C.jsxs("button",{onClick:()=>{W("/product-review"),r(!1)},className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[C.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[C.jsx(vy,{className:"text-xl"}),"Product Reviews"]}),C.jsx(yf,{className:"text-gray-400 ml-auto"})]}),C.jsxs("div",{className:"flex flex-col",children:[C.jsxs("button",{onClick:()=>x(Ee=>!Ee),className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[C.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[C.jsx(OL,{className:"text-xl"}),"Switch to business account"]}),C.jsx(yf,{className:`text-gray-400 ml-auto transition-transform duration-200 ${p?"rotate-90":""}`})]}),p&&C.jsxs("div",{className:"ml-4 flex flex-col gap-1 mt-1",children:[C.jsxs("button",{onClick:()=>{W("/organizer/registration"),r(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[C.jsx(Tm,{className:"text-xl"}),"Organizer"]}),C.jsxs("button",{onClick:()=>{W("/vendor/registration"),r(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[C.jsx(tx,{className:"text-xl"}),"Vendor"]})]})]})]})]}),Se&&C.jsxs("div",{children:[C.jsx("h2",{className:"text-sm uppercase tracking-wide text-gray-400 mb-3",children:"Business"}),N?C.jsxs("div",{className:"flex flex-col gap-2",children:[ce&&C.jsxs("div",{className:"flex flex-col",children:[C.jsx("button",{onClick:()=>{W("/business/product"),r(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:C.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[C.jsx(tx,{className:"text-xl"}),"Product"]})}),C.jsxs("button",{onClick:()=>i(Ee=>!Ee),className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[C.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[C.jsx(Tm,{className:"text-xl"}),"Market Space"]}),C.jsx(yf,{className:`text-gray-400 ml-auto transition-transform duration-200 ${S?"rotate-90":""}`})]}),S&&C.jsxs("div",{className:"ml-4 flex flex-col gap-1 mt-1",children:[C.jsxs("button",{onClick:()=>{W("/business/marketspace"),r(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[C.jsx(my,{className:"text-xl"}),"Manage"]}),C.jsxs("button",{onClick:()=>{W("/business/marketspace/available"),r(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[C.jsx(ix,{className:"text-xl"}),"Available"]}),C.jsxs("button",{onClick:()=>{W("/business/marketspace/application"),r(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[C.jsx(KL,{className:"text-xl"}),"My Application"]})]}),C.jsx("button",{onClick:()=>{W(`/business/vendor/${K?.user?.id}/statistic`),r(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:C.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[C.jsx(DL,{className:"text-xl"}),"Statistic"]})})]}),ve&&C.jsxs("div",{className:"flex flex-col",children:[C.jsxs("button",{onClick:()=>h(Ee=>!Ee),className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[C.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[C.jsx(Tm,{className:"text-xl"}),"Market"]}),C.jsx(yf,{className:`text-gray-400 ml-auto transition-transform duration-200 ${c?"rotate-90":""}`})]}),c&&C.jsxs("div",{className:"ml-4 flex flex-col gap-1 mt-1",children:[C.jsxs("button",{onClick:()=>{W("/business/market/"),r(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[C.jsx(my,{className:"text-xl"}),"Manage"]}),C.jsxs("button",{onClick:()=>{W("/business/market/apply"),r(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[C.jsx(ix,{className:"text-xl"}),"Apply"]})]})]})]}):C.jsx("div",{className:"flex flex-col gap-2",children:C.jsxs("div",{className:"flex items-center gap-3 text-gray-800 py-2 text-left text-base font-medium",children:[C.jsx(qL,{className:"text-xl"}),"Application in Progress"]})})]})]}),C.jsxs("div",{className:"flex items-center gap-2 p-6 text-red-600 hover:text-red-700 cursor-pointer border-t border-gray-100",onClick:ae,children:[C.jsx(WL,{className:"text-xl"}),C.jsx("span",{className:"text-sm font-medium",children:"Sign Out"})]})]})]})},TF=({visitorId:o})=>{const[r,c]=ye.useState([]),[h,p]=ye.useState(!0),x="/v1";return ye.useEffect(()=>{(async()=>{try{const M=await(await fetch(`${x}/visitor/${o}/market-history`)).json();console.log(M),c(M||[])}catch(i){console.error("Error fetching visited markets:",i)}finally{p(!1)}})()},[o]),console.log(r),h?C.jsx("p",{className:"text-center text-gray-500",children:"Loading markets..."}):r.length===0?C.jsx("p",{className:"text-center text-gray-500",children:"No visited markets found."}):C.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.map(S=>C.jsx("div",{className:"w-full aspect-square overflow-hidden shadow-sm hover:shadow-md transition cursor-pointer",children:C.jsx("img",{src:S.market_image,alt:S.market_name,className:"w-full h-full object-cover"})},S.market_id))})},KM=({market:o,isVendor:r=!1,onView:c,isOwnProfile:h=!0})=>{const[p,x]=ye.useState(!1);return C.jsxs("div",{className:"relative rounded-xl overflow-hidden shadow-md hover:shadow-lg transition cursor-pointer h-[208px]",children:[C.jsx("img",{src:o.image||o.market_image||"/default-market.png",alt:o.name||o.market_name,className:"w-full h-full object-cover"}),C.jsx("div",{className:"absolute inset-0 bg-black/40"}),!r&&h&&o.application_status==1&&C.jsxs("div",{className:"absolute bottom-2 left-2 right-2 flex justify-between z-10",children:[C.jsxs("div",{className:"flex gap-2",children:[C.jsx(fo,{to:`/business/market/${o.id}/space`,onClick:S=>S.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Manage Space",children:C.jsx(my,{size:20})}),C.jsx(fo,{to:`/business/market/${o.id}/review`,onClick:S=>S.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Reviews",children:C.jsx(vy,{size:20})}),C.jsx(fo,{to:`/business/market/${o.id}/statistic`,onClick:S=>S.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Statistics",children:C.jsx(LL,{size:20})})]}),C.jsx(fo,{to:`/business/market/${o.id}/edit`,onClick:S=>S.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Edit Market",children:C.jsx(UL,{size:20})})]}),r&&h&&C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-2 z-10",children:[C.jsxs("div",{className:"flex items-center gap-1 bg-black/60 p-1 rounded-full text-white cursor-default",children:[C.jsx(my,{size:20}),C.jsx("span",{className:"text-xs font-medium",children:o.available_space})]}),o.schedules?.length>0&&C.jsxs("button",{onClick:S=>{S.stopPropagation(),x(!p)},className:"flex items-center gap-1 bg-black/60 p-1 rounded-full text-white hover:bg-black/80 transition text-xs font-medium",title:"View Schedule",children:[C.jsx(rM,{size:20}),C.jsx("span",{children:o.schedules.length})]})]}),p&&C.jsxs("div",{className:"absolute bottom-12 left-2 bg-black/80 text-white text-xs rounded p-2 z-20 max-h-40 overflow-y-auto",children:[o.schedules.length>0&&C.jsx("div",{className:"mb-1",children:C.jsx("span",{className:"font-semibold",children:o.schedules[0].recurrence_type})}),o.schedules.map(S=>{const i={1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday",7:"Sunday"},M=N=>{const[H,W,K]=N.split(":").map(Number),re=H>=12?"PM":"AM";return`${H%12===0?12:H%12}:${W.toString().padStart(2,"0")} ${re}`};let P="";return S.daily_day?P=`Every Day ${i[S.daily_day]||""}`:S.weekly_day?P=`${i[S.weekly_day]||""}`:S.monthly_day?P=`Day ${S.monthly_day} of every month`:S.annually_day&&S.annually_month?P=`On ${S.annually_day}/${S.annually_month}`:S.once_date&&(P=S.once_date),C.jsxs("div",{className:"mb-1",children:[C.jsx("div",{children:P}),C.jsxs("div",{children:[M(S.open_time)," - ",M(S.close_time)]})]},S.schedule_id)})]}),C.jsx(fo,{to:`/business/market/${o.market_id||o.id}/space`,onClick:S=>S.stopPropagation(),className:"absolute bottom-2 right-2 bg-orange-500 text-white px-3 py-1 rounded-lg font-medium hover:bg-orange-600 transition z-10",title:"View Market",children:"View"})]}),o.application_status!==1&&C.jsxs("div",{className:"absolute bottom-2 left-2 z-10 bg-black/70 text-white text-xs px-3 py-1 rounded-full",children:[o.application_status===2&&"Pending approval",o.application_status===3&&"Rejected"]}),C.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:C.jsx("h3",{className:"text-white font-semibold text-lg drop-shadow text-center px-4 line-clamp-2",children:o.name||o.market_name})})]})},Qg=({loading:o,size:r=10})=>o?C.jsx("div",{className:"w-screen h-screen flex items-center justify-center",children:C.jsx("div",{style:{animationDuration:"1000ms"},className:`w-${r} h-${r} border-4 border-gray-300 border-t-orange-500 rounded-full animate-spin`})}):null,kF="/v1",JM=({organizerId:o,isOwnProfile:r=!0})=>{const[c,h]=ye.useState([]),[p,x]=ye.useState(!0);return $a(),ye.useEffect(()=>{if(!o)return;(async()=>{try{const i=await fetch(`${kF}/organizer/${o}/market`);if(!i.ok)throw new Error("Failed to fetch markets");const M=await i.json();h(M||[])}catch(i){console.error(i)}finally{x(!1)}})()},[o]),p?C.jsx(Qg,{loading:!0}):C.jsx("div",{className:"flex flex-col gap-3 pb-12",children:c.map(S=>C.jsx(KM,{market:S,isOwnProfile:r},S.id))})},I0=()=>{const o=$r(!0),r=$a(),{id:c}=cl(),h=Uc(),[p,x]=ye.useState([]),[S,i]=ye.useState("main"),[M,P]=ye.useState([]),[N,H]=ye.useState(!0),W="/v1",K=c||o?.user?.id;ye.useEffect(()=>{if(!K)return;(async()=>{H(!0);try{const He=await fetch(`${W}/visitor/${K}/post`);if(!He.ok)throw new Error("Failed to fetch visitor posts");const ke=await He.json();P(ke)}catch(He){console.error("[Visitor Posts] Error:",He),P([])}finally{H(!1)}})()},[c,W,K]),ye.useEffect(()=>{(async()=>{if(!(!o||!o.user))try{const He=await fetch(`${W}/user/${o.user.id}/roles`),ke=await He.json();He.ok&&ke.roles&&x(ke.roles)}catch(He){console.error("Error fetching roles:",He),x([])}})()},[o,W]);const re=h.pathname,ae=re.match(/\/(vendor|visitor|organizer)\//);let ce=ae?ae[1]:null;re==="/profile"&&(p.includes("Vendor")?ce="vendor":p.includes("Organizer")?ce="organizer":ce="visitor");const ve=re==="/profile"||(c?c===o?.user?.id:!0);if(ye.useEffect(()=>{if(!o?.user||!c||ve)return;(async()=>{try{await fetch(`${W}/user/${c}/click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({viewer_id:o.user.id})})}catch(He){console.error("[Profile Click] Error:",He)}})(),console.log("here")},[c,ve,o,W]),!o)return null;const Se={visitor:{icon:eO,key:"visited"},vendor:{icon:tx,key:"products"},organizer:{icon:Tm,key:"markets"}},Ee=Array.isArray(M)?M.filter(Qe=>Qe.type===1):[];return C.jsxs("div",{className:"relative flex flex-col items-center min-h-screen bg-[#FFFDFA] font-inter",children:[C.jsxs("div",{className:"absolute top-4 w-full px-4 md:px-8 flex justify-between items-center",children:[ve?C.jsx("div",{}):C.jsx("div",{className:"flex items-center gap-3",children:C.jsx("button",{onClick:()=>r(-1),className:"text-[var(--black)] hover:text-[var(--orange)] transition",children:C.jsx(km,{className:"text-2xl"})})}),ve&&C.jsx(SF,{})]}),C.jsxs("div",{className:"w-full max-w-5xl mt-16 px-4 md:px-8 pb-10",children:[C.jsx(xF,{userId:c||o.user.id,isOwnProfile:ve}),C.jsx("hr",{className:"mt-6 border-gray-200"}),!ve&&C.jsxs("div",{className:"flex justify-center mb-6 border-b border-gray-200 py-3 gap-2",children:[C.jsx("button",{onClick:()=>i("main"),className:`flex-1 max-w-[200px] flex justify-center py-2 rounded-md ${S==="main"?"text-orange-500 bg-orange-50":"text-gray-400"}`,children:C.jsx(VL,{size:22})}),ce&&Se[ce]&&C.jsx("button",{onClick:()=>i(Se[ce].key),className:`flex-1 max-w-[200px] flex justify-center py-2 rounded-md ${S===Se[ce].key?"text-orange-500 bg-orange-50":"text-gray-400"}`,children:Np.createElement(Se[ce].icon,{size:22})})]}),S==="main"&&Ee.length>0&&C.jsx("div",{className:"mt-6 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 md:gap-4",children:Ee.map(Qe=>C.jsx("div",{className:"w-full aspect-square overflow-hidden shadow-sm hover:shadow-md transition cursor-pointer rounded-lg bg-white",onClick:()=>{console.log("Clicked post:",Qe.id)},children:C.jsx("img",{src:Qe.image,alt:Qe.caption||"Visitor post",className:"w-full h-full object-cover"})},Qe.id))}),ce==="visitor"&&S==="visited"&&C.jsx("div",{className:"mt-6",children:C.jsx(TF,{visitorId:c||o.user.id})}),ce==="vendor"&&S==="products"&&C.jsx("div",{className:"mt-6",children:C.jsx(AS,{vendorId:c||o.user.id,isOwnProfile:ve})}),ce==="organizer"&&S==="markets"&&C.jsx("div",{className:"mt-6",children:C.jsx(JM,{organizerId:c||o.user.id})})]})]})},VE=o=>{const r=new Date,c=new Date(o),h=r-c,p=Math.floor(h/(1e3*60)),x=Math.floor(h/(1e3*60*60)),S=Math.floor(h/(1e3*60*60*24)),i=Math.floor(S/7);return p<60?`${p}m ago`:x<24?`${x}h ago`:S<7?`${S}d ago`:`${i}w ago`},EF=({comment:o,onReply:r})=>C.jsxs("div",{className:"w-full py-3",children:[C.jsxs("div",{className:"flex items-start gap-3",children:[C.jsx("img",{src:o.visitor?.image,alt:o.visitor?.username,className:"w-8 h-8 rounded-full object-cover"}),C.jsxs("div",{className:"flex flex-col leading-tight min-w-0",children:[C.jsxs("div",{className:"flex items-end gap-1 text-sm text-gray-800 -mt-1",children:[C.jsx("span",{className:"font-semibold",children:o.visitor?.username}),C.jsx("span",{className:"text-gray-400",children:""}),C.jsx("span",{className:"text-gray-400 text-xs",children:VE(o.created_at)})]}),C.jsx("p",{className:"text-gray-800 text-sm break-words whitespace-normal",children:o.comment}),C.jsx("button",{className:"text-left text-xs text-gray-500 mt-1 hover:underline",onClick:()=>{r&&r(o.id,o.visitor?.username)},children:"Reply"})]})]}),o.replies&&o.replies.length>0&&C.jsx("div",{className:"mt-2 ml-8 border-l border-gray-200 pl-3 flex flex-col gap-3",children:o.replies.map(c=>C.jsxs("div",{className:"py-1",children:[C.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[C.jsx("img",{src:c.visitor?.image,alt:c.visitor?.username,className:"w-6 h-6 rounded-full object-cover"}),C.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-800",children:[C.jsx("span",{className:"font-medium",children:c.visitor?.username}),C.jsx("span",{className:"text-gray-400",children:""}),C.jsx("span",{className:"text-gray-400",children:VE(c.created_at)})]})]}),C.jsx("p",{className:"text-gray-800 text-sm",children:c.reply})]},c.id))})]}),QM=({contentId:o,onClose:r})=>{const[c,h]=ye.useState(""),[p,x]=ye.useState(""),[S,i]=ye.useState([]),[M,P]=ye.useState(""),H=$r()?.user?.id,W=async()=>{try{const ae=await(await fetch(`/v1/content/${o}/comment`)).json();i(ae)}catch(re){console.error("Error fetching comments:",re)}};ye.useEffect(()=>(document.body.style.overflow="hidden",W(),()=>{document.body.style.overflow=""}),[o]);const K=async()=>{if(!(!M.trim()||!H))try{p?await fetch("/v1/content/reply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment_id:p,visitor_id:H,reply:M.trim()})}):await fetch(`/v1/content/${o}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content_id:o,visitor_id:H,comment:M.trim()})}),P(""),x(""),h(""),W()}catch(re){console.error("Error submitting comment or reply:",re)}};return C.jsx("div",{className:"fixed inset-0 z-[9999] flex justify-center items-end bg-black/40",children:C.jsxs("div",{className:"bg-white w-full max-w-lg h-[75vh] rounded-t-2xl flex flex-col overflow-hidden",children:[C.jsxs("div",{className:"p-4 relative border-b border-gray-200",children:[C.jsx("h3",{className:"font-medium text-lg",children:"Comments"}),C.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-gray-600 text-xl",children:""})]}),C.jsx("div",{className:"flex-1 overflow-y-auto px-4",children:S.length===0?C.jsx("p",{className:"text-gray-500 text-sm",children:"No comments yet."}):S.map(re=>C.jsx(EF,{comment:re,onReply:(ae,ce)=>{h(ce),x(ae)}},re.id))}),C.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-2",children:[C.jsx("input",{type:"text",placeholder:c?`Replying to ${c}`:"Write a comment...",value:M,onChange:re=>P(re.target.value),className:"flex-1 border rounded-full px-4 py-2 text-sm focus:outline-none focus:ring focus:border-orange-500"}),C.jsx("button",{onClick:K,className:"bg-orange-500 text-white px-4 py-2 rounded-full text-sm hover:bg-orange-600 transition",children:"Send"})]})]})})},AF=o=>{const r=new Date(o),h=new Date-r,p=Math.floor(h/(1e3*60*60*24));if(p===0){const x=Math.floor(h/36e5);if(x===0){const S=Math.floor(h/6e4);return S<=1?"just now":`${S} minutes ago`}return`${x} hours ago`}else return p===1?"Yesterday":r.toLocaleDateString()},CF=({content:o,type:r})=>{const[c,h]=ye.useState(!1),x=$r()?.user?.id,[S,i]=ye.useState(!1),[M,P]=ye.useState(!1),[N,H]=ye.useState({total_likes:0,total_comments:0});ye.useEffect(()=>{(async()=>{try{const ce=await fetch(`/v1/content/${o.content_id}/engagement`);if(ce.ok){const ve=await ce.json();H({total_likes:ve.total_likes||0,total_comments:ve.total_comments||0})}}catch(ce){console.error("Error fetching engagement:",ce)}})()},[o.content_id]);const W=async()=>{if(x)try{S?(await fetch(`/v1/user/follow?follower_id=${x}&following_id=${o.visitor_id}`,{method:"DELETE"}),i(!1)):(await fetch("/v1/user/follow",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({follower_id:x,following_id:o.visitor_id})}),i(!0))}catch(ae){console.error("Error following/unfollowing:",ae)}},K=async()=>{if(x)try{M?(await fetch(`/v1/content/like?visitor_id=${x}&content_id=${o.content_id}`,{method:"DELETE"}),P(!1)):(await fetch("/v1/content/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:x,content_id:o.content_id})}),P(!0))}catch(ae){console.error("Error liking/unliking content:",ae)}},re=ye.useCallback(async()=>{const ae=typeof window<"u"?`${window.location.origin}/community/${o.content_id}`:"",ce=o.market_name||"Check this out",ve=o.caption||"Have a look at this post";try{navigator.share?await navigator.share({title:ce,text:ve,url:ae}):(await navigator.clipboard.writeText(ae),alert("Link copied to clipboard"))}catch(Se){console.error("Error sharing content:",Se)}},[o.caption,o.content_id,o.market_name]);return ye.useEffect(()=>{if(!x)return;(async()=>{try{const ve=await(await fetch(`/v1/user/follow?follower_id=${x}&following_id=${o.visitor_id}`)).json();i(ve.length>0)}catch(ce){console.error("Error checking follow status:",ce)}})()},[x,o.visitor_id]),ye.useEffect(()=>{if(!x)return;(async()=>{try{const ve=await(await fetch(`/v1/content/like?visitor_id=${x}&content_id=${o.content_id}`)).json();P(ve.length>0)}catch(ce){console.error("Error checking like status:",ce)}})()},[x,o.content_id]),C.jsxs("div",{className:"bg-[var(--white)] shadow-sm hover:shadow-md transition",children:[C.jsxs("div",{className:"flex items-center justify-between px-4 py-3 gap-3",children:[C.jsx("div",{className:"flex items-center gap-3",children:C.jsxs(fo,{to:`/visitor/${o.visitor_id}`,className:"flex items-center gap-3",children:[C.jsx("img",{src:o.visitor_image,alt:o.visitor_username,className:"w-10 h-10 rounded-full object-cover"}),C.jsxs("div",{className:"flex flex-col",children:[C.jsx("span",{className:"font-semibold text-[var(--black)] hover:underline",children:o.visitor_username}),C.jsx("span",{className:"text-xs text-[var(--gray)]",children:AF(o.created_at)})]})]})}),C.jsx("button",{onClick:W,className:`w-30 text-center px-3 py-1 text-sm font-medium rounded-full border transition ${S?"border-[var(--orange)] text-[var(--white)] bg-[var(--orange)] hover:bg-[var(--white)] hover:text-[var(--orange)]":"border-[var(--orange)] text-[var(--orange)] hover:bg-[var(--orange)] hover:text-[var(--white)]"}`,children:S?"Following":"Follow"})]}),r==="Post"&&o.image&&C.jsx("img",{src:o.image,alt:o.title,className:"w-full aspect-square object-cover"}),C.jsxs("div",{className:"px-4 py-3",children:[C.jsx("div",{className:"mb-2 text-sm",children:C.jsx(fo,{to:`/market/${o.market_id}`,className:"font-medium text-[var(--orange)] hover:underline",children:o.market_name})}),C.jsx("p",{className:"text-[var(--black)] text-sm mt-1",children:o.caption}),C.jsxs("div",{className:"mt-2 text-xs text-[var(--gray)] flex gap-4",children:[C.jsxs("span",{children:[N.total_likes," Likes"]}),C.jsxs("span",{children:[N.total_comments," Comments"]})]})]}),C.jsxs("div",{className:"px-4 py-2 border-t border-gray-200 flex justify-around text-[var(--black)] text-sm",children:[C.jsxs("button",{onClick:K,className:"flex items-center gap-1  hover:text-[var(--orange)] transition",children:[M?C.jsx(QC,{className:"text-lg text-red-500"}):C.jsx(lM,{className:"text-lg text-gray-600 hover:text-orange-500"}),"Like"]}),C.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[C.jsx(bS,{className:"text-lg"})," Comment"]}),C.jsxs("button",{onClick:re,className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[C.jsx(dM,{className:"text-lg"})," Share"]})]}),c&&C.jsx(QM,{contentId:o.content_id,onClose:()=>h(!1)})]})},MF=o=>{if(!o)return"";const r=new Date(o),h=new Date-r,p=Math.floor(h/(1e3*60*60*24));if(p===0){const x=Math.floor(h/36e5);if(x===0){const S=Math.floor(h/6e4);return S<=1?"just now":`${S} minutes ago`}return`${x} hours ago`}else return p===1?"Yesterday":r.toLocaleDateString()},PF=({content:o})=>{const c=$r()?.user?.id,[h,p]=ye.useState(!1),[x,S]=ye.useState(!1),[i,M]=ye.useState({total_likes:0,total_comments:0}),P=o?.content_id||o?.id;ye.useEffect(()=>{if(!P)return;(async()=>{try{const Se=await fetch(`/v1/content/${P}/engagement`);if(Se.ok){const Ee=await Se.json();M({total_likes:Ee.total_likes||0,total_comments:Ee.total_comments||0})}}catch(Se){console.error("Error fetching engagement:",Se)}})()},[P]),ye.useEffect(()=>{if(!c||!P)return;(async()=>{try{const Ee=await(await fetch(`/v1/content/like?visitor_id=${c}&content_id=${P}`)).json();S(Array.isArray(Ee)?Ee.length>0:!1)}catch(Se){console.error("Error checking like status:",Se)}})()},[c,P]);const N=async()=>{if(!(!c||!P))try{x?(await fetch(`/v1/content/like?visitor_id=${c}&content_id=${P}`,{method:"DELETE"}),S(!1),M(ve=>({...ve,total_likes:Math.max(0,ve.total_likes-1)}))):(await fetch("/v1/content/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:c,content_id:P})}),S(!0),M(ve=>({...ve,total_likes:ve.total_likes+1})))}catch(ve){console.error("Error liking/unliking content:",ve)}},H=ye.useCallback(async()=>{const ve=typeof window<"u"?`${window.location.origin}/community/${P}`:"",Se=o?.title||"Check this forum",Ee=o?.caption||"Have a look at this forum";try{navigator.share?await navigator.share({title:Se,text:Ee,url:ve}):(await navigator.clipboard.writeText(ve),alert("Link copied to clipboard"))}catch(Qe){console.error("Error sharing content:",Qe)}},[o?.caption,o?.title,P]),W=o?.market_name,K=o?.title||"Forum",re=o?.caption||"",ae=MF(o?.created_at),ce=o?.visitor_username||o?.visitor_name||"";return C.jsxs("div",{className:"bg-[var(--white)] shadow-sm hover:shadow-md transition rounded-lg border border-gray-100",children:[C.jsxs("div",{className:"px-4 py-3 flex items-start justify-between gap-3",children:[C.jsxs("div",{className:"flex flex-col gap-1",children:[W&&C.jsx(fo,{to:`/market/${o?.market_id??""}`,className:"text-xs font-semibold text-[var(--orange)] uppercase tracking-wide hover:underline",children:W}),C.jsx("h3",{className:"text-base font-semibold text-[var(--black)]",children:K})]}),ce&&C.jsxs("div",{className:"text-xs text-[var(--gray)] whitespace-nowrap",children:["Posted by @",ce]})]}),re&&C.jsx("div",{className:"px-4 pb-3 text-sm text-[var(--black)]",children:C.jsx("p",{children:re})}),C.jsxs("div",{className:"px-4 pb-2 text-xs text-[var(--gray)] flex items-center justify-between",children:[C.jsxs("div",{className:"flex gap-4",children:[C.jsxs("span",{children:[i.total_likes," Likes"]}),C.jsxs("span",{children:[i.total_comments," Comments"]})]}),ae&&C.jsx("div",{className:"whitespace-nowrap",children:ae})]}),C.jsxs("div",{className:"px-4 py-2 border-t border-gray-200 flex justify-around text-sm text-[var(--gray)]",children:[C.jsxs("button",{onClick:N,className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[x?C.jsx(QC,{className:"text-lg text-red-500"}):C.jsx(lM,{className:"text-lg"}),"Like"]}),C.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[C.jsx(bS,{className:"text-lg"}),"Comment"]}),C.jsxs("button",{onClick:H,className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[C.jsx(dM,{className:"text-lg"}),"Share"]})]}),h&&C.jsx(QM,{contentId:P,onClose:()=>p(!1)})]})},jF=()=>C.jsxs("div",{className:"bg-[var(--white)] shadow-sm hover:shadow-md transition animate-pulse mb-2",children:[C.jsxs("div",{className:"flex items-center justify-between px-4 py-3 gap-3",children:[C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200"}),C.jsxs("div",{className:"flex flex-col gap-1",children:[C.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded"}),C.jsx("div",{className:"w-16 h-3 bg-gray-200 rounded"})]})]}),C.jsx("div",{className:"w-20 h-6 bg-gray-200 rounded-full"})]}),C.jsx("div",{className:"w-full h-48 bg-gray-200"}),C.jsxs("div",{className:"px-4 py-3 space-y-2",children:[C.jsx("div",{className:"w-32 h-3 bg-gray-200 rounded"}),C.jsx("div",{className:"w-full h-3 bg-gray-200 rounded"}),C.jsx("div",{className:"w-3/4 h-3 bg-gray-200 rounded"}),C.jsxs("div",{className:"mt-2 flex gap-4",children:[C.jsx("div",{className:"w-12 h-3 bg-gray-200 rounded"}),C.jsx("div",{className:"w-16 h-3 bg-gray-200 rounded"})]})]}),C.jsxs("div",{className:"px-4 py-2 border-t border-gray-200 flex justify-around text-gray-600 text-sm",children:[C.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"}),C.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"}),C.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]})]}),zF=()=>{const[o,r]=ye.useState("Explore"),[c,h]=ye.useState("Latest"),[p,x]=ye.useState([]),[S,i]=ye.useState(!0),M=["Explore","Following","Forum"],P=["Latest","Popular","Nearby"],N=$a(),W=$r()?.user?.id,K="/v1",re=()=>{N(o==="Forum"?"/community/add?type=forum":"/community/add?type=post")};return ye.useEffect(()=>{if(!o)return;(async()=>{i(!0);try{let ce="";if(o==="Explore")ce=`${K}/content/post/`;else if(o==="Following"){if(!W){x([]),i(!1);return}ce=`${K}/content/post?visitor_id=${W}`}else if(o==="Forum")ce=`${K}/content/forum/`;else{x([]),i(!1);return}const ve=await fetch(ce);if(!ve.ok)throw new Error("Failed to fetch content");const Se=await ve.json();x(Se)}catch(ce){console.error(ce),x([])}finally{i(!1)}})()},[o,W,K]),console.log(p),C.jsxs("div",{className:"min-h-screen",children:[C.jsx("nav",{className:"bg-[var(--white)] px-6 py-3 flex justify-center space-x-8 sticky top-0 z-50",children:M.map(ae=>C.jsxs("button",{onClick:()=>r(ae),className:"relative text-[var(--black)] font-medium text-sm transition-colors hover:text-[var(--orange)]",children:[ae,C.jsx("span",{className:`absolute left-0 -bottom-1 h-0.5 w-full bg-[var(--orange)] transition-all ${o===ae?"scale-x-100":"scale-x-0"}`,style:{transformOrigin:"left"}})]},ae))}),C.jsxs("div",{className:"bg-[var(--white)] shadow-sm px-6 py-3 flex justify-between items-center",children:[C.jsx("div",{className:"flex items-center gap-2 text-[var(--black)] relative",children:C.jsxs("div",{className:"flex items-center border border-[var(--black)] rounded-md px-2 py-1.5 bg-[var(--white)]",children:[C.jsx(vS,{className:"text-lg mr-1"}),C.jsx("select",{value:c,onChange:ae=>h(ae.target.value),className:"appearance-none bg-transparent outline-none text-sm text-[var(--black)] cursor-pointer",children:P.map(ae=>C.jsx("option",{value:ae,children:ae},ae))})]})}),C.jsxs("button",{onClick:re,className:"flex items-center gap-1 bg-[var(--orange)] hover:bg-[var(--orange)] text-[var(--white)] text-sm font-medium px-3 py-1.5 rounded-full shadow-sm transition",children:[C.jsx(ix,{className:"text-lg"}),o==="Forum"?"New Forum":"New Post"]})]}),C.jsx("div",{className:"space-y-4 pb-20 mt-2 flex flex-col items-center",children:S?Array.from({length:5}).map((ae,ce)=>C.jsx("div",{className:"w-full max-w-xl",children:C.jsx(jF,{})},ce)):p.length===0?C.jsx("div",{className:"p-4 text-[var(--gray)] w-full text-center max-w-xl",children:"No content available."}):p.map(ae=>C.jsx("div",{className:"w-full max-w-xl",children:o==="Forum"?C.jsx(PF,{content:ae}):C.jsx(CF,{content:ae,type:o==="Forum"?"Forum":"Post"})},ae.id))})]})},IF=({onChange:o,role:r})=>{const[c,h]=ye.useState({userType:r,fullName:"",nric:"",businessName:"",businessLicense:""}),p=x=>{const S={...c,[x.target.name]:x.target.value};h(S),o&&o(S)};return C.jsx("div",{className:"flex flex-col items-center font-inter w-full",children:C.jsxs("div",{className:"flex flex-col gap-3 w-[300px]",children:[C.jsxs("div",{className:"w-full",children:[C.jsx("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name (as per NRIC)"}),C.jsx("input",{id:"fullName",type:"text",name:"fullName",value:c.fullName,onChange:p,placeholder:"Enter your full name",className:"w-full h-[40px] border border-gray-300 rounded-xl px-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]",required:!0})]}),C.jsxs("div",{className:"w-full",children:[C.jsx("label",{htmlFor:"nric",className:"block text-sm font-medium text-gray-700 mb-1",children:"National ID (NRIC)"}),C.jsx("input",{id:"nric",type:"text",name:"nric",value:c.nric,onChange:p,placeholder:"e.g. 980101-14-5678",className:"w-full h-[40px] border border-gray-300 rounded-xl px-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]",required:!0})]}),C.jsxs("div",{className:"w-full",children:[C.jsx("label",{htmlFor:"businessName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name"}),C.jsx("input",{id:"businessName",type:"text",name:"businessName",value:c.businessName,onChange:p,placeholder:"Enter your business name",className:"w-full h-[40px] border border-gray-300 rounded-xl px-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]",required:!0})]}),C.jsxs("div",{className:"w-full",children:[C.jsx("label",{htmlFor:"businessLicense",className:"block text-sm font-medium text-gray-700 mb-1",children:"Business License"}),C.jsx("input",{id:"businessLicense",type:"text",name:"businessLicense",value:c.businessLicense,onChange:p,placeholder:"Enter your license number",className:"w-full h-[40px] border border-gray-300 rounded-xl px-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]",required:!0})]})]})})},RF=({onChange:o})=>{const[r,c]=ye.useState({icFront:null,icBack:null,businessLicenseFile:null}),h=S=>{const{name:i,files:M}=S.target,P={...r,[i]:M[0]};c(P),o&&o(P)},p=S=>{const i={...r,[S]:null};c(i),o&&o(i)},x=(S,i,M,P,N)=>C.jsxs("div",{className:`w-full border rounded-xl p-4 flex justify-between items-center transition-all duration-300 ${r[M]?"border-[#FF8225]":"border-gray-200"}`,children:[C.jsxs("div",{className:"flex flex-col text-left",children:[C.jsx("label",{htmlFor:S,className:"text-sm font-medium text-gray-700 mb-1",children:i}),C.jsx("span",{className:"text-xs text-gray-400",children:N})]}),C.jsx("div",{className:"flex items-center justify-center",children:r[M]?C.jsx("button",{onClick:()=>p(M),className:"w-[100px] h-[36px] rounded-lg bg-red-500 text-white text-sm font-medium hover:bg-red-600 transition-all",children:"Remove"}):C.jsxs(C.Fragment,{children:[C.jsx("input",{type:"file",id:S,name:M,accept:P,onChange:h,className:"hidden"}),C.jsx("label",{htmlFor:S,className:"w-[100px] h-[36px] flex items-center justify-center rounded-lg bg-[#FF8225] text-white text-sm font-medium hover:bg-[#e9711c] cursor-pointer transition-all",children:"Add"})]})})]});return C.jsx("div",{className:"flex flex-col items-center font-inter w-full",children:C.jsxs("div",{className:"flex flex-col gap-4 w-[300px]",children:[x("icFront","Upload NRIC (Front)","icFront","image/*","Image only (PNG, JPG)"),x("icBack","Upload NRIC (Back)","icBack","image/*","Image only (PNG, JPG)"),x("businessLicenseFile","Upload Business License","businessLicenseFile",".pdf,image/*","PDF or Image (max 5MB)")]})})},DF=({onChange:o,user_id:r})=>{const[c,h]=ye.useState(null),[p,x]=ye.useState({profilePicture:null,username:"",password:""}),S=P=>{const{files:N}=P.target,H={...p,profilePicture:N[0]};x(H),o&&o(H)},i=()=>{const P={...p,profilePicture:null};x(P),o&&o(P)},M=P=>{const{value:N}=P.target,H={...p,username:N};x(H),o&&o(H)};return ye.useEffect(()=>{if(!r)return;(async()=>{try{const H=await(await fetch(`/v1/visitor/${r}`)).json();h(H);const W={profilePicture:H.image||null,username:H.username||""};x(W),o&&o(W)}catch(N){console.error(" Failed to fetch visitor:",N)}})()},[r]),C.jsx("div",{className:"flex flex-col items-center font-inter w-full",children:C.jsxs("div",{className:"flex flex-col gap-4 w-[300px]",children:[C.jsxs("div",{className:"w-full flex flex-col items-center",children:[C.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-100 mb-6 flex items-center justify-center overflow-hidden",children:p.profilePicture?C.jsx("img",{src:c.image,alt:"Profile",className:"w-full h-full object-cover"}):C.jsx("span",{className:"text-gray-400 text-xs",children:"Preview"})}),C.jsxs("div",{className:`w-full border rounded-xl p-4 flex justify-between items-center transition-all duration-300 ${p.profilePicture?"border-[#FF8225]":"border-gray-200"}`,children:[C.jsxs("div",{className:"flex flex-col text-left",children:[C.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Profile Picture"}),C.jsx("span",{className:"text-xs text-gray-400",children:"Image only (PNG, JPG)"})]}),C.jsx("div",{className:"flex items-center justify-center",children:p.profilePicture?C.jsx("button",{onClick:i,className:"w-[100px] h-[36px] rounded-lg bg-red-500 text-white text-sm font-medium hover:bg-red-600 transition-all",children:"Remove"}):C.jsxs(C.Fragment,{children:[C.jsx("input",{type:"file",accept:"image/*",onChange:S,className:"hidden",id:"profilePicture"}),C.jsx("label",{htmlFor:"profilePicture",className:"w-[100px] h-[36px] flex items-center justify-center rounded-lg bg-[#FF8225] text-white text-sm font-medium hover:bg-[#e9711c] cursor-pointer transition-all",children:"Add"})]})})]})]}),C.jsxs("div",{className:"w-full flex flex-col",children:[C.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Username"}),C.jsx("input",{type:"text",placeholder:"Enter your username",value:p.username,onChange:M,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-[#FF8225]"})]})]})})},HE="/v1",LF=()=>{const{role:o}=cl(),r=$r(!1),c=$a(),[h,p]=ye.useState(1),[x,S]=ye.useState({}),[i,M]=ye.useState({}),[P,N]=ye.useState({}),[H,W]=ye.useState(!1),K=x.fullName?.trim()&&x.nric?.trim()&&x.businessName?.trim()&&x.businessLicense?.trim(),re=i.icFront&&i.icBack&&i.businessLicenseFile,ae=P.username?.trim(),ce=()=>p(Qe=>Math.min(Qe+1,3)),ve=()=>p(Qe=>Math.max(Qe-1,1)),Se=async()=>{if(!r){alert("You must be logged in to register a business.");return}try{W(!0);const Qe={id:r.user.id,name:x.businessName,license:x.businessLicense},He=x.userType?.toLowerCase()==="vendor"?"vendor":"organizer",ke=`${HE}/${He}`,tt=await fetch(ke,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Qe)});if(!tt.ok){const gt=await tt.json().catch(()=>({}));throw new Error(gt.message||"Registration failed")}const Ke=await tt.json();alert(`${He.charAt(0).toUpperCase()+He.slice(1)} registration complete!`);const lt={...x,...i,...P},ft={...lt,user_id:r.user.id,email:r.user.email};if(i.icFront||i.icBack||i.businessLicenseFile){const gt=[{key:"nricFront",file:i.icFront},{key:"nricBack",file:i.icBack},{key:"license",file:i.businessLicenseFile}];for(const ni of gt){if(!ni.file)continue;const Ft=`${He}s/${r.user.id}/${ni.key}.jpg`,{error:Vi}=await bs.storage.from("tamulokal-private").upload(Ft,ni.file,{cacheControl:"3600",upsert:!0,contentType:ni.file.type});if(Vi)throw Vi}}if(P.profilePicture){const gt=Ke.id||Ke[He]?.id||r.user.id,ni=lt.profilePicture,Ft=`visitors/${gt}/${gt}}.jpg`,{data:Vi,error:Ri}=await bs.storage.from("tamulokal").upload(Ft,ni,{cacheControl:"3600",upsert:!0,contentType:ni.type});if(!Ri){const{data:We}=bs.storage.from("tamulokal").getPublicUrl(Ft),Et=We.publicUrl;await fetch(`${HE}/${He}/${gt}/image`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:Et})})}}c("/profile")}catch(Qe){alert("Registration failed: "+Qe.message)}finally{W(!1)}},Ee=[{number:1,title:"Identification"},{number:2,title:"Verification"},{number:3,title:"Finish"}];return C.jsxs("div",{className:"flex flex-col items-center w-full min-h-screen font-inter  md:bg-gray-50",children:[C.jsxs("div",{className:"fixed top-0 w-full flex flex-col items-center pb-2 pt-5 z-20",children:[C.jsxs("h1",{className:"text-base font-semibold text-[var(--black)] mb-4",children:[o=="vendor"?"Vendor ":"Organizer "," Registration"]}),C.jsx("div",{className:"relative flex items-center justify-center w-full max-w-[300px] md:max-w-lg",children:Ee.map((Qe,He)=>C.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center relative",children:[He<Ee.length-1&&C.jsx("div",{className:`absolute top-1/3 left-1/2 right-[-50%] h-[2px] 
                              ${h>Qe.number?"bg-[#FF8225]":"bg-gray-300"} 
                              -translate-y-1/2 transition-all duration-500 z-0`}),C.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center text-xs font-medium transition-all duration-300 z-10
                  ${h===Qe.number?"border-[#FF8225] text-[#FF8225] bg-[var(--white)]":h>Qe.number?"border-[#FF8225] bg-[#FF8225] text-white":"border-gray-300 text-gray-400 bg-[var(--white)]"}`,children:Qe.number}),C.jsx("span",{className:`text-[10px] mt-1 ${h===Qe.number?"text-[#FF8225] font-medium":"text-gray-400"}`,children:Qe.title})]},Qe.number))})]}),C.jsx("div",{className:`\r
          mt-[140px] w-full px-0 flex justify-center\r
        `,children:C.jsxs("div",{className:`\r
          w-full max-w-[340px] md:max-w-xl\r
          md:rounded-2xl md:shadow-sm\r
          md:p-8 md:mt-8 md:mb-4\r
          flex flex-col\r
        `,children:[h===1&&C.jsx(IF,{onChange:S,role:o}),h===2&&C.jsx(RF,{onChange:M}),h===3&&C.jsx(DF,{onChange:N,user_id:r?.user?.id})]})}),C.jsx("div",{className:"fixed bottom-0 w-full flex flex-col items-center pb-5 pt-3 z-20 bg-white md:hidden",children:C.jsx("div",{className:"flex flex-col w-[300px] gap-2",children:h<3?C.jsxs(C.Fragment,{children:[C.jsx("button",{onClick:ce,disabled:h===1&&!K||h===2&&!re,className:`h-[40px] rounded-xl font-medium text-sm w-full transition-colors
                  ${h===1&&!K||h===2&&!re?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#FF8225] text-white hover:bg-[#e6731f]"}`,children:"Next"}),h===1&&C.jsx("button",{onClick:()=>c("/profile"),className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                    font-medium text-sm hover:bg-gray-50 transition-colors w-full`,children:"Cancel"}),h===2&&C.jsx("button",{onClick:ve,className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                    font-medium text-sm hover:bg-gray-50 transition-colors w-full`,children:"Back"})]}):C.jsxs(C.Fragment,{children:[C.jsx("button",{onClick:Se,disabled:H||!ae,className:`h-[40px] rounded-xl font-medium text-sm w-full ${H||!ae?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-[#FF8225] text-white hover:bg-[#e6731f] transition-colors"}`,children:H?"Submitting...":"Finish"}),C.jsx("button",{onClick:ve,className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                  font-medium text-sm hover:bg-gray-50 transition-colors w-full`,children:"Back"})]})})}),C.jsx("div",{className:"hidden md:flex w-full justify-center mt-0 mb-10",children:C.jsx("div",{className:"flex flex-row w-full max-w-xl gap-2",children:h<3?C.jsxs(C.Fragment,{children:[h===1&&C.jsxs(C.Fragment,{children:[C.jsx("button",{onClick:()=>c("/profile"),className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                      font-medium text-sm hover:bg-gray-50 transition-colors w-full max-w-[180px]`,children:"Cancel"}),C.jsx("div",{className:"flex-1"}),C.jsx("button",{onClick:ce,disabled:!K,className:`h-[40px] rounded-xl font-medium text-sm w-full max-w-[180px] transition-colors
                      ${K?"bg-[#FF8225] text-white hover:bg-[#e6731f]":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"})]}),h===2&&C.jsxs(C.Fragment,{children:[C.jsx("button",{onClick:ve,className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                      font-medium text-sm hover:bg-gray-50 transition-colors w-full max-w-[180px]`,children:"Back"}),C.jsx("div",{className:"flex-1"}),C.jsx("button",{onClick:ce,disabled:!re,className:`h-[40px] rounded-xl font-medium text-sm w-full max-w-[180px] transition-colors
                      ${re?"bg-[#FF8225] text-white hover:bg-[#e6731f]":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"})]})]}):C.jsxs(C.Fragment,{children:[C.jsx("button",{onClick:ve,className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                  font-medium text-sm hover:bg-gray-50 transition-colors w-full max-w-[180px]`,children:"Back"}),C.jsx("div",{className:"flex-1"}),C.jsx("button",{onClick:Se,disabled:H||!ae,className:`h-[40px] rounded-xl font-medium text-sm w-full max-w-[180px] ${H||!ae?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-[#FF8225] text-white hover:bg-[#e6731f] transition-colors"}`,children:H?"Submitting...":"Finish"})]})})})]})},OF=()=>{const o=$a(),r=$r(!0),{id:c}=cl();if(!r)return null;const h=c||r.user.id;return C.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[C.jsx("div",{className:"px-4 py-4",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("button",{onClick:()=>o("/profile"),className:"text-gray-700 hover:text-orange-500 transition",children:C.jsx(km,{className:"text-2xl"})}),C.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Manage Products"})]})}),C.jsx("main",{className:"p-4",children:C.jsx(AS,{vendorId:h,isOwnProfile:!0})})]})},GE=({label:o,value:r,onChange:c,disabled:h})=>C.jsxs("div",{children:[C.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:o}),C.jsx("input",{type:"time",value:r||"08:00",onChange:c,className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded",disabled:h})]}),Pv=({sameOperatingHours:o,onToggle:r})=>C.jsxs("div",{className:"flex items-center",children:[C.jsx("span",{className:"text-sm text-gray-600 mr-2",children:"Same hours"}),C.jsx("button",{type:"button",onClick:r,className:`relative inline-flex h-6 w-11 items-center rounded-full ${o?"bg-orange-500":"bg-gray-300"}`,children:C.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full  transition ${o?"translate-x-6":"translate-x-1"}`})})]}),R0=({onClick:o})=>C.jsx("button",{type:"button",onClick:o,className:"text-red-500 text-sm",children:"Remove"}),f1=({onClick:o,label:r})=>C.jsxs("button",{type:"button",onClick:o,className:"text-sm text-orange-600 hover:text-orange-700",children:["+ ",r]}),jv=({title:o,children:r})=>C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("h3",{className:"text-sm font-medium text-gray-700",children:o}),r]}),NF=({market:o=null,organizerId:r,onClose:c,setLoading:h})=>{const p=$a(),x=wy(),S=!!o,[i,M]=ye.useState(!1),[P,N]=ye.useState(!1),[H,W]=ye.useState(null),[K,re]=ye.useState(null),[ae,ce]=ye.useState(""),[ve,Se]=ye.useState(""),[Ee,Qe]=ye.useState(""),[He,ke]=ye.useState(1),[tt,Ke]=ye.useState([]),[lt,ft]=ye.useState(),gt=ye.useRef(null),ni=ye.useRef(null),Ft="/v1",Vi=[{id:1,title:"Daily"},{id:2,title:"Weekly"},{id:3,title:"Monthly"},{id:4,title:"Annually"},{id:5,title:"Once"}],Ri=[{id:7,name:"Sunday"},{id:1,name:"Monday"},{id:2,name:"Tuesday"},{id:3,name:"Wednesday"},{id:4,name:"Thursday"},{id:5,name:"Friday"},{id:6,name:"Saturday"}],We=[{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}],Et=(Qi,Fi)=>He===1?tt.find(nn=>nn.daily_day===Fi)||{}:tt[Qi]||{},jt=Qi=>Ri.find(Fi=>Fi.id===Qi)?.name||"Day",Gi=Qi=>{const Fi={open_time:tt.length>0&&P?tt[0].open_time:"08:00",close_time:tt.length>0&&P?tt[0].close_time:"17:00"};switch(Qi){case"monthly":return{...Fi,monthly_day:tt.length+1};case"annually":return{...Fi,annually_month:1,annually_day:1};case"once":return{...Fi,once_date:new Date().toISOString().split("T")[0]};default:return Fi}},Ce=()=>{if(x&&x.length>0&&x[0]){const Qi={lat:x[0],lng:x[1]};ft(Qi),gt.current&&(gt.current.setView([Qi.lat,Qi.lng],13),ni.current&&ni.current.setLatLng([Qi.lat,Qi.lng]))}};ye.useEffect(()=>{o&&(ce(o.name||""),Se(o.description||""),Qe(o.address||""),ke(o.recurrence_type||o.frequency||1),re(o.image||null),ft({lat:o.latitude||5.975,lng:o.longitude||116.072}),o.id&&_t(o.id))},[o]);const _t=async Qi=>{try{const Fi=await fetch(`${Ft}/market/${Qi}/schedule`);if(Fi.ok){const nn=await Fi.json();if(Ke(nn),nn.length>0){const hn=nn[0],ln=nn.every(xn=>xn.open_time===hn.open_time&&xn.close_time===hn.close_time);N(ln)}}}catch(Fi){console.error("Failed to load schedules:",Fi)}};ye.useEffect(()=>{!lt&&!S&&x&&x.length>0&&x[0]&&ft({lat:x[0],lng:x[1]})},[x,lt,S]),ye.useEffect(()=>{if(!lt||!document.getElementById("map-picker"))return;gt.current&&(gt.current.remove(),gt.current=null,ni.current=null);const Fi=qu.map("map-picker").setView([lt.lat,lt.lng],13);return gt.current=Fi,qu.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(Fi),ni.current=qu.marker([lt.lat,lt.lng]).addTo(Fi),Fi.on("click",nn=>{const{lat:hn,lng:ln}=nn.latlng;ft({lat:hn,lng:ln}),ni.current&&ni.current.setLatLng([hn,ln])}),()=>{gt.current&&(gt.current.remove(),gt.current=null)}},[lt]),ye.useEffect(()=>{gt.current&&setTimeout(()=>{gt.current.invalidateSize(),gt.current.setView([lt.lat,lt.lng],13),ni.current&&ni.current.setLatLng([lt.lat,lt.lng])},100)},[lt]),ye.useEffect(()=>()=>{gt.current&&(gt.current.remove(),gt.current=null)},[]),ye.useEffect(()=>{tt.length===0&&!S&&At()},[He]);const At=()=>{let Qi=[];switch(He){case 1:Qi=Ri.map(hn=>({daily_day:hn.id,open_time:"08:00",close_time:"17:00"}));break;case 2:Qi=Ri.map(hn=>({weekly_day:hn.id,open_time:"08:00",close_time:"17:00",is_active:!0}));break;case 3:Qi=[{monthly_day:1,open_time:"08:00",close_time:"17:00"}];break;case 4:Qi=[{annually_month:1,annually_day:1,open_time:"08:00",close_time:"17:00"}];break;case 5:Qi=[{once_date:new Date().toISOString().split("T")[0],open_time:"08:00",close_time:"17:00"}];break}Ke(Qi)},Ct=Qi=>{const Fi=Qi.target.files[0];Fi&&(W(Fi),re(URL.createObjectURL(Fi)))},oi=(Qi,Fi,nn)=>{const hn=[...tt];hn[Qi]={...hn[Qi],[Fi]:nn},P&&(Fi==="open_time"||Fi==="close_time")&&hn.forEach((ln,xn)=>{xn!==Qi&&(hn[xn]={...ln,[Fi]:nn})}),Ke(hn)},Ci=Qi=>{Ke([...tt,Gi(Qi)])},li=Qi=>{if(tt.length<=1)return;const Fi=[...tt];Fi.splice(Qi,1),Ke(Fi)},Ba=Qi=>{const Fi=tt.findIndex(nn=>nn.weekly_day===Qi);if(Fi>=0){const nn=[...tt];nn.splice(Fi,1),Ke(nn)}else{const nn={weekly_day:Qi,open_time:tt.length>0&&P?tt[0].open_time:"08:00",close_time:tt.length>0&&P?tt[0].close_time:"17:00"};Ke([...tt,nn])}},Un=()=>{const Qi=!P;if(N(Qi),Qi&&tt.length>0){const Fi=tt[0],nn=tt.map(hn=>({...hn,open_time:Fi.open_time||"08:00",close_time:Fi.close_time||"17:00"}));Ke(nn)}},qn=async Qi=>{Qi.preventDefault();try{h(!0);let Fi,nn=null;if(tt.length>0){const ln=[];tt.forEach(xn=>{if(He===5&&xn.once_date)ln.push(new Date(xn.once_date));else if(He===4&&xn.annually_month&&xn.annually_day){const za=new Date;ln.push(new Date(za.getFullYear(),xn.annually_month-1,xn.annually_day))}else if(He===3&&xn.monthly_day){const za=new Date;ln.push(new Date(za.getFullYear(),za.getMonth(),xn.monthly_day))}}),ln.length>0?nn=new Date(Math.min(...ln.map(za=>za.getTime()))).toISOString().split("T")[0]:nn=new Date().toISOString().split("T")[0]}const hn={organizer_id:r,name:ae,description:ve,address:Ee,recurrence_type:parseInt(He,10),latitude:lt.lat,longitude:lt.lng,image:null,start_date:nn};if(S){const ln=await fetch(`${Ft}/market/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(hn)});if(!ln.ok)throw new Error("Failed to update market");Fi=(await ln.json()).id}else{const ln=await fetch(`${Ft}/market`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(hn)});if(!ln.ok)throw new Error("Failed to add market");Fi=(await ln.json()).id}if(H){const ln=await createImageBitmap(H),xn=document.createElement("canvas");xn.width=ln.width,xn.height=ln.height,xn.getContext("2d").drawImage(ln,0,0);const $c=await new Promise(Vr=>xn.toBlob(Vr,"image/jpeg",.9)),Zo=`organizers/${r||o.organizer_id}/${Fi}.jpg`,{error:$s}=await bs.storage.from("tamulokal").upload(Zo,$c,{contentType:"image/jpeg",upsert:!0});if($s)throw $s;const{data:{publicUrl:ws}}=bs.storage.from("tamulokal").getPublicUrl(Zo);if(!(await fetch(`${Ft}/market/${Fi}/image`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:ws})})).ok)throw new Error("Failed to update market image")}await On(Fi),S?c():p(`/business/market/${Fi}/plan`)}catch(Fi){console.error(Fi),alert(S?"Failed to update market":"Failed to add market")}finally{h(!1)}},On=async Qi=>{try{const Fi=tt.map(ln=>{const xn={market_id:Qi,open_time:ln.open_time,close_time:ln.close_time};return He===1&&(xn.daily_day=ln.daily_day),He===2&&(xn.weekly_day=ln.weekly_day),He===3&&(xn.monthly_day=ln.monthly_day),He===4&&(xn.annually_month=ln.annually_month,xn.annually_day=ln.annually_day),He===5&&(xn.once_date=ln.once_date),xn});S&&await fetch(`${Ft}/market/${Qi}/schedule`,{method:"DELETE"});const nn=await fetch(`${Ft}/market/${Qi}/schedule`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schedules:Fi})});if(!nn.ok)throw new Error("Failed to save schedules");const hn=await nn.json();console.log("Schedules saved:",hn)}catch(Fi){throw console.error("Error saving schedules:",Fi),Fi}},Ja=()=>{const Qi=(nn,hn)=>C.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[C.jsx(GE,{label:"Open Time",value:nn.open_time,onChange:ln=>oi(hn,"open_time",ln.target.value),disabled:P&&hn>0}),C.jsx(GE,{label:"Close Time",value:nn.close_time,onChange:ln=>oi(hn,"close_time",ln.target.value),disabled:P&&hn>0})]}),Fi=nn=>P&&nn===0&&C.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Changes here apply to all"});switch(He){case 1:return C.jsxs("div",{className:"space-y-4",children:[C.jsx(jv,{title:"Daily Schedule",children:C.jsx(Pv,{sameOperatingHours:P,onToggle:Un})}),Ri.map((nn,hn)=>{const ln=Et(hn,nn.id);return C.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[C.jsx("div",{className:"flex justify-between items-center mb-2",children:C.jsx("span",{className:"font-medium text-sm",children:nn.name})}),Qi(ln,hn),Fi(hn)]},nn.id)})]});case 2:return C.jsxs("div",{className:"space-y-4",children:[C.jsx(jv,{title:"Weekly Schedule",children:C.jsx(Pv,{sameOperatingHours:P,onToggle:Un})}),C.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:Ri.map(nn=>{const hn=tt.some(ln=>ln.weekly_day===nn.id);return C.jsx("button",{type:"button",onClick:()=>Ba(nn.id),className:`px-3 py-1 rounded-full text-sm border ${hn?"bg-orange-100 border-orange-400 text-orange-700":"bg-gray-100 border-gray-300 text-gray-600"}`,children:nn.name.substring(0,3)},nn.id)})}),tt.sort((nn,hn)=>(nn.weekly_day||0)-(hn.weekly_day||0)).map((nn,hn)=>{const ln=tt.findIndex(xn=>xn.weekly_day===nn.weekly_day);return C.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[C.jsxs("div",{className:"flex justify-between items-center mb-2",children:[C.jsx("span",{className:"font-medium text-sm",children:jt(nn.weekly_day)}),C.jsx(R0,{onClick:()=>li(ln)})]}),Qi(nn,ln),Fi(ln)]},nn.weekly_day||hn)})]});case 3:return C.jsxs("div",{className:"space-y-4",children:[C.jsx(jv,{title:"Monthly Schedule",children:C.jsx(Pv,{sameOperatingHours:P,onToggle:Un})}),tt.map((nn,hn)=>C.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 space-y-3",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("span",{className:"font-medium text-sm",children:["Day ",hn+1]}),tt.length>1&&C.jsx(R0,{onClick:()=>li(hn)})]}),C.jsxs("div",{children:[C.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Day of Month (1-31)"}),C.jsx("input",{type:"number",min:"1",max:"31",value:nn.monthly_day||1,onChange:ln=>oi(hn,"monthly_day",parseInt(ln.target.value)),className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded"})]}),Qi(nn,hn),Fi(hn)]},hn)),C.jsx(f1,{onClick:()=>Ci("monthly"),label:"Add Another Day"})]});case 4:return C.jsxs("div",{className:"space-y-4",children:[C.jsx(jv,{title:"Annually Schedule",children:C.jsx(Pv,{sameOperatingHours:P,onToggle:Un})}),tt.map((nn,hn)=>C.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 space-y-3",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("span",{className:"font-medium text-sm",children:["Date ",hn+1]}),tt.length>1&&C.jsx(R0,{onClick:()=>li(hn)})]}),C.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[C.jsxs("div",{children:[C.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Month"}),C.jsx("select",{value:nn.annually_month||1,onChange:ln=>oi(hn,"annually_month",parseInt(ln.target.value)),className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded ",children:We.map(ln=>C.jsx("option",{value:ln.id,children:ln.name},ln.id))})]}),C.jsxs("div",{children:[C.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Day"}),C.jsx("input",{type:"number",min:"1",max:"31",value:nn.annually_day||1,onChange:ln=>oi(hn,"annually_day",parseInt(ln.target.value)),className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded"})]})]}),Qi(nn,hn),Fi(hn)]},hn)),C.jsx(f1,{onClick:()=>Ci("annually"),label:"Add Another Date"})]});case 5:return C.jsxs("div",{className:"space-y-4",children:[C.jsx(jv,{title:"One-time Market",children:C.jsx(Pv,{sameOperatingHours:P,onToggle:Un})}),tt.map((nn,hn)=>C.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 space-y-3",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("span",{className:"font-medium text-sm",children:["Date ",hn+1]}),tt.length>1&&C.jsx(R0,{onClick:()=>li(hn)})]}),C.jsxs("div",{children:[C.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Date"}),C.jsx("input",{type:"date",value:nn.once_date||new Date().toISOString().split("T")[0],onChange:ln=>oi(hn,"once_date",ln.target.value),className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded"})]}),Qi(nn,hn),Fi(hn)]},hn)),C.jsx(f1,{onClick:()=>Ci("once"),label:"Add Another Date"})]});default:return null}};return C.jsx("div",{className:"py-8 px-2 flex justify-center min-h-screen",children:C.jsxs("form",{onSubmit:qn,className:"w-full max-w-2xl  rounded-2xl p-8 md:shadow-lg md:border md:border-gray-200 space-y-8",style:{minWidth:0},children:[C.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[C.jsx("div",{children:C.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl  w-full aspect-square min-h-[210px] flex flex-col items-center justify-center cursor-pointer hover:border-orange-400 transition",onClick:()=>document.getElementById("marketImage").click(),children:[K?C.jsx("img",{src:K,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}):C.jsx("span",{className:"text-gray-400 text-sm",children:"Click to upload market image"}),C.jsx("input",{type:"file",accept:"image/*",id:"marketImage",className:"hidden",onChange:Ct})]})}),C.jsxs("div",{className:"flex flex-col gap-3 justify-between",children:[C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm text-gray-600 mb-1 font-medium",children:"Market Name"}),C.jsx("input",{type:"text",value:ae,onChange:Qi=>ce(Qi.target.value),placeholder:"Market Name",className:"w-full h-[40px] border border-gray-300 px-3 text-sm  focus:outline-none focus:ring-2 focus:ring-orange-400 rounded mb-2",required:!0})]}),C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm text-gray-600 mb-1 font-medium",children:"Description"}),C.jsx("textarea",{rows:3,value:ve,onChange:Qi=>Se(Qi.target.value),placeholder:"Description",className:"w-full border border-gray-300 rounded-xl px-3 py-2 text-sm  focus:outline-none focus:ring-2 focus:ring-orange-400",required:!0})]}),C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm text-gray-600 mb-1 font-medium",children:"Address"}),C.jsx("input",{type:"text",value:Ee,onChange:Qi=>Qe(Qi.target.value),placeholder:"Address",className:"w-full h-[40px] border border-gray-300 px-3 text-sm  focus:outline-none focus:ring-2 focus:ring-orange-400 rounded",required:!0})]})]})]}),C.jsxs("div",{children:[C.jsxs("div",{className:"mb-4",children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frequency"}),C.jsxs("div",{className:"relative w-full",children:[C.jsxs("button",{type:"button",onClick:()=>M(Qi=>!Qi),className:"w-full h-[42px] border border-gray-300 rounded-xl px-3  text-left text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 flex justify-between items-center shadow-sm",children:[C.jsx("span",{children:Vi[He-1]?.title||"Select frequency"}),C.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:C.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&C.jsx("ul",{className:"relative z-20 mt-1 w-full  border border-gray-200 rounded-xl shadow-xl max-h-56 overflow-auto",children:Vi.map((Qi,Fi)=>C.jsx("li",{onClick:()=>{ke(Qi.id),M(!1),Ke([]),N(!1)},className:"px-4 py-2 text-sm hover:bg-orange-50 cursor-pointer",children:Qi.title},Qi.id||Fi))})]})]}),Ja()]}),C.jsxs("div",{children:[C.jsxs("div",{className:"flex items-center justify-between mb-1",children:[C.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Select Market Location:"}),C.jsx("button",{type:"button",className:"px-2 py-1 bg-orange-500 text-white text-xs rounded hover:bg-orange-600 transition ml-2",onClick:Ce,children:"My Location"})]}),C.jsx("div",{id:"map-picker",className:"w-full h-64 rounded-xl border border-gray-300"}),C.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Selected: ",lt?.lat?.toFixed(5)||"...",",",lt?.lng?.toFixed(5)||"..."]})]}),C.jsx("div",{className:"flex gap-2 mt-6",children:C.jsx("button",{type:"submit",className:"flex-1 py-3 bg-[#FF8225] text-white rounded-md font-medium hover:bg-[#e6731f] transition",children:S?"Save":"Register"})})]})})},m1=()=>{$a();const{id:o}=cl(),r=$r(!0),[c,h]=ye.useState(null),p="/v1",[x,S]=ye.useState(!1);return ye.useEffect(()=>{if(!o)return;(async()=>{try{S(!0);const M=await fetch(`${p}/market/${o}`);if(!M.ok)throw new Error("Failed to fetch market");const P=await M.json();h(P)}catch(M){console.error(M)}finally{S(!1)}})()},[o]),r?x?C.jsx(Qg,{loading:!0}):C.jsxs("div",{className:"relative w-full h-screen",children:[C.jsx(dc,{title:o?"Edit Market":"Register Market"}),C.jsx("main",{children:C.jsx(NF,{organizerId:r.user.id,market:o?c:null,onClose:()=>window.history.back(),setLoading:S})})]}):null},qE=250,FF=({setSubmitting:o})=>{const r=$r(),c=$a(),{markets:h}=xy(),[p,x]=ye.useState(null),[S,i]=ye.useState(""),[M,P]=ye.useState(""),[N,H]=ye.useState(""),[W,K]=ye.useState(!1),[re,ae]=ye.useState(""),ce=Qe=>{const He=Qe.target.files[0];He&&x(URL.createObjectURL(He))},ve=async Qe=>{if(Qe.preventDefault(),!r?.user?.id){alert("User not logged in"),o(!1);return}const He={caption:S,market_id:M,visitor_id:r.user.id,type:1};try{const ke=await fetch("/v1/content?type=post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(He)});if(!ke.ok)throw new Error("Failed to create content");const tt=await ke.json(),Ke=tt?.data?.id||tt?.id;if(!Ke)throw new Error("No content ID returned");o(!0);const ft=document.getElementById("photoUpload").files[0];if(ft){const gt=ft.name.split(".").pop(),ni=`contents/${Ke}.${gt}`,{error:Ft}=await bs.storage.from("tamulokal").upload(ni,ft,{upsert:!0});if(Ft)throw Ft;const{data:Vi}=bs.storage.from("tamulokal").getPublicUrl(ni),Ri=Vi.publicUrl;if(!(await fetch(`/v1/content/${Ke}/image`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:Ri})})).ok)throw new Error("Failed to update image")}c("/community");return}catch(ke){console.error(ke),alert("Something went wrong")}finally{o(!1)}},Se=h.filter(Qe=>Qe.name.toLowerCase().includes(re.toLowerCase())),Ee=Qe=>{P(Qe.id),H(Qe.name),K(!1)};return C.jsxs("div",{className:"w-full flex flex-col relative",children:[C.jsxs("form",{id:"community-post-form",onSubmit:ve,className:"px-6 py-4 space-y-6",children:[C.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[C.jsxs("div",{className:"md:w-1/2",children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photo (preview only)"}),C.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center bg-white w-full aspect-square cursor-pointer hover:border-orange-400 transition",onClick:()=>document.getElementById("photoUpload").click(),children:[p?C.jsx("img",{src:p,alt:"Preview",className:"w-full h-full object-cover rounded-md"}):C.jsxs("div",{className:"flex flex-col items-center text-gray-400",children:[C.jsx(cM,{className:"text-4xl mb-2"}),C.jsx("span",{className:"text-sm",children:"Click to preview image"})]}),C.jsx("input",{id:"photoUpload",type:"file",accept:"image/*",className:"hidden",onChange:ce})]})]}),C.jsxs("div",{className:"md:w-1/2 flex flex-col justify-between",children:[C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Caption"}),C.jsx("textarea",{value:S,onChange:Qe=>i(Qe.target.value),placeholder:"Write something...",rows:"6",className:"w-full border border-gray-300 rounded-md p-3 text-sm bg-white focus:ring-2 focus:ring-orange-400 focus:outline-none"}),C.jsxs("div",{className:`text-right text-xs mt-1 ${S.length>qE?"text-red-500":"text-gray-500"}`,children:[S.length," / ",qE]})]}),C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tag a Market"}),C.jsxs("div",{className:"border border-gray-300 rounded-md p-3 text-sm bg-white cursor-pointer hover:border-orange-400 transition flex justify-between items-center",onClick:()=>K(!0),children:[C.jsx("span",{className:N?"text-gray-900":"text-gray-400",children:N||"Select a market..."}),C.jsx(py,{className:"text-gray-500"})]})]})]})]}),C.jsx("div",{className:"flex justify-end md:hidden",children:C.jsx("button",{type:"submit",className:"px-6 py-3 bg-orange-500 text-white rounded-md font-medium hover:bg-orange-600 transition w-full",children:"Share"})})]}),W&&C.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end",children:[C.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:()=>K(!1)}),C.jsxs("div",{className:"relative bg-white rounded-t-2xl shadow-lg p-5 w-full h-[70vh] animate-slide-up z-10 flex flex-col",style:{animation:"slideUp 0.3s ease-out"},children:[C.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full mx-auto mb-4"}),C.jsxs("div",{className:"flex justify-between items-center mb-4",children:[C.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Select a Market"}),C.jsx("button",{onClick:()=>K(!1),className:"text-gray-500 hover:text-gray-700",children:C.jsx(Od,{className:"text-xl"})})]}),C.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md px-2 mb-3",children:[C.jsx(py,{className:"text-gray-500 text-lg"}),C.jsx("input",{type:"text",value:re,onChange:Qe=>ae(Qe.target.value),placeholder:"Search markets...",className:"flex-1 p-2 outline-none text-sm"})]}),C.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-gray-100",children:Se.length>0?Se.map(Qe=>C.jsx("div",{onClick:()=>Ee(Qe),className:"p-3 text-sm hover:bg-orange-50 cursor-pointer transition",children:Qe.name},Qe.id)):C.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"No markets found"})})]})]})]})},BF=({setSubmitting:o=()=>{}})=>{const{markets:r}=xy(),c=$r(),h=$a(),[p,x]=ye.useState(""),[S,i]=ye.useState(""),[M,P]=ye.useState(""),[N,H]=ye.useState(""),[W,K]=ye.useState(!1),[re,ae]=ye.useState(""),ce=async Ee=>{if(Ee.preventDefault(),o(!0),!c?.user?.id){alert("User not logged in"),o(!1);return}const Qe={title:p,caption:S,market_id:M,visitor_id:c.user.id,type:2};try{if(!(await fetch("/v1/content?type=forum",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Qe)})).ok)throw new Error("Failed to create forum");h("/community")}catch(He){console.error(He),alert("Something went wrong")}finally{o(!1)}},ve=r.filter(Ee=>Ee.name.toLowerCase().includes(re.toLowerCase())),Se=Ee=>{P(Ee.id),H(Ee.name),K(!1)};return C.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col relative",children:[C.jsxs("form",{onSubmit:ce,className:"flex-1 px-6 py-4 space-y-6 pb-28",children:[C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),C.jsx("input",{type:"text",value:p,onChange:Ee=>x(Ee.target.value),placeholder:"Enter forum title...",className:"w-full border border-gray-300 rounded-md p-3 text-sm bg-white focus:ring-2 focus:ring-orange-400 focus:outline-none"})]}),C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),C.jsx("textarea",{value:S,onChange:Ee=>i(Ee.target.value),placeholder:"Write something...",rows:"4",className:"w-full border border-gray-300 rounded-md p-3 text-sm bg-white focus:ring-2 focus:ring-orange-400 focus:outline-none"})]}),C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tag a Market"}),C.jsxs("div",{className:"border border-gray-300 rounded-md p-3 text-sm bg-white cursor-pointer hover:border-orange-400 transition flex justify-between items-center",onClick:()=>K(!0),children:[C.jsx("span",{className:N?"text-gray-900":"text-gray-400",children:N||"Select a market..."}),C.jsx(py,{className:"text-gray-500"})]})]})]}),C.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 px-6 py-4",children:C.jsx("button",{type:"submit",onClick:ce,className:"w-full py-3 bg-orange-500 text-white rounded-md font-medium hover:bg-orange-600 transition",children:"Share"})}),W&&C.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end",children:[C.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:()=>K(!1)}),C.jsxs("div",{className:"relative bg-white rounded-t-2xl shadow-lg p-5 w-full h-[70vh] animate-slide-up z-10 flex flex-col",style:{animation:"slideUp 0.3s ease-out"},children:[C.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full mx-auto mb-4"}),C.jsxs("div",{className:"flex justify-between items-center mb-4",children:[C.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Select a Market"}),C.jsx("button",{onClick:()=>K(!1),className:"text-gray-500 hover:text-gray-700",children:C.jsx(Od,{className:"text-xl"})})]}),C.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md px-2 mb-3",children:[C.jsx(py,{className:"text-gray-500 text-lg"}),C.jsx("input",{type:"text",value:re,onChange:Ee=>ae(Ee.target.value),placeholder:"Search markets...",className:"flex-1 p-2 outline-none text-sm"})]}),C.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-gray-100",children:ve.length>0?ve.map(Ee=>C.jsx("div",{onClick:()=>Se(Ee),className:"p-3 text-sm hover:bg-orange-50 cursor-pointer transition",children:Ee.name},Ee.id)):C.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"No markets found"})})]})]})]})},UF=()=>{const[o,r]=ye.useState(!1),c=Uc(),p=new URLSearchParams(c.search).get("type")||"post",x=p!=="forum";return o?C.jsx(Qg,{loading:!0}):C.jsxs("div",{className:"min-h-screen w-full bg-gray-50 flex flex-col",children:[C.jsx(dc,{title:p==="forum"?"New Forum":"New Post",backPath:"/community"}),C.jsx("main",{className:"flex-1 flex justify-center px-4 py-6",children:C.jsxs("div",{className:"w-full max-w-3xl",children:[C.jsx("div",{className:"p-0 sm:p-6 md:p-8 md:bg-white md:shadow-sm md:rounded-xl md:border md:border-gray-100",children:p==="forum"?C.jsx(BF,{}):C.jsx(FF,{setSubmitting:r})}),x&&C.jsx("div",{className:"hidden md:flex justify-end mt-4",children:C.jsx("button",{type:"submit",form:"community-post-form",className:"px-6 py-3 bg-orange-500 text-white rounded-md font-medium hover:bg-orange-600 transition",children:"Share"})})]})})]})},$F=["Food","Fresh Produce","Handicraft","Fashion","Local Snack"],VF=()=>{const{markets:o,loading:r}=xy(),c=wy(),[h,p]=ye.useState(!1),[x,S]=ye.useState({distance:null,rating:null,openNow:!1,tags:[]}),i=N=>{const H=new Date().getHours(),W=new Date(N.open_time).getHours(),K=new Date(N.close_time).getHours();return W<=K?H>=W&&H<=K:H>=W||H<=K},M=o.filter(N=>!(x.openNow&&!i(N)||x.rating&&N.average_rating<x.rating||x.distance&&N.distance>x.distance||x.tags.length>0&&!x.tags.some(H=>N.tags?.includes(H)))),P=N=>{S(H=>({...H,tags:H.tags.includes(N)?H.tags.filter(W=>W!==N):[...H.tags,N]}))};return r?C.jsx(Qg,{loading:r}):C.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[C.jsx(dc,{title:"Explore Tamu",backPath:"/"}),C.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[C.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-1 px-4 py-2 rounded-xl bg-white shadow-sm hover:shadow-md transition",children:[C.jsx(vS,{size:20,className:"text-gray-700"}),C.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filter"})]}),C.jsx("div",{className:`
                    px-4 py-2 rounded-full text-sm font-medium shadow-sm
                    ${c?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}
                    transition
                `,children:c?"Location enabled":"Location disabled"})]}),C.jsx("div",{className:"px-4",children:C.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[M.map(N=>C.jsx("div",{className:"w-full h-[350px]",children:C.jsx(qM,{market:N,height:350})},N.id)),!r&&M.length===0&&C.jsx("p",{className:"text-gray-600 text-center col-span-full",children:"No markets found with selected filters."})]})}),h&&C.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end justify-center z-50",children:C.jsxs("div",{className:"bg-white w-full max-w-xl rounded-t-2xl p-6 shadow-lg ",children:[C.jsxs("div",{className:"flex justify-between items-center mb-4",children:[C.jsx("button",{onClick:()=>S({distance:null,rating:null,openNow:!1,tags:[]}),className:"text-sm text-gray-500 font-medium",children:"Reset"}),C.jsx("h3",{className:"text-lg font-semibold",children:"Filter"}),C.jsx("button",{onClick:()=>p(!1),className:"text-sm text-[var(--orange)] font-medium",children:"Apply"})]}),C.jsxs("div",{className:"mb-5",children:[C.jsxs("p",{className:"font-medium mb-2",children:["Distance ",x.distance?`( ${x.distance} km )`:"Any"]}),C.jsx("input",{type:"range",min:5,max:20,step:5,value:x.distance||20,onChange:N=>S({...x,distance:Number(N.target.value)}),className:"w-full accent-orange-500"})]}),C.jsxs("div",{className:"mb-5",children:[C.jsxs("p",{className:"font-medium mb-2 flex items-center gap-1",children:["Rating",x.rating?C.jsxs("span",{className:"flex items-center gap-0.5",children:["( ",x.rating," ",C.jsx(Wo,{className:"text-yellow-400"})," )"]}):" Any"]}),C.jsx("input",{type:"range",min:1,max:5,step:1,value:x.rating||1,onChange:N=>S({...x,rating:Number(N.target.value)}),className:"w-full accent-orange-500"})]}),C.jsxs("div",{className:"mb-5 flex items-center justify-between",children:[C.jsx("p",{className:"font-medium mb-0",children:"Open Only"}),C.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[C.jsx("input",{type:"checkbox",checked:x.openNow,onChange:()=>S({...x,openNow:!x.openNow}),className:"sr-only peer"}),C.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-orange-300 rounded-full peer peer-checked:bg-orange-500 transition-colors"}),C.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-md peer-checked:translate-x-5 transition-transform"})]})]}),C.jsxs("div",{className:"mb-5",children:[C.jsx("p",{className:"font-medium mb-2",children:"Tags"}),C.jsx("div",{className:"flex flex-wrap gap-2",children:$F.map(N=>C.jsx("button",{onClick:()=>P(N),className:`px-3 py-1 rounded-full text-xs border ${x.tags.includes(N)?"bg-orange-500 text-white border-orange-500":"bg-white text-gray-700 border-gray-300"}`,children:N},N))})]})]})})]})},HF=({vendor:o})=>{const[r,c]=ye.useState(0),h=(o.product_images||[]).slice(0,3);return ye.useEffect(()=>{if(h.length<=1)return;const p=setInterval(()=>{c(x=>(x+1)%h.length)},3e3);return()=>clearInterval(p)},[h.length]),h.length===0?null:C.jsxs("div",{className:"relative w-full max-w-md aspect-square rounded-xl overflow-hidden shadow-lg border border-gray-200",children:[C.jsx("img",{src:h[r],alt:o.vendor_name,className:"w-full h-full object-cover"}),C.jsxs("div",{className:"absolute bottom-0 left-0 w-full p-3 bg-gradient-to-t from-black/70 via-black/30 to-transparent text-white flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("img",{src:o.vendor_image||"/placeholder.jpg",alt:o.vendor_name,className:"w-10 h-10 rounded-full object-cover border border-gray-200"}),C.jsxs("div",{className:"flex flex-col",children:[C.jsx("h3",{className:"font-semibold text-sm line-clamp-1",children:o.vendor_name}),C.jsxs("div",{className:"flex items-center text-xs gap-1",children:[C.jsx(Wo,{className:"text-yellow-400 text-xs"}),o.avg_rating?.toFixed(1)??"0.0"," (",o.total_reviews,")"]})]})]}),C.jsx(fo,{to:`/vendor/${o.vendor_id}`,className:"text-gray-800 bg-white p-2 rounded-full hover:bg-orange-100 transition",children:C.jsx(eM,{className:"text-base"})})]})]})},GF=[{id:1,name:"Fresh Produce",emoji:""},{id:2,name:"Street Food",emoji:""},{id:3,name:"Snacks & Drinks",emoji:""},{id:4,name:"Clothing",emoji:""},{id:5,name:"Handicrafts",emoji:""},{id:6,name:"Fruits",emoji:""},{id:7,name:"Seafood",emoji:""},{id:8,name:"Performance",emoji:""}],qF=()=>{const{id:o}=cl(),[r,c]=ye.useState([]),[h,p]=ye.useState(!0),x=GF.find(i=>i.id===Number(o)),S="/v1";return ye.useEffect(()=>{if(!o)return;(async()=>{try{p(!0);const M=await fetch(`${S}/category/${o}`);if(!M.ok)throw new Error(`HTTP error: ${M.status}`);const P=await M.json();c(P)}catch(M){console.error("Error fetching vendors:",M)}finally{p(!1)}})()},[o,S]),h?C.jsx(Qg,{loading:h}):C.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[C.jsx(dc,{title:x?`${x.name}`:"Category",backPath:"/"}),r.length===0&&C.jsx("p",{className:"text-center mt-4 text-[var(--gray)]",children:"No vendors found"}),r.length>0&&C.jsx("div",{className:"w-full p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:r.map(i=>C.jsx(HF,{vendor:i},i.vendor_id))})]})},WF="/v1",ZF=({space:o})=>{const[r,c]=ye.useState(o.state!=2),h=async p=>{p.stopPropagation();const x=!r;c(x);try{const S=await fetch(`${WF}/marketspace/${o.id}/state`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:x?1:2})});if(!S.ok)throw new Error(`Failed to update space: ${S.status}`);const i=await S.json();console.log(i)}catch(S){console.error("Error updating space state:",S),c(r),alert("Failed to update space state")}};return C.jsxs("div",{className:"relative rounded-xl overflow-hidden shadow-md hover:shadow-lg transition cursor-pointer h-[208px]",children:[C.jsx("img",{src:o.market_image||"/default-market.png",alt:o.market_name,className:"w-full h-full object-cover"}),C.jsx("div",{className:"absolute inset-0 bg-black/40"}),C.jsx("div",{className:"absolute bottom-2 right-2 flex z-10",children:C.jsx(fo,{to:`/business/marketspace/${o.id}`,onClick:p=>p.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Edit Market",children:C.jsx(tx,{size:20})})}),C.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-2 z-10",children:[C.jsx("button",{onClick:h,className:`relative inline-flex items-center h-8 w-16 rounded-full transition-colors duration-300 focus:outline-none ${r?"bg-green-500":"bg-red-500"}`,children:C.jsx("span",{className:`absolute w-6 h-6 bg-white rounded-full shadow-md transition-transform duration-300 ${r?"translate-x-0 right-1":"translate-x-0 left-1"}`})}),C.jsx("span",{className:"text-white text-sm font-medium select-none",children:r?"Open":"Closed"})]}),C.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:C.jsxs("h3",{className:"text-white font-semibold text-lg drop-shadow text-center px-4 line-clamp-2",children:[o.market_name,C.jsx("br",{}),"( Lot ",o.lot," )"]})})]})},XF="/v1",YF=({vendorId:o})=>{$a();const[r,c]=ye.useState([]),[h,p]=ye.useState(!0);return ye.useEffect(()=>{(async()=>{if(o){p(!0);try{const i=await(await fetch(`${XF}/marketspace?vendor_id=${o}`)).json();c(i)}catch(S){console.error("Error fetching marketspaces:",S),c([])}finally{p(!1)}}})()},[o]),h?C.jsx("div",{className:"flex justify-center py-10 text-gray-500",children:"Loading market spaces..."}):C.jsx("div",{className:"flex flex-col gap-3 pb-12",children:r.map(x=>C.jsx(ZF,{space:x},x.id))})},WE=()=>{const o=$r(!0);$a();const[r,c]=ye.useState(null),[h,p]=ye.useState(!0);return ye.useEffect(()=>{const x=async()=>{try{const S=o.user.id,i=await fetch(`/v1/user/${S}/roles`),M=await i.json();i.ok&&M.roles?M.roles.includes("Vendor")?c("Vendor"):M.roles.includes("Organizer")?c("Organizer"):c("None"):c("None")}catch(S){console.error(S),c("None")}finally{p(!1)}};o?.user&&x()},[o]),!o||!o.user?null:h?C.jsx("div",{className:"text-gray-600 text-center mt-10",children:"Loading..."}):C.jsxs("div",{className:"relative w-full h-screen ",children:[C.jsx(dc,{title:r==="Vendor"?"Market Space":r==="Organizer"?"Market Property":"Business Page"}),C.jsxs("main",{className:"overflow-hidden flex flex-col items-center md:items-start font-inter p-4 max-w-7xl md:mx-auto",children:[r==="Vendor"&&C.jsx(YF,{vendorId:o.user.id}),r==="Organizer"&&C.jsx(JM,{organizerId:o.user.id})]})]})},KF=()=>{const r=$r(!0),{isAdmin:c}=WM(r,"/v1"),[h,p]=ye.useState("market"),[x,S]=ye.useState(null),[i,M]=ye.useState(null),[P,N]=ye.useState({vendors:[],organizers:[]}),[H,W]=ye.useState([]),[K,re]=ye.useState(""),[ae,ce]=ye.useState(!1),[ve,Se]=ye.useState(null),[Ee,Qe]=ye.useState(null),He=async(Ke,lt)=>{if(!lt)return null;const ft=["nricFront.jpg","nricBack.jpg","license.jpg"],gt={};for(const ni of ft){const Ft=`${Ke}/${lt}/${ni}`,{data:Vi,error:Ri}=await bs.storage.from("tamulokal-private").download(Ft);Ri?gt[ni]=null:gt[ni]=URL.createObjectURL(Vi)}return gt};ye.useEffect(()=>{if(!ve)return;(async()=>{const lt=ve.type==="Vendor"?"vendors":"organizers",ft=await He(lt,ve.id);Qe(ft)})()},[ve]),ye.useEffect(()=>{if(h!=="business")return;(async()=>{try{const[lt,ft]=await Promise.all([fetch("/v1/vendor/"),fetch("/v1/organizer/")]),gt=await lt.json(),ni=await ft.json();N({vendors:gt,organizers:ni})}catch{}})()},[h]),ye.useEffect(()=>{if(h!=="market")return;(async()=>{try{const ft=await(await fetch("/v1/market/admin")).json();W(ft)}catch{}})()},[h]);const ke=H.filter(Ke=>Ke.name.toLowerCase().includes(K.toLowerCase())),tt=[...P.vendors.map(Ke=>({...Ke,type:"Vendor"})),...P.organizers.map(Ke=>({...Ke,type:"Organizer"}))].filter(Ke=>Ke.name.toLowerCase().includes(K.toLowerCase()));return c?C.jsxs("div",{className:"min-h-screen flex bg-gray-100",children:[C.jsxs("aside",{className:"hidden lg:flex flex-col w-64 bg-white shadow-md p-4",children:[C.jsx("h1",{className:"text-xl font-semibold mb-6",children:"Admin Dashboard"}),C.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Manage users and markets"}),C.jsxs("button",{onClick:()=>{p("market"),re("")},className:`flex items-center gap-2 py-3 px-4 rounded-lg text-sm font-medium transition ${h==="market"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,children:[C.jsx(Tm,{}),"Markets"]}),C.jsxs("button",{onClick:()=>{p("business"),re("")},className:`flex items-center gap-2 py-3 px-4 mt-2 rounded-lg text-sm font-medium transition ${h==="business"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,children:[C.jsx(nb,{}),"Accounts"]})]}),C.jsxs("div",{className:"flex-1 flex flex-col",children:[C.jsxs("header",{className:"lg:hidden flex items-center justify-between p-4 bg-white shadow-md",children:[C.jsx("h1",{className:"text-lg font-semibold",children:"Admin Dashboard"}),C.jsx("button",{onClick:()=>ce(!ae),className:"p-2 rounded-md hover:bg-gray-100 transition",children:C.jsx(YL,{size:24})})]}),ae&&C.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex lg:hidden",children:C.jsxs("aside",{className:"bg-white w-64 p-4",children:[C.jsx("button",{onClick:()=>ce(!1),className:"mb-4 px-2 py-1 text-sm text-gray-500",children:"Close"}),C.jsxs("button",{onClick:()=>{p("market"),re(""),ce(!1)},className:`flex items-center gap-2 py-3 px-4 rounded-lg text-sm font-medium transition ${h==="market"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,children:[C.jsx(Tm,{}),"Markets"]}),C.jsxs("button",{onClick:()=>{p("business"),re(""),ce(!1)},className:`flex items-center gap-2 py-3 px-4 mt-2 rounded-lg text-sm font-medium transition ${h==="business"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,children:[C.jsx(nb,{}),"Accounts"]})]})}),C.jsx("div",{className:"p-4",children:C.jsx("input",{type:"text",placeholder:h==="market"?"Search market":"Search account",value:K,onChange:Ke=>re(Ke.target.value),className:"w-full px-3 py-2 rounded-xl shadow bg-white text-sm outline-none"})}),C.jsxs("main",{className:"px-4 mb-10 pb-6 flex-1 overflow-y-auto",children:[h==="market"&&C.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-10",children:[ke.map((Ke,lt)=>{let ft={text:"Approved",bg:"bg-green-100",textColor:"text-green-700"};if(Ke.applications&&Ke.applications.length>0){const gt=Ke.applications[0].status;gt===1?ft={text:"Approved",bg:"bg-green-100",textColor:"text-green-700"}:gt===2?ft={text:"Pending",bg:"bg-yellow-100",textColor:"text-yellow-700"}:gt===3&&(ft={text:"Rejected",bg:"bg-red-100",textColor:"text-red-700"})}return C.jsxs("div",{onClick:()=>M(Ke),className:"p-4 bg-white rounded-xl shadow flex justify-between items-center cursor-pointer hover:shadow-lg transition",children:[C.jsxs("div",{className:"flex items-center gap-3",children:[Ke.image?C.jsx("img",{src:Ke.image,alt:Ke.name,className:"w-12 h-12 object-cover rounded-full border-2 border-gray-200"}):C.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-green-100 text-green-600 rounded-full border-2 border-gray-200",children:C.jsx(Tm,{size:20})}),C.jsxs("div",{className:"flex flex-col",children:[C.jsx("p",{className:"font-semibold text-sm",children:Ke.name}),C.jsx("div",{className:"flex gap-2 mt-1",children:C.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${ft.bg} ${ft.textColor}`,children:ft.text})})]})]}),C.jsx(yf,{size:22,className:"text-gray-400"})]},lt)}),C.jsx("div",{className:"fixed bottom-4 left-0 w-full flex justify-center lg:static z-20",children:C.jsx(fo,{to:"/admin/market/add",className:"w-[90%] lg:w-full flex items-center justify-center gap-2 p-4 bg-orange-600 text-white rounded-xl font-medium shadow active:scale-[0.98] transition text-center",children:"Add New Market"})})]}),h==="business"&&C.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:tt.map((Ke,lt)=>C.jsxs("div",{onClick:()=>Se(Ke),className:"p-4 bg-white rounded-xl shadow flex justify-between items-center cursor-pointer hover:shadow-lg transition",children:[C.jsxs("div",{className:"flex items-center gap-3",children:[Ke.image?C.jsx("img",{src:Ke.image,alt:Ke.name,className:"w-12 h-12 object-cover rounded-full border-2 border-gray-200"}):C.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full border-2 border-gray-200",children:C.jsx(nb,{size:20})}),C.jsxs("div",{className:"flex flex-col",children:[C.jsx("p",{className:"font-semibold text-sm",children:Ke.name}),C.jsxs("div",{className:"flex gap-2 mt-1",children:[C.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${Ke.verified?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:Ke.verified?"Verified":"Unverified"}),C.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${Ke.type==="Vendor"?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"}`,children:Ke.type})]})]})]}),C.jsx(yf,{size:22,className:"text-gray-400"})]},lt))})]}),i&&C.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:C.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-4xl relative overflow-y-auto max-h-[90vh]",children:[C.jsx("button",{onClick:()=>M(null),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-800 transition",children:C.jsx(Od,{size:24})}),C.jsxs("div",{className:"flex flex-col lg:flex-row p-4 gap-4",children:[i.image?C.jsx("div",{className:"lg:w-1/3 flex-shrink-0 mx-auto",children:C.jsx("img",{src:i.image,alt:i.name,className:"w-full h-full max-w-[200px] mx-auto object-cover rounded-lg"})}):C.jsx("div",{className:"lg:w-1/3 flex-shrink-0 flex items-center justify-center bg-green-100 text-green-600 rounded-lg border-2 border-gray-200",children:C.jsx(Tm,{size:48})}),C.jsxs("div",{className:"lg:w-2/3 flex flex-col gap-2",children:[C.jsx("p",{className:"text-lg font-semibold",children:i.name}),C.jsx("p",{className:"text-sm text-gray-600",children:i.description}),C.jsxs("p",{className:"text-sm text-gray-600",children:["Address: ",i.address]}),i.applications&&i.applications.length>0&&C.jsx("div",{className:"mt-2",children:(()=>{const Ke=i.applications[0].status;let lt="Approved",ft="bg-green-100",gt="text-green-700";return Ke===2&&(lt="Pending",ft="bg-yellow-100",gt="text-yellow-700"),Ke===3&&(lt="Rejected",ft="bg-red-100",gt="text-red-700"),C.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${ft} ${gt}`,children:lt})})()}),C.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Created on ",new Date(i.created_at).toLocaleDateString()]}),C.jsx("div",{className:"flex gap-2 mt-3",children:i.applications?.[0]?.status===2?C.jsxs(C.Fragment,{children:[C.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/market/${i.market_id}/verify?status=1`,{method:"PUT"})).ok)throw new Error("Failed to approve market");M(ft=>({...ft,applications:[{...ft.applications[0],status:1}]})),W(ft=>ft.map(gt=>gt.market_id===i.market_id?{...gt,applications:[{...gt.applications[0],status:1}]}:gt))}catch{}},className:"flex-1 p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:"Approve"}),C.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/market/${i.market_id}/verify?status=3`,{method:"PUT"})).ok)throw new Error("Failed to reject market");M(ft=>({...ft,applications:[{...ft.applications[0],status:3}]})),W(ft=>ft.map(gt=>gt.market_id===i.market_id?{...gt,applications:[{...gt.applications[0],status:3}]}:gt))}catch{}},className:"flex-1 p-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Reject"})]}):C.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/market/${i.market_id}`,{method:"DELETE"})).ok)throw new Error("Failed to remove market");W(ft=>ft.filter(gt=>gt.market_id!==i.market_id)),M(null)}catch{}},className:"flex-1 p-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition",children:"Remove"})})]})]})]})}),ve&&C.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:C.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-4xl relative overflow-y-auto max-h-[90vh]",children:[C.jsx("button",{onClick:()=>{Se(null),Qe(null)},className:"absolute top-3 right-3 text-gray-500 hover:text-gray-800 transition",children:C.jsx(Od,{size:24})}),C.jsxs("div",{className:"flex flex-col lg:flex-row p-4",children:[ve.image&&C.jsx("div",{className:"lg:w-1/3 flex-shrink-0 mx-auto",children:C.jsx("img",{src:ve.image,alt:ve.name,className:"w-full h-full max-w-[200px] mx-auto object-cover rounded-lg"})}),C.jsxs("div",{className:"lg:w-2/3 flex flex-col gap-2",children:[C.jsx("p",{className:"text-lg font-semibold",children:ve.name}),C.jsxs("p",{className:"text-sm text-gray-600",children:["License: ",ve.license]}),Ee?C.jsxs("div",{className:"flex",children:[Ee["nricFront.jpg"]&&C.jsx("img",{src:Ee["nricFront.jpg"],alt:"NRIC Front",className:"w-1/3 object-cover aspect-square cursor-pointer",onClick:()=>S(Ee["nricFront.jpg"])}),Ee["nricBack.jpg"]&&C.jsx("img",{src:Ee["nricBack.jpg"],alt:"NRIC Back",className:"w-1/3 object-cover aspect-square cursor-pointer",onClick:()=>S(Ee["nricBack.jpg"])}),Ee["license.jpg"]&&C.jsx("img",{src:Ee["license.jpg"],alt:"License",className:"w-1/3 object-cover aspect-square cursor-pointer",onClick:()=>S(Ee["license.jpg"])})]}):C.jsx("p",{className:"text-gray-400 text-sm",children:"Loading private images..."}),C.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Joined on ",new Date(ve.created_at).toLocaleDateString()]}),C.jsxs("div",{className:"flex gap-2 mt-3",children:[!ve.verified&&C.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/${ve.type.toLowerCase()}/${ve.id}/verify?verified=true`,{method:"PUT"})).ok)throw new Error("Failed to verify account");Se(lt=>({...lt,verified:!0})),N(lt=>{const ft=lt.vendors.map(gt=>gt.id===ve.id?{...gt,verified:!0}:gt);return{...lt,vendors:ft}})}catch{}},className:"flex-1 p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:"Approve"}),ve.verified&&C.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/${ve.type.toLowerCase()}/${ve.id}`,{method:"DELETE"})).ok)throw new Error("Failed to remove account");N(lt=>({vendors:lt.vendors.filter(ft=>ft.id!==ve.id),organizers:lt.organizers.filter(ft=>ft.id!==ve.id)})),Se(null),Qe(null)}catch{}},className:"flex-1 p-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Remove"})]})]})]})]})}),x&&C.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",onClick:()=>S(null),children:C.jsx("img",{src:x,alt:"Selected",className:"max-h-[90vh] max-w-full object-contain rounded shadow-lg"})})]})]}):C.jsx("div",{children:"You do not have access to this page"})},D0=43200,ZE=1440,XE=Symbol.for("constructDateFrom");function CS(o,r){return typeof o=="function"?o(r):o&&typeof o=="object"&&XE in o?o[XE](r):o instanceof Date?new o.constructor(r):new Date(r)}function Vp(o,r){return CS(o,o)}let JF={};function QF(){return JF}function YE(o){const r=Vp(o),c=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return c.setUTCFullYear(r.getFullYear()),+o-+c}function MS(o,...r){const c=CS.bind(null,o||r.find(h=>typeof h=="object"));return r.map(c)}function ab(o,r){const c=+Vp(o)-+Vp(r);return c<0?-1:c>0?1:c}function eB(o){return CS(o,Date.now())}function tB(o,r,c){const[h,p]=MS(c?.in,o,r),x=h.getFullYear()-p.getFullYear(),S=h.getMonth()-p.getMonth();return x*12+S}function iB(o){return r=>{const h=(o?Math[o]:Math.trunc)(r);return h===0?0:h}}function nB(o,r){return+Vp(o)-+Vp(r)}function aB(o,r){const c=Vp(o);return c.setHours(23,59,59,999),c}function rB(o,r){const c=Vp(o),h=c.getMonth();return c.setFullYear(c.getFullYear(),h+1,0),c.setHours(23,59,59,999),c}function sB(o,r){const c=Vp(o);return+aB(c)==+rB(c)}function oB(o,r,c){const[h,p,x]=MS(c?.in,o,o,r),S=ab(p,x),i=Math.abs(tB(p,x));if(i<1)return 0;p.getMonth()===1&&p.getDate()>27&&p.setDate(30),p.setMonth(p.getMonth()-S*i);let M=ab(p,x)===-S;sB(h)&&i===1&&ab(h,x)===1&&(M=!1);const P=S*(i-+M);return P===0?0:P}function lB(o,r,c){const h=nB(o,r)/1e3;return iB(c?.roundingMethod)(h)}const cB={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},uB=(o,r,c)=>{let h;const p=cB[o];return typeof p=="string"?h=p:r===1?h=p.one:h=p.other.replace("{{count}}",r.toString()),c?.addSuffix?c.comparison&&c.comparison>0?"in "+h:h+" ago":h};function p1(o){return(r={})=>{const c=r.width?String(r.width):o.defaultWidth;return o.formats[c]||o.formats[o.defaultWidth]}}const dB={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},hB={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},fB={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},mB={date:p1({formats:dB,defaultWidth:"full"}),time:p1({formats:hB,defaultWidth:"full"}),dateTime:p1({formats:fB,defaultWidth:"full"})},pB={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},gB=(o,r,c,h)=>pB[o];function zv(o){return(r,c)=>{const h=c?.context?String(c.context):"standalone";let p;if(h==="formatting"&&o.formattingValues){const S=o.defaultFormattingWidth||o.defaultWidth,i=c?.width?String(c.width):S;p=o.formattingValues[i]||o.formattingValues[S]}else{const S=o.defaultWidth,i=c?.width?String(c.width):o.defaultWidth;p=o.values[i]||o.values[S]}const x=o.argumentCallback?o.argumentCallback(r):r;return p[x]}}const _B={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},yB={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},vB={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},xB={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},bB={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},wB={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},SB=(o,r)=>{const c=Number(o),h=c%100;if(h>20||h<10)switch(h%10){case 1:return c+"st";case 2:return c+"nd";case 3:return c+"rd"}return c+"th"},TB={ordinalNumber:SB,era:zv({values:_B,defaultWidth:"wide"}),quarter:zv({values:yB,defaultWidth:"wide",argumentCallback:o=>o-1}),month:zv({values:vB,defaultWidth:"wide"}),day:zv({values:xB,defaultWidth:"wide"}),dayPeriod:zv({values:bB,defaultWidth:"wide",formattingValues:wB,defaultFormattingWidth:"wide"})};function Iv(o){return(r,c={})=>{const h=c.width,p=h&&o.matchPatterns[h]||o.matchPatterns[o.defaultMatchWidth],x=r.match(p);if(!x)return null;const S=x[0],i=h&&o.parsePatterns[h]||o.parsePatterns[o.defaultParseWidth],M=Array.isArray(i)?EB(i,H=>H.test(S)):kB(i,H=>H.test(S));let P;P=o.valueCallback?o.valueCallback(M):M,P=c.valueCallback?c.valueCallback(P):P;const N=r.slice(S.length);return{value:P,rest:N}}}function kB(o,r){for(const c in o)if(Object.prototype.hasOwnProperty.call(o,c)&&r(o[c]))return c}function EB(o,r){for(let c=0;c<o.length;c++)if(r(o[c]))return c}function AB(o){return(r,c={})=>{const h=r.match(o.matchPattern);if(!h)return null;const p=h[0],x=r.match(o.parsePattern);if(!x)return null;let S=o.valueCallback?o.valueCallback(x[0]):x[0];S=c.valueCallback?c.valueCallback(S):S;const i=r.slice(p.length);return{value:S,rest:i}}}const CB=/^(\d+)(th|st|nd|rd)?/i,MB=/\d+/i,PB={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},jB={any:[/^b/i,/^(a|c)/i]},zB={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},IB={any:[/1/i,/2/i,/3/i,/4/i]},RB={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},DB={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},LB={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},OB={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},NB={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},FB={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},BB={ordinalNumber:AB({matchPattern:CB,parsePattern:MB,valueCallback:o=>parseInt(o,10)}),era:Iv({matchPatterns:PB,defaultMatchWidth:"wide",parsePatterns:jB,defaultParseWidth:"any"}),quarter:Iv({matchPatterns:zB,defaultMatchWidth:"wide",parsePatterns:IB,defaultParseWidth:"any",valueCallback:o=>o+1}),month:Iv({matchPatterns:RB,defaultMatchWidth:"wide",parsePatterns:DB,defaultParseWidth:"any"}),day:Iv({matchPatterns:LB,defaultMatchWidth:"wide",parsePatterns:OB,defaultParseWidth:"any"}),dayPeriod:Iv({matchPatterns:NB,defaultMatchWidth:"any",parsePatterns:FB,defaultParseWidth:"any"})},UB={code:"en-US",formatDistance:uB,formatLong:mB,formatRelative:gB,localize:TB,match:BB,options:{weekStartsOn:0,firstWeekContainsDate:1}};function $B(o,r,c){const h=QF(),p=c?.locale??h.locale??UB,x=2520,S=ab(o,r);if(isNaN(S))throw new RangeError("Invalid time value");const i=Object.assign({},c,{addSuffix:c?.addSuffix,comparison:S}),[M,P]=MS(c?.in,...S>0?[r,o]:[o,r]),N=lB(P,M),H=(YE(P)-YE(M))/1e3,W=Math.round((N-H)/60);let K;if(W<2)return c?.includeSeconds?N<5?p.formatDistance("lessThanXSeconds",5,i):N<10?p.formatDistance("lessThanXSeconds",10,i):N<20?p.formatDistance("lessThanXSeconds",20,i):N<40?p.formatDistance("halfAMinute",0,i):N<60?p.formatDistance("lessThanXMinutes",1,i):p.formatDistance("xMinutes",1,i):W===0?p.formatDistance("lessThanXMinutes",1,i):p.formatDistance("xMinutes",W,i);if(W<45)return p.formatDistance("xMinutes",W,i);if(W<90)return p.formatDistance("aboutXHours",1,i);if(W<ZE){const re=Math.round(W/60);return p.formatDistance("aboutXHours",re,i)}else{if(W<x)return p.formatDistance("xDays",1,i);if(W<D0){const re=Math.round(W/ZE);return p.formatDistance("xDays",re,i)}else if(W<D0*2)return K=Math.round(W/D0),p.formatDistance("aboutXMonths",K,i)}if(K=oB(P,M),K<12){const re=Math.round(W/D0);return p.formatDistance("xMonths",re,i)}else{const re=K%12,ae=Math.trunc(K/12);return re<3?p.formatDistance("aboutXYears",ae,i):re<9?p.formatDistance("overXYears",ae,i):p.formatDistance("almostXYears",ae+1,i)}}function VB(o,r){return $B(o,eB(o),r)}const g1=({notif:o})=>{const r=$a(),c=new Date(o.created_at+"Z");console.log(o);const h=async()=>{if(!o.is_read)try{await fetch(`/v1/notification/${o.id}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_read:!0})}),o.is_read=!0}catch(p){console.error("Failed to mark notification as read:",p)}o.market_id&&r(`/market/${o.market_id}`),o.event_id==1&&r("/market/history")};return C.jsxs("div",{className:`w-full py-3 min-h-[60px] flex flex-col justify-center border-b border-gray-200 ${o.market_id?"cursor-pointer hover:bg-gray-50 transition":""} ${o.is_read?"opacity-60":"bg-[var(--white)]"}`,onClick:h,children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("p",{className:"font-medium text-gray-800",children:o.message}),!o.is_read&&C.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full flex-shrink-0"})]}),C.jsx("p",{className:"text-xs text-gray-500 mt-1",children:VB(c,{addSuffix:!0})})]})},HB=()=>{const r=$r()?.user,c=$a(),[h,p]=ye.useState([]),[x,S]=ye.useState(!0);ye.useEffect(()=>{if(!r?.id)return;(async()=>{try{const N=await(await fetch(`/v1/notification?user_id=${r.id}`)).json();p(N)}catch(P){console.error("Failed to fetch notifications:",P)}finally{S(!1)}})()},[r]);const i=ye.useMemo(()=>{const M=[],P=[],N=[],H=new Date,W=H.toDateString(),K=new Date(H);K.setDate(H.getDate()-1);const re=K.toDateString();return h.forEach(ae=>{const ce=new Date(ae.created_at+"Z").toDateString();ce===W?M.push(ae):ce===re?P.push(ae):N.push(ae)}),{today:M,yesterday:P,older:N}},[h]);return C.jsxs("div",{className:"relative h-screen overflow-hidden bg-[#FFFDFA] flex flex-col items-center font-inter p-4",children:[C.jsx("div",{className:"max-w-xl w-full",children:C.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[C.jsx("button",{onClick:()=>c("/profile"),className:"text-gray-700 hover:text-orange-500 transition",children:C.jsx(km,{className:"text-2xl"})}),C.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Notifications"})]})}),C.jsx("div",{className:"max-w-xl w-full space-y-6 overflow-y-auto pb-10",children:x?C.jsx("p",{className:"text-gray-500",children:"Loading notifications..."}):h.length===0?C.jsx("p",{className:"text-gray-500",children:"No notifications yet."}):C.jsxs(C.Fragment,{children:[i.today.length>0&&C.jsxs("div",{children:[C.jsx("h2",{className:"text-[var(--black)] font-semibold mb-2",children:"Today"}),i.today.map(M=>C.jsx(g1,{notif:M},M.id))]}),i.yesterday.length>0&&C.jsxs("div",{children:[C.jsx("h2",{className:"text-[var(--black)] font-semibold mb-2",children:"Yesterday"}),i.yesterday.map(M=>C.jsx(g1,{notif:M},M.id))]}),i.older.length>0&&C.jsxs("div",{children:[C.jsx("h2",{className:"text-[var(--black)] font-semibold mb-2",children:"Older"}),i.older.map(M=>C.jsx(g1,{notif:M},M.id))]})]})})]})},Cp=40,KE=.3,JE=2.5;function GB(){const o=$a(),{id:r}=cl(),c=ye.useRef(null),h=ye.useRef(null),p="/v1",[x,S]=ye.useState("add"),[i,M]=ye.useState([]),[P,N]=ye.useState(null),[H,W]=ye.useState({x:0,y:0,zoom:1}),[K,re]=ye.useState(!1),[ae,ce]=ye.useState(null),[ve,Se]=ye.useState(null),Ee=Ce=>Math.floor(Ce/Cp)*Cp,Qe=(Ce,_t)=>{const At=c.current.getBoundingClientRect();return{x:(Ce-At.left)/H.zoom+H.x,y:(_t-At.top)/H.zoom+H.y}},He=Ce=>{const _t=c.current.getBoundingClientRect();return{x:(Ce.clientX-_t.left)/H.zoom+H.x,y:(Ce.clientY-_t.top)/H.zoom+H.y}},ke=(Ce,_t)=>`${Ce},${_t}`;ye.useEffect(()=>{const Ce=c.current,_t=Ce.getContext("2d"),At=()=>{Ce.width=Ce.clientWidth,Ce.height=Ce.clientHeight,gt(_t)};return At(),window.addEventListener("resize",At),()=>window.removeEventListener("resize",At)},[H,i,ve,P]);const tt=Ce=>{const{width:_t,height:At}=Ce.canvas,Ct=Cp*H.zoom;Ce.strokeStyle="#e5e7eb",Ce.lineWidth=1;const oi=-H.x*H.zoom%Ct,Ci=-H.y*H.zoom%Ct;for(let li=oi;li<_t;li+=Ct)Ce.beginPath(),Ce.moveTo(li,0),Ce.lineTo(li,At),Ce.stroke();for(let li=Ci;li<At;li+=Ct)Ce.beginPath(),Ce.moveTo(0,li),Ce.lineTo(_t,li),Ce.stroke()},Ke=Ce=>{i.forEach((_t,At)=>{const Ct=(_t.x-H.x)*H.zoom,oi=(_t.y-H.y)*H.zoom,Ci=Cp*H.zoom;Ce.fillStyle="#4ade80",Ce.strokeStyle="#166534",Ce.fillRect(Ct,oi,Ci,Ci),Ce.strokeRect(Ct,oi,Ci,Ci),Ce.fillStyle="#064e3b",Ce.font=`${12*H.zoom}px sans-serif`,Ce.textAlign="center",Ce.textBaseline="middle";const li=String(i.length).length,Ba=String(At+1).padStart(li,"0");Ce.fillText(Ba,Ct+Ci/2,oi+Ci/2)})},lt=Ce=>{P&&(Ce.fillStyle="#f97316",Ce.fillRect((P.x-H.x)*H.zoom,(P.y-H.y)*H.zoom,Cp*H.zoom,Cp*H.zoom))},ft=Ce=>{ve&&(Ce.fillStyle="rgba(59,130,246,0.4)",Ce.fillRect((ve.x-H.x)*H.zoom,(ve.y-H.y)*H.zoom,Cp*H.zoom,Cp*H.zoom))},gt=Ce=>{Ce.clearRect(0,0,Ce.canvas.width,Ce.canvas.height),tt(Ce),Ke(Ce),lt(Ce),ft(Ce)},ni=(Ce,_t)=>{const At=Ee(Ce),Ct=Ee(_t),oi=ke(At,Ct);x==="add"&&M(Ci=>Ci.some(li=>ke(li.x,li.y)===oi)?Ci:[...Ci,{x:At,y:Ct}]),x==="delete"&&(M(Ci=>Ci.filter(li=>ke(li.x,li.y)!==oi)),P&&ke(P.x,P.y)===oi&&N(null)),x==="start"&&N({x:At,y:Ct}),Se({x:At,y:Ct})},Ft=Ce=>{if(Ce.button===1){re(!0),ce({x:Ce.clientX,y:Ce.clientY,cam:{...H}});return}const{x:_t,y:At}=Qe(Ce.clientX,Ce.clientY);ni(_t,At)},Vi=Ce=>{if(K&&ae){const Ct=(Ce.clientX-ae.x)/H.zoom,oi=(Ce.clientY-ae.y)/H.zoom;W({...H,x:ae.cam.x-Ct,y:ae.cam.y-oi});return}if(!ve)return;const{x:_t,y:At}=Qe(Ce.clientX,Ce.clientY);ni(_t,At)},Ri=()=>Se(null),We=Ce=>{Ce.preventDefault();const _t=Ce.deltaY<0?1.1:.9;W(At=>({...At,zoom:Math.min(JE,Math.max(KE,At.zoom*_t))}))},Et=Ce=>{if(Ce.preventDefault(),Ce.touches.length===1){const{x:_t,y:At}=He(Ce.touches[0]);ni(_t,At)}if(Ce.touches.length===2){const _t=Ce.touches[0].clientX-Ce.touches[1].clientX,At=Ce.touches[0].clientY-Ce.touches[1].clientY;h.current=Math.hypot(_t,At),ce({x:(Ce.touches[0].clientX+Ce.touches[1].clientX)/2,y:(Ce.touches[0].clientY+Ce.touches[1].clientY)/2,cam:{...H}}),re(!0)}},jt=Ce=>{if(Ce.preventDefault(),Ce.touches.length===1&&ve){const{x:_t,y:At}=He(Ce.touches[0]);ni(_t,At)}if(Ce.touches.length===2&&ae){const _t=(Ce.touches[0].clientX+Ce.touches[1].clientX)/2,At=(Ce.touches[0].clientY+Ce.touches[1].clientY)/2,Ct=(_t-ae.x)/H.zoom,oi=(At-ae.y)/H.zoom,Ci=Ce.touches[0].clientX-Ce.touches[1].clientX,li=Ce.touches[0].clientY-Ce.touches[1].clientY,Ba=Math.hypot(Ci,li);let Un=H.zoom;h.current&&(Un=Math.min(JE,Math.max(KE,Un*(Ba/h.current)))),h.current=Ba,W({x:ae.cam.x-Ct,y:ae.cam.y-oi,zoom:Un})}},Gi=()=>{Se(null),re(!1),h.current=null};return C.jsx("div",{className:"w-full h-full relative bg-gray-100 flex",children:C.jsxs("div",{className:"flex-1 relative",children:[C.jsx("canvas",{ref:c,className:"w-full h-full cursor-crosshair touch-none",onMouseDown:Ft,onMouseMove:Vi,onMouseUp:Ri,onWheel:We,onTouchStart:Et,onTouchMove:jt,onTouchEnd:Gi}),C.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-white shadow-lg rounded-full px-4 py-2 flex items-center gap-4 z-50",children:[C.jsx("button",{onClick:()=>S("add"),className:`w-12 h-12 rounded-full flex items-center justify-center text-xl
                ${x==="add"?"bg-green-400 text-white":"bg-gray-100"}`,children:C.jsx(ix,{})}),C.jsx("button",{onClick:()=>S("start"),className:`w-12 h-12 rounded-full flex items-center justify-center text-xl
                ${x==="start"?"bg-orange-400 text-white":"bg-gray-100"}`,children:C.jsx($L,{})}),C.jsx("button",{onClick:()=>S("delete"),className:`w-12 h-12 rounded-full flex items-center justify-center text-xl
                ${x==="delete"?"bg-red-400 text-white":"bg-gray-100"}`,children:C.jsx(tO,{})}),C.jsx("button",{onClick:async()=>{if(i.length===0){alert("No stalls to save!");return}const Ce=prompt("Enter fee for one lot:","0");if(!Ce)return;const _t=String(i.length).length,At=i.map((Ct,oi)=>({lot:String(oi+1).padStart(_t,"0"),fee:Ce,market_id:r,x_floor_plan:Ct.x,y_floor_plan:Ct.y}));try{const Ct=await fetch(`${p}/market/${r}/space`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(At)});if(Ct.ok)console.log("All stalls saved successfully!"),alert("All stalls saved successfully!"),o(`/business/market/${r}/space`);else{const oi=await Ct.text();console.error("Failed to save stalls:",oi),alert("Failed to save stalls. Check console for details.")}}catch(Ct){console.error("Error saving stalls:",Ct),alert("Error saving stalls. Check console for details.")}},className:"w-12 h-12 rounded-full flex items-center justify-center text-xl bg-blue-500 text-white",children:C.jsx(BL,{})})]}),C.jsxs("div",{className:"absolute top-3 left-3 bg-white shadow rounded px-3 py-2 text-sm",children:[C.jsxs("div",{children:[" Stalls: ",i.length]}),C.jsxs("div",{children:[" Start: ",P?"Set":"None"]})]})]})})}function qB(){const o=$a();return C.jsxs("div",{className:"w-screen h-screen flex flex-col",children:[C.jsx("div",{className:"px-4 py-4",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("button",{onClick:()=>o("/"),className:"text-gray-700 hover:text-orange-500 transition",children:C.jsx(km,{className:"text-2xl"})}),C.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Market Floor Plan"})]})}),C.jsx("main",{className:"flex-1 overflow-hidden",children:C.jsx(GB,{})})]})}function WB({marketId:o,stalls:r,isVendor:c=!1,session:h,onSelectStall:p}){const x=ye.useRef({x:0,y:0,zoom:1}),S=ye.useRef(null),i=ye.useRef({x:0,y:0}),M=ye.useRef(!1),P=ye.useRef(null),[N,H]=ye.useState(null),W=40,K=1,[re,ae]=ye.useState({x:0,y:0,zoom:1}),[ce,ve]=ye.useState({left:!1,right:!1,top:!1,bottom:!1}),[Se,Ee]=ye.useState({width:0,height:0}),Qe=We=>{if(!r||!r.length)return;let Et=Math.min(...r.map(Ct=>Ct.x)),jt=Math.min(...r.map(Ct=>Ct.y)),Gi=Math.max(...r.map(Ct=>Ct.x))+W,Ce=Math.max(...r.map(Ct=>Ct.y))+W;const _t=K*W,At={x:Et-(We.canvas.width-(Gi-Et+_t*2))/2,y:jt-(We.canvas.height-(Ce-jt+_t*2))/2,zoom:1};ae(At),x.current=At},He=(We,Et)=>{ae(jt=>({...jt,x:jt.x-We/jt.zoom,y:jt.y-Et/jt.zoom}))},ke=(We,Et,jt)=>{if(!S.current)return;const Gi=S.current.getBoundingClientRect(),Ce=Et-Gi.left,_t=jt-Gi.top,At=Ce/re.zoom+re.x,Ct=_t/re.zoom+re.y,oi=Math.max(.5,Math.min(3,re.zoom*We)),Ci=At-Ce/oi,li=Ct-_t/oi;ae({x:Ci,y:li,zoom:oi})},tt=We=>{We.preventDefault();const Et=We.deltaY<0?1.1:.9;ke(Et,We.clientX,We.clientY)},Ke=We=>{We.button===0&&(i.current={x:We.clientX,y:We.clientY},M.current=!0,We.preventDefault())},lt=We=>{if(M.current){const Et=We.clientX-i.current.x,jt=We.clientY-i.current.y;He(Et,jt),i.current={x:We.clientX,y:We.clientY}}},ft=()=>{M.current=!1},gt=We=>{if(We.touches.length===1){const Et=We.touches[0];i.current={x:Et.clientX,y:Et.clientY},M.current=!0,P.current=null}else if(We.touches.length===2){const Et=We.touches[0],jt=We.touches[1],Gi=Et.clientX-jt.clientX,Ce=Et.clientY-jt.clientY;P.current=Math.sqrt(Gi*Gi+Ce*Ce),i.current={x:(Et.clientX+jt.clientX)/2,y:(Et.clientY+jt.clientY)/2},M.current=!1}},ni=We=>{if(We.touches.length===1&&M.current){const Et=We.touches[0],jt=Et.clientX-i.current.x,Gi=Et.clientY-i.current.y;He(jt,Gi),i.current={x:Et.clientX,y:Et.clientY}}else if(We.touches.length===2&&P.current){const Et=We.touches[0],jt=We.touches[1],Gi=Et.clientX-jt.clientX,Ce=Et.clientY-jt.clientY,_t=Math.sqrt(Gi*Gi+Ce*Ce),At=_t/P.current,Ct=(Et.clientX+jt.clientX)/2,oi=(Et.clientY+jt.clientY)/2;ke(At,Ct,oi),P.current=_t,i.current={x:Ct,y:oi}}},Ft=()=>{M.current=!1,P.current=null},Vi=We=>{if(M.current||!S.current||!r||!r.length){M.current=!1;return}const Et=S.current.getBoundingClientRect(),jt=We.clientX-Et.left,Gi=We.clientY-Et.top,Ce=jt/re.zoom+re.x,_t=Gi/re.zoom+re.y,At=r.find(Ct=>Ce>=Ct.x&&Ce<=Ct.x+W&&_t>=Ct.y&&_t<=Ct.y+W);H(At||null)},Ri=We=>{if(We.clearRect(0,0,We.canvas.width,We.canvas.height),!r||!r.length)return;let Et=Math.min(...r.map(At=>At.x)),jt=Math.min(...r.map(At=>At.y)),Gi=Math.max(...r.map(At=>At.x))+W,Ce=Math.max(...r.map(At=>At.y))+W;const _t=K*W;We.strokeStyle="#FFFDFA",We.lineWidth=1;for(let At=Et-_t;At<=Gi+_t;At+=W)We.beginPath(),We.moveTo((At-re.x)*re.zoom,(jt-_t-re.y)*re.zoom),We.lineTo((At-re.x)*re.zoom,(Ce+_t-re.y)*re.zoom),We.stroke();for(let At=jt-_t;At<=Ce+_t;At+=W)We.beginPath(),We.moveTo((Et-_t-re.x)*re.zoom,(At-re.y)*re.zoom),We.lineTo((Gi+_t-re.x)*re.zoom,(At-re.y)*re.zoom),We.stroke();r.forEach(At=>{const Ct=(At.x-re.x)*re.zoom,oi=(At.y-re.y)*re.zoom,Ci=W*re.zoom;let li="#4ade80";const Ba=c&&At.pending_applications?.some(qn=>qn.vendor_id===h?.user?.id);let Un="#026700";N&&N.id===At.id&&At.pending_applications==0?li="#22c55e":At.status==="Occupied"?li="#FF8225":(At.pending_applications.length>0||Ba)&&(li="#60a5fa"),We.fillStyle=li,We.strokeStyle=Un,We.lineWidth=N&&N.id===At.id?3:1,We.fillRect(Ct,oi,Ci,Ci),We.strokeRect(Ct,oi,Ci,Ci),We.fillStyle="#171A1D",We.font=`${Math.max(8,12*re.zoom)}px sans-serif`,We.textAlign="center",We.textBaseline="middle",We.fillText(At.lot,Ct+Ci/2,oi+Ci/2)})};return ye.useEffect(()=>{const We=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=We}},[]),ye.useEffect(()=>{const We=S.current;if(!We)return;const Et=We.getContext("2d"),jt=We.parentElement;if(!jt)return;const Gi=()=>{const{clientWidth:_t,clientHeight:At}=jt;(We.width!==_t||We.height!==At)&&(We.width=_t,We.height=At,Ee({width:_t,height:At}),r&&r.length&&Qe(Et))},Ce=new ResizeObserver(Gi);return Ce.observe(jt),Gi(),()=>Ce.disconnect()},[r]),ye.useEffect(()=>{if(!S.current||!r||!r.length)return;const We=S.current.getContext("2d");Ri(We);const Et=S.current,jt=re.x,Gi=re.x+Et.width/re.zoom,Ce=re.y,_t=re.y+Et.height/re.zoom,At=Math.min(...r.map(li=>li.x))-K*W,Ct=Math.min(...r.map(li=>li.y))-K*W,oi=Math.max(...r.map(li=>li.x+W))+K*W,Ci=Math.max(...r.map(li=>li.y+W))+K*W;ve({left:At<jt-W/2,right:oi>Gi+W/2,top:Ct<Ce-W/2,bottom:Ci>_t+W/2})},[re,r,Se,N]),ye.useEffect(()=>{const We=S.current;if(We)return We.addEventListener("mousedown",Ke),window.addEventListener("mousemove",lt),window.addEventListener("mouseup",ft),We.addEventListener("wheel",tt,{passive:!1}),We.addEventListener("touchstart",gt,{passive:!1}),We.addEventListener("touchmove",ni,{passive:!1}),We.addEventListener("touchend",Ft),We.addEventListener("click",Vi),()=>{We.removeEventListener("mousedown",Ke),window.removeEventListener("mousemove",lt),window.removeEventListener("mouseup",ft),We.removeEventListener("wheel",tt),We.removeEventListener("touchstart",gt),We.removeEventListener("touchmove",ni),We.removeEventListener("touchend",Ft),We.removeEventListener("click",Vi)}},[re,r,N]),!r||!r.length?C.jsx("div",{children:"No stalls found"}):(console.log(N),C.jsxs("div",{className:"relative w-full h-full flex",children:[C.jsx("canvas",{ref:S,className:"w-full h-full cursor-move rounded-lg",style:{touchAction:"none"}}),ce.left&&C.jsx(TL,{className:"absolute left-6 top-1/2 transform -translate-y-1/2 text-gray-500 text-3xl z-10"}),ce.right&&C.jsx(kL,{className:"absolute right-6 top-1/2 transform -translate-y-1/2 text-gray-500 text-3xl z-10"}),ce.top&&C.jsx(EL,{className:"absolute top-6 left-1/2 transform -translate-x-1/2 text-gray-500 text-3xl z-10"}),ce.bottom&&C.jsx(SL,{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 text-gray-500 text-3xl z-10"}),N&&C.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30 z-0",onClick:()=>H(null)}),N&&C.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10",children:C.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 w-80 overflow-hidden",children:[C.jsxs("div",{className:"px-5 py-4 border-b border-gray-100 flex justify-between items-center",children:[C.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Lot ",N.lot]}),C.jsx("button",{onClick:()=>H(null),className:"text-gray-400 hover:text-gray-600 text-xl",children:""})]}),C.jsxs("div",{className:"px-5 py-4 space-y-4",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsx("span",{className:"text-sm text-gray-500",children:"Status"}),C.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium
                    ${N.status==="Available"&&"bg-green-100 text-green-700"}
                    ${N.status==="Occupied"&&"bg-yellow-100 text-yellow-700"}
                    ${N.status==="Reserved"&&"bg-blue-100 text-blue-700"}
                    ${N.status==="Maintenance"&&"bg-red-100 text-red-700"}
                  `,children:N.status})]}),C.jsx("div",{className:"flex items-center justify-between",children:N.status==="Occupied"?C.jsx(C.Fragment,{children:C.jsxs("div",{className:"flex items-center space-x-3",children:[C.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden flex items-center justify-center",children:N.vendor_image?C.jsx("img",{src:N.vendor_image,alt:N.vendor_name,className:"w-full h-full object-cover"}):C.jsx("span",{className:"text-sm text-gray-400",children:"N/A"})}),C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-gray-500",children:"Vendor"}),C.jsx("p",{className:"text-sm font-medium text-gray-800",children:N.vendor_name||"Unknown Vendor"})]})]})}):c?C.jsxs(C.Fragment,{children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-gray-500",children:"Rent"}),C.jsxs("p",{className:"text-sm font-medium text-gray-800",children:["RM ",N.fee]})]}),N.pending_applications?.some(We=>We.vendor_id===h?.user?.id)?C.jsx("span",{className:"text-gray-400 font-medium text-sm",children:"Applied"}):C.jsx(fo,{to:`/business/marketspace/${N.id}/apply`,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",onClick:We=>We.stopPropagation(),children:"Apply"})]}):C.jsxs(C.Fragment,{children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-gray-500",children:"Application"}),C.jsx("p",{className:"text-sm font-medium text-gray-800",children:N.pending_applications?.length>0?N.pending_applications.length:"None"})]}),C.jsx("button",{className:"text-blue-600 hover:text-blue-700 font-medium text-sm",onClick:()=>{H(N),p&&p(N)},children:"View"})]})})]})]})}),C.jsxs("div",{className:"fixed bottom-4 left-4 flex items-center space-x-3 bg-white rounded bg-opacity-80 px-3 py-2 z-20",children:[C.jsx("button",{onClick:()=>ae(x.current),className:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600",children:"Reset"}),C.jsxs("span",{className:"text-gray-700 font-medium",children:[Math.round(re.zoom*100),"%"]})]})]}))}const ZB=({application:o})=>{const[r,c]=ye.useState(null),[h,p]=ye.useState(!0),x="/v1";return ye.useEffect(()=>{if(!o?.vendor_id)return;(async()=>{try{p(!0);const i=await fetch(`${x}/vendor/${o.vendor_id}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error("Failed to fetch vendor");const M=await i.json();c(M)}catch(i){console.error(i),c(null)}finally{p(!1)}})()},[o?.vendor_id]),console.log(r),C.jsxs("div",{className:"border rounded p-3 flex justify-between items-center",children:[C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden flex items-center justify-center",children:r?.image?C.jsx("img",{src:r.image,alt:r?.fullname,className:"w-full h-full object-cover"}):C.jsx("span",{className:"text-xs text-gray-400",children:"N/A"})}),C.jsx("div",{children:h?C.jsx("p",{className:"text-sm text-gray-400",children:"Loading vendor..."}):C.jsxs(C.Fragment,{children:[C.jsx("p",{className:"text-sm font-medium",children:r?.fullname||"Unknown Vendor"}),C.jsxs("p",{className:"text-xs text-gray-500",children:["Applied on"," ",o?.submitted_at?new Date(o.submitted_at).toLocaleDateString():"-"]})]})})]}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("button",{className:"p-2 rounded bg-red-100 text-red-700 hover:bg-red-200 transition",title:"Reject",children:C.jsx(Od,{className:"text-lg"})}),C.jsx("button",{className:"p-2 rounded bg-green-100 text-green-700 hover:bg-green-200 transition",title:"Accept",children:C.jsx(iM,{className:"text-lg"})})]})]})},XB=()=>{const o=$r(!0),[r,c]=ye.useState(!1),[h,p]=ye.useState(null),[x,S]=ye.useState("grid"),[i,M]=ye.useState("lot"),[P,N]=ye.useState(""),{id:H}=cl();$a();const[W,K]=ye.useState(!1),[re,ae]=ye.useState([]),[ce,ve]=ye.useState(!0),[Se,Ee]=ye.useState(null),Qe="/v1",{isVendor:He}=WM(o,Qe),ke=async()=>{if(!H){Ee("Market ID is required"),ve(!1);return}try{ve(!0),Ee(null);const Ke=await fetch(`${Qe}/market/${H}/space`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!Ke.ok)throw new Error(`Failed to fetch stalls: ${Ke.status} ${Ke.statusText}`);const ft=(await Ke.json()).map((gt,ni)=>({x:gt.x_floor_plan||0,y:gt.y_floor_plan||0,lot:gt.lot,id:gt.id||gt.stall_id||ni+1,name:gt.name||gt.stall_name||`Stall ${ni+1}`,status:gt.vendor_id==null?"Available":"Occupied",...gt}));ae(ft)}catch(Ke){Ee(Ke.message||"Failed to load stall data"),ae([])}finally{ve(!1)}};if(ye.useEffect(()=>{ke()},[H]),ce)return C.jsx(Qg,{loading:ce});if(Se)return C.jsxs("div",{children:["Error: ",Se]});console.log(re);const tt=re.filter(Ke=>{const lt=P.toLowerCase();return Ke.vendor_name?.toLowerCase().includes(lt)||String(Ke.lot).includes(lt)}).sort((Ke,lt)=>i==="lot"?Ke.lot-lt.lot:i==="status"?Ke.status===lt.status?0:Ke.status==="Occupied"?-1:1:0);return console.log(h),C.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[C.jsx(dc,{title:"Market Space"}),C.jsx("main",{className:`flex-1 flex ${W?"overflow-hidden":"overflow-auto"}`,children:W?C.jsx(WB,{marketId:H,stalls:re,isVendor:He,session:o,onSelectStall:Ke=>{p(Ke),c(!0)}}):C.jsxs("div",{className:"w-full h-full p-4 overflow-auto",children:[C.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3 mb-4 w-full",children:[C.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("button",{onClick:()=>S("grid"),className:`p-2 rounded ${x==="grid"?"bg-orange-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:C.jsx(my,{className:"text-lg"})}),C.jsx("button",{onClick:()=>S("list"),className:`p-2 rounded ${x==="list"?"bg-orange-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:C.jsx(rE,{className:"text-lg"})})]}),C.jsx("div",{className:"flex items-center gap-2 ml-auto md:ml-0",children:C.jsxs("select",{value:i,onChange:Ke=>M(Ke.target.value),className:"border rounded px-3 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-orange-500",children:[C.jsx("option",{value:"lot",children:"Lot Number"}),C.jsx("option",{value:"status",children:"Occupied First"})]})})]}),C.jsx("input",{type:"text",value:P,onChange:Ke=>N(Ke.target.value),placeholder:"Search vendor or lot...",className:"w-full md:w-64 md:ml-auto border rounded px-3 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-orange-500"})]}),C.jsx("div",{className:x==="grid"?"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-4 items-stretch":"flex flex-col gap-4",children:tt.map(Ke=>{const lt=Ke.pending_applications?.some(ft=>ft.vendor_id===o?.user?.id);return C.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border h-full min-h-[100px] flex flex-col",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("h3",{className:"font-medium",children:["Lot ",Ke.lot]}),C.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${Ke.status==="Available"?"bg-green-100 text-green-700":Ke.status==="Occupied"?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"}`,children:Ke.status})]}),C.jsx("div",{className:"mt-2 flex-1 flex flex-col justify-between",children:Ke.status==="Occupied"?C.jsx("div",{className:"flex items-center justify-between",children:C.jsx("div",{className:"flex items-center space-x-3",children:C.jsxs(fo,{to:`/vendor/${Ke.vendor_id}`,onClick:ft=>ft.stopPropagation(),className:"flex items-center space-x-3 hover:opacity-80 transition",children:[C.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden flex items-center justify-center",children:Ke.vendor_image?C.jsx("img",{src:Ke.vendor_image,alt:Ke.vendor_name,className:"w-full h-full object-cover"}):C.jsx("span",{className:"text-sm text-gray-400",children:"N/A"})}),C.jsx("p",{className:"text-sm font-medium text-gray-800",children:Ke.vendor_name||"Unknown Vendor"})]})})}):C.jsx("div",{className:"flex items-center justify-between",children:He?C.jsxs(C.Fragment,{children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-gray-500",children:"Rent"}),C.jsxs("p",{className:"text-sm font-medium text-gray-800",children:["RM ",Ke.fee]})]}),lt?C.jsx("span",{className:"text-gray-400 font-medium text-sm cursor-not-allowed",children:"Applied"}):C.jsx(fo,{to:`/business/marketspace/${Ke.id}/apply`,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",onClick:ft=>ft.stopPropagation(),children:"Apply"})]}):C.jsxs(C.Fragment,{children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-gray-500",children:"Application"}),C.jsx("p",{className:"text-sm font-medium text-gray-800",children:Ke.pending_applications.length>0?`${Ke.pending_applications.length}`:"None"})]}),C.jsx(fo,{to:`/market/${H}/space/${Ke.id}/applications`,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",onClick:ft=>{ft.preventDefault(),ft.stopPropagation(),p(Ke),c(!0)},children:"View"})]})})})]},Ke.id)})})]})}),C.jsx("div",{className:"fixed bottom-4 right-4 flex items-center space-x-3 bg-orange-500 bg-opacity-80 px-3 py-2 rounded-full z-20",children:C.jsxs("button",{onClick:()=>K(Ke=>!Ke),className:"flex items-center gap-2 bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600 transition",children:[W?C.jsx(rE,{className:"text-lg"}):C.jsx(my,{className:"text-lg"}),C.jsx("span",{children:W?"List":"Plan View"})]})}),r&&C.jsx("div",{className:"fixed inset-0 z-50 px-4 flex items-center justify-center bg-black/40",onClick:()=>c(!1),children:C.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg h-[70vh] p-5 shadow-lg flex flex-col",onClick:Ke=>Ke.stopPropagation(),children:[C.jsxs("div",{className:"flex justify-between items-center mb-4",children:[C.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Applications  Lot ",h?.lot]}),C.jsx("button",{onClick:()=>c(!1),className:"text-gray-500 hover:text-gray-700",children:""})]}),h?.pending_applications?.length>0?C.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:h.pending_applications.map(Ke=>C.jsx(ZB,{application:Ke},Ke.id))}):C.jsx("p",{className:"text-sm text-gray-500",children:"No applications found."})]})})]})},YB=[{id:1,name:"Fresh Produce",emoji:""},{id:2,name:"Street Food",emoji:""},{id:3,name:"Snacks & Drinks",emoji:""},{id:4,name:"Clothing",emoji:""},{id:5,name:"Handicrafts",emoji:""},{id:6,name:"Fruits",emoji:""},{id:7,name:"Seafood",emoji:""},{id:8,name:"Performance",emoji:""}],KB=({product:o=null,category:r=null,vendorId:c,onClose:h})=>{const p=!!o,[x,S]=ye.useState(null),[i,M]=ye.useState(null),[P,N]=ye.useState(""),[H,W]=ye.useState(""),[K,re]=ye.useState(""),[ae,ce]=ye.useState([]),[ve,Se]=ye.useState(null),[Ee,Qe]=ye.useState([]),He="/v1";ye.useEffect(()=>{o&&r&&(N(o.name||""),W(o.price||""),re(o.quantity||""),M(o.image||null),Array.isArray(r)&&Qe(r.map(ft=>ft.category_id)),o.categories&&Qe(o.categories))},[o,r]),ye.useEffect(()=>{(async()=>{try{const gt=await fetch(`${He}/product/qtype`);if(!gt.ok)throw new Error("Failed to fetch quantity types");const ni=await gt.json()||[];if(ce(ni),o){const Ft=ni.find(Vi=>Vi.id===o.quantity_type);Se(Ft||ni[0]||null)}else Se(ni[0]||null)}catch(gt){console.error(gt)}})()},[He,o]);const ke=ft=>{const gt=ft.target.files[0];gt&&(S(gt),M(URL.createObjectURL(gt)))},tt=ft=>{Ee.includes(ft)?Qe(Ee.filter(gt=>gt!==ft)):Ee.length<3&&Qe([...Ee,ft])},Ke=async()=>{if(!(!p||!o?.id)&&window.confirm("Are you sure you want to delete this product?"))try{if(!(await fetch(`${He}/product/${o.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete product");if(o.image)try{const gt=o.image,ni="tamulokal/",Ft=gt.indexOf(ni);if(Ft!==-1){const Vi=gt.substring(Ft+ni.length),{error:Ri}=await bs.storage.from("tamulokal").remove([Vi]);Ri&&console.warn("Failed to delete image from storage:",Ri)}else console.warn("Could not extract file path from image URL:",gt)}catch(gt){console.warn("Error deleting image from storage:",gt)}alert("Product deleted!"),h()}catch(ft){console.error(ft),alert("Failed to delete product")}},lt=async ft=>{if(ft.preventDefault(),!ve){alert("Please select a quantity type");return}if(Ee.length===0){alert("Please select at least 1 category");return}try{let gt;if(p){const ni=await fetch(`${He}/product/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:P,price:parseFloat(H),quantity:parseFloat(K),quantity_type:ve.id,categories:Ee})});if(!ni.ok)throw new Error("Failed to update product");gt=(await ni.json()).id}else{const ni=await fetch(`${He}/product`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vendor_id:c,name:P,price:parseFloat(H),quantity:parseFloat(K),quantity_type:ve.id,categories:Ee})});if(!ni.ok)throw new Error("Failed to add product");gt=(await ni.json()).id}if(x){const ni=x.name.split(".").pop(),Ft=`vendors/${c}/${gt}.${ni}`,{error:Vi}=await bs.storage.from("tamulokal").upload(Ft,x,{upsert:!0});if(Vi)throw Vi;const{data:{publicUrl:Ri}}=bs.storage.from("tamulokal").getPublicUrl(Ft);if(!(await fetch(`${He}/product/${gt}/image`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:Ri})})).ok)throw new Error("Failed to update product image")}alert(p?"Product updated!":"Product added!"),h()}catch(gt){console.error(gt),alert(p?"Failed to update product":"Failed to add product")}};return C.jsx("div",{className:"min-h-screen w-full flex flex-col font-inter",children:C.jsx("form",{onSubmit:lt,className:"flex-1 w-full px-4 md:px-8 py-6",children:C.jsxs("div",{className:"w-full max-w-5xl mx-auto space-y-6",children:[C.jsxs("div",{className:"flex flex-col md:flex-row md:gap-8 md:items-stretch",children:[C.jsx("div",{className:"w-full md:w-1/4 md:flex md:flex-col",children:C.jsxs("div",{className:"relative border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center bg-white w-full aspect-square cursor-pointer hover:border-orange-400 transition",onClick:()=>document.getElementById("productImage").click(),children:[i?C.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover rounded-md"}):C.jsx("div",{className:"flex flex-col items-center text-gray-400",children:C.jsx(cM,{className:"text-4xl mb-2"})}),C.jsx("input",{id:"productImage",type:"file",accept:"image/*",className:"hidden",onChange:ke})]})}),C.jsx("div",{className:"w-full md:w-3/4 mt-6 md:mt-0 md:flex md:flex-col md:self-stretch",children:C.jsxs("div",{className:"flex flex-col gap-2 p-0 md:p-6 md:bg-white md:border md:border-gray-200 md:rounded-lg md:shadow-sm md:h-full",children:[C.jsx("label",{htmlFor:"productName",className:"text-sm font-medium text-gray-700",children:"Product Name"}),C.jsx("input",{type:"text",value:P,onChange:ft=>N(ft.target.value),placeholder:"Product Name",className:"w-full h-[42px] border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 bg-white rounded-md",required:!0}),C.jsx("label",{htmlFor:"productPrice",className:"text-sm font-medium text-gray-700",children:"Price"}),C.jsx("input",{type:"number",value:H,onChange:ft=>W(ft.target.value),placeholder:"Price",className:"w-full h-[42px] border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 bg-white rounded-md",required:!0}),C.jsx("label",{htmlFor:"productQuantity",className:"text-sm font-medium text-gray-700",children:"Quantity"}),C.jsxs("div",{className:"flex gap-2",children:[C.jsx("input",{type:"number",value:K,onChange:ft=>re(ft.target.value),placeholder:"Quantity",className:"flex-1 h-[42px] border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 bg-white rounded-md",required:!0}),C.jsx("select",{value:ve?.id||"",onChange:ft=>{const gt=ae.find(ni=>ni.id===parseInt(ft.target.value));Se(gt)},className:"w-[120px] h-[42px] border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 bg-white rounded-md",required:!0,children:ae.map(ft=>C.jsx("option",{value:ft.id,children:ft.title},ft.id))})]}),C.jsx("label",{className:"text-sm font-medium text-gray-700 mt-4 mb-1",children:"Category (pick up to 3)"}),C.jsx("div",{className:"flex flex-wrap gap-2",children:YB.map(ft=>C.jsxs("button",{type:"button",className:"px-3 py-1.5 rounded-full text-sm border flex items-center gap-1 transition "+(Ee.includes(ft.id)?"bg-orange-100 border-orange-500 text-orange-700 font-semibold":"bg-white border-gray-200 text-gray-800 hover:border-orange-400"),style:{opacity:!Ee.includes(ft.id)&&Ee.length>=3?.6:1,pointerEvents:!Ee.includes(ft.id)&&Ee.length>=3?"none":"auto"},onClick:()=>tt(ft.id),children:[C.jsx("span",{children:ft.emoji}),ft.name]},ft.id))}),Ee.length===0&&C.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Pick at least 1 category."})]})})]}),C.jsxs("div",{className:"flex flex-col md:flex-row md:justify-end gap-3",children:[p&&C.jsx("button",{type:"button",onClick:Ke,className:"w-full md:w-auto px-5 py-2.5 text-sm font-medium text-red-600 border border-red-200 rounded-md hover:bg-red-50 transition",children:"Delete"}),C.jsx("button",{type:"submit",className:"w-full md:w-auto px-6 py-2.5 bg-[#FF8225] text-white rounded-md font-medium hover:bg-[#e6731f] transition",children:p?"Save":"Create"})]})]})})})},QE=()=>{$a();const{id:o}=cl(),r=$r(!0),[c,h]=ye.useState(null),[p,x]=ye.useState(null),S="/v1";return ye.useEffect(()=>{if(!o)return;(async()=>{try{const M=await fetch(`${S}/product/${o}`);if(!M.ok)throw new Error("Failed to fetch product");const P=await M.json();h(P.product),x(P.categories)}catch(M){console.error(M)}})()},[o]),console.log(c),r?C.jsxs("div",{className:"w-screen h-screen",children:[C.jsx(dc,{title:o?"Edit Product":"Add Product",backPath:"/business/product"}),C.jsx("main",{className:"overflow-hidden flex flex-col items-center font-inter p-4",children:C.jsx(KB,{vendorId:r.user.id,product:o?c:null,category:o?p:null,onClose:()=>window.history.back()})})]}):null},JB=()=>{$a();const o=$r(!0),{id:r}=cl();if(!o)return null;const c=o.user.id;return C.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[C.jsx(dc,{title:"Manage Product"}),C.jsx("main",{className:"p-4 md:mx-auto",children:C.jsx(AS,{vendorId:c,isOwnProfile:!1,showAvailabilityToggle:!0})})]})},QB="/v1",e4=({isVendor:o=!0})=>{$a();const[r,c]=ye.useState([]);return ye.useEffect(()=>{(async()=>{try{const p=await fetch(`${QB}/marketspace/available`);if(!p.ok)throw new Error("Failed to fetch available marketspace");const x=await p.json();c(x),console.log("Available marketspace:",x)}catch(p){console.error("Error fetching available marketspace:",p)}})()},[]),C.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[C.jsx(dc,{title:"Market Space"}),C.jsx("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 md:mx-auto",children:r.map(h=>C.jsx(KM,{market:h,isVendor:o},h.market_id))})]})},t4=({vendor:o,space:r})=>{if(!o||!r)return null;const c=["icFront","icBack","businessLicenseFile"],h=K=>c.includes(K),[p,x]=ye.useState({}),[S,i]=ye.useState({icFront:null,icBack:null,businessLicenseFile:null,permitLicenseFile:null}),M=async(K,re)=>{const{data:ae,error:ce}=await bs.storage.from("tamulokal-private").download(K);return ce||!ae?null:new File([ae],re,{type:ae.type})};ye.useEffect(()=>{if(!o?.id)return;(async()=>{try{const[re,ae,ce]=await Promise.all([M(`vendors/${o.id}/nricfront.jpg`,"nricfront.jpg"),M(`vendors/${o.id}/nricback.jpg`,"nricback.jpg"),M(`vendors/${o.id}/businesslicense.jpg`,"businesslicense.jpg")]);i(ve=>({...ve,icFront:re||ve.icFront,icBack:ae||ve.icBack,businessLicenseFile:ce||ve.businessLicenseFile}))}catch(re){console.error("Failed to fetch private documents",re)}})()},[o]);const P=K=>{const{name:re,files:ae}=K.target;i(ce=>({...ce,[re]:ae[0]}))},N=K=>{i(re=>({...re,[K]:null}))},H=(K,re,ae,ce,ve)=>C.jsxs("div",{className:`w-full border rounded-xl p-4 flex flex-col transition-all ${S[ae]?"border-orange-500":"border-gray-200"}`,children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("div",{className:"flex flex-col",children:[C.jsx("label",{htmlFor:K,className:"text-sm font-medium text-gray-700",children:re}),C.jsx("span",{className:"text-xs text-gray-400",children:ve})]}),C.jsx("div",{className:"flex items-center gap-2",children:S[ae]?h(ae)?C.jsx("button",{type:"button",disabled:!0,className:"w-[100px] h-[36px] rounded-lg bg-gray-300 text-gray-600 text-sm font-medium cursor-not-allowed",children:"Uploaded"}):C.jsx("button",{type:"button",onClick:()=>N(ae),className:"w-[100px] h-[36px] rounded-lg bg-red-500 text-white text-sm font-medium hover:bg-red-600",children:"Remove"}):C.jsxs(C.Fragment,{children:[C.jsx("input",{type:"file",id:K,name:ae,accept:ce,onChange:P,className:"hidden"}),C.jsx("label",{htmlFor:K,className:"w-[100px] h-[36px] flex items-center justify-center rounded-lg bg-orange-500 text-white text-sm font-medium hover:bg-orange-600 cursor-pointer",children:"Add"})]})})]}),p[ae]&&C.jsx("p",{className:"text-xs text-red-500 mt-1",children:p[ae]})]},ae),W=async()=>{const K={icFront:"Required",icBack:"Required",businessLicenseFile:"Required",permitLicenseFile:"Required"},re={};if(Object.keys(K).forEach(ae=>{S[ae]||(re[ae]=K[ae])}),x(re),!(Object.keys(re).length>0))try{const ce=await fetch(`/v1/marketspace/${r.id}/apply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vendor_id:o.id})});if(!ce.ok)throw new Error("Failed to submit application");const ve=await ce.json();if(ve.image&&S.businessLicenseFile){const Se=`${ve.image}businesslicense.jpg`,{error:Ee}=await bs.storage.from("tamulokal-private").upload(Se,S.businessLicenseFile,{contentType:S.businessLicenseFile.type,upsert:!0});Ee&&console.error("Failed to upload business license:",Ee)}}catch(ae){console.error(ae)}};return C.jsxs("div",{className:"p-4 space-y-6",children:[C.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[C.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Vendor Information"}),C.jsxs("p",{className:"text-sm text-gray-600",children:[C.jsx("span",{className:"font-medium",children:"Name:"})," ",o.name||o.username]}),C.jsxs("p",{className:"text-sm text-gray-600",children:[C.jsx("span",{className:"font-medium",children:"Business License:"})," ",o.license||"-"]})]}),C.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[C.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Space Information"}),C.jsxs("p",{className:"text-sm text-gray-600",children:[C.jsx("span",{className:"font-medium",children:"Lot:"})," ",r.lot]}),C.jsxs("p",{className:"text-sm text-gray-600",children:[C.jsx("span",{className:"font-medium",children:"Rent:"})," RM",r.fee]})]}),C.jsxs("div",{className:"bg-white rounded-lg shadow p-4 space-y-4",children:[C.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Application Documents"}),H("icFront","Upload NRIC (Front)","icFront","image/*","Image only (PNG, JPG)"),H("icBack","Upload NRIC (Back)","icBack","image/*","Image only (PNG, JPG)"),H("businessLicenseFile","Upload Business License","businessLicenseFile",".pdf,image/*","PDF or Image (max 5MB)"),H("permitLicenseFile","Upload Permit License","permitLicenseFile",".pdf,image/*","PDF or Image (max 5MB)")]}),C.jsx("div",{className:"w-full bg-white border-t border-gray-200 px-6 py-4",children:C.jsx("button",{type:"submit",onClick:W,className:"w-full py-3 bg-[#FF8225] text-white rounded-md font-medium hover:bg-[#e6731f] transition",children:"Submit"})})]})},eA="/v1",i4=()=>{const o=$a(),{id:r}=cl(),h=$r(!0)?.user?.id,[p,x]=ye.useState(null),[S,i]=ye.useState(null),[M,P]=ye.useState(!0),[N,H]=ye.useState(null);return ye.useEffect(()=>{(async()=>{try{P(!0),H(null);const[K,re]=await Promise.all([fetch(`${eA}/vendor/${h}/all`),fetch(`${eA}/marketspace/${r}`)]);if(!K.ok)throw new Error("Failed to fetch vendor");if(!re.ok)throw new Error("Failed to fetch market space");const ae=await K.json(),ce=await re.json();console.log(ae),x(ae),i(ce)}catch(K){H(K.message||"Failed to load data")}finally{P(!1)}})()},[h,r]),C.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[C.jsx("div",{className:"px-4 py-4 bg-white",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("button",{onClick:()=>o(-1),className:"text-gray-700 hover:text-orange-500 transition",children:C.jsx(km,{className:"text-2xl"})}),C.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Space Application"})]})}),C.jsxs("div",{className:"flex-1 overflow-auto bg-gray-50",children:[M&&C.jsx("div",{className:"flex justify-center items-center h-40",children:C.jsx("div",{className:"animate-spin h-8 w-8 border-b-2 border-orange-500"})}),N&&C.jsxs("div",{className:"p-4 text-red-600 text-sm",children:["Error: ",N]}),!M&&!N&&C.jsx(t4,{vendor:p,space:S})]})]})},tA="/v1",n4=()=>{const[o,r]=ye.useState("all"),c=$a(),h=$r(!0),[p,x]=ye.useState([]),[S,i]=ye.useState(!0),[M,P]=ye.useState({}),N=h?.user?.id;ye.useEffect(()=>{if(!N)return;(async()=>{try{const ae=await(await fetch(`${tA}/vendor/${N}/marketspace/application`)).json();x(ae||[])}catch(re){console.error("Failed to fetch applications",re)}finally{i(!1)}})()},[N]);const H=p.filter(K=>o==="all"?!0:o==="pending"?K.application_status===2:o==="approved"?K.application_status===1:o==="rejected"?K.application_status!==1&&K.application_status!==2:!0),W=async(K,re)=>{if(!M[re]){P(ae=>({...ae,[re]:!0}));try{await fetch(`${tA}/vendor/${K}/marketspace/application?id=${re}`,{method:"DELETE"}),x(ae=>ae.filter(ce=>ce.application_id!==re))}catch{alert("Failed to withdraw application")}finally{P(ae=>({...ae,[re]:!1}))}}};return C.jsxs("div",{className:"w-screen h-screen flex flex-col relative bg-gray-50",children:[C.jsx("div",{className:"px-4 py-4",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("button",{onClick:()=>c("/profile"),className:"text-gray-700 hover:text-orange-500 transition",children:C.jsx(km,{className:"text-2xl"})}),C.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"My application"})]})}),C.jsx("div",{className:"px-4 pb-6 flex-1 overflow-y-auto",children:S?C.jsx("p",{className:"text-sm text-gray-500",children:"Loading..."}):p.length>0?C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:"flex gap-2 mb-4",children:[C.jsx("button",{onClick:()=>r("all"),className:`px-3 py-1 text-xs rounded-full font-medium ${o==="all"?"bg-gray-800 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All"}),C.jsx("button",{onClick:()=>r("approved"),className:`px-3 py-1 text-xs rounded-full font-medium ${o==="approved"?"bg-green-600 text-white":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:"Accepted"}),C.jsx("button",{onClick:()=>r("pending"),className:`px-3 py-1 text-xs rounded-full font-medium ${o==="pending"?"bg-yellow-500 text-white":"bg-yellow-100 text-yellow-700 hover:bg-yellow-200"}`,children:"Pending"}),C.jsx("button",{onClick:()=>r("rejected"),className:`px-3 py-1 text-xs rounded-full font-medium ${o==="rejected"?"bg-red-600 text-white":"bg-red-100 text-red-700 hover:bg-red-200"}`,children:"Rejected"})]}),C.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:H.map(K=>C.jsxs("div",{className:"bg-white border rounded-xl shadow-sm overflow-hidden flex flex-col md:items-stretch transition",children:[C.jsx("div",{className:"w-full h-36 md:h-40 flex-shrink-0 bg-gray-100",children:K.market_image?C.jsx("img",{src:K.market_image,alt:K.market_name,className:"w-full h-full object-cover"}):C.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-400",children:"No Image"})}),C.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm font-semibold text-gray-800",children:K.market_name}),C.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Lot ",K.lot]}),C.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Applied on"," ",new Date(K.submitted_at).toLocaleDateString()]})]}),C.jsxs("div",{className:"flex items-center justify-between mt-3",children:[C.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${K.application_status===2?"bg-yellow-100 text-yellow-700":K.application_status===1?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:K.application_status===2?"Pending":K.application_status===1?"Approved":"Rejected"}),K.application_status===2&&C.jsxs("button",{className:"flex items-center gap-1 text-xs text-red-600 hover:text-red-700 font-medium disabled:opacity-50",onClick:()=>W(N,K.application_id),type:"button",disabled:M[K.application_id],children:[C.jsx(sE,{className:"text-sm"}),M[K.application_id]?"Withdrawing...":"Withdraw"]}),K.application_status===1&&C.jsxs("button",{className:"flex items-center gap-1 text-xs text-green-600 hover:text-green-700 font-medium",onClick:()=>c(`/business/marketspace/${K.space_id}`),children:[C.jsx(QL,{className:"text-sm"}),"Manage Product"]}),K.application_status!==2&&K.application_status!==1&&C.jsxs("button",{className:"flex items-center gap-1 text-xs text-orange-600 hover:text-orange-700 font-medium",children:[C.jsx(sE,{className:"text-sm"}),"Appeal"]})]})]})]},K.application_id))})]}):C.jsx("p",{className:"text-sm text-gray-500",children:"You have not applied for any marketspace yet."})})]})},a4="/v1",r4=()=>{const o=$r(!0),r=$a(),[c,h]=ye.useState([]),[p,x]=ye.useState(!0),S=o?.user?.id;ye.useEffect(()=>{if(!S)return;(async()=>{try{const N=await(await fetch(`${a4}/visitor/${S}/market-history`)).json();h(N)}catch(P){console.error("Failed to fetch market history",P)}finally{x(!1)}})()},[S]);const i=M=>{const P=new Date(M),N=new Date,H=P.toDateString()===N.toDateString(),W=new Date(N);W.setDate(N.getDate()-1);const K=P.toDateString()===W.toDateString(),re=P.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0});let ae;return H?ae="Today":K?ae="Yesterday":P.getFullYear()===N.getFullYear()?ae=P.toLocaleDateString(void 0,{month:"short",day:"numeric"}):ae=P.toLocaleDateString("en-GB"),{displayDate:ae,time:re}};return C.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[C.jsx("div",{className:"px-4 py-4",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("button",{onClick:()=>r("/profile"),className:"text-gray-700 hover:text-orange-500 transition",children:C.jsx(km,{className:"text-2xl"})}),C.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Market History"})]})}),C.jsx("div",{className:"flex-1 px-4 overflow-y-auto",children:p?C.jsx("p",{className:"text-gray-500 text-sm",children:"Loading history..."}):c.length===0?C.jsx("p",{className:"text-gray-500 text-sm",children:"No market history found"}):C.jsx("div",{className:"flex flex-col md:flex-row md:flex-wrap md:gap-4 gap-4 justify-center mb-4",children:c.map(M=>C.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition overflow-hidden flex flex-col md:flex-row max-h-92 md:h-60 md:w-[48%]",children:[C.jsx("div",{className:"relative w-full md:w-1/2 h-32 md:h-full bg-gray-100 flex-shrink-0",children:M.market_image?C.jsx("img",{src:M.market_image,alt:M.market_name,className:"w-full h-full object-cover"}):C.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-sm",children:"No Image"})}),C.jsxs("div",{className:"px-4 py-3 w-full md:w-1/2 flex flex-col",children:[C.jsx("h2",{className:"text-base font-semibold text-gray-800 text-center mb-2",children:M.market_name}),C.jsxs("div",{className:"flex-1 flex flex-col",children:[C.jsxs("p",{className:"text-xs font-medium text-gray-500 mb-2",children:["Visit History (",M.visits.length,")"]}),C.jsx("div",{className:"max-h-28 overflow-y-auto space-y-2 pr-1 flex-1 no-scrollbar",children:M.visits.sort((P,N)=>new Date(N.visited_at)-new Date(P.visited_at)).map(P=>C.jsxs("div",{className:"flex items-center justify-between text-sm bg-gray-50 rounded-lg px-3 py-2",children:[C.jsx("span",{className:"text-gray-700",children:i(P.visited_at).displayDate}),C.jsx("span",{className:"text-gray-500 text-xs",children:i(P.visited_at).time})]},P.history_id))})]}),C.jsx("div",{className:"pt-3",children:C.jsx(fo,{to:M.review_id!=null?`/market-review/${M.review_id}`:`/market/${M.market_id}/review`,className:`block w-full py-2 text-sm font-medium rounded-lg text-center transition
                ${M.review_id!=null?"bg-orange-500 text-white hover:bg-orange-600":"border border-orange-400 text-orange-500 hover:bg-orange-500 hover:text-white"}
                `,children:M.review_id!=null?"Edit review":"Leave a review"})})]})]},M.market_id))})})]})},s4="/v1",o4=()=>{const o=$r(!0);$a();const[r,c]=ye.useState([]),[h,p]=ye.useState(!0),x=o?.user?.id;return ye.useEffect(()=>{if(!x)return;(async()=>{try{const M=await(await fetch(`${s4}/visitor/${x}/market-bookmark`)).json();c(M)}catch(i){console.error("Failed to fetch market bookmarks",i)}finally{p(!1)}})()},[x]),C.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[C.jsx(dc,{title:"Market Bookmark",backPath:"/profile"}),C.jsx("div",{className:"flex-1 px-4 py-2 grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 overflow-y-auto",children:h?C.jsx("p",{className:"text-gray-500 text-sm",children:"Loading bookmarks..."}):r.length===0?C.jsx("p",{className:"text-gray-500 text-sm",children:"No bookmarks found"}):r.map(S=>C.jsxs(fo,{to:`/market/${S.market_id}`,className:"relative w-full h-40 rounded-xl overflow-hidden shadow-md hover:shadow-lg transition cursor-pointer",children:[C.jsx("img",{src:S.market_image||"https://via.placeholder.com/300x200",alt:S.market_name,className:"w-full h-full object-cover"}),C.jsx("div",{className:"absolute inset-0 bg-black/25 flex flex-col justify-between",children:C.jsx("div",{className:"flex-1 flex items-center justify-center",children:C.jsx("h2",{className:"text-white text-lg font-semibold text-center px-2",children:S.market_name})})})]},S.market_id))})]})},iA=()=>{$a();const{review_id:o,market_id:r}=cl();return C.jsxs("div",{className:"w-screen min-h-screen flex flex-col",children:[C.jsx(dc,{title:"Market Review"}),C.jsx("div",{className:"flex-1 w-full px-4 md:px-8 pb-10",children:C.jsx("div",{className:"max-w-3xl mx-auto overflow-hidden",children:C.jsx(XM,{market_id:r,review_id:o})})})]})},nA="/v1",l4=()=>{$a();const{market_id:o}=cl(),[r,c]=ye.useState([]),[h,p]=ye.useState(!0);ye.useEffect(()=>{if(!o)return;(async()=>{try{const i=await fetch(`${nA}/market/${o}/review`);if(!i.ok)throw new Error("Failed to fetch reviews");const M=await i.json();c(M)}catch(i){console.error(i)}finally{p(!1)}})()},[o]);const x=async(S,i)=>{try{await fetch(`${nA}/market/${o}/review?id=${S}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({hide:i})}),c(M=>M.map(P=>P.id===S?{...P,hide:i}:P))}catch(M){console.error("Failed to update review visibility",M),alert("Failed to update review visibility")}};return C.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[C.jsx(dc,{title:"Market Reviews"}),C.jsx("div",{className:"flex-1 px-4 py-4 overflow-y-auto space-y-4",children:h?C.jsx("p",{className:"text-gray-500 text-sm",children:"Loading reviews..."}):r.length===0?C.jsx("p",{className:"text-gray-500 text-sm",children:"No reviews found"}):r.map(S=>C.jsx(ZM,{review:S,onToggleHide:x,isOwnProfile:!0},S.id))})]})},L0=({title:o,data:r,trendText:c,filter:h,filterByTime:p})=>{const x=p(r),S=o==="Rating",i=S?x.length>0?(x.reduce((re,ae)=>re+(ae.rating||0),0)/x.length).toFixed(1):"0.0":x.length,M=S?r.length>0?r.length:0:r.length,N=(()=>{if(!r)return 0;const re=new Date,ae=r.filter(ce=>{const ve=new Date(ce.created_at);switch(h){case"today":{const Se=new Date(re);return Se.setDate(re.getDate()-1),ve.toDateString()===Se.toDateString()}case"week":{const Se=new Date(re);Se.setDate(re.getDate()-re.getDay()-7);const Ee=new Date(Se);return Ee.setDate(Se.getDate()+6),ve>=Se&&ve<=Ee}case"month":{const Se=re.getMonth()-1,Ee=Se<0?re.getFullYear()-1:re.getFullYear(),Qe=Se<0?11:Se;return ve.getMonth()===Qe&&ve.getFullYear()===Ee}case"year":{const Se=re.getFullYear()-1;return ve.getFullYear()===Se}case"all":default:return!1}});return S?ae.length>0?ae.reduce((ce,ve)=>ce+(ve.rating||0),0)/ae.length:0:ae.length})();let H,W;const K=S?parseFloat(i):Number(i);return H=K>=N,K===0&&N===0?W=0:N===0?W=100:W=Math.floor((K-N)/N*100),C.jsxs("div",{className:"bg-white rounded-xl shadow p-4 flex flex-col gap-2",children:[C.jsx("p",{className:"text-sm font-medium text-gray-500",children:o}),C.jsxs("div",{className:"flex items-end justify-start",children:[C.jsx("p",{className:"text-4xl font-semibold text-gray-800",children:i}),h!=="all"&&C.jsxs("div",{className:"flex items-end",children:[H?C.jsx(ML,{className:"text-green-500 -mb-2.5 -mx-1.5",size:40}):C.jsx(CL,{className:"text-red-500 -mb-1.5 -mx-1.5",size:40}),C.jsxs("span",{className:`text-xl ${H?"text-green-500":"text-red-500"}`,children:[W,"%"]})]})]}),C.jsx("p",{className:"text-xs text-gray-500",children:c.replace("xx",M)})]})},_1="/v1",c4=()=>{const o=$a(),{market_id:r}=cl(),[c,h]=ye.useState("today"),[p,x]=ye.useState(null),[S,i]=ye.useState([]),M=()=>{r&&(window.location.href=`${_1}/market/${r}/statistic-download`)};ye.useEffect(()=>{if(!r)return;const H=async()=>{try{const K=await fetch(`${_1}/market/${r}/statistic`);if(!K.ok)throw new Error("Failed to fetch statistic");const re=await K.json();x(re)}catch(K){console.error(K)}},W=async()=>{try{const K=await fetch(`${_1}/market/${r}/vendor`);if(!K.ok)throw new Error("Failed to fetch vendors");const re=await K.json();i(re)}catch(K){console.error(K)}};H(),W()},[r]);const P=H=>{if(!H)return[];const W=new Date;return H.filter(K=>{const re=new Date(K.created_at);switch(c){case"Today":return re.toDateString()===W.toDateString();case"This Week":const ae=new Date(W);return ae.setDate(W.getDate()-W.getDay()),re>=ae;case"This Month":return re.getMonth()===W.getMonth()&&re.getFullYear()===W.getFullYear();case"This Year":return re.getFullYear()===W.getFullYear();case"All Time":default:return!0}})},N=[...S].sort((H,W)=>W.avg_rating-H.avg_rating).slice(0,3);return C.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[C.jsx("div",{className:"px-4 py-4",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("button",{onClick:()=>o(-1),className:"text-gray-700 hover:text-orange-500 transition",children:C.jsx(km,{className:"text-2xl"})}),C.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Market Statistic"})]})}),C.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[C.jsxs("select",{className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-orange-400",value:c,onChange:H=>h(H.target.value),children:[C.jsx("option",{value:"today",children:"Today"}),C.jsx("option",{value:"week",children:"This Week"}),C.jsx("option",{value:"month",children:"This Month"}),C.jsx("option",{value:"year",children:"This Year"}),C.jsx("option",{value:"all",children:"All Time"})]}),C.jsxs("button",{onClick:M,className:"flex items-center gap-1 px-3 py-1 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition",children:[C.jsx(oM,{className:"text-lg"}),"Full Report"]})]}),C.jsx("div",{className:"px-4 py-2 grid grid-cols-2 gap-4",children:p&&C.jsxs(C.Fragment,{children:[C.jsx(L0,{title:"People Visit",data:p.market_history,trendText:"xx people have visited your market",filter:c,filterByTime:P}),C.jsx(L0,{title:"Rating",data:p.market_review,trendText:"xx people have reviewed your market",filter:c,filterByTime:P}),C.jsx(L0,{title:"Mentions",data:p.market_content,trendText:"Your market has been mentioned xx times",filter:c,filterByTime:P}),C.jsx(L0,{title:"Market Click",data:p.market_click,trendText:"xx people have clicked on your market",filter:c,filterByTime:P})]})}),N.length>0&&C.jsxs("div",{className:"px-4 py-4",children:[C.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Top Vendors"}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:N.map((H,W)=>C.jsxs("div",{className:`px-4 py-2 rounded-xl shadow flex items-center border-2 gap-4 ${W===0?"border-yellow-300":W===1?"border-gray-300":"border-orange-200"}`,children:[C.jsx("p",{className:"font-bold text-xl w-6 text-center",children:W+1}),C.jsx("img",{src:H.image,alt:H.name,className:"w-16 h-16 object-cover rounded-full"}),C.jsxs("div",{className:"flex justify-between w-full items-center gap-2",children:[C.jsx("p",{className:"font-semibold text-gray-800",children:H.name}),C.jsxs("div",{className:"flex items-center text-yellow-400",children:[C.jsx(Wo,{className:"inline-block"}),C.jsx("span",{className:"ml-1",children:H.avg_rating})]})]})]},H.vendor_id))})]})]})},aA="/v1",y1=({label:o,value:r,color:c,description:h})=>C.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 flex flex-col items-center justify-center",children:[C.jsx("div",{className:"uppercase text-xs text-gray-500 font-semibold tracking-wider mb-2",children:o}),C.jsx("div",{className:`text-3xl font-extrabold mb-1 ${c||"text-gray-900"}`,children:r}),h&&C.jsx("div",{className:"text-xs text-gray-500 font-normal text-center",children:h})]}),u4=({idx:o,product:r})=>C.jsxs("div",{className:`p-4 rounded-xl border-2 flex items-center gap-4 bg-white shadow mb-3 ${o===0?"border-yellow-300":o===1?"border-gray-300":"border-orange-200"}`,style:{minHeight:90},children:[C.jsx("div",{className:"font-bold text-2xl w-8 text-center flex-shrink-0",children:o+1}),r.image?C.jsx("img",{src:r.image,alt:r.name,className:"w-16 h-16 object-cover rounded-lg border border-gray-100",style:{background:"#f3f3f3"}}):C.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400",children:C.jsx(Wo,{className:"text-2xl"})}),C.jsxs("div",{className:"flex flex-col justify-center flex-1 min-w-0",children:[C.jsx("div",{className:"truncate font-semibold text-gray-900",children:r.name}),C.jsxs("div",{className:"flex items-center mt-1 text-yellow-500 font-medium text-base",children:[C.jsx(Wo,{className:"mr-1"}),r.avg_rating.toFixed(1)]})]})]}),d4=()=>{const r=$r(!0)?.user?.id;$a();const[c,h]=ye.useState(null);ye.useEffect(()=>{if(!r)return;(async()=>{try{const N=await fetch(`${aA}/vendor/${r}/statistic`);if(!N.ok)throw new Error("Failed to fetch vendor statistic");const H=await N.json();h(H)}catch(N){console.error(N)}})()},[r]);const p=c?.profile_click?.length||0,x=c?.account_follow?.length||0;let S=0;if(c?.products?.length>0){const P=c.products.map(N=>!N.reviews||N.reviews.length===0?null:N.reviews.reduce((W,K)=>W+K.rating,0)/N.reviews.length).filter(Boolean);P.length>0&&(S=P.reduce((N,H)=>N+H,0)/P.length)}const i=ye.useMemo(()=>c?.products?.map(P=>{if(!P.reviews||P.reviews.length===0)return null;const N=P.reviews.reduce((H,W)=>H+W.rating,0)/P.reviews.length;return{...P.product,avg_rating:N,image:P.product?.image}}).filter(Boolean).sort((P,N)=>N.avg_rating-P.avg_rating).slice(0,3)||[],[c]),M=()=>{r&&(window.location.href=`${aA}/vendor/${r}/statistic-download`)};return C.jsxs("div",{className:"relative w-full h-screen",children:[C.jsx(dc,{title:"Vendor Statistic"}),C.jsx("div",{className:"w-full max-w-2xl mx-auto px-4 flex justify-end items-center mb-4",children:C.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-orange-500 text-white hover:bg-orange-600 text-sm font-medium transition",onClick:M,children:[C.jsx(oM,{className:"text-lg"}),"Full Report"]})}),c&&C.jsxs("div",{className:"w-full max-w-2xl mx-auto grid grid-cols-1 sm:grid-cols-2 gap-6 px-4 mb-8",children:[C.jsx(y1,{label:"Profile Clicks",value:p,description:"Total click counts on your profile"}),C.jsx(y1,{label:"Followers",value:x,description:"Current number of followers"}),C.jsx(y1,{label:"Review Score",value:S?S.toFixed(1):"-",description:"Overall average rating of your products"})]}),i.length>0&&C.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4",children:[C.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4 mt-8",children:"Top 3 Products"}),i.map((P,N)=>C.jsx(u4,{idx:N,product:P},P.id))]})]})},v1=[{label:"Markets",value:128,icon:C.jsx(Tm,{size:60})},{label:"Vendors",value:920,icon:C.jsx(nb,{size:60})},{label:"Products",value:5400,icon:C.jsx(tx,{size:60})}],h4=()=>{const o=$a(),[r,c]=ye.useState(v1.map(()=>0)),[h,p]=ye.useState(!1),x=ye.useRef(null),S=ye.useRef(null),i=()=>{S.current?.scrollIntoView({behavior:"smooth",block:"start"})};return ye.useEffect(()=>{if(!x.current)return;const M=()=>{const H=performance.now(),W=K=>{const re=Math.min((K-H)/1200,1);c(v1.map(ae=>Math.round(ae.value*re))),re<1&&requestAnimationFrame(W)};requestAnimationFrame(W)},P=new IntersectionObserver(N=>{N.some(H=>H.isIntersecting)&&!h&&(p(!0),M())},{threshold:.35});return P.observe(x.current),()=>P.disconnect()},[h]),C.jsxs("div",{className:"font-inter text-[var(--black)] snap-y snap-mandatory",style:{background:"linear-gradient(to bottom, color-mix(in srgb, var(--orange) 10%, transparent) 0%, var(--white) 25%, var(--white) 100%)"},children:[C.jsx("header",{className:"fixed top-0 left-0 w-full z-30",children:C.jsxs("div",{className:"w-full px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between gap-3 backdrop-blur-lg bg-[color-mix(in srgb,var(--white) 30%,transparent)]",children:[C.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[C.jsx("img",{src:"/tamulokal.png",alt:"Tamukinabalu logo",className:"h-8 w-8 sm:h-10 sm:w-10 object-contain"}),C.jsx("span",{className:"text-base sm:text-xl font-semibold text-[var(--black)]",children:"Tamukinabalu"})]}),C.jsx("div",{className:"flex items-center gap-2 sm:gap-3 shrink-0",children:C.jsxs("button",{onClick:()=>{},className:"inline-flex items-center gap-1.5 px-3 py-2 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm font-semibold transition shadow-sm hover:shadow-md border border-[var(--gray)] bg-[color-mix(in srgb,var(--white) 70%,transparent)] text-[var(--black)]",children:[C.jsx(hM,{className:"text-base sm:text-lg"}),"EN"]})})]})}),C.jsxs("section",{className:"min-h-screen snap-start flex flex-col justify-center items-center px-6 text-center relative overflow-hidden pt-28 pb-16 sm:pt-24",children:[C.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`
              radial-gradient(circle at top left, color-mix(in srgb,var(--orange) 15%, transparent) 0%, transparent 35%),
              radial-gradient(circle at bottom right, color-mix(in srgb,var(--orange) 15%, transparent) 0%, transparent 35%)
            `}}),C.jsxs("div",{className:"max-w-4xl mx-auto relative",children:[C.jsxs("h1",{className:"text-4xl md:text-5xl lg:text-6xl font-extrabold leading-tight text-[var(--black)]",children:["Your Tamu Adventure",C.jsx("span",{className:"text-[var(--orange)]",children:" Starts Here"})]}),C.jsx("p",{className:"mt-4 md:mt-6 max-w-2xl mx-auto text-base md:text-lg text-[var(--black)]",children:"Discover street markets near you in Kota Kinabalucheck whats happening today, navigate easily, and plan your visit before you arrive."}),C.jsxs("div",{className:"mt-8 flex justify-center gap-3",children:[C.jsx("button",{onClick:i,className:"px-7 py-3 rounded-full text-sm font-semibold transition shadow-sm hover:shadow-md inline-flex items-center justify-center gap-2 border border-[var(--orange)] text-[var(--orange)] bg-[color-mix(in srgb,var(--white) 80%,transparent)]",children:"Learn More"}),C.jsx("button",{onClick:()=>o("/"),className:"px-7 py-3 rounded-full text-sm font-semibold transition shadow-md hover:shadow-lg inline-flex items-center justify-center gap-2 bg-[var(--orange)] text-[var(--white)]",children:"Explore Now"})]})]})]}),C.jsx("section",{ref:S,className:"min-h-screen snap-start flex items-center px-6 bg-[var(--white)] pt-24 pb-16",children:C.jsxs("div",{className:"max-w-6xl mx-auto w-full",children:[C.jsxs("div",{className:"text-center mb-10",children:[C.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:"Features"}),C.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-[var(--black)] mt-2",children:"Designed for visitors exploring Kota Kinabalu"}),C.jsx("p",{className:"mt-3 text-[var(--gray)] max-w-3xl mx-auto",children:"Find the best Tamu nearby, see whats live right now, and plan your route before you head out."})]}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[C.jsx(x1,{icon:C.jsx(xS,{size:32}),title:"Find nearby markets",desc:"See Tamu around you with distance and open/close times at a glance."}),C.jsx(x1,{icon:C.jsx(NL,{size:32}),title:"Navigate easily",desc:"One-tap directions to markets, optimized for walking or driving."}),C.jsx(x1,{icon:C.jsx(bS,{size:32}),title:"Engage with others",desc:"Share your posts, tips, and join forum discussions with other market-goers."})]})]})}),C.jsx("section",{ref:x,className:"min-h-screen snap-start flex items-center px-6 bg-[var(--white)] relative overflow-hidden pt-24 pb-16",children:C.jsxs("div",{className:"max-w-5xl mx-auto w-full",children:[C.jsxs("div",{className:"text-center mb-12",children:[C.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:"By the Numbers"}),C.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-[var(--black)] mt-2",children:"A thriving community of markets, vendors, and products"}),C.jsx("p",{className:"mt-3 text-[var(--gray)] max-w-2xl mx-auto",children:"Real-time snapshots of Tamukinabalus ecosystemgrowing every day to help visitors discover, vendors thrive, and organizers succeed."})]}),C.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:v1.map((M,P)=>C.jsxs("div",{className:"rounded-2xl shadow-lg p-4 border bg-[var(--white)] border-[color-mix(in srgb,var(--orange) 20%, transparent)] flex flex-col items-center text-center gap-4",children:[C.jsx("div",{className:"w-16 h-16 flex items-center justify-center rounded-full text-3xl bg-[color-mix(in srgb,var(--orange) 18%, transparent)] text-[var(--gray)]",children:M.icon}),C.jsx("div",{className:"text-lg font-semibold text-[var(--black)]",children:M.label}),C.jsx("div",{className:"text-4xl md:text-5xl font-extrabold text-[var(--black)]",children:r[P].toLocaleString()})]},M.label))})]})}),C.jsx("section",{className:"min-h-screen snap-start flex items-center px-6 bg-[color-mix(in srgb,var(--black) 5%, transparent)] pt-24 pb-16",children:C.jsxs("div",{className:"max-w-5xl mx-auto w-full text-center",children:[C.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:"Partner with Tamukinabalu"}),C.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-[var(--black)] mt-2",children:"Grow your presence as a Vendor or Organizer"}),C.jsx("p",{className:"mt-3 text-[var(--gray)] max-w-2xl mx-auto",children:"Showcase products, manage applications, and run smoother events with our tools built for local markets."}),C.jsxs("div",{className:"mt-10 grid grid-cols-1 md:grid-cols-2 gap-6",children:[C.jsx(rA,{title:"Vendors",bullets:["Apply to markets and secure spots","Showcase products and offers","Engage with visitors directly"],ctaText:"Join as Vendor",onClick:()=>{localStorage.setItem("signupRole","vendor"),o("/auth")}}),C.jsx(rA,{title:"Organizers",bullets:["Create and manage market events","Approve vendors and assign slots","Track performance and attendance"],ctaText:"Start as Organizer",onClick:()=>{localStorage.setItem("signupRole","organizer"),o("/auth")}})]})]})}),C.jsxs("section",{className:"min-h-screen snap-start flex items-center px-6 text-center bg-[var(--orange)] text-[var(--white)] pt-24 pb-16 relative overflow-hidden",children:[C.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`
              radial-gradient(circle at 20% 20%, rgba(255,255,255,0.18) 0%, transparent 35%),
              radial-gradient(circle at 80% 30%, rgba(255,255,255,0.12) 0%, transparent 32%),
              radial-gradient(circle at 40% 80%, rgba(255,255,255,0.14) 0%, transparent 32%)
            `}}),C.jsxs("div",{className:"max-w-4xl mx-auto relative",children:[C.jsx("p",{className:"text-sm font-semibold tracking-[0.12em] uppercase opacity-90",children:" Lets Go"}),C.jsx("h2",{className:"text-3xl md:text-4xl font-extrabold mt-2",children:"Ready to Explore?"}),C.jsx("p",{className:"mt-3 text-base md:text-lg opacity-90",children:"Jump into Kota Kinabalus street markets and start your adventure today."}),C.jsx("div",{className:"mt-7 flex flex-wrap justify-center gap-3",children:C.jsx("button",{onClick:()=>o("/"),className:"px-7 py-3 rounded-full text-sm font-semibold transition shadow-md hover:shadow-lg inline-flex items-center justify-center gap-2 bg-[var(--white)] text-[var(--orange)]",children:"Explore Now"})})]})]}),C.jsxs("footer",{className:"text-sm py-8 px-6 text-center bg-[var(--black)] text-[var(--white)]",children:[" ",new Date().getFullYear()," Tamukinabalu. All rights reserved."]})]})},x1=({icon:o,title:r,desc:c})=>C.jsxs("div",{className:"rounded-xl shadow-sm border p-6 text-left bg-[var(--white)] border-[color-mix(in srgb,var(--black) 10%, transparent)]",children:[C.jsx("div",{className:"w-12 h-12 flex items-center justify-center rounded-full text-xl mb-4 bg-[color-mix(in srgb,var(--orange) 15%, transparent)] text-[var(--orange)]",children:o}),C.jsx("h3",{className:"font-semibold mb-2 text-lg text-[var(--black)]",children:r}),C.jsx("p",{className:"text-sm leading-relaxed text-[var(--gray)]",children:c})]}),rA=({title:o,bullets:r,ctaText:c,onClick:h})=>C.jsxs("div",{className:"rounded-xl shadow-sm border p-6 text-left bg-[var(--white)] border-[color-mix(in srgb,var(--black) 12%, transparent)] flex flex-col h-full",children:[C.jsx("h3",{className:"text-xl font-semibold text-[var(--black)] mb-3",children:o}),C.jsx("ul",{className:"space-y-2 text-[var(--gray)] text-sm flex-1",children:r.map((p,x)=>C.jsxs("li",{className:"flex gap-2 items-start",children:[C.jsx(iM,{className:"text-[var(--green)] mt-[2px]"}),C.jsx("span",{children:p})]},x))}),C.jsx("button",{onClick:h,className:"mt-6 inline-flex items-center justify-center px-5 py-3 rounded-full text-sm font-semibold bg-[var(--orange)] text-[var(--white)] shadow-sm hover:shadow-md transition",children:c})]});var rb={exports:{}},f4=rb.exports,sA;function m4(){return sA||(sA=1,(function(o,r){(function(c,h){o.exports=h()})(f4,(function(){var c,h,p;function x(i,M){if(!c)c=M;else if(!h)h=M;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",N={};c(N),p=M(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(p.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}x(["exports"],(function(i){var M=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function N(a,e){var n=e[0],l=e[1],u=e[2],g=e[3],_=n*g-u*l;return _?(a[0]=g*(_=1/_),a[1]=-l*_,a[2]=-u*_,a[3]=n*_,a):null}function H(){var a=new P(9);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function W(a,e){var n=e[0],l=e[1],u=e[2],g=e[3],_=e[4],w=e[5],A=e[6],z=e[7],O=e[8];return a[0]=_*O-w*z,a[1]=u*z-l*O,a[2]=l*w-u*_,a[3]=w*A-g*O,a[4]=n*O-u*A,a[5]=u*g-n*w,a[6]=g*z-_*A,a[7]=l*A-n*z,a[8]=n*_-l*g,a}function K(a,e,n){var l=e[0],u=e[1],g=e[2],_=e[3],w=e[4],A=e[5],z=e[6],O=e[7],F=e[8],U=n[0],q=n[1],Z=n[2],ee=n[3],le=n[4],oe=n[5],fe=n[6],_e=n[7],be=n[8];return a[0]=U*l+q*_+Z*z,a[1]=U*u+q*w+Z*O,a[2]=U*g+q*A+Z*F,a[3]=ee*l+le*_+oe*z,a[4]=ee*u+le*w+oe*O,a[5]=ee*g+le*A+oe*F,a[6]=fe*l+_e*_+be*z,a[7]=fe*u+_e*w+be*O,a[8]=fe*g+_e*A+be*F,a}function re(){var a=new P(16);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function ae(a){var e=new P(16);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function ce(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ve(a,e){var n=e[0],l=e[1],u=e[2],g=e[3],_=e[4],w=e[5],A=e[6],z=e[7],O=e[8],F=e[9],U=e[10],q=e[11],Z=e[12],ee=e[13],le=e[14],oe=e[15],fe=n*w-l*_,_e=n*A-u*_,be=n*z-g*_,Oe=l*A-u*w,Ie=l*z-g*w,Ue=u*z-g*A,Ge=O*ee-F*Z,et=O*le-U*Z,yt=O*oe-q*Z,nt=F*le-U*ee,bt=F*oe-q*ee,Mt=U*oe-q*le,Pt=fe*Mt-_e*bt+be*nt+Oe*yt-Ie*et+Ue*Ge;return Pt?(a[0]=(w*Mt-A*bt+z*nt)*(Pt=1/Pt),a[1]=(u*bt-l*Mt-g*nt)*Pt,a[2]=(ee*Ue-le*Ie+oe*Oe)*Pt,a[3]=(U*Ie-F*Ue-q*Oe)*Pt,a[4]=(A*yt-_*Mt-z*et)*Pt,a[5]=(n*Mt-u*yt+g*et)*Pt,a[6]=(le*be-Z*Ue-oe*_e)*Pt,a[7]=(O*Ue-U*be+q*_e)*Pt,a[8]=(_*bt-w*yt+z*Ge)*Pt,a[9]=(l*yt-n*bt-g*Ge)*Pt,a[10]=(Z*Ie-ee*be+oe*fe)*Pt,a[11]=(F*be-O*Ie-q*fe)*Pt,a[12]=(w*et-_*nt-A*Ge)*Pt,a[13]=(n*nt-l*et+u*Ge)*Pt,a[14]=(ee*_e-Z*Oe-le*fe)*Pt,a[15]=(O*Oe-F*_e+U*fe)*Pt,a):null}function Se(a,e,n){var l=e[0],u=e[1],g=e[2],_=e[3],w=e[4],A=e[5],z=e[6],O=e[7],F=e[8],U=e[9],q=e[10],Z=e[11],ee=e[12],le=e[13],oe=e[14],fe=e[15],_e=n[0],be=n[1],Oe=n[2],Ie=n[3];return a[0]=_e*l+be*w+Oe*F+Ie*ee,a[1]=_e*u+be*A+Oe*U+Ie*le,a[2]=_e*g+be*z+Oe*q+Ie*oe,a[3]=_e*_+be*O+Oe*Z+Ie*fe,a[4]=(_e=n[4])*l+(be=n[5])*w+(Oe=n[6])*F+(Ie=n[7])*ee,a[5]=_e*u+be*A+Oe*U+Ie*le,a[6]=_e*g+be*z+Oe*q+Ie*oe,a[7]=_e*_+be*O+Oe*Z+Ie*fe,a[8]=(_e=n[8])*l+(be=n[9])*w+(Oe=n[10])*F+(Ie=n[11])*ee,a[9]=_e*u+be*A+Oe*U+Ie*le,a[10]=_e*g+be*z+Oe*q+Ie*oe,a[11]=_e*_+be*O+Oe*Z+Ie*fe,a[12]=(_e=n[12])*l+(be=n[13])*w+(Oe=n[14])*F+(Ie=n[15])*ee,a[13]=_e*u+be*A+Oe*U+Ie*le,a[14]=_e*g+be*z+Oe*q+Ie*oe,a[15]=_e*_+be*O+Oe*Z+Ie*fe,a}function Ee(a,e,n){var l,u,g,_,w,A,z,O,F,U,q,Z,ee=n[0],le=n[1],oe=n[2];return e===a?(a[12]=e[0]*ee+e[4]*le+e[8]*oe+e[12],a[13]=e[1]*ee+e[5]*le+e[9]*oe+e[13],a[14]=e[2]*ee+e[6]*le+e[10]*oe+e[14],a[15]=e[3]*ee+e[7]*le+e[11]*oe+e[15]):(u=e[1],g=e[2],_=e[3],w=e[4],A=e[5],z=e[6],O=e[7],F=e[8],U=e[9],q=e[10],Z=e[11],a[0]=l=e[0],a[1]=u,a[2]=g,a[3]=_,a[4]=w,a[5]=A,a[6]=z,a[7]=O,a[8]=F,a[9]=U,a[10]=q,a[11]=Z,a[12]=l*ee+w*le+F*oe+e[12],a[13]=u*ee+A*le+U*oe+e[13],a[14]=g*ee+z*le+q*oe+e[14],a[15]=_*ee+O*le+Z*oe+e[15]),a}function Qe(a,e,n){var l=n[0],u=n[1],g=n[2];return a[0]=e[0]*l,a[1]=e[1]*l,a[2]=e[2]*l,a[3]=e[3]*l,a[4]=e[4]*u,a[5]=e[5]*u,a[6]=e[6]*u,a[7]=e[7]*u,a[8]=e[8]*g,a[9]=e[9]*g,a[10]=e[10]*g,a[11]=e[11]*g,a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function He(a,e,n){var l=Math.sin(n),u=Math.cos(n),g=e[4],_=e[5],w=e[6],A=e[7],z=e[8],O=e[9],F=e[10],U=e[11];return e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[4]=g*u+z*l,a[5]=_*u+O*l,a[6]=w*u+F*l,a[7]=A*u+U*l,a[8]=z*u-g*l,a[9]=O*u-_*l,a[10]=F*u-w*l,a[11]=U*u-A*l,a}function ke(a,e,n){var l=Math.sin(n),u=Math.cos(n),g=e[0],_=e[1],w=e[2],A=e[3],z=e[8],O=e[9],F=e[10],U=e[11];return e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=g*u-z*l,a[1]=_*u-O*l,a[2]=w*u-F*l,a[3]=A*u-U*l,a[8]=g*l+z*u,a[9]=_*l+O*u,a[10]=w*l+F*u,a[11]=A*l+U*u,a}function tt(a,e,n){var l=Math.sin(n),u=Math.cos(n),g=e[0],_=e[1],w=e[2],A=e[3],z=e[4],O=e[5],F=e[6],U=e[7];return e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=g*u+z*l,a[1]=_*u+O*l,a[2]=w*u+F*l,a[3]=A*u+U*l,a[4]=z*u-g*l,a[5]=O*u-_*l,a[6]=F*u-w*l,a[7]=U*u-A*l,a}function Ke(a,e){return a[0]=e[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=e[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=e[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function lt(a,e,n){var l,u,g,_=n[0],w=n[1],A=n[2],z=Math.sqrt(_*_+w*w+A*A);return z<M?null:(_*=z=1/z,w*=z,A*=z,l=Math.sin(e),u=Math.cos(e),a[0]=_*_*(g=1-u)+u,a[1]=w*_*g+A*l,a[2]=A*_*g-w*l,a[3]=0,a[4]=_*w*g-A*l,a[5]=w*w*g+u,a[6]=A*w*g+_*l,a[7]=0,a[8]=_*A*g+w*l,a[9]=w*A*g-_*l,a[10]=A*A*g+u,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function ft(a,e){var n=e[0],l=e[1],u=e[2],g=e[4],_=e[5],w=e[6],A=e[8],z=e[9],O=e[10];return a[0]=Math.sqrt(n*n+l*l+u*u),a[1]=Math.sqrt(g*g+_*_+w*w),a[2]=Math.sqrt(A*A+z*z+O*O),a}function gt(a,e){var n=e[0],l=e[1],u=e[2],g=e[3],_=n+n,w=l+l,A=u+u,z=n*_,O=l*_,F=l*w,U=u*_,q=u*w,Z=u*A,ee=g*_,le=g*w,oe=g*A;return a[0]=1-F-Z,a[1]=O+oe,a[2]=U-le,a[3]=0,a[4]=O-oe,a[5]=1-z-Z,a[6]=q+ee,a[7]=0,a[8]=U+le,a[9]=q-ee,a[10]=1-z-F,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}var ni=Se;function Ft(){var a=new P(3);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Vi(a){var e=new P(3);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e}function Ri(a){var e=a[0],n=a[1],l=a[2];return Math.sqrt(e*e+n*n+l*l)}function We(a,e,n){var l=new P(3);return l[0]=a,l[1]=e,l[2]=n,l}function Et(a,e,n,l){return a[0]=e,a[1]=n,a[2]=l,a}function jt(a,e,n){return a[0]=e[0]+n[0],a[1]=e[1]+n[1],a[2]=e[2]+n[2],a}function Gi(a,e,n){return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],a}function Ce(a,e,n){return a[0]=e[0]*n[0],a[1]=e[1]*n[1],a[2]=e[2]*n[2],a}function _t(a,e,n){return a[0]=Math.min(e[0],n[0]),a[1]=Math.min(e[1],n[1]),a[2]=Math.min(e[2],n[2]),a}function At(a,e,n){return a[0]=Math.max(e[0],n[0]),a[1]=Math.max(e[1],n[1]),a[2]=Math.max(e[2],n[2]),a}function Ct(a,e,n){return a[0]=e[0]*n,a[1]=e[1]*n,a[2]=e[2]*n,a}function oi(a,e,n,l){return a[0]=e[0]+n[0]*l,a[1]=e[1]+n[1]*l,a[2]=e[2]+n[2]*l,a}function Ci(a,e){var n=e[0]-a[0],l=e[1]-a[1],u=e[2]-a[2];return Math.sqrt(n*n+l*l+u*u)}function li(a,e){var n=e[0]-a[0],l=e[1]-a[1],u=e[2]-a[2];return n*n+l*l+u*u}function Ba(a){var e=a[0],n=a[1],l=a[2];return e*e+n*n+l*l}function Un(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a}function qn(a,e){var n=e[0],l=e[1],u=e[2],g=n*n+l*l+u*u;return g>0&&(g=1/Math.sqrt(g)),a[0]=e[0]*g,a[1]=e[1]*g,a[2]=e[2]*g,a}function On(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]}function Ja(a,e,n){var l=e[0],u=e[1],g=e[2],_=n[0],w=n[1],A=n[2];return a[0]=u*A-g*w,a[1]=g*_-l*A,a[2]=l*w-u*_,a}function Qi(a,e,n,l){var u=e[0],g=e[1],_=e[2];return a[0]=u+l*(n[0]-u),a[1]=g+l*(n[1]-g),a[2]=_+l*(n[2]-_),a}function Fi(a,e,n){var l=e[0],u=e[1],g=e[2],_=n[3]*l+n[7]*u+n[11]*g+n[15];return a[0]=(n[0]*l+n[4]*u+n[8]*g+n[12])/(_=_||1),a[1]=(n[1]*l+n[5]*u+n[9]*g+n[13])/_,a[2]=(n[2]*l+n[6]*u+n[10]*g+n[14])/_,a}function nn(a,e,n){var l=e[0],u=e[1],g=e[2];return a[0]=l*n[0]+u*n[3]+g*n[6],a[1]=l*n[1]+u*n[4]+g*n[7],a[2]=l*n[2]+u*n[5]+g*n[8],a}function hn(a,e,n){var l=n[0],u=n[1],g=n[2],_=n[3],w=e[0],A=e[1],z=e[2],O=u*z-g*A,F=g*w-l*z,U=l*A-u*w;return a[0]=w+_*(O+=O)+u*(U+=U)-g*(F+=F),a[1]=A+_*F+g*O-l*U,a[2]=z+_*U+l*F-u*O,a}function ln(a){return a[0]=0,a[1]=0,a[2]=0,a}function xn(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]}var za=Gi,$c=Ce,Zo=Ri;function $s(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function ws(a,e,n){return a[0]=e[0]*n,a[1]=e[1]*n,a[2]=e[2]*n,a[3]=e[3]*n,a}function Vs(a,e){var n=e[0],l=e[1],u=e[2],g=e[3],_=n*n+l*l+u*u+g*g;return _>0&&(_=1/Math.sqrt(_)),a[0]=n*_,a[1]=l*_,a[2]=u*_,a[3]=g*_,a}function Vr(a,e,n){var l=e[0],u=e[1],g=e[2],_=e[3];return a[0]=n[0]*l+n[4]*u+n[8]*g+n[12]*_,a[1]=n[1]*l+n[5]*u+n[9]*g+n[13]*_,a[2]=n[2]*l+n[6]*u+n[10]*g+n[14]*_,a[3]=n[3]*l+n[7]*u+n[11]*g+n[15]*_,a}function Xo(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Kr(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Qa(a,e,n){n*=.5;var l=e[0],u=e[1],g=e[2],_=e[3],w=Math.sin(n),A=Math.cos(n);return a[0]=l*A+_*w,a[1]=u*A+g*w,a[2]=g*A-u*w,a[3]=_*A-l*w,a}function us(a,e,n){n*=.5;var l=e[0],u=e[1],g=e[2],_=e[3],w=Math.sin(n),A=Math.cos(n);return a[0]=l*A-g*w,a[1]=u*A+_*w,a[2]=g*A+l*w,a[3]=_*A-u*w,a}Ft(),$s();var mr,ul,Jl,Hs=Vs,Yo=(mr=Ft(),ul=We(1,0,0),Jl=We(0,1,0),function(a,e,n){var l=On(e,n);return l<-.999999?(Ja(mr,ul,e),Zo(mr)<1e-6&&Ja(mr,Jl,e),qn(mr,mr),(function(u,g,_){_*=.5;var w=Math.sin(_);u[0]=w*g[0],u[1]=w*g[1],u[2]=w*g[2],u[3]=Math.cos(_)})(a,mr,Math.PI),a):l>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(Ja(mr,e,n),a[0]=mr[0],a[1]=mr[1],a[2]=mr[2],a[3]=1+l,Hs(a,a))});function yr(){var a=new P(2);return P!=Float32Array&&(a[0]=0,a[1]=0),a}function zr(a,e){var n=new P(2);return n[0]=a,n[1]=e,n}function Ql(a,e,n){return a[0]=e,a[1]=n,a}function Ss(a,e,n){return a[0]=e[0]+n[0],a[1]=e[1]+n[1],a}function mo(a,e,n){return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a}function Ko(a,e,n){return a[0]=e[0]*n,a[1]=e[1]*n,a}function Gs(a){var e=a[0],n=a[1];return Math.sqrt(e*e+n*n)}function ec(a,e){var n=e[0],l=e[1],u=n*n+l*l;return u>0&&(u=1/Math.sqrt(u)),a[0]=e[0]*u,a[1]=e[1]*u,a}function po(a,e){return a[0]*e[0]+a[1]*e[1]}Xo(),Xo(),H();var qa,Fr,tc=mo;function jo(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}yr();var go=(function(){if(Fr)return qa;function a(e,n,l,u){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=u}return Fr=1,qa=a,a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,u=0;u<8;u++){var g=this.sampleCurveX(l)-e;if(Math.abs(g)<n)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=g/_}var w=0,A=1;for(l=e,u=0;u<20&&(g=this.sampleCurveX(l),!(Math.abs(g-e)<n));u++)e>g?w=l:A=l,l=.5*(A-w)+w;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},qa})(),wu=jo(go);function Pe(a,e){this.x=a,this.y=e}function zt(a,e){if(Array.isArray(a)){if(!Array.isArray(e)||a.length!==e.length)return!1;for(let n=0;n<a.length;n++)if(!zt(a[n],e[n]))return!1;return!0}if(typeof a=="object"&&a!==null&&e!==null){if(typeof e!="object"||Object.keys(a).length!==Object.keys(e).length)return!1;for(const n in a)if(!zt(a[n],e[n]))return!1;return!0}return a===e}Pe.prototype={clone(){return new Pe(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,e){return this.clone()._rotateAround(a,e)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const e=a.x-this.x,n=a.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,e){return Math.atan2(this.x*e-this.y*a,this.x*a+this.y*e)},_matMult(a){const e=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=e,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const e=Math.cos(a),n=Math.sin(a),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround(a,e){const n=Math.cos(a),l=Math.sin(a),u=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Pe},Pe.convert=function(a){if(a instanceof Pe)return a;if(Array.isArray(a))return new Pe(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new Pe(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const Qt=Math.PI/180,Ei=180/Math.PI;function ui(a){return a*Qt}function qi(a){return a*Ei}const Si=[[0,0],[1,0],[1,1],[0,1]];function pn(a){if(a<=0)return 0;if(a>=1)return 1;const e=a*a,n=e*a;return 4*(a<.5?n:3*(a-e)+n-.75)}function kn(a,e,n,l){const u=new wu(a,e,n,l);return function(g){return u.solve(g)}}const Ze=kn(.25,.1,.25,1);function ie(a,e,n){return Math.min(n,Math.max(e,a))}function ue(a,e,n){return(n=ie((n-a)/(e-a),0,1))*n*(3-2*n)}function Te(a,e,n){const l=n-e,u=((a-e)%l+l)%l+e;return u===e?n:u}function Fe(a,e,n){if(!a.length)return n(null,[]);let l=a.length;const u=new Array(a.length);let g=null;a.forEach(((_,w)=>{e(_,((A,z)=>{A&&(g=A),u[w]=z,--l==0&&n(g,u)}))}))}let Be=1;function qe(){return Be++}function rt(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log2(a)))}function Je(a,e){a.forEach((n=>{e[n]&&(e[n]=e[n].bind(e))}))}function ot(a,e,n){const l={};for(const u in a)l[u]=e.call(this,a[u],u,a);return l}function Rt(a,e,n){const l={};for(const u in a)e.call(this,a[u],u,a)&&(l[u]=a[u]);return l}function St(a){return Array.isArray(a)?a.map(St):typeof a=="object"&&a?ot(a,St):a}function ci(a,e){for(let n=0;n<a.length;n++)if(e.indexOf(a[n])>=0)return!0;return!1}const Oi={};function mi(a){Oi[a]||(typeof console<"u"&&console.warn(a),Oi[a]=!0)}function tn(a,e,n){return(n.y-a.y)*(e.x-a.x)>(e.y-a.y)*(n.x-a.x)}function rn(a){let e=0;for(let n,l,u=0,g=a.length,_=g-1;u<g;_=u++)n=a[u],l=a[_],e+=(l.x-n.x)*(n.y+l.y);return e}function Zi([a,e,n]){const l=ui(e+90),u=ui(n);return{x:a*Math.cos(l)*Math.sin(u),y:a*Math.sin(l)*Math.sin(u),z:a*Math.cos(u),azimuthal:e,polar:n}}function Ui(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function $n(a){const e={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,l,u,g)=>{const _=u||g;return e[l]=!_||_.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Ia=null;function Ta(a,e){return[a[4*e],a[4*e+1],a[4*e+2],a[4*e+3]]}function Yn(a,e,n,l){for(;e<n;){const u=e+n>>1;a[u]<l?e=u+1:n=u}return e}function fn(a,e,n,l){for(;e<n;){const u=e+n>>1;a[u]<=l?e=u+1:n=u}return e}function an(a){return a>0?1/(1.001-a):1+a}function ea(a){return a>0?1-1/(1.001-a):-a}function ra(a,e,n){return(a-e.min)*(n.max-n.min)/(e.max-e.min)+n.min}const Sn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Sn.API_URL)return null;try{const a=new URL(Sn.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Wa(a){return Sn.API_URL_REGEX.test(a)}function zn(a){return Sn.API_SPRITE_REGEX.test(a)}let ka,qs,rs,er,zo,Jr;function ss(){return ka==null&&(ka=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ka}const xa={now:()=>er!==void 0?er:performance.now(),setNow(a){er=a},restoreNow(){er=void 0},frame(a){const e=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(a,e=0){const{width:n,height:l}=a;zo||(zo=document.createElement("canvas"));const u=zo.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>zo.width||l>zo.height)&&(zo.width=n,zo.height=l),u.clearRect(-e,-e,n+2*e,l+2*e),u.drawImage(a,0,0,n,l),u.getImageData(-e,-e,n+2*e,l+2*e)},resolveURL:a=>(qs||(qs=document.createElement("a")),qs.href=a,qs.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(rs==null&&(rs=window.matchMedia("(prefers-reduced-motion: reduce)")),rs.matches)},hasCanvasFingerprintNoise(){if(Jr!==void 0)return Jr;if(!ss())return Jr=!1,!1;const a=new OffscreenCanvas(85,1),e=a.getContext("2d",{willReadFrequently:!0});let n=0;for(let u=0;u<a.width;++u)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(u,0,1,1);const l=e.getImageData(0,0,a.width,a.height);n=0;for(let u=0;u<l.data.length;++u)if(u%4!=3&&n++!==l.data[u])return Jr=!0,!0;return Jr=!1,!1}};function Io(a,e){const n=a.indexOf("?");if(n<0)return`${a}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(a.slice(n));for(const u in e)l.set(u,e[u]);return`${a.slice(0,n)}?${l.toString()}`}function _o(a,e={persistentParams:[]}){const n=a.indexOf("?");if(n<0)return a;const l=new URLSearchParams,u=new URLSearchParams(a.slice(n));for(const _ of e.persistentParams){const w=u.get(_);w&&l.set(_,w)}const g=l.toString();return`${a.slice(0,n)}${g.length>0?`?${g}`:""}`}const Vc="mapbox-tiles";let Su=500,hc=50;const fc=["language","worldview","jobid"];let dl,Ps;function io(){try{return caches}catch{}}function yo(){const a=io();a&&dl==null&&(dl=a.open(Vc))}let Ws=1/0;const no={supported:!1,testSupport:function(a){!sa&&Hc&&(Zs?Dl(a):vo=a)}};let vo,Hc,sa=!1,Zs=!1;const ar=typeof self<"u"?self:{};function Dl(a){const e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Hc),a.isContextLost())return;no.supported=!0}catch{}a.deleteTexture(e),sa=!0}ar.document&&(Hc=ar.document.createElement("img"),Hc.onload=function(){vo&&Dl(vo),vo=null,Zs=!0},Hc.onerror=function(){sa=!0,vo=null},Hc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const mc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(mc);class ds extends Error{constructor(e,n,l){n===401&&Wa(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Jo=Ui()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,xo=function(a,e){if(!(/^file:/.test(n=a.url)||/^file:/.test(Jo())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(l,u){const g=new AbortController,_=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Jo(),referrerPolicy:l.referrerPolicy,signal:g.signal});let w=!1,A=!1;const z=(O=_.url).indexOf("sku=")>0&&Wa(O);var O;l.type==="json"&&_.headers.set("Accept","application/json");const F=(q,Z,ee)=>{if(A)return;if(q&&q.message!=="SecurityError"&&mi(q.toString()),Z&&ee)return U(Z);const le=Date.now();fetch(_).then((oe=>{if(oe.ok){const fe=z?oe.clone():null;return U(oe,fe,le)}return u(new ds(oe.statusText,oe.status,l.url))})).catch((oe=>{oe.name!=="AbortError"&&u(new Error(`${oe.message} ${l.url}`))}))},U=(q,Z,ee)=>{(l.type==="arrayBuffer"?q.arrayBuffer():l.type==="json"?q.json():q.text()).then((le=>{A||(Z&&ee&&(function(oe,fe,_e){if(yo(),dl==null)return;const be=$n(fe.headers.get("Cache-Control")||"");if(be["no-store"])return;const Oe={status:fe.status,statusText:fe.statusText,headers:new Headers};fe.headers.forEach(((Ge,et)=>Oe.headers.set(et,Ge))),be["max-age"]&&Oe.headers.set("Expires",new Date(_e+1e3*be["max-age"]).toUTCString());const Ie=Oe.headers.get("Expires");if(!Ie||new Date(Ie).getTime()-_e<42e4)return;let Ue=_o(oe.url,{persistentParams:fc});if(fe.status===206){const Ge=oe.headers.get("Range");if(!Ge)return;Oe.status=200,Ue=Io(Ue,{range:Ge})}(function(Ge,et){if(Ps===void 0)try{new Response(new ReadableStream),Ps=!0}catch{Ps=!1}Ps?et(Ge.body):Ge.blob().then(et).catch((yt=>mi(yt.message)))})(fe,(Ge=>{const et=new Response((yt=fe.status)!==200&&yt!==404&&[101,103,204,205,304].includes(yt)?null:Ge,Oe);var yt;yo(),dl?.then((nt=>nt.put(Ue,et))).catch((nt=>mi(nt.message)))}))})(_,Z,ee),w=!0,u(null,le,q.headers))})).catch((le=>{A||u(new Error(le.message))}))};return z?(function(q,Z){if(yo(),dl==null)return Z(null);dl.then((ee=>{let le=_o(q.url,{persistentParams:fc});const oe=q.headers.get("Range");oe&&(le=Io(le,{range:oe})),ee.match(le).then((fe=>{const _e=(function(be){if(!be)return!1;const Oe=new Date(be.headers.get("Expires")||0),Ie=$n(be.headers.get("Cache-Control")||"");return Number(Oe)>Date.now()&&!Ie["no-cache"]})(fe);ee.delete(le).catch(Z),_e&&ee.put(le,fe.clone()).catch(Z),Z(null,fe,_e)})).catch(Z)})).catch(Z)})(_,F):F(null,null),{cancel:()=>{A=!0,w||g.abort()}}})(a,e);if(Ui(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,e,void 0,!0)}var n;return(function(l,u){const g=new XMLHttpRequest;g.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const _ in l.headers)g.setRequestHeader(_,l.headers[_]);return l.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=l.credentials==="include",g.onerror=()=>{u(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let _=g.response;if(l.type==="json")try{_=JSON.parse(g.response)}catch(A){return u(A)}const w=new Headers;g.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((A=>{const z=A.split(": "),O=z.shift(),F=z.join(": ");w.append(O,F)})),u(null,_,w)}else u(new ds(g.statusText,g.status,l.url))},g.send(l.body),{cancel:()=>g.abort()}})(a,e)},Ro=function(a,e){return xo(Object.assign(a,{type:"arrayBuffer"}),e)};function Xu(a){const e=document.createElement("a");return e.href=a,e.protocol===location.protocol&&e.host===location.host}const os="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Do,Vn;Do=[],Vn=0;const js=function(a,e){if(no.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Vn>=Sn.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Do.push(g),g}Vn++;let n=!1;const l=()=>{if(!n)for(n=!0,Vn--;Do.length&&Vn<Sn.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Do.shift(),{requestParameters:_,callback:w,cancelled:A}=g;A||(g.cancel=js(_,w).cancel)}},u=Ro(a,((g,_,w)=>{l(),g?e(g):_&&(self.createImageBitmap?(function(A,z){const O=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(O).then((F=>{z(null,F)})).catch((F=>{z(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(_,((A,z)=>e(A,z,w))):(function(A,z){const O=new Image;O.onload=()=>{z(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame((()=>{O.src=os}))},O.onerror=()=>z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Blob([new Uint8Array(A)],{type:"image/png"});O.src=A.byteLength?URL.createObjectURL(F):os})(_,((A,z)=>e(A,z,w))))}));return{cancel:()=>{u.cancel(),l()}}};var pc,Yu,Gc,qc={exports:{}},Wc={exports:{}},Aa={exports:{}},Tu=(function(){if(Gc)return qc.exports;Gc=1;var a=(pc||(pc=1,Wc.exports=function(n,l){var u,g,_,w,A,z,O,F;for(g=n.length-(u=3&n.length),_=l,A=3432918353,z=461845907,F=0;F<g;)O=255&n.charCodeAt(F)|(255&n.charCodeAt(++F))<<8|(255&n.charCodeAt(++F))<<16|(255&n.charCodeAt(++F))<<24,++F,_=27492+(65535&(w=5*(65535&(_=(_^=O=(65535&(O=(O=(65535&O)*A+(((O>>>16)*A&65535)<<16)&4294967295)<<15|O>>>17))*z+(((O>>>16)*z&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(O=0,u){case 3:O^=(255&n.charCodeAt(F+2))<<16;case 2:O^=(255&n.charCodeAt(F+1))<<8;case 1:_^=O=(65535&(O=(O=(65535&(O^=255&n.charCodeAt(F)))*A+(((O>>>16)*A&65535)<<16)&4294967295)<<15|O>>>17))*z+(((O>>>16)*z&65535)<<16)&4294967295}return _^=n.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Wc.exports),e=(Yu||(Yu=1,Aa.exports=function(n,l){for(var u,g=n.length,_=l^g,w=0;g>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),g-=4,++w;switch(g){case 3:_^=(255&n.charCodeAt(w+2))<<16;case 2:_^=(255&n.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&n.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Aa.exports);return qc.exports=a,qc.exports.murmur3=a,qc.exports.murmur2=e,qc.exports})(),Xs=jo(Tu);class bo{constructor(e,...n){Object.assign(this,n[0]||{}),this.type=e}}class Ku extends bo{constructor(e,n={}){super("error",Object.assign({error:e},n))}}function bf(a,e,n){n[a]&&n[a].indexOf(e)!==-1||(n[a]=n[a]||[],n[a].push(e))}function ic(a,e,n){if(n&&n[a]){const l=n[a].indexOf(e);l!==-1&&n[a].splice(l,1)}}class gc{on(e,n){return this._listeners=this._listeners||{},bf(e,n,this._listeners),this}off(e,n){return ic(e,n,this._listeners),ic(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},bf(e,n,this._oneTimeListeners),this):new Promise((l=>{this.once(e,l)}))}fire(e,n){const l=typeof e=="string"?new bo(e,n):e,u=l.type;if(this.listens(u)){l.target=this;const g=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const A of g)A.call(this,l);const _=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const A of _)ic(u,A,this._oneTimeListeners),A.call(this,l);const w=this._eventedParent;if(w){const A=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,A),w.fire(l)}}else l instanceof Ku&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}class zs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new zs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[n,l]=e.split("");return new zs({name:n,iconsetId:l})}static isEqual(e,n){return e.name===n.name&&e.iconsetId===n.iconsetId}toString(){return zs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var kh,Fd={},Lo=(function(){if(kh)return Fd;kh=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(g){return(g=Math.round(g))<0?0:g>255?255:g}function n(g){return e(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function l(g){return(_=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:_>1?1:_;var _}function u(g,_,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?g+(_-g)*w*6:2*w<1?_:3*w<2?g+(_-g)*(2/3-w)*6:g}try{Fd.parseCSSColor=function(g){var _,w=g.replace(/ /g,"").toLowerCase();if(w in a)return a[w].slice();if(w[0]==="#")return w.length===4?(_=parseInt(w.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:w.length===7&&(_=parseInt(w.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var A=w.indexOf("("),z=w.indexOf(")");if(A!==-1&&z+1===w.length){var O=w.substr(0,A),F=w.substr(A+1,z-(A+1)).split(","),U=1;switch(O){case"rgba":if(F.length!==4)return null;U=l(F.pop());case"rgb":return F.length!==3?null:[n(F[0]),n(F[1]),n(F[2]),U];case"hsla":if(F.length!==4)return null;U=l(F.pop());case"hsl":if(F.length!==3)return null;var q=(parseFloat(F[0])%360+360)%360/360,Z=l(F[1]),ee=l(F[2]),le=ee<=.5?ee*(Z+1):ee+Z-ee*Z,oe=2*ee-le;return[e(255*u(oe,le,q+1/3)),e(255*u(oe,le,q)),e(255*u(oe,le,q-1/3)),U];default:return null}}return null}}catch{}return Fd})();class ha{constructor(e,n,l,u=1){this.r=e,this.g=n,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof ha)return e;if(typeof e!="string")return;const n=Lo.parseCSSColor(e);return n?new ha(n[0]/255,n[1]/255,n[2]/255,n[3]):void 0}toString(){const[e,n,l,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*l)},${u})`}toNonPremultipliedRenderColor(e){const{r:n,g:l,b:u,a:g}=this;return new Em(e,n,l,u,g)}toPremultipliedRenderColor(e){const{r:n,g:l,b:u,a:g}=this;return new wf(e,n*g,l*g,u*g,g)}clone(){return new ha(this.r,this.g,this.b,this.a)}}class hl{constructor(e,n,l,u,g,_=!1){if(this.premultiplied=!1,this.premultiplied=_,e){const w=e.image.height,A=w*w;this.premultiplied?(n=g===0?0:n/g*(w-1),l=g===0?0:l/g*(w-1),u=g===0?0:u/g*(w-1)):(n*=w-1,l*=w-1,u*=w-1);const z=Math.floor(n),O=Math.floor(l),F=Math.floor(u),U=Math.ceil(n),q=Math.ceil(l),Z=Math.ceil(u),ee=n-z,le=l-O,oe=u-F,fe=e.image.data,_e=4*(z+O*A+F*w),be=4*(z+O*A+Z*w),Oe=4*(z+q*A+F*w),Ie=4*(z+q*A+Z*w),Ue=4*(U+O*A+F*w),Ge=4*(U+O*A+Z*w),et=4*(U+q*A+F*w),yt=4*(U+q*A+Z*w);if(_e<0||yt>=fe.length)throw new Error("out of range");this.r=$i($i($i(fe[_e],fe[be],oe),$i(fe[Oe],fe[Ie],oe),le),$i($i(fe[Ue],fe[Ge],oe),$i(fe[et],fe[yt],oe),le),ee)/255*(this.premultiplied?g:1),this.g=$i($i($i(fe[_e+1],fe[be+1],oe),$i(fe[Oe+1],fe[Ie+1],oe),le),$i($i(fe[Ue+1],fe[Ge+1],oe),$i(fe[et+1],fe[yt+1],oe),le),ee)/255*(this.premultiplied?g:1),this.b=$i($i($i(fe[_e+2],fe[be+2],oe),$i(fe[Oe+2],fe[Ie+2],oe),le),$i($i(fe[Ue+2],fe[Ge+2],oe),$i(fe[et+2],fe[yt+2],oe),le),ee)/255*(this.premultiplied?g:1),this.a=g}else this.r=n,this.g=l,this.b=u,this.a=g}toArray(){const{r:e,g:n,b:l,a:u}=this;return[255*e,255*n,255*l,u]}toHslaArray(){let{r:e,g:n,b:l,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];const Z=1/u;e*=Z,n*=Z,l*=Z}const g=Math.min(Math.max(e,0),1),_=Math.min(Math.max(n,0),1),w=Math.min(Math.max(l,0),1),A=Math.min(g,_,w),z=Math.max(g,_,w),O=z-A,F=.5*(A+z);if(O===0)return[0,0,100*F,u];const U=F>.5?O/(2-z-A):O/(z+A);let q;switch(z){case g:q=60*((_-w)/O+(_<w?6:0));break;case _:q=60*((w-g)/O+2);break;default:q=60*((g-_)/O+4)}return[q,100*U,100*F,u]}toArray01(){const{r:e,g:n,b:l,a:u}=this;return[e,n,l,u]}toArray01Scaled(e){const{r:n,g:l,b:u}=this;return[n*e,l*e,u*e]}toArray01Linear(){const{r:e,g:n,b:l,a:u}=this;return[Math.pow(e,2.2),Math.pow(n,2.2),Math.pow(l,2.2),u]}}class Em extends hl{constructor(e,n,l,u,g){super(e,n,l,u,g,!1)}}class wf extends hl{constructor(e,n,l,u,g){super(e,n,l,u,g,!0)}}function $i(a,e,n){return a*(1-n)+e*n}function Eh(a,e,n){return a.map(((l,u)=>$i(l,e[u],n)))}ha.black=new ha(0,0,0,1),ha.white=new ha(1,1,1,1),ha.transparent=new ha(0,0,0,0),ha.red=new ha(1,0,0,1),ha.blue=new ha(0,0,1,1);var Zc=Object.freeze({__proto__:null,array:Eh,color:function(a,e,n){return new ha($i(a.r,e.r,n),$i(a.g,e.g,n),$i(a.b,e.b,n),$i(a.a,e.a,n))},number:$i});class Oo extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Ju{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,u]of n)this.bindings[l]=u}concat(e){return new Ju(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const fl={kind:"null"},Ii={kind:"number"},Nn={kind:"string"},pa={kind:"boolean"},Ys={kind:"color"},nc={kind:"object"},na={kind:"value"},Bd={kind:"collator"},Xc={kind:"formatted"},Ll={kind:"resolvedImage"};function Is(a,e){return{kind:"array",itemType:a,N:e}}function or(a){if(a.kind==="array"){const e=or(a.itemType);return typeof a.N=="number"?`array<${e}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${e}>`}return a.kind}const ao=[fl,Ii,Nn,pa,Ys,Xc,nc,Is(na),Ll];function _c(a,e){if(e.kind==="error")return null;if(a.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!_c(a.itemType,e.itemType))&&(typeof a.N!="number"||a.N===e.N))return null}else{if(a.kind===e.kind)return null;if(a.kind==="value"){for(const n of ao)if(!_c(n,e))return null}}return`Expected ${or(a)} but found ${or(e)} instead.`}function Ud(a,e){return e.some((n=>n.kind===a.kind))}function Qu(a,e){return e.some((n=>n==="null"?a===null:n==="array"?Array.isArray(a):n==="object"?a&&!Array.isArray(a)&&typeof a=="object":n===typeof a))}function ku(a,e){return a.kind==="array"&&e.kind==="array"?a.N===e.N&&ku(a.itemType,e.itemType):a.kind===e.kind}class ed{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $d{constructor(e,n,l,u,g){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=l,this.fontStack=u,this.textColor=g}}class ls{constructor(e){this.sections=e}static fromString(e){return new ls([new $d(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof ls?e:ls.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){const u=n.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(n.text);const l={};n.fontStack&&(l["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(l["font-scale"]=n.scale),n.textColor&&(l["text-color"]=["rgba"].concat(n.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class ac{constructor(e,n={}){this.id=zs.from(e),this.params=n.params,this.sx=n.sx||1,this.sy=n.sy||1}toString(){return JSON.stringify(this)}static parse(e){let n,l,u,g;try{({id:n,params:l,sx:u,sy:g}=JSON.parse(e)||{})}catch{return null}return n?new ac(n,{params:l,sx:u,sy:g}):null}scaleSelf(e,n=e){return this.sx*=e,this.sy*=n,this}}class ro{constructor(e,n,l,u,g=!1){this.primaryId=zs.from(e),this.primaryOptions=n,l&&(this.secondaryId=zs.from(l)),this.secondaryOptions=u,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ac(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ac(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?ro.build({name:e}):e}static build(e,n,l,u){return!e||typeof e=="object"&&!("name"in e)?null:new ro(e,l,n,u)}}function Ks(a,e,n,l){return typeof a=="number"&&a>=0&&a<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[a,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[a,e,n,l]:[a,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ml(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof ha||a instanceof ed||a instanceof ls||a instanceof ro)return!0;if(Array.isArray(a)){for(const e of a)if(!ml(e))return!1;return!0}if(typeof a=="object"){for(const e in a)if(!ml(a[e]))return!1;return!0}return!1}function Hr(a){if(a===null)return fl;if(typeof a=="string")return Nn;if(typeof a=="boolean")return pa;if(typeof a=="number")return Ii;if(a instanceof ha)return Ys;if(a instanceof ed)return Bd;if(a instanceof ls)return Xc;if(a instanceof ro)return Ll;if(Array.isArray(a)){const e=a.length;let n;for(const l of a){const u=Hr(l);if(n){if(n===u)continue;n=na;break}n=u}return Is(n||na,e)}return nc}function Br(a){const e=typeof a;return a===null?"":e==="string"||e==="number"||e==="boolean"?String(a):a instanceof ls||a instanceof ro||a instanceof ha?a.toString():JSON.stringify(a)}class Qo{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ml(e[1]))return n.error("invalid value");const l=e[1];let u=Hr(l);const g=n.expectedType;return u.kind!=="array"||u.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(u=g),new Qo(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ha?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ls?this.value.serialize():this.value}}class wr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const td={string:Nn,number:Ii,boolean:pa,object:nc};class so{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,u=1;const g=e[0];if(g==="array"){let w,A;if(e.length>2){const z=e[1];if(typeof z!="string"||!(z in td)||z==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=td[z],u++}else w=na;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);A=e[2],u++}l=Is(w,A)}else l=td[g];const _=[];for(;u<e.length;u++){const w=n.parse(e[u],u,na);if(!w)return null;_.push(w)}return new so(l,_)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!_c(this.type,Hr(l)))return l;if(n===this.args.length-1)throw new wr(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${or(Hr(l))} but was expected to be of type ${or(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){n.push(l.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map((l=>l.serialize())))}}class pl{constructor(e){this.type=Xc,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const u=[];let g=!1;for(let _=1;_<=e.length-1;++_){const w=e[_];if(g&&typeof w=="object"&&!Array.isArray(w)){g=!1;let A=null;if(w["font-scale"]&&(A=n.parseObjectValue(w["font-scale"],_,"font-scale",Ii),!A))return null;let z=null;if(w["text-font"]&&(z=n.parseObjectValue(w["text-font"],_,"text-font",Is(Nn)),!z))return null;let O=null;if(w["text-color"]&&(O=n.parseObjectValue(w["text-color"],_,"text-color",Ys),!O))return null;const F=u[u.length-1];F.scale=A,F.font=z,F.textColor=O}else{const A=n.parse(e[_],_,na);if(!A)return null;const z=A.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,u.push({content:A,scale:null,font:null,textColor:null})}}return new pl(u)}evaluate(e){return new ls(this.sections.map((n=>{const l=n.content.evaluate(e);return ku(Hr(l),Ll)?new $d("",l,null,null,null):new $d(Br(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const l={};n.scale&&(l["font-scale"]=n.scale.serialize()),n.font&&(l["text-font"]=n.font.serialize()),n.textColor&&(l["text-color"]=n.textColor.serialize()),e.push(l)}return e}}class sn{constructor(e,n,l,u){this._imageWarnHistory={},this.type=Ll,this.namePrimary=e,this.nameSecondary=n,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let l=1;const u=[];function g(){if(l<e.length){const w=n.parse(e[l],l++,Nn);return w?(u.push({image:w,options:{}}),!0):(n.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(l<e.length){const A=e[l];if((w=A)===null||typeof w!="object"||Array.isArray(w))return!0;const z=A.params,O=A.iconset,F=n.concat(l);if(!z&&!O)return l++,!0;if(z){if(typeof z!="object"||z.constructor!==Object)return F.error('Image options "params" should be an object'),!1;const U={},q=F.concat(void 0,"params");for(const Z in z){if(!Z)return q.error("Image parameter name should be non-empty"),!1;const ee=q.concat(void 0,Z).parse(z[Z],void 0,Ys,void 0,{typeAnnotation:"coerce"});if(!ee)return!1;U[Z]=ee}u[u.length-1].options.params=U}if(O){if(typeof O!="object"||O.constructor!==Object)return F.error('Image options "iconset" should be an object'),!1;if(!O.id)return F.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=O}return l++,!0}var w;return!0}for(let w=0;w<2;w++)if(!g()||!_())return;return new sn(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,n){const l={};if(n){for(const u in n)if(n[u])try{l[u]=n[u].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const n={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=ro.build(n,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const g=u.getPrimary().id;if(u.available=e.availableImages.some((_=>zs.isEqual(_,g))),u.available){const _=u.getSecondary()?u.getSecondary().id:null;_&&(u.available=e.availableImages.some((w=>zs.isEqual(w,_))))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const n in this.paramsPrimary)this.paramsPrimary[n]&&e(this.paramsPrimary[n]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const n in this.paramsSecondary)this.paramsSecondary[n]&&e(this.paramsSecondary[n])}outputDefined(){return!1}serializeOptions(e,n){const l={};if(n&&(l.iconset={id:n}),e){l.params={};for(const u in e)e[u]&&(l.params[u]=e[u].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const n=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);n&&e.push(n)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const n=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);n&&e.push(n)}return e}}function Pi(a){return Ki(a)?"string":Eu(a)?"number":id(a)?"boolean":Array.isArray(a)?"array":a===null?"null":gl(a)?"object":typeof a}function gl(a){return a!=null&&!Array.isArray(a)&&typeof a!="function"&&!(a instanceof String||a instanceof Number||a instanceof Boolean)&&typeof a=="object"}function Ki(a){return typeof a=="string"||a instanceof String}function Eu(a){return typeof a=="number"||a instanceof Number}function id(a){return typeof a=="boolean"||a instanceof Boolean}const en={"to-boolean":pa,"to-color":Ys,"to-number":Ii,"to-string":Nn};class Rs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0],u=[];let g=fl;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const _=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);g=Is(n.expectedType.itemType,_)}else{if(!(_>0&&ml(e[1][0])))return null;g=Is(Hr(e[1][0]),_)}for(let w=0;w<_;w++){const A=e[1][w];let z;if(Array.isArray(A))z=n.parse(A,void 0,g.itemType);else{const O=Pi(A);if(O!==g.itemType.kind)return n.error(`Expected ${g.itemType.kind} but found ${O}.`);z=n.registry.literal.parse(["literal",A===void 0?null:A],n)}if(!z)return null;u.push(z)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");g=en[l];for(let _=1;_<e.length;_++){const w=n.parse(e[_],_,na);if(!w)return null;u.push(w)}}return new Rs(g,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,l;for(const u of this.args){if(n=u.evaluate(e),l=null,n instanceof ha)return n;if(typeof n=="string"){const g=e.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ks(n[0],n[1],n[2],n[3]),!l))return new ha(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new wr(l||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new wr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?ls.fromString(Br(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ro.build(Br(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((n=>n.evaluate(e))):Br(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new pl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new sn(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((n=>{e.push(n.serialize())})),e}}const Sf=["Unknown","Point","LineString","Polygon"];class yc{constructor(e,n,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Sf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*n-e[0])+this.featureDistanceData.bearing[1]*(u*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=ha.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Sr{constructor(e,n,l,u,g){this.name=e,this.type=n,this._evaluate=l,this.args=u,this._overloadIndex=g}evaluate(e){if(!this._evaluate){const n=Sr.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,n){const l=e[0],u=Sr.definitions[l];if(!u)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,w=[];let A=null,z=-1;for(const[O,F]of _){if(Array.isArray(O)&&O.length!==e.length-1)continue;w.push(O),z++,A=new wc(n.registry,n.path,null,n.scope,void 0,n._scope,n.options,n.iconImageUseTheme);const U=[];let q=!1;for(let Z=1;Z<e.length;Z++){const ee=e[Z],le=Array.isArray(O)?O[Z-1]:O.type,oe=A.parse(ee,1+U.length,le);if(!oe){q=!0;break}U.push(oe)}if(!q)if(Array.isArray(O)&&O.length!==U.length)A.error(`Expected ${O.length} arguments, but found ${U.length} instead.`);else{for(let Z=0;Z<U.length;Z++){const ee=Array.isArray(O)?O[Z]:O.type,le=U[Z];A.concat(Z+1).checkSubtype(ee,le.type)}if(A.errors.length===0)return new Sr(l,g,F,U,z)}}if(w.length===1)n.errors.push(...A.errors);else{const O=(w.length?w:_.map((([U])=>U))).map(oo).join(" | "),F=[];for(let U=1;U<e.length;U++){const q=n.parse(e[U],1+F.length);if(!q)return null;F.push(or(q.type))}n.error(`Expected arguments of type ${O}, but found (${F.join(", ")}) instead.`)}return null}static register(e,n){Sr.definitions=n;for(const l in n)e[l]=Sr}}function oo(a){return Array.isArray(a)?`(${a.map(or).join(", ")})`:`(${or(a.type)}...)`}class Ir{constructor(e,n,l){this.type=Bd,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const u=l["case-sensitive"]===void 0?n.parse(!1,1,pa):n.parseObjectValue(l["case-sensitive"],1,"case-sensitive",pa);if(!u)return null;const g=l["diacritic-sensitive"]===void 0?n.parse(!1,1,pa):n.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",pa);if(!g)return null;let _=null;return l.locale&&(_=n.parseObjectValue(l.locale,1,"locale",Nn),!_)?null:new Ir(u,g,_)}evaluate(e){return new ed(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function nd(a,e,n=0,l=a.length-1,u=Au){for(;l>n;){if(l-n>600){const A=l-n+1,z=e-n+1,O=Math.log(A),F=.5*Math.exp(2*O/3),U=.5*Math.sqrt(O*F*(A-F)/A)*(z-A/2<0?-1:1);nd(a,e,Math.max(n,Math.floor(e-z*F/A+U)),Math.min(l,Math.floor(e+(A-z)*F/A+U)),u)}const g=a[e];let _=n,w=l;for(No(a,n,e),u(a[l],g)>0&&No(a,n,l);_<w;){for(No(a,_,w),_++,w--;u(a[_],g)<0;)_++;for(;u(a[w],g)>0;)w--}u(a[n],g)===0?No(a,n,w):(w++,No(a,w,l)),w<=e&&(n=w+1),e<=w&&(l=w-1)}}function No(a,e,n){const l=a[e];a[e]=a[n],a[n]=l}function Au(a,e){return a<e?-1:a>e?1:0}function _l(a){let e=0;for(let n,l,u=0,g=a.length,_=g-1;u<g;_=u++)n=a[u],l=a[_],e+=(l.x-n.x)*(n.y+l.y);return e}function wo(a,e){a[0]=Math.min(a[0],e[0]),a[1]=Math.min(a[1],e[1]),a[2]=Math.max(a[2],e[0]),a[3]=Math.max(a[3],e[1])}function So(a,e){return!(a[0]<=e[0]||a[2]>=e[2]||a[1]<=e[1]||a[3]>=e[3])}function ad(a,e,n){const l=a[0]-e[0],u=a[1]-e[1],g=a[0]-n[0],_=a[1]-n[1];return l*_-g*u==0&&l*g<=0&&u*_<=0}function yl(a,e,n=!1){let l=!1;for(let w=0,A=e.length;w<A;w++){const z=e[w];for(let O=0,F=z.length,U=F-1;O<F;U=O++){const q=z[U],Z=z[O];if(ad(a,q,Z))return n;(g=q)[1]>(u=a)[1]!=(_=Z)[1]>u[1]&&u[0]<(_[0]-g[0])*(u[1]-g[1])/(_[1]-g[1])+g[0]&&(l=!l)}}var u,g,_;return l}function Yc(a,e,n,l){const u=l[0]-n[0],g=l[1]-n[1],_=(a[0]-n[0])*g-u*(a[1]-n[1]),w=(e[0]-n[0])*g-u*(e[1]-n[1]);return _>0&&w<0||_<0&&w>0}function rd(a,e,n,l){return(u=[l[0]-n[0],l[1]-n[1]])[0]*(g=[e[0]-a[0],e[1]-a[1]])[1]-u[1]*g[0]!=0&&!(!Yc(a,e,n,l)||!Yc(n,l,a,e));var u,g}function Ds(a){const e=new Pe(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new Pe(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of a[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),n.x<l.x&&(n.x=l.x),n.y<l.y&&(n.y=l.y);return{min:e,max:n}}const el=8192;function Ah(a,e){const n=(180+a[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*el),Math.round(l*u*el)]}function Ch(a,e){for(let n=0;n<e.length;n++)if(yl(a,e[n]))return!0;return!1}function Kc(a,e,n){for(const l of n)for(let u=0,g=l.length,_=g-1;u<g;_=u++)if(rd(a,e,l[_],l[u]))return!0;return!1}function Tf(a,e){for(let n=0;n<a.length;++n)if(!yl(a[n],e))return!1;for(let n=0;n<a.length-1;++n)if(Kc(a[n],a[n+1],e))return!1;return!0}function vl(a,e){for(let n=0;n<e.length;n++)if(Tf(a,e[n]))return!0;return!1}function Cu(a,e,n){const l=[];for(let u=0;u<a.length;u++){const g=[];for(let _=0;_<a[u].length;_++){const w=Ah(a[u][_],n);wo(e,w),g.push(w)}l.push(g)}return l}function Jc(a,e,n){const l=[];for(let u=0;u<a.length;u++){const g=Cu(a[u],e,n);l.push(g)}return l}function Vd(a,e,n,l){if(a[0]<n[0]||a[0]>n[2]){const u=.5*l;let g=a[0]-n[0]>u?-l:n[0]-a[0]>u?l:0;g===0&&(g=a[0]-n[2]>u?-l:n[2]-a[0]>u?l:0),a[0]+=g}wo(e,a)}function Am(a,e,n,l){const u=Math.pow(2,l.z)*el,g=[l.x*el,l.y*el],_=[];if(!a)return _;for(const w of a)for(const A of w){const z=[A.x+g[0],A.y+g[1]];Vd(z,e,n,u),_.push(z)}return _}function sd(a,e,n,l){const u=Math.pow(2,l.z)*el,g=[l.x*el,l.y*el],_=[];if(!a)return _;for(const A of a){const z=[];for(const O of A){const F=[O.x+g[0],O.y+g[1]];wo(e,F),z.push(F)}_.push(z)}if(e[2]-e[0]<=u/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const A of _)for(const z of A)Vd(z,e,n,u)}var w;return _}class vc{constructor(e,n){this.type=pa,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ml(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){const g=l.features[u].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new vc(l,l.features[u].geometry)}else if(l.type==="Feature"){const u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new vc(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new vc(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const u=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if(l.type==="Polygon"){const w=Cu(l.coordinates,g,_),A=Am(n.geometry(),u,g,_);if(!So(u,g))return!1;for(const z of A)if(!yl(z,w))return!1}if(l.type==="MultiPolygon"){const w=Jc(l.coordinates,g,_),A=Am(n.geometry(),u,g,_);if(!So(u,g))return!1;for(const z of A)if(!Ch(z,w))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const u=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if(l.type==="Polygon"){const w=Cu(l.coordinates,g,_),A=sd(n.geometry(),u,g,_);if(!So(u,g))return!1;for(const z of A)if(!Tf(z,w))return!1}if(l.type==="MultiPolygon"){const w=Jc(l.coordinates,g,_),A=sd(n.geometry(),u,g,_);if(!So(u,g))return!1;for(const z of A)if(!vl(z,w))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ol={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Qr=1/298.257223563,Qc=Qr*(2-Qr),Ls=Math.PI/180;class Os{static fromTile(e,n,l){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),g=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Ls;return new Os(g,l)}static get units(){return Ol}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Ol[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Ol).join(", ")}`);const l=6378.137*Ls*(n?Ol[n]:1),u=Math.cos(e*Ls),g=1/(1-Qc*(1-u*u)),_=Math.sqrt(g);this.kx=l*_*u,this.ky=l*_*g*(1-Qc)}distance(e,n){const l=Js(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+u*u)}bearing(e,n){const l=Js(n[0]-e[0])*this.kx;return Math.atan2(l,(n[1]-e[1])*this.ky)/Ls}destination(e,n,l){const u=l*Ls;return this.offset(e,Math.sin(u)*n,Math.cos(u)*n)}offset(e,n,l){return[e[0]+n/this.kx,e[1]+l/this.ky]}lineDistance(e){let n=0;for(let l=0;l<e.length-1;l++)n+=this.distance(e[l],e[l+1]);return n}area(e){let n=0;for(let l=0;l<e.length;l++){const u=e[l];for(let g=0,_=u.length,w=_-1;g<_;w=g++)n+=Js(u[g][0]-u[w][0])*(u[g][1]+u[w][1])*(l?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let l=0;if(n<=0)return e[0];for(let u=0;u<e.length-1;u++){const g=e[u],_=e[u+1],w=this.distance(g,_);if(l+=w,l>n)return Fo(g,_,(n-(l-w))/w)}return e[e.length-1]}pointToSegmentDistance(e,n,l){let[u,g]=n,_=Js(l[0]-u)*this.kx,w=(l[1]-g)*this.ky;if(_!==0||w!==0){const A=(Js(e[0]-u)*this.kx*_+(e[1]-g)*this.ky*w)/(_*_+w*w);A>1?(u=l[0],g=l[1]):A>0&&(u+=_/this.kx*A,g+=w/this.ky*A)}return _=Js(e[0]-u)*this.kx,w=(e[1]-g)*this.ky,Math.sqrt(_*_+w*w)}pointOnLine(e,n){let l=1/0,u=e[0][0],g=e[0][1],_=0,w=0;for(let A=0;A<e.length-1;A++){let z=e[A][0],O=e[A][1],F=Js(e[A+1][0]-z)*this.kx,U=(e[A+1][1]-O)*this.ky,q=0;F===0&&U===0||(q=(Js(n[0]-z)*this.kx*F+(n[1]-O)*this.ky*U)/(F*F+U*U),q>1?(z=e[A+1][0],O=e[A+1][1]):q>0&&(z+=F/this.kx*q,O+=U/this.ky*q)),F=Js(n[0]-z)*this.kx,U=(n[1]-O)*this.ky;const Z=F*F+U*U;Z<l&&(l=Z,u=z,g=O,_=A,w=q)}return{point:[u,g],index:_,t:Math.max(0,Math.min(1,w))}}lineSlice(e,n,l){let u=this.pointOnLine(l,e),g=this.pointOnLine(l,n);if(u.index>g.index||u.index===g.index&&u.t>g.t){const z=u;u=g,g=z}const _=[u.point],w=u.index+1,A=g.index;!eu(l[w],_[0])&&w<=A&&_.push(l[w]);for(let z=w+1;z<=A;z++)_.push(l[z]);return eu(l[A],g.point)||_.push(g.point),_}lineSliceAlong(e,n,l){let u=0;const g=[];for(let _=0;_<l.length-1;_++){const w=l[_],A=l[_+1],z=this.distance(w,A);if(u+=z,u>e&&g.length===0&&g.push(Fo(w,A,(e-(u-z))/z)),u>=n)return g.push(Fo(w,A,(n-(u-z))/z)),g;u>e&&g.push(A)}return g}bufferPoint(e,n){const l=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-l,e[0]+u,e[1]+l]}bufferBBox(e,n){const l=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-l,e[2]+u,e[3]+l]}insideBBox(e,n){return Js(e[0]-n[0])>=0&&Js(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function eu(a,e){return a[0]===e[0]&&a[1]===e[1]}function Fo(a,e,n){const l=Js(e[0]-a[0]);return[a[0]+l*n,a[1]+(e[1]-a[1])*n]}function Js(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class tu{constructor(e=[],n=((l,u)=>l<u?-1:l>u?1:0)){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,u=n[e];for(;e>0;){const g=e-1>>1,_=n[g];if(l(u,_)>=0)break;n[e]=_,e=g}n[e]=u}_down(e){const{data:n,compare:l}=this,u=this.length>>1,g=n[e];for(;e<u;){let _=1+(e<<1);const w=_+1;if(w<this.length&&l(n[w],n[_])<0&&(_=w),l(n[_],g)>=0)break;n[e]=n[_],e=_}n[e]=g}}var Xt=8192;function iu(a,e){return e.dist-a.dist}const nu=100,Nl=50;function xc(a){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==a.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==a[n])return!1;return!0}function od(a){return a[1]-a[0]+1}function es(a,e){const n=a[1]>=a[0]&&a[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function ld(a,e){if(a[0]>a[1])return[null,null];const n=od(a);if(e){if(n===2)return[a,null];const l=Math.floor(n/2);return[[a[0],a[0]+l],[a[0]+l,a[1]]]}{if(n===1)return[a,null];const l=Math.floor(n/2)-1;return[[a[0],a[0]+l],[a[0]+l+1,a[1]]]}}function lo(a,e){const n=[1/0,1/0,-1/0,-1/0];if(!es(e,a.length))return n;for(let l=e[0];l<=e[1];++l)wo(n,a[l]);return n}function bc(a){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<a.length;++n)for(let l=0;l<a[n].length;++l)wo(e,a[n][l]);return e}function xl(a,e,n){if(xc(a)||xc(e))return NaN;let l=0,u=0;return a[2]<e[0]&&(l=e[0]-a[2]),a[0]>e[2]&&(l=a[0]-e[2]),a[1]>e[3]&&(u=a[1]-e[3]),a[3]<e[1]&&(u=e[1]-a[3]),n.distance([0,0],[l,u])}function Fl(a){return 360*a-180}function Mh(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Mu(a,e){const n=Math.pow(2,e.z),l=(a.y/Xt+e.y)/n;return[Fl((a.x/Xt+e.x)/n),Mh(l)]}function Pu(a,e){const n=[];for(let l=0;l<a.length;++l)n.push(Mu(a[l],e));return n}function ju(a,e,n){const l=n.pointOnLine(e,a).point;return n.distance(a,l)}function b(a,e,n,l,u){const g=n.slice(l[0],l[1]+1);let _=1/0;for(let w=e[0];w<=e[1];++w)if((_=Math.min(_,ju(a[w],g,u)))===0)return 0;return _}function I(a,e,n,l,u){const g=Math.min(u.pointToSegmentDistance(a,n,l),u.pointToSegmentDistance(e,n,l)),_=Math.min(u.pointToSegmentDistance(n,a,e),u.pointToSegmentDistance(l,a,e));return Math.min(g,_)}function $(a,e,n,l,u){if(!es(e,a.length)||!es(l,n.length))return NaN;let g=1/0;for(let _=e[0];_<e[1];++_)for(let w=l[0];w<l[1];++w){if(rd(a[_],a[_+1],n[w],n[w+1]))return 0;g=Math.min(g,I(a[_],a[_+1],n[w],n[w+1],u))}return g}function te(a,e,n,l,u){if(!es(e,a.length)||!es(l,n.length))return NaN;let g=1/0;for(let _=e[0];_<=e[1];++_)for(let w=l[0];w<=l[1];++w)if((g=Math.min(g,u.distance(a[_],n[w])))===0)return g;return g}function me(a,e,n){if(yl(a,e,!0))return 0;let l=1/0;for(const u of e){const g=u.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[g-1]&&(l=Math.min(l,n.pointToSegmentDistance(a,u[g-1],u[0])))===0||(l=Math.min(l,ju(a,u,n)))===0)return l}return l}function Le(a,e,n,l){if(!es(e,a.length))return NaN;for(let g=e[0];g<=e[1];++g)if(yl(a[g],n,!0))return 0;let u=1/0;for(let g=e[0];g<e[1];++g)for(const _ of n)for(let w=0,A=_.length,z=A-1;w<A;z=w++){if(rd(a[g],a[g+1],_[z],_[w]))return 0;u=Math.min(u,I(a[g],a[g+1],_[z],_[w],l))}return u}function ut(a,e){for(const n of a)for(let l=0;l<=n.length-1;++l)if(yl(n[l],e,!0))return!0;return!1}function Bt(a,e,n,l=1/0){const u=bc(a),g=bc(e);if(l!==1/0&&xl(u,g,n)>=l)return l;if(So(u,g)){if(ut(a,e))return 0}else if(ut(e,a))return 0;let _=l;for(const w of a)for(let A=0,z=w.length,O=z-1;A<z;O=A++)for(const F of e)for(let U=0,q=F.length,Z=q-1;U<q;Z=U++){if(rd(w[O],w[A],F[Z],F[U]))return 0;_=Math.min(_,I(w[O],w[A],F[Z],F[U],n))}return _}function It(a,e,n,l,u,g,_){if(g===null||_===null)return;const w=xl(lo(l,g),lo(u,_),n);w<e&&a.push({dist:w,range1:g,range2:_})}function ji(a,e,n,l,u=1/0){let g=Math.min(l.distance(a[0],n[0][0]),u);if(g===0)return g;const _=new tu([{dist:0,range1:[0,a.length-1],range2:[0,0]}],iu),w=e?Nl:nu,A=bc(n);for(;_.length;){const z=_.pop();if(z.dist>=g)continue;const O=z.range1;if(od(O)<=w){if(!es(O,a.length))return NaN;if(e){const F=Le(a,O,n,l);if((g=Math.min(g,F))===0)return g}else for(let F=O[0];F<=O[1];++F){const U=me(a[F],n,l);if((g=Math.min(g,U))===0)return g}}else{const F=ld(O,e);if(F[0]!==null){const U=xl(lo(a,F[0]),A,l);U<g&&_.push({dist:U,range1:F[0],range2:[0,0]})}if(F[1]!==null){const U=xl(lo(a,F[1]),A,l);U<g&&_.push({dist:U,range1:F[1],range2:[0,0]})}}}return g}function cn(a,e,n,l,u,g=1/0){let _=Math.min(g,u.distance(a[0],n[0]));if(_===0)return _;const w=new tu([{dist:0,range1:[0,a.length-1],range2:[0,n.length-1]}],iu),A=e?Nl:nu,z=l?Nl:nu;for(;w.length;){const O=w.pop();if(O.dist>=_)continue;const F=O.range1,U=O.range2;if(od(F)<=A&&od(U)<=z){if(!es(F,a.length)||!es(U,n.length))return NaN;if(e&&l?_=Math.min(_,$(a,F,n,U,u)):e||l?e&&!l?_=Math.min(_,b(n,U,a,F,u)):!e&&l&&(_=Math.min(_,b(a,F,n,U,u))):_=Math.min(_,te(a,F,n,U,u)),_===0)return _}else{const q=ld(F,e),Z=ld(U,l);It(w,_,u,a,n,q[0],Z[0]),It(w,_,u,a,n,q[0],Z[1]),It(w,_,u,a,n,q[1],Z[0]),It(w,_,u,a,n,q[1],Z[1])}}return _}function vn(a,e,n,l,u=1/0){let g=u;const _=lo(a,[0,a.length-1]);for(const w of n)if(!(g!==1/0&&xl(_,lo(w,[0,w.length-1]),l)>=g)&&(g=Math.min(g,cn(a,e,w,!0,l,g)),g===0))return g;return g}function En(a,e,n,l,u=1/0){let g=u;const _=lo(a,[0,a.length-1]);for(const w of n){if(g!==1/0&&xl(_,bc(w),l)>=g)continue;const A=ji(a,e,w,l,g);if(isNaN(A))return A;if((g=Math.min(g,A))===0)return g}return g}function oa(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class pr{constructor(e,n){this.type=Ii,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ml(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let u=0;u<l.features.length;++u)if(oa(l.features[u].geometry.type))return new pr(l,l.features[u].geometry)}else if(l.type==="Feature"){if(oa(l.geometry.type))return new pr(l,l.geometry)}else if(oa(l.type))return new pr(l,l)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),l=e.canonicalID();if(n!=null&&l!=null){if(e.geometryType()==="Point")return(function(u,g,_){const w=[];for(const z of u)for(const O of z)w.push(Mu(O,g));const A=new Os(w[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?cn(w,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",A):_.type==="MultiLineString"?vn(w,!1,_.coordinates,A):_.type==="Polygon"||_.type==="MultiPolygon"?En(w,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,A):null})(n,l,this.geometries);if(e.geometryType()==="LineString")return(function(u,g,_){const w=[];for(const z of u){const O=[];for(const F of z)O.push(Mu(F,g));w.push(O)}const A=new Os(w[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return vn(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,A);if(_.type==="MultiLineString"){let z=1/0;for(let O=0;O<_.coordinates.length;O++){const F=vn(_.coordinates[O],!0,w,A,z);if(isNaN(F))return F;if((z=Math.min(z,F))===0)return z}return z}if(_.type==="Polygon"||_.type==="MultiPolygon"){let z=1/0;for(let O=0;O<w.length;O++){const F=En(w[O],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,A,z);if(isNaN(F))return F;if((z=Math.min(z,F))===0)return z}return z}return null})(n,l,this.geometries);if(e.geometryType()==="Polygon")return(function(u,g,_){const w=[];for(const z of(function(O,F){const U=O.length;if(U<=1)return[O];const q=[];let Z,ee;for(let le=0;le<U;le++){const oe=_l(O[le]);oe!==0&&(O[le].area=Math.abs(oe),ee===void 0&&(ee=oe<0),ee===oe<0?(Z&&q.push(Z),Z=[O[le]]):Z.push(O[le]))}return Z&&q.push(Z),q})(u)){const O=[];for(let F=0;F<z.length;++F)O.push(Pu(z[F],g));w.push(O)}const A=new Os(w[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return En(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,A);if(_.type==="MultiLineString"){let z=1/0;for(let O=0;O<_.coordinates.length;O++){const F=En(_.coordinates[O],!0,w,A,z);if(isNaN(F))return F;if((z=Math.min(z,F))===0)return z}return z}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(z,O,F){let U=1/0;for(const q of z)for(const Z of O){const ee=Bt(q,Z,F,U);if(isNaN(ee))return ee;if((U=Math.min(U,ee))===0)return U}return U})(_.type==="Polygon"?[_.coordinates]:_.coordinates,w,A):null})(n,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ar(a){if(a instanceof Sr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof vc||a instanceof pr)return!1;if(a instanceof Bl)return a.featureConstant;let e=!0;return a.eachChild((n=>{e&&!Ar(n)&&(e=!1)})),e}function hs(a){if(a instanceof Sr&&a.name==="feature-state")return!1;let e=!0;return a.eachChild((n=>{e&&!hs(n)&&(e=!1)})),e}function Qs(a,e){if(a instanceof Sr&&e.indexOf(a.name)>=0)return!1;let n=!0;return a.eachChild((l=>{n&&!Qs(l,e)&&(n=!1)})),n}function kf(a,e,n){return[a,e,n].filter(Boolean).join("")}function Ph(a,e){switch(a){case"string":return Br(e);case"number":return+e;case"boolean":return!!e;case"color":return ha.parse(e);case"formatted":return ls.fromString(Br(e));case"resolvedImage":return ro.build(Br(e))}return e}function cd(a,e,n,l){return l!==void 0&&(a=l*Math.round(a/l)),e!==void 0&&a<e&&(a=e),n!==void 0&&a>n&&(a=n),a}class Bl{constructor(e,n,l,u=!1){this.type=e,this.key=n,this.scope=l,this.featureConstant=u}static parse(e,n){let l=n.expectedType;if(l==null&&(l=na),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const u=n.parse(e[1],1);if(!(u instanceof Qo))return n.error("Key name of 'config' expression must be a string literal.");let g,_=!0;const w=Br(u.value);if(e.length>=3){const A=n.parse(e[2],2);if(!(A instanceof Qo))return n.error("Scope of 'config' expression must be a string literal.");g=Br(A.value)}if(n.options){const A=kf(w,g,n._scope),z=n.options.get(A);z&&(_=Ar(z.value||z.default))}return new Bl(l,w,g,_)}evaluate(e){const n=kf(this.key,this.scope,e.scope),l=e.getConfig(n);if(!l)return null;const{type:u,value:g,values:_,minValue:w,maxValue:A,stepValue:z}=l,O=l.default.evaluate(e);let F=O;if(g){const U=e.scope;e.scope=(U||"").split("").slice(1).join(""),F=g.evaluate(e),e.scope=U}return u&&(F=Ph(u,F)),F===void 0||w===void 0&&A===void 0&&z===void 0||(typeof F=="number"?F=cd(F,w,A,z):Array.isArray(F)&&(F=F.map((U=>typeof U=="number"?cd(U,w,A,z):U)))),g!==void 0&&F!==void 0&&_&&!_.includes(F)&&(F=O,u&&(F=Ph(u,F))),(u&&u!==this.type||F!==void 0&&!ku(Hr(F),this.type))&&(F=Ph(this.type.kind,F)),F}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Hd{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new Hd(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class wc{constructor(e,n=[],l,u=new Ju,g=[],_,w,A){this.registry=e,this.path=n,this.key=n.map((z=>typeof z=="string"?`['${z}']`:`[${z}]`)).join(""),this.scope=u,this.errors=g,this.expectedType=l,this._scope=_,this.options=w,this.iconImageUseTheme=A}parse(e,n,l,u,g={}){return n||l?this.concat(n,null,l,u)._parse(e,g):this._parse(e,g)}parseObjectValue(e,n,l,u,g,_={}){return this.concat(n,l,u,g)._parse(e,_)}_parse(e,n){function l(u,g,_){return _==="assert"?new so(g,[u]):_==="coerce"?new Rs(g,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let g=u.parse(e,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,w=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(_,w))return null}else g=l(g,_,n.typeAnnotation||"coerce");else g=l(g,_,n.typeAnnotation||"assert")}if(!(g instanceof Qo)&&g.type.kind!=="resolvedImage"&&Ur(g)){const _=new yc(this._scope,this.options,this.iconImageUseTheme);try{g=new Qo(g.type,g.evaluate(_))}catch(w){return this.error(w.message),null}}return g}return Rs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l,u){let g=typeof e=="number"?this.path.concat(e):this.path;g=typeof n=="string"?g.concat(n):g;const _=u?this.scope.concat(u):this.scope;return new wc(this.registry,g,l||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...n){const l=`${this.key}${n.map((u=>`[${u}]`)).join("")}`;this.errors.push(new Oo(l,e))}checkSubtype(e,n){const l=_c(e,n);return l&&this.error(l),l}}function Ur(a){if(a instanceof Hd)return Ur(a.boundExpression);if(a instanceof Sr&&a.name==="error"||a instanceof Ir||a instanceof vc||a instanceof pr||a instanceof Bl)return!1;const e=a instanceof Rs||a instanceof so;let n=!0;return a.eachChild((l=>{n=e?n&&Ur(l):n&&l instanceof Qo})),!!n&&Ar(a)&&Qs(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function tl(a,e){const n=a.length-1;let l,u,g=0,_=n,w=0;for(;g<=_;)if(w=Math.floor((g+_)/2),l=a[w],u=a[w+1],l<=e){if(w===n||e<u)return w;g=w+1}else{if(!(l>e))throw new wr("Input is not a number.");_=w-1}return 0}class il{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,g]of l)this.labels.push(u),this.outputs.push(g)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,Ii);if(!l)return null;const u=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let _=1;_<e.length;_+=2){const w=_===1?-1/0:e[_],A=e[_+1],z=_,O=_+1;if(typeof w!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(u.length&&u[u.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const F=n.parse(A,O,g);if(!F)return null;g=g||F.type,u.push([w,F])}return new il(g,l,u)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return l[0].evaluate(e);const g=n.length;return u>=n[g-1]?l[g-1].evaluate(e):l[tl(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const Sc=.95047,rc=1.08883,ud=4/29,Tc=6/29,dd=3*Tc*Tc,Cm=Tc*Tc*Tc,Gd=Math.PI/180,Bo=180/Math.PI;function jh(a){return a>Cm?Math.pow(a,1/3):a/dd+ud}function Mm(a){return a>Tc?a*a*a:dd*(a-ud)}function Wp(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Zp(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function e_(a){const e=Zp(a.r),n=Zp(a.g),l=Zp(a.b),u=jh((.4124564*e+.3575761*n+.1804375*l)/Sc),g=jh((.2126729*e+.7151522*n+.072175*l)/1);return{l:116*g-16,a:500*(u-g),b:200*(g-jh((.0193339*e+.119192*n+.9503041*l)/rc)),alpha:a.a}}function fs(a){let e=(a.l+16)/116,n=isNaN(a.a)?e:e+a.a/500,l=isNaN(a.b)?e:e-a.b/200;return e=1*Mm(e),n=Sc*Mm(n),l=rc*Mm(l),new ha(Wp(3.2404542*n-1.5371385*e-.4985314*l),Wp(-.969266*n+1.8760108*e+.041556*l),Wp(.0556434*n-.2040259*e+1.0572252*l),a.alpha)}function zh(a,e,n){const l=e-a;return a+n*(l>180||l<-180?l-360*Math.round(l/360):l)}const au={forward:e_,reverse:fs,interpolate:function(a,e,n){return{l:$i(a.l,e.l,n),a:$i(a.a,e.a,n),b:$i(a.b,e.b,n),alpha:$i(a.alpha,e.alpha,n)}}},zu={forward:function(a){const{l:e,a:n,b:l}=e_(a),u=Math.atan2(l,n)*Bo;return{h:u<0?u+360:u,c:Math.sqrt(n*n+l*l),l:e,alpha:a.a}},reverse:function(a){const e=a.h*Gd,n=a.c;return fs({l:a.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:a.alpha})},interpolate:function(a,e,n){return{h:zh(a.h,e.h,n),c:$i(a.c,e.c,n),l:$i(a.l,e.l,n),alpha:$i(a.alpha,e.alpha,n)}}};var Pm=Object.freeze({__proto__:null,hcl:zu,lab:au});class co{constructor(e,n,l,u,g){this.type=e,this.operator=n,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[_,w]of g)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(e,n,l,u){let g=0;if(e.name==="exponential")g=Iu(n,e.base,l,u);else if(e.name==="linear")g=Iu(n,1,l,u);else if(e.name==="cubic-bezier"){const _=e.controlPoints;g=new wu(_[0],_[1],_[2],_[3]).solve(Iu(n,1,l,u))}return g}static parse(e,n){let[l,u,g,..._]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const z=u[1];if(typeof z!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:z}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const z=u.slice(1);if(z.length!==4||z.some((O=>typeof O!="number"||O<0||O>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:z}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,Ii),!g)return null;const w=[];let A=null;l==="interpolate-hcl"||l==="interpolate-lab"?A=Ys:n.expectedType&&n.expectedType.kind!=="value"&&(A=n.expectedType);for(let z=0;z<_.length;z+=2){const O=_[z],F=_[z+1],U=z+3,q=z+4;if(typeof O!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(w.length&&w[w.length-1][0]>=O)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const Z=n.parse(F,q,A);if(!Z)return null;A=A||Z.type,w.push([O,Z])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new co(A,l,u,g,w):n.error(`Type ${or(A)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return l[0].evaluate(e);const g=n.length;if(u>=n[g-1])return l[g-1].evaluate(e);const _=tl(n,u),w=co.interpolationFactor(this.interpolation,u,n[_],n[_+1]),A=l[_].evaluate(e),z=l[_+1].evaluate(e);return this.operator==="interpolate"?Zc[this.type.kind.toLowerCase()](A,z,w):this.operator==="interpolate-hcl"?zu.reverse(zu.interpolate(zu.forward(A),zu.forward(z),w)):au.reverse(au.interpolate(au.forward(A),au.forward(z),w))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const n=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)n.push(this.labels[l],this.outputs[l].serialize());return n}}function Iu(a,e,n,l){const u=l-n,g=a-n;return u===0?0:e===1?g/u:(Math.pow(e,g)-1)/(Math.pow(e,u)-1)}class Ef{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let l=null;const u=n.expectedType;u&&u.kind!=="value"&&(l=u);const g=[];for(const w of e.slice(1)){const A=n.parse(w,1+g.length,l,void 0,{typeAnnotation:"omit"});if(!A)return null;l=l||A.type,g.push(A)}const _=u&&g.some((w=>_c(u,w.type)));return new Ef(_?na:l,g)}evaluate(e){let n,l=null,u=0;for(const g of this.args){if(u++,l=g.evaluate(e),l&&l instanceof ro&&!l.available&&(n||(n=l),l=null,u===this.args.length))return n;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((n=>{e.push(n.serialize())})),e}}class ru{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=n.parse(e[g+1],g+1);if(!w)return null;l.push([_,w])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return u?new ru(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,l]of this.bindings)e.push(n,l.serialize());return e.push(this.result.serialize()),e}}class jm{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Ii),u=n.parse(e[2],2,Is(n.expectedType||na));return l&&u?new jm(u.type.itemType,l,u):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new wr("Array index out of bounds: negative index");if(n>=l.length)throw new wr("Array index out of bounds: index exceeds array size");if(n!==Math.floor(n))throw new wr("Array index must be an integer. Use at-interpolated for fractional indices");return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Af{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Ii),u=n.parse(e[2],2,Is(n.expectedType||na));return l&&u?new Af(u.type.itemType,l,u):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new wr(`Array index out of bounds: ${n} < 0.`);if(n>l.length-1)throw new wr(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n===Math.floor(n))return l[n];const u=Math.floor(n),g=Math.ceil(n),_=l[u],w=l[g];if(typeof _!="number"||typeof w!="number")throw new wr(`Cannot interpolate between non-number values at index ${n}.`);const A=n-u;return _*(1-A)+w*A}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Ru{constructor(e,n){this.type=pa,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,na),u=n.parse(e[2],2,na);return l&&u?Ud(l.type,[pa,Nn,Ii,fl,na])?new Ru(l,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${or(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Qu(n,["boolean","string","number","null"]))throw new wr(`Expected first argument to be of type boolean, string, number or null, but found ${or(Hr(n))} instead.`);if(!Qu(l,["string","array"]))throw new wr(`Expected second argument to be of type array or string, but found ${or(Hr(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class hd{constructor(e,n,l){this.type=Ii,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,na),u=n.parse(e[2],2,na);if(!l||!u)return null;if(!Ud(l.type,[pa,Nn,Ii,fl,na]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${or(l.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,Ii);return g?new hd(l,u,g):null}return new hd(l,u)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Qu(n,["boolean","string","number","null"]))throw new wr(`Expected first argument to be of type boolean, string, number or null, but found ${or(Hr(n))} instead.`);if(!Qu(l,["string","array"]))throw new wr(`Expected second argument to be of type array or string, but found ${or(Hr(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(n,u)}return l.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fd{constructor(e,n,l,u,g,_){this.inputType=e,this.type=n,this.input=l,this.cases=u,this.outputs=g,this.otherwise=_}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const g={},_=[];for(let z=2;z<e.length-1;z+=2){let O=e[z];const F=e[z+1];Array.isArray(O)||(O=[O]);const U=n.concat(z);if(O.length===0)return U.error("Expected at least one branch label.");for(const Z of O){if(typeof Z!="number"&&typeof Z!="string")return U.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return U.error("Numeric branch labels must be integer values.");if(l){if(U.checkSubtype(l,Hr(Z)))return null}else l=Hr(Z);if(g[String(Z)]!==void 0)return U.error("Branch labels must be unique.");g[String(Z)]=_.length}const q=n.parse(F,z,u);if(!q)return null;u=u||q.type,_.push(q)}const w=n.parse(e[1],1,na);if(!w)return null;const A=n.parse(e[e.length-1],e.length-1,u);return A?w.type.kind!=="value"&&n.concat(1).checkSubtype(l,w.type)?null:new fd(l,u,w,g,_,A):null}evaluate(e){const n=this.input.evaluate(e);return(ku(Hr(n),this.inputType)&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),l=[],u={};for(const _ of n){const w=u[this.cases[_]];w===void 0?(u[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[w][1].push(_)}const g=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,w]of l)e.push(w.length===1?g(w[0]):w.map(g)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class Ih{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const w=n.parse(e[_],_,pa);if(!w)return null;const A=n.parse(e[_+1],_+1,l);if(!A)return null;u.push([w,A]),l=l||A.type}const g=n.parse(e[e.length-1],e.length-1,l);return g?new Ih(l,u,g):null}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((n=>{e.push(n.serialize())})),e}}class md{constructor(e,n,l,u){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,na),u=n.parse(e[2],2,Ii);if(!l||!u)return null;if(!Ud(l.type,[Is(na),Nn,na]))return n.error(`Expected first argument to be of type array or string, but found ${or(l.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,Ii);return g?new md(l.type,l,u,g):null}return new md(l.type,l,u)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Qu(n,["string","array"]))throw new wr(`Expected first argument to be of type array or string, but found ${or(Hr(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(l,u)}return n.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class zm{constructor(e,n){this.type=Is(Nn),this.str=e,this.delimiter=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Nn),u=n.parse(e[2],2,Nn);return l&&u?new zm(l,u):void 0}evaluate(e){const n=this.str.evaluate(e),l=this.delimiter.evaluate(e);return n.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Rh(a,e){return a==="=="||a==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Cf(a,e,n,l){return l.compare(e,n)===0}function qd(a,e,n){const l=a!=="=="&&a!=="!=";return class eP{constructor(g,_,w){this.type=pa,this.lhs=g,this.rhs=_,this.collator=w,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const w=g[0];let A=_.parse(g[1],1,na);if(!A)return null;if(!Rh(w,A.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${or(A.type)}'.`);let z=_.parse(g[2],2,na);if(!z)return null;if(!Rh(w,z.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${or(z.type)}'.`);if(A.type.kind!==z.type.kind&&A.type.kind!=="value"&&z.type.kind!=="value")return _.error(`Cannot compare types '${or(A.type)}' and '${or(z.type)}'.`);l&&(A.type.kind==="value"&&z.type.kind!=="value"?A=new so(z.type,[A]):A.type.kind!=="value"&&z.type.kind==="value"&&(z=new so(A.type,[z])));let O=null;if(g.length===4){if(A.type.kind!=="string"&&z.type.kind!=="string"&&A.type.kind!=="value"&&z.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(O=_.parse(g[3],3,Bd),!O)return null}return new eP(A,z,O)}evaluate(g){const _=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(l&&this.hasUntypedArgument){const A=Hr(_),z=Hr(w);if(A.kind!==z.kind||A.kind!=="string"&&A.kind!=="number")throw new wr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${A.kind}, ${z.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const A=Hr(_),z=Hr(w);if(A.kind!=="string"||z.kind!=="string")return e(g,_,w)}return this.collator?n(g,_,w,this.collator.evaluate(g)):e(g,_,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild((_=>{g.push(_.serialize())})),g}}}const Im=qd("==",(function(a,e,n){return e===n}),Cf),t_=qd("!=",(function(a,e,n){return e!==n}),(function(a,e,n,l){return!Cf(0,e,n,l)})),Dh=qd("<",(function(a,e,n){return e<n}),(function(a,e,n,l){return l.compare(e,n)<0})),Xp=qd(">",(function(a,e,n){return e>n}),(function(a,e,n,l){return l.compare(e,n)>0})),Mf=qd("<=",(function(a,e,n){return e<=n}),(function(a,e,n,l){return l.compare(e,n)<=0})),pd=qd(">=",(function(a,e,n){return e>=n}),(function(a,e,n,l){return l.compare(e,n)>=0}));class Lh{constructor(e,n,l,u,g,_){this.type=Nn,this.number=e,this.locale=n,this.currency=l,this.unit=u,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Ii);if(!l)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let g=null;if(u.locale&&(g=n.parseObjectValue(u.locale,2,"locale",Nn),!g))return null;let _=null;if(u.currency&&(_=n.parseObjectValue(u.currency,2,"currency",Nn),!_))return null;let w=null;if(u.unit&&(w=n.parseObjectValue(u.unit,2,"unit",Nn),!w))return null;let A=null;if(u["min-fraction-digits"]&&(A=n.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Ii),!A))return null;let z=null;return u["max-fraction-digits"]&&(z=n.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Ii),!z)?null:new Lh(l,g,_,w,A,z)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Pf{constructor(e){this.type=Ii,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${or(l.type)} instead.`):new Pf(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new wr(`Expected value to be of type string or array, but found ${or(Hr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((n=>{e.push(n.serialize())})),e}}function Du(a){return function(){a=1831565813+(a|=0)|0;let e=Math.imul(a^a>>>15,1|a);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Ul={"==":Im,"!=":t_,">":Xp,"<":Dh,">=":pd,"<=":Mf,array:so,at:jm,"at-interpolated":Af,boolean:so,case:Ih,coalesce:Ef,collator:Ir,format:pl,image:sn,in:Ru,"index-of":hd,interpolate:co,"interpolate-hcl":co,"interpolate-lab":co,length:Pf,let:ru,literal:Qo,match:fd,number:so,"number-format":Lh,object:so,slice:md,step:il,string:so,"to-boolean":Rs,"to-color":Rs,"to-number":Rs,"to-string":Rs,var:Hd,within:vc,distance:pr,config:Bl,split:zm};function Wd(a,[e,n,l,u]){e=e.evaluate(a),n=n.evaluate(a),l=l.evaluate(a);const g=u?u.evaluate(a):1,_=Ks(e,n,l,g);if(_)throw new wr(_);return new ha(e/255,n/255,l/255,g)}function jf(a,[e,n,l,u]){e=e.evaluate(a),n=n.evaluate(a),l=l.evaluate(a);const g=u?u.evaluate(a):1,_=(function(z,O,F,U){return typeof z=="number"&&z>=0&&z<=360?typeof O=="number"&&O>=0&&O<=100&&typeof F=="number"&&F>=0&&F<=100?U===void 0||typeof U=="number"&&U>=0&&U<=1?null:`Invalid hsla value [${[z,O,F,U].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof U=="number"?[z,O,F,U]:[z,O,F]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof U=="number"?[z,O,F,U]:[z,O,F]).join(", ")}]: 'h' must be between 0 and 360.`})(e,n,l,g);if(_)throw new wr(_);const w=`hsla(${e}, ${n}%, ${l}%, ${g})`,A=ha.parse(w);if(!A)throw new wr(`Failed to parse HSLA color: ${w}`);return A}function Rm(a,e){return a in e}function Zd(a,e){const n=e[a];return n===void 0?null:n}function sc(a){return{type:a}}function gd(a){if(a instanceof Bl)return new Set([a.key]);let e=new Set;return a.eachChild((n=>{e=new Set([...e,...gd(n)])})),e}function zf(a){if(a instanceof Sr&&a.name==="is-active-floor")return!0;let e=!1;return a.eachChild((n=>{!e&&zf(n)&&(e=!0)})),e}function Xd(a){return{result:"success",value:a}}function kc(a){return{result:"error",value:a}}function Dm(a,e){return!!a&&!!a.parameters&&a.parameters.indexOf(e)>-1}function Yd(a){return a["property-type"]==="data-driven"}function Lm(a){return Dm(a.expression,"measure-light")}function Lu(a){return Dm(a.expression,"zoom")}function Ca(a){return!!a.expression&&a.expression.interpolated}function vr(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Ts(a){return a}function If(a,e){const n=e.type==="color",l=a.stops&&typeof a.stops[0][0]=="object",u=l||!(l||a.property!==void 0),g=a.type||(Ca(e)?"exponential":"interval");if(n&&((a=Object.assign({},a)).stops&&(a.stops=a.stops.map((z=>[z[0],ha.parse(z[1])]))),a.default=ha.parse(a.default?a.default:e.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Pm[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let _,w,A;if(g==="exponential")_=Oh;else if(g==="interval")_=Om;else if(g==="categorical"){_=Kd,w=Object.create(null);for(const z of a.stops)w[z[0]]=z[1];A=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=Jd}if(l){const z={},O=[];for(let q=0;q<a.stops.length;q++){const Z=a.stops[q],ee=Z[0].zoom;z[ee]===void 0&&(z[ee]={zoom:ee,type:a.type,property:a.property,default:a.default,stops:[]},O.push(ee)),z[ee].stops.push([Z[0].value,Z[1]])}const F=[];for(const q of O)F.push([z[q].zoom,If(z[q],e)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:co.interpolationFactor.bind(void 0,U),zoomStops:F.map((q=>q[0])),evaluate:({zoom:q},Z)=>Oh({stops:F,base:a.base},e,q).evaluate(q,Z)}}if(u){const z=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:co.interpolationFactor.bind(void 0,z),zoomStops:a.stops.map((O=>O[0])),evaluate:({zoom:O})=>_(a,e,O,w,A)}}return{kind:"source",evaluate(z,O){const F=O&&O.properties?O.properties[a.property]:void 0;return F===void 0?nl(a.default,e.default):_(a,e,F,w,A)}}}function nl(a,e,n){return a!==void 0?a:e!==void 0?e:n!==void 0?n:void 0}function Kd(a,e,n,l,u){return nl(typeof n===u?l[n]:void 0,a.default,e.default)}function Om(a,e,n){if(!Eu(n))return nl(a.default,e.default);const l=a.stops.length;if(l===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[l-1][0])return a.stops[l-1][1];const u=tl(a.stops.map((g=>g[0])),n);return a.stops[u][1]}function Oh(a,e,n){const l=a.base!==void 0?a.base:1;if(!Eu(n))return nl(a.default,e.default);const u=a.stops.length;if(u===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[u-1][0])return a.stops[u-1][1];const g=tl(a.stops.map((O=>O[0])),n),_=(function(O,F,U,q){const Z=q-U,ee=O-U;return Z===0?0:F===1?ee/Z:(Math.pow(F,ee)-1)/(Math.pow(F,Z)-1)})(n,l,a.stops[g][0],a.stops[g+1][0]),w=a.stops[g][1],A=a.stops[g+1][1];let z=Zc[e.type]||Ts;if(a.colorSpace&&a.colorSpace!=="rgb"){const O=Pm[a.colorSpace];z=(F,U)=>O.reverse(O.interpolate(O.forward(F),O.forward(U),_))}return typeof w.evaluate=="function"?{evaluate(...O){const F=w.evaluate.apply(void 0,O),U=A.evaluate.apply(void 0,O);if(F!==void 0&&U!==void 0)return z(F,U,_)}}:z(w,A,_)}function Jd(a,e,n){return e.type==="color"?n=ha.parse(n):e.type==="formatted"?n=ls.fromString(n.toString()):e.type==="resolvedImage"?n=ro.build(n.toString()):Pi(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),nl(n,a.default,e.default)}Sr.register(Ul,{error:[{kind:"error"},[Nn],(a,[e])=>{throw new wr(e.evaluate(a))}],typeof:[Nn,[na],(a,[e])=>or(Hr(e.evaluate(a)))],"to-rgba":[Is(Ii,4),[Ys],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Is(Ii,4),[Ys],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ys,[Ii,Ii,Ii],Wd],rgba:[Ys,[Ii,Ii,Ii,Ii],Wd],hsl:[Ys,[Ii,Ii,Ii],jf],hsla:[Ys,[Ii,Ii,Ii,Ii],jf],has:{type:pa,overloads:[[[Nn],(a,[e])=>Rm(e.evaluate(a),a.properties())],[[Nn,nc],(a,[e,n])=>Rm(e.evaluate(a),n.evaluate(a))]]},get:{type:na,overloads:[[[Nn],(a,[e])=>Zd(e.evaluate(a),a.properties())],[[Nn,nc],(a,[e,n])=>Zd(e.evaluate(a),n.evaluate(a))]]},"feature-state":[na,[Nn],(a,[e])=>Zd(e.evaluate(a),a.featureState||{})],properties:[nc,[],a=>a.properties()],"geometry-type":[Nn,[],a=>a.geometryType()],worldview:[Nn,[],a=>a.globals.worldview||""],"is-active-floor":[pa,sc(Nn),(a,e)=>{if(!(a.globals.activeFloors&&a.globals.activeFloors.size>0))return!1;const n=a.globals.activeFloors;return e.some((l=>{const u=l.evaluate(a);return n.has(u)}))}],id:[na,[],a=>a.id()],zoom:[Ii,[],a=>a.globals.zoom],pitch:[Ii,[],a=>a.globals.pitch||0],"distance-from-center":[Ii,[],a=>a.distanceFromCenter()],"measure-light":[Ii,[Nn],(a,[e])=>a.measureLight(e.evaluate(a))],"heatmap-density":[Ii,[],a=>a.globals.heatmapDensity||0],"line-progress":[Ii,[],a=>a.globals.lineProgress||0],"raster-value":[Ii,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[Ii,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ii,[],a=>a.globals.skyRadialProgress||0],accumulated:[na,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Ii,sc(Ii),(a,e)=>{let n=0;for(const l of e)n+=l.evaluate(a);return n}],"*":[Ii,sc(Ii),(a,e)=>{let n=1;for(const l of e)n*=l.evaluate(a);return n}],"-":{type:Ii,overloads:[[[Ii,Ii],(a,[e,n])=>e.evaluate(a)-n.evaluate(a)],[[Ii],(a,[e])=>-e.evaluate(a)]]},"/":[Ii,[Ii,Ii],(a,[e,n])=>e.evaluate(a)/n.evaluate(a)],"%":[Ii,[Ii,Ii],(a,[e,n])=>e.evaluate(a)%n.evaluate(a)],ln2:[Ii,[],()=>Math.LN2],pi:[Ii,[],()=>Math.PI],e:[Ii,[],()=>Math.E],"^":[Ii,[Ii,Ii],(a,[e,n])=>Math.pow(e.evaluate(a),n.evaluate(a))],sqrt:[Ii,[Ii],(a,[e])=>Math.sqrt(e.evaluate(a))],log10:[Ii,[Ii],(a,[e])=>Math.log(e.evaluate(a))/Math.LN10],ln:[Ii,[Ii],(a,[e])=>Math.log(e.evaluate(a))],log2:[Ii,[Ii],(a,[e])=>Math.log2(e.evaluate(a))],sin:[Ii,[Ii],(a,[e])=>Math.sin(e.evaluate(a))],cos:[Ii,[Ii],(a,[e])=>Math.cos(e.evaluate(a))],tan:[Ii,[Ii],(a,[e])=>Math.tan(e.evaluate(a))],asin:[Ii,[Ii],(a,[e])=>Math.asin(e.evaluate(a))],acos:[Ii,[Ii],(a,[e])=>Math.acos(e.evaluate(a))],atan:[Ii,[Ii],(a,[e])=>Math.atan(e.evaluate(a))],min:[Ii,sc(Ii),(a,e)=>Math.min(...e.map((n=>n.evaluate(a))))],max:[Ii,sc(Ii),(a,e)=>Math.max(...e.map((n=>n.evaluate(a))))],abs:[Ii,[Ii],(a,[e])=>Math.abs(e.evaluate(a))],round:[Ii,[Ii],(a,[e])=>{const n=e.evaluate(a);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ii,[Ii],(a,[e])=>Math.floor(e.evaluate(a))],ceil:[Ii,[Ii],(a,[e])=>Math.ceil(e.evaluate(a))],"filter-==":[pa,[Nn,na],(a,[e,n])=>a.properties()[e.value]===n.value],"filter-id-==":[pa,[na],(a,[e])=>a.id()===e.value],"filter-type-==":[pa,[Nn],(a,[e])=>a.geometryType()===e.value],"filter-<":[pa,[Nn,na],(a,[e,n])=>{const l=a.properties()[e.value],u=n.value;return typeof l==typeof u&&l<u}],"filter-id-<":[pa,[na],(a,[e])=>{const n=a.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[pa,[Nn,na],(a,[e,n])=>{const l=a.properties()[e.value],u=n.value;return typeof l==typeof u&&l>u}],"filter-id->":[pa,[na],(a,[e])=>{const n=a.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[pa,[Nn,na],(a,[e,n])=>{const l=a.properties()[e.value],u=n.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[pa,[na],(a,[e])=>{const n=a.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[pa,[Nn,na],(a,[e,n])=>{const l=a.properties()[e.value],u=n.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[pa,[na],(a,[e])=>{const n=a.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[pa,[na],(a,[e])=>e.value in a.properties()],"filter-has-id":[pa,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[pa,[Is(Nn)],(a,[e])=>e.value.indexOf(a.geometryType())>=0],"filter-id-in":[pa,[Is(na)],(a,[e])=>e.value.indexOf(a.id())>=0],"filter-in-small":[pa,[Nn,Is(na)],(a,[e,n])=>n.value.indexOf(a.properties()[e.value])>=0],"filter-in-large":[pa,[Nn,Is(na)],(a,[e,n])=>(function(l,u,g,_){for(;g<=_;){const w=g+_>>1;if(u[w]===l)return!0;u[w]>l?_=w-1:g=w+1}return!1})(a.properties()[e.value],n.value,0,n.value.length-1)],all:{type:pa,overloads:[[[pa,pa],(a,[e,n])=>e.evaluate(a)&&n.evaluate(a)],[sc(pa),(a,e)=>{for(const n of e)if(!n.evaluate(a))return!1;return!0}]]},any:{type:pa,overloads:[[[pa,pa],(a,[e,n])=>e.evaluate(a)||n.evaluate(a)],[sc(pa),(a,e)=>{for(const n of e)if(n.evaluate(a))return!0;return!1}]]},"!":[pa,[pa],(a,[e])=>!e.evaluate(a)],"is-supported-script":[pa,[Nn],(a,[e])=>{const n=a.globals&&a.globals.isSupportedScript;return!n||n(e.evaluate(a))}],upcase:[Nn,[Nn],(a,[e])=>e.evaluate(a).toUpperCase()],downcase:[Nn,[Nn],(a,[e])=>e.evaluate(a).toLowerCase()],concat:[Nn,sc(na),(a,e)=>e.map((n=>Br(n.evaluate(a)))).join("")],"resolved-locale":[Nn,[Bd],(a,[e])=>e.evaluate(a).resolvedLocale()],random:[Ii,[Ii,Ii,na],(a,e)=>{const[n,l,u]=e.map((_=>_.evaluate(a)));if(n>l||n===l)return n;let g;if(typeof u=="string")g=(function(_){let w=0;if(_.length===0)return w;for(let A=0;A<_.length;A++)w=(w<<5)-w+_.charCodeAt(A),w|=0;return w})(u);else{if(typeof u!="number")throw new wr(`Invalid seed input: ${u}`);g=u}return n+Du(g)()*(l-n)}]});class Nm{constructor(e,n,l,u,g){this.expression=e,this._warningHistory={},this._scope=l,this._options=u,this._iconImageUseTheme=g,this._evaluator=new yc(l,u,g),this._defaultValue=n?(function(_){return _.type==="color"&&(vr(_.default)||Array.isArray(_.default))?new ha(0,0,0,0):_.type==="color"?ha.parse(_.default)||null:_.default===void 0?null:_.default})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=gd(e),this.isIndoorDependent=zf(e)}evaluateWithoutErrorHandling(e,n,l,u,g,_,w,A){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,u,g,_,w,A,z){this._evaluator||(this._evaluator=new yc(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=A||null,this._evaluator.iconImageUseTheme=z||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new wr(`Expected value to be one of ${Object.keys(this._enumValues).map((F=>JSON.stringify(F))).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){const F=O;return this._warningHistory[F.message]||(this._warningHistory[F.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${F.message}`)),this._defaultValue}}}function Gr(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ul}function su(a,e,n,l,u){const g=new wc(Ul,[],e?(function(w){const A={color:Ys,string:Nn,number:Ii,enum:Nn,boolean:pa,formatted:Xc,resolvedImage:Ll};return w.type==="array"?Is(A[w.value]||na,w.length):A[w.type]})(e):void 0,void 0,void 0,n,l,u),_=g.parse(a,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Xd(new Nm(_,e,n,l,u)):kc(g.errors)}class _d{constructor(e,n,l,u){this.kind=e,this._styleExpression=n,this.isLightConstant=l,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!hs(n.expression),this.configDependencies=gd(n.expression),this.isIndoorDependent=zf(n.expression)}evaluateWithoutErrorHandling(e,n,l,u,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,u,g,_)}evaluate(e,n,l,u,g,_,w){return this._styleExpression.evaluate(e,n,l,u,g,_,void 0,void 0,w)}}class yd{constructor(e,n,l,u,g,_){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!hs(n.expression),this.isIndoorDependent=zf(n.expression),this.isLightConstant=g,this.isLineProgressConstant=_,this.configDependencies=gd(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,l,u,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,u,g,_)}evaluate(e,n,l,u,g,_){return this._styleExpression.evaluate(e,n,l,u,g,_)}interpolationFactor(e,n,l){return this.interpolationType?co.interpolationFactor(this.interpolationType,e,n,l):0}}function Fm(a,e,n,l,u){if((a=su(a,e,n,l,u)).result==="error")return a;const g=a.value.expression,_=Ar(g);if(!_&&!Yd(e))return kc([new Oo("","data expressions not supported")]);const w=Qs(g,["zoom","pitch","distance-from-center"]);if(!w&&!Lu(e))return kc([new Oo("","zoom expressions not supported")]);const A=Qs(g,["measure-light"]);if(!A&&!Lm(e))return kc([new Oo("","measure-light expression not supported")]);const z=Qs(g,["line-progress"]);if(!z&&!(function(U){return Dm(U.expression,"line-progress")})(e))return kc([new Oo("","line-progress expression not supported")]);const O=e.expression&&e.expression.relaxZoomRestriction,F=$l(g);return F||w||O?F instanceof Oo?kc([F]):F instanceof co&&!Ca(e)?kc([new Oo("",'"interpolate" expressions cannot be used with this property')]):Xd(F?new yd(_&&z?"camera":"composite",a.value,F.labels,F instanceof co?F.interpolation:void 0,A,z):new _d(_&&z?"constant":"source",a.value,A,z)):kc([new Oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Bm{constructor(e,n){this._parameters=e,this._specification=n,Object.assign(this,If(this._parameters,this._specification))}static deserialize(e){return new Bm(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function $l(a){let e=null;if(a instanceof ru)e=$l(a.result);else if(a instanceof Ef){for(const n of a.args)if(e=$l(n),e)break}else(a instanceof il||a instanceof co)&&a.input instanceof Sr&&a.input.name==="zoom"&&(e=a);return e instanceof Oo||a.eachChild((n=>{const l=$l(n);l instanceof Oo?e=l:e&&l&&e!==l&&(e=new Oo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Rf,Um,al=(function(){if(Um)return Rf;Um=1,Rf=e;var a=3;function e(n,l,u){var g=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var _=new Int32Array(this.arrayBuffer);n=_[0],this.d=(l=_[1])+2*(u=_[2]);for(var w=0;w<this.d*this.d;w++){var A=_[a+w],z=_[a+w+1];g.push(A===z?null:_.subarray(A,z))}var O=_[a+g.length+1];this.keys=_.subarray(_[a+g.length],O),this.bboxes=_.subarray(O),this.insert=this._insertReadonly}else{this.d=l+2*u;for(var F=0;F<this.d*this.d;F++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=n,this.padding=u,this.scale=l/n,this.uid=0;var U=u/l*n;this.min=-U,this.max=n+U}return e.prototype.insert=function(n,l,u,g,_){this._forEachCell(l,u,g,_,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(_)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,l,u,g,_,w){this.cells[_].push(w)},e.prototype.query=function(n,l,u,g,_){var w=this.min,A=this.max;if(n<=w&&l<=w&&A<=u&&A<=g&&!_)return Array.prototype.slice.call(this.keys);var z=[];return this._forEachCell(n,l,u,g,this._queryCell,z,{},_),z},e.prototype._queryCell=function(n,l,u,g,_,w,A,z){var O=this.cells[_];if(O!==null)for(var F=this.keys,U=this.bboxes,q=0;q<O.length;q++){var Z=O[q];if(A[Z]===void 0){var ee=4*Z;(z?z(U[ee+0],U[ee+1],U[ee+2],U[ee+3]):n<=U[ee+2]&&l<=U[ee+3]&&u>=U[ee+0]&&g>=U[ee+1])?(A[Z]=!0,w.push(F[Z])):A[Z]=!1}}},e.prototype._forEachCell=function(n,l,u,g,_,w,A,z){for(var O=this._convertToCellCoord(n),F=this._convertToCellCoord(l),U=this._convertToCellCoord(u),q=this._convertToCellCoord(g),Z=O;Z<=U;Z++)for(var ee=F;ee<=q;ee++){var le=this.d*ee+Z;if((!z||z(this._convertFromCellCoord(Z),this._convertFromCellCoord(ee),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(ee+1)))&&_.call(this,n,l,u,g,le,w,A,z))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,l=a+this.cells.length+1+1,u=0,g=0;g<this.cells.length;g++)u+=this.cells[g].length;var _=new Int32Array(l+u+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var w=l,A=0;A<n.length;A++){var z=n[A];_[a+A]=w,_.set(z,w),w+=z.length}return _[a+n.length]=w,_.set(this.keys,w),_[a+n.length+1]=w+=this.keys.length,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer},Rf})(),qr=jo(al);const Ou={};function yi(a,e,n={}){Object.defineProperty(a,"_classRegistryKey",{value:e,writable:!1}),Ou[e]={klass:a,omit:n.omit||[]}}yi(Object,"Object"),qr.serialize=function(a,e){const n=a.toArrayBuffer();return e&&e.add(n),{buffer:n}},qr.deserialize=function(a){return new qr(a.buffer)},Object.defineProperty(qr,"name",{value:"Grid"}),yi(qr,"Grid"),delete Pe.prototype.constructor,yi(ha,"Color"),yi(Error,"Error"),yi(ls,"Formatted"),yi($d,"FormattedSection"),yi(ds,"AJAXError"),yi(ro,"ResolvedImage"),yi(Bm,"StylePropertyFunction"),yi(Nm,"StyleExpression",{omit:["_evaluator"]}),yi(zs,"ImageId"),yi(ac,"ImageVariant"),yi(yd,"ZoomDependentExpression"),yi(_d,"ZoomConstantExpression"),yi(Sr,"CompoundExpression",{omit:["_evaluate"]});for(const a in Ul)Ou[Ul[a]._classRegistryKey]||yi(Ul[a],`Expression${a}`);function vd(a){return a&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ec(a,e){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(vd(a)||a instanceof ImageBitmap)return e&&e.add(a),a;if(ArrayBuffer.isView(a))return e&&e.add(a.buffer),a;if(a instanceof ImageData)return e&&e.add(a.data.buffer),a;if(Array.isArray(a)){const n=[];for(const l of a)n.push(Ec(l,e));return n}if(a instanceof Map){const n={$name:"Map",entries:[]};for(const[l,u]of a.entries())n.entries.push(Ec(l),Ec(u,e));return n}if(a instanceof Set){const n={$name:"Set"};let l=0;for(const u of a.values())n[++l]=Ec(u);return n}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const n=a.constructor,l=n._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const u=n.serialize?n.serialize(a,e):{};if(!n.serialize){for(const g in a)a.hasOwnProperty(g)&&(Ou[l].omit.indexOf(g)>=0||(u[g]=Ec(a[g],e)));a instanceof Error&&(u.message=a.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof a)}function Uo(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||vd(a)||a instanceof ImageBitmap||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Uo);if(typeof a=="object"){const e=a.$name||"Object";if(e==="Map"){const u=a.entries||[],g=new Map;for(let _=0;_<u.length;_+=2)g.set(Uo(u[_]),Uo(u[_+1]));return g}if(e==="Set"){const u=new Set;for(const g of Object.keys(a))g!=="$name"&&u.add(Uo(a[g]));return u}if(e==="BigInt")return BigInt(a.value);const{klass:n}=Ou[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(a);const l=Object.create(n.prototype);for(const u of Object.keys(a))u!=="$name"&&(l[u]=Uo(a[u]));return l}throw new Error("can't deserialize object of type "+typeof a)}const Hi={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Qd(a){for(const e of a)if(Lf(e.charCodeAt(0)))return!0;return!1}function Df(a){for(const e of a)if(!Yp(e.charCodeAt(0)))return!1;return!0}function Yp(a){return!(Hi.Arabic(a)||Hi["Arabic Supplement"](a)||Hi["Arabic Extended-A"](a)||Hi["Arabic Presentation Forms-A"](a)||Hi["Arabic Presentation Forms-B"](a))}function Lf(a){return!(a!==746&&a!==747&&(a<4352||!(Hi["Bopomofo Extended"](a)||Hi.Bopomofo(a)||Hi["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Hi["CJK Compatibility Ideographs"](a)||Hi["CJK Compatibility"](a)||Hi["CJK Radicals Supplement"](a)||Hi["CJK Strokes"](a)||!(!Hi["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Hi["CJK Unified Ideographs Extension A"](a)||Hi["CJK Unified Ideographs"](a)||Hi["Enclosed CJK Letters and Months"](a)||Hi["Hangul Compatibility Jamo"](a)||Hi["Hangul Jamo Extended-A"](a)||Hi["Hangul Jamo Extended-B"](a)||Hi["Hangul Jamo"](a)||Hi["Hangul Syllables"](a)||Hi.Hiragana(a)||Hi["Ideographic Description Characters"](a)||Hi.Kanbun(a)||Hi["Kangxi Radicals"](a)||Hi["Katakana Phonetic Extensions"](a)||Hi.Katakana(a)&&a!==12540||!(!Hi["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Hi["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Hi["Unified Canadian Aboriginal Syllabics"](a)||Hi["Unified Canadian Aboriginal Syllabics Extended"](a)||Hi["Vertical Forms"](a)||Hi["Yijing Hexagram Symbols"](a)||Hi["Yi Syllables"](a)||Hi["Yi Radicals"](a))))}function Of(a){return!(Lf(a)||(function(e){return!!(Hi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Hi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Hi["Letterlike Symbols"](e)||Hi["Number Forms"](e)||Hi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Hi["Control Pictures"](e)&&e!==9251||Hi["Optical Character Recognition"](e)||Hi["Enclosed Alphanumerics"](e)||Hi["Geometric Shapes"](e)||Hi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Hi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Hi["CJK Symbols and Punctuation"](e)||Hi.Katakana(e)||Hi["Private Use Area"](e)||Hi["CJK Compatibility Forms"](e)||Hi["Small Form Variants"](e)||Hi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(a))}function Nf(a){return Hi.Arabic(a)||Hi["Arabic Supplement"](a)||Hi["Arabic Extended-A"](a)||Hi["Arabic Presentation Forms-A"](a)||Hi["Arabic Presentation Forms-B"](a)}function $m(a){return a>=1424&&a<=2303||Hi["Arabic Presentation Forms-A"](a)||Hi["Arabic Presentation Forms-B"](a)}function ou(a,e){return!(!e&&$m(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Hi.Khmer(a))}function Kp(a){for(const e of a)if($m(e.charCodeAt(0)))return!0;return!1}const rl={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Jp=null,To=rl.unavailable,lu=null;const Nh=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(To=rl.error),Jp&&Jp(a)};function Fh(){Ff.fire(new bo("pluginStateChange",{pluginStatus:To,pluginURL:lu}))}const Ff=new gc,Bh=function(){return To},Qp=function(){if(To!==rl.deferred||!lu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");To=rl.loading,Fh(),lu&&Ro({url:lu},(a=>{a?Nh(a):(To=rl.loaded,Fh())}))},cu={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>To===rl.loaded||cu.applyArabicShaping!=null,isLoading:()=>To===rl.loading,setState(a){To=a.pluginStatus,lu=a.pluginURL},isParsing:()=>To===rl.parsing,isParsed:()=>To===rl.parsed,getPluginURL:()=>lu};class Da{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness,this.worldview=n.worldview,this.activeFloors=n.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(n,l){for(const u of n)if(!ou(u.charCodeAt(0),l))return!1;return!0})(e,cu.isLoaded())}}class Vm{constructor(e,n,l,u,g){this.property=e,this.value=n,this.expression=(function(_,w,A,z,O){if(vr(_))return new Bm(_,w);if(Gr(_)||Array.isArray(_)&&_.length>0){const F=Fm(_,w,A,z,O);if(F.result==="error")throw new Error(F.value.map((U=>`${U.key}: ${U.message}`)).join(", "));return F.value}{let F=_;return typeof _=="string"&&w.type==="color"&&(F=ha.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>F}}})(n===void 0?e.specification.default:n,e.specification,l,u,g)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,l,u){return this.property.possiblyEvaluate(this,e,n,l,u)}}class Hm{constructor(e,n,l,u){this.property=e,this.value=new Vm(e,void 0,n,l,u)}transitioned(e,n){return new Bf(this.property,this.value,n,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Bf(this.property,this.value,null,{},0)}}class eh{constructor(e,n,l,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=l,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return St(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Hm(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Vm(this._values[e].property,n===null?void 0:St(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,n){n&&(this._options=n);const l=this._properties.properties;if(e)for(const u in e){const g=e[u];if(u.endsWith("-transition")){const _=u.slice(0,-11);l[_]&&this.setTransition(_,g)}else l.hasOwnProperty(u)&&this.setValue(u,g)}}getTransition(e){return St(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Hm(this._values[e].property)),this._values[e].transition=St(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const l=new eg(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,n._values[u]);return l}untransitioned(){const e=new eg(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Bf{constructor(e,n,l,u,g){const _=u.delay||0,w=u.duration||0;g=g||0,this.property=e,this.value=n,this.begin=g+_,this.end=this.begin+w,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const u=e.now||0,g=this.value.possiblyEvaluate(e,n,l),_=this.prior;if(_){if(u>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(u<this.begin)return _.possiblyEvaluate(e,n,l);{const w=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,n,l),g,pn(w))}}return g}}class eg{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const u=new xd(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].possiblyEvaluate(e,n,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Uf{constructor(e,n,l,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=l,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return St(this._values[e].value)}setValue(e,n){this._values[e]=new Vm(this._values[e].property,n===null?void 0:St(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l,u){const g=new xd(this._properties);for(const _ of Object.keys(this._values))g._values[_]=this._values[_].possiblyEvaluate(e,n,l,u);return g}isIndoorDependent(){return this._isIndoorDependent}}class Ac{constructor(e,n,l,u){this.property=e,this.value=n,this.parameters=l,this.iconImageUseTheme=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,u){return this.property.evaluate(this.value,this.parameters,e,n,l,u,this.iconImageUseTheme)}}class xd{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Kt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,l){const u=Zc[this.specification.type];return u?u(e,n,l):e}}class si{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,u,g){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Ac(this,{kind:"constant",value:e.expression.evaluate(n,null,{},l,u,void 0,g)},n):new Ac(this,e.expression,n,g)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Ac(this,{kind:"constant",value:void 0},e.parameters);const u=Zc[this.specification.type];return u?new Ac(this,{kind:"constant",value:u(e.value.value,n.value.value,l)},e.parameters):e}evaluate(e,n,l,u,g,_,w){return e.kind==="constant"?e.value:e.evaluate(n,l,u,g,_,void 0,w)}}class bd{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,u){return!!e.expression.evaluate(n,null,{},l,u)}interpolate(){return!1}}class ur{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Da(0,{});for(const l in e){const u=e[l];u.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new Vm(u,void 0),_=this.defaultTransitionablePropertyValues[l]=new Hm(u);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate(n)}}}yi(si,"DataDrivenProperty"),yi(Kt,"DataConstantProperty"),yi(bd,"ColorRampProperty");var at=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Gm(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function $f(a){if(Array.isArray(a))return a.map($f);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const e={};for(const n in a)e[n]=$f(a[n]);return e}return Gm(a)}function Cc(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const e of a.slice(1))if(!Cc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Uh(a,e="",n=null,l="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Cc(a)||(a=Vh(a));const u=a;let g=!0;try{g=(function(O){if(!$h(O))return O;let F=$f(O);return tg(F),F=wd(F),F})(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let _=null,w=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){w=at[`filter_${l}`];const O=su(g,w,e,n);if(O.result==="error")throw new Error(O.value.map((F=>`${F.key}: ${F.message}`)).join(", "));_=(F,U,q)=>O.value.evaluate(F,U,{},q)}let A=null,z=null;if(g!==u){const O=su(u,w,e,n);if(O.result==="error")throw new Error(O.value.map((F=>`${F.key}: ${F.message}`)).join(", "));A=(F,U,q,Z,ee)=>O.value.evaluate(F,U,{},q,void 0,void 0,Z,ee),z=!Ar(O.value.expression)}return{filter:_,dynamicFilter:A||void 0,needGeometry:ng(g),needFeature:!!z}}function wd(a){if(!Array.isArray(a))return a;const e=(function(n){if(ig.has(n[0])){for(let l=1;l<n.length;l++)if($h(n[l]))return!0}return n})(a);return e===!0?e:e.map((n=>wd(n)))}function tg(a){let e=!1;const n=[];if(a[0]==="case"){for(let l=1;l<a.length-1;l+=2)e=e||$h(a[l]),n.push(a[l+1]);n.push(a[a.length-1])}else if(a[0]==="match"){e=e||$h(a[1]);for(let l=2;l<a.length-1;l+=2)n.push(a[l+1]);n.push(a[a.length-1])}else if(a[0]==="step"){e=e||$h(a[1]);for(let l=1;l<a.length-1;l+=2)n.push(a[l+1])}e&&(a.length=0,a.push("any",...n));for(let l=1;l<a.length;l++)tg(a[l])}function $h(a){if(!Array.isArray(a))return!1;if((e=a[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<a.length;n++)if($h(a[n]))return!0;return!1}const ig=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function i_(a,e){return a<e?-1:a>e?1:0}function ng(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let e=1;e<a.length;e++)if(ng(a[e]))return!0;return!1}function Vh(a){if(!a)return!0;const e=a[0];return a.length<=1?e!=="any":e==="=="?Vf(a[1],a[2],"=="):e==="!="?Gf(Vf(a[1],a[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Vf(a[1],a[2],e):e==="any"?(n=a.slice(1),["any"].concat(n.map(Vh))):e==="all"?["all"].concat(a.slice(1).map(Vh)):e==="none"?["all"].concat(a.slice(1).map(Vh).map(Gf)):e==="in"?Hf(a[1],a.slice(2)):e==="!in"?Gf(Hf(a[1],a.slice(2))):e==="has"?qm(a[1]):e!=="!has"||Gf(qm(a[1]));var n}function Vf(a,e,n){switch(a){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,a,e]}}function Hf(a,e){if(e.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",a,["literal",e.sort(i_)]]:["filter-in-small",a,["literal",e]]}}function qm(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Gf(a){return["!",a]}const Sd="";function sl(a,e){return e?`${a}${Sd}${e}`:a}let Wm;const qf=()=>Wm||(Wm=new ur({"icon-size":new si(at.layout_symbol["icon-size"]),"icon-image":new si(at.layout_symbol["icon-image"]),"icon-rotate":new si(at.layout_symbol["icon-rotate"]),"icon-offset":new si(at.layout_symbol["icon-offset"]),"text-size":new si(at.layout_symbol["text-size"]),"text-rotate":new si(at.layout_symbol["text-rotate"]),"text-offset":new si(at.layout_symbol["text-offset"])}));class ag{constructor(e,n,l,u,g,_){const w=su(e,at.appearance.condition);if(w.result==="success"&&(this.condition=w.value),this.name=n,l){this.properties=new xd(qf()),this.unevaluatedLayout=new Uf(qf(),u,g,_);for(const A in l)this.unevaluatedLayout.setValue(A,l[A])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,n,l){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,n,l))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),n=this.hasProperty("icon-size"),l=this.hasProperty("icon-offset"),u=this.hasProperty("icon-rotate");return e||n||l||u}hasTextProperties(){const e=this.hasProperty("text-size"),n=this.hasProperty("text-offset"),l=this.hasProperty("text-rotate");return e||n||l}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const rg="-transition",Vl=new Set(["fill","line","background","hillshade","raster"]);class ko extends gc{constructor(e,n,l,u,g,_){if(super(),this.id=e.id,this.fqid=sl(this.id,l),this.type=e.type,this.scope=l,this.lut=u,this.options=g,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const w=su(this.filter,at[`filter_${e.type}`]);w.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...w.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||w.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),n.layout&&(this._unevaluatedLayout=new Uf(n.layout,this.scope,g,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),n.paint){this._transitionablePaint=new eh(n.paint,this.scope,g);for(const w in e.paint)this.setPaintProperty(w,e.paint[w]);for(const w in e.layout)this.setLayoutProperty(w,e.layout[w]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xd(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Vl.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((n=>{this.appearances.push(new ag(n.condition,n.name,n.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(rg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,n){const l=this._transitionablePaint,u=l._properties.properties;if(e.endsWith(rg)){const F=e.slice(0,-11);return u[F]&&l.setTransition(F,n||void 0),!1}if(!u[e])return!1;const g=l._values[e],_=g.value.isDataDriven(),w=g.value;l.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const A=l._values[e].value,z=A.isDataDriven(),O=e.endsWith("pattern")||e==="line-dasharray";return z||_||O||this._handleOverridablePaintPropertyUpdate(e,w,A)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,l){return null}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((n=>n.serialize()))),Rt(e,((n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Ac&&Yd(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}for(const e of this.appearances)if(!hs(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Uh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,n,l){return{}}queryRadius(e){}queryIntersectsFeature(e,n,l,u,g,_,w,A,z){}}const sg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Wf{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const Hh=new ArrayBuffer(0);class La{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,n){return e._trim(),n&&e.arrayBuffer&&n.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,e.arrayBuffer?n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement:(n.capacity=0,n.arrayBuffer=Hh),n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Mn(a,e=1){let n=0,l=0;return{members:a.map((u=>{const g=sg[u.type].BYTES_PER_ELEMENT,_=n=Gh(n,Math.max(e,g)),w=u.components||1;return l=Math.max(l,g),n+=g*w,{name:u.name,type:u.type,components:w,offset:_}})),size:Gh(n,Math.max(l,e)),alignment:e}}function Gh(a,e){return Math.ceil(a/e)*e}class Mc extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=l,e}}Mc.prototype.bytesPerElement=4,yi(Mc,"StructArrayLayout2i4");class th extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const g=3*e;return this.int16[g+0]=n,this.int16[g+1]=l,this.int16[g+2]=u,e}}th.prototype.bytesPerElement=6,yi(th,"StructArrayLayout3i6");class ih extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,l,u)}emplace(e,n,l,u,g){const _=4*e;return this.int16[_+0]=n,this.int16[_+1]=l,this.int16[_+2]=u,this.int16[_+3]=g,e}}ih.prototype.bytesPerElement=8,yi(ih,"StructArrayLayout4i8");class bl extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}bl.prototype.bytesPerElement=4,yi(bl,"StructArrayLayout1f4");class Zm extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const g=4*e,_=2*e;return this.int16[g+0]=n,this.int16[g+1]=l,this.float32[_+1]=u,e}}Zm.prototype.bytesPerElement=8,yi(Zm,"StructArrayLayout2i1f8");class wl extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=l,this.int16[g+2]=u,e}}wl.prototype.bytesPerElement=8,yi(wl,"StructArrayLayout3i8");class oc extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,u,g)}emplace(e,n,l,u,g,_){const w=5*e;return this.int16[w+0]=n,this.int16[w+1]=l,this.int16[w+2]=u,this.int16[w+3]=g,this.int16[w+4]=_,e}}oc.prototype.bytesPerElement=10,yi(oc,"StructArrayLayout5i10");class Pc extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,u,g,_,w)}emplace(e,n,l,u,g,_,w,A){const z=6*e,O=12*e,F=3*e;return this.int16[z+0]=n,this.int16[z+1]=l,this.uint8[O+4]=u,this.uint8[O+5]=g,this.uint8[O+6]=_,this.uint8[O+7]=w,this.float32[F+2]=A,e}}Pc.prototype.bytesPerElement=12,yi(Pc,"StructArrayLayout2i4ub1f12");class Sl extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const g=3*e;return this.float32[g+0]=n,this.float32[g+1]=l,this.float32[g+2]=u,e}}Sl.prototype.bytesPerElement=12,yi(Sl,"StructArrayLayout3f12");class ms extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,u,g)}emplace(e,n,l,u,g,_){const w=6*e,A=3*e;return this.uint16[w+0]=n,this.uint16[w+1]=l,this.uint16[w+2]=u,this.uint16[w+3]=g,this.float32[A+2]=_,e}}ms.prototype.bytesPerElement=12,yi(ms,"StructArrayLayout4ui1f12");class ol extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,l,u)}emplace(e,n,l,u,g){const _=4*e;return this.uint16[_+0]=n,this.uint16[_+1]=l,this.uint16[_+2]=u,this.uint16[_+3]=g,e}}ol.prototype.bytesPerElement=8,yi(ol,"StructArrayLayout4ui8");class ps extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,u,g,_)}emplace(e,n,l,u,g,_,w){const A=6*e;return this.int16[A+0]=n,this.int16[A+1]=l,this.int16[A+2]=u,this.int16[A+3]=g,this.int16[A+4]=_,this.int16[A+5]=w,e}}ps.prototype.bytesPerElement=12,yi(ps,"StructArrayLayout6i12");class qh extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w,A,z,O,F,U){const q=this.length;return this.resize(q+1),this.emplace(q,e,n,l,u,g,_,w,A,z,O,F,U)}emplace(e,n,l,u,g,_,w,A,z,O,F,U,q){const Z=12*e;return this.int16[Z+0]=n,this.int16[Z+1]=l,this.int16[Z+2]=u,this.int16[Z+3]=g,this.uint16[Z+4]=_,this.uint16[Z+5]=w,this.uint16[Z+6]=A,this.uint16[Z+7]=z,this.int16[Z+8]=O,this.int16[Z+9]=F,this.int16[Z+10]=U,this.int16[Z+11]=q,e}}qh.prototype.bytesPerElement=24,yi(qh,"StructArrayLayout4i4ui4i24");class Zf extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,u,g,_)}emplace(e,n,l,u,g,_,w){const A=10*e,z=5*e;return this.int16[A+0]=n,this.int16[A+1]=l,this.int16[A+2]=u,this.float32[z+2]=g,this.float32[z+3]=_,this.float32[z+4]=w,e}}Zf.prototype.bytesPerElement=20,yi(Zf,"StructArrayLayout3i3f20");class uu extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,l,u)}emplace(e,n,l,u,g){const _=4*e;return this.float32[_+0]=n,this.float32[_+1]=l,this.float32[_+2]=u,this.float32[_+3]=g,e}}uu.prototype.bytesPerElement=16,yi(uu,"StructArrayLayout4f16");class Xf extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Xf.prototype.bytesPerElement=4,yi(Xf,"StructArrayLayout1ul4");class Tl extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=l,e}}Tl.prototype.bytesPerElement=4,yi(Tl,"StructArrayLayout2ui4");class du extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w,A,z,O,F,U,q){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,n,l,u,g,_,w,A,z,O,F,U,q)}emplace(e,n,l,u,g,_,w,A,z,O,F,U,q,Z){const ee=20*e,le=10*e;return this.int16[ee+0]=n,this.int16[ee+1]=l,this.int16[ee+2]=u,this.int16[ee+3]=g,this.int16[ee+4]=_,this.float32[le+3]=w,this.float32[le+4]=A,this.float32[le+5]=z,this.float32[le+6]=O,this.int16[ee+14]=F,this.uint32[le+8]=U,this.uint16[ee+18]=q,this.uint16[ee+19]=Z,e}}du.prototype.bytesPerElement=40,yi(du,"StructArrayLayout5i4f1i1ul2ui40");class nh extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,u,g,_,w)}emplace(e,n,l,u,g,_,w,A){const z=8*e;return this.int16[z+0]=n,this.int16[z+1]=l,this.int16[z+2]=u,this.int16[z+4]=g,this.int16[z+5]=_,this.int16[z+6]=w,this.int16[z+7]=A,e}}nh.prototype.bytesPerElement=16,yi(nh,"StructArrayLayout3i2i2i16");class Yf extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,u,g)}emplace(e,n,l,u,g,_){const w=4*e,A=8*e;return this.float32[w+0]=n,this.float32[w+1]=l,this.float32[w+2]=u,this.int16[A+6]=g,this.int16[A+7]=_,e}}Yf.prototype.bytesPerElement=16,yi(Yf,"StructArrayLayout2f1f2i16");class Xm extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,u,g,_)}emplace(e,n,l,u,g,_,w){const A=20*e,z=5*e;return this.uint8[A+0]=n,this.uint8[A+1]=l,this.float32[z+1]=u,this.float32[z+2]=g,this.float32[z+3]=_,this.float32[z+4]=w,e}}Xm.prototype.bytesPerElement=20,yi(Xm,"StructArrayLayout2ub4f20");class Wr extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const g=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=l,this.uint16[g+2]=u,e}}Wr.prototype.bytesPerElement=6,yi(Wr,"StructArrayLayout3ui6");class Nu extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe,fe,_e,be,Oe){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe,fe,_e,be,Oe)}emplace(e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe,fe,_e,be,Oe,Ie){const Ue=30*e,Ge=15*e,et=60*e;return this.int16[Ue+0]=n,this.int16[Ue+1]=l,this.int16[Ue+2]=u,this.float32[Ge+2]=g,this.float32[Ge+3]=_,this.uint16[Ue+8]=w,this.uint16[Ue+9]=A,this.uint32[Ge+5]=z,this.uint32[Ge+6]=O,this.uint32[Ge+7]=F,this.uint16[Ue+16]=U,this.uint16[Ue+17]=q,this.uint16[Ue+18]=Z,this.float32[Ge+10]=ee,this.float32[Ge+11]=le,this.uint8[et+48]=oe,this.uint8[et+49]=fe,this.uint8[et+50]=_e,this.uint32[Ge+13]=be,this.int16[Ue+28]=Oe,this.uint8[et+58]=Ie,e}}Nu.prototype.bytesPerElement=60,yi(Nu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ym extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe,fe,_e,be,Oe,Ie,Ue,Ge,et,yt,nt,bt,Mt,Pt,Ht,qt,Ut){const $t=this.length;return this.resize($t+1),this.emplace($t,e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe,fe,_e,be,Oe,Ie,Ue,Ge,et,yt,nt,bt,Mt,Pt,Ht,qt,Ut)}emplace(e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe,fe,_e,be,Oe,Ie,Ue,Ge,et,yt,nt,bt,Mt,Pt,Ht,qt,Ut,$t){const xt=20*e,vt=40*e,Vt=80*e;return this.float32[xt+0]=n,this.float32[xt+1]=l,this.int16[vt+4]=u,this.int16[vt+5]=g,this.int16[vt+6]=_,this.int16[vt+7]=w,this.int16[vt+8]=A,this.int16[vt+9]=z,this.int16[vt+10]=O,this.int16[vt+11]=F,this.int16[vt+12]=U,this.uint16[vt+13]=q,this.uint16[vt+14]=Z,this.uint16[vt+15]=ee,this.uint16[vt+16]=le,this.uint16[vt+17]=oe,this.uint16[vt+18]=fe,this.uint16[vt+19]=_e,this.uint16[vt+20]=be,this.uint16[vt+21]=Oe,this.uint16[vt+22]=Ie,this.uint16[vt+23]=Ue,this.uint16[vt+24]=Ge,this.uint16[vt+25]=et,this.uint16[vt+26]=yt,this.uint16[vt+27]=nt,this.uint32[xt+14]=bt,this.float32[xt+15]=Mt,this.float32[xt+16]=Pt,this.float32[xt+17]=Ht,this.float32[xt+18]=qt,this.uint8[Vt+76]=Ut,this.uint16[vt+39]=$t,e}}Ym.prototype.bytesPerElement=80,yi(Ym,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Kf extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,u,g,_)}emplace(e,n,l,u,g,_,w){const A=6*e;return this.float32[A+0]=n,this.float32[A+1]=l,this.float32[A+2]=u,this.float32[A+3]=g,this.float32[A+4]=_,this.float32[A+5]=w,e}}Kf.prototype.bytesPerElement=24,yi(Kf,"StructArrayLayout6f24");class Td extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,u,g)}emplace(e,n,l,u,g,_){const w=5*e;return this.float32[w+0]=n,this.float32[w+1]=l,this.float32[w+2]=u,this.float32[w+3]=g,this.float32[w+4]=_,e}}Td.prototype.bytesPerElement=20,yi(Td,"StructArrayLayout5f20");class Km extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,u,g,_,w)}emplace(e,n,l,u,g,_,w,A){const z=7*e;return this.float32[z+0]=n,this.float32[z+1]=l,this.float32[z+2]=u,this.float32[z+3]=g,this.float32[z+4]=_,this.float32[z+5]=w,this.float32[z+6]=A,e}}Km.prototype.bytesPerElement=28,yi(Km,"StructArrayLayout7f28");class og extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w,A,z,O,F){const U=this.length;return this.resize(U+1),this.emplace(U,e,n,l,u,g,_,w,A,z,O,F)}emplace(e,n,l,u,g,_,w,A,z,O,F,U){const q=11*e;return this.float32[q+0]=n,this.float32[q+1]=l,this.float32[q+2]=u,this.float32[q+3]=g,this.float32[q+4]=_,this.float32[q+5]=w,this.float32[q+6]=A,this.float32[q+7]=z,this.float32[q+8]=O,this.float32[q+9]=F,this.float32[q+10]=U,e}}og.prototype.bytesPerElement=44,yi(og,"StructArrayLayout11f44");class ah extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w,A,z){const O=this.length;return this.resize(O+1),this.emplace(O,e,n,l,u,g,_,w,A,z)}emplace(e,n,l,u,g,_,w,A,z,O){const F=9*e;return this.float32[F+0]=n,this.float32[F+1]=l,this.float32[F+2]=u,this.float32[F+3]=g,this.float32[F+4]=_,this.float32[F+5]=w,this.float32[F+6]=A,this.float32[F+7]=z,this.float32[F+8]=O,e}}ah.prototype.bytesPerElement=36,yi(ah,"StructArrayLayout9f36");class Rr extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=l,e}}Rr.prototype.bytesPerElement=8,yi(Rr,"StructArrayLayout2f8");class xr extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,l,u)}emplace(e,n,l,u,g){const _=6*e;return this.uint32[3*e+0]=n,this.uint16[_+2]=l,this.uint16[_+3]=u,this.uint16[_+4]=g,e}}xr.prototype.bytesPerElement=12,yi(xr,"StructArrayLayout1ul3ui12");class Fu extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Fu.prototype.bytesPerElement=2,yi(Fu,"StructArrayLayout1ui2");class Jm extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le)}emplace(e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe){const fe=16*e;return this.float32[fe+0]=n,this.float32[fe+1]=l,this.float32[fe+2]=u,this.float32[fe+3]=g,this.float32[fe+4]=_,this.float32[fe+5]=w,this.float32[fe+6]=A,this.float32[fe+7]=z,this.float32[fe+8]=O,this.float32[fe+9]=F,this.float32[fe+10]=U,this.float32[fe+11]=q,this.float32[fe+12]=Z,this.float32[fe+13]=ee,this.float32[fe+14]=le,this.float32[fe+15]=oe,e}}Jm.prototype.bytesPerElement=64,yi(Jm,"StructArrayLayout16f64");class Jf extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,g,_,w){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,u,g,_,w)}emplace(e,n,l,u,g,_,w,A){const z=10*e,O=5*e;return this.uint16[z+0]=n,this.uint16[z+1]=l,this.uint16[z+2]=u,this.uint16[z+3]=g,this.float32[O+2]=_,this.float32[O+3]=w,this.float32[O+4]=A,e}}Jf.prototype.bytesPerElement=20,yi(Jf,"StructArrayLayout4ui3f20");class Qm extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Qm.prototype.bytesPerElement=2,yi(Qm,"StructArrayLayout1i2");class Qf extends La{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Qf.prototype.bytesPerElement=1,yi(Qf,"StructArrayLayout1ub1");class rh extends Wf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}rh.prototype.size=40;class ep extends du{get(e){return new rh(this,e)}}yi(ep,"CollisionBoxArray");class em extends Wf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}em.prototype.size=60;class lg extends Nu{get(e){return new em(this,e)}}yi(lg,"PlacedSymbolArray");class cg extends Wf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}cg.prototype.size=80;class tm extends Ym{get(e){return new cg(this,e)}}yi(tm,"SymbolInstanceArray");class Wh extends bl{getoffsetX(e){return this.float32[1*e+0]}}yi(Wh,"GlyphOffsetArray");class tp extends Mc{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}yi(tp,"SymbolLineVertexArray");class ip extends Wf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ip.prototype.size=12;class im extends xr{get(e){return new ip(this,e)}}yi(im,"FeatureIndexArray");class nm extends Tl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}yi(nm,"FillExtrusionCentroidArray");class Zh extends Wf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Zh.prototype.size=6;class Xh extends th{get(e){return new Zh(this,e)}}yi(Xh,"FillExtrusionWallArray");const np=Mn([{name:"a_pos",components:2,type:"Int16"}],4),n_=Mn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),hu=Mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class tr{constructor(e=[]){this.segments=e}_prepareSegment(e,n,l,u){let g=this.segments[this.segments.length-1];return e>tr.MAX_VERTEX_ARRAY_LENGTH&&mi(`Max vertices per segment is ${tr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>tr.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==u)&&(g={vertexOffset:n,primitiveOffset:l,vertexLength:0,primitiveLength:0},u!==void 0&&(g.sortKey=u),this.segments.push(g)),g}prepareSegment(e,n,l,u){return this._prepareSegment(e,n.length,l.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,u){return new tr([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}function ap(a,e){return 256*(a=ie(Math.floor(a),0,255))+ie(Math.floor(e),0,255)}tr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yi(tr,"SegmentVector");const a_=Mn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Bu=Mn([{name:"a_pattern_b",components:4,type:"Uint16"}]),r_=Mn([{name:"a_dash",components:4,type:"Uint16"}]);class kd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,l,u){this.ids.push(sh(e)),this.positions.push(n,l,u)}eachPosition(e,n){const l=sh(e);let u=0,g=this.ids.length-1;for(;u<g;){const _=u+g>>1;this.ids[_]>=l?g=_:u=_+1}for(;this.ids[u]===l;)n(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,n){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Zr(l,u,0,l.length-1),n&&(n.add(l.buffer),n.add(u.buffer)),{ids:l,positions:u}}static deserialize(e){const n=new kd;let l;n.ids=e.ids,n.positions=e.positions;for(const u of n.ids)u!==l&&n.uniqueIds.push(u),l=u;return n.indexed=!0,n}}function sh(a){const e=+a;return Number.isSafeInteger(e)?e:Xs(String(a))}function Zr(a,e,n,l){for(;n<l;){const u=a[n+l>>1];let g=n-1,_=l+1;for(;;){do g++;while(a[g]<u);do _--;while(a[_]>u);if(g>=_)break;rp(a,g,_),rp(e,3*g,3*_),rp(e,3*g+1,3*_+1),rp(e,3*g+2,3*_+2)}_-n<l-_?(Zr(a,e,n,_),n=_+1):(Zr(a,e,_+1,l),l=_)}}function rp(a,e,n){const l=a[e];a[e]=a[n],a[n]=l}yi(kd,"FeaturePositionMap");class Uu{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class am extends Uu{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Cr extends Uu{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Eo extends Uu{constructor(e){super(e),this.current=[0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Yh extends Uu{constructor(e){super(e),this.current=[0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class rm extends Uu{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class $u extends Uu{constructor(e){super(e),this.current=ha.transparent.toPremultipliedRenderColor(null)}set(e,n,l){this.fetchUniformLocation(e,n)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const fu=new Float32Array(16);class Kh extends Uu{constructor(e){super(e),this.current=fu}set(e,n,l){if(this.fetchUniformLocation(e,n)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const Jh=new Float32Array(9),s_=new Float32Array(4);class Qh extends Uu{constructor(e){super(e),this.current=s_}set(e,n,l){if(this.fetchUniformLocation(e,n)){for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function sm(a){return[ap(255*a.r,255*a.g),ap(255*a.b,255*a.a)]}function Ed(a,e,n,l,u,g,_,w){return!!a&&(a.kind==="composite"||a.kind==="source"?a.evaluate(new Da(0,{brightness:g,worldview:w}),e,n,u,l,_)==="none":a.value==="none")}class ef{constructor(e,n,l,u){this.value=e,this.uniformNames=n.map((g=>`u_${g}`)),this.type=l,this.context=u}setUniform(e,n,l,u,g){const _=u.constantOr(this.value);n.set(e,g,_ instanceof ha?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(e,n){return this.type==="color"?new $u(e):new Cr(e)}}class kl{constructor(e,n){this.uniformNames=n.map((l=>`u_${l}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,n){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=n?n.tl.concat(n.br):this.pattern}setUniform(e,n,l,u,g){let _=null;g!=="u_pattern"&&g!=="u_dash"||(_=this.pattern),g==="u_pattern_b"&&(_=this.patternTransition),g==="u_pixel_ratio"&&(_=this.pixelRatio),_&&n.set(e,g,_)}getBinding(e,n){return n==="u_pattern"||n==="u_pattern_b"||n==="u_dash"?new rm(e):new Cr(e)}}class kr{constructor(e,n,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map((g=>({name:`a_${g}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,n,l,u,g,_,w,A){const z=this.paintVertexArray.length,O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Da(0,{brightness:_,worldview:A}),n,{},g,u,w):this.expression.kind==="constant"&&this.expression.value,F=Ed(this.lutExpression,n,{},u,g,_,w,A);this.paintVertexArray.resize(e),this._setPaintValue(z,e,O,F?null:this.context.lut)}updatePaintArray(e,n,l,u,g,_,w,A){const z=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w,worldview:A},l,u,void 0,g):this.expression.kind==="constant"&&this.expression.value,O=Ed(this.lutExpression,l,u,g,void 0,w,void 0,A);this._setPaintValue(e,n,z,O?null:this.context.lut)}_setPaintValue(e,n,l,u){if(this.type==="color"){const g=sm(l.toPremultipliedRenderColor(u));for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,g[0],g[1])}else{for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jc{constructor(e,n,l,u,g,_){this.expression=e,this.uniformNames=n.map((w=>`u_${w}_t`)),this.type=l,this.useIntegerZoom=u,this.context=g,this.maxValue=0,this.paintVertexAttributes=n.map((w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(e,n,l,u,g,_,w,A){const z=this.expression.evaluate(new Da(this.context.zoom,{brightness:_,worldview:A}),n,{},g,u,w),O=this.expression.evaluate(new Da(this.context.zoom+1,{brightness:_,worldview:A}),n,{},g,u,w),F=Ed(this.lutExpression,n,{},u,g,_,w,A),U=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(U,e,z,O,F?null:this.context.lut)}updatePaintArray(e,n,l,u,g,_,w,A){const z=this.expression.evaluate({zoom:this.context.zoom,brightness:w,worldview:A},l,u,void 0,g),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w,worldview:A},l,u,void 0,g),F=Ed(this.lutExpression,l,u,g,void 0,w,void 0,A);this._setPaintValue(e,n,z,O,F?null:this.context.lut)}_setPaintValue(e,n,l,u,g){if(this.type==="color"){const _=sm(l.toPremultipliedRenderColor(g)),w=sm(l.toPremultipliedRenderColor(g));for(let A=e;A<n;A++)this.paintVertexArray.emplace(A,_[0],_[1],w[0],w[1])}else{for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,l,u,g){const _=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,w=ie(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);n.set(e,g,w)}getBinding(e,n){return new Cr(e)}}class mu{constructor(e,n,l,u,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=(l==="array"?r_:a_).members;for(let _=0;_<n.length;++_);this.paintVertexArray=new u,this.paintTransitionVertexArray=new ol}populatePaintArray(e,n,l,u){const g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(g,e,n.patterns&&n.patterns[this.layerId],l)}updatePaintArray(e,n,l,u,g,_,w){this._setPaintValues(e,n,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(e,n,l,u){if(!u||!l)return;const g=u[l[0]],_=u[l[1]];if(g){if(g){const{tl:w,br:A,pixelRatio:z}=g;for(let O=e;O<n;O++)this.paintVertexArray.emplace(O,w[0],w[1],A[0],A[1],z)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:w,br:A}=_;for(let z=e;z<n;z++)this.paintTransitionVertexArray.emplace(z,w[0],w[1],A[0],A[1])}}}upload(e){const n=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,n)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Bu.members,n))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Xr{constructor(e,n,l=(()=>!0)){this.binders={},this._buffers=[],this.context=n;const u=[];for(const g in e.paint._values){const _=e.paint.get(g);if(g.endsWith("-use-theme")||!l(g)||!(_ instanceof Ac&&Yd(_.property.specification)))continue;const w=l_(g,e.type),A=_.value,z=_.property.specification.type,O=!!_.property.useIntegerZoom,F=g==="line-dasharray"||g.endsWith("pattern"),U=e.paint.get(`${g}-use-theme`),q=g==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||U&&U.value.kind!=="constant";if(A.kind!=="constant"||q)if(A.kind==="source"||q||F){const Z=Ic(g,z,"source");this.binders[g]=F?new mu(A,w,z,Z,e.id):new kr(A,w,z,Z),u.push(`/a_${g}`)}else{const Z=Ic(g,z,"composite");this.binders[g]=new jc(A,w,z,O,n,Z),u.push(`/z_${g}`)}else this.binders[g]=F?new kl(A.value,w):new ef(A.value,w,z,n),u.push(`/u_${g}`);U&&(this.binders[g].lutExpression=U.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof kr||n instanceof jc?n.maxValue:0}populatePaintArrays(e,n,l,u,g,_,w,A){for(const z in this.binders){const O=this.binders[z];O.context=this.context,(O instanceof kr||O instanceof jc||O instanceof mu)&&O.populatePaintArray(e,n,l,u,g,_,w,A)}}setConstantPatternPositions(e,n){for(const l in this.binders){const u=this.binders[l];u instanceof kl&&u.setConstantPatternPositions(e,n)}}getPatternTransitionVertexBuffer(e){const n=this.binders[e];return n instanceof mu?n.paintTransitionVertexBuffer:null}updatePaintArrays(e,n,l,u,g,_,w,A,z,O){let F=!1;const U=Object.keys(e),q=U.length!==0&&!A,Z=q?U:n.uniqueIds;this.context.lut=g.lut;for(const ee in this.binders){const le=this.binders[ee];if(le.context=this.context,(le instanceof kr||le instanceof jc||le instanceof mu)&&le.expression&&le.expression.kind&&le.expression.kind!=="constant"&&(le.expression.isStateDependent===!0||le.expression.isLightConstant===!1)){const oe=g.paint.get(ee);le.expression=oe.value;for(const fe of Z){const _e=e[fe.toString()];n.eachPosition(fe,((be,Oe,Ie)=>{const Ue=u.feature(be);le.updatePaintArray(Oe,Ie,Ue,_e,_,w,z,O)}))}if(!q)for(const fe of l.uniqueIds){const _e=e[fe.toString()];l.eachPosition(fe,((be,Oe,Ie)=>{const Ue=u.feature(be);le.updatePaintArray(Oe,Ie,Ue,_e,_,w,z,O)}))}F=!0}}return F}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof ef||l instanceof kl)&&e.push(...l.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof ef||u instanceof kl||u instanceof jc)for(const g of u.uniformNames)n.push({name:g,property:l,binding:u.getBinding(e,g)})}return n}setUniforms(e,n,l,u,g){for(const{name:_,property:w,binding:A}of l)this.binders[w].setUniform(e,A,g,u.get(w),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof kr||n instanceof jc||n instanceof mu)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer),n instanceof mu&&n.paintTransitionVertexBuffer&&this._buffers.push(n.paintTransitionVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof kr||l instanceof jc||l instanceof mu)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof kr||n instanceof jc||n instanceof mu)&&n.destroy()}}}class zc{constructor(e,n,l=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Xr(u,n,l);this.needsUpload=!1,this._featureMap=new kd,this._featureMapWithoutIds=new kd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,l,u,g,_,w,A,z){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(e,n,u,g,_,w,A,z);n.id!==void 0?this._featureMap.add(n.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,u,g,_,w,A){for(const z of l)this.needsUpload=this.programConfigurations[z.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,z,u,g,_,w||0,A)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const o_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function l_(a,e){return o_[a]||[a.replace(`${e}-`,"").replace(/-/g,"_")]}const ts={"line-pattern":{source:ms,composite:ms},"fill-pattern":{source:ms,composite:ms},"fill-extrusion-pattern":{source:ms,composite:ms},"line-dasharray":{source:ol,composite:ol}},El={color:{source:Rr,composite:uu},number:{source:bl,composite:Rr}};function Ic(a,e,n){const l=ts[a];return l&&l[n]||El[e][n]}yi(ef,"ConstantBinder"),yi(kl,"PatternConstantBinder"),yi(kr,"SourceExpressionBinder"),yi(mu,"PatternCompositeBinder"),yi(jc,"CompositeExpressionBinder"),yi(Xr,"ProgramConfiguration",{omit:["_buffers"]}),yi(zc,"ProgramConfigurationSet");const eo=Xt/Math.PI/2,Hl=5,sp=6,ug=16383,uo=64,Gl=[uo,32,16],ql=-eo,is=eo;function Ad(a,e,n,l=eo){return n=ui(n),[a*Math.sin(n)*l,-e*l,a*Math.cos(n)*l]}function Wl(a,e,n){return Ad(Math.cos(ui(a)),Math.sin(ui(a)),e,n)}const f=63710088e-1,t=2*Math.PI*f;class s{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new s(Te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,u=e.lat*n,g=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return f*Math.acos(Math.min(g,1))}toBounds(e=0){const n=360*e/40075017,l=n/Math.cos(Math.PI/180*this.lat);return new m({lng:this.lng-l,lat:this.lat-n},{lng:this.lng+l,lat:this.lat+n})}toEcef(e){return Wl(this.lat,this.lng,eo+e*eo/f)}static convert(e){if(e instanceof s)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new s(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new s(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class m{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof s?new s(e.lng,e.lat):s.convert(e),this}setSouthWest(e){return this._sw=e instanceof s?new s(e.lng,e.lat):s.convert(e),this}extend(e){const n=this._sw,l=this._ne;let u,g;if(e instanceof s)u=e,g=e;else{if(!(e instanceof m))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(m.convert(e)):this.extend(s.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(s.convert(e)):this;if(u=e._sw,g=e._ne,!u||!g)return this}return n||l?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),l.lng=Math.max(g.lng,l.lng),l.lat=Math.max(g.lat,l.lat)):(this._sw=new s(u.lng,u.lat),this._ne=new s(g.lng,g.lat)),this}getCenter(){return new s((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s(this.getWest(),this.getNorth())}getSouthEast(){return new s(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:l}=s.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){if(e)return e instanceof m?e:new m(e)}}const v=0,T=25.5;function E(a){return t*Math.cos(a*Math.PI/180)}function j(a){return(180+a)/360}function D(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function B(a,e){return a/E(e)}function V(a){return 360*a-180}function Y(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function X(a,e){return a*E(Y(e))}const J=85.051129;function se(a){return Math.cos(ui(ie(a,-J,J)))}function ne(a,e){const n=ie(e,v,T),l=Math.pow(2,n);return se(a)*t/(512*l)}function he(a){return 1/Math.cos(a*Math.PI/180)}function de(a,e=0){const n=Math.exp(Math.PI*(1-(a.y+e/Xt)/(1<<a.z)*2));return 80150034*n/(n*n+1)/Xt/(1<<a.z)}class pe{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=s.convert(e);return new pe(j(l.lng),D(l.lat),B(n,l.lat))}toLngLat(){return new s(V(this.x),Y(this.y))}toAltitude(){return X(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/t*he(Y(this.y))}}function xe(a,e,n,l,u,g,_,w,A){const z=(e+l)/2,O=(n+u)/2,F=new Pe(z,O);w(F),(function(U,q,Z,ee,le,oe){const fe=Z-le,_e=ee-oe;return Math.abs((ee-q)*fe-(Z-U)*_e)/Math.hypot(fe,_e)})(F.x,F.y,g.x,g.y,_.x,_.y)>=A?(xe(a,e,n,z,O,g,F,w,A),xe(a,z,O,l,u,F,_,w,A)):a.push(_)}function ge(a,e,n){let l=a[0],u=l.x,g=l.y;e(l);const _=[l];for(let w=1;w<a.length;w++){const A=a[w],{x:z,y:O}=A;e(A),xe(_,u,g,z,O,l,A,e,n),u=z,g=O,l=A}return _}function je(a,e,n,l){if(l(e,n)){const u=e.add(n)._mult(.5);je(a,e,u,l),je(a,u,n,l)}else a.push(n)}function Ae(a,e){let n=a[0];const l=[n];for(let u=1;u<a.length;u++){const g=a[u];je(l,n,g,e),n=g}return l}const De=Math.pow(2,14)-1,ze=-De-1;function Me(a,e){const n=Math.round(a.x*e),l=Math.round(a.y*e);return a.x=ie(n,ze,De),a.y=ie(l,ze,De),(n<a.x||n>a.x+1||l<a.y||l>a.y+1)&&mi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Ve(a,e,n){const l=a.loadGeometry(),u=a.extent,g=Xt/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:w,x:A,y:z,projection:O}=n,F=U=>{const q=V((e.x+U.x/u)/_),Z=Y((e.y+U.y/u)/_),ee=O.project(q,Z);U.x=(ee.x*w-A)*u,U.y=(ee.y*w-z)*u};for(let U=0;U<l.length;U++)if(a.type!==1)l[U]=ge(l[U],F,1);else{const q=[];for(const Z of l[U])Z.x<0||Z.x>=u||Z.y<0||Z.y>=u||(F(Z),q.push(Z));l[U]=q}}for(const _ of l)for(const w of _)Me(w,g);return l}function it(a,e){return{type:a.type,id:a.id,properties:a.properties,geometry:e?Ve(a):[]}}class Ye{constructor(e,n,l,u,g){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=g,e.readFields(dt,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,l=[];let u,g=1,_=0,w=0,A=0;for(;e.pos<n;){if(_<=0){const z=e.readVarint();g=7&z,_=z>>3}if(_--,g===1||g===2)w+=e.readSVarint(),A+=e.readSVarint(),g===1&&(u&&l.push(u),u=[]),u&&u.push(new Pe(w,A));else{if(g!==7)throw new Error(`unknown command ${g}`);u&&u.push(u[0].clone())}}return u&&l.push(u),l}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let l=1,u=0,g=0,_=0,w=1/0,A=-1/0,z=1/0,O=-1/0;for(;e.pos<n;){if(u<=0){const F=e.readVarint();l=7&F,u=F>>3}if(u--,l===1||l===2)g+=e.readSVarint(),_+=e.readSVarint(),g<w&&(w=g),g>A&&(A=g),_<z&&(z=_),_>O&&(O=_);else if(l!==7)throw new Error(`unknown command ${l}`)}return[w,z,A,O]}toGeoJSON(e,n,l){const u=this.extent*Math.pow(2,l),g=this.extent*e,_=this.extent*n,w=this.loadGeometry();function A(U){return[360*(U.x+g)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(U.y+_)/u)*Math.PI))-90]}function z(U){return U.map(A)}let O;if(this.type===1){const U=[];for(const Z of w)U.push(Z[0]);const q=z(U);O=U.length===1?{type:"Point",coordinates:q[0]}:{type:"MultiPoint",coordinates:q}}else if(this.type===2){const U=w.map(z);O=U.length===1?{type:"LineString",coordinates:U[0]}:{type:"MultiLineString",coordinates:U}}else{if(this.type!==3)throw new Error("unknown feature type");{const U=(function(Z){const ee=Z.length;if(ee<=1)return[Z];const le=[];let oe,fe;for(let _e=0;_e<ee;_e++){const be=mt(Z[_e]);be!==0&&(fe===void 0&&(fe=be<0),fe===be<0?(oe&&le.push(oe),oe=[Z[_e]]):oe&&oe.push(Z[_e]))}return oe&&le.push(oe),le})(w),q=[];for(const Z of U)q.push(Z.map(z));O=q.length===1?{type:"Polygon",coordinates:q[0]}:{type:"MultiPolygon",coordinates:q}}}const F={type:"Feature",geometry:O,properties:this.properties};return this.id!=null&&(F.id=this.id),F}}function dt(a,e,n){a===1?e.id=n.readVarint():a===2?(function(l,u){const g=l.readVarint()+l.pos;for(;l.pos<g;){const _=u._keys[l.readVarint()],w=u._values[l.readVarint()];u.properties[_]=w}})(n,e):a===3?e.type=n.readVarint():a===4&&(e._geometry=n.pos)}function mt(a){let e=0;for(let n,l,u=0,g=a.length,_=g-1;u<g;_=u++)n=a[u],l=a[_],e+=(l.x-n.x)*(n.y+l.y);return e}Ye.types=["Unknown","Point","LineString","Polygon"];class Tt{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Ot,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Ye(this._pbf,n,this.extent,this._keys,this._values)}}function Ot(a,e,n){a===15?e.version=n.readVarint():a===1?e.name=n.readString():a===5?e.extent=n.readVarint():a===2?e._features.push(n.pos):a===3?e._keys.push(n.readString()):a===4&&e._values.push((function(l){let u=null;const g=l.readVarint()+l.pos;for(;l.pos<g;){const _=l.readVarint()>>3;u=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(n))}class st{constructor(e,n){this.layers=e.readFields(Xe,{},n)}}function Xe(a,e,n){if(a===3){const l=new Tt(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}const pt="3d_elevation_id",ht="level";class Nt{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,n){return this._valid&&e(n(this._geometry)),this}require(e,n,l){return this.get(e,!0,n,l)}optional(e,n,l){return this.get(e,!1,n,l)}success(){return this._valid}get(e,n,l,u){const g=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?l(u?u(g):g):n&&(this._valid=!1),this}}class ti{constructor(e,n){this.featureFunc=e,this.vertexFunc=n}parseFeature(e,n,l){return this.featureFunc(e,n,l)}parseVertex(e,n,l){return this.vertexFunc(e,n,l)}}const gi=new ti(((a,e,n)=>a.reset(e).require(pt,(l=>{n.id=l})).optional("fixed_height_relative",(l=>{n.constantHeight=l}),Dt.decodeRelativeHeight).geometry((l=>{n.bounds=l}),Ds).success()),((a,e,n)=>a.reset(e).require(pt,(l=>{n.id=l})).require("elevation_idx",(l=>{n.idx=l})).require("extent",(l=>{n.extent=l})).require("height_relative",(l=>{n.height=l}),Dt.decodeRelativeHeight).geometry((l=>{n.position=l}),Dt.getPoint).success())),Wt=new ti(((a,e,n)=>a.reset(e).require(pt,(l=>{n.id=l})).optional("fixed_height",(l=>{n.constantHeight=l}),Dt.decodeMetricHeight).geometry((l=>{n.bounds=l}),Ds).success()),((a,e,n)=>a.reset(e).require(pt,(l=>{n.id=l})).require("elevation_idx",(l=>{n.idx=l})).require("extent",(l=>{n.extent=l})).require("height",(l=>{n.height=l}),Dt.decodeMetricHeight).geometry((l=>{n.position=l}),Dt.getPoint).success()));class Dt{static getPoint(e){return zr(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Wt:void 0:gi}static parse(e){const n=[],l=[],u=e.length,g=new Nt;for(let _=0;_<u;_++){const w=e.feature(_),A=w.properties.version,z=Dt.getVersionSchema(A);if(z===void 0){mi(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const O=w.properties.type;if(!O)continue;const F=Ye.types[w.type];if(F==="Point"&&O==="curve_point"){const U={};z.parseVertex(g,w,U)&&n.push(U)}else if(F==="Polygon"&&O==="curve_meta"){const U={};z.parseFeature(g,w,U)&&l.push(U)}}return{vertices:n,features:l}}}class Ti{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,l){const u=po(n,this.dir);if(Math.abs(u)<1e-6)return!1;const g=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1])/u;return l[0]=this.pos[0]+this.dir[0]*g,l[1]=this.pos[1]+this.dir[1]*g,!0}}class bi{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,l){const u=On(n,this.dir);if(Math.abs(u)<1e-6)return!1;const g=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return l[0]=this.pos[0]+this.dir[0]*g,l[1]=this.pos[1]+this.dir[1]*g,l[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,n,l){if((function(q,Z){var ee=q[0],le=q[1],oe=q[2],fe=Z[0],_e=Z[1],be=Z[2];return Math.abs(ee-fe)<=M*Math.max(1,Math.abs(ee),Math.abs(fe))&&Math.abs(le-_e)<=M*Math.max(1,Math.abs(le),Math.abs(_e))&&Math.abs(oe-be)<=M*Math.max(1,Math.abs(oe),Math.abs(be))})(this.pos,e)||n===0)return l[0]=l[1]=l[2]=0,!1;const[u,g,_]=this.dir,w=this.pos[0]-e[0],A=this.pos[1]-e[1],z=this.pos[2]-e[2],O=u*u+g*g+_*_,F=2*(w*u+A*g+z*_),U=F*F-4*O*(w*w+A*A+z*z-n*n);if(U<0){const q=Math.max(-F/2,0),Z=w+u*q,ee=A+g*q,le=z+_*q,oe=Math.hypot(Z,ee,le);return l[0]=Z*n/oe,l[1]=ee*n/oe,l[2]=le*n/oe,!1}{const q=(-F-Math.sqrt(U))/(2*O);if(q<0){const Z=Math.hypot(w,A,z);return l[0]=w*n/Z,l[1]=A*n/Z,l[2]=z*n/Z,!1}return l[0]=w+u*q,l[1]=A+g*q,l[2]=z+_*q,!0}}}class di{constructor(e,n,l,u,g){this.TL=e,this.TR=n,this.BR=l,this.BL=u,this.horizon=g}static fromInvProjectionMatrix(e,n,l){const u=[-1,1,1],g=[1,1,1],_=[1,-1,1],w=[-1,-1,1],A=Fi(u,u,e),z=Fi(g,g,e),O=Fi(_,_,e),F=Fi(w,w,e);return new di(A,z,O,F,n/l)}}function _i(a,e,n){let l=1/0,u=-1/0;const g=[];for(const _ of a){za(g,_,e);const w=On(g,n);l=Math.min(l,w),u=Math.max(u,w)}return[l,u]}function Bi(a,e){let n=!0;for(let l=0;l<a.planes.length;l++){const u=a.planes[l];let g=0;for(let _=0;_<e.length;_++)g+=+(On(u,e[_])+u[3]>=0);if(g===0)return 0;g!==e.length&&(n=!1)}return n?2:1}function dn(a,e){for(const n of a.projections){const l=_i(e,a.points[0],n.axis);if(n.projection[1]<l[0]||n.projection[0]>l[1])return 0}return 1}function Pn(a,e){let n=0;const l=[0,0,0,0];for(let _=0;_<a.length;_++)l[0]=a[_][0],l[1]=a[_][1],l[2]=a[_][2],l[3]=1,(u=l)[0]*(g=e)[0]+u[1]*g[1]+u[2]*g[2]+u[3]*g[3]>=0&&n++;var u,g;return n}class Jn{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=wi.fromPoints(this.points),this.projections=[],this.frustumEdges=[za([],this.points[2],this.points[3]),za([],this.points[0],this.points[3]),za([],this.points[4],this.points[0]),za([],this.points[5],this.points[1]),za([],this.points[6],this.points[2]),za([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const u=[0,-l[2],l[1]],g=[l[2],0,-l[0]];this.projections.push({axis:u,projection:_i(this.points,this.points[0],u)}),this.projections.push({axis:g,projection:_i(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(e,n,l,u){const g=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((z=>{const O=Vr([],z,e),F=1/O[3]/n*g;return(U=O)[0]=(q=O)[0]*(Z=[F,F,u?1/O[3]:F,F])[0],U[1]=q[1]*Z[1],U[2]=q[2]*Z[2],U[3]=q[3]*Z[3],U;var U,q,Z})),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((z=>{const O=qn([],Ja([],za([],_[z[0]],_[z[1]]),za([],_[z[2]],_[z[1]]))),F=-On(O,_[z[1]]);return O.concat(F)})),A=[];for(let z=0;z<_.length;z++)A.push([_[z][0],_[z][1],_[z][2]]);return new Jn(A,w)}intersectsPrecise(e,n,l){for(let u=0;u<n.length;u++)if(!Pn(e,n[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Pn(e,this.planes[u]))return 0;for(const u of l)for(const g of this.frustumEdges){const _=Ja([],u,g),w=Ri(_);if(w===0)continue;Ct(_,_,1/w);const A=_i(this.points,this.points[0],_),z=_i(e,this.points[0],_);if(A[0]>z[1]||z[0]>A[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const l=n[3];if(On([n[0],n[1],n[2]],e)+l<0)return!1}return!0}}class wi{static fromPoints(e){const n=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const u of e)_t(n,n,u),At(l,l,u);return new wi(n,l)}static fromTileIdAndHeight(e,n,l){const u=1<<e.canonical.z,g=e.canonical.x,_=e.canonical.y;return new wi([g/u,_/u,n],[(g+1)/u,(_+1)/u,l])}static applyTransform(e,n){const l=e.getCorners();for(let u=0;u<l.length;++u)Fi(l[u],l[u],n);return wi.fromPoints(l)}static applyTransformFast(e,n){const l=[n[12],n[13],n[14]],u=[...l];for(let g=0;g<3;g++)for(let _=0;_<3;_++){const w=n[4*_+g],A=w*e.min[_],z=w*e.max[_];l[g]+=Math.min(A,z),u[g]+=Math.max(A,z)}return new wi(l,u)}static projectAabbCorners(e,n){const l=e.getCorners();for(let u=0;u<l.length;++u)Fi(l[u],l[u],n);return l}constructor(e,n){this.min=e,this.max=n,this.center=Ct([],jt([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],l=Vi(this.min),u=Vi(this.max);for(let g=0;g<n.length;g++)l[g]=n[g]?this.min[g]:this.center[g],u[g]=n[g]?this.center[g]:this.max[g];return u[2]=this.max[2],new wi(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Bi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Bi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?dn(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?dn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}yi(wi,"Aabb");class Qn{constructor(e,n){this.feature=e,this.metersToTile=n,this.index=0}get(){const e=this.feature.vertices[this.index],n=this.feature.vertexProps[this.index].dir,l=n[1],u=-n[0],g=(e.extent+1)*this.metersToTile;return[new Pe(Math.trunc(e.position[0]+l*g),Math.trunc(e.position[1]+u*g)),new Pe(Math.trunc(e.position[0]-l*g),Math.trunc(e.position[1]-u*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Wi{constructor(e,n,l,u,g,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[yr(),yr(),yr(),yr(),yr(),yr(),yr()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=n,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=g,this.edges=this.edges.filter((w=>{return w.a<this.vertices.length&&w.b<this.vertices.length&&!((A=this.vertices[w.a].position)[0]===(z=this.vertices[w.b].position)[0]&&A[1]===z[1]);var A,z})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:zr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const A=this.vertices[w.a].position,z=this.vertices[w.b].position,O=mo(yr(),z,A),F=Gs(O),U=Ko(yr(),O,1/F);this.edgeProps.push({vec:O,dir:U,len:F});const q=this.vertexProps[w.a].dir,Z=this.vertexProps[w.b].dir;Ss(q,q,U),Ss(Z,Z,U)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||ec(w.dir,w.dir);this.tessellate(_)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const n=this.getClosestEdge(e);if(n==null)return 0;const[l,u]=n;return $i(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,u)}computeSlopeNormal(e,n){const l=this.getClosestEdge(e);if(!l)return We(0,0,1);const u=l[0],g=this.edges[u],_=this.edgeProps[u].vec,w=We(_[0],_[1],(this.vertices[g.b].height-this.vertices[g.a].height)*n),A=We(w[1],-w[0],0);Ja(A,A,w);const z=Ri(A);return z>0?Ct(A,A,1/z):Et(A,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let n=0,l=Number.POSITIVE_INFINITY,u=0;const[g,_,w,A,z,O,F]=this._tmpVec2;Ql(F,e.x,e.y);const U=new Ti(F,null);for(let q=0;q<this.edges.length;q++){const Z=this.edges[q],ee=this.edgeProps[q].dir;U.dir=ee;const le=this.vertices[Z.a].position,oe=this.vertices[Z.b].position,fe=U.intersectsPlane(le,this.vertexProps[Z.a].dir,g),_e=U.intersectsPlane(oe,this.vertexProps[Z.b].dir,_);if(!fe||!_e)continue;mo(w,_,g),mo(A,F,g);const be=po(w,w),Oe=be>0?po(A,w)/be:0,Ie=ie(Oe,0,1),Ue=Math.abs((Oe-Ie)*this.edgeProps[q].len);mo(z,F,le),Ql(O,ee[1],-ee[0]);const Ge=Ue+Math.abs(po(z,O));Ge<l&&(n=q,l=Ge,u=Ie)}return[n,u]}tessellate(e){const n=Ft(),l=Ft(),u=Ft(),g=Ft();for(let _=this.edges.length-1;_>=0;--_){const w=this.edges[_].a,A=this.edges[_].b,{position:z,height:O,extent:F}=this.vertices[w],{position:U,height:q,extent:Z}=this.vertices[A],ee=this.vertexProps[w].dir,le=this.vertexProps[A].dir;if(Et(n,z[0]/e,z[1]/e,O),Et(l,U[0]/e,U[1]/e,q),Et(u,ee[1],-ee[0],0),Ct(u,u,F),Et(g,le[1],-le[0],0),Ct(g,g,Z),this.distSqLines(We(n[0]+.5*u[0],n[1]+.5*u[1],n[2]+.5*u[2]),We(l[0]-.5*g[0],l[1]-.5*g[1],l[2]-.5*g[2]),We(n[0]-.5*u[0],n[1]-.5*u[1],n[2]-.5*u[2]),We(l[0]+.5*g[0],l[1]+.5*g[1],l[2]+.5*g[2]))<=.0025000000000000005)continue;const oe=this.vertices.length,fe=Ss(yr(),z,U);this.vertices.push({position:Ko(fe,fe,.5),height:.5*(O+q),extent:.5*(F+Z)});const _e=Ss(yr(),ee,le);this.vertexProps.push({dir:ec(_e,_e)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:w,b:oe}),this.edges.push({a:oe,b:A});const be=mo(yr(),this.vertices[oe].position,z),Oe=Gs(be),Ie={vec:be,dir:Ko(yr(),be,1/Oe),len:Oe};this.edgeProps.push(Ie),this.edgeProps.push(Ie)}}distSqLines(e,n,l,u){const g=Gi(Ft(),n,e),_=Gi(Ft(),u,l),w=Gi(Ft(),e,l),A=On(g,g),z=On(g,_),O=On(g,w),F=On(_,_),U=On(_,w),q=A*F-z*z;if(q===0)return li(Qi(g,l,u,On(w,_)/On(_,_)),e);const Z=(A*U-z*O)/q;return li(Qi(g,e,n,(z*U-O*F)/q),Qi(_,l,u,Z))}}class la{static parseFrom(e,n){const l=Dt.parse(e);if(!l)return[];let{vertices:u,features:g}=l;const _=1/de(n);g.sort(((O,F)=>O.id-F.id)),u.sort(((O,F)=>O.id-F.id||O.idx-F.idx)),u=u.filter(((O,F,U)=>F===U.findIndex((q=>q.id===O.id&&q.idx===O.idx))));const w=new Array;let A=0;const z=u.length;for(const O of g){if(O.constantHeight){w.push(new Wi(O.id,O.bounds,O.constantHeight));continue}for(;A!==z&&u[A].id<O.id;)A++;if(A===z||u[A].id!==O.id)continue;const F=new Array,U=new Array,q=A;for(;A!==z&&u[A].id===O.id;){const Z=u[A];if(F.push({position:Z.position,height:Z.height,extent:Z.extent}),A!==q&&u[A-1].idx===Z.idx-1){const ee=A-q;U.push({a:ee-1,b:ee})}A++}w.push(new Wi(O.id,O.bounds,void 0,F,U,_))}return w}static getElevationFeature(e,n){if(!n)return;const l=+e.properties[pt];return Number.isNaN(l)?void 0:n.find((u=>u.id===l))}}class _a{constructor(e,n){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(n)||(this.zScale=Math.pow(2,n.z-e.z),this.xOffset=(e.x*this.zScale-n.x)*Xt,this.yOffset=(e.y*this.zScale-n.y)*Xt)}constantElevation(e,n){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,n)}pointElevation(e,n,l){const u=this.constantElevation(n,l);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(n.pointElevation(e),l))}computeBiasedHeight(e,n){return n<=0?e:e+n*ue(0,n,e>=0?e:Math.abs(.5*e))}}yi(Wi,"ElevationFeature");class ya{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Mc,this.indexArray=new Wr,this.segments=new tr,this.programConfigurations=new zc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new bl),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,u){}populate(e,n,l,u){const g=this.layers[0],_=[];let w=null;g.type==="circle"&&(w=g.layout.get("circle-sort-key"));for(const{feature:z,id:O,index:F,sourceLayerIndex:U}of e){const q=this.layers[0]._featureFilter.needGeometry,Z=it(z,q);if(!this.layers[0]._featureFilter.filter(new Da(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),Z,l))continue;const ee=w?w.evaluate(Z,{},l):void 0,le={id:O,properties:z.properties,type:z.type,sourceLayerIndex:U,index:F,geometry:q?Z.geometry:Ve(z,l,u),patterns:{},sortKey:ee};_.push(le)}w&&_.sort(((z,O)=>z.sortKey-O.sortKey));let A=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new ps,A=u.projection);for(const z of _){const{geometry:O,index:F,sourceLayerIndex:U}=z,q=e[F].feature;this.addFeature(z,O,F,n.availableImages,l,A,n.brightness,n.elevationFeatures),n.featureIndex.insert(q,O,F,U,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,n,l,u,g,_,w){this.programConfigurations.updatePaintArrays(e,n,g,l,u,_,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,np.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hu.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,n_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,n,l,u,g,_,w,A){let z;this.elevationMode!=="none"&&(z=la.getElevationFeature(e,A));for(const O of n)for(const F of O){const U=F.x,q=F.y;if(U<0||U>=Xt||q<0||q>=Xt)continue;if(_){const le=_.projectTilePoint(U,q,g),oe=_.upVector(g,U,q);this.addGlobeExtVertex(le,oe),this.addGlobeExtVertex(le,oe),this.addGlobeExtVertex(le,oe),this.addGlobeExtVertex(le,oe)}const Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ee=Z.vertexLength;if(this.addCircleVertex(U,q,-1,-1),this.addCircleVertex(U,q,1,-1),this.addCircleVertex(U,q,1,1),this.addCircleVertex(U,q,-1,1),this.elevationMode!=="none"){const le=z?z.pointElevation(new Pe(U,q)):0;this.hasElevation=this.hasElevation||le!==0;for(let oe=0;oe<4;oe++)this.elevatedLayoutVertexArray.emplaceBack(le)}this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+2,ee+3),Z.vertexLength+=4,Z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,g,w,void 0,this.worldview)}addCircleVertex(e,n,l,u){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*n+(u+1)/2)}addGlobeExtVertex(e,n){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}}function Rn(a,e){for(let n=0;n<a.length;n++)if(Ma(e,a[n]))return!0;for(let n=0;n<e.length;n++)if(Ma(a,e[n]))return!0;return!!Za(a,e)}function mn(a,e,n){return!!Ma(a,e)||!!Oa(e,a,n)}function ta(a,e){if(a.length===1)return lr(e,a[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let u=0;u<l.length;u++)if(Ma(a,l[u]))return!0}for(let n=0;n<a.length;n++)if(lr(e,a[n]))return!0;for(let n=0;n<e.length;n++)if(Za(a,e[n]))return!0;return!1}function Va(a,e,n){if(a.length>1){if(Za(a,e))return!0;for(let l=0;l<e.length;l++)if(Oa(e[l],a,n))return!0}for(let l=0;l<a.length;l++)if(Oa(a[l],e,n))return!0;return!1}function Za(a,e){if(a.length===0||e.length===0)return!1;for(let n=0;n<a.length-1;n++){const l=a[n],u=a[n+1];for(let g=0;g<e.length-1;g++)if(ca(l,u,e[g],e[g+1]))return!0}return!1}function ca(a,e,n,l){return tn(a,n,l)!==tn(e,n,l)&&tn(a,e,n)!==tn(a,e,l)}function Wn(a,e,n){return(a.x-n.x)*(e.y-n.y)-(a.y-n.y)*(e.x-n.x)}function gn(a,e,n,l){const u=Wn(a,e,l),g=Wn(a,e,n);if(Math.sign(u)===Math.sign(g))return;const _=Wn(n,l,a),w=_+g-u;return Math.sign(_)!==Math.sign(w)?[_/(_-w),g/(g-u)]:void 0}function Oa(a,e,n){const l=n*n;if(e.length===1)return a.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(Tr(a,e[u-1],e[u])<l)return!0;return!1}function Tr(a,e,n){const l=e.distSqr(n);if(l===0)return a.distSqr(e);const u=((a.x-e.x)*(n.x-e.x)+(a.y-e.y)*(n.y-e.y))/l;return a.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function lr(a,e){let n,l,u,g=!1;for(let _=0;_<a.length;_++){n=a[_];for(let w=0,A=n.length-1;w<n.length;A=w++)l=n[w],u=n[A],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(g=!g)}return g}function Ma(a,e){let n=!1;for(let l=0,u=a.length-1;l<a.length;u=l++){const g=a[l],_=a[u];g.y>e.y!=_.y>e.y&&e.x<(_.x-g.x)*(e.y-g.y)/(_.y-g.y)+g.x&&(n=!n)}return n}function Ao(a,e,n,l,u){for(const _ of a)if(e<=_.x&&n<=_.y&&l>=_.x&&u>=_.y)return!0;const g=[new Pe(e,n),new Pe(e,u),new Pe(l,u),new Pe(l,n)];if(a.length>2){for(const _ of g)if(Ma(a,_))return!0}for(let _=0;_<a.length-1;_++)if(Ns(a[_],a[_+1],g))return!0;return!1}function Ns(a,e,n){const l=n[0],u=n[2];if(a.x<l.x&&e.x<l.x||a.x>u.x&&e.x>u.x||a.y<l.y&&e.y<l.y||a.y>u.y&&e.y>u.y)return!1;const g=tn(a,e,n[0]);return g!==tn(a,e,n[1])||g!==tn(a,e,n[2])||g!==tn(a,e,n[3])}function Er(a,e,n,l,u,g){let _=e.y-a.y,w=a.x-e.x;if(g=g||0){const A=_*_+w*w;if(A===0)return!0;const z=Math.sqrt(A);_/=z,w/=z}return!((n.x-a.x)*_+(n.y-a.y)*w-g<0||(l.x-a.x)*_+(l.y-a.y)*w-g<0||(u.x-a.x)*_+(u.y-a.y)*w-g<0)}function ks(a,e,n,l,u,g,_){return!(Er(a,e,l,u,g,_)||Er(e,n,l,u,g,_)||Er(n,a,l,u,g,_)||Er(l,u,a,e,n,_)||Er(u,g,a,e,n,_)||Er(g,l,a,e,n,_))}function to(a,e,n){const l=e.paint.get(a).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(a)}function Es(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Al(a,e,n,l,u){if(!e[0]&&!e[1])return a;const g=Pe.convert(e)._mult(u);n==="viewport"&&g._rotate(-l);const _=[];for(let w=0;w<a.length;w++)_.push(a[w].sub(g));return _}function Zl(a,e,n,l){const u=Pe.convert(a)._mult(l);return e==="viewport"&&u._rotate(-n),u}let $o,dr;function gr(a,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[a*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}yi(ya,"CircleBucket",{omit:["layers"]});class Ea{constructor(e,n,l){this.z=e,this.x=n,this.y=l,this.key=ir(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const n=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>n&&e.y===this.y>>n}url(e,n){const l=(function(g,_,w){var A=gr(256*g,256*(_=Math.pow(2,w)-_-1),w),z=gr(256*(g+1),256*(_+1),w);return A[0]+","+A[1]+","+z[0]+","+z[1]})(this.x,this.y,this.z),u=(function(g,_,w){let A,z="";for(let O=g;O>0;O--)A=1<<O-1,z+=(_&A?1:0)+(w&A?2:0);return z})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Mr{constructor(e,n){this.wrap=e,this.canonical=n,this.key=ir(e,n.z,n.z,n.x,n.y)}}class Dn{constructor(e,n,l,u,g){this.overscaledZ=e,this.wrap=n,this.canonical=new Ea(l,+u,+g),this.key=n===0&&e===l?this.canonical.key:ir(n,e,l,u,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Dn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return ir(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return ir(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Dn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new Dn(n,this.wrap,n,l,u),new Dn(n,this.wrap,n,l+1,u),new Dn(n,this.wrap,n,l,u+1),new Dn(n,this.wrap,n,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Dn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Dn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Mr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ir(a,e,n,l,u){const g=1<<Math.min(n,22);let _=g*(u%g)+l%g;return a&&n<22&&(_+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-n)))),16*(32*_+n)+(e-n)}const lc=[a=>{let e=a.canonical.x-1,n=a.wrap;return e<0&&(e=(1<<a.canonical.z)-1,n--),new Dn(a.overscaledZ,n,a.canonical.z,e,a.canonical.y)},a=>{let e=a.canonical.x+1,n=a.wrap;return e===1<<a.canonical.z&&(e=0,n++),new Dn(a.overscaledZ,n,a.canonical.z,e,a.canonical.y)},a=>new Dn(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Dn(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];yi(Ea,"CanonicalTileID"),yi(Dn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const tf=Mn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rc}=tf,om=Mn([{name:"a_pos_3",components:3,type:"Int16"}]);var nf=Mn([{name:"a_pos",type:"Int16",components:2}]);function Xl(a){return a*eo/f}const Cl=[new wi([ql,ql,ql],[is,is,is]),new wi([ql,ql,ql],[0,0,is]),new wi([0,ql,ql],[is,0,is]),new wi([ql,0,ql],[0,is,is]),new wi([0,0,ql],[is,is,is])];function Cd(a,e,n,l=!0){const u=Ct([],a._camera.position,a.worldSize),g=[e,n,1,1];Vr(g,g,a.pixelMatrixInverse),ws(g,g,1/g[3]);const _=qn([],za([],g,u)),w=a.globeMatrix,A=[w[12],w[13],w[14]],z=za([],A,u),O=Ri(z),F=qn([],z),U=a.worldSize/(2*Math.PI),q=On(F,_),Z=Math.asin(U/O);if(Z<Math.acos(q)){if(!l)return null;const yt=[],nt=[];Ct(yt,_,O/q),qn(nt,za(nt,yt,z)),qn(_,jt(_,z,Ct(_,nt,Math.tan(Z)*O)))}const ee=[];new bi(u,_).closestPointOnSphere(A,U,ee);const le=qn([],Ta(w,0)),oe=qn([],Ta(w,1)),fe=qn([],Ta(w,2)),_e=On(le,ee),be=On(oe,ee),Oe=On(fe,ee),Ie=qi(Math.asin(-be/U));let Ue=qi(Math.atan2(_e,Oe));Ue=a.center.lng+(function(yt,nt){const bt=(nt-yt+180)%360-180;return bt<-180?bt+360:bt})(a.center.lng,Ue);const Ge=j(Ue),et=ie(D(Ie),0,1);return new pe(Ge,et)}class Dc{constructor(e,n,l){this.a=za([],e,l),this.b=za([],n,l),this.center=l;const u=qn([],this.a),g=qn([],this.b);this.angle=Math.acos(On(u,g))}}function Lc(a,e){if(a.angle===0)return null;let n;return n=a.a[e]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[e]/a.a[e]/Math.sin(a.angle)-1/Math.tan(a.angle)),n<0||n>1?null:(function(l,u,g,_){const w=Math.sin(g);return l*(Math.sin((1-_)*g)/w)+u*(Math.sin(_*g)/w)})(a.a[e],a.b[e],a.angle,ie(n,0,1))+a.center[e]}function Co(a){if(a.z<=1)return Cl[a.z+2*a.y+a.x];const e=c_(dg(a));return wi.fromPoints(e)}function ho(a,e,n){return Ct(a,a,1-n),oi(a,a,e,n)}function op(a,e,n){for(const l of a)Fi(l,l,e),Ct(l,l,n)}function vx(a,e,n,l){const u=e/a.worldSize,g=a.globeMatrix;if(n.z<=1){const et=Co(n).getCorners();return op(et,g,u),wi.fromPoints(et)}const _=dg(n,l),w=c_(_,eo+Xl(a._tileCoverLift));op(w,g,u);const A=Number.MAX_VALUE,z=[-A,-A,-A],O=[A,A,A];if(_.contains(a.center)){for(const nt of w)_t(O,O,nt),At(z,z,nt);z[2]=0;const et=a.point,yt=[et.x*u,et.y*u,0];return _t(O,O,yt),At(z,z,yt),new wi(O,z)}if(a._tileCoverLift>0){for(const et of w)_t(O,O,et),At(z,z,et);return new wi(O,z)}const F=[g[12]*u,g[13]*u,g[14]*u],U=_.getCenter(),q=ie(a.center.lat,-J,J),Z=ie(U.lat,-J,J),ee=j(a.center.lng),le=D(q);let oe=ee-j(U.lng);const fe=le-D(Z);oe>.5?oe-=1:oe<-.5&&(oe+=1);let _e=0;Math.abs(oe)>Math.abs(fe)?_e=oe>=0?1:3:(_e=fe>=0?0:2,oi(F,F,[g[4]*u,g[5]*u,g[6]*u],-Math.sin(ui(fe>=0?_.getSouth():_.getNorth()))*eo));const be=w[_e],Oe=w[(_e+1)%4],Ie=new Dc(be,Oe,F),Ue=[Lc(Ie,0)||be[0],Lc(Ie,1)||be[1],Lc(Ie,2)||be[2]],Ge=Md(a.zoom);if(Ge>0){const et=(function({x:nt,y:bt,z:Mt},Pt,Ht,qt,Ut){const $t=1/(1<<Mt);let xt=nt*$t,vt=xt+$t,Vt=bt*$t,ai=Vt+$t,Yt=0;const Di=(xt+vt)/2-qt;return Di>.5?Yt=-1:Di<-.5&&(Yt=1),xt=((xt+Yt)*Pt-(qt*=Pt))*Ht+qt,vt=((vt+Yt)*Pt-qt)*Ht+qt,Vt=(Vt*Pt-(Ut*=Pt))*Ht+Ut,ai=(ai*Pt-Ut)*Ht+Ut,[[xt,ai,0],[vt,ai,0],[vt,Vt,0],[xt,Vt,0]]})(n,e,a._pixelsPerMercatorPixel,ee,le);for(let nt=0;nt<w.length;nt++)ho(w[nt],et[nt],Ge);const yt=jt([],et[_e],et[(_e+1)%4]);Ct(yt,yt,.5),ho(Ue,yt,Ge)}for(const et of w)_t(O,O,et),At(z,z,et);return O[2]=Math.min(be[2],Oe[2]),_t(O,O,Ue),At(z,z,Ue),new wi(O,z)}function dg({x:a,y:e,z:n},l=!1){const u=1/(1<<n),g=new s(V(a*u),e===(1<<n)-1&&l?-90:Y((e+1)*u)),_=new s(V((a+1)*u),e===0&&l?90:Y(e*u));return new m(g,_)}function c_(a,e=eo){const n=ui(a.getNorth()),l=ui(a.getSouth()),u=Math.cos(n),g=Math.cos(l),_=Math.sin(n),w=Math.sin(l),A=a.getWest(),z=a.getEast();return[Ad(g,w,A,e),Ad(g,w,z,e),Ad(u,_,z,e),Ad(u,_,A,e)]}function lp(a,e,n,l){const u=1<<n.z,g=(a/Xt+n.x)/u;return Wl(Y((e/Xt+n.y)/u),V(g),l)}function hg({min:a,max:e}){return ug/Math.max(e[0]-a[0],e[1]-a[1],e[2]-a[2])}const xx=new Float64Array(16);function cp(a){const e=hg(a),n=Ke(xx,[e,e,e]);return Ee(n,n,Un([],a.min))}function u_(a){const e=(l=a.min,(n=xx)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=l[0],n[13]=l[1],n[14]=l[2],n[15]=1,n);var n,l;const u=1/hg(a);return Qe(e,e,[u,u,u])}function d_(a){const e=Xt/(2*Math.PI);return a/(2*Math.PI)/e}function bx(a,e){return Xt/(512*Math.pow(2,a))*hg(Co(e))}function h_(a,e,n,l,u){const g=d_(n),_=[a,e,-n/(2*Math.PI)],w=ce(new Float64Array(16));return Ee(w,w,_),Qe(w,w,[g,g,g]),He(w,w,ui(-u)),ke(w,w,ui(-l)),w}function Md(a){return ue(Hl,sp,a)}function wx(a,e){const n=Wl(e.lat,e.lng),l=(function(Z){const ee=Wl(Z._center.lat,Z._center.lng);let le=Ja([],We(0,1,0),ee);const oe=lt([],-Z.angle,ee);le=Fi(le,le,oe),lt(oe,-Z._pitch,le);const fe=qn([],ee);return Ct(fe,fe,Xl(Z.cameraToCenterDistance/Z.pixelsPerMeter)),Fi(fe,fe,oe),jt([],ee,fe)})(a);return _=(u=Gi([],l,n))[0],w=u[1],A=u[2],z=(g=n)[0],O=g[1],F=g[2],q=(U=Math.sqrt((_*_+w*w+A*A)*(z*z+O*O+F*F)))&&On(u,g)/U,Math.acos(Math.min(Math.max(q,-1),1));var u,g,_,w,A,z,O,F,U,q}function ky(a,e){return wx(a,e)>Math.PI/2*1.01}const up=ui(85),Db=Math.cos(up),Sx=Math.sin(up),rr=re(),f_=a=>{const e=[];return a.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function fg(a,e,n,l,u,g,_,w,A){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(A*=a.pixelToTileUnitsFactor);const z=a.tileID.canonical,O=n.projection.upVectorScale(z,n.center.lat,n.worldSize).metersToTile;for(const F of e)for(const U of F){const q=U.add(w),Z=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(q.x,q.y,!0):0,ee=n.projection.projectTilePoint(q.x,q.y,z);if(Z>0){const _e=n.projection.upVector(z,q.x,q.y);ee.x+=_e[0]*O*Z,ee.y+=_e[1]*O*Z,ee.z+=_e[2]*O*Z}const le=g?q:Ey(ee.x,ee.y,ee.z,l),oe=g?a.tilespaceRays.map((_e=>mg(_e,Z))):a.queryGeometry.screenGeometry,fe=Vr([],[ee.x,ee.y,ee.z,1],l);if(!_&&g?A*=fe[3]/n.cameraToCenterDistance:_&&!g&&(A*=n.cameraToCenterDistance/fe[3]),g){const _e=Y((U.y/Xt+z.y)/(1<<z.z));A/=n.projection.pixelsPerMeter(_e,1)/B(1,_e)}if(mn(oe,le,A))return!0}return!1}function Ey(a,e,n,l){const u=Vr([],[a,e,n,1],l);return new Pe(u[0]/u[3],u[1]/u[3])}const Ay=We(0,0,0),Cy=We(0,0,1);function mg(a,e){const n=Ft();return Ay[2]=e,a.intersectsPlane(Ay,Cy,n),new Pe(n[0],n[1])}class pg extends ya{}let lm,My,Tx,kx;function Py(a,{width:e,height:n},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*l);return a.width=e,a.height=n,a.data=u,a}function jy(a,e,n){const{width:l,height:u}=e;l===a.width&&u===a.height||(dp(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,l),height:Math.min(a.height,u)},n,null),a.width=l,a.height=u,a.data=e.data)}function dp(a,e,n,l,u,g,_,w){if(u.width===0||u.height===0)return e;if(u.width>a.width||u.height>a.height||n.x>a.width-u.width||n.y>a.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const A=a.data,z=e.data,O=g===4&&w;for(let F=0;F<u.height;F++){const U=((n.y+F)*a.width+n.x)*g,q=((l.y+F)*e.width+l.x)*g;if(O)for(let Z=0;Z<u.width;Z++){const ee=U+Z*g+3,le=q+Z*g;z[le+0]=255,z[le+1]=255,z[le+2]=255,z[le+3]=A[ee]}else if(_)for(let Z=0;Z<u.width;Z++){const ee=U+Z*g,le=q+Z*g,oe=new ha(A[ee+0]/255,A[ee+1]/255,A[ee+2]/255,A[ee+3]).toNonPremultipliedRenderColor(_).toArray();z[le+0]=oe[0],z[le+1]=oe[1],z[le+2]=oe[2],z[le+3]=oe[3]}else for(let Z=0;Z<u.width*g;Z++)z[q+Z]=A[U+Z]}return e}yi(pg,"HeatmapBucket",{omit:["layers"]});class hr{constructor(e,n){Py(this,e,1,n)}resize(e){jy(this,new hr(e),1)}clone(){return new hr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,u,g){dp(e,n,l,u,g,1,null)}}class Fs{constructor(e,n){Py(this,e,4,n)}resize(e){jy(this,new Fs(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,u,g,_,w){dp(e,n,l,u,g,4,_,w)}}class Vo{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function gg(a){const e={},n=a.resolution||256,l=a.clips?a.clips.length:1,u=a.image||new Fs({width:n,height:l}),g=(_,w,A)=>{e[a.evaluationKey]=A;const z=a.expression.evaluate(e),O=z?z.toNonPremultipliedRenderColor(null):null;O&&(u.data[_+w+0]=Math.floor(255*O.r),u.data[_+w+1]=Math.floor(255*O.g),u.data[_+w+2]=Math.floor(255*O.b),u.data[_+w+3]=Math.floor(255*O.a))};if(a.clips)for(let _=0,w=0;_<l;++_,w+=4*n)for(let A=0,z=0;A<n;A++,z+=4){const O=A/(n-1),{start:F,end:U}=a.clips[_];g(w,z,F*(1-O)+U*O)}else for(let _=0,w=0;_<n;_++,w+=4)g(0,w,_/(n-1));return u}yi(hr,"AlphaImage"),yi(Fs,"RGBAImage");const zy=Mn([{name:"a_pos",components:2,type:"Int16"}],4),Iy=Mn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),m_=Mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Ex=Mn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function cm(a,e,n=2){const l=e&&e.length,u=l?e[0]*n:a.length;let g=p_(a,0,u,n,!0);const _=[];if(!g||g.next===g.prev)return _;let w,A,z;if(l&&(g=(function(O,F,U,q){const Z=[];for(let ee=0,le=F.length;ee<le;ee++){const oe=p_(O,F[ee]*q,ee<le-1?F[ee+1]*q:O.length,q,!1);oe===oe.next&&(oe.steiner=!0),Z.push(Fb(oe))}Z.sort(Nb);for(let ee=0;ee<Z.length;ee++)U=af(Z[ee],U);return U})(a,e,g,n)),a.length>80*n){w=a[0],A=a[1];let O=w,F=A;for(let U=n;U<u;U+=n){const q=a[U],Z=a[U+1];q<w&&(w=q),Z<A&&(A=Z),q>O&&(O=q),Z>F&&(F=Z)}z=Math.max(O-w,F-A),z=z!==0?32767/z:0}return _g(g,_,n,w,A,z,0),_}function p_(a,e,n,l,u){let g;if(u===(function(_,w,A,z){let O=0;for(let F=w,U=A-z;F<A;F+=z)O+=(_[U]-_[F])*(_[F+1]+_[U+1]),U=F;return O})(a,e,n,l)>0)for(let _=e;_<n;_+=l)g=xg(_/l|0,a[_],a[_+1],g);else for(let _=n-l;_>=e;_-=l)g=xg(_/l|0,a[_],a[_+1],g);return g&&rf(g,g.next)&&(Oc(g),g=g.next),g}function oh(a,e){if(!a)return a;e||(e=a);let n,l=a;do if(n=!1,l.steiner||!rf(l,l.next)&&br(l.prev,l,l.next)!==0)l=l.next;else{if(Oc(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function _g(a,e,n,l,u,g,_){if(!a)return;!_&&g&&(function(A,z,O,F){let U=A;do U.z===0&&(U.z=yg(U.x,U.y,z,O,F)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==A);U.prevZ.nextZ=null,U.prevZ=null,(function(q){let Z,ee=1;do{let le,oe=q;q=null;let fe=null;for(Z=0;oe;){Z++;let _e=oe,be=0;for(let Ie=0;Ie<ee&&(be++,_e=_e.nextZ,_e);Ie++);let Oe=ee;for(;be>0||Oe>0&&_e;)be!==0&&(Oe===0||!_e||oe.z<=_e.z)?(le=oe,oe=oe.nextZ,be--):(le=_e,_e=_e.nextZ,Oe--),fe?fe.nextZ=le:q=le,le.prevZ=fe,fe=le;oe=_e}fe.nextZ=null,ee*=2}while(Z>1)})(U)})(a,l,u,g);let w=a;for(;a.prev!==a.next;){const A=a.prev,z=a.next;if(g?Lb(a,l,u,g):Ax(a))e.push(A.i,a.i,z.i),Oc(a),a=z.next,w=z.next;else if((a=z)===w){_?_===1?_g(a=Cx(oh(a),e),e,n,l,u,g,2):_===2&&Ob(a,e,n,l,u,g):_g(oh(a),e,n,l,u,g,1);break}}}function Ax(a){const e=a.prev,n=a,l=a.next;if(br(e,n,l)>=0)return!1;const u=e.x,g=n.x,_=l.x,w=e.y,A=n.y,z=l.y,O=Math.min(u,g,_),F=Math.min(w,A,z),U=Math.max(u,g,_),q=Math.max(w,A,z);let Z=l.next;for(;Z!==e;){if(Z.x>=O&&Z.x<=U&&Z.y>=F&&Z.y<=q&&um(u,w,g,A,_,z,Z.x,Z.y)&&br(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function Lb(a,e,n,l){const u=a.prev,g=a,_=a.next;if(br(u,g,_)>=0)return!1;const w=u.x,A=g.x,z=_.x,O=u.y,F=g.y,U=_.y,q=Math.min(w,A,z),Z=Math.min(O,F,U),ee=Math.max(w,A,z),le=Math.max(O,F,U),oe=yg(q,Z,e,n,l),fe=yg(ee,le,e,n,l);let _e=a.prevZ,be=a.nextZ;for(;_e&&_e.z>=oe&&be&&be.z<=fe;){if(_e.x>=q&&_e.x<=ee&&_e.y>=Z&&_e.y<=le&&_e!==u&&_e!==_&&um(w,O,A,F,z,U,_e.x,_e.y)&&br(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,be.x>=q&&be.x<=ee&&be.y>=Z&&be.y<=le&&be!==u&&be!==_&&um(w,O,A,F,z,U,be.x,be.y)&&br(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;_e&&_e.z>=oe;){if(_e.x>=q&&_e.x<=ee&&_e.y>=Z&&_e.y<=le&&_e!==u&&_e!==_&&um(w,O,A,F,z,U,_e.x,_e.y)&&br(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;be&&be.z<=fe;){if(be.x>=q&&be.x<=ee&&be.y>=Z&&be.y<=le&&be!==u&&be!==_&&um(w,O,A,F,z,U,be.x,be.y)&&br(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function Cx(a,e){let n=a;do{const l=n.prev,u=n.next.next;!rf(l,u)&&Ry(l,n,n.next,u)&&Ml(l,u)&&Ml(u,l)&&(e.push(l.i,n.i,u.i),Oc(n),Oc(n.next),n=a=u),n=n.next}while(n!==a);return oh(n)}function Ob(a,e,n,l,u,g){let _=a;do{let w=_.next.next;for(;w!==_.prev;){if(_.i!==w.i&&Bb(_,w)){let A=Dy(_,w);return _=oh(_,_.next),A=oh(A,A.next),_g(_,e,n,l,u,g,0),void _g(A,e,n,l,u,g,0)}w=w.next}_=_.next}while(_!==a)}function Nb(a,e){let n=a.x-e.x;return n===0&&(n=a.y-e.y,n===0)&&(n=(a.next.y-a.y)/(a.next.x-a.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function af(a,e){const n=(function(u,g){let _=g;const w=u.x,A=u.y;let z,O=-1/0;if(rf(u,_))return _;do{if(rf(u,_.next))return _.next;if(A<=_.y&&A>=_.next.y&&_.next.y!==_.y){const ee=_.x+(A-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(ee<=w&&ee>O&&(O=ee,z=_.x<_.next.x?_:_.next,ee===w))return z}_=_.next}while(_!==g);if(!z)return null;const F=z,U=z.x,q=z.y;let Z=1/0;_=z;do{if(w>=_.x&&_.x>=U&&w!==_.x&&Px(A<q?w:O,A,U,q,A<q?O:w,A,_.x,_.y)){const ee=Math.abs(A-_.y)/(w-_.x);Ml(_,u)&&(ee<Z||ee===Z&&(_.x>z.x||_.x===z.x&&Mx(z,_)))&&(z=_,Z=ee)}_=_.next}while(_!==F);return z})(a,e);if(!n)return e;const l=Dy(n,a);return oh(l,l.next),oh(n,n.next)}function Mx(a,e){return br(a.prev,a,e.prev)<0&&br(e.next,a,a.next)<0}function yg(a,e,n,l,u){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-n)*u|0)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Fb(a){let e=a,n=a;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==a);return n}function Px(a,e,n,l,u,g,_,w){return(u-_)*(e-w)>=(a-_)*(g-w)&&(a-_)*(l-w)>=(n-_)*(e-w)&&(n-_)*(g-w)>=(u-_)*(l-w)}function um(a,e,n,l,u,g,_,w){return!(a===_&&e===w)&&Px(a,e,n,l,u,g,_,w)}function Bb(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!(function(n,l){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==l.i&&u.next.i!==l.i&&Ry(u,u.next,n,l))return!0;u=u.next}while(u!==n);return!1})(a,e)&&(Ml(a,e)&&Ml(e,a)&&(function(n,l){let u=n,g=!1;const _=(n.x+l.x)/2,w=(n.y+l.y)/2;do u.y>w!=u.next.y>w&&u.next.y!==u.y&&_<(u.next.x-u.x)*(w-u.y)/(u.next.y-u.y)+u.x&&(g=!g),u=u.next;while(u!==n);return g})(a,e)&&(br(a.prev,a,e.prev)||br(a,e.prev,e))||rf(a,e)&&br(a.prev,a,a.next)>0&&br(e.prev,e,e.next)>0)}function br(a,e,n){return(e.y-a.y)*(n.x-e.x)-(e.x-a.x)*(n.y-e.y)}function rf(a,e){return a.x===e.x&&a.y===e.y}function Ry(a,e,n,l){const u=sf(br(a,e,n)),g=sf(br(a,e,l)),_=sf(br(n,l,a)),w=sf(br(n,l,e));return u!==g&&_!==w||!(u!==0||!vg(a,n,e))||!(g!==0||!vg(a,l,e))||!(_!==0||!vg(n,a,l))||!(w!==0||!vg(n,e,l))}function vg(a,e,n){return e.x<=Math.max(a.x,n.x)&&e.x>=Math.min(a.x,n.x)&&e.y<=Math.max(a.y,n.y)&&e.y>=Math.min(a.y,n.y)}function sf(a){return a>0?1:a<0?-1:0}function Ml(a,e){return br(a.prev,a,a.next)<0?br(a,e,a.next)>=0&&br(a,a.prev,e)>=0:br(a,e,a.prev)<0||br(a,a.next,e)<0}function Dy(a,e){const n=Ly(a.i,a.x,a.y),l=Ly(e.i,e.x,e.y),u=a.next,g=e.prev;return a.next=e,e.prev=a,n.next=u,u.prev=n,l.next=n,n.prev=l,g.next=l,l.prev=g,l}function xg(a,e,n,l){const u=Ly(a,e,n);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function Oc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Ly(a,e,n){return{i:a,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function bg(a,e){const n=a.length;if(n<=1)return[a];const l=[];let u,g;for(let _=0;_<n;_++){const w=rn(a[_]);w!==0&&(a[_].area=Math.abs(w),g===void 0&&(g=w<0),g===w<0?(u&&l.push(u),u=[a[_]]):u.push(a[_]))}if(u&&l.push(u),e>1)for(let _=0;_<l.length;_++)l[_].length<=e||(nd(l[_],e,1,l[_].length-1,hp),l[_]=l[_].slice(0,e));return l}function hp(a,e){return e.area-a.area}function Oy(a,e,n=1){if(!a)return null;const l=typeof a=="string"?ro.from(a).getPrimary():a.getPrimary(),u=typeof a=="string"?null:a.getSecondary();for(const g of[l,u]){if(!g)continue;const _=g.id.toString();e.has(_)||e.set(_,[]),g.scaleSelf(n),e.get(_).push(g)}return{primary:l.toString(),secondary:u?u.toString():null}}function Ny(a,e,n,l){const u=l.patternDependencies;let g=!1;for(const _ of e){const w=_.paint.get(`${a}-pattern`);w.isConstant()||(g=!0),Oy(w.constantOr(null),u,n)&&(g=!0)}return g}function Fy(a,e,n,l,u,g){const _=g.patternDependencies;for(const w of e){const A=w.paint.get(`${a}-pattern`).value;if(A.kind!=="constant"){let z=A.evaluate({zoom:l},n,{},g.availableImages);z=z&&z.name?z.name:z;const O=Oy(z,_,u);if(!O)continue;const{primary:F,secondary:U}=O;F&&(n.patterns[w.id]=[F,U].filter(Boolean))}}return n}class jx{constructor(){this.polygons=new Map}add(e,...n){const l=this.polygons.get(e);l?l.push(...n):this.polygons.set(e,n)}merge(e){for(const[n,l]of e.polygons)this.add(n,...l)}}class lh{constructor(){this.portals=[]}static isOnBorder(e,n){return e<=0&&n<=0||e>=Xt&&n>=Xt}static evaluate(e){if(e.length===0)return new lh;let n=[];for(const A of e)n.push(...A.portals);if(n.length===0)return new lh;for(const A of n){const z=A.va,O=A.vb;(lh.isOnBorder(z.x,O.x)||lh.isOnBorder(z.y,O.y))&&(A.type="border")}const l=n.filter((A=>A.type!=="unevaluated")),u=n.filter((A=>A.type==="unevaluated"));if(u.length===0)return new lh;u.sort(((A,z)=>A.hash===z.hash?A.isTunnel===z.isTunnel?0:A.isTunnel?-1:1:A.hash<z.hash?1:-1)),n=l.concat(u);let g=l.length,_=g,w=g;do if(_++,_===n.length||n[g].hash!==n[_].hash){if(_-g==2){w<g&&(n[w]=n[g],n[g]=null);const A=n[w],z=n[_-1];A.type=A.isTunnel!==z.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:z.connection.a},w++}g=_}while(g!==n.length);return n.splice(w),n.sort(((A,z)=>A.hash<z.hash?1:-1)),{portals:n}}}yi(lh,"ElevationPortalGraph"),yi(jx,"ElevationPolygons");class Ub{constructor(e,n,l){this.outPositions=e,this.outNormals=n,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,n,l){let u=e[2];l!=null&&(u*=l);const g=`${e[0]},${e[1]},${e[2]},${n[0]},${n[1]},${n[2]}`,_=this.vertexLookup.get(g);if(_!=null)return _;const w=this.outPositions.length;this.vertexLookup.set(g,w);const A=Math.trunc(16384*n[0]),z=Math.trunc(16384*n[1]),O=Math.trunc(16384*n[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(A,z,O),w}addTriangle(e,n,l){this.outIndices.emplaceBack(e,n,l)}addTriangles(e,n,l){if(e.length===0)return;const u=l.length===1,g=Ft(),_=Ft();for(let w=0;w<e.length;w+=3){const A=n[e[w+0]],z=n[e[w+1]],O=n[e[w+2]],F=u?l[0]:l[e[w+1]],U=u?l[0]:l[e[w+2]];Et(g,A.x,A.y,u?l[0]:l[e[w+0]]);const q=this.addVertex(g,_);Et(g,z.x,z.y,F);const Z=this.addVertex(g,_);Et(g,O.x,O.y,U);const ee=this.addVertex(g,_);this.outIndices.emplaceBack(q,Z,ee)}}addQuad(e,n,l,u,g,_){const w=this.addVertex(e,g,_),A=this.addVertex(n,g,_),z=this.addVertex(l,g,_),O=this.addVertex(u,g,_);this.addTriangle(w,A,z),this.addTriangle(z,O,w)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Yl{constructor(e,n,l,u){this.unevaluatedPortals=new lh,this.portalPolygons=new jx,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Zm,this.vertexNormals=new wl,this.indexArray=new Wr,this.tileToMeters=de(e),this.bridgeProgramConfigurations=new zc(n,{zoom:l,lut:u},(g=>g!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new zc(n,{zoom:l,lut:u},(g=>g!=="fill-bridge-guard-rail-color"))}addVertices(e,n){const l=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(n[u]);return l}addTriangles(e,n,l){const u=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of e)u.push(g+n)}addRenderableRing(e,n,l,u,g,_){const w=[new Pe(g.min.x,g.min.y),new Pe(g.max.x,g.min.y),new Pe(g.max.x,g.max.y),new Pe(g.min.x,g.max.y)];for(let A=0;A<l-1;A++){const z=n+A,O=z+1,F=this.unevalVertices[z],U=this.unevalVertices[O];if(!(F.x>=g.min.x&&F.x<=g.max.x&&F.y>=g.min.y&&F.y<=g.max.y||U.x>=g.min.x&&U.x<=g.max.x&&U.y>=g.min.y&&U.y<=g.max.y||Ns(F,U,w))||this.isOnBorder(F.x,U.x)||this.isOnBorder(F.y,U.y))continue;const q=Yl.computeEdgeHash(this.unevalVertices[z],this.unevalVertices[O]);let Z,ee=this.vertexHashLookup.get(Yl.computePosHash(F));ee!=null?Z=ee.next:(ee=this.vertexHashLookup.get(Yl.computePosHash(U)),Z=ee!=null?ee.prev:q),this.unevalEdges.push({polygonIdx:e,a:z,b:O,hash:q,portalHash:Z,isTunnel:u,type:"unevaluated",featureInfo:_})}}addPortalCandidates(e,n,l,u,g){if(n.length===0)return;this.portalPolygons.add(e,{geometry:n,zLevel:g});const _=n[0];this.vertexHashLookup.clear();let w=Yl.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let A=0;A<_.length-1;A++){const z=_[A+0],O=_[A+1],F=zr(O.x-z.x,O.y-z.y),U=Gs(F);if(U===0)continue;let q="unevaluated";const Z=u.pointElevation(z),ee=u.pointElevation(O);Math.abs(Z)<.01&&Math.abs(ee)<.01?q="entrance":(this.isOnBorder(z.x,O.x)||this.isOnBorder(z.y,O.y))&&(q="border");const le=Yl.computeEdgeHash(z,O);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:z,vb:O,vab:F,length:U,hash:le,isTunnel:l,type:q});const oe=Yl.computePosHash(z);this.vertexHashLookup.set(oe,{prev:w,next:le}),w=le}}construct(e){if(this.unevalVertices.length===0)return;const n=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=U=>{U.primitiveLength=this.indexArray.length-U.primitiveOffset},u=new Ub(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const g=n(),_=n(),w=n(),A=(U,q)=>{U.sort(((ee,le)=>ee.type===q&&le.type!==q?-1:ee.type!==q&&le.type===q?1:0));const Z=U.findIndex((ee=>ee.type!==q));return Z>=0?Z:U.length};let z=0;this.unevalEdges.length>0&&(z=A(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:z},this.tileToMeters)),l(w);const O=n(),F=n();if(this.unevalEdges.length>0){const U=this.unevalEdges.splice(z),q=A(U,"tunnel")+z;this.unevalEdges.push(...U),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:z},{min:z,max:q})}l(O),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(F),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(_),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(g),this.maskSegments=tr.simpleSegment(0,F.primitiveOffset,0,F.primitiveLength),this.depthSegments=tr.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=tr.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableTunnelSegments=tr.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.shadowCasterSegments=tr.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(e,n,l,u,g,_,w,A){this.bridgeProgramConfigurations.updatePaintArrays(e,n,g,l,u,_,w,A),this.tunnelProgramConfigurations.updatePaintArrays(e,n,g,l,u,_,w,A)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,m_.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Ex.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,n,l,u,g){const _=(w,A)=>{for(let z=0;z<A.length-1;z++){const O=A[z].featureIndex,F=A[z+1].vertexStart,U=e.feature(O);w.populatePaintArrays(F,U,O,{},l,n,u,void 0,g)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,n,l,u,g){const _=new Map;for(let w=u;w<g;w++){const A=l[w],z=A.a,O=A.b,F=Yl.computePosHash(e[z]),U=Yl.computePosHash(e[O]);let q=_.get(F);q||(q={},_.set(F,q));let Z=_.get(U);Z||(Z={},_.set(U,Z)),n[z]<=0&&n[O]<=0||(q.to=O,Z.from=z)}return _}isTerminalVertex(e,n){const l=Yl.computePosHash(this.unevalVertices[e]),u=n.get(l);return!u||!u.from||!u.to}constructBridgeStructures(e,n,l,u,g,_){e.clearVertexLookup();const w=this.computeVertexConnections(n,l,u,g.min,g.max),A=1/_,z=.5*A,O=(Ht,qt)=>Et(Ht,n[qt].x,n[qt].y,l[qt]*A),F=Ft(),U=Ft(),q=Ft(),Z=Ft(),ee=Ft(),le=(Ht,qt)=>{const Ut=w.get(Yl.computePosHash(n[qt])),$t=Ut.from,xt=Ut.to;if(!$t||!xt)return;O(F,$t),O(U,qt),O(q,xt),ln(Z),xn(F,U)||(za(ee,U,F),qn(Z,ee)),xn(q,U)||(za(ee,q,U),jt(Z,Z,qn(ee,ee)));const vt=Zo(Z);return vt>0?Ct(Ht,Z,1/vt):void 0};let oe=Number.POSITIVE_INFINITY;this.sortSubarray(u,g.min,g.max,((Ht,qt)=>Ht.featureInfo.featureIndex-qt.featureInfo.featureIndex));const fe=Ft(),_e=Ft(),be=Ft(),Oe=Ft(),Ie=Ft(),Ue=Ft(),Ge=Ft(),et=Ft(),yt=Ft(),nt=[Ft(),Ft(),Ft(),Ft()],bt=[Ft(),Ft(),Ft(),Ft()],Mt=[{coord:new Pe(0,0),height:0},{coord:new Pe(0,0),height:0}],Pt=(Ht,qt)=>Ht>qt;for(let Ht=g.min;Ht<g.max;Ht++){const qt=u[Ht];if(!qt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Mt,n,l,qt,Pt))continue;const[Ut,$t]=Mt;if(Et(fe,Ut.coord.x,Ut.coord.y,A*Ut.height),Et(_e,$t.coord.x,$t.coord.y,A*$t.height),xn(fe,_e))continue;za(be,_e,fe),qn(be,be);const xt=le(et,qt.a)||be,vt=le(yt,qt.b)||be;Et(Oe,xt[1],-xt[0],0),qn(Oe,Oe),Et(Ie,vt[1],-vt[0],0),qn(Ie,Ie),Ja(et,Oe,xt),qn(Ue,et),Ja(et,Ie,vt),qn(Ge,et),jt(nt[0],fe,Ct(et,za(et,Oe,Ue),z)),jt(nt[1],fe,Ct(et,jt(et,Oe,Ue),z)),jt(nt[2],fe,Ct(et,Ue,z)),nt[3]=fe,jt(bt[0],_e,Ct(et,za(et,Ie,Ge),z)),jt(bt[1],_e,Ct(et,jt(et,Ie,Ge),z)),jt(bt[2],_e,Ct(et,Ge,z)),bt[3]=_e,oe=this.addFeatureSection(qt.featureInfo.featureIndex,oe,this.bridgeFeatureSections,e);const Vt=e.addVertex(nt[0],Oe,_),ai=e.addVertex(nt[1],Oe,_),Yt=e.addVertex(bt[0],Ie,_),Di=e.addVertex(bt[1],Ie,_);e.addTriangle(Vt,ai,Yt),e.addTriangle(ai,Di,Yt);const pi=e.addVertex(nt[1],Ue,_),xi=e.addVertex(nt[2],Ue,_),Mi=e.addVertex(bt[1],Ge,_),An=e.addVertex(bt[2],Ge,_);e.addTriangle(pi,xi,Mi),e.addTriangle(xi,An,Mi),Un(Oe,Oe),Un(Ie,Ie);const ei=e.addVertex(nt[2],Oe,_),zi=e.addVertex(nt[3],Oe,_),un=e.addVertex(bt[2],Ie,_),Hn=e.addVertex(bt[3],Ie,_);e.addTriangle(ei,zi,un),e.addTriangle(zi,Hn,un);const Xn=this.isTerminalVertex(qt.a,w),yn=this.isTerminalVertex(qt.b,w);Ut.height<.01&&Xn&&e.addQuad(nt[3],nt[2],nt[1],nt[0],Un(xt,xt),_),$t.height<.01&&yn&&e.addQuad(bt[0],bt[1],bt[2],bt[3],vt,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,n,l,u,g,_){e.clearVertexLookup();let w=Number.POSITIVE_INFINITY;const A=(oe,fe)=>oe.featureInfo.featureIndex-fe.featureInfo.featureIndex;this.sortSubarray(u,g.min,g.max,A),this.sortSubarray(u,_.min,_.max,A);const z=oe=>qn(oe,oe),O=[{coord:new Pe(0,0),height:0},{coord:new Pe(0,0),height:0}],F=(oe,fe)=>oe<fe,U=Ft(),q=Ft(),Z=Ft(),ee=Ft(),le=Ft();for(let oe=g.min;oe<g.max;oe++){if(!this.prepareEdgePoints(O,n,l,u[oe],F))continue;const[fe,_e]=O,be=z(Et(le,-(_e.coord.y-fe.coord.y),_e.coord.x-fe.coord.x,0));w=this.addFeatureSection(u[oe].featureInfo.featureIndex,w,this.tunnelFeatureSections,e),e.addQuad(Et(U,fe.coord.x,fe.coord.y,fe.height),Et(q,_e.coord.x,_e.coord.y,_e.height),Et(Z,_e.coord.x,_e.coord.y,u[oe].isTunnel?-.1:0),Et(ee,fe.coord.x,fe.coord.y,u[oe].isTunnel?-.1:0),be)}for(let oe=_.min;oe<_.max;oe++){const fe=u[oe];fe.isTunnel&&([fe.a,fe.b]=[fe.b,fe.a]);const _e=n[fe.a],be=n[fe.b],Oe=z(Et(le,-(be.y-_e.y),be.x-_e.x,0));w=this.addFeatureSection(fe.featureInfo.featureIndex,w,this.tunnelFeatureSections,e),e.addQuad(Et(U,be.x,be.y,0),Et(q,_e.x,_e.y,0),Et(Z,_e.x,_e.y,l[fe.a]+4),Et(ee,be.x,be.y,l[fe.b]+4),Oe),e.addQuad(Et(U,_e.x,_e.y,0),Et(q,be.x,be.y,0),Et(Z,be.x,be.y,l[fe.b]+4),Et(ee,_e.x,_e.y,l[fe.a]+4),Oe)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,n,l,u){e.coord.x=n,e.coord.y=l,e.height=u}prepareEdgePoints(e,n,l,u,g){let _=n[u.a].x,w=n[u.a].y,A=n[u.b].x,z=n[u.b].y,O=l[u.a],F=l[u.b];const U=g(O,0),q=g(F,0);if(U&&q)return this.setElevatedPoint(e[0],_,w,O),this.setElevatedPoint(e[1],A,z,F),!0;if(!U&&!q)return!1;if(U){if(!q){const Z=F/(F-O);A=$i(A,_,Z),z=$i(z,w,Z),F=$i(F,O,Z)}}else{const Z=O/(O-F);_=$i(_,A,Z),w=$i(w,z,Z),O=$i(O,F,Z)}return this.setElevatedPoint(e[0],_,w,O),this.setElevatedPoint(e[1],A,z,F),!0}prepareEdges(e,n){if(n.length===0)return;n.sort(((w,A)=>w.hash===A.hash?A.polygonIdx-w.polygonIdx:A.hash>w.hash?1:-1));let l=0,u=0,g=0,_=n[l].polygonIdx;do u++,(u===n.length||n[l].hash!==n[u].hash)&&((u-l==1||n[u-1].polygonIdx!==_)&&(g<l&&(n[g]=n[l],n[l]=null),n[g].type="none",g++),l=u,l!==n.length&&(_=n[l].polygonIdx));while(l!==n.length);if(n.splice(g),n.length!==0&&e.length!==0){n.sort(((z,O)=>z.portalHash<O.portalHash?1:-1));let w=0,A=0;for(;w!==n.length&&A!==e.length;){const z=n[w],O=e[A];z.portalHash>O.hash?w++:O.hash>z.portalHash?A++:(z.type=O.type,w++)}}}isOnBorder(e,n){return e<=0&&n<=0||e>=Xt&&n>=Xt}addFeatureSection(e,n,l,u){return e!==n&&(n=e,l.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),n}sortSubarray(e,n,l,u){const g=e.slice(n,l);g.sort(u),e.splice(n,g.length,...g)}static computeEdgeHash(e,n){return(e.y===n.y&&e.x>n.x||e.y>n.y)&&([e,n]=[n,e]),BigInt(Yl.computePosHash(e))<<32n|BigInt(Yl.computePosHash(n))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var zx,By={exports:{}},dm=(zx||(zx=1,(function(a){function e(Re,Ne){return Re>Ne?1:Re<Ne?-1:0}var n=function(Re,Ne){Re===void 0&&(Re=e),Ne===void 0&&(Ne=!1),this._compare=Re,this._root=null,this._size=0,this._noDuplicates=!!Ne},l={size:{configurable:!0}};function u(Re,Ne,wt,Gt,hi){var fi=hi-Gt;if(fi>0){var Li=Gt+Math.floor(fi/2),Ni={key:Ne[Li],data:wt[Li],parent:Re};return Ni.left=u(Ni,Ne,wt,Gt,Li),Ni.right=u(Ni,Ne,wt,Li+1,hi),Ni}return null}function g(Re,Ne,wt,Gt,hi){if(!(wt>=Gt)){for(var fi=Re[wt+Gt>>1],Li=wt-1,Ni=Gt+1;;){do Li++;while(hi(Re[Li],fi)<0);do Ni--;while(hi(Re[Ni],fi)>0);if(Li>=Ni)break;var _n=Re[Li];Re[Li]=Re[Ni],Re[Ni]=_n,_n=Ne[Li],Ne[Li]=Ne[Ni],Ne[Ni]=_n}g(Re,Ne,wt,Ni,hi),g(Re,Ne,Ni+1,Gt,hi)}}n.prototype.rotateLeft=function(Re){var Ne=Re.right;Ne&&(Re.right=Ne.left,Ne.left&&(Ne.left.parent=Re),Ne.parent=Re.parent),Re.parent?Re===Re.parent.left?Re.parent.left=Ne:Re.parent.right=Ne:this._root=Ne,Ne&&(Ne.left=Re),Re.parent=Ne},n.prototype.rotateRight=function(Re){var Ne=Re.left;Ne&&(Re.left=Ne.right,Ne.right&&(Ne.right.parent=Re),Ne.parent=Re.parent),Re.parent?Re===Re.parent.left?Re.parent.left=Ne:Re.parent.right=Ne:this._root=Ne,Ne&&(Ne.right=Re),Re.parent=Ne},n.prototype._splay=function(Re){for(;Re.parent;){var Ne=Re.parent;Ne.parent?Ne.left===Re&&Ne.parent.left===Ne?(this.rotateRight(Ne.parent),this.rotateRight(Ne)):Ne.right===Re&&Ne.parent.right===Ne?(this.rotateLeft(Ne.parent),this.rotateLeft(Ne)):Ne.left===Re&&Ne.parent.right===Ne?(this.rotateRight(Ne),this.rotateLeft(Ne)):(this.rotateLeft(Ne),this.rotateRight(Ne)):Ne.left===Re?this.rotateRight(Ne):this.rotateLeft(Ne)}},n.prototype.splay=function(Re){for(var Ne,wt,Gt,hi,fi;Re.parent;)(wt=(Ne=Re.parent).parent)&&wt.parent?((Gt=wt.parent).left===wt?Gt.left=Re:Gt.right=Re,Re.parent=Gt):(Re.parent=null,this._root=Re),hi=Re.left,fi=Re.right,Re===Ne.left?(wt&&(wt.left===Ne?(Ne.right?(wt.left=Ne.right,wt.left.parent=wt):wt.left=null,Ne.right=wt,wt.parent=Ne):(hi?(wt.right=hi,hi.parent=wt):wt.right=null,Re.left=wt,wt.parent=Re)),fi?(Ne.left=fi,fi.parent=Ne):Ne.left=null,Re.right=Ne,Ne.parent=Re):(wt&&(wt.right===Ne?(Ne.left?(wt.right=Ne.left,wt.right.parent=wt):wt.right=null,Ne.left=wt,wt.parent=Ne):(fi?(wt.left=fi,fi.parent=wt):wt.left=null,Re.right=wt,wt.parent=Re)),hi?(Ne.right=hi,hi.parent=Ne):Ne.right=null,Re.left=Ne,Ne.parent=Re)},n.prototype.replace=function(Re,Ne){Re.parent?Re===Re.parent.left?Re.parent.left=Ne:Re.parent.right=Ne:this._root=Ne,Ne&&(Ne.parent=Re.parent)},n.prototype.minNode=function(Re){if(Re===void 0&&(Re=this._root),Re)for(;Re.left;)Re=Re.left;return Re},n.prototype.maxNode=function(Re){if(Re===void 0&&(Re=this._root),Re)for(;Re.right;)Re=Re.right;return Re},n.prototype.insert=function(Re,Ne){var wt=this._root,Gt=null,hi=this._compare;if(this._noDuplicates)for(;wt;){if(Gt=wt,hi(wt.key,Re)===0)return;wt=hi(wt.key,Re)<0?wt.right:wt.left}else for(;wt;)Gt=wt,wt=hi(wt.key,Re)<0?wt.right:wt.left;return wt={key:Re,data:Ne,left:null,right:null,parent:Gt},Gt?hi(Gt.key,wt.key)<0?Gt.right=wt:Gt.left=wt:this._root=wt,this.splay(wt),this._size++,wt},n.prototype.find=function(Re){for(var Ne=this._root,wt=this._compare;Ne;){var Gt=wt(Ne.key,Re);if(Gt<0)Ne=Ne.right;else{if(!(Gt>0))return Ne;Ne=Ne.left}}return null},n.prototype.contains=function(Re){for(var Ne=this._root,wt=this._compare;Ne;){var Gt=wt(Re,Ne.key);if(Gt===0)return!0;Ne=Gt<0?Ne.left:Ne.right}return!1},n.prototype.remove=function(Re){var Ne=this.find(Re);if(!Ne)return!1;if(this.splay(Ne),Ne.left)if(Ne.right){var wt=this.minNode(Ne.right);wt.parent!==Ne&&(this.replace(wt,wt.right),wt.right=Ne.right,wt.right.parent=wt),this.replace(Ne,wt),wt.left=Ne.left,wt.left.parent=wt}else this.replace(Ne,Ne.left);else this.replace(Ne,Ne.right);return this._size--,!0},n.prototype.removeNode=function(Re){if(!Re)return!1;if(this.splay(Re),Re.left)if(Re.right){var Ne=this.minNode(Re.right);Ne.parent!==Re&&(this.replace(Ne,Ne.right),Ne.right=Re.right,Ne.right.parent=Ne),this.replace(Re,Ne),Ne.left=Re.left,Ne.left.parent=Ne}else this.replace(Re,Re.left);else this.replace(Re,Re.right);return this._size--,!0},n.prototype.erase=function(Re){var Ne=this.find(Re);if(Ne){this.splay(Ne);var wt=Ne.left,Gt=Ne.right,hi=null;wt&&(wt.parent=null,hi=this.maxNode(wt),this.splay(hi),this._root=hi),Gt&&(wt?hi.right=Gt:this._root=Gt,Gt.parent=hi),this._size--}},n.prototype.pop=function(){var Re=this._root,Ne=null;if(Re){for(;Re.left;)Re=Re.left;Ne={key:Re.key,data:Re.data},this.remove(Re.key)}return Ne},n.prototype.next=function(Re){var Ne=Re;if(Ne)if(Ne.right)for(Ne=Ne.right;Ne&&Ne.left;)Ne=Ne.left;else for(Ne=Re.parent;Ne&&Ne.right===Re;)Re=Ne,Ne=Ne.parent;return Ne},n.prototype.prev=function(Re){var Ne=Re;if(Ne)if(Ne.left)for(Ne=Ne.left;Ne&&Ne.right;)Ne=Ne.right;else for(Ne=Re.parent;Ne&&Ne.left===Re;)Re=Ne,Ne=Ne.parent;return Ne},n.prototype.forEach=function(Re){for(var Ne=this._root,wt=[],Gt=!1,hi=0;!Gt;)Ne?(wt.push(Ne),Ne=Ne.left):wt.length>0?(Re(Ne=wt.pop(),hi++),Ne=Ne.right):Gt=!0;return this},n.prototype.range=function(Re,Ne,wt,Gt){for(var hi=[],fi=this._compare,Li=this._root;hi.length!==0||Li;)if(Li)hi.push(Li),Li=Li.left;else{if(fi((Li=hi.pop()).key,Ne)>0)break;if(fi(Li.key,Re)>=0&&wt.call(Gt,Li))return this;Li=Li.right}return this},n.prototype.keys=function(){for(var Re=this._root,Ne=[],wt=[],Gt=!1;!Gt;)Re?(Ne.push(Re),Re=Re.left):Ne.length>0?(Re=Ne.pop(),wt.push(Re.key),Re=Re.right):Gt=!0;return wt},n.prototype.values=function(){for(var Re=this._root,Ne=[],wt=[],Gt=!1;!Gt;)Re?(Ne.push(Re),Re=Re.left):Ne.length>0?(Re=Ne.pop(),wt.push(Re.data),Re=Re.right):Gt=!0;return wt},n.prototype.at=function(Re){for(var Ne=this._root,wt=[],Gt=!1,hi=0;!Gt;)if(Ne)wt.push(Ne),Ne=Ne.left;else if(wt.length>0){if(Ne=wt.pop(),hi===Re)return Ne;hi++,Ne=Ne.right}else Gt=!0;return null},n.prototype.load=function(Re,Ne,wt){if(Re===void 0&&(Re=[]),Ne===void 0&&(Ne=[]),wt===void 0&&(wt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Gt=Re.length;return wt&&g(Re,Ne,0,Gt-1,this._compare),this._root=u(null,Re,Ne,0,Gt),this._size=Gt,this},n.prototype.min=function(){var Re=this.minNode(this._root);return Re?Re.key:null},n.prototype.max=function(){var Re=this.maxNode(this._root);return Re?Re.key:null},n.prototype.isEmpty=function(){return this._root===null},l.size.get=function(){return this._size},n.createTree=function(Re,Ne,wt,Gt,hi){return new n(wt,hi).load(Re,Ne,Gt)},Object.defineProperties(n.prototype,l);var _=0,w=1,A=2,z=3,O=0,F=1,U=2,q=3;function Z(Re,Ne,wt){Ne===null?(Re.inOut=!1,Re.otherInOut=!0):(Re.isSubject===Ne.isSubject?(Re.inOut=!Ne.inOut,Re.otherInOut=Ne.otherInOut):(Re.inOut=!Ne.otherInOut,Re.otherInOut=Ne.isVertical()?!Ne.inOut:Ne.inOut),Ne&&(Re.prevInResult=!ee(Ne,wt)||Ne.isVertical()?Ne.prevInResult:Ne));var Gt=ee(Re,wt);Re.resultTransition=Gt?(function(hi,fi){var Li,Ni=!hi.inOut,_n=!hi.otherInOut;switch(fi){case O:Li=Ni&&_n;break;case F:Li=Ni||_n;break;case q:Li=Ni^_n;break;case U:Li=hi.isSubject?Ni&&!_n:_n&&!Ni}return Li?1:-1})(Re,wt):0}function ee(Re,Ne){switch(Re.type){case _:switch(Ne){case O:return!Re.otherInOut;case F:return Re.otherInOut;case U:return Re.isSubject&&Re.otherInOut||!Re.isSubject&&!Re.otherInOut;case q:return!0}break;case A:return Ne===O||Ne===F;case z:return Ne===U;case w:return!1}return!1}var le=function(Re,Ne,wt,Gt,hi){this.left=Ne,this.point=Re,this.otherEvent=wt,this.isSubject=Gt,this.type=hi||_,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},oe={inResult:{configurable:!0}};function fe(Re,Ne){return Re[0]===Ne[0]&&Re[1]===Ne[1]}le.prototype.isBelow=function(Re){var Ne=this.point,wt=this.otherEvent.point;return this.left?(Ne[0]-Re[0])*(wt[1]-Re[1])-(wt[0]-Re[0])*(Ne[1]-Re[1])>0:(wt[0]-Re[0])*(Ne[1]-Re[1])-(Ne[0]-Re[0])*(wt[1]-Re[1])>0},le.prototype.isAbove=function(Re){return!this.isBelow(Re)},le.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},oe.inResult.get=function(){return this.resultTransition!==0},le.prototype.clone=function(){var Re=new le(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Re.contourId=this.contourId,Re.resultTransition=this.resultTransition,Re.prevInResult=this.prevInResult,Re.isExteriorRing=this.isExteriorRing,Re.inOut=this.inOut,Re.otherInOut=this.otherInOut,Re},Object.defineProperties(le.prototype,oe);var _e=11102230246251565e-32,be=134217729,Oe=(3+8*_e)*_e;function Ie(Re,Ne,wt,Gt,hi){var fi,Li,Ni,_n,bn=Ne[0],Tn=Gt[0],Fn=0,Ji=0;Tn>bn==Tn>-bn?(fi=bn,bn=Ne[++Fn]):(fi=Tn,Tn=Gt[++Ji]);var on=0;if(Fn<Re&&Ji<wt)for(Tn>bn==Tn>-bn?(Ni=fi-((Li=bn+fi)-bn),bn=Ne[++Fn]):(Ni=fi-((Li=Tn+fi)-Tn),Tn=Gt[++Ji]),fi=Li,Ni!==0&&(hi[on++]=Ni);Fn<Re&&Ji<wt;)Tn>bn==Tn>-bn?(Ni=fi-((Li=fi+bn)-(_n=Li-fi))+(bn-_n),bn=Ne[++Fn]):(Ni=fi-((Li=fi+Tn)-(_n=Li-fi))+(Tn-_n),Tn=Gt[++Ji]),fi=Li,Ni!==0&&(hi[on++]=Ni);for(;Fn<Re;)Ni=fi-((Li=fi+bn)-(_n=Li-fi))+(bn-_n),bn=Ne[++Fn],fi=Li,Ni!==0&&(hi[on++]=Ni);for(;Ji<wt;)Ni=fi-((Li=fi+Tn)-(_n=Li-fi))+(Tn-_n),Tn=Gt[++Ji],fi=Li,Ni!==0&&(hi[on++]=Ni);return fi===0&&on!==0||(hi[on++]=fi),on}function Ue(Re){return new Float64Array(Re)}var Ge=33306690738754716e-32,et=22204460492503146e-32,yt=11093356479670487e-47,nt=Ue(4),bt=Ue(8),Mt=Ue(12),Pt=Ue(16),Ht=Ue(4);function qt(Re,Ne,wt){var Gt=(function(hi,fi,Li,Ni,_n,bn){var Tn=(fi-bn)*(Li-_n),Fn=(hi-_n)*(Ni-bn),Ji=Tn-Fn;if(Tn===0||Fn===0||Tn>0!=Fn>0)return Ji;var on=Math.abs(Tn+Fn);return Math.abs(Ji)>=Ge*on?Ji:-(function(ia,ua,da,ba,Na,ja,fa){var va,wn,Zn,fr,Xi,Bn,Ra,Ua,Ya,Lr,Ha,Yi,_r,wa,cr,_s,Us,ns,as=ia-Na,Cs=da-Na,Kl=ua-ja,Ga=ba-ja;nt[0]=(cr=(Ua=as-(Ra=(Bn=be*as)-(Bn-as)))*(Lr=Ga-(Ya=(Bn=be*Ga)-(Bn-Ga)))-((wa=as*Ga)-Ra*Ya-Ua*Ya-Ra*Lr))-((Ha=cr-(Us=(Ua=Kl-(Ra=(Bn=be*Kl)-(Bn-Kl)))*(Lr=Cs-(Ya=(Bn=be*Cs)-(Bn-Cs)))-((_s=Kl*Cs)-Ra*Ya-Ua*Ya-Ra*Lr)))+(Xi=cr-Ha))+(Xi-Us),nt[1]=(_r=wa-((Yi=wa+Ha)-(Xi=Yi-wa))+(Ha-Xi))-((Ha=_r-_s)+(Xi=_r-Ha))+(Xi-_s),nt[2]=Yi-((ns=Yi+Ha)-(Xi=ns-Yi))+(Ha-Xi),nt[3]=ns;var Pr=(function(ff,Mo){for(var Pl=Mo[0],Bc=1;Bc<4;Bc++)Pl+=Mo[Bc];return Pl})(0,nt),Or=et*fa;if(Pr>=Or||-Pr>=Or||(va=ia-(as+(Xi=ia-as))+(Xi-Na),Zn=da-(Cs+(Xi=da-Cs))+(Xi-Na),wn=ua-(Kl+(Xi=ua-Kl))+(Xi-ja),fr=ba-(Ga+(Xi=ba-Ga))+(Xi-ja),va===0&&wn===0&&Zn===0&&fr===0)||(Or=yt*fa+Oe*Math.abs(Pr),(Pr+=as*fr+Ga*va-(Kl*Zn+Cs*wn))>=Or||-Pr>=Or))return Pr;Ht[0]=(cr=(Ua=va-(Ra=(Bn=be*va)-(Bn-va)))*(Lr=Ga-(Ya=(Bn=be*Ga)-(Bn-Ga)))-((wa=va*Ga)-Ra*Ya-Ua*Ya-Ra*Lr))-((Ha=cr-(Us=(Ua=wn-(Ra=(Bn=be*wn)-(Bn-wn)))*(Lr=Cs-(Ya=(Bn=be*Cs)-(Bn-Cs)))-((_s=wn*Cs)-Ra*Ya-Ua*Ya-Ra*Lr)))+(Xi=cr-Ha))+(Xi-Us),Ht[1]=(_r=wa-((Yi=wa+Ha)-(Xi=Yi-wa))+(Ha-Xi))-((Ha=_r-_s)+(Xi=_r-Ha))+(Xi-_s),Ht[2]=Yi-((ns=Yi+Ha)-(Xi=ns-Yi))+(Ha-Xi),Ht[3]=ns;var cc=Ie(4,nt,4,Ht,bt);Ht[0]=(cr=(Ua=as-(Ra=(Bn=be*as)-(Bn-as)))*(Lr=fr-(Ya=(Bn=be*fr)-(Bn-fr)))-((wa=as*fr)-Ra*Ya-Ua*Ya-Ra*Lr))-((Ha=cr-(Us=(Ua=Kl-(Ra=(Bn=be*Kl)-(Bn-Kl)))*(Lr=Zn-(Ya=(Bn=be*Zn)-(Bn-Zn)))-((_s=Kl*Zn)-Ra*Ya-Ua*Ya-Ra*Lr)))+(Xi=cr-Ha))+(Xi-Us),Ht[1]=(_r=wa-((Yi=wa+Ha)-(Xi=Yi-wa))+(Ha-Xi))-((Ha=_r-_s)+(Xi=_r-Ha))+(Xi-_s),Ht[2]=Yi-((ns=Yi+Ha)-(Xi=ns-Yi))+(Ha-Xi),Ht[3]=ns;var ys=Ie(cc,bt,4,Ht,Mt);Ht[0]=(cr=(Ua=va-(Ra=(Bn=be*va)-(Bn-va)))*(Lr=fr-(Ya=(Bn=be*fr)-(Bn-fr)))-((wa=va*fr)-Ra*Ya-Ua*Ya-Ra*Lr))-((Ha=cr-(Us=(Ua=wn-(Ra=(Bn=be*wn)-(Bn-wn)))*(Lr=Zn-(Ya=(Bn=be*Zn)-(Bn-Zn)))-((_s=wn*Zn)-Ra*Ya-Ua*Ya-Ra*Lr)))+(Xi=cr-Ha))+(Xi-Us),Ht[1]=(_r=wa-((Yi=wa+Ha)-(Xi=Yi-wa))+(Ha-Xi))-((Ha=_r-_s)+(Xi=_r-Ha))+(Xi-_s),Ht[2]=Yi-((ns=Yi+Ha)-(Xi=ns-Yi))+(Ha-Xi),Ht[3]=ns;var zd=Ie(ys,Mt,4,Ht,Pt);return Pt[zd-1]})(hi,fi,Li,Ni,_n,bn,on)})(Re[0],Re[1],Ne[0],Ne[1],wt[0],wt[1]);return Gt>0?-1:Gt<0?1:0}function Ut(Re,Ne){var wt=Re.point,Gt=Ne.point;return wt[0]>Gt[0]?1:wt[0]<Gt[0]?-1:wt[1]!==Gt[1]?wt[1]>Gt[1]?1:-1:(function(hi,fi,Li,Ni){return hi.left!==fi.left?hi.left?1:-1:qt(Li,hi.otherEvent.point,fi.otherEvent.point)!==0?hi.isBelow(fi.otherEvent.point)?-1:1:!hi.isSubject&&fi.isSubject?1:-1})(Re,Ne,wt)}function $t(Re,Ne,wt){var Gt=new le(Ne,!1,Re,Re.isSubject),hi=new le(Ne,!0,Re.otherEvent,Re.isSubject);return fe(Re.point,Re.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Re),Gt.contourId=hi.contourId=Re.contourId,Ut(hi,Re.otherEvent)>0&&(Re.otherEvent.left=!0,hi.left=!1),Re.otherEvent.otherEvent=hi,Re.otherEvent=Gt,wt.push(hi),wt.push(Gt),wt}function xt(Re,Ne){return Re[0]*Ne[1]-Re[1]*Ne[0]}function vt(Re,Ne){return Re[0]*Ne[0]+Re[1]*Ne[1]}function Vt(Re,Ne,wt){var Gt=(function(_n,bn,Tn,Fn,Ji){var on=[bn[0]-_n[0],bn[1]-_n[1]],ia=[Fn[0]-Tn[0],Fn[1]-Tn[1]];function ua(Bn,Ra,Ua){return[Bn[0]+Ra*Ua[0],Bn[1]+Ra*Ua[1]]}var da=[Tn[0]-_n[0],Tn[1]-_n[1]],ba=xt(on,ia),Na=ba*ba,ja=vt(on,on);if(Na>0){var fa=xt(da,ia)/ba;if(fa<0||fa>1)return null;var va=xt(da,on)/ba;return va<0||va>1?null:fa===0||fa===1?[ua(_n,fa,on)]:va===0||va===1?[ua(Tn,va,ia)]:[ua(_n,fa,on)]}if((Na=(ba=xt(da,on))*ba)>0)return null;var wn=vt(on,da)/ja,Zn=wn+vt(on,ia)/ja,fr=Math.min(wn,Zn),Xi=Math.max(wn,Zn);return fr<=1&&Xi>=0?fr===1?[ua(_n,fr>0?fr:0,on)]:Xi===0?[ua(_n,Xi<1?Xi:1,on)]:[ua(_n,fr>0?fr:0,on),ua(_n,Xi<1?Xi:1,on)]:null})(Re.point,Re.otherEvent.point,Ne.point,Ne.otherEvent.point),hi=Gt?Gt.length:0;if(hi===0||hi===1&&(fe(Re.point,Ne.point)||fe(Re.otherEvent.point,Ne.otherEvent.point))||hi===2&&Re.isSubject===Ne.isSubject)return 0;if(hi===1)return fe(Re.point,Gt[0])||fe(Re.otherEvent.point,Gt[0])||$t(Re,Gt[0],wt),fe(Ne.point,Gt[0])||fe(Ne.otherEvent.point,Gt[0])||$t(Ne,Gt[0],wt),1;var fi=[],Li=!1,Ni=!1;return fe(Re.point,Ne.point)?Li=!0:Ut(Re,Ne)===1?fi.push(Ne,Re):fi.push(Re,Ne),fe(Re.otherEvent.point,Ne.otherEvent.point)?Ni=!0:Ut(Re.otherEvent,Ne.otherEvent)===1?fi.push(Ne.otherEvent,Re.otherEvent):fi.push(Re.otherEvent,Ne.otherEvent),Li&&Ni||Li?(Ne.type=w,Re.type=Ne.inOut===Re.inOut?A:z,Li&&!Ni&&$t(fi[1].otherEvent,fi[0].point,wt),2):Ni?($t(fi[0],fi[1].point,wt),3):fi[0]!==fi[3].otherEvent?($t(fi[0],fi[1].point,wt),$t(fi[1],fi[2].point,wt),3):($t(fi[0],fi[1].point,wt),$t(fi[3].otherEvent,fi[2].point,wt),3)}function ai(Re,Ne){if(Re===Ne)return 0;if(qt(Re.point,Re.otherEvent.point,Ne.point)!==0||qt(Re.point,Re.otherEvent.point,Ne.otherEvent.point)!==0)return fe(Re.point,Ne.point)?Re.isBelow(Ne.otherEvent.point)?-1:1:Re.point[0]===Ne.point[0]?Re.point[1]<Ne.point[1]?-1:1:Ut(Re,Ne)===1?Ne.isAbove(Re.point)?-1:1:Re.isBelow(Ne.point)?-1:1;if(Re.isSubject!==Ne.isSubject)return Re.isSubject?-1:1;var wt=Re.point,Gt=Ne.point;return wt[0]===Gt[0]&&wt[1]===Gt[1]?(wt=Re.otherEvent.point)[0]===(Gt=Ne.otherEvent.point)[0]&&wt[1]===Gt[1]?0:Re.contourId>Ne.contourId?1:-1:Ut(Re,Ne)===1?1:-1}var Yt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Di(Re,Ne,wt,Gt){var hi,fi=Re+1,Li=Ne[Re].point,Ni=Ne.length;for(fi<Ni&&(hi=Ne[fi].point);fi<Ni&&hi[0]===Li[0]&&hi[1]===Li[1];){if(!wt[fi])return fi;++fi<Ni&&(hi=Ne[fi].point)}for(fi=Re-1;wt[fi]&&fi>Gt;)fi--;return fi}Yt.prototype.isExterior=function(){return this.holeOf==null};var pi=Mi,xi=Mi;function Mi(Re,Ne){if(!(this instanceof Mi))return new Mi(Re,Ne);if(this.data=Re||[],this.length=this.data.length,this.compare=Ne||An,this.length>0)for(var wt=(this.length>>1)-1;wt>=0;wt--)this._down(wt)}function An(Re,Ne){return Re<Ne?-1:Re>Ne?1:0}Mi.prototype={push:function(Re){this.data.push(Re),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Re=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Re}},peek:function(){return this.data[0]},_up:function(Re){for(var Ne=this.data,wt=this.compare,Gt=Ne[Re];Re>0;){var hi=Re-1>>1,fi=Ne[hi];if(wt(Gt,fi)>=0)break;Ne[Re]=fi,Re=hi}Ne[Re]=Gt},_down:function(Re){for(var Ne=this.data,wt=this.compare,Gt=this.length>>1,hi=Ne[Re];Re<Gt;){var fi=1+(Re<<1),Li=fi+1,Ni=Ne[fi];if(Li<this.length&&wt(Ne[Li],Ni)<0&&(fi=Li,Ni=Ne[Li]),wt(Ni,hi)>=0)break;Ne[Re]=Ni,Re=fi}Ne[Re]=hi}},pi.default=xi;var ei=Math.max,zi=Math.min,un=0;function Hn(Re,Ne,wt,Gt,hi,fi){var Li,Ni,_n,bn,Tn,Fn;for(Li=0,Ni=Re.length-1;Li<Ni;Li++)if(bn=Re[Li+1],Tn=new le(_n=Re[Li],!1,void 0,Ne),Fn=new le(bn,!1,Tn,Ne),Tn.otherEvent=Fn,_n[0]!==bn[0]||_n[1]!==bn[1]){Tn.contourId=Fn.contourId=wt,fi||(Tn.isExteriorRing=!1,Fn.isExteriorRing=!1),Ut(Tn,Fn)>0?Fn.left=!0:Tn.left=!0;var Ji=_n[0],on=_n[1];hi[0]=zi(hi[0],Ji),hi[1]=zi(hi[1],on),hi[2]=ei(hi[2],Ji),hi[3]=ei(hi[3],on),Gt.push(Tn),Gt.push(Fn)}}var Xn=[];function yn(Re,Ne,wt){typeof Re[0][0][0]=="number"&&(Re=[Re]),typeof Ne[0][0][0]=="number"&&(Ne=[Ne]);var Gt=(function(on,ia,ua){var da=null;return on.length*ia.length==0&&(ua===O?da=Xn:ua===U?da=on:ua!==F&&ua!==q||(da=on.length===0?ia:on)),da})(Re,Ne,wt);if(Gt)return Gt===Xn?null:Gt;var hi=[1/0,1/0,-1/0,-1/0],fi=[1/0,1/0,-1/0,-1/0],Li=(function(on,ia,ua,da,ba){var Na,ja,fa,va,wn,Zn,fr=new pi(null,Ut);for(fa=0,va=on.length;fa<va;fa++)for(wn=0,Zn=(Na=on[fa]).length;wn<Zn;wn++)(ja=wn===0)&&un++,Hn(Na[wn],!0,un,fr,ua,ja);for(fa=0,va=ia.length;fa<va;fa++)for(wn=0,Zn=(Na=ia[fa]).length;wn<Zn;wn++)ja=wn===0,ba===U&&(ja=!1),ja&&un++,Hn(Na[wn],!1,un,fr,da,ja);return fr})(Re,Ne,hi,fi,wt);if(Gt=(function(on,ia,ua,da,ba){var Na=null;return(ua[0]>da[2]||da[0]>ua[2]||ua[1]>da[3]||da[1]>ua[3])&&(ba===O?Na=Xn:ba===U?Na=on:ba!==F&&ba!==q||(Na=on.concat(ia))),Na})(Re,Ne,hi,fi,wt))return Gt===Xn?null:Gt;for(var Ni=(function(on){var ia,ua,da=(function(fa){var va,wn,Zn,fr,Xi=[];for(wn=0,Zn=fa.length;wn<Zn;wn++)((va=fa[wn]).left&&va.inResult||!va.left&&va.otherEvent.inResult)&&Xi.push(va);for(var Bn=!1;!Bn;)for(Bn=!0,wn=0,Zn=Xi.length;wn<Zn;wn++)wn+1<Zn&&Ut(Xi[wn],Xi[wn+1])===1&&(fr=Xi[wn],Xi[wn]=Xi[wn+1],Xi[wn+1]=fr,Bn=!1);for(wn=0,Zn=Xi.length;wn<Zn;wn++)(va=Xi[wn]).otherPos=wn;for(wn=0,Zn=Xi.length;wn<Zn;wn++)(va=Xi[wn]).left||(fr=va.otherPos,va.otherPos=va.otherEvent.otherPos,va.otherEvent.otherPos=fr);return Xi})(on),ba={},Na=[],ja=function(){if(!ba[ia]){var fa=Na.length,va=(function(Xi,Bn,Ra){var Ua=new Yt;if(Xi.prevInResult!=null){var Ya=Xi.prevInResult,Lr=Ya.outputContourId;if(Ya.resultTransition>0){var Ha=Bn[Lr];if(Ha.holeOf!=null){var Yi=Ha.holeOf;Bn[Yi].holeIds.push(Ra),Ua.holeOf=Yi,Ua.depth=Bn[Lr].depth}else Bn[Lr].holeIds.push(Ra),Ua.holeOf=Lr,Ua.depth=Bn[Lr].depth+1}else Ua.holeOf=null,Ua.depth=Bn[Lr].depth}else Ua.holeOf=null,Ua.depth=0;return Ua})(da[ia],Na,fa),wn=function(Xi){ba[Xi]=!0,Xi<da.length&&da[Xi]&&(da[Xi].outputContourId=fa)},Zn=ia,fr=ia;for(va.points.push(da[ia].point);wn(Zn),wn(Zn=da[Zn].otherPos),va.points.push(da[Zn].point),!((Zn=Di(Zn,da,ba,fr))==fr||Zn>=da.length)&&da[Zn];);Na.push(va)}};for(ia=0,ua=da.length;ia<ua;ia++)ja();return Na})((function(on,ia,ua,da,ba,Na){for(var ja,fa,va,wn=new n(ai),Zn=[],fr=Math.min(da[2],ba[2]);on.length!==0;){var Xi=on.pop();if(Zn.push(Xi),Na===O&&Xi.point[0]>fr||Na===U&&Xi.point[0]>da[2])break;if(Xi.left){fa=ja=wn.insert(Xi),ja=ja!==(va=wn.minNode())?wn.prev(ja):null,fa=wn.next(fa);var Bn=ja?ja.key:null;if(Z(Xi,Bn,Na),fa&&Vt(Xi,fa.key,on)===2&&(Z(Xi,Bn,Na),Z(fa.key,Xi,Na)),ja&&Vt(ja.key,Xi,on)===2){var Ra=ja;Z(Bn,(Ra=Ra!==va?wn.prev(Ra):null)?Ra.key:null,Na),Z(Xi,Bn,Na)}}else fa=ja=wn.find(Xi=Xi.otherEvent),ja&&fa&&(ja=ja!==va?wn.prev(ja):null,fa=wn.next(fa),wn.remove(Xi),fa&&ja&&Vt(ja.key,fa.key,on))}return Zn})(Li,0,0,hi,fi,wt)),_n=[],bn=0;bn<Ni.length;bn++){var Tn=Ni[bn];if(Tn.isExterior()){for(var Fn=[Tn.points],Ji=0;Ji<Tn.holeIds.length;Ji++)Fn.push(Ni[Tn.holeIds[Ji]].points);_n.push(Fn)}}return _n}var Pa={UNION:F,DIFFERENCE:U,INTERSECTION:O,XOR:q};a.diff=function(Re,Ne){return yn(Re,Ne,U)},a.intersection=function(Re,Ne){return yn(Re,Ne,O)},a.operations=Pa,a.union=function(Re,Ne){return yn(Re,Ne,F)},a.xor=function(Re,Ne){return yn(Re,Ne,q)},Object.defineProperty(a,"__esModule",{value:!0})})(By.exports)),By.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function of(a,e,n,l){const u=[],g=l===0?(_,w,A,z,O,F)=>{_.push(new Pe(F,A+(F-w)/(z-w)*(O-A)))}:(_,w,A,z,O,F)=>{_.push(new Pe(w+(F-A)/(O-A)*(z-w),F))};for(const _ of a){const w=[];for(const A of _){if(A.length<=2)continue;const z=[];for(let U=0;U<A.length-1;U++){const q=A[U].x,Z=A[U].y,ee=A[U+1].x,le=A[U+1].y,oe=l===0?q:Z,fe=l===0?ee:le;oe<e?fe>e&&g(z,q,Z,ee,le,e):oe>n?fe<n&&g(z,q,Z,ee,le,n):z.push(A[U]),fe<e&&oe>=e&&g(z,q,Z,ee,le,e),fe>n&&oe<=n&&g(z,q,Z,ee,le,n)}let O=A[A.length-1];const F=l===0?O.x:O.y;F>=e&&F<=n&&z.push(O),z.length&&(O=z[z.length-1],z[0].x===O.x&&z[0].y===O.y||z.push(z[0]),w.push(z))}w.length&&u.push(w)}return u}function Ix(a,e){const n=lf(a),l=lf([e]),u=dm.intersection(n,l);return u==null?[]:fp(u)}function $b(a,e){let l=lf(a,65536);const u=[];for(;e.valid();e.next()){const[g,_]=e.get(),w=g.x*65536,A=g.y*65536,z=_.x*65536,O=_.y*65536,F=z-w,U=O-A,q=Math.hypot(F,U);if(q===0)continue;const Z=Math.trunc(U/q*3),ee=-Math.trunc(F/q*3);u.push([[[w,A],[z,O],[z+Z,O+ee],[w+Z,A+ee],[w,A]]])}return u.length>0&&(l=dm.diff(l,u)),fp(l,1/65536)}function lf(a,e=1){return[a.map((n=>n.map((l=>[l.x*e,l.y*e]))))]}function fp(a,e=1){return a.map((n=>n.map(((l,u)=>{const g=l.map((_=>new Pe(_[0]*e,_[1]*e).round()));return u>0&&g.reverse(),g}))))}class g_{constructor(e,n){this.layoutVertexArray=new Mc,this.indexArray=new Wr,this.lineIndexArray=new Tl,this.triangleSegments=new tr,this.lineSegments=new tr,this.programConfigurations=new zc(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,n&&(this.elevatedLayoutVertexArray=new bl)}update(e,n,l,u,g,_,w,A){this.programConfigurations.updatePaintArrays(e,n,g,l,u,_,w,A)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Iy.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,n,l,u,g,_,w){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,u,g,_,void 0,w)}}class mp{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new g_(e,!1),this.elevationBufferData=new g_(e,!0),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,u){}populate(e,n,l,u){this.hasPattern=Ny("fill",this.layers,this.pixelRatio,n);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:w,id:A,index:z,sourceLayerIndex:O}of e){const F=this.layers[0]._featureFilter.needGeometry,U=it(w,F);if(!this.layers[0]._featureFilter.filter(new Da(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),U,l))continue;const q=g?g.evaluate(U,{},l,n.availableImages):void 0,Z={id:A,properties:w.properties,type:w.type,sourceLayerIndex:O,index:z,geometry:F?U.geometry:Ve(w,l,u),patterns:{},sortKey:q};_.push(Z)}g&&_.sort(((w,A)=>w.sortKey-A.sortKey));for(const w of _){const{geometry:A,index:z,sourceLayerIndex:O}=w;if(this.hasPattern){const F=Fy("fill",this.layers,w,this.zoom,this.pixelRatio,n);this.patternFeatures.push(F)}else this.addFeature(w,A,z,l,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(e[z].feature,A,z,O,this.index)}}update(e,n,l,u,g,_,w){this.bufferData.update(e,n,l,u,g,_,w,this.worldview),this.elevationBufferData.update(e,n,l,u,g,_,w,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,n,l,u,g,_,w,this.worldview)}addFeatures(e,n,l,u,g,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,n,l,u,_,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,n,l,u,g,_=[],w,A){const z=bg(n,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,z,u,l,A):this.addGeometry(z,this.bufferData),this.bufferData.populatePaintArrays(e,l,g,_,u,w,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,g,_,u,w,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,n,l,u,g){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(n,l,u,g,this.worldview))}addElevatedRoadFeature(e,n,l,u,g){const _=new Array,w=la.getElevationFeature(e,g);if(!w)return void this.addGeometry(n,this.bufferData);{const z=this.clipPolygonsToTile(n,1);z.length>0&&_.push({polygons:z,elevationFeature:w,elevationTileID:l})}const A={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:u};for(const z of _)if(z.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Yl(z.elevationTileID,this.layers,this.zoom,this.lut));const F=z.elevationFeature.isTunnel();let U=0;e.properties.hasOwnProperty(ht)&&(U=+e.properties[ht]);for(const q of z.polygons)this.elevatedStructures.addPortalCandidates(z.elevationFeature.id,q,F,z.elevationFeature,U)}z.elevationFeature.constantHeight==null&&(z.polygons=this.prepareElevatedPolygons(z.polygons,z.elevationFeature,z.elevationTileID));const O=new _a(l,z.elevationTileID);this.addElevatedGeometry(z.polygons,O,z.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,A)}}addElevatedGeometry(e,n,l,u,g,_){const w={elevation:l,elevationSampler:n,bias:u,index:g,featureInfo:_},[A,z]=this.addGeometry(e,this.elevationBufferData,w);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:A,max:z}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,A),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,z))}addGeometry(e,n,l){let u=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,_=null;l&&(_=l.elevationSampler.constantElevation(l.elevation,l.bias),_!=null&&(u=_,g=_));const w=(A,z,O)=>{if(l!=null)if(z.push(A),_!=null)n.elevatedLayoutVertexArray.emplaceBack(_),O.push(_);else{const F=l.elevationSampler.pointElevation(A,l.elevation,l.bias);n.elevatedLayoutVertexArray.emplaceBack(F),O.push(F),u=Math.min(u,F),g=Math.max(g,F)}};for(const A of e){let z=0;for(const _e of A)z+=_e.length;const O=n.triangleSegments.prepareSegment(z,n.layoutVertexArray,n.indexArray),F=O.vertexLength,U=[],q=[],Z=[],ee=[],le=[],oe=n.layoutVertexArray.length;for(const _e of A){if(_e.length===0)continue;_e!==A[0]&&q.push(U.length/2);const be=n.lineSegments.prepareSegment(_e.length,n.layoutVertexArray,n.lineIndexArray),Oe=be.vertexLength;l&&le.push(n.layoutVertexArray.length-oe),w(_e[0],Z,ee),n.layoutVertexArray.emplaceBack(_e[0].x,_e[0].y),n.lineIndexArray.emplaceBack(Oe+_e.length-1,Oe),U.push(_e[0].x),U.push(_e[0].y);for(let Ie=1;Ie<_e.length;Ie++)w(_e[Ie],Z,ee),n.layoutVertexArray.emplaceBack(_e[Ie].x,_e[Ie].y),n.lineIndexArray.emplaceBack(Oe+Ie-1,Oe+Ie),U.push(_e[Ie].x),U.push(_e[Ie].y);be.vertexLength+=_e.length,be.primitiveLength+=_e.length}const fe=cm(U,q);for(let _e=0;_e<fe.length;_e+=3)n.indexArray.emplaceBack(F+fe[_e],F+fe[_e+1],F+fe[_e+2]);if(fe.length>0&&l&&this.elevationMode==="hd-road-base"){const _e=l.elevation.isTunnel(),be=l.elevation.safeArea,Oe=this.elevatedStructures.addVertices(Z,ee);this.elevatedStructures.addTriangles(fe,Oe,_e);const Ie=le.length;if(Ie>0){for(let Ue=0;Ue<Ie-1;Ue++)this.elevatedStructures.addRenderableRing(l.index,le[Ue]+Oe,le[Ue+1]-le[Ue],_e,be,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,le[Ie-1]+Oe,Z.length-le[Ie-1],_e,be,l.featureInfo)}}O.vertexLength+=z,O.primitiveLength+=fe.length/3}return[u,g]}prepareElevatedPolygons(e,n,l){const u=1/de(l),g=[];for(const _ of e){const w=$b(_,new Qn(n,u));g.push(...w)}return g}clipPolygonsToTile(e,n){const l=-n,u=-n,g=Xt+n,_=Xt+n;let w=0;const A=[],z=[];for(;w<e.length;w++){const U=e[w],q=Ds(U);(q.min.x>=l&&q.max.x<=g&&q.min.y>=u&&q.max.y<=_?A:z).push(U)}if(A.length===e.length)return e;const O=[new Pe(l,u),new Pe(g,u),new Pe(g,_),new Pe(l,_),new Pe(l,u)],F=A;for(const U of z)F.push(...Ix(U,O));return F}}let __,y_,wg,Uy;yi(mp,"FillBucket",{omit:["layers","patternFeatures"]}),yi(g_,"FillBufferData"),yi(Yl,"ElevatedStructures");class Sg{constructor(e,n,l,u){if(this.triangleCount=n.length/3,this.min=new Pe(0,0),this.max=new Pe(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[g,_]=[e[0].clone(),e[0].clone()];for(let F=1;F<e.length;++F){const U=e[F];g.x=Math.min(g.x,U.x),g.y=Math.min(g.y,U.y),_.x=Math.max(_.x,U.x),_.y=Math.max(_.y,U.y)}if(u){const F=Math.ceil(Math.max(_.x-g.x,_.y-g.y)/u);l=Math.max(l,F)}if(l===0)return;this.min=g,this.max=_;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const A=Math.max(w.x,w.y)/l;this.cellsX=Math.max(1,Math.ceil(w.x/A)),this.cellsY=Math.max(1,Math.ceil(w.y/A)),this.xScale=1/A,this.yScale=1/A;const z=[];for(let F=0;F<this.triangleCount;F++){const U=e[n[3*F+0]].sub(this.min),q=e[n[3*F+1]].sub(this.min),Z=e[n[3*F+2]].sub(this.min),ee=Pd(Math.floor(Math.min(U.x,q.x,Z.x)),this.xScale,this.cellsX),le=Pd(Math.floor(Math.max(U.x,q.x,Z.x)),this.xScale,this.cellsX),oe=Pd(Math.floor(Math.min(U.y,q.y,Z.y)),this.yScale,this.cellsY),fe=Pd(Math.floor(Math.max(U.y,q.y,Z.y)),this.yScale,this.cellsY),_e=new Pe(0,0),be=new Pe(0,0),Oe=new Pe(0,0),Ie=new Pe(0,0);for(let Ue=oe;Ue<=fe;++Ue){_e.y=be.y=Ue*A,Oe.y=Ie.y=(Ue+1)*A;for(let Ge=ee;Ge<=le;++Ge)_e.x=Oe.x=Ge*A,be.x=Ie.x=(Ge+1)*A,(ks(U,q,Z,_e,be,Ie)||ks(U,q,Z,_e,Ie,Oe))&&z.push({cellIdx:Ue*this.cellsX+Ge,triIdx:F})}}if(z.length===0)return;z.sort(((F,U)=>F.cellIdx-U.cellIdx||F.triIdx-U.triIdx));let O=0;for(;O<z.length;){const F=z[O].cellIdx,U={start:this.payload.length,len:0};for(;O<z.length&&z[O].cellIdx===F;)++U.len,this.payload.push(z[O++].triIdx);this.cells[F]=U}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=Pd(e.x-this.min.x,this.xScale,this.cellsX),u=Pd(e.y-this.min.y,this.yScale,this.cellsY),g=this.cells[u*this.cellsX+l];if(g){this._lazyInitLookup();for(let _=0;_<g.len;_++){const w=this.payload[g.start+_],A=Math.floor(w/8),z=1<<w%8;if(!(this.lookup[A]&z)&&(this.lookup[A]|=z,n.push(w),n.length===this.triangleCount))return}}}query(e,n,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const u=Pd(e.x-this.min.x,this.xScale,this.cellsX),g=Pd(n.x-this.min.x,this.xScale,this.cellsX),_=Pd(e.y-this.min.y,this.yScale,this.cellsY),w=Pd(n.y-this.min.y,this.yScale,this.cellsY);for(let A=_;A<=w;A++)for(let z=u;z<=g;z++){const O=this.cells[A*this.cellsX+z];if(O)for(let F=0;F<O.len;F++){const U=this.payload[O.start+F],q=Math.floor(U/8),Z=1<<U%8;if(!(this.lookup[q]&Z)&&(this.lookup[q]|=Z,l.push(U),l.length===this.triangleCount))return}}}}function Pd(a,e,n){return Math.max(0,Math.min(n-1,Math.floor(a*e)))}yi(Sg,"TriangleGridIndex");class $y{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){for(const l of this.footprints)n.push({footprint:l,id:e})}updateAppearances(e,n,l,u){}populate(e,n,l,u){const g=[];for(const{feature:_,id:w,index:A,sourceLayerIndex:z}of e){const O=this.layers[0]._featureFilter.needGeometry,F=it(_,O);if(!this.layers[0]._featureFilter.filter(new Da(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),F,l))continue;const U={id:w,properties:_.properties,type:_.type,sourceLayerIndex:z,index:A,geometry:O?F.geometry:Ve(_,l,u),patterns:{}};g.push(U)}for(const _ of g){const{geometry:w,index:A,sourceLayerIndex:z}=_;this.addFeature(_,w,A,l,{},n.availableImages,n.brightness),n.featureIndex.insert(e[A].feature,w,A,z,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,l,u,g,_,w){}destroy(){}addFeature(e,n,l,u,g,_=[],w){for(const A of bg(n,2)){const z=[],O=[],F=[],U=new Pe(1/0,1/0),q=new Pe(-1/0,-1/0);for(const le of A)if(le.length!==0){le!==A[0]&&F.push(O.length/2);for(let oe=0;oe<le.length;oe++)O.push(le[oe].x),O.push(le[oe].y),z.push(le[oe]),U.x=Math.min(U.x,le[oe].x),U.y=Math.min(U.y,le[oe].y),q.x=Math.max(q.x,le[oe].x),q.y=Math.max(q.y,le[oe].y)}const Z=cm(O,F),ee=new Sg(z,Z,8,256);this.footprints.push({vertices:z,indices:Z,grid:ee,min:U,max:q})}}}yi($y,"ClipBucket",{omit:["layers"]});const Tg=Mn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Vb=Mn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Hb=Mn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Gb=Mn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),v_=Mn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),x_=Mn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Vy=Mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qb}=Tg,ch=Number.MAX_SAFE_INTEGER,Rx=ch-1;function Hy(a,e,n,l){return a.order<e||a.order===ch||!(a.clipMask&n)||(function(u,g){return g.length!==0&&g.find((_=>_===u))===void 0})(l,a.clipScope)}function kg(a,e){return a.x-e.x||a.y-e.y}function Gy(a,e){return kg(a.min,e.min)===0&&kg(a.max,e.max)===0}function b_(a,e){return!(a.min.x>e.max.x||a.max.x<e.min.x||a.min.y>e.max.y||a.max.y<e.min.y)}function pp(a,e){if(a.length!==e.length)return!1;for(let n=0;n<a.length;n++)if(a[n].sourceId!==e[n].sourceId||!Gy(a[n],e[n])||a[n].order!==e[n].order||a[n].clipMask!==e[n].clipMask||!zt(a[n].clipScope,e[n].clipScope))return!1;return!0}function qy(a,e,n){const l=1/Xt,u=1/(1<<n.canonical.z),g=(e.x*l+n.canonical.x)*u+n.wrap,_=(e.y*l+n.canonical.y)*u;return{min:new Pe((a.x*l+n.canonical.x)*u+n.wrap,(a.y*l+n.canonical.y)*u),max:new Pe(g,_)}}function w_(a,e,n){const l=1<<n.canonical.z,u=((e.x-n.wrap)*l-n.canonical.x)*Xt,g=(e.y*l-n.canonical.y)*Xt;return{min:new Pe(((a.x-n.wrap)*l-n.canonical.x)*Xt,(a.y*l-n.canonical.y)*Xt),max:new Pe(u,g)}}function Wy(a,e,n,l,u,g,_){const w=a.indices,A=a.vertices,z=[];for(let O=l;O<l+u;O+=3){const F=e[n[O+0]+g],U=e[n[O+1]+g],q=e[n[O+2]+g],Z=Math.min(F.x,U.x,q.x),ee=Math.max(F.x,U.x,q.x),le=Math.min(F.y,U.y,q.y),oe=Math.max(F.y,U.y,q.y);z.length=0,a.grid.query(new Pe(Z,le),new Pe(ee,oe),z);for(let fe=0;fe<z.length;fe++){const _e=z[fe];if(ks(A[w[3*_e+0]],A[w[3*_e+1]],A[w[3*_e+2]],F,U,q,_))return!0}}return!1}function Dx(a,e,n,l){if(!a||!n)return!1;let u=a.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(n.vertices.length<a.vertices.length)return Dx(n,l,a,e);const g=e.canonical,_=l.canonical,w=Math.pow(2,_.z-g.z);u=a.vertices.map((A=>new Pe((A.x+g.x*Xt)*w-_.x*Xt,(A.y+g.y*Xt)*w-_.y*Xt)))}return Wy(n,u,a.indices,0,a.indices.length,0,0)}function S_(a,e,n,l){const u=Math.pow(2,l.z-n.z);return new Pe((a+n.x*Xt)*u-l.x*Xt,(e+n.y*Xt)*u-l.y*Xt)}function T_(a,e){const n=[];e.grid.queryPoint(a,n);const l=e.indices,u=e.vertices;for(let g=0;g<n.length;g++){const _=n[g];if(Ma([u[l[3*_+0]],u[l[3*_+1]],u[l[3*_+2]]],a))return!0}return!1}const gp=[new Pe(0,0),new Pe(Xt,0),new Pe(Xt,Xt),new Pe(0,Xt)];function k_(a,e){const n=[];let l=[];if(!e||a.length<2)return[a];if(a.length===2)return Ns(a[0],a[1],gp)?[a]:[];for(let u=0;u<a.length+2;u++){const g=a[u%a.length],_=a[(u+1)%a.length],w=Ns(u===0?a[a.length-1]:a[(u-1)%a.length],g,gp),A=Ns(g,_,gp),z=w||A;z&&l.push(g),z&&A||l.length>0&&(l.length>1&&n.push(l),l=[])}return l.length>1&&n.push(l),n}const E_=Ye.types,Zy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],cf=["fill-extrusion-flood-light-ground-radius"],uf=Math.pow(2,13),df=Math.pow(2,15)-1,_p=new Pe(0,1),Nc=2147483648,uh=7,Lx=450;function yp(a,e,n,l,u,g,_,w){a.emplaceBack((e<<1)+_,(n<<1)+g,(Math.floor(l*uf)<<1)+u,Math.round(w))}function dh(a,e,n){a.emplaceBack(e.x*Xt,e.y*Xt,n?1:0)}function A_(a,e,n,l,u,g){a.emplaceBack(e.x,e.y,(n.x<<1)+l,(n.y<<1)+u,g)}function vp(a,e,n){a.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Eg{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Xy{constructor(){this.centroidXY=new Pe(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Pe(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Pe(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Pe(this.max.x-this.min.x,this.max.y-this.min.y)}}class Ox{constructor(){this.acc=new Pe(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,l){this.accCount++,this.acc._add(n);let u=!!this.borders;n.x<e.min.x?(e.min.x=n.x,u=!0):n.x>e.max.x&&(e.max.x=n.x,u=!0),n.y<e.min.y?(e.min.y=n.y,u=!0):n.y>e.max.y&&(e.max.y=n.y,u=!0),((n.x===0||n.x===Xt)&&n.x===l.x)!=((n.y===0||n.y===Xt)&&n.y===l.y)&&this.processBorderOverlap(n,l),u&&this.checkBorderIntersection(n,l)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,$i(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Xt!=e.x>Xt&&this.addBorderIntersection(1,$i(n.y,e.y,(Xt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,$i(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Xt!=e.y>Xt&&this.addBorderIntersection(3,$i(n.x,e.x,(Xt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];n<l[0]&&(l[0]=n),n>l[1]&&(l[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,n.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,n.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new Pe(0,0):new Pe(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,n)=>e+ +(n[0]!==Number.MAX_VALUE)),0):0}}function Ag(a,e){const n=a.add(e)._unit(),l=ie(a.x*n.x+a.y*n.y,-1,1);var u,g,_;return u=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(u)))/4*df*((g=a).x*(_=e).y-g.y*_.x<0?-1:1)}const C_=[a=>a.x<0,a=>a.x>Xt,a=>a.y<0,a=>a.y>Xt];function Nx(a,e,n,l){const u=[4];if(l===0)return u;n._mult(l);const g=a.sub(n),_=e.sub(n),w=[a,e,g,_];for(let A=0;A<4;A++)for(const z of w)if(C_[A](z)){u.push(A);break}return u}class hm{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new oc,this.indexArray=new Wr,this.programConfigurations=new zc(e.layers,{zoom:e.zoom,lut:e.lut},(n=>cf.includes(n))),this._segments=new tr,this.hiddenByLandmarkVertexArray=new Qf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new tr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,l,u=!1){const g=e.length;if(g>2){let _=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let A;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const z=e[0],O=e[1];A=Ag(z.sub(e[g-1])._perp()._unit(),O.sub(z)._perp()._unit())}for(let z=0;z<g;z++){const O=z===g-1?0:z+1,F=e[z],U=e[O],q=e[O===g-1?0:O+1],Z=U.sub(F)._perp()._unit(),ee=Ag(Z,q.sub(U)._perp()._unit()),le=A,oe=ee;if(bp(F,U,n)||u&&d(F,n)&&d(U,n)){A=ee;continue}const fe=w.vertexLength;A_(this.vertexArray,F,U,1,1,le),A_(this.vertexArray,F,U,1,0,le),A_(this.vertexArray,F,U,0,1,oe),A_(this.vertexArray,F,U,0,0,oe),w.vertexLength+=4;const _e=Nx(F,U,Z,l);for(const be of _e)this._segmentToGroundQuads[_].push({id:fe,region:be}),this._segmentToRegionTriCounts[_][be]+=2,w.primitiveLength+=2;A=ee}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let l=0;l<n;l++)this._segmentToGroundQuads[l].sort(((u,g)=>u.region-g.region));for(let l=0;l<n;l++){const u=this._segmentToGroundQuads[l],g=e[l],_=this._segmentToRegionTriCounts[l];_.reduce(((A,z)=>A+z),0);let w=0;for(let A=0;A<=4;A++){const z=_[A];if(z!==0){let O=this.regionSegments[A];O||(O=this.regionSegments[A]=new tr);const F={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+w,vertexLength:g.vertexLength,primitiveLength:z};O.get().push(F)}w+=z}for(let A=0;A<u.length;A++){const z=u[A].id;this.indexArray.emplaceBack(z,z+1,z+3),this.indexArray.emplaceBack(z,z+3,z+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,l,u,g,_,w){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,l,u,g,_,void 0,w)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Vb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,Hb.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,l,u,g,_,w,A){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,l,u,g,_,w,A)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Nc))}updateHiddenByLandmarkRange(e,n,l){if(!this.hasData())return;const u=n+e;if(n!==0){for(let g=e;g<u;++g)this.hiddenByLandmarkVertexArray.emplace(g,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,x_.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class xp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Wr,this.footprintVertices=new Mc,this.footprintSegments=[],this.layoutVertexArray=new ih,this.centroidVertexArray=new nm,this.wallVertexArray=new Xh,this.indexArray=new Wr,this.programConfigurations=new zc(e.layers,{zoom:e.zoom,lut:e.lut},(n=>Zy.includes(n))),this.segments=new tr,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.groundEffect=new hm(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,u){}populate(e,n,l,u){this.features=[],this.hasPattern=Ny("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=de(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:_,index:w,sourceLayerIndex:A}of e){const z=this.layers[0]._featureFilter.needGeometry,O=it(g,z);if(!this.layers[0]._featureFilter.filter(new Da(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),O,l))continue;const F={id:_,sourceLayerIndex:A,index:w,geometry:z?O.geometry:Ve(g,l,u),properties:g.properties,type:g.type,patterns:{}},U=this.layoutVertexArray.length,q=E_[F.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:Fy("fill-extrusion",this.layers,F,this.zoom,this.pixelRatio,n)});else if(this.wallMode)for(const Z of F.geometry)for(const ee of k_(Z,q))this.addFeature(g.id,F,[ee],w,l,{},n.availableImages,u,n.brightness);else this.addFeature(g.id,F,F.geometry,w,l,{},n.availableImages,u,n.brightness);n.featureIndex.insert(g,F.geometry,w,A,this.index,U)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,l,u,g,_){for(const{featureId:w,feature:A}of this.features){const z=E_[A.type]==="Polygon",{geometry:O}=A;if(this.wallMode)for(const F of O)for(const U of k_(F,z))this.addFeature(w,A,[U],A.index,n,l,u,g,_);else this.addFeature(w,A,O,A.index,n,l,u,g,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,l,u,g,_,w){this.programConfigurations.updatePaintArrays(e,n,g,l,u,_,w,this.worldview),this.groundEffect.update(e,n,g,l,u,_,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,v_.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Vy.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Gb.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,u,g,_,w,A,z){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,F=[new Pe(0,0),new Pe(Xt,Xt)],U=A.projection,q=U.name==="globe",Z=this.wallMode||E_[n.type]==="Polygon",ee=new Ox;ee.centroidDataIndex=this.centroidData.length;const le=new Xy;le.buildingId=e,n.properties&&n.properties.hasOwnProperty("building_id")&&(le.buildingId=n.properties.building_id);const oe=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},g)<=0,fe=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},g);let _e;if(le.height=fe,le.vertexArrayOffset=this.layoutVertexArray.length,le.groundVertexArrayOffset=this.groundEffect.vertexArray.length,q&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ps),this.wallMode){if(q)return void mi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;_e=(function(nt){const bt=nt[0].x===nt[nt.length-1].x&&nt[0].y===nt[nt.length-1].y;(function(xi){let Mi=0;const An=xi.length;for(let ei=0;ei<An;ei++)Mi+=(xi[(ei+1)%An].x-xi[ei].x)*(xi[(ei+1)%An].y+xi[ei].y);return Mi>=0})(nt)||(nt=nt.reverse());const Pt={geometry:[],joinNormals:[],indices:[]},Ht=[],qt=[],Ut=[];let $t=nt.length;for(;$t>=2&&nt[$t-1].equals(nt[$t-2]);)$t--;if($t<(bt?3:2))return Pt;let xt,vt,Vt,ai,Yt,Di=0;for(;Di<$t-1&&nt[Di].equals(nt[Di+1]);)Di++;bt&&(xt=nt[$t-2],Yt=nt[Di].sub(xt)._unit()._perp());for(let xi=Di;xi<$t;xi++){if(Vt=xi===$t-1?bt?nt[Di+1]:void 0:nt[xi+1],Vt&&nt[xi].equals(Vt))continue;Yt&&(ai=Yt),xt&&(vt=xt),xt=nt[xi],Yt=Vt?Vt.sub(xt)._unit()._perp():ai,ai=ai||Yt;let Mi=ai.add(Yt);Mi.x===0&&Mi.y===0||Mi._unit();const An=Mi.x*Yt.x+Mi.y*Yt.y,ei=An!==0?1/An:1/0,zi=ai.x*Yt.y-ai.y*Yt.x>0;let un="miter";const Hn=2;un==="miter"&&ei>Hn&&(un="bevel"),un==="bevel"&&(ei>100&&(un="flipbevel"),ei<Hn&&(un="miter"));const Xn=(yn,Pa,Re,Ne)=>{const wt=new Pe(yn.x,yn.y),Gt=new Pe(yn.x,yn.y);wt.x+=Pa.x*Ne,wt.y+=Pa.y*Ne,Gt.x-=Pa.x*Math.max(Re,1),Gt.y-=Pa.y*Math.max(Re,1),Ut.push(Pa),Ht.push(wt),qt.push(Gt)};if(un==="miter")Mi._mult(ei),Xn(xt,Mi,0,0);else if(un==="flipbevel")Mi=Yt.mult(-1),Xn(xt,Mi,0,0),Xn(xt,Mi.mult(-1),0,0);else{const yn=-Math.sqrt(ei*ei-1),Pa=zi?yn:0,Re=zi?0:yn;vt&&Xn(xt,ai,Pa,Re),Vt&&Xn(xt,Yt,Pa,Re)}}Pt.geometry=[...Ht,...qt.reverse(),Ht[0]],Pt.joinNormals=[...Ut,...Ut.reverse(),Ut[Ut.length-1]];const pi=Pt.geometry.length-1;for(let xi=0;xi<pi/2;xi++)if(xi+1<pi/2){let Mi=xi,An=xi+1,ei=pi-1-xi,zi=pi-2-xi;Mi=Mi===0?pi-1:Mi-1,An=An===0?pi-1:An-1,ei=ei===0?pi-1:ei-1,zi=zi===0?pi-1:zi-1,Pt.indices.push(ei),Pt.indices.push(An),Pt.indices.push(Mi),Pt.indices.push(ei),Pt.indices.push(zi),Pt.indices.push(An)}return Pt})(l[0]),l=[_e.geometry]}const be=(nt,bt)=>nt<(bt.length-1)/2||nt===bt.length-1,Oe=this.wallMode?[l]:bg(l,500);for(let nt=Oe.length-1;nt>=0;nt--){const bt=Oe[nt];(bt.length===0||(Ie=bt[0]).every((Mt=>Mt.x<=0))||Ie.every((Mt=>Mt.x>=Xt))||Ie.every((Mt=>Mt.y<=0))||Ie.every((Mt=>Mt.y>=Xt)))&&Oe.splice(nt,1)}var Ie;let Ue;if(q)Ue=G(Oe,F,g);else{Ue=[];for(const nt of Oe)Ue.push({polygon:nt,bounds:F})}const Ge=Z?this.edgeRadius:0,et=Ge>0&&this.zoom<17,yt=(nt,bt)=>{if(nt.length===0)return!1;const Mt=nt[nt.length-1];return bt.x===Mt.x&&bt.y===Mt.y};for(const{polygon:nt,bounds:bt}of Ue){let Mt=0,Pt=0;for(const $t of nt)Z&&!$t[0].equals($t[$t.length-1])&&$t.push($t[0]),Pt+=Z?$t.length-1:$t.length;const Ht=this.segments.prepareSegment((Z?5:4)*Pt,this.layoutVertexArray,this.indexArray);le.footprintSegIdx<0&&(le.footprintSegIdx=this.footprintSegments.length),le.polygonSegIdx<0&&(le.polygonSegIdx=this.polygonSegments.length);const qt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ut=new Eg;if(Ut.vertexOffset=this.footprintVertices.length,Ut.indexOffset=3*this.footprintIndices.length,Ut.ringIndices=[],Z){const $t=[],xt=[];Mt=Ht.vertexLength;for(let Vt=0;Vt<nt.length;Vt++){const ai=nt[Vt];ai.length&&Vt!==0&&xt.push($t.length/2);const Yt=[];let Di,pi;Di=ai[1].sub(ai[0])._perp()._unit(),Ut.ringIndices.push(ai.length-1);for(let xi=1;xi<ai.length;xi++){const Mi=ai[xi],An=ai[xi===ai.length-1?1:xi+1],ei=Mi.clone();if(Ge){pi=An.sub(Mi)._perp()._unit();const zi=Di.add(pi)._unit(),un=Ge*Math.min(4,1/(Di.x*zi.x+Di.y*zi.y));ei.x+=un*zi.x,ei.y+=un*zi.y,ei.x=Math.round(ei.x),ei.y=Math.round(ei.y),Di=pi}if(!oe||Ge!==0&&!et||yt(Yt,ei)||Yt.push(ei),yp(this.layoutVertexArray,ei.x,ei.y,0,0,1,1,0),this.wallMode){const zi=be(xi,ai);dh(this.wallVertexArray,_e.joinNormals[xi],!zi)}Ht.vertexLength++,this.footprintVertices.emplaceBack(Mi.x,Mi.y),$t.push(Mi.x,Mi.y),q&&vp(this.layoutVertexExtArray,U.projectTilePoint(ei.x,ei.y,g),U.upVector(g,ei.x,ei.y))}oe&&(Ge===0||et)&&(Yt.length!==0&&yt(Yt,Yt[0])&&Yt.pop(),this.groundEffect.addData(Yt,bt,O))}const vt=this.wallMode?_e.indices:cm($t,xt);for(let Vt=0;Vt<vt.length;Vt+=3)this.footprintIndices.emplaceBack(Ut.vertexOffset+vt[Vt+0],Ut.vertexOffset+vt[Vt+1],Ut.vertexOffset+vt[Vt+2]),this.indexArray.emplaceBack(Mt+vt[Vt],Mt+vt[Vt+2],Mt+vt[Vt+1]),Ht.primitiveLength++;Ut.indexCount+=vt.length,Ut.vertexCount+=this.footprintVertices.length-Ut.vertexOffset}for(let $t=0;$t<nt.length;$t++){const xt=nt[$t];ee.startRing(le,xt[0]);let vt=xt.length>4&&y(xt[xt.length-2],xt[0],xt[1]),Vt=Ge?Fx(xt[xt.length-2],xt[0],xt[1],Ge):0;const ai=[];let Yt,Di,pi;Di=xt[1].sub(xt[0])._perp()._unit();let xi=!0;for(let Mi=1,An=0;Mi<xt.length;Mi++){let ei=xt[Mi-1],zi=xt[Mi];const un=xt[Mi===xt.length-1?1:Mi+1];if(ee.appendEdge(le,zi,ei),bp(zi,ei,bt)){Ge&&(Di=un.sub(zi)._perp()._unit(),xi=!xi);continue}const Hn=zi.sub(ei)._perp(),Xn=Hn.x/(Math.abs(Hn.x)+Math.abs(Hn.y)),yn=Hn.y>0?1:0,Pa=ei.dist(zi);if(An+Pa>32768&&(An=0),Ge){pi=un.sub(zi)._perp()._unit();let Gt=Bx(ei,zi,un,Cg(Di,pi),Ge);isNaN(Gt)&&(Gt=0);const hi=zi.sub(ei)._unit();ei=ei.add(hi.mult(Vt))._round(),zi=zi.add(hi.mult(-Gt))._round(),Vt=Gt,Di=pi,oe&&this.zoom>=17&&(yt(ai,ei)||ai.push(ei),yt(ai,zi)||ai.push(zi))}const Re=Ht.vertexLength,Ne=xt.length>4&&y(ei,zi,un);let wt=k(An,vt,xi);if(yp(this.layoutVertexArray,ei.x,ei.y,Xn,yn,0,0,wt),yp(this.layoutVertexArray,ei.x,ei.y,Xn,yn,0,1,wt),this.wallMode){const Gt=be(Mi-1,xt),hi=_e.joinNormals[Mi-1];dh(this.wallVertexArray,hi,Gt),dh(this.wallVertexArray,hi,Gt)}if(An+=Pa,wt=k(An,Ne,!xi),vt=Ne,yp(this.layoutVertexArray,zi.x,zi.y,Xn,yn,0,0,wt),yp(this.layoutVertexArray,zi.x,zi.y,Xn,yn,0,1,wt),this.wallMode){const Gt=be(Mi,xt),hi=_e.joinNormals[Mi];dh(this.wallVertexArray,hi,Gt),dh(this.wallVertexArray,hi,Gt)}if(Ht.vertexLength+=4,this.indexArray.emplaceBack(Re+0,Re+1,Re+2),this.indexArray.emplaceBack(Re+1,Re+3,Re+2),Ht.primitiveLength+=2,Ge){const Gt=Mt+(Mi===1?xt.length-2:Mi-2),hi=Mi===1?Mt:Gt+1;if(this.indexArray.emplaceBack(Re+1,Gt,Re+3),this.indexArray.emplaceBack(Gt,hi,Re+3),Ht.primitiveLength+=2,Yt===void 0&&(Yt=Re),!bp(un,xt[Mi],bt)){const fi=Mi===xt.length-1?Yt:Ht.vertexLength;this.indexArray.emplaceBack(Re+2,Re+3,fi),this.indexArray.emplaceBack(Re+3,fi+1,fi),this.indexArray.emplaceBack(Re+3,hi,fi+1),Ht.primitiveLength+=3}xi=!xi}if(q){const Gt=this.layoutVertexExtArray,hi=U.projectTilePoint(ei.x,ei.y,g),fi=U.projectTilePoint(zi.x,zi.y,g),Li=U.upVector(g,ei.x,ei.y),Ni=U.upVector(g,zi.x,zi.y);vp(Gt,hi,Li),vp(Gt,hi,Li),vp(Gt,fi,Ni),vp(Gt,fi,Ni)}}Z&&(Mt+=xt.length-1),oe&&Ge&&this.zoom>=17&&(ai.length!==0&&yt(ai,ai[0])&&ai.pop(),this.groundEffect.addData(ai,bt,O,Ge>0))}this.footprintSegments.push(Ut),qt.triangleCount=this.indexArray.length-qt.triangleArrayOffset,this.polygonSegments.push(qt),++le.footprintSegLen,++le.polygonSegLen}if(le.vertexCount=this.layoutVertexArray.length-le.vertexArrayOffset,le.groundVertexCount=this.groundEffect.vertexArray.length-le.groundVertexArrayOffset,le.vertexCount!==0){if(le.centroidXY=ee.borders?_p:this.encodeCentroid(ee,le),this.centroidData.push(le),ee.borders){this.featuresOnBorder.push(ee);const nt=this.featuresOnBorder.length-1;for(let bt=0;bt<ee.borders.length;bt++)ee.borders[bt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[bt].push(nt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,_,w,g,z,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(n,u,_,w,g,z,this.worldview),this.maxHeight=Math.max(this.maxHeight,fe)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((n,l)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[l].borders[e][0]))}splitToSubtiles(){const e=[];for(let w=0;w<this.centroidData.length;w++){const A=this.centroidData[w],z=+(A.min.y+A.max.y>Xt),O=2*z+(+(A.min.x+A.max.x>Xt)^z);for(let F=0;F<A.polygonSegLen;F++){const U=A.polygonSegIdx+F;e.push({centroidIdx:w,subtile:O,polygonSegmentIdx:U,triangleSegmentIdx:this.polygonSegments[U].triangleSegIdx})}}const n=new Wr;e.sort(((w,A)=>w.triangleSegmentIdx===A.triangleSegmentIdx?w.subtile-A.subtile:w.triangleSegmentIdx-A.triangleSegmentIdx));let l=0,u=0,g=0;for(const w of e){if(w.triangleSegmentIdx!==l)break;g++}const _=e.length;for(;u!==e.length;){l=e[u].triangleSegmentIdx;let w=0,A=u,z=u;for(let O=A;O<g&&e[O].subtile===w;O++)z++;for(;A!==g;){const O=e[A];w=O.subtile;const F=this.centroidData[O.centroidIdx].min.clone(),U=this.centroidData[O.centroidIdx].max.clone(),q={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Z=A;Z<z;Z++){const ee=e[Z],le=this.polygonSegments[ee.polygonSegmentIdx],oe=this.centroidData[ee.centroidIdx].min,fe=this.centroidData[ee.centroidIdx].max,_e=this.indexArray.uint16;for(let be=le.triangleArrayOffset;be<le.triangleArrayOffset+le.triangleCount;be++)n.emplaceBack(_e[3*be],_e[3*be+1],_e[3*be+2]);q.primitiveLength+=le.triangleCount,F.x=Math.min(F.x,oe.x),F.y=Math.min(F.y,oe.y),U.x=Math.max(U.x,fe.x),U.y=Math.max(U.y,fe.y)}q.primitiveLength>0&&this.triangleSubSegments.push({segment:q,min:F,max:U}),A=z;for(let Z=A;Z<g&&e[Z].subtile===e[A].subtile;Z++)z++}u=g;for(let O=u;O<_&&e[O].triangleSegmentIdx===e[u].triangleSegmentIdx;O++)g++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,l){const u=new tr;if(this.wallMode){for(const ee of this.triangleSubSegments)u.segments.push(ee.segment);return u}let g=0,_=0;const w=1<<e.canonical.z;if(n){const ee=n.getMinMaxForTile(e);ee&&(g=ee.min,_=ee.max)}_+=this.maxHeight;const A=e.toUnwrapped();let z;const O=[A.canonical.x/w+A.wrap,A.canonical.y/w],F=[(A.canonical.x+1)/w+A.wrap,(A.canonical.y+1)/w],U=(ee,le,oe)=>[ee[0]*(1-oe[0])+le[0]*oe[0],ee[1]*(1-oe[1])+le[1]*oe[1]],q=[],Z=[];for(const ee of this.triangleSubSegments){q[0]=ee.min.x/Xt,q[1]=ee.min.y/Xt,Z[0]=ee.max.x/Xt,Z[1]=ee.max.y/Xt;const le=U(O,F,q),oe=U(O,F,Z);if(new wi([le[0],le[1],g],[oe[0],oe[1],_]).intersectsPrecise(l)===0){z&&(u.segments.push(z),z=void 0);continue}const fe=ee.segment;z&&z.vertexOffset!==fe.vertexOffset&&(u.segments.push(z),z=void 0),z?(z.vertexLength+=fe.vertexLength,z.primitiveLength+=fe.primitiveLength):z={vertexOffset:fe.vertexOffset,primitiveLength:fe.primitiveLength,vertexLength:fe.vertexLength,primitiveOffset:fe.primitiveOffset,sortKey:void 0,vaos:{}}}return z&&u.segments.push(z),u}encodeCentroid(e,n){const l=e.centroid(),u=n.span(),g=Math.min(7,Math.round(u.x*this.tileToMeter/10)),_=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Pe(ie(l.x,1,Xt-1)<<3|g,ie(l.y,1,Xt-1)<<3|_)}encodeBorderCentroid(e){if(!e.borders)return new Pe(0,0);const n=e.borders,l=Number.MAX_VALUE;if(n[0][0]!==l||n[1][0]!==l){const u=n[0][0]!==l?0:1;return new Pe(6|(n[0][0]!==l?0:65528),(n[u][0]+n[u][1])/2<<3|6)}{const u=n[2][0]!==l?2:3;return new Pe((n[u][0]+n[u][1])/2<<3|6,6|(n[2][0]!==l?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=2147483647,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,u=e.flags&Nc?_p:e.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==u.y||g!==u.x){for(let _=n;_<l;++_)this.centroidVertexArray.emplace(_,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,l){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const u=n.getReplacementRegionsForTile(e.toUnwrapped());if(pp(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const g=[];for(const _ of this.activeReplacements){if(_.order<l)continue;const w=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));if(_.footprint.buildingIds)for(const A of this.centroidData)A.flags&Nc||_.min.x>A.max.x||A.min.x>_.max.x||_.min.y>A.max.y||A.min.y>_.max.y||_.footprint.buildingIds.has(A.buildingId)&&(A.flags|=Nc);else for(const A of this.centroidData)if(!(A.flags&Nc||_.min.x>A.max.x||A.min.x>_.max.x||_.min.y>A.max.y||A.min.y>_.max.y))for(let z=0;z<A.footprintSegLen;z++){const O=this.footprintSegments[A.footprintSegIdx+z];if(g.length=0,Q(this.footprintVertices,O.vertexOffset,O.vertexCount,_.footprintTileId.canonical,e.canonical,g),Wy(_.footprint,g,this.footprintIndices.uint16,O.indexOffset,O.indexCount,-O.vertexOffset,-w)){A.flags|=Nc;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,l){let u=!1;for(let g=0;g<l.footprintSegLen;g++){const _=this.footprintSegments[l.footprintSegIdx+g];let w=0;for(const A of _.ringIndices){for(let z=w,O=A+w-1;z<A+w;O=z++){const F=this.footprintVertices.int16[2*(z+_.vertexOffset)+0],U=this.footprintVertices.int16[2*(z+_.vertexOffset)+1],q=this.footprintVertices.int16[2*(O+_.vertexOffset)+1];U>n!=q>n&&e<(this.footprintVertices.int16[2*(O+_.vertexOffset)+0]-F)*(n-U)/(q-U)+F&&(u=!u)}w=A}}return u}getHeightAtTileCoord(e,n){let l=Number.NEGATIVE_INFINITY,u=!0;const g=4*(e+Xt)*Xt+(n+Xt);if(this.partLookup.hasOwnProperty(g)){const _=this.partLookup[g];return _?{height:_.height,hidden:!!(_.flags&Nc)}:void 0}for(const _ of this.centroidData)e>_.max.x||_.min.x>e||n>_.max.y||_.min.y>n||_.height<=l||this.footprintContainsPoint(e,n,_)&&(l=_.height,this.partLookup[g]=_,u=!!(_.flags&Nc));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.partLookup[g]=void 0}}function Cg(a,e){const n=a.add(e)._unit();return a.x*n.x+a.y*n.y}function Fx(a,e,n,l){const u=e.sub(a)._perp()._unit(),g=n.sub(e)._perp()._unit();return Bx(a,e,n,Cg(u,g),l)}function Bx(a,e,n,l,u){const g=Math.sqrt(1-l*l);return Math.min(a.dist(e)/3,e.dist(n)/3,u*g/l)}function bp(a,e,n){return a.x<n[0].x&&e.x<n[0].x||a.x>n[1].x&&e.x>n[1].x||a.y<n[0].y&&e.y<n[0].y||a.y>n[1].y&&e.y>n[1].y}function d(a,e){return a.x<e[0].x||a.x>e[1].x||a.y<e[0].y||a.y>e[1].y}function y(a,e,n){if(a.x<0||a.x>=Xt||e.x<0||e.x>=Xt||n.x<0||n.x>=Xt)return!1;const l=n.sub(e),u=l.perp(),g=a.sub(e);return(l.x*g.x+l.y*g.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(g.x*g.x+g.y*g.y))>-.866&&u.x*g.x+u.y*g.y<0}function k(a,e,n){const l=e?2|a:-3&a;return n?1|l:-2&l}function R(){const a=Math.PI/32,e=Math.tan(a),n=f;return n*Math.sqrt(1+2*e*e)-n}function G(a,e,n){const l=1<<n.z,u=V(n.x/l),g=V((n.x+1)/l),_=Y(n.y/l),w=Y((n.y+1)/l);return(function(A,z,O,F,U=0,q){const Z=[];if(!A.length||!O||!F)return Z;const ee=(Ie,Ue)=>{for(const Ge of Ie)Z.push({polygon:Ge,bounds:Ue})},le=Math.ceil(Math.log2(O)),oe=Math.ceil(Math.log2(F)),fe=le-oe,_e=[];for(let Ie=0;Ie<Math.abs(fe);Ie++)_e.push(fe>0?0:1);for(let Ie=0;Ie<Math.min(le,oe);Ie++)_e.push(0),_e.push(1);let be=A;if(be=of(be,z[0].y-U,z[1].y+U,1),be=of(be,z[0].x-U,z[1].x+U,0),!be.length)return Z;const Oe=[];for(_e.length?Oe.push({polygons:be,bounds:z,depth:0}):ee(be,z);Oe.length;){const Ie=Oe.pop(),Ue=Ie.depth,Ge=_e[Ue],et=Ie.bounds[0],yt=Ie.bounds[1],nt=Ge===0?et.x:et.y,bt=Ge===0?yt.x:yt.y,Mt=q?q(Ge,nt,bt):.5*(nt+bt),Pt=of(Ie.polygons,nt-U,Mt+U,Ge),Ht=of(Ie.polygons,Mt-U,bt+U,Ge);if(Pt.length){const qt=[et,new Pe(Ge===0?Mt:yt.x,Ge===1?Mt:yt.y)];_e.length>Ue+1?Oe.push({polygons:Pt,bounds:qt,depth:Ue+1}):ee(Pt,qt)}if(Ht.length){const qt=[new Pe(Ge===0?Mt:et.x,Ge===1?Mt:et.y),yt];_e.length>Ue+1?Oe.push({polygons:Ht,bounds:qt,depth:Ue+1}):ee(Ht,qt)}}return Z})(a,e,Math.ceil((g-u)/11.25),Math.ceil((_-w)/11.25),1,((A,z,O)=>{if(A===0)return .5*(z+O);{const F=Y((n.y+z/Xt)/l);return(D(.5*(Y((n.y+O/Xt)/l)+F))*l-n.y)*Xt}}))}function Q(a,e,n,l,u,g){const _=Math.pow(2,l.z-u.z);for(let w=0;w<n;w++){let A=a.int16[2*(w+e)+0],z=a.int16[2*(w+e)+1];A=(A+u.x*Xt)*_-l.x*Xt,z=(z+u.y*Xt)*_-l.y*Xt,g.push(new Pe(A,z))}}let we,$e;yi(xp,"FillExtrusionBucket",{omit:["layers","features"]}),yi(Xy,"PartData"),yi(Eg,"FootprintSegment"),yi(Ox,"BorderCentroidData"),yi(hm,"GroundEffect");class ct extends Pe{constructor(e,n,l){super(e,n),this.z=l}}class Jt extends ct{constructor(e,n,l,u){super(e,n,l),this.w=u}}function vi(a,e,n,l){const u=n==="x"?"y":"x",g=(l-a[n])/(e[n]-a[n]);a[u]=Math.round(a[u]+(e[u]-a[u])*g),a[n]=l,a.hasOwnProperty("z")&&(a.z=$i(a.z,e.z,g)),a.hasOwnProperty("w")&&(a.w=$i(a.w,e.w,g))}function Ai(a,e,n,l){const u=n,g=l;for(const _ of["x","y"]){let w=a,A=e;w[_]>=A[_]&&(w=e,A=a),w[_]<u&&A[_]>u&&vi(w,A,_,u),w[_]<g&&A[_]>g&&vi(A,w,_,g)}}function ii(a,e,n,l,u,g){const _=[];for(let w=0;w<a.length;w++){const A=a[w];let z;const O=_.length;let F=0;for(let U=0;U<A.length-1;U++){let q=A[U],Z=A[U+1],ee=0;const le=F;let oe,fe;g&&(ee=Math.hypot(Z.x-q.x,Z.y-q.y),F+=ee,oe=q,fe=Z),q.x<e&&Z.x<e||(q.x<e?q=new Pe(e,q.y+(e-q.x)/(Z.x-q.x)*(Z.y-q.y))._round():Z.x<e&&(Z=new Pe(e,q.y+(e-q.x)/(Z.x-q.x)*(Z.y-q.y))._round()),q.y<n&&Z.y<n||(q.y<n?q=new Pe(q.x+(n-q.y)/(Z.y-q.y)*(Z.x-q.x),n)._round():Z.y<n&&(Z=new Pe(q.x+(n-q.y)/(Z.y-q.y)*(Z.x-q.x),n)._round()),q.x>=l&&Z.x>=l||(q.x>=l?q=new Pe(l,q.y+(l-q.x)/(Z.x-q.x)*(Z.y-q.y))._round():Z.x>=l&&(Z=new Pe(l,q.y+(l-q.x)/(Z.x-q.x)*(Z.y-q.y))._round()),q.y>=u&&Z.y>=u||(q.y>=u?q=new Pe(q.x+(u-q.y)/(Z.y-q.y)*(Z.x-q.x),u)._round():Z.y>=u&&(Z=new Pe(q.x+(u-q.y)/(Z.y-q.y)*(Z.x-q.x),u)._round()),z&&q.equals(z[z.length-1])||(z=[q],_.push(z),g&&g.push({progress:{min:le+ga(oe,fe,q)*ee,max:1},parentIndex:w,prevPoint:oe,nextPoint:fe})),z.push(Z),g&&(g[g.length-1].progress.max=le+ga(oe,fe,Z)*ee,g[g.length-1].nextPoint=fe)))))}if(g&&F>0)for(let U=O;U<_.length;U++)g[U].progress.min/=F,g[U].progress.max/=F}return _}function ri(a,e,n,l,u){if(a.length<2)return void l.push(a);const g=[];for(;e.valid();){const[z,O]=e.get();for(let F=0;F<a.length-1;F++){const U=a[F],q=a[F+1],Z=gn(U,q,z,O);if(Z){const[ee]=Z,le=new Pe($i(U.x,q.x,ee),$i(U.y,q.y,ee));g.push({t:F+ee,distance:0,point:le})}}e.next()}if(g.length===0)return void l.push(a);g.sort(((z,O)=>z.t-O.t));let _=0,w=0,A=[];for(l.push(A);_!==a.length;){if(w===g.length){for(;_!==a.length;)A.length!==0&&A[A.length-1].equals(a[_])||A.push(a[_]),_++;break}g[w].t<=_?(A.length!==0&&A[A.length-1].equals(g[w].point)||A.push(g[w].point),Math.trunc(g[w].t),w++):(A.length!==0&&A[A.length-1].equals(a[_])||A.push(a[_]),_++)}}function ga(a,e,n){return a.x!==e.x?(n.x-a.x)/(e.x-a.x):a.y!==e.y?(n.y-a.y)/(e.y-a.y):0}function Kn(a,e){return a.x*e.x+a.y*e.y}function Dr(a,e){if(a.length===1){let n=0;const l=e[n++];let u;for(;!u||l.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const g=e[n],_=a[0],w=u.sub(l),A=g.sub(l),z=_.sub(l),O=Kn(w,w),F=Kn(w,A),U=Kn(A,A),q=Kn(z,w),Z=Kn(z,A),ee=O*U-F*F,le=(U*q-F*Z)/ee,oe=(O*Z-F*q)/ee,fe=l.z*(1-le-oe)+u.z*le+g.z*oe;if(isFinite(fe))return fe}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}function Lt(a,e,n){let l=1/0;ta(n,e)&&(l=Dr(n,e[0]));for(let u=0;u<e.length;u++){const g=e[u],_=a[u];for(let w=0;w<g.length-1;w++){const A=g[w],z=[A,g[w+1],_[w+1],_[w],A];Rn(n,z)&&(l=Math.min(l,Dr(n,z)))}}return l!==1/0&&l}function kt(a,e,n,l,u,g,_,w,A,z,O){return a.projection.name==="globe"?(function(F,U,q,Z,ee,le,oe,fe,_e,be,Oe){const Ie=[],Ue=[],Ge=F.projection.upVectorScale(Oe,F.center.lat,F.worldSize).metersToTile,et=[0,0,0,1],yt=[0,0,0,1],nt=(Mt,Pt,Ht,qt)=>{Mt[0]=Pt,Mt[1]=Ht,Mt[2]=qt,Mt[3]=1},bt=R();q>0&&(q+=bt),Z+=bt;for(const Mt of U){const Pt=[],Ht=[];for(const qt of Mt){const Ut=qt.x+ee.x,$t=qt.y+ee.y,xt=F.projection.projectTilePoint(Ut,$t,Oe),vt=F.projection.upVector(Oe,qt.x,qt.y);let Vt=q,ai=Z;if(oe){const Yt=Zt(Ut,$t,q,Z,oe,fe,_e,be);Vt+=Yt.base,ai+=Yt.top}q!==0?nt(et,xt.x+vt[0]*Ge*Vt,xt.y+vt[1]*Ge*Vt,xt.z+vt[2]*Ge*Vt):nt(et,xt.x,xt.y,xt.z),nt(yt,xt.x+vt[0]*Ge*ai,xt.y+vt[1]*Ge*ai,xt.z+vt[2]*Ge*ai),Fi(et,et,le),Fi(yt,yt,le),Pt.push(new ct(et[0],et[1],et[2])),Ht.push(new ct(yt[0],yt[1],yt[2]))}Ie.push(Pt),Ue.push(Ht)}return[Ie,Ue]})(a,e,n,l,u,g,_,w,A,z,O):_?(function(F,U,q,Z,ee,le,oe,fe,_e){const be=[],Oe=[],Ie=[0,0,0,1];for(const Ue of F){const Ge=[],et=[];for(const yt of Ue){const nt=yt.x+Z.x,bt=yt.y+Z.y,Mt=Zt(nt,bt,U,q,le,oe,fe,_e);Ie[0]=nt,Ie[1]=bt,Ie[2]=Mt.base,Ie[3]=1,Vr(Ie,Ie,ee),Ie[3]=Math.max(Ie[3],1e-5);const Pt=new ct(Ie[0]/Ie[3],Ie[1]/Ie[3],Ie[2]/Ie[3]);Ie[0]=nt,Ie[1]=bt,Ie[2]=Mt.top,Ie[3]=1,Vr(Ie,Ie,ee),Ie[3]=Math.max(Ie[3],1e-5);const Ht=new ct(Ie[0]/Ie[3],Ie[1]/Ie[3],Ie[2]/Ie[3]);Ge.push(Pt),et.push(Ht)}be.push(Ge),Oe.push(et)}return[be,Oe]})(e,n,l,u,g,_,w,A,z):(function(F,U,q,Z,ee){const le=[],oe=[],fe=ee[8]*U,_e=ee[9]*U,be=ee[10]*U,Oe=ee[11]*U,Ie=ee[8]*q,Ue=ee[9]*q,Ge=ee[10]*q,et=ee[11]*q;for(const yt of F){const nt=[],bt=[];for(const Mt of yt){const Pt=Mt.x+Z.x,Ht=Mt.y+Z.y,qt=ee[0]*Pt+ee[4]*Ht+ee[12],Ut=ee[1]*Pt+ee[5]*Ht+ee[13],$t=ee[2]*Pt+ee[6]*Ht+ee[14],xt=ee[3]*Pt+ee[7]*Ht+ee[15],vt=qt+fe,Vt=Ut+_e,ai=$t+be,Yt=Math.max(xt+Oe,1e-5),Di=qt+Ie,pi=Ut+Ue,xi=$t+Ge,Mi=Math.max(xt+et,1e-5);nt.push(new ct(vt/Yt,Vt/Yt,ai/Yt)),bt.push(new ct(Di/Mi,pi/Mi,xi/Mi))}le.push(nt),oe.push(bt)}return[le,oe]})(e,n,l,u,g)}function Zt(a,e,n,l,u,g,_,w){const A=_*u.getElevationAt(a,e,!0,!0),z=g[0]!==0,O=z?g[1]===0?_*(g[0]/uh-Lx):_*(function(F,U,q){const Z=Math.floor(U[0]/8),ee=Math.floor(U[1]/8),le=10*(U[0]-8*Z),oe=10*(U[1]-8*ee),fe=F.getElevationAt(Z,ee,!0,!0),_e=F.getMeterToDEM(q),be=Math.floor(.5*(le*_e-1)),Oe=Math.floor(.5*(oe*_e-1)),Ie=F.tileCoordToPixel(Z,ee),Ue=2*be+1,Ge=2*Oe+1,et=(function(Ht,qt,Ut,$t,xt){return[Ht.getElevationAtPixel(qt,Ut,!0),Ht.getElevationAtPixel(qt+xt,Ut,!0),Ht.getElevationAtPixel(qt,Ut+xt,!0),Ht.getElevationAtPixel(qt+$t,Ut+xt,!0)]})(F,Ie.x-be,Ie.y-Oe,Ue,Ge),yt=Math.abs(et[0]-et[1]),nt=Math.abs(et[2]-et[3]),bt=Math.abs(et[0]-et[2])+Math.abs(et[1]-et[3]),Mt=Math.min(.25,.5*_e*(yt+nt)/Ue),Pt=Math.min(.25,.5*_e*bt/Ge);return fe+Math.max(Mt*le,Pt*oe)})(u,g,w):A;return{base:A+(n===0?-1:n),top:z?Math.max(O+l,A+n+2):A+l}}class ki{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class jn{constructor(){this.tasks={},this.taskQueue=[],Je(["process"],this),this.invoker=new ki(this.process),this.nextId=0}add(e,n){const l=this.nextId++,u=(function({type:g,isSymbolTile:_,zoom:w}){return w=w||0,g==="message"?0:g!=="maybePrepare"||_?g!=="parseTile"||_?g==="parseTile"&&_?300-w:g==="maybePrepare"&&_?400-w:500:200-w:100-w})(n);if(u===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:n,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((l=>!!this.tasks[l])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const g=this.tasks[this.taskQueue[u]];g.priority<n&&(n=g.priority,e=u)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class Xa{constructor(e,n,l){this.target=e,this.parent=n,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Je(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new jn}send(e,n,l,u,g=!1,_){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=_,this.callbacks[w]=l);const A=new Set;return this.target.postMessage({id:w,type:e,hasCallback:!!l,targetMapId:u,mustQueue:g,sourceMapId:this.mapId,data:Ec(n,A)},A),{cancel:()=>{l&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const n=e.data;if(!n)return;const l=n.id;if(l&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(n.mustQueue||Ui(self)){const u=this.callbacks[l],g=this.scheduler.add((()=>this.processTask(l,n)),u&&u.metadata||{type:"message"});g&&(this.cancelCallbacks[l]=g)}else this.processTask(l,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(n.error?l(Uo(n.error)):l(null,Uo(n.data)))}else{const l=new Set,u=n.hasCallback?(_,w)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:_?Ec(_):null,data:Ec(w,l)},l)}:()=>{},g=Uo(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,g,u);else if(this.parent.getWorkerSource){const _=n.type.split("."),{source:w,scope:A}=g;this.parent.getWorkerSource(n.sourceMapId,_[0],w,A)[_[1]](g,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Ln={workerUrl:"",workerClass:null,workerParams:void 0};const aa="mapboxgl_preloaded_worker_pool";class gs{constructor(e){this.active={},this.name=e}acquire(e,n=gs.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;){const u=(l=`${this.name||""}WorkerPool: ${e}-${this.workers.length}`,Ln.workerClass!=null?new Ln.workerClass:new self.Worker(Ln.workerUrl,Object.assign({name:l},Ln.workerParams)));this.workers.push(u)}var l;return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((n=>{n.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[aa]}numActive(){return Object.keys(this.active).length}}gs.workerCount=2;class sr{constructor(e,n,l="Worker",u=gs.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=qe();const g=this.workerPool.acquire(this.id,u);for(let _=0;_<g.length;_++){const w=new sr.Actor(g[_],n,this.id);w.name=`${l} ${_}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,n,l){Fe(this.actors,((u,g)=>{u.send(e,n,g)}),l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let pu,Yy;function Ux(){return pu||(pu=new gs),pu}sr.Actor=Xa;const Wb=4096;class JP{constructor(e){this.module=e,this.memoryStack=this.module.malloc(Wb),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>Wb?-1:(new Int32Array(this.module.heap32.buffer,n,e.length).set(e),n)}createFloatArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>Wb?-1:(new Float32Array(this.module.heapF32.buffer,n,e.length).set(e),n)}readStringBuffer(e){let n="";for(;this.module.heapU8[e]!==0;)n+=String.fromCharCode(this.module.heapU8[e]),++e;return n}setStyle(e){const n=e.normalScale;this.module.setStyle(n[0],n[1],n[2],e.tileToMeters)}setAOOptions(e,n){this.module.setAOOptions(e?1:0,n)}setMetricOptions(e,n){this.module.setMetricOptions(e?1:0,n)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,n){this.module.setFacadeOptions(e,n?1:0)}setFauxFacadeOptions(e,n,l){this.module.setFauxFacadeOptions(e?1:0,n?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,n){this.memoryStackNextFree=this.memoryStack;for(const w of e){const A=this.createIntArray(w.ringIndices),z=this.createFloatArray(w.coordinates);if(A===-1||z===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(w.id,w.sourceId,w.minHeight,w.height,w.roofType,z,A,w.ringIndices.length-1)}for(const w of n){let A;A=w.entrances?JSON.parse(w.entrances):[];const z=this.createFloatArray(A),O=this.createFloatArray(w.coordinates);if(z===-1||O===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(w.sourceId,w.crossPerc,w.distanceToRoad,z,A.length,O,w.coordinates.length)}if(!this.module.generateMesh()){const w=this.module.getLastError();return this.readStringBuffer(w)}const l=this.module.getMeshCount(),u=new Array(l);for(let w=0;w<l;w++){const A=this.module.getPositionsPtr(w),z=this.module.getPositionsLength(w),O=new Float32Array(this.module.heapF32.buffer,A,z),F=this.module.getNormalsPtr(w),U=this.module.getNormalsLength(w),q=new Float32Array(this.module.heapF32.buffer,F,U),Z=this.module.getAOPtr(w),ee=this.module.getAOLength(w),le=new Float32Array(this.module.heapF32.buffer,Z,ee),oe=this.module.getUVPtr(w),fe=this.module.getUVLength(w),_e=new Float32Array(this.module.heapF32.buffer,oe,fe),be=this.module.getFauxFacadePtr(w),Oe=this.module.getFauxFacadeLength(w),Ie=new Uint8Array(this.module.heapU8.buffer,be,Oe),Ue=this.module.getIndicesPtr(w),Ge=this.module.getIndicesLength(w),et=new Int16Array(this.module.heap16.buffer,Ue,Ge),yt=this.module.getBuildingPart(w);u[w]={positions:O,normals:q,ao:le,uv:_e,isFauxFacade:Ie,indices:et,buildingPart:yt}}const g=this.module.getRingCount(),_=[];for(let w=0;w<g;w++){const A=this.module.getRingPtr(w),z=this.module.getRingLength(w),O=new Float32Array(this.module.heapF32.buffer,A,z);_.push(O)}return{meshes:u,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let Ky,Zb,hh,M_,Xb,P_=null,j_=null,VS=null,$x=null;function HS(){return Ui(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Zb||Sn.DRACO_URL}function GS(){if(Ui(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(M_)return M_;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return M_=WebAssembly.validate(a)?Sn.MESHOPT_SIMD_URL:Sn.MESHOPT_URL,M_}function QP(){return $x}const Vx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ej={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Jy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function qS(a,e,n){const l=n.json.bufferViews.length,u=n.buffers.length;e.bufferView=l,n.json.bufferViews[l]={buffer:u,byteLength:a.byteLength},n.buffers[u]=a}const Yb="KHR_draco_mesh_compression";function tj(a,e){const n=a.extensions&&a.extensions[Yb];if(!n)return;const l=new hh.Decoder,u=YS(e,n.bufferView),g=new hh.Mesh;if(!l.DecodeArrayToMesh(u,u.byteLength,g))throw new Error("Failed to decode Draco mesh");const _=e.json.accessors[a.indices],w=Vx[_.componentType],A=_.count*w.BYTES_PER_ELEMENT,z=hh._malloc(A);w===Uint16Array?l.GetTrianglesUInt16Array(g,A,z):l.GetTrianglesUInt32Array(g,A,z),qS(hh.memory.buffer.slice(z,z+A),_,e),hh._free(z);for(const O of Object.keys(n.attributes)){const F=l.GetAttributeByUniqueId(g,n.attributes[O]),U=e.json.accessors[a.attributes[O]],q=ej[U.componentType],Z=U.count*Jy[U.type]*Vx[U.componentType].BYTES_PER_ELEMENT,ee=hh._malloc(Z);l.GetAttributeDataArrayForAllPoints(g,F,hh[q],Z,ee),qS(hh.memory.buffer.slice(ee,ee+Z),U,e),hh._free(ee)}l.destroy(),g.destroy(),delete a.extensions[Yb]}const Hx="EXT_meshopt_compression";function ij(a,e){if(!a.extensions||!a.extensions[Hx])return;const n=a.extensions[Hx],l=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),u=new Uint8Array(n.count*n.byteStride);Xb.decodeGltfBuffer(u,n.count,n.byteStride,l,n.mode,n.filter),a.buffer=e.buffers.length,a.byteOffset=0,e.buffers[a.buffer]=u.buffer,delete a.extensions[Hx]}const WS=1179937895,ZS=new TextDecoder("utf8");function XS(a,e){return new URL(a,e).href}function nj(a,e,n,l){return fetch(XS(a.uri,l)).then((u=>u.arrayBuffer())).then((u=>{e.buffers[n]=u}))}function YS(a,e){const n=a.json.bufferViews[e];return new Uint8Array(a.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function aj(a,e,n,l){if(a.uri){const u=XS(a.uri,l);return fetch(u).then((g=>g.blob())).then((g=>createImageBitmap(g))).then((g=>{e.images[n]=g}))}if(a.bufferView!==void 0){const u=YS(e,a.bufferView),g=new Blob([u],{type:a.mimeType});return createImageBitmap(g).then((_=>{e.images[n]=_}))}}function KS(a,e=0,n){const l={json:null,images:[],buffers:[]};if(new Uint32Array(a,e,1)[0]===WS){const O=new Uint32Array(a,e);let F=2;const U=(O[F++]>>2)-3,q=O[F++]>>2;if(F++,l.json=JSON.parse(ZS.decode(O.subarray(F,F+q))),F+=q,F<U){const Z=O[F++];F++;const ee=e+(F<<2);l.buffers[0]=a.slice(ee,ee+Z)}}else l.json=JSON.parse(ZS.decode(new Uint8Array(a,e)));const{buffers:u,images:g,meshes:_,extensionsUsed:w,bufferViews:A}=l.json;let z=Promise.resolve();if(u){const O=[];for(let F=0;F<u.length;F++){const U=u[F];U.uri?O.push(nj(U,l,F,n)):l.buffers[F]||(l.buffers[F]=null)}z=Promise.all(O)}return z.then((()=>{const O=[],F=w&&w.includes(Yb),U=w&&w.includes(Hx);if(F&&O.push((function(){if(!hh)return Ky??(Ky=(function(q){let Z,ee=null;function le(){Z=new Uint8Array(ee.buffer)}function oe(){throw new Error("Unexpected Draco error.")}const fe={a:{a:oe,d:function(_e,be,Oe){return Z.copyWithin(_e,be,be+Oe)},c:function(_e){const be=Z.length,Oe=Math.max(_e>>>0,Math.ceil(1.2*be)),Ie=Math.ceil((Oe-be)/65536);try{return ee.grow(Ie),le(),!0}catch{return!1}},b:oe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(q,fe):q.then((_e=>_e.arrayBuffer())).then((_e=>WebAssembly.instantiate(_e,fe)))).then((_e=>{const{Rb:be,Qb:Oe,P:Ie,T:Ue,X:Ge,Ja:et,La:yt,Qa:nt,Va:bt,Wa:Mt,eb:Pt,jb:Ht,f:qt,e:Ut,yb:$t,zb:xt,Ab:vt,Bb:Vt,Db:ai,Gb:Yt}=_e.instance.exports;ee=Ut;const Di=(()=>{let pi=0,xi=0,Mi=0,An=0;return ei=>{Mi&&(be(An),be(pi),xi+=Mi,Mi=pi=0),pi||(xi+=128,pi=Oe(xi));const zi=ei.length+7&-8;let un=pi;zi>=xi&&(Mi=zi,un=An=Oe(zi));for(let Hn=0;Hn<ei.length;Hn++)Z[un+Hn]=ei[Hn];return un}})();return le(),qt(),{memory:Ut,_free:be,_malloc:Oe,Mesh:class{constructor(){this.ptr=Ie()}destroy(){Ue(this.ptr)}},Decoder:class{constructor(){this.ptr=et()}destroy(){Ht(this.ptr)}DecodeArrayToMesh(pi,xi,Mi){const An=Di(pi),ei=yt(this.ptr,An,xi,Mi.ptr);return!!Ge(ei)}GetAttributeByUniqueId(pi,xi){return{ptr:nt(this.ptr,pi.ptr,xi)}}GetTrianglesUInt16Array(pi,xi,Mi){bt(this.ptr,pi.ptr,xi,Mi)}GetTrianglesUInt32Array(pi,xi,Mi){Mt(this.ptr,pi.ptr,xi,Mi)}GetAttributeDataArrayForAllPoints(pi,xi,Mi,An,ei){Pt(this.ptr,pi.ptr,xi.ptr,Mi,An,ei)}},DT_INT8:$t(),DT_UINT8:xt(),DT_INT16:vt(),DT_UINT16:Vt(),DT_UINT32:ai(),DT_FLOAT32:Yt()}}))})(fetch(HS())),Ky.then((q=>{hh=q,Ky=void 0})))})()),U&&O.push((function(){if(Xb)return;const q=(function(Z){let ee;const le=WebAssembly.instantiateStreaming(Z,{}).then((_e=>{ee=_e.instance,ee.exports.__wasm_call_ctors()})),oe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},fe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:le,supported:!0,decodeGltfBuffer(_e,be,Oe,Ie,Ue,Ge){(function(et,yt,nt,bt,Mt,Pt,Ht){const qt=et.exports.sbrk,Ut=bt+3&-4,$t=qt(Ut*Mt),xt=qt(Pt.length),vt=new Uint8Array(et.exports.memory.buffer);vt.set(Pt,xt);const Vt=yt($t,bt,Mt,xt,Pt.length);if(Vt===0&&Ht&&Ht($t,Ut,Mt),nt.set(vt.subarray($t,$t+bt*Mt)),qt($t-qt(0)),Vt!==0)throw new Error(`Malformed buffer data: ${Vt}`)})(ee,ee.exports[fe[Ue]],_e,be,Oe,Ie,ee.exports[oe[Ge]])}}})(fetch(GS()));return q.ready.then((()=>{Xb=q}))})()),g)for(let q=0;q<g.length;q++)O.push(aj(g[q],l,q,n));return(O.length?Promise.all(O):Promise.resolve()).then((()=>{if(F&&_)for(const{primitives:q}of _)for(const Z of q)tj(Z,l);if(U&&_&&A)for(const q of A)ij(q,l);return l}))}))}function JS(a){return fetch(a).then((e=>e.arrayBuffer())).then((e=>KS(e,0,a)))}function Kb(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Jb(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Qb{constructor(e,n,l,u){this.context=e,this.format=l,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:u&&u.premultiply})}update(e,n){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:g}=this,{gl:_}=g,{x:w,y:A}=n&&n.position?n.position:{x:0,y:0},z=w+l,O=A+u;!this.size||this.size[0]===z&&this.size[1]===O||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!n||n.premultiply!==!1));const F=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&z>0&&O>0){const U=this.useMipmap?Math.floor(Math.log2(Math.max(z,O)))+1:1;_.texStorage2D(_.TEXTURE_2D,U,this.format,z,O),this.size=[z,O]}this.size&&(F?_.texSubImage2D(_.TEXTURE_2D,0,w,A,Kb(this.format),Jb(this.format),e):"data"in e&&e.data&&_.texSubImage2D(_.TEXTURE_2D,0,w,A,l,u,Kb(this.format),Jb(this.format),e.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n,l=!1){const{context:u}=this,{gl:g}=u;g.bindTexture(g.TEXTURE_2D,this.texture),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,l,u,g){const{context:_}=this,{gl:w}=_;w.bindTexture(w.TEXTURE_2D,this.texture),n!==this.magFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,this.useMipmap?e===w.NEAREST?w.NEAREST_MIPMAP_NEAREST:w.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,l),this.wrapS=l),u!==this.wrapT&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,u),this.wrapT=u),g!==this.compareMode&&(g?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,g)):w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.NONE),this.compareMode=g)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Qy{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}}const rj=Mn([{name:"a_pos_3f",components:3,type:"Float32"}]),sj=Mn([{name:"a_color_3f",components:3,type:"Float32"}]),oj=Mn([{name:"a_color_4f",components:4,type:"Float32"}]),lj=Mn([{name:"a_uv_2f",components:2,type:"Float32"}]),cj=Mn([{name:"a_normal_3f",components:3,type:"Float32"}]),uj=Mn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),dj=Mn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function QS(a,e){const n=Gx(a.projection,a.zoom,a.width,a.height),l=(function(g,_,w,A,z){const O=new s(w.lng-180*wp,w.lat),F=new s(w.lng+180*wp,w.lat),U=g.project(O.lng,O.lat),q=g.project(F.lng,F.lat),Z=-Math.atan2(q.y-U.y,q.x-U.x),ee=pe.fromLngLat(w);ee.y=ie(ee.y,-1+wp,1-wp);const le=ee.toLngLat(),oe=g.project(le.lng,le.lat),fe=pe.fromLngLat(le);fe.x+=wp;const _e=fe.toLngLat(),be=g.project(_e.lng,_e.lat),Oe=t2(be.x-oe.x,be.y-oe.y,Z),Ie=pe.fromLngLat(le);Ie.y+=wp;const Ue=Ie.toLngLat(),Ge=g.project(Ue.lng,Ue.lat),et=t2(Ge.x-oe.x,Ge.y-oe.y,Z),yt=Math.abs(Oe.x)/Math.abs(et.y),nt=ce([]);tt(nt,nt,-Z*(1-(z?0:A)));const bt=ce([]);return Qe(bt,bt,[1,1-(1-yt)*A,1]),bt[4]=-et.x/et.y*A,tt(bt,bt,Z),Se(bt,nt,bt),bt})(a.projection,0,a.center,n,e),u=e2(a);return Qe(l,l,[u,u,1]),l}function e2(a){const e=a.projection,n=Gx(a.projection,a.zoom,a.width,a.height),l=ew(e,a.center),u=ew(e,s.convert(e.center));return Math.pow(2,l*n+(1-n)*u)}function Gx(a,e,n,l,u=1/0){const g=a.range;if(!g)return 0;const _=Math.min(u,Math.max(n,l)),w=Math.log2(_/1024);return ue(g[0]+w,g[1]+w,e)}const wp=1/4e4;function ew(a,e){const n=ie(e.lat,-J,J),l=new s(e.lng-180*wp,n),u=new s(e.lng+180*wp,n),g=a.project(l.lng,n),_=a.project(u.lng,n),w=pe.fromLngLat(l),A=pe.fromLngLat(u),z=_.x-g.x,O=_.y-g.y,F=A.x-w.x,U=A.y-w.y,q=Math.sqrt((F*F+U*U)/(z*z+O*O));return Math.log2(q)}function t2(a,e,n){const l=Math.cos(n),u=Math.sin(n);return{x:a*l-e*u,y:a*u+e*l}}function i2(a,e,n){ce(a),tt(a,a,ui(e[2])),He(a,a,ui(e[0])),ke(a,a,ui(e[1])),Qe(a,a,n),Se(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function qx(a,e,n,l,u,g,_,w){const A=[n[0]-e[0],n[1]-e[1],0],z=[l[0]-e[0],l[1]-e[1],0];if(Ri(A)<1e-12||Ri(z)<1e-12)return Kr(a);const O=Ja([],A,z);qn(O,O),Gi(z,l,e),A[2]=(g-u)*w,z[2]=(_-u)*w;const F=A;return Ja(F,A,z),qn(F,F),Yo(a,O,F)}function Wx(a,e,n=!1){const l=Md(e.zoom),u=(function(g,_,w){const A=_.worldSize,z=[g[12],g[13],g[14]],O=Y(z[1]/A),F=V(z[0]/A),U=ce([]),q=B(1,O)*A,Z=B(1,0)*A*ne(O,_.zoom),ee=1/d_(A);let le=Z*ee;if(w){const be=Gx(_.projection,_.zoom,_.width,_.height,1024);le=ee*_.projection.pixelSpaceConversion(_.center.lat,A,be)}const oe=Wl(O,F);jt(oe,oe,Ct([],qn([],oe),q*le*z[2]));const fe=(function(be){const Oe=[be[0],be[1],be[2]];let Ie=[0,1,0];const Ue=Ja([],Ie,Oe);return Ja(Ie,Oe,Ue),Ba(Ie)===0&&(Ie=[0,1,0],Ja(Ue,Oe,Ie)),qn(Ue,Ue),qn(Ie,Ie),qn(Oe,Oe),[Ue[0],Ue[1],Ue[2],0,Ie[0],Ie[1],Ie[2],0,Oe[0],Oe[1],Oe[2],0,be[0],be[1],be[2],1]})(oe);Qe(U,U,[le,le,le*q]),Ee(U,U,[-z[0],-z[1],-z[2]]);const _e=Se([],_.globeMatrix,fe);return Se(_e,_e,U),Se(_e,_e,g),_e})(a,e,n);if(l>0){const g=(function(_,w){const A=w.worldSize,z=B(1,0)*A*ne(w.center.lat,w.zoom)/d_(A),O=B(1,w.center.lat)*A,F=ce([]);ke(F,F,ui(w.center.lng)),He(F,F,ui(w.center.lat)),Ee(F,F,[0,0,eo]),Qe(F,F,[z,z,z*O]);const U=w.point;return Ee(F,F,[-U.x,-U.y,0]),Se(F,F,_),Se(F,w.globeMatrix,F)})(a,e);return(function(_,w,A){const z=(Z,ee,le)=>{const oe=Ri(Z),fe=Ri(ee),_e=ho(Z,ee,le);return Ct(_e,_e,1/Ri(_e)*$i(oe,fe,le))},O=z([_[0],_[1],_[2]],[w[0],w[1],w[2]],A),F=z([_[4],_[5],_[6]],[w[4],w[5],w[6]],A),U=z([_[8],_[9],_[10]],[w[8],w[9],w[10]],A),q=ho([_[12],_[13],_[14]],[w[12],w[13],w[14]],A);return[O[0],O[1],O[2],0,F[0],F[1],F[2],0,U[0],U[1],U[2],0,q[0],q[1],q[2],1]})(u,g,l)}return u}function tw(a,e,n,l){const u=wi.projectAabbCorners(l,n);let g=Number.MAX_VALUE;for(let w=0;w<u.length;++w){const A=u[w];A[0]=(.5*A[0]+.5)*e.width,A[1]=(.5-.5*A[1])*e.height,A[2]<g&&(g=A[2])}const _=(function(w){const A=[];let z=0;for(let q=1;q<w.length;q++)(w[q][0]<w[z][0]||w[q][0]===w[z][0]&&w[q][1]<w[z][1])&&(z=q);let O,F=z;const U=new Uint8Array(w.length);do{if(U[F])break;A.push(new Pe(w[F][0],w[F][1])),U[F]=1,O=(F+1)%w.length;for(let q=0;q<w.length;q++){if(w[q][0]===w[O][0]&&w[q][1]===w[O][1]||w[q][0]===w[F][0]&&w[q][1]===w[F][1])continue;const Z=[w[q][0]-w[F][0],w[q][1]-w[F][1]],ee=[w[O][0]-w[F][0],w[O][1]-w[F][1]],le=Z[0]*ee[1]-Z[1]*ee[0];(le>0||le===0&&Z[0]*ee[0]+Z[1]*ee[1]>=0&&Z[0]*Z[0]+Z[1]*Z[1]>ee[0]*ee[0]+ee[1]*ee[1])&&(O=q)}F=O}while(F!==z);return A.length>0&&A.push(A[0]),A})(u);if(Rn(a,_))return g}const Mg=64,z_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Zx(a,e,n,l,u,g,_,w,A,z=!1){const O=n.zoom,F=n.project(l),U=ne(l.lat,O),q=1/U;ce(a),Ee(a,a,[F.x+_[0]*q,F.y+_[1]*q,_[2]]);let Z=1,ee=1;const le=n.worldSize;if(z){if(n.projection.name==="mercator"){let be=0;n.elevation&&(be=n.elevation.getAtPointOrZero(new pe(F.x/le,F.y/le),0));const Oe=Vr([],[F.x,F.y,be,1],n.projMatrix)[3]/n.cameraToCenterDistance;Z=Oe,ee=Oe*ne(n.center.lat,O)}else if(n.projection.name==="globe"){const be=Wx(a,n),Oe=[0,0,0,1];Vr(Oe,Oe,Se([],n.projMatrix,be));const Ie=Oe[3]/n.cameraToCenterDistance,Ue=Md(O),Ge=n.projection.pixelsPerMeter(l.lat,le)*ne(l.lat,O),et=n.projection.pixelsPerMeter(n.center.lat,le)*ne(n.center.lat,O);Z=Ie/$i(Ge,se(n.center.lat),Ue),ee=Ie*U/Ge,Z*=et,ee*=et}}else Z=q;Qe(a,a,[Z,Z,ee]);const oe=[...a],fe=e.orientation,_e=[];if(i2(_e,[fe[0]+(u?u[0]:0),fe[1]+(u?u[1]:0),fe[2]+(u?u[2]:0)],g),Se(a,oe,_e),w&&n.elevation){let be=0;const Oe=[];if(A&&n.elevation){be=(function(Ue,Ge,et,yt,nt){const bt=Ge.elevation;if(!bt)return 0;const Mt=wi.projectAabbCorners(et,yt),Pt=B(1,nt.lat)*Ge.worldSize,Ht=(function(xi,Mi){const An=[0,0,1],ei=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const zi of ei){const un=xi[zi.corners[0]],Hn=xi[zi.corners[1]],Xn=xi[zi.corners[2]],yn=[Hn[0]-un[0],Hn[1]-un[1],Mi*(Hn[2]-un[2])],Pa=Ja(yn,yn,[Xn[0]-un[0],Xn[1]-un[1],Mi*(Xn[2]-un[2])]);qn(Pa,Pa),zi.dotProductWithUp=On(Pa,An)}return ei.sort(((zi,un)=>zi.dotProductWithUp-un.dotProductWithUp)),ei[0].corners})(Mt,Pt),qt=Mt[Ht[0]],Ut=Mt[Ht[1]],$t=Mt[Ht[2]],xt=Mt[Ht[3]],vt=bt.getAtPointOrZero(new pe(qt[0]/Ge.worldSize,qt[1]/Ge.worldSize),0),Vt=bt.getAtPointOrZero(new pe(Ut[0]/Ge.worldSize,Ut[1]/Ge.worldSize),0),ai=bt.getAtPointOrZero(new pe($t[0]/Ge.worldSize,$t[1]/Ge.worldSize),0),Yt=bt.getAtPointOrZero(new pe(xt[0]/Ge.worldSize,xt[1]/Ge.worldSize),0),Di=(vt+Yt)/2,pi=(Vt+ai)/2;return Di>pi?Vt<ai?qx(Ue,Ut,xt,qt,Vt,Yt,vt,Pt):qx(Ue,$t,qt,xt,ai,vt,Yt,Pt):vt<Yt?qx(Ue,qt,Ut,$t,vt,Vt,ai,Pt):qx(Ue,xt,$t,Ut,Yt,ai,Vt,Pt),Math.max(Di,pi)})(Oe,n,e.aabb,a,l);const Ie=Se([],gt([],Oe),_e);Se(a,oe,Ie)}else be=n.elevation.getAtPointOrZero(new pe(F.x/le,F.y/le),0);be!==0&&(a[14]+=be)}}class n2{constructor(e,n,l,u,g){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=n,this.position=l!=null?new s(l[0],l[1]):new s(0,0),this.orientation=u??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){Se(e.globalMatrix,n,e.localMatrix);const l=this.nodeOverrides.get(e.name);if(l!==void 0){const _=[];g=l.orientation,ce(u=_),ke(u,u,ui(g[1])),tt(u,u,ui(g[2])),He(u,u,ui(g[0])),Se(e.globalMatrix,e.globalMatrix,_)}var u,g;if(e.meshes)for(const _ of e.meshes){const w=wi.applyTransformFast(_.aabb,e.globalMatrix);this.aabb.encapsulate(w)}if(e.children)for(const _ of e.children)this._applyTransformations(_,e.globalMatrix)}computeBoundsAndApplyParent(){const e=ce([]);this.aabb=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.nodes)this._applyTransformations(n,e)}computeModelMatrix(e,n,l,u,g,_,w=!1){Zx(this.matrix,this,e.transform,this.position,n,l,u,g,_,w)}upload(e){if(!this.uploaded){for(const n of this.nodes)iw(n,e);for(const n of this.nodes)Xx(n);this.uploaded=!0}}destroy(){for(const e of this.nodes)nw(e)}}function ev(a,e,n=!1){a.uploaded||(a.gfxTexture=new Qb(e,a.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:a.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function hj(a,e,n){a.indexBuffer=e.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=e.createVertexBuffer(a.vertexArray,rj.members,!1,!0),a.normalArray&&(a.normalBuffer=e.createVertexBuffer(a.normalArray,cj.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=e.createVertexBuffer(a.texcoordArray,lj.members,!1,!0)),a.colorArray&&(a.colorBuffer=e.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?sj:oj).members,!1,!0)),a.featureArray&&(a.pbrBuffer=e.createVertexBuffer(a.featureArray,dj.members,!0)),a.segments=tr.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const l=a.material;l.pbrMetallicRoughness.baseColorTexture&&ev(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&ev(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&ev(l.normalTexture,e),l.occlusionTexture&&ev(l.occlusionTexture,e,n),l.emissionTexture&&ev(l.emissionTexture,e)}function iw(a,e,n){if(a.meshes)for(const l of a.meshes)hj(l,e,n);if(a.children)for(const l of a.children)iw(l,e,n)}function Xx(a){if(a.meshes)for(const e of a.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(a.children)for(const e of a.children)Xx(e)}function nw(a){if(a.meshes)for(const n of a.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(a.children)for(const n of a.children)nw(n)}function Pg(a,e){const n=a.json.bufferViews[e.bufferView],l=Vx[e.componentType];return new l(a.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Jy[e.type]*l.BYTES_PER_ELEMENT?n.byteStride/l.BYTES_PER_ELEMENT:Jy[e.type]))}function aw(a,e,n,l){const u=Vx[e.componentType],g=(function(O){switch(O){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(u),_=a.json.bufferViews[e.bufferView],w=_.byteStride?_.byteStride/u.BYTES_PER_ELEMENT:Jy[e.type],A=n.float32,z=A.length/n.capacity;for(let O=0,F=0;O<e.count*w;O+=w,F+=z)for(let U=0;U<z;U++)A[F+U]=l[O+U]*g;n._trim()}function fj(a,e,n){const l=a.indices,u=a.attributes,g={};g.indexArray=new Wr;const _=e.json.accessors[l],w=_.count/3;g.indexArray.reserve(w);const A=Pg(e,_);for(let U=0;U<w;U++)g.indexArray.emplaceBack(A[3*U],A[3*U+1],A[3*U+2]);g.indexArray._trim(),g.vertexArray=new Sl;const z=e.json.accessors[u.POSITION];g.vertexArray.reserve(z.count);const O=Pg(e,z);for(let U=0;U<z.count;U++)g.vertexArray.emplaceBack(O[3*U],O[3*U+1],O[3*U+2]);if(g.vertexArray._trim(),g.aabb=new wi(z.min,z.max),g.centroid=(function(U,q){const Z=[0,0,0],ee=U.length;if(ee>0){for(let le=0;le<ee;le++){const oe=3*U[le];Z[0]+=q[oe],Z[1]+=q[oe+1],Z[2]+=q[oe+2]}Z[0]/=ee,Z[1]/=ee,Z[2]/=ee}return Z})(A,O),u.COLOR_0!==void 0){const U=e.json.accessors[u.COLOR_0],q=Jy[U.type],Z=Pg(e,U);g.colorArray=q===3?new Sl:new uu,g.colorArray.resize(U.count),aw(e,U,g.colorArray,Z)}if(u.NORMAL!==void 0){g.normalArray=new Sl;const U=e.json.accessors[u.NORMAL];g.normalArray.resize(U.count);const q=Pg(e,U);aw(e,U,g.normalArray,q)}if(u.TEXCOORD_0!==void 0&&n.length>0){g.texcoordArray=new Rr;const U=e.json.accessors[u.TEXCOORD_0];g.texcoordArray.resize(U.count);const q=Pg(e,U);aw(e,U,g.texcoordArray,q)}if(u._FEATURE_ID_RGBA4444!==void 0){const U=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Pg(e,U))}u._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Pg(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const F=a.material;return g.material=(function(U,q){const{emissiveFactor:Z=[0,0,0],alphaMode:ee="OPAQUE",alphaCutoff:le=.5,normalTexture:oe,occlusionTexture:fe,emissiveTexture:_e,doubleSided:be,name:Oe}=U,{baseColorFactor:Ie=[1,1,1,1],metallicFactor:Ue=1,roughnessFactor:Ge=1,baseColorTexture:et,metallicRoughnessTexture:yt}=U.pbrMetallicRoughness||{},nt=fe?q[fe.index]:void 0;if(fe&&fe.extensions&&fe.extensions.KHR_texture_transform&&nt){const bt=fe.extensions.KHR_texture_transform;nt.offsetScale=[bt.offset[0],bt.offset[1],bt.scale[0],bt.scale[1]]}return{name:Oe,pbrMetallicRoughness:{baseColorFactor:new ha(...Ie),metallicFactor:Ue,roughnessFactor:Ge,baseColorTexture:et?q[et.index]:void 0,metallicRoughnessTexture:yt?q[yt.index]:void 0},doubleSided:be,emissiveFactor:new ha(...Z),alphaMode:ee,alphaCutoff:le,normalTexture:oe?q[oe.index]:void 0,occlusionTexture:nt,emissionTexture:_e?q[_e.index]:void 0,defined:U.defined===void 0}})(F!==void 0?e.json.materials[F]:{defined:!1},n),g}function a2(a,e,n){const{matrix:l,rotation:u,translation:g,scale:_,mesh:w,extras:A,children:z,name:O}=a,F={};if(F.name=O,F.localMatrix=l||(function(U,q,Z,ee){var le=q[0],oe=q[1],fe=q[2],_e=q[3],be=le+le,Oe=oe+oe,Ie=fe+fe,Ue=le*be,Ge=le*Oe,et=le*Ie,yt=oe*Oe,nt=oe*Ie,bt=fe*Ie,Mt=_e*be,Pt=_e*Oe,Ht=_e*Ie,qt=ee[0],Ut=ee[1],$t=ee[2];return U[0]=(1-(yt+bt))*qt,U[1]=(Ge+Ht)*qt,U[2]=(et-Pt)*qt,U[3]=0,U[4]=(Ge-Ht)*Ut,U[5]=(1-(Ue+bt))*Ut,U[6]=(nt+Mt)*Ut,U[7]=0,U[8]=(et+Pt)*$t,U[9]=(nt-Mt)*$t,U[10]=(1-(Ue+yt))*$t,U[11]=0,U[12]=Z[0],U[13]=Z[1],U[14]=Z[2],U[15]=1,U})([],u||[0,0,0,1],g||[0,0,0],_||[1,1,1]),F.globalMatrix=ae(F.localMatrix),w!==void 0){F.meshes=n[w];const U=F.anchor=[0,0];for(const q of F.meshes){const{min:Z,max:ee}=q.aabb;U[0]+=Z[0]+ee[0],U[1]+=Z[1]+ee[1]}U[0]=Math.floor(U[0]/F.meshes.length/2),U[1]=Math.floor(U[1]/F.meshes.length/2)}if(A&&(A.id&&(F.id=A.id),A.lights&&(F.lights=(function(U){if(!U.length)return[];const q=(function(fe){const _e=atob(fe),be=new Uint8Array(_e.length);for(let Oe=0;Oe<_e.length;Oe++)be[Oe]=_e.codePointAt(Oe);return be})(U),Z=[],ee=q.length/24,le=new Uint16Array(q.buffer),oe=new Float32Array(q.buffer);for(let fe=0;fe<ee;fe++){const _e=le[2*fe*6]/30,be=le[2*fe*6+1]/30,Oe=le[2*fe*6+10]/100,Ie=oe[6*fe+1],Ue=oe[6*fe+2],Ge=oe[6*fe+3],et=oe[6*fe+4],yt=Ge-Ie,nt=et-Ue,bt=Math.hypot(yt,nt);Z.push({pos:[Ie+.5*yt,Ue+.5*nt,be],normal:[nt/bt,-yt/bt,0],width:bt,height:_e,depth:Oe,points:[Ie,Ue,Ge,et]})}return Z})(A.lights)),A.MAPBOX_geometry_bloom&&(F.isGeometryBloom=A.MAPBOX_geometry_bloom)),z){const U=[];for(const q of z)U.push(a2(e.json.nodes[q],e,n));F.children=U}return F}function mj(a){if(a.vertices.length===0||a.indices.length===0)return null;const e=new Sg(a.vertices,a.indices,8,256),[n,l]=[e.min.clone(),e.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:e,min:n,max:l}}function pj(a){if(!a.extras||!a.extras.ground)return null;const e=a.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const l=[];for(const _ of n){if(!Array.isArray(_)||_.length!==2)continue;const w=_[0],A=_[1];typeof w=="number"&&typeof A=="number"&&l.push(new Pe(w,A))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let u=0;for(let _=0;_<l.length;_++){const w=l[_],A=l[(_+1)%l.length],z=l[(_+2)%l.length];u+=(w.x-A.x)*(z.y-A.y)-(z.x-A.x)*(w.y-A.y)}u>0&&l.reverse();const g=cm(l.flatMap((_=>[_.x,_.y])),[]);return g.length===0?null:{vertices:l,indices:g}}function gj(a,e){const n=[],l=[];let u=0;const g=[];for(const _ of a){u=n.length;const w=_.vertexArray.float32,A=_.indexArray.uint16;for(let z=0;z<_.vertexArray.length;z++)g[0]=w[3*z+0],g[1]=w[3*z+1],g[2]=w[3*z+2],Fi(g,g,e),n.push(new Pe(g[0],g[1]));for(let z=0;z<3*_.indexArray.length;z++)l.push(A[z]+u)}if(l.length%3!=0)return null;for(let _=0;_<l.length;_+=3){const w=n[l[_+0]],A=n[l[_+1]],z=n[l[_+2]];(w.x-A.x)*(z.y-A.y)-(z.x-A.x)*(w.y-A.y)>0&&([l[_+1],l[_+2]]=[l[_+2],l[_+1]])}return{vertices:n,indices:l}}function rw(a){const e=(function(A,z){const O=[],F=WebGL2RenderingContext;if(A.json.textures)for(const U of A.json.textures){const q={magFilter:F.LINEAR,minFilter:F.NEAREST,wrapS:F.REPEAT,wrapT:F.REPEAT};U.sampler!==void 0&&Object.assign(q,A.json.samplers[U.sampler]),O.push({image:z[U.source],sampler:q,uploaded:!1})}return O})(a,a.images),n=(function(A,z){const O=[];for(const F of A.json.meshes){const U=[];for(const q of F.primitives)U.push(fj(q,A,z));O.push(U)}return O})(a,e),{scenes:l,scene:u,nodes:g}=a.json,_=l?l[u||0].nodes:[...g.keys()],w=[];for(const A of _)w.push(a2(g[A],a,n));return(function(A,z,O){const F={},U=new Set;for(let q=0;q<A.length;q++){const Z=O[z[q]];if(!Z.extras)continue;const ee=Z.extras["mapbox:footprint:version"],le=Z.extras["mapbox:footprint:id"];(ee||le)&&U.add(q),ee==="1.0.0"&&le&&(F[le]=q)}for(let q=0;q<A.length;q++){if(U.has(q))continue;const Z=A[q],ee=O[z[q]];if(!ee.extras)continue;let le=null;Z.id in F&&(le=gj(A[F[Z.id]].meshes,Z.localMatrix)),le||(le=pj(ee)),le&&(Z.footprint=mj(le))}if(U.size>0){const q=Array.from(U.values()).sort(((Z,ee)=>Z-ee));for(let Z=q.length-1;Z>=0;Z--)A.splice(q[Z],1)}})(w,_,a.json.nodes),w}function _j(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const e=a.vertexArray.float32,n=a.aabb.min[0]-1,l=a.aabb.min[1]-1,u=Mg/(a.aabb.max[0]-n+2),g=Mg/(a.aabb.max[1]-l+2);for(let _=0;_<e.length;_+=3){const w=e[_+2],A=(e[_+0]-n)*u|0,z=(e[_+1]-l)*g|0;w>a.heightmap[z*Mg+A]&&(a.heightmap[z*Mg+A]=w)}}function r2(a,e,n,l,u){n.reserve(n.length+4*a.length),l.reserve(l.length+10*a.length),u.reserve(u.length+10*a.length);let g=l.length;for(const _ of a){const w=Math.min(10,Math.max(4,1.3*_.height))*e,A=[-_.normal[1],_.normal[0],0],z=Math.min(.29,.1*_.width/_.depth),O=_.width-2*_.depth*e*(z+.01),F=oi([],_.pos,A,O/2),U=oi([],_.pos,A,-O/2),q=[F[0],F[1],F[2]+_.height],Z=[U[0],U[1],U[2]+_.height],ee=oi([],_.normal,A,z);Ct(ee,ee,w);const le=oi([],_.normal,A,-z);Ct(le,le,w),jt(ee,F,ee),jt(le,U,le),F[2]+=.1,U[2]+=.1,l.emplaceBack(ee[0],ee[1],ee[2]),l.emplaceBack(le[0],le[1],le[2]),l.emplaceBack(F[0],F[1],F[2]),l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack(q[0],q[1],q[2]),l.emplaceBack(Z[0],Z[1],Z[2]),l.emplaceBack(F[0],F[1],F[2]),l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack(ee[0],ee[1],ee[2]),l.emplaceBack(le[0],le[1],le[2]);const oe=O/w/2;u.emplaceBack(-oe-z,-1,oe,.8),u.emplaceBack(oe+z,-1,oe,.8),u.emplaceBack(-oe,0,oe,1.3),u.emplaceBack(oe,0,oe,1.3),u.emplaceBack(oe+z,-.8,oe,.7),u.emplaceBack(oe+z,-.8,oe,.7),u.emplaceBack(0,0,oe,1.3),u.emplaceBack(0,0,oe,1.3),u.emplaceBack(oe+z,-1.2,oe,.8),u.emplaceBack(oe+z,-1.2,oe,.8),n.emplaceBack(6+g,4+g,8+g),n.emplaceBack(7+g,9+g,5+g),n.emplaceBack(0+g,1+g,2+g),n.emplaceBack(1+g,3+g,2+g),g+=10}}function yj(a,e){const n={};n.indexArray=new Wr,n.vertexArray=new Sl,n.colorArray=new uu,r2(a,e,n.indexArray,n.vertexArray,n.colorArray);const l={defined:!0};l.emissiveFactor=ha.black;const u={};return u.baseColorFactor=ha.white,l.pbrMetallicRoughness=u,n.material=l,n.aabb=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const s2=Mn([{name:"a_pos_3f",components:3,type:"Float32"}]),vj=Mn([{name:"a_normal_3",components:3,type:"Int16"}]),xj=Mn([{name:"a_centroid_3",components:3,type:"Int16"}]),o2=Mn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),bj=Mn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),wj=Mn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Sj=Mn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Tj=Mn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),kj=Mn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),l2=Ye.types,Yx=32767;function Ej(a,e){const n=Xt+e;for(const l of a)for(const u of l)if(u.x<-e||u.x>n||u.y<-e||u.y>n)return!1;return!0}function Aj(a){switch(a){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${a}`)}}class sw{constructor(){this.layoutVertexArray=new Sl,this.layoutAttenuationArray=new uu,this.layoutColorArray=new Tl,this.indexArray=new Wr,this.indexArrayForConflation=new Wr,this.segmentsBucket=new tr}}class ow{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new tr,this.entranceBloom=new sw;const n=66560;this.layoutVertexArray=new Sl,this.layoutVertexArray.reserve(n),this.layoutNormalArray=new th,this.layoutNormalArray.reserve(n),this.layoutCentroidArray=new th,this.layoutCentroidArray.reserve(n),this.layoutColorArray=new Tl,this.layoutColorArray.reserve(n),this.layoutFloodLightDataArray=new Fu,this.layoutFloodLightDataArray.reserve(n),this.layoutAOArray=new Qf,this.layoutAOArray.reserve(n),this.indexArray=new Wr,this.indexArray.reserve(66560),this.indexArrayForConflation=new Wr,this.segmentsBucket=new tr,this.entranceBloom=new sw,e&&(this.layoutFacadePaintArray=new Tl,this.layoutFacadeDataArray=new ol,this.layoutFacadeVerticalRangeArray=new Tl)}reserve(e,n,l){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(n),l&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class c2{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Rr,this.footprintsIndices=new Fu,this.footprintsMin=new Pe(1/0,1/0),this.footprintsMax=new Pe(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new ow(!1),this.buildingWithFacade=new ow(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new zc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.projection=e.projection,this.groundEffect=new hm(e),this.groundEffect.groundRadiusArray=new bl,this.hasAppearances=null}updateFootprints(e,n){const l=new Sg([],[],1),u={vertices:[],indices:new Uint32Array(0),grid:l,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};n.push({footprint:u,id:e})}updateAppearances(e,n,l,u){}prepare(){return(function(){if($x!=null||VS!=null)return null;if(j_!=null)return j_;const e=fetch(Sn.BUILDING_GEN_URL);return j_=(function(n){let l,u,g,_,w;function A(){l=new Uint8Array(w.buffer),u=new Int16Array(w.buffer),g=new Int32Array(w.buffer),_=new Float32Array(w.buffer)}function z(){throw new Error("Unexpected BuildingGen error.")}const O=()=>{},F={a:{a:z,f:function(U){const q=l.length,Z=Math.max(U>>>0,Math.ceil(1.2*q)),ee=Math.ceil((Z-q)/65536);try{return w.grow(ee),A(),!0}catch{return!1}},g:z,b:O,c:O,d:O,e:O}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,F):n.then((U=>U.arrayBuffer())).then((U=>WebAssembly.instantiate(U,F)))).then((U=>{const q=U.instance.exports;return(0,q.g)(),w=q.f,A(),new JP({setStyle:q.h,setAOOptions:q.i,setMetricOptions:q.j,setStructuralOptions:q.k,setFacadeOptions:q.l,setFauxFacadeOptions:q.m,setFacadeClassifierOptions:q.n,addFeature:q.o,addFacade:q.p,generateMesh:q.q,getLastError:q.r,getOuterRingLength:q.s,getMeshCount:q.t,getPositionsPtr:q.u,getPositionsLength:q.v,getNormalsPtr:q.w,getNormalsLength:q.x,getAOPtr:q.y,getAOLength:q.z,getUVPtr:q.A,getUVLength:q.B,getFauxFacadePtr:q.C,getFauxFacadeLength:q.D,getIndicesPtr:q.E,getIndicesLength:q.F,getBuildingPart:q.G,getRingCount:q.H,getRingPtr:q.I,getRingLength:q.J,malloc:q.K,free:q.L,heapU8:l,heap16:u,heap32:g,heapF32:_})}))})(e).then((n=>(j_=null,$x=n,$x))).catch((n=>{mi("Could not load building-gen"),j_=null,VS=n})),j_})()}populate(e,n,l,u){const g=QP();if(!g)return;const _=de(l);this.tileToMeter=_,this.brightness=n.brightness,g.setStyle({normalScale:[1,-1,_],tileToMeters:_}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const w=new Map,A=new Map;let z=0;for(const{feature:oe}of e){if(l2[oe.type]!=="LineString"){w.set(oe.id,oe.properties.source_id);continue}const fe=this.layers[0]._featureFilter.needGeometry;if(fe&&!this.layers[0]._featureFilter.filter(new Da(this.zoom),oe,l))continue;const _e=it(oe,fe);if(!fe&&!this.layers[0]._featureFilter.filter(new Da(this.zoom),_e,l))continue;const be=fe?_e.geometry:Ve(oe,l,u),Oe=[];for(const et of be)for(const yt of et)Oe.push(yt.x),Oe.push(yt.y);const Ie={coordinates:Oe,crossPerc:oe.properties.cross_perc,distanceToRoad:oe.properties.distance_to_road,entrances:oe.properties.entrances,sourceId:0},Ue=oe.properties.source_id;let Ge=A.get(Ue);Ge||(Ge=[],A.set(Ue,Ge)),Ge.push(Ie),++z}this.maxHeight=0;const O=new Array,F=new Set,U=oe=>{oe!=null&&F.add(oe)},q=(oe,fe)=>{oe!=null&&O.push({buildingId:oe,footprintIndex:fe})},Z=64*(e.length-z),ee=Z/2;this.buildingWithFacade.reserve(Z,ee,!0),this.buildingWithoutFacade.reserve(2*Z,2*ee,!1),this.footprintsIndices.reserve(16*(e.length-z)),this.footprintsVertices.reserve(8*(e.length-z));for(const{feature:oe,id:fe,index:_e,sourceLayerIndex:be}of e){if(l2[oe.type]==="LineString")continue;const Oe=this.layers[0]._featureFilter.needGeometry;if(Oe&&!this.layers[0]._featureFilter.filter(new Da(this.zoom),oe,l))continue;let Ie=null;if(oe.properties&&oe.properties.hasOwnProperty("building_id")&&(Ie=oe.properties.building_id,F.has(Ie)))continue;const Ue=it(oe,Oe);if(!Oe&&!this.layers[0]._featureFilter.filter(new Da(this.zoom),Ue,l))continue;const Ge=Oe?Ue.geometry:Ve(oe,l,u),et=bg(Ge,500);let yt=!1;for(const Yi of et)if(Yi.length!==1){yt=!0;break}if(yt){U(Ie);continue}if(!Ej(Ge,163)){U(Ie);continue}const nt=this.layers[0],bt=Aj(nt.layout.get("building-roof-shape").evaluate(oe,{},l)),Mt=nt.layout.get("building-base").evaluate(oe,{},l),Pt=nt.layout.get("building-height").evaluate(oe,{},l),Ht=nt.layout.get("building-flood-light-ground-radius").evaluate(oe,{},l),qt=nt.paint.get("building-ambient-occlusion-intensity"),Ut=Ht/this.tileToMeter;oe.properties["building-part"]="roof";const $t=nt.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),xt=nt.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);oe.properties["building-part"]="wall";const vt=nt.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),Vt=nt.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);oe.properties["building-part"]="window";const ai=nt.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),Yt=nt.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);oe.properties["building-part"]="door";const Di=nt.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),pi=nt.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);let xi=nt.layout.get("building-flood-light-wall-radius").evaluate(oe,{},l);xi=ie(xi,0,2048);const Mi=xi/2048*Yx,An=w.get(fe),ei=A.get(An)||[],zi=ei.length!==0&&nt.layout.get("building-facade").evaluate(oe,{},l);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(zi,!1,1);let un=0,Hn=0,Xn=0,yn=0,Pa=0,Re=0,Ne=0,wt=0,Gt=0,hi=0,fi=0;if(zi){let Yi=Math.round(nt.layout.get("building-facade-floors").evaluate(oe,{},l));if(Mt===0){Yi=Math.max(1,Yi-(ei.length>0?1:0));let wa=4;if(Pt>100){const cr=[10,13,15];wa=cr[oe.id?oe.id%cr.length:0]}else Pt<=10&&(wa=3);g.setFacadeOptions(wa,!0),Pa=(Pt<15?1.3:1.61803)*wa/_}else Pa=Mt/_;Re=Pt/_,Pa=Math.min(Pa,Re),Xn=nt.layout.get("building-facade-unit-width").evaluate(oe,{},l)/_,yn=(Re-Pa)/Yi,g.setFauxFacadeOptions(!0,!0,Xn);const _r=nt.layout.get("building-facade-window").evaluate(oe,{},l);un=_r[0],Hn=_r[1],Ne=Math.floor(65535*Math.min(1,Pa/Xt)),wt=Math.floor(65535*Math.min(1,Re/Xt)),Gt=Math.floor(255*un)<<8|Math.floor(255*Hn),hi=Math.floor(65535*Math.min(1,Xn/Xt)),fi=Math.floor(65535*Math.min(1,yn/Xt))}const Li=Array(et.length),Ni={x:1/0,y:1/0},_n={x:-1/0,y:-1/0},bn={x:0,y:0};let Tn=0;for(let Yi=0;Yi<et.length;Yi++){const _r=et[Yi];if(_r.length>0){const wa=[],cr=Array(_r.length+1);cr[0]=0;for(let _s=0;_s<_r.length;_s++){const Us=_r[_s];for(let ns=0;ns<Us.length;ns++){const as=Us[Us.length-ns-1];Ni.x=Math.min(Ni.x,as.x),Ni.y=Math.min(Ni.y,as.y),_n.x=Math.max(_n.x,as.x),_n.y=Math.max(_n.y,as.y),bn.x+=as.x,bn.y+=as.y,Tn++,wa.push(as.x),wa.push(as.y)}cr[_s+1]=wa.length}Li[Yi]={id:oe.id?oe.id:0,height:Pt,minHeight:Mt,sourceId:0,roofType:bt,coordinates:wa,ringIndices:cr}}}bn.x/=Tn||1,bn.y/=Tn||1;const Fn=g.generateMesh(Li,ei);if(typeof Fn=="string"){mi(`Unable to generate building ${oe.id}: ${Fn}`),U(Ie);continue}if(Fn.meshes.length===0||Fn.modifiedPolygonRings.length===0){U(Ie);continue}const Ji=zi?this.buildingWithFacade:this.buildingWithoutFacade;let on=0;for(const Yi of Fn.meshes)on+=Yi.positions.length/3;const ia=Ji.segmentsBucket.prepareSegment(on,Ji.layoutVertexArray,Ji.indexArray),ua=[];let da=null,ba=0,Na=-1;const ja=Ji.layoutVertexArray.length,fa=ja+on;Ji.layoutVertexArray.resize(fa),Ji.layoutCentroidArray.resize(fa),Ji.layoutNormalArray.resize(fa),Ji.layoutAOArray.resize(fa),Ji.layoutColorArray.resize(fa),Ji.layoutFloodLightDataArray.resize(fa),zi&&(Ji.layoutFacadePaintArray.resize(fa),Ji.layoutFacadeDataArray.resize(fa),Ji.layoutFacadeVerticalRangeArray.resize(fa));const va=Ji.indexArray.length;let wn=0,Zn=ja;for(const Yi of Fn.meshes){let _r,wa;if(Yi.buildingPart===1)_r=$t,wa=xt;else if(Yi.buildingPart===0)_r=vt,wa=Vt;else if(Yi.buildingPart===2)_r=ai,wa=Yt;else{if(Yi.buildingPart!==3)continue;_r=Di,wa=pi}if(wa=ie(wa,0,1),Yi.buildingPart===3){const Ga=new Array;for(let ys=0;ys<Yi.positions.length;ys+=12){const zd=Yi.positions[ys+0],ff=Yi.positions[ys+1],Mo=Yi.positions[ys+3],Pl=Yi.positions[ys+4],Bc=Yi.positions[ys+2],Ep=Yi.positions[ys+8]-Bc,G_=1,_h=Mo-zd,yh=Pl-ff,Tv=Math.hypot(_h,yh);Ga.push({pos:[zd+.5*_h,ff+.5*yh,Bc],normal:[yh/Tv,-_h/Tv,0],width:Tv,height:Ep,depth:G_,points:[zd,ff,Mo,Pl]})}const Pr=Ji.entranceBloom.segmentsBucket.prepareSegment(10*Ga.length,Ji.entranceBloom.layoutVertexArray,Ji.entranceBloom.indexArray),Or=Ji.entranceBloom.layoutVertexArray.length;ba=Ji.entranceBloom.indexArray.length,r2(Ga,.5/this.tileToMeter,Ji.entranceBloom.indexArray,Ji.entranceBloom.layoutVertexArray,Ji.entranceBloom.layoutAttenuationArray);const cc=Ji.entranceBloom.layoutVertexArray.length-Or;Na=Ji.entranceBloom.indexArray.length-ba;for(let ys=0;ys<cc;ys++)Ji.entranceBloom.layoutColorArray.emplaceBack(255*Di.r<<8|255*Di.g,255*Di.b<<8|51*pi);Pr.vertexLength+=cc,Pr.primitiveLength+=Na,da={part:Yi.buildingPart,vertexOffset:Or,vertexLength:cc}}Ji.layoutVertexArray.float32.set(Yi.positions,3*Zn);const cr=Yi.positions.length/3;for(let Ga=0;Ga<cr;++Ga){const Pr=3*Ga;wn=Math.max(wn,Yi.positions[Pr+2]);const Or=Yi.normals[Pr+1]*Yx,cc=Yi.normals[Pr+2]*Yx,ys=3*(Zn+Ga);Ji.layoutNormalArray.int16[ys]=Yi.normals[Pr]*Yx,Ji.layoutNormalArray.int16[ys+1]=Or,Ji.layoutNormalArray.int16[ys+2]=cc;const zd=Yi.ao[Ga];Ji.layoutAOArray.uint8[Zn+Ga]=255*zd;const ff=1+(zd-1)*qt,Mo=255*_r.b*ff<<8|255*wa;Ji.layoutColorArray.uint16[2*(Zn+Ga)]=255*_r.r*ff<<8|255*_r.g*ff,Ji.layoutColorArray.uint16[2*(Zn+Ga)+1]=Mo}const _s=Math.floor(bn.x),Us=Math.floor(bn.y),ns=Math.floor(Pt);for(let Ga=0;Ga<cr;++Ga){const Pr=3*(Zn+Ga);Ji.layoutCentroidArray.int16[Pr]=_s,Ji.layoutCentroidArray.int16[Pr+1]=Us,Ji.layoutCentroidArray.int16[Pr+2]=ns}if(Ji.layoutFloodLightDataArray.uint16.fill(Yi.buildingPart===0?Mi:0,Zn,Zn+cr),zi){const Ga=255*ai.r<<8|255*ai.g,Pr=255*ai.b<<8|255*Yt;for(let Or=0;Or<cr;++Or){const cc=2*(Zn+Or);Ji.layoutFacadePaintArray.uint16[cc]=Ga,Ji.layoutFacadePaintArray.uint16[cc+1]=Pr}for(let Or=0;Or<cr;++Or)if(Yi.isFauxFacade[Or]){const cc=Math.min(65535,Math.floor(Yi.uv[2*Or]*Fn.outerRingLength));Ji.layoutFacadeDataArray.emplace(Zn+Or,1|cc,Gt,hi,fi),Ji.layoutFacadeVerticalRangeArray.emplace(Zn+Or,Ne,wt)}else Ji.layoutFacadeDataArray.emplace(Zn+Or,0,0,0,0),Ji.layoutFacadeVerticalRangeArray.emplace(Zn+Or,0,0)}const as=ia.vertexLength,Cs=Yi.indices.length/3,Kl=Ji.indexArray.length;Ji.indexArray.resize(Kl+Cs);for(let Ga=0;Ga<Cs;++Ga){const Pr=3*Ga,Or=3*Kl+Pr;Ji.indexArray.uint16[Or]=as+Yi.indices[Pr],Ji.indexArray.uint16[Or+1]=as+Yi.indices[Pr+1],Ji.indexArray.uint16[Or+2]=as+Yi.indices[Pr+2]}Yi.buildingPart!==1&&Yi.buildingPart!==0&&Yi.buildingPart!==2&&Yi.buildingPart!==3||ua.push({part:Yi.buildingPart,vertexOffset:Zn,vertexLength:Yi.positions.length/3}),Zn+=cr,ia.vertexLength+=cr,ia.primitiveLength+=Yi.indices.length/3}this.maxHeight=Math.max(this.maxHeight,wn);const fr=Ji.indexArray.length-va,Xi=this.footprintsIndices.length,Bn=this.footprintsVertices.length,Ra=[],Ua=new Pe(1/0,1/0),Ya=new Pe(-1/0,-1/0),Lr=this.groundEffect.vertexArray.length;for(const Yi of Fn.modifiedPolygonRings){const _r=[],wa=new Pe(1/0,1/0),cr=new Pe(-1/0,-1/0);for(let _s=0;_s<Yi.length;_s+=2){const Us=Yi.length-_s-2;wa.x=Math.min(wa.x,Yi[Us]),wa.y=Math.min(wa.y,Yi[Us+1]),cr.x=Math.max(cr.x,Yi[Us]),cr.y=Math.max(cr.y,Yi[Us+1]);const ns=new Pe(Yi[Us],Yi[Us+1]);_r.push(ns),Ra.push(ns.x,ns.y),this.footprintsVertices.emplaceBack(ns.x,ns.y)}Ua.x=Math.min(Ua.x,wa.x),Ua.y=Math.min(Ua.y,wa.y),Ya.x=Math.max(Ya.x,cr.x),Ya.y=Math.max(Ya.y,cr.y),this.groundEffect.addData(_r,[wa,cr],Ut)}const Ha=this.groundEffect.vertexArray.length-Lr;this.groundEffect.groundRadiusArray.reserveForAdditional(Ha);for(let Yi=0;Yi<Ha;Yi++)this.groundEffect.groundRadiusArray.emplaceBack(Ht);(Ni.x<0||_n.x>Xt||Ni.y<0||_n.y>Xt)&&this.featuresOnBorder.push({featureId:oe.id,footprintIndex:this.footprints.length});{const Yi=cm(Ra,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Yi.length),this.footprintsIndices.uint16.set(Yi,Xi),this.buildingIds.add(Ie??oe.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Ua.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Ua.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Ya.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Ya.y);const _r={footprintVertexOffset:Bn,footprintVertexLength:this.footprintsVertices.length-Bn,footprintIndexOffset:Xi,footprintIndexLength:this.footprintsIndices.length-Xi,min:Ua,max:Ya,hiddenFlags:0,indicesOffset:va,indicesLength:fr,bloomIndicesOffset:ba,bloomIndicesLength:Na,groundEffectVertexOffset:Lr,groundEffectVertexLength:Ha,hasFauxFacade:zi,height:wn,promoteId:fe,feature:Ue,parts:ua,buildingBloom:da},wa=this.footprints.length;oe.id!==void 0&&this.featureFootprintLookup.set(oe.id,wa),q(Ie,wa),this.footprints.push(_r)}this.programConfigurations.populatePaintArrays(Ji.layoutVertexArray.length,oe,_e,{},n.availableImages,l,n.brightness),this.groundEffect.addPaintPropertiesData(oe,_e,{},n.availableImages,l,n.brightness),n.featureIndex.insert(oe,Ge,_e,be,this.index,ja)}O.forEach((({buildingId:oe,footprintIndex:fe})=>{F.has(oe)&&(this.footprints[fe].hiddenFlags|=4)}));const le=new Set;this.buildingIds.forEach(((oe,fe,_e)=>{F.has(oe)||le.add(oe)})),this.buildingIds=le,this.groundEffect.prepareBorderSegments()}update(e,n,l,u,g,_,w){this.programConfigurations.updatePaintArrays(e,n,g,l,u,_,w),this.groundEffect.update(e,n,g,l,u,_,w),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const n=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,s2.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,vj.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,xj.members),l.layoutFloodLightDataBuffer=e.createVertexBuffer(l.layoutFloodLightDataArray,kj.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,wj.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,Sj.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,s2.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,Tj.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=n=>{n.layoutVertexBuffer&&(n.layoutVertexBuffer.destroy(),n.layoutNormalBuffer.destroy(),n.layoutColorBuffer.destroy(),n.segmentsBucket.destroy(),n.indexBuffer&&n.indexBuffer.destroy(),n.entranceBloom.layoutVertexBuffer&&(n.entranceBloom.layoutVertexBuffer.destroy(),n.entranceBloom.layoutColorBuffer.destroy(),n.entranceBloom.layoutAttenuationBuffer.destroy(),n.entranceBloom.indexBuffer.destroy(),n.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,n,l=!0){let u=!1;const g=l?n:0,_=0|(l?-1:~n);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const w of e){const A=this.footprints[w],z=A.hiddenFlags&_|g;A.hiddenFlags!==z&&(A.hiddenFlags=z,u=!0,this.groundEffect.updateHiddenByLandmarkRange(A.groundEffectVertexOffset,A.groundEffectVertexLength,A.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const n=u=>{u.indexArray.length!==0&&(u.indexArrayForConflation.resize(u.indexArray.length),u.indexArrayForConflation.uint16.set(u.indexArray.uint16),u.entranceBloom.indexArrayForConflation.resize(u.entranceBloom.indexArray.length),u.entranceBloom.indexArrayForConflation.uint16.set(u.entranceBloom.indexArray.uint16))};n(this.buildingWithoutFacade),n(this.buildingWithFacade);for(const u of this.footprints){const g=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=u.indicesOffset+u.indicesLength;if(u.hiddenFlags!==0){for(let A=u.indicesOffset;A<_;A++)g.indexArrayForConflation.uint16[3*A+0]=0,g.indexArrayForConflation.uint16[3*A+1]=0,g.indexArrayForConflation.uint16[3*A+2]=0;const w=u.bloomIndicesOffset+u.bloomIndicesLength;for(let A=u.bloomIndicesOffset;A<w;A++)g.entranceBloom.indexArrayForConflation.uint16[3*A+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*A+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*A+2]=0}}const l=u=>{u.indexArray.length!==0&&(u.indexBuffer?u.indexBuffer.updateData(u.indexArrayForConflation):u.indexBuffer=e.createIndexBuffer(u.indexArrayForConflation,!0),u.entranceBloom.indexBuffer?u.entranceBloom.indexBuffer.updateData(u.entranceBloom.indexArrayForConflation):u.entranceBloom.indexBuffer=e.createIndexBuffer(u.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const n=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,o2.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,bj.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,o2.members,!0)};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,n){const l=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.footprints){if(4&u.hiddenFlags)continue;const g=n[u.promoteId],_=u.feature;_.properties["building-part"]="roof";const w=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),A=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="wall";const z=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),O=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="window";const F=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),U=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="door";const q=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),Z=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical),ee=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const oe of u.parts){let fe,_e=w;oe.part===1?(_e=w,fe=A):oe.part===0?(_e=z,fe=O):oe.part===2?(_e=F,fe=U):oe.part===3&&(_e=q,fe=Z),fe=ie(fe,0,1);for(let be=0;be<oe.vertexLength;be++){const Oe=oe.vertexOffset+be,Ie=1+(ee.layoutAOArray.uint8[Oe]/255-1)*l;ee.layoutColorArray.emplace(Oe,_e.r*Ie*255<<8|_e.g*Ie*255,_e.b*Ie*255<<8|255*fe),u.hasFauxFacade&&ee.layoutFacadePaintArray.emplace(Oe,255*F.r<<8|255*F.g,255*F.b<<8|255*U)}}const le=u.buildingBloom;if(le)for(let oe=0;oe<le.vertexLength;oe++)ee.entranceBloom.layoutColorArray.emplace(le.vertexOffset+oe,255*q.r<<8|255*q.g,255*q.b<<8|51*Z)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,n,l){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const u=n.getReplacementRegionsForTile(e.toUnwrapped());if(pp(this.activeReplacements,u))return;this.activeReplacements=u;for(const _ of this.footprints)_.hiddenFlags&=-2;const g=[];for(const _ of this.activeReplacements){if(_.order<=Rx)continue;const w=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));for(const A of this.footprints)A.min.x>_.max.x||A.max.x<_.min.x||A.min.y>_.max.y||A.max.y<_.min.y||(g.length=0,Mj(this.footprintsVertices,A.footprintVertexOffset,A.footprintVertexLength,_.footprintTileId.canonical,e.canonical,g),Wy(_.footprint,g,this.footprintsIndices.uint16,A.footprintIndexOffset,A.footprintIndexLength,0,-w)&&(A.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const n=this.featureFootprintLookup.get(e.id);return this.footprints[n]}return null}getHeightAtTileCoord(e,n){let l=Number.NEGATIVE_INFINITY,u=!0;const g=4*(e+Xt)*Xt+(n+Xt);if(this.footprintLookup.hasOwnProperty(g)){const w=this.footprintLookup[g];return w?{height:w.height,hidden:w.hiddenFlags!==0}:void 0}const _=new Pe(e,n);for(const w of this.footprints)e>w.max.x||w.min.x>e||n>w.max.y||w.min.y>n||w.height<=l||Cj(_,this.footprintsVertices.float32.subarray(2*w.footprintVertexOffset,2*(w.footprintVertexOffset+w.footprintVertexLength)),this.footprintsIndices.uint16.subarray(w.footprintIndexOffset,w.footprintIndexOffset+w.footprintIndexLength))&&(l=w.height,this.footprintLookup[g]=w,u=w.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.footprintLookup[g]=void 0}}function Cj(a,e,n){for(let l=0;l<n.length;l+=3){const u=n[l],g=n[l+1],_=n[l+2],w=e[2*u+0],A=e[2*u+1],z=e[2*g+0],O=e[2*g+1],F=e[2*_+0],U=e[2*_+1],q=(w-F)*(a.y-U)-(A-U)*(a.x-F),Z=(z-w)*(a.y-A)-(O-A)*(a.x-w);if(q<0!=Z<0&&q!==0&&Z!==0)continue;const ee=(F-z)*(a.y-O)-(U-O)*(a.x-z);if(ee===0||ee<0==q+Z<=0)return!0}return!1}function Mj(a,e,n,l,u,g){const _=Math.pow(2,l.z-u.z);for(let w=0;w<n;w++){let A=a.float32[2*(w+e)+0],z=a.float32[2*(w+e)+1];A=(A+u.x*Xt)*_-l.x*Xt,z=(z+u.y*Xt)*_-l.y*Xt,g.push(new Pe(A,z))}}let u2,d2;yi(c2,"BuildingBucket",{omit:["layers"]}),yi(ow,"BuildingGeometry"),yi(sw,"BuildingBloomGeometry");const Pj=Mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),jj=Mn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:zj}=Pj,Ij=Mn([{name:"a_packed",components:3,type:"Float32"}]),{members:Rj}=Ij,Dj=Mn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Lj}=Dj;class h2{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new hr({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const l=this.getKey(e,n);return this.positions[l]}trim(){const e=this.width,n=this.height=rt(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,l){const u=[];let g=e.length%2==1?-e[e.length-1]*l:0,_=e[0]*l,w=!0;u.push({left:g,right:_,isDash:w,zeroLength:e[0]===0});let A=e[0];for(let z=1;z<e.length;z++){w=!w;const O=e[z];g=A*l,A+=O,_=A*l,u.push({left:g,right:_,isDash:w,zeroLength:O===0})}return u}addRoundDash(e,n,l){const u=n/2;for(let g=-l;g<=l;g++){const _=this.width*(this.nextRow+l+g);let w=0,A=e[w];for(let z=0;z<this.width;z++){z/A.right>1&&(A=e[++w]);const O=Math.abs(z-A.left),F=Math.abs(z-A.right),U=Math.min(O,F);let q;const Z=g/l*(u+1);if(A.isDash){const ee=u-Math.abs(Z);q=Math.sqrt(U*U+ee*ee)}else q=u-Math.sqrt(U*U+Z*Z);this.image.data[_+z]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(e,n){for(let A=e.length-1;A>=0;--A){const z=e[A],O=e[A+1];z.zeroLength?e.splice(A,1):O&&O.isDash===z.isDash&&(O.left=z.left,e.splice(A,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const g=this.width*this.nextRow;let _=0,w=e[_];for(let A=0;A<this.width;A++){A/w.right>1&&(w=e[++_]);const z=Math.abs(A-w.left),O=Math.abs(A-w.right),F=Math.min(z,O);this.image.data[g+A]=Math.max(0,Math.min(255,(w.isDash?F:-F)+n+128))}}addDash(e,n){const l=this.getKey(e,n);if(this.positions[l])return this.positions[l];const u=n==="round",g=u?7:0,_=2*g+1;if(this.nextRow+_>this.height)return mi("LineAtlas out of space"),null;e.length===0&&e.push(1);let w=0;for(let O=0;O<e.length;O++)e[O]<0&&(mi("Negative value is found in line dasharray, replacing values with 0"),e[O]=0),w+=e[O];if(w!==0){const O=this.width/w,F=this.getDashRanges(e,this.width,O);u?this.addRoundDash(F,O,g):this.addRegularDash(F,n==="square"?.5*O:0)}const A=this.nextRow+g;this.nextRow+=_;const z={tl:[A,g],br:[w,0]};return this.positions[l]=z,z}}yi(h2,"LineAtlas");const Oj=Ye.types,Nj=Math.cos(Math.PI/180*37.5),Fj=Math.cos(Math.PI/180*5);class lw{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new Pc,this.layoutVertexArray2=new Sl,this.patternVertexArray=new Sl,this.indexArray=new Wr,this.programConfigurations=new zc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new tr,this.maxLineLength=0,this.zOffsetVertexArray=new Sl,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:Xt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,u){}populate(e,n,l,u){this.hasPattern=Ny("line",this.layers,this.pixelRatio,n);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=de(l);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const U=this.layers[0].layout.get("line-z-offset"),q=U.isConstant()&&!U.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&q?"none":"offset",this.elevationType==="offset"&&_==="none"&&mi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&w!==void 0;const A=[];for(const{feature:U,id:q,index:Z,sourceLayerIndex:ee}of e){const le=this.layers[0]._featureFilter.needGeometry,oe=it(U,le);if(!this.layers[0]._featureFilter.filter(new Da(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),oe,l))continue;const fe=g?g.evaluate(oe,{},l):void 0,_e={id:q,properties:U.properties,type:U.type,sourceLayerIndex:ee,index:Z,geometry:le?oe.geometry:Ve(U,l,u),patterns:{},sortKey:fe};A.push(_e)}g&&A.sort(((U,q)=>U.sortKey-q.sortKey));const{lineAtlas:z,featureIndex:O}=n,F=this.addConstantDashes(z);for(const U of A){const{geometry:q,index:Z,sourceLayerIndex:ee}=U;if(F&&this.addFeatureDashes(U,z),this.hasPattern){const le=Fy("line",this.layers,U,this.zoom,this.pixelRatio,n);this.patternFeatures.push(le)}else this.addFeature(U,q,Z,l,z.positions,n.availableImages,n.brightness,n.elevationFeatures);O.insert(e[Z].feature,q,Z,ee,this.index)}}addConstantDashes(e){let n=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,g=l.layout.get("line-cap").value;if(u.kind!=="constant"||g.kind!=="constant")n=!0;else{const _=g.value,w=u.value;if(!w)continue;e.addDash(w,_)}}return n}addFeatureDashes(e,n){const l=this.zoom;for(const u of this.layers){const g=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if(g.kind==="constant"&&_.kind==="constant")continue;let w,A;if(g.kind==="constant"){if(w=g.value,!w)continue}else w=g.evaluate({zoom:l},e);A=_.kind==="constant"?_.value:_.evaluate({zoom:l},e),n.addDash(w,A),e.patterns[u.id]=[n.getKey(w,A)]}}update(e,n,l,u,g,_,w,A){this.programConfigurations.updatePaintArrays(e,n,g,l,u,_,w,A)}addFeatures(e,n,l,u,g,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,n,l,u,_,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Rj)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Lj)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,jj.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zj),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,n){let l,u;if(n&&n>0?(l=`mapbox_clip_start_${n}`,u=`mapbox_clip_end_${n}`):(l="mapbox_clip_start",u="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(u))return{start:+e.properties[l],end:+e.properties[u]}}addFeature(e,n,l,u,g,_,w,A){const z=this.layers[0].layout,O=z.get("line-join").evaluate(e,{}),F=z.get("line-cap").evaluate(e,{}),U=z.get("line-miter-limit"),q=z.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const Z=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=z.get("line-z-offset").value;const ee=this.layers[0].paint.get("line-width").value;if(ee.kind!=="constant"&&ee.isLineProgressConstant===!1&&(this.variableWidthValue=ee),this.elevationType==="road"){const le=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,n,u,A,O,F,U,q)){const[oe,fe]=this.clipRuntimeLinesToTile(n,1);for(let _e=0;_e<oe.length;_e++){const be=oe[_e],Oe=fe[_e],Ie={progress:{min:Oe.progress.min,max:Oe.progress.max},nextDir:this.computeSegNextDir(Oe,be),prevDir:this.computeSegPrevDir(Oe,be)};this.addLine(be,e,u,O,F,U,q,Ie,Z&&Oe.parentIndex>0?Oe.parentIndex:null)}this.fillNonElevatedRoadSegment(le)}}else for(let le=0;le<n.length;le++)this.addLine(n[le],e,u,O,F,U,q,void 0,Z&&le>0?le:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,g,_,u,w,void 0,this.worldview)}computeSegNextDir(e,n){return e.nextPoint.sub(n.at(-2)).unit()}computeSegPrevDir(e,n){return n[1].sub(e.prevPoint).unit()}clipLinesToTile(e,n){return ii(e,-n,-n,Xt+n,Xt+n)}clipRuntimeLinesToTile(e,n){const l=[];return[ii(e,-n,-n,Xt+n,Xt+n,l),l]}addElevatedRoadFeature(e,n,l,u,g,_,w,A){const z=[],O=la.getElevationFeature(e,u);if(O){const F=this.clipLinesToTile(n,1),U=this.prepareElevatedLines(F,O,l);for(const q of U)z.push({geometry:q,elevation:O,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(z.length===0)return!1;for(const F of z){const U=this.layoutVertexArray.length;this.addLine(F.geometry,e,l,g,_,w,A);const q=new _a(l,F.elevationTileID);if(F.elevation)for(let Z=U;Z<this.layoutVertexArray.length;Z++){const ee=new Pe(this.layoutVertexArray.int16[6*Z]>>1,this.layoutVertexArray.int16[6*Z+1]>>1),le=q.pointElevation(ee,F.elevation,.05);this.updateHeightRange(le),this.zOffsetVertexArray.emplaceBack(le,0,0)}else this.fillNonElevatedRoadSegment(U)}return!0}prepareElevatedLines(e,n,l){if(n.constantHeight!=null)return e;const u=[],g=1/de(l);for(const _ of e)ri(_,new Qn(n,g),0,u);return u}fillNonElevatedRoadSegment(e){for(let n=e;n<this.layoutVertexArray.length;n++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,n,l,u,g,_,w,A,z){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=z?this.lineFeatureClips(n,z):this.lineClips;const O=u==="none";this.patternJoinNone=this.hasPattern&&O,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const F=A&&A.progress.min>0,U=A&&A.progress.max<1;if(this.lineClips){let et={min:this.lineClips.start,max:this.lineClips.end},yt=1;if(A){const Mt=this.lineClips.end-this.lineClips.start;et=(function(Pt,Ht,qt){return{min:ra(Pt.min,Ht,qt),max:ra(Pt.max,Ht,qt)}})(A.progress,{min:0,max:1},et),Mt>0&&(yt=(et.max-et.min)/Mt)}const nt=+n.properties.mapbox_clip_feature_len,bt=+n.properties.mapbox_clip_seg_len;if(Number.isNaN(nt)||Number.isNaN(bt)){for(let Pt=0;Pt<e.length-1;Pt++)this.totalDistance+=e[Pt].dist(e[Pt+1]);const Mt=this.totalDistance/(et.max-et.min);this.totalFeatureLength=Number.isFinite(Mt)?Mt:0,this.lineClips.start=et.min,this.lineClips.end=et.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=nt,this.distance=bt*yt,this.lineClips.start=et.min,this.lineClips.end=et.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const q=Oj[n.type]==="Polygon";let Z=e.length;for(;Z>=2&&e[Z-1].equals(e[Z-2]);)Z--;let ee=0;for(;ee<Z-1&&e[ee].equals(e[ee+1]);)ee++;if(Z<(q?3:2))return;u==="bevel"&&(_=1.05);const le=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray);let oe,fe,_e,be,Oe,Ie,Ue,Ge;A&&A.prevDir&&(Ie=A.prevDir.perp()),A&&A.nextDir&&(Ue=A.nextDir.perp()),this.e1=this.e2=-1,q&&(oe=e[Z-2],Oe=e[ee].sub(oe)._unit()._perp());for(let et=ee;et<Z;et++){if(_e=et===Z-1?q?e[ee+1]:void 0:e[et+1],_e&&e[et].equals(_e))continue;Oe&&(be=Oe),oe&&(fe=oe),oe=e[et],Ge=this.evaluateLineProgressFeatures(fe?fe.dist(oe):0),Oe=_e?_e.sub(oe)._unit()._perp():be,be=be||Oe;const yt=fe&&_e;let nt=yt?u:q||O?"butt":g;const bt=be.x*Oe.x+be.y*Oe.y;if(O){const vt=function(Vt){if(Vt.patternJoinNone){const ai=Vt.segmentPoints.length/2,Yt=Vt.lineSoFar-Vt.segmentStart;for(let Di=0;Di<ai;++Di){const pi=Vt.segmentPoints[2*Di+1],xi=Math.round(Vt.segmentPoints[2*Di])+.5+.25*pi;Vt.patternVertexArray.emplaceBack(xi,Yt,Vt.segmentStart),Vt.patternVertexArray.emplaceBack(xi,Yt,Vt.segmentStart)}Vt.segmentPoints.length=0}Vt.e1=Vt.e2=-1};if(yt&&bt<Fj){this.updateDistance(fe,oe),this.addCurrentVertex(oe,be,1,1,le,Ge),vt(this),this.addCurrentVertex(oe,Oe,-1,-1,le,Ge);continue}if(fe){if(!_e){this.updateDistance(fe,oe),this.addCurrentVertex(oe,be,1,1,le,Ge),vt(this);continue}nt="miter"}}let Mt=be.add(Oe);Mt.x===0&&Mt.y===0||Mt._unit();const Pt=Mt.x*Oe.x+Mt.y*Oe.y,Ht=Pt!==0?1/Pt:1/0,qt=2*Math.sqrt(2-2*Pt),Ut=Pt<Nj&&fe&&_e,$t=be.x*Oe.y-be.y*Oe.x>0,xt=this.overscaling<=16?15*Xt/(512*this.overscaling):0;if(yt&&nt==="round"){if(Ht<w)nt="miter";else if(Ht<=2){const vt=cw(oe,-10,Xt+10);nt=this.elevationType==="offset"&&(vt||this.hasCrossSlope)?"miter":"fakeround"}}if(nt==="miter"&&Ht>_&&(nt="bevel"),nt==="bevel"&&(Ht>2&&(nt="flipbevel"),Ht<_&&(nt="miter")),fe&&!(nt==="miter"&&Ut)&&this.updateDistance(fe,oe),nt==="miter")if(Ut){const vt=oe.dist(fe);if(vt>2*xt){const ai=oe.sub(oe.sub(fe)._mult(xt/vt)._round());this.updateDistance(fe,ai),this.addCurrentVertex(ai,be,0,0,le,Ge),fe=ai}this.updateDistance(fe,oe),Mt._mult(Ht),this.addCurrentVertex(oe,Mt,0,0,le,Ge);const Vt=oe.dist(_e);if(Vt>2*xt){const ai=oe.add(_e.sub(oe)._mult(xt/Vt)._round());this.updateDistance(oe,ai),this.addCurrentVertex(ai,Oe,0,0,le,Ge),oe=ai}}else Mt._mult(Ht),this.addCurrentVertex(oe,Mt,0,0,le,Ge);else if(nt==="flipbevel"){if(Ht>100)Mt=Oe.mult(-1);else{const vt=Ht*be.add(Oe).mag()/be.sub(Oe).mag();Mt._perp()._mult(vt*($t?-1:1))}this.addCurrentVertex(oe,Mt,0,0,le,Ge),this.addCurrentVertex(oe,Mt.mult(-1),0,0,le,Ge)}else if(nt==="bevel"||nt==="fakeround"){Ge!=null&&fe&&this.addCurrentVertex(oe,Ue||be,-1,-1,le,Ge);const vt=oe.dist(fe)<=2*xt&&nt!=="bevel",Vt=Mt.mult($t?1:-1);Vt._mult(Ht);const ai=Oe.mult($t?-1:1),Yt=be.mult($t?-1:1),Di=this.evaluateLineProgressFeatures(this.distance);if(Ge==null&&(this.addHalfVertex(oe,Vt.x,Vt.y,!1,!$t,0,le,Di),vt||this.addHalfVertex(oe,Vt.x+2*Yt.x,Vt.y+2*Yt.y,!1,$t,0,le,Di)),nt==="fakeround"){const pi=Math.round(180*qt/Math.PI/20);this.addHalfVertex(oe,Yt.x,Yt.y,!1,$t,0,le,Di);for(let xi=0;xi<pi;xi++){let Mi=xi/pi;if(Mi!==.5){const ei=Mi-.5;Mi+=Mi*ei*(Mi-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*ei*ei+(.848013+bt*(.215638*bt-1.06021)))}const An=ai.sub(Yt)._mult(Mi)._add(Yt)._unit();this.addHalfVertex(oe,An.x,An.y,!1,$t,0,le,Di)}this.addHalfVertex(oe,ai.x,ai.y,!1,$t,0,le,Di)}vt||Ge!=null||this.addHalfVertex(oe,Vt.x+2*ai.x,Vt.y+2*ai.y,!1,$t,0,le,Di),Ge!=null&&_e&&this.addCurrentVertex(oe,Ie||Oe,1,1,le,Ge)}else if(nt==="butt")this.addCurrentVertex(oe,Mt,0,0,le,Ge);else if(nt==="square"){if(!fe){const vt=F?0:-1;this.addCurrentVertex(oe,Mt,vt,vt,le,Ge)}if(this.addCurrentVertex(oe,Mt,0,0,le,Ge),fe){const vt=U?0:1;this.addCurrentVertex(oe,Mt,vt,vt,le,Ge)}}else if(nt==="round"){if(fe){const vt=!yt&&Ue?Ue:be;this.addCurrentVertex(oe,vt,0,0,le,Ge),!yt&&U||this.addCurrentVertex(oe,vt,1,1,le,Ge,!0)}if(_e){const vt=!yt&&Ie?Ie:Oe;!yt&&F||this.addCurrentVertex(oe,vt,-1,-1,le,Ge,!0),this.addCurrentVertex(oe,vt,0,0,le,Ge)}}}}addVerticesTo(e,n,l,u,g,_,w,A,z,O){const F=(n.w-e.w)/this.tessellationStep|0;let U=0;const q=this.scaledDistance;if(F>1){this.lineSoFar=e.w;const ee=(n.x-e.x)/F,le=(n.y-e.y)/F,oe=(n.z-e.z)/F,fe=(n.w-e.w)/F;for(let _e=1;_e<F;++_e){e.x+=ee,e.y+=le,e.z+=oe,this.lineSoFar+=fe,U+=fe;const be=this.evaluateLineProgressFeatures(this.prevDistance+U);this.scaledDistance=(this.prevDistance+U)/this.totalDistance,this.addHalfVertex(e,l,u,O,!1,w,z,be),this.addHalfVertex(e,g,_,O,!0,-A,z,be)}}this.lineSoFar=n.w,this.scaledDistance=q;const Z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,l,u,O,!1,w,z,Z),this.addHalfVertex(n,g,_,O,!0,-A,z,Z)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):mi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:n}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}}addCurrentVertex(e,n,l,u,g,_,w=!1){const A=n.x+n.y*l,z=n.y-n.x*l,O=n.y*u-n.x,F=-n.y-n.x*u;if(_!=null){const U=this.elevationType==="offset",q=-10,Z=Xt+10,ee=_.zOffset,le=new Jt(e.x,e.y,ee,this.lineSoFar),oe=!!U&&cw(e,q,Z),fe=this.lineSoFar,_e=this.distance;if(this.currentVertex)if(oe){const be=this.currentVertexIsOutside,Oe=this.currentVertex,Ie=new Jt(e.x,e.y,ee,this.lineSoFar);if(Ai(Oe,Ie,q,Z),!cw(Ie,q,Z)){if(be){this.e1=this.e2=-1,this.distance-=Oe.dist(le),this.lineSoFar=Oe.w;const Ue=this.evaluateLineProgressFeatures(Oe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Oe,A,z,w,!1,l,g,Ue),this.addHalfVertex(Oe,O,F,w,!0,-u,g,Ue),this.prevDistance=this.distance}this.distance=this.prevDistance+Oe.dist(Ie),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Oe,Ie,A,z,O,F,l,u,g,w),this.distance=_e,this.scaledDistance=this.distance/this.totalDistance}}else{const be=this.currentVertex;if(this.currentVertexIsOutside){Ai(be,le,q,Z),this.e1=this.e2=-1,this.distance-=be.dist(le),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=be.w;const Oe=this.evaluateLineProgressFeatures(be.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(be,A,z,w,!1,l,g,Oe),this.addHalfVertex(be,O,F,w,!0,-u,g,Oe),this.prevDistance=this.distance,this.distance=_e,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(be,le,A,z,O,F,l,u,g,w)}else oe||(this.addHalfVertex(e,A,z,w,!1,l,g,_),this.addHalfVertex(e,O,F,w,!0,-u,g,_));this.currentVertex=le,this.currentVertexIsOutside=oe,this.lineSoFar=fe}else this.addHalfVertex(e,A,z,w,!1,l,g,_),this.addHalfVertex(e,O,F,w,!0,-u,g,_)}addHalfVertex({x:e,y:n},l,u,g,_,w,A,z){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(n<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const F=$i(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,F)}const O=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),A.primitiveLength++),_?this.e2=O:this.e1=O,z!=null&&this.zOffsetVertexArray.emplaceBack(z.zOffset,z.variableWidth,z.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function cw(a,e,n){return a.x<e||a.x>n||a.y<e||a.y>n}let f2,m2;function p2(a,e,n){return e*(Xt/(a.tileSize*Math.pow(2,n-a.tileID.overscaledZ)))}yi(lw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const g2=(a,e,n)=>(1-n)*a+n*e;function _2(a,e){return 1/p2(a,1,e.tileZoom)}function y2(a,e,n,l){return a.translatePosMatrix(l||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const v2=a=>{const e=[];x2(a)&&e.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=a.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=a.layout.get("line-join").constantOr("miter")==="none",u=!!a.paint.get("line-pattern").constantOr(1);return l&&u&&e.push("LINE_JOIN_NONE"),e};function x2(a){const e=a.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let uw;const b2=()=>uw||(uw={layout:f2||(f2=new ur({"line-cap":new si(at.layout_line["line-cap"]),"line-join":new si(at.layout_line["line-join"]),"line-miter-limit":new Kt(at.layout_line["line-miter-limit"]),"line-round-limit":new Kt(at.layout_line["line-round-limit"]),"line-sort-key":new si(at.layout_line["line-sort-key"]),"line-z-offset":new si(at.layout_line["line-z-offset"]),"line-elevation-reference":new Kt(at.layout_line["line-elevation-reference"]),"line-cross-slope":new Kt(at.layout_line["line-cross-slope"]),visibility:new Kt(at.layout_line.visibility),"line-width-unit":new Kt(at.layout_line["line-width-unit"])})),paint:m2||(m2=new ur({"line-opacity":new si(at.paint_line["line-opacity"]),"line-color":new si(at.paint_line["line-color"]),"line-translate":new Kt(at.paint_line["line-translate"]),"line-translate-anchor":new Kt(at.paint_line["line-translate-anchor"]),"line-width":new si(at.paint_line["line-width"]),"line-gap-width":new si(at.paint_line["line-gap-width"]),"line-offset":new si(at.paint_line["line-offset"]),"line-blur":new si(at.paint_line["line-blur"]),"line-dasharray":new si(at.paint_line["line-dasharray"]),"line-pattern":new si(at.paint_line["line-pattern"]),"line-pattern-cross-fade":new Kt(at.paint_line["line-pattern-cross-fade"]),"line-gradient":new bd(at.paint_line["line-gradient"]),"line-trim-offset":new Kt(at.paint_line["line-trim-offset"]),"line-trim-fade-range":new Kt(at.paint_line["line-trim-fade-range"]),"line-trim-color":new Kt(at.paint_line["line-trim-color"]),"line-emissive-strength":new si(at.paint_line["line-emissive-strength"]),"line-border-width":new si(at.paint_line["line-border-width"]),"line-border-color":new si(at.paint_line["line-border-color"]),"line-occlusion-opacity":new Kt(at.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},uw);class Bj extends si{possiblyEvaluate(e,n){return n=new Da(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition,worldview:n.worldview}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,u){return n=Object.assign({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,u)}}let tv;function w2(a,e){return e>0?e+2*a:a}const Uj=Mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$j=Mn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Vj=Mn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hj=Mn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Gj=Mn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),qj=Mn([{name:"a_texb",components:2,type:"Uint16"}]),Wj=Mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Zj=Mn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const S2=Mn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xj=Mn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mn([{name:"triangle",components:3,type:"Uint16"}]),Mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Mn([{type:"Float32",name:"offsetX"}]),Mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Bs=24;function Yj(a,e,n){return a.sections.forEach((l=>{l.text=(function(u,g,_){const w=g.layout.get("text-transform").evaluate(_,{});return w==="uppercase"?u=u.toLocaleUpperCase():w==="lowercase"&&(u=u.toLocaleLowerCase()),cu.applyArabicShaping&&(u=cu.applyArabicShaping(u)),u})(l.text,e,n)})),a}const iv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Kj(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function Jj(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}const dw=4294967296,T2=1/dw,k2=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Kx=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,e,n=this.length){for(;this.pos<n;){const l=this.readVarint(),u=l>>3,g=this.pos;this.type=7&l,a(u,e,this),this.pos===g&&this.skip(l)}return e}readMessage(a,e){return this.readFields(a,e,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*dw;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*dw;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const e=this.buf;let n,l;return l=e[this.pos++],n=127&l,l<128?n:(l=e[this.pos++],n|=(127&l)<<7,l<128?n:(l=e[this.pos++],n|=(127&l)<<14,l<128?n:(l=e[this.pos++],n|=(127&l)<<21,l<128?n:(l=e[this.pos],n|=(15&l)<<28,(function(u,g,_){const w=_.buf;let A,z;if(z=w[_.pos++],A=(112&z)>>4,z<128||(z=w[_.pos++],A|=(127&z)<<3,z<128)||(z=w[_.pos++],A|=(127&z)<<10,z<128)||(z=w[_.pos++],A|=(127&z)<<17,z<128)||(z=w[_.pos++],A|=(127&z)<<24,z<128)||(z=w[_.pos++],A|=(1&z)<<31,z<128))return I_(u,A,g);throw new Error("Expected varint not more than 10 bytes")})(n,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,e=this.pos;return this.pos=a,a-e>=12&&k2?k2.decode(this.buf.subarray(e,a)):(function(n,l,u){let g="",_=l;for(;_<u;){const w=n[_];let A,z,O,F=null,U=w>239?4:w>223?3:w>191?2:1;if(_+U>u)break;U===1?w<128&&(F=w):U===2?(A=n[_+1],(192&A)==128&&(F=(31&w)<<6|63&A,F<=127&&(F=null))):U===3?(A=n[_+1],z=n[_+2],(192&A)==128&&(192&z)==128&&(F=(15&w)<<12|(63&A)<<6|63&z,(F<=2047||F>=55296&&F<=57343)&&(F=null))):U===4&&(A=n[_+1],z=n[_+2],O=n[_+3],(192&A)==128&&(192&z)==128&&(192&O)==128&&(F=(15&w)<<18|(63&A)<<12|(63&z)<<6|63&O,(F<=65535||F>=1114112)&&(F=null))),F===null?(F=65533,U=1):F>65535&&(F-=65536,g+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),g+=String.fromCharCode(F),_+=U}return g})(this.buf,e,a)}readBytes(){const a=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,a);return this.pos=a,e}readPackedVarint(a=[],e){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readVarint(e));return a}readPackedSVarint(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const e=7&a;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(a,e){this.writeVarint(a<<3|e)}realloc(a){let e=this.length||16;for(;e<this.pos+a;)e*=2;if(e!==this.length){const n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*T2),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*T2),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(e,n){let l,u;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(l=~(-e%4294967296),u=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),(function(g,_,w){w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7)})(l,0,n),(function(g,_){const w=(7&g)<<4;_.buf[_.pos++]|=w|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))})(u,n)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const e=this.pos;this.pos=(function(l,u,g){for(let _,w,A=0;A<u.length;A++){if(_=u.charCodeAt(A),_>55295&&_<57344){if(!w){_>56319||A+1===u.length?(l[g++]=239,l[g++]=191,l[g++]=189):w=_;continue}if(_<56320){l[g++]=239,l[g++]=191,l[g++]=189,w=_;continue}_=w-55296<<10|_-56320|65536,w=null}else w&&(l[g++]=239,l[g++]=191,l[g++]=189,w=null);_<128?l[g++]=_:(_<2048?l[g++]=_>>6|192:(_<65536?l[g++]=_>>12|224:(l[g++]=_>>18|240,l[g++]=_>>12&63|128),l[g++]=_>>6&63|128),l[g++]=63&_|128)}return g})(this.buf,a,this.pos);const n=this.pos-e;n>=128&&E2(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const e=a.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=a[n]}writeRawMessage(a,e){this.pos++;const n=this.pos;a(e,this);const l=this.pos-n;l>=128&&E2(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeMessage(a,e,n){this.writeTag(a,2),this.writeRawMessage(e,n)}writePackedVarint(a,e){e.length&&this.writeMessage(a,Qj,e)}writePackedSVarint(a,e){e.length&&this.writeMessage(a,ez,e)}writePackedBoolean(a,e){e.length&&this.writeMessage(a,nz,e)}writePackedFloat(a,e){e.length&&this.writeMessage(a,tz,e)}writePackedDouble(a,e){e.length&&this.writeMessage(a,iz,e)}writePackedFixed32(a,e){e.length&&this.writeMessage(a,az,e)}writePackedSFixed32(a,e){e.length&&this.writeMessage(a,rz,e)}writePackedFixed64(a,e){e.length&&this.writeMessage(a,sz,e)}writePackedSFixed64(a,e){e.length&&this.writeMessage(a,oz,e)}writeBytesField(a,e){this.writeTag(a,2),this.writeBytes(e)}writeFixed32Field(a,e){this.writeTag(a,5),this.writeFixed32(e)}writeSFixed32Field(a,e){this.writeTag(a,5),this.writeSFixed32(e)}writeFixed64Field(a,e){this.writeTag(a,1),this.writeFixed64(e)}writeSFixed64Field(a,e){this.writeTag(a,1),this.writeSFixed64(e)}writeVarintField(a,e){this.writeTag(a,0),this.writeVarint(e)}writeSVarintField(a,e){this.writeTag(a,0),this.writeSVarint(e)}writeStringField(a,e){this.writeTag(a,2),this.writeString(e)}writeFloatField(a,e){this.writeTag(a,5),this.writeFloat(e)}writeDoubleField(a,e){this.writeTag(a,1),this.writeDouble(e)}writeBooleanField(a,e){this.writeVarintField(a,+e)}};function I_(a,e,n){return n?4294967296*e+(a>>>0):4294967296*(e>>>0)+(a>>>0)}function E2(a,e,n){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(let u=n.pos-1;u>=a;u--)n.buf[u+l]=n.buf[u]}function Qj(a,e){for(let n=0;n<a.length;n++)e.writeVarint(a[n])}function ez(a,e){for(let n=0;n<a.length;n++)e.writeSVarint(a[n])}function tz(a,e){for(let n=0;n<a.length;n++)e.writeFloat(a[n])}function iz(a,e){for(let n=0;n<a.length;n++)e.writeDouble(a[n])}function nz(a,e){for(let n=0;n<a.length;n++)e.writeBoolean(a[n])}function az(a,e){for(let n=0;n<a.length;n++)e.writeFixed32(a[n])}function rz(a,e){for(let n=0;n<a.length;n++)e.writeSFixed32(a[n])}function sz(a,e){for(let n=0;n<a.length;n++)e.writeFixed64(a[n])}function oz(a,e){for(let n=0;n<a.length;n++)e.writeSFixed64(a[n])}const hw=3;function lz(a,e,n){e.glyphs=[],a===1&&n.readMessage(cz,e)}function cz(a,e,n){if(a===3){const{id:l,bitmap:u,width:g,height:_,left:w,top:A,advance:z}=n.readMessage(uz,{});e.glyphs.push({id:l,bitmap:new hr({width:g+2*hw,height:_+2*hw},u),metrics:{width:g,height:_,left:w,top:A,advance:z}})}else a===4?e.ascender=n.readSVarint():a===5&&(e.descender=n.readSVarint())}function uz(a,e,n){a===1?e.id=n.readVarint():a===2?e.bitmap=n.readBytes():a===3?e.width=n.readVarint():a===4?e.height=n.readVarint():a===5?e.left=n.readSVarint():a===6?e.top=n.readSVarint():a===7&&(e.advance=n.readVarint())}const A2=hw,Fc={horizontal:1,vertical:2,horizontalOnly:3};class nv{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const l=new nv;return l.scale=e||1,l.fontStack=n,l}static forImage(e){const n=new nv;return n.image=e,n}}class R_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n,l){const u=new R_;for(let g=0;g<e.sections.length;g++){const _=e.sections[g];_.image?u.addImageSection(_,l):u.addTextSection(_,n)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(n,l){let u="";for(let g=0;g<n.length;g++){const _=n.charCodeAt(g+1)||null,w=n.charCodeAt(g-1)||null;u+=!l&&(_&&Of(_)&&!iv[n[g+1]]||w&&Of(w)&&!iv[n[g-1]])||!iv[n[g]]?n[g]:iv[n[g]]}return u})(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Jx[this.text.charCodeAt(l)];l++)e++;let n=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Jx[this.text.charCodeAt(l)];l--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const l=new R_;return l.text=this.text.substring(e,n),l.sectionIndex=this.sectionIndex.slice(e,n),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(nv.forText(e.scale,e.fontStack||n));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e,n){const l=e.image?e.image.getPrimary():null;if(!l)return void mi("Can't add FormattedSection with an empty image.");l.scaleSelf(n);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(nv.forImage(l)),this.sectionIndex.push(this.sections.length-1)):mi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fw(a,e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee=1){const le=R_.fromFeature(a,u,ee);F===Fc.vertical&&le.verticalizePunctuation(U);let oe=[];const fe=(function(Ue,Ge,et,yt,nt,bt){if(!Ue)return[];const Mt=[],Pt=(function($t,xt,vt,Vt,ai,Yt){let Di=0;for(let pi=0;pi<$t.length();pi++){const xi=$t.getSection(pi);Di+=C2($t.getCodePoint(pi),xi,Vt,ai,xt,Yt)}return Di/Math.max(1,Math.ceil(Di/vt))})(Ue,Ge,et,yt,nt,bt),Ht=Ue.text.indexOf("")>=0;let qt=0;for(let $t=0;$t<Ue.length();$t++){const xt=Ue.getSection($t),vt=Ue.getCodePoint($t);if(Jx[vt]||(qt+=C2(vt,xt,yt,nt,Ge,bt)),$t<Ue.length()-1){const Vt=!((Ut=vt)<11904||!(Hi["Bopomofo Extended"](Ut)||Hi.Bopomofo(Ut)||Hi["CJK Compatibility Forms"](Ut)||Hi["CJK Compatibility Ideographs"](Ut)||Hi["CJK Compatibility"](Ut)||Hi["CJK Radicals Supplement"](Ut)||Hi["CJK Strokes"](Ut)||Hi["CJK Symbols and Punctuation"](Ut)||Hi["CJK Unified Ideographs Extension A"](Ut)||Hi["CJK Unified Ideographs"](Ut)||Hi["Enclosed CJK Letters and Months"](Ut)||Hi["Halfwidth and Fullwidth Forms"](Ut)||Hi.Hiragana(Ut)||Hi["Ideographic Description Characters"](Ut)||Hi["Kangxi Radicals"](Ut)||Hi["Katakana Phonetic Extensions"](Ut)||Hi.Katakana(Ut)||Hi["Vertical Forms"](Ut)||Hi["Yi Radicals"](Ut)||Hi["Yi Syllables"](Ut)));(dz[vt]||Vt||xt.image)&&Mt.push(P2($t+1,qt,Pt,Mt,hz(vt,Ue.getCodePoint($t+1),Vt&&Ht),!1))}}var Ut;return j2(P2(Ue.length(),qt,Pt,Mt,0,!0))})(le,z,g,e,l,q),{processBidirectionalText:_e,processStyledBidirectionalText:be}=cu;if(_e&&le.sections.length===1){const Ue=_e(le.toString(),fe);for(const Ge of Ue){const et=new R_;et.text=Ge,et.sections=le.sections;for(let yt=0;yt<Ge.length;yt++)et.sectionIndex.push(0);oe.push(et)}}else if(be){const Ue=be(le.text,le.sectionIndex,fe);for(const Ge of Ue){const et=new R_;et.text=Ge[0],et.sectionIndex=Ge[1],et.sections=le.sections,oe.push(et)}}else oe=(function(Ue,Ge){const et=[],yt=Ue.text;let nt=0;for(const bt of Ge)et.push(Ue.substring(nt,bt)),nt=bt;return nt<yt.length&&et.push(Ue.substring(nt,yt.length)),et})(le,fe);const Oe=[],Ie={positionedLines:Oe,text:le.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ue,Ge,et,yt,nt,bt,Mt,Pt,Ht,qt,Ut,$t){let xt=0,vt=0,Vt=0;const ai=Pt==="right"?1:Pt==="left"?0:.5;let Yt=!1;for(const ei of nt){const zi=ei.getSections();for(const un of zi){if(un.image)continue;const Hn=Ge[un.fontStack];if(Hn&&(Yt=Hn.ascender!==void 0&&Hn.descender!==void 0,!Yt))break}if(!Yt)break}let Di=0;for(const ei of nt){ei.trim();const zi=ei.getMaxScale(),un=(zi-1)*Bs,Hn={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[Di]=Hn;const Xn=Hn.positionedGlyphs;let yn=0;if(!ei.length()){vt+=bt,++Di;continue}let Pa=0,Re=0;for(let wt=0;wt<ei.length();wt++){const Gt=ei.getSection(wt),hi=ei.getSectionIndex(wt),fi=ei.getCodePoint(wt);let Li=Gt.scale,Ni=null,_n=null,bn=null,Tn=Bs,Fn=0,Ji=Ht;Ji===Fc.vertical&&((pi=fi)===12312||pi===12313||pi===12316||pi===12540||pi===12448)&&(Ji=Fc.horizontal);const on=!(Ji===Fc.horizontal||!Ut&&!Lf(fi)||Ut&&(Jx[fi]||Nf(fi)));if(Gt.image){const ia=yt.get(Gt.image.toString());if(!ia)continue;bn=Gt.image,Ue.iconsInText=Ue.iconsInText||!0,_n=ia.paddedRect;const ua=ia.displaySize;Li=Li*Bs/$t,Ni={width:ua[0],height:ua[1],left:0,top:-A2,advance:on?ua[1]:ua[0],localGlyph:!1},Fn=Yt?-Ni.height*Li:zi*Bs-17-ua[1]*Li,Tn=Ni.advance;const da=(on?ua[0]:ua[1])*Li-Bs*zi;da>0&&da>yn&&(yn=da)}else{const ia=et[Gt.fontStack];if(!ia)continue;ia[fi]&&(_n=ia[fi]);const ua=Ge[Gt.fontStack];if(!ua)continue;const da=ua.glyphs[fi];if(!da)continue;if(Ni=da.metrics,Tn=fi!==8203?Bs:0,Yt){const ba=ua.ascender!==void 0?Math.abs(ua.ascender):0,Na=ua.descender!==void 0?Math.abs(ua.descender):0,ja=(ba+Na)*Li;Pa<ja&&(Pa=ja,Re=(ba-Na)/2*Li),Fn=-ba*Li}else Fn=(zi-Li)*Bs-17}on?(Ue.verticalizable=!0,Xn.push({glyph:fi,image:bn,x:xt,y:vt+Fn,vertical:on,scale:Li,localGlyph:Ni.localGlyph,fontStack:Gt.fontStack,sectionIndex:hi,metrics:Ni,rect:_n}),xt+=Tn*Li+qt):(Xn.push({glyph:fi,image:bn,x:xt,y:vt+Fn,vertical:on,scale:Li,localGlyph:Ni.localGlyph,fontStack:Gt.fontStack,sectionIndex:hi,metrics:Ni,rect:_n}),xt+=Ni.advance*Li+qt)}Xn.length!==0&&(Vt=Math.max(xt-qt,Vt),Yt?z2(Xn,ai,yn,Re,bt*zi/2):z2(Xn,ai,yn,0,bt/2)),xt=0;const Ne=bt*zi+yn;Hn.lineOffset=Math.max(yn,un),vt+=Ne,++Di}var pi;const xi=vt,{horizontalAlign:Mi,verticalAlign:An}=mw(Mt);(function(ei,zi,un,Hn,Xn,yn){const Pa=(zi-un)*Xn,Re=-yn*Hn;for(const Ne of ei)for(const wt of Ne.positionedGlyphs)wt.x+=Pa,wt.y+=Re})(Ue.positionedLines,ai,Mi,An,Vt,xi),Ue.top+=-An*xi,Ue.bottom=Ue.top+xi,Ue.left+=-Mi*Vt,Ue.right=Ue.left+Vt,Ue.hasBaseline=Yt})(Ie,e,n,l,oe,_,w,A,F,z,U,Z),!(function(Ue){for(const Ge of Ue)if(Ge.positionedGlyphs.length!==0)return!1;return!0})(Oe))return Ie}const Jx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dz={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function C2(a,e,n,l,u,g){if(e.image){const _=l.get(e.image.toString());return _?_.displaySize[0]*e.scale*Bs/g+u:0}{const _=n[e.fontStack],w=_&&_.glyphs[a];return w?w.metrics.advance*e.scale+u:0}}function M2(a,e,n,l){const u=Math.pow(a-e,2);return l?a<e?u/2:2*u:u+Math.abs(n)*n}function hz(a,e,n){let l=0;return a===10&&(l-=1e4),n&&(l+=150),a!==40&&a!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function P2(a,e,n,l,u,g){let _=null,w=M2(e,n,u,g);for(const A of l){const z=M2(e-A.x,n,u,g)+A.badness;z<=w&&(_=A,w=z)}return{index:a,x:e,priorBreak:_,badness:w}}function j2(a){return a?j2(a.priorBreak).concat(a.index):[]}function mw(a){let e=.5,n=.5;switch(a){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function z2(a,e,n,l,u){if(!(e||n||l||u))return;const g=a.length-1,_=a[g],w=(_.x+_.metrics.advance*_.scale)*e;for(let A=0;A<=g;A++)a[A].x-=w,a[A].y+=n+l+u}function pw(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function Qx(a,e,n,l){const{horizontalAlign:u,verticalAlign:g}=mw(l),_=n[0]-a.displaySize[0]*u,w=n[1]-a.displaySize[1]*g;return{imagePrimary:a,imageSecondary:e,top:w,bottom:w+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function gw(a,e,n,l,u,g){const _=a.imagePrimary;let w;if(_.content){const le=_.content,oe=_.pixelRatio||1;w=[le[0]/oe,le[1]/oe,_.displaySize[0]-le[2]/oe,_.displaySize[1]-le[3]/oe]}const A=e.left*g,z=e.right*g;let O,F,U,q;n==="width"||n==="both"?(q=u[0]+A-l[3],F=u[0]+z+l[1]):(q=u[0]+(A+z-_.displaySize[0])/2,F=q+_.displaySize[0]);const Z=e.top*g,ee=e.bottom*g;return n==="height"||n==="both"?(O=u[1]+Z-l[0],U=u[1]+ee+l[2]):(O=u[1]+(Z+ee-_.displaySize[1])/2,U=O+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:O,right:F,bottom:U,left:q,collisionPadding:w}}function I2(a){return!a.imagePrimary.stretchX}function R2(a){return!a.imagePrimary.stretchY}function D2(a){return{width:a.right-a.left,height:a.bottom-a.top}}const fh=128;function D_(a,e,n){const{expression:l}=e;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Da(a+1,{worldview:n}))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:g}=l;let _=0;for(;_<u.length&&u[_]<=a;)_++;_=Math.max(0,_-1);let w=_;for(;w<u.length&&u[w]<a+1;)w++;w=Math.min(u.length-1,w);const A=u[_],z=u[w];return l.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:z,interpolationType:g}:{kind:"camera",minZoom:A,maxZoom:z,minSize:l.evaluate(new Da(A,{worldview:n})),maxSize:l.evaluate(new Da(z,{worldview:n})),interpolationType:g}}}function _w(a,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:u}){return a.kind==="source"?l/fh:a.kind==="composite"?$i(l/fh,u/fh,n):e}function L_(a,e,n=1){let l=0,u=0;if(a.kind==="constant")u=a.layoutSize*n;else if(a.kind!=="source"){const{interpolationType:g,minZoom:_,maxZoom:w}=a,A=g?ie(co.interpolationFactor(g,e,_,w),0,1):0;a.kind==="camera"?u=$i(a.minSize,a.maxSize,A)*n:l=A*n}return{uSizeT:l,uSize:u}}class fm extends Pe{constructor(e,n,l,u,g){super(e,n),this.angle=u,this.z=l,g!==void 0&&(this.segment=g)}clone(){return new fm(this.x,this.y,this.z,this.angle,this.segment)}}function L2(a,e,n,l,u){if(e.segment===void 0)return!0;let g=e,_=e.segment+1,w=0;for(;w>-n/2;){if(_--,_<0)return!1;w-=a[_].dist(g),g=a[_]}w+=a[_].dist(a[_+1]),_++;const A=[];let z=0;for(;w<n/2;){const O=a[_],F=a[_+1];if(!F)return!1;let U=a[_-1].angleTo(O)-O.angleTo(F);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:w,angleDelta:U}),z+=U;w-A[0].distance>l;)z-=A.shift().angleDelta;if(z>u)return!1;_++,w+=O.dist(F)}return!0}function O2(a){let e=0;for(let n=0;n<a.length-1;n++)e+=a[n].dist(a[n+1]);return e}function N2(a,e,n){return a?.6*e*n:0}function F2(a,e){return Math.max(a?a.right-a.left:0,e?e.right-e.left:0)}function fz(a,e,n,l,u,g){const _=N2(n,u,g),w=F2(n,l)*g;let A=0;const z=O2(a)/2;for(let O=0;O<a.length-1;O++){const F=a[O],U=a[O+1],q=F.dist(U);if(A+q>z){const Z=(z-A)/q,ee=$i(F.x,U.x,Z),le=$i(F.y,U.y,Z),oe=new fm(ee,le,0,U.angleTo(F),O);return!_||L2(a,oe,w,_,e)?oe:void 0}A+=q}}function mz(a,e,n,l,u,g,_,w,A){const z=N2(l,g,_),O=F2(l,u),F=O*_,U=a[0].x===0||a[0].x===A||a[0].y===0||a[0].y===A;return e-F<e/4&&(e=F+e/4),B2(a,U?e/2*w%e:(O/2+2*g)*_*w%e,e,z,n,F,U,!1,A)}function B2(a,e,n,l,u,g,_,w,A){const z=g/2,O=O2(a);let F=0,U=e-n,q=[];for(let Z=0;Z<a.length-1;Z++){const ee=a[Z],le=a[Z+1],oe=ee.dist(le),fe=le.angleTo(ee);for(;U+n<F+oe;){U+=n;const _e=(U-F)/oe,be=$i(ee.x,le.x,_e),Oe=$i(ee.y,le.y,_e);if(be>=0&&be<A&&Oe>=0&&Oe<A&&U-z>=0&&U+z<=O){const Ie=new fm(be,Oe,0,fe,Z);l&&!L2(a,Ie,g,l,u)||q.push(Ie)}}F+=oe}return w||q.length||_||(q=B2(a,F/2,n,l,u,g,_,!0,A)),q}function U2(a){let e=0,n=0;for(const _ of a)e+=_.w*_.h,n=Math.max(n,_.w);a.sort(((_,w)=>w.h-_.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,g=0;for(const _ of a)for(let w=l.length-1;w>=0;w--){const A=l[w];if(!(_.w>A.w||_.h>A.h)){if(_.x=A.x,_.y=A.y,g=Math.max(g,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===A.w&&_.h===A.h){const z=l.pop();z&&w<l.length&&(l[w]=z)}else _.h===A.h?(A.x+=_.w,A.w-=_.w):_.w===A.w?(A.y+=_.h,A.h-=_.h):(l.push({x:A.x+_.w,y:A.y,w:A.w-_.w,h:_.h}),A.y+=_.h,A.h-=_.h);break}}return{w:u,h:g,fill:e/(u*g)||0}}yi(fm,"Anchor");const jg=1;class av{static getImagePositionScale(e,n,l){if(n&&e){const{sx:u,sy:g}=e;return{x:u,y:g}}return{x:l,y:l}}constructor(e,n,l,u){this.paddedRect=e;const{pixelRatio:g,version:_,stretchX:w,stretchY:A,content:z,sdf:O,usvg:F}=n;this.pixelRatio=g,this.stretchX=w,this.stretchY=A,this.content=z,this.version=_,this.padding=l,this.sdf=O,this.usvg=F,this.scale=av.getImagePositionScale(u,F,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function yw(a,e,n){const l=ac.parse(a),u=(function(g,_,w=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*w[0])+2*_,h:(g.data?g.data.height:g.height*w[1])+2*_}})(e,n,[l.sx,l.sy]);return{bin:u,imagePosition:new av(u,e,n,l),imageVariant:l}}class $2{constructor(e,n,l){const u=new Map,g=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(e,u,jg,_),this.addImages(n,g,2,_);const{w,h:A}=U2(_),z=new Fs({width:w||1,height:A||1});for(const[O,F]of e.entries()){const U=u.get(O).paddedRect;Fs.copy(F.data,z,{x:0,y:0},{x:U.x+jg,y:U.y+jg},F.data,null,F.sdf)}for(const[O,F]of n.entries()){const U=g.get(O),q=U.paddedRect;let Z=U.padding;const ee=q.x+Z,le=q.y+Z,oe=F.data.width,fe=F.data.height;Z=Z>1?Z-1:Z,Fs.copy(F.data,z,{x:0,y:0},{x:ee,y:le},F.data,l),Fs.copy(F.data,z,{x:0,y:fe-Z},{x:ee,y:le-Z},{width:oe,height:Z},l),Fs.copy(F.data,z,{x:0,y:0},{x:ee,y:le+fe},{width:oe,height:Z},l),Fs.copy(F.data,z,{x:oe-Z,y:0},{x:ee-Z,y:le},{width:Z,height:fe},l),Fs.copy(F.data,z,{x:0,y:0},{x:ee+oe,y:le},{width:Z,height:fe},l),Fs.copy(F.data,z,{x:oe-Z,y:fe-Z},{x:ee-Z,y:le-Z},{width:Z,height:Z},l),Fs.copy(F.data,z,{x:0,y:fe-Z},{x:ee+oe,y:le-Z},{width:Z,height:Z},l),Fs.copy(F.data,z,{x:0,y:0},{x:ee+oe,y:le+fe},{width:Z,height:Z},l),Fs.copy(F.data,z,{x:oe-Z,y:0},{x:ee-Z,y:le+fe},{width:Z,height:Z},l)}this.lut=l,this.image=z,this.iconPositions=u,this.patternPositions=g}addImages(e,n,l,u){for(const[g,_]of e.entries()){const{bin:w,imagePosition:A,imageVariant:z}=yw(g,_,l);n.set(g,A),u.push(w),_.hasRenderCallback&&this.haveRenderCallbacks.push(z.id)}}patchUpdatedImages(e,n,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((u=>e.hasImage(u,l))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const u of e.getUpdatedImages(l)){for(const g of this.iconPositions.keys()){const _=ac.parse(g);if(zs.isEqual(_.id,u)){const w=e.getImage(u,l);this.patchUpdatedImage(this.iconPositions.get(g),w,n,null)}}for(const g of this.patternPositions.keys()){const _=ac.parse(g);if(zs.isEqual(_.id,u)){const w=e.getImage(u,l);this.patchUpdatedImage(this.patternPositions.get(g),w,n,this.lut)}}}}patchUpdatedImage(e,n,l,u=null){if(!e||!n||e.version===n.version)return;e.version=n.version;const[g,_]=e.tl,w=e.sdf;if(this.lut||w){const A={width:n.data.width,height:n.data.height},z=new Fs(A);Fs.copy(n.data,z,{x:0,y:0},{x:0,y:0},A,u,w),l.update(z,{position:{x:g,y:_}})}else l.update(n.data,{position:{x:g,y:_}})}}yi(av,"ImagePosition"),yi($2,"ImageAtlas");const rv=1e20;function V2(a,e,n,l,u,g,_,w,A){for(let z=e;z<e+l;z++)H2(a,n*g+z,g,u,_,w,A);for(let z=n;z<n+u;z++)H2(a,z*g+e,1,l,_,w,A)}function H2(a,e,n,l,u,g,_){g[0]=0,_[0]=-rv,_[1]=rv,u[0]=a[e];for(let w=1,A=0,z=0;w<l;w++){u[w]=a[e+w*n];const O=w*w;do{const F=g[A];z=(u[w]-u[F]+O-F*F)/(w-F)/2}while(z<=_[A]&&--A>-1);A++,g[A]=w,_[A]=z,_[A+1]=rv}for(let w=0,A=0;w<l;w++){for(;_[A+1]<w;)A++;const z=g[A],O=w-z;a[e+w*n]=u[z]+O*O}}const mh=2,vw={none:0,ideographs:1,all:2};class O_{constructor(e,n,l){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const l=[],u=this.url||Sn.GLYPHS_URL;for(const g in e)for(const _ of e[g])l.push({stack:g,id:_});Fe(l,(({stack:g,id:_},w)=>{let A=this.entries[g];A||(A=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let z=A.glyphs[_];if(z!==void 0)return void w(null,{stack:g,id:_,glyph:z});if(z=this._tinySDF(A,g,_),z)return A.glyphs[_]=z,void w(null,{stack:g,id:_,glyph:z});const O=Math.floor(_/256);if(256*O>65535)return mi("glyphs > 65535 not supported"),void w(null,{stack:g,id:_,glyph:z});if(A.ranges[O])return void w(null,{stack:g,id:_,glyph:z});let F=A.requests[O];F||(F=A.requests[O]=[],O_.loadGlyphRange(g,O,u,this.requestManager,((U,q)=>{if(q){A.ascender=q.ascender,A.descender=q.descender;for(const Z in q.glyphs)this._doesCharSupportLocalGlyph(+Z)||(A.glyphs[+Z]=q.glyphs[+Z]);A.ranges[O]=!0}for(const Z of F)Z(U,q);delete A.requests[O]}))),F.push(((U,q)=>{U?w(U):q&&w(null,{stack:g,id:_,glyph:q.glyphs[_]||null})}))}),((g,_)=>{if(g)n(g);else if(_){const w={};for(const{stack:A,id:z,glyph:O}of _)w[A]===void 0&&(w[A]={}),w[A].glyphs===void 0&&(w[A].glyphs={}),w[A].glyphs[z]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},w[A].ascender=this.entries[A].ascender,w[A].descender=this.entries[A].descender;n(null,w)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==vw.none&&(this.localGlyphMode===vw.all?!!this.localFontFamily:!!this.localFontFamily&&(Hi["CJK Unified Ideographs"](e)||Hi["Hangul Syllables"](e)||Hi.Hiragana(e)||Hi.Katakana(e)||Hi["CJK Symbols and Punctuation"](e)||Hi["CJK Unified Ideographs Extension A"](e)||Hi["CJK Unified Ideographs Extension B"](e)||Hi.Osage(e)))}_tinySDF(e,n,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let g=e.tinySDF;if(!g){let ee="400";/bold/i.test(n)?ee="900":/medium/i.test(n)?ee="500":/light/i.test(n)&&(ee="200"),g=e.tinySDF=new O_.TinySDF({fontFamily:u,fontWeight:ee,fontSize:24*mh,buffer:3*mh,radius:8*mh}),g.fontWeight=ee}if(this.localGlyphs[g.fontWeight][l])return this.localGlyphs[g.fontWeight][l];const _=String.fromCodePoint(l),{data:w,width:A,height:z,glyphWidth:O,glyphHeight:F,glyphLeft:U,glyphTop:q,glyphAdvance:Z}=g.draw(_);return this.localGlyphs[g.fontWeight][l]={id:l,bitmap:new hr({width:A,height:z},w),metrics:{width:O/mh,height:F/mh,left:U/mh,top:q/mh-27,advance:Z/mh,localGlyph:!0}}}}O_.loadGlyphRange=function(a,e,n,l,u){const g=256*e,_=g+255,w=l.transformRequest(l.normalizeGlyphsURL(n).replace("{fontstack}",a).replace("{range}",`${g}-${_}`),mc.Glyphs);Ro(w,((A,z)=>{if(A)u(A);else if(z){const O={},F=(function(U){return new Kx(U).readFields(lz,{})})(z);for(const U of F.glyphs)O[U.id]=U;u(null,{glyphs:O,ascender:F.ascender,descender:F.descender})}}))},O_.TinySDF=class{constructor({fontSize:a=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:g="normal",fontStyle:_="normal",lang:w=null}={}){this.buffer=e,this.cutoff=l,this.radius=n,this.lang=w;const A=this.size=a+4*e,z=this._createCanvas(A),O=this.ctx=z.getContext("2d",{willReadFrequently:!0});O.font=`${_} ${g} ${a}px ${u}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(a){const e=document.createElement("canvas");return e.width=e.height=a,e}draw(a){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:g}=this.ctx.measureText(a),_=Math.ceil(n),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-u))),A=Math.min(this.size-this.buffer,_+Math.ceil(l)),z=w+2*this.buffer,O=A+2*this.buffer,F=Math.max(z*O,0),U=new Uint8ClampedArray(F),q={data:U,width:z,height:O,glyphWidth:w,glyphHeight:A,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(w===0||A===0)return q;const{ctx:Z,buffer:ee,gridInner:le,gridOuter:oe}=this;this.lang&&(Z.lang=this.lang),Z.clearRect(ee,ee,w,A),Z.fillText(a,ee,ee+_);const fe=Z.getImageData(ee,ee,w,A);oe.fill(rv,0,F),le.fill(0,0,F);for(let _e=0;_e<A;_e++)for(let be=0;be<w;be++){const Oe=fe.data[4*(_e*w+be)+3]/255;if(Oe===0)continue;const Ie=(_e+ee)*z+be+ee;if(Oe===1)oe[Ie]=0,le[Ie]=rv;else{const Ue=.5-Oe;oe[Ie]=Ue>0?Ue*Ue:0,le[Ie]=Ue<0?Ue*Ue:0}}V2(oe,0,0,z,O,z,this.f,this.v,this.z),V2(le,ee,ee,w,A,z,this.f,this.v,this.z);for(let _e=0;_e<F;_e++){const be=Math.sqrt(oe[_e])-Math.sqrt(le[_e]);U[_e]=Math.round(255-255*(be/this.radius+this.cutoff))}return q}};const hf=jg;function G2(a,e){return a+e[1]-e[0]}function xw(a,e,n,l,u=1){const g=[],_=a.imagePrimary,w=_.pixelRatio,A=_.paddedRect.w-2*hf,z=_.paddedRect.h-2*hf,O=(a.right-a.left)*u,F=(a.bottom-a.top)*u,U=_.stretchX||[[0,A]],q=_.stretchY||[[0,z]],Z=U.reduce(G2,0),ee=q.reduce(G2,0),le=A-Z,oe=z-ee;let fe=0,_e=Z,be=0,Oe=ee,Ie=0,Ue=le,Ge=0,et=oe;if(_.content&&l){const nt=_.content;fe=e0(U,0,nt[0]),be=e0(q,0,nt[1]),_e=e0(U,nt[0],nt[2]),Oe=e0(q,nt[1],nt[3]),Ie=nt[0]-fe,Ge=nt[1]-be,Ue=nt[2]-nt[0]-_e,et=nt[3]-nt[1]-Oe}const yt=(nt,bt,Mt,Pt)=>{const Ht=t0(nt.stretch-fe,_e,O,a.left*u),qt=i0(nt.fixed-Ie,Ue,nt.stretch,Z),Ut=t0(bt.stretch-be,Oe,F,a.top*u),$t=i0(bt.fixed-Ge,et,bt.stretch,ee),xt=t0(Mt.stretch-fe,_e,O,a.left*u),vt=i0(Mt.fixed-Ie,Ue,Mt.stretch,Z),Vt=t0(Pt.stretch-be,Oe,F,a.top*u),ai=i0(Pt.fixed-Ge,et,Pt.stretch,ee),Yt=new Pe(Ht,Ut),Di=new Pe(xt,Ut),pi=new Pe(xt,Vt),xi=new Pe(Ht,Vt),Mi=new Pe(qt/w,$t/w),An=new Pe(vt/w,ai/w),ei=e*Math.PI/180;if(ei){const Pa=Math.sin(ei),Re=Math.cos(ei),Ne=[Re,-Pa,Pa,Re];Yt._matMult(Ne),Di._matMult(Ne),xi._matMult(Ne),pi._matMult(Ne)}const zi=nt.stretch+nt.fixed,un=Mt.stretch+Mt.fixed,Hn=bt.stretch+bt.fixed,Xn=Pt.stretch+Pt.fixed,yn=a.imageSecondary;return{tl:Yt,tr:Di,bl:xi,br:pi,texPrimary:{x:_.paddedRect.x+hf+zi,y:_.paddedRect.y+hf+Hn,w:un-zi,h:Xn-Hn},texSecondary:yn?{x:yn.paddedRect.x+hf+zi,y:yn.paddedRect.y+hf+Hn,w:un-zi,h:Xn-Hn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mi,pixelOffsetBR:An,minFontScaleX:Ue/w/O,minFontScaleY:et/w/F,isSDF:n}};if(l&&(_.stretchX||_.stretchY)){const nt=q2(U,le,Z),bt=q2(q,oe,ee);for(let Mt=0;Mt<nt.length-1;Mt++){const Pt=nt[Mt],Ht=nt[Mt+1];for(let qt=0;qt<bt.length-1;qt++)g.push(yt(Pt,bt[qt],Ht,bt[qt+1]))}}else g.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:z+1}));return g}function pz(a,e){const n=a.stretchY||[[0,a.paddedRect.h-2*hf]];return e&&(a.stretchX||a.stretchY)?W2(a.stretchX||[[0,a.paddedRect.w-2*hf]])*W2(n):1}function e0(a,e,n){let l=0;for(const u of a)l+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return l}function q2(a,e,n){const l=[{fixed:-hf,stretch:0}];for(const[u,g]of a){const _=l[l.length-1];l.push({fixed:u-_.stretch,stretch:_.stretch}),l.push({fixed:u-_.stretch,stretch:_.stretch+(g-u)})}return l.push({fixed:e+hf,stretch:n}),l}function W2(a){return 2*a.length+1}function t0(a,e,n,l){return a/e*n+l}function i0(a,e,n,l){return a-e*n/l}function gz(a,e,n,l){const u=e+a.positionedLines[l].lineOffset;return l===0?n+u/2:n+(u+(e+a.positionedLines[l-1].lineOffset))/2}function _z(a,e=1,n=!1){let l=1/0,u=1/0,g=-1/0,_=-1/0;const w=a[0];for(let q=0;q<w.length;q++){const Z=w[q];(!q||Z.x<l)&&(l=Z.x),(!q||Z.y<u)&&(u=Z.y),(!q||Z.x>g)&&(g=Z.x),(!q||Z.y>_)&&(_=Z.y)}const A=Math.min(g-l,_-u);let z=A/2;const O=new tu([],yz);if(A===0)return new Pe(l,u);for(let q=l;q<g;q+=A)for(let Z=u;Z<_;Z+=A)O.push(new N_(q+z,Z+z,z,a));let F=(function(q){let Z=0,ee=0,le=0;const oe=q[0];for(let fe=0,_e=oe.length,be=_e-1;fe<_e;be=fe++){const Oe=oe[fe],Ie=oe[be],Ue=Oe.x*Ie.y-Ie.x*Oe.y;ee+=(Oe.x+Ie.x)*Ue,le+=(Oe.y+Ie.y)*Ue,Z+=3*Ue}return new N_(ee/Z,le/Z,0,q)})(a),U=O.length;for(;O.length;){const q=O.pop();(q.d>F.d||!F.d)&&(F=q,n&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,U)),q.max-F.d<=e||(z=q.h/2,O.push(new N_(q.p.x-z,q.p.y-z,z,a)),O.push(new N_(q.p.x+z,q.p.y-z,z,a)),O.push(new N_(q.p.x-z,q.p.y+z,z,a)),O.push(new N_(q.p.x+z,q.p.y+z,z,a)),U+=4)}return n&&(console.log(`num probes: ${U}`),console.log(`best distance: ${F.d}`)),F.p}function yz(a,e){return e.max-a.max}class N_{constructor(e,n,l,u){this.p=new Pe(e,n),this.h=l,this.d=(function(g,_){let w=!1,A=1/0;for(let z=0;z<_.length;z++){const O=_[z];for(let F=0,U=O.length,q=U-1;F<U;q=F++){const Z=O[F],ee=O[q];Z.y>g.y!=ee.y>g.y&&g.x<(ee.x-Z.x)*(g.y-Z.y)/(ee.y-Z.y)+Z.x&&(w=!w),A=Math.min(A,Tr(g,Z,ee))}}return(w?1:-1)*Math.sqrt(A)})(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const vz=Object.keys,bw=Number.POSITIVE_INFINITY,xz=Math.sqrt(2);function Sp(a,e,n,l,u){const g=pw(a)&&a.collisionPadding?a.collisionPadding:[0,0,0,0],_={top:a.top-g[1],bottom:a.bottom+g[3],left:a.left-g[0],right:a.right+g[2],scaled:!1};return l!==void 0&&(function(w,A){w.top*=A,w.bottom*=A,w.left*=A,w.right*=A,w.scaled=!0})(_,l),n&&(function(w,A){if(!A)return;const z=ui(A),O=new Pe(w.left,w.top),F=new Pe(w.right,w.top),U=new Pe(w.left,w.bottom),q=new Pe(w.right,w.bottom),Z=new Pe(0,0);O._rotateAround(z,Z),F._rotateAround(z,Z),U._rotateAround(z,Z),q._rotateAround(z,Z),w.left=Math.min(O.x,F.x,U.x,q.x),w.right=Math.max(O.x,F.x,U.x,q.x),w.top=Math.min(O.y,F.y,U.y,q.y),w.bottom=Math.max(O.y,F.y,U.y,q.y)})(_,n),u&&(_.left+=u[0],_.right+=u[0],_.top+=u[1],_.bottom+=u[1]),e?{top:Math.min(e.top,_.top),bottom:Math.max(e.bottom,_.bottom),left:Math.min(e.left,_.left),right:Math.max(e.right,_.right),scaled:e.scaled||_.scaled}:_}function Z2(a,[e,n]){let l=0,u=0;if(n===bw){e<0&&(e=0);const g=e/xz;switch(a){case"top-right":case"top-left":u=g-7;break;case"bottom-right":case"bottom-left":u=7-g;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(a){case"top-right":case"bottom-right":l=-g;break;case"top-left":case"bottom-left":l=g;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),a){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(a){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function bz(a,e,n,l,u,g,_,w,A,z,O,F,U,q){const Z=a.layers[0],ee=Z.appearances;if(ee.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const le={iconBBox:null,iconVerticalBBox:null},oe={textBBox:null,textVerticalBBox:null},{baseIconRotate:fe,baseTextRotate:_e,iconScaleFactor:be}=(function(Ie,Ue,Ge){const et=Ie.get("icon-rotate").evaluate(Ue,{},Ge),yt=Ie.get("text-rotate").evaluate(Ue,{},Ge),[nt,bt]=Ie.get("icon-size-scale-range");return{baseIconRotate:et,baseTextRotate:yt,iconScaleFactor:ie(1,nt,bt)}})(l,u,g);e&&(le.iconBBox=Sp(e,le.iconBBox,fe,_),n)&&(le.iconVerticalBBox=Sp(n,le.iconVerticalBBox,fe+90,_));const Oe=a0(F.horizontal);Oe&&(oe.textBBox=Sp(Oe,oe.textBBox,_e,1,q)),F.vertical&&(oe.textVerticalBBox=Sp(F.vertical,oe.textVerticalBBox,_e+90,1,q));for(const Ie of ee)Ie.hasIconProperties()&&wz(le,a,Z,Ie,u,g,w,fe,_,A,e,z,be,O),Ie.hasTextProperties()&&Sz(oe,Z,Ie,u,g,q,_e,U,Oe,F.vertical);return{iconBBox:le.iconBBox,iconVerticalBBox:le.iconVerticalBBox,textBBox:oe.textBBox,textVerticalBBox:oe.textVerticalBBox}}function wz(a,e,n,l,u,g,_,w,A,z,O,F,U,q){const{appearanceIconOffset:Z,appearanceIconRotate:ee,appearanceIconSize:le}=(function(be,Oe,Ie,Ue,Ge,et,yt,nt){const bt=be.hasProperty("icon-offset")?Oe.getAppearanceValueAndResolveTokens(be,"icon-offset",Ie,Ue,[]):null,Mt=bt&&Array.isArray(bt)?bt:Ge,Pt=be.hasProperty("icon-rotate")?Oe.getAppearanceValueAndResolveTokens(be,"icon-rotate",Ie,Ue,[]):null,Ht=typeof Pt=="number"?Pt:et,qt=be.hasProperty("icon-size")?Oe.getAppearanceValueAndResolveTokens(be,"icon-size",Ie,Ue,[]):null;return{appearanceIconOffset:Mt,appearanceIconRotate:Ht,appearanceIconSize:typeof qt=="number"?qt*nt.iconScaleFactor:yt}})(l,n,u,g,_,w,A,z);let oe=null,fe=null,_e=null;l.hasProperty("icon-image")?_e=(function(be,Oe,Ie,Ue,Ge,et,yt){let nt=null;const bt=Oe.getAppearanceValueAndResolveTokens(Ie,"icon-image",Ue,Ge,[]);if(bt){const Mt=be.getResolvedImageFromTokens(bt),Pt=Ie.getUnevaluatedProperty("icon-size"),Ht=sv(Mt,D_(be.zoom,Pt,be.worldview),Pt,Ge,be.zoom,Ue,be.pixelRatio,yt,be.worldview);nt=et.get(Ht.iconPrimary.toString())}return nt})(e,n,l,u,g,F,U):O&&(_e=O.imagePrimary),_e&&(oe=Qx(_e,null,Z,q),e.allowVerticalPlacement&&(fe=Qx(_e,null,Z,q))),oe&&(a.iconBBox=Sp(oe,a.iconBBox,ee,le)),fe&&(a.iconVerticalBBox=Sp(fe,a.iconVerticalBBox,ee+90,le))}function Sz(a,e,n,l,u,g,_,w,A,z){const{appearanceTextOffset:O,appearanceTextRotate:F,appearanceTextSize:U}=(function(Z,ee,le,oe,fe,_e,be){const Oe=Z.hasProperty("text-offset")?ee.getAppearanceValueAndResolveTokens(Z,"text-offset",le,oe,[]):null,Ie=Oe&&Array.isArray(Oe)?[Oe[0]*Bs,Oe[1]*Bs]:fe,Ue=Z.hasProperty("text-rotate")?ee.getAppearanceValueAndResolveTokens(Z,"text-rotate",le,oe,[]):null,Ge=typeof Ue=="number"?Ue:_e,et=Z.hasProperty("text-size")?ee.getAppearanceValueAndResolveTokens(Z,"text-size",le,oe,[]):null;return{appearanceTextOffset:Ie,appearanceTextRotate:Ge,appearanceTextSize:typeof et=="number"?et:be}})(n,e,l,u,g,_,w),q=U/w;A&&(a.textBBox=Sp(A,a.textBBox,F,q,O)),z&&(a.textVerticalBBox=Sp(z,a.textVerticalBBox,F+90,q,O))}function n0(a,e,n,l,u,g,_,w,A){if(!e||!e.usvg)return;const z=D2(l),O=D2(u),F=g!=="both"&&g!=="width"||!I2(l)?1:O.width/z.width,U=g!=="both"&&g!=="height"||!R2(l)?1:O.height/z.height;n.scaleSelf(F,U);const q=n.toString();_.set(q,n),w.set(q,e);const{imagePosition:Z}=yw(q,e,jg);A.set(q,Z)}function X2(a,e,n,l,u,g,_,w,A){if(!a)return;const z=(function(O,F,U,q,Z,ee){if(O.kind==="camera")return O.maxSize;if(O.kind==="composite"){const le=F.possiblyEvaluate(new Da(O.maxZoom,{worldview:ee}),U).evaluate(Z,{},U),oe=F.possiblyEvaluate(new Da(O.minZoom,{worldview:ee}),U).evaluate(Z,{},U);return Math.max(le,oe)}return F.possiblyEvaluate(new Da(q,{worldview:ee})).evaluate(Z,{},U)})(e,n,l,u,g,A);return a.scaleSelf(z*w*_)}function sv(a,e,n,l,u,g,_,w,A){return{iconPrimary:X2(a.getPrimary(),e,n,l,u,g,_,w,A),iconSecondary:X2(a.getSecondary(),e,n,l,u,g,_,w,A)}}function Tz(a,e,n){if(!e)return;const l=n.get(a.toString()),u=n.get(e.toString());l&&u&&(l.paddedRect.w===u.paddedRect.w&&l.paddedRect.h===u.paddedRect.h||mi(`Mismatch in icon variant sizes: ${a.toString()} and ${e.toString()}`),l.usvg!==u.usvg&&mi(`Mismatch in icon variant image types: ${a.id} and ${e.id}`))}function Y2(a,e,n,l){if(!a)return;const u=e.get(n.toString());if(a.imagePrimary=u,l){const g=e.get(l.toString());a.imageSecondary=g}}function kz(a,e){for(const n in a.horizontal)K2(a.horizontal[n],e);K2(a.vertical,e)}function K2(a,e){if(a){for(const n of a.positionedLines)for(const l of n.positionedGlyphs)if(l.image!==null){const u=l.image.toString();l.rect=e.get(u).paddedRect}}}function ww(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ez(a,e,n,l,u,g,_,w,A){const z=a0(g.horizontal)||g.vertical,O=n.get("icon-text-fit-padding").evaluate(l,{},u);let F,U=e;return e&&A!=="none"&&(a.allowVerticalPlacement&&g.vertical&&(F=gw(e,g.vertical,A,O,w,_)),z&&(U=gw(e,z,A,O,w,_))),{defaultShapedIcon:U,verticallyShapedIcon:F}}function Az(a,e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe,fe,_e,be,Oe,Ie,Ue){let Ge=_.textMaxSize.evaluate(e,{},U);Ge===void 0?Ge=w*_.textScaleFactor:Ge*=_.textScaleFactor;const et=a.layers[0].layout,yt=Bs,nt=w*_.textScaleFactor/yt,bt=a0(n.horizontal)||n.vertical;if(le!=="none"&&a.appearanceFeatureData&&e.index<a.appearanceFeatureData.length){const pi=a.appearanceFeatureData[e.index];pi&&(pi.textShaping=bt,pi.iconTextFitPadding=et.get("icon-text-fit-padding").evaluate(e,{},U),pi.fontScale=nt)}const Mt=q.name==="globe",Pt=a.tilePixelRatio*Ge/yt,Ht=(Vt=a.overscaling,a.zoom>18&&Vt>2&&(Vt>>=1),Math.max(Xt/(512*Vt),1)*et.get("symbol-spacing")),qt=et.get("text-padding")*a.tilePixelRatio,Ut=et.get("icon-padding")*a.tilePixelRatio,$t=ui(et.get("text-max-angle")),xt=et.get("icon-rotation-alignment")==="map"&&_e!=="point",vt=Ht/2;var Vt;a.hasAnyIconTextFit===!1&&le!=="none"&&(a.hasAnyIconTextFit=!0);const ai=e.properties?+e.properties[pt]:null,Yt=ai&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(ai):65535,Di=(pi,xi,Mi)=>{if(xi.x<0||xi.x>=Xt||xi.y<0||xi.y>=Xt)return;let An=null;if(Mt){const{x:ei,y:zi,z:un}=q.projectTilePoint(xi.x,xi.y,Mi);An={anchor:new fm(ei,zi,un,0,void 0),up:q.upVector(Mi,xi.x,xi.y)}}(function(ei,zi,un,Hn,Xn,yn,Pa,Re,Ne,wt,Gt,hi,fi,Li,Ni,_n,bn,Tn,Fn,Ji,on,ia,ua,da,ba,Na,ja,fa,va,wn,Zn,fr,Xi){const Bn=ei.addToLineVertexArray(zi,Hn);let Ra,Ua,Ya,Lr,Ha,Yi,_r,wa=0,cr=0,_s=0,Us=0,ns=-1,as=-1;const Cs={};let Kl=Xs("");const Ga=un?un.anchor:zi,Pr=fa!=="none";let Or=0,cc=0;if(Ne._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Mo=Ne.layout.get("text-offset").evaluate(on,{},ba);Or=Mo[0]*Bs,cc=Mo[1]*Bs}else Or=Ne.layout.get("text-radial-offset").evaluate(on,{},ba)*Bs,cc=bw;if(ei.allowVerticalPlacement&&Xn.vertical){const Mo=Xn.vertical;if(Ni)Yi=Sw(Mo),Re&&(_r=Sw(Re));else{const Pl=Ne.layout.get("text-rotate").evaluate(on,{},ba)+90;Ya=r0(wt,Ga,zi,Gt,hi,fi,Mo,Li,Pl,_n,fr),Re&&(Lr=r0(wt,Ga,zi,Gt,hi,fi,Re,Tn,Pl,null,Zn))}}if(yn){const Mo=ei.iconSizeData,Pl=Ne.layout.get("icon-rotate").evaluate(on,{},ba),Bc=xw(yn,Pl,ua,Pr,ia.iconScaleFactor),Ep=Re?xw(Re,Pl,ua,Pr,ia.iconScaleFactor):void 0;Ua=r0(wt,Ga,zi,Gt,hi,fi,yn,Tn,Pl,null,wn);const G_=(function(yh,Tv,gk,FI,_k,yk,BI,UI){const vk=yh.layers[0],xk=vk.appearances;let q_=Tv.length;if(gk&&(q_=Math.max(q_,gk.length)),xk.length===0)return q_;const[$I,VI]=FI.get("icon-size-scale-range"),HI=ie(1,$I,VI);for(const bk of xk){const wk=bk.getUnevaluatedProperties();if(wk._values["icon-image"].value!==void 0){const Sk=vk.getAppearanceValueAndResolveTokens(bk,"icon-image",_k,yk,[]);if(Sk){const Tk=yh.getResolvedImageFromTokens(Sk);if(Tk){const kk=wk._values["icon-size"],GI=sv(Tk,D_(yh.zoom,kk,yh.worldview),kk,yk,yh.zoom,_k,yh.pixelRatio,HI,yh.worldview),qI=BI.get(GI.iconPrimary.toString());q_=Math.max(q_,pz(qI,UI))}}}}return q_})(ei,Bc,Ep,Ne.layout,on,ba,ei.iconAtlasPositions,Pr);wa=4*G_;let _h=null;Mo.kind==="source"?(_h=[fh*Ne.layout.get("icon-size").evaluate(on,{},ba)*ia.iconScaleFactor],_h[0]>mm&&mi(`${ei.layerIds[0]}: Value for "icon-size" is >= ${ov}. Reduce your "icon-size".`)):Mo.kind==="composite"&&(_h=[fh*ia.compositeIconSizes[0].evaluate(on,{},ba)*ia.iconScaleFactor,fh*ia.compositeIconSizes[1].evaluate(on,{},ba)*ia.iconScaleFactor],(_h[0]>mm||_h[1]>mm)&&mi(`${ei.layerIds[0]}: Value for "icon-size" is >= ${ov}. Reduce your "icon-size".`)),ei.addSymbols(ei.icon,Bc,_h,Ji,Fn,on,void 0,un,zi,Bn.lineStartIndex,Bn.lineLength,-1,da,ba,Na,ja,ei.symbolInstances.length,G_),ns=ei.icon.placedSymbolArray.length-1,Ep&&(cr=4*G_,ei.addSymbols(ei.icon,Ep,_h,Ji,Fn,on,Fc.vertical,un,zi,Bn.lineStartIndex,Bn.lineLength,-1,da,ba,Na,ja,ei.symbolInstances.length,G_),as=ei.icon.placedSymbolArray.length-1)}for(const Mo in Xn.horizontal){const Pl=Mo,Bc=Xn.horizontal[Pl];Ra||(Kl=Xs(Bc.text),Ni?Ha=Sw(Bc):Ra=r0(wt,Ga,zi,Gt,hi,fi,Bc,Li,Ne.layout.get("text-rotate").evaluate(on,{},ba),_n,fr));const Ep=Bc.positionedLines.length===1;if(_s+=J2(ei,un,zi,Bc,Pa,Ne,Ni,on,_n,Bn,Xn.vertical?Fc.horizontal:Fc.horizontalOnly,Ep?vz(Xn.horizontal):[Pl],Cs,ns,ia,da,ba,ei.symbolInstances.length,Na),Ep)break}Xn.vertical&&(Us+=J2(ei,un,zi,Xn.vertical,Pa,Ne,Ni,on,_n,Bn,Fc.vertical,["vertical"],Cs,as,ia,da,ba,ei.symbolInstances.length,Na));let ys=-1;const zd=(Mo,Pl)=>Mo?Math.max(Mo,Pl):Pl;ys=zd(Ha,ys),ys=zd(Yi,ys),ys=zd(_r,ys);const ff=ys>-1?1:0;ei.glyphOffsetArray.length>=65535&&mi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),on.sortKey!==void 0&&ei.addToSortKeyRanges(ei.symbolInstances.length,on.sortKey),ei.symbolInstances.emplaceBack(zi.x,zi.y,Ga.x,Ga.y,Ga.z,Cs.right>=0?Cs.right:-1,Cs.center>=0?Cs.center:-1,Cs.left>=0?Cs.left:-1,Cs.vertical>=0?Cs.vertical:-1,ns,as,Kl,Ra!==void 0?Ra:ei.collisionBoxArray.length,Ra!==void 0?Ra+1:ei.collisionBoxArray.length,Ya!==void 0?Ya:ei.collisionBoxArray.length,Ya!==void 0?Ya+1:ei.collisionBoxArray.length,Ua!==void 0?Ua:ei.collisionBoxArray.length,Ua!==void 0?Ua+1:ei.collisionBoxArray.length,Lr||ei.collisionBoxArray.length,Lr?Lr+1:ei.collisionBoxArray.length,Gt,_s,Us,wa,cr,ff,0,Or,cc,ys,0,Pr?1:0,va)})(a,xi,An,pi,n,l,g,u,a.layers[0],a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,qt,fe,z,0,Ut,xt,oe,e,_,O,F,U,Z,ee,le,Yt,be,Oe,Ie)};if(_e==="line")for(const pi of ii(e.geometry,0,0,Xt,Xt)){const xi=mz(pi,Ht,$t,n.vertical||bt,l,yt,Pt,a.overscaling,Xt);for(const Mi of xi)bt&&Cz(a,bt.text,vt,Mi)||Di(pi,Mi,U)}else if(_e==="line-center"){for(const pi of e.geometry)if(pi.length>1){const xi=fz(pi,$t,n.vertical||bt,l,yt,Pt);xi&&Di(pi,xi,U)}}else if(e.type==="Polygon")for(const pi of bg(e.geometry,0)){const xi=_z(pi,16);Di(pi[0],new fm(xi.x,xi.y,0,0,void 0),U)}else if(e.type==="LineString")for(const pi of e.geometry)Di(pi,new fm(pi[0].x,pi[0].y,0,0,void 0),U);else if(e.type==="Point")for(const pi of e.geometry)for(const xi of pi)Di([xi],new fm(xi.x,xi.y,0,0,void 0),U)}const ov=255,mm=ov*fh;function J2(a,e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe,fe){const _e=(function(Ie,Ue,Ge,et,yt,nt,bt,Mt){const Pt=[];if(Ue.positionedLines.length===0)return Pt;const Ht=et.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,qt=(function(Vt){const ai=Vt[0],Yt=Vt[1],Di=ai*Yt;return Di>0?[ai,-Yt]:Di<0?[-ai,Yt]:ai===0?[Yt,ai]:[Yt,-ai]})(Ge);let Ut=Math.abs(Ue.top-Ue.bottom);for(const Vt of Ue.positionedLines)Ut-=Vt.lineOffset;const $t=Ue.positionedLines.length,xt=Ut/$t;let vt=Ue.top-Ge[1];for(let Vt=0;Vt<$t;++Vt){const ai=Ue.positionedLines[Vt];vt=gz(Ue,xt,vt,Vt);for(const Yt of ai.positionedGlyphs){if(!Yt.rect)continue;const Di=Yt.rect||{};let pi=A2+1,xi=!0,Mi=1,An=0;if(Yt.image){const bn=bt.get(Yt.image.toString());if(!bn)continue;if(bn.sdf){mi("SDF images are not supported in formatted text and will be ignored.");continue}xi=!1,Mi=bn.pixelRatio,pi=jg/Mi}const ei=(yt||Mt)&&Yt.vertical,zi=Yt.metrics.advance*Yt.scale/2,un=Yt.metrics,Hn=Yt.rect;if(Hn===null)continue;Mt&&Ue.verticalizable&&(An=Yt.image?zi-Yt.metrics.width*Yt.scale/2:0);const Xn=yt?[Yt.x+zi,Yt.y]:[0,0];let yn=[0,0],Pa=[0,0],Re=!1;yt||(ei?(Pa=[Yt.x+zi+qt[0],Yt.y+qt[1]-An],Re=!0):yn=[Yt.x+zi+Ge[0],Yt.y+Ge[1]-An]);const Ne=Hn.w*Yt.scale/(Mi*(Yt.localGlyph?mh:1)),wt=Hn.h*Yt.scale/(Mi*(Yt.localGlyph?mh:1));let Gt,hi,fi,Li;if(ei){const bn=Yt.y-vt,Tn=new Pe(-zi,zi-bn),Fn=-Math.PI/2,Ji=new Pe(...Pa);Gt=new Pe(-zi+yn[0],yn[1]),Gt._rotateAround(Fn,Tn)._add(Ji),Gt.x+=-bn+zi,Gt.y-=(un.left-pi)*Yt.scale;const on=Yt.image?un.advance*Yt.scale:Bs*Yt.scale,ia=String.fromCodePoint(Yt.glyph);Kj(ia)?Gt.x+=(1-pi)*Yt.scale:Jj(ia)?Gt.x+=on-un.height*Yt.scale+(-pi-1)*Yt.scale:Gt.x+=Yt.image||un.width+2*pi===Hn.w&&un.height+2*pi===Hn.h?(on-wt)/2:(on-(un.height+2*pi)*Yt.scale)/2,hi=new Pe(Gt.x,Gt.y-Ne),fi=new Pe(Gt.x+wt,Gt.y),Li=new Pe(Gt.x+wt,Gt.y-Ne)}else{const bn=(un.left-pi)*Yt.scale-zi+yn[0],Tn=(-un.top-pi)*Yt.scale+yn[1],Fn=bn+Ne,Ji=Tn+wt;Gt=new Pe(bn,Tn),hi=new Pe(Fn,Tn),fi=new Pe(bn,Ji),Li=new Pe(Fn,Ji)}if(Ht){let bn;bn=yt?new Pe(0,0):Re?new Pe(qt[0],qt[1]):new Pe(Ge[0],Ge[1]),Gt._rotateAround(Ht,bn),hi._rotateAround(Ht,bn),fi._rotateAround(Ht,bn),Li._rotateAround(Ht,bn)}const Ni=new Pe(0,0),_n=new Pe(0,0);Pt.push({tl:Gt,tr:hi,bl:fi,br:Li,texPrimary:Di,texSecondary:void 0,writingMode:Ue.writingMode,glyphOffset:Xn,sectionIndex:Yt.sectionIndex,isSDF:xi,pixelOffsetTL:Ni,pixelOffsetBR:_n,minFontScaleX:0,minFontScaleY:0})}}return Pt})(0,l,A,g,_,w,u,a.allowVerticalPlacement),be=a.textSizeData;let Oe=null;be.kind==="source"?(Oe=[fh*g.layout.get("text-size").evaluate(w,{},le)*Z.textScaleFactor],Oe[0]>mm&&mi(`${a.layerIds[0]}: Value for "text-size" is >= ${ov}. Reduce your "text-size".`)):be.kind==="composite"&&(Oe=[fh*Z.compositeTextSizes[0].evaluate(w,{},le)*Z.textScaleFactor,fh*Z.compositeTextSizes[1].evaluate(w,{},le)*Z.textScaleFactor],(Oe[0]>mm||Oe[1]>mm)&&mi(`${a.layerIds[0]}: Value for "text-size" is >= ${ov}. Reduce your "text-size".`)),a.addSymbols(a.text,_e,Oe,A,_,w,O,e,n,z.lineStartIndex,z.lineLength,q,ee,le,fe,!1,oe,_e.length);for(const Ie of F)U[Ie]=a.text.placedSymbolArray.length-1;return 4*_e.length}function a0(a){for(const e in a)return a[e];return null}function r0(a,e,n,l,u,g,_,w,A,z,O){let F,U,q,Z;if(F=O?O.top:_.top,U=O?O.bottom:_.bottom,q=O?O.left:_.left,Z=O?O.right:_.right,pw(_)&&_.collisionPadding){const ee=_.collisionPadding;q-=ee[0],F-=ee[1],Z+=ee[2],U+=ee[3]}if(A){const ee=new Pe(q,F),le=new Pe(Z,F),oe=new Pe(q,U),fe=new Pe(Z,U),_e=ui(A);let be=new Pe(0,0);z&&(be=new Pe(z[0],z[1])),ee._rotateAround(_e,be),le._rotateAround(_e,be),oe._rotateAround(_e,be),fe._rotateAround(_e,be),q=Math.min(ee.x,le.x,oe.x,fe.x),Z=Math.max(ee.x,le.x,oe.x,fe.x),F=Math.min(ee.y,le.y,oe.y,fe.y),U=Math.max(ee.y,le.y,oe.y,fe.y)}return a.emplaceBack(e.x,e.y,e.z,n.x,n.y,q,F,Z,U,w,l,u,g),a.length-1}function Sw(a){pw(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const e=a.bottom-a.top;return e>0?Math.max(10,e):null}function Cz(a,e,n,l){const u=a.compareText;if(e in u){const g=u[e];for(let _=g.length-1;_>=0;_--)if(l.dist(g[_])<n)return!0}else u[e]=[];return u[e].push(l),!1}function Q2(a,e){const n=a.fovAboveCenter,l=a.elevation?a.elevation.getMinElevationBelowMSL()*e:0,u=(a._camera.position[2]*a.worldSize-l)/Math.cos(a._pitch),g=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-a._pitch-n,.01));let _=Math.sin(a._pitch)*g+u;const w=u*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let A=Math.max(a.zoom-17,0);a.isOrthographic&&(A/=10),_*=1+A}return Math.min(1.01*_,w)}function lv(a,e){if(!e.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:e};const n=Math.pow(2,-a.z),l=a.x*n,u=(a.x+1)*n,g=a.y*n,_=(a.y+1)*n,w=V(l),A=V(u),z=Y(g),O=Y(_),F=e.project(w,z),U=e.project(A,z),q=e.project(A,O),Z=e.project(w,O);let ee=Math.min(F.x,U.x,q.x,Z.x),le=Math.min(F.y,U.y,q.y,Z.y),oe=Math.max(F.x,U.x,q.x,Z.x),fe=Math.max(F.y,U.y,q.y,Z.y);const _e=n/16;function be(Ie,Ue,Ge,et,yt,nt){const bt=(Ge+yt)/2,Mt=(et+nt)/2,Pt=e.project(V(bt),Y(Mt)),Ht=Math.max(0,ee-Pt.x,le-Pt.y,Pt.x-oe,Pt.y-fe);ee=Math.min(ee,Pt.x),oe=Math.max(oe,Pt.x),le=Math.min(le,Pt.y),fe=Math.max(fe,Pt.y),Ht>_e&&(be(Ie,Pt,Ge,et,bt,Mt),be(Pt,Ue,bt,Mt,yt,nt))}be(F,U,l,g,u,g),be(U,q,u,g,u,_),be(q,Z,u,_,l,_),be(Z,F,l,_,l,g),ee-=_e,le-=_e,oe+=_e,fe+=_e;const Oe=1/Math.max(oe-ee,fe-le);return{scale:Oe,x:ee*Oe,y:le*Oe,x2:oe*Oe,y2:fe*Oe,projection:e}}function eT(a,{x:e,y:n},l=0){return new Pe(((e-l)*a.scale-a.x)*Xt,(n*a.scale-a.y)*Xt)}const Mz=ce(new Float32Array(16));class Tp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new s(0,0)}projectTilePoint(e,n,l){return{x:e,y:n,z:0}}locationPoint(e,n,l,u=!0){return e._coordinatePoint(e.locationCoordinate(n,l),u)}pixelsPerMeter(e,n){return B(1,e)*n}pixelSpaceConversion(e,n,l){return 1}farthestPixelDistance(e){return Q2(e,e.pixelsPerMeter)}pointCoordinate(e,n,l,u){const g=e.horizonLineFromTop(!1),_=new Pe(n,Math.max(g,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,u))}pointCoordinate3D(e,n,l){const u=new Pe(n,l);if(e.elevation)return e.elevation.pointCoordinate(u);{const g=this.pointCoordinate(e,u.x,u.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const l=e.horizonLineFromTop();return n.y<l}createInversionMatrix(e,n){return Mz}createTileMatrix(e,n,l){let u,g,_;const w=l.canonical,A=ce(new Float64Array(16));if(this.isReprojectedInTileSpace){const z=lv(w,this);u=1,g=z.x+l.wrap*z.scale,_=z.y,Qe(A,A,[u/z.scale,u/z.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(w.z),g=(w.x+Math.pow(2,w.z)*l.wrap)*u,_=w.y*u;return Ee(A,A,[g,_,0]),Qe(A,A,[u/Xt,u/Xt,1]),A}upVector(e,n,l){return[0,0,1]}upVectorScale(e,n,l){return{metersToTile:1}}}class Pz extends Tp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(ui(n));this.n=(u+Math.sin(ui(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:l,c:u,r0:g}=this,_=ui(e-this.center[0]),w=ui(n),A=Math.sqrt(u-2*l*Math.sin(w))/l;return{x:A*Math.sin(_*l),y:A*Math.cos(_*l)-g,z:0}}unproject(e,n){const{n:l,c:u,r0:g}=this,_=g+n;let w=Math.atan2(e,Math.abs(_))*Math.sign(_);_*l<0&&(w-=Math.PI*Math.sign(e)*Math.sign(_));const A=ui(this.center[0])*l;w=Te(w,-Math.PI-A,Math.PI-A);const z=ie(qi(w/l)+this.center[0],-180,180),O=Math.asin(ie((u-(e*e+_*_)*l*l)/(2*l),-1,1)),F=ie(qi(O),-J,J);return new s(z,F)}}const cv=1.340264,uv=-.081106,dv=893e-6,hv=.003796,s0=Math.sqrt(3)/2;class jz extends Tp{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(s0*Math.sin(n)),u=l*l,g=u*u*u;return{x:.5*(e*Math.cos(l)/(s0*(cv+3*uv*u+g*(7*dv+9*hv*u)))/Math.PI+.5),y:1-.5*(l*(cv+uv*u+g*(dv+hv*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,u=l*l,g=u*u*u;for(let O,F,U,q=0;q<12&&(F=l*(cv+uv*u+g*(dv+hv*u))-n,U=cv+3*uv*u+g*(7*dv+9*hv*u),O=F/U,l=ie(l-O,-Math.PI/3,Math.PI/3),u=l*l,g=u*u*u,!(Math.abs(O)<1e-12));++q);const _=s0*e*(cv+3*uv*u+g*(7*dv+9*hv*u))/Math.cos(l),w=Math.asin(Math.sin(l)/s0),A=ie(180*_/Math.PI,-180,180),z=ie(180*w/Math.PI,-J,J);return new s(A,z)}}class zz extends Tp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const l=360*(e-.5),u=ie(360*(.5-n),-J,J);return new s(l,u)}}const F_=Math.PI/2;function o0(a){return Math.tan((F_+a)/2)}class Iz extends Tp{constructor(e){super(e),this.center=e.center||[0,30];const[n,l]=this.parallels=e.parallels||[30,30];let u=ui(n),g=ui(l);this.southernCenter=u+g<0,this.southernCenter&&(u=-u,g=-g);const _=Math.cos(u),w=o0(u);this.n=u===g?Math.sin(u):Math.log(_/Math.cos(g))/Math.log(o0(g)/w),this.f=_*Math.pow(o0(u),this.n)/this.n}project(e,n){n=ui(n),this.southernCenter&&(n=-n),e=ui(e-this.center[0]);const l=1e-6,{n:u,f:g}=this;g>0?n<-F_+l&&(n=-F_+l):n>F_-l&&(n=F_-l);const _=g/Math.pow(o0(n),u);let w=_*Math.sin(u*e),A=g-_*Math.cos(u*e);return w=.5*(w/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:w,y:this.southernCenter?A:1-A,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:l,f:u}=this,g=u-n,_=Math.sign(g),w=Math.sign(l)*Math.sqrt(e*e+g*g);let A=Math.atan2(e,Math.abs(g))*_;g*l<0&&(A-=Math.PI*Math.sign(e)*_);const z=ie(qi(A/l)+this.center[0],-180,180),O=ie(qi(2*Math.atan(Math.pow(u/w,1/l))-F_),-J,J);return new s(z,this.southernCenter?-O:O)}}class tT extends Tp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:j(e),y:D(n),z:0}}unproject(e,n){const l=V(e),u=Y(n);return new s(l,u)}}const iT=ui(J);class Rz extends Tp{project(e,n){const l=(n=ui(n))*n,u=l*l;return{x:.5*((e=ui(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,u=25,g=0,_=l*l;do{_=l*l;const z=_*_;g=(l*(1.007226+_*(.015085+z*(.028874*_-.044475-.005916*z)))-n)/(1.007226+_*(.045255+z*(.259866*_-.311325-.005916*11*z))),l=ie(l-g,-iT,iT)}while(Math.abs(g)>1e-6&&--u>0);_=l*l;const w=ie(qi(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),A=qi(l);return new s(w,A)}}const nT=ui(J);class Dz extends Tp{project(e,n){n=ui(n),e=ui(e);const l=Math.cos(n),u=2/Math.PI,g=Math.acos(l*Math.cos(e/2)),_=Math.sin(g)/g,w=.5*(e*u+2*l*Math.sin(e/2)/_)||0,A=.5*(n+Math.sin(n)/_)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(e,n){let l=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,g=25;const _=1e-6;let w=0,A=0;do{const z=Math.cos(u),O=Math.sin(u),F=2*O*z,U=O*O,q=z*z,Z=Math.cos(l/2),ee=Math.sin(l/2),le=2*Z*ee,oe=ee*ee,fe=1-q*Z*Z,_e=fe?1/fe:0,be=fe?Math.acos(z*Z)*Math.sqrt(1/fe):0,Oe=.5*(2*be*z*ee+2*l/Math.PI)-e,Ie=.5*(be*O+u)-n,Ue=.5*_e*(q*oe+be*z*Z*U)+1/Math.PI,Ge=_e*(le*F/4-be*O*ee),et=.125*_e*(F*ee-be*O*q*le),yt=.5*_e*(U*Z+be*oe*z)+.5,nt=Ge*et-yt*Ue;w=(Ie*Ge-Oe*yt)/nt,A=(Oe*et-Ie*Ue)/nt,l=ie(l-w,-Math.PI,Math.PI),u=ie(u-A,-nT,nT)}while((Math.abs(w)>_||Math.abs(A)>_)&&--g>0);return new s(qi(l),qi(u))}}class aT extends Tp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ui(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:l,cosPhi:u}=this;return{x:ui(e)*u*l+.5,y:-Math.sin(ui(n))/u*l+.5,z:0}}unproject(e,n){const{scale:l,cosPhi:u}=this,g=-(n-.5)/l,_=ie(qi((e-.5)/l)/u,-180,180),w=Math.asin(ie(g*u,-1,1)),A=ie(qi(w),-J,J);return new s(_,A)}}class Lz extends tT{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,l){const u=lp(e,n,l);return Fi(u,u,cp(Co(l))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n,l){const u=Wl(n.lat,n.lng),g=qn([],u),_=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;oi(u,u,g,B(1,0)*Xt*_);const w=ce(new Float64Array(16));return Se(w,e.pixelMatrix,e.globeMatrix),Fi(u,u,w),new Pe(u[0],u[1])}pixelsPerMeter(e,n){return B(1,0)*n}pixelSpaceConversion(e,n,l){const u=B(1,e)*n,g=$i(B(1,45)*n,u,l);return this.pixelsPerMeter(e,n)/g}createTileMatrix(e,n,l){const u=u_(Co(l.canonical));return Se(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:l}=e,u=cp(Co(n));return ke(u,u,ui(l.lng)),He(u,u,ui(l.lat)),Qe(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,l,u){return Cd(e,n,l,!0)||new pe(0,0)}pointCoordinate3D(e,n,l){const u=this.pointCoordinate(e,n,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!Cd(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=(function(u,g){const _=u.cameraToCenterDistance,w=u._centerAltitude*g,A=u._camera,z=u._camera.forward(),O=jt([],Ct([],z,-_),[0,0,w]),F=u.worldSize/(2*Math.PI),U=[0,0,-F],q=u.width/u.height,Z=Math.tan(u.fovAboveCenter),ee=Ct([],A.up(),Z),le=Ct([],A.right(),Z*q),oe=qn([],jt([],jt([],z,ee),le)),fe=[];let _e;if(new bi(O,oe).closestPointOnSphere(U,F,fe)){const be=jt([],fe,U),Oe=za([],be,O);_e=Math.cos(u.fovAboveCenter)*Ri(Oe)}else{const be=za([],O,U),Oe=za([],U,O);qn(Oe,Oe);const Ie=Ri(be)-F;_e=Math.sqrt(Ie*(Ie+2*F));const Ue=Math.acos(_e/(F+Ie))-Math.acos(On(z,Oe));_e*=Math.cos(Ue)}return 1.01*_e})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Md(e.zoom);if(l>0){const u=Q2(e,B(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return $i(n,u+g*(1-Math.cos(_)),Math.pow(l,10))}return n}upVector(e,n,l){return lp(n,l,e,1)}upVectorScale(e){return{metersToTile:Xl(hg(Co(e)))}}}function rT(a){const e=a.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(a.name){case"mercator":return new tT(a);case"equirectangular":return new zz(a);case"naturalEarth":return new Rz(a);case"equalEarth":return new jz(a);case"winkelTripel":return new Dz(a);case"albers":return n?new aT(a):new Pz(a);case"lambertConformalConic":return n?new aT(a):new Iz(a);case"globe":return new Lz(a)}throw new Error(`Invalid projection name: ${a.name}`)}const Oz=Ye.types,Nz=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fv(a,e,n,l,u,g,_,w,A,z,O,F,U){const q=w?Math.min(mm,Math.round(w[0])):0,Z=w?Math.min(mm,Math.round(w[1])):0;a.emplaceBack(e,n,Math.round(32*l),Math.round(32*u),g,_,(q<<1)+(A?1:0),0+(Z<<1),16*z,16*O,256*F,256*U)}function mv(a,e,n){a.emplaceBack(e,n)}function pv(a,e,n,l,u,g,_){a.emplaceBack(e,n,l,u,g,_)}const l0=(a,e,n,l)=>{for(let u=0;u<e;u++)a.emplaceBack(n[0],n[1],n[2],l[0],l[1],l[2])};function B_(a,e,n,l,u){a.emplaceBack(e,n,l,u),a.emplaceBack(e,n,l,u),a.emplaceBack(e,n,l,u),a.emplaceBack(e,n,l,u)}function Fz(a){for(const e of a.sections)if(Kp(e.text))return!0;return!1}class Tw{constructor(e){this.layoutVertexArray=new qh,this.indexArray=new Wr,this.programConfigurations=e,this.segments=new tr,this.dynamicLayoutVertexArray=new uu,this.opacityVertexArray=new Xf,this.placedSymbolArray=new lg,this.iconTransitioningVertexArray=new Tl,this.globeExtVertexArray=new Zf,this.zOffsetVertexArray=new bl,this.orientationVertexArray=new Kf,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,n){const l=[],u=this.layoutVertexArray.uint16;for(let g=0;g<n;++g){const _=12*(e+g);l.push(...u.slice(_,_+12))}return l}updateIconVertexData(e,n,l,u,g,_,w,A,z,O,F,U,q){const Z=this.layoutVertexArray.uint16,ee=12*e;Z[ee]=n,Z[ee+1]=l,Z[ee+2]=u,Z[ee+3]=g,Z[ee+4]=_,Z[ee+5]=w,Z[ee+6]=A,Z[ee+7]=z,Z[ee+8]=O,Z[ee+9]=F,Z[ee+10]=U,Z[ee+11]=q}upload(e,n,l,u,g,_){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Uj.members,!!_),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Vj.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Nz,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,qj.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$j.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Hj.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,Gj.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}yi(Tw,"SymbolBuffers");class kw{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new tr,this.collisionVertexArray=new Xm,this.collisionVertexArrayExt=new uu}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Wj.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Zj.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yi(kw,"CollisionBuffers");class c0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((_=>_.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ce([]),this.placementViewportMatrix=ce([]);const n=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=D_(this.zoom,n["text-size"],this.worldview),this.iconSizeData=D_(this.zoom,n["icon-size"],this.worldview);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),g=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map((_=>Fc[_])),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const n=this.layers[0].getAppearances();return!(!n||n.length===0)&&n.some((l=>l.getProperty(e)!=null))}createArrays(){this.text=new Tw(new zc(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new Tw(new zc(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new Wh,this.lineVertexArray=new tp,this.symbolInstances=new tm}calculateGlyphDependencies(e,n,l,u,g){for(const _ of e){const w=_.codePointAt(0);if(w===void 0)break;if(n[w]=!0,u&&g&&w<=65535){const A=iv[_];A&&(n[A.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,n,l,u,g,_){let w=1;const A=e.getUnevaluatedProperties()._values["icon-size"],z=D_(this.zoom,A,this.worldview),O=L_(z,n);if(z.kind!=="constant"&&z.kind!=="camera"||(w=O.uSize),z.kind==="composite"){const{minZoom:F,maxZoom:U}=z,q=A.possiblyEvaluate(new Da(F,{worldview:this.worldview}),u),Z=A.possiblyEvaluate(new Da(U,{worldview:this.worldview}),u),ee=q.evaluate(l,{},u,g);w=ee+(Z.evaluate(l,{},u,g)-ee)*O.uSizeT}return z.kind==="source"&&(w=A.possiblyEvaluate(new Da(this.zoom,{worldview:this.worldview}),u).evaluate(l,{},u,g)),w*_}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!pp(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?ro.build(e):e}populate(e,n,l,u){const g=this.layers[0],_=g.layout,w=this.projection.name==="globe",A=_.get("text-font"),z=_.get("text-field"),O=_.get("icon-image"),[F,U]=_.get("icon-size-scale-range"),q=ie(n.scaleFactor||1,F,U),Z=(z.value.kind!=="constant"||z.value.value instanceof ls&&!z.value.value.isEmpty()||z.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),ee=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,le=this.hasAnyAppearanceProperty("icon-image"),oe=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!Z&&!ee&&!le)return;const fe=n.iconDependencies,_e=n.glyphDependencies,be=n.availableImages,Oe=new Da(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),Ie=Ue=>{const Ge=Ue.id.toString();fe.has(Ge)?fe.get(Ge).push(Ue):fe.set(Ge,[Ue])};for(const Ue of e){const{feature:Ge,id:et,index:yt,sourceLayerIndex:nt}=Ue,bt=g._featureFilter.needGeometry,Mt=it(Ge,bt);if(!g._featureFilter.filter(Oe,Mt,l))continue;if(bt||(Mt.geometry=Ve(Ge,l,u)),w&&Ge.type!==1&&l.z<=5){const Vt=Mt.geometry,ai=.98078528056,Yt=(Di,pi)=>On(lp(Di.x,Di.y,l,1),lp(pi.x,pi.y,l,1))<ai;for(let Di=0;Di<Vt.length;Di++)Vt[Di]=Ae(Vt[Di],Yt)}let Pt,Ht;if(Z){const Vt=g.getValueAndResolveTokens("text-field",Mt,l,be),ai=ls.factory(Vt);Fz(ai)&&(this.hasRTLText=!0),(!this.hasRTLText||Bh()==="unavailable"||this.hasRTLText&&cu.isParsed())&&(Pt=Yj(ai,g,Mt))}if(ee){const Vt=g.getValueAndResolveTokens("icon-image",Mt,l,be);Ht=this.getResolvedImageFromTokens(Vt)}const qt=this.layers[0];let Ut=!1;if(!Ht&&le){const Vt=qt.getAppearances();for(const ai of Vt)if(ai.getProperty("icon-image")){const Yt=qt.getAppearanceValueAndResolveTokens(ai,"icon-image",Mt,l,be);if(Yt){Ht=this.getResolvedImageFromTokens(Yt),Ut=!0;break}}}if(!Pt&&!Ht)continue;const $t=this.sortFeaturesByKey?oe.evaluate(Mt,{},l):void 0,xt={id:et,text:Pt,icon:Ht,index:yt,sourceLayerIndex:nt,geometry:Mt.geometry,properties:Ge.properties,type:Oz[Ge.type],sortKey:$t};if(this.features.push(xt),this.featureToAppearanceIndex[yt]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:et,properties:Ge.properties,usesAppearanceIconAsPlaceholder:Ut,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Ht){const Vt=qt._unevaluatedLayout._values,{iconPrimary:ai,iconSecondary:Yt}=sv(Ht,this.iconSizeData,Vt["icon-size"],l,this.zoom,xt,this.pixelRatio,q,this.worldview);Ie(ai),Yt&&(this.hasAnySecondaryIcon=!0,Ie(Yt))}const vt=qt.getAppearances();if(vt.length!==0&&vt.forEach((Vt=>{if(!Vt.getProperty("icon-image"))return;const ai=this.getCombinedIconPrimary(Vt,qt,Mt,l,be,xt,q);ai&&Ie(ai)})),Pt){const Vt=A.evaluate(Mt,{},l).join(","),ai=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fc.vertical)>=0;for(const Yt of Pt.sections)if(Yt.image){const Di=Yt.image.getPrimary().scaleSelf(this.pixelRatio),pi=Di.id.toString(),xi=fe.get(pi)||[];xi.push(Di),fe.set(pi,xi)}else{const Di=Qd(Pt.toString()),pi=Yt.fontStack||Vt,xi=_e[pi]=_e[pi]||{};this.calculateGlyphDependencies(Yt.text,xi,ai,this.allowVerticalPlacement,Di)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(Ue){const Ge={},et={},yt=[];let nt=0;function bt(qt){yt.push(Ue[qt]),nt++}function Mt(qt,Ut,$t){const xt=et[qt];return delete et[qt],et[Ut]=xt,yt[xt].geometry[0].pop(),yt[xt].geometry[0]=yt[xt].geometry[0].concat($t[0]),xt}function Pt(qt,Ut,$t){const xt=Ge[Ut];return delete Ge[Ut],Ge[qt]=xt,yt[xt].geometry[0].shift(),yt[xt].geometry[0]=$t[0].concat(yt[xt].geometry[0]),xt}function Ht(qt,Ut,$t){const xt=$t?Ut[0][Ut[0].length-1]:Ut[0][0];return`${qt}:${xt.x}:${xt.y}`}for(let qt=0;qt<Ue.length;qt++){const Ut=Ue[qt],$t=Ut.geometry,xt=Ut.text?Ut.text.toString():null;if(!xt){bt(qt);continue}const vt=Ht(xt,$t),Vt=Ht(xt,$t,!0);if(vt in et&&Vt in Ge&&et[vt]!==Ge[Vt]){const ai=Pt(vt,Vt,$t),Yt=Mt(vt,Vt,yt[ai].geometry);delete Ge[vt],delete et[Vt],et[Ht(xt,yt[Yt].geometry,!0)]=Yt,yt[ai].geometry=null}else vt in et?Mt(vt,Vt,$t):Vt in Ge?Pt(vt,Vt,$t):(bt(qt),Ge[vt]=nt-1,et[Vt]=nt-1)}return yt.filter((qt=>qt.geometry))})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",n.elevationFeatures){!this.elevationFeatures&&n.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ue of n.elevationFeatures)this.elevationFeatureIdToIndex.set(Ue.id,this.elevationFeatures.length),this.elevationFeatures.push(Ue)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Ue,Ge)=>Ue.sortKey-Ge.sortKey))}getCombinedIconPrimary(e,n,l,u,g,_,w){let A,z;const O=e.getUnevaluatedProperties();if(O._values["icon-image"].value!==void 0){const F=n.getAppearanceValueAndResolveTokens(e,"icon-image",l,u,g);A=this.getResolvedImageFromTokens(F)}else{const F=n.getValueAndResolveTokens("icon-image",l,u,g);A=this.getResolvedImageFromTokens(F)}if(A){const F=O._values["icon-size"]||n._unevaluatedLayout._values["icon-size"];z=sv(A,D_(this.zoom,F,this.worldview),F,u,this.zoom,_,this.pixelRatio,w,this.worldview).iconPrimary}return z}updateAppearanceBasedIconTextures(e,n,l,u){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const g=this.layers[0];let _=!1,w=0;const A=g.layout,[z,O]=A.get("icon-size-scale-range"),F=ie(1,z,O);for(let U=0;U<this.symbolInstances.length;U++){const q=this.symbolInstances.get(U),Z=this.featureToAppearanceIndex[q.featureIndex],ee=Z!==void 0?this.appearanceFeatureData[Z]:void 0;if(ee&&q.placedIconSymbolIndex>=0){const le=ee.id,oe=n&&le!==void 0?n[String(le)]:void 0,fe={type:"Point",id:ee.id,properties:ee.properties,geometry:[]},_e=this.layers[0].appearances&&this.layers[0].appearances.find((be=>be.isActive({globals:u,feature:fe,canonical:e,featureState:oe})));if(ee.activeAppearance===_e){w+=q.numIconVertices;continue}if(_e){ee.activeAppearance=_e;const be=this.getCombinedIconPrimary(_e,g,fe,e,l,{sortKey:void 0,text:void 0,icon:null,index:q.featureIndex,sourceLayerIndex:q.featureIndex,geometry:[],properties:ee.properties,type:"Point",id:ee.id},F);if(!be)continue;const Oe=be.toString(),Ie=this.iconAtlasPositions&&this.iconAtlasPositions.get(Oe);if(Ie){const Ue=g.getAppearanceValueAndResolveTokens(_e,"icon-offset",fe,e,l),Ge=Ue&&Array.isArray(Ue)?Ue:[0,0];let et=Qx(Ie,void 0,Ge,g.layout.get("icon-anchor").evaluate(fe,{},e));const yt=g.getAppearanceValueAndResolveTokens(_e,"icon-rotate",fe,e,l),nt=typeof yt=="number"?yt:0,bt=Ie.sdf,Mt=g.layout.get("icon-text-fit").constantOr("none");Mt!=="none"&&ee.textShaping&&ee.iconTextFitPadding&&ee.fontScale&&(et=gw(et,ee.textShaping,Mt,ee.iconTextFitPadding,Ge,ee.fontScale));const Pt=this.calculateEffectiveAppearanceIconSize(_e,u.zoom,fe,e,l,F),Ht=0,qt=1+(Math.min(mm,Math.round(Pt*fh))<<1),Ut=xw(et,nt,bt,Mt!=="none",F);ee.isUsingAppearanceVertexData||(ee.isUsingAppearanceVertexData=!0,ee.layoutBasedVertexData=this.icon.getIconVertexData(w,q.numIconVertices));for(let xt=0;xt<Ut.length;++xt){const vt=Ut[xt],Vt=ee.layoutBasedVertexData[0]||q.tileAnchorX,ai=ee.layoutBasedVertexData[1]||q.tileAnchorY,Yt=16*vt.pixelOffsetTL.x,Di=16*vt.pixelOffsetTL.y,pi=16*vt.pixelOffsetBR.x,xi=16*vt.pixelOffsetBR.y,Mi=16*vt.minFontScaleX,An=16*vt.minFontScaleY;this.icon.updateIconVertexData(w,Vt,ai,Math.round(32*vt.tl.x),Math.round(32*vt.tl.y),vt.texPrimary.x,vt.texPrimary.y,Ht,qt,Yt,Di,Mi,An),this.icon.updateIconVertexData(w+1,Vt,ai,Math.round(32*vt.tr.x),Math.round(32*vt.tr.y),vt.texPrimary.x+vt.texPrimary.w,vt.texPrimary.y,Ht,qt,pi,Di,Mi,An),this.icon.updateIconVertexData(w+2,Vt,ai,Math.round(32*vt.bl.x),Math.round(32*vt.bl.y),vt.texPrimary.x,vt.texPrimary.y+vt.texPrimary.h,Ht,qt,Yt,xi,Mi,An),this.icon.updateIconVertexData(w+3,Vt,ai,Math.round(32*vt.br.x),Math.round(32*vt.br.y),vt.texPrimary.x+vt.texPrimary.w,vt.texPrimary.y+vt.texPrimary.h,Ht,qt,pi,xi,Mi,An),w+=4}const $t=q.numIconVertices-4*Ut.length;for(let xt=0;xt<$t;++xt)this.icon.updateIconVertexData(w+xt,0,0,0,0,0,0,0,0,0,0,0,0);_=!0}else w+=q.numIconVertices}else if(ee.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(w,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+3,0,0,0,0,0,0,0,0,0,0,0,0),_=!0),w+=q.numIconVertices,ee.activeAppearance=null;else if(ee.isUsingAppearanceVertexData){const Oe=ee.layoutBasedVertexData.length/12;for(let Ie=0;Ie<Oe;++Ie){const Ue=Ie*12;this.icon.updateIconVertexData(w+Ie,ee.layoutBasedVertexData[Ue+0],ee.layoutBasedVertexData[Ue+1],ee.layoutBasedVertexData[Ue+2],ee.layoutBasedVertexData[Ue+3],ee.layoutBasedVertexData[Ue+4],ee.layoutBasedVertexData[Ue+5],ee.layoutBasedVertexData[Ue+6],ee.layoutBasedVertexData[Ue+7],ee.layoutBasedVertexData[Ue+8],ee.layoutBasedVertexData[Ue+9],ee.layoutBasedVertexData[Ue+10],ee.layoutBasedVertexData[Ue+11])}w+=Oe,ee.isUsingAppearanceVertexData=!1,ee.activeAppearance=null,_=!0}else w+=q.numIconVertices,ee.activeAppearance=null}}return _}update(e,n,l,u,g,_,w){this.text.programConfigurations.updatePaintArrays(e,n,g,l,u,_,w,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,n,g,l,u,_,w,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let n=!1;const l=de(e),u=1/l;let g=!1,_=!1;for(let w=0;w<this.symbolInstances.length;w++){const A=this.symbolInstances.get(w),z=We(1,0,0),O=We(0,1,0),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:U,numIconVertices:q,numVerticalIconVertices:Z}=A,ee=F>0||U>0,le=q>0,oe=this.elevationFeatures[A.elevationFeatureIndex];if(oe){const fe=new Pe(A.tileAnchorX,A.tileAnchorY),_e=.075+oe.pointElevation(fe);A.zOffset!==_e&&(n=!0,A.zOffset=_e),_e!==0&&(this.hasAnyZOffset=!0);const be=oe.computeSlopeNormal(fe,u),Oe=Yo(Xo(),We(0,0,1),be);hn(z,z,Oe),hn(O,O,Oe),z[2]*=l,O[2]*=l,z[0]===1&&z[1]===0&&z[2]===0&&O[0]===0&&O[1]===1&&O[2]===0||(g=g||ee,_=_||le)}if(ee&&(l0(this.text.orientationVertexArray,F,z,O),l0(this.text.orientationVertexArray,U,z,O)),le){const{placedIconSymbolIndex:fe,verticalPlacedIconSymbolIndex:_e}=A;fe>=0&&l0(this.icon.orientationVertexArray,q,z,O),_e>=0&&l0(this.icon.orientationVertexArray,Z,z,O)}}g||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),n&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(g,_,w)=>{l+=_,l>g.length&&g.resize(l);for(let A=-_;A<0;A++)g.emplace(A+l,w)},n=(g,_,w)=>{u+=_,u>g.length&&g.resize(u);for(let A=-_;A<0;A++)g.emplace(A+u,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,u=0;for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:A,numIconVertices:z}=_,O=_.zOffset,F=z>0;if((w>0||A>0)&&(e(this.text.zOffsetVertexArray,w,O),e(this.text.zOffsetVertexArray,A,O)),F){const{placedIconSymbolIndex:U,verticalPlacedIconSymbolIndex:q}=_;U>=0&&n(this.icon.zOffsetVertexArray,z,O),q>=0&&n(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,O)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,n,l,u,g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((_=>_.appearances&&_.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,n,l,u){return!!(e&&n&&l)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,n,l,u)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:g}of n)this.lineVertexArray.emplaceBack(u,g);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee,le,oe,fe){const _e=e.indexArray,be=e.layoutVertexArray,Oe=e.globeExtVertexArray,Ie=e.segments.prepareSegment(4*fe,be,_e,this.canOverlap?_.sortKey:void 0),Ue=this.glyphOffsetArray.length,Ge=Ie.vertexLength,et=this.allowVerticalPlacement&&w===Fc.vertical?Math.PI/2:0,yt=_.text&&_.text.sections;for(let Mt=0;Mt<n.length;Mt++){const{tl:Pt,tr:Ht,bl:qt,br:Ut,texPrimary:$t,texSecondary:xt,pixelOffsetTL:vt,pixelOffsetBR:Vt,minFontScaleX:ai,minFontScaleY:Yt,glyphOffset:Di,isSDF:pi,sectionIndex:xi}=n[Mt],Mi=Ie.vertexLength,An=Di[1];if(fv(be,z.x,z.y,Pt.x,An+Pt.y,$t.x,$t.y,l,pi,vt.x,vt.y,ai,Yt),fv(be,z.x,z.y,Ht.x,An+Ht.y,$t.x+$t.w,$t.y,l,pi,Vt.x,vt.y,ai,Yt),fv(be,z.x,z.y,qt.x,An+qt.y,$t.x,$t.y+$t.h,l,pi,vt.x,Vt.y,ai,Yt),fv(be,z.x,z.y,Ut.x,An+Ut.y,$t.x+$t.w,$t.y+$t.h,l,pi,Vt.x,Vt.y,ai,Yt),A){const{x:ei,y:zi,z:un}=A.anchor,[Hn,Xn,yn]=A.up;pv(Oe,ei,zi,un,Hn,Xn,yn),pv(Oe,ei,zi,un,Hn,Xn,yn),pv(Oe,ei,zi,un,Hn,Xn,yn),pv(Oe,ei,zi,un,Hn,Xn,yn),B_(e.dynamicLayoutVertexArray,ei,zi,un,et)}else B_(e.dynamicLayoutVertexArray,z.x,z.y,z.z,et);if(le){const ei=xt||$t;mv(e.iconTransitioningVertexArray,ei.x,ei.y),mv(e.iconTransitioningVertexArray,ei.x+ei.w,ei.y),mv(e.iconTransitioningVertexArray,ei.x,ei.y+ei.h),mv(e.iconTransitioningVertexArray,ei.x+ei.w,ei.y+ei.h)}_e.emplaceBack(Mi,Mi+1,Mi+2),_e.emplaceBack(Mi+1,Mi+2,Mi+3),Ie.vertexLength+=4,Ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Di[0]),Mt!==n.length-1&&xi===n[Mt+1].sectionIndex||e.programConfigurations.populatePaintArrays(be.length,_,_.index,{},q,Z,ee,yt&&yt[xi],this.worldview)}const nt=fe-n.length;nt!==0&&this._addNullVertices(nt,be,l,A,Oe,e,le,Ie,_e);const bt=A?A.anchor:z;e.placedSymbolArray.emplaceBack(bt.x,bt.y,bt.z,z.x,z.y,Ue,this.glyphOffsetArray.length-Ue,Ge,O,F,z.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],w,0,0,0,U,0),e.symbolInstanceIndices.push(oe)}_addNullVertices(e,n,l,u,g,_,w,A,z){for(let O=0;O<e;O++){for(let U=0;U<4;U++)fv(n,0,0,0,0,0,0,l,!1,0,0,0,0),u&&pv(g,0,0,0,0,0,0),B_(_.dynamicLayoutVertexArray,0,0,0,0),w&&mv(_.iconTransitioningVertexArray,0,0);const F=A.vertexLength;z.emplaceBack(F,F+1,F+2),z.emplaceBack(F+1,F+2,F+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,n,l,u,g,_,w){e.emplaceBack(n,l,u,g,_,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,n,l,u,g,_,w){const A=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),z=A.vertexLength,O=w.tileAnchorX,F=w.tileAnchorY;for(let q=0;q<4;q++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,n,e.padding,w.zOffset),this._commitLayoutVertex(l.layoutVertexArray,u,g,_,O,F,new Pe(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,g,_,O,F,new Pe(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,g,_,O,F,new Pe(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,g,_,O,F,new Pe(e.x1,e.y2)),A.vertexLength+=4;const U=l.indexArray;U.emplaceBack(z,z+1),U.emplaceBack(z+1,z+2),U.emplaceBack(z+2,z+3),U.emplaceBack(z+3,z),A.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,l,u,g,_){for(let w=u;w<g;w++){const A=l.get(w),z=this.getSymbolInstanceTextSize(e,_,n,w);this._addCollisionDebugVertices(A,z,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,n,l,u,g,_){for(let w=u;w<g;w++){const A=l.get(w),z=this.getSymbolInstanceIconSize(e,n,_.placedIconSymbolIndex);this._addCollisionDebugVertices(A,z,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,n,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new kw(nh,S2.members,Tl),this.iconCollisionBox=new kw(nh,S2.members,Tl);const u=L_(this.iconSizeData,e),g=L_(this.textSizeData,e,l);for(let _=0;_<this.symbolInstances.length;_++){const w=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(g,e,n,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(g,e,n,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(u,e,n,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(u,e,n,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(e,n,l,u){const g=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),_=_w(this.textSizeData,e,g)/Bs;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,n,l){const u=this.icon.placedSymbolArray.get(l),g=_w(this.iconSizeData,e,u);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,n,l,u){e.emplaceBack(n,-l,-l,u),e.emplaceBack(n,l,-l,u),e.emplaceBack(n,l,l,u),e.emplaceBack(n,-l,l,u)}_updateTextDebugCollisionBoxes(e,n,l,u,g,_,w){for(let A=u;A<g;A++){const z=l.get(A),O=this.getSymbolInstanceTextSize(e,_,n,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,O,z.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(e,n,l,u,g,_,w){for(let A=u;A<g;A++){const z=l.get(A),O=this.getSymbolInstanceIconSize(e,n,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,O,z.padding,_.zOffset)}}updateCollisionDebugBuffers(e,n,l,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=L_(this.iconSizeData,e,u),_=L_(this.textSizeData,e,l);for(let w=0;w<this.symbolInstances.length;w++){const A=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(_,e,n,A.textBoxStartIndex,A.textBoxEndIndex,A,l),this._updateTextDebugCollisionBoxes(_,e,n,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,l),this._updateIconDebugCollisionBoxes(g,e,n,A.iconBoxStartIndex,A.iconBoxEndIndex,A,u),this._updateIconDebugCollisionBoxes(g,e,n,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,l,u,g,_,w,A,z){const O={};if(n<l){const{x1:F,y1:U,x2:q,y2:Z,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:_e,tileAnchorY:be,featureIndex:Oe}=e.get(n);O.textBox={x1:F,y1:U,x2:q,y2:Z,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:_e,tileAnchorY:be},O.textFeatureIndex=Oe}if(u<g){const{x1:F,y1:U,x2:q,y2:Z,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:_e,tileAnchorY:be,featureIndex:Oe}=e.get(u);O.verticalTextBox={x1:F,y1:U,x2:q,y2:Z,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:_e,tileAnchorY:be},O.verticalTextFeatureIndex=Oe}if(_<w){const{x1:F,y1:U,x2:q,y2:Z,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:_e,tileAnchorY:be,featureIndex:Oe}=e.get(_);O.iconBox={x1:F,y1:U,x2:q,y2:Z,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:_e,tileAnchorY:be},O.iconFeatureIndex=Oe}if(A<z){const{x1:F,y1:U,x2:q,y2:Z,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:_e,tileAnchorY:be,featureIndex:Oe}=e.get(A);O.verticalIconBox={x1:F,y1:U,x2:q,y2:Z,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:_e,tileAnchorY:be},O.verticalIconFeatureIndex=Oe}return O}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),u=l.vertexStartIndex+4*l.numGlyphs;for(let g=l.vertexStartIndex;g<u;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),u=[],g=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const A=this.symbolInstances.get(w);u.push(0|Math.round(n*A.tileAnchorX+l*A.tileAnchorY)),g.push(A.featureIndex)}return _.sort(((w,A)=>u[w]-u[A]||g[A]-g[w])),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:z}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),g>=0&&g!==u&&this.addIndicesForPlacedSymbol(this.text,g),_>=0&&_!==g&&_!==u&&this.addIndicesForPlacedSymbol(this.text,_),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),z>=0&&this.addIndicesForPlacedSymbol(this.icon,z)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const n=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let l;return this.elevationFeatures&&n<this.elevationFeatures.length&&(l=this.elevationFeatures[n]),l}}function sT(a,e){return e.replace(/{([^{}]+)}/g,((n,l)=>l in a?String(a[l]):""))}let oT,lT,Ew;yi(c0,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),c0.addDynamicAttributes=B_;class cT{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:fl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yi(cT,"FormatSectionOverride",{omit:["defaultValue"]});const Aw=()=>Ew||(Ew={layout:oT||(oT=new ur({"symbol-placement":new Kt(at.layout_symbol["symbol-placement"]),"symbol-spacing":new Kt(at.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Kt(at.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new si(at.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Kt(at.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Kt(at.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Kt(at.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Kt(at.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Kt(at.layout_symbol["icon-ignore-placement"]),"icon-optional":new Kt(at.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Kt(at.layout_symbol["icon-rotation-alignment"]),"icon-size":new si(at.layout_symbol["icon-size"]),"icon-size-scale-range":new Kt(at.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new si(at.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new si(at.layout_symbol["icon-text-fit-padding"]),"icon-image":new si(at.layout_symbol["icon-image"]),"icon-image-use-theme":new Kt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new si(at.layout_symbol["icon-rotate"]),"icon-padding":new Kt(at.layout_symbol["icon-padding"]),"icon-keep-upright":new Kt(at.layout_symbol["icon-keep-upright"]),"icon-offset":new si(at.layout_symbol["icon-offset"]),"icon-anchor":new si(at.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Kt(at.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Kt(at.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Kt(at.layout_symbol["text-rotation-alignment"]),"text-field":new si(at.layout_symbol["text-field"]),"text-font":new si(at.layout_symbol["text-font"]),"text-size":new si(at.layout_symbol["text-size"]),"text-size-scale-range":new Kt(at.layout_symbol["text-size-scale-range"]),"text-max-width":new si(at.layout_symbol["text-max-width"]),"text-line-height":new si(at.layout_symbol["text-line-height"]),"text-letter-spacing":new si(at.layout_symbol["text-letter-spacing"]),"text-justify":new si(at.layout_symbol["text-justify"]),"text-radial-offset":new si(at.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Kt(at.layout_symbol["text-variable-anchor"]),"text-anchor":new si(at.layout_symbol["text-anchor"]),"text-max-angle":new Kt(at.layout_symbol["text-max-angle"]),"text-writing-mode":new Kt(at.layout_symbol["text-writing-mode"]),"text-rotate":new si(at.layout_symbol["text-rotate"]),"text-padding":new Kt(at.layout_symbol["text-padding"]),"text-keep-upright":new Kt(at.layout_symbol["text-keep-upright"]),"text-transform":new si(at.layout_symbol["text-transform"]),"text-offset":new si(at.layout_symbol["text-offset"]),"text-allow-overlap":new Kt(at.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Kt(at.layout_symbol["text-ignore-placement"]),"text-optional":new Kt(at.layout_symbol["text-optional"]),visibility:new Kt(at.layout_symbol.visibility)})),paint:lT||(lT=new ur({"icon-opacity":new si(at.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new si(at.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new si(at.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new si(at.paint_symbol["text-emissive-strength"]),"icon-color":new si(at.paint_symbol["icon-color"]),"icon-halo-color":new si(at.paint_symbol["icon-halo-color"]),"icon-halo-width":new si(at.paint_symbol["icon-halo-width"]),"icon-halo-blur":new si(at.paint_symbol["icon-halo-blur"]),"icon-translate":new Kt(at.paint_symbol["icon-translate"]),"icon-translate-anchor":new Kt(at.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Kt(at.paint_symbol["icon-image-cross-fade"]),"text-opacity":new si(at.paint_symbol["text-opacity"]),"text-occlusion-opacity":new si(at.paint_symbol["text-occlusion-opacity"]),"text-color":new si(at.paint_symbol["text-color"],{runtimeType:Ys,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new si(at.paint_symbol["text-halo-color"]),"text-halo-width":new si(at.paint_symbol["text-halo-width"]),"text-halo-blur":new si(at.paint_symbol["text-halo-blur"]),"text-translate":new Kt(at.paint_symbol["text-translate"]),"text-translate-anchor":new Kt(at.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Kt(at.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Kt(at.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Kt(at.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Kt(at.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new si(at.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},Ew);class u0 extends ko{constructor(e,n,l,u){super(e,Aw(),n,l,u,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=ce([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,n){super.recalculate(e,n),this.appearances&&this.appearances.forEach((u=>{u.recalculate(e,n,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const g of l)u.indexOf(g)<0&&u.push(g);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,l,u){return this._saturation===e&&this._contrast===n&&this._brightnessMin===l&&this._brightnessMax===u||(this._colorAdjustmentMatrix=(function(g,_,w,A){g=ea(g),_=an(_);const z=re(),O=g/3,F=1-2*O,U=[F,O,O,0,O,F,O,0,O,O,F,0,0,0,0,1],q=.5-.5*_,Z=A-w;return Se(z,[Z,0,0,0,0,Z,0,0,0,0,Z,0,w,w,w,1],[_,0,0,0,0,_,0,0,0,0,_,0,q,q,q,1]),Se(z,z,U),z})(e,n,l,u),this._saturation=e,this._contrast=n,this._brightnessMin=l,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,l,u){const g=this.layout.get(e).evaluate(n,{},l,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Gr(_.value)||!g?g:sT(n.properties,g)}getAppearanceValueAndResolveTokens(e,n,l,u,g){const _=e.getProperty(n);if(!_)return;const w=_.evaluate(l,{},u,g),A=e.getUnevaluatedProperties()._values[n];return A.isDataDriven()||Gr(A.value)||!w||typeof w!="string"?w:sT(l.properties,w)}createBucket(e){return new c0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Aw().paint.overridableProperties){if(!u0.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new cT(n),u=new Nm(l,n.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new _d("source",u):new yd("composite",u,n.value.zoomStops,n.value.interpolationType),this.paint._values[e]=new Ac(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&u0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),u=Aw().paint.properties[n];let g=!1;const _=w=>{for(const A of w)if(u.overrides&&u.overrides.hasOverride(A))return void(g=!0)};if(l.value.kind==="constant"&&l.value.value instanceof ls)_(l.value.value.sections);else if(l.value.kind==="source"){const w=z=>{g||(z instanceof Qo&&Hr(z.value)===Xc?_(z.value.sections):z instanceof pl?_(z.sections):z.eachChild(w))},A=l.value;A._styleExpression&&w(A._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,l){return{config:new Xr(this,{zoom:n,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let uT,dT,hT,fT;var Cw=Mn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function d0(a,e,n,l,u,g,_,w){const A=[a,e,1,n,l,1,u,g,1],z=[_,w,1],O=W([],A),[F,U,q]=nn(z,z,O);return K(A,A,[F,0,0,0,U,0,0,0,q])}function mT(a,e,n,l,u,g,_,w){const A=(function(z,O,F,U,q,Z,ee,le){const oe=d0(0,0,1,0,1,1,0,1),fe=d0(z,O,F,U,q,Z,ee,le);return K(fe,fe,W([],oe))})(a,e,n,l,u,g,_,w);return[A[2]/A[8]/Xt,A[5]/A[8]/Xt]}function h0(a){return[a[0],Math.min(Math.max(a[1],-J),J)]}class pT extends gc{constructor(e,n,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new bo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=js(this.map._requestManager.transformRequest(this.url,mc.Image),((l,u)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Ku(l)):u&&(this.image=u instanceof HTMLImageElement?xa.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Qy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new bo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Qy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],l=e[0][1];for(const g of e)g[1]>l&&(l=g[1]),g[1]<n&&(n=g[1]);const u=(l+n)/2;if(u>J?this.onNorthPole=!0:u<-J&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=e.map(pe.fromLngLat);this.tileID=(function(_){let w=1/0,A=1/0,z=-1/0,O=-1/0;for(const ee of _)w=Math.min(w,ee.x),A=Math.min(A,ee.y),z=Math.max(z,ee.x),O=Math.max(O,ee.y);const F=Math.max(z-w,O-A),U=Math.max(0,Math.floor(-Math.log2(F))),q=Math.pow(2,U);let Z=Math.floor((w+z)/2*q);return Z>1&&(Z-=1),new Ea(U,Z,Math.floor((A+O)/2*q))})(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new bo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Qy||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const oe in this.tiles){const fe=this.tiles[oe];fe.state!=="loaded"&&(fe.state="loaded",fe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=lv(new Ea(0,0,0),this.map.transform.projection),l=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(oe){const fe=oe[1].x-oe[0].x,_e=oe[1].y-oe[0].y,be=oe[2].x-oe[1].x,Oe=oe[2].y-oe[1].y,Ie=oe[3].x-oe[2].x,Ue=oe[3].y-oe[2].y,Ge=oe[0].x-oe[3].x,et=oe[0].y-oe[3].y,yt=fe*Oe-be*_e,nt=be*Ue-Ie*Oe,bt=Ie*et-Ge*Ue,Mt=Ge*_e-fe*et;return yt>0&&nt>0&&bt>0&&Mt>0||yt<0&&nt<0&&bt<0&&Mt<0})(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=lv(this.tileID,this.map.transform.projection),[g,_,w,A]=this.coordinates.map((oe=>{const fe=u.projection.project(oe[0],oe[1]);return eT(u,fe)._round()}));this.perspectiveTransform=mT(g.x,g.y,_.x,_.y,w.x,w.y,A.x,A.y);const z=this._boundsArray=new ih;z.emplaceBack(g.x,g.y,0,0),z.emplaceBack(_.x,_.y,Xt,0),z.emplaceBack(A.x,A.y,0,Xt),z.emplaceBack(w.x,w.y,Xt,Xt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(z,Cw.members),this.boundsSegments=tr.simpleSegment(0,0,4,2);const O=[],F=[h0((U=this.coordinates)[0]),h0(U[1]),h0(U[2]),h0(U[3])];var U;const[q,Z,ee,le]=(function(oe){let fe=oe[0][0],_e=fe,be=oe[0][1],Oe=be;for(let Ie=1;Ie<oe.length;Ie++)oe[Ie][0]<fe?fe=oe[Ie][0]:oe[Ie][0]>_e&&(_e=oe[Ie][0]),oe[Ie][1]<be?be=oe[Ie][1]:oe[Ie][1]>Oe&&(Oe=oe[Ie][1]);return[fe,be,_e-fe,Oe-be]})(F);{const oe=new ih,[fe,_e,be,Oe]=(function(Ut){let $t=Ut[0].x,xt=$t,vt=Ut[0].y,Vt=vt;for(let ai=1;ai<Ut.length;ai++)Ut[ai].x<$t?$t=Ut[ai].x:Ut[ai].x>xt&&(xt=Ut[ai].x),Ut[ai].y<vt?vt=Ut[ai].y:Ut[ai].y>Vt&&(Vt=Ut[ai].y);return[$t,vt,xt-$t,Vt-vt]})(l),Ie=Ut=>[(Ut.x-fe)/be,(Ut.y-_e)/Oe],[Ue,Ge,et,yt]=l.map(Ie),nt=(function(Ut,$t,xt,vt,Vt,ai,Yt,Di){const pi=d0(0,0,1,0,1,1,0,1);return K(pi,pi,W([],d0(Ut,$t,xt,vt,Vt,ai,Yt,Di)))})(Ue[0],Ue[1],Ge[0],Ge[1],et[0],et[1],yt[0],yt[1]);this.elevatedGlobePerspectiveTransform=mT(Ue[0],Ue[1],Ge[0],Ge[1],et[0],et[1],yt[0],yt[1]);const bt=(Ut,$t)=>{O.push(Ut.lng);const xt=Math.round((Ut.lng-q)/ee*Xt),vt=Math.round((Ut.lat-Z)/le*Xt),Vt=Ie($t),ai=nn([],[Vt[0],Vt[1],1],nt),Yt=Math.round(ai[0]/ai[2]*Xt),Di=Math.round(ai[1]/ai[2]*Xt);oe.emplaceBack(xt,vt,Yt,Di)},Mt=l[3].x-l[0].x,Pt=l[3].y-l[0].y,Ht=l[2].x-l[1].x,qt=l[2].y-l[1].y;for(let Ut=0;Ut<65;Ut++){const $t=Ut/64,xt=[l[0].x+$t*Mt,l[0].y+$t*Pt],vt=[l[1].x+$t*Ht,l[1].y+$t*qt],Vt=vt[0]-xt[0],ai=vt[1]-xt[1];for(let Yt=0;Yt<65;Yt++){const Di=Yt/64,pi={x:xt[0]+Vt*Di,y:xt[1]+ai*Di};bt(n.projection.unproject(pi.x,pi.y),pi)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(oe,Cw.members)}{this.maxLongitudeTriangleSize=0;let oe=[],fe=new Wr;const _e=(be,Oe,Ie)=>{fe.emplaceBack(be,Oe,Ie);const Ue=O[be],Ge=O[Oe],et=O[Ie],yt=Math.min(Math.min(Ue,Ge),et),nt=Math.max(Math.max(Ue,Ge),et)-yt;nt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=nt),oe.push(yt+nt/2)};for(let be=0;be<64;be++)for(let Oe=0;Oe<64;Oe++){const Ie=65*be+Oe,Ue=Ie+1,Ge=Ie+65,et=Ge+1;_e(Ie,Ge,Ue),_e(Ue,Ge,et)}[oe,fe]=(function(be,Oe){const Ie=Array.from({length:be.length},((et,yt)=>yt));Ie.sort(((et,yt)=>be[et]-be[yt]));const Ue=[],Ge=new Wr;for(let et=0;et<Ie.length;et++){const yt=Ie[et];Ue.push(be[yt]);const nt=3*yt,bt=nt+1;Ge.emplaceBack(Oe.uint16[nt],Oe.uint16[bt],Oe.uint16[bt+1])}return[Ue,Ge]})(oe,fe),this.elevatedGlobeTrianglesCenterLongitudes=oe,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(fe)}this.elevatedGlobeSegments=tr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ee/Xt,0,le/Xt,0,0,Z,q,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,l=n.gl;!this._dirty||this.texture instanceof Qy||(this.texture?this.texture.update(this.image):(this.texture=new Qb(n,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let u=(g=e+180)+360*Math.round((l[0]-g)/360);var g;const _=new tr,w=(F,U)=>{_.segments.push({vertexOffset:0,primitiveOffset:F,vertexLength:n.segments[0].vertexLength,primitiveLength:U,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-u)<=A){const F=fn(l,0,l.length,u+A);return F===l.length||w(F,Yn(l,F+1,l.length,u+360-A)-F),_}u<l[0]&&(u+=360);const z=Yn(l,0,l.length,u-A);if(z===l.length)return w(0,l.length),_;w(0,z-0);const O=fn(l,z+1,l.length,u+A);return O!==l.length&&w(O,l.length-O),_}}const Bz=(Math.pow(256,2)-1)/16907520;class gT extends ko{constructor(e,n,l,u){super(e,{layout:hT||(hT=new ur({visibility:new Kt(at.layout_raster.visibility)})),paint:fT||(fT=new ur({"raster-opacity":new Kt(at.paint_raster["raster-opacity"]),"raster-color":new bd(at.paint_raster["raster-color"]),"raster-color-mix":new Kt(at.paint_raster["raster-color-mix"]),"raster-color-range":new Kt(at.paint_raster["raster-color-range"]),"raster-hue-rotate":new Kt(at.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Kt(at.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Kt(at.paint_raster["raster-brightness-max"]),"raster-saturation":new Kt(at.paint_raster["raster-saturation"]),"raster-contrast":new Kt(at.paint_raster["raster-contrast"]),"raster-resampling":new Kt(at.paint_raster["raster-resampling"]),"raster-fade-duration":new Kt(at.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Kt(at.paint_raster["raster-emissive-strength"]),"raster-array-band":new Kt(at.paint_raster["raster-array-band"]),"raster-elevation":new Kt(at.paint_raster["raster-elevation"]),"raster-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},n,l,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof pT&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[l,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(u)||l===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=gg({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,u])}}let _T,yT,vT,xT,bT;class wT extends ko{constructor(e,n,l,u){super(e,{layout:_T||(_T=new ur({visibility:new Kt(at["layout_raster-particle"].visibility)})),paint:yT||(yT=new ur({"raster-particle-array-band":new Kt(at["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Kt(at["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new bd(at["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Kt(at["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Kt(at["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Kt(at["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Kt(at["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Kt(at["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},n,l,u),this._updateColorRamp(),this.lastInvalidatedAt=xa.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=gg({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=xa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Uz extends ko{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Mw(a,e,n){const l=[0,0,1],u=Kr([]);return us(u,u,n?-ui(a)+Math.PI:ui(a)),Qa(u,u,-ui(e)),hn(l,l,u),qn(l,l)}const ST={None:0,Model:1,Symbol:2,FillExtrusion:4};class f0{constructor(e,n,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function Pw(a,e){const n=a.indexOf("://")===-1;try{return new URL(a,n&&e?"http://example.com":void 0),!0}catch{return!1}}class TT{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class kT{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Jm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const n=16*e,l=this.instancedDataArray.float32;let u=Math.floor(l[n+2]);const g=1.05*(l[n+2]-u);return u/=100,[l[n]%1*1.05,l[n+1]%1*1.05,g,u]}tileCoordinatesForInstance(e){const n=16*e,l=this.instancedDataArray.float32;let u=l[n+0];return u=u>Xt?u-Xt:u,new Pe(Math.trunc(u),Math.trunc(l[n+1]))}translationForInstance(e){const n=16*e,l=this.instancedDataArray.float32;return[l[n+4],l[n+5],l[n+6]]}rotationScaleForInstance(e){const n=16*e,l=this.instancedDataArray.float32;return[l[n+7],l[n+8],l[n+9],l[n+10],l[n+11],l[n+12],l[n+13],l[n+14],l[n+15]]}transformForInstance(e){const n=16*e,l=this.instancedDataArray.float32;return[l[n+7],l[n+8],l[n+9],l[n+4],l[n+10],l[n+11],l[n+12],l[n+5],l[n+13],l[n+14],l[n+15],l[n+6],0,0,0,1]}}class jw{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,u){}populate(e,n,l,u){this.tileToMeter=de(l);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:w,index:A,sourceLayerIndex:z}of e){const O=w??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),F=it(_,g);if(!this.layers[0]._featureFilter.filter(new Da(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),F,l))continue;const U={id:O,sourceLayerIndex:z,index:A,geometry:g?F.geometry:Ve(_,l,u),properties:_.properties,type:_.type,patterns:{}},q=this.addFeature(U,U.geometry,F);q&&n.featureIndex.insert(_,U.geometry,A,z,this.index,this.instancesPerModel[q].instancedDataArray.length,Xt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,n=this.layers[0].scope;let l=0;for(const u of this.modelUris){const g=e.getModel(u,n);if(!g)continue;const _=this.instancesPerModel[u];if(_){const w=.5*Ci(g.aabb.max,g.aabb.min)*_.maxScale+_.maxXYTranslationDistance,A=Math.min(Xt,Math.max(w/this.tileToMeter,Xt/32));l=Math.max(A,l)}}return l}update(e,n,l,u){for(const g in this.instancesPerModel){const _=this.instancesPerModel[g];for(const w in e)_.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(_.features[_.idToFeaturesIndex[w]],e[w],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];for(const u of l.features){const g=this.layers[0],_=u.feature,w=this.canonical,A=g.paint.get("model-rotation").evaluate(_,{},w),z=g.paint.get("model-scale").evaluate(_,{},w),O=g.paint.get("model-translation").evaluate(_,{},w);xn(u.rotation,A)&&xn(u.scale,z)&&xn(u.translation,O)||(this.evaluate(u,u.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,n,l,u){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const g=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(pp(this.activeReplacements,g))return!1;this.activeReplacements=g;let _=!1;for(const w in this.instancesPerModel){const A=this.instancesPerModel[w],z=A.instancedDataArray;for(const O of A.features){const F=O.instancedDataOffset,U=O.instancedDataCount;for(let q=0;q<U;q++){const Z=16*(q+F);let ee=z.float32[Z+0];const le=ee>Xt;ee=le?ee-Xt:ee;const oe=Math.floor(ee),fe=Math.floor(z.float32[Z+1]);let _e=!1;for(const be of this.activeReplacements)if(!Hy(be,l,ST.Model,u)&&!(be.min.x>oe||oe>be.max.x||be.min.y>fe||fe>be.max.y)&&(_e=T_(S_(oe,fe,e.canonical,be.footprintTileId.canonical),be.footprint),_e))break;z.float32[Z]=_e?ee+Xt:ee,_=_||_e!==le}}}return _}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,uj.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(e&&n&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)n.removeModel(l,"",!0)}addFeature(e,n,l){const u=this.layers[0],g=u.layout.get("model-id").evaluate(l,{},this.canonical);if(!g)return mi(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),g;(Pw(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new kT);const _=this.instancesPerModel[g],w=_.instancedDataArray,A=new TT(l,w.length);for(const z of n)for(const O of z){if(O.x<0||O.x>=Xt||O.y<0||O.y>=Xt)continue;if(this.lookupDim!==0){const U=(this.lookupDim-1)/Xt,q=this.lookupDim*(O.y*U|0)+O.x*U|0;if(this.lookup){if(this.lookup[q]!==0)continue;this.lookup[q]=1}}this.instanceCount++;const F=w.length;w.resize(F+1),_.instancesEvaluatedElevation.push(0),w.float32[16*F]=O.x,w.float32[16*F+1]=O.y}return A.instancedDataCount=_.instancedDataArray.length-A.instancedDataOffset,A.instancedDataCount>0&&(e.id&&(_.idToFeaturesIndex[e.id]=_.features.length),_.features.push(A),this.evaluate(A,{},_,!1)),g}getModelUris(){return this.modelUris}evaluate(e,n,l,u){const g=this.layers[0],_=e.feature,w=this.canonical,A=e.rotation=g.paint.get("model-rotation").evaluate(_,n,w),z=e.scale=g.paint.get("model-scale").evaluate(_,n,w),O=e.translation=g.paint.get("model-translation").evaluate(_,n,w),F=Object.assign({},g.paint.get("model-color").evaluate(_,n,w));F.a=g.paint.get("model-color-mix-intensity").evaluate(_,n,w);const U=[];this.maxVerticalOffset<O[2]&&(this.maxVerticalOffset=O[2]);const q=O[0]*O[0]+O[1]*O[1],Z=q>0?Math.sqrt(q):0;l.maxScale=Math.max(Math.max(l.maxScale,z[0]),Math.max(z[1],z[2])),l.maxXYTranslationDistance=Math.max(l.maxXYTranslationDistance,Z),this.maxScale=Math.max(Math.max(this.maxScale,z[0]),Math.max(z[1],z[2])),i2(U,A,z);const ee=Math.round(100*F.a)+F.b/1.05;for(let le=0;le<e.instancedDataCount;++le){const oe=e.instancedDataOffset+le,fe=16*oe,_e=l.instancedDataArray.float32;let be=0;u&&(be=_e[fe+6]-l.instancesEvaluatedElevation[oe]);const Oe=0|_e[fe+1];_e[fe]=(0|_e[fe])+F.r/1.05,_e[fe+1]=Oe+F.g/1.05,_e[fe+2]=ee,_e[fe+3]=1/(w.z>10?this.tileToMeter:de(w,Oe)),_e[fe+4]=O[0],_e[fe+5]=O[1],_e[fe+6]=O[2]+be,_e[fe+7]=U[0],_e[fe+8]=U[1],_e[fe+9]=U[2],_e[fe+10]=U[4],_e[fe+11]=U[5],_e[fe+12]=U[6],_e[fe+13]=U[8],_e[fe+14]=U[9],_e[fe+15]=U[10],l.instancesEvaluatedElevation[oe]=O[2]}}}let ET,AT;yi(jw,"ModelBucket",{omit:["layers"]}),yi(kT,"PerModelAttributes"),yi(TT,"ModelFeature");class U_{constructor(e,n,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=l}static create(e,n,l){const u=l||e.findDEMTileFor(n);if(!u||!u.dem)return;const g=u.dem,_=u.tileID,w=1<<n.canonical.z-_.canonical.z;return new U_(u,g.dim/Xt/w,[(n.canonical.x/w-_.canonical.x)*g.dim,(n.canonical.y/w-_.canonical.y)*g.dim])}tileCoordToPixel(e,n){const l=n*this._scale+this._offset[1];return new Pe(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,n,l,u){const g=e*this._scale+this._offset[0],_=n*this._scale+this._offset[1],w=Math.floor(g),A=Math.floor(_),z=this._dem;return u=!!u,l?$i($i(z.get(w,A,u),z.get(w,A+1,u),_-A),$i(z.get(w+1,A,u),z.get(w+1,A+1,u),_-A),g-w):z.get(w,A,u)}getElevationAtPixel(e,n,l){return this._dem.get(e,n,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*B(1,e)*this._dem.stride}}const zw=new Float32Array(262144),zg=new Uint8Array(262144);function CT(a){let e=0;if(a.meshes)for(const n of a.meshes)e=Math.max(e,n.aabb.max[2]);if(a.children)for(const n of a.children)e=Math.max(e,CT(n));return e}function MT(a,e,n){if(a.meshes)for(const l of a.meshes){if(l.aabb.min[0]===1/0)continue;const u=wi.applyTransform(l.aabb,a.globalMatrix);n.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(a.children)for(const l of a.children)MT(l,e,n)}const PT=["","wall","door","roof","window","lamp","logo"];class jT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:CT(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=wi.applyTransformFast(l.aabb,this.node.globalMatrix),n.encapsulate(l.transformedAabb)),e++;this.aabb=n}return this.aabb}}class m0{constructor(e,n,l,u,g,_,w,A){this.id=l,this.layers=e,this.layerIds=this.layers.map((z=>z.fqid)),this.stateDependentLayerIds=this.layers.filter((z=>z.isStateDependent())).map((z=>z.id)),this.modelTraits|=z_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=z_.HasMapboxMeshFeatures),g&&(this.modelTraits|=z_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=A,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const z of n)this.nodesInfo.push(new jT(z)),MT(z,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,n){for(const l of this.getNodesInfo()){const u=l.node;u.footprint&&n.push({footprint:u.footprint,id:e})}}updateAppearances(e,n,l,u){}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const l=n?this.stateDependentLayers:this.layers;if(!zt(e,this.states))for(const u of l)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const l of n){const u=l.node;this.uploaded?this.updatePbrBuffer(u):iw(u,e,!0)}for(const l of n)Xx(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),n=!0);return n}needsReEvaluation(e,n,l){const u=e.transform.projectionOptions,g=e.style.getBrightness(),_=this.brightness!==g;if(!this.uploaded||this.dirty||u.name!==this.projection.name||gv(l.paint.get("model-color").value,_)||gv(l.paint.get("model-color-mix-intensity").value,_)||gv(l.paint.get("model-roughness").value,_)||gv(l.paint.get("model-emissive-strength").value,_)||gv(l.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=u,this.brightness=g;const w=this.getNodesInfo();for(const A of w)A.state=null;return!0}return!1}evaluateTransform(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),u=this.id.canonical;for(const g of l){const _=g.feature;g.evaluatedTranslation=n.paint.get("model-translation").evaluate(_,{},u),g.evaluatedScale=n.paint.get("model-scale").evaluate(_,{},u)}}evaluate(e,n){const l=this.getNodesInfo();for(const u of l){if(!u.node.meshes)continue;const g=u.feature,_=n&&n[g.id];if(zt(_,u.state))continue;u.state=structuredClone(_);const w=u.node.meshes&&u.node.meshes[0].featureData,A=u.evaluatedColor[2],z=u.evaluatedRMEA[2],O=this.id.canonical;if(u.hasTranslucentParts=!1,w){for(let F=0;F<PT.length;F++){const U=PT[F];U.length&&(g.properties.part=U);const q=e.paint.get("model-color").evaluate(g,_,O).toPremultipliedRenderColor(null),Z=e.paint.get("model-color-mix-intensity").evaluate(g,_,O);u.evaluatedColor[F]=[q.r,q.g,q.b,Z],u.evaluatedRMEA[F][0]=e.paint.get("model-roughness").evaluate(g,_,O),u.evaluatedRMEA[F][2]=e.paint.get("model-emissive-strength").evaluate(g,_,O),u.evaluatedRMEA[F][3]=q.a,u.emissionHeightBasedParams[F]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,_,O),!u.hasTranslucentParts&&q.a<1&&(u.hasTranslucentParts=!0)}delete g.properties.part,Vz(u,A!==u.evaluatedColor[2]||z!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(g,_,O);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(g,_,O),u.evaluatedScale=e.paint.get("model-scale").evaluate(g,_,O),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,l,u){const g=e.findDEMTileFor(l);if(g&&(g.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const _=U_.create(e,l,g);if(!_)return;this.modelTraits&z_.HasMapboxMeshFeatures&&this.updateDEM(e,_,l,u);for(const w of this.getNodesInfo()){const A=w.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const z=A.footprint.vertices;let O=_.getElevationAt(z[0].x,z[0].y,!0,!0);for(let F=1;F<z.length;F++)O=Math.min(O,_.getElevationAt(z[F].x,z[F].y,!0,!0));A.elevation=O}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,l,u){let g=n._dem._modifiedForSources[u];if(g===void 0&&(n._dem._modifiedForSources[u]=[],g=n._dem._modifiedForSources[u]),g.includes(l.canonical))return;const _=n._dem.dim;g.push(l.canonical);let w=!1;for(const A of this.getNodesInfo()){const z=A.node;if(!z.footprint||!z.footprint.grid)continue;const O=z.footprint.grid,F=n.tileCoordToPixel(O.min.x,O.min.y),U=n.tileCoordToPixel(O.max.x,O.max.y),q=Math.min(Math.min(_-U.y,F.x),Math.min(F.y,_-U.x));if(q<0)continue;const Z=ie(q,2,5);let ee=Math.max(0,F.x-Z),le=Math.max(0,F.y-Z),oe=Math.min(U.x+Z,_-1),fe=Math.min(U.y+Z,_-1);for(let Ie=le;Ie<=fe;++Ie)for(let Ue=ee;Ue<=oe;++Ue)zg[Ie*_+Ue]=255;let _e=0,be=0;for(let Ie=0;Ie<O.cellsY;++Ie)for(let Ue=0;Ue<O.cellsX;++Ue){if(!O.cells[Ie*O.cellsX+Ue])continue;const Ge=n.tileCoordToPixel(O.min.x+Ue/O.xScale,O.min.y+Ie/O.yScale),et=n.tileCoordToPixel(O.min.x+(Ue+1)/O.xScale,O.min.y+(Ie+1)/O.yScale);for(let yt=Ge.y;yt<=Math.min(et.y+1,_-1);++yt)for(let nt=Ge.x;nt<=Math.min(et.x+1,_-1);++nt)zg[yt*_+nt]===255&&(zg[yt*_+nt]=0,_e+=n.getElevationAtPixel(nt,yt),be++)}const Oe=_e/be;ee=Math.max(1,F.x-Z),le=Math.max(1,F.y-Z),oe=Math.min(U.x+Z,_-2),fe=Math.min(U.y+Z,_-2),w=!0;for(let Ie=le;Ie<=fe;++Ie)for(let Ue=ee;Ue<=oe;++Ue)zg[Ie*_+Ue]===0&&(zw[Ie*_+Ue]=n._dem.set(Ue,Ie,Oe));for(let Ie=1;Ie<Z;++Ie){ee=Math.max(1,F.x-Ie),le=Math.max(1,F.y-Ie),oe=Math.min(U.x+Ie,_-2),fe=Math.min(U.y+Ie,_-2);for(let Ue=le;Ue<=fe;++Ue)for(let Ge=ee;Ge<=oe;++Ge){const et=Ue*_+Ge;if(zg[et]===255){let yt=0,nt=0,bt=-1,Mt=-1;for(let Pt=-1;Pt<=1;++Pt)for(let Ht=-1;Ht<=1;++Ht){const qt=(Ue+Pt)*_+Ge+Ht;if(zg[qt]>=Ie)continue;const Ut=zw[qt],$t=Math.abs(Ut);$t>nt&&(yt=Ut,nt=$t,bt=Ht,Mt=Pt)}if(nt>.1){const Pt=1-(Ie+.5*Math.abs(bt*Mt))/Z;let Ht=n._dem.get(Ge,Ue)+yt*Pt;const qt=n._dem.get(Ge+bt,Ue+Mt),Ut=n._dem.get(Ge-bt,Ue-Mt,!0);(Ht-qt)*(Ht-Ut)>0&&(Ht=(qt+Ut)/2),zw[et]=n._dem.set(Ge,Ue,Ht),zg[et]=Ie}}}}}w&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=xa.now())}setFilter(e){this.filter=e?Uh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Da(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)Xx(n.node),nw(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const g=u.node.footprint;u.hiddenByReplacement=!!g&&!l.find((_=>_.footprint===g))}}getHeightAtTileCoord(e,n){const l=[],u=[0,0,0],g=ce([]);for(const _ of this.getNodesInfo()){const w=_.node.meshes[0],A=w.transformedAabb;if(e<A.min[0]||n<A.min[1]||e>A.max[0]||n>A.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};ve(g,_.node.globalMatrix),u[0]=e,u[1]=n,Fi(u,u,g);const z=(u[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*Mg|0,O=Math.min(63,(u[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*Mg|0)*Mg+Math.min(63,z),F=w.heightmap[O];if(!(F<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:F,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Pe(e,n),new Pe(e,n),l),l.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function gv(a,e){return a instanceof _d&&!a.isLightConstant&&e}function $z(a,e,n,l,u,g,_,w){let A=(61440&e|(61440&e)>>4)>>8,z=(3840&e|(3840&e)>>4)>>4,O=240&e|(240&e)>>4;n[3]>0&&(A=$i(A,255*n[0],n[3]),z=$i(z,255*n[1],n[3]),O=$i(O,255*n[2],n[3]));const F=A<<8|z,U=O<<8|Math.floor(255*l[3]),q=(function(Ie){const Ue=ie(Ie,0,2);return Math.min(Math.round(.5*Ue*255),255)})(l[2])<<8|15*l[0]<<4|15*l[1],Z=ie(u[0],0,1),ee=ie(u[1],0,1),le=ie(u[2],0,1),oe=ie(u[3],0,1);let fe,_e,be,Oe;if(Z!==ee&&_!==g&&ee!==Z){const Ie=_-g;_e=1/(Ie*(ee-Z)),be=-(g+Ie*Z)/(Ie*(ee-Z));const Ue=ie(u[4],-1,1);Oe=Math.pow(10,Ue),fe=255*le<<8|255*oe}else fe=65535,_e=0,be=1,Oe=1;if(a.emplaceBack(F,U,q,fe,_e,be,Oe),w){const Ie=w.length;w.clear();for(let Ue=0;Ue<Ie;Ue++)w.emplaceBack(F,U,q,fe,_e,be,Oe)}}function Vz(a,e,n){const l=a.node;let u=0;const g=n&z_.HasMeshoptCompression;for(const _ of l.meshes){if(l.lights&&l.lightMeshIndex===u||!_.featureData)continue;_.featureArray=new Jf,_.featureArray.reserve(_.featureData.length);let w=e;for(const A of _.featureData){const z=g?65535&A:A>>16&65535,O=g?A>>16&65535:65535&A,F=(15&O)<8?15&O:0,U=a.evaluatedRMEA[F],q=a.evaluatedColor[F],Z=a.emissionHeightBasedParams[F];let ee;if(w&&F===2&&l.lights&&(ee=new Jf,ee.resize(10*l.lights.length)),$z(_.featureArray,z,q,U,Z,_.aabb.min[2],_.aabb.max[2],ee),ee&&w){w=!1;const le=l.meshes[l.lightMeshIndex];le.featureArray=ee,le.featureArray._trim()}}_.featureArray._trim(),u++}}yi(m0,"Tiled3dModelBucket",{omit:["layers"]}),yi(jT,"Tiled3dModelFeature");const Hz=["id","tile","layer","source","sourceLayer","state"];class Ig{constructor(e,n,l,u,g){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=l,this._y=u,this.properties=e?e.properties:{},this.id=g}clone(){const e=new Ig(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of Hz)this[n]!==void 0&&(e[n]=this[n]);return e}}class Rg extends gc{constructor(e,n,l,u){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=n,this._modelsInfo=new Map}load(){const e=[];for(const n in this._options.models){const l=this._options.models[n],u=this._modelsInfo.get(n);if(u){const g=u.model;g.position=l.position!=null?new s(l.position[0],l.position[1]):new s(0,0),g.orientation=l.orientation!=null?l.orientation:[0,0,0],u.modelSpec=l,Rg.applyModelSpecification(g,l),g.computeBoundsAndApplyParent(),this.models.push(g)}else{const g=JS(this.map._requestManager.transformRequest(l.uri,mc.Model).url).then((_=>{if(!_)return;const w=rw(_),A=new n2(n,l.uri,l.position,l.orientation,w);Rg.applyModelSpecification(A,l),A.computeBoundsAndApplyParent(),this.models.push(A),this._modelsInfo.set(n,{modelSpec:l,model:A})})).catch((_=>{this.fire(new Ku(new Error(`Could not load model ${n} from ${l.uri}: ${_.message}`)))}));e.push(g)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new bo("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((n=>{this._loaded=!0,this.fire(new Ku(new Error(`Could not load models: ${n.message}`)))}))}static applyModelSpecification(e,n){n.nodeOverrides&&Rg.convertNodeOverrides(e,n.nodeOverrides),n.materialOverrides&&Rg.convertMaterialOverrides(e,n.materialOverrides),n.nodeOverrideNames&&(e.nodeOverrideNames=[...n.nodeOverrideNames]),n.materialOverrideNames&&(e.materialOverrideNames=[...n.materialOverrideNames]),n.featureProperties&&(e.featureProperties=n.featureProperties)}static convertNodeOverrides(e,n){if(Array.isArray(n)&&n.every((l=>typeof l=="string"))){e.nodeOverrideNames=[];for(const l of n)e.nodeOverrideNames.push(l)}else Object.entries(n).forEach((([l,u])=>{const g={orientation:[0,0,0]};if(u.hasOwnProperty("orientation")){const _=u.orientation;_&&(g.orientation=_)}e.nodeOverrides.set(l,g)}))}static convertMaterialOverrides(e,n){if(Array.isArray(n)&&n.every((l=>typeof l=="string"))){e.materialOverrideNames=[];for(const l of n)e.materialOverrideNames.push(l)}else Object.entries(n).forEach((([l,u])=>{const g={color:new ha(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=u["model-color"];_!==void 0&&(g.color.r=_[0],g.color.g=_[1],g.color.b=_[2]);const w=u["model-color-mix-intensity"];w!==void 0&&(g.colorMix=w);const A=u["model-emissive-strength"];A!==void 0&&(g.emissionStrength=A);const z=u["model-opacity"];z!==void 0&&(g.opacity=z),e.materialOverrides.set(l,g)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,n){}serialize(){return this._options}setProperty(e,n){return!1}reload(){const e=sl(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const n=new Map;for(const l in e){const u=e[l];if(this._modelsInfo.has(l)){const g=this._modelsInfo.get(l);g&&g.modelSpec.uri===u.uri&&n.set(l,g)}}this._modelsInfo=n,this._options.models=e,this._loaded=!1,this.load()}}function Iw(a,e,n,l){const u=1<<a.z;e.lat=Y((l/Xt+a.y)/u),e.lng=V((n/Xt+a.x)/u)}function Gz(a,e,n,l){const u=a.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let g=Number.MAX_VALUE;const _=u.node,w=n.tile,A=l.calculatePosMatrix(w.tileID.toUnwrapped(),l.worldSize),z=u.evaluatedScale;let O=0;l.elevation&&_.elevation&&(O=_.elevation*l.elevation.exaggeration()),Ee(A,A,[(_.anchor?_.anchor[0]:0)*(z[0]-1),(_.anchor?_.anchor[1]:0)*(z[1]-1),O]),Qe(A,A,z);const F=n.queryGeometry,U=F.isPointQuery()?F.screenBounds:F.screenGeometry,q=function(ee){const le=Se([],A,ee.globalMatrix);Se(le,l.expandedFarZProjMatrix,le);for(let oe=0;oe<ee.meshes.length;++oe){const fe=ee.meshes[oe];if(oe===ee.lightMeshIndex)continue;const _e=tw(U,l,le,fe.aabb);_e!=null&&(g=Math.min(_e,g))}if(ee.children)for(const oe of ee.children)q(oe)};if(q(_),g===Number.MAX_VALUE)return;const Z=new s(0,0);return Iw(w.tileID.canonical,Z,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:g,position:Z,feature:u.feature}}const qz={circle:class extends ko{constructor(a,e,n,l){super(a,{layout:$o||($o=new ur({"circle-sort-key":new si(at.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Kt(at.layout_circle["circle-elevation-reference"]),visibility:new Kt(at.layout_circle.visibility)})),paint:dr||(dr=new ur({"circle-radius":new si(at.paint_circle["circle-radius"]),"circle-color":new si(at.paint_circle["circle-color"]),"circle-blur":new si(at.paint_circle["circle-blur"]),"circle-opacity":new si(at.paint_circle["circle-opacity"]),"circle-translate":new Kt(at.paint_circle["circle-translate"]),"circle-translate-anchor":new Kt(at.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Kt(at.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Kt(at.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new si(at.paint_circle["circle-stroke-width"]),"circle-stroke-color":new si(at.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new si(at.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Kt(at.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}createBucket(a){return new ya(a)}queryRadius(a){const e=a;return to("circle-radius",this,e)+to("circle-stroke-width",this,e)+Es(this.paint.get("circle-translate"))}queryIntersectsFeature(a,e,n,l,u,g,_,w){const A=Zl(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),z=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return fg(a,l,g,_,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,z)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,e,n){const l=f_(this);return{config:new Xr(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ko{createBucket(a){return new pg(a)}constructor(a,e,n,l){super(a,{layout:lm||(lm=new ur({visibility:new Kt(at.layout_heatmap.visibility)})),paint:My||(My=new ur({"heatmap-radius":new si(at.paint_heatmap["heatmap-radius"]),"heatmap-weight":new si(at.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Kt(at.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bd(at.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Kt(at.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return to("heatmap-radius",this,a)}queryIntersectsFeature(a,e,n,l,u,g,_,w){const A=this.paint.get("heatmap-radius").evaluate(e,n);return fg(a,l,g,_,w,!0,!0,new Pe(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,e,n){return a==="heatmap"?{config:new Xr(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends ko{constructor(a,e,n,l){super(a,{layout:Tx||(Tx=new ur({visibility:new Kt(at.layout_hillshade.visibility)})),paint:kx||(kx=new ur({"hillshade-illumination-direction":new Kt(at.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Kt(at.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Kt(at.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Kt(at.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Kt(at.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Kt(at.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Kt(at.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,e,n){return{overrideFog:!1}}},fill:class extends ko{constructor(a,e,n,l){super(a,{layout:__||(__=new ur({"fill-sort-key":new si(at.layout_fill["fill-sort-key"]),visibility:new Kt(at.layout_fill.visibility),"fill-elevation-reference":new Kt(at.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new si(at.layout_fill["fill-construct-bridge-guard-rail"])})),paint:y_||(y_=new ur({"fill-antialias":new Kt(at.paint_fill["fill-antialias"]),"fill-opacity":new si(at.paint_fill["fill-opacity"]),"fill-color":new si(at.paint_fill["fill-color"]),"fill-outline-color":new si(at.paint_fill["fill-outline-color"]),"fill-translate":new Kt(at.paint_fill["fill-translate"]),"fill-translate-anchor":new Kt(at.paint_fill["fill-translate-anchor"]),"fill-pattern":new si(at.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Kt(at.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Kt(at.paint_fill["fill-emissive-strength"]),"fill-z-offset":new si(at.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new si(at.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new si(at.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}getProgramIds(){const a=this.paint.get("fill-pattern"),e=a&&a.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(a,e,n){return{config:new Xr(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(a,e){super.recalculate(a,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new mp(a)}queryRadius(){return Es(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,n,l,u,g){return!a.queryGeometry.isAboveHorizon&&ta(Al(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?e&&!a:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ko{constructor(a,e,n,l){super(a,{layout:we||(we=new ur({visibility:new Kt(at["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Kt(at["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:$e||($e=new ur({"fill-extrusion-opacity":new Kt(at["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new si(at["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Kt(at["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Kt(at["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new si(at["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Kt(at["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new si(at["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new si(at["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Kt(at["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Kt(at["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Kt(at["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Kt(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Kt(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Kt(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Kt(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Kt(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Kt(at["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Kt(at["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new si(at["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new si(at["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Kt(at["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Kt(at["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Kt(at["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Kt(at["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new si(at["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new si(at["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Kt(at["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new xp(a)}queryRadius(){return Es(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,e,n,l,u,g,_,w,A){const z=Zl(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(e,n),F=this.paint.get("fill-extrusion-base").evaluate(e,n),U=[0,0],q=w&&g.elevation,Z=g.elevation?g.elevation.exaggeration():1,ee=a.tile.getBucket(this);if(q&&ee instanceof xp){const be=ee.centroidVertexArray,Oe=A+1;Oe<be.length&&(U[0]=be.geta_centroid_pos0(Oe),U[1]=be.geta_centroid_pos1(Oe))}if(U[0]===0&&U[1]===1)return!1;g.projection.name==="globe"&&(l=G([l],[new Pe(0,0),new Pe(Xt,Xt)],a.tileID.canonical).map((be=>be.polygon)).flat());const le=q?w:null,[oe,fe]=kt(g,l,F,O,z,_,le,U,Z,g.center.lat,a.tileID.canonical),_e=a.queryGeometry;return Lt(oe,fe,_e.isPointQuery()?_e.screenBounds:_e.screenGeometry)}},building:class extends ko{constructor(a,e,n,l){super(a,{layout:u2||(u2=new ur({visibility:new Kt(at.layout_building.visibility),"building-facade":new si(at.layout_building["building-facade"]),"building-facade-floors":new si(at.layout_building["building-facade-floors"]),"building-facade-unit-width":new si(at.layout_building["building-facade-unit-width"]),"building-facade-window":new si(at.layout_building["building-facade-window"]),"building-roof-shape":new si(at.layout_building["building-roof-shape"]),"building-height":new si(at.layout_building["building-height"]),"building-base":new si(at.layout_building["building-base"]),"building-flood-light-wall-radius":new si(at.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new si(at.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new si(at.layout_building["building-flip-roof-orientation"])})),paint:d2||(d2=new ur({"building-opacity":new Kt(at.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Kt(at.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Kt(at.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Kt(at.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Kt(at.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Kt(at.paint_building["building-vertical-scale"]),"building-cast-shadows":new Kt(at.paint_building["building-cast-shadows"]),"building-color":new si(at.paint_building["building-color"]),"building-emissive-strength":new si(at.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Kt(at.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Kt(at.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Kt(at.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Kt(at.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Kt(at.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new c2(a)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}queryRadius(a){return 0}queryIntersectsFeature(a,e,n,l,u,g,_,w,A){let z=this.layout.get("building-height").evaluate(e,n);const O=this.layout.get("building-base").evaluate(e,n),F=a.tile.getBucket(this).getFootprint(e);if(F){if(F.hiddenFlags!==0)return!1;z=F.height}const[U,q]=kt(g,l,O,z,new Pe(0,0),_,null,[0,0],1,g.center.lat,a.tileID.canonical),Z=a.queryGeometry;return Lt(U,q,Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends ko{constructor(a,e,n,l){const u=b2();super(a,u,e,n,l),u.layout&&(this.layout=new xd(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof il,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(a,e){super.recalculate(a,e),this.paint._values["line-floorwidth"]=(()=>{if(tv)return tv;const n=b2();return tv=new Bj(n.paint.properties["line-width"].specification),tv.useIntegerZoom=!0,tv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new lw(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,e,n){const l=v2(this);return{config:new Xr(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}queryRadius(a){const e=a,n=w2(to("line-width",this,e),to("line-gap-width",this,e)),l=to("line-offset",this,e);return n/2+Math.abs(l)+Es(this.paint.get("line-translate"))}queryIntersectsFeature(a,e,n,l,u,g){if(a.queryGeometry.isAboveHorizon)return!1;const _=Al(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),w=a.pixelToTileUnitsFactor/2*w2(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),A=this.paint.get("line-offset").evaluate(e,n);return A&&(l=(function(z,O){const F=[],U=new Pe(0,0);for(let q=0;q<z.length;q++){const Z=z[q],ee=[];for(let le=0;le<Z.length;le++){const oe=Z[le],fe=Z[le+1],_e=le===0?U:oe.sub(Z[le-1])._unit()._perp(),be=le===Z.length-1?U:fe.sub(oe)._unit()._perp(),Oe=_e._add(be)._unit();Oe._mult(1/(Oe.x*be.x+Oe.y*be.y)),ee.push(Oe._mult(O)._add(oe))}F.push(ee)}return F})(l,A*a.pixelToTileUnitsFactor)),(function(z,O,F){for(let U=0;U<O.length;U++){const q=O[U];if(z.length>=3){for(let Z=0;Z<q.length;Z++)if(Ma(z,q[Z]))return!0}if(Va(z,q,F))return!0}return!1})(_,l,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:u0,background:class extends ko{constructor(a,e,n,l){super(a,{layout:uT||(uT=new ur({visibility:new Kt(at.layout_background.visibility)})),paint:dT||(dT=new ur({"background-pitch-alignment":new Kt(at.paint_background["background-pitch-alignment"]),"background-color":new Kt(at.paint_background["background-color"]),"background-pattern":new Kt(at.paint_background["background-pattern"]),"background-opacity":new Kt(at.paint_background["background-opacity"]),"background-emissive-strength":new Kt(at.paint_background["background-emissive-strength"]),"background-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,e,n){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:gT,"raster-particle":wT,sky:class extends ko{constructor(a,e,n,l){super(a,{layout:vT||(vT=new ur({visibility:new Kt(at.layout_sky.visibility)})),paint:xT||(xT=new ur({"sky-type":new Kt(at.paint_sky["sky-type"]),"sky-atmosphere-sun":new Kt(at.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Kt(at.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Kt(at.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Kt(at.paint_sky["sky-gradient-radius"]),"sky-gradient":new bd(at.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Kt(at.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Kt(at.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Kt(at.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=gg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(a,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),u=!l,g=a.style.light,_=g.properties.get("position");return u&&g.properties.get("anchor")==="viewport"&&mi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Mw(_.azimuthal,90-_.polar,e):Mw(l[0],90-l[1],e)}const n=this.paint.get("sky-gradient-center");return Mw(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends ko{constructor(a,e,n,l){super(a,{paint:bT||(bT=new ur({}))},e,null)}},model:class extends ko{constructor(a,e,n,l){super(a,{layout:ET||(ET=new ur({visibility:new Kt(at.layout_model.visibility),"model-id":new si(at.layout_model["model-id"])})),paint:AT||(AT=new ur({"model-opacity":new si(at.paint_model["model-opacity"]),"model-rotation":new si(at.paint_model["model-rotation"]),"model-scale":new si(at.paint_model["model-scale"]),"model-translation":new si(at.paint_model["model-translation"]),"model-color":new si(at.paint_model["model-color"]),"model-color-mix-intensity":new si(at.paint_model["model-color-mix-intensity"]),"model-type":new Kt(at.paint_model["model-type"]),"model-cast-shadows":new Kt(at.paint_model["model-cast-shadows"]),"model-receive-shadows":new Kt(at.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Kt(at.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new si(at.paint_model["model-emissive-strength"]),"model-roughness":new si(at.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new si(at.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Kt(at.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Kt(at.paint_model["model-front-cutoff"]),"model-elevation-reference":new Kt(at.paint_model["model-elevation-reference"]),"model-color-use-theme":new si({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this.layer=a,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new jw(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof m0?Xt-1:0}queryRenderedFeatures(a,e,n){const l=e.getSource();if(!(l&&l instanceof Rg))return{};const u=l,g={};g[this.id]=[];const _=g[this.id];let w=0;for(const A of u.models){const z=e.getFeatureState(this.sourceLayer,A.id),O={type:"Unknown",id:A.id,properties:A.featureProperties},F=this.paint.get("model-rotation").evaluate(O,z),U=this.paint.get("model-scale").evaluate(O,z),q=this.paint.get("model-translation").evaluate(O,z),Z=this.paint.get("model-elevation-reference");let ee=[];Zx(ee,A,n,A.position,F,U,q,Z==="ground",Z==="ground",!1),n.projection.name==="globe"&&(ee=Wx(ee,n));const le=Se([],n.projMatrix,ee),oe=tw(a.isPointQuery()?a.screenBounds:a.screenGeometry,n,le,A.aabb);if(oe!=null){const fe=new Ig(void 0,0,0,0,A.id);fe.layer=this.layer,fe.properties=structuredClone(A.featureProperties),fe.properties.layer=this.id,fe.properties.uri=A.uri,fe.properties.orientation=A.orientation,fe.sourceLayer=this.sourceLayer,fe.geometry={type:"Point",coordinates:[A.position.lng,A.position.lat]},fe.state=z,fe.source=this.source,_.push({featureIndex:w,feature:fe,intersectionZ:oe})}++w}return g}queryIntersectsFeature(a,e,n,l,u,g){if(!this.modelManager)return!1;const _=this.modelManager,w=a.tile.getBucket(this);if(!(w&&w instanceof jw))return!1;for(const A in w.instancesPerModel){const z=w.instancesPerModel[A],O=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(z.idToFeaturesIndex.hasOwnProperty(O)){const F=z.features[z.idToFeaturesIndex[O]],U=_.getModel(A,this.scope);if(!U)return!1;let q=[];const Z=new s(0,0),ee=w.canonical;let le=Number.MAX_VALUE;for(let oe=0;oe<F.instancedDataCount;++oe){const fe=16*(F.instancedDataOffset+oe),_e=z.instancedDataArray.float32,be=[_e[fe+4],_e[fe+5],_e[fe+6]];Iw(ee,Z,Math.floor(_e[fe]),Math.floor(_e[fe+1])),Zx(q,U,g,Z,F.rotation,F.scale,be,!1,!1,!1),g.projection.name==="globe"&&(q=Wx(q,g));const Oe=Se([],g.projMatrix,q),Ie=a.queryGeometry,Ue=tw(Ie.isPointQuery()?Ie.screenBounds:Ie.screenGeometry,g,Oe,U.aabb);Ue!=null&&(le=Math.min(Ue,le))}return le!==Number.MAX_VALUE&&le}}return!1}_handleOverridablePaintPropertyUpdate(a,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const e=this._transitionablePaint._values[a];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof yd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ko{constructor(a,e,n,l){super(a,{layout:wg||(wg=new ur({"clip-layer-types":new Kt(at.layout_clip["clip-layer-types"]),"clip-layer-scope":new Kt(at.layout_clip["clip-layer-scope"])})),paint:Uy||(Uy=new ur({}))},e,n,l)}recalculate(a,e){super.recalculate(a,e)}createBucket(a){return new $y(a)}is3D(a){return!0}}},Rw=new ha(0,0,0),Dw={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Lw={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},p0={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Wz={PAINT_ORDER_FILL_AND_STROKE:1},_v={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},zT={MASK_TYPE_LUMINANCE:1};function Zz(a,e,n){a===1&&e.icons.push((function(l,u){return(function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:_}=g;if(_.content_area){const{content_area:w}=_;w.left==null&&(w.left=0),w.top==null&&(w.top=w.left),w.width==null&&(w.width=g.usvg_tree.width),w.height==null&&(w.height=w.width)}if(_.text_placeholder){const{text_placeholder:w}=_;w.top==null&&(w.top=w.left),w.height==null&&(w.height=w.width)}return _.stretch_x&&_.stretch_x.length&&IT(_,"x"),_.stretch_y&&_.stretch_y.length&&IT(_,"y"),g})(l.readFields(Xz,{name:void 0},u))})(n,n.readVarint()+n.pos))}function IT(a,e){const n=[],l=a[`stretch_${e}`];let u=null;for(let g=0;g<l.length;g++)u===null?u=n.length===0?l[0]:n[n.length-1][1]+l[g]:(n.push([u,u+l[g]]),u=null);a[`stretch_${e}_areas`]=n}function Xz(a,e,n){a===1?e.name=n.readString():a===2?e.metadata=(function(l,u){return l.readFields(Yz,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)})(n,n.readVarint()+n.pos):a===3&&(e.usvg_tree=(function(l,u){return l.readFields(Qz,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)})(n,n.readVarint()+n.pos),e.data="usvg_tree")}function Yz(a,e,n){a===1?e.stretch_x=n.readPackedVarint():a===2?e.stretch_y=n.readPackedVarint():a===3?e.content_area=RT(n,n.readVarint()+n.pos):a===4?e.variables.push((function(l,u){return l.readFields(Jz,{name:void 0},u)})(n,n.readVarint()+n.pos)):a===5&&(e.text_placeholder=RT(n,n.readVarint()+n.pos))}function RT(a,e){return a.readFields(Kz,{},e)}function Kz(a,e,n){a===1?e.left=n.readVarint():a===2?e.width=n.readVarint():a===3?e.top=n.readVarint():a===4&&(e.height=n.readVarint())}function Jz(a,e,n){a===1?e.name=n.readString():a===2&&(e.rgb_color=y0(n.readVarint()),e.value="rgb_color")}function Qz(a,e,n){a===1?e.width=e.height=n.readVarint():a===2?e.height=n.readVarint():a===3?e.children.push(g0(n,n.readVarint()+n.pos)):a===4?e.linear_gradients.push((function(l,u){return l.readFields(sI,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)})(n,n.readVarint()+n.pos)):a===5?e.radial_gradients.push((function(l,u){return l.readFields(lI,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)})(n,n.readVarint()+n.pos)):a===7?e.clip_paths.push((function(l,u){return l.readFields(cI,{children:[]},u)})(n,n.readVarint()+n.pos)):a===8&&e.masks.push((function(l,u){const g=l.readFields(uI,{left:0,width:20,mask_type:zT.MASK_TYPE_LUMINANCE,children:[]},u);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g})(n,n.readVarint()+n.pos))}function g0(a,e){return a.readFields(eI,{},e)}function eI(a,e,n){a===1?(e.group=(function(l,u){return l.readFields(tI,{opacity:255,children:[]},u)})(n,n.readVarint()+n.pos),e.node="group"):a===2&&(e.path=(function(l,u){return l.readFields(nI,{paint_order:1,commands:[],step:1,diffs:[],rule:Dw.PATH_RULE_NON_ZERO},u)})(n,n.readVarint()+n.pos),e.node="path")}function tI(a,e,n){a===1?e.transform=_0(n,n.readVarint()+n.pos):a===2?e.opacity=n.readVarint():a===5?e.clip_path_idx=n.readVarint():a===6?e.mask_idx=n.readVarint():a===7&&e.children.push(g0(n,n.readVarint()+n.pos))}function _0(a,e){return a.readFields(iI,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function iI(a,e,n){a===1?e.sx=n.readFloat():a===2?e.ky=n.readFloat():a===3?e.kx=n.readFloat():a===4?e.sy=n.readFloat():a===5?e.tx=n.readFloat():a===6&&(e.ty=n.readFloat())}function nI(a,e,n){a===1?e.fill=(function(l,u){return l.readFields(aI,{rgb_color:Rw,paint:"rgb_color",opacity:255},u)})(n,n.readVarint()+n.pos):a===2?e.stroke=(function(l,u){return l.readFields(rI,{rgb_color:Rw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)})(n,n.readVarint()+n.pos):a===3?e.paint_order=n.readVarint():a===5?n.readPackedVarint(e.commands):a===6?e.step=n.readFloat():a===7?n.readPackedSVarint(e.diffs):a===8&&(e.rule=n.readVarint())}function aI(a,e,n){a===1?(e.rgb_color=y0(n.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):a===5&&(e.opacity=n.readVarint())}function y0(a){return new ha((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function rI(a,e,n){a===1?(e.rgb_color=y0(n.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):a===5?n.readPackedFloat(e.dasharray):a===6?e.dashoffset=n.readFloat():a===7?e.miterlimit=n.readFloat():a===8?e.opacity=n.readVarint():a===9?e.width=n.readFloat():a===10?e.linecap=n.readVarint():a===11&&(e.linejoin=n.readVarint())}function sI(a,e,n){a===1?e.transform=_0(n,n.readVarint()+n.pos):a===2?e.spread_method=n.readVarint():a===3?e.stops.push(DT(n,n.readVarint()+n.pos)):a===4?e.x1=n.readFloat():a===5?e.y1=n.readFloat():a===6?e.x2=n.readFloat():a===7&&(e.y2=n.readFloat())}function DT(a,e){return a.readFields(oI,{offset:0,opacity:255,rgb_color:Rw},e)}function oI(a,e,n){a===1?e.offset=n.readFloat():a===2?e.opacity=n.readVarint():a===3&&(e.rgb_color=y0(n.readVarint()))}function lI(a,e,n){a===1?e.transform=_0(n,n.readVarint()+n.pos):a===2?e.spread_method=n.readVarint():a===3?e.stops.push(DT(n,n.readVarint()+n.pos)):a===4?e.cx=n.readFloat():a===5?e.cy=n.readFloat():a===6?e.r=n.readFloat():a===7?e.fx=n.readFloat():a===8?e.fy=n.readFloat():a===9&&(e.fr=n.readFloat())}function cI(a,e,n){a===1?e.transform=_0(n,n.readVarint()+n.pos):a===2?e.clip_path_idx=n.readVarint():a===3&&e.children.push(g0(n,n.readVarint()+n.pos))}function uI(a,e,n){a===1?e.left=e.top=n.readFloat():a===2?e.width=e.height=n.readFloat():a===3?e.top=n.readFloat():a===4?e.height=n.readFloat():a===5?e.mask_type=n.readVarint():a===6?e.mask_idx=n.readVarint():a===7&&e.children.push(g0(n,n.readVarint()+n.pos))}class dI{static calculate(e={},n=[]){const l=new Map,u=new Map;if(Object.keys(e).length===0)return l;n.forEach((g=>{u.set(g.name,g.rgb_color||new ha(0,0,0))}));for(const[g,_]of Object.entries(e))u.has(g)?l.set(u.get(g).toString(),_):console.warn(`Ignoring unknown image variable "${g}"`);return l}}function $_(a,e=255,n){const l=e/255,u=a.toString(),g=n.has(u)?n.get(u).clone():a.clone();return g.a*=l,g.toString()}function yv(a,e){if(!ss()){const n=document.createElement("canvas");return n.width=a,n.height=e,n}return new OffscreenCanvas(a,e)}let Ow,vv=null;function Nw(a,e,n,l,u){for(const g of l.children)LT(a,e,n,g,u)}function LT(a,e,n,l,u){l.group?(a.save(),(function(g,_,w,A,z){const O=A.mask_idx!=null?w.masks[A.mask_idx]:null,F=A.clip_path_idx!=null?w.clip_paths[A.clip_path_idx]:null;if(A.transform&&(_=V_(A.transform).preMultiplySelf(_)),!(function(Z,ee,le){return Z.opacity!==255||ee||le})(A,F!=null,O!=null))return void Nw(g,_,w,A,z);const U=yv(g.canvas.width,g.canvas.height),q=U.getContext("2d");Nw(q,_,w,A,z),F&&VT(q,_,w,F),O&&HT(q,_,w,O,z),g.globalAlpha=A.opacity/255,g.drawImage(U,0,0)})(a,e,n,l.group,u),a.restore()):l.path&&(a.save(),(function(g,_,w,A,z){g.setTransform(_),A.paint_order===Wz.PAINT_ORDER_FILL_AND_STROKE?(OT(g,w,A,z),FT(g,w,A,z)):(FT(g,w,A,z),OT(g,w,A,z))})(a,e,n,l.path,u),a.restore())}function OT(a,e,n,l){const u=n.fill;if(!u)return;const g=u.opacity/255;switch(a.save(),a.beginPath(),GT(n,a),u.paint){case"rgb_color":a.fillStyle=$_(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":{const _=e.linear_gradients[u.linear_gradient_idx];_.transform&&a.setTransform(V_(_.transform).preMultiplySelf(a.getTransform())),a.fillStyle=BT(a,_,g,l);break}case"radial_gradient_idx":{const _=e.radial_gradients[u.radial_gradient_idx];_.transform&&a.setTransform(V_(_.transform).preMultiplySelf(a.getTransform())),a.fillStyle=UT(a,_,g,l)}}a.fill(NT(n)),a.restore()}function NT(a){return a.rule===Dw.PATH_RULE_NON_ZERO?"nonzero":a.rule===Dw.PATH_RULE_EVEN_ODD?"evenodd":void 0}function FT(a,e,n,l){const u=n.stroke;if(!u)return;const g=qT(n);a.lineWidth=u.width,a.miterLimit=u.miterlimit,a.setLineDash(u.dasharray),a.lineDashOffset=u.dashoffset;const _=u.opacity/255;switch(u.paint){case"rgb_color":a.strokeStyle=$_(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":a.strokeStyle=BT(a,e.linear_gradients[u.linear_gradient_idx],_,l,!0);break;case"radial_gradient_idx":a.strokeStyle=UT(a,e.radial_gradients[u.radial_gradient_idx],_,l,!0)}switch(u.linejoin){case p0.LINE_JOIN_MITER_CLIP:case p0.LINE_JOIN_MITER:a.lineJoin="miter";break;case p0.LINE_JOIN_ROUND:a.lineJoin="round";break;case p0.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(u.linecap){case Lw.LINE_CAP_BUTT:a.lineCap="butt";break;case Lw.LINE_CAP_ROUND:a.lineCap="round";break;case Lw.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(g)}function BT(a,e,n,l,u=!1){if(e.stops.length===1){const U=e.stops[0];return $_(U.rgb_color,U.opacity*n,l)}const{x1:g,y1:_,x2:w,y2:A}=e;let z=new DOMPoint(g,_),O=new DOMPoint(w,A);if(u){const U=V_(e.transform);z=U.transformPoint(z),O=U.transformPoint(O)}const F=a.createLinearGradient(z.x,z.y,O.x,O.y);for(const U of e.stops)F.addColorStop(U.offset,$_(U.rgb_color,U.opacity*n,l));return F}function UT(a,e,n,l,u=!1){if(e.stops.length===1){const oe=e.stops[0];return $_(oe.rgb_color,oe.opacity*n,l)}const g=V_(e.transform),{fx:_,fy:w,fr:A,cx:z,cy:O,r:F}=e;let U=new DOMPoint(_,w),q=new DOMPoint(z,O),Z=A,ee=F;if(u){U=g.transformPoint(U),q=g.transformPoint(q);const oe=(g.a+g.d)/2;Z=A*oe,ee=e.r*oe}const le=a.createRadialGradient(U.x,U.y,Z,q.x,q.y,ee);for(const oe of e.stops)le.addColorStop(oe.offset,$_(oe.rgb_color,oe.opacity*n,l));return le}function $T(a,e,n,l){const u=l.transform?V_(l.transform).preMultiplySelf(e):e,g=yv(a.canvas.width,a.canvas.height),_=g.getContext("2d");for(const A of l.children)if(A.group)$T(_,u,n,A.group);else if(A.path){const z=A.path,O=new Path2D;O.addPath(qT(z),u),_.fill(O,NT(z))}const w=l.clip_path_idx!=null?n.clip_paths[l.clip_path_idx]:null;w&&VT(_,u,n,w),a.globalCompositeOperation="source-over",a.drawImage(g,0,0)}function VT(a,e,n,l){const u=yv(a.canvas.width,a.canvas.height);$T(u.getContext("2d"),e,n,l),a.globalCompositeOperation="destination-in",a.drawImage(u,0,0)}function HT(a,e,n,l,u){if(l.children.length===0)return;const g=l.mask_idx!=null?n.masks[l.mask_idx]:null;g&&HT(a,e,n,g,u);const _=a.canvas.width,w=a.canvas.height,A=yv(_,w),z=A.getContext("2d"),O=l.width,F=l.height,U=l.left,q=l.top,Z=new Path2D,ee=new Path2D;ee.rect(U,q,O,F),Z.addPath(ee,e),z.clip(Z);for(const fe of l.children)LT(z,e,n,fe,u);const le=z.getImageData(0,0,_,w),oe=le.data;if(l.mask_type===zT.MASK_TYPE_LUMINANCE)for(let fe=0;fe<oe.length;fe+=4)oe[fe+3]=oe[fe+3]/255*(.2126*oe[fe]+.7152*oe[fe+1]+.0722*oe[fe+2]);z.putImageData(le,0,0),a.globalCompositeOperation="destination-in",a.drawImage(A,0,0)}function V_(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function GT(a,e){const n=a.step;let l=a.diffs[0]*n,u=a.diffs[1]*n;e.moveTo(l,u);for(let g=0,_=2;g<a.commands.length;g++)switch(a.commands[g]){case _v.PATH_COMMAND_MOVE:l+=a.diffs[_++]*n,u+=a.diffs[_++]*n,e.moveTo(l,u);break;case _v.PATH_COMMAND_LINE:l+=a.diffs[_++]*n,u+=a.diffs[_++]*n,e.lineTo(l,u);break;case _v.PATH_COMMAND_QUAD:{const w=l+a.diffs[_++]*n,A=u+a.diffs[_++]*n;l=w+a.diffs[_++]*n,u=A+a.diffs[_++]*n,e.quadraticCurveTo(w,A,l,u);break}case _v.PATH_COMMAND_CUBIC:{const w=l+a.diffs[_++]*n,A=u+a.diffs[_++]*n,z=w+a.diffs[_++]*n,O=A+a.diffs[_++]*n;l=z+a.diffs[_++]*n,u=O+a.diffs[_++]*n,e.bezierCurveTo(w,A,z,O,l,u);break}case _v.PATH_COMMAND_CLOSE:e.closePath()}return e}function qT(a){return GT(a,new Path2D)}class v0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}yi(v0,"LRUCache");class Fw{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Fs(e,e.data)}getFromCache(e,n,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new v0(150)),this.cacheMap.get(l).get(sl(e.toString(),n))}setInCache(e,n,l,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new v0(150));const g=this.cacheDependenciesMap.get(u),_=sl(e.id.toString(),l);g.get(_)||g.set(_,new Set);const w=this.cacheMap.get(u),A=e.toString();g.get(_).add(A),w.put(sl(e.toString(),l),n)}removeImagesFromCacheByIds(e,n,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const u=this.cacheMap.get(l),g=this.cacheDependenciesMap.get(l);for(const _ of e){const w=sl(_.toString(),n);if(g.has(w)){for(const A of g.get(w))u.delete(A);g.delete(w)}}}rasterize(e,n,l,u){const g=this.getFromCache(e,l,u);if(g)return g.clone();const _=(function(A,z){const O=dI.calculate(z.params,A.metadata?A.metadata.variables:[]),F=A.usvg_tree,U=F.width,q=F.height,Z=Math.max(1,Math.round(U*z.sx)),ee=Math.max(1,Math.round(q*z.sy)),le=new DOMMatrix([Z/U,0,0,ee/q,0,0]);return vv===null&&(vv=yv(10,10),Ow=vv.getContext("2d",{willReadFrequently:!0})),vv.width=Z,vv.height=ee,Nw(Ow,le,F,F,O),Ow.getImageData(0,0,Z,ee)})(n.icon,e),w=Fw._getImage(_);return this.setInCache(e,w,l,u),w.clone()}}class WT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const l=this.toIdx(e,n);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function ZT(a,e,n,l){let u=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(n[_]<a[_]||n[_]>e[_])return null}else{const w=1/l[_];let A=(a[_]-n[_])*w,z=(e[_]-n[_])*w;if(A>z){const O=A;A=z,z=O}if(A>u&&(u=A),z<g&&(g=z),u>g)return null}return u}function XT(a,e,n,l,u,g,_,w,A,z,O){const F=l-a,U=u-e,q=g-n,Z=_-a,ee=w-e,le=A-n,oe=O[1]*le-O[2]*ee,fe=O[2]*Z-O[0]*le,_e=O[0]*ee-O[1]*Z,be=F*oe+U*fe+q*_e;if(Math.abs(be)<1e-15)return null;const Oe=1/be,Ie=z[0]-a,Ue=z[1]-e,Ge=z[2]-n,et=(Ie*oe+Ue*fe+Ge*_e)*Oe;if(et<0||et>1)return null;const yt=Ue*q-Ge*U,nt=Ge*F-Ie*q,bt=Ie*U-Ue*F,Mt=(O[0]*yt+O[1]*nt+O[2]*bt)*Oe;return Mt<0||et+Mt>1?null:(Z*yt+ee*nt+le*bt)*Oe}function YT(a,e,n){return(a-e)/(n-e)}function KT(a,e,n,l,u,g,_,w,A){const z=1<<n,O=g-l,F=_-u,U=(a+1)/z*O+l,q=(e+0)/z*F+u,Z=(e+1)/z*F+u;w[0]=(a+0)/z*O+l,w[1]=q,A[0]=U,A[1]=Z}class JT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=(function(g){const _=Math.ceil(Math.log2(g.dim/8)),w=[];let A=Math.ceil(Math.pow(2,_));const z=1/A,O=(q,Z,ee,le,oe)=>{const fe=le?1:0,_e=(q+1)*ee-fe,be=Z*ee,Oe=(Z+1)*ee-fe;oe[0]=q*ee,oe[1]=be,oe[2]=_e,oe[3]=Oe};let F=new WT(A);const U=[];for(let q=0;q<A*A;q++){O(q%A,Math.floor(q/A),z,!1,U);const Z=kp(U[0],U[1],g),ee=kp(U[2],U[1],g),le=kp(U[2],U[3],g),oe=kp(U[0],U[3],g);F.minimums.push(Math.min(Z,ee,le,oe)),F.maximums.push(Math.max(Z,ee,le,oe)),F.leaves.push(1)}for(w.push(F),A/=2;A>=1;A/=2){const q=w[w.length-1];F=new WT(A);for(let Z=0;Z<A*A;Z++){O(Z%A,Math.floor(Z/A),2,!0,U);const ee=q.getElevation(U[0],U[1]),le=q.getElevation(U[2],U[1]),oe=q.getElevation(U[2],U[3]),fe=q.getElevation(U[0],U[3]),_e=q.isLeaf(U[0],U[1]),be=q.isLeaf(U[2],U[1]),Oe=q.isLeaf(U[2],U[3]),Ie=q.isLeaf(U[0],U[3]),Ue=Math.min(ee.min,le.min,oe.min,fe.min),Ge=Math.max(ee.max,le.max,oe.max,fe.max),et=_e&&be&&Oe&&Ie;F.maximums.push(Ge),F.minimums.push(Ue),F.leaves.push(Ge-Ue<=5&&et?1:0)}w.push(F)}return w})(this.dem),l=n.length-1,u=n[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,l,0)}raycastRoot(e,n,l,u,g,_,w=1){return ZT([e,n,-100],[l,u,this.maximums[0]*w],g,_)}raycast(e,n,l,u,g,_,w=1){if(!this.nodeCount)return null;const A=this.raycastRoot(e,n,l,u,g,_,w);if(A==null)return null;const z=[],O=[],F=[],U=[],q=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;q.length>0;){const{idx:Z,t:ee,nodex:le,nodey:oe,depth:fe}=q.pop();if(this.leaves[Z]){KT(le,oe,fe,e,n,l,u,F,U);const be=1<<fe,Oe=(le+0)/be,Ie=(le+1)/be,Ue=(oe+0)/be,Ge=(oe+1)/be,et=kp(Oe,Ue,this.dem)*w,yt=kp(Ie,Ue,this.dem)*w,nt=kp(Ie,Ge,this.dem)*w,bt=kp(Oe,Ge,this.dem)*w,Mt=XT(F[0],F[1],et,U[0],F[1],yt,U[0],U[1],nt,g,_),Pt=XT(U[0],U[1],nt,F[0],U[1],bt,F[0],F[1],et,g,_),Ht=Math.min(Mt!==null?Mt:Number.MAX_VALUE,Pt!==null?Pt:Number.MAX_VALUE);if(Ht!==Number.MAX_VALUE)return Ht;{const qt=oi([],g,_,ee);if(QT(et,yt,bt,nt,YT(qt[0],F[0],U[0]),YT(qt[1],F[1],U[1]))>=qt[2])return ee}continue}let _e=0;for(let be=0;be<this._siblingOffset.length;be++){KT((le<<1)+this._siblingOffset[be][0],(oe<<1)+this._siblingOffset[be][1],fe+1,e,n,l,u,F,U),F[2]=-100,U[2]=this.maximums[this.childOffsets[Z]+be]*w;const Oe=ZT(F,U,g,_);if(Oe!=null){const Ie=Oe;z[be]=Ie;let Ue=!1;for(let Ge=0;Ge<_e&&!Ue;Ge++)Ie>=z[O[Ge]]&&(O.splice(Ge,0,be),Ue=!0);Ue||(O[_e]=be),_e++}}for(let be=0;be<_e;be++){const Oe=O[be];q.push({idx:this.childOffsets[Z]+Oe,t:z[Oe],nodex:(le<<1)+this._siblingOffset[Oe][0],nodey:(oe<<1)+this._siblingOffset[Oe][1],depth:fe+1})}}return null}_addNode(e,n,l){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,l,u,g){if(e[u].isLeaf(n,l)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=u-1,w=e[_];let A=0,z=0;for(let O=0;O<this._siblingOffset.length;O++){const F=2*n+this._siblingOffset[O][0],U=2*l+this._siblingOffset[O][1],q=w.getElevation(F,U),Z=w.isLeaf(F,U),ee=this._addNode(q.min,q.max,Z);Z&&(A|=1<<O),z||(z=ee)}for(let O=0;O<this._siblingOffset.length;O++)A&1<<O||this._construct(e,2*n+this._siblingOffset[O][0],2*l+this._siblingOffset[O][1],_,z+O)}}function QT(a,e,n,l,u,g){return $i($i(a,n,g),$i(e,l,g),u)}function kp(a,e,n){const l=n.dim,u=ie(a*l-.5,0,l-1),g=ie(e*l-.5,0,l-1),_=Math.floor(u),w=Math.floor(g),A=Math.min(_+1,l-1),z=Math.min(w+1,l-1);return QT(n.get(_,w),n.get(A,w),n.get(_,z),n.get(A,z),u-_,g-w)}const hI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function fI(a,e,n){return(256*a*256+256*e+n)/10-1e4}function mI(a,e,n){return 256*a+e+n/256-32768}class x0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,l,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void mi(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const g=this.dim=n.height-2,_=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let A=0;A<g;A++)_[this._idx(-1,A)]=_[this._idx(0,A)],_[this._idx(g,A)]=_[this._idx(g-1,A)],_[this._idx(A,-1)]=_[this._idx(A,0)],_[this._idx(A,g)]=_[this._idx(A,g-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(g,-1)]=_[this._idx(g-1,0)],_[this._idx(-1,g)]=_[this._idx(0,g-1)],_[this._idx(g,g)]=_[this._idx(g-1,g-1)]}const w=l==="terrarium"?mI:fI;for(let A=0;A<_.length;++A){const z=4*A;this.floatView[A]=w(this.pixels[z],this.pixels[z+1],this.pixels[z+2])}this._timestamp=xa.now()}_buildQuadTree(){this._tree=new JT(this)}get(e,n,l=!1){l&&(e=ie(e,-1,this.dim),n=ie(n,-1,this.dim));const u=this._idx(e,n);return this.floatView[u]}set(e,n,l){const u=this._idx(e,n),g=this.floatView[u];return this.floatView[u]=l,l-g}static getUnpackVector(e){return hI[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const l=[0,0,0,0],u=x0.getUnpackVector(n);let g=Math.floor((e+u[3])/u[2]);return l[2]=g%256,g=Math.floor(g/256),l[1]=g%256,g=Math.floor(g/256),l[0]=g,l}getPixels(){return new Vo({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,g=n*this.dim+this.dim,_=l*this.dim,w=l*this.dim+this.dim;switch(n){case-1:u=g-1;break;case 1:g=u+1}switch(l){case-1:_=w-1;break;case 1:w=_+1}const A=-n*this.dim,z=-l*this.dim;for(let O=_;O<w;O++)for(let F=u;F<g;F++){const U=4*this._idx(F,O),q=4*this._idx(F+A,O+z);this.pixels[U+0]=e.pixels[q+0],this.pixels[U+1]=e.pixels[q+1],this.pixels[U+2]=e.pixels[q+2],this.pixels[U+3]=e.pixels[q+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function pI(a,e,n){a===1?e.headerLength=n.readFixed32():a===2?e.x=n.readVarint():a===3?e.y=n.readVarint():a===4?e.z=n.readVarint():a===5&&e.layers.push((function(l,u){return l.readFields(xI,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)})(n,n.readVarint()+n.pos))}function gI(a,e,n){a===1?(e.delta_filter=(function(l,u){return l.readFields(_I,{blockSize:0},u)})(n,n.readVarint()+n.pos),e.filter="delta_filter"):a===2?(n.readVarint(),e.filter="zigzag_filter"):a===3?(n.readVarint(),e.filter="bitshuffle_filter"):a===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function _I(a,e,n){a===1&&(e.blockSize=n.readVarint())}function yI(a,e,n){a===1?(n.readVarint(),e.codec="gzip_data"):a===2?(n.readVarint(),e.codec="jpeg_image"):a===3?(n.readVarint(),e.codec="webp_image"):a===4&&(n.readVarint(),e.codec="png_image")}function vI(a,e,n){let l=0,u=0;a===1?e.firstByte=n.readFixed64():a===2?e.lastByte=n.readFixed64():a===3?e.filters.push((function(g,_){return g.readFields(gI,{},_)})(n,n.readVarint()+n.pos)):a===4?e.codec=(function(g,_){return g.readFields(yI,{},_)})(n,n.readVarint()+n.pos):a===5?u=n.readFloat():a===6?l=n.readFloat():a===7?e.bands.push(n.readString()):a===8?e.offset=n.readDouble():a===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=l)}function xI(a,e,n){a===1?e.version=n.readVarint():a===2?e.name=n.readString():a===3?e.units=n.readString():a===4?e.tileSize=n.readVarint():a===5?e.buffer=n.readVarint():a===6?e.pixelFormat=n.readVarint():a===7&&e.dataIndex.push((function(l,u){return l.readFields(vI,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)})(n,n.readVarint()+n.pos))}function bI(a,e,n){if(a===2)(function(l,u,g){l.readFields(wI,g,u)})(n,n.readVarint()+n.pos,e);else if(a===3)throw new Error("Not implemented")}function wI(a,e,n){if(a===1){let l=0;const u=n.readVarint()+n.pos;for(;n.pos<u;)e[l++]=n.readVarint()}}function SI(a,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let l=2;l>=1;l--){const u=l===1?1:0,g=l===2?1:0;for(let _=0;_<e[0];_++){const w=e[1]*_;for(let A=u;A<e[1];A++){const z=e[2]*(A+w);for(let O=g;O<e[2];O++){const F=e[3]*(O+z);for(let U=0;U<e[3];U++){const q=F+U;a[q]+=a[q-n]}}}}n*=e[l]}return a}function TI(a){for(let e=0,n=a.length;e<n;e++)a[e]=a[e]>>>1^-(1&a[e]);return a}function kI(a,e){switch(e){case"uint32":return a;case"uint16":for(let n=0;n<a.length;n+=2){const l=a[n],u=a[n+1];a[n]=(240&l)>>4|(61440&l)>>8|(240&u)<<4|61440&u,a[n+1]=15&l|(3840&l)>>4|(15&u)<<8|(3840&u)<<4}return a;case"uint8":for(let n=0;n<a.length;n+=4){const l=a[n],u=a[n+1],g=a[n+2],_=a[n+3];a[n+0]=(192&l)>>6|(192&u)>>4|(192&g)>>2|192&_,a[n+1]=(48&l)>>4|(48&u)>>2|48&g|(48&_)<<2,a[n+2]=(12&l)>>2|12&u|(12&g)<<2|(12&_)<<4,a[n+3]=3&l|(3&u)<<2|(3&g)<<4|(3&_)<<6}return a;default:throw new Error(`Invalid pixel format, "${e}"`)}}yi(x0,"DEMData"),yi(JT,"DemMinMaxQuadTree",{omit:["dem"]});var Vu=Uint8Array,xv=Uint16Array,EI=Int32Array,ek=new Vu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tk=new Vu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),AI=new Vu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ik=function(a,e){for(var n=new xv(31),l=0;l<31;++l)n[l]=e+=1<<a[l-1];var u=new EI(n[30]);for(l=1;l<30;++l)for(var g=n[l];g<n[l+1];++g)u[g]=g-n[l]<<5|l;return{b:n,r:u}},nk=ik(ek,2),ak=nk.b,CI=nk.r;ak[28]=258,CI[258]=28;for(var MI=ik(tk,0).b,rk=new xv(32768),As=0;As<32768;++As){var H_=(43690&As)>>1|(21845&As)<<1;rk[As]=((65280&(H_=(61680&(H_=(52428&H_)>>2|(13107&H_)<<2))>>4|(3855&H_)<<4))>>8|(255&H_)<<8)>>1}var bv=function(a,e,n){for(var l=a.length,u=0,g=new xv(e);u<l;++u)a[u]&&++g[a[u]-1];var _,w=new xv(e);for(u=1;u<e;++u)w[u]=w[u-1]+g[u-1]<<1;_=new xv(1<<e);var A=15-e;for(u=0;u<l;++u)if(a[u])for(var z=u<<4|a[u],O=e-a[u],F=w[a[u]-1]++<<O,U=F|(1<<O)-1;F<=U;++F)_[rk[F]>>A]=z;return _},wv=new Vu(288);for(As=0;As<144;++As)wv[As]=8;for(As=144;As<256;++As)wv[As]=9;for(As=256;As<280;++As)wv[As]=7;for(As=280;As<288;++As)wv[As]=8;var sk=new Vu(32);for(As=0;As<32;++As)sk[As]=5;var PI=bv(wv,9),jI=bv(sk,5),Bw=function(a){for(var e=a[0],n=1;n<a.length;++n)a[n]>e&&(e=a[n]);return e},ph=function(a,e,n){var l=e/8|0;return(a[l]|a[l+1]<<8)>>(7&e)&n},Uw=function(a,e){var n=e/8|0;return(a[n]|a[n+1]<<8|a[n+2]<<16)>>(7&e)},zI=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],gh=function(a,e,n){var l=new Error(e||zI[a]);if(l.code=a,Error.captureStackTrace&&Error.captureStackTrace(l,gh),!n)throw l;return l},II=new Vu(0),RI=typeof TextDecoder<"u"&&new TextDecoder;try{RI.decode(II,{stream:!0})}catch{}const DI={gzip_data:"gzip"};class jd extends Error{constructor(e){super(e),this.name="MRTError"}}const LI={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ok={uint32:1,uint16:2,uint8:4},OI={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let $w;class b0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new jd(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),l=new DataView(e);if(n[0]!==13)throw new jd("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),l=this.getHeaderLength(e);if(n.length<l)throw new jd(`Expected header with length >= ${l} but got buffer of length ${n.length}`);const u=new $w(n.subarray(0,l)).readFields(pI,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new jd(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const g of u.layers)this.layers[g.name]=new lk(g,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],l=this.getLayer(e.layerName);for(let u of e.blockIndices){const g=l.dataIndex[u],_=g.firstByte-e.firstByte,w=g.lastByte-e.firstByte;if(l._blocksInProgress.has(u))continue;const A={layerName:l.name,firstByte:_,lastByte:w,pixelFormat:l.pixelFormat,blockIndex:u,blockShape:[g.bands.length].concat(l.bandShape),buffer:l.buffer,codec:g.codec.codec,filters:g.filters.map((z=>z.filter))};l._blocksInProgress.add(u),n.push(A)}return new ck(n,(()=>{n.forEach((u=>l._blocksInProgress.delete(u.blockIndex)))}),((u,g)=>{if(n.forEach((_=>l._blocksInProgress.delete(_.blockIndex))),u)throw u;g.forEach((_=>{this.getLayer(_.layerName).processDecodedData(_)}))}))}}class lk{constructor({version:e,name:n,units:l,tileSize:u,pixelFormat:g,buffer:_,dataIndex:w},A){if(this.version=e,this.version!==1)throw new jd(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=l,this.tileSize=u,this.buffer=_,this.pixelFormat=LI[g],this.dataIndex=w,this.bandShape=[u+2*_,u+2*_,ok[this.pixelFormat]],this._decodedBlocks=new v0(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return ok[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[l,u]of this.dataIndex.entries()){for(const[g,_]of u.bands.entries())if(_===e)return{bandIndex:n+g,blockIndex:l,blockBandIndex:g};n+=u.bands.length}break;case"number":for(const[l,u]of this.dataIndex.entries()){if(e>=n&&e<n+u.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-n};n+=u.bands.length}break;default:throw new jd(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let n=1/0,l=-1/0;const u=[],g=new Set;for(const _ of e){const{blockIndex:w}=this.getBlockForBand(_);if(w<0)throw new jd(`Invalid band: ${JSON.stringify(_)}`);const A=this.dataIndex[w];u.includes(w)||u.push(w),g.add(w),n=Math.min(n,A.firstByte),l=Math.max(l,A.lastByte)}if(g.size>this.cacheSize)throw new jd(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:l,blockIndices:u}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:l}=this.getBlockForBand(e);if(n<0)throw new jd(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(n.toString());if(!u)throw new jd(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[n],_=this.bandShape.reduce(((z,O)=>z*O),1),w=l*_,A=u.subarray(w,w+_);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}b0.setPbf=function(a){$w=a};class ck{constructor(e,n,l){this.tasks=e,this._onCancel=n,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}b0.performDecoding=function(a,e){const n=new Uint8Array(a);return Promise.all(e.tasks.map((l=>{const{layerName:u,firstByte:g,lastByte:_,pixelFormat:w,blockShape:A,blockIndex:z,filters:O,codec:F}=l,U=n.subarray(g,_+1),q=new Uint32Array(A[0]*A[1]*A[2]);let Z;if(F!=="gzip_data")throw new jd(`Unhandled codec: ${F}`);return Z=(function(ee,le){if(!globalThis.DecompressionStream&&le==="gzip_data")return Promise.resolve(((be=(function(Ue){Ue[0]==31&&Ue[1]==139&&Ue[2]==8||gh(6,"invalid gzip data");var Ge=Ue[3],et=10;4&Ge&&(et+=2+(Ue[10]|Ue[11]<<8));for(var yt=(Ge>>3&1)+(Ge>>4&1);yt>0;yt-=!Ue[et++]);return et+(2&Ge)})(_e=ee))+8>_e.length&&gh(6,"invalid gzip data"),(function(Ue,Ge,et,yt){var nt=Ue.length;if(!nt||Ge.f&&!Ge.l)return et||new Vu(0);var bt=!et,Mt=bt||Ge.i!=2,Pt=Ge.i;bt&&(et=new Vu(3*nt));var Ht,qt,Ut=function(ja){var fa=et.length;if(ja>fa){var va=new Vu(Math.max(2*fa,ja));va.set(et),et=va}},$t=Ge.f||0,xt=Ge.p||0,vt=Ge.b||0,Vt=Ge.l,ai=Ge.d,Yt=Ge.m,Di=Ge.n,pi=8*nt;do{if(!Vt){$t=ph(Ue,xt,1);var xi=ph(Ue,xt+1,3);if(xt+=3,!xi){var Mi=Ue[(wt=4+((xt+7)/8|0))-4]|Ue[wt-3]<<8,An=wt+Mi;if(An>nt){Pt&&gh(0);break}Mt&&Ut(vt+Mi),et.set(Ue.subarray(wt,An),vt),Ge.b=vt+=Mi,Ge.p=xt=8*An,Ge.f=$t;continue}if(xi==1)Vt=PI,ai=jI,Yt=9,Di=5;else if(xi==2){var ei=ph(Ue,xt,31)+257,zi=ph(Ue,xt+10,15)+4,un=ei+ph(Ue,xt+5,31)+1;xt+=14;for(var Hn=new Vu(un),Xn=new Vu(19),yn=0;yn<zi;++yn)Xn[AI[yn]]=ph(Ue,xt+3*yn,7);xt+=3*zi;var Pa=Bw(Xn),Re=(1<<Pa)-1,Ne=bv(Xn,Pa);for(yn=0;yn<un;){var wt,Gt=Ne[ph(Ue,xt,Re)];if(xt+=15&Gt,(wt=Gt>>4)<16)Hn[yn++]=wt;else{var hi=0,fi=0;for(wt==16?(fi=3+ph(Ue,xt,3),xt+=2,hi=Hn[yn-1]):wt==17?(fi=3+ph(Ue,xt,7),xt+=3):wt==18&&(fi=11+ph(Ue,xt,127),xt+=7);fi--;)Hn[yn++]=hi}}var Li=Hn.subarray(0,ei),Ni=Hn.subarray(ei);Yt=Bw(Li),Di=Bw(Ni),Vt=bv(Li,Yt),ai=bv(Ni,Di)}else gh(1);if(xt>pi){Pt&&gh(0);break}}Mt&&Ut(vt+131072);for(var _n=(1<<Yt)-1,bn=(1<<Di)-1,Tn=xt;;Tn=xt){var Fn=(hi=Vt[Uw(Ue,xt)&_n])>>4;if((xt+=15&hi)>pi){Pt&&gh(0);break}if(hi||gh(2),Fn<256)et[vt++]=Fn;else{if(Fn==256){Tn=xt,Vt=null;break}var Ji=Fn-254;Fn>264&&(Ji=ph(Ue,xt,(1<<(ua=ek[yn=Fn-257]))-1)+ak[yn],xt+=ua);var on=ai[Uw(Ue,xt)&bn],ia=on>>4;if(on||gh(3),xt+=15&on,Ni=MI[ia],ia>3){var ua=tk[ia];Ni+=Uw(Ue,xt)&(1<<ua)-1,xt+=ua}if(xt>pi){Pt&&gh(0);break}Mt&&Ut(vt+131072);var da=vt+Ji;if(vt<Ni){var ba=0-Ni,Na=Math.min(Ni,da);for(ba+vt<0&&gh(3);vt<Na;++vt)et[vt]=(void 0)[ba+vt]}for(;vt<da;++vt)et[vt]=et[vt-Ni]}}Ge.l=Vt,Ge.p=Tn,Ge.b=vt,Ge.f=$t,Vt&&($t=1,Ge.m=Yt,Ge.d=ai,Ge.n=Di)}while(!$t);return vt!=et.length&&bt?(Ht=et,((qt=vt)==null||qt>Ht.length)&&(qt=Ht.length),new Vu(Ht.subarray(0,qt))):et.subarray(0,vt)})(_e.subarray(be,-8),{i:2},new Vu(((oe=_e)[(fe=oe.length)-4]|oe[fe-3]<<8|oe[fe-2]<<16|oe[fe-1]<<24)>>>0))));var oe,fe,_e,be;const Oe=DI[le];if(!Oe)throw new Error(`Unhandled codec: ${le}`);const Ie=new globalThis.DecompressionStream(Oe);return new Response(new Blob([ee]).stream().pipeThrough(Ie)).arrayBuffer().then((Ue=>new Uint8Array(Ue)))})(U,F).then((ee=>((function(le,oe){le.readFields(bI,oe)})(new $w(ee),q),new OI[w](q.buffer)))),Z.then((ee=>{for(let le=O.length-1;le>=0;le--)switch(O[le]){case"delta_filter":SI(ee,A);break;case"zigzag_filter":TI(ee);break;case"bitshuffle_filter":kI(ee,w);break;default:throw new jd(`Unhandled filter "${O[le]}"`)}return{layerName:u,blockIndex:z,data:ee}})).catch((ee=>{throw ee}))})))},yi(ck,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),yi(b0,"MapboxRasterTile"),yi(lk,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class uk{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class dk{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new qr(Xt,16,0),this.featureIndexArray=new im,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,l,u,g,_=0,w=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,g,_);const z=this.grid;for(let O=0;O<n.length;O++){const F=n[O],U=[1/0,1/0,-1/0,-1/0];for(let q=0;q<F.length;q++){const Z=F[q];U[0]=Math.min(U[0],Z.x),U[1]=Math.min(U[1],Z.y),U[2]=Math.max(U[2],Z.x),U[3]=Math.max(U[3],Z.y)}w!==0&&(U[0]-=w,U[1]-=w,U[2]+=w,U[3]+=w),U[0]<Xt&&U[1]<Xt&&U[2]>=0&&U[3]>=0&&z.insert(A,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new st(new Kx(this.rawTileData)).layers,this.sourceLayerCoder=new uk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:l,transform:u,tileTransform:g,pixelPosMatrix:_,availableImages:w,worldview:A}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const z=n.queryRadius?n.queryRadius:0,O=l.bufferedTilespaceBounds,F=this.grid.query(O.min.x,O.min.y,O.max.x,O.max.y,((ee,le,oe,fe)=>Ao(l.bufferedTilespaceGeometry,ee-z,le-z,oe+z,fe+z)));F.sort(NI);let U=null;u.elevation&&F.length>0&&(U=U_.create(u.elevation,this.tileID));const q={};let Z;for(let ee=0;ee<F.length;ee++){const le=F[ee];if(le===Z)continue;Z=le;const oe=this.featureIndexArray.get(le);let fe=null;this.is3DTile?this.loadMatchingModelFeature(q,oe,e,l,u,A):this.loadMatchingFeature(q,oe,e,w,A,((_e,be,Oe,Ie=0)=>(fe||(fe=Ve(_e,this.tileID.canonical,g)),be.queryIntersectsFeature(l,_e,Oe,fe,this.z,u,_,U,Ie))))}return q}loadMatchingFeature(e,n,l,u,g,_){const{featureIndex:w,bucketIndex:A,sourceLayerIndex:z,layoutVertexArrayOffset:O}=n,F=this.bucketLayerIDs[A],U=l.layers,q=Object.keys(U);if(q.length&&!ci(q,F))return;const Z=l.sourceCache,ee=this.sourceLayerCoder.decode(z),le=this.vtLayers[ee].feature(w),oe=this.getId(le,ee);for(let fe=0;fe<F.length;fe++){const _e=F[fe];if(!U[_e])continue;const{styleLayer:be,targets:Oe}=U[_e];let Ie={};oe!==void 0&&(Ie=Z.getFeatureState(be.sourceLayer,oe));const Ue=!_||_(le,be,Ie,O);if(!Ue)continue;const Ge=new Ig(le,this.z,this.x,this.y,oe);Ge.tile=this.tileID.canonical,Ge.state=Ie;let et=this.serializedLayersCache.get(_e);et||(et=be.serialize(),et.id=_e,this.serializedLayersCache.set(_e,et)),Ge.source=et.source,Ge.sourceLayer=et["source-layer"],Ge.layer=Object.assign({},et),Ge.layer.paint=hk(et.paint,be.paint,le,Ie,u),Ge.layer.layout=hk(et.layout,be.layout,le,Ie,u);let yt=!1;for(const nt of Oe){this.updateFeatureProperties(Ge,nt);const{filter:bt}=nt;if(bt){if(le.properties=Ge.properties,bt.needGeometry){const Mt=it(le,!0);if(!bt.filter(new Da(this.tileID.overscaledZ,{worldview:g}),Mt,this.tileID.canonical))continue}else if(!bt.filter(new Da(this.tileID.overscaledZ,{worldview:g}),le))continue}yt=!0,nt.targetId&&this.addFeatureVariant(Ge,nt)}yt&&this.appendToResult(e,_e,w,Ge,Ue)}}loadMatchingModelFeature(e,n,l,u,g,_){const{featureIndex:w,bucketIndex:A}=n,z=this.bucketLayerIDs[A],O=l.layers,F=Object.keys(O);if(!F.length||ci(F,z))for(let U=0;U<z.length;U++){const q=z[U],{styleLayer:Z,targets:ee}=O[q];if(Z.type!=="model")continue;const le=u.tile,oe=le.getBucket(Z);if(!(oe&&oe instanceof m0))continue;const fe=Gz(oe,w,u,g);if(!fe)continue;const{z:_e,x:be,y:Oe}=le.tileID.canonical,{feature:Ie,intersectionZ:Ue,position:Ge}=fe;let et={};Ie.id!==void 0&&(et=l.sourceCache.getFeatureState(Z.sourceLayer,Ie.id));const yt=new Ig({},_e,be,Oe,Ie.id);yt.tile=this.tileID.canonical,yt.state=et,yt.properties=Ie.properties,yt.geometry={type:"Point",coordinates:[Ge.lng,Ge.lat]};let nt=this.serializedLayersCache.get(q);nt||(nt=Z.serialize(),nt.id=q,this.serializedLayersCache.set(q,nt)),yt.source=nt.source,yt.sourceLayer=nt["source-layer"],yt.layer=Object.assign({},nt);let bt=!1;for(const Mt of ee){this.updateFeatureProperties(yt,Mt);const{filter:Pt}=Mt;if(Pt){if(Ie.properties=yt.properties,Pt.needGeometry){if(!Pt.filter(new Da(this.tileID.overscaledZ,{worldview:_}),Ie,this.tileID.canonical))continue}else if(!Pt.filter(new Da(this.tileID.overscaledZ,{worldview:_}),Ie))continue}bt=!0,Mt.targetId&&this.addFeatureVariant(yt,Mt)}bt&&this.appendToResult(e,q,w,yt,Ue)}}updateFeatureProperties(e,n,l){if(n.properties){const u={};for(const g in n.properties){const _=n.properties[g].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);_!=null&&(u[g]=_)}e.properties=u}}addFeatureVariant(e,n,l){const u={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(u)}appendToResult(e,n,l,u,g){let _=e[n];_===void 0&&(_=e[n]=[]),_.push({featureIndex:l,feature:u,intersectionZ:g})}lookupSymbolFeatures(e,n,l,u,g,_){const w={};this.loadVTLayers();for(const A of e)this.loadMatchingFeature(w,{bucketIndex:n,sourceLayerIndex:l,featureIndex:A,layoutVertexArrayOffset:0},u,g,_);return w}loadFeature(e){const{featureIndex:n,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),g=this.vtFeatures[u];if(g[n])return g[n];const _=this.vtLayers[u].feature(n);return g[n]=_,_}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){let l=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const g=su(u);if(g.result!=="success"){const _=g.value.map((w=>`${w.key}: ${w.message}`)).join(", ");return void mi(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=g.value}l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[u];typeof l=="boolean"&&(l=Number(l))}return l}}function hk(a,e,n,l,u){return ot(a,((g,_)=>{const w=e instanceof xd?e.get(_):null;return w&&w.evaluate?w.evaluate(n,l,void 0,u):w}))}function NI(a,e){return e-a}yi(dk,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const fk=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=l>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const g=fk[15&l];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new Vw(w,_,g,e)}constructor(e,n=64,l=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=fk.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${l}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+A,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+w+A),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+A,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Hw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:w}=this,A=[0,g.length-1,0],z=[];for(;A.length;){const O=A.pop()||0,F=A.pop()||0,U=A.pop()||0;if(F-U<=w){for(let le=U;le<=F;le++){const oe=_[2*le],fe=_[2*le+1];oe>=e&&oe<=l&&fe>=n&&fe<=u&&z.push(g[le])}continue}const q=U+F>>1,Z=_[2*q],ee=_[2*q+1];Z>=e&&Z<=l&&ee>=n&&ee<=u&&z.push(g[q]),(O===0?e<=Z:n<=ee)&&(A.push(U),A.push(q-1),A.push(1-O)),(O===0?l>=Z:u>=ee)&&(A.push(q+1),A.push(F),A.push(1-O))}return z}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:g,nodeSize:_}=this,w=[0,u.length-1,0],A=[],z=l*l;for(;w.length;){const O=w.pop()||0,F=w.pop()||0,U=w.pop()||0;if(F-U<=_){for(let le=U;le<=F;le++)pk(g[2*le],g[2*le+1],e,n)<=z&&A.push(u[le]);continue}const q=U+F>>1,Z=g[2*q],ee=g[2*q+1];pk(Z,ee,e,n)<=z&&A.push(u[q]),(O===0?e-l<=Z:n-l<=ee)&&(w.push(U),w.push(q-1),w.push(1-O)),(O===0?e+l>=Z:n+l>=ee)&&(w.push(q+1),w.push(F),w.push(1-O))}return A}}function Hw(a,e,n,l,u,g){if(u-l<=n)return;const _=l+u>>1;mk(a,e,_,l,u,g),Hw(a,e,n,l,_-1,1-g),Hw(a,e,n,_+1,u,1-g)}function mk(a,e,n,l,u,g){for(;u>l;){if(u-l>600){const z=u-l+1,O=n-l+1,F=Math.log(z),U=.5*Math.exp(2*F/3),q=.5*Math.sqrt(F*U*(z-U)/z)*(O-z/2<0?-1:1);mk(a,e,n,Math.max(l,Math.floor(n-O*U/z+q)),Math.min(u,Math.floor(n+(z-O)*U/z+q)),g)}const _=e[2*n+g];let w=l,A=u;for(Sv(a,e,l,n),e[2*u+g]>_&&Sv(a,e,l,u);w<A;){for(Sv(a,e,w,A),w++,A--;e[2*w+g]<_;)w++;for(;e[2*A+g]>_;)A--}e[2*l+g]===_?Sv(a,e,l,A):(A++,Sv(a,e,A,u)),A<=n&&(l=A+1),n<=A&&(u=A-1)}}function Sv(a,e,n,l){Gw(a,n,l),Gw(e,2*n,2*l),Gw(e,2*n+1,2*l+1)}function Gw(a,e,n){const l=a[e];a[e]=a[n],a[n]=l}function pk(a,e,n,l){const u=a-n,g=e-l;return u*u+g*g}i.$=id,i.A=ac,i.B=sl,i.C=2,i.D=sr,i.E=gc,i.F=av,i.G=U2,i.H=gl,i.I=zs,i.J=Gm,i.K=Pi,i.L=Eu,i.M=Ca,i.N=Yd,i.O=Lu,i.P=Pe,i.Q=Gr,i.R=mc,i.S=$f,i.T=Qb,i.U=su,i.V=f0,i.W=Fm,i.X=Qs,i.Y=Ar,i.Z=hs,i._=Sr,i.a=function(a){return Sn.API_CDN_URL_REGEX.test(a)},i.a$=Y,i.a0=Ki,i.a1=Lo,i.a2=Cc,i.a3=class extends f0{},i.a4=vr,i.a5=Lm,i.a6=at,i.a7=function(a){const e=a.value;return e?Ki(e)?Pw(e,!0)?[]:[new f0(a.key,e,`invalid url "${e}"`)]:[new f0(a.key,e,`string expected, "${Pi(e)}" found`)]:[]},i.a8=eh,i.a9=ur,i.aA=ie,i.aB=Se,i.aC=Vr,i.aD=eo,i.aE=Ma,i.aF=j,i.aG=ge,i.aH=function(a,e){const n={};for(let l=0;l<e.length;l++){const u=e[l];u in a&&(n[u]=a[u])}return n},i.aI=m,i.aJ=D,i.aK=class{constructor(a){this.entries={},this.scheduler=a}request(a,e,n,l){const u=this.entries[a]=this.entries[a]||{callbacks:[]};if(u.result){const[g,_]=u.result;return this.scheduler?this.scheduler.add((()=>{l(g,_)}),e):l(g,_),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=n(((g,_)=>{u.result=[g,_];for(const w of u.callbacks)this.scheduler?this.scheduler.add((()=>{w(g,_)}),e):w(g,_);setTimeout((()=>delete this.entries[a]),3e3)}))),()=>{u.result||(u.callbacks=u.callbacks.filter((g=>g!==l)),u.callbacks.length||(u.cancel(),delete this.entries[a]))}}},i.aL=function(a,e,n){const l=JSON.stringify(a.request);return a.data&&(this.deduped.entries[l]={result:[null,a.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},(u=>{const g=Ro(a.request,((_,w,A)=>{_?u(_):w&&u(null,{rawData:w,vectorTile:n?void 0:new st(new Kx(w)),responseHeaders:new Map(A.entries())})}));return()=>{g.cancel(),u()}}),e)},i.aM=function(a){return a?{cacheControl:a.get("Cache-Control"),expires:a.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=ds,i.aO=function(a){Ws++,Ws>hc&&(a.getActor().send("enforceCacheSizeLimit",Su),Ws=0)},i.aP=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log2(a)))},i.aQ=Dn,i.aR=gT,i.aS=wT,i.aT=s,i.aU=pT,i.aV=function(a,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let l=0;l<a.length;l++){const u=document.createElement("source");Xu(a[l])||(n.crossOrigin="Anonymous"),u.src=a[l],n.appendChild(u)}return{cancel:()=>{}}},i.aW=Qy,i.aX=Rg,i.aY=Je,i.aZ=lv,i.a_=V,i.aa=Kt,i.ab=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return Zi(a.expression.evaluate(e))}interpolate(a,e,n){return{x:$i(a.x,e.x,n),y:$i(a.y,e.y,n),z:$i(a.z,e.z,n),azimuthal:$i(a.azimuthal,e.azimuthal,n),polar:$i(a.polar,e.polar,n)}}},i.ac=Da,i.ad=yd,i.ae=pe,i.af=Fi,i.ag=Ri,i.ah=ue,i.ai=xd,i.aj=Md,i.ak=$i,i.al=Xt,i.am=Eh,i.an=ui,i.ao=ha,i.ap=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return(function([n,l]){const u=Zi([1,n,l]);return{x:u.x,y:u.y,z:u.z}})(a.expression.evaluate(e))}interpolate(a,e,n){return{x:$i(a.x,e.x,n),y:$i(a.y,e.y,n),z:$i(a.z,e.z,n)}}},i.aq=function(a,e,n=0,l=!0){const u=new Pe(n,n),g=a.sub(u),_=e.add(u),w=[g,new Pe(_.x,g.y),_,new Pe(g.x,_.y)];return l&&w.push(g.clone()),w},i.ar=function(a,e){const n=[];for(let l=0;l<a.length;l++){const u=Te(l-1,-1,a.length-1),g=Te(l+1,-1,a.length-1),_=a[l],w=a[g],A=a[u].sub(_).unit(),z=w.sub(_).unit(),O=z.angleWithSep(A.x,A.y),F=A.add(z).unit().mult(-1*e/Math.sin(O/2));n.push(_.add(F))}return n},i.as=eT,i.at=Ao,i.au=function(a,e,n=0){return We(((e.x-n)*a.scale-a.x)*Xt,(e.y*a.scale-a.y)*Xt,X(e.z,e.y))},i.av=za,i.aw=qn,i.ax=bi,i.ay=p2,i.az=function(a){let e=1/0,n=1/0,l=-1/0,u=-1/0;for(const g of a)e=Math.min(e,g.x),n=Math.min(n,g.y),l=Math.max(l,g.x),u=Math.max(u,g.y);return{min:new Pe(e,n),max:new Pe(l,u)}},i.b=function(a){return Sn.API_FONTS_REGEX.test(a)},i.b$=S_,i.b0=Wr,i.b1=ih,i.b2=qe,i.b3=ep,i.b4=c0,i.b5=function(){cu.isLoading()||cu.isLoaded()||Bh()!=="deferred"||Qp()},i.b6=Uh,i.b7=it,i.b8=Ig,i.b9=$n,i.bA=ce,i.bB=tt,i.bC=re,i.bD=function(a,e){const{x:n,y:l}=a.point,u=h_(n,l,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Se(u,u,u_(Co(e)))},i.bE=N,i.bF=ln,i.bG=Ci,i.bH=oi,i.bI=Ja,i.bJ=On,i.bK=L_,i.bL=Fc,i.bM=_w,i.bN=function(a,e,n,l,u){const g=5*e+2;a.float32[g+0]=n,a.float32[g+1]=l,a.float32[g+2]=u},i.bO=B_,i.bP=zr,i.bQ=Ko,i.bR=Ss,i.bS=tc,i.bT=Te,i.bU=function(a,e,n,l){var u=new P(4);return u[0]=a,u[1]=e,u[2]=n,u[3]=l,u},i.bV=class{isDataAvailableAtPoint(a){const e=this._source();if(this.isUsingMockSource()||!e||a.y<0||a.y>1)return!1;const n=e.getSource().maxzoom,l=1<<n,u=Math.floor(a.x),g=Math.floor((a.x-u)*l),_=Math.floor(a.y*l),w=this.findDEMTileFor(new Dn(n,u,n,g,_));return!(!w||!w.dem)}getAtPointOrZero(a,e=0){return this.getAtPoint(a,e)||0}getAtPoint(a,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||a.y<0||a.y>1)return e;const u=l.getSource().maxzoom,g=1<<u,_=Math.floor(a.x),w=a.x-_,A=new Dn(u,_,u,Math.floor(w*g),Math.floor(a.y*g)),z=this.findDEMTileFor(A);if(!z||!z.dem)return e;const O=z.dem,F=1<<z.tileID.canonical.z,U=(w*F-z.tileID.canonical.x)*O.dim,q=(a.y*F-z.tileID.canonical.y)*O.dim,Z=Math.floor(U),ee=Math.floor(q);return(n?this.exaggeration():1)*$i($i(O.get(Z,ee),O.get(Z,ee+1),q-ee),$i(O.get(Z+1,ee),O.get(Z+1,ee+1),q-ee),U-Z)}static getAtTileOffset(a,e,n,l){const u=1<<a.canonical.z;return l?l.pointElevation(e):n?n.getAtPointOrZero(new pe(a.wrap+(a.canonical.x+e.x/Xt)/u,(a.canonical.y+e.y/Xt)/u)):0}static getAtTileOffsetFunc(a,e,n,l){return(u,g,_)=>{const w=this.getAtTileOffset(a,u,g,_),A=l.upVector(a.canonical,u.x,u.y);return Ct(A,A,w*l.upVectorScale(a.canonical,e,n).metersToTile),A}}getForTilePoints(a,e,n,l){if(this.isUsingMockSource())return!1;const u=U_.create(this,a,l);return!!u&&(e.forEach((g=>{g[2]=this.exaggeration()*u.getElevationAt(g[0],g[1],n)})),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(a);if(!e||!e.dem)return null;const n=e.dem.tree,l=e.tileID,u=1<<a.canonical.z-l.canonical.z;let g=a.canonical.x/u-l.canonical.x,_=a.canonical.y/u-l.canonical.y,w=0;for(let A=0;A<a.canonical.z-l.canonical.z&&!n.leaves[w];A++){g*=2,_*=2;const z=2*Math.floor(_)+Math.floor(g);w=n.childOffsets[w]+z,g%=1,_%=1}return{min:this.exaggeration()*n.minimums[w],max:this.exaggeration()*n.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let e=!1,n=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const u of a){const g=this.getMinMaxForTile(u.tileID);g&&(n=Math.min(n,g.min),l=Math.max(l,g.max),e=!0)}return e?{min:n,max:l}:null}},i.bW=ii,i.bX=Rn,i.bY=Bs,i.bZ=Hy,i.b_=ST,i.ba=lw,i.bb=mp,i.bc=Ve,i.bd=Mc,i.be=Fu,i.bf=nf,i.bg=tr,i.bh=cm,i.bi=Cw,i.bj=function(a,e){const n=Md(e.zoom);if(n===0)return Co(a);const l=dg(a),u=c_(l),g=j(l.getWest())*e.worldSize,_=j(l.getEast())*e.worldSize,w=D(l.getNorth())*e.worldSize,A=D(l.getSouth())*e.worldSize,z=[g,w,0],O=[_,w,0],F=[g,A,0],U=[_,A,0],q=ve([],e.globeMatrix);return Fi(z,z,q),Fi(O,O,q),Fi(F,F,q),Fi(U,U,q),u[0]=ho(u[0],F,n),u[1]=ho(u[1],U,n),u[2]=ho(u[2],O,n),u[3]=ho(u[3],z,n),wi.fromPoints(u)},i.bk=cp,i.bl=ve,i.bm=lp,i.bn=ho,i.bo=th,i.bp=om,i.bq=Ke,i.br=Ee,i.bs=b0,i.bt=Kx,i.bu=Ro,i.bv=function(a,e){const n=[];for(const l in a)l in e||n.push(l);return n},i.bw=Fe,i.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.by=zt,i.bz=ae,i.c=zn,i.c$=function(a,e,n){let l=0;for(let u=0;u<2;++u)a[u]>0&&(l+=(a[u]-0)*(a[u]-0)),e[u]<0&&(l+=(0-e[u])*(0-e[u]));return l},i.c0=T_,i.c1=mw,i.c2=Z2,i.c3=ww,i.c4=Vw,i.c5=Ct,i.c6=Zo,i.c7=Kr,i.c8=function(a,e,n){n*=.5;var l=e[0],u=e[1],g=e[2],_=e[3],w=Math.sin(n),A=Math.cos(n);return a[0]=l*A+u*w,a[1]=u*A-l*w,a[2]=g*A+_*w,a[3]=_*A-g*w,a},i.c9=Qa,i.cA=Ft,i.cB=Jn,i.cC=e2,i.cD=Ea,i.cE=vx,i.cF=function(a,e,n,l,u,g,_,w,A){if(A.name==="globe")return vx(a,e,new Ea(n,l,u),!1);const z=lv({z:n,x:l,y:u},A);return new wi([(g+z.x/z.scale)*e,e*(z.y/z.scale),_],[(g+z.x2/z.scale)*e,e*(z.y2/z.scale),w])},i.cG=function(a,e,n){return a[0]=Math.min(e[0],n[0]),a[1]=Math.min(e[1],n[1]),a[2]=Math.min(e[2],n[2]),a[3]=Math.min(e[3],n[3]),a},i.cH=function(a,e,n){return a[0]=Math.max(e[0],n[0]),a[1]=Math.max(e[1],n[1]),a[2]=Math.max(e[2],n[2]),a[3]=Math.max(e[3],n[3]),a},i.cI=function(a){const e=Math.round((a+45+360)%360/90)%4;return Si[e]},i.cJ=J,i.cK=ws,i.cL=sp,i.cM=function(a){const e=ce(new Float64Array(16));Se(e,a.pixelMatrix,a.globeMatrix);const n=[0,ql,0],l=[0,is,0];return Fi(n,n,e),Fi(l,l,e),[n[0]>0&&n[0]<=a.width&&n[1]>0&&n[1]<=a.height&&!ky(a,new s(a.center.lat,90)),l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!ky(a,new s(a.center.lat,-90))]},i.cN=function(a,e){const{scale:n}=a.tileTransform,l=n*Xt/(a.tileSize*Math.pow(2,e.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return(function(u,g,_){var w=g[1],A=g[2],z=g[3],O=_[0],F=_[1];return u[0]=g[0]*O,u[1]=w*O,u[2]=A*F,u[3]=z*F,u})(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},i.cO=Gx,i.cP=ni,i.cQ=QS,i.cR=function(a){const e=QS(a,!0);return N([],[e[0],e[1],e[4],e[5]])},i.cS=Qe,i.cT=di,i.cU=He,i.cV=function(a){const{x:e,y:n}=a.point,{lng:l,lat:u}=a._center;return h_(e,n,a.worldSize,l,u)},i.cW=Ce,i.cX=qi,i.cY=ir,i.cZ=Ns,i.c_=Hl,i.ca=Ta,i.cb=function(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a[3]=e[3],a},i.cc=gt,i.cd=function(a,e,n,l,u){var g=1/Math.tan(e/2);if(a[0]=g/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,u!=null&&u!==1/0){var _=1/(l-u);a[10]=(u+l)*_,a[14]=2*u*l*_}else a[10]=-1,a[14]=-2*l;return a},i.ce=function(a,e,n,l,u,g,_){var w=1/(e-n),A=1/(l-u),z=1/(g-_);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*z,a[11]=0,a[12]=(e+n)*w,a[13]=(u+l)*A,a[14]=(_+g)*z,a[15]=1,a},i.cf=B,i.cg=function(a,e,n){a[4*e+0]=n[0],a[4*e+1]=n[1],a[4*e+2]=n[2],a[4*e+3]=n[3]},i.ch=am,i.ci=Yh,i.cj=Cr,i.ck=Eo,i.cl=Kh,i.cm=rT,i.cn=function(){var a=new P(4);return P!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},i.co=function(a,e,n){var l=e[0],u=e[1],g=e[2],_=e[3],w=Math.sin(n),A=Math.cos(n);return a[0]=l*A+g*w,a[1]=u*A+_*w,a[2]=l*-w+g*A,a[3]=u*-w+_*A,a},i.cp=function(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]},i.cq=xn,i.cr=function(a){var e=a[0],n=a[1],l=a[2],u=a[3];return Math.sqrt(e*e+n*n+l*l+u*u)},i.cs=Hs,i.ct=hn,i.cu=Mr,i.cv=3,i.cw=2,i.cx=7,i.cy=6,i.cz=Qi,i.d=function(a){return Sn.API_TILEJSON_REGEX.test(a)},i.d$=class{constructor(a,e,n,l){this.context=a,this.format=l,this.size=n,this.texture=a.gl.createTexture();const[u,g,_]=this.size,{gl:w}=a;w.bindTexture(w.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&w.texImage3D(w.TEXTURE_3D,0,this.format,u,g,_,0,Kb(this.format),Jb(this.format),e.data)}bind(a,e){const{context:n}=this,{gl:l}=n;l.bindTexture(l.TEXTURE_3D,this.texture),a!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,a),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,a),this.minFilter=a),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},i.d0=function(a){return a*a*a*a*a},i.d1=E,i.d2=45,i.d3=rm,i.d4=function(a,e,n){const l=Math.sqrt(a*a+e*e+n*n),u=l>0?Math.acos(n/l)*Ei:0;let g=a!==0||e!==0?Math.atan2(-e,-a)*Ei+90:0;return g<0&&(g+=360),[l,g,u]},i.d5=We,i.d6=Zi,i.d7=de,i.d8=jt,i.d9=wi,i.dA=function(a){return a({pluginStatus:To,pluginURL:lu}),Ff.on("pluginStateChange",a),a},i.dB=$u,i.dC=class extends Uu{constructor(a){super(a),this.current=Jh}set(a,e,n){if(this.fetchUniformLocation(a,e)){for(let l=0;l<9;l++)if(n[l]!==this.current[l]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},i.dD=pn,i.dE=function(a,e,n){const l=Md(n.zoom),u=a.style.map._antialias,g=a.terrain&&a.terrain.exaggeration()>0;return l===0&&!u&&!g},i.dF=function(a){const e=a.pixelsPerMeter,n=e/B(1,a.center.lat),l=ce(new Float64Array(16));return Ee(l,l,[a.point.x,a.point.y,0]),Qe(l,l,[n,n,e]),Float32Array.from(l)},i.dG=dg,i.dH=function(a){const e=J-5;a=ie(a,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(ui(a))),3);return Math.round(n*(Gl.length-1))},i.dI=function(a,e,n,l){const u=e.getNorth(),g=e.getSouth(),_=e.getWest(),w=e.getEast(),A=1<<a.z,z=w-_,O=u-g,F=z/uo,U=-O/Gl[n],q=[0,F,0,U,0,0,u,_,0];if(a.z>0){const Z=180/l;K(q,q,[Z/z+1,0,0,0,Z/O+1,0,-.5*Z/F,.5*Z/U,1])}return q[2]=A,q[5]=a.x,q[8]=a.y,q},i.dJ=Co,i.dK=function(a,e,n){const l=ce(new Float64Array(16)),u=(e/(1<<a)-.5)*Math.PI*2;return ke(l,n.globeMatrix,u),Float32Array.from(l)},i.dL=Vo,i.dM=Xl,i.dN=function(a,e){return[Math.pow(a[0],2.2)*e,Math.pow(a[1],2.2)*e,Math.pow(a[2],2.2)*e]},i.dO=H,i.dP=function(a,e){var n=Math.sin(e),l=Math.cos(e);return a[0]=l,a[1]=n,a[2]=0,a[3]=-n,a[4]=l,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},i.dQ=nn,i.dR=bx,i.dS=an,i.dT=ea,i.dU=256,i.dV=function(a,e){const n=[0,0,0];return Fi(n,n,cp(Co(e.canonical))),Fi(n,n,a),n},i.dW=a=>({u_matrix:new Kh(a),u_texsize:new Eo(a),u_pixels_to_tile_units:new Qh(a),u_device_pixel_ratio:new Cr(a),u_width_scale:new Cr(a),u_floor_width_scale:new Cr(a),u_image:new am(a),u_units_to_pixels:new Eo(a),u_tile_units_to_pixels:new Cr(a),u_alpha_discard_threshold:new Cr(a),u_trim_offset:new Eo(a),u_trim_fade_range:new Eo(a),u_trim_color:new rm(a),u_zbias_factor:new Cr(a),u_tile_to_meter:new Cr(a),u_ground_shadow_factor:new Yh(a),u_pattern_transition:new Cr(a)}),i.dX=a=>({u_matrix:new Kh(a),u_pixels_to_tile_units:new Qh(a),u_device_pixel_ratio:new Cr(a),u_width_scale:new Cr(a),u_floor_width_scale:new Cr(a),u_units_to_pixels:new Eo(a),u_dash_image:new am(a),u_gradient_image:new am(a),u_image_height:new Cr(a),u_texsize:new Eo(a),u_tile_units_to_pixels:new Cr(a),u_alpha_discard_threshold:new Cr(a),u_trim_offset:new Eo(a),u_trim_fade_range:new Eo(a),u_trim_color:new rm(a),u_zbias_factor:new Cr(a),u_tile_to_meter:new Cr(a),u_ground_shadow_factor:new Yh(a)}),i.dY=a=>({u_camera_to_center_distance:new Cr(a),u_extrude_scale:new Qh(a),u_device_pixel_ratio:new Cr(a),u_matrix:new Kh(a),u_inv_rot_matrix:new Kh(a),u_merc_center:new Eo(a),u_tile_id:new Yh(a),u_zoom_transition:new Cr(a),u_up_dir:new Yh(a),u_emissive_strength:new Cr(a)}),i.dZ=Yf,i.d_=Xj,i.da=Gi,i.db=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},i.dc=JS,i.dd=rw,i.de=n2,i.df=Pw,i.dg=function(a,e){return a.readFields(Zz,{icons:[]},e)},i.dh=Ux,i.di=O_,i.dj=vw,i.dk=Jo,i.dl=Nh,i.dm=_o,i.dn=Xs,i.dp=St,i.dq=function(a){const e=a.indexOf(Sd);return e>=0?a.slice(0,e):a},i.dr=function(a){return a.indexOf(Sd)>=0},i.ds=function(a){const e=a.lastIndexOf(Sd);return e>=0?a.slice(e+1):""},i.dt=function(a){const e=[],n=a.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),a.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},i.du=function(a,e,n,l){return a.type==="custom"?new Uz(a,e):new qz[a.type](a,e,n,l)},i.dv=Rt,i.dw=function(a){const e=a.indexOf(Sd);return e>=0?a.slice(e+1):""},i.dx=class extends Ig{constructor(a,e){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},i.dy=Ff,i.dz=xo,i.e=Sn,i.e$=Et,i.e0=f_,i.e1=(a,e,n,l,u,g)=>{const _=a.transform,w=_.projection.name==="globe";let A;if(g.paint.get("circle-pitch-alignment")==="map")if(w){const O=bx(_.zoom,e.canonical)*_._pixelsPerMercatorPixel;A=Float32Array.from([O,0,0,O])}else A=_.calculatePixelsToTileUnitsMatrix(n);else A=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(_.projection),u_matrix:a.translatePosMatrix(e.projMatrix,n,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:xa.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:rr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(w){z.u_inv_rot_matrix=l,z.u_merc_center=u,z.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],z.u_zoom_transition=Md(_.zoom);const O=u[0]*Xt,F=u[1]*Xt;z.u_up_dir=_.projection.upVector(new Ea(0,0,0),O,F)}return z},i.e2=v2,i.e3=ro,i.e4=(a,e,n,l,u,g,_,w,A,z)=>{const O=a.transform,F=O.pitch<15?g2(.07,.7,ie((14-O.zoom)/5,0,1)):.07,U=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:y2(a,e,n,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:g,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:_2(e,O),u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(U?null:n.lut).toArray01(),u_zbias_factor:F,u_tile_to_meter:de(e.tileID.canonical,0),u_ground_shadow_factor:A,u_pattern_transition:z}},i.e5=(a,e,n,l,u,g,_,w,A,z)=>{const O=a.transform,F=O.calculatePixelsToTileUnitsMatrix(e),U=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",q=O.pitch<15?g2(.07,.7,ie((14-O.zoom)/5,0,1)):.07;return{u_matrix:y2(a,e,n,l),u_pixels_to_tile_units:F,u_device_pixel_ratio:g,u_width_scale:_,u_floor_width_scale:w,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:x2(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:_2(e,a.transform),u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(U?null:n.lut).toArray01(),u_zbias_factor:q,u_tile_to_meter:de(e.tileID.canonical,0),u_ground_shadow_factor:z}},i.e6=rt,i.e7=gg,i.e8=X,i.e9=lc,i.eA=function(a,e){var n=2*Math.acos(e[3]),l=Math.sin(n/2);return l>M?(a[0]=e[0]/l,a[1]=e[1]/l,a[2]=e[2]/l):(a[0]=1,a[1]=0,a[2]=0),n},i.eB=Iw,i.eC=Zx,i.eD=Wx,i.eE=[1,1,1],i.eF=U_,i.eG=$s,i.eH=function(a,e,n,l){var u=e[0],g=e[1],_=e[2],w=e[3];return a[0]=u+l*(n[0]-u),a[1]=g+l*(n[1]-g),a[2]=_+l*(n[2]-_),a[3]=w+l*(n[3]-w),a},i.eI=z_,i.eJ=Tl,i.eK=Rr,i.eL=function(a,e,n,l,u,g,_,w,A,z,O,F,U,q,Z,ee){var le=new P(16);return le[0]=a,le[1]=e,le[2]=n,le[3]=l,le[4]=u,le[5]=g,le[6]=_,le[7]=w,le[8]=A,le[9]=z,le[10]=O,le[11]=F,le[12]=U,le[13]=q,le[14]=Z,le[15]=ee,le},i.eM=f,i.eN=ah,i.eO=og,i.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Pe(1/0,1/0),max:new Pe(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,e=!1){const n=qy(new Pe(0,0),new Pe(Xt,Xt),a),l=[];if(e&&!b_(n,this._globalClipBounds))return l;for(const u of this._activeRegions){if(u.hiddenByOverlap||!b_(n,u))continue;const g=w_(u.min,u.max,a);l.push({min:g.min,max:g.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return l}setSources(a){this._setSources(a.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const l of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(l).buckets[e.layer];u&&u.updateFootprints(l.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(a){const e=a.getFootprints();if(e.length===0)return;const n=a.getOrder(),l=a.getClipMask(),u=a.getClipScope();for(const g of e){if(!g.footprint)continue;const _=qy(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:n,clipMask:l,clipScope:u})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,n)=>e.priority-n.priority||kg(e.min,n.min)||kg(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||(function(l,u){const g=(_,w)=>_+w;return l.length-u.length||l.reduce(g,"").localeCompare(u.reduce(g,""))})(e.clipScope,n.clipScope)));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let e=0;for(;!a&&e!==this._activeRegions.length;){const n=this._activeRegions[e],l=this._prevRegions[e];a=n.priority!==l.priority||!Gy(n,l)||n.order!==l.order||n.clipMask!==l.clipMask||!zt(n.clipScope,l.clipScope),this._activeRegions[e].hiddenByOverlap=l.hiddenByOverlap,++e}}if(a){++this._updateTime;for(const n of this._activeRegions)n.order!==ch&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const l=this._activeRegions;if(n>=l.length)return n;const u=l[n].priority;for(;n<l.length&&l[n].priority===u;)++n;return n};if(this._sourceIds.length>1){let n=0,l=e(n);for(;n!==l;){let u=n;const g=n;for(;u!==l;){const _=this._activeRegions[u];_.hiddenByOverlap=!1;for(let w=0;w<g;w++){const A=this._activeRegions[w];if(!A.hiddenByOverlap&&_.order===ch&&b_(_,A)&&(_.hiddenByOverlap=Dx(_.footprint,_.tileId,A.footprint,A.tileId),_.hiddenByOverlap))break}++u}n=l,l=e(n)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=a.length-1;e>=0;e--)this._addSource(a[e]);this._computeReplacement()}},i.eQ=ch,i.eR=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,e){const n=new Mc,l=new Wr,u=[],g=a+1+2,_=e[0]+1,w=e[0]+1+(1+e.length),A=(z,O,F)=>{let U=z===g-1?z-2:z===0?z:z-1;return U+=F?24575:0,[U,O]};for(let z=0;z<g;++z)n.emplaceBack(...A(z,0,!0));for(let z=0;z<_;++z)for(let O=0;O<g;++O)n.emplaceBack(...A(O,z,(O===0||O===g-1)&&!0));for(let z=0;z<e.length;++z){const O=e[z];for(let F=0;F<g;++F)n.emplaceBack(...A(F,O,!0))}for(let z=0;z<e.length;++z){const O=l.length,F=e[z]+1+2,U=new Wr;for(let ee=0;ee<F-1;ee++){const le=ee===F-2,oe=le?g*(w-e.length+z-ee):g;for(let fe=0;fe<g-1;fe++){const _e=ee*g+fe;ee===0||le||fe===0||fe===g-2?(U.emplaceBack(_e+1,_e,_e+oe),U.emplaceBack(_e+oe,_e+oe+1,_e+1)):(l.emplaceBack(_e+1,_e,_e+oe),l.emplaceBack(_e+oe,_e+oe+1,_e+1))}}const q=tr.simpleSegment(0,O,n.length,l.length-O);for(let ee=0;ee<U.uint16.length;ee+=3)l.emplaceBack(U.uint16[ee],U.uint16[ee+1],U.uint16[ee+2]);const Z=tr.simpleSegment(0,O,n.length,l.length-O);u.push({withoutSkirts:q,withSkirts:Z})}return{vertices:n,indices:l,segments:u}}_createGrid(a){const e=this._fillGridMeshWithLods(uo,Gl);this._gridSegments=e.segments,this._gridBuffer=a.createVertexBuffer(e.vertices,nf.members),this._gridIndexBuffer=a.createIndexBuffer(e.indices,!0)}_createPoles(a){const e=new Wr;for(let _=0;_<=uo;_++)e.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=a.createIndexBuffer(e,!0);const n=new Td,l=new Td,u=new Td,g=new Td;this._poleSegments=[];for(let _=0,w=0;_<Hl;_++){const A=360/(1<<_);n.emplaceBack(0,-eo,0,.5,0),l.emplaceBack(0,-eo,0,.5,1),u.emplaceBack(0,-eo,0,.5,.5),g.emplaceBack(0,-eo,0,.5,.5);for(let z=0;z<=uo;z++){let O=z/uo,F=0;const U=$i(0,A,O),[q,Z,ee]=Ad(Db,Sx,U,eo);n.emplaceBack(q,Z,ee,O,F),l.emplaceBack(q,Z,ee,O,1-F);const le=ui(U);O=.5+.5*Math.sin(le),F=.5+.5*Math.cos(le),u.emplaceBack(q,Z,ee,O,F),g.emplaceBack(q,Z,ee,O,1-F)}this._poleSegments.push(tr.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(n,Rc,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(l,Rc,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(u,Rc,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(g,Rc,!1)}getGridBuffers(a,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},i.eS=Rx,i.eT=kn,i.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eV=Ze,i.eW=he,i.eX=function(a,e,n){return a[0]=e[0]/n[0],a[1]=e[1]/n[1],a[2]=e[2]/n[2],a},i.eY=$c,i.eZ=Wl,i.e_=Ba,i.ea=xp,i.eb=R,i.ec=Nc,i.ed=Lx,i.ee=uh,i.ef=ne,i.eg=function(a,e){if(a===e){var n=e[1],l=e[2],u=e[3],g=e[6],_=e[7],w=e[11];a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=n,a[6]=e[9],a[7]=e[13],a[8]=l,a[9]=g,a[11]=e[14],a[12]=u,a[13]=_,a[14]=w}else a[0]=e[0],a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=e[1],a[5]=e[5],a[6]=e[9],a[7]=e[13],a[8]=e[2],a[9]=e[6],a[10]=e[10],a[11]=e[14],a[12]=e[3],a[13]=e[7],a[14]=e[11],a[15]=e[15];return a},i.eh=Bz,i.ei=Mn,i.ej=Qm,i.ek=256,i.el=u_,i.em=Sl,i.en=ke,i.eo=function(a,e){return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[4],a[4]=e[5],a[5]=e[6],a[6]=e[8],a[7]=e[9],a[8]=e[10],a},i.ep=Td,i.eq=Du,i.er=Km,i.es=function(a,e,n,l,u){return ie((a-e)/(n-e)*(u-l)+l,l,u)},i.et=us,i.eu=function(a,e){var n=e[0],l=e[1],u=e[2],g=e[3],_=e[4],w=e[5],A=e[6],z=e[7],O=e[8],F=O*_-w*z,U=-O*g+w*A,q=z*g-_*A,Z=n*F+l*U+u*q;return Z?(a[0]=F*(Z=1/Z),a[1]=(-O*l+u*z)*Z,a[2]=(w*l-u*_)*Z,a[3]=U*Z,a[4]=(O*n-u*A)*Z,a[5]=(-w*n+u*g)*Z,a[6]=q*Z,a[7]=(-z*n+l*A)*Z,a[8]=(_*n-l*g)*Z,a):null},i.ev=2,i.ew=Un,i.ex=Xo,i.ey=ft,i.ez=function(a,e){var n=new P(3);ft(n,e);var l=1/n[0],u=1/n[1],g=1/n[2],_=e[0]*l,w=e[1]*u,A=e[2]*g,z=e[4]*l,O=e[5]*u,F=e[6]*g,U=e[8]*l,q=e[9]*u,Z=e[10]*g,ee=_+O+Z,le=0;return ee>0?(le=2*Math.sqrt(ee+1),a[3]=.25*le,a[0]=(F-q)/le,a[1]=(U-A)/le,a[2]=(w-z)/le):_>O&&_>Z?(le=2*Math.sqrt(1+_-O-Z),a[3]=(F-q)/le,a[0]=.25*le,a[1]=(w+z)/le,a[2]=(U+A)/le):O>Z?(le=2*Math.sqrt(1+O-_-Z),a[3]=(U-A)/le,a[0]=(w+z)/le,a[1]=.25*le,a[2]=(F+q)/le):(le=2*Math.sqrt(1+Z-_-O),a[3]=(w-z)/le,a[0]=(U+A)/le,a[1]=(F+q)/le,a[2]=.25*le),a},i.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,((e,n)=>String.fromCharCode(+("0x"+n)))))},i.f0=function([a,e,n]){const l=Math.hypot(a,e,n),u=Math.atan2(a,n),g=.5*Math.PI-Math.acos(-e/l);return new s(qi(u),qi(g))},i.f1=Vs,i.f2=ew,i.f3=function(a){const e=a.navigator?a.navigator.userAgent:null;return!!(function(n){if(Ia==null){const l=n.navigator?n.navigator.userAgent:null;Ia=!!n.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Ia})(a)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f4=function(a,e){Su=a,hc=e},i.f5=ky,i.f6=wx,i.f7=function(a){const e=[0,0,0],n=ce(new Float64Array(16));return Se(n,a.pixelMatrix,a.globeMatrix),Fi(e,e,n),new Pe(e[0],e[1])},i.f8=function(){const a=pu;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(aa),pu=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f9=function(){Ux().acquire(aa)},i.fA=x0,i.fB=Ye,i.fC=function(a){let e=0;if(new Uint32Array(a,0,1)[0]!==WS){const n=new Uint32Array(a,0,7),[,,l,u,g,_]=n;e=n.byteLength+u+g+_+g,(l!==a.byteLength||e>=a.byteLength)&&mi("Invalid b3dm header information.")}return KS(a,e)},i.fD=function(a,e){const n=rw(a);for(const l of n){for(const u of l.meshes)_j(u);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(yj(l.lights,e)))}return n},i.fE=m0,i.fF=Ui,i.fG=Xa,i.fH=cu,i.fI=rl,i.fJ=function(a){yo(),dl?.then((e=>{e.keys().then((n=>{for(let l=0;l<n.length-a;l++)e.delete(n[l]).catch((u=>mi(u.message)))})).catch((n=>mi(n.message)))})).catch((e=>mi(e.message)))},i.fa=Bh,i.fb=function(a,e,n=!1){if(To===rl.deferred||To===rl.loading||To===rl.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");lu=xa.resolveURL(a),To=rl.deferred,Jp=e,Fh(),n||Qp()},i.fc=function(a){M_=xa.resolveURL(a),P_||(P_=new sr(Ux(),new gc)),P_.broadcast("setMeshoptUrl",M_)},i.fd=GS,i.fe=function(a){Zb=xa.resolveURL(a),P_||(P_=new sr(Ux(),new gc)),P_.broadcast("setDracoUrl",Zb)},i.ff=HS,i.fg=Ln,i.fh=function(a){const e=io();if(!e)return;const n=e.delete(Vc);a&&n.then((()=>a())).catch(a)},i.fi=gs,i.fj=yi,i.fk=hr,i.fl=mh,i.fm=uk,i.fn=dk,i.fo=h2,i.fp=pt,i.fq="hd_road_elevation",i.fr=la,i.fs=ot,i.ft=lh,i.fu=yw,i.fv=jg,i.fw=function(a,e,n,l,u,g,_,w=1,A,z,O){a.createArrays(),a.tilePixelRatio=Xt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const F=a.layers[0].layout,U=a.layers[0]._unevaluatedLayout._values,q={};q.scaleFactor=w,q.textSizeScaleRange=F.get("text-size-scale-range"),q.iconSizeScaleRange=F.get("icon-size-scale-range");const[Z,ee]=q.textSizeScaleRange,[le,oe]=q.iconSizeScaleRange;q.textScaleFactor=ie(q.scaleFactor,Z,ee),q.iconScaleFactor=ie(q.scaleFactor,le,oe);const fe=U["text-size"],_e=U["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:et,maxZoom:yt}=a.textSizeData;q.compositeTextSizes=[fe.possiblyEvaluate(new Da(et,{worldview:O}),g),fe.possiblyEvaluate(new Da(yt,{worldview:O}),g)]}if(a.iconSizeData.kind==="composite"){const{minZoom:et,maxZoom:yt}=a.iconSizeData;q.compositeIconSizes=[_e.possiblyEvaluate(new Da(et,{worldview:O}),g),_e.possiblyEvaluate(new Da(yt,{worldview:O}),g)]}q.layoutTextSize=fe.possiblyEvaluate(new Da(_+1,{worldview:O}),g),q.layoutIconSize=_e.possiblyEvaluate(new Da(_+1,{worldview:O}),g),q.textMaxSize=fe.possiblyEvaluate(new Da(18,{worldview:O}),g);const be=F.get("symbol-placement"),Oe=F.get("text-rotation-alignment")==="map"&&be!=="point",Ie=F.get("text-size");let Ue=!1;const Ge=[];for(const et of a.features){const yt=F.get("text-font").evaluate(et,{},g).join(","),nt=Ie.evaluate(et,{},g)*q.textScaleFactor,bt=q.layoutTextSize.evaluate(et,{},g)*q.textScaleFactor,Mt=q.layoutIconSize.evaluate(et,{},g)*q.iconScaleFactor,Pt={horizontal:{},vertical:void 0},Ht=et.text;let qt,Ut=[0,0];if(Ht){const yn=Ht.toString(),Pa=F.get("text-letter-spacing").evaluate(et,{},g)*Bs,Re=F.get("text-line-height").evaluate(et,{},g)*Bs,Ne=Df(yn)?Pa:0,wt=F.get("text-anchor").evaluate(et,{},g),Gt=F.get("text-variable-anchor");if(!Gt){const _n=F.get("text-radial-offset").evaluate(et,{},g);if(_n)Ut=Z2(wt,[_n*Bs,bw]);else{const bn=F.get("text-offset").evaluate(et,{},g);Ut=[bn[0]*Bs,bn[1]*Bs]}}let hi=Oe?"center":F.get("text-justify").evaluate(et,{},g);const fi=be==="point",Li=fi?F.get("text-max-width").evaluate(et,{},g)*Bs:1/0,Ni=_n=>{a.allowVerticalPlacement&&Qd(yn)&&(Pt.vertical=fw(Ht,e,n,u,yt,Li,Re,wt,_n,Ne,Ut,Fc.vertical,!0,bt,nt,A))};if(!Oe&&Gt){const _n=hi==="auto"?Gt.map((Tn=>ww(Tn))):[hi];let bn=!1;for(let Tn=0;Tn<_n.length;Tn++){const Fn=_n[Tn];if(!Pt.horizontal[Fn])if(bn)Pt.horizontal[Fn]=Pt.horizontal[0];else{const Ji=fw(Ht,e,n,u,yt,Li,Re,"center",Fn,Ne,Ut,Fc.horizontal,!1,bt,nt,A);Ji&&(Pt.horizontal[Fn]=Ji,bn=Ji.positionedLines.length===1)}}Ni("left")}else{if(hi==="auto"&&(hi=ww(wt)),fi||F.get("text-writing-mode").indexOf("horizontal")>=0||!Qd(yn)){const _n=fw(Ht,e,n,u,yt,Li,Re,wt,hi,Ne,Ut,Fc.horizontal,!1,bt,nt,A);_n&&(Pt.horizontal[hi]=_n)}Ni(fi?"left":hi)}}let $t,xt,vt,Vt,ai,Yt,Di=!1;const pi=F.get("icon-text-fit").evaluate(et,{},g);if(et.icon&&et.icon.hasPrimary()){const yn=sv(et.icon,a.iconSizeData,U["icon-size"],g,a.zoom,et,A,q.iconScaleFactor,O);$t=yn.iconPrimary,vt=yn.iconSecondary;const Pa=$t.toString();if(xt=l.get(Pa),xt&&(ai=F.get("icon-offset").evaluate(et,{},g),Yt=F.get("icon-anchor").evaluate(et,{},g),qt=Qx(u.get(Pa),vt?u.get(vt.toString()):void 0,ai,Yt),Di=xt.sdf,a.sdfIcons===void 0?a.sdfIcons=xt.sdf:a.sdfIcons!==xt.sdf&&mi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xt.pixelRatio!==a.pixelRatio||F.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),vt){const Re=vt.toString();Vt=l.get(Re)}}Ue=Ue||!(!et.icon||!et.icon.hasSecondary());const xi=a0(Pt.horizontal)||Pt.vertical;a.iconsInText||(a.iconsInText=!!xi&&xi.iconsInText);const Mi=bt*q.textScaleFactor/Bs,{defaultShapedIcon:An,verticallyShapedIcon:ei}=Ez(a,qt,F,et,g,Pt,Mi,ai,pi);pi!=="none"&&qt&&(I2(qt)||R2(qt))&&(n0(0,xt,$t,qt,An,pi,z,l,u),n0(0,Vt,vt,qt,An,pi,z,l,u),ei&&(n0(0,xt,$t,qt,ei,pi,z,l,u),n0(0,Vt,vt,qt,ei,pi,z,l,u))),qt=An;const{iconBBox:zi,iconVerticalBBox:un,textBBox:Hn,textVerticalBBox:Xn}=bz(a,qt,ei,F,et,g,Mt,ai,q,u,Yt,Pt,bt,Ut);Ge.push({feature:et,shapedTextOrientations:Pt,shapedText:xi,shapedIcon:qt,iconPrimary:$t,iconSecondary:vt,iconOffset:ai,iconAnchor:Yt,verticallyShapedIcon:ei,layoutTextSize:bt,layoutIconSize:Mt,textOffset:Ut,isSDFIcon:Di,iconTextFit:pi,iconCollisionBounds:zi,iconVerticalCollisionBounds:un,textCollisionBounds:Hn,textVerticalCollisionBounds:Xn})}return{featureData:Ge,sizes:q,hasAnySecondaryIcon:Ue,textAlongLine:Oe,symbolPlacement:be}},i.fx=$2,i.fy=function(a,e,n,l,u,g,_,w,A,z){a.iconAtlasPositions=z.iconPositions;const{featureData:O,hasAnySecondaryIcon:F,sizes:U,textAlongLine:q,symbolPlacement:Z}=e;for(const ee of O){const{shapedIcon:le,verticallyShapedIcon:oe,feature:fe,shapedTextOrientations:_e,shapedText:be,layoutTextSize:Oe,textOffset:Ie,isSDFIcon:Ue,iconPrimary:Ge,iconSecondary:et,iconTextFit:yt,iconOffset:nt,iconCollisionBounds:bt,iconVerticalCollisionBounds:Mt,textCollisionBounds:Pt}=ee;Y2(le,z.iconPositions,Ge,et),Y2(oe,z.iconPositions,Ge,et),kz(_e,z.iconPositions),Tz(Ge,et,z.iconPositions),(be||le)&&Az(a,fe,_e,le,oe,A,U,Oe,0,Ie,Ue,l,u,_,w,F,yt,nt,q,Z,bt,Mt,Pt)}n&&a.generateCollisionDebugBuffers(g,a.collisionBoxArray,U.textScaleFactor)},i.fz=st,i.g=function(a,e){return xo(Object.assign(a,{method:"GET"}),e)},i.h=function(a){return a.indexOf("mapbox:")===0},i.i=function(a){return Sn.API_STYLE_REGEX.test(a)&&!zn(a)},i.j=Wa,i.k=no,i.l=function(a){return decodeURIComponent(atob(a).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},i.m=function(a,e){return xo(Object.assign(a,{type:"json"}),e)},i.n=js,i.o=xa,i.p=function(a,e){return xo(Object.assign(a,{method:"POST"}),e)},i.q=Fs,i.r=ss,i.s=function(a){try{const e=self[a];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return Yy||(Yy=new gs("ImageRasterizer")),Yy},i.u=function(){return(function a(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()},i.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},i.w=mi,i.x=Fw,i.y=Ku,i.z=bo})),x(["./shared"],(function(i){function M(Ze){const ie=Ze?Ze.url.toString():void 0;return ie?performance.getEntriesByName(ie):[]}function P(Ze){if(typeof Ze=="number"||typeof Ze=="boolean"||typeof Ze=="string"||Ze==null)return JSON.stringify(Ze);if(Array.isArray(Ze)){let ue="[";for(const Te of Ze)ue+=`${P(Te)},`;return`${ue}]`}let ie="{";for(const ue of Object.keys(Ze).sort())ie+=`${ue}:${P(Ze[ue])},`;return`${ie}}`}function N(Ze){let ie="";for(const ue of i.bx)ie+=`/${P(Ze[ue])}`;return ie}class H{constructor(ie){this.keyCache={},this._layers={},this._layerConfigs={},ie&&this.replace(ie)}replace(ie,ue){this._layerConfigs={},this._layers={},this.update(ie,[],ue)}update(ie,ue,Te){this._options=Te;for(const Be of ie)this._layerConfigs[Be.id]=Be,(this._layers[Be.id]=i.du(Be,this.scope,null,this._options)).compileFilter(Te),this.keyCache[Be.id]&&delete this.keyCache[Be.id];for(const Be of ue)delete this.keyCache[Be],delete this._layerConfigs[Be],delete this._layers[Be];this.familiesBySource={};const Fe=(function(Be,qe){const rt={};for(let ot=0;ot<Be.length;ot++){const Rt=Be[ot];let St=qe&&qe[Rt.id];St||(Rt.type==="symbol"?St=Rt.id:(St=N(Rt),Rt.type==="line"&&Rt.paint&&(function Oi(mi){return typeof mi=="string"&&mi==="line-progress"||(Array.isArray(mi)?mi.some(Oi):!(!mi||typeof mi!="object")&&Object.values(mi).some(Oi))})(Rt.paint["line-width"])&&(St+=`/${P(Rt.paint["line-width"])}`))),qe&&(qe[Rt.id]=St);let ci=rt[St];ci||(ci=rt[St]=[]),ci.push(Rt)}const Je=[];for(const ot in rt)Je.push(rt[ot]);return Je})(Object.values(this._layerConfigs),this.keyCache);for(const Be of Fe){const qe=Be.map((ci=>this._layers[ci.id])),rt=qe[0];if(rt.visibility==="none")continue;const Je=rt.source||"";let ot=this.familiesBySource[Je];ot||(ot=this.familiesBySource[Je]={});const Rt=rt.sourceLayer||"_geojsonTileLayer";let St=ot[Rt];St||(St=ot[Rt]=[]),St.push(qe)}}}const W=1*i.fl;class K{constructor(ie){const ue={},Te=[];for(const rt in ie){const Je=ie[rt],ot=ue[rt]={};for(const Rt in Je.glyphs){const St=Je.glyphs[+Rt];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;const ci=St.metrics.localGlyph?W:1,Oi={x:0,y:0,w:St.bitmap.width+2*ci,h:St.bitmap.height+2*ci};Te.push(Oi),ot[Rt]=Oi}}const{w:Fe,h:Be}=i.G(Te),qe=new i.fk({width:Fe||1,height:Be||1});for(const rt in ie){const Je=ie[rt];for(const ot in Je.glyphs){const Rt=Je.glyphs[+ot];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const St=ue[rt][ot],ci=Rt.metrics.localGlyph?W:1;i.fk.copy(Rt.bitmap,qe,{x:0,y:0},{x:St.x+ci,y:St.y+ci},Rt.bitmap)}}this.image=qe,this.positions=ue}}function re(Ze,ie,ue){Ze[ie]?ue&&(Ze[ie].center=ue):Ze[ie]={floorIds:new Set,center:ue||[0,0],floors:{}}}function ae(Ze,ie,ue,Te){for(const Fe of ie)re(Ze,Fe),Ze[Fe].floors[ue]=Te,Ze[Fe].floorIds.add(ue)}function ce(Ze){return{id:Ze.properties.id.toString(),center:Ze.properties.center.toString().split(";").map(Number)}}function ve(Ze){return{id:Ze.properties.id.toString(),isDefault:!!Ze.properties.is_default&&Ze.properties.is_default,connections:Ze.properties.connected_floor_ids?new Set(Ze.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ze.properties.conflicted_floor_ids?new Set(Ze.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ze.properties.building_ids?new Set(Ze.properties.building_ids.toString().split(";")):new Set,name:Ze.properties.name.toString(),zIndex:Ze.properties.z_index}}function Se(Ze,ie){return ie.every((ue=>Ze.properties&&Ze.properties[ue]!=null))}function Ee(Ze){return Se(Ze,["type","id","name"])&&Ze.properties.type==="building"}function Qe(Ze){return Se(Ze,["type","id","name","z_index"])&&Ze.properties.type==="floor"}i.fj(K,"GlyphAtlas");class He{constructor(ie){this.tileID=new i.aQ(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.lut=ie.lut,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.scope=ie.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.request&&ie.request.collectResourceTiming,this.promoteId=ie.promoteId,this.isSymbolTile=ie.isSymbolTile,this.tileTransform=i.aZ(ie.tileID.canonical,ie.projection),this.projection=ie.projection,this.worldview=ie.worldview,this.localizableLayerIds=ie.localizableLayerIds,this.brightness=ie.brightness,this.extraShadowCaster=!!ie.extraShadowCaster,this.tessellationStep=ie.tessellationStep,this.scaleFactor=ie.scaleFactor,this.worldview=ie.worldview,this.indoor=ie.indoor}parse(ie,ue,Te,Fe,Be,qe){this.status="parsing",this.data=ie,this.collisionBoxArray=new i.b3;const rt=new i.fm(Object.keys(ie.layers).sort()),Je=new i.fn(this.tileID,this.promoteId);Je.bucketLayerIDs=[];const ot={},Rt=new i.fo(256,256),St={featureIndex:Je,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Rt,availableImages:Te,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const tn=this.indoor.indoorState.activeFloorsVisible,rn=(function(Zi,Ui,$n){const Ia=(function(fn,an){if(!fn)return i.w("No source layers defined in indoor specification"),an;if(fn.size===0)return an;const ea=fn.difference(an);for(const ra of ea)i.w(`Missing source layer required in indoor specification: ${ra}`);return an.intersection(an)})(Ui.sourceLayers,new Set(Object.keys(Zi.layers))),Ta=Ui.indoorState,Yn=(function(fn,an,ea,ra){const Sn=new Set,Wa=new Set,zn=new Set,ka=new Map,qs={},rs=er=>{const zo=ka.get(er)||new Set;for(const Jr of Sn)if((ka.get(Jr)||new Set).has(er)||zo.has(Jr))return!0;return!1};for(const er of an){const zo=fn.layers[er];if(zo)for(let Jr=0;Jr<zo.length;Jr++){const ss=zo.feature(Jr);if(Ee(ss)){const{id:xa,center:Io}=ce(ss);re(qs,xa,Io),Sn.add(xa)}else if(Qe(ss)){const{id:xa,isDefault:Io,connections:_o,conflicts:Vc,buildings:Su,name:hc,zIndex:fc}=ve(ss);ae(qs,Su,xa,{name:hc,zIndex:fc}),ka.set(xa,Vc),(xa===ra||_o.has(ra))&&Sn.add(xa),Wa.add(xa),Io&&zn.add(xa)}}else i.w(`indoor source layer not found: ${er}`)}if(ea)for(const er of ea)Wa.has(er)&&(rs(er)||Sn.add(er));for(const er of zn)Sn.has(er)||rs(er)||Sn.add(er);return{buildings:qs,activeFloors:Sn}})(Zi,Ia,Ta.lastActiveFloors,Ta.selectedFloorId);return $n.send("setIndoorData",Yn),Yn})(ie,this.indoor,Be);St.activeFloors=tn?rn.activeFloors:void 0}const ci=[],Oi=ue.familiesBySource[this.source];for(const tn in Oi){const rn=ie.layers[tn];if(!rn)continue;let Zi=!1,Ui=!1,$n=!1;for(const an of Oi[tn])an[0].type==="symbol"?Zi=!0:Ui=!0,an[0].is3D()&&an[0].type!=="model"&&($n=!0);if(this.extraShadowCaster&&!$n||this.isSymbolTile===!0&&!Zi||this.isSymbolTile===!1&&!Ui)continue;rn.version===1&&i.w(`Vector tile source "${this.source}" layer "${tn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ia=rt.encode(tn),Ta=[],Yn=this.localizableLayerIds&&this.localizableLayerIds.has(tn);let fn=!1;for(let an=0,ea=0;an<rn.length;an++){const ra=rn.feature(an),Sn=Je.getId(ra,tn),Wa=ra.properties?ra.properties.worldview:null;if(Yn&&this.worldview&&typeof Wa=="string")if(Wa==="all")ra.properties.$localized=!0;else{if(!Wa.split(",").includes(this.worldview))continue;ra.properties.$localized=!0,ra.properties.worldview=this.worldview}!fn&&ra.properties&&ra.properties.hasOwnProperty(i.fp)&&(fn=!0),Ta.push({feature:ra,id:Sn,index:ea,sourceLayerIndex:Ia}),ea++}fn&&!St.elevationFeatures&&ie.layers.hasOwnProperty(i.fq)&&(St.elevationFeatures=i.fr.parseFrom(ie.layers[i.fq],this.canonical));for(const an of Oi[tn]){const ea=an[0];if(this.extraShadowCaster&&(!ea.is3D()||ea.type==="model")||this.isSymbolTile!==void 0&&ea.type==="symbol"!==this.isSymbolTile||ea.minzoom&&this.zoom<Math.floor(ea.minzoom)||ea.maxzoom&&this.zoom>=ea.maxzoom||ea.visibility==="none")continue;ke(an,this.zoom,St.brightness,Te,this.worldview);const ra=ot[ea.id]=ea.createBucket({index:Je.bucketLayerIDs.length,layers:an,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ia,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Fe,worldview:this.worldview,localizable:Yn});Je.bucketLayerIDs.push(an.map((Wa=>i.B(Wa.id,Wa.scope))));let Sn=ra.prepare?ra.prepare():null;Sn!=null?(Sn=Sn.then((()=>ra.populate(Ta,St,this.tileID.canonical,this.tileTransform))),ci.push(Sn)):ra.populate(Ta,St,this.tileID.canonical,this.tileTransform)}}const mi=()=>{let tn,rn,Zi,Ui,$n,Ia;Rt.trim();const Ta={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Yn=()=>{if(tn)return this.status="done",qe(tn);if(this.extraShadowCaster)this.status="done",qe(null,{buckets:Object.values(ot).filter((an=>!an.isEmpty())),featureIndex:Je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:St.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(rn&&Zi&&Ui){const an=new K(rn),ea=new Map;for(const[Wa,zn]of Zi.entries()){const{imagePosition:ka}=i.fu(Wa,zn,i.fv);ea.set(Wa,ka)}const ra={};for(const Wa in ot){const zn=ot[Wa];zn instanceof i.b4&&(ke(zn.layers,this.zoom,St.brightness,Te,this.worldview),ra[Wa]=i.fw(zn,rn,an.positions,Zi,ea,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,$n,this.worldview))}const Sn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Be,Zi,$n,(()=>{Sn.iconsPending=!1,fn(ra,an,Sn)})),this.rasterizeIfNeeded(Be,Ui,Ia,(()=>{Sn.patternsPending=!1,fn(ra,an,Sn)}))}},fn=(an,ea,ra,Sn)=>{if(ra.iconsPending||ra.patternsPending)return;const Wa=new i.fx(Zi,Ui,this.lut);for(const zn in ot){const ka=ot[zn];if(zn in an)i.fy(ka,an[zn],this.showCollisionBoxes,Te,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Zi,Wa);else if(ka.hasPattern&&(ka instanceof i.ba||ka instanceof i.bb||ka instanceof i.ea)){ke(ka.layers,this.zoom,St.brightness,Te,this.worldview);const qs=Object.fromEntries(Wa.patternPositions);ka.addFeatures(St,this.tileID.canonical,qs,Te,this.tileTransform,this.brightness)}}this.status="done",qe(null,{buckets:Object.values(ot).filter((zn=>!zn.isEmpty())),featureIndex:Je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ea.image,lineAtlas:Rt,imageAtlas:Wa,brightness:St.brightness})};if(!this.extraShadowCaster){const an=i.fs(St.glyphDependencies,(Sn=>Object.keys(Sn).map(Number)));Object.keys(an).length?Be.send("getGlyphs",{uid:this.uid,stacks:an},((Sn,Wa)=>{tn||(tn=Sn,rn=Wa,Yn())}),void 0,!1,Ta):rn={};const ea=Array.from(St.iconDependencies.keys()).map((Sn=>i.I.parse(Sn)));ea.length?Be.send("getImages",{images:ea,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Sn,Wa)=>{tn||(tn=Sn,Zi=new Map,$n=this.updateImageMapAndGetImageTaskQueue(Zi,Wa,St.iconDependencies),Yn())}),void 0,!1,Ta):(Zi=new Map,$n=new Map);const ra=Array.from(St.patternDependencies.keys()).map((Sn=>i.I.parse(Sn)));ra.length?Be.send("getImages",{images:ra,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Sn,Wa)=>{tn||(tn=Sn,Ui=new Map,Ia=this.updateImageMapAndGetImageTaskQueue(Ui,Wa,St.patternDependencies),Yn())}),void 0,!1,Ta):(Ui=new Map,Ia=new Map)}if(St.elevationFeatures&&St.elevationFeatures.length>0){const an=[];for(const ra of Object.values(ot))if(ra instanceof i.bb){const Sn=ra.getUnevaluatedPortalGraph();Sn&&an.push(Sn)}const ea=i.ft.evaluate(an);for(const ra of Object.values(ot))if(ra instanceof i.bb){const Sn=ie.layers[rt.decode(ra.sourceLayerIndex)];ra.setEvaluatedPortalGraph(ea,Sn,this.tileID.canonical,St.availableImages,St.brightness)}}Yn()};ci.length>0?Promise.allSettled(ci).then(mi).catch(qe):mi()}updateParameters(ie){this.scaleFactor=ie.scaleFactor,this.showCollisionBoxes=ie.showCollisionBoxes,this.projection=ie.projection,this.brightness=ie.brightness,this.tileTransform=i.aZ(ie.tileID.canonical,ie.projection),this.extraShadowCaster=ie.extraShadowCaster,this.lut=ie.lut,this.worldview=ie.worldview,this.indoor=ie.indoor}rasterizeIfNeeded(ie,ue,Te,Fe){Array.from(ue.values()).some((Be=>Be.usvg))?this.rasterize(ie,ue,Te,Fe):Fe()}updateImageMapAndGetImageTaskQueue(ie,ue,Te){const Fe=new Map;for(const Be of ue.keys()){const qe=Te.get(Be)||[];for(const rt of qe){const Je=rt.toString(),ot=ue.get(rt.id.toString());ot.usvg?Fe.has(Je)||(Fe.set(Je,rt),ie.set(Je,Object.assign({},ot))):ie.set(Je,ot)}}return Fe}rasterize(ie,ue,Te,Fe){this.rasterizeTask=ie.send("rasterizeImages",{scope:this.scope,tasks:Te},((Be,qe)=>{if(!Be)for(const[rt,Je]of qe.entries()){const ot=Object.assign(ue.get(rt),{data:Je});ue.set(rt,ot)}Fe()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ke(Ze,ie,ue,Te,Fe){const Be=new i.ac(ie,{brightness:ue,worldview:Fe});for(const qe of Ze)qe.recalculate(Be,Te)}class tt extends i.E{constructor(ie,ue,Te,Fe,Be,qe,rt){super(),this.actor=ie,this.layerIndex=ue,this.availableImages=Te,this.availableModels=Fe,this.loadVectorData=qe||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(ie.scheduler),this.isSpriteLoaded=Be,this.scheduler=ie.scheduler,this.brightness=rt}loadTile(ie,ue){const Te=ie.uid,Fe=ie&&ie.request,Be=Fe&&Fe.collectResourceTiming,qe=this.loading[Te]=new He(ie);qe.abort=this.loadVectorData(ie,((rt,Je)=>{const ot=!this.loading[Te];if(delete this.loading[Te],qe.cancelRasterize(),ot||rt||!Je)return qe.status="done",ot||(this.loaded[Te]=qe),ue(rt);const Rt=Je.rawData,St={},ci=i.aM(Je.responseHeaders);ci&&ci.expires&&(St.expires=ci.expires),ci&&ci.cacheControl&&(St.cacheControl=ci.cacheControl),qe.vectorTile=Je.vectorTile||new i.fz(new i.bt(Rt));const Oi=()=>{qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((mi,tn)=>{if(mi||!tn)return ue(mi);const rn={};if(Be){const Zi=M(Fe);Zi.length>0&&(rn.resourceTiming=JSON.parse(JSON.stringify(Zi)))}ue(null,Object.assign({rawTileData:Rt.slice(0),responseHeaders:Je.responseHeaders},tn,St,rn))}))};this.isSpriteLoaded?Oi():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(Oi,{type:"parseTile",isSymbolTile:ie.isSymbolTile,zoom:ie.tileZoom}):Oi()})),this.loaded=this.loaded||{},this.loaded[Te]=qe}))}reloadTile(ie,ue){const Te=this.loaded,Fe=ie.uid;if(Te&&Te[Fe]){const Be=Te[Fe];Be.updateParameters(ie);const qe=(rt,Je)=>{const ot=Be.reloadCallback;ot&&(delete Be.reloadCallback,Be.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ot)),ue(rt,Je)};Be.status==="parsing"?Be.reloadCallback=qe:Be.status==="done"&&(Be.vectorTile?Be.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,qe):qe())}else ue(null,void 0)}abortTile(ie,ue){const Te=ie.uid,Fe=this.loading[Te];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[Te]),ue()}removeTile(ie,ue){const Te=this.loaded,Fe=ie.uid;Te&&Te[Fe]&&delete Te[Fe],ue()}}class Ke{loadTile(ie,ue){const{uid:Te,encoding:Fe,rawImageData:Be,padding:qe}=ie,rt=ImageBitmap&&Be instanceof ImageBitmap?this.getImageData(Be,qe):Be;ue(null,new i.fA(Te,rt,Fe,qe<1))}reloadTile(ie,ue){ue(null,null)}abortTile(ie,ue){ue()}removeTile(ie,ue){ue()}getImageData(ie,ue){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ie.width,ie.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ie.width,this.offscreenCanvas.height=ie.height,this.offscreenCanvasContext.drawImage(ie,0,0,ie.width,ie.height);const Te=this.offscreenCanvasContext.getImageData(-ue,-ue,ie.width+2*ue,ie.height+2*ue);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Te}}i.bs.setPbf(i.bt);class lt{constructor(ie){this._mrt=new i.bs(ie.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ie.uid,this.tileID=ie.tileID,this.source=ie.source}parse(ie,ue){const Te=this._mrt;this.status="parsing",this._entireBuffer=ie;try{Te.parseHeader(ie),this._isHeaderLoaded=!0;const Fe=[];for(const Be in Te.layers){const qe=Te.getLayer(Be),rt=qe.getDataRange(qe.getBandList()),Je=Te.createDecodingTask(rt),ot=ie.slice(rt.firstByte,rt.lastByte+1),Rt=i.bs.performDecoding(ot,Je).then((St=>Je.complete(null,St))).catch((St=>Je.complete(St,null)));Fe.push(Rt)}Promise.allSettled(Fe).then((()=>ue(null,Te))).catch((Be=>ue(Be)))}catch(Fe){ue(Fe)}}}class ft{constructor(ie){this.actor=ie,this.loading={},this.loaded={}}loadTile(ie,ue){const Te=ie.uid,Fe=ie.request,Be=this.loading[Te]=new lt(ie),{cancel:qe}=i.bu(Fe,((rt,Je,ot)=>{const Rt=!this.loading[Te];if(delete this.loading[Te],Rt||rt||!Je)return Be.status="done",Rt||(this.loaded[Te]=Be),ue(rt);Be.parse(Je,((St,ci)=>{if(St||!ci)return ue(St);ue(null,ci,ot)})),this.loaded[Te]=Be}));Be.abort=qe}reloadTile(ie,ue){ue(null,void 0)}abortTile(ie,ue){const Te=ie.uid,Fe=this.loading[Te];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[Te]),ue()}removeTile(ie,ue){const Te=ie.uid;this.loaded[Te]&&delete this.loaded[Te],ue()}decodeRasterArray(ie,ue){i.bs.performDecoding(ie.buffer,ie.task).then((Te=>ue(null,Te))).catch((Te=>ue(Te)))}}const gt=i.fB.prototype.toGeoJSON;class ni{constructor(ie){this._feature=ie,this.extent=i.al,this.type=ie.type,this.properties=ie.tags,"id"in ie&&!isNaN(ie.id)&&(this.id=parseInt(ie.id,10))}loadGeometry(){if(this._feature.type===1){const ie=[];for(const ue of this._feature.geometry)ie.push([new i.P(ue[0],ue[1])]);return ie}{const ie=[];for(const ue of this._feature.geometry){const Te=[];for(const Fe of ue)Te.push(new i.P(Fe[0],Fe[1]));ie.push(Te)}return ie}}toGeoJSON(ie,ue,Te){return gt.call(this,ie,ue,Te)}}class Ft{constructor(ie,ue){this.name=ie,this.extent=i.al,this.length=ue.length,this._jsonFeatures=ue}feature(ie){return new ni(this._jsonFeatures[ie])}}class Vi{constructor(ie){this.layers={},this.extent=i.al;for(const ue of Object.keys(ie))this.layers[ue]=new Ft(ue,ie[ue])}}const Ri=64/4096,We=128;class Et{constructor(){this.features=new Map}clear(){this.features.clear()}load(ie=[],ue){for(const Te of ie){const Fe=Te.id;if(Fe==null)continue;let Be=this.features.get(Fe);Be&&this.updateCache(Be,ue),Te.geometry?(Be=Gi(Te),this.updateCache(Be,ue),this.features.set(Fe,Be)):this.features.delete(Fe),this.updateCache(Be,ue)}}updateCache(ie,ue){for(const{canonical:Te,uid:Fe}of Object.values(ue)){const{z:Be,x:qe,y:rt}=Te;jt(ie,Math.pow(2,Be),qe,rt)&&delete ue[Fe]}}getTile(ie,ue,Te){const Fe=Math.pow(2,ie),Be=[];for(const qe of this.features.values())jt(qe,Fe,ue,Te)&&Be.push(Ct(qe,Fe,ue,Te));return{features:Be}}getFeatures(){return[...this.features.values()]}}function jt({minX:Ze,minY:ie,maxX:ue,maxY:Te},Fe,Be,qe){return Ze<(Be+1+Ri)/Fe&&ie<(qe+1+Ri)/Fe&&ue>(Be-Ri)/Fe&&Te>(qe-Ri)/Fe}function Gi(Ze){const{id:ie,geometry:ue,properties:Te}=Ze;if(!ue)return;if(ue.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Fe,coordinates:Be}=ue,qe={id:ie,type:1,geometry:[],tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},rt=qe.geometry;if(Fe==="Point")Ce(Be,rt,qe);else if(Fe==="MultiPoint")for(const Je of Be)Ce(Je,rt,qe);else if(Fe==="LineString")qe.type=2,_t(Be,rt,qe);else if(Fe==="MultiLineString")qe.type=2,At(Be,rt,qe);else if(Fe==="Polygon")qe.type=3,At(Be,rt,qe,!0);else{if(Fe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");qe.type=3;for(const Je of Be)At(Je,rt,qe,!0)}return qe}function Ce([Ze,ie],ue,Te){const Fe=i.aF(Ze);let Be=i.aJ(ie);Be=Be<0?0:Be>1?1:Be,ue.push(Fe,Be),Te.minX=Math.min(Te.minX,Fe),Te.minY=Math.min(Te.minY,Be),Te.maxX=Math.max(Te.maxX,Fe),Te.maxY=Math.max(Te.maxY,Be)}function _t(Ze,ie,ue,Te=!1,Fe=!1){const Be=[];for(const qe of Ze)Ce(qe,Be,ue);ie.push(Be),Te&&(function(qe,rt){let Je=0;for(let ot=0,Rt=qe.length,St=Rt-2;ot<Rt;St=ot,ot+=2)Je+=(qe[ot]-qe[St])*(qe[ot+1]+qe[St+1]);if(Je>0===rt)for(let ot=0,Rt=qe.length;ot<Rt/2;ot+=2){const St=qe[ot],ci=qe[ot+1];qe[ot]=qe[Rt-2-ot],qe[ot+1]=qe[Rt-1-ot],qe[Rt-2-ot]=St,qe[Rt-1-ot]=ci}})(Be,Fe)}function At(Ze,ie,ue,Te=!1){for(let Fe=0;Fe<Ze.length;Fe++)_t(Ze[Fe],ie,ue,Te,Fe===0)}function Ct(Ze,ie,ue,Te){const{id:Fe,type:Be,geometry:qe,tags:rt}=Ze,Je=[];if(Be===1)(function(ot,Rt,St,ci,Oi){for(let mi=0;mi<ot.length;mi+=2){const tn=Math.round(i.al*(ot[mi+0]*Rt-St)),rn=Math.round(i.al*(ot[mi+1]*Rt-ci));Oi.push([tn,rn])}})(qe,ie,ue,Te,Je);else if(Be===2)for(const ot of qe)oi(ot,ie,ue,Te,Je);else if(Be===3)for(const ot of qe)Ci(ot,ie,ue,Te,Je);return{id:Fe,type:Be,geometry:Je,tags:rt}}function oi(Ze,ie,ue,Te,Fe){const Be=-We,qe=i.al+We;let rt;for(let Je=0;Je<Ze.length-2;Je+=2){let ot=Math.round(i.al*(Ze[Je+0]*ie-ue)),Rt=Math.round(i.al*(Ze[Je+1]*ie-Te)),St=Math.round(i.al*(Ze[Je+2]*ie-ue)),ci=Math.round(i.al*(Ze[Je+3]*ie-Te));const Oi=St-ot,mi=ci-Rt;ot<Be&&St<Be||(ot<Be?(Rt+=Math.round(mi*((Be-ot)/Oi)),ot=Be):St<Be&&(ci=Rt+Math.round(mi*((Be-ot)/Oi)),St=Be),Rt<Be&&ci<Be||(Rt<Be?(ot+=Math.round(Oi*((Be-Rt)/mi)),Rt=Be):ci<Be&&(St=ot+Math.round(Oi*((Be-Rt)/mi)),ci=Be),ot>=qe&&St>=qe||(ot>=qe?(Rt+=Math.round(mi*((qe-ot)/Oi)),ot=qe):St>=qe&&(ci=Rt+Math.round(mi*((qe-ot)/Oi)),St=qe),Rt>=qe&&ci>=qe||(Rt>=qe?(ot+=Math.round(Oi*((qe-Rt)/mi)),Rt=qe):ci>=qe&&(St=ot+Math.round(Oi*((qe-Rt)/mi)),ci=qe),rt&&ot===rt[rt.length-1][0]&&Rt===rt[rt.length-1][1]||(rt=[[ot,Rt]],Fe.push(rt)),rt.push([St,ci])))))}}function Ci(Ze,ie,ue,Te,Fe){const Be=(ue-Ri)/ie,qe=(Te-Ri)/ie,rt=(ue+1+Ri)/ie,Je=(Te+1+Ri)/ie;function ot(ci,Oi){let mi=0;return ci<Be?mi|=1:ci>rt&&(mi|=2),Oi<qe?mi|=4:Oi>Je&&(mi|=8),mi}let Rt=[];for(let ci=1;ci<=8;ci*=2){let Oi=Ze[Ze.length-2],mi=Ze[Ze.length-1],tn=!(ot(Oi,mi)&ci);for(let rn=0;rn<Ze.length;rn+=2){const Zi=Ze[rn],Ui=Ze[rn+1],$n=!(ot(Zi,Ui)&ci);$n!==tn&&(8&ci?Rt.push(Oi+(Zi-Oi)*(Je-mi)/(Ui-mi),Je):4&ci?Rt.push(Oi+(Zi-Oi)*(qe-mi)/(Ui-mi),qe):2&ci?Rt.push(rt,mi+(Ui-mi)*(rt-Oi)/(Zi-Oi)):1&ci&&Rt.push(Be,mi+(Ui-mi)*(Be-Oi)/(Zi-Oi))),$n&&Rt.push(Zi,Ui),Oi=Zi,mi=Ui,tn=$n}if(!(Ze=Rt).length||ci===8)break;Rt=[]}const St=[];for(let ci=0;ci<Rt.length;ci+=2)St.push([Math.round(i.al*(Rt[ci]*ie-ue)),Math.round(i.al*(Rt[ci+1]*ie-Te))]);Fe.push(St)}function li({name:Ze,features:ie},ue){ue.writeStringField(1,Ze),ue.writeVarintField(5,i.al);const Te=new Map,Fe=new Map,Be={keys:Te,values:Fe,feature:null};for(const qe of ie)Be.feature=qe,ue.writeMessage(2,Ba,Be);for(const qe of Te.keys())ue.writeStringField(3,qe);for(const qe of Fe.keys())ue.writeMessage(4,Qi,qe)}function Ba(Ze,ie){const ue=Ze.feature;ue.id!==void 0&&Number.isSafeInteger(+ue.id)&&ie.writeVarintField(1,+ue.id),ue.tags&&ie.writeMessage(2,Un,Ze),ie.writeVarintField(3,ue.type),ie.writeMessage(4,Ja,ue)}function Un({keys:Ze,values:ie,feature:ue},Te){for(const Fe of Object.keys(ue.tags)){let Be=ue.tags[Fe];if(Be===null)continue;let qe=Ze.get(Fe);qe===void 0&&(qe=Ze.size,Ze.set(Fe,qe)),Te.writeVarint(qe);const rt=typeof Be;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(Be=JSON.stringify(Be));let Je=ie.get(Be);Je===void 0&&(Je=ie.size,ie.set(Be,Je)),Te.writeVarint(Je)}}function qn(Ze,ie){return(ie<<3)+(7&Ze)}function On(Ze){return Ze<<1^Ze>>31}function Ja(Ze,ie){const{geometry:ue,type:Te}=Ze;let Fe=0,Be=0;if(Te===1){ie.writeVarint(qn(1,ue.length));for(const qe of ue){const rt=qe[0]-Fe,Je=qe[1]-Be;ie.writeVarint(On(rt)),ie.writeVarint(On(Je)),Fe+=rt,Be+=Je}}else for(const qe of ue){ie.writeVarint(qn(1,1));const rt=qe.length-(Te===3?1:0);for(let Je=0;Je<rt;Je++){Je===1&&ie.writeVarint(qn(2,rt-1));const ot=qe[Je][0]-Fe,Rt=qe[Je][1]-Be;ie.writeVarint(On(ot)),ie.writeVarint(On(Rt)),Fe+=ot,Be+=Rt}Te===3&&ie.writeVarint(qn(7,1))}}function Qi(Ze,ie){const ue=typeof Ze;ue==="string"?ie.writeStringField(1,Ze):ue==="boolean"?ie.writeBooleanField(7,Ze):ue==="number"&&(Ze%1!=0?ie.writeDoubleField(3,Ze):Ze<0?ie.writeSVarintField(6,Ze):ie.writeVarintField(5,Ze))}const Fi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ze=>Ze},nn=Math.fround||(hn=new Float32Array(1),Ze=>(hn[0]=+Ze,hn[0]));var hn;const ln=3,xn=5,za=6;class $c{constructor(ie){this.options=Object.assign(Object.create(Fi),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:ue,minZoom:Te,maxZoom:Fe}=this.options;ue&&console.time("total time");const Be=`prepare ${ie.length} points`;ue&&console.time(Be),this.points=ie;const qe=[];for(let Je=0;Je<ie.length;Je++){const ot=ie[Je];if(!ot.geometry)continue;const[Rt,St]=ot.geometry.coordinates,ci=nn(ws(Rt)),Oi=nn(Vs(St));qe.push(ci,Oi,1/0,Je,-1,1),this.options.reduce&&qe.push(0)}let rt=this.trees[Fe+1]=this._createTree(qe);ue&&console.timeEnd(Be);for(let Je=Fe;Je>=Te;Je--){const ot=+Date.now();rt=this.trees[Je]=this._createTree(this._cluster(rt,Je)),ue&&console.log("z%d: %d clusters in %dms",Je,rt.numItems,+Date.now()-ot)}return ue&&console.timeEnd("total time"),this}getClusters(ie,ue){let Te=((ie[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,ie[1]));let Be=ie[2]===180?180:((ie[2]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)Te=-180,Be=180;else if(Te>Be){const St=this.getClusters([Te,Fe,180,qe],ue),ci=this.getClusters([-180,Fe,Be,qe],ue);return St.concat(ci)}const rt=this.trees[this._limitZoom(ue)],Je=rt.range(ws(Te),Vs(qe),ws(Be),Vs(Fe)),ot=rt.data,Rt=[];for(const St of Je){const ci=this.stride*St;Rt.push(ot[ci+xn]>1?Zo(ot,ci,this.clusterProps):this.points[ot[ci+ln]])}return Rt}getChildren(ie){const ue=this._getOriginId(ie),Te=this._getOriginZoom(ie),Fe="No cluster with the specified id.",Be=this.trees[Te];if(!Be)throw new Error(Fe);const qe=Be.data;if(ue*this.stride>=qe.length)throw new Error(Fe);const rt=this.options.radius/(this.options.extent*Math.pow(2,Te-1)),Je=Be.within(qe[ue*this.stride],qe[ue*this.stride+1],rt),ot=[];for(const Rt of Je){const St=Rt*this.stride;qe[St+4]===ie&&ot.push(qe[St+xn]>1?Zo(qe,St,this.clusterProps):this.points[qe[St+ln]])}if(ot.length===0)throw new Error(Fe);return ot}getLeaves(ie,ue,Te){const Fe=[];return this._appendLeaves(Fe,ie,ue=ue||10,Te=Te||0,0),Fe}getTile(ie,ue,Te){const Fe=this.trees[this._limitZoom(ie)],Be=Math.pow(2,ie),{extent:qe,radius:rt}=this.options,Je=rt/qe,ot=(Te-Je)/Be,Rt=(Te+1+Je)/Be,St={features:[]};return this._addTileFeatures(Fe.range((ue-Je)/Be,ot,(ue+1+Je)/Be,Rt),Fe.data,ue,Te,Be,St),ue===0&&this._addTileFeatures(Fe.range(1-Je/Be,ot,1,Rt),Fe.data,Be,Te,Be,St),ue===Be-1&&this._addTileFeatures(Fe.range(0,ot,Je/Be,Rt),Fe.data,-1,Te,Be,St),St.features.length?St:null}getClusterExpansionZoom(ie){let ue=this._getOriginZoom(ie)-1;for(;ue<=this.options.maxZoom;){const Te=this.getChildren(ie);if(ue++,Te.length!==1)break;ie=Te[0].properties.cluster_id}return ue}_appendLeaves(ie,ue,Te,Fe,Be){const qe=this.getChildren(ue);for(const rt of qe){const Je=rt.properties;if(Je&&Je.cluster?Be+Je.point_count<=Fe?Be+=Je.point_count:Be=this._appendLeaves(ie,Je.cluster_id,Te,Fe,Be):Be<Fe?Be++:ie.push(rt),ie.length===Te)break}return Be}_createTree(ie){const ue=new i.c4(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Te=0;Te<ie.length;Te+=this.stride)ue.add(ie[Te],ie[Te+1]);return ue.finish(),ue.data=ie,ue}_addTileFeatures(ie,ue,Te,Fe,Be,qe){for(const rt of ie){const Je=rt*this.stride,ot=ue[Je+xn]>1;let Rt,St,ci;if(ot)Rt=$s(ue,Je,this.clusterProps),St=ue[Je],ci=ue[Je+1];else{const tn=this.points[ue[Je+ln]];Rt=tn.properties;const[rn,Zi]=tn.geometry.coordinates;St=ws(rn),ci=Vs(Zi)}const Oi={type:1,geometry:[[Math.round(this.options.extent*(St*Be-Te)),Math.round(this.options.extent*(ci*Be-Fe))]],tags:Rt};let mi;mi=ot||this.options.generateId?ue[Je+ln]:this.points[ue[Je+ln]].id,mi!==void 0&&(Oi.id=mi),qe.features.push(Oi)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,ue){const{radius:Te,extent:Fe,reduce:Be,minPoints:qe}=this.options,rt=Te/(Fe*Math.pow(2,ue)),Je=ie.data,ot=[],Rt=this.stride;for(let St=0;St<Je.length;St+=Rt){if(Je[St+2]<=ue)continue;Je[St+2]=ue;const ci=Je[St],Oi=Je[St+1],mi=ie.within(Je[St],Je[St+1],rt),tn=Je[St+xn];let rn=tn;for(const Zi of mi){const Ui=Zi*Rt;Je[Ui+2]>ue&&(rn+=Je[Ui+xn])}if(rn>tn&&rn>=qe){let Zi,Ui=ci*tn,$n=Oi*tn,Ia=-1;const Ta=(St/Rt<<5)+(ue+1)+this.points.length;for(const Yn of mi){const fn=Yn*Rt;if(Je[fn+2]<=ue)continue;Je[fn+2]=ue;const an=Je[fn+xn];Ui+=Je[fn]*an,$n+=Je[fn+1]*an,Je[fn+4]=Ta,Be&&(Zi||(Zi=this._map(Je,St,!0),Ia=this.clusterProps.length,this.clusterProps.push(Zi)),Be(Zi,this._map(Je,fn)))}Je[St+4]=Ta,ot.push(Ui/rn,$n/rn,1/0,Ta,-1,rn),Be&&ot.push(Ia)}else{for(let Zi=0;Zi<Rt;Zi++)ot.push(Je[St+Zi]);if(rn>1)for(const Zi of mi){const Ui=Zi*Rt;if(!(Je[Ui+2]<=ue)){Je[Ui+2]=ue;for(let $n=0;$n<Rt;$n++)ot.push(Je[Ui+$n])}}}}return ot}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,ue,Te){if(ie[ue+xn]>1){const qe=this.clusterProps[ie[ue+za]];return Te?Object.assign({},qe):qe}const Fe=this.points[ie[ue+ln]].properties,Be=this.options.map(Fe);return Te&&Be===Fe?Object.assign({},Be):Be}}function Zo(Ze,ie,ue){return{type:"Feature",id:Ze[ie+ln],properties:$s(Ze,ie,ue),geometry:{type:"Point",coordinates:[(Te=Ze[ie],360*(Te-.5)),Vr(Ze[ie+1])]}};var Te}function $s(Ze,ie,ue){const Te=Ze[ie+xn],Fe=Te>=1e4?`${Math.round(Te/1e3)}k`:Te>=1e3?Math.round(Te/100)/10+"k":Te,Be=Ze[ie+za],qe=Be===-1?{}:Object.assign({},ue[Be]);return Object.assign(qe,{cluster:!0,cluster_id:Ze[ie+ln],point_count:Te,point_count_abbreviated:Fe})}function ws(Ze){return Ze/360+.5}function Vs(Ze){const ie=Math.sin(Ze*Math.PI/180),ue=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ue<0?0:ue>1?1:ue}function Vr(Ze){const ie=(180-360*Ze)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function Xo(Ze,ie,ue,Te){let Fe=Te;const Be=ie+(ue-ie>>1);let qe,rt=ue-ie;const Je=Ze[ie],ot=Ze[ie+1],Rt=Ze[ue],St=Ze[ue+1];for(let ci=ie+3;ci<ue;ci+=3){const Oi=Kr(Ze[ci],Ze[ci+1],Je,ot,Rt,St);if(Oi>Fe)qe=ci,Fe=Oi;else if(Oi===Fe){const mi=Math.abs(ci-Be);mi<rt&&(qe=ci,rt=mi)}}Fe>Te&&(qe-ie>3&&Xo(Ze,ie,qe,Te),Ze[qe+2]=Fe,ue-qe>3&&Xo(Ze,qe,ue,Te))}function Kr(Ze,ie,ue,Te,Fe,Be){let qe=Fe-ue,rt=Be-Te;if(qe!==0||rt!==0){const Je=((Ze-ue)*qe+(ie-Te)*rt)/(qe*qe+rt*rt);Je>1?(ue=Fe,Te=Be):Je>0&&(ue+=qe*Je,Te+=rt*Je)}return qe=Ze-ue,rt=ie-Te,qe*qe+rt*rt}function Qa(Ze,ie,ue,Te){const Fe={id:Ze??null,type:ie,geometry:ue,tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")us(Fe,ue);else if(ie==="Polygon")us(Fe,ue[0]);else if(ie==="MultiLineString")for(const Be of ue)us(Fe,Be);else if(ie==="MultiPolygon")for(const Be of ue)us(Fe,Be[0]);return Fe}function us(Ze,ie){for(let ue=0;ue<ie.length;ue+=3)Ze.minX=Math.min(Ze.minX,ie[ue]),Ze.minY=Math.min(Ze.minY,ie[ue+1]),Ze.maxX=Math.max(Ze.maxX,ie[ue]),Ze.maxY=Math.max(Ze.maxY,ie[ue+1])}function mr(Ze,ie,ue,Te){if(!ie.geometry)return;const Fe=ie.geometry.coordinates;if(Fe&&Fe.length===0)return;const Be=ie.geometry.type,qe=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2);let rt=[],Je=ie.id;if(ue.promoteId?Je=ie.properties[ue.promoteId]:ue.generateId&&(Je=Te||0),Be==="Point")ul(Fe,rt);else if(Be==="MultiPoint")for(const ot of Fe)ul(ot,rt);else if(Be==="LineString")Jl(Fe,rt,qe,!1);else if(Be==="MultiLineString"){if(ue.lineMetrics){for(const ot of Fe)rt=[],Jl(ot,rt,qe,!1),Ze.push(Qa(Je,"LineString",rt,ie.properties));return}Hs(Fe,rt,qe,!1)}else if(Be==="Polygon")Hs(Fe,rt,qe,!0);else{if(Be!=="MultiPolygon"){if(Be==="GeometryCollection"){for(const ot of ie.geometry.geometries)mr(Ze,{id:Je,geometry:ot,properties:ie.properties},ue,Te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ot of Fe){const Rt=[];Hs(ot,Rt,qe,!0),rt.push(Rt)}}Ze.push(Qa(Je,Be,rt,ie.properties))}function ul(Ze,ie){ie.push(Yo(Ze[0]),yr(Ze[1]),0)}function Jl(Ze,ie,ue,Te){let Fe,Be,qe=0;for(let Je=0;Je<Ze.length;Je++){const ot=Yo(Ze[Je][0]),Rt=yr(Ze[Je][1]);ie.push(ot,Rt,0),Je>0&&(qe+=Te?(Fe*Rt-ot*Be)/2:Math.sqrt(Math.pow(ot-Fe,2)+Math.pow(Rt-Be,2))),Fe=ot,Be=Rt}const rt=ie.length-3;ie[2]=1,Xo(ie,0,rt,ue),ie[rt+2]=1,ie.size=Math.abs(qe),ie.start=0,ie.end=ie.size}function Hs(Ze,ie,ue,Te){for(let Fe=0;Fe<Ze.length;Fe++){const Be=[];Jl(Ze[Fe],Be,ue,Te),ie.push(Be)}}function Yo(Ze){return Ze/360+.5}function yr(Ze){const ie=Math.sin(Ze*Math.PI/180),ue=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ue<0?0:ue>1?1:ue}function zr(Ze,ie,ue,Te,Fe,Be,qe,rt){if(Te/=ie,Be>=(ue/=ie)&&qe<Te)return Ze;if(qe<ue||Be>=Te)return null;const Je=[];for(const ot of Ze){const Rt=ot.geometry;let St=ot.type;const ci=Fe===0?ot.minX:ot.minY,Oi=Fe===0?ot.maxX:ot.maxY;if(ci>=ue&&Oi<Te){Je.push(ot);continue}if(Oi<ue||ci>=Te)continue;let mi=[];if(St==="Point"||St==="MultiPoint")Ql(Rt,mi,ue,Te,Fe);else if(St==="LineString")Ss(Rt,mi,ue,Te,Fe,!1,rt.lineMetrics);else if(St==="MultiLineString")Ko(Rt,mi,ue,Te,Fe,!1);else if(St==="Polygon")Ko(Rt,mi,ue,Te,Fe,!0);else if(St==="MultiPolygon")for(const tn of Rt){const rn=[];Ko(tn,rn,ue,Te,Fe,!0),rn.length&&mi.push(rn)}if(mi.length){if(rt.lineMetrics&&St==="LineString"){for(const tn of mi)Je.push(Qa(ot.id,St,tn,ot.tags));continue}St!=="LineString"&&St!=="MultiLineString"||(mi.length===1?(St="LineString",mi=mi[0]):St="MultiLineString"),St!=="Point"&&St!=="MultiPoint"||(St=mi.length===3?"Point":"MultiPoint"),Je.push(Qa(ot.id,St,mi,ot.tags))}}return Je.length?Je:null}function Ql(Ze,ie,ue,Te,Fe){for(let Be=0;Be<Ze.length;Be+=3){const qe=Ze[Be+Fe];qe>=ue&&qe<=Te&&Gs(ie,Ze[Be],Ze[Be+1],Ze[Be+2])}}function Ss(Ze,ie,ue,Te,Fe,Be,qe){let rt=mo(Ze);const Je=Fe===0?ec:po;let ot,Rt,St=Ze.start;for(let rn=0;rn<Ze.length-3;rn+=3){const Zi=Ze[rn],Ui=Ze[rn+1],$n=Ze[rn+2],Ia=Ze[rn+3],Ta=Ze[rn+4],Yn=Fe===0?Zi:Ui,fn=Fe===0?Ia:Ta;let an=!1;qe&&(ot=Math.sqrt(Math.pow(Zi-Ia,2)+Math.pow(Ui-Ta,2))),Yn<ue?fn>ue&&(Rt=Je(rt,Zi,Ui,Ia,Ta,ue),qe&&(rt.start=St+ot*Rt)):Yn>Te?fn<Te&&(Rt=Je(rt,Zi,Ui,Ia,Ta,Te),qe&&(rt.start=St+ot*Rt)):Gs(rt,Zi,Ui,$n),fn<ue&&Yn>=ue&&(Rt=Je(rt,Zi,Ui,Ia,Ta,ue),an=!0),fn>Te&&Yn<=Te&&(Rt=Je(rt,Zi,Ui,Ia,Ta,Te),an=!0),!Be&&an&&(qe&&(rt.end=St+ot*Rt),ie.push(rt),rt=mo(Ze)),qe&&(St+=ot)}let ci=Ze.length-3;const Oi=Ze[ci],mi=Ze[ci+1],tn=Fe===0?Oi:mi;tn>=ue&&tn<=Te&&Gs(rt,Oi,mi,Ze[ci+2]),ci=rt.length-3,Be&&ci>=3&&(rt[ci]!==rt[0]||rt[ci+1]!==rt[1])&&Gs(rt,rt[0],rt[1],rt[2]),rt.length&&ie.push(rt)}function mo(Ze){const ie=[];return ie.size=Ze.size,ie.start=Ze.start,ie.end=Ze.end,ie}function Ko(Ze,ie,ue,Te,Fe,Be){for(const qe of Ze)Ss(qe,ie,ue,Te,Fe,Be,!1)}function Gs(Ze,ie,ue,Te){Ze.push(ie,ue,Te)}function ec(Ze,ie,ue,Te,Fe,Be){const qe=(Be-ie)/(Te-ie);return Gs(Ze,Be,ue+(Fe-ue)*qe,1),qe}function po(Ze,ie,ue,Te,Fe,Be){const qe=(Be-ue)/(Fe-ue);return Gs(Ze,ie+(Te-ie)*qe,Be,1),qe}function qa(Ze,ie){const ue=[];for(let Te=0;Te<Ze.length;Te++){const Fe=Ze[Te],Be=Fe.type;let qe;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")qe=Fr(Fe.geometry,ie);else if(Be==="MultiLineString"||Be==="Polygon"){qe=[];for(const rt of Fe.geometry)qe.push(Fr(rt,ie))}else if(Be==="MultiPolygon"){qe=[];for(const rt of Fe.geometry){const Je=[];for(const ot of rt)Je.push(Fr(ot,ie));qe.push(Je)}}ue.push(Qa(Fe.id,Be,qe,Fe.tags))}return ue}function Fr(Ze,ie){const ue=[];ue.size=Ze.size,Ze.start!==void 0&&(ue.start=Ze.start,ue.end=Ze.end);for(let Te=0;Te<Ze.length;Te+=3)ue.push(Ze[Te]+ie,Ze[Te+1],Ze[Te+2]);return ue}function tc(Ze,ie){if(Ze.transformed)return Ze;const ue=1<<Ze.z,Te=Ze.x,Fe=Ze.y;for(const Be of Ze.features){const qe=Be.geometry,rt=Be.type;if(Be.geometry=[],rt===1)for(let Je=0;Je<qe.length;Je+=2)Be.geometry.push(jo(qe[Je],qe[Je+1],ie,ue,Te,Fe));else for(let Je=0;Je<qe.length;Je++){const ot=[];for(let Rt=0;Rt<qe[Je].length;Rt+=2)ot.push(jo(qe[Je][Rt],qe[Je][Rt+1],ie,ue,Te,Fe));Be.geometry.push(ot)}}return Ze.transformed=!0,Ze}function jo(Ze,ie,ue,Te,Fe,Be){return[Math.round(ue*(Ze*Te-Fe)),Math.round(ue*(ie*Te-Be))]}function go(Ze,ie,ue,Te,Fe){const Be=ie===Fe.maxZoom?0:Fe.tolerance/((1<<ie)*Fe.extent),qe={features:[],numPoints:0,numSimplified:0,numFeatures:Ze.length,source:null,x:ue,y:Te,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rt of Ze)wu(qe,rt,Be,Fe);return qe}function wu(Ze,ie,ue,Te){const Fe=ie.geometry,Be=ie.type,qe=[];if(Ze.minX=Math.min(Ze.minX,ie.minX),Ze.minY=Math.min(Ze.minY,ie.minY),Ze.maxX=Math.max(Ze.maxX,ie.maxX),Ze.maxY=Math.max(Ze.maxY,ie.maxY),Be==="Point"||Be==="MultiPoint")for(let rt=0;rt<Fe.length;rt+=3)qe.push(Fe[rt],Fe[rt+1]),Ze.numPoints++,Ze.numSimplified++;else if(Be==="LineString")Pe(qe,Fe,Ze,ue,!1,!1);else if(Be==="MultiLineString"||Be==="Polygon")for(let rt=0;rt<Fe.length;rt++)Pe(qe,Fe[rt],Ze,ue,Be==="Polygon",rt===0);else if(Be==="MultiPolygon")for(let rt=0;rt<Fe.length;rt++){const Je=Fe[rt];for(let ot=0;ot<Je.length;ot++)Pe(qe,Je[ot],Ze,ue,!0,ot===0)}if(qe.length){let rt=ie.tags||null;if(Be==="LineString"&&Te.lineMetrics){rt={};for(const ot in ie.tags)rt[ot]=ie.tags[ot];rt.mapbox_clip_start=Fe.start/Fe.size,rt.mapbox_clip_end=Fe.end/Fe.size}const Je={geometry:qe,type:Be==="Polygon"||Be==="MultiPolygon"?3:Be==="LineString"||Be==="MultiLineString"?2:1,tags:rt};ie.id!==null&&(Je.id=ie.id),Ze.features.push(Je)}}function Pe(Ze,ie,ue,Te,Fe,Be){const qe=Te*Te;if(Te>0&&ie.size<(Fe?qe:Te))return void(ue.numPoints+=ie.length/3);const rt=[];for(let Je=0;Je<ie.length;Je+=3)(Te===0||ie[Je+2]>qe)&&(ue.numSimplified++,rt.push(ie[Je],ie[Je+1])),ue.numPoints++;Fe&&(function(Je,ot){let Rt=0;for(let St=0,ci=Je.length,Oi=ci-2;St<ci;Oi=St,St+=2)Rt+=(Je[St]-Je[Oi])*(Je[St+1]+Je[Oi+1]);if(Rt>0===ot)for(let St=0,ci=Je.length;St<ci/2;St+=2){const Oi=Je[St],mi=Je[St+1];Je[St]=Je[ci-2-St],Je[St+1]=Je[ci-1-St],Je[ci-2-St]=Oi,Je[ci-1-St]=mi}})(rt,Be),Ze.push(rt)}const zt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Qt{constructor(ie,ue){const Te=(ue=this.options=(function(Be,qe){for(const rt in qe)Be[rt]=qe[rt];return Be})(Object.create(zt),ue)).debug;if(Te&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");let Fe=(function(Be,qe){const rt=[];if(Be.type==="FeatureCollection")for(let Je=0;Je<Be.features.length;Je++)mr(rt,Be.features[Je],qe,Je);else mr(rt,Be.type==="Feature"?Be:{geometry:Be},qe);return rt})(ie,ue);this.tiles={},this.tileCoords=[],Te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Fe=(function(Be,qe){const rt=qe.buffer/qe.extent;let Je=Be;const ot=zr(Be,1,-1-rt,rt,0,-1,2,qe),Rt=zr(Be,1,1-rt,2+rt,0,-1,2,qe);return(ot||Rt)&&(Je=zr(Be,1,-rt,1+rt,0,-1,2,qe)||[],ot&&(Je=qa(ot,1).concat(Je)),Rt&&(Je=Je.concat(qa(Rt,-1)))),Je})(Fe,ue),Fe.length&&this.splitTile(Fe,0,0,0),Te&&(Fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ie,ue,Te,Fe,Be,qe,rt){const Je=[ie,ue,Te,Fe],ot=this.options,Rt=ot.debug;for(;Je.length;){Fe=Je.pop(),Te=Je.pop(),ue=Je.pop(),ie=Je.pop();const St=1<<ue,ci=Ei(ue,Te,Fe);let Oi=this.tiles[ci];if(!Oi&&(Rt>1&&console.time("creation"),Oi=this.tiles[ci]=go(ie,ue,Te,Fe,ot),this.tileCoords.push({z:ue,x:Te,y:Fe}),Rt)){Rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,Te,Fe,Oi.numFeatures,Oi.numPoints,Oi.numSimplified),console.timeEnd("creation"));const an=`z${ue}`;this.stats[an]=(this.stats[an]||0)+1,this.total++}if(Oi.source=ie,Be==null){if(ue===ot.indexMaxZoom||Oi.numPoints<=ot.indexMaxPoints)continue}else{if(ue===ot.maxZoom||ue===Be)continue;if(Be!=null){const an=Be-ue;if(Te!==qe>>an||Fe!==rt>>an)continue}}if(Oi.source=null,ie.length===0)continue;Rt>1&&console.time("clipping");const mi=.5*ot.buffer/ot.extent,tn=.5-mi,rn=.5+mi,Zi=1+mi;let Ui=null,$n=null,Ia=null,Ta=null,Yn=zr(ie,St,Te-mi,Te+rn,0,Oi.minX,Oi.maxX,ot),fn=zr(ie,St,Te+tn,Te+Zi,0,Oi.minX,Oi.maxX,ot);ie=null,Yn&&(Ui=zr(Yn,St,Fe-mi,Fe+rn,1,Oi.minY,Oi.maxY,ot),$n=zr(Yn,St,Fe+tn,Fe+Zi,1,Oi.minY,Oi.maxY,ot),Yn=null),fn&&(Ia=zr(fn,St,Fe-mi,Fe+rn,1,Oi.minY,Oi.maxY,ot),Ta=zr(fn,St,Fe+tn,Fe+Zi,1,Oi.minY,Oi.maxY,ot),fn=null),Rt>1&&console.timeEnd("clipping"),Je.push(Ui||[],ue+1,2*Te,2*Fe),Je.push($n||[],ue+1,2*Te,2*Fe+1),Je.push(Ia||[],ue+1,2*Te+1,2*Fe),Je.push(Ta||[],ue+1,2*Te+1,2*Fe+1)}}getTile(ie,ue,Te){ie=+ie,ue=+ue,Te=+Te;const Fe=this.options,{extent:Be,debug:qe}=Fe;if(ie<0||ie>24)return null;const rt=1<<ie,Je=Ei(ie,ue=ue+rt&rt-1,Te);if(this.tiles[Je])return tc(this.tiles[Je],Be);qe>1&&console.log("drilling down to z%d-%d-%d",ie,ue,Te);let ot,Rt=ie,St=ue,ci=Te;for(;!ot&&Rt>0;)Rt--,St>>=1,ci>>=1,ot=this.tiles[Ei(Rt,St,ci)];return ot&&ot.source?(qe>1&&(console.log("found parent tile z%d-%d-%d",Rt,St,ci),console.time("drilling down")),this.splitTile(ot.source,Rt,St,ci,ie,ue,Te),qe>1&&console.timeEnd("drilling down"),this.tiles[Je]?tc(this.tiles[Je],Be):null):null}}function Ei(Ze,ie,ue){return 32*((1<<Ze)*ue+ie)+Ze}function ui(Ze,ie){const ue=Ze.tileID.canonical;if(!this._geoJSONIndex)return void ie(null,null);const Te=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!Te)return void ie(null,null);const Fe=ot=>ot.tags&&"3d_elevation_id"in ot.tags&&"source"in ot.tags&&ot.tags.source==="elevation",Be=Te.features.filter((ot=>Fe(ot)));let qe={_geojsonTileLayer:Te.features};Be.length>0&&(qe={_geojsonTileLayer:Te.features.filter((ot=>!Fe(ot))),hd_road_elevation:Be});const rt=new Vi(qe),Je=(function(ot){const Rt=new i.bt;for(const St of Object.keys(ot))Rt.writeMessage(3,li,{name:St,features:ot[St]});return Rt.finish()})(qe).buffer;ie(null,{vectorTile:rt,rawData:Je})}class qi extends tt{constructor(ie,ue,Te,Fe,Be,qe,rt){super(ie,ue,Te,Fe,Be,ui,rt),qe&&(this.loadGeoJSON=qe),this._dynamicIndex=new Et}loadData(ie,ue){const Te=ie&&ie.request,Fe=Te&&Te.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ie,((Be,qe)=>{if(Be||!qe)return ue(Be);if(typeof qe!="object")return ue(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));{try{if(ie.filter){const Je=i.U(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Je.result==="error")throw new Error(Je.value.map((ot=>`${ot.key}: ${ot.message}`)).join(", "));qe.features=qe.features.filter((ot=>Je.value.evaluate({zoom:0},ot)))}ie.dynamic?(qe.type==="Feature"&&(qe={type:"FeatureCollection",features:[qe]}),ie.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(qe.features,this.loaded),ie.cluster&&(qe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ie.cluster?new $c((function({superclusterOptions:Je,clusterProperties:ot}){if(!ot||!Je)return Je;const Rt={},St={},ci={accumulated:null,zoom:0},Oi={properties:null},mi=Object.keys(ot);for(const tn of mi){const[rn,Zi]=ot[tn],Ui=i.U(Zi),$n=i.U(typeof rn=="string"?[rn,["accumulated"],["get",tn]]:rn);Rt[tn]=Ui.value,St[tn]=$n.value}return Je.map=tn=>{Oi.properties=tn;const rn={};for(const Zi of mi)rn[Zi]=Rt[Zi].evaluate(ci,Oi);return rn},Je.reduce=(tn,rn)=>{Oi.properties=rn;for(const Zi of mi)ci.accumulated=tn[Zi],tn[Zi]=St[Zi].evaluate(ci,Oi)},Je})(ie)).load(qe.features):ie.dynamic?this._dynamicIndex:(function(Je,ot){return new Qt(Je,ot)})(qe,ie.geojsonVtOptions)}catch(Je){return ue(Je)}const rt={};if(Fe){const Je=M(Te);Je&&(rt.resourceTiming={},rt.resourceTiming[ie.source]=JSON.parse(JSON.stringify(Je)))}ue(null,rt)}}))}reloadTile(ie,ue){const Te=this.loaded;return Te&&Te[ie.uid]?ie.partial?ue(null,void 0):super.reloadTile(ie,ue):this.loadTile(ie,ue)}loadGeoJSON(ie,ue){if(ie.request)i.m(ie.request,ue);else{if(typeof ie.data!="string")return ue(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return ue(null,JSON.parse(ie.data))}catch{return ue(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(ie,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(Te){ue(Te)}}getClusterChildren(ie,ue){try{ue(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(Te){ue(Te)}}getClusterLeaves(ie,ue){try{ue(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(Te){ue(Te)}}}class Si{constructor(ie,ue,Te){this.tileID=new i.aQ(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ie.projection,this.brightness=ue,this.worldview=Te}parse(ie,ue,Te,Fe){this.status="parsing";const Be=new i.aQ(Te.tileID.overscaledZ,Te.tileID.wrap,Te.tileID.canonical.z,Te.tileID.canonical.x,Te.tileID.canonical.y),qe=[],rt=ue.familiesBySource[Te.source],Je=new i.fn(Be,Te.promoteId);Je.bucketLayerIDs=[],Je.is3DTile=!0,i.fC(ie).then((ot=>{if(!ot)return Fe(new Error("Could not parse tile"));const Rt=ot.json.extensionsUsed&&ot.json.extensionsUsed.includes("MAPBOX_mesh_features")||ot.json.asset.extras&&ot.json.asset.extras.MAPBOX_mesh_features,St=ot.json.extensionsUsed&&ot.json.extensionsUsed.includes("EXT_meshopt_compression"),ci=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Oi in rt)for(const mi of rt[Oi]){const tn=mi[0];Je.bucketLayerIDs.push(mi.map((Ui=>i.B(Ui.id,Ui.scope)))),tn.recalculate(ci,[]);const rn=i.fD(ot,1/i.d7(Te.tileID.canonical)),Zi=new i.fE(mi,rn,Be,Rt,St,this.brightness,Je,this.worldview);Rt||(Zi.needsUpload=!0),qe.push(Zi),Zi.evaluate(tn)}this.status="done",Fe(null,{buckets:qe,featureIndex:Je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((ot=>Fe(new Error(ot.message))))}}class pn{constructor(ie,ue,Te,Fe,Be,qe,rt,Je){this.actor=ie,this.layerIndex=ue,this.availableImages=Te,this.availableModels=Fe,this.brightness=rt,this.loading={},this.loaded={},this.worldview=Je}loadTile(ie,ue){const Te=ie.uid,Fe=this.loading[Te]=new Si(ie,this.brightness,this.worldview);i.bu(ie.request,((Be,qe)=>{const rt=!this.loading[Te];return delete this.loading[Te],rt||Be?(Fe.status="done",rt||(this.loaded[Te]=Fe),ue(Be)):qe&&qe.byteLength!==0?void Fe.parse(qe,this.layerIndex,ie,((Je,ot)=>{Fe.status="done",this.loaded=this.loaded||{},this.loaded[Te]=Fe,Je||!ot?ue(Je):ue(null,ot)})):(Fe.status="done",this.loaded[Te]=Fe,ue())}))}reloadTile(ie,ue){const Te=this.loaded,Fe=ie.uid;if(Te&&Te[Fe]){const Be=Te[Fe];Be.projection=ie.projection,Be.brightness=ie.brightness;const qe=(rt,Je)=>{Be.reloadCallback&&(delete Be.reloadCallback,this.loadTile(ie,ue)),ue(rt,Je)};Be.status==="parsing"?Be.reloadCallback=qe:Be.status==="done"&&this.loadTile(ie,ue)}}abortTile(ie,ue){const Te=ie.uid;this.loading[Te]&&delete this.loading[Te],ue()}removeTile(ie,ue){const Te=this.loaded,Fe=ie.uid;Te&&Te[Fe]&&delete Te[Fe],ue()}}class kn{constructor(ie){this.self=ie,this.actor=new i.fG(ie,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cm({name:"mercator"}),this.workerSourceTypes={vector:tt,geojson:qi,"raster-dem":Ke,"raster-array":ft,"batched-model":pn},this.workerSources={},this.self.registerWorkerSource=(ue,Te)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=Te},this.self.registerRTLTextPlugin=ue=>{if(i.fH.isParsed())throw new Error("RTL text plugin already registered.");i.fH.setState({pluginStatus:i.fI.parsed,pluginURL:i.fH.getPluginURL()}),i.fH.applyArabicShaping=ue.applyArabicShaping,i.fH.processBidirectionalText=ue.processBidirectionalText,i.fH.processStyledBidirectionalText=ue.processStyledBidirectionalText;for(const Te of this.rtlPluginParsingListeners)Te(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ie,ue,Te){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.availableModels[ie],delete this.workerSources[ie],Te()}checkIfReady(ie,ue,Te){Te()}setReferrer(ie,ue){this.referrer=ue}spriteLoaded(ie,ue){this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={});const{scope:Te,isLoaded:Fe}=ue;if(this.isSpriteLoaded[ie][Te]=Fe,this.workerSources[ie]&&this.workerSources[ie][Te])for(const Be in this.workerSources[ie][Te]){const qe=this.workerSources[ie][Te][Be];for(const rt in qe){const Je=qe[rt];Je instanceof tt&&(Je.isSpriteLoaded=Fe,Je.fire(new i.z("isSpriteLoaded")))}}}setImages(ie,ue,Te){this.availableImages[ie]||(this.availableImages[ie]={});const{scope:Fe,images:Be}=ue;if(this.availableImages[ie][Fe]=Be,this.workerSources[ie]&&this.workerSources[ie][Fe]){for(const qe in this.workerSources[ie][Fe]){const rt=this.workerSources[ie][Fe][qe];for(const Je in rt)rt[Je].availableImages=Be}Te()}else Te()}setModels(ie,{scope:ue,models:Te},Fe){if(this.availableModels[ie]||(this.availableModels[ie]={}),this.availableModels[ie][ue]=Te,this.workerSources[ie]&&this.workerSources[ie][ue]){for(const Be in this.workerSources[ie][ue]){const qe=this.workerSources[ie][ue][Be];for(const rt in qe)qe[rt].availableModels=Te}Fe()}else Fe()}setProjection(ie,ue){this.projections[ie]=i.cm(ue)}setBrightness(ie,ue,Te){this.brightness=ue,Te()}setWorldview(ie,ue,Te){this.worldview=ue,Te()}setLayers(ie,ue,Te){this.getLayerIndex(ie,ue.scope).replace(ue.layers,ue.options),Te()}updateLayers(ie,ue,Te){this.getLayerIndex(ie,ue.scope).update(ue.layers,ue.removedIds,ue.options),Te()}loadTile(ie,ue,Te){ue.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,ue.type,ue.source,ue.scope).loadTile(ue,Te)}decodeRasterArray(ie,ue,Te){this.getWorkerSource(ie,ue.type,ue.source,ue.scope).decodeRasterArray(ue,Te)}reloadTile(ie,ue,Te){ue.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,ue.type,ue.source,ue.scope).reloadTile(ue,Te)}abortTile(ie,ue,Te){this.getWorkerSource(ie,ue.type,ue.source,ue.scope).abortTile(ue,Te)}removeTile(ie,ue,Te){this.getWorkerSource(ie,ue.type,ue.source,ue.scope).removeTile(ue,Te)}removeSource(ie,ue,Te){if(!(this.workerSources[ie]&&this.workerSources[ie][ue.scope]&&this.workerSources[ie][ue.scope][ue.type]&&this.workerSources[ie][ue.scope][ue.type][ue.source]))return;const Fe=this.workerSources[ie][ue.scope][ue.type][ue.source];delete this.workerSources[ie][ue.scope][ue.type][ue.source],Fe.removeSource!==void 0?Fe.removeSource(ue,Te):Te()}loadWorkerSource(ie,ue,Te){try{this.self.importScripts(ue.url),Te()}catch(Fe){Te(Fe)}}syncRTLPluginState(ie,ue,Te){if(i.fH.isParsed())Te(null,!0);else if(i.fH.isParsing())this.rtlPluginParsingListeners.push(Te);else try{i.fH.setState(ue);const Fe=i.fH.getPluginURL();!i.fH.isLoaded()||i.fH.isParsed()||i.fH.isParsing()||Fe==null||(i.fH.setState({pluginStatus:i.fI.parsing,pluginURL:i.fH.getPluginURL()}),this.self.importScripts(Fe),i.fH.isParsed()?Te(null,!0):this.rtlPluginParsingListeners.push(Te))}catch(Fe){Te(Fe)}}setDracoUrl(ie,ue){this.dracoUrl=ue}getAvailableImages(ie,ue){this.availableImages[ie]||(this.availableImages[ie]={});let Te=this.availableImages[ie][ue];return Te||(Te=[]),Te}getAvailableModels(ie,ue){this.availableModels[ie]||(this.availableModels[ie]={});let Te=this.availableModels[ie][ue];return Te||(Te={}),Te}getLayerIndex(ie,ue){this.layerIndexes[ie]||(this.layerIndexes[ie]={});let Te=this.layerIndexes[ie][ue];return Te||(Te=this.layerIndexes[ie][ue]=new H,Te.scope=ue),Te}getWorkerSource(ie,ue,Te,Fe){const Be=this.workerSources;return Be[ie]||(Be[ie]={}),Be[ie][Fe]||(Be[ie][Fe]={}),Be[ie][Fe][ue]||(Be[ie][Fe][ue]={}),this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),Be[ie][Fe][ue][Te]||(Be[ie][Fe][ue][Te]=new this.workerSourceTypes[ue]({send:(qe,rt,Je,ot,Rt,St)=>this.actor.send(qe,rt,Je,ie,Rt,St),scheduler:this.actor.scheduler},this.getLayerIndex(ie,Fe),this.getAvailableImages(ie,Fe),this.getAvailableModels(ie,Fe),this.isSpriteLoaded[ie][Fe],void 0,this.brightness,this.worldview)),Be[ie][Fe][ue][Te]}rasterizeImagesWorker(ie,ue,Te){const Fe=new Map;for(const[Be,{image:qe,imageVariant:rt}]of ue.tasks.entries()){const Je=this.imageRasterizer.rasterize(rt,qe,ue.scope,ie);Fe.set(Be,Je)}Te(void 0,Fe)}removeRasterizedImages(ie,ue,Te){this.imageRasterizer.removeImagesFromCacheByIds(ue.imageIds,ue.scope,ie),Te()}enforceCacheSizeLimit(ie,ue){i.fJ(ue)}getWorkerPerformanceMetrics(ie,ue,Te){Te(void 0,void 0)}}return i.fF(self)&&(self.worker=new kn(self)),kn})),x(["./shared"],(function(i){var M="3.17.0";const P={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(f){performance.mark(f)},measure(f,t,s){performance.measure(f,t,s)}};function H(f){const t=f.name.split("?")[0];return i.a(t)&&t.includes("mapbox-gl.js")?"javascript":i.a(t)&&t.includes("mapbox-gl.css")?"css":i.b(t)?"fontRange":i.c(t)?"sprite":i.i(t)?"style":i.d(t)?"tilejson":"other"}var W,K={},re=(function(){if(W)return K;function f(m){return!t(m)}function t(m){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,E,j=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(j);try{E=new Worker(D),T=!0}catch{T=!1}return E&&E.terminate(),URL.revokeObjectURL(D),T})()?(function(){var T=document.createElement("canvas");T.width=T.height=1;var E=T.getContext("2d");if(!E)return!1;var j=E.getImageData(0,0,1,1);return j&&j.width===T.width})()?(s[v=m&&m.failIfMajorPerformanceCaveat]===void 0&&(s[v]=(function(T){var E,j=(function(D){var B=document.createElement("canvas"),V=Object.create(f.webGLContextAttributes);return V.failIfMajorPerformanceCaveat=D,B.getContext("webgl2",V)})(T);if(!j)return!1;try{E=j.createShader(j.VERTEX_SHADER)}catch{return!1}return!(!E||j.isContextLost())&&(j.shaderSource(E,"void main() {}"),j.compileShader(E),j.getShaderParameter(E,j.COMPILE_STATUS)===!0)})(v)),s[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}W=1,K.supported=f,K.notSupportedReason=t;var s={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},K})();function ae(f,t,s){const m=document.createElement(f);return t!=null&&(m.className=t),s&&s.appendChild(m),m}function ce(f,t,s){const m=document.createElementNS("http://www.w3.org/2000/svg",f);for(const v of Object.keys(t))m.setAttributeNS(null,v,String(t[v]));return s&&s.appendChild(m),m}const ve=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Se=ve&&ve.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ee;function Qe(){ve&&Se&&(Ee=ve[Se],ve[Se]="none")}function He(){ve&&Se&&(ve[Se]=Ee)}function ke(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",ke,!0)}function tt(){window.addEventListener("click",ke,!0),window.setTimeout((()=>{window.removeEventListener("click",ke,!0)}),0)}function Ke(f,t){const s=f.getBoundingClientRect();return gt(f,s,t)}function lt(f,t){const s=f.getBoundingClientRect(),m=[];for(let v=0;v<t.length;v++)m.push(gt(f,s,t[v]));return m}function ft(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function gt(f,t,s){const m=f.offsetWidth===t.width?1:f.offsetWidth/t.width;return new i.P((s.clientX-t.left)*m,(s.clientY-t.top)*m)}const ni="01",Ft="NO_ACCESS_TOKEN";class Vi{constructor(t,s,m){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const t=(function(){let s="";for(let m=0;m<10;m++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ni,s].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!i.h(t))return t;const m=We(t);return m.params.push(`sdk=js-${M}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!i.h(t))return t;const m=We(t);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||s)}normalizeModelURL(t,s){if(!i.h(t))return t;const m=We(t);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||s)}normalizeSourceURL(t,s,m,v){if(!i.h(t))return t;const T=We(t);return T.path=`/v4/${T.authority}.json`,T.params.push("secure"),m&&T.params.push(`language=${m}`),v&&T.params.push(`worldview=${v}`),this._makeAPIURL(T,this._customAccessToken||s)}normalizeIconsetURL(t,s){const m=We(t);return i.h(t)?(m.path=`/styles/v1${m.path}/iconset.pbf`,this._makeAPIURL(m,this._customAccessToken||s)):Et(m)}normalizeSpriteURL(t,s,m,v){const T=We(t);return i.h(t)?(T.path=`/styles/v1${T.path}/sprite${s}${m}`,this._makeAPIURL(T,this._customAccessToken||v)):(T.path+=`${s}${m}`,Et(T))}normalizeTileURL(t,s,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!i.h(t))return t;const v=We(t);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||m&&v.authority!=="raster"&&m===512?"@2x":""}${i.k.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${i.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${i.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${i.e.TILE_URL_VERSION}${v.path}`);const T=this._customAccessToken||(function(E){for(const j of E){const D=j.match(/^access_token=(.*)$/);if(D)return D[1]}return null})(v.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&T&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,T)}canonicalizeTileURL(t,s){const m=We(t);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return t;let v="mapbox://";m.path.match(/^\/raster\/v1\//)?v+=`raster/${m.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${m.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${m.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let T=m.params;return s&&(T=T.filter((E=>!E.match(/^access_token=/)))),T.length&&(v+=`?${T.join("&")}`),v}canonicalizeTileset(t,s){const m=!!s&&i.h(s),v=[];for(const T of t.tiles||[])i.j(T)?v.push(this.canonicalizeTileURL(T,m)):v.push(T);return v}_makeAPIURL(t,s){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=We(i.e.API_URL);if(t.protocol=v.protocol,t.authority=v.authority,t.protocol==="http"){const T=t.params.indexOf("secure");T>=0&&t.params.splice(T,1)}if(v.path!=="/"&&(t.path=`${v.path}${t.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Et(t);if(s=s||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return t.params=t.params.filter((T=>T.indexOf("access_token")===-1)),t.params.push(`access_token=${s||""}`),Et(t)}}const Ri=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function We(f){const t=f.match(Ri);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Et(f){const t=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${t}`}const jt="mapbox.eventData";function Gi(f){if(!f)return null;const t=f.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(i.l(t[1]))}catch{return null}}class Ce{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=Gi(i.e.ACCESS_TOKEN);let m="";return m=s&&s.u?i.f(s.u):i.e.ACCESS_TOKEN||"",t?`${jt}.${t}:${m}`:`${jt}:${m}`}fetchEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),m=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp");if(t)try{const T=localStorage.getItem(s);T&&(this.eventData=JSON.parse(T));const E=localStorage.getItem(m);E&&(this.anonId=E);const j=localStorage.getItem(v);j&&(this.anonIdTimestamp=Number(j));const D=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<D)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),m=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp"),T=this.anonId,E=this.anonIdTimestamp;if(t&&T)try{localStorage.setItem(m,T),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData)),E&&localStorage.setItem(v,E.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,m,v){if(!i.e.EVENTS_URL)return;const T=We(i.e.EVENTS_URL);T.params.push(`access_token=${v||i.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(t).toISOString()},j=s?Object.assign(E,s):E,D={url:Et(T),headers:{"Content-Type":"text/plain"},body:JSON.stringify([j])};this.pendingRequest=i.p(D,(B=>{this.pendingRequest=null,m(B),this.saveEventData(),this.processRequests(v)}))}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}class _t extends Ce{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!i.e.EVENTS_URL||!t&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const s=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:s},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:m}=this.queue.shift();this.postEvent(s,m,(()=>{}),t)}}const At=new class extends Ce{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,t){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some((s=>i.h(s)||i.j(s)))&&this.queueRequest(Date.now(),t)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Gi(i.e.ACCESS_TOKEN),s=t?t.u:i.e.ACCESS_TOKEN;let m=s!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),m=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const T=new Date(this.eventData.lastSuccess),E=new Date(v),j=(v-this.eventData.lastSuccess)/864e5;m=m||j>=1||j<-1||T.getDate()!==E.getDate()}else m=!0;m?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:ni,"enabled.telemetry":!1,userId:this.anonId},(T=>{T||(this.eventData.lastSuccess=v,this.eventData.tokenU=s)}),f):this.processRequests()}},Ct=At.postTurnstileEvent.bind(At),oi=new class extends Ce{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,t,s,m){this.skuToken=t,this.errorCb=m,i.e.EVENTS_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(Ft)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:ni,skuToken:this.skuToken,userId:this.anonId},(m=>{m?this.errorCb(m):t&&(this.success[t]=!0)}),f))}remove(){this.errorCb=null}},Ci=oi.postMapLoadEvent.bind(oi),li=new class extends Ce{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let t=this.mapInstanceIdMap.get(f);return t||(t=i.u(),this.mapInstanceIdMap.set(f,t)),t}getEventId(f){const t=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,t+1),t}postStyleLoadEvent(f,t){const{map:s,style:m,importedStyles:v}=t;if(!i.e.EVENTS_URL||!f&&!i.e.ACCESS_TOKEN)return;const T=this.getMapInstanceId(s),E={mapInstanceId:T,eventId:this.getEventId(T),style:m};v.length&&(E.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:E},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,(()=>{}),f)}},Ba=li.postStyleLoadEvent.bind(li),Un=new _t({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),qn=Un.postMetricsEvent.bind(Un),On=new _t({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Ja=On.postMetricsEvent.bind(On),Qi=new class extends Ce{constructor(){super("gljs.performance")}postPerformanceEvent(f,t){i.e.EVENTS_URL&&(f||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),m=(function(v){const T=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),j=(function(J){const se={};if(J){for(const ne in J)if(ne!=="other")for(const he of J[ne]){const de=`${ne}ResolveRangeMin`,pe=`${ne}ResolveRangeMax`,xe=`${ne}RequestCount`,ge=`${ne}RequestCachedCount`;se[de]=Math.min(se[de]||1/0,he.startTime),se[pe]=Math.max(se[pe]||-1/0,he.responseEnd);const je=Ae=>{se[Ae]===void 0&&(se[Ae]=0),++se[Ae]};he.transferSize!==void 0&&he.transferSize===0&&je(ge),je(xe)}}return se})((function(J,se){const ne={};if(J)for(const he of J){const de=se(he);ne[de]===void 0&&(ne[de]=[]),ne[de].push(he)}return ne})(T,H)),D=window.devicePixelRatio,B=navigator.connection||navigator.mozConnection||navigator.webkitConnection,V=B?B.effectiveType:void 0,Y={counters:[],metadata:[],attributes:[]},X=(J,se,ne)=>{ne!=null&&J.push({name:se,value:ne.toString()})};for(const J in j)X(Y.counters,J,j[J]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(X(Y.counters,"interactionRangeMin",v.interactionRange[0]),X(Y.counters,"interactionRangeMax",v.interactionRange[1])),E)for(const J of Object.values(P)){const se=E.find((ne=>ne.name===J));se&&X(Y.counters,J,se.startTime)}return X(Y.counters,"visibilityHidden",v.visibilityHidden),X(Y.attributes,"style",(function(J){if(J)for(const se of J){const ne=se.name.split("?")[0];if(i.i(ne)){const he=ne.split("/").slice(-2);if(he.length===2)return`mapbox://styles/${he[0]}/${he[1]}`}}})(T)),X(Y.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),X(Y.attributes,"fogEnabled",v.fogEnabled?"true":"false"),X(Y.attributes,"projection",v.projection),X(Y.attributes,"zoom",v.zoom),X(Y.metadata,"devicePixelRatio",D),X(Y.metadata,"connectionEffectiveType",V),X(Y.metadata,"navigatorUserAgent",navigator.userAgent),X(Y.metadata,"screenWidth",window.screen.width),X(Y.metadata,"screenHeight",window.screen.height),X(Y.metadata,"windowWidth",window.innerWidth),X(Y.metadata,"windowHeight",window.innerHeight),X(Y.metadata,"mapWidth",v.width/D),X(Y.metadata,"mapHeight",v.height/D),X(Y.metadata,"webglRenderer",v.renderer),X(Y.metadata,"webglVendor",v.vendor),X(Y.metadata,"sdkVersion",M),X(Y.metadata,"sdkIdentifier","mapbox-gl-js"),Y})(s);for(const v of m.metadata);for(const v of m.counters);for(const v of m.attributes);this.postEvent(t,m,(()=>{}),f)}},Fi=Qi.postPerformanceEvent.bind(Qi),nn=new class extends Ce{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,t,s,m){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const v=We(i.e.API_URL+i.e.SESSION_PATH);v.params.push(`sku=${t||""}`),v.params.push(`access_token=${m||i.e.ACCESS_TOKEN||""}`);const T={url:Et(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(T,(E=>{this.pendingRequest=null,s(E),this.saveEventData(),this.processRequests(m)}))}getSessionAPI(f,t,s,m){this.skuToken=t,this.errorCb=m,i.e.SESSION_PATH&&i.e.API_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(Ft)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,(m=>{m?this.errorCb(m):t&&(this.success[t]=!0)}),f)}remove(){this.errorCb=null}},hn=nn.getSessionAPI.bind(nn),ln=new Set;function xn(f,t){t?ln.add(f):ln.delete(f)}class za{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,s){this._updatedImages[s]=this._updatedImages[s]||new Set,this._updatedImages[s].add(i.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function $c(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class Zo extends i.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new i.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const s=this.atlasTexture.get(t);s&&(s.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,s){this.imageProviders.has(s)||this.imageProviders.set(s,new Map),this.imageProviders.get(s).set(t.id,t)}removeImageProvider(t,s){this.imageProviders.has(s)&&this.imageProviders.get(s).delete(t)}getPendingImageProviders(){const t=[];for(const s of this.imageProviders.values())for(const m of s.values())m.hasPendingRequests()&&t.push(m);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,s){if(this.loaded.get(s)!==t&&(this.loaded.set(s,t),t)){for(const{ids:m,callback:v}of this.requestors)this._notify(m,s,v);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return this.images.get(s).get(t.toString())}addImage(t,s,m){this._validate(t,m)&&this.images.get(s).set(t.toString(),m)}_validate(t,s){let m=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new i.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),m=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new i.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),m=!1),this._validateContent(s.content,s)||(this.fire(new i.y(new Error(`Image "${t.name}" has invalid "content" value`))),m=!1),m}_validateStretch(t,s){if(!t)return!0;let m=0;for(const v of t){if(v[0]<m||v[1]<v[0]||s<v[1])return!1;m=v[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,m){const v=this.images.get(s).get(t.toString());m.version=v.version+1,this.images.get(s).set(t.toString(),m),this.updatedImages.get(s).add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,s){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([t],s))}removeImage(t,s){const m=this.images.get(s),v=m.get(t.toString());m.delete(t.toString()),this.patterns.get(s).delete(t.toString()),this.removeFromImageRasterizerCache(t,s),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((s=>i.I.from(s)))}getImages(t,s,m){const v=[],T=[],E=this.imageProviders.get(s);for(const V of t){if(!V.iconsetId){v.push(V);continue}const Y=E.get(V.iconsetId);Y&&(this.getImage(V,s)?T.push(V):Y.addPendingRequest(V))}if(v.length===0)return void this._notify(T,s,m);let j=!0;const D=!!this.loaded.get(s),B=this.images.get(s);if(!D)for(const V of v)B.has(V.toString())||(j=!1);D||j?this._notify(v,s,m):this.requestors.push({ids:v,scope:s,callback:m})}rasterizeImages(t,s){const m=new Map,{tasks:v,scope:T}=t;for(const[E,j]of v.entries()){const D=this.getImage(j.id,T);D&&m.set(E,{image:D,imageVariant:j})}this._rasterizeImages(T,m,s)}_rasterizeImages(t,s,m){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:s,scope:t},m);else{const v=new Map;for(const[T,{image:E,imageVariant:j}]of s.entries())v.set(T,this.imageRasterizer.rasterize(j,E,t,0));m(void 0,v)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,s,m){const v=this.images.get(s),T=new Map;for(const E of t){if(!v.get(E.toString())){if(E.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:E.name}))}const j=v.get(E.toString());if(!j){i.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const D={data:j.usvg?null:j.data.clone(),pixelRatio:j.pixelRatio,sdf:j.sdf,usvg:j.usvg,version:j.version,stretchX:j.stretchX,stretchY:j.stretchY,content:j.content,hasRenderCallback:!!(j.userImage&&j.userImage.render)};j.usvg&&Object.assign(D,{width:j.icon.usvg_tree.width,height:j.icon.usvg_tree.height}),T.set(i.I.toString(E),D)}m(null,T)}getPixelSize(t){const{width:s,height:m}=this.atlasImage.get(t);return{width:s,height:m}}getPattern(t,s,m){const v=t.toString(),T=this.patterns.get(s),E=T.get(v),j=this.getImage(t,s);if(!j)return null;if(E){if(E.position.version===j.version)return E.position;E.position.version=j.version}else{if(j.usvg&&!j.data){const D=this.getPatternInFlightId(v,s);if(this.patternsInFlight.has(D))return null;this.patternsInFlight.add(D);const B=new i.A(t).scaleSelf(i.o.devicePixelRatio),V=new Map([[B.toString(),{image:j,imageVariant:B}]]);return this._rasterizeImages(s,V,((Y,X)=>this.storePatternImage(B,s,j,m,X))),null}this.storePattern(t,s,j)}return this._updatePatternAtlas(s,m),T.get(v).position}getPatternInFlightId(t,s){return i.B(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,m,v,T){const E=t.toString(),j=T?T.get(E):void 0;j&&(m.data=j,this.storePattern(t.id,s,m),this._updatePatternAtlas(s,v),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,m){const v={w:m.data.width+2*i.C,h:m.data.height+2*i.C,x:0,y:0},T=new i.F(v,m,i.C);this.patterns.get(s).set(t.toString(),{bin:v,position:T})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,s){const m=t.gl;let v=this.atlasTexture.get(s);v?this.dirty&&(v.update(this.atlasImage.get(s)),this.dirty=!1):(v=new i.T(t,this.atlasImage.get(s),m.RGBA8),this.atlasTexture.set(s,v)),v.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const m=this.patterns.get(t),v=Array.from(m.values()).map((({bin:B})=>B)),{w:T,h:E}=i.G(v),j=this.atlasImage.get(t);j.resize({width:T||1,height:E||1});const D=this.images.get(t);for(const[B,{bin:V,position:Y}]of m.entries()){let X=Y.padding;const J=V.x+X,se=V.y+X,ne=D.get(B).data,he=ne.width,de=ne.height;X=X>1?X-1:X,i.q.copy(ne,j,{x:0,y:0},{x:J,y:se},{width:he,height:de},s),i.q.copy(ne,j,{x:0,y:de-X},{x:J,y:se-X},{width:he,height:X},s),i.q.copy(ne,j,{x:0,y:0},{x:J,y:se+de},{width:he,height:X},s),i.q.copy(ne,j,{x:he-X,y:0},{x:J-X,y:se},{width:X,height:de},s),i.q.copy(ne,j,{x:0,y:0},{x:J+he,y:se},{width:X,height:de},s),i.q.copy(ne,j,{x:he-X,y:de-X},{x:J-X,y:se-X},{width:X,height:X},s),i.q.copy(ne,j,{x:0,y:de-X},{x:J+he,y:se-X},{width:X,height:X},s),i.q.copy(ne,j,{x:0,y:0},{x:J+he,y:se+de},{width:X,height:X},s),i.q.copy(ne,j,{x:he-X,y:0},{x:J-X,y:se+de},{width:X,height:X},s)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,s){const m=this.images.get(s);for(const v of t){if(this.callbackDispatchedThisFrame.get(s).has(v.toString()))continue;this.callbackDispatchedThisFrame.get(s).add(v.toString());const T=m.get(v.toString());$c(T)&&this.updateImage(v,s,T)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function $s(f){const t=f.value,s=f.valueSpec,m=f.style,v=f.styleSpec,T=f.key,E=f.arrayElementValidator||qa;if(!Array.isArray(t))return[new i.V(T,t,`array expected, ${i.K(t)} found`)];if(s.length&&t.length!==s.length)return[new i.V(T,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new i.V(T,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let j={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};v.$version<7&&(j.function=s.function),i.H(s.value)&&(j=s.value);let D=[];for(let B=0;B<t.length;B++)D=D.concat(E({array:t,arrayIndex:B,value:t[B],valueSpec:j,style:m,styleSpec:v,key:`${T}[${B}]`},!0));return D}function ws(f){const t=f.key,s=f.value,m=f.valueSpec;if(!i.L(s))return[new i.V(t,s,`number expected, ${i.K(s)} found`)];if(s!=s)return[new i.V(t,s,"number expected, NaN found")];if("minimum"in m){let v=m.minimum;if(Array.isArray(m.minimum)&&(v=m.minimum[f.arrayIndex]),s<v)return[new i.V(t,s,`${s} is less than the minimum value ${v}`)]}if("maximum"in m){let v=m.maximum;if(Array.isArray(m.maximum)&&(v=m.maximum[f.arrayIndex]),s>v)return[new i.V(t,s,`${s} is greater than the maximum value ${v}`)]}return[]}function Vs(f){const t=f.key,s=f.value;if(!i.H(s))return[new i.V(t,s,`object expected, ${i.K(s)} found`)];const m=f.valueSpec,v=i.J(s.type);let T,E,j,D={};const B=v!=="categorical"&&s.property===void 0,V=!B,Y=(function(ne){const he=ne.stops;return Array.isArray(he)&&Array.isArray(he[0])&&i.H(he[0][0])})(s),X=Fr({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(ne){if(v==="identity")return[new i.V(ne.key,ne.value,'identity function may not have a "stops" property')];let he=[];const de=ne.value;return he=he.concat($s({key:ne.key,value:de,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:J})),Array.isArray(de)&&de.length===0&&he.push(new i.V(ne.key,de,"array must have at least one stop")),he},default:function(ne){return qa({key:ne.key,value:ne.value,valueSpec:m,style:ne.style,styleSpec:ne.styleSpec})}}});return v==="identity"&&B&&X.push(new i.V(f.key,f.value,'missing required property "property"')),v==="identity"||s.stops||X.push(new i.V(f.key,f.value,'missing required property "stops"')),v==="exponential"&&m.expression&&!i.M(m)&&X.push(new i.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(V&&!i.N(m)?X.push(new i.V(f.key,f.value,"property functions not supported")):B&&!i.O(m)&&X.push(new i.V(f.key,f.value,"zoom functions not supported"))),v!=="categorical"&&!Y||s.property!==void 0||X.push(new i.V(f.key,f.value,'"property" property is required')),X;function J(ne){let he=[];const de=ne.value,pe=ne.key;if(!Array.isArray(de))return[new i.V(pe,de,`array expected, ${i.K(de)} found`)];if(de.length!==2)return[new i.V(pe,de,`array length 2 expected, length ${de.length} found`)];if(Y){if(!i.H(de[0]))return[new i.V(pe,de,`object expected, ${i.K(de[0])} found`)];const xe=de[0];if(xe.zoom===void 0)return[new i.V(pe,de,"object stop key must have zoom")];if(xe.value===void 0)return[new i.V(pe,de,"object stop key must have value")];const ge=i.J(xe.zoom);if(typeof ge!="number")return[new i.V(pe,xe.zoom,"stop zoom values must be numbers")];if(j&&j>ge)return[new i.V(pe,xe.zoom,"stop zoom values must appear in ascending order")];ge!==j&&(j=ge,E=void 0,D={}),he=he.concat(Fr({key:`${pe}[0]`,value:de[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:ws,value:se}}))}else he=he.concat(se({key:`${pe}[0]`,value:de[0],style:ne.style,styleSpec:ne.styleSpec},de));return i.Q(i.S(de[1]))?he.concat([new i.V(`${pe}[1]`,de[1],"expressions are not allowed in function stops.")]):he.concat(qa({key:`${pe}[1]`,value:de[1],valueSpec:m,style:ne.style,styleSpec:ne.styleSpec}))}function se(ne,he){const de=i.K(ne.value),pe=i.J(ne.value),xe=ne.value!==null?ne.value:he;if(T){if(de!==T)return[new i.V(ne.key,xe,`${de} stop domain type must match previous stop domain type ${T}`)]}else T=de;if(de!=="number"&&de!=="string"&&de!=="boolean"&&typeof pe!="number"&&typeof pe!="string"&&typeof pe!="boolean")return[new i.V(ne.key,xe,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&v!=="categorical"){let ge=`number expected, ${de} found`;return i.N(m)&&v===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(ne.key,xe,ge)]}return v!=="categorical"||de!=="number"||typeof pe=="number"&&isFinite(pe)&&Math.floor(pe)===pe?v!=="categorical"&&de==="number"&&typeof pe=="number"&&typeof E=="number"&&E!==void 0&&pe<E?[new i.V(ne.key,xe,"stop domain values must appear in ascending order")]:(E=pe,v==="categorical"&&pe in D?[new i.V(ne.key,xe,"stop domain values must be unique")]:(D[pe]=!0,[])):[new i.V(ne.key,xe,`integer expected, found ${String(pe)}`)]}}function Vr(f){const t=(f.expressionContext==="property"?i.W:i.U)(i.S(f.value),f.valueSpec);if(t.result==="error")return t.value.map((m=>new i.V(`${f.key}${m.key}`,f.value,m.message)));const s=t.value.expression||t.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!s.outputDefined())return[new i.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!i.Z(s))return[new i.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Xo(s,f);if(f.expressionContext==="appearance")return Kr(s,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!i.X(s,["zoom","feature-state"]))return[new i.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!i.Y(s))return[new i.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xo(f,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const v of t.valueSpec.expression.parameters)s.delete(v);if(s.size===0)return[];const m=[];return f instanceof i._&&s.has(f.name)?[new i.V(t.key,t.value,`["${f.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(f.eachChild((v=>{m.push(...Xo(v,t))})),m)}function Kr(f,t){const s=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const v of t.valueSpec.expression.parameters)s.add(v);if(s.size===0)return[];const m=[];return f instanceof i._&&!s.has(f.name)?[new i.V(t.key,t.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild((v=>{m.push(...Kr(v,t))})),m)}function Qa(f){const t=f.key,s=f.value,m=f.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(i.J(s))===-1&&v.push(new i.V(t,s,`expected one of [${m.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(m.values).indexOf(i.J(s))===-1&&v.push(new i.V(t,s,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(s)} found`)),v}function us(f){return i.a2(i.S(f.value))?Vr(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):mr(f)}function mr(f){const t=f.value,s=f.key;if(!Array.isArray(t))return[new i.V(s,t,`array expected, ${i.K(t)} found`)];if(t.length<1)return[new i.V(s,t,"filter array must have at least 1 element")];const m=f.styleSpec;let v=Qa({key:`${s}[0]`,value:t[0],valueSpec:m.filter_operator});const T=()=>{t.length>=2&&(i.a0(t[1])||v.push(new i.V(`${s}[1]`,t[1],`string expected, ${i.K(t[1])} found`)));for(let E=2;E<t.length;E++)i.J(t[1])==="$type"?v=v.concat(Qa({key:`${s}[${E}]`,value:t[E],valueSpec:m.geometry_type})):i.a0(t[E])||i.L(t[E])||i.$(t[E])||v.push(new i.V(`${s}[${E}]`,t[E],`string, number, or boolean expected, ${i.K(t[E])} found.`))};switch(i.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&i.J(t[1])==="$type"&&v.push(new i.V(s,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&v.push(new i.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`)),T();break;case"==":case"!=":t.length!==3&&v.push(new i.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`)),T();break;case"in":case"!in":T();break;case"any":case"all":case"none":for(let E=1;E<t.length;E++)v=v.concat(mr({key:`${s}[${E}]`,value:t[E],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":t.length!==2?v.push(new i.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):i.a0(t[1])||v.push(new i.V(`${s}[1]`,t[1],`string expected, ${i.K(t[1])} found`))}return v}function ul(f,t){const s=f.key,m=f.style,v=f.layer,T=f.styleSpec,E=f.value,j=f.objectKey,D=T[`${t}_${f.layerType}`];if(!D)return[];const B=j.match(/^(.*)-use-theme$/);if(B&&D[B[1]])return i.Q(i.S(E))?[].concat(qa({key:s,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:m,styleSpec:T,expressionContext:"property",propertyType:t,propertyKey:j})):qa({key:s,value:E,valueSpec:{type:"string"},style:m,styleSpec:T});const V=j.match(/^(.*)-transition$/);if(t==="paint"&&V&&D[V[1]]&&D[V[1]].transition)return qa({key:s,value:E,valueSpec:T.transition,style:m,styleSpec:T});const Y=f.valueSpec||D[j];if(!Y)return[new i.a3(s,E,`unknown property "${j}"`)];let X;if(i.a0(E)&&i.N(Y)&&!Y.tokens&&(X=/^{([^}]+)}$/.exec(E))){const se=`\`{ "type": "identity", "property": ${X?JSON.stringify(X[1]):'"_"'} }\``;return[new i.V(s,E,`"${j}" does not support interpolation syntax
Use an identity property function instead: ${se}.`)]}const J=[];if(f.layerType==="symbol")j!=="text-field"||!m||m.glyphs||m.imports||J.push(new i.V(s,E,'use of "text-field" requires a style "glyphs" property')),j==="text-font"&&i.a4(i.S(E))&&i.J(E.type)==="identity"&&J.push(new i.V(s,E,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&t==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&i.N(Y)&&(i.a5(Y)||i.O(Y))){const se=i.W(i.S(E),Y).value,ne="expression"in se&&se.expression||"_styleExpression"in se&&se._styleExpression&&se._styleExpression.expression;ne&&!i.X(ne,["measure-light"])&&(j==="model-emissive-strength"&&i.Y(ne)&&i.Z(ne)||J.push(new i.V(s,E,`${j} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return J.concat(qa({key:f.key,value:E,valueSpec:Y,style:m,styleSpec:T,expressionContext:"property",propertyType:t,propertyKey:j}))}function Jl(f){return ul(f,"paint")}function Hs(f){return ul(f,"layout")}function Yo(f){let t=[];const s=f.value,m=f.key,v=f.style,T=f.styleSpec;if(!i.H(s))return[new i.V(m,s,"object expected")];s.type||s.ref||t.push(new i.V(m,s,'either "type" or "ref" is required'));let E=i.J(s.type);const j=i.J(s.ref);if(s.id){const D=i.J(s.id);for(let B=0;B<f.arrayIndex;B++){const V=v.layers[B];i.J(V.id)===D&&t.push(new i.V(m,s.id,`duplicate layer id "${D}", previously used at line ${V.id.__line__}`))}}if("ref"in s){let D;["type","source","source-layer","filter","layout"].forEach((B=>{B in s&&t.push(new i.V(m,s[B],`"${B}" is prohibited for ref layers`))})),v.layers.forEach((B=>{i.J(B.id)===j&&(D=B)})),D?D.ref?t.push(new i.V(m,s.ref,"ref cannot reference another ref layer")):E=i.J(D.type):typeof j=="string"&&t.push(new i.V(m,s.ref,`ref layer "${j}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(s.source)if(i.a0(s.source)){const D=v.sources&&v.sources[s.source],B=D&&i.J(D.type);D?B==="vector"&&E==="raster"?t.push(new i.V(m,s.source,`layer "${s.id}" requires a raster source`)):B==="raster"&&E!=="raster"?t.push(new i.V(m,s.source,`layer "${s.id}" requires a vector source`)):B!=="vector"||s["source-layer"]?B==="raster-dem"&&E!=="hillshade"?t.push(new i.V(m,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):B!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&s.paint&&(s.paint["line-gradient"]||s.paint["line-trim-offset"])&&B==="geojson"&&!D.lineMetrics?t.push(new i.V(m,s,`layer "${s.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&B!=="raster-array"&&t.push(new i.V(m,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new i.V(m,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new i.V(m,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new i.V(m,s.source,`source "${s.source}" not found`))}else t.push(new i.V(`${m}.source`,s.source,'"source" must be a string'));else t.push(new i.V(m,s,'missing required property "source"'));return t=t.concat(Fr({key:m,value:s,valueSpec:T.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>qa({key:`${m}.type`,value:s.type,valueSpec:T.layer.type,style:f.style,styleSpec:f.styleSpec,object:s,objectKey:"type"}),filter:D=>us(Object.assign({layerType:E},D)),layout:D=>Fr({layer:s,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":B=>Hs(Object.assign({layerType:E},B))}}),paint:D=>Fr({layer:s,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":B=>Jl(Object.assign({layerType:E,layer:s},B))}}),appearances(D){const B=$s({key:D.key,value:D.value,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:X=>(function(J){const{key:se,layer:ne,layerType:he}=J,de=i.J(J.value),pe=i.J(de.name),xe=i.J(de.condition),ge=Fr({key:se,value:de,valueSpec:J.styleSpec.appearance,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{condition:je=>(function(Ae){const De=[];return De.push(...Vr({key:Ae.key,value:Ae.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),De})(Object.assign({layer:ne,layerType:he},je)),properties:je=>(function(Ae){const De=[],{styleSpec:ze,layer:Me,layerType:Ve}=Ae,it=ze[`paint_${Ve}`],Ye=ze[`layout_${Ve}`],dt=Ae.object[Ae.objectKey];for(const mt in dt){const Tt=mt in it?"paint":mt in Ye?"layout":void 0;if(!Tt){De.push(new i.V(Ae.key,mt,`unknown property "${mt}" for layer type "${Ve}"`));continue}const Ot=Object.assign({},Ae,{key:`${Ae.key}.${mt}`,object:dt,objectKey:mt,layer:Me,layerType:Ve,value:dt[mt],valueSpec:Tt==="paint"?it[mt]:Ye[mt]});De.push(...ul(Ot,Tt))}return De})(Object.assign({layer:ne,layerType:he},je))}});return pe!=="hidden"&&xe===void 0&&ge.push(new i.V(J.key,"name",'Appearance with name different than "hidden" must have a condition')),ge})(Object.assign({layerType:E,layer:s},X))}),V=Array.isArray(D.value)?D.value:[],Y=new Set;return V.forEach(((X,J)=>{const se=i.J(X.name);if(se)if(Y.has(se)){const ne=i.J(s.id);B.push(new i.V(D.key,se,`Duplicated appearance name "${se}" for layer "${ne}"`))}else Y.add(se)})),B}}})),t}function yr({key:f,value:t}){return i.a0(t)?[]:[new i.V(f,t,`string expected, ${i.K(t)} found`)]}const zr={promoteId:function f({key:t,value:s}){if(i.a0(s))return yr({key:t,value:s});if(Array.isArray(s)){const v=[],T=i.S(s),E=i.U(T);return E.result==="error"&&E.value.forEach((j=>{v.push(new i.V(`${t}${j.key}`,null,`${j.message}`))})),i.X(E.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||v.push(new i.V(`${t}`,null,"promoteId expression should be only feature dependent")),v}if(!i.H(s))return[new i.V(t,s,`string, expression or object expected, "${i.K(s)}" found`)];const m=[];for(const v in s)m.push(...f({key:`${t}.${v}`,value:s[v]}));return m}};function Ql(f){const t=f.value,s=f.key,m=f.styleSpec,v=f.style;if(!i.H(t))return[new i.V(s,t,`object expected, ${i.K(t)} found`)];if(!("type"in t))return[new i.V(s,t,'"type" is required')];const T=i.J(t.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&("url"in t||"tiles"in t||E.push(new i.a3(s,t,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Fr({key:s,value:t,valueSpec:m[`source_${T.replace("-","_")}`],style:f.style,styleSpec:m,objectElementValidators:zr})),E;case"geojson":if(E=Fr({key:s,value:t,valueSpec:m.source_geojson,style:v,styleSpec:m,objectElementValidators:zr}),"cluster"in t&&"clusterProperties"in t){if(!i.H(t.clusterProperties))return[new i.V(`${s}.clusterProperties`,t,`object expected, ${i.K(t)} found`)];for(const j in t.clusterProperties){const D=t.clusterProperties[j];if(!Array.isArray(D))return[new i.V(`${s}.clusterProperties.${j}`,D,"array expected")];const[B,V]=D,Y=typeof B=="string"?[B,["accumulated"],["get",j]]:B;E.push(...Vr({key:`${s}.${j}.map`,value:V,expressionContext:"cluster-map"})),E.push(...Vr({key:`${s}.${j}.reduce`,value:Y,expressionContext:"cluster-reduce"}))}}return E;case"video":return Fr({key:s,value:t,valueSpec:m.source_video,style:v,styleSpec:m});case"image":return Fr({key:s,value:t,valueSpec:m.source_image,style:v,styleSpec:m});case"canvas":return[new i.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qa({key:`${s}.type`,value:t.type,valueSpec:{values:Ss(m)}})}}function Ss(f){return f.source.reduce(((t,s)=>{const m=f[s];return m.type.type==="enum"&&(t=t.concat(Object.keys(m.type.values||{}))),t}),[])}function mo(f){const t=f.value,s=f.styleSpec,m=s.light,v=f.style;if(t===void 0)return[];if(!i.H(t))return[new i.V("light",t,`object expected, ${i.K(t)} found`)];let T=[];for(const E in t){const j=E.match(/^(.*)-transition$/),D=E.match(/^(.*)-use-theme$/);T=T.concat(D&&m[D[1]]?qa({key:E,value:t[E],valueSpec:{type:"string"},style:v,styleSpec:s}):j&&m[j[1]]&&m[j[1]].transition?qa({key:E,value:t[E],valueSpec:s.transition,style:v,styleSpec:s}):m[E]?qa({key:E,value:t[E],valueSpec:m[E],style:v,styleSpec:s}):[new i.V(E,t[E],`unknown property "${E}"`)])}return T}function Ko(f){const t=f.value;if(!t)return[];const s=f.key;if(!i.H(t))return[new i.V(s,t,`object expected, ${i.K(t)} found`)];let m=[];const v=f.styleSpec,T=v["light-3d"],E=f.style,j=f.style.lights;for(const V of["type","id"])if(!(V in t))return m=m.concat([new i.V(s,t,`missing property "${V}"`)]),m;if(!i.a0(t.type))return m=m.concat([new i.V(`${s}.type`,t.type,"string expected")]),m;if(j)for(let V=0;V<f.arrayIndex;V++){const Y=i.J(t.type),X=j[V];i.J(X.type)===Y&&m.push(new i.V(s,t.id,`duplicate light type "${t.type}", previously defined at line ${X.id.__line__}`))}const D=`properties_light_${t.type}`;if(!(D in v))return m=m.concat([new i.V(`${s}.type`,t,`Invalid light type ${t.type}`)]),m;const B=v[D];for(const V in t)if(V==="properties"){const Y=t[V];if(!i.H(Y))return m=m.concat([new i.V("properties",Y,`object expected, ${i.K(Y)} found`)]),m;for(const X in Y){const J=X.match(/^(.*)-transition$/),se=X.match(/^(.*)-use-theme$/);m=m.concat(se&&B[se[1]]?qa({key:V,value:Y[X],valueSpec:{type:"string"},style:E,styleSpec:v}):J&&B[J[1]]&&B[J[1]].transition?qa({key:V,value:t[V],valueSpec:v.transition,style:E,styleSpec:v}):B[X]?qa({key:X,value:Y[X],valueSpec:B[X],style:E,styleSpec:v}):[new i.a3(f.key,Y[X],`unknown property "${X}"`)])}}else m=m.concat(T[V]?qa({key:V,value:t[V],valueSpec:T[V],style:E,styleSpec:v}):[new i.a3(V,t[V],`unknown property "${V}"`)]);return m}function Gs(f){const t=f.value,s=f.key,m=f.style,v=f.styleSpec,T=v.terrain;if(t==null)return[];if(!i.H(t))return[new i.V("terrain",t,`object expected, ${i.K(t)} found`)];let E=[];for(const j in t){const D=j.match(/^(.*)-transition$/),B=j.match(/^(.*)-use-theme$/);E=E.concat(B&&T[B[1]]?qa({key:j,value:t[j],valueSpec:{type:"string"},style:m,styleSpec:v}):D&&T[D[1]]&&T[D[1]].transition?qa({key:j,value:t[j],valueSpec:v.transition,style:m,styleSpec:v}):T[j]?qa({key:j,value:t[j],valueSpec:T[j],style:m,styleSpec:v}):[new i.a3(j,t[j],`unknown property "${j}"`)])}if(t.source)if(i.a0(t.source)){const j=m.sources&&m.sources[t.source],D=j&&i.J(j.type);j?D!=="raster-dem"&&E.push(new i.V(`${s}.source`,t.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):E.push(new i.V(`${s}.source`,t.source,`source "${t.source}" not found`))}else E.push(new i.V(`${s}.source`,t.source,"source must be a string"));else E.push(new i.V(s,t,'terrain is missing required property "source"'));return E}function ec(f){const t=f.value,s=f.style,m=f.styleSpec,v=m.fog;if(t===void 0)return[];if(!i.H(t))return[new i.V("fog",t,`object expected, ${i.K(t)} found`)];let T=[];for(const E in t){const j=E.match(/^(.*)-transition$/),D=E.match(/^(.*)-use-theme$/);T=T.concat(D&&v[D[1]]?qa({key:E,value:t[E],valueSpec:{type:"string"},style:s,styleSpec:m}):j&&v[j[1]]&&v[j[1]].transition?qa({key:E,value:t[E],valueSpec:m.transition,style:s,styleSpec:m}):v[E]?qa({key:E,value:t[E],valueSpec:v[E],style:s,styleSpec:m}):[new i.a3(E,t[E],`unknown property "${E}"`)])}return T}const po={"*":()=>[],array:$s,boolean:function(f){const t=f.value,s=f.key;return i.$(t)?[]:[new i.V(s,t,`boolean expected, ${i.K(t)} found`)]},number:ws,color:function({key:f,value:t}){return i.a0(t)?i.a1.parseCSSColor(t)===null?[new i.V(f,t,`color expected, "${t}" found`)]:[]:[new i.V(f,t,`color expected, ${i.K(t)} found`)]},enum:Qa,filter:us,function:Vs,layer:Yo,object:Fr,source:Ql,model:i.a7,light:mo,"light-3d":Ko,terrain:Gs,fog:ec,string:yr,formatted:function(f){return yr(f).length===0?[]:Vr(f)},resolvedImage:function(f){return yr(f).length===0?[]:Vr(f)},projection:function(f){const t=f.value,s=f.styleSpec,m=s.projection,v=f.style;if(i.H(t)){let T=[];for(const E in t)T=T.concat(qa({key:E,value:t[E],valueSpec:m[E],style:v,styleSpec:s}));return T}return i.a0(t)?[]:[new i.V("projection",t,`object or string expected, ${i.K(t)} found`)]},import:function(f){const t=f.key,{value:s,styleSpec:m}=f;if(!i.H(s))return[new i.V(t,s,"import must be an object")];const{data:v,...T}=s;Object.defineProperty(T,"__line__",{value:s.__line__,enumerable:!1});let E=Fr(Object.assign({},f,{value:T,valueSpec:m.import}));return i.J(T.id)===""&&E.push(new i.V(`${f.key}.id`,T,"import id can't be an empty string")),v&&(E=E.concat(jo(v,m,{key:`${f.key}.data`}))),E},iconset:function(f){const t=f.value,s=f.key,m=f.styleSpec,v=f.style;if(!i.H(t))return[new i.V(s,t,"object expected")];if(!t.type)return[new i.V(s,t,'"type" is required')];const T=i.J(t.type);let E=[];if(E=E.concat(Fr({key:s,value:t,valueSpec:m[`iconset_${T}`],style:v,styleSpec:m})),(function(j,D){return!(j!=="source"||!D.source)})(T,t)){const j=v.sources&&v.sources[t.source],D=j&&i.J(j.type);j?D!=="raster-array"&&E.push(new i.V(s,t.source,`iconset cannot be used with a source of type ${String(D)}, it only be used with a "raster-array" source type`)):E.push(new i.V(s,t.source,`source "${t.source}" not found`))}return E}};function qa(f,t=!1){const s=f.value,m=f.valueSpec,v=f.styleSpec;if(m.expression){if(i.a4(i.J(s)))return Vs(f);if(i.Q(i.S(s)))return Vr(f)}if(m.type&&po[m.type]){const T=po[m.type](f);return t===!0&&T.length>0&&Array.isArray(f.value)?Vr(f):T}return Fr(Object.assign({},f,{valueSpec:m.type?v[m.type]:m}))}function Fr(f){const t=f.key,s=f.value,m=f.valueSpec||{},v=f.objectElementValidators||{},T=f.style,E=f.styleSpec;if(!i.H(s))return[new i.V(t,s,`object expected, ${i.K(s)} found`)];let j=[];for(const D in s){const B=D.split(".")[0];let V;v[B]?V=v[B]:m[B]?V=qa:v["*"]?V=v["*"]:m["*"]&&(V=qa),V?j=j.concat(V({key:(t&&`${t}.`)+D,value:s[D],valueSpec:m[B]||m["*"],style:T,styleSpec:E,object:s,objectKey:D},s)):j.push(new i.a3(t,s[D],`unknown property "${D}"`))}for(const D in m){if(v[D])continue;const B=m[D];B.required&&B.default===void 0&&s[D]===void 0&&j.push(new i.V(t,s,`missing required property "${D}"`))}return j}function tc({key:f,value:t}){const s=yr({key:f,value:t});if(s.length)return s;const m=t;return m.indexOf("{fontstack}")===-1&&s.push(new i.V(f,t,'"glyphs" url must include a "{fontstack}" token')),m.indexOf("{range}")===-1&&s.push(new i.V(f,t,'"glyphs" url must include a "{range}" token')),s}function jo(f,t=i.a6,s={}){return Fr({key:s.key||"",value:f,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:f,objectElementValidators:{glyphs:tc}})}function go(f,t=i.a6){return ue(jo(f,t))}const wu=f=>ue(Ql(f)),Pe=f=>ue(mo(f)),zt=f=>ue(Ko(f)),Qt=f=>ue(Gs(f)),Ei=f=>ue(ec(f)),ui=f=>ue((function(t){const s=t.value,m=t.style,v=t.styleSpec,T=v.snow;if(s===void 0)return[];if(!i.H(s))return[new i.V("snow",s,`object expected, ${i.K(s)} found`)];let E=[];for(const j in s){const D=j.match(/^(.*)-transition$/);E=E.concat(D&&T[D[1]]&&T[D[1]].transition?qa({key:j,value:s[j],valueSpec:v.transition,style:m,styleSpec:v}):T[j]?qa({key:j,value:s[j],valueSpec:T[j],style:m,styleSpec:v}):[new i.a3(j,s[j],`unknown property "${j}"`)])}return E})(f)),qi=f=>ue((function(t){const s=t.value,m=t.style,v=t.styleSpec,T=v.rain;if(s===void 0)return[];if(!i.H(s))return[new i.V("rain",s,`object expected, ${i.K(s)} found`)];let E=[];for(const j in s){const D=j.match(/^(.*)-transition$/);E=E.concat(D&&T[D[1]]&&T[D[1]].transition?qa({key:j,value:s[j],valueSpec:v.transition,style:m,styleSpec:v}):T[j]?qa({key:j,value:s[j],valueSpec:T[j],style:m,styleSpec:v}):[new i.a3(j,s[j],`unknown property "${j}"`)])}return E})(f)),Si=f=>ue(Yo(f)),pn=f=>ue(us(f)),kn=f=>ue(Jl(f)),Ze=f=>ue(Hs(f)),ie=f=>ue(i.a7(f));function ue(f){return f.slice().sort(((t,s)=>t.line&&s.line?t.line-s.line:0))}function Te(f,t){let s=!1;if(t&&t.length)for(const m of t)m instanceof i.a3?i.w(m.message):(f.fire(new i.y(new Error(m.message))),s=!0);return s}const Fe=i.a6.light;let Be;class qe extends i.E{constructor(t,s="flat"){super(),this._transitionable=new i.a8(Be||(Be=new i.a9({anchor:new i.aa(Fe.anchor),position:new i.ab(Fe.position),color:new i.aa(Fe.color),intensity:new i.aa(Fe.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,m={}){this._validate(Pe,t,m)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,m){return(!m||m.validate!==!1)&&Te(this,t.call(go,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const rt=i.a6.terrain;let Je=class extends i.E{constructor(f,t,s,m,v){super(),this.scope=s,this._transitionable=new i.a8(new i.a9({source:new i.aa(rt.source),exaggeration:new i.aa(rt.exaggeration)}),s,m),this._transitionable.setTransitionOrValue(f,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=v}get(){return this._transitionable.serialize()}set(f,t){this._transitionable.setTransitionOrValue(f,t)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new i.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const t=f.value.expression;if(!t)return null;let s=-1,m=-1,v=1;for(const T of t.zoomStops)v=t.evaluate(new i.ac(T,{worldview:this.worldview})),v>.01?(s=T,m=-1):m=T;return v<.01&&s>0&&m>s?[s,m]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof i.ad}};const ot=45,Rt=65,St=.05;function ci(f,t,s,m){const v=i.ah(ot,Rt,s),[T,E]=Oi(f,m);let j=1-Math.min(1,Math.exp((t-T)/(E-T)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*v*f.alpha}function Oi(f,t){const s=.5/Math.tan(.5*t);return[f.range[0]+s,f.range[1]+s]}function mi(f,t,s,m,v){const T=i.af([],[t,s,m],v.mercatorFogMatrix);return ci(f,i.ag(T),v.pitch,v._fov)}function tn(f,t,s,m,v,T,E){const j=[[s,m,0],[v,m,0],[v,T,0],[s,T,0]];let D=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(const V of j){const Y=i.af([],V,t),X=i.ag(Y);D=Math.min(D,X),B=Math.max(B,X)}return[ci(f,D,E.pitch,E._fov),ci(f,B,E.pitch,E._fov)]}const rn=i.a6.fog;class Zi extends i.E{constructor(t,s,m,v){super();const T=new i.a9({range:new i.aa(rn.range),color:new i.aa(rn.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(rn["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(rn["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(rn["horizon-blend"]),"star-intensity":new i.aa(rn["star-intensity"]),"vertical-range":new i.aa(rn["vertical-range"])});this._transitionable=new i.a8(T,m,new Map(v)),this.set(t,v),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new i.ai(T),this.scope=m}get state(){const t=this._transform,s=t.projection.name==="globe",m=i.aj(t.zoom),v=this.properties.get("range"),T=[.5,3];return{range:s?[i.ak(T[0],v[0],m),i.ak(T[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,m={}){if(this._validate(Ei,t,m))return;const v=Object.assign({},t);for(const T of Object.keys(rn))v[T]===void 0&&(v[T]=rn[T].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(ot,Rt,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?(function(m,v,T){const E=i.ae.fromLngLat(v),j=T.elevation?T.elevation.getAtPointOrZero(E):0;return mi(m,E.x,E.y,j,T)})(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return tn(this.state,s,0,0,i.al,i.al,this._transform)}getOpacityForBounds(t,s,m,v,T){return this._transform.projection.supportsFog?tn(this.state,t,s,m,v,T,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Oi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const m of s){const v=t.points[m];let T;if(v[2]>=0)T=v;else{const E=t.points[m-4];T=i.am(E,v,E[2]/(E[2]-v[2]))}if(mi(this.state,T[0],T[1],0,this._transform)>=St)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,m){return(!m||m.validate!==!1)&&Te(this,t.call(go,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let Ui,$n,Ia,Ta,Yn=class extends i.E{constructor(f,t,s,m){super();const v=Ui||(Ui=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(v,s,new Map(m)),this.set(f,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(v),this.scope=s}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),m=i.an(s[0]),v=-Math.max(i.an(s[1]),.01),T=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],E=this.properties.get("vignette"),j=this.properties.get("vignette-color");return j.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(t.r,t.g,t.b,t.a*f),direction:T,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:j}}get(){return this._transitionable.serialize()}set(f,t,s={}){if(this._validate(ui,f,s))return;const m=Object.assign({},f),v=i.a6.snow;for(const T of Object.keys(v))m[T]===void 0&&(m[T]=v[T].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,s){return(!s||s.validate!==!1)&&Te(this,f.call(go,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},fn=class extends i.E{constructor(f,t,s,m){super();const v=$n||($n=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(v,s,new Map(m)),this.set(f,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(v),this.scope=s}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),m=i.an(s[0]),v=-Math.max(i.an(s[1]),.01),T=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(t.r,t.g,t.b,t.a*f),direction:T,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(f,t,s={}){if(this._validate(qi,f,s))return;const m=Object.assign({},f),v=i.a6.rain;for(const T of Object.keys(v))m[T]===void 0&&(m[T]=v[T].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,s){return(!s||s.validate!==!1)&&Te(this,f.call(go,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class an extends i.E{constructor(t,s,m,v){super(),this.scope=m,this._options=t,this.properties=new i.ai(s),this._transitionable=new i.a8(s,m,new Map(v)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ea{constructor(t,s,m){this.screenBounds=t,this.cameraPoint=m.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=s,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(t,s){let m,v;if(t instanceof i.P||typeof t[0]=="number"){const T=i.P.convert(t);m=[T],v=s.isPointAboveHorizon(T)}else{const T=i.P.convert(t[0]),E=i.P.convert(t[1]),j=T.add(E)._div(2);m=[T,E],v=i.aq(T,E).every((D=>s.isPointAboveHorizon(D)))&&s.isPointAboveHorizon(j)}return new ea(m,v,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.aq(s,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(v[3]=this.cameraPoint)),i.ar(v,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.aq(s,m,t),T=this.cameraPoint.clone();switch(3*((T.y>s.y)+(T.y>m.y))+((T.x>s.x)+(T.x>m.x))){case 0:v[0]=T,v[4]=T.clone();break;case 1:v.splice(1,0,T);break;case 2:v[1]=T;break;case 3:v.splice(4,0,T);break;case 5:v.splice(2,0,T);break;case 6:v[3]=T;break;case 7:v.splice(3,0,T);break;case 8:v[2]=T}return v}containsTile(t,s,m,v=0){const T=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/s._pixelsPerMercatorPixel+1,E=m?this._bufferedCameraMercator(T,s):this._bufferedScreenMercator(T,s);let j=t.tileID.wrap+(E.unwrapped?v:0);const D=E.polygon.map((he=>i.as(t.tileTransform,he,j)));if(!i.at(D,0,0,i.al,i.al))return;j=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const B=this.screenGeometryMercator.polygon.map((he=>i.au(t.tileTransform,he,j))),V=B.map((he=>new i.P(he[0],he[1]))),Y=s.getFreeCameraOptions().position||new i.ae(0,0,0),X=i.au(t.tileTransform,Y,j),J=B.map((he=>{const de=i.av(he,he,X);return i.aw(de,de),new i.ax(X,de)})),se=i.ay(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:V,tilespaceRays:J,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(ne=i.az(D),ne.min.x=i.aA(ne.min.x,0,i.al),ne.min.y=i.aA(ne.min.y,0,i.al),ne.max.x=i.aA(ne.max.x,0,i.al),ne.max.y=i.aA(ne.max.y,0,i.al),ne),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:se};var ne}_bufferedScreenMercator(t,s){const m=Wa(t);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map((T=>s.pointCoordinate3D(T))),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(t,s){const m=Wa(t);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map((T=>s.pointCoordinate3D(T))),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(t,s){const m=(function(T,E){const j=i.aB([],E.pixelMatrix,E.globeMatrix),D=[0,-i.aD,0,1],B=[0,i.aD,0,1],V=[0,0,0,1];i.aC(D,D,j),i.aC(B,B,j),i.aC(V,V,j);const Y=new i.P(D[0]/D[3],D[1]/D[3]),X=new i.P(B[0]/B[3],B[1]/B[3]),J=i.aE(T,Y)&&D[3]<V[3],se=i.aE(T,X)&&B[3]<V[3];if(!J&&!se)return null;const ne=(function(De,ze,Me){for(let Ve=1;Ve<De.length;Ve++){const it=Sn(ze.pointCoordinate3D(De[Ve-1]).x),Ye=Sn(ze.pointCoordinate3D(De[Ve]).x);if(Me<0){if(it<Ye)return{idx:Ve,t:-it/(Ye-1-it)}}else if(Ye<it)return{idx:Ve,t:(1-it)/(Ye+1-it)}}return null})(T,E,J?-1:1);if(!ne)return null;const{idx:he,t:de}=ne;let pe=he>1?ra(T.slice(0,he),E):[],xe=he<T.length?ra(T.slice(he),E):[];pe=pe.map((De=>new i.P(Sn(De.x),De.y))),xe=xe.map((De=>new i.P(Sn(De.x),De.y)));const ge=[...pe];ge.length===0&&ge.push(xe[xe.length-1]);const je=i.ak(ge[ge.length-1].y,(xe.length===0?pe[0]:xe[0]).y,de);let Ae;return Ae=J?[new i.P(0,je),new i.P(0,0),new i.P(1,0),new i.P(1,je)]:[new i.P(1,je),new i.P(1,1),new i.P(0,1),new i.P(0,je)],ge.push(...Ae),xe.length===0?ge.push(pe[0]):ge.push(...xe),{polygon:ge.map((De=>new i.ae(De.x,De.y))),unwrapped:!1}})(t,s);if(m)return m;const v=(function(T,E){let j=!1,D=-1/0,B=0;for(let Y=0;Y<T.length-1;Y++)T[Y].x>D&&(D=T[Y].x,B=Y);for(let Y=0;Y<T.length-1;Y++){const X=(B+Y)%(T.length-1),J=T[X],se=T[X+1];Math.abs(J.x-se.x)>.5&&(J.x<se.x?(J.x+=1,X===0&&(T[T.length-1].x+=1)):(se.x+=1,X+1===T.length-1&&(T[0].x+=1)),j=!0)}const V=i.aF(E.center.lng);return j&&V<Math.abs(V-1)&&T.forEach((Y=>{Y.x-=1})),{polygon:T,unwrapped:j}})(ra(t,s).map((T=>new i.P(Sn(T.x),T.y))),s);return{polygon:v.polygon.map((T=>new i.ae(T.x,T.y))),unwrapped:v.unwrapped}}}function ra(f,t){return i.aG(f,(s=>{const m=t.pointCoordinate3D(s);s.x=m.x,s.y=m.y}),1/256)}function Sn(f){return f<0?1+f%1:f%1}function Wa(f){return 100*f|0}function zn(f,t,s,m,v){const T=function(j,D){if(j)return v(j);if(D){if(f.url&&D.tiles&&f.tiles&&delete f.tiles,D.variants){if(!Array.isArray(D.variants))return v(new Error("variants must be an array"));for(const V of D.variants){if(V==null||typeof V!="object"||V.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(V.capabilities))return v(new Error("capabilities must be an array"));if(V.capabilities.length===1&&V.capabilities[0]==="meshopt"){D=Object.assign(D,V);break}}}const B=i.aH(Object.assign({},D,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);B.tiles=t.canonicalizeTileset(B,f.url),v(null,B)}},E=(function(j,D,B){if(!j)return null;if(!D&&!B)return j;B=B||j.worldview_default;const V=Object.values(j.language||{});if(V.length===0)return null;const Y=Object.values(j.worldview||{});if(Y.length===0)return null;const X=V.every((se=>se===D)),J=Y.every((se=>se===B));return X&&J?j:D in(j.language_options||{})||B in(j.worldview_options||{})?null:j.language_options&&j.worldview_options?j:null})(f.data,s,m);return E?i.o.frame((()=>T(null,E))):f.url?i.m(t.transformRequest(t.normalizeSourceURL(f.url,null,s,m),i.R.Source),T):i.o.frame((()=>{const{data:j,...D}=f;T(null,D)}))}function ka(f,t){const s=Math.pow(2,t.z),m=Math.floor(i.aF(f.getWest())*s),v=Math.floor(i.aJ(f.getNorth())*s),T=Math.ceil(i.aF(f.getEast())*s),E=Math.ceil(i.aJ(f.getSouth())*s);return t.x>=m&&t.x<T&&t.y>=v&&t.y<E}class qs{constructor(t,s,m){this.bounds=t?i.aI.convert(this.validateBounds(t)):null,this.minzoom=s||0,this.maxzoom=m||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const s of t)this.extraBounds.push(i.aI.convert(this.validateBounds(s)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!ka(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const s of this.extraBounds)if(ka(s,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const s=new qs(t.bounds,t.minzoom,t.maxzoom);return s.addExtraBounds(t.extra_bounds),s}}class rs extends i.E{constructor(t,s,m,v){if(super(),this.id=t,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(s,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new i.aK}load(t){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=zn(this._options,this.map._requestManager,s,m,((v,T)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new i.y(v));else if(T){if(Object.assign(this,T),this.hasWorldviews=!!T.worldview_options,T.worldview_default&&(this.worldviewDefault=T.worldview_default),T.vector_layers){this.vectorLayers=T.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of T.vector_layers)this.vectorLayerIds.push(E.id),T.worldview&&T.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=qs.fromTileJSON(T),Ct(T.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(v)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,s){const m=t.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(m),T=this.map._requestManager.transformRequest(v,i.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,j=E?{image:E.image.clone()}:null,D={request:T,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:j,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(m)&&(D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",D,B.bind(this));else if(t.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",D,B.bind(this),void 0,!0);else{const V=i.aL.call({deduped:this._deduped},D,((Y,X)=>{if(Y||!X)B.call(this,Y);else{const J=i.aM(X.responseHeaders);D.data={rawData:X.rawData.slice(0),expires:J.expires,cacheControl:J.cacheControl},t.actor&&t.actor.send("loadTile",D,B.bind(this),void 0,!0)}}),!0);t.request={cancel:V}}function B(V,Y){return delete t.request,t.aborted?s(null):V&&V instanceof i.aN&&V.status!==404?s(V):(Y&&Y.resourceTiming&&(t.resourceTiming=Y.resourceTiming),this.map._refreshExpiredTiles&&Y&&t.setExpiryData(Y),t.loadVectorData(Y,this.map.painter),i.aO(this.dispatcher),s(null,Y),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class er extends i.E{constructor(t,s,m,v){super(),this.id=t,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},s),Object.assign(this,i.aH(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const s=this.map.getWorldview();this._tileJSONRequest=zn(this._options,this.map._requestManager,null,s,((m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new i.y(m)):v&&(Object.assign(this,v),v.raster_layers&&(this.rasterLayers=v.raster_layers,this.rasterLayerIds=this.rasterLayers.map((T=>T.id))),this.tileBounds=qs.fromTileJSON(v),Ct(v.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(m)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const m=i.o.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);t.request=i.n(this.map._requestManager.transformRequest(v,i.R.Tile),((T,E,j)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(T)return t.state="errored",s(T);if(!E)return s(null);const D=i.aM(j);this.map._refreshExpiredTiles&&t.setExpiryData(D),t.setTexture(E,this.map.painter),t.state="loaded",i.aO(this.dispatcher),s(null)}))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof i.T?(t.destroy(!1),t.texture&&t.texture instanceof i.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function zo([f,t],s,m,{scaled:v=!0}={}){const{tileSize:T,buffer:E}=m,{x:j,y:D,z:B}=s;if(!isFinite(j)||!isFinite(D)||!isFinite(B))throw new Error("Invalid MRT header");const V=2**B,Y=V*i.aF(f),X=V*i.aJ(t);return(function([J,se],ne,{scaled:he=!0}={}){if(!ne)throw new Error("bandView is undefined");const{data:de,tileSize:pe,buffer:xe,offset:ge,scale:je,dimension:Ae}=ne;if(J<-xe||J>pe+xe||se<-xe||se>pe+xe)throw new Error(`Point (${J}, ${se}) out of bounds for tileSize=${pe}, buffer=${xe}`);const De=(se+xe)*(pe+2*xe)+(J+xe);if(new Uint32Array(de.buffer)[De]===4294967295)return null;let ze=[];ze=he?[]:new ne.data.constructor(Ae);for(let Me=0;Me<Ae;Me++)ze[Me]=Math.round(1e12*(de[Ae*De+Me]*je+ge))/1e12;return ze})([Math.min(Math.max(-E,Math.floor((Y-j)*T)),T-1+E),Math.min(Math.max(-E,Math.floor((X-D)*T)),T-1+E)],m,{scaled:v})}class Jr extends er{constructor(t,s,m,v){super(t,s,m,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);s&&s.enabled&&m&&s._clearRenderCacheForTile(m.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,i.R.Tile),T={request:v,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=v,t.actor||(t.actor=this.dispatcher.getActor());const E=(j,D,B)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(j)return j.name==="AbortError"?void 0:(t.state="errored",s(j));if(this.map._refreshExpiredTiles&&D){const V=i.aM(B);t.setExpiryData(V)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!D)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=D}s(null)};t.request=this.partial?t.fetchHeader(void 0,E.bind(this)):t.actor.send("loadTile",T,E.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const m=t.texturePerLayer;if(t.flushAllQueues(),m.size){t.destroy(!1);for(const v of m.values())this.map.painter.saveTileTexture(v)}else t.destroy()}prepareTile(t,s,m,v){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(s,m,v,((T,E)=>{if(T)return t.state="errored",this.fire(new i.y(T)),void this.triggerRepaint(t);E&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(m,E,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find((({id:T})=>T===t)),m=s&&s.fields,v=m&&m.bands&&m.bands;return v?v[0]:0}getTextureDescriptor(t,s,m){if(!t)return;const v=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let T=null;s instanceof i.aR?T=s.paint.get("raster-array-band"):s instanceof i.aS&&(T=s.paint.get("raster-particle-array-band"));const E=T||this.getInitialBand(v);if(E==null)return;if(!t.textureDescriptorPerLayer.get(s.id))return void this.prepareTile(t,v,s.id,E);if(t.updateNeeded(s.id,E)&&!m)return;const j=t.textureDescriptorPerLayer.get(s.id);return Object.assign({},j,{texture:t.texturePerLayer.get(s.id)})}getImages(t,s){const m=new Map;for(const v of t)for(const T of s){const[E,j]=T.split("/"),D=v.getLayer(E);if(!D||!D.hasBand(j)||!D.hasDataForBand(j))continue;const{bytes:B,tileSize:V,buffer:Y}=D.getBandView(j),X=V+2*Y,J={data:new i.q({width:X,height:X},B),pixelRatio:2,sdf:!1,usvg:!1,version:0};m.set(T,J)}return m}queryRasterArrayValueByBandId(t,s,m){const v=s._mrt;return new Promise((T=>{const E={},j=new Set;for(const[D,B]of Object.entries(v.layers)){if(m.layerName&&D!==m.layerName)continue;const V={};E[D]=V;for(const{bands:Y}of B.dataIndex)for(const X of Y)m.bands&&!m.bands.includes(X)||(j.add(i.B(D,X)),s.fetchBand(D,null,X,(J=>{i.o.frame((()=>{V[X]=J?null:zo([t.lng,t.lat],v,B.getBandView(X)),j.delete(i.B(D,X)),j.size===0&&T(E)}))}),!1))}j.size===0&&T(E)}))}_loadTileForQuery(t,s){if(this._loadTileLoaded[t.uid])return void s(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(s);this._loadTilePending[t.uid]=[s];const m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,i.R.Tile);t.actor.send("loadTile",{request:v,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((T,E,j)=>{if(T)return this._loadTilePending[t.uid].forEach((D=>D(T,null))),void delete this._loadTilePending[t.uid];if(!E)return this._loadTilePending[t.uid].forEach((D=>D(null,null))),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&E){const D=i.aM(j);t.setExpiryData(D)}t._mrt=E,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((D=>D(null,E))),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(t,s,m){return new Promise(((v,T)=>{this._loadTileForQuery(s,((E,j)=>{E?T(E):v(j?this.queryRasterArrayValueByBandId(t,s,m):null)}))}))}queryRasterArrayValue(t,s){const m=i.aT.convert(t),v=this.findLoadedParent(m);return v&&v._mrt?s.bands||!this.partial?this.queryRasterArrayValueByBandId(m,v,s):this.queryRasterArrayValueByAllBands(m,v,s):Promise.resolve(null)}findLoadedParent(t){const s=i.ae.fromLngLat(t,this.map.transform.tileSize),m=this.maxzoom+1,v=1<<m,T=Math.floor(s.x),E=Math.floor((s.x-T)*v),j=Math.floor(s.y*v),D=this.map.style.getSourceCache(this.id),B=new i.aQ(m,T,m,E,j);return D.findLoadedParent(B,this.minzoom)}}const ss={vector:rs,raster:er,"raster-dem":class extends er{constructor(f,t,s,m){super(f,t,s,m),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(f,t){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,T){v&&(f.state="errored",t(v)),T&&(f.dem=T,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",t(null))}f.request=i.n(this.map._requestManager.transformRequest(s,i.R.Tile),(function(v,T,E){if(delete f.request,f.aborted)f.state="unloaded",t(null);else if(v)f.state="errored",t(v);else if(T){const j=i.aM(E);this.map._refreshExpiredTiles&&f.setExpiryData(j);const D=ImageBitmap&&T instanceof ImageBitmap&&i.r(),B=1-(T.width-i.aP(T.width))/2;B<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const V=D?T:i.o.getImageData(T,B),Y={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:V,encoding:this.encoding,padding:B};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",Y,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const t=f.canonical,s=Math.pow(2,t.z),m=(t.x-1+s)%s,v=t.x===0?f.wrap-1:f.wrap,T=(t.x+1+s)%s,E=t.x+1===s?f.wrap+1:f.wrap,j={};return j[new i.aQ(f.overscaledZ,v,t.z,m,t.y).key]={backfilled:!1},j[new i.aQ(f.overscaledZ,E,t.z,T,t.y).key]={backfilled:!1},t.y>0&&(j[new i.aQ(f.overscaledZ,v,t.z,m,t.y-1).key]={backfilled:!1},j[new i.aQ(f.overscaledZ,f.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},j[new i.aQ(f.overscaledZ,E,t.z,T,t.y-1).key]={backfilled:!1}),t.y+1<s&&(j[new i.aQ(f.overscaledZ,v,t.z,m,t.y+1).key]={backfilled:!1},j[new i.aQ(f.overscaledZ,f.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},j[new i.aQ(f.overscaledZ,E,t.z,T,t.y+1).key]={backfilled:!1}),j}},"raster-array":Jr,geojson:class extends i.E{constructor(f,t,s,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(m),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const v=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*v,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*v,extent:i.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:i.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*v,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of f.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterChildren(f,t){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterLeaves(f,t,s,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:t,offset:s},m),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:f},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(i.o.resolveURL(s),i.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((m,v)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new i.y(m));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(T.resourceTiming=v.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new i.z("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const f=i.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,t){const s=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,v=m?{image:m.image.clone()}:null,T=this._partialReload,E={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:T,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};f.request=this.actor.send(s,E,((j,D)=>T&&!D?(f.state="loaded",t(null)):(delete f.request,f.destroy(!1),f.aborted?t(null):j?t(j):(f.loadVectorData(D,this.map.painter,s==="reloadTile"),t(null)))),void 0,s==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,t){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aU{constructor(f,t,s,m){super(f,t,s,m),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const t of f.urls)this.urls.push(this.map._requestManager.transformRequest(t,i.R.Source).url);i.aV(this.urls,((t,s)=>{this._loaded=!0,t?this.fire(new i.y(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const t=this.video.seekable;f<t.start(0)||f>t.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,t=f.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(f,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aU,model:i.aX,"batched-model":class extends i.E{constructor(f,t,s,m){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(f)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=zn(this._options,this.map._requestManager,t,s,((m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new i.y(m))):v&&(Object.assign(this,v),v.bounds&&(this.tileBounds=new qs(v.bounds,this.minzoom,this.maxzoom)),Ct(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(m)}))}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,t){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(s,i.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=t;else{if(f.buckets){const T=Object.values(f.buckets);for(const E of T)E.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",m,v.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",m,v.bind(this),void 0,!0);function v(T,E){return f.aborted?t(null):T&&T.status!==404?t(T):(this.map._refreshExpiredTiles&&E&&f.setExpiryData(E),f.loadModelData(E,this.map.painter),f.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aU{constructor(f,t,s,m){super(f,t,s,m),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((v=>!Array.isArray(v)||v.length!==2||v.some((T=>typeof T!="number"))))||this.fire(new i.y(new i.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${f}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof i.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends i.E{constructor(f,t,s,m){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new qs(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:t,y:s,z:m}=f.canonical;return this._implementation.hasTile({x:t,y:s,z:m})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,t){const{x:s,y:m,z:v}=f.tileID.canonical,T=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:s,y:m,z:v},{signal:T.signal})).then((function(E){return delete f.request,f.aborted?(f.state="unloaded",t(null)):E===void 0?(f.state="errored",t(null)):E===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",t(null)):(function(j){return j instanceof ImageData||j instanceof HTMLCanvasElement||j instanceof ImageBitmap||j instanceof HTMLImageElement})(E)?(this.loadTileData(f,E),f.state="loaded",void t(null)):(f.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((E=>{E.name!=="AbortError"&&(f.state="errored",t(E))})),f.request.cancel=()=>T.abort()}loadTileData(f,t){f.setTexture(t,this.map.painter)}unloadTile(f,t){if(f.texture&&f.texture instanceof i.T?(f.destroy(!1),f.texture&&f.texture instanceof i.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:s,y:m,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:s,y:m,z:v})}t&&t()}abortTile(f,t){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z})))}_clearTiles(){const f=i.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},xa=function(f,t,s,m){const v=new ss[t.type](f,t,s,m);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return i.aY(["load","abort","unload","serialize","prepare"],v),v};function Io(f,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${(function(m){if("layerId"in m)return`layer:${m.layerId}`;{const{featuresetId:v,importId:T}=m;return`featureset:${v}${T?`:import:${T}`:""}`}})(f.target)}`}function _o(f,t,s,m=""){if(f.uniqueFeatureID){const v=Io(f,t,m);if(s.has(v))return!0;s.add(v)}return!1}function Vc(f,t,s,m,v=!1){const T=t.sourceCache.transform,E=t.sourceCache.tilesIn(f,t.has3DLayers,v);E.sort(fc);const j=[];for(const D of E){const B=D.tile.queryRenderedFeatures(t,D,s,m,T,v);Object.keys(B).length&&j.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:B})}for(const D in t.layers){const B=t.layers[D];if(B.styleLayer){const V=B.styleLayer.queryRenderedFeatures(f,t.sourceCache,m);Object.keys(V).length&&j.push({wrappedTileID:0,queryResults:V})}}return j.length===0?{}:(function(D){const B={},V={};for(const Y of D){const X=Y.queryResults,J=Y.wrappedTileID,se=V[J]=V[J]||{};for(const ne in X){const he=X[ne],de=se[ne]=se[ne]||{},pe=B[ne]=B[ne]||[];for(const xe of he)de[xe.featureIndex]||(de[xe.featureIndex]=!0,pe.push(xe))}}return B})(j)}function Su(f,t,s,m,v,T){const E={},j=m.queryRenderedSymbols(f),D=[];for(const B of Object.keys(j).map(Number))D.push(v[B]);D.sort(fc);for(const B of D){const V=B.featureIndex.lookupSymbolFeatures(j[B.bucketInstanceId],B.bucketIndex,B.sourceLayerIndex,t,s,T);for(const Y in V){const X=E[Y]=E[Y]||[],J=V[Y];J.sort(((se,ne)=>{const he=B.featureSortOrder;if(he){const de=he.indexOf(se.featureIndex);return he.indexOf(ne.featureIndex)-de}return ne.featureIndex-se.featureIndex}));for(const se of J)X.push(se)}}return E}function hc(f,t){const s=f.getRenderableIds().map((T=>f.getTileByID(T))),m=[],v={};for(let T=0;T<s.length;T++){const E=s[T],j=E.tileID.canonical.key;v[j]||(v[j]=!0,E.querySourceFeatures(m,t))}return m}function fc(f,t){const s=f.tileID,m=t.tileID;return s.overscaledZ-m.overscaledZ||s.canonical.y-m.canonical.y||s.wrap-m.wrap||s.canonical.x-m.canonical.x}function dl(f,t){const s={};if(!t)return s;for(const m of f){const v=m.layerIds.map((T=>t.getLayer(T))).filter(Boolean);if(v.length!==0){m.layers=v,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map((T=>v.filter((E=>E.id===T))[0])));for(const T of v)s[T.fqid]=m}}return s}const Ps=32,io=33,yo=new Uint16Array(8184);for(let f=0;f<2046;f++){let t=f+2,s=0,m=0,v=0,T=0,E=0,j=0;for(1&t?v=T=E=Ps:s=m=j=Ps;(t>>=1)>1;){const B=s+v>>1,V=m+T>>1;1&t?(v=s,T=m,s=E,m=j):(s=v,m=T,v=E,T=j),E=B,j=V}const D=4*f;yo[D+0]=s,yo[D+1]=m,yo[D+2]=v,yo[D+3]=T}const Ws=new Uint16Array(2178),no=new Uint8Array(1089),vo=new Uint16Array(1089);function Hc(f){return f===0?-.03125:f===32?.03125:0}const sa={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class Zs{constructor(t,s,m,v,T,E){this.tileID=t,this.uid=i.b2(),this.uses=0,this.tileSize=s,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=T,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection),this.worldview=E,this._hasAppearances=null}registerFadeDuration(t){const s=t+this.timeAdded;s<i.o.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,m){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=dl(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const T=this.buckets[v];if(T instanceof i.b4){if(this.hasSymbolBuckets=!0,!m)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const T=this.buckets[v];if(T instanceof i.b4&&T.hasRTLText){this.hasRTLText=!0,i.b5();break}}this.queryPadding=0;for(const v in this.buckets){const T=this.buckets[v],E=s.style.getOwnLayer(v);if(!E)continue;const j=E.queryRadius(T);this.queryPadding=Math.max(this.queryPadding,j)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new i.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,m){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,dl(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,s){for(const T in this.buckets){const E=this.buckets[T];if(E.uploadPending()){let j={},D=[],B={zoom:0,pitch:0,brightness:0,worldview:""};if(s){if(s.style){D=s.style.listImages();const V=E.layers[0],Y=V.sourceLayer||"_geojsonTileLayer",X=s.style.getLayerSourceCache(V);X&&(j=X._state.getState(Y,void 0))}B={zoom:s.transform.zoom||0,pitch:s.transform.pitch||0,brightness:s.style.getBrightness()||0,worldview:s.worldview||""}}E.upload(t,this.tileID.canonical,j,D,B)}}const m=t.gl,v=this.imageAtlas;v&&!v.uploaded&&(this.imageAtlasTexture=new i.T(t,v.image,m.RGBA8,{useMipmap:!!v.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(t,this.glyphAtlasImage,m.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(t,this.lineAtlas.image,m.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,m),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=s.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(s)),(this._lastUpdatedBrightness||v||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const s in this.buckets){const m=this.buckets[s];m.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,m.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,s,m,v,T,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const j=this.evaluateQueryRenderedFeaturePadding(),D=(function(B,V){const Y=i.bq([],[.5*B.width,.5*-B.height,1]);return i.br(Y,Y,[1,-1,0]),i.aB(Y,Y,B.calculateProjMatrix(V.toUnwrapped())),Float32Array.from(Y)})(T,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:D,transform:v,availableImages:m,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:j})}querySourceFeatures(t,s){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const v=m.loadVTLayers(),T=s?s.sourceLayer:"",E=v._geojsonTileLayer||v[T];if(!E)return;const j=i.b6(s&&s.filter),{z:D,x:B,y:V}=this.tileID.canonical,Y={z:D,x:B,y:V};for(let X=0;X<E.length;X++){const J=E.feature(X);if(j.needGeometry){const he=i.b7(J,!0);if(!j.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),he,this.tileID.canonical))continue}else if(!j.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),J))continue;const se=m.getId(J,T),ne=new i.b8(J,D,B,V,se);ne.tile=Y,t.push(ne)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const m=i.b9(t.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const m=Date.now();let v=!1;if(this.expirationTime>m)v=!1;else if(s)if(this.expirationTime<s)v=!0;else{const T=this.expirationTime-s;T?this.expirationTime=m+Math.max(T,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const s in this.buckets)if(t.style.hasLayer(s)&&this.buckets[s].layers.some((m=>m.appearances&&m.appearances.length>0)))return!0;return!1}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const m=t.style.listImages(),v=t.style.getBrightness();for(const T in this.buckets){if(!t.style.hasLayer(T))continue;const E=this.buckets[T],j=E.layers[0],D=j.sourceLayer||"_geojsonTileLayer",B=t.style.getLayerSourceCache(j);let V={};B&&(V=B._state.getState(D,void 0));const Y=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},X=Object.keys(V).length>0&&!s;E.hasAppearances=E.layers.some((ne=>ne.appearances&&ne.appearances.length>0));const J=X?E.stateDependentLayers:E.layers;if(X&&E.stateDependentLayers.length!==0||s){const ne=this.latestFeatureIndex.loadVTLayers();E.update(V,ne[D],m,Y,J,s,v)}if(X&&E.stateDependentLayers.length!==0||s||E.hasAppearances){const ne={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};E.updateAppearances(this.tileID.canonical,V,m,ne)}(E instanceof i.ba||E instanceof i.bb)&&t._terrain&&t._terrain.enabled&&B&&E.uploadPending()&&t._terrain._clearRenderCacheForTile(B.id,this.tileID);const se=t&&t.style&&t.style.getOwnLayer(T);se&&(this.queryPadding=Math.max(this.queryPadding,se.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=i.o.now()+t}setTexture(t,s){const m=s.context,v=m.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t):(this.texture=new i.T(m,t,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(t,s){const m={};for(const v of s)m[v]=!0;this.dependencies[t]=m}hasDependency(t,s){for(const m of t){const v=this.dependencies[m];if(v){for(const T of s)if(v[T])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const m=i.bc(sa,this.tileID.canonical,this.tileTransform)[0],v=new i.bd,T=new i.be;for(let E=0;E<m.length;E++){const{x:j,y:D}=m[E];v.emplaceBack(j,D),T.emplaceBack(E)}T.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(T),this._tileDebugBuffer=t.createVertexBuffer(v,i.bf.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,v.length,T.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const m=i.bc(sa,this.tileID.canonical,this.tileTransform)[0];let v,T;if(this.isRaster){const E=(function(j,D){const B=i.aZ(j,D),V=Math.pow(2,j.z);for(let he=0;he<io;he++)for(let de=0;de<io;de++){const pe=i.a_((j.x+(de+Hc(de))/Ps)/V),xe=i.a$((j.y+(he+Hc(he))/Ps)/V),ge=D.project(pe,xe),je=he*io+de;Ws[2*je+0]=Math.round((ge.x*B.scale-B.x)*i.al),Ws[2*je+1]=Math.round((ge.y*B.scale-B.y)*i.al)}no.fill(0),vo.fill(0);for(let he=2045;he>=0;he--){const de=4*he,pe=yo[de+0],xe=yo[de+1],ge=yo[de+2],je=yo[de+3],Ae=pe+ge>>1,De=xe+je>>1,ze=Ae+De-xe,Me=De+pe-Ae,Ve=xe*io+pe,it=je*io+ge,Ye=De*io+Ae,dt=Math.hypot((Ws[2*Ve+0]+Ws[2*it+0])/2-Ws[2*Ye+0],(Ws[2*Ve+1]+Ws[2*it+1])/2-Ws[2*Ye+1])>=16;no[Ye]=no[Ye]||(dt?1:0),he<1022&&(no[Ye]=no[Ye]||no[(xe+Me>>1)*io+(pe+ze>>1)]||no[(je+Me>>1)*io+(ge+ze>>1)])}const Y=new i.b1,X=new i.b0;let J=0;function se(he,de){const pe=de*io+he;return vo[pe]===0&&(Y.emplaceBack(Ws[2*pe+0],Ws[2*pe+1],he*i.al/Ps,de*i.al/Ps),vo[pe]=++J),vo[pe]-1}function ne(he,de,pe,xe,ge,je){const Ae=he+pe>>1,De=de+xe>>1;if(Math.abs(he-ge)+Math.abs(de-je)>1&&no[De*io+Ae])ne(ge,je,he,de,Ae,De),ne(pe,xe,ge,je,Ae,De);else{const ze=se(he,de),Me=se(pe,xe),Ve=se(ge,je);X.emplaceBack(ze,Me,Ve)}}return ne(0,0,Ps,Ps,Ps,0),ne(Ps,Ps,0,0,0,Ps),{vertices:Y,indices:X}})(this.tileID.canonical,s);v=E.vertices,T=E.indices}else{v=new i.b1,T=new i.b0;for(const{x:j,y:D}of m)v.emplaceBack(j,D,0,0);const E=i.bh(v.int16.subarray(0,4*v.length),void 0,4);for(let j=0;j<E.length;j+=3)T.emplaceBack(E[j],E[j+1],E[j+2])}this._tileBoundsBuffer=t.createVertexBuffer(v,i.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(T),this._tileBoundsSegments=i.bg.simpleSegment(0,0,v.length,T.length)}_makeGlobeTileDebugBuffers(t,s){const m=s.projection;if(!m||m.name!=="globe"||s.freezeTileCoverage)return;const v=this.tileID.canonical,T=i.bj(v,s),E=i.bk(T),j=i.aj(s.zoom);let D;j>0&&(D=i.bl(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,v,s,E,D,j),this._makeGlobeTileDebugTextBuffer(t,v,s,E,D,j)}_globePoint(t,s,m,v,T,E,j){let D=i.bm(t,s,m);if(E){const B=1<<m.z,V=i.aF(v.center.lng),Y=i.aJ(v.center.lat),X=(m.x+.5)/B-V;let J=0;X>.5?J=-1:X<-.5&&(J=1);let se=(t/i.al+m.x)/B+J,ne=(s/i.al+m.y)/B;se=(se-V)*v._pixelsPerMercatorPixel+V,ne=(ne-Y)*v._pixelsPerMercatorPixel+Y;const he=[se*v.worldSize,ne*v.worldSize,0];i.af(he,he,E),D=i.bn(D,he,j)}return i.af(D,D,T)}_makeGlobeTileDebugBorderBuffer(t,s,m,v,T,E){const j=new i.bd,D=new i.be,B=new i.bo,V=(X,J,se,ne,he)=>{const de=(se-X)/(he-1),pe=(ne-J)/(he-1),xe=j.length;for(let ge=0;ge<he;ge++){const je=X+ge*de,Ae=J+ge*pe;j.emplaceBack(je,Ae);const De=this._globePoint(je,Ae,s,m,v,T,E);B.emplaceBack(De[0],De[1],De[2]),D.emplaceBack(xe+ge)}},Y=i.al;V(0,0,Y,0,16),V(Y,0,Y,Y,16),V(Y,Y,0,Y,16),V(0,Y,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(D),this._tileDebugBuffer=t.createVertexBuffer(j,i.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(B,i.bp.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,j.length,D.length)}_makeGlobeTileDebugTextBuffer(t,s,m,v,T,E){const j=i.al/4,D=new i.bd,B=new i.b0,V=new i.bo,Y=25;B.reserve(32),D.reserve(Y),V.reserve(Y);const X=(J,se)=>Y*J+se;for(let J=0;J<Y;J++){const se=J*j;for(let ne=0;ne<Y;ne++){const he=ne*j;D.emplaceBack(he,se);const de=this._globePoint(he,se,s,m,v,T,E);V.emplaceBack(de[0],de[1],de[2])}}for(let J=0;J<4;J++)for(let se=0;se<4;se++){const ne=X(J,se),he=X(J,se+1),de=X(J+1,se),pe=X(J+1,se+1);B.emplaceBack(ne,he,de),B.emplaceBack(de,he,pe)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(B),this._tileDebugTextBuffer=t.createVertexBuffer(D,i.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(V,i.bp.members),this._tileDebugTextSegments=i.bg.simpleSegment(0,0,Y,32)}destroy(t=!0){for(const s in this.buckets)this.buckets[s].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof i.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bs.setPbf(i.bt);class ar extends Zs{constructor(t,s,m,v,T){super(t,s,m,v,T),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,s,m){const v=m.context,T=v.gl;let E=this.texturePerLayer.get(t)||m.getTileTexture(s.width);E&&E instanceof i.T?E.update(s,{premultiply:!1}):E=new i.T(v,s,T.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,E)}flushQueues(t){const s=this._workQueuePerLayer.get(t)||[],m=this._fetchQueuePerLayer.get(t)||[];for(;s.length;)s.pop()();for(;m.length;)m.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const s=this._workQueuePerLayer.get(t)||[];for(;s.length;)s.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const s=this._fetchQueuePerLayer.get(t)||[];for(;s.length;)s.pop()()}}fetchHeader(t=16384,s){const m=this._mrt=new i.bs(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=i.bu(v,((T,E,j)=>{if(T)s(T);else try{const D=m.getHeaderLength(E);if(D>t)return void(this.request=this.fetchHeader(D,s));m.parseHeader(E),this._isHeaderLoaded=!0;let B=0;for(const V of Object.values(m.layers))B=Math.max(B,V.dataIndex[V.dataIndex.length-1].lastByte);E.byteLength>=B&&(this.entireBuffer=E),s(null,this.entireBuffer||E,j)}catch(D){s(D)}})),this.request}fetchBandForRender(t,s,m,v){this.fetchBand(t,s,m,(T=>{if(T)return void v(T);this.updateTextureDescriptor(t,s,m);const E=this.textureDescriptorPerLayer.get(s);v(null,E?E.img:null)}))}fetchBand(t,s,m,v,T=!0){const E=this._mrt;if(!this._isHeaderLoaded||!E)return void v(new Error("Tile header is not ready"));const j=this.actor;if(!j)return void v(new Error("Can't fetch tile band without an actor"));let D;const B=i.B(String(m),i.B(this.tileID.key,t));let V=this._taskQueue.get(B);V?V.add(v):(V=new Set,V.add(v),this._taskQueue.set(B,V));const Y=(ne,he)=>{D.complete(ne,he),ne?v(ne):(V.forEach((de=>de(null,he))),this._taskQueue.delete(B))},X=(ne,he)=>{if(ne)return v(ne);const de=j.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:he,task:D},Y,void 0,!0);if(s!==null){const pe=this._workQueuePerLayer.get(s)||[];pe.push((()=>{de&&de.cancel(),D.cancel()})),this._workQueuePerLayer.has(s)||this._workQueuePerLayer.set(s,pe)}};let J;try{J=E.getLayer(t)}catch(ne){if(this.state==="reloading")return;throw ne}if(!J)return void v(new Error(`Unknown sourceLayer "${t}"`));if(J.hasDataForBand(m))return V.forEach((ne=>ne(null,null))),void this._taskQueue.delete(B);const se=J.getDataRange([m]);if(D=E.createDecodingTask(se),!D||D.tasks.length)if(s!==null&&this.flushQueues(s),this.entireBuffer)X(null,this.entireBuffer.slice(se.firstByte,se.lastByte+1));else{const ne=Object.assign({},this.requestParams,{headers:{Range:`bytes=${se.firstByte}-${se.lastByte}`}}),he=i.bu(ne,X);if(s!==null){const de=this._fetchQueuePerLayer.get(s)||[];de.push((()=>{he.cancel(),D.cancel()})),this._fetchQueuePerLayer.has(s)||this._fetchQueuePerLayer.set(s,de)}}}updateNeeded(t,s){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==s||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,s,m){if(!this._mrt)return;const v=this._mrt.getLayer(t);if(!v||!v.hasBand(m)||!v.hasDataForBand(m))return;const{bytes:T,tileSize:E,buffer:j,offset:D,scale:B}=v.getBandView(m),V=E+2*j,Y=new i.q({width:V,height:V},T),X=this.texturePerLayer.get(s);X&&X instanceof i.T&&X.update(Y,{premultiply:!1}),this.textureDescriptorPerLayer.set(s,{layer:t,band:m,img:Y,buffer:j,offset:D,tileSize:E,format:v.pixelFormat,mix:[B,256*B,65536*B,16777216*B]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const s of this.texturePerLayer.values())s&&s instanceof i.T&&s.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Dl{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,m){const v=t.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const T={value:s,timeout:void 0};if(m!==void 0&&(T.timeout=setTimeout((()=>{this.remove(t,T)}),m)),this.data[v].push(T),this.order.push(v),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const m=t.wrapped().key,v=s===void 0?0:this.data[m].indexOf(s),T=this.data[m][v];return this.data[m].splice(v,1),T.timeout&&clearTimeout(T.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(T.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const m in this.data)for(const v of this.data[m])t(v.value)||s.push(v);for(const m of s)this.remove(m.value.tileID,m)}}class mc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,m){const v=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][v]=this.stateChanges[t][v]||{},Object.assign(this.stateChanges[t][v],m),this.deletedStates[t]===null){this.deletedStates[t]={};for(const T in this.state[t])T!==v&&(this.deletedStates[t][T]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][v]===null){this.deletedStates[t][v]={};for(const T in this.state[t][v])m[T]||(this.deletedStates[t][v][T]=null)}else for(const T in m)this.deletedStates[t]&&this.deletedStates[t][v]&&this.deletedStates[t][v][T]===null&&delete this.deletedStates[t][v][T]}removeFeatureState(t,s,m){if(this.deletedStates[t]===null)return;const v=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},m&&s!==void 0)this.deletedStates[t][v]!==null&&(this.deletedStates[t][v]=this.deletedStates[t][v]||{},this.deletedStates[t][v][m]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][v])for(m in this.deletedStates[t][v]={},this.stateChanges[t][v])this.deletedStates[t][v][m]=null;else this.deletedStates[t][v]=null;else this.deletedStates[t]=null}getState(t,s){const m=this.state[t]||{},v=this.stateChanges[t]||{},T=this.deletedStates[t];if(T===null)return{};if(s!==void 0){const j=String(s),D=Object.assign({},m[j],v[j]);if(T){const B=T[s];if(B===null)return{};for(const V in B)delete D[V]}return D}const E=Object.assign({},m,v);if(T)for(const j in T)delete E[j];return E}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const m={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const T={};for(const E in this.stateChanges[v])this.state[v][E]||(this.state[v][E]={}),Object.assign(this.state[v][E],this.stateChanges[v][E]),T[E]=this.state[v][E];m[v]=T}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const T={};if(this.deletedStates[v]===null)for(const E in this.state[v])T[E]={},this.state[v][E]={};else for(const E in this.deletedStates[v]){if(this.deletedStates[v][E]===null)this.state[v][E]={};else if(this.state[v][E])for(const j of Object.keys(this.deletedStates[v][E]))delete this.state[v][E][j];T[E]=this.state[v][E]}m[v]=m[v]||{},Object.assign(m[v],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const v in t)t[v].refreshFeatureState(s)}}class ds extends i.E{constructor(t,s,m){super(),this.id=t,this._onlySymbols=m,s.on("data",(v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),s.on("error",(()=>{this._sourceErrored=!0})),this._source=s,this._tiles={},this._cache=new Dl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new mc,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const m=this._tiles[s];m.upload(t,this.map?this.map.painter:void 0),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Jo).map((t=>t.key))}getRenderableIds(t,s){const m=[];for(const v in this._tiles)this._isIdRenderable(+v,t,s)&&m.push(this._tiles[v]);return t?m.sort(((v,T)=>{const E=v.tileID,j=T.tileID,D=new i.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),B=new i.P(j.canonical.x,j.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-j.overscaledZ||B.y-D.y||B.x-D.x})).map((v=>v.tileID.key)):m.map((v=>v.tileID)).sort(Jo).map((v=>v.key))}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,m){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(m||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const m=this._tiles[t];m&&(m.state!=="loading"&&(m.state=s),this._loadTile(m,this._tileLoaded.bind(this,m,t,s)))}_tileLoaded(t,s,m,v,T){if(v){if(t.state="errored",v.status!==404)this._source.fire(new i.y(v,{tile:t}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const j=this.map.painter.terrain;this.update(this.transform,j.getScaledDemTileSize(),!0),j.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=i.o.now(),m==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let E=new Map;T&&T.responseHeaders&&(E=T.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:E}))}_backfillDEM(t){const s=this.getRenderableIds();for(let v=0;v<s.length;v++){const T=s[v];if(t.neighboringTiles&&t.neighboringTiles[T]){const E=this.getTileByID(T);m(t,E),m(E,t)}}function m(v,T){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let E=T.tileID.canonical.x-v.tileID.canonical.x;const j=T.tileID.canonical.y-v.tileID.canonical.y,D=Math.pow(2,v.tileID.canonical.z),B=T.tileID.key;E===0&&j===0||Math.abs(j)>1||(Math.abs(E)>1&&(Math.abs(E+D)===1?E+=D:Math.abs(E-D)===1&&(E-=D)),T.dem&&v.dem&&(v.dem.backfillBorder(T.dem,E,j),v.neighboringTiles&&v.neighboringTiles[B]&&(v.neighboringTiles[B].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,m,v){for(const T in this._tiles){let E=this._tiles[T];if(v[T]||!E.hasData()||E.tileID.overscaledZ<=s||E.tileID.overscaledZ>m)continue;let j=E.tileID;for(;E&&E.tileID.overscaledZ>s+1;){const B=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[B.key],E&&E.hasData()&&(j=B)}let D=j;for(;D.overscaledZ>s;)if(D=D.scaledTo(D.overscaledZ-1),t[D.key]){v[j.key]=j;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const m=this._loadedParentTiles[t.key];return m&&m.tileID.overscaledZ>=s?m:null}for(let m=t.overscaledZ-1;m>=s;m--){const v=t.scaledTo(m),T=this._getLoadedTile(v);if(T)return T}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const m=Math.ceil(t.width/s)+1,v=Math.ceil(t.height/s)+1,T=Math.floor(m*v*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,T):T,j=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(j)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const m={};for(const v in this._tiles){const T=this._tiles[v];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),m[T.tileID.key]=T}this._tiles=m;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(t,s,m,v,T){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let j,D=this._source.maxzoom;const B=this.map&&this.map.painter?this.map.painter._terrain:null;if(B&&B.sourceCache===this&&B.attenuationRange()){const X=B.attenuationRange()[0],J=Math.floor(X)-Math.log2(B.getDemUpscale());D>J&&(D=J)}if(this.used||this.usedForTerrain){if(this._source.tileID)j=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((X=>new i.aQ(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y)));else if(this.tileCoverLift!==0){const X=t.clone();X.tileCoverLift=this.tileCoverLift,j=X.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&t.projection.name==="globe"&&(j.push(new i.aQ(1,0,1,0,0)),j.push(new i.aQ(1,0,1,1,0)),j.push(new i.aQ(1,0,1,0,1)),j.push(new i.aQ(1,0,1,1,1)))}else if(j=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const X=this._source.hasTile.bind(this._source);j=j.filter((J=>X(J)))}}else j=[];if(j.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!xo(this._source.type)){const X=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),J=Math.min(X,this._source.maxzoom);if(E){const se=t.extendTileCover(j,J);for(const ne of se)j.push(ne)}else if(T){const se=t.extendTileCoverToNearPlane(j,this.transform.getFrustum(J),J);for(const ne of se)j.push(ne)}else if(this.castsShadows&&v){const se=t.extendTileCover(j,J,v,16);for(const ne of se)this._shadowCasterTiles[ne.key]=!0,j.push(ne)}}const V=this._updateRetainedTiles(j);if(xo(this._source.type)&&j.length!==0){const X={},J={},se=Object.keys(V);for(const he of se){const de=V[he],pe=this._tiles[he];if(!pe||pe.fadeEndTime&&pe.fadeEndTime<=i.o.now())continue;const xe=this.findLoadedParent(de,Math.max(de.overscaledZ-ds.maxOverzooming,this._source.minzoom));xe&&(this._addTile(xe.tileID),X[xe.tileID.key]=xe.tileID),J[he]=de}const ne=j[j.length-1].overscaledZ;for(const he in this._tiles){const de=this._tiles[he];if(V[he]||!de.hasData())continue;let pe=de.tileID;for(;pe.overscaledZ>ne;){pe=pe.scaledTo(pe.overscaledZ-1);const xe=this._tiles[pe.key];if(xe&&xe.hasData()&&J[pe.key]){V[he]=de.tileID;break}}}for(const he in X)V[he]||(this._coveredTiles[he]=!0,V[he]=X[he])}for(const X in V)this._tiles[X].clearFadeHold();const Y=i.bv(this._tiles,V);for(const X of Y){const J=this._tiles[X];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile(+X)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const m={},v=t.reduce(((B,V)=>Math.min(B,V.overscaledZ)),1/0),T=t[0].overscaledZ,E=Math.max(T-ds.maxOverzooming,this._source.minzoom),j=Math.max(T+ds.maxUnderzooming,this._source.minzoom),D={};for(const B of t){const V=this._addTile(B);s[B.key]=B,V.hasData()||v<this._source.maxzoom&&(D[B.key]=B)}this._retainLoadedChildren(D,v,j,s);for(const B of t){let V=this._tiles[B.key];if(V.hasData())continue;if(B.canonical.z>=this._source.maxzoom){const X=B.children(this._source.maxzoom)[0],J=this.getTile(X);if(J&&J.hasData()){s[X.key]=X;continue}}else{const X=B.children(this._source.maxzoom);if(s[X[0].key]&&s[X[1].key]&&s[X[2].key]&&s[X[3].key])continue}let Y=V.wasRequested();for(let X=B.overscaledZ-1;X>=E;--X){const J=B.scaledTo(X);if(m[J.key]||(m[J.key]=!0,V=this.getTile(J),!V&&Y&&(V=this._addTile(J)),V&&(s[J.key]=J,Y=V.wasRequested(),V.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let m,v=this._tiles[t].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){m=this._loadedParentTiles[v.key];break}s.push(v.key);const T=v.scaledTo(v.overscaledZ-1);if(m=this._getLoadedTile(T),m)break;v=T}for(const T of s)this._loadedParentTiles[T]=m}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const m=!!s;if(!m){const v=this.map?this.map.painter:null,T=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new ar(t,T,this.transform.tileZoom,v,this._isRaster):new Zs(t,T,this.transform.tileZoom,v,this._isRaster,this._source.worldview),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s.uses++,this._tiles[t.key]=s,m||this._source.fire(new i.z("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const m=s.getExpiryTimeout();m&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),m))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,m){const v=[],T=this.transform;if(!T)return v;const E=T.projection.name==="globe",j=i.aF(T.center.lng);for(const D in this._tiles){const B=this._tiles[D];if(m&&B.clearQueryDebugViz(),B.holdingForFade())continue;let V;if(E){const Y=B.tileID.canonical;if(Y.z===0){const X=[Math.abs(i.aA(j,...Ro(Y,-1))-j),Math.abs(i.aA(j,...Ro(Y,1))-j)];V=[0,2*X.indexOf(Math.min(...X))-1]}else{const X=[Math.abs(i.aA(j,...Ro(Y,-1))-j),Math.abs(i.aA(j,...Ro(Y,0))-j),Math.abs(i.aA(j,...Ro(Y,1))-j)];V=[X.indexOf(Math.min(...X))-1]}}else V=[0];for(const Y of V){const X=t.containsTile(B,T,s,Y);X&&v.push(X)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const m=this.getRenderableIds(t,s).map((T=>this._tiles[T].tileID)),v=this.transform.projection.name==="globe";for(const T of m)T.projMatrix=this.transform.calculateProjMatrix(T.toUnwrapped()),T.expandedProjMatrix=v?this.transform.calculateProjMatrix(T.toUnwrapped(),!1,!0):T.projMatrix;return m}sortCoordinatesByDistance(t){const s=t.slice(),m=this.transform._camera.position,v=this.transform._camera.forward(),T={};for(const E of s){const j=1/(1<<E.canonical.z);T[E.key]=((E.canonical.x+.5)*j+E.wrap-m[0])*v[0]+((E.canonical.y+.5)*j-m[1])*v[1]-m[2]*v[2]}return s.sort(((E,j)=>T[E.key]-T[j.key])),s}hasTransition(){if(this._source.hasTransition())return!0;if(xo(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(t,s,m){this._state.updateState(t=t||"_geojsonTileLayer",s,m)}removeFeatureState(t,s,m){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,m)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,m){const v=this._tiles[t];v&&v.setDependencies(s,m)}reloadTilesForDependencies(t,s){for(const m in this._tiles)this._tiles[m].hasDependency(t,s)&&this._reloadTile(+m,"reloading");this._cache.filter((m=>!m.hasDependency(t,s)))}_preloadTiles(t,s){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(t,s))};return void this._source.on("data",D)}const m=new Map,v=Array.isArray(t)?t:[t],T=this.map.painter.terrain,E=this.usedForTerrain&&T?T.getScaledDemTileSize():this._source.tileSize;for(const D of v){const B=D.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const V of B)m.set(V.key,V);this.usedForTerrain&&D.updateElevation(!1)}const j=Array.from(m.values());i.bw(j,((D,B)=>{const V=new Zs(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(V,(Y=>{this._source.type==="raster-dem"&&V.dem&&this._backfillDEM(V),B(Y,V)}))}),s)}}function Jo(f,t){const s=Math.abs(2*f.wrap)-+(f.wrap<0),m=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||m-s||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function xo(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Ro(f,t){const s=1<<f.z;return[f.x/s+t,(f.x+1)/s+t]}ds.maxOverzooming=10,ds.maxUnderzooming=3;class Xu{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const m in this.style._mergedLayers){const v=this.style._mergedLayers[m];if(v.type==="fill-extrusion"||v.type==="building")this.layers.push({layer:v,visible:t,visibilityChanged:s});else if(v.type==="model"){const T=this.style.getLayerSource(v);T&&T.type==="batched-model"&&this.layers.push({layer:v,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const m=s.layer;let v=!1;m.type==="fill-extrusion"?v=!m.isHidden(t)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="building"?v=!m.isHidden(t)&&m.paint.get("building-opacity")>0:m.type==="model"&&(v=!m.isHidden(t)&&m.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&s.visible,s.visible=v}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const v of this.layers){const T=v.layer,E=this.style.getLayerSourceCache(T);let j=1;T.type==="fill-extrusion"?j=v.visible?T.paint.get("fill-extrusion-vertical-scale"):0:T.type==="building"&&(j=v.visible?T.paint.get("building-vertical-scale"):0);let D=E?E.getTile(s):null;if(!D&&E)for(const B in E._tiles){const V=E._tiles[B];if(s.canonical.isChildOf(V.tileID.canonical)){D=V;break}}this.currentBuildingBuckets.push({bucket:D?D.getBucket(T):null,tileID:D?D.tileID:s,verticalScale:j})}t.hasAnyZOffset=!1;let m=!1;for(let v=0;v<t.symbolInstances.length;v++){const T=t.symbolInstances.get(v),E=T.zOffset,j=this._getHeightAtTileOffset(s,T.tileAnchorX,T.tileAnchorY);T.zOffset=j!==Number.NEGATIVE_INFINITY?j:E,m||E===T.zOffset||(m=!0),t.hasAnyZOffset||T.zOffset===0||(t.hasAnyZOffset=!0)}m&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,m,v){let T=s,E=m;if(t.canonical.z!==v.canonical.z){const j=v.canonical,D=1/(1<<t.canonical.z-j.z);T=(s+t.canonical.x*i.al)*D-j.x*i.al|0,E=(m+t.canonical.y*i.al)*D-j.y*i.al|0}return{tileX:T,tileY:E}}_getHeightAtTileOffset(t,s,m){let v,T;for(let E=0;E<this.layers.length;++E){const j=this.layers[E].layer;if(j.type!=="fill-extrusion"&&j.type!=="building")continue;const{bucket:D,tileID:B,verticalScale:V}=this.currentBuildingBuckets[E];if(!D)continue;const{tileX:Y,tileY:X}=this._mapCoordToOverlappingTile(t,s,m,B),J=D.getHeightAtTileCoord(Y,X);J&&J.height!==void 0&&(J.hidden?v=J.height:T=Math.max(J.height*V,T||0))}if(T!==void 0)return T;for(let E=0;E<this.layers.length;++E){const j=this.layers[E];if(j.layer.type!=="model"||!j.visible)continue;const{bucket:D,tileID:B}=this.currentBuildingBuckets[E];if(!D)continue;const{tileX:V,tileY:Y}=this._mapCoordToOverlappingTile(t,s,m,B),X=D.getHeightAtTileCoord(V,Y);if(X&&!X.hidden)return X.height===void 0&&v!==void 0?Math.min(X.maxHeight,v)*X.verticalScale:X.height?X.height*X.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function os(f,t){const s={};for(const m in f)m!=="ref"&&(s[m]=f[m]);return i.bx.forEach((m=>{m in t&&(s[m]=t[m])})),s}function Do(f){f=f.slice();const t=Object.create(null);for(let s=0;s<f.length;s++)t[f[s].id]=f[s];for(let s=0;s<f.length;s++)"ref"in f[s]&&(f[s]=os(f[s],t[f[s].ref]));return f}const Vn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function js(f,t,s){s.push({command:Vn.addSource,args:[f,t[f]]})}function pc(f,t,s){t.push({command:Vn.removeSource,args:[f]}),s[f]=!0}function Yu(f,t,s,m){pc(f,s,m),js(f,t,s)}function Gc(f,t,s){let m;for(m in f[s])if(f[s].hasOwnProperty(m)&&m!=="data"&&!i.by(f[s][m],t[s][m]))return!1;for(m in t[s])if(t[s].hasOwnProperty(m)&&m!=="data"&&!i.by(f[s][m],t[s][m]))return!1;return!0}function qc(f,t,s,m,v,T){let E;for(E in t=t||{},f=f||{})f.hasOwnProperty(E)&&(i.by(f[E],t[E])||s.push({command:T,args:[m,E,t[E],v]}));for(E in t)t.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(i.by(f[E],t[E])||s.push({command:T,args:[m,E,t[E],v]}))}function Wc(f){return f.id}function Aa(f,t){return f[t.id]=t,f}function Tu(f,t,s){const m=t.createTileMatrix(f,f.worldSize,s.toUnwrapped());return i.aB(new Float32Array(16),f.projMatrix,m)}function Xs(f,t,s){if(t.projection.name===s.projection.name)return f.projMatrix;const m=s.clone();return m.setProjection(t.projection),Tu(m,t.getProjection(),f)}function bo(f,t,s){return t.name===s.projection.name?f.projMatrix:Tu(s,t,f)}class Ku{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=i.aA(t,0,1);let s=1,m=this._distances[s];const v=t*this.paddedLength+this.padding;for(;m<v&&s<this._distances.length;)m=this._distances[++s];const T=s-1,E=this._distances[T],j=m-E,D=j>0?(v-E)/j:0;return this.points[T].mult(1-D).add(this.points[s].mult(D))}}class bf{constructor(t,s,m){const v=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(t/m),this.yCellCount=Math.ceil(s/m);for(let E=0;E<this.xCellCount*this.yCellCount;E++)v.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,m,v,T){this._forEachCell(s,m,v,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(T)}insertCircle(t,s,m,v){this._forEachCell(s-v,m-v,s+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(m),this.circles.push(v)}_insertBoxCell(t,s,m,v,T,E){this.boxCells[T].push(E)}_insertCircleCell(t,s,m,v,T,E){this.circleCells[T].push(E)}_query(t,s,m,v,T,E){if(m<0||t>this.width||v<0||s>this.height)return!T&&[];const j=[];if(t<=0&&s<=0&&this.width<=m&&this.height<=v){if(T)return!0;for(let D=0;D<this.boxKeys.length;D++)j.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const B=this.circles[3*D],V=this.circles[3*D+1],Y=this.circles[3*D+2];j.push({key:this.circleKeys[D],x1:B-Y,y1:V-Y,x2:B+Y,y2:V+Y})}return E?j.filter(E):j}return this._forEachCell(t,s,m,v,this._queryCell,j,{hitTest:T,seenUids:{box:{},circle:{}}},E),T?j.length>0:j}_queryCircle(t,s,m,v,T){const E=t-m,j=t+m,D=s-m,B=s+m;if(j<0||E>this.width||B<0||D>this.height)return!v&&[];const V=[];return this._forEachCell(E,D,j,B,this._queryCellCircle,V,{hitTest:v,circle:{x:t,y:s,radius:m},seenUids:{box:{},circle:{}}},T),v?V.length>0:V}query(t,s,m,v,T){return this._query(t,s,m,v,!1,T)}hitTest(t,s,m,v,T){return this._query(t,s,m,v,!0,T)}hitTestCircle(t,s,m,v){return this._queryCircle(t,s,m,!0,v)}_queryCell(t,s,m,v,T,E,j,D){const B=j.seenUids,V=this.boxCells[T];if(V!==null){const X=this.bboxes;for(const J of V)if(!B.box[J]){B.box[J]=!0;const se=4*J;if(t<=X[se+2]&&s<=X[se+3]&&m>=X[se+0]&&v>=X[se+1]&&(!D||D(this.boxKeys[J]))){if(j.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[J],x1:X[se],y1:X[se+1],x2:X[se+2],y2:X[se+3]})}}}const Y=this.circleCells[T];if(Y!==null){const X=this.circles;for(const J of Y)if(!B.circle[J]){B.circle[J]=!0;const se=3*J;if(this._circleAndRectCollide(X[se],X[se+1],X[se+2],t,s,m,v)&&(!D||D(this.circleKeys[J]))){if(j.hitTest)return E.push(!0),!0;{const ne=X[se],he=X[se+1],de=X[se+2];E.push({key:this.circleKeys[J],x1:ne-de,y1:he-de,x2:ne+de,y2:he+de})}}}}}_queryCellCircle(t,s,m,v,T,E,j,D){const B=j.circle,V=j.seenUids,Y=this.boxCells[T];if(Y!==null){const J=this.bboxes;for(const se of Y)if(!V.box[se]){V.box[se]=!0;const ne=4*se;if(this._circleAndRectCollide(B.x,B.y,B.radius,J[ne+0],J[ne+1],J[ne+2],J[ne+3])&&(!D||D(this.boxKeys[se])))return E.push(!0),!0}}const X=this.circleCells[T];if(X!==null){const J=this.circles;for(const se of X)if(!V.circle[se]){V.circle[se]=!0;const ne=3*se;if(this._circlesCollide(J[ne],J[ne+1],J[ne+2],B.x,B.y,B.radius)&&(!D||D(this.circleKeys[se])))return E.push(!0),!0}}}_forEachCell(t,s,m,v,T,E,j,D){const B=this._convertToXCellCoord(t),V=this._convertToYCellCoord(s),Y=this._convertToXCellCoord(m),X=this._convertToYCellCoord(v);for(let J=B;J<=Y;J++)for(let se=V;se<=X;se++)if(T.call(this,t,s,m,v,this.xCellCount*se+J,E,j,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,m,v,T,E){const j=v-t,D=T-s,B=m+E;return B*B>j*j+D*D}_circleAndRectCollide(t,s,m,v,T,E,j){const D=(E-v)/2,B=Math.abs(t-(v+D));if(B>D+m)return!1;const V=(j-T)/2,Y=Math.abs(s-(T+V));if(Y>V+m)return!1;if(B<=D||Y<=V)return!0;const X=B-D,J=Y-V;return X*X+J*J<=m*m}}const ic={unknown:0,flipRequired:1,flipNotRequired:2},gc=Math.tan(85*Math.PI/180);function zs(f,t,s,m,v,T,E){const j=i.bC();if(s)if(T.name==="globe"){const D=i.bD(v,t);i.aB(j,j,D)}else{const D=i.bE([],E);j[0]=D[0],j[1]=D[1],j[4]=D[2],j[5]=D[3],m||i.bB(j,j,v.angle)}else i.aB(j,v.labelPlaneMatrix,f);return j}function kh(f,t,s,m,v,T,E){const j=zs(f,t,s,m,v,T,E);return T.name==="globe"&&s||(j[2]=j[6]=j[10]=j[14]=0),j}function Fd(f,t,s,m,v,T,E){if(s){if(T.name==="globe"){const j=zs(f,t,s,m,v,T,E);return i.bl(j,j),i.aB(j,f,j),j}{const j=i.bz(f),D=i.bA([]);return D[0]=E[0],D[1]=E[1],D[4]=E[2],D[5]=E[3],i.aB(j,j,D),m||i.bB(j,j,-v.angle),j}}return v.glCoordMatrix}function Lo(f,t,s,m){const v=[f,t,s,1];s?i.aC(v,v,m):Ii(v,v,m);const T=v[3];return v[0]/=T,v[1]/=T,v[2]/=T,v}function ha(f,t){return Math.min(.5+f/t*.5,1.5)}function hl(f,t){const s=f[0]/f[3],m=f[1]/f[3];return s>=-t[0]&&s<=t[0]&&m>=-t[1]&&m<=t[1]}function Em(f,t,s,m,v,T,E,j,D,B,V=1){const Y=s.transform,X=m?f.textSizeData:f.iconSizeData,J=i.bK(X,s.transform.zoom,V),se=Y.projection.name==="globe",ne=[256/s.width*2+1,256/s.height*2+1],he=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;he.clear();let de=null;se&&(de=m?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const pe=f.lineVertexArray,xe=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,ge=s.transform.width/s.transform.height;let je,Ae=!1;for(let De=0;De<xe.length;De++){const ze=xe.get(De),{numGlyphs:Me,writingMode:Ve}=ze;if(Ve!==i.bL.vertical||Ae||je===i.bL.horizontal||(Ae=!0),je=Ve,(ze.hidden||Ve===i.bL.vertical)&&!Ae){fl(Me,he);continue}Ae=!1;const it=new i.P(ze.tileAnchorX,ze.tileAnchorY),Ye=f.elevationType==="road",dt=!!Y.elevation||Ye;let{x:mt,y:Tt,z:Ot}=Y.projection.projectTilePoint(it.x,it.y,B.canonical),st=null;if(dt){const _i=Ye?f.getElevationFeatureForText(De):null;st={getElevation:D,elevation:Y.elevation,elevationFeature:_i};const[Bi,dn,Pn]=D(it,Y.elevation,_i);mt+=Bi,Tt+=dn,Ot+=Pn}const Xe=[mt,Tt,Ot,1];if(i.aC(Xe,Xe,t),!hl(Xe,ne)){fl(Me,he);continue}const pt=Xe[3],ht=ha(s.transform.getCameraToCenterDistance(Y.projection),pt),Nt=i.bM(X,J,ze),ti=E?Nt/ht:Nt*ht,gi=Lo(mt,Tt,Ot,v);if(gi[3]<=0){fl(Me,he);continue}let Wt={};const Dt=i.an(f.layers[0].layout.get("text-max-angle")),Ti=Math.cos(Dt),bi=E?null:st,di=Eh(ze,ti,!1,j,t,v,T,f.glyphOffsetArray,pe,he,de,gi,it,Wt,ge,bi,Y.projection,B,E,Ti);Ae=di.useVertical,bi&&di.needsFlipping&&(Wt={}),(di.notEnoughRoom||Ae||di.needsFlipping&&Eh(ze,ti,!0,j,t,v,T,f.glyphOffsetArray,pe,he,de,gi,it,Wt,ge,bi,Y.projection,B,E,Ti).notEnoughRoom)&&fl(Me,he)}m?(f.text.dynamicLayoutVertexBuffer.updateData(he),de&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(de)):(f.icon.dynamicLayoutVertexBuffer.updateData(he),de&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(de))}function wf(f,t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he){const{lineStartIndex:de,glyphStartIndex:pe,segment:xe}=j,ge=pe+j.numGlyphs,je=de+j.lineLength,Ae=t.getoffsetX(pe),De=t.getoffsetX(ge-1),ze=Ju(f*Ae,s,m,v,T,E,xe,de,je,D,B,V,Y,X,!0,J,se,ne,he);if(!ze)return null;const Me=Ju(f*De,s,m,v,T,E,xe,de,je,D,B,V,Y,X,!0,J,se,ne,he);return Me?{first:ze,last:Me}:null}function $i(f,t,s,m){return f===i.bL.horizontal&&Math.abs(m)>Math.abs(s)?{useVertical:!0}:f===i.bL.vertical?m>0?{needsFlipping:!0}:null:t!==ic.unknown&&(function(v,T){return v===0||Math.abs(T/v)>gc})(s,m)?t===ic.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Eh(f,t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he,de,pe,xe){const ge=t/24,je=f.lineOffsetX*ge,Ae=f.lineOffsetY*ge,{lineStartIndex:De,glyphStartIndex:ze,numGlyphs:Me,segment:Ve,writingMode:it,flipState:Ye}=f,dt=De+f.lineLength,mt=Tt=>{if(V){const[pt,ht,Nt]=Tt.up,ti=B.length;i.bN(V,ti+0,pt,ht,Nt),i.bN(V,ti+1,pt,ht,Nt),i.bN(V,ti+2,pt,ht,Nt),i.bN(V,ti+3,pt,ht,Nt)}const[Ot,st,Xe]=Tt.point;i.bO(B,Ot,st,Xe,Tt.angle)};if(Me>1){const Tt=wf(ge,j,je,Ae,s,Y,X,f,D,T,J,ne,!1,he,de,pe,xe);if(!Tt)return{notEnoughRoom:!0};if(m&&!s){let[Ot,st,Xe]=Tt.first.point,[pt,ht,Nt]=Tt.last.point;[Ot,st]=Lo(Ot,st,Xe,E),[pt,ht]=Lo(pt,ht,Nt,E);const ti=$i(it,Ye,(pt-Ot)*se,ht-st);if(f.flipState=ti&&ti.needsFlipping?ic.flipRequired:ic.flipNotRequired,ti)return ti}mt(Tt.first);for(let Ot=ze+1;Ot<ze+Me-1;Ot++){const st=Ju(ge*j.getoffsetX(Ot),je,Ae,s,Y,X,Ve,De,dt,D,T,J,ne,!1,!1,he,de,pe,xe);if(!st)return B.length-=4*(Ot-ze),{notEnoughRoom:!0};mt(st)}mt(Tt.last)}else{if(m&&!s){const Ot=Lo(X.x,X.y,0,v),st=De+Ve+1,Xe=new i.P(D.getx(st),D.gety(st)),pt=Lo(Xe.x,Xe.y,0,v),ht=pt[3]>0?pt:Oo(X,Xe,Ot,1,v,void 0,he,de.canonical),Nt=$i(it,Ye,(ht[0]-Ot[0])*se,ht[1]-Ot[1]);if(f.flipState=Nt&&Nt.needsFlipping?ic.flipRequired:ic.flipNotRequired,Nt)return Nt}const Tt=Ju(ge*j.getoffsetX(ze),je,Ae,s,Y,X,Ve,De,dt,D,T,J,ne,!1,!1,he,de,pe,xe);if(!Tt)return{notEnoughRoom:!0};mt(Tt)}return{}}function Zc(f,t,s,m,v){const{x:T,y:E,z:j}=m.projectTilePoint(f.x,f.y,t);if(!v)return Lo(T,E,j,s);const[D,B,V]=v.getElevation(f,v.elevation,v.elevationFeature);return Lo(T+D,E+B,j+V,s)}function Oo(f,t,s,m,v,T,E,j){const D=Zc(f.sub(t)._unit()._add(f),j,v,E,T);return i.av(D,s,D),i.aw(D,D),i.bH(D,s,D,m)}function Ju(f,t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he,de,pe){const xe=m?f-t:f+t;let ge=xe>0?1:-1,je=0;m&&(ge*=-1,je=Math.PI),ge<0&&(je+=Math.PI);let Ae=j+E+(ge>0?0:1)|0,De=v,ze=v,Me=0,Ve=0;const it=Math.abs(xe),Ye=[],dt=[];let mt=T,Tt=mt,Ot=i.bF([]);const st=()=>Oo(Tt,mt,ze,it-Me+1,V,X,ne,he.canonical);for(;Me+Ve<=it;){if(Ae+=ge,Ae<j||Ae>=D)return null;if(ze=De,Tt=mt,Ye.push(ze),J&&dt.push(Tt),mt=new i.P(B.getx(Ae),B.gety(Ae)),De=Y[Ae],!De){const bi=Zc(mt,he.canonical,V,ne,X);De=bi[3]>0?Y[Ae]=bi:st()}Me+=Ve;const Dt=i.av([],De,ze),Ti=i.bG(ze,De);if(s&&Ti>0&&Ve>0&&i.bJ(Ot,Dt)/(Ve*Ti)<pe)return null;Ve=Ti,Ot=Dt}se&&X&&(Y[Ae]&&(De=st(),Ve=i.bG(ze,De),Ot=i.av([],De,ze)),Y[Ae]=De);const Xe=(it-Me)/Ve,pt=mt.sub(Tt)._mult(Xe)._add(Tt),ht=i.bH([],ze,Ot,Xe);let Nt=[0,0,1],ti=Ot[0],gi=Ot[1];if(de&&(Nt=ne.upVector(he.canonical,pt.x,pt.y),Nt[0]!==0||Nt[1]!==0||Nt[2]!==1)){const Dt=[Nt[2],0,-Nt[0]],Ti=i.bI([],Nt,Dt);i.aw(Dt,Dt),i.aw(Ti,Ti),ti=i.bJ(Ot,Dt),gi=i.bJ(Ot,Ti)}if(s){const Dt=i.bI([],Nt,Ot);i.aw(Dt,Dt),i.bH(ht,ht,Dt,s*ge)}const Wt=je+Math.atan2(gi,ti);return Ye.push(ht),J&&dt.push(pt),{point:ht,angle:Wt,path:Ye,tilePath:dt,up:Nt}}function fl(f,t){const s=t.length,m=s+4*f;t.resize(m),t.float32.fill(-1/0,4*s,4*m)}function Ii(f,t,s){const m=t[0],v=t[1];return f[0]=s[0]*m+s[4]*v+s[12],f[1]=s[1]*m+s[5]*v+s[13],f[3]=s[3]*m+s[7]*v+s[15],f}const Nn=100;class pa{constructor(t,s,m=new bf(t.width+200,t.height+200,25),v=new bf(t.width+200,t.height+200,25)){this.transform=t,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Nn,this.screenBottomBoundary=t.height+Nn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,m,v,T,E,j,D,B,V,Y){let X=m.projectedAnchorX,J=m.projectedAnchorY,se=m.projectedAnchorZ;const ne=m.tileAnchorX,he=m.tileAnchorY,de=m.elevation,pe=m.tileID,xe=t.getProjection();if(de&&pe){const[dt,mt,Tt]=xe.upVector(pe.canonical,m.tileAnchorX,m.tileAnchorY),Ot=xe.upVectorScale(pe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;X+=dt*de*Ot,J+=mt*de*Ot,se+=Tt*de*Ot}const ge=t.projection.name==="globe",je=t.projection.name==="globe"?i.aj(this.transform.zoom):0;if(pe&&ge&&je<1&&!E){const dt=1<<pe.canonical.z,mt=i.bP(ne,he);i.bQ(mt,mt,1/i.al),i.bR(mt,mt,i.bP(pe.canonical.x,pe.canonical.y)),i.bQ(mt,mt,1/dt),i.bS(mt,mt,i.bP(v[0],v[1])),mt[0]=i.bT(mt[0],-.5,.5),i.bQ(mt,mt,i.al);const Tt=i.bU(mt[0],mt[1],i.al/(2*Math.PI),1);i.aC(Tt,Tt,T),X=i.ak(X,Tt[0],je),J=i.ak(J,Tt[1],je),se=i.ak(se,Tt[2],je)}const Ae=this.projectAndGetPerspectiveRatio(V,X,J,se,m.tileID,xe.name==="globe"||!!de||this.transform.pitch>0,xe),De=B*Ae.perspectiveRatio,ze=(m.x1*s+j.x-m.padding)*De+Ae.point.x,Me=(m.y1*s+j.y-m.padding)*De+Ae.point.y,Ve=(m.x2*s+j.x+m.padding)*De+Ae.point.x,it=(m.y2*s+j.y+m.padding)*De+Ae.point.y,Ye=Ae.perspectiveRatio<=.55||Ae.occluded;return!this.isInsideGrid(ze,Me,Ve,it)||!D&&this.grid.hitTest(ze,Me,Ve,it,Y)||Ye?{box:[],offscreen:!1,occluded:Ae.occluded}:{box:[ze,Me,Ve,it],offscreen:this.isOffscreen(ze,Me,Ve,it),occluded:!1}}placeCollisionCircles(t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he){const de=[],pe=this.transform.elevation,xe=t.getProjection(),ge=t.elevationType==="road",je=!!pe||ge,Ae=i.bV.getAtTileOffsetFunc(he,this.transform.center.lat,this.transform.worldSize,xe),De=new i.P(m.tileAnchorX,m.tileAnchorY),ze=new i.P(m.tileAnchorX,m.tileAnchorY);let{x:Me,y:Ve,z:it}=xe.projectTilePoint(ze.x,ze.y,he.canonical),Ye=null;if(je){const Ti=ge?t.getElevationFeatureForText(v):null;Ye={getElevation:Ae,elevation:pe,elevationFeature:Ti};const[bi,di,_i]=Ae(De,pe,Ti);Me+=bi,Ve+=di,it+=_i}const dt=xe.name==="globe",mt=this.projectAndGetPerspectiveRatio(D,Me,Ve,it,he,dt||!!pe||this.transform.pitch>0,xe),{perspectiveRatio:Tt}=mt,Ot=(X?j/Tt:j*Tt)/i.bY,st=Lo(Me,Ve,it,B),Xe=m.lineOffsetX*Ot,pt=m.lineOffsetY*Ot,ht=i.an(t.layers[0].layout.get("text-max-angle")),Nt=Math.cos(ht),ti=mt.signedDistanceFromCamera>0?wf(Ot,E,Xe,pt,ge&&m.flipState===1,st,ze,m,T,B,{},je&&!X?Ye:null,X&&je,xe,he,X,Nt):null;let gi=!1,Wt=!1,Dt=!0;if(ti&&!mt.occluded){const Ti=.5*se*Tt+ne,bi=new i.P(-100,-100),di=new i.P(this.screenRightBoundary,this.screenBottomBoundary),_i=new Ku,{first:Bi,last:dn}=ti,Pn=Bi.path.length;let Jn=[];for(let Wi=Pn-1;Wi>=1;Wi--)Jn.push(Bi.path[Wi]);for(let Wi=1;Wi<dn.path.length;Wi++)Jn.push(dn.path[Wi]);const wi=2.5*Ti;V&&(Jn=Jn.map((([Wi,la,_a],ya)=>(je&&!dt&&(_a=Ae(ya<Pn-1?Bi.tilePath[Pn-1-ya]:dn.tilePath[ya-Pn+2],pe,Ye.elevationFeature)[2]),Lo(Wi,la,_a,V)))),Jn.some((Wi=>Wi[3]<=0))&&(Jn=[]));let Qn=[];if(Jn.length>0){let Wi=1/0,la=-1/0,_a=1/0,ya=-1/0;for(const Rn of Jn)Wi=Math.min(Wi,Rn[0]),_a=Math.min(_a,Rn[1]),la=Math.max(la,Rn[0]),ya=Math.max(ya,Rn[1]);la>=bi.x&&Wi<=di.x&&ya>=bi.y&&_a<=di.y&&(Qn=[Jn.map((Rn=>new i.P(Rn[0],Rn[1])))],(Wi<bi.x||la>di.x||_a<bi.y||ya>di.y)&&(Qn=i.bW(Qn,bi.x,bi.y,di.x,di.y)))}for(const Wi of Qn){_i.reset(Wi,.25*Ti);let la=0;la=_i.length<=.5*Ti?1:Math.ceil(_i.paddedLength/wi)+1;for(let _a=0;_a<la;_a++){const ya=_a/Math.max(la-1,1),Rn=_i.lerp(ya),mn=Rn.x+Nn,ta=Rn.y+Nn;de.push(mn,ta,Ti,0);const Va=mn-Ti,Za=ta-Ti,ca=mn+Ti,Wn=ta+Ti;if(Dt=Dt&&this.isOffscreen(Va,Za,ca,Wn),Wt=Wt||this.isInsideGrid(Va,Za,ca,Wn),!s&&this.grid.hitTestCircle(mn,ta,Ti,J)&&(gi=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:gi,occluded:!1}}}}return{circles:!Y&&gi||!Wt?[]:de,offscreen:Dt,collisionDetected:gi,occluded:mt.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let m=1/0,v=1/0,T=-1/0,E=-1/0;for(const V of t){const Y=new i.P(V.x+Nn,V.y+Nn);m=Math.min(m,Y.x),v=Math.min(v,Y.y),T=Math.max(T,Y.x),E=Math.max(E,Y.y),s.push(Y)}const j=this.grid.query(m,v,T,E).concat(this.ignoredGrid.query(m,v,T,E)),D={},B={};for(const V of j){const Y=V.key;if(D[Y.bucketInstanceId]===void 0&&(D[Y.bucketInstanceId]={}),D[Y.bucketInstanceId][Y.featureIndex])continue;const X=[new i.P(V.x1,V.y1),new i.P(V.x2,V.y1),new i.P(V.x2,V.y2),new i.P(V.x1,V.y2)];i.bX(s,X)&&(D[Y.bucketInstanceId][Y.featureIndex]=!0,B[Y.bucketInstanceId]===void 0&&(B[Y.bucketInstanceId]=[]),B[Y.bucketInstanceId].push(Y.featureIndex))}return B}insertCollisionBox(t,s,m,v,T){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:T},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,m,v,T){const E=s?this.ignoredGrid:this.grid,j={bucketInstanceId:m,featureIndex:v,collisionGroupID:T};for(let D=0;D<t.length;D+=4)E.insertCircle(j,t[D],t[D+1],t[D+2])}projectAndGetPerspectiveRatio(t,s,m,v,T,E,j){const D=[s,m,v,1];let B=!1;v||this.transform.pitch>0?(i.aC(D,D,t),this.fogState&&T&&j.name!=="globe"&&(B=(function(X,J,se,ne,he,de){const pe=de.calculateFogTileMatrix(he),xe=[J,se,ne];return i.af(xe,xe,pe),ci(X,i.ag(xe),de.pitch,de._fov)})(this.fogState,s,m,v,T.toUnwrapped(),this.transform)>.9)):Ii(D,D,t);const V=D[3];return{point:new i.P((D[0]/V+1)/2*this.transform.width+Nn,(-D[1]/V+1)/2*this.transform.height+Nn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(j)/V*.5,1.5),signedDistanceFromCamera:V,occluded:E&&D[2]>V||B}}isOffscreen(t,s,m,v){return m<Nn||t>=this.screenRightBoundary||v<Nn||s>this.screenBottomBoundary}isInsideGrid(t,s,m,v){return m>=0&&t<this.gridRightBoundary&&v>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=i.bA([]);return i.br(t,t,[-100,-100,0]),t}}class Ys{constructor(t,s,m,v){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class nc{constructor(t,s,m,v,T,E=!1){this.text=new Ys(t?t.text:null,s,m,T),this.icon=new Ys(t?t.icon:null,s,v,T),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class na{constructor(t,s,m,v=!1){this.text=t,this.icon=s,this.skipFade=m,this.clipped=v}}class Bd{constructor(){this.invProjMatrix=i.bC(),this.viewportMatrix=i.bC(),this.circles=[]}}class Xc{constructor(t,s,m,v,T){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=T}}class Ll{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:m=>m.collisionGroupID===s}}return this.collisionGroups[t]}}function Is(f,t,s,m,v){const{horizontalAlign:T,verticalAlign:E}=i.c1(f),j=-(T-.5)*t,D=-(E-.5)*s,B=i.c2(f,m);return new i.P(j+B[0]*v,D+B[1]*v)}function or(f,t,s,m,v){const T=new i.P(f,t);return s&&T._rotate(m?v:-v),T}class ao{constructor(t,s,m,v,T,E){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new pa(this.transform,T),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Ll(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,s,m,v,T=1){const E=m.getBucket(s),j=m.latestFeatureIndex;if(!E||!j||s.fqid!==E.layerIds[0])return;const D=E.layers[0].layout,B=E.layers[0].paint,V=m.collisionBoxArray,Y=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),X=m.tileSize/i.al,J=m.tileID.toUnwrapped();this.transform.setProjection(E.projection);const se=(ne=m.tileID,he=E.getProjection(),de=this.transform,he.name===this.projection?de.calculateProjMatrix(ne.toUnwrapped()):Tu(de,he,ne));var ne,he,de;const pe=D.get("text-pitch-alignment")==="map",xe=D.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const ge=s.dynamicFilter(),je=s.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(m),De=kh(se,m.tileID.canonical,pe,xe,this.transform,E.getProjection(),Ae);let ze=null;const Me=E.getProjection().createInversionMatrix(this.transform,m.tileID.canonical);if(pe){const Xe=Fd(se,m.tileID.canonical,pe,xe,this.transform,E.getProjection(),Ae);ze=i.aB([],this.transform.labelPlaneMatrix,Xe)}let Ve=null;ge&&m.latestFeatureIndex&&(Ve={unwrappedTileID:J,dynamicFilter:ge,dynamicFilterNeedsFeature:je}),this.retainedQueryData[E.bucketInstanceId]=new Xc(E.bucketInstanceId,j,E.sourceLayerIndex,E.index,m.tileID);const[it,Ye]=E.layers[0].layout.get("text-size-scale-range"),dt=i.aA(T,it,Ye),[mt,Tt]=D.get("icon-size-scale-range"),Ot=i.aA(T,mt,Tt),st={bucket:E,layout:D,paint:B,posMatrix:se,invMatrix:Me,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:De,labelToScreenMatrix:ze,clippingData:Ve,scale:Y,textPixelRatio:X,holdingForFade:m.holdingForFade(),collisionBoxArray:V,partiallyEvaluatedTextSize:i.bK(E.textSizeData,this.transform.zoom,dt),partiallyEvaluatedIconSize:i.bK(E.iconSizeData,this.transform.zoom,Ot),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(v)for(const Xe of E.sortKeyRanges){const{sortKey:pt,symbolInstanceStart:ht,symbolInstanceEnd:Nt}=Xe;t.push({sortKey:pt,symbolInstanceStart:ht,symbolInstanceEnd:Nt,parameters:st})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:st})}attemptAnchorPlacement(t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he,de,pe,xe,ge,je){const{textOffset0:Ae,textOffset1:De,crossTileID:ze}=ne,Me=[Ae,De],Ve=Is(t,E,j,Me,D),it=this.collisionIndex.placeCollisionBox(de,D,s,m,v,T,or(Ve.x,Ve.y,B,V,this.transform.angle),se,Y,X,J.predicate);if(xe){const Ye=de.getSymbolInstanceIconSize(je,this.transform.zoom,ne.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(de,Ye,xe,m,v,T,or(Ve.x,Ve.y,B,V,this.transform.angle),se,Y,X,J.predicate).box.length===0)return}if(it.box.length>0){let Ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[ze]&&this.prevPlacement.placements[ze]&&this.prevPlacement.placements[ze].text&&(Ye=this.prevPlacement.variableOffsets[ze].anchor),this.variableOffsets[ze]={textOffset:Me,width:E,height:j,anchor:t,textScale:D,prevAnchor:Ye},this.markUsedJustification(de,t,ne,pe),de.allowVerticalPlacement&&(this.markUsedOrientation(de,pe,ne),this.placedOrientations[ze]=pe),{shift:Ve,placedGlyphBoxes:it}}}placeLayerBucketPart(t,s,m,v,T=1){const{bucket:E,layout:j,paint:D,posMatrix:B,textLabelPlaneMatrix:V,labelToScreenMatrix:Y,clippingData:X,textPixelRatio:J,mercatorCenter:se,invMatrix:ne,holdingForFade:he,collisionBoxArray:de,partiallyEvaluatedTextSize:pe,partiallyEvaluatedIconSize:xe,collisionGroup:ge,latestFeatureIndex:je}=t.parameters,Ae=j.get("text-optional"),De=j.get("icon-optional"),ze=j.get("text-allow-overlap"),Me=j.get("icon-allow-overlap"),Ve=j.get("text-rotation-alignment")==="map",it=j.get("icon-rotation-alignment")==="map",Ye=j.get("text-pitch-alignment")==="map",dt=D.get("symbol-z-offset"),mt=j.get("symbol-elevation-reference")==="sea",Tt=j.get("symbol-placement"),[Ot,st]=j.get("text-size-scale-range"),[Xe,pt]=j.get("icon-size-scale-range"),ht=i.aA(T,Ot,st),Nt=i.aA(T,Xe,pt),ti=j.get("text-variable-anchor"),gi=Ve&&Tt!=="point",Wt=it&&Tt!=="point",Dt=ti&&E.hasTextData(),Ti=E.hasIconTextFit()&&Dt&&E.hasIconData();this.transform.setProjection(E.projection);const bi=Dt||gi,di=Wt||Ti;let _i=ze&&(Me||!E.hasIconData()||De),Bi=Me&&(ze||!E.hasTextData()||Ae);const dn=!dt.isConstant();!E.collisionArrays&&de&&E.deserializeCollisionBoxes(de),m&&v&&E.updateCollisionDebugBuffers(this.transform.zoom,de,ht,Nt);const Pn=(wi,Qn,Wi)=>{const{crossTileID:la,numVerticalGlyphVertices:_a}=wi;let ya=null;if(X&&X.dynamicFilterNeedsFeature||dn){const dr=this.retainedQueryData[E.bucketInstanceId];ya=je.loadFeature({featureIndex:wi.featureIndex,bucketIndex:dr.bucketIndex,sourceLayerIndex:dr.sourceLayerIndex,layoutVertexArrayOffset:0});const gr=ya.properties?ya.properties.worldview:null;if(E.localizable&&E.worldview&&typeof gr=="string")if(gr==="all")ya.properties.$localized=!0;else{if(!gr.split(",").includes(E.worldview))return;ya.properties.$localized=!0,ya.properties.worldview=E.worldview}}if(X&&!(0,X.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:E.worldview},ya,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new i.P(wi.tileAnchorX,wi.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[la]=new na(!1,!1,!1,!0),void s.add(la);const Rn=dt.evaluate(ya,{});if(s.has(la))return;if(he)return void(this.placements[la]=new na(!1,!1,!1));let mn=!1,ta=!1,Va=!0,Za=!1,ca=!1,Wn=null,gn={box:null,offscreen:null,occluded:null},Oa={box:null},Tr=null,lr=null,Ma=null,Ao=0,Ns=0,Er=0;Wi.textFeatureIndex?Ao=Wi.textFeatureIndex:wi.useRuntimeCollisionCircles&&(Ao=wi.featureIndex),Wi.verticalTextFeatureIndex&&(Ns=Wi.verticalTextFeatureIndex);const ks=E.elevationFeatures?E.elevationFeatures[wi.elevationFeatureIndex]:void 0,to=dr=>{dr.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const gr=this.transform.elevation;dr.elevation=mt?Rn:Rn+i.bV.getAtTileOffset(dr.tileID,new i.P(dr.tileAnchorX,dr.tileAnchorY),gr,ks),dr.elevation+=wi.zOffset},Es=Wi.textBox;if(Es){to(Es);const dr=Ea=>{let Mr=i.bL.horizontal;if(E.allowVerticalPlacement&&!Ea&&this.prevPlacement){const Dn=this.prevPlacement.placedOrientations[la];Dn&&(this.placedOrientations[la]=Dn,Mr=Dn,this.markUsedOrientation(E,Mr,wi))}return Mr},gr=(Ea,Mr)=>{if(E.allowVerticalPlacement&&_a>0&&Wi.verticalTextBox){for(const Dn of E.writingModes)if(Dn===i.bL.vertical?(gn=Mr(),Oa=gn):gn=Ea(),gn&&gn.box&&gn.box.length)break}else gn=Ea()};if(ti){let Ea=ti;if(this.prevPlacement&&this.prevPlacement.variableOffsets[la]){const ir=this.prevPlacement.variableOffsets[la];Ea.indexOf(ir.anchor)>0&&(Ea=Ea.filter((lc=>lc!==ir.anchor)),Ea.unshift(ir.anchor))}const Mr=(ir,lc,tf)=>{const Rc=E.getSymbolInstanceTextSize(pe,wi,this.transform.zoom,Qn),om=(ir.x2-ir.x1)*Rc+2*ir.padding,nf=(ir.y2-ir.y1)*Rc+2*ir.padding,Xl=wi.hasIconTextFit&&!Me?lc:null;Xl&&to(Xl);let Cl={box:[],offscreen:!1,occluded:!1};const Cd=ze?2*Ea.length:Ea.length;for(let Dc=0;Dc<Cd;++Dc){const Lc=this.attemptAnchorPlacement(Ea[Dc%Ea.length],ir,se,ne,bi,om,nf,Rc,Ve,Ye,J,B,ge,Dc>=Ea.length,wi,Qn,E,tf,Xl,pe,xe);if(Lc&&(Cl=Lc.placedGlyphBoxes,Cl&&Cl.box&&Cl.box.length)){mn=!0,Wn=Lc.shift;break}}return Cl};gr((()=>Mr(Es,Wi.iconBox,i.bL.horizontal)),(()=>{const ir=Wi.verticalTextBox;return ir&&to(ir),E.allowVerticalPlacement&&!(gn&&gn.box&&gn.box.length)&&_a>0&&ir?Mr(ir,Wi.verticalIconBox,i.bL.vertical):{box:null,offscreen:null,occluded:null}})),gn&&(mn=gn.box,Va=gn.offscreen,Za=gn.occluded);const Dn=dr(!(!gn||!gn.box));if(!mn&&this.prevPlacement){const ir=this.prevPlacement.variableOffsets[la];ir&&(this.variableOffsets[la]=ir,this.markUsedJustification(E,ir.anchor,wi,Dn))}}else{const Ea=(Mr,Dn)=>{const ir=E.getSymbolInstanceTextSize(pe,wi,this.transform.zoom,Qn),lc=this.collisionIndex.placeCollisionBox(E,ir,Mr,se,ne,bi,new i.P(0,0),ze,J,B,ge.predicate);return lc&&lc.box&&lc.box.length&&(this.markUsedOrientation(E,Dn,wi),this.placedOrientations[la]=Dn),lc};gr((()=>Ea(Es,i.bL.horizontal)),(()=>{const Mr=Wi.verticalTextBox;return E.allowVerticalPlacement&&_a>0&&Mr?(to(Mr),Ea(Mr,i.bL.vertical)):{box:null,offscreen:null,occluded:null}})),dr(!!(gn&&gn.box&&gn.box.length))}}if(Tr=gn,mn=Tr&&Tr.box&&Tr.box.length>0,Va=Tr&&Tr.offscreen,Za=Tr&&Tr.occluded,wi.useRuntimeCollisionCircles){const dr=wi.centerJustifiedTextSymbolIndex>=0?wi.centerJustifiedTextSymbolIndex:wi.verticalPlacedTextSymbolIndex,gr=E.text.placedSymbolArray.get(dr),Ea=i.bM(E.textSizeData,pe,gr),Mr=j.get("text-padding");lr=this.collisionIndex.placeCollisionCircles(E,ze,gr,dr,E.lineVertexArray,E.glyphOffsetArray,Ea,B,V,Y,m,Ye,ge.predicate,wi.collisionCircleDiameter*Ea/i.bY,Mr,this.retainedQueryData[E.bucketInstanceId].tileID),mn=ze||lr.circles.length>0&&!lr.collisionDetected,Va=Va&&lr.offscreen,Za=lr.occluded}if(Wi.iconFeatureIndex&&(Er=Wi.iconFeatureIndex),Wi.iconBox){const dr=gr=>{to(gr);const Ea=wi.hasIconTextFit&&Wn?or(Wn.x,Wn.y,Ve,Ye,this.transform.angle):new i.P(0,0),Mr=E.getSymbolInstanceIconSize(xe,this.transform.zoom,wi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Mr,gr,se,ne,di,Ea,Me,J,B,ge.predicate)};Oa&&Oa.box&&Oa.box.length&&Wi.verticalIconBox?(Ma=dr(Wi.verticalIconBox),ta=Ma.box.length>0):(Ma=dr(Wi.iconBox),ta=Ma.box.length>0),Va=Va&&Ma.offscreen,ca=Ma.occluded}const Al=Ae||wi.numHorizontalGlyphVertices===0&&_a===0,Zl=De||wi.numIconVertices===0;if(Al||Zl?Zl?Al||(ta=ta&&mn):mn=ta&&mn:ta=mn=ta&&mn,mn&&Tr&&Tr.box&&this.collisionIndex.insertCollisionBox(Tr.box,j.get("text-ignore-placement"),E.bucketInstanceId,Oa&&Oa.box&&Ns?Ns:Ao,ge.ID),ta&&Ma&&this.collisionIndex.insertCollisionBox(Ma.box,j.get("icon-ignore-placement"),E.bucketInstanceId,Er,ge.ID),lr&&(mn&&this.collisionIndex.insertCollisionCircles(lr.circles,j.get("text-ignore-placement"),E.bucketInstanceId,Ao,ge.ID),m)){const dr=E.bucketInstanceId;let gr=this.collisionCircleArrays[dr];gr===void 0&&(gr=this.collisionCircleArrays[dr]=new Bd);for(let Ea=0;Ea<lr.circles.length;Ea+=4)gr.circles.push(lr.circles[Ea+0]),gr.circles.push(lr.circles[Ea+1]),gr.circles.push(lr.circles[Ea+2]),gr.circles.push(lr.collisionDetected?1:0)}const $o=E.projection.name!=="globe";_i=_i&&($o||!Za),Bi=Bi&&($o||!ca),this.placements[la]=new na(mn||_i,ta||Bi,Va||E.justReloaded),s.add(la)},Jn=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,Jn),E.elevationType==="road"&&E.updateRoadElevation(Jn.canonical),E.updateZOffset(),E.sortFeaturesByY){const wi=E.getSortedSymbolIndexes(this.transform.angle);for(let Qn=wi.length-1;Qn>=0;--Qn){const Wi=wi[Qn];Pn(E.symbolInstances.get(Wi),Wi,E.collisionArrays[Wi])}E.hasAnyZOffset&&i.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const wi=E.getSortedIndexesByZOffset();for(let Qn=0;Qn<wi.length;++Qn){const Wi=wi[Qn];Pn(E.symbolInstances.get(Wi),Wi,E.collisionArrays[Wi])}}else for(let wi=t.symbolInstanceStart;wi<t.symbolInstanceEnd;wi++)Pn(E.symbolInstances.get(wi),wi,E.collisionArrays[wi]);if(m&&E.bucketInstanceId in this.collisionCircleArrays){const wi=this.collisionCircleArrays[E.bucketInstanceId];i.bl(wi.invProjMatrix,B),wi.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(t,s,m,v){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:D,crossTileID:B}=m,V=i.c3(s),Y=v===i.bL.vertical?D:V==="left"?T:V==="center"?E:V==="right"?j:-1;T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=Y>=0&&T!==Y?0:B),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=Y>=0&&E!==Y?0:B),j>=0&&(t.text.placedSymbolArray.get(j).crossTileID=Y>=0&&j!==Y?0:B),D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=Y>=0&&D!==Y?0:B)}markUsedOrientation(t,s,m){const v=s===i.bL.horizontal||s===i.bL.horizontalOnly?s:0,T=s===i.bL.vertical?s:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:B}=m,V=t.text.placedSymbolArray;E>=0&&(V.get(E).placedOrientation=v),j>=0&&(V.get(j).placedOrientation=v),D>=0&&(V.get(D).placedOrientation=v),B>=0&&(V.get(B).placedOrientation=T)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let m=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const v=s?s.symbolFadeChange(t):1,T=s?s.opacities:{},E=s?s.variableOffsets:{},j=s?s.placedOrientations:{};for(const D in this.placements){const B=this.placements[D],V=T[D];V?(this.opacities[D]=new nc(V,v,B.text,B.icon,null,B.clipped),m=m||B.text!==V.text.placed||B.icon!==V.icon.placed):(this.opacities[D]=new nc(null,v,B.text,B.icon,B.skipFade,B.clipped),m=m||B.text||B.icon)}for(const D in T){const B=T[D];if(!this.opacities[D]){const V=new nc(B,v,!1,!1);V.isHidden()||(this.opacities[D]=V,m=m||B.text.placed||B.icon.placed)}}for(const D in E)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=E[D]);for(const D in j)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=j[D]);m?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,m,v){v&&(this.lastReplacementSourceUpdateTime=v.updateTime);const T=new Set;for(const E of s){const j=E.getBucket(t);j&&E.latestFeatureIndex&&t.fqid===j.layerIds[0]&&(this.updateBucketOpacities(j,T,E,E.collisionBoxArray,m,v,E.tileID,t.scope),j.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(j,E.tileID),j.elevationType==="road"&&j.updateRoadElevation(E.tileID.canonical),j.updateZOffset())}}updateBucketOpacities(t,s,m,v,T,E,j,D){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const B=t.layers[0].layout,V=t.layers[0].paint,Y=!!t.layers[0].dynamicFilter(),X=new nc(null,0,!1,!1,!0),J=B.get("text-allow-overlap"),se=B.get("icon-allow-overlap"),ne=B.get("text-variable-anchor"),he=B.get("text-rotation-alignment")==="map",de=B.get("text-pitch-alignment")==="map",pe=V.get("symbol-z-offset"),xe=B.get("symbol-elevation-reference")==="sea",ge=!pe.isConstant(),je=new nc(null,0,J&&(se||!t.hasIconData()||B.get("icon-optional")),se&&(J||!t.hasTextData()||B.get("text-optional")),!0);!t.collisionArrays&&v&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(v);const Ae=(ze,Me,Ve)=>{for(let it=0;it<Me/4;it++)ze.opacityVertexArray.emplaceBack(Ve)};let De=0;E&&t.updateReplacement(j,E);for(let ze=0;ze<t.symbolInstances.length;ze++){const Me=t.symbolInstances.get(ze),{numHorizontalGlyphVertices:Ve,numVerticalGlyphVertices:it,crossTileID:Ye,numIconVertices:dt,tileAnchorX:mt,tileAnchorY:Tt}=Me;let Ot=null;const st=this.retainedQueryData[t.bucketInstanceId];ge&&Me&&st&&(Ot=m.latestFeatureIndex.loadFeature({featureIndex:Me.featureIndex,bucketIndex:st.bucketIndex,sourceLayerIndex:st.sourceLayerIndex,layoutVertexArrayOffset:0}));const Xe=pe.evaluate(Ot,{}),pt=s.has(Ye);let ht=this.opacities[Ye];pt?ht=X:ht||(ht=je,this.opacities[Ye]=ht),s.add(Ye);const Nt=Ve>0||it>0,ti=dt>0,gi=this.placedOrientations[Ye],Wt=gi===i.bL.vertical,Dt=gi===i.bL.horizontal||gi===i.bL.horizontalOnly;!Nt&&!ti||ht.isHidden()||De++;let Ti=!1;if((Nt||ti)&&E)for(const bi of t.activeReplacements){if(i.bZ(bi,T,i.b_.Symbol,D)||bi.min.x>mt||mt>bi.max.x||bi.min.y>Tt||Tt>bi.max.y)continue;const di=i.b$(mt,Tt,j.canonical,bi.footprintTileId.canonical);if(Ti=i.c0(di,bi.footprint),Ti)break}if(Nt){const bi=Ti?Ks:ro(ht.text);Ae(t.text,Ve,Wt?Ks:bi),Ae(t.text,it,Dt?Ks:bi);const di=ht.text.isHidden(),{leftJustifiedTextSymbolIndex:_i,centerJustifiedTextSymbolIndex:Bi,rightJustifiedTextSymbolIndex:dn,verticalPlacedTextSymbolIndex:Pn}=Me,Jn=t.text.placedSymbolArray,wi=di||Wt?1:0;_i>=0&&(Jn.get(_i).hidden=wi),Bi>=0&&(Jn.get(Bi).hidden=wi),dn>=0&&(Jn.get(dn).hidden=wi),Pn>=0&&(Jn.get(Pn).hidden=di||Dt?1:0);const Qn=this.variableOffsets[Ye];Qn&&this.markUsedJustification(t,Qn.anchor,Me,gi);const Wi=this.placedOrientations[Ye];Wi&&(this.markUsedJustification(t,"left",Me,Wi),this.markUsedOrientation(t,Wi,Me))}if(ti){const bi=Ti?Ks:ro(ht.icon),{placedIconSymbolIndex:di,verticalPlacedIconSymbolIndex:_i}=Me,Bi=t.icon.placedSymbolArray,dn=ht.icon.isHidden()?1:0;di>=0&&(Ae(t.icon,dt,Wt?Ks:bi),Bi.get(di).hidden=dn),_i>=0&&(Ae(t.icon,Me.numVerticalIconVertices,Dt?Ks:bi),Bi.get(_i).hidden=dn)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const bi=t.collisionArrays[ze];if(bi){let di=new i.P(0,0),_i=!0;if(bi.textBox||bi.verticalTextBox){if(ne){const dn=this.variableOffsets[Ye];dn?(di=Is(dn.anchor,dn.width,dn.height,dn.textOffset,dn.textScale),he&&di._rotate(de?this.transform.angle:-this.transform.angle)):_i=!1}Y&&(_i=!ht.clipped),bi.textBox&&_c(t.textCollisionBox.collisionVertexArray,ht.text.placed,!_i||Wt,Xe,xe,di.x,di.y),bi.verticalTextBox&&_c(t.textCollisionBox.collisionVertexArray,ht.text.placed,!_i||Dt,Xe,xe,di.x,di.y)}const Bi=_i&&!!(!Dt&&bi.verticalIconBox);bi.iconBox&&_c(t.iconCollisionBox.collisionVertexArray,ht.icon.placed,Bi,Xe,xe,Me.hasIconTextFit?di.x:0,Me.hasIconTextFit?di.y:0),bi.verticalIconBox&&_c(t.iconCollisionBox.collisionVertexArray,ht.icon.placed,!Bi,Xe,xe,Me.hasIconTextFit?di.x:0,Me.hasIconTextFit?di.y:0)}}}if(t.fullyClipped=De===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ze.invProjMatrix,t.placementViewportMatrix=ze.viewportMatrix,t.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const m=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*m>t}isStale(){return this.stale}setStale(){this.stale=!0}}function _c(f,t,s,m,v,T,E){f.emplaceBack(t?1:0,s?1:0,T||0,E||0,m,v?1:0),f.emplaceBack(t?1:0,s?1:0,T||0,E||0,m,v?1:0),f.emplaceBack(t?1:0,s?1:0,T||0,E||0,m,v?1:0),f.emplaceBack(t?1:0,s?1:0,T||0,E||0,m,v?1:0)}const Ud=Math.pow(2,25),Qu=Math.pow(2,24),ku=Math.pow(2,17),ed=Math.pow(2,16),$d=Math.pow(2,9),ls=Math.pow(2,8),ac=Math.pow(2,1);function ro(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Ud+t*Qu+s*ku+t*ed+s*$d+t*ls+s*ac+t}const Ks=0;class ml{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,m,v,T,E){const j=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(j,v,t[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort(((D,B)=>D.sortKey-B.sortKey)));this._currentPartIndex<j.length;){const D=j[this._currentPartIndex];if(s.placeLayerBucketPart(D,this._seenCrossTileIDs,m,D.symbolInstanceStart===0,E),this._currentPartIndex++,T())return!0}return!1}}class Hr{constructor(t,s,m,v,T,E,j,D,B){this.placement=new ao(t,T,E,j,D,B),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(t,s,m,v,T){const E=i.o.now(),j=()=>{const D=i.o.now()-E;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=s[t[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&D.visibility!=="none"&&(!D.minzoom||D.minzoom<=B)&&(!D.maxzoom||D.maxzoom>B)){const V=D,Y=V.layout.get("symbol-z-elevate"),X=V.layout.get("symbol-sort-key").constantOr(1)!==void 0,J=V.layout.get("symbol-z-order"),se=J==="viewport-y"||J==="auto"&&!(J!=="viewport-y"&&X),ne=V.layout.get("text-allow-overlap")||V.layout.get("icon-allow-overlap")||V.layout.get("text-ignore-placement")||V.layout.get("icon-ignore-placement"),he=se&&ne,de=this._inProgressLayer=this._inProgressLayer||new ml(V),pe=i.B(D.source,D.scope);if(de.continuePlacement(Y||he?v[pe]:m[pe],this.placement,this._showCollisionBoxes,D,j,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Br=512/i.al/2;class Qo{constructor(t,s,m){this.tileID=t,this.bucketInstanceId=m,this.index=new i.c4(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=t.canonical.x*i.al,T=t.canonical.y*i.al;for(let E=0;E<s.length;E++){const{key:j,crossTileID:D,tileAnchorX:B,tileAnchorY:V}=s.get(E),Y=Math.floor((v+B)*Br),X=Math.floor((T+V)*Br);this.index.add(Y,X),this.keys.push(j),this.crossTileIDs.push(D)}this.index.finish()}findMatches(t,s,m){const v=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),T=Br/Math.pow(2,s.canonical.z-this.tileID.canonical.z),E=s.canonical.x*i.al,j=s.canonical.y*i.al;for(let D=0;D<t.length;D++){const B=t.get(D);if(B.crossTileID)continue;const{key:V,tileAnchorX:Y,tileAnchorY:X}=B,J=Math.floor((E+Y)*T),se=Math.floor((j+X)*T),ne=this.index.range(J-v,se-v,J+v,se+v).sort(((he,de)=>he-de));for(const he of ne){const de=this.crossTileIDs[he];if(this.keys[he]===V&&!m.has(de)){m.add(de),B.crossTileID=de;break}}}}}class wr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class td{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const m in this.indexes){const v=this.indexes[m],T={};for(const E in v){const j=v[E];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+s),T[j.tileID.key]=j}this.indexes[m]=T}this.lng=t}addBucket(t,s,m){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let T=0;T<s.symbolInstances.length;T++)s.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const v=this.usedCrossTileIDs[t.overscaledZ];for(const T in this.indexes){const E=this.indexes[T];if(Number(T)>t.overscaledZ)for(const j in E){const D=E[j];D.tileID.isChildOf(t)&&D.findMatches(s.symbolInstances,t,v)}else{const j=E[t.scaledTo(Number(T)).key];j&&j.findMatches(s.symbolInstances,t,v)}}for(let T=0;T<s.symbolInstances.length;T++){const E=s.symbolInstances.get(T);E.crossTileID||(E.crossTileID=m.generate(),v.add(E.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Qo(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const m of s.crossTileIDs)this.usedCrossTileIDs[t].delete(m)}removeStaleBuckets(t){let s=!1;for(const m in this.indexes){const v=this.indexes[m];for(const T in v)t[v[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[T]),delete v[T],s=!0)}return s}}class so{constructor(){this.layerIndexes={},this.crossTileIDs=new wr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,m,v){let T=this.layerIndexes[t.fqid];T===void 0&&(T=this.layerIndexes[t.fqid]=new td);let E=!1;const j={};v.name!=="globe"&&T.handleWrapJump(m);for(const D of s){const B=D.getBucket(t);B&&t.fqid===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(D.tileID,B,this.crossTileIDs)&&(E=!0),j[B.bucketInstanceId]=!0)}return T.removeStaleBuckets(j)&&(E=!0),E}pruneUnusedLayers(t){const s={};t.forEach((m=>{s[m]=!0}));for(const m in this.layerIndexes)s[m]||delete this.layerIndexes[m]}}const pl=771;class sn{constructor(t,s,m,v){this.blendFunction=t,this.blendColor=s.toNonPremultipliedRenderColor(null),this.mask=m,this.blendEquation=v}}sn.Replace=[1,0,1,0],sn.disabled=new sn(sn.Replace,i.ao.transparent,[!1,!1,!1,!1]),sn.unblended=new sn(sn.Replace,i.ao.transparent,[!0,!0,!0,!0]),sn.alphaBlended=new sn([1,pl,1,pl],i.ao.transparent,[!0,!0,!0,!0]),sn.alphaBlendedNonPremultiplied=new sn([770,pl,770,pl],i.ao.transparent,[!0,!0,!0,!0]),sn.multiply=new sn([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),sn.additive=new sn([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class Pi{constructor(t,s,m){this.func=t,this.mask=s,this.range=m}}Pi.ReadOnly=!1,Pi.ReadWrite=!0,Pi.disabled=new Pi(519,Pi.ReadOnly,[0,1]);const gl=7680;class Ki{constructor(t,s,m,v,T,E){this.test=t,this.ref=s,this.mask=m,this.fail=v,this.depthFail=T,this.pass=E}}Ki.disabled=new Ki({func:519,mask:0},0,0,gl,gl,gl);const Eu=1029,id=2305;class en{constructor(t,s,m){this.enable=t,this.mode=s,this.frontFace=m}}function Rs(f,t){const s=i.ca(f,3);i.cc(f,t),i.cg(f,3,s)}function Sf(f,t){const s=i.c7([]);return i.c8(s,s,-t),i.c9(s,s,-f),s}function yc(f,t){const s=[f[0],f[1],0],m=[t[0],t[1],0];if(i.ag(s)>=1e-15){const E=i.aw([],s);i.c5(m,E,i.bJ(m,E)),t[0]=m[0],t[1]=m[1]}const v=i.bI([],t,f);if(i.c6(v)<1e-15)return null;const T=Math.atan2(-v[1],v[0]);return Sf(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),T)}en.disabled=new en(!1,Eu,id),en.backCCW=new en(!0,Eu,id),en.backCW=new en(!0,Eu,2304),en.frontCW=new en(!0,1028,2304),en.frontCCW=new en(!0,1028,id);class Sr{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof i.ae?t:new i.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=i.bT(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s,m){if(this.orientation=null,!this.position)return;const v=this.position,T=m||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(t)):0),E=i.ae.fromLngLat(t,T),j=[E.x-v.x,E.y-v.y,E.z-v.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=yc(j,s)}setPitchBearing(t,s){this.orientation=Sf(i.an(t),i.an(-s))}}class oo{constructor(t,s){this._transform=i.bA([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new i.ae(t[0],t[1],t[2])}get position(){const t=i.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&i.cg(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||i.c7([]),t&&Rs(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=Sf(t,s),Rs(this._transform,this._orientation)}forward(){const t=i.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=i.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=i.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const m=new Float64Array(16);return i.bl(m,this.getWorldToCamera(t,s)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,m){const v=this.position;i.c5(v,v,-t);const T=new Float64Array(16);return i.bq(T,[m,m,m]),i.br(T,T,v),T[10]*=s,T}getWorldToCamera(t,s){const m=new Float64Array(16),v=new Float64Array(4),T=this.position;return i.cb(v,this._orientation),i.c5(T,T,-t),i.cc(m,v),i.br(m,m,T),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=s,m[9]*=s,m[10]*=s,m[11]*=s,m}getCameraToClipPerspective(t,s,m,v){const T=new Float64Array(16);return i.cd(T,t,s,m,v),T}getCameraToClipOrthographic(t,s,m,v,T,E){const j=new Float64Array(16);return i.ce(j,t,s,m,v,T,E),j}getDistanceToElevation(t,s=!1){const m=t===0?0:i.cf(t,s?i.a$(this.position[1]):this.position[1]),v=this.forward();return(m-this.position[2])/v[2]}clone(){return new oo([...this.position],[...this.orientation])}}const Ir={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class nd{constructor(t=0,s=0,m=0,v=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=m,this.right=v}interpolate(t,s,m){return s.top!=null&&t.top!=null&&(this.top=i.ak(t.top,s.top,m)),s.bottom!=null&&t.bottom!=null&&(this.bottom=i.ak(t.bottom,s.bottom,m)),s.left!=null&&t.left!=null&&(this.left=i.ak(t.left,s.left,m)),s.right!=null&&t.right!=null&&(this.right=i.ak(t.right,s.right,m)),this}getCenter(t,s){const m=i.aA((this.left+t-this.right)/2,0,t),v=i.aA((this.top+s-this.bottom)/2,0,s);return new i.P(m,v)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new nd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const No=15;class Au{constructor(t,s,m,v,T,E,j){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(E),this.setMaxBounds(j),this.width=0,this.height=0,this._center=new i.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new nd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new oo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Au(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<No}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(t||m)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=i.cm(this.projectionOptions);const m=this.getProjection(),v=!i.by(s,m);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cm({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=i.cn(),i.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=i.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=i.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,T=0;for(let E=0;E<s.length;E++){const j=new i.P(s[E][0]*this.width,m+s[E][1]*(this.height-m)),D=t.pointCoordinate(j);if(!D)continue;const B=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);v+=D[3]*B,T+=B}return T===0?NaN:v/T}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*s,v=this._mercatorZfromZoom(t),T=this._mercatorZfromZoom(this._maxZoom),E=Math.max(v-m,T);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const s=this.elevation,m=t.elevation,v=s!=null!=(m!=null)||s&&m&&s.exaggeration()!==m.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!v}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let m;m=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const v=i.ag(i.av([],this._camera.position,m));return i.aA(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!i.cp(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const m=[t.position.x,t.position.y,t.position.z];i.cq(m,this._camera.position)||(this._setCameraPosition(m),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new Sr;return s.position=new i.ae(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!i.cr(t))return!1;i.cs(t,t);const s=i.ct([],[0,0,-1],t),m=i.ct([],[0,-1,0],t);if(m[2]<0)return!1;const v=yc(s,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;t[2]=i.aA(t[2],v/m,v/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,m){this._unmodified=!1,this._edgeInsets.interpolate(t,s,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new i.cu(0,t)];if(this.renderWorldCopies){const m=this.pointCoordinate(new i.P(0,0)),v=this.pointCoordinate(new i.P(this.width,0)),T=this.pointCoordinate(new i.P(this.width,this.height)),E=this.pointCoordinate(new i.P(0,this.height)),j=Math.floor(Math.min(m.x,v.x,T.x,E.x)),D=Math.floor(Math.max(m.x,v.x,T.x,E.x)),B=1;for(let V=j-B;V<=D+B;V++)V!==0&&s.push(new i.cu(V,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,m,v){let T=[];const E=m!=null,j=!E;if(j&&this.zoom<s||E&&m[0]===0&&m[1]===0)return T;const D=new Set,B=(Y,X,J,se,ne)=>{const he=i.cY(X,Y,J,se,ne);D.has(he)||(T.push(new i.aQ(Y,X,J,se,ne)),D.add(he))};for(let Y=0;Y<t.length;Y++){const X=t[Y];if(j&&X.canonical.z!==s||E&&v!==void 0&&v>X.canonical.z)continue;const J=X.canonical,se=X.overscaledZ,ne=X.wrap,he=1<<J.z,de=J.x+1<he,pe=J.x>0,xe=J.y+1<he,ge=J.y>0,je=X.wrap-(pe?0:1),Ae=X.wrap+(de?0:1),De=pe?J.x-1:he-1,ze=de?J.x+1:0;if(E)m[0]<0?(B(se,Ae,J.z,ze,J.y),m[1]<0&&xe&&(B(se,ne,J.z,J.x,J.y+1),B(se,Ae,J.z,ze,J.y+1)),m[1]>0&&ge&&(B(se,ne,J.z,J.x,J.y-1),B(se,Ae,J.z,ze,J.y-1))):m[0]>0?(B(se,je,J.z,De,J.y),m[1]<0&&xe&&(B(se,ne,J.z,J.x,J.y+1),B(se,je,J.z,De,J.y+1)),m[1]>0&&ge&&(B(se,ne,J.z,J.x,J.y-1),B(se,je,J.z,De,J.y-1))):m[1]<0&&xe?B(se,ne,J.z,J.x,J.y+1):ge&&B(se,ne,J.z,J.x,J.y-1);else{const Me=X.visibleQuadrants;1&Me&&(B(se,je,J.z,De,J.y),ge&&(B(se,ne,J.z,J.x,J.y-1),B(se,je,J.z,De,J.y-1))),2&Me&&(B(se,Ae,J.z,ze,J.y),ge&&(B(se,ne,J.z,J.x,J.y-1),B(se,Ae,J.z,ze,J.y-1))),4&Me&&(B(se,je,J.z,De,J.y),xe&&(B(se,ne,J.z,J.x,J.y+1),B(se,je,J.z,De,J.y+1))),8&Me&&(B(se,Ae,J.z,ze,J.y),xe&&(B(se,ne,J.z,J.x,J.y+1),B(se,Ae,J.z,ze,J.y+1)))}}const V=[];for(const Y of T)T.some((X=>Y.isChildOf(X)))||V.push(Y);if(T=V.filter((Y=>!t.some((X=>!!(Y.overscaledZ<s&&X.isChildOf(Y))||Y.equals(X)||Y.isChildOf(X))))),j){const Y=1<<s,X=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=[Y*X.x,Y*X.y],se=4,ne=se*se;T=T.filter((he=>{const de=he.canonical.x+.5-J[0],pe=he.canonical.y+.5-J[1];return de*de+pe*pe<ne}))}return T}extendTileCoverToNearPlane(t,s,m){const v=[],T=new Set;for(const pe of t)T.add(pe.key);const E=(pe,xe,ge,je,Ae)=>{const De=i.cY(xe,pe,ge,je,Ae);T.has(De)||(v.push(new i.aQ(pe,xe,ge,je,Ae)),T.add(De))},j=t.reduce(((pe,xe)=>Math.max(pe,xe.overscaledZ)),m),D=1<<m,B=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],V=new i.P(0,0),Y=new i.P(0,0),X=(pe,xe)=>{const ge=Math.floor(pe[0]),je=Math.floor(pe[1]),Ae=(pe[0]-ge)*i.al,De=(pe[1]-je)*i.al,ze=Math.floor(xe[0]),Me=Math.floor(xe[1]),Ve=(xe[0]-ze)*i.al,it=(xe[1]-Me)*i.al;for(let Ye=-1;Ye<=1;Ye++){const dt=ge+Ye;if(!(dt<0||dt>=D)){V.x=Ae-Ye*i.al,Y.x=Ve-(dt-ze)*i.al;for(let mt=-1;mt<=1;mt++){const Tt=je+mt;V.y=De-mt*i.al,Y.y=it-(Tt-Me)*i.al,i.cZ(V,Y,B)&&E(j,0,m,dt,Tt)}}}},J=s.points,se=J[i.cv],ne=J[i.cw],he=this._projectToGround(se,J[i.cx]),de=this._projectToGround(ne,J[i.cy]);return X(se,he),X(ne,de),v}_projectToGround(t,s){return i.cz(i.cA(),t,s,t[2]/(t[2]-s[2]))}coveringTiles(t){let s=this.coveringZoomLevel(t);const m=s,v=this.elevation&&this.elevation.exaggeration(),T=v&&!t.isTerrainDEM,E=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const j=this.locationCoordinate(this.center),D=this.center.lat,B=1<<s,V=[B*j.x,B*j.y,0],Y=this.projection.name==="globe",X=!Y,J=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,X),se=Y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ne=B*i.cf(1,this.center.lat),he=this._camera.position[2]/i.cf(1,this.center.lat),de=[B*se.x,B*se.y,he*(X?1:ne)],pe=Y||v,xe=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ge=this.isLODDisabled(!0)?s:0;let je;if(this._elevation&&t.isTerrainDEM)je=1e4*this._elevation.exaggeration();else if(this._elevation){const Xe=this._elevation.getMinMaxForVisibleTiles();je=Xe?Xe.max:this._centerAltitude}else je=this._centerAltitude;const Ae=t.isTerrainDEM?-je:this._elevation?this._elevation.getMinElevationBelowMSL():0,De=this.projection.isReprojectedInTileSpace?i.cC(this):1,ze=Xe=>{const ht=new i.ae(Xe.x+25e-6,Xe.y,Xe.z),Nt=new i.ae(Xe.x,Xe.y+25e-6,Xe.z),ti=Xe.toLngLat(),gi=ht.toLngLat(),Wt=Nt.toLngLat(),Dt=this.locationCoordinate(ti),Ti=this.locationCoordinate(gi),bi=this.locationCoordinate(Wt),di=Math.hypot(Ti.x-Dt.x,Ti.y-Dt.y),_i=Math.hypot(bi.x-Dt.x,bi.y-Dt.y);return Math.sqrt(di*_i)*De/25e-6},Me=Xe=>{const pt=je,ht=Ae;return{aabb:i.cF(this,B,0,0,0,Xe,ht,pt,this.projection),zoom:0,x:0,y:0,minZ:ht,maxZ:pt,wrap:Xe,fullyVisible:!1}},Ve=[];let it=[];const Ye=s,dt=t.reparseOverscaled?m:s,mt=(he-this._centerAltitude)*ne,Tt=Xe=>{if(!this._elevation||!Xe.tileID||!E)return;const pt=this._elevation.getMinMaxForTile(Xe.tileID),ht=Xe.aabb;pt?(ht.min[2]=pt.min,ht.max[2]=pt.max,ht.center[2]=(ht.min[2]+ht.max[2])/2):(Xe.shouldSplit=st(Xe),Xe.shouldSplit||(ht.min[2]=ht.max[2]=ht.center[2]=this._centerAltitude))},Ot=(Xe,pt)=>{if(.707*pt<Xe)return 1;const ht=pt/Xe;return ht/(1.4144271570014144+(Math.pow(1.1,ht-1.4144271570014144+1)-1)/(1.1-1)-1)},st=Xe=>{if(Xe.zoom<ge)return!0;if(Xe.zoom===Ye)return!1;if(Xe.shouldSplit!=null)return Xe.shouldSplit;const pt=Xe.aabb.distanceX(de),ht=Xe.aabb.distanceY(de);let Nt=mt,ti=1;if(Y){Nt=Xe.aabb.distanceZ(de);const _i=Math.pow(2,Xe.zoom),Bi=i.a$((Xe.y+1)/_i),dn=i.a$(Xe.y/_i),Pn=Math.min(Math.max(D,Bi),dn),Jn=i.d1(Pn)/i.d1(D);if(ti=Pn===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Jn/this._mercatorScaleRatio),this.zoom<=i.c_&&Xe.zoom===Ye-1&&Jn>=.9)return!0}else if(T&&(Nt=Xe.aabb.distanceZ(de)*ne),this.projection.isReprojectedInTileSpace&&m<=5){const _i=Math.pow(2,Xe.zoom),Bi=ze(new i.ae((Xe.x+.5)/_i,(Xe.y+.5)/_i));ti=Bi>.85?1:Bi}if(!E&&!Y){const _i=Math.sqrt(pt*pt+ht*ht+Nt*Nt);let Bi=(1<<Ye-Xe.zoom)*xe*ti;return Bi*=Ot(Math.max(Nt,mt),_i),_i<Bi}let gi=Number.MAX_VALUE,Wt=0;const Dt=Xe.aabb.getCorners(),Ti=[];for(const _i of Dt){i.av(Ti,_i,de),Y||(T?Ti[2]*=ne:Ti[2]=mt);const Bi=i.bJ(Ti,this._camera.forward());Bi<gi&&(gi=Bi,Wt=Math.abs(Ti[2]))}let bi=(1<<Ye-Xe.zoom)*xe*ti;if(bi*=Ot(Math.max(Wt,mt),gi),gi<bi)return!0;const di=Xe.aabb.closestPoint(V);return di[0]===V[0]&&di[1]===V[1]};if(this.renderWorldCopies)for(let Xe=1;Xe<=3;Xe++)Ve.push(Me(-Xe)),Ve.push(Me(Xe));for(Ve.push(Me(0));Ve.length>0;){const Xe=Ve.pop(),pt=Xe.x,ht=Xe.y;let Nt=Xe.fullyVisible;const ti=()=>this.projection.name==="globe"&&(Xe.y===0||Xe.y===(1<<Xe.zoom)-1);if(!Nt){let gi=pe?Xe.aabb.intersects(J):Xe.aabb.intersectsFlat(J);if(gi===0&&ti()){const Wt=new i.cD(Xe.zoom,pt,ht);gi=i.cE(this,B,Wt,!0).intersects(J)}if(gi===0)continue;Nt=gi===2}if(Xe.zoom!==Ye&&st(Xe))for(let gi=0;gi<4;gi++){const Wt=(pt<<1)+gi%2,Dt=(ht<<1)+(gi>>1),Ti={aabb:E?Xe.aabb.quadrant(gi):i.cF(this,B,Xe.zoom+1,Wt,Dt,Xe.wrap,Xe.minZ,Xe.maxZ,this.projection),zoom:Xe.zoom+1,x:Wt,y:Dt,wrap:Xe.wrap,fullyVisible:Nt,tileID:void 0,shouldSplit:void 0,minZ:Xe.minZ,maxZ:Xe.maxZ};T&&!Y&&(Ti.tileID=new i.aQ(Xe.zoom+1===Ye?dt:Xe.zoom+1,Xe.wrap,Xe.zoom+1,Wt,Dt),Tt(Ti)),Ve.push(Ti)}else{const gi=Xe.zoom===Ye?dt:Xe.zoom;if(t.minzoom&&t.minzoom>gi)continue;let Wt=0;if(!Nt){let di=pe?Xe.aabb.intersectsPrecise(J):Xe.aabb.intersectsPreciseFlat(J);if(di===0&&ti()){const _i=new i.cD(Xe.zoom,pt,ht);di=i.cE(this,B,_i,!0).intersectsPrecise(J)}if(di===0)continue;if(t.calculateQuadrantVisibility)if(J.containsPoint(Xe.aabb.center))Wt=15;else for(let _i=0;_i<4;_i++)Xe.aabb.quadrant(_i).intersects(J)!==0&&(Wt|=1<<_i)}const Dt=V[0]-(.5+pt+(Xe.wrap<<Xe.zoom))*(1<<s-Xe.zoom),Ti=V[1]-.5-ht,bi=Xe.tileID?Xe.tileID:new i.aQ(gi,Xe.wrap,Xe.zoom,pt,ht);t.calculateQuadrantVisibility&&(bi.visibleQuadrants=Wt),it.push({tileID:bi,distanceSq:Dt*Dt+Ti*Ti})}}if(this.fogCullDistSq){const Xe=this.fogCullDistSq,pt=this.horizonLineFromTop();it=it.filter((ht=>{const Nt=[0,0,0,1],ti=[i.al,i.al,0,1],gi=this.calculateFogTileMatrix(ht.tileID.toUnwrapped());i.aC(Nt,Nt,gi),i.aC(ti,ti,gi);const Wt=i.cG([],Nt,ti),Dt=i.cH([],Nt,ti),Ti=i.c$(Wt,Dt);if(Ti===0)return!0;let bi=!1;const di=this._elevation;if(di&&Ti>Xe&&pt!==0){const _i=this.calculateProjMatrix(ht.tileID.toUnwrapped());let Bi;t.isTerrainDEM||(Bi=di.getMinMaxForTile(ht.tileID)),Bi||(Bi={min:Ae,max:je});const dn=i.cI(this.rotation),Pn=[dn[0]*i.al,dn[1]*i.al,Bi.max];i.af(Pn,Pn,_i),bi=(1-Pn[1])*this.height*.5<pt}return Ti<Xe||bi}))}return it.sort(((Xe,pt)=>Xe.distanceSq-pt.distanceSq)).map((Xe=>Xe.tileID))}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const s=i.aA(t.lat,-i.cJ,i.cJ),m=this.projection.project(t.lng,s);return new i.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let m,v;const T=this.centerPoint;if(this.projection.name==="globe"){const j=this.worldSize;m=(s.x-T.x)/j,v=(s.y-T.y)/j}else{const j=this.pointCoordinate(s),D=this.pointCoordinate(T);m=j.x-D.x,v=j.y-D.y}const E=this.locationCoordinate(t);this.setLocation(new i.ae(E.x-m,E.y-v))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const m=s?i.cf(s,t.lat):void 0,v=this.projection.project(t.lng,t.lat);return new i.ae(v.x,v.y,m)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const m=s??this._centerAltitude,v=[t.x,t.y,0,1],T=[t.x,t.y,1,1];i.aC(v,v,this.pixelMatrixInverse),i.aC(T,T,this.pixelMatrixInverse);const E=T[3];i.cK(v,v,1/v[3]),i.cK(T,T,1/E);const j=v[2],D=T[2];return{p0:v,p1:T,t:j===D?0:(m-j)/(D-j)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],m=[t.x,t.y,1,1];return i.aC(s,s,this.pixelMatrixInverse),i.aC(m,m,this.pixelMatrixInverse),i.cK(s,s,1/s[3]),i.cK(m,m,1/m[3]),s[2]=i.cf(s[2],this._center.lat)*this.worldSize,m[2]=i.cf(m[2],this._center.lat)*this.worldSize,i.cK(s,s,1/this.worldSize),i.cK(m,m,1/this.worldSize),new i.ax([s[0],s[1],s[2]],i.aw([],i.av([],m,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:m,t:v}=t,T=i.cf(s[2],this._center.lat),E=i.cf(m[2],this._center.lat);return new i.ae(i.ak(s[0],m[0],v)/this.worldSize,i.ak(s[1],m[1],v)/this.worldSize,i.ak(T,E,v))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let m=this.projection.pointCoordinate3D(this,t.x,t.y);if(m)return new i.ae(m[0],m[1],m[2]);let v=0,T=this.horizonLineFromTop();if(t.y>T)return this.pointCoordinate(t,s);const E=.02*T,j=t.clone();for(let D=0;D<10&&T-v>E;D++){j.y=i.ak(v,T,.66);const B=this.projection.pointCoordinate3D(this,j.x,j.y);B?(T=j.y,m=B):v=j.y}return m?new i.ae(m[0],m[1],m[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=i.cL)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const m=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,v=[t.x*this.worldSize,t.y*this.worldSize,m+t.toAltitude(),1];return i.aC(v,v,this.pixelMatrix),v[3]>0?new i.P(v[0]/v[3],v[1]/v[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,T=this.pointLocation3D(new i.P(s,t)),E=this.pointLocation3D(new i.P(v,t)),j=this.pointLocation3D(new i.P(v,m)),D=this.pointLocation3D(new i.P(s,m));let B=Math.min(T.lng,E.lng,j.lng,D.lng),V=Math.max(T.lng,E.lng,j.lng,D.lng),Y=Math.min(T.lat,E.lat,j.lat,D.lat),X=Math.max(T.lat,E.lat,j.lat,D.lat);const J=Math.pow(2,-this.zoom)/16*270,se=this.projection.name==="globe"?1:4,ne=(he,de,pe,xe,ge)=>{const je=(he+pe)/2,Ae=(de+xe)/2,De=new i.P(je,Ae),{lng:ze,lat:Me}=this.pointLocation3D(De),Ve=Math.max(0,B-ze,Y-Me,ze-V,Me-X);B=Math.min(B,ze),V=Math.max(V,ze),Y=Math.min(Y,Me),X=Math.max(X,Me),(ge<se||Ve>J)&&(ne(he,de,je,Ae,ge+1),ne(je,Ae,pe,xe,ge+1))};if(ne(s,t,v,t,1),ne(v,t,v,m,1),ne(v,m,s,m,1),ne(s,m,s,t,1),this.projection.name==="globe"){const[he,de]=i.cM(this);he?(X=90,V=180,B=-180):de&&(Y=-90,V=180,B=-180)}return new i.aI(new i.aT(B,Y),new i.aT(V,X))}_getBoundsRectangular(t,s){const{top:m,left:v}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,j=new i.P(v,m),D=new i.P(E,m),B=new i.P(E,T),V=new i.P(v,T);let Y=this.pointCoordinate(j,t),X=this.pointCoordinate(D,t);const J=this.pointCoordinate(B,s),se=this.pointCoordinate(V,s),ne=(he,de)=>(de.y-he.y)/(de.x-he.x);return Y.y>1&&X.y>=0?Y=new i.ae((1-se.y)/ne(se,Y)+se.x,1):Y.y<0&&X.y<=1&&(Y=new i.ae(-se.y/ne(se,Y)+se.x,0)),X.y>1&&Y.y>=0?X=new i.ae((1-J.y)/ne(J,X)+J.x,1):X.y<0&&Y.y<=1&&(X=new i.ae(-J.y/ne(J,X)+J.x,0)),new i.aI().extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(J))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce(((m,v)=>{if(v.dem){const T=v.dem.tree;m.min=Math.min(m.min,T.minimums[0]),m.max=Math.max(m.max,T.maximums[0])}return m}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-i.cJ,this.maxLat=i.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,m=this._distanceTileDataCache;if(m[s])return m[s];const v=t.canonical,T=1/this.height,E=this.cameraWorldSize,j=E/this.zoomScale(v.z),D=(v.x+Math.pow(2,v.z)*t.wrap)*j,B=v.y*j,V=this.point;V.x*=E/this.worldSize,V.y*=E/this.worldSize;const Y=this.angle,X=Math.sin(-Y),J=-Math.cos(-Y);return m[s]={bearing:[X,J],center:[(V.x-D)*T,(V.y-B)*T],scale:j/i.al*T},m[s]}calculateFogTileMatrix(t){const s=t.key,m=this._fogTileMatrixCache;if(m[s])return m[s];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return i.aB(v,this.worldToFogMatrix,v),m[s]=new Float32Array(v),m[s]}calculateProjMatrix(t,s=!1,m=!1){const v=t.key;let T;if(T=m?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,T[v])return T[v];const E=this.calculatePosMatrix(t,this.worldSize);let j;return j=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,i.aB(E,j,E),T[v]=new Float32Array(E),T[v]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,m=this._pixelsToTileUnitsCache;if(m[s])return m[s];const v=i.cN(t,this);return m[s]=v,m[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=i.bq([],[t,t,t]);return i.aB(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=i.cf(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(s),v=this._camera.forward(),T=i.cf(1,this._center.lat);m[2]/=T,v[2]/=T,i.aw(v,v);const E=t.raycast(m,v,t.exaggeration());if(E){const j=i.bH([],m,v,E),D=new i.ae(j[0],j[1],i.cf(j[2],i.a$(j[1]))),B=(D.z+i.ag([D.x-m[0],D.y-m[1],D.z-m[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,m=i.cf(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(m),T=s.getAtPointOrZero(new i.ae(...v)),E=this.pixelsPerMeter/this.worldSize*T,j=this._minimumHeightOverTerrain(),D=v[2]-E;if(D<=j)if(D<0||t){const B=this.locationCoordinate(this._center,this._centerAltitude),V=[v[0],v[1],B.z-v[2]],Y=i.ag(V);V[2]-=(j-D)/this._pixelsPerMercatorPixel;const X=i.ag(V);if(X===0)return;i.c5(V,V,Y/X*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],B.z*this._pixelsPerMercatorPixel-V[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const X=this.center;return X.lat=i.aA(X.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(X.lng=i.aA(X.lng,this.minLng,this.maxLng)),this.center=X,void(this._constraining=!1)}const s=this._unmodified,{x:m,y:v}=this.point;let T=0,E=m,j=v;const D=this.width/2,B=this.height/2,V=this.worldMinY*this.scale,Y=this.worldMaxY*this.scale;if(v-B<V&&(j=V+B),v+B>Y&&(j=Y-B),Y-V<this.height&&(T=Math.max(T,this.height/(Y-V)),j=(Y+V)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const X=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,se=this.worldSize/2-(X+J)/2;E=(m+se+this.worldSize)%this.worldSize-se,E-D<X&&(E=X+D),E+D>J&&(E=J-D),J-X<this.width&&(T=Math.max(T,this.width/(J-X)),E=(J+X)/2)}E===m&&j===v||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(E,j))),T&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.cf(1,this.center.lat)/i.cf(1,i.d2));const v=i.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?m:1,E=this._camera.getWorldToCamera(this.worldSize,T);let j;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-t.x/this.width,D[9]=2*t.y/this.height,this.isOrthographic){let Me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ve=Me*this.aspect,it=-Ve,Ye=-Me;Ve-=t.x,it-=t.x,Me+=t.y,Ye+=t.y,j=this._camera.getCameraToClipOrthographic(it,Ve,Ye,Me,this._nearZ,this._farZ),((dt,mt,Tt,Ot)=>{for(let st=0;st<16;st++)dt[st]=i.ak(mt[st],Tt[st],Ot)})(j,j,D,i.d0(this.pitch>=No?1:this.pitch/No))}else j=D;const B=i.cP([],D,E);let V=i.cP([],j,E);if(this.projection.isReprojectedInTileSpace){const Me=this.locationCoordinate(this.center),Ve=i.bA([]);i.br(Ve,Ve,[Me.x*this.worldSize,Me.y*this.worldSize,0]),i.aB(Ve,Ve,i.cQ(this)),i.br(Ve,Ve,[-Me.x*this.worldSize,-Me.y*this.worldSize,0]),i.aB(V,V,Ve),i.aB(B,B,Ve),this.inverseAdjustmentMatrix=i.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cS([],V,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=V,this.invProjMatrix=i.bl(new Float64Array(16),this.projMatrix),s){const Me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Me[8]=2*-t.x/this.width,Me[9]=2*t.y/this.height,this.expandedFarZProjMatrix=i.cP([],Me,E)}else this.expandedFarZProjMatrix=this.projMatrix;const Y=i.bl([],j);this.frustumCorners=i.cT.fromInvProjectionMatrix(Y,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const X=new Float32Array(16);i.bA(X),i.cS(X,X,[1,-1,1]),i.cU(X,X,this._pitch),i.bB(X,X,this.angle);const J=i.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bz(J);const se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;J[8]=2*-t.x/this.width,J[9]=2*(t.y+se)/this.height,this.skyboxMatrix=i.aB(X,J,X);const ne=this.point,he=ne.x,de=ne.y,pe=this.width%2/2,xe=this.height%2/2,ge=Math.cos(this.angle),je=Math.sin(this.angle),Ae=he-Math.round(he)+ge*pe+je*xe,De=de-Math.round(de)+ge*xe+je*pe,ze=new Float64Array(V);if(i.br(ze,ze,[Ae>.5?Ae-1:Ae,De>.5?De-1:De,0]),this.alignedProjMatrix=ze,V=i.bC(),i.cS(V,V,[this.width/2,-this.height/2,1]),i.br(V,V,[1,-1,0]),this.labelPlaneMatrix=V,V=i.bC(),i.cS(V,V,[1,-1,1]),i.br(V,V,[-1,-1,0]),i.cS(V,V,[2/this.width,2/this.height,1]),this.glCoordMatrix=V,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,B),this._calcFogMatrices(),this._distanceTileDataCache={},V=i.bl(new Float64Array(16),this.pixelMatrix),!V)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=V,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cV(this);const Me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(Me,Me,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=V;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,T=[t,t,s];i.c5(T,T,v),i.c5(m,m,-1),i.cW(m,m,T);const E=i.bC();i.br(E,E,m),i.cS(E,E,T),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,v)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*T,v.y/this.worldSize-m[1]*T,t/this.worldSize*this._centerAltitude-m[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],v=t[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(T=Math.min((s-m)/v,1)),this._camera.position=i.bH([],this._camera.position,t,T),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),T=i.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),j=Math.max((t[2]-T)/Math.cos(m),E),D=this._zoomFromMercatorZ(j);i.bH(t,t,s,j),this._pitch=i.aA(m,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bT(v,-Math.PI,Math.PI),this._setZoom(i.aA(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,m=i.cL,v=0,T=1/0;for(;m-s>1e-6&&m>s;){const E=s+.5*(m-s),j=this.tileSize*Math.pow(2,E),D=this.getCameraToCenterDistance(this.projection,E,j),B=this.scaleZoom(D/(Math.max(0,t)*this.tileSize)),V=Math.abs(E-B);V<T&&(T=V,v=E),E<B?s=E:m=E}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const m=Math.min(t.x,s.x),v=Math.max(t.x,s.x),T=Math.min(t.y,s.y),E=Math.max(t.y,s.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const j=[new i.P(m,T),new i.P(v,E),new i.P(m,E),new i.P(v,T)],D=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const V of j){const Y=this.pointRayIntersection(V);if(Y.t<0)return!0;const X=this.rayIntersectionCoordinate(Y);if(X.x<D||X.y<0||X.x>B||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(t,s){const m=i.ag(i.av([],this._camera.position,t)),v=this._zoomFromMercatorZ(m)+s;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([s,m,v],T){const E=[s,m,v,1];i.aC(E,E,T);const j=E[3]=Math.max(E[3],1e-6);return E[0]/=j,E[1]/=j,E[2]/=j,E})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,m=this.worldSize){const v=i.cO(t,s,this.width,this.height,1024),T=t.pixelSpaceConversion(this.center.lat,m,v);let E=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(E=i.ak(1,E,i.d0(this.pitch>=No?1:this.pitch/No))),E}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(t,t,this.globeMatrix),t}getFrustum(t){return i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const _l=(f,t)=>{if(t>0&&f.terrain&&i.w("Cutoff is currently disabled on terrain"),t<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=f.transform,m=Math.max(Math.abs(s._zoom-(f.minCutoffZoom-1)),1),v=s.isLODDisabled(!1)?i.ah(60,45,s.pitch):i.ah(30,15,s.pitch),T=s._farZ-s._nearZ,E=t*s.height,j=((1-(D=v))*s.cameraToCenterDistance+D*(s._farZ+E))*m;var D;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(j-s._nearZ)/T,(j-E-s._nearZ)/T]}}},wo=2048;class So{constructor(t,s){this.aabb=t,this.lastCascade=s}}class ad{add(t,s){const m=this.receivers[t.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],s.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],s.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],s.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],s.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],s.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],s.max[2])):this.receivers[t.key]=new So(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,m){const v=i.d9.fromPoints(t.points);let T=0;for(const E in this.receivers){const j=this.receivers[E];if(!j||!v.intersectsAabb(j.aabb))continue;j.aabb.min=v.closestPoint(j.aabb.min),j.aabb.max=v.closestPoint(j.aabb.max);const D=j.aabb.getCorners();for(let B=0;B<m.length;B++){let V=!0;for(const Y of D){const X=[Y[0]*s,Y[1]*s,Y[2]];if(i.af(X,X,m[B].matrix),X[0]<-1||X[0]>1||X[1]<-1||X[1]>1){V=!1;break}}if(j.lastCascade=B,T=Math.max(T,B),V)break}}return T+1}}class yl{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ad,this._depthMode=new Pi(t.context.gl.LEQUAL,Pi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const v=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||v<=0||(this._shadowLayerCount=m.style.order.reduce(((se,ne)=>{const he=m.style._mergedLayers[ne];return se+(he.hasShadowPass()&&!he.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=m.context,E=wo,j=wo;if(this._cascades.length===0||wo!==this._cascades[0].texture.size[0]){this._cascades=[];for(let se=0;se<2;++se){const ne=m._shadowMapDebug,he=T.gl,de=T.createFramebuffer(E,j,ne?1:0,"texture"),pe=new i.T(T,{width:E,height:j,data:null},he.DEPTH_COMPONENT16);if(de.depthAttachment.set(pe.texture),ne){const xe=new i.T(T,{width:E,height:j,data:null},he.RGBA8);de.colorAttachment0.set(xe.texture)}this._cascades.push({framebuffer:de,texture:pe,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cB,scale:0})}}this.shadowDirection=rd(s);let D=0;if(t.elevation){const se=t.elevation,ne=[1e4,-1e4];se.visibleDemTiles.filter((he=>he.dem)).forEach((he=>{const de=he.dem.tree;ne[0]=Math.min(ne[0],de.minimums[0]),ne[1]=Math.max(ne[1],de.maximums[0])})),ne[0]!==1e4&&(D=(ne[1]-ne[0])*se.exaggeration())}const B=1.5*t.cameraToCenterDistance,V=3*B,Y=new Float64Array(16);for(let se=0;se<this._cascades.length;++se){const ne=this._cascades[se];let he=t.height/50,de=1;se===0?de=B:(he=B,de=V);const[pe,xe]=el(t,this.shadowDirection,he,de,wo,D);ne.scale=t.scale,ne.matrix=pe,ne.boundingSphereRadius=xe,i.bl(Y,ne.matrix),ne.frustum=i.cB.fromInvProjectionMatrix(Y,1,0,!0),ne.far=de}const X=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[X].far,this._cascades[X].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=wo,this._uniformValues.u_shadowmap_0=Ir.ShadowMap0,this._uniformValues.u_shadowmap_1=Ir.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const J=m.transform.elevation;for(const se of this._groundShadowTiles){let ne={min:0,max:0};if(J){const he=J.getMinMaxForTile(se);he&&(ne=he)}this.addShadowReceiver(se.toUnwrapped(),ne.min,ne.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const m=this.painter,v=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),v.viewport.set([0,0,wo,wo]);for(let T=0;T<this._numCascadesToRender;++T){m.currentShadowCascade=T,v.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),v.clear({color:i.ao.white,depth:1});for(const E of t.order){const j=t._mergedLayers[E];if(!j.hasShadowPass()||j.isHidden(m.transform.zoom))continue;const D=t.getLayerSourceCache(j),B=D?s[D.id]:void 0;(j.type==="model"||B&&B.length)&&m.renderLayer(m,D,j,B)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,m=t.context,v=m.gl,T=s.directionalLight,E=s.ambientLight;if(!T||!E)return;const j=[],D=_l(t,t.longestCutoffRange);D.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),j.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&j.push("NORMAL_OFFSET");const B=Ds(s,T,E),V=new Pi(v.LEQUAL,Pi.ReadOnly,t.depthRangeFor3D),Y=new Ki({func:v.EQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.KEEP);for(const X of this._groundShadowTiles){const J=X.toUnwrapped(),se=t.isTileAffectedByFog(X),ne=t.getOrCreateProgram("groundShadow",{defines:j,overrideFog:se});this.setupShadows(J,ne),t.uploadCommonUniforms(m,ne,J,null,D);const he={u_matrix:t.transform.calculateProjMatrix(J),u_ground_shadow_factor:B};ne.draw(t,v.TRIANGLES,V,Y,sn.multiply,en.disabled,he,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?sn.unblended:sn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,m=s.calculatePosMatrix(t,s.worldSize);return i.aB(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(t){const s=i.bz(t);return i.aB(s,this._cascades[this.painter.currentShadowCascade].matrix,t),s}setupShadows(t,s,m){if(!this.enabled)return;const v=this.painter.transform,T=this.painter.context,E=T.gl,j=this._uniformValues,D=new Float64Array(16),B=v.calculatePosMatrix(t,v.worldSize);for(let V=0;V<this._cascades.length;V++)i.aB(D,this._cascades[V].matrix,B),j[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),T.activeTexture.set(E.TEXTURE0+Ir.ShadowMap0+V),this._cascades[V].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);if(this.useNormalOffset=!!m,this.useNormalOffset){const V=i.d7(t.canonical),Y=2/v.tileSize*i.al/wo,X=Y*this._cascades[0].boundingSphereRadius,J=Y*this._cascades[this._cascades.length-1].boundingSphereRadius,se=(m==="vector-tile"?1:3)*(function(ne,he,de,pe,xe){const ge=i.aA((ne-22)/-22,0,1);return .125*(1-ge)+4*ge})(v.zoom);j.u_shadow_normal_offset=[V,X*se,J*se],j.u_shadow_bias=[1e-4,.0012,.012]}else j.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(T,j)}setupShadowsFromMatrix(t,s,m=!1){if(!this.enabled)return;const v=this.painter.context,T=v.gl,E=this._uniformValues,j=new Float64Array(16);for(let D=0;D<2;D++)i.aB(j,this._cascades[D].matrix,t),E[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(j),v.activeTexture.set(T.TEXTURE0+Ir.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);this.useNormalOffset=m,m?(E.u_shadow_normal_offset=[1,3,3],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],s.setShadowUniformValues(v,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,m,v){if(v[2]>=0)return{};const T=(function(D,B,V){const Y=V/(1<<D.canonical.z);return new i.d9([D.canonical.x*Y+D.wrap*V,D.canonical.y*Y+D.wrap*V,0],[(D.canonical.x+1)*Y+D.wrap*V,(D.canonical.y+1)*Y+D.wrap*V,B])})(t,s,m).getCorners(),E=s/-v[2];v[0]<0?(i.d8(T[0],T[0],[v[0]*E,0,0]),i.d8(T[3],T[3],[v[0]*E,0,0])):v[0]>0&&(i.d8(T[1],T[1],[v[0]*E,0,0]),i.d8(T[2],T[2],[v[0]*E,0,0])),v[1]<0?(i.d8(T[0],T[0],[0,v[1]*E,0]),i.d8(T[1],T[1],[0,v[1]*E,0])):v[1]>0&&(i.d8(T[2],T[2],[0,v[1]*E,0]),i.d8(T[3],T[3],[0,v[1]*E,0]));const j={};return j.vertices=T,j.planes=[Yc(T[1],T[0],T[4]),Yc(T[2],T[1],T[5]),Yc(T[3],T[2],T[6]),Yc(T[0],T[3],T[7])],j}addShadowReceiver(t,s,m){this._receivers.add(t,i.d9.fromTileIdAndHeight(t,s,m))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function Yc(f,t,s){const m=i.av([],s,t),v=i.av([],f,t),T=i.bI([],m,v),E=i.ag(T);return E===0?[0,0,1,0]:(i.c5(T,T,1/E),[T[0],T[1],T[2],-i.bJ(T,t)])}function rd(f){const t=f.properties.get("direction"),s=i.d4(t.x,t.y,t.z);s[2]=i.aA(s[2],0,75);const m=i.d6([s[0],s[1],s[2]]);return i.d5(m.x,m.y,m.z)}function Ds(f,t,s){const m=t.properties.get("color-use-theme")==="none",v=t.properties.get("color"),T=t.properties.get("intensity"),E=t.properties.get("direction"),j=[E.x,E.y,E.z],D=s.properties.get("color-use-theme")==="none",B=s.properties.get("color"),V=s.properties.get("intensity"),Y=Math.max(i.bJ([0,0,1],j),0),X=[0,0,0];i.c5(X,B.toPremultipliedRenderColor(D?null:f.getLut(t.scope)).toArray01Linear().slice(0,3),V);const J=[0,0,0];return i.c5(J,v.toPremultipliedRenderColor(m?null:f.getLut(s.scope)).toArray01Linear().slice(0,3),Y*T),i.db([X[0]>0?X[0]/(X[0]+J[0]):0,X[1]>0?X[1]/(X[1]+J[1]):0,X[2]>0?X[2]/(X[2]+J[2]):0])}function el(f,t,s,m,v,T){const E=f.zoom,j=f.scale,D=f.worldSize,B=1/D,V=f.aspect,Y=Math.sqrt(1+V*V)*Math.tan(.5*f.fovX),X=Y*Y,J=m-s,se=m+s;let ne,he;X>J/se?(ne=m,he=m*Y):(ne=.5*se*(1+X),he=.5*Math.sqrt(J*J+2*(m*m+s*s)*X+se*se*X*X));const de=f.projection.pixelsPerMeter(f.center.lat,D),pe=f._camera.getCameraToWorldMercator(),xe=[0,0,-ne*B];i.af(xe,xe,pe);let ge=he*B;const je=f._edgeInsets;if(!(je.left===0&&je.top===0&&je.right===0&&je.bottom===0||je.left===je.right&&je.top===je.bottom)){const Nt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?de:1),ti=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,s,m);ti[8]=2*-f.centerOffset.x/f.width,ti[9]=2*f.centerOffset.y/f.height;const gi=new Float64Array(16);i.cP(gi,ti,Nt);const Wt=new Float64Array(16);i.bl(Wt,gi);const Dt=i.cB.fromInvProjectionMatrix(Wt,D,E,!0);for(const Ti of Dt.points){const bi=((Ae=Ti)[0]/=j,Ae[1]/=j,Ae[2]=i.cf(Ae[2],f._center.lat),Ae);ge=Math.max(ge,i.c6(i.da([],xe,bi)))}}var Ae;ge*=v/(v-1);const De=Math.acos(t[2]),ze=Math.atan2(-t[0],-t[1]),Me=new oo;Me.position=xe,Me.setPitchBearing(De,ze);const Ve=Me.getWorldToCamera(D,de),it=ge*D,Ye=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*it),dt=Me.getCameraToClipOrthographic(-it,it,-it,it,Ye,(it+T*de)/t[2]),mt=new Float64Array(16);i.aB(mt,dt,Ve);const Tt=i.d5(Math.floor(1e6*xe[0])/1e6*D,Math.floor(1e6*xe[1])/1e6*D,0),Ot=.5*v,st=[0,0,0];i.af(st,Tt,mt),i.c5(st,st,Ot);const Xe=[Math.floor(st[0]),Math.floor(st[1]),Math.floor(st[2])],pt=[0,0,0];i.av(pt,st,Xe),i.c5(pt,pt,-1/Ot);const ht=new Float64Array(16);return i.bA(ht),i.br(ht,ht,pt),i.aB(mt,ht,mt),[mt,it]}class Ah extends i.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,s){return i.dc(this.requestManager.transformRequest(s,i.R.Model).url).then((m=>{if(!m)return;const v=i.dd(m),T=new i.de(t,s,void 0,void 0,v);return T.computeBoundsAndApplyParent(),T})).catch((m=>{if(m&&m.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${t} from ${s}: ${m.message}`)))}))}load(t,s,m={forceReload:!1}){this.models[s]||(this.models[s]={});const v=Object.keys(t),T=[],E=[];for(const j of v){const D=t[j];this.hasURLBeenRequested(D)&&!m.forceReload||(this.modelByURL[D]={modelId:j,scope:s},T.push(this.loadModel(j,D)),E.push(j)),this.models[s][j]||(this.models[s][j]={model:null,numReferences:1})}this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+E.length,Promise.allSettled(T).then((j=>{for(let D=0;D<j.length;D++){const{status:B}=j[D];if(B==="rejected")continue;const{value:V}=j[D];this.models[s][E[D]]||(this.models[s][E[D]]={model:null,numReferences:1}),this.models[s][E[D]].model=V}this.numModelsLoading[s]-=E.length,this.fire(new i.z("data",{dataType:"style"}))})).catch((j=>{this.fire(new i.y(new Error(`Could not load models: ${j.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s,m={exactIdMatch:!1}){return!!(m.exactIdMatch?this.getModel(t,s):this.getModelByURL(this.modelUris[s][t]))}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}getModelByURL(t){if(!t)return null;const s=this.modelByURL[t];return s?this.models[s.scope][s.modelId].model:null}hasModelBeenAdded(t,s){return this.models[s]&&this.models[s][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,s,m){this.models[m]||(this.models[m]={}),this.modelUris[m]||(this.modelUris[m]={});const v=this.requestManager.normalizeModelURL(s);if((this.hasModel(t,m,{exactIdMatch:!0})||this.hasModelBeenAdded(t,m))&&this.modelUris[m][t]===v)this.models[m][t].numReferences++;else if(this.hasURLBeenRequested(v)){const{scope:T,modelId:E}=this.modelByURL[v];this.models[T][E].numReferences++}else this.modelUris[m][t]=v,this.load({[t]:this.modelUris[m][t]},m)}addModelURLs(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const m=this.modelUris[s];for(const v in t)m[v]=this.requestManager.normalizeModelURL(t[v])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const m={};for(const v of t)this.hasModel(v,s,{exactIdMatch:!0})||this.hasURLBeenRequested(v)?this.models[s][v].numReferences++:this.modelUris[s][v]&&!this.hasURLBeenRequested(v)?m[v]=this.modelUris[s][v]:!this.hasURLBeenRequested(v)&&i.df(v,!1)&&(this.modelUris[s][v]=this.requestManager.normalizeModelURL(v),m[v]=this.modelUris[s][v]);this.load(m,s)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,s,m=!1,v=!1){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0||v)){const T=this.modelUris[s][t];m||delete this.modelUris[s][t],delete this.modelByURL[T];const E=this.models[s][t].model;if(!E)return;delete this.models[s][t],E.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const s of Object.keys(this.models[t])){const m=this.models[t][s].model;delete this.models[t][s],m&&m.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const m in this.models[s])this.models[s][m].model&&this.models[s][m].model.upload(t.context)}}const Ch=i.a6.colorTheme,Kc=new i.a9({data:new i.aa(Ch.data)});function Tf(f){if(!f.metadata||!f.metadata.content_area)return;const t=i.o.devicePixelRatio,{left:s,top:m,width:v,height:T}=f.metadata.content_area,E=s*t,j=m*t;return[E,j,E+v*t,j+T*t]}function vl(f){if(f)return f.map((([t,s])=>[t*i.o.devicePixelRatio,s*i.o.devicePixelRatio]))}class Cu{constructor(t,s,m){this.id=t,this.scope=s,this.sourceCache=m,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const s=this.sourceCache.getVisibleCoordinates();if(s.length===0)return t;const m=this.sourceCache.getSource();if(!(m instanceof Jr))return t;const v=s.map((E=>this.sourceCache.getTile(E))),T=m.getImages(v,Array.from(this.pendingRequests));for(const[E,j]of T)t.set(i.I.from({name:E,iconsetId:this.id}),j),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),t}}const Jc=(f,t)=>Te(f,t&&t.filter((s=>s.identifier!=="source.canvas"))),Vd=i.aH(Vn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Am=i.aH(Vn,["setCenter","setZoom","setBearing","setPitch"]),sd=new Set(["background","sky","slot","custom"]),vc={version:8,layers:[],sources:{}},Ol={duration:300,delay:0};class Qr extends i.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=Object.assign({},Ol),this._buildingIndex=new Xu(this),this.crossTileSymbolIndex=new so,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=s.styleChanges||new za,this._hasDataDrivenEmissive=!1,this.dispatcher=s.dispatcher?s.dispatcher:new i.D(i.dh(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Zo(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new i.di(t._requestManager,s.localFontFamily?i.dj.all:s.localIdeographFontFamily?i.dj.ideographs:i.dj.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Ah(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._indoorDependentLayers=s.indoorDependentLayers?s.indoorDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",i.dk());const m=this;this._rtlTextPluginCallback=Qr.registerForPluginStateChange((v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},((T,E)=>{if(i.dl(T),E&&E.every((j=>j)))for(const j in m._sourceCaches){const D=m._sourceCaches[j],B=D.getSource().type;B!=="vector"&&B!=="geojson"||D.reload()}}))})),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const T=this.getOwnSource(v.sourceId);if(T&&T.vectorLayerIds)for(const E in this._layers){const j=this._layers[E];j.source===T.id&&this._validateLayer(j)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(i.h(t))return t;const s=i.dm(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${i.dn(JSON.stringify(t))}`}_diffStyle(t,s,m){this.globalId=this._getGlobalId(t);const v=(T,E)=>{try{E(null,this.setState(T,m))}catch(j){E(j,!1)}};if(typeof t=="string"){const T=this.map._requestManager.normalizeStyleURL(t),E=this.map._requestManager.transformRequest(T,i.R.Style);i.m(E,((j,D)=>{j?this.fire(new i.y(j)):D&&v(D,s)}))}else typeof t=="object"&&v(t,s)}loadURL(t,s={}){this.fire(new i.z("dataloading",{dataType:"style"}));const m=typeof s.validate=="boolean"?s.validate:!i.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const v=this.importsCache.get(t);if(v)return this._load(v,m);const T=this.map._requestManager.transformRequest(t,i.R.Style);this._request=i.m(T,((E,j)=>{if(this._request=null,E)this.fire(new i.y(E));else if(j)return this.importsCache.set(t,j),this._load(j,m)}))}loadJSON(t,s={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=i.o.frame((()=>{this._request=null,this._load(t,s.validate!==!1)}))}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(vc,!1)}_loadImports(t,s,m){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const T of t){const E=this._createFragmentStyle(T),j=new Promise((V=>{E.once("style.import.load",V),E.once("error",V)})).then((()=>this.mergeAll()));if(v.push(j),this.resolvedImports.has(T.url)){E.loadEmpty();continue}const D=T.data||this.importsCache.get(T.url);D?(E.loadJSON(D,{validate:s}),this._isInternalStyle(D)&&(E.globalId=null)):T.url?E.loadURL(T.url,{validate:s}):E.loadEmpty();const B={style:E,id:T.id,config:T.config};if(m){const V=this.fragments.findIndex((({id:Y})=>Y===m));this.fragments=this.fragments.slice(0,V).concat(B).concat(this.fragments.slice(V))}else this.fragments.push(B)}return Promise.allSettled(v)}getImportGlobalIds(t=this,s=new Set){for(const m of t.fragments)m.style.globalId&&s.add(m.style.globalId),this.getImportGlobalIds(m.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?i.B(t.id,this.scope):t.id;let m;const v=this._initialConfig&&this._initialConfig[s];(t.config||v)&&(m=Object.assign({},t.config,v));const T=new Qr(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){if(this._isInternalStyle(t)){const T=Object.assign({},vc,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(T,s)}if(this.updateConfig(this._config,t.schema),s&&Jc(this,go(t)))return;this._loaded=!0,this.stylesheet=i.dp(t);const m=()=>{for(const D in t.sources)this.addSource(D,t.sources[D],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const D in t.iconsets)this.addIconset(D,t.iconsets[D]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const T=Do(this.stylesheet.layers);if(this._order=T.map((D=>D.id)),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new qe(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new qe(this.stylesheet.light)),this._layers={};for(const D of T){const B=i.du(D,this.scope,this._styleColorTheme.lut,this.options);B.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(B.fqid),this._hasAppearances=this._hasAppearances||B.getAppearances().length!==0,B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B;const V=this.getOwnLayerSourceCache(B),Y=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&B.canCastShadows()&&Y&&(V.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const j=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then((()=>{this._reloadImports(),this.fire(new i.z(j?"style.load":"style.import.load"))})).catch((D=>{this.fire(new i.y(new Error("Failed to load imports",D))),this.fire(new i.z(j?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new i.z(j?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const T=this._evaluateColorThemeData(v);this._loadColorTheme(T).then((()=>{m()})).catch((E=>{i.w(`Couldn't load color theme from the stylesheet: ${E}`),m()}))}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some((t=>t.style.hasAppearances()))}mergeAll(){let t,s,m,v,T,E,j,D,B,V;const Y={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((X=>{if(X.stylesheet){if(X.light!=null&&(t=X.light),X.stylesheet.lights)for(const J of X.stylesheet.lights)J.type==="ambient"&&X.ambientLight!=null&&(s=X.ambientLight),J.type==="directional"&&X.directionalLight!=null&&(m=X.directionalLight);v=this._prioritizeTerrain(v,X.terrain,X.stylesheet.terrain),X.stylesheet.fog&&X.fog!=null&&(T=X.fog),X.stylesheet.snow&&X.snow!=null&&(E=X.snow),X.stylesheet.rain&&X.rain!=null&&(j=X.rain),X.stylesheet.camera!=null&&(V=X.stylesheet.camera),X.stylesheet.projection!=null&&(D=X.stylesheet.projection),X.stylesheet.transition!=null&&(B=X.stylesheet.transition),Y[X.scope]=X._styleColorTheme}})),this.light=t,this.ambientLight=s,this.directionalLight=m,this.fog=T,this.snow=E,this.rain=j,this._styleColorThemeForScope=Y,v===null?delete this.terrain:this.terrain=v,this.camera=V||{"camera-projection":"perspective"},this.projection=D||{name:"mercator"},this.transition=Object.assign({},Ol,B),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const s=m=>{for(const v of m.fragments)s(v.style);t(m)};s(this)}_prioritizeTerrain(t,s,m){const v=t&&t.drapeRenderMode===0;return m===null?s&&s.drapeRenderMode===0?s:v?t:null:s!=null&&(!t||v||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},m={};this.forEachFragmentStyle((v=>{for(const T in v._sourceCaches){const E=i.B(T,v.scope);t[E]=v._sourceCaches[T]}for(const T in v._otherSourceCaches){const E=i.B(T,v.scope);s[E]=v._otherSourceCaches[T]}for(const T in v._symbolSourceCaches){const E=i.B(T,v.scope);m[E]=v._symbolSourceCaches[T]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=m}mergeIndoor(){this.forEachFragmentStyle((t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const s of Object.values(t.stylesheet.indoor)){const m=s,v=i.B(m.sourceId,t.scope);this._mergedIndoor[v]=new Set(m.sourceLayers||[])}}))}mergeLayers(){const t={},s=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((E=>{for(const j of E._order){const D=E._layers[j];if(D.type==="slot"){const B=i.dq(j);if(t[B])continue;t[B]=[]}D.slot&&t[D.slot]?t[D.slot].push(D):s.push(D)}})),this._mergedOrder=[];let v=-1;const T=(E=[])=>{for(const j of E)if(j.type==="slot"){const D=i.dq(j.id);t[D]&&T(t[D]),this._mergedSlots.push(D)}else{const D=i.B(j.id,j.scope);this._mergedOrder.push(D),m[D]=j,j.is3D(!!this.terrain)&&(this._has3DLayers=!0,v=this._mergedOrder.length-1),j.type==="circle"&&(this._hasCircleLayers=!0),j.type==="symbol"&&(this._hasSymbolLayers=!0),j.type==="clip"&&(this._clipLayerPresent=!0)}};if(T(s),this._has3DLayers){const E={};for(let j=0;j<this._mergedOrder.length;++j){const D=this._mergedOrder[j];E[D]=j===v?1:j<v?m[D].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((j,D)=>E[j]-E[D]))}this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(s,m,v,T){const E=Object.assign({},m);for(const D of Object.keys(Ch))E[D]===void 0&&(E[D]=Ch[D].default);const j=new i.a8(Kc,s,new Map(v));return j.setTransitionOrValue(E,v),j.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((m,v)=>{const T="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let E=t;E.startsWith(T)||(E=T+E);const j=i.I.from("mapbox-reserved-lut"),D=new Image;D.src=E,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void m();this._styleColorTheme.lutLoading=!1;const{width:B,height:V,data:Y}=i.o.getImageData(D);if(V>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(B!==V*V)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(j)&&this.removeImage(j),this.addImage(j,{data:new i.q({width:B,height:V},Y),pixelRatio:1,sdf:!1,usvg:!1,version:0});const X=this.imageManager.getImage(j,this.scope);X?(this._styleColorTheme.lut={image:X.data,data:t},m()):v(new Error("Missing LUT image."))}}))}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(s,m,v){let T,E,j;const D=i.o.devicePixelRatio>1?"@2x":"";let B=i.m(m.transformRequest(m.normalizeSpriteURL(s,D,".json"),i.R.SpriteJSON),((X,J)=>{B=null,j||(j=X,T=J,Y())})),V=i.n(m.transformRequest(m.normalizeSpriteURL(s,D,".png"),i.R.SpriteImage),((X,J)=>{V=null,j||(j=X,E=J,Y())}));function Y(){if(j)v(j);else if(T&&E){const X=i.o.getImageData(E),J={};for(const se in T){const{width:ne,height:he,x:de,y:pe,sdf:xe,pixelRatio:ge,stretchX:je,stretchY:Ae,content:De}=T[se],ze=new i.q({width:ne,height:he});i.q.copy(X,ze,{x:de,y:pe},{x:0,y:0},{width:ne,height:he},null),J[se]={data:ze,pixelRatio:ge!==void 0?ge:1,sdf:xe!==void 0&&xe,stretchX:je,stretchY:Ae,content:De,usvg:!1,version:0}}v(null,J)}}return{cancel(){B&&(B.cancel(),B=null),V&&(V.cancel(),V=null)}}})(t,this.map._requestManager,((s,m)=>{if(this._spriteRequest=null,s)this.fire(new i.y(s));else if(m){const v=new Map;for(const T in m)v.set(i.I.from(T),m[T]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))}))}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const m=this.getOwnSourceCache(s.source);if(!m)return void this.fire(new i.y(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const v=m.getSource();if(v.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));v.partial=!1;const T=new Cu(t,this.scope,m);this.imageManager.addImageProvider(T,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!i.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var m,v;this._spriteRequest=(v=(T,E)=>{if(this._spriteRequest=null,T)s?this._loadSprite(t):this.fire(new i.y(T));else if(E){const j=new Map;for(const D in E)j.set(i.I.from(D),E[D]);this.addImages(j)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bu((m=this.map._requestManager).transformRequest(m.normalizeIconsetURL(t),i.R.Iconset),((T,E)=>{if(T)return void v(T);const j={},D=i.dg(new i.bt(E));for(const B of D.icons){const V={version:1,pixelRatio:i.o.devicePixelRatio,content:Tf(B),stretchX:B.metadata?vl(B.metadata.stretch_x_areas):void 0,stretchY:B.metadata?vl(B.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:B};j[B.name]=V}v(null,j)})))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const m=t.sourceLayer;m&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(m)===-1)&&this.fire(new i.y(new Error(`Source layer "${m}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,s)=>{const m=this.fragments[s];return m&&m.style&&(t.data=m.style.serialize()),t}))}_serializeSources(){const t={};for(const s in this._sourceCaches){const m=this._sourceCaches[s].getSource();t[m.id]||(t[m.id]=m.serialize())}return t}_serializeLayers(t){const s=[];for(const m of t){const v=this._layers[m];v&&v.type!=="custom"&&s.push(v.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const s=this._mergedLayers[t];if(s._transitionablePaint&&s._transitionablePaint._values){const m=s._transitionablePaint._values["line-emissive-strength"];if(m&&m.value&&m.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new i.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new i.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const m=this.map.painter;if(m)for(let v=t.minzoom||0;v<(t.maxzoom||25.5);v++){const T=t.getProgramIds();if(T)for(const E of T){const j=t.getDefaultProgramParams(E,s.zoom,this._styleColorTheme.lut);j&&(m.style=this,this.fog&&(m._fogVisible=!0,j.overrideFog=!0,m.getOrCreateProgram(E,j)),m._fogVisible=!1,j.overrideFog=!1,m.getOrCreateProgram(E,j),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(j.overrideRtt=!0,m.getOrCreateProgram(E,j)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const m=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const j=this._changes.getLayerUpdatesByScope();for(const D in j){const{updatedIds:B,removedIds:V}=j[D];(B||V)&&(this._updateWorkerLayers(D,B,V),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const T={};for(const j in this._mergedSourceCaches){const D=this._mergedSourceCaches[j];T[j]=D.used,D.used=!1,D.tileCoverLift=0}for(const j of this._mergedOrder){const D=this._mergedLayers[j];if(D.visibility!=="none"&&D.recalculate(t,this._availableImages),!D.isHidden(t.zoom)){const B=this.getLayerSourceCache(D);B&&(B.used=!0,B.tileCoverLift=Math.max(B.tileCoverLift,D.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(D,t)})):this.precompilePrograms(D,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const j of E)j.sourceCache.used=!0;for(const j in T){const D=this._mergedSourceCaches[j];T[j]!==D.used&&D.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),m&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const s of t){const m=s.resolvePendingRequests(),v=this.getFragmentStyle(s.scope);v&&v.addImages(m)}}_updateTilesForChangedImages(){const t={};for(const s in this._mergedSourceCaches){const m=this._mergedSourceCaches[s].getSource().scope;t[m]=t[m]||this._changes.getUpdatedImages(m),t[m].length!==0&&this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t[m])}for(const s in t)this._changes.resetUpdatedImages(s)}_updateWorkerLayers(t,s,m){const v=this.getFragmentStyle(t);v&&this.dispatcher.broadcast("updateLayers",{layers:s?v._serializeLayers(s):[],scope:t,removedIds:m||[],options:v.options})}setState(t,s){if(this._checkLoaded(),Jc(this,go(t)))return!1;(t=i.dp(t)).layers=Do(t.layers);const m=(function(E,j){if(!E)return[{command:Vn.setStyle,args:[j]}];let D=[];try{if(!i.by(E.version,j.version))return[{command:Vn.setStyle,args:[j]}];if(i.by(E.center,j.center)||D.push({command:Vn.setCenter,args:[j.center]}),i.by(E.zoom,j.zoom)||D.push({command:Vn.setZoom,args:[j.zoom]}),i.by(E.bearing,j.bearing)||D.push({command:Vn.setBearing,args:[j.bearing]}),i.by(E.pitch,j.pitch)||D.push({command:Vn.setPitch,args:[j.pitch]}),i.by(E.sprite,j.sprite)||D.push({command:Vn.setSprite,args:[j.sprite]}),i.by(E.glyphs,j.glyphs)||D.push({command:Vn.setGlyphs,args:[j.glyphs]}),i.by(E.imports,j.imports)||(function(J=[],se=[],ne){se=se||[];const he=(J=J||[]).map(Wc),de=se.map(Wc),pe=J.reduce(Aa,{}),xe=se.reduce(Aa,{}),ge=he.slice();let je,Ae,De,ze;for(je=0,Ae=0;je<he.length;je++)De=he[je],xe.hasOwnProperty(De)?Ae++:(ne.push({command:Vn.removeImport,args:[De]}),ge.splice(ge.indexOf(De,Ae),1));for(je=0,Ae=0;je<de.length;je++)De=de[de.length-1-je],ge[ge.length-1-je]!==De&&(pe.hasOwnProperty(De)?(ne.push({command:Vn.removeImport,args:[De]}),ge.splice(ge.lastIndexOf(De,ge.length-Ae),1)):Ae++,ze=ge[ge.length-je],ne.push({command:Vn.addImport,args:[xe[De],ze]}),ge.splice(ge.length-je,0,De));for(const Me of se){const Ve=pe[Me.id];Ve&&(delete Ve.data,i.by(Ve,Me)||ne.push({command:Vn.updateImport,args:[Me.id,Me]}))}})(E.imports,j.imports,D),i.by(E.transition,j.transition)||D.push({command:Vn.setTransition,args:[j.transition]}),i.by(E.light,j.light)||D.push({command:Vn.setLight,args:[j.light]}),i.by(E.fog,j.fog)||D.push({command:Vn.setFog,args:[j.fog]}),i.by(E.snow,j.snow)||D.push({command:Vn.setSnow,args:[j.snow]}),i.by(E.rain,j.rain)||D.push({command:Vn.setRain,args:[j.rain]}),i.by(E.projection,j.projection)||D.push({command:Vn.setProjection,args:[j.projection]}),i.by(E.lights,j.lights)||D.push({command:Vn.setLights,args:[j.lights]}),i.by(E.camera,j.camera)||D.push({command:Vn.setCamera,args:[j.camera]}),i.by(E.iconsets,j.iconsets)||(function(J,se,ne){let he;for(he in se=se||{},J=J||{})J.hasOwnProperty(he)&&(se.hasOwnProperty(he)||ne.push({command:Vn.removeIconset,args:[he]}));for(he in se){if(!se.hasOwnProperty(he))continue;const de=se[he];J.hasOwnProperty(he)?i.by(J[he],de)||(ne.push({command:Vn.removeIconset,args:[he]}),ne.push({command:Vn.addIconset,args:[he,de]})):ne.push({command:Vn.addIconset,args:[he,de]})}})(E.iconsets,j.iconsets,D),!i.by(E["color-theme"],j["color-theme"]))return[{command:Vn.setStyle,args:[j]}];const B={},V=[];(function(J,se,ne,he){let de;for(de in se=se||{},J=J||{})J.hasOwnProperty(de)&&(se.hasOwnProperty(de)||pc(de,ne,he));for(de in se){if(!se.hasOwnProperty(de))continue;const pe=se[de];J.hasOwnProperty(de)?i.by(J[de],pe)||(J[de].type==="geojson"&&pe.type==="geojson"&&Gc(J,se,de)?ne.push({command:Vn.setGeoJSONSourceData,args:[de,pe.data]}):Yu(de,se,ne,he)):js(de,se,ne)}})(E.sources,j.sources,V,B);const Y=[];E.layers&&E.layers.forEach((J=>{J.source&&B[J.source]?D.push({command:Vn.removeLayer,args:[J.id]}):Y.push(J)}));let X=E.terrain;X&&B[X.source]&&(D.push({command:Vn.setTerrain,args:[void 0]}),X=void 0),D=D.concat(V),i.by(X,j.terrain)||D.push({command:Vn.setTerrain,args:[j.terrain]}),(function(J,se,ne){se=se||[];const he=(J=J||[]).map(Wc),de=se.map(Wc),pe=J.reduce(Aa,{}),xe=se.reduce(Aa,{}),ge=he.slice(),je=Object.create(null);let Ae,De,ze,Me,Ve,it,Ye;for(Ae=0,De=0;Ae<he.length;Ae++)ze=he[Ae],xe.hasOwnProperty(ze)?De++:(ne.push({command:Vn.removeLayer,args:[ze]}),ge.splice(ge.indexOf(ze,De),1));for(Ae=0,De=0;Ae<de.length;Ae++)ze=de[de.length-1-Ae],ge[ge.length-1-Ae]!==ze&&(pe.hasOwnProperty(ze)?(ne.push({command:Vn.removeLayer,args:[ze]}),ge.splice(ge.lastIndexOf(ze,ge.length-De),1)):De++,it=ge[ge.length-Ae],ne.push({command:Vn.addLayer,args:[xe[ze],it]}),ge.splice(ge.length-Ae,0,ze),je[ze]=!0);for(Ae=0;Ae<de.length;Ae++)if(ze=de[Ae],Me=pe[ze],Ve=xe[ze],!je[ze]&&!i.by(Me,Ve))if(i.by(Me.source,Ve.source)&&i.by(Me["source-layer"],Ve["source-layer"])&&i.by(Me.type,Ve.type)){for(Ye in qc(Me.layout,Ve.layout,ne,ze,null,Vn.setLayoutProperty),qc(Me.paint,Ve.paint,ne,ze,null,Vn.setPaintProperty),i.by(Me.slot,Ve.slot)||ne.push({command:Vn.setSlot,args:[ze,Ve.slot]}),i.by(Me.filter,Ve.filter)||ne.push({command:Vn.setFilter,args:[ze,Ve.filter]}),i.by(Me.minzoom,Ve.minzoom)&&i.by(Me.maxzoom,Ve.maxzoom)||ne.push({command:Vn.setLayerZoomRange,args:[ze,Ve.minzoom,Ve.maxzoom]}),Me)Me.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&Ye!=="slot"&&(Ye.indexOf("paint.")===0?qc(Me[Ye],Ve[Ye],ne,ze,Ye.slice(6),Vn.setPaintProperty):i.by(Me[Ye],Ve[Ye])||ne.push({command:Vn.setLayerProperty,args:[ze,Ye,Ve[Ye]]}));for(Ye in Ve)Ve.hasOwnProperty(Ye)&&!Me.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&Ye!=="slot"&&(Ye.indexOf("paint.")===0?qc(Me[Ye],Ve[Ye],ne,ze,Ye.slice(6),Vn.setPaintProperty):i.by(Me[Ye],Ve[Ye])||ne.push({command:Vn.setLayerProperty,args:[ze,Ye,Ve[Ye]]}))}else ne.push({command:Vn.removeLayer,args:[ze]}),it=ge[ge.lastIndexOf(ze)+1],ne.push({command:Vn.addLayer,args:[Ve,it]})})(Y,j.layers,D)}catch(B){console.warn("Unable to compute style diff:",B),D=[{command:Vn.setStyle,args:[j]}]}return D})(this.serialize(),t).filter((E=>!(E.command in Am)));if(m.length===0)return!1;const v=m.filter((E=>!(E.command in Vd)));if(v.length>0)throw new Error(`Unimplemented: ${v.map((E=>E.command)).join(", ")}.`);const T=[];return m.forEach((E=>{T.push(this[E.command](...E.args))})),s&&Promise.all(T).then(s).catch(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[s,m]of t.entries()){if(this.getImage(s))return this.fire(new i.y(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,m),this._changes.updateImage(s,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)?this.fire(new i.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(t,s,m=!1){this.imageManager.updateImage(t,this.scope,s),m&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(t,s,m={}){return this._checkLoaded(),this._validate(ie,`models.${t}`,s,null,m)||(this.modelManager.addModel(t,s,this.getActualScope()),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,s,m={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(wu,`sources.${t}`,s,null,m))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const v=xa(t,s,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id})));const T=E=>{const j=(E?"symbol:":"other:")+v.id,D=i.B(j,this.scope),B=this._sourceCaches[j]=new ds(D,v,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=B,B.onAdd(this.map)};T(!1),s.type!=="vector"&&s.type!=="geojson"||T(!0),v.onAdd&&v.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===t)return this.fire(new i.y(new Error(`Source "${t}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new i.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const v=Object.entries(this.stylesheet.iconsets).find((([T,E])=>E.type==="source"&&E.source===t));if(v)return this.fire(new i.y(new Error(`Source "${t}" cannot be removed while iconset "${v[0]}" is using it.`)))}const m=this.getOwnSourceCaches(t);for(const v of m){const T=i.dq(v.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(v.id),v.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const m=this.getOwnSourceCache(s);m&&t.push(m.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const m=t[s]._tiles;for(const v in m){const T=m[v];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const T of t){if(this._validate(zt,"lights",T))return;switch(T.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(T),E.updateTransitions(s)}else this.ambientLight=new an(T,Ia||(Ia=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(T),E.updateTransitions(s)}else this.directionalLight=new an(T,Ta||(Ta=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=Object.assign(s,{worldview:this.map.getWorldview()}),v=new i.ac(this.z||0,m);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const m=X=>.2126*(X[0]<=.03928?X[0]/12.92:Math.pow((X[0]+.055)/1.055,2.4))+.7152*(X[1]<=.03928?X[1]/12.92:Math.pow((X[1]+.055)/1.055,2.4))+.0722*(X[2]<=.03928?X[2]/12.92:Math.pow((X[2]+.055)/1.055,2.4)),v=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),T=t.properties.get("intensity"),E=t.properties.get("direction"),j=1-i.d4(E.x,E.y,E.z)[2]/90,D=m(v)*T*j,B=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),V=s.properties.get("intensity"),Y=m(B)*V;return Number(((D+Y)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(i.dr(t)){const s=i.ds(t),m=this.fragments.find((({id:T})=>T===s));if(!m)return;const v=i.dq(t);return m.style.getFragmentStyle(v)}{const s=this.fragments.find((({id:m})=>m===t));return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},m=(v,T="")=>`${v}::${T}`;this._featuresetSelectors={};for(const v in t){const T=this._featuresetSelectors[v]=[];for(const E of t[v].selectors){if(E.featureNamespace){const D=this.getOwnLayer(E.layer);if(!D){i.w(`Layer is undefined for selector: ${E.layer}`);continue}const B=m(D.source,D.sourceLayer);if(B in s&&s[B]!==E.featureNamespace){i.w(`"featureNamespace ${E.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}s[B]=E.featureNamespace}let j;if(E.properties)for(const D in E.properties){const B=i.U(E.properties[D]);B.result==="success"&&(j=j||{},j[D]=B.value)}T.push({layerId:E.layer,namespace:E.featureNamespace,properties:j,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const m=[];for(const v in s.stylesheet.featuresets)m.push({featuresetId:v,importId:s.scope?s.scope:void 0});return m}getFeaturesetLayers(t,s){const m=this.getFragmentStyle(s),v=m.stylesheet.featuresets;if(!v||!v[t])return this.fire(new i.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const T=[];for(const E of v[t].selectors){const j=m.getOwnLayer(E.layer);j&&T.push(j)}return T}getConfigProperty(t,s){const m=this.getFragmentStyle(t);if(!m)return null;const v=i.B(s,m.scope),T=m.options.get(v),E=T?T.value||T.default:null;return E?E.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,s){const m=i.B(t,s);return this._mergedIndoor[m]}setIndoorData(t,s){this.map.indoor.setIndoorData(s)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,s,m){const v=this.getFragmentStyle(t);if(!v)return;const T=v.stylesheet.schema;if(!T||!T[s])return;const E=i.U(m);if(E.result!=="success")return void Jc(this,E.value);const j=E.value.expression,D=i.B(s,v.scope),B=v.options.get(D);if(!B)return;let V;const{minValue:Y,maxValue:X,stepValue:J,type:se,values:ne}=T[s],he=i.U(T[s].default);he.result==="success"&&(V=he.value.expression),V?(this.options.set(D,Object.assign({},B,{value:j,default:V,minValue:Y,maxValue:X,stepValue:J,type:se,values:ne})),this.updateConfigDependencies(s)):this.fire(new i.y(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const m=s.stylesheet.schema;if(!m)return null;const v={};for(const T in m){const E=i.B(T,s.scope),j=s.options.get(E),D=j?j.value||j.default:null;v[T]=D?D.serialize():null}return v}setConfig(t,s){const m=this.getFragmentStyle(t);m&&(m.updateConfig(s,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const m=this.getFragmentStyle(t);m&&(m.stylesheet.schema=s,m.updateConfig(m._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const m in s){let v,T;const E=i.U(s[m].default);if(E.result==="success"&&(v=E.value.expression),t&&t[m]!==void 0){const X=i.U(t[m]);X.result==="success"&&(T=X.value.expression)}const{minValue:j,maxValue:D,stepValue:B,type:V,values:Y}=s[m];if(v){const X=i.B(m,this.scope);this.options.set(X,{default:v,value:T,minValue:j,maxValue:D,stepValue:B,type:V,values:Y})}else this.fire(new i.y(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,s=(()=>!0)){for(const m of t){const v=this.getLayer(m);v&&s(v)&&(v.possiblyEvaluateVisibility(),this._updateLayer(v),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,(s=>!t||s.expressionDependencies.configDependencies.has(t))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((s=>{const m=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(m){const v=s._evaluateColorThemeData(m);(!s._styleColorTheme.lut&&v!==""||s._styleColorTheme.lut&&v!==s._styleColorTheme.lut.data)&&s.setColorTheme(m)}})),this._changes.setDirty()}addLayer(t,s,m={}){this._checkLoaded();const v=t.id;if(this._layers[v])return void this.fire(new i.y(new Error(`Layer with id "${v}" already exists on this map`)));let T;if(t.type==="custom"){if(Jc(this,i.dt(t)))return;T=i.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(v,t.source),t=i.dp(t),t=Object.assign(t,{source:v})),this._validate(Si,`layers.${v}`,t,{arrayIndex:-1},m))return;T=i.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:v}})}const E=i.B(T.source,T.scope);T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E);let j=this._order.length;if(s){const Y=this._order.indexOf(s);if(Y===-1)return void this.fire(new i.y(new Error(`Layer with id "${s}" does not exist on this map.`)));T.slot===this._layers[s].slot?j=Y:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(j,0,v),this._layerOrderChanged=!0,this._layers[v]=T;const D=this.getOwnLayerSourceCache(T),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&T.canCastShadows()&&B&&(D.castsShadows=!0);const V=this._changes.getRemovedLayer(T);if(V&&T.source&&D&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const Y=i.B(T.source,T.scope);V.type!==T.type?this._changes.updateSourceCache(Y,"clear"):(this._changes.updateSourceCache(Y,"reload"),D.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const m=this._checkLayer(t);if(!m||t===s)return;const v=this._order.indexOf(t);this._order.splice(v,1);let T=this._order.length;if(s){const E=this._order.indexOf(s);if(E===-1)return void this.fire(new i.y(new Error(`Layer with id "${s}" does not exist on this map.`)));m.slot===this._layers[s].slot?T=E:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const m=this._order.indexOf(t);this._order.splice(m,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._indoorDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const v=this.getOwnLayerSourceCache(s);if(v&&v.castsShadows){let T=!1;for(const E in this._layers)if(this._layers[E].source===s.source&&this._layers[E].canCastShadows()){T=!0;break}v.castsShadows=T}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,m){this._checkLoaded();const v=this._checkLayer(t);v&&(v.minzoom===s&&v.maxzoom===m||(s!=null&&(v.minzoom=s),m!=null&&(v.maxzoom=m),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const m=this._checkLayer(t);m&&m.slot!==s&&(m.slot=s,this._updateLayer(m))}setFilter(t,s,m={}){this._checkLoaded();const v=this._checkLayer(t);if(v&&!i.by(v.filter,s))return s==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(pn,`layers.${v.id}.filter`,s,{layerType:v.type},m)||(v.filter=i.dp(s),this._updateLayer(v)))}getFilter(t){const s=this._checkLayer(t);if(s)return i.dp(s.filter)}setLayoutProperty(t,s,m,v={}){this._checkLoaded();const T=this._checkLayer(t);if(T&&!i.by(T.getLayoutProperty(s),m)){if(m!=null&&(!v||v.validate!==!1)&&Jc(T,Ze.call(go,{key:`layers.${t}.layout.${s}`,layerType:T.type,objectKey:s,value:m,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(s,m),T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T.fqid),this._updateLayer(T)}}setLayerProperty(t,s,m,v={}){this._checkLoaded();const T=this._checkLayer(t);T&&(s==="appearances"?(T.setAppearances(m),this._changes.setDirty()):T.isPaintProperty(s)?this.setPaintProperty(t,s,m,v):this.setLayoutProperty(t,s,m,v))}getLayoutProperty(t,s){const m=this._checkLayer(t);if(m)return m.getLayoutProperty(s)}setPaintProperty(t,s,m,v={}){this._checkLoaded();const T=this._checkLayer(t);if(!T||i.by(T.getPaintProperty(s),m)||m!=null&&(!v||v.validate!==!1)&&Jc(T,kn.call(go,{key:`layers.${t}.paint.${s}`,layerType:T.type,objectKey:s,value:m,styleSpec:i.a6})))return;const E=T.setPaintProperty(s,m);T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T.fqid),E&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(t,s){const m=this._checkLayer(t);if(m)return m.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:D,importId:B}=t.target,V=this.getFragmentStyle(B),Y=V.getFeaturesetLayers(D);for(const{source:X,sourceLayer:J}of Y)V.setFeatureState({id:t.id,source:X,sourceLayer:J},s)}else if("layerId"in t.target){const{layerId:D}=t.target,B=this.getLayer(D);this.setFeatureState({id:t.id,source:B.source,sourceLayer:B.sourceLayer},s)}return}const m=t.source,v=t.sourceLayer,T=this._checkSource(m);if(!T)return;const E=T.type;if(E==="geojson"&&v)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!v)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const j=this.getOwnSourceCaches(m);for(const D of j)D.setFeatureState(v,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:D,importId:B}=t.target,V=this.getFragmentStyle(B),Y=V.getFeaturesetLayers(D);for(const{source:X,sourceLayer:J}of Y)V.removeFeatureState({id:t.id,source:X,sourceLayer:J},s)}else if("layerId"in t.target){const{layerId:D}=t.target,B=this.getLayer(D);this.removeFeatureState({id:t.id,source:B.source,sourceLayer:B.sourceLayer},s)}return}const m=t.source,v=this._checkSource(m);if(!v)return;const T=v.type,E=T==="vector"?t.sourceLayer:void 0;if(T==="vector"&&!E)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const j=this.getOwnSourceCaches(m);for(const D of j)D.removeFeatureState(E,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let T;if("featuresetId"in t.target){const{featuresetId:E,importId:j}=t.target,D=this.getFragmentStyle(j),B=D.getFeaturesetLayers(E);for(const{source:V,sourceLayer:Y}of B){const X=D.getFeatureState({id:t.id,source:V,sourceLayer:Y});if(X&&!T)T=X;else if(!i.by(T,X))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:E}=t.target,j=this.getLayer(E);T=this.getFeatureState({id:t.id,source:j.source,sourceLayer:j.sourceLayer})}return T}const s=t.source,m=t.sourceLayer,v=this._checkSource(s);if(v){if(v.type!=="vector"||m)return t.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(m,t.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return i.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(m=>m!==void 0))}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),m=i.B(t.source,t.scope),v=this._changes.getUpdatedSourceCaches();t.source&&!v[m]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=j=>this._mergedLayers[j].is3D(!!this.terrain),m=this.order,v={},T=[];for(let j=m.length-1;j>=0;j--){const D=m[j];if(s(D)){v[D]=j;for(const B of t){const V=B[D];if(V)for(const Y of V)T.push(Y)}}}T.sort(((j,D)=>D.intersectionZ-j.intersectionZ));const E=[];for(let j=m.length-1;j>=0;j--){const D=m[j];if(s(D))for(let B=T.length-1;B>=0;B--){const V=T[B].feature;if(V.layer&&v[V.layer.id]<j)break;E.push(V),T.pop()}else for(const B of t){const V=B[D];if(V)for(const Y of V)E.push(Y.feature)}}return E}queryRasterValue(t,s,m){const v=this.getOwnSource(t);return v?v.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):v.queryRasterArrayValue(s,m):(this.fire(new i.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,s,m){let v;s&&!Array.isArray(s)&&s.filter&&(this._validate(pn,"queryRenderedFeatures.filter",s.filter,null,s),v=i.b6(s.filter));const T={},E=V=>{if(sd.has(V.type))return;const Y=this.getOwnLayerSourceCache(V),X=T[Y.id]=T[Y.id]||{sourceCache:Y,layers:{},has3DLayers:!1};V.is3D(!!this.terrain)&&(X.has3DLayers=!0),X.layers[V.fqid]=X.layers[V.fqid]||{styleLayer:V,targets:[]},X.layers[V.fqid].targets.push({filter:v})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const V of s.layers){const Y=this._layers[V];if(!Y)return this.fire(new i.y(new Error(`The layer '${V}' does not exist in the map's style and cannot be queried for features.`))),[];E(Y)}}else for(const V in this._layers)E(this._layers[V]);const j=this._queryRenderedFeatures(t,T,m),D=this._flattenAndSortRenderedFeatures(j),B=[];for(const V of D)i.dw(V.layer.id)===this.scope&&B.push(V);return B}queryRenderedFeatureset(t,s,m){let v;s&&!Array.isArray(s)&&s.filter&&(this._validate(pn,"queryRenderedFeatures.filter",s.filter,null,s),v=i.b6(s.filter));const T="mock",E=[];if(s&&s.target)E.push(Object.assign({},s,{targetId:T,filter:v}));else{const V=this.getFeaturesetDescriptors();for(const Y of V)E.push({targetId:T,filter:v,target:Y});for(const{style:Y}of this.fragments){const X=Y.getFeaturesetDescriptors();for(const J of X)E.push({targetId:T,filter:v,target:J})}}const j=this.queryRenderedTargets(t,E,m),D=[],B=new Set;for(const V of j)for(const Y of V.variants[T])_o(Y,V,B)||D.push(new i.dx(V,Y));return D}queryRenderedTargets(t,s,m){const v={},T=(j,D,B,V)=>{const Y=v[D.id]=v[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};if(Y.layers[j.fqid]=Y.layers[j.fqid]||{styleLayer:j,targets:[]},j.is3D(!!this.terrain)&&(Y.has3DLayers=!0),!V)return B.uniqueFeatureID=!1,void Y.layers[j.fqid].targets.push(B);Y.layers[j.fqid].targets.push(Object.assign({},B,{namespace:V.namespace,properties:V.properties,uniqueFeatureID:V.uniqueFeatureID}))};for(const j of s)if("featuresetId"in j.target){const{featuresetId:D,importId:B}=j.target,V=this.getFragmentStyle(B);if(!V||!V._featuresetSelectors)continue;const Y=V._featuresetSelectors[D];if(!Y){this.fire(new i.y(new Error(`The featureset '${D}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const X of Y){const J=V.getOwnLayer(X.layerId);J&&!sd.has(J.type)&&T(J,V.getOwnLayerSourceCache(J),j,X)}}else if("layerId"in j.target){const{layerId:D}=j.target,B=this.getLayer(D);if(!B||sd.has(B.type))continue;T(B,this.getLayerSourceCache(B),j)}const E=this._queryRenderedFeatures(t,v,m);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(t,s,m){const v=[],T=!!this.map._showQueryGeometry,E=ea.createFromScreenPoints(t,m);for(const j in s){const D=Vc(E,s[j],this._availableImages,m,T);Object.keys(D).length&&v.push(D)}if(this.placement)for(const j in s){if(!s[j].sourceCache._onlySymbols)continue;const D=Su(E.screenGeometry,s[j],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(D).length&&v.push(D)}return v}querySourceFeatures(t,s){const m=s&&s.filter;m&&this._validate(pn,"querySourceFeatures.filter",m,null,s);let v=[];const T=this.getOwnSourceCaches(t);for(const E of T)v=v.concat(hc(E,s));return v}addSourceType(t,s,m){return Qr.getSourceType(t)?m(new Error(`A source type called "${t}" already exists.`)):(Qr.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,m={}){this._checkLoaded();const v=this.light.getLight();let T=!1;for(const j in t)if(!i.by(t[j],v[j])){T=!0;break}if(!T)return;const E=this._getTransitionParameters();this.light.setLight(t,s,m),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=t;const v=!("source"in t)||t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if("source"in m&&typeof m.source=="object"){const j="terrain-dem-src";this.addSource(j,m.source),m=i.dp(m),m=Object.assign(m,{source:j})}const T=Object.assign({},m),E={};if(this.terrain&&v){T.source=this.terrain.get().source;const j=this.terrain?this.getFragmentStyle(this.terrain.scope):null;j&&(E.style=j.serialize())}if(this._validate(Qt,"terrain",T,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&s!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,s),this.fire(new i.z("data",{dataType:"style"}))}else{const T=this.terrain,E=T.get();for(const j of Object.keys(i.a6.terrain))!m.hasOwnProperty(j)&&i.a6.terrain[j].default&&(m[j]=i.a6.terrain[j].default);for(const j in t)if(!i.by(t[j],E[j])){T.set(t,this.options),this.stylesheet.terrain=t;const D=this._getTransitionParameters({duration:0});T.updateTransitions(D),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Zi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}_createSnow(t){const s=this.snow=new Yn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}_createRain(t){const s=this.rain=new fn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!i.by(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!i.by(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!i.by(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const m=this._evaluateColorThemeData(s);this._loadColorTheme(m).then((()=>{this.fire(new i.z("colorthemeset")),t()})).catch((v=>{i.w(`Couldn't set color theme: ${v}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const m=this.getFragmentStyle(t);m&&(m._styleColorTheme.colorThemeOverride=s,m._reloadColorTheme())}_getTransitionParameters(t){return{now:i.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?t.push(m):s.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const m=this.terrain=new Je(t,s,this.scope,this.options,this.map.getWorldview());s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,m,v,T={}){if(T&&T.validate===!1)return!1;const E=Object.assign({},this.serialize());return Jc(this,t.call(go,Object.assign({key:s,style:E,value:m,styleSpec:i.a6},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const m of s)m.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const s=this._mergedLayers[t];s._clear&&s._clear()}}reloadSource(t){const s=this.getSourceCaches(t);for(const m of s)m.resume(),m.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let s;this.directionalLight&&(s=rd(this.directionalLight));const m=new Set,v=new Set;for(const T in this._mergedLayers){const E=this._mergedLayers[T];E.type==="building"&&m.add(E.source),E.hasElevation()&&!v.has(E.source)&&v.add(E.source)}for(const T in this._mergedSourceCaches){const E=this._mergedSourceCaches[T],j=v.has(E._source.id);m.has(E._source.id)&&(E._source.reparseOverscaled=!1),E.update(t,void 0,void 0,s,j)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,m,v,T,E,j=!1){let D=!1,B=!1;const V={},Y={};for(const ne of this._mergedOrder){const he=this._mergedLayers[ne];if(he.type!=="symbol")continue;const de=i.B(he.source,he.scope);let pe=V[de];if(!pe){const ge=this.getLayerSourceCache(he);if(!ge)continue;const je=ge.getRenderableIds(!0).map((Ae=>ge.getTileByID(Ae)));Y[de]=je.slice(),pe=V[de]=je.sort(((Ae,De)=>De.tileID.overscaledZ-Ae.tileID.overscaledZ||(Ae.tileID.isLessThan(De.tileID)?-1:1)))}const xe=this.crossTileSymbolIndex.addLayer(he,pe,s.center.lng,s.projection);D=D||xe}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),j=j||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new i.z("neworder"));const X=!!(this.placement&&!s.equals(this.placement.transform)),J=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!E||this.placement.lastReplacementSourceUpdateTime!==E.updateTime)),se=(X||J||D||this.placement&&this.placement.isStale())&&v===0;if((j||!this.pauseablePlacement||se||v!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),s.zoom))&&(this.pauseablePlacement=new Hr(s,this._mergedOrder,j||v===0,m,v,T,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,V,Y,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),B=!0),D&&this.pauseablePlacement.placement.setStale()),B||D){this._buildingIndex.onNewFrame(s.zoom);for(let ne=0;ne<this._mergedOrder.length;ne++){const he=this._mergedLayers[this._mergedOrder[ne]];if(he.type!=="symbol"||he.visibility==="none")continue;const de=this.isLayerClipped(he);this.placement.updateLayerOpacities(he,V[i.B(he.source,he.scope)],ne,de?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex((({id:T})=>T===t.id))!==-1)return void this.fire(new i.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return m.push(t),this._loadImports([t],!0);const v=m.findIndex((({id:T})=>T===s));return v===-1&&this.fire(new i.y(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,v).concat(t).concat(m.slice(v)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(t);return v===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==m[v].url&&this.setImportUrl(t,s.url),i.by(s.config,m[v].config)||this.setImportConfig(t,s.config,s.data.schema),i.by(s.data,m[v].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let m=this.stylesheet.imports||[];const v=this.getImportIndex(t);if(v===-1)return this;const T=this.getImportIndex(s);if(T===-1)return this;const E=m[v],j=this.fragments[v];return m=m.filter((({id:D})=>D!==t)),this.fragments=this.fragments.filter((({id:D})=>D!==t)),this.stylesheet.imports=m.slice(0,T).concat(E).concat(m.slice(T)),this.fragments=this.fragments.slice(0,T).concat(j).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(t);if(v===-1)return this;m[v].url=s;const T=this.fragments[v];return T.style=this._createFragmentStyle(m[v]),T.style.on("style.import.load",(()=>this.mergeAll())),T.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const m=this.getImportIndex(t),v=this.stylesheet.imports||[];return m===-1?this:s?(this.fragments[m].style.setState(s),this._reloadImports(),this):(delete v[m].data,this.setImportUrl(t,v[m].url))}setImportConfig(t,s,m){this._checkLoaded();const v=this.getImportIndex(t),T=this.stylesheet.imports||[];if(v===-1)return this;s?T[v].config=s:delete T[v].config;const E=this.fragments[v];m&&E.style.stylesheet&&(E.style.stylesheet.schema=m);const j=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=s,E.style.updateConfig(s,j),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],m=this.getImportIndex(t);m!==-1&&(s.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex((m=>m.id===t));return s===-1&&this.fire(new i.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[s];m&&t.push(m.getSource())}return t}getSource(t,s){const m=this.getSourceCache(t,s);return m&&m.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const m=i.B(t,s);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(t){const s=i.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const m=t[s];m==="reload"?this.reloadSource(s):m==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const m of s){const v=this.getLayer(m);v&&v.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,s,m){this.imageManager.getImages(s.images,s.scope,m),this._updateTilesForChangedImages();const v=E=>{if(E){const j=s.images.map((D=>i.I.toString(D)));E.setDependencies(s.tileID.key,s.type,j)}},T=i.B(s.source,s.scope);v(this._mergedOtherSourceCaches[T]),v(this._mergedSymbolSourceCaches[T]),s.images.some((E=>E.iconsetId))&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(t,s,m){this.imageManager.rasterizeImages(s,m)}getGlyphs(t,s,m){this.glyphManager.getGlyphs(s.stacks,m)}getResource(t,s,m){return i.dz(s,m)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${t}'`))),!1):s.every((m=>m.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const m=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),v=t.type==="building";if(t.is3D(!!this.terrain)){if(m||v||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qr.getSourceType=function(f){return ss[f]},Qr.setSourceType=function(f,t){ss[f]=t},Qr.registerForPluginStateChange=i.dA;class Qc extends i.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[s,m]of Object.entries(t.buildings))if(this._buildings[s])for(const v of m.floorIds)this._buildings[s].floors[v]||(this._buildings[s].floors[v]=m.floors[v]);else this._buildings[s]=m;for(const s of t.activeFloors)this._activeFloors.add(s);this._updateIndoorSelector()}getIndoorTileOptions(t,s){const m=this._style.getIndoorSourceLayers(t,s);return m&&this._indoorState?{sourceLayers:m,indoorState:this._indoorState}:null}_updateUI(t,s,m){const v=(function(T,E,j,D){let B=null,V=Number.MAX_SAFE_INTEGER;if(D<16)return null;for(const[Y,X]of Object.entries(T)){const J=X.center;if(J){const se=E.distanceTo(i.aT.convert(J));se<V&&j.contains(J)&&(V=se,B=Y)}}return B})(this._buildings,s,m,t);v!==this._closestBuildingId&&(this._closestBuildingId=v,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,s=this._closestBuildingId,m=s&&t?t[s]:void 0;if(!m)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let v=null;for(const E of m.floorIds)if(this._activeFloors&&this._activeFloors.has(E)){v=E;break}const T=Array.from(m.floorIds).map((E=>({id:E,name:m.floors[E].name,zIndex:m.floors[E].zIndex}))).sort(((E,j)=>j.zIndex-E.zIndex));this.fire(new i.z("selector-update",{selectedFloorId:v,activeFloorsVisible:this._activeFloorsVisible,floors:T}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Ls=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Os=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,eu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Fo="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Js=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,tu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Xt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,iu=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,nu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Nl=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,xc=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const od=/#include\s+"([^"]+)"/g,es=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,ld=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,lo=new Set(["ifdef","ifndef","elif","if","defined"]),bc=new Set;I(Ls,bc),I(eu,bc),I(Os,bc);const xl={"_prelude_fog.vertex.glsl":tu,"_prelude_terrain.vertex.glsl":Js,"_prelude_shadow.vertex.glsl":Nl,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Xt,"_prelude_shadow.fragment.glsl":xc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":iu,"_prelude_raster_particle.glsl":nu},Fl={};$("",Js),$(Xt,tu),$(xc,Nl),$(iu,""),$(nu,"");const Mh=$(Os,eu),Mu=Ls,Pu=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Mu,Mh.fragmentSource].join(`
`),ju=["precision highp float;",Mu,Mh.vertexSource].join(`
`);var b={background:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:$(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:$(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:$("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:$(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:$("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:$("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:$(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:$(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:$(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:$(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:$(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:$(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:$("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:$("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:$(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:$(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:$("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:$(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fo),skyboxGradient:$(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fo),skyboxCapture:$(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:$(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:$(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:$(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:$(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:$("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:$("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:$("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:$("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function I(f,t){const s=f.split(`
`);for(let m of s){if(m=m.trimStart(),m[0]!=="#"||!m.includes("if")||m.startsWith("#endif"))continue;const v=m.match(ld);if(v)for(const T of v)lo.has(T)||t.add(T)}}function $(f,t){const s=new Set,m=[],v=[];f=f.replace(od,((E,j)=>(v.push(j),""))),t=t.replace(od,((E,j)=>(m.push(j),"")));let T=new Set(bc);I(f,T),I(t,T);for(const E of[...m,...v])Fl[E]||(Fl[E]=new Set,I(xl[E],Fl[E])),T=new Set([...T,...Fl[E]]);return{fragmentSource:f=f.replace(es,((E,j,D,B,V)=>(s.add(V),j==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${D} ${B} ${V};
#else
uniform ${D} ${B} u_${V};
#endif
`:j==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${D} ${B} ${V} = u_${V};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${D} ${B} ${V};
#endif
`:j==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(es,((E,j,D,B,V)=>{const Y=`MATERIAL_ATTRIBUTE_OFFSET_${V}`,X=B==="float"?"vec2":B,J=`GET_ATTRIBUTE_${X}(a_${V}, materialInfo, ${Y})`,se=V.match(/color/)?"color":X;return j==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${D} ${B} a_${V};
#endif
`:s.has(V)?j==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
    #if !defined(${Y})
        in ${D} ${X} a_${V};
    #endif
out ${D} ${B} ${V};
#else
uniform ${D} ${B} u_${V};
#endif
`:j==="initialize"?se==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${D} ${B} ${V} = u_${V};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${V})
    #ifdef ${Y}
        ${V} = unpack_mix_${se}(${J}, u_${V}_t);
    #else
        ${V} = unpack_mix_${se}(a_${V}, u_${V}_t);
    #endif
#else
    ${D} ${B} ${V} = u_${V};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${D} ${B} a_${V};
    out ${D} ${B} ${V};
#endif
`:j==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:j==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
    #if !defined(${Y})
        in ${D} ${X} a_${V};
    #endif
#else
uniform ${D} ${B} u_${V};
#endif
`:j==="define-instanced"?se==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${D} ${B} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${D} ${X} a_${V};
#else
uniform ${D} ${B} u_${V};
#endif
`:j==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${D} ${B} ${V} = a_${V};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    #ifdef ${Y}
        ${D} ${B} ${V} = ${J};
    #else
        ${D} ${B} ${V} = a_${V};
    #endif
#else
    ${D} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    #ifdef ${Y}
        ${D} ${B} ${V} = unpack_mix_${se}(${J}, u_${V}_t);
    #else
        ${D} ${B} ${V} = unpack_mix_${se}(a_${V}, u_${V}_t);
    #endif
#else
    ${D} ${B} ${V} = u_${V};
#endif
`})),usedDefines:T,vertexIncludes:m,fragmentIncludes:v}}class te{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,m,v,T,E,j,D){this.context=t;let B=this.boundPaintVertexBuffers.length!==v.length;for(let Y=0;!B&&Y<v.length;Y++)this.boundPaintVertexBuffers[Y]!==v[Y]&&(B=!0);let V=this.boundDynamicVertexBuffers.length!==j.length;for(let Y=0;!V&&Y<j.length;Y++)this.boundDynamicVertexBuffers[Y]!==j[Y]&&(V=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==m||B||V||this.boundIndexBuffer!==T||this.boundVertexOffset!==E)this.freshBind(s,m,v,T,E,j,D);else{t.bindVertexArrayOES.set(this.vao);for(const Y of j)Y&&(Y.bind(),D&&Y.instanceCount&&Y.setVertexAttribDivisor(t.gl,s,D));T&&T.dynamicDraw&&T.bind()}}freshBind(t,s,m,v,T,E,j){const D=this.context,B=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=E,s.enableAttributes(B,t),s.bind(),s.setVertexAttribPointers(B,t,T);for(const V of m)V.enableAttributes(B,t),V.bind(),V.setVertexAttribPointers(B,t,T);for(const V of E)V&&(V.enableAttributes(B,t),V.bind(),V.setVertexAttribPointers(B,t,T),j&&V.instanceCount&&V.setVertexAttribDivisor(B,t,j));v&&v.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function me(f,t){const s=Math.pow(2,t.canonical.z),m=t.canonical.y;return[new i.ae(0,m/s).toLngLat().lat,new i.ae(0,(m+1)/s).toLngLat().lat]}function Le(f,t,s,m,v,T,E){const j=f.context,D=j.gl,B=s.hillshadeFBO;if(!B)return;f.prepareDrawTile();const V=f.isTileAffectedByFog(t),Y=[];f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&Y.push("USE_MRT1");const X=f.getOrCreateProgram("hillshade",{overrideFog:V,defines:Y});j.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,B.colorAttachment0.get());const J=((de,pe,xe,ge)=>{const je=xe.paint.get("hillshade-shadow-color"),Ae=xe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",De=xe.paint.get("hillshade-highlight-color"),ze=xe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Me=xe.paint.get("hillshade-accent-color"),Ve=xe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",it=xe.paint.get("hillshade-emissive-strength");let Ye=i.an(xe.paint.get("hillshade-illumination-direction"));if(xe.paint.get("hillshade-illumination-anchor")==="viewport")Ye-=de.transform.angle;else if(de.style&&de.style.enable3dLights()&&de.style.directionalLight){const mt=de.style.directionalLight.properties.get("direction"),Tt=i.d4(mt.x,mt.y,mt.z);Ye=i.an(Tt[1])}const dt=!de.options.moving;return{u_matrix:ge||de.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),dt),u_image:0,u_latrange:me(0,pe.tileID),u_light:[xe.paint.get("hillshade-exaggeration"),Ye],u_shadow:je.toPremultipliedRenderColor(Ae?null:xe.lut),u_highlight:De.toPremultipliedRenderColor(ze?null:xe.lut),u_emissive_strength:it,u_accent:Me.toPremultipliedRenderColor(Ve?null:xe.lut)}})(f,s,m,f.terrain?t.projMatrix:null);f.uploadCommonUniforms(j,X,t.toUnwrapped());const{tileBoundsBuffer:se,tileBoundsIndexBuffer:ne,tileBoundsSegments:he}=f.getTileBoundsBuffers(s);X.draw(f,D.TRIANGLES,v,T,E,en.disabled,J,m.id,se,ne,he)}function ut(f,t,s){if(!t.needsDEMTextureUpload)return;const m=f.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(s.stride);const T=s.getPixels();t.demTexture?t.demTexture.update(T,{premultiply:!1}):t.demTexture=new i.T(m,T,v.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Bt(f,t,s){const m=f.context,v=m.gl;if(!t.dem)return;const T=t.dem;if(m.activeTexture.set(v.TEXTURE1),ut(f,t,T),!t.demTexture)return;t.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const E=T.dim;m.activeTexture.set(v.TEXTURE0);let j=t.hillshadeFBO;if(!j){const X=new i.T(m,{width:E,height:E,data:null},v.RGBA8);X.bind(v.LINEAR,v.CLAMP_TO_EDGE),j=t.hillshadeFBO=m.createFramebuffer(E,E,1,"renderbuffer"),j.colorAttachment0.set(X.texture)}m.bindFramebuffer.set(j.framebuffer),m.viewport.set([0,0,E,E]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:B,tileBoundsSegments:V}=f.getMercatorTileBoundsBuffers(),Y=[];f.linearFloatFilteringSupported()&&Y.push("TERRAIN_DEM_FLOAT_FORMAT"),f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&Y.push("USE_MRT1"),f.getOrCreateProgram("hillshadePrepare",{defines:Y}).draw(f,v.TRIANGLES,Pi.disabled,Ki.disabled,sn.unblended,en.disabled,((X,J)=>{const se=J.stride,ne=i.bC();return i.ce(ne,0,i.al,-i.al,0,0,1),i.br(ne,ne,[0,-i.al,0]),{u_matrix:ne,u_image:1,u_dimension:[se,se],u_zoom:X.overscaledZ}})(t.tileID,T),s.id,D,B,V),t.needsHillshadePrepare=!1}class It{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ji extends It{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cn extends It{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class vn extends It{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class En extends It{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class oa extends It{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class pr extends It{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ar extends It{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class hs extends It{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Qs extends It{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class kf extends It{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ph extends It{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class cd extends It{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Bl extends It{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Hd extends It{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wc extends It{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ur extends It{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class tl extends It{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class il extends It{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Sc extends It{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let rc=class extends It{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class ud extends It{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Tc extends It{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class dd extends It{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Cm extends It{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Gd extends It{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Bo extends It{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class jh extends It{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Mm extends It{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Wp extends It{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Zp extends It{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class e_ extends It{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class fs extends It{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class zh extends fs{constructor(t,s,m=0){super(t,s),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+m}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachmentPoint,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class au extends fs{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zu extends fs{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Pm extends au{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const co=(f,t,s,m)=>({u_matrix:f,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:s,u_emissive_texture_available:m}),Iu=(f,t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:s,u_zoom_transition:v,u_merc_center:T,u_image0:0,u_image1:1,u_frustum_tl:E,u_frustum_tr:j,u_frustum_br:D,u_frustum_bl:B,u_globe_pos:V,u_globe_radius:Y,u_viewport:X,u_grid_matrix:he?Float32Array.from(he):new Float32Array(9),u_skirt_height:J,u_far_z_cutoff:se,u_emissive_texture_available:ne});function Ef(f,t){return f!=null&&t!=null&&!(!f.hasData()||!t.hasData())&&f.demTexture!=null&&t.demTexture!=null&&f.tileID.key!==t.tileID.key}const ru=new class{constructor(){this.operations={}}newMorphing(f,t,s,m,v){if(f in this.operations){const T=this.operations[f];T.to.tileID.key!==s.tileID.key&&(T.queued=s)}else this.operations[f]={startTime:m,phase:0,duration:v,from:t,to:s,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const t=this.operations[f];return{from:t.from,to:t.to,phase:t.phase}}update(f){for(const t in this.operations){const s=this.operations[t];for(s.phase=(f-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,f)){delete this.operations[t];break}}}_nextOp(f,t){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=t,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},jm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Af(f,t,s){if(t===0)return 0;const m=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-f)*Math.max(t,1)*m}function Ru(f,t){const s=1<<f.z;return!t&&(f.x===0||f.x===s-1)||f.y===0||f.y===s-1}function hd(f,t){if(!f.style||!f.style.enable3dLights())return;const s=f.context,m=s.gl;s.activeTexture.set(m.TEXTURE1),t?t.bind(m.LINEAR,m.CLAMP_TO_EDGE):f.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}const fd=f=>({u_matrix:f});function Ih(f,t,s,m,v){if(v>0){const T=i.o.now(),E=(T-f.timeAdded)/v,j=t?(T-t.timeAdded)/v:-1,D=s.getSource(),B=m.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),V=!t||Math.abs(t.tileID.overscaledZ-B)>Math.abs(f.tileID.overscaledZ-B),Y=V&&f.refreshedUponExpiration?1:i.aA(V?E:1-j,0,1);return t?{opacity:1,mix:1-Y,isFading:E<1}:{opacity:Y,mix:0,isFading:E<1}}return{opacity:1,mix:0,isFading:!1}}class md extends ds{constructor(t){const s=xa("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",s,!1),s.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class zm extends ds{constructor(t){const s=xa("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,m){if(t.freezeTileCoverage)return;this.transform=t;const v=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((T,E)=>{if(T[E.key]="",!this._tiles[E.key]){const j=new Zs(E,this._source.tileSize*E.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);j.state="loaded",this._tiles[E.key]=j}return T}),{});for(const T in this._tiles)T in v||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const m=Object.values(s);this.renderCachePool.push(...m),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Rh extends i.aQ{constructor(t,s,m){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=m}}class Cf extends i.bV{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,T]=(function(D){const B=new i.bd,V=new i.b0,Y=131;B.reserve(17161),V.reserve(33800);const X=i.al/128,J=i.al+X/2,se=J+X;for(let he=-X;he<se;he+=X)for(let de=-X;de<se;de+=X){const pe=de<0||de>J||he<0||he>J?24575:0,xe=i.aA(Math.round(de),0,i.al),ge=i.aA(Math.round(he),0,i.al);B.emplaceBack(xe+pe,ge)}const ne=(he,de)=>{const pe=de*Y+he;V.emplaceBack(pe+1,pe,pe+Y),V.emplaceBack(pe+Y,pe+Y+1,pe+1)};for(let he=1;he<129;he++)for(let de=1;de<129;de++)ne(de,he);return[0,129].forEach((he=>{for(let de=0;de<130;de++)ne(de,he),ne(he,de)})),[B,V,32768]})(),E=t.context;this.gridBuffer=E.createVertexBuffer(m,i.bf.members),this.gridIndexBuffer=E.createIndexBuffer(v),this.gridSegments=i.bg.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=i.bg.simpleSegment(0,0,m.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new zm(s.map),this.orthoMatrix=i.bC(),i.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const j=E.gl;this._overlapStencilMode=new Ki({func:j.GEQUAL,mask:255},0,255,j.KEEP,j.KEEP,j.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new md(s.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,s,m){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const v=t.terrain.properties,T=t.terrain.drapeRenderMode===0,E=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const j=t.terrain&&t.terrain.scope,D=v.get("source"),B=T?this._mockSourceCache:t.getSourceCache(D,j);if(!B)return void i.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=B,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(s):v.get("exaggeration"),!s.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const V=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Y=this.getScaledDemTileSize();this.sourceCache.update(s,Y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,V(),this._initializing=!0),V(),s.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,m=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=m;const v=s!=null?m-s:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const T=t.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(T);let j=T-this._previousZoom;const D=this._previousUpdateTimestamp;let B=T;this._evaluationZoom!=null&&(B=this._evaluationZoom,Math.abs(T-B)>.5&&(j=.5*(T-B+j)),j*v<0&&(B+=j)),this._evaluationZoom=B;const V=E.getExaggeration(B),Y=V===E.getExaggeration(Math.max(0,B-.1));if(Y&&Math.abs(V-this._exaggeration)<.01)return V;let X=Math.min(.1,.00375*(this._updateTimestamp-D));return(Y||V<.1||Math.abs(j)<1e-4)&&(X=Math.min(.2,4*X)),i.ak(this._exaggeration,V,X)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=s.getIds().map((D=>{const B=s.getTileByID(D).tileID;return B.projMatrix=m.calculateProjMatrix(B.toUnwrapped()),B}));(function(D,B){const V=B.transform.pointCoordinate(B.transform.getCameraPoint()),Y=new i.P(V.x,V.y);D.sort(((X,J)=>{if(J.overscaledZ-X.overscaledZ)return J.overscaledZ-X.overscaledZ;const se=new i.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ne=new i.P(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),he=Y.mult(1<<X.canonical.z);return he.x-=.5,he.y-=.5,he.distSqr(se)-he.distSqr(ne)}))})(v,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},v.forEach((D=>{this.proxyToSource[D.key]={}})),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const D in E){const B=E[D];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,t[D],T),B.usedForTerrain))continue;const V=t[D];B.getSource().reparseOverscaled&&this._assignTerrainTiles(V)}this.proxiedCoords[s.id]=v.map((D=>new Rh(D,D.key,this.orthoMatrix))),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const j={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const B=this.terrainTileForTile[D.key];if(!B)continue;const V=B.tileID.key;V in j||(this._visibleDemTiles.push(B),j[V]=V)}}_assignTerrainTiles(t){this._initializing||t.forEach((s=>{if(this.terrainTileForTile[s.key])return;const m=this._findTileCoveringTileID(s,this.sourceCache);m&&(this.terrainTileForTile[s.key]=m)}))}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],T=v.dem;!T||v.demTexture&&!v.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),ut(this.painter,v,T))}}_prepareDemTileUniforms(t,s,m,v){if(!s||s.demTexture==null)return!1;const T=t.tileID.canonical,E=Math.pow(2,s.tileID.canonical.z-T.z),j=v||"";return m[`u_dem_tl${j}`]=[T.x*E%1,T.y*E%1],m[`u_dem_scale${j}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce(((m,v)=>{if(!v.dem)return m;const T=v.dem.tree.minimums[0];return T>0&&t++,m+T}),0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const m=this._getLoadedAreaMinimum(),v=new i.dL({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(v,{premultiply:!1}):T=this._emptyDEMTexture=new i.T(t,v,s.R32F,{premultiply:!1}),T}setupElevationDraw(t,s,m){const v=this.painter.context,T=v.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let j=null,D=null,B=1;if(m&&m.morphing&&this._useVertexMorphing){const J=m.morphing.srcDemTile,se=m.morphing.dstDemTile;B=m.morphing.phase,J&&se&&(this._prepareDemTileUniforms(t,J,E,"_prev")&&(D=J),this._prepareDemTileUniforms(t,se,E)&&(j=se))}const V=J=>J&&J.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let Y=null;var X;if(this.enabled?D&&j?(Y=j.demTexture,v.activeTexture.set(T.TEXTURE4),D.demTexture.bind(V(D),T.CLAMP_TO_EDGE),E.u_dem_lerp=B):(j=this.terrainTileForTile[t.tileID.key],Y=this._prepareDemTileUniforms(t,j,E)?j.demTexture:this.emptyDEMTexture):Y=this.emptyDEMTexture,v.activeTexture.set(T.TEXTURE2),Y&&(E.u_dem_size=(X=Y).size[0]===1?1:X.size[0]-2,Y.bind(V(j),T.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,s,E),m&&m.useMeterToDem&&j){const J=(1<<j.tileID.canonical.z)*i.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=J}if(m&&m.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),s.setTerrainUniformValues(v,E),this.painter.transform.projection.name==="globe"){const J=this.globeUniformValues(this.painter.transform,t.tileID.canonical,m&&m.useDenormalizedUpVectorScale);s.setGlobeUniformValues(v,J)}}globeUniformValues(t,s,m){const v=t.projection;return{u_tile_tl_up:v.upVector(s,0,0),u_tile_tr_up:v.upVector(s,i.al,0),u_tile_br_up:v.upVector(s,i.al,i.al),u_tile_bl_up:v.upVector(s,0,i.al),u_tile_up_scale:m?i.dM(1):v.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,m=this.painter.context;t.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(v,T,E,j,D){if(v.transform.projection.name==="globe")(function(B,V,Y,X,J){const se=B.context,ne=se.gl;let he,de;const pe=B.transform,xe=i.dE(B,se,pe),ge=(dt,mt)=>{if(de===mt)return;const Tt=[jm[mt],"PROJECTION_GLOBE_VIEW"];xe&&Tt.push("CUSTOM_ANTIALIASING");const Ot=B.isTileAffectedByFog(dt);he=B.getOrCreateProgram("globeRaster",{defines:Tt,overrideFog:Ot}),de=mt},je=B.colorModeForRenderPass(),Ae=new Pi(ne.LEQUAL,Pi.ReadWrite,B.depthRangeFor3D);ru.update(J);const De=i.dF(pe),ze=[i.aF(pe.center.lng),i.aJ(pe.center.lat)],Me=B.globeSharedBuffers,Ve=[pe.width*i.o.devicePixelRatio,pe.height*i.o.devicePixelRatio],it=Float32Array.from(pe.globeMatrix),Ye={useDenormalizedUpVectorScale:!0};{const dt=B.transform,mt=Af(dt.zoom,V.exaggeration(),V.sourceCache._source.tileSize);de=-1;const Tt=ne.TRIANGLES;for(const Ot of X){const st=Y.getTile(Ot),Xe=Ki.disabled,pt=V.prevTerrainTileForTile[Ot.key],ht=V.terrainTileForTile[Ot.key];Ef(pt,ht)&&ru.newMorphing(Ot.key,pt,ht,J,250),hd(B,st.emissiveTexture),se.activeTexture.set(ne.TEXTURE0),st.texture&&st.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const Nt=ru.getMorphValuesForProxy(Ot.key),ti=Nt?1:0;Nt&&Object.assign(Ye,{morphing:{srcDemTile:Nt.from,dstDemTile:Nt.to,phase:i.dD(Nt.phase)}});const gi=i.dG(Ot.canonical),Wt=i.dH(gi.getCenter().lat),Dt=i.dI(Ot.canonical,gi,Wt,dt.worldSize/dt._pixelsPerMercatorPixel),Ti=i.bk(i.dJ(Ot.canonical)),bi=B.emissiveMode==="mrt-fallback"?1:0,di=Iu(dt.expandedFarZProjMatrix,it,De,Ti,i.aj(dt.zoom),ze,dt.frustumCorners.TL,dt.frustumCorners.TR,dt.frustumCorners.BR,dt.frustumCorners.BL,dt.globeCenterInViewSpace,dt.globeRadius,Ve,mt,dt._farZ,bi,Dt);if(ge(Ot,ti),he&&(V.setupElevationDraw(st,he,Ye),B.uploadCommonUniforms(se,he,Ot.toUnwrapped()),Me)){const[_i,Bi,dn]=Me.getGridBuffers(Wt,mt!==0);he.draw(B,Tt,Ae,Xe,je,en.backCCW,di,"globe_raster",_i,Bi,dn)}}}if(Me&&(B.renderDefaultNorthPole||B.renderDefaultSouthPole)){const dt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xe&&dt.push("CUSTOM_ANTIALIASING"),he=B.getOrCreateProgram("globeRaster",{defines:dt});for(const mt of X){const{x:Tt,y:Ot,z:st}=mt.canonical,Xe=Ot===0,pt=Ot===(1<<st)-1,[ht,Nt,ti,gi]=Me.getPoleBuffers(st,!1);if(gi&&(Xe||pt)){const Wt=Y.getTile(mt);hd(B,Wt.emissiveTexture),se.activeTexture.set(ne.TEXTURE0),Wt.texture&&Wt.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let Dt=i.dK(st,Tt,pe);const Ti=i.bk(i.dJ(mt.canonical)),bi=B.emissiveMode==="mrt-fallback"?1:0,di=(_i,Bi)=>_i.draw(B,ne.TRIANGLES,Ae,Ki.disabled,je,en.disabled,Iu(pe.expandedFarZProjMatrix,Dt,Dt,Ti,0,ze,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,Ve,0,pe._farZ,bi),"globe_pole_raster",Bi,ti,gi);V.setupElevationDraw(Wt,he,Ye),B.uploadCommonUniforms(se,he,mt.toUnwrapped()),Xe&&B.renderDefaultNorthPole&&di(he,ht),pt&&B.renderDefaultSouthPole&&(Dt=i.cS(i.bC(),Dt,[1,-1,1]),di(he,Nt))}}}})(v,T,E,j,D);else{const B=v.context,V=B.gl;let Y,X;const J=v.shadowRenderer,se=_l(v,v.longestCutoffRange),ne=je=>{if(X===je)return;const Ae=[];Ae.push(jm[je]),se.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),J&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),J.useNormalOffset&&Ae.push("NORMAL_OFFSET")),Y=v.getOrCreateProgram("terrainRaster",{defines:Ae}),X=je},he=v.colorModeForRenderPass(),de=new Pi(V.LEQUAL,Pi.ReadWrite,v.depthRangeFor3D);ru.update(D);const pe=v.transform,xe=Af(pe.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let ge=[0,0,0];if(J){const je=v.style.directionalLight,Ae=v.style.ambientLight;je&&Ae&&(ge=Ds(v.style,je,Ae))}{X=-1;const je=V.TRIANGLES,[Ae,De]=[T.gridIndexBuffer,T.gridSegments];for(const ze of j){const Me=E.getTile(ze),Ve=Ki.disabled,it=T.prevTerrainTileForTile[ze.key],Ye=T.terrainTileForTile[ze.key];Ef(it,Ye)&&ru.newMorphing(ze.key,it,Ye,D,250),hd(v,Me.emissiveTexture),B.activeTexture.set(V.TEXTURE0),Me.texture&&Me.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const dt=ru.getMorphValuesForProxy(ze.key),mt=dt?1:0;let Tt;dt&&(Tt={morphing:{srcDemTile:dt.from,dstDemTile:dt.to,phase:i.dD(dt.phase)}});const Ot=v.emissiveMode==="mrt-fallback"?1:0,st=co(ze.projMatrix,Ru(ze.canonical,pe.renderWorldCopies)?xe/10:xe,ge,Ot);if(ne(mt),!Y)continue;T.setupElevationDraw(Me,Y,Tt);const Xe=ze.toUnwrapped();J&&J.setupShadows(Xe,Y),v.uploadCommonUniforms(B,Y,Xe,null,se),Y.draw(v,je,de,Ve,he,en.backCCW,st,"terrain_raster",T.gridBuffer,Ae,De)}}}})(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,m=this.painter.context,v=this.proxySourceCache,T=this.proxiedCoords[v.id],E=this._drapedRenderBatches.shift(),j=s.style.order,D=[];this._updateFBOs(s.emissiveMode==="mrt-fallback");let B=0;for(const V of T){const Y=v.getTileByID(V.proxyTileKey),X=v.proxyCachedFBO[V.key]?v.proxyCachedFBO[V.key][t]:void 0,J=X!==void 0?v.renderCache[X]:this.pool[B++],se=X!==void 0;if(Y.texture=J.tex,Y.emissiveTexture=J.emissiveTex,se&&!J.dirty){D.push(Y.tileID);continue}m.bindFramebuffer.set(J.fb.framebuffer);const ne=m.gl;let he;ne.drawBuffers(s.emissiveMode==="mrt-fallback"?[ne.COLOR_ATTACHMENT0,ne.COLOR_ATTACHMENT1]:[ne.COLOR_ATTACHMENT0]),this.renderedToTile=!1,J.dirty&&(m.clear({color:i.ao.transparent,stencil:0}),J.dirty=!1);for(let de=E.start;de<=E.end;++de){const pe=s.style._mergedLayers[j[de]];if(pe.isHidden(s.transform.zoom))continue;const xe=s.style.getLayerSourceCache(pe),ge=xe?this.proxyToSource[V.key][xe.id]:[V];if(!ge)continue;const je=ge;m.viewport.set([0,0,J.fb.width,J.fb.height]),he!==(xe?xe.id:null)&&(this._setupStencil(J,ge,pe,xe),he=xe?xe.id:null),s.renderLayer(s,xe,pe,je)}if(ne.drawBuffers([ne.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const de of this._pendingGroundEffectLayers){const pe=s.style._mergedLayers[j[de]];if(pe.isHidden(s.transform.zoom))continue;const xe=s.style.getLayerSourceCache(pe),ge=xe?this.proxyToSource[V.key][xe.id]:[V];if(!ge)continue;const je=ge;m.viewport.set([0,0,J.fb.width,J.fb.height]),he!==(xe?xe.id:null)&&(this._setupStencil(J,ge,pe,xe),he=xe?xe.id:null),s.renderLayer(s,xe,pe,je)}this.renderedToTile?(J.dirty=!0,D.push(Y.tileID)):se||--B,B===5&&(B=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,s.width,s.height]),E.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let m=-1,v=s;for(let T=0;T<s;++T)this._style.isLayerDraped(t._mergedLayers[t.order[T]])?m=Math.max(m,T):v=Math.min(v,T);return v>m}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((s=>s.dem)).forEach((s=>{t=Math.min(t,s.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,s,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter((T=>T.dem)).map((T=>{const E=T.tileID,j=1<<E.overscaledZ,{x:D,y:B}=E.canonical,V=D/j,Y=(D+1)/j,X=B/j,J=(B+1)/j;return{minx:V,miny:X,maxx:Y,maxy:J,t:T.dem.tree.raycastRoot(V,X,Y,J,t,s,m),tile:T}}));v.sort(((T,E)=>(T.t!==null?T.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE)));for(const T of v){if(T.t==null)return null;const E=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,t,s,m);if(E!=null)return E}return null}_createFBO(){const t=this.painter.context,s=t.gl,m=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const v=new i.T(t,{width:m[0],height:m[1],data:null},s.RGBA8);v.bind(s.LINEAR,s.CLAMP_TO_EDGE);const T=t.createFramebuffer(m[0],m[1],1,null);let E;return T.colorAttachment0.set(v.texture),this._emissiveTexture&&(E=new i.T(t,{width:m[0],height:m[1],data:null},s.R8),E.bind(s.LINEAR,s.CLAMP_TO_EDGE),T.createColorAttachment(t,1),T.colorAttachment1.set(E.texture)),T.depthAttachment=new Pm(t,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:T,tex:v,emissiveTex:E,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const s of this.pool)this._updateFBO(s,t);for(const s of this.proxySourceCache.renderCache)this._updateFBO(s,t);this._emissiveTexture=t}}_updateFBO(t,s){const m=t.fb,v=this.painter.context,T=v.gl,E=this.drapeBufferSize;if(s){const j=new i.T(v,{width:E[0],height:E[1],data:null},T.R8);j.bind(T.LINEAR,T.CLAMP_TO_EDGE),t.emissiveTex=j,m.createColorAttachment(v,1),m.colorAttachment1.set(j.texture)}else t.emissiveTex=void 0,m.removeColorAttachment(v,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const s=this._style._mergedLayers[t],m=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!m&&s.shouldRedrape():!m&&s.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const m of this._style.getSources())if(m instanceof rs){t=!0;break}if(!t)return;const s={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],T=this._style.getLayerSourceCache(v);if(!T||s[T.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="line")continue;const E=v.widthExpression(),j=v.emissiveStrengthExpression();if(E instanceof i.ad||j instanceof i.ad){s[T.id]=!0;for(const D of this.proxyCoords){const B=this.proxyToSource[D.key][T.id];if(B)for(const V of B)this._clearRenderCacheForTile(T.id,V)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof er){t=!0;break}if(!t)return;const s={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],T=this._style.getLayerSourceCache(v);if(!T||s[T.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const E=v.paint.get("raster-fade-duration");for(const j of this.proxyCoords){const D=this.proxyToSource[j.key][T.id];if(D)for(const B of D){const V=Ih(T.getTile(B),T.findLoadedParent(B,0),T,this.painter.transform,E);(V.opacity!==1||V.mix!==0)&&this._clearRenderCacheForTile(T.id,B)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const m=[];this._pendingGroundEffectLayers=[];let v,T=0,E=this._style._mergedLayers[t[T]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++T<s;)E=this._style._mergedLayers[t[T]];for(;T<s;++T){const j=this._style._mergedLayers[t[T]];j.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(j)?v===void 0&&(v=T):(j.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),v!==void 0&&(m.push({start:v,end:T-1}),v=void 0)))}if(v!==void 0&&m.push({start:v,end:T-1}),m.length!==0){const j=m[m.length-1];this._pendingGroundEffectLayers.every((D=>D>j.end))||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const E=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let j=0;j<E.length;++j){const D=Object.values(E[j]);s.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let E=m.length-1;E>=0;E--){const j=m[E];if(s.getTileByID(j.key),s.proxyCachedFBO[j.key]!==void 0){const D=t[j.key],B=this.proxyToSource[j.key];let V=0;for(const Y in B){const X=B[Y],J=D[Y];if(!J||J.length!==X.length||X.some(((se,ne)=>se!==J[ne]||v[Y]&&v[Y].hasOwnProperty(se.key)))){V=-1;break}++V}for(const Y in s.proxyCachedFBO[j.key])s.renderCache[s.proxyCachedFBO[j.key][Y]].dirty=V<0||V!==Object.values(D).length}}const T=[...this._drapedRenderBatches];T.sort(((E,j)=>j.end-j.start-(E.end-E.start)));for(const E of T)for(const j of m){if(s.proxyCachedFBO[j.key])continue;let D=s.renderCachePool.pop();D===void 0&&s.renderCache.length<50&&(D=s.renderCache.length,s.renderCache.push(this._createFBO())),D!==void 0&&(s.proxyCachedFBO[j.key]={},s.proxyCachedFBO[j.key][E.start]=D,s.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,E=T.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let j;if(m.isTileClipped())j=s.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);j=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+j>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=j,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ki.disabled}_renderTileClippingMasks(t,s){const m=this.painter,v=this.painter.context,T=v.gl;m._tileClippingMaskIDs={},v.setColorMode(sn.disabled),v.setDepthMode(Pi.disabled);const E=m.getOrCreateProgram("clippingMask");for(const j of t){const D=m._tileClippingMaskIDs[j.key]=--s;E.draw(m,T.TRIANGLES,Pi.disabled,new Ki({func:T.ALWAYS,mask:0},D,255,T.KEEP,T.KEEP,T.REPLACE),sn.disabled,en.disabled,fd(j.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const m=[t.x,t.y,1,1];i.aC(m,m,s.pixelMatrixInverse),i.cK(m,m,1/m[3]),m[0]/=s.worldSize,m[1]/=s.worldSize;const v=s._camera.position,T=i.cf(1,s.center.lat),E=[v[0],v[1],v[2]/T,0],j=i.da([],m.slice(0,3),E);i.aw(j,j);const D=this.raycast(E,j,this._exaggeration);return D!==null&&D?(i.bH(E,E,j,D),E[3]=E[2],E[2]*=T,E):null}_setupProxiedCoordsForOrtho(t,s,m){if(t.getSource()instanceof i.aU)return this._setupProxiedCoordsForImageSource(t,s,m);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const v=this.proxiedCoords[t.id]=[],T=this.proxyCoords;for(let D=0;D<T.length;D++){const B=T[D],V=this._findTileCoveringTileID(B,t);if(V){const Y=this._createProxiedId(B,V,m[B.key]&&m[B.key][t.id]);v.push(Y),this.proxyToSource[B.key][t.id]=[Y]}}let E=!1;const j=new Set;for(let D=0;D<s.length;D++){const B=t.getTile(s[D]);if(!B||!B.hasData())continue;const V=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(V&&V.tileID.canonical.z!==B.tileID.canonical.z){const Y=this.proxyToSource[V.tileID.key][t.id],X=this._createProxiedId(V.tileID,B,m[V.tileID.key]&&m[V.tileID.key][t.id]);Y?Y.splice(Y.length-1,0,X):this.proxyToSource[V.tileID.key][t.id]=[X];const J=this.proxyToSource[V.tileID.key][t.id];j.has(J)||j.add(J),v.push(X),E=!0}}if(this._sourceTilesOverlap[t.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const D of j)D.sort(((B,V)=>V.overscaledZ-B.overscaledZ))}_setupProxiedCoordsForImageSource(t,s,m){if(!t.getSource().loaded())return;const v=this.proxiedCoords[t.id]=[],T=this.proxyCoords,E=t.getSource(),j=E.tileID;if(!j)return;const D=new i.P(j.x,j.y)._div(1<<j.z),B=E.coordinates.map(i.ae.fromLngLat).reduce(((Y,X)=>(Y.min.x=Math.min(Y.min.x,X.x-D.x),Y.min.y=Math.min(Y.min.y,X.y-D.y),Y.max.x=Math.max(Y.max.x,X.x-D.x),Y.max.y=Math.max(Y.max.y,X.y-D.y),Y)),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),V=(Y,X)=>{const J=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),se=Y.canonical.y/(1<<Y.canonical.z),ne=i.al/(1<<Y.canonical.z),he=X.wrap+X.canonical.x/(1<<X.canonical.z),de=X.canonical.y/(1<<X.canonical.z);return J+ne<he+B.min.x||J>he+B.max.x||se+ne<de+B.min.y||se>de+B.max.y};for(let Y=0;Y<T.length;Y++){const X=T[Y];for(let J=0;J<s.length;J++){const se=t.getTile(s[J]);if(!se||!se.hasData()||V(X,se.tileID))continue;const ne=this._createProxiedId(X,se,m[X.key]&&m[X.key][t.id]),he=this.proxyToSource[X.key][t.id];he?he.push(ne):this.proxyToSource[X.key][t.id]=[ne],v.push(ne)}}}_createProxiedId(t,s,m){let v=this.orthoMatrix;if(m){const T=m.find((E=>E.key===s.tileID.key));if(T)return T}if(s.tileID.key!==t.key){const T=t.canonical.z-s.tileID.canonical.z;let E,j,D;v=i.bC();const B=s.tileID.wrap-t.wrap<<t.overscaledZ;T>0?(E=i.al>>T,j=E*((s.tileID.canonical.x<<T)-t.canonical.x+B),D=E*((s.tileID.canonical.y<<T)-t.canonical.y)):(E=i.al<<-T,j=i.al*(s.tileID.canonical.x-(t.canonical.x+B<<-T)),D=i.al*(s.tileID.canonical.y-(t.canonical.y<<-T))),i.ce(v,0,E,0,E,0,1),i.br(v,v,[j,D,0])}return new Rh(s.tileID,t.key,v)}_findTileCoveringTileID(t,s){let m=s.getTile(t);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[s.id],T=v[t.key];if(m=T?s.getTileByID(T):null,m&&m.hasData()||T===null)return m;let E=m?m.tileID:t,j=E.overscaledZ;const D=s.getSource().minzoom,B=[];if(!T){const Y=s.getSource().maxzoom;if(t.canonical.z>=Y){const X=t.canonical.z-Y;s.getSource().reparseOverscaled?(j=Math.max(t.canonical.z+2,s.transform.tileZoom),E=new i.aQ(j,t.wrap,Y,t.canonical.x>>X,t.canonical.y>>X)):X!==0&&(j=Y,E=new i.aQ(j,t.wrap,Y,t.canonical.x>>X,t.canonical.y>>X))}E.key!==t.key&&(B.push(E.key),m=s.getTile(E))}const V=Y=>{B.forEach((X=>{v[X]=Y})),B.length=0};for(j-=1;j>=D&&(!m||!m.hasData());j--){m&&V(m.tileID.key);const Y=E.calculateScaledKey(j);if(m=s.getTileByID(Y),m&&m.hasData())break;const X=v[Y];if(X===null)break;X===void 0?B.push(Y):m=s.getTileByID(X)}return V(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let m=this._tilesDirty[t];m||(m=this._tilesDirty[t]={}),m[s.key]=!0}}function qd(f,t,s){const m=(function(j,D,B){const V=i.bJ(D,j),Y=i.bJ(B,[.2126,.7152,.0722]),X=(se,ne,he)=>(1-he)*se+he*ne,J=X(1-.3*Math.min(Y,1),1,Math.min(V+1,1));return X(.92,1,Math.asin(i.aA(D[2],-1,1))/Math.PI+.5)*J})(f,[0,0,1],t),v=[0,0,0];i.c5(v,s.slice(0,3),m);const T=[0,0,0];i.c5(T,t.slice(0,3),f[2]);const E=[0,0,0];return i.d8(E,v,T),i.db(E)}const Im=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],t_=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Dh{static cacheKey(t,s,m,v){const T=[s];v&&T.push(v.cacheKey);for(const E of m)t.usedDefines.has(E)&&T.push(E);return T.join("/")}constructor(t,s,m,v,T,E){const j=t.gl;this.program=j.createProgram(),this.configuration=v,this.name=s,this.fixedDefines=[...E];const D=`#version 300 es
${(v?v.defines():[]).concat(E.map((ne=>`#define ${ne}`))).join(`
`)}`,B=[D,Pu];for(const ne of m.fragmentIncludes)B.push(xl[ne]);B.push(m.fragmentSource);const V=B.join(`
`),Y=[D,ju];for(const ne of m.vertexIncludes)Y.push(xl[ne]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&m.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&Y.push("uniform int u_instanceID;"),Y.push(m.vertexSource);let X=Y.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(X=X.replaceAll("gl_InstanceID","u_instanceID"));const J=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);j.shaderSource(J,V),j.compileShader(J),j.attachShader(this.program,J);const se=j.createShader(j.VERTEX_SHADER);j.isContextLost()?this.failedToCreate=!0:(j.shaderSource(se,X),j.compileShader(se),j.attachShader(this.program,se),this.attributes={},j.linkProgram(this.program),j.deleteShader(se),j.deleteShader(J),this.fixedUniforms=T(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=v?v.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ne=>({u_instanceID:new i.ch(ne)}))(t)),(E.includes("TERRAIN")||s.includes("symbol")||s.includes("circle"))&&(this.terrainUniforms=(ne=>({u_dem:new i.ch(ne),u_dem_prev:new i.ch(ne),u_dem_tl:new i.ck(ne),u_dem_scale:new i.cj(ne),u_dem_tl_prev:new i.ck(ne),u_dem_scale_prev:new i.cj(ne),u_dem_size:new i.cj(ne),u_dem_lerp:new i.cj(ne),u_exaggeration:new i.cj(ne),u_depth:new i.ch(ne),u_depth_size_inv:new i.ck(ne),u_depth_range_unpack:new i.ck(ne),u_occluder_half_size:new i.cj(ne),u_occlusion_depth_offset:new i.cj(ne),u_meter_to_dem:new i.cj(ne),u_label_plane_matrix_inv:new i.cl(ne)}))(t)),E.includes("GLOBE")&&(this.globeUniforms=(ne=>({u_tile_tl_up:new i.ci(ne),u_tile_tr_up:new i.ci(ne),u_tile_br_up:new i.ci(ne),u_tile_bl_up:new i.ci(ne),u_tile_up_scale:new i.cj(ne)}))(t)),E.includes("FOG")&&(this.fogUniforms=(ne=>({u_fog_matrix:new i.cl(ne),u_fog_range:new i.ck(ne),u_fog_color:new i.d3(ne),u_fog_horizon_blend:new i.cj(ne),u_fog_vertical_limit:new i.ck(ne),u_fog_temporal_offset:new i.cj(ne),u_frustum_tl:new i.ci(ne),u_frustum_tr:new i.ci(ne),u_frustum_br:new i.ci(ne),u_frustum_bl:new i.ci(ne),u_globe_pos:new i.ci(ne),u_globe_radius:new i.cj(ne),u_globe_transition:new i.cj(ne),u_is_globe:new i.ch(ne),u_viewport:new i.ck(ne)}))(t)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ne=>({u_cutoff_params:new i.d3(ne)}))(t)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ne=>({u_lighting_ambient_color:new i.ci(ne),u_lighting_directional_dir:new i.ci(ne),u_lighting_directional_color:new i.ci(ne),u_ground_radiance:new i.ci(ne)}))(t)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ne=>({u_light_matrix_0:new i.cl(ne),u_light_matrix_1:new i.cl(ne),u_fade_range:new i.ck(ne),u_shadow_normal_offset:new i.ci(ne),u_shadow_intensity:new i.cj(ne),u_shadow_texel_size:new i.cj(ne),u_shadow_map_resolution:new i.cj(ne),u_shadow_direction:new i.ci(ne),u_shadow_bias:new i.ci(ne),u_shadowmap_0:new i.ch(ne),u_shadowmap_1:new i.ch(ne)}))(t)))}getAttributeLocation(t,s){let m=this.attributes[s];return m===void 0&&(m=this.attributes[s]=t.getAttribLocation(this.program,s)),m}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const v in s)m[v]&&m[v].set(this.program,v,s[v])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const v in s)m[v]&&m[v].set(this.program,v,s[v])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const v in s)m[v].set(this.program,v,s[v])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const v in s)m[v].set(this.program,v,s[v])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const v in s)m[v].set(this.program,v,s[v])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;t.program.set(this.program);for(const v in s)m[v].set(this.program,v,s[v])}_drawDebugWireframe(t,s,m,v,T,E,j,D,B,V){const Y=t.options.wireframe;if(Y.terrain===!1&&Y.layers2D===!1&&Y.layers3D===!1)return;const X=t.context;if(!(!(!Y.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Y.layers2D||t._terrain&&t._terrain.renderingToTexture||!Im.includes(this.name))||!(!Y.layers3D||!t_.includes(this.name))))return;const J=X.gl,se=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,T,X);if(!se)return;const ne=[...this.fixedDefines,"DEBUG_WIREFRAME"],he=t.getOrCreateProgram(this.name,{config:this.configuration,defines:ne});X.program.set(he.program);const de=(ge,je,Ae)=>{if(je[ge]&&Ae[ge])for(const De in je[ge])Ae[ge][De]&&Ae[ge][De].set(Ae.program,De,je[ge][De].current)};B&&B.setUniforms(he.program,X,he.binderUniforms,j,{zoom:D}),de("fixedUniforms",this,he),de("terrainUniforms",this,he),de("globeUniforms",this,he),de("fogUniforms",this,he),de("lightsUniforms",this,he),de("shadowUniforms",this,he),se.bind(),X.setColorMode(new sn([J.ONE,J.ONE_MINUS_SRC_ALPHA,J.ZERO,J.ONE],i.ao.transparent,[!0,!0,!0,!1])),X.setDepthMode(new Pi(s.func===J.LESS?J.LEQUAL:s.func,Pi.ReadOnly,s.range)),X.setStencilMode(Ki.disabled);const pe=3*E.primitiveLength*2,xe=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ge=V||1;for(let je=0;je<ge;++je)he.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",je),J.drawElements(J.LINES,pe,J.UNSIGNED_SHORT,xe)}else V&&V>1?J.drawElementsInstanced(J.LINES,pe,J.UNSIGNED_SHORT,xe,V):J.drawElements(J.LINES,pe,J.UNSIGNED_SHORT,xe);T.bind(),X.program.set(this.program),X.setDepthMode(s),X.setStencilMode(m),X.setColorMode(v)}checkUniforms(t,s,m){if(this.fixedDefines.includes(s)){for(const v of Object.keys(m))if(!m[v].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${v} not set but required by ${s} being defined`)}}draw(t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he){const de=t.context,pe=de.gl;if(this.failedToCreate)return;de.program.set(this.program),de.setDepthMode(m),de.setStencilMode(v),de.setColorMode(T),de.setCullFace(E);for(const[ze,Me]of this.fixedUniformsEntries)Me.set(this.program,ze,j[ze]);se&&se.setUniforms(this.program,de,this.binderUniforms,X,{zoom:J});const xe={[pe.POINTS]:1,[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[s];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const ge=ne||[],je=se?se.getPaintVertexBuffers():[],Ae=s===pe.TRIANGLES&&V,De=he&&he>0?1:void 0;for(const ze of Y.get()){const Me=ze.vaos||(ze.vaos={});if((Me[D]||(Me[D]=new te)).bind(de,this,B,je,V,ze.vertexOffset,ge,De),this.forceManualRenderingForInstanceIDShaders){const Ve=he||1;for(let it=0;it<Ve;++it)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",it),V?pe.drawElements(s,ze.primitiveLength*xe,pe.UNSIGNED_SHORT,ze.primitiveOffset*xe*2):pe.drawArrays(s,ze.vertexOffset,ze.vertexLength)}else he&&he>1?pe.drawElementsInstanced(s,ze.primitiveLength*xe,pe.UNSIGNED_SHORT,ze.primitiveOffset*xe*2,he):V?pe.drawElements(s,ze.primitiveLength*xe,pe.UNSIGNED_SHORT,ze.primitiveOffset*xe*2):pe.drawArrays(s,ze.vertexOffset,ze.vertexLength);Ae&&this._drawDebugWireframe(t,m,v,T,V,ze,X,J,se,he)}}}function Xp(f,t,s=0){const m=Math.pow(2,t.tileID.overscaledZ),v=t.tileSize*Math.pow(2,f.transform.tileZoom)/m,T=v*(t.tileID.canonical.x+t.tileID.wrap*m),E=v*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(t,1,f.transform.tileZoom),u_pixel_coord_upper:[T>>16,E>>16],u_pixel_coord_lower:[65535&T,65535&E],u_pattern_transition:s}}const Mf={terrain:0,flat:1},pd=i.bC(),Lh=(f,t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he,de)=>{const pe=t.style.light,xe=pe.properties.get("position"),ge=[xe.x,xe.y,xe.z],je=i.dO();pe.properties.get("anchor")==="viewport"&&(i.dP(je,-t.transform.angle),i.dQ(ge,ge,je));const Ae=pe.properties.get("color").toPremultipliedRenderColor(null),De=t.transform,ze={u_matrix:f,u_lightpos:ge,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+s,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Mf[B],u_base_type:Mf[V],u_ao:v,u_edge_radius:T,u_width_scale:E,u_flood_light_color:se,u_vertical_scale:ne,u_flood_light_intensity:he,u_ground_shadow_factor:de};return De.projection.name==="globe"&&(ze.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],ze.u_zoom_transition=Y,ze.u_inv_rot_matrix=J,ze.u_merc_center=X,ze.u_up_dir=De.projection.upVector(new i.cD(0,0,0),X[0]*i.al,X[1]*i.al),ze.u_height_lift=D),ze},Pf=(f,t,s,m,v,T)=>({u_matrix:f,u_edge_radius:t,u_width_scale:s,u_vertical_scale:m,u_height_type:Mf[v],u_base_type:Mf[T]}),Du=(f,t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he,de)=>{const pe=Lh(f,t,s,m,v,T,E,j,B,V,Y,X,J,se,ne,he,1,[0,0,0]),xe={u_height_factor:-Math.pow(2,j.overscaledZ)/D.tileSize/8};return Object.assign(pe,Xp(t,D,de),xe)},Ul=(f,t,s,m,v,T,E,j,D,B,V)=>({u_matrix:t,u_opacity:s,u_ao_pass:m?1:0,u_meter_to_tile:v,u_ao:T,u_flood_light_intensity:E,u_flood_light_color:j,u_attenuation:D,u_edge_radius:B,u_fb:0,u_fb_size:V,u_dynamic_offset:1}),Wd=(f,t,s)=>({u_matrix:f,u_emissive_strength:t,u_ground_shadow_factor:s}),jf=(f,t,s,m,v,T=0)=>Object.assign(Wd(f,t,v),Xp(s,m,T)),Rm=(f,t,s,m)=>({u_matrix:f,u_world:s,u_emissive_strength:t,u_ground_shadow_factor:m}),Zd=(f,t,s,m,v,T,E=0)=>Object.assign(jf(f,t,s,m,T,E),{u_world:v}),sc=(f,t)=>({u_matrix:f,u_ground_shadow_factor:t}),gd=(f,t,s,m,v)=>({u_matrix:f,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:m,u_reset_depth:v}),zf=(f,t,s,m,v,T,E,j,D)=>({u_matrix:f,u_normal_matrix:t,u_opacity:s,u_faux_facade_ao_intensity:m,u_camera_pos:v,u_tile_to_meter:T,u_facade_emissive_chance:E,u_flood_light_color:j,u_flood_light_intensity:D}),Xd=f=>({u_matrix:f}),kc=f=>({u_matrix:f}),Dm=(f,t,s,m,v,T,E,j)=>{const D=i.al/T.tileSize;return{u_matrix:f,u_inv_rot_matrix:t,u_camera_to_center_distance:s.getCameraToCenterDistance(j),u_extrude_scale:[s.pixelsToGLUnits[0]/D,s.pixelsToGLUnits[1]/D],u_zoom_transition:m,u_tile_id:E,u_merc_center:v}},Yd=(f,t,s=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:s}),Lm=i.bC(),Lu=(f,t,s,m,v,T,E)=>{const j=f.transform,D=j.projection.name==="globe",B=D?i.dR(j.zoom,t.canonical)*j._pixelsPerMercatorPixel:i.ay(s,1,T),V={u_matrix:t.projMatrix,u_extrude_scale:B,u_intensity:E,u_inv_rot_matrix:Lm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){V.u_inv_rot_matrix=m,V.u_merc_center=v,V.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],V.u_zoom_transition=i.aj(j.zoom);const Y=v[0]*i.al,X=v[1]*i.al;V.u_up_dir=j.projection.upVector(new i.cD(0,0,0),Y,X)}return V};function Ca(f,[t,s,m,v],[T,E]){if(T===E)return[0,0,0,0];const j=255*(f-1)/(f*(E-T));return[t*j,s*j,m*j,v*j]}function vr(f,t,[s,m]){return s===m?0:.5/f+(t-s)*(f-1)/(f*(m-s))}const Ts=(f,t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he,de,pe,xe,ge)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:T,u_scale_parent:B,u_fade_t:V.mix,u_opacity:V.opacity*Y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Y.paint.get("raster-brightness-min"),u_brightness_high:Y.paint.get("raster-brightness-max"),u_saturation_factor:i.dT(Y.paint.get("raster-saturation")),u_contrast_factor:i.dS(Y.paint.get("raster-contrast")),u_spin_weights:If(Y.paint.get("raster-hue-rotate")),u_perspective_transform:X,u_raster_elevation:J,u_zoom_transition:E,u_merc_center:j,u_cutoff_params:D,u_colorization_mix:Ca(i.dU,ne,de),u_colorization_offset:vr(i.dU,he,de),u_color_ramp:se,u_texture_offset:[xe/(pe+2*xe),pe/(pe+2*xe)],u_texture_res:[pe+2*xe,pe+2*xe],u_emissive_strength:ge});function If(f){f*=Math.PI/180;const t=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const nl=.05,Kd=(f,t,s,m,v,T,E,j,D,B,V,Y)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:T,u_scale_parent:B,u_fade_t:V.mix,u_opacity:V.opacity,u_image0:0,u_image1:1,u_raster_elevation:Y,u_zoom_transition:E,u_merc_center:j,u_cutoff_params:D}),Om=(f,t,s,m,v,T,E,j,D,B)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:m,u_color_ramp:T,u_velocity_res:v,u_max_speed:E,u_uv_offset:j,u_data_scale:[255*D[0],255*D[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[nl,nl]}),Oh=(f,t,s,m,v,T,E,j,D,B)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:m,u_max_speed:v,u_speed_factor:T,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:j,u_data_scale:[255*D[0],255*D[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[nl,nl]}),Jd=i.bC(),Nm=(f,t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he,de,pe,xe,ge,je,Ae,De)=>{const ze=v.transform,Me={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ze.getCameraToCenterDistance(pe),u_rotate_symbol:+s,u_aspect_ratio:ze.width/ze.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:E,u_coord_matrix:j,u_is_text:+B,u_elevation_from_sea:D?1:0,u_pitch_with_map:+m,u_texsize:V,u_texsize_icon:Y,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Jd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Jd,u_up_vector:[0,-1,0],u_color_adj_mat:je,u_icon_transition:Ae||0,u_gamma_scale:m?v.transform.getCameraToCenterDistance(pe)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:De||1,u_ground_shadow_factor:xe,u_inv_matrix:i.bl(i.bC(),E),u_normal_scale:ge,u_lutTexture:Ir.LUT};return pe.name==="globe"&&(Me.u_tile_id=[J.canonical.x,J.canonical.y,1<<J.canonical.z],Me.u_zoom_transition=se,Me.u_inv_rot_matrix=he,Me.u_merc_center=ne,Me.u_camera_forward=ze._camera.forward(),Me.u_ecef_origin=i.dV(ze.globeMatrix,J.toUnwrapped()),Me.u_tile_matrix=Float32Array.from(ze.globeMatrix),Me.u_up_vector=de),Me},Gr=(f,t,s,m)=>({u_matrix:f,u_emissive_strength:t,u_opacity:s,u_color:m}),su=(f,t,s,m,v,T,E,j,D)=>Object.assign((function(B,V,Y,X,J,se){const{width:ne,height:he}=X.imageManager.getPixelSize(V),de=Math.pow(2,se.tileID.overscaledZ),pe=se.tileSize*Math.pow(2,X.transform.tileZoom)/de,xe=pe*(se.tileID.canonical.x+se.tileID.wrap*de),ge=pe*se.tileID.canonical.y;return{u_image:0,u_pattern_tl:Y.tl,u_pattern_br:Y.br,u_texsize:[ne,he],u_pattern_size:Y.displaySize,u_pattern_units_to_pixels:J?[X.transform.width,-1*X.transform.height]:[1/i.ay(se,1,X.transform.tileZoom),1/i.ay(se,1,X.transform.tileZoom)],u_pixel_coord_upper:[xe>>16,ge>>16],u_pixel_coord_lower:[65535&xe,65535&ge]}})(0,T,E,m,j,D),{u_matrix:f,u_emissive_strength:t,u_opacity:s}),_d=new Float32Array(i.bA([])),yd=(f,t,s,m,v,T,E,j,D,B,V,Y,X,J=[0,0,0],se,ne,he)=>{const de=v.style.light,pe=de.properties.get("position"),xe=[-pe.x,-pe.y,pe.z],ge=i.dO();de.properties.get("anchor")==="viewport"&&(i.dP(ge,-v.transform.angle),i.dQ(xe,xe,ge));const je=V.alphaMode==="MASK",Ae=de.properties.get("color").toNonPremultipliedRenderColor(null),De=X.paint.get("model-ambient-occlusion-intensity"),ze=X.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return ze.a=X.paint.get("model-color-mix-intensity").constantOr(0),he&&(ze.r=he[0],ze.g=he[1],ze.b=he[2],ze.a=he[3]),ne&&(ze.r=ne.color.r,ze.g=ne.color.g,ze.b=ne.color.b,ze.a=ne.colorMix,Y=ne.emissionStrength,T*=ne.opacity),{u_matrix:f,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:m||_d,u_lightpos:xe,u_lightintensity:de.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_camera_pos:J,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+je,u_alphaCutoff:V.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:j.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:D,u_roughnessFactor:B,u_baseColorTexture:Ir.BaseColor,u_metallicRoughnessTexture:Ir.MetallicRoughness,u_normalTexture:Ir.Normal,u_occlusionTexture:Ir.Occlusion,u_emissionTexture:Ir.Emission,u_lutTexture:Ir.LUT,u_color_mix:ze.toArray01(),u_aoIntensity:De,u_emissive_strength:Y,u_occlusionTextureTransform:se||[0,0,0,0]}},Fm=(f,t=_d,s=_d)=>({u_matrix:f,u_instance:t,u_node_matrix:s}),Bm={fillExtrusion:f=>({u_matrix:new i.cl(f),u_lightpos:new i.ci(f),u_lightintensity:new i.cj(f),u_lightcolor:new i.ci(f),u_vertical_gradient:new i.cj(f),u_opacity:new i.cj(f),u_edge_radius:new i.cj(f),u_width_scale:new i.cj(f),u_ao:new i.ck(f),u_height_type:new i.ch(f),u_base_type:new i.ch(f),u_tile_id:new i.ci(f),u_zoom_transition:new i.cj(f),u_inv_rot_matrix:new i.cl(f),u_merc_center:new i.ck(f),u_up_dir:new i.ci(f),u_height_lift:new i.cj(f),u_flood_light_color:new i.ci(f),u_vertical_scale:new i.cj(f),u_flood_light_intensity:new i.cj(f),u_ground_shadow_factor:new i.ci(f)}),fillExtrusionDepth:f=>({u_matrix:new i.cl(f),u_edge_radius:new i.cj(f),u_width_scale:new i.cj(f),u_vertical_scale:new i.cj(f),u_height_type:new i.ch(f),u_base_type:new i.ch(f)}),fillExtrusionPattern:f=>({u_matrix:new i.cl(f),u_lightpos:new i.ci(f),u_lightintensity:new i.cj(f),u_lightcolor:new i.ci(f),u_vertical_gradient:new i.cj(f),u_height_factor:new i.cj(f),u_edge_radius:new i.cj(f),u_width_scale:new i.cj(f),u_ao:new i.ck(f),u_height_type:new i.ch(f),u_base_type:new i.ch(f),u_tile_id:new i.ci(f),u_zoom_transition:new i.cj(f),u_inv_rot_matrix:new i.cl(f),u_merc_center:new i.ck(f),u_up_dir:new i.ci(f),u_height_lift:new i.cj(f),u_image:new i.ch(f),u_texsize:new i.ck(f),u_pixel_coord_upper:new i.ck(f),u_pixel_coord_lower:new i.ck(f),u_tile_units_to_pixels:new i.cj(f),u_opacity:new i.cj(f),u_pattern_transition:new i.cj(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new i.cl(f),u_opacity:new i.cj(f),u_ao_pass:new i.cj(f),u_meter_to_tile:new i.cj(f),u_ao:new i.ck(f),u_flood_light_intensity:new i.cj(f),u_flood_light_color:new i.ci(f),u_attenuation:new i.cj(f),u_edge_radius:new i.cj(f),u_fb:new i.ch(f),u_fb_size:new i.cj(f),u_dynamic_offset:new i.cj(f)}),fill:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_ground_shadow_factor:new i.ci(f)}),fillPattern:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_image:new i.ch(f),u_texsize:new i.ck(f),u_pixel_coord_upper:new i.ck(f),u_pixel_coord_lower:new i.ck(f),u_tile_units_to_pixels:new i.cj(f),u_ground_shadow_factor:new i.ci(f),u_pattern_transition:new i.cj(f)}),fillOutline:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_world:new i.ck(f),u_ground_shadow_factor:new i.ci(f)}),fillOutlinePattern:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_world:new i.ck(f),u_image:new i.ch(f),u_texsize:new i.ck(f),u_pixel_coord_upper:new i.ck(f),u_pixel_coord_lower:new i.ck(f),u_tile_units_to_pixels:new i.cj(f),u_ground_shadow_factor:new i.ci(f),u_pattern_transition:new i.cj(f)}),building:f=>({u_matrix:new i.cl(f),u_normal_matrix:new i.cl(f),u_opacity:new i.cj(f),u_faux_facade_ao_intensity:new i.cj(f),u_camera_pos:new i.ci(f),u_tile_to_meter:new i.cj(f),u_facade_emissive_chance:new i.cj(f),u_flood_light_color:new i.ci(f),u_flood_light_intensity:new i.cj(f)}),buildingBloom:f=>({u_matrix:new i.cl(f)}),buildingDepth:f=>({u_matrix:new i.cl(f)}),elevatedStructuresDepth:f=>({u_matrix:new i.cl(f),u_depth_bias:new i.cj(f)}),elevatedStructures:f=>({u_matrix:new i.cl(f),u_ground_shadow_factor:new i.ci(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new i.cl(f),u_camera_pos:new i.ci(f),u_depth_bias:new i.cj(f),u_height_scale:new i.cj(f),u_reset_depth:new i.cj(f)}),circle:i.dY,collisionBox:f=>({u_matrix:new i.cl(f),u_inv_rot_matrix:new i.cl(f),u_camera_to_center_distance:new i.cj(f),u_extrude_scale:new i.ck(f),u_zoom_transition:new i.cj(f),u_merc_center:new i.ck(f),u_tile_id:new i.ci(f)}),collisionCircle:f=>({u_matrix:new i.cl(f),u_inv_matrix:new i.cl(f),u_camera_to_center_distance:new i.cj(f),u_viewport_size:new i.ck(f)}),debug:f=>({u_color:new i.dB(f),u_matrix:new i.cl(f),u_overlay:new i.ch(f),u_overlay_scale:new i.cj(f)}),clippingMask:f=>({u_matrix:new i.cl(f)}),heatmap:f=>({u_extrude_scale:new i.cj(f),u_intensity:new i.cj(f),u_matrix:new i.cl(f),u_inv_rot_matrix:new i.cl(f),u_merc_center:new i.ck(f),u_tile_id:new i.ci(f),u_zoom_transition:new i.cj(f),u_up_dir:new i.ci(f)}),heatmapTexture:f=>({u_image:new i.ch(f),u_color_ramp:new i.ch(f),u_opacity:new i.cj(f)}),hillshade:f=>({u_matrix:new i.cl(f),u_image:new i.ch(f),u_latrange:new i.ck(f),u_light:new i.ck(f),u_shadow:new i.dB(f),u_highlight:new i.dB(f),u_emissive_strength:new i.cj(f),u_accent:new i.dB(f)}),hillshadePrepare:f=>({u_matrix:new i.cl(f),u_image:new i.ch(f),u_dimension:new i.ck(f),u_zoom:new i.cj(f)}),line:i.dX,linePattern:i.dW,raster:f=>({u_matrix:new i.cl(f),u_normalize_matrix:new i.cl(f),u_globe_matrix:new i.cl(f),u_merc_matrix:new i.cl(f),u_grid_matrix:new i.dC(f),u_tl_parent:new i.ck(f),u_scale_parent:new i.cj(f),u_fade_t:new i.cj(f),u_opacity:new i.cj(f),u_image0:new i.ch(f),u_image1:new i.ch(f),u_brightness_low:new i.cj(f),u_brightness_high:new i.cj(f),u_saturation_factor:new i.cj(f),u_contrast_factor:new i.cj(f),u_spin_weights:new i.ci(f),u_perspective_transform:new i.ck(f),u_raster_elevation:new i.cj(f),u_zoom_transition:new i.cj(f),u_merc_center:new i.ck(f),u_cutoff_params:new i.d3(f),u_colorization_mix:new i.d3(f),u_colorization_offset:new i.cj(f),u_color_ramp:new i.ch(f),u_texture_offset:new i.ck(f),u_texture_res:new i.ck(f),u_emissive_strength:new i.cj(f)}),rasterParticle:f=>({u_matrix:new i.cl(f),u_normalize_matrix:new i.cl(f),u_globe_matrix:new i.cl(f),u_merc_matrix:new i.cl(f),u_grid_matrix:new i.dC(f),u_tl_parent:new i.ck(f),u_scale_parent:new i.cj(f),u_fade_t:new i.cj(f),u_opacity:new i.cj(f),u_image0:new i.ch(f),u_image1:new i.ch(f),u_raster_elevation:new i.cj(f),u_zoom_transition:new i.cj(f),u_merc_center:new i.ck(f),u_cutoff_params:new i.d3(f)}),rasterParticleTexture:f=>({u_texture:new i.ch(f),u_opacity:new i.cj(f)}),rasterParticleDraw:f=>({u_particle_texture:new i.ch(f),u_particle_texture_side_len:new i.cj(f),u_tile_offset:new i.ck(f),u_velocity:new i.ch(f),u_color_ramp:new i.ch(f),u_velocity_res:new i.ck(f),u_max_speed:new i.cj(f),u_uv_offset:new i.ck(f),u_data_scale:new i.ck(f),u_data_offset:new i.cj(f),u_particle_pos_scale:new i.cj(f),u_particle_pos_offset:new i.ck(f)}),rasterParticleUpdate:f=>({u_particle_texture:new i.ch(f),u_particle_texture_side_len:new i.cj(f),u_velocity:new i.ch(f),u_velocity_res:new i.ck(f),u_max_speed:new i.cj(f),u_speed_factor:new i.cj(f),u_reset_rate:new i.cj(f),u_rand_seed:new i.cj(f),u_uv_offset:new i.ck(f),u_data_scale:new i.ck(f),u_data_offset:new i.cj(f),u_particle_pos_scale:new i.cj(f),u_particle_pos_offset:new i.ck(f)}),symbol:f=>({u_is_size_zoom_constant:new i.ch(f),u_is_size_feature_constant:new i.ch(f),u_size_t:new i.cj(f),u_size:new i.cj(f),u_camera_to_center_distance:new i.cj(f),u_rotate_symbol:new i.ch(f),u_aspect_ratio:new i.cj(f),u_fade_change:new i.cj(f),u_matrix:new i.cl(f),u_label_plane_matrix:new i.cl(f),u_coord_matrix:new i.cl(f),u_is_text:new i.ch(f),u_elevation_from_sea:new i.ch(f),u_pitch_with_map:new i.ch(f),u_texsize:new i.ck(f),u_texsize_icon:new i.ck(f),u_texture:new i.ch(f),u_texture_icon:new i.ch(f),u_gamma_scale:new i.cj(f),u_device_pixel_ratio:new i.cj(f),u_tile_id:new i.ci(f),u_zoom_transition:new i.cj(f),u_inv_rot_matrix:new i.cl(f),u_merc_center:new i.ck(f),u_camera_forward:new i.ci(f),u_tile_matrix:new i.cl(f),u_up_vector:new i.ci(f),u_ecef_origin:new i.ci(f),u_is_halo:new i.ch(f),u_icon_transition:new i.cj(f),u_color_adj_mat:new i.cl(f),u_scale_factor:new i.cj(f),u_ground_shadow_factor:new i.ci(f),u_inv_matrix:new i.cl(f),u_normal_scale:new i.cj(f),u_lutTexture:new i.ch(f)}),background:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_opacity:new i.cj(f),u_color:new i.dB(f)}),backgroundPattern:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_opacity:new i.cj(f),u_image:new i.ch(f),u_pattern_tl:new i.ck(f),u_pattern_br:new i.ck(f),u_texsize:new i.ck(f),u_pattern_size:new i.ck(f),u_pixel_coord_upper:new i.ck(f),u_pixel_coord_lower:new i.ck(f),u_pattern_units_to_pixels:new i.ck(f)}),terrainRaster:f=>({u_matrix:new i.cl(f),u_image0:new i.ch(f),u_image1:new i.ch(f),u_skirt_height:new i.cj(f),u_ground_shadow_factor:new i.ci(f),u_emissive_texture_available:new i.cj(f)}),skybox:f=>({u_matrix:new i.cl(f),u_sun_direction:new i.ci(f),u_cubemap:new i.ch(f),u_opacity:new i.cj(f),u_temporal_offset:new i.cj(f)}),skyboxGradient:f=>({u_matrix:new i.cl(f),u_color_ramp:new i.ch(f),u_center_direction:new i.ci(f),u_radius:new i.cj(f),u_opacity:new i.cj(f),u_temporal_offset:new i.cj(f)}),skyboxCapture:f=>({u_matrix_3f:new i.dC(f),u_sun_direction:new i.ci(f),u_sun_intensity:new i.cj(f),u_color_tint_r:new i.d3(f),u_color_tint_m:new i.d3(f),u_luminance:new i.cj(f)}),globeRaster:f=>({u_proj_matrix:new i.cl(f),u_globe_matrix:new i.cl(f),u_normalize_matrix:new i.cl(f),u_merc_matrix:new i.cl(f),u_zoom_transition:new i.cj(f),u_merc_center:new i.ck(f),u_image0:new i.ch(f),u_image1:new i.ch(f),u_grid_matrix:new i.dC(f),u_skirt_height:new i.cj(f),u_far_z_cutoff:new i.cj(f),u_frustum_tl:new i.ci(f),u_frustum_tr:new i.ci(f),u_frustum_br:new i.ci(f),u_frustum_bl:new i.ci(f),u_globe_pos:new i.ci(f),u_globe_radius:new i.cj(f),u_viewport:new i.ck(f),u_emissive_texture_available:new i.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new i.ci(f),u_frustum_tr:new i.ci(f),u_frustum_br:new i.ci(f),u_frustum_bl:new i.ci(f),u_horizon:new i.cj(f),u_transition:new i.cj(f),u_fadeout_range:new i.cj(f),u_atmosphere_fog_color:new i.d3(f),u_high_color:new i.d3(f),u_space_color:new i.d3(f),u_temporal_offset:new i.cj(f),u_horizon_angle:new i.cj(f)}),model:f=>({u_matrix:new i.cl(f),u_lighting_matrix:new i.cl(f),u_normal_matrix:new i.cl(f),u_node_matrix:new i.cl(f),u_lightpos:new i.ci(f),u_lightintensity:new i.cj(f),u_lightcolor:new i.ci(f),u_camera_pos:new i.ci(f),u_opacity:new i.cj(f),u_baseColorFactor:new i.d3(f),u_emissiveFactor:new i.d3(f),u_metallicFactor:new i.cj(f),u_roughnessFactor:new i.cj(f),u_baseTextureIsAlpha:new i.ch(f),u_alphaMask:new i.ch(f),u_alphaCutoff:new i.cj(f),u_baseColorTexture:new i.ch(f),u_metallicRoughnessTexture:new i.ch(f),u_normalTexture:new i.ch(f),u_occlusionTexture:new i.ch(f),u_emissionTexture:new i.ch(f),u_lutTexture:new i.ch(f),u_color_mix:new i.d3(f),u_aoIntensity:new i.cj(f),u_emissive_strength:new i.cj(f),u_occlusionTextureTransform:new i.d3(f)}),modelDepth:f=>({u_matrix:new i.cl(f),u_instance:new i.cl(f),u_node_matrix:new i.cl(f)}),groundShadow:f=>({u_matrix:new i.cl(f),u_ground_shadow_factor:new i.ci(f)}),stars:f=>({u_matrix:new i.cl(f),u_up:new i.ci(f),u_right:new i.ci(f),u_intensity_multiplier:new i.cj(f)}),snowParticle:f=>({u_modelview:new i.cl(f),u_projection:new i.cl(f),u_time:new i.cj(f),u_cam_pos:new i.ci(f),u_velocityConeAperture:new i.cj(f),u_velocity:new i.cj(f),u_horizontalOscillationRadius:new i.cj(f),u_horizontalOscillationRate:new i.cj(f),u_boxSize:new i.cj(f),u_billboardSize:new i.cj(f),u_simpleShapeParameters:new i.ck(f),u_screenSize:new i.ck(f),u_thinningCenterPos:new i.ck(f),u_thinningShape:new i.ci(f),u_thinningAffectedRatio:new i.cj(f),u_thinningParticleOffset:new i.cj(f),u_particleColor:new i.d3(f),u_direction:new i.ci(f)}),rainParticle:f=>({u_modelview:new i.cl(f),u_projection:new i.cl(f),u_time:new i.cj(f),u_cam_pos:new i.ci(f),u_texScreen:new i.ch(f),u_velocityConeAperture:new i.cj(f),u_velocity:new i.cj(f),u_boxSize:new i.cj(f),u_rainDropletSize:new i.ck(f),u_distortionStrength:new i.cj(f),u_rainDirection:new i.ci(f),u_color:new i.d3(f),u_screenSize:new i.ck(f),u_thinningCenterPos:new i.ck(f),u_thinningShape:new i.ci(f),u_thinningAffectedRatio:new i.cj(f),u_thinningParticleOffset:new i.cj(f),u_shapeDirectionalPower:new i.cj(f),u_shapeNormalPower:new i.cj(f),u_mode:new i.cj(f)}),vignette:f=>({u_vignetteShape:new i.ci(f),u_vignetteColor:new i.d3(f)}),occlusion:f=>({u_matrix:new i.cl(f),u_anchorPos:new i.ci(f),u_screenSizePx:new i.ck(f),u_occluderSizePx:new i.ck(f),u_color:new i.d3(f)})};class $l{constructor(t,s,m,v){this.id=$l.uniqueIdxCounter,$l.uniqueIdxCounter++,this.context=t;const T=t.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||v||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=$l.uniqueIdxCounter,$l.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}$l.uniqueIdxCounter=0;const Rf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Um{constructor(t,s,m,v,T,E){this.length=s.length,this.attributes=m,this.itemSize=s.bytesPerElement,this.dynamicDraw=v,this.instanceCount=E,this.context=t;const j=t.gl;this.buffer=j.createBuffer(),t.bindVertexBuffer.set(this.buffer),j.bufferData(j.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||T||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let m=0;m<this.attributes.length;m++){const v=s.getAttributeLocation(t,this.attributes[m].name);v!==-1&&t.enableVertexAttribArray(v)}}setVertexAttribPointers(t,s,m){for(let v=0;v<this.attributes.length;v++){const T=this.attributes[v],E=s.getAttributeLocation(t,T.name);E!==-1&&t.vertexAttribPointer(E,T.components,t[Rf[T.type]],!1,this.itemSize,T.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(t,s,m){for(let v=0;v<this.attributes.length;v++){const T=s.getAttributeLocation(t,this.attributes[v].name);T!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(T,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class al{constructor(t,s,m,v,T){this.context=t,this.width=s,this.height=m;const E=this.framebuffer=t.gl.createFramebuffer();v>0&&(this.colorAttachment0=new zh(t,E,0)),v>1&&(this.colorAttachment1=new zh(t,E,1)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new au(t,E):new zu(t,E))}createColorAttachment(t,s){s===0?this.colorAttachment0=new zh(t,this.framebuffer,0):s===1&&(this.colorAttachment1=new zh(t,this.framebuffer,1))}removeColorAttachment(t,s){const m=this.context.gl;let v;s===0?(v=this.colorAttachment0.get(),this.colorAttachment0=void 0):s===1&&(v=this.colorAttachment1.get(),this.colorAttachment1=void 0),v&&m.deleteTexture(v)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const s=this.colorAttachment0.get();s&&t.deleteTexture(s)}if(this.colorAttachment1){const s=this.colorAttachment1.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class qr{constructor(t,s){this.gl=t,this.clearColor=new ji(this),this.clearDepth=new cn(this),this.clearStencil=new vn(this),this.colorMask=new En(this),this.depthMask=new oa(this),this.stencilMask=new pr(this),this.stencilFunc=new Ar(this),this.stencilOp=new hs(this),this.stencilTest=new Qs(this),this.depthRange=new kf(this),this.depthTest=new Ph(this),this.depthFunc=new cd(this),this.blend=new Bl(this),this.blendFunc=new Hd(this),this.blendColor=new wc(this),this.blendEquation=new Ur(this),this.cullFace=new tl(this),this.cullFaceSide=new il(this),this.frontFace=new Sc(this),this.program=new rc(this),this.activeTexture=new ud(this),this.viewport=new Tc(this),this.bindFramebuffer=new dd(this),this.bindRenderbuffer=new Cm(this),this.bindTexture=new Gd(this),this.bindVertexBuffer=new Bo(this),this.bindElementBuffer=new jh(this),this.bindVertexArrayOES=new Mm(this),this.pixelStoreUnpack=new Wp(this),this.pixelStoreUnpackPremultiplyAlpha=new Zp(this),this.pixelStoreUnpackFlipY=new e_(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,m){return new $l(this,t,s,m)}createVertexBuffer(t,s,m,v,T){return new Um(this,t,s,m,v,T)}createRenderbuffer(t,s,m){const v=this.gl,T=v.createRenderbuffer();return this.bindRenderbuffer.set(T),v.renderbufferStorage(v.RENDERBUFFER,t,s,m),this.bindRenderbuffer.set(null),T}createFramebuffer(t,s,m,v){return new al(this,t,s,m,v)}clear({color:t,depth:s,stencil:m,colorMask:v}){const T=this.gl;let E=0;t&&(E|=T.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(v||[!0,!0,!0,!0])),s!==void 0&&(E|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),m!==void 0&&(E|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),T.clear(E)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){i.by(t.blendFunction,sn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ou;function yi(f,t,s,m,v,T,E){const j=f.context,D=j.gl,B=f.transform,V=[i.aF(B.center.lng),i.aJ(B.center.lat)],Y=s.layout.get("symbol-placement"),X=s.layout.get("text-variable-anchor"),J=s.layout.get("icon-rotation-alignment")==="map",se=s.layout.get("text-rotation-alignment")==="map",ne=Y!=="point",he=[];let de=0,pe=0;for(let Me=0;Me<m.length;Me++){const Ve=m[Me],it=t.getTile(Ve),Ye=it.getBucket(s);if(!Ye)continue;const dt=Ye.getProjection().createInversionMatrix(B,Ve.canonical),mt=[],Tt=Xs(Ve,Ye,B),Ot=!E&&J&&ne,st=E&&se&&ne,Xe=X&&Ye.hasTextData(),pt=Ye.hasIconTextFit()&&Xe&&Ye.hasIconData(),ht=Ot||st||E&&Xe||pt,Nt=Ye.projection.name==="globe",ti=Nt?i.aj(B.zoom):0;Nt&&(mt.push("PROJECTION_GLOBE_VIEW"),ht&&mt.push("PROJECTED_POS_ON_VIEWPORT"));const gi=f.getOrCreateProgram("collisionBox",{defines:mt});let Wt=Tt;v[0]===0&&v[1]===0||(Wt=f.translatePosMatrix(Tt,it,v,T));const Dt=E?Ye.textCollisionBox:Ye.iconCollisionBox,Ti=Ye.collisionCircleArray;if(Ti.length>0){const di=i.bC(),_i=Wt;i.cP(di,Ye.placementInvProjMatrix,B.glCoordMatrix),i.cP(di,di,Ye.placementViewportMatrix),he.push({circleArray:Ti,circleOffset:pe,transform:_i,invTransform:di,projection:Ye.getProjection()}),de+=Ti.length/4,pe=de}if(!Dt)continue;f.terrain&&f.terrain.setupElevationDraw(it,gi);const bi=Nt?[Ve.canonical.x,Ve.canonical.y,1<<Ve.canonical.z]:[0,0,0];gi.draw(f,D.LINES,Pi.disabled,Ki.disabled,f.colorModeForRenderPass(),en.disabled,Dm(Wt,dt,B,ti,V,it,bi,Ye.getProjection()),s.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,null,B.zoom,null,[Dt.collisionVertexBuffer,Dt.collisionVertexBufferExt])}if(!E||!he.length)return;const xe=f.getOrCreateProgram("collisionCircle"),ge=new i.dZ;ge.resize(4*de),ge._trim();let je=0;for(const Me of he)for(let Ve=0;Ve<Me.circleArray.length/4;Ve++){const it=4*Ve,Ye=Me.circleArray[it+0],dt=Me.circleArray[it+1],mt=Me.circleArray[it+2],Tt=Me.circleArray[it+3];ge.emplace(je++,Ye,dt,mt,Tt,0),ge.emplace(je++,Ye,dt,mt,Tt,1),ge.emplace(je++,Ye,dt,mt,Tt,2),ge.emplace(je++,Ye,dt,mt,Tt,3)}(!Ou||Ou.length<2*de)&&(Ou=(function(Me){const Ve=2*Me,it=new i.b0;it.resize(Ve),it._trim();for(let Ye=0;Ye<Ve;Ye++){const dt=6*Ye;it.uint16[dt+0]=4*Ye+0,it.uint16[dt+1]=4*Ye+1,it.uint16[dt+2]=4*Ye+2,it.uint16[dt+3]=4*Ye+2,it.uint16[dt+4]=4*Ye+3,it.uint16[dt+5]=4*Ye+0}return it})(de));const Ae=j.createIndexBuffer(Ou,!0),De=j.createVertexBuffer(ge,i.d_.members,!0);for(const Me of he){const Ve={u_matrix:Me.transform,u_inv_matrix:Me.invTransform,u_camera_to_center_distance:(ze=B).getCameraToCenterDistance(Me.projection),u_viewport_size:[ze.width,ze.height]};xe.draw(f,D.TRIANGLES,Pi.disabled,Ki.disabled,f.colorModeForRenderPass(),en.disabled,Ve,s.id,De,Ae,i.bg.simpleSegment(0,2*Me.circleOffset,Me.circleArray.length,Me.circleArray.length/2),null,B.zoom)}var ze;De.destroy(),Ae.destroy()}const vd=i.bC();function Ec(f){const t=f._camera.getWorldToCamera(f.worldSize,1),s=i.aB([],t,f.globeMatrix);i.bl(s,s);const m=[0,0,0],v=[0,1,0,0];return i.aC(v,v,s),m[0]=v[0],m[1]=v[1],m[2]=v[2],i.aw(m,m),m}function Uo({width:f,height:t,anchor:s,textOffset:m,textScale:v},T){const{horizontalAlign:E,verticalAlign:j}=i.c1(s),D=-(E-.5)*f,B=-(j-.5)*t,V=i.c2(s,m);return new i.P((D/v+V[0])*T,(B/v+V[1])*T)}function Hi(f,t,s,m,v,T,E,j,D,B){const V=f.text.placedSymbolArray,Y=f.text.dynamicLayoutVertexArray,X=f.icon.dynamicLayoutVertexArray,J={},se=f.getProjection(),ne=bo(E,se,v),he=v.elevation,de=se.upVectorScale(E.canonical,v.center.lat,v.worldSize).metersToTile;Y.clear();for(let pe=0;pe<V.length;pe++){const xe=V.get(pe),{tileAnchorX:ge,tileAnchorY:je,numGlyphs:Ae}=xe,De=xe.hidden||!xe.crossTileID||f.allowVerticalPlacement&&!xe.placedOrientation?null:m[xe.crossTileID];if(De){let ze=0,Me=0,Ve=0;const it=f.elevationType==="road";if(he||it){const ht=it?f.getElevationFeatureForText(pe):null,Nt=i.bV.getAtTileOffset(E,new i.P(ge,je),he,ht),[ti,gi,Wt]=se.upVector(E.canonical,ge,je);ze=Nt*ti*de,Me=Nt*gi*de,Ve=Nt*Wt*de}let[Ye,dt,mt,Tt]=Lo(xe.projectedAnchorX+ze,xe.projectedAnchorY+Me,xe.projectedAnchorZ+Ve,s?ne:T);const Ot=ha(v.getCameraToCenterDistance(se),Tt);let st=i.bM(f.textSizeData,D,xe)*Ot/i.bY;s&&(st*=f.tilePixelRatio/j);const Xe=Uo(De,st);s?({x:Ye,y:dt,z:mt}=se.projectTilePoint(ge+Xe.x,je+Xe.y,E.canonical),[Ye,dt,mt]=Lo(Ye+ze,dt+Me,mt+Ve,T)):(t&&Xe._rotate(-v.angle),Ye+=Xe.x,dt+=Xe.y,mt=0);const pt=f.allowVerticalPlacement&&xe.placedOrientation===i.bL.vertical?Math.PI/2:0;for(let ht=0;ht<Ae;ht++)i.bO(Y,Ye,dt,mt,pt);B&&xe.associatedIconIndex>=0&&(J[xe.associatedIconIndex]={x:Ye,y:dt,z:mt,angle:pt})}else fl(Ae,Y)}if(B){X.clear();const pe=f.icon.placedSymbolArray;for(let xe=0;xe<pe.length;xe++){const ge=pe.get(xe),{numGlyphs:je}=ge,Ae=J[xe];if(ge.hidden||!Ae)fl(je,X);else{const{x:De,y:ze,z:Me,angle:Ve}=Ae;for(let it=0;it<je;it++)i.bO(X,De,ze,Me,Ve)}}f.icon.dynamicLayoutVertexBuffer.updateData(X)}f.text.dynamicLayoutVertexBuffer.updateData(Y)}function Qd(f,t,s,m,v,T,E={}){const j=s.paint.get("icon-translate"),D=s.paint.get("text-translate"),B=s.paint.get("icon-translate-anchor"),V=s.paint.get("text-translate-anchor"),Y=s.layout.get("icon-rotation-alignment"),X=s.layout.get("text-rotation-alignment"),J=s.layout.get("icon-pitch-alignment"),se=s.layout.get("text-pitch-alignment"),ne=s.layout.get("icon-keep-upright"),he=s.layout.get("text-keep-upright"),de=s.paint.get("icon-color-saturation"),pe=s.paint.get("icon-color-contrast"),xe=s.paint.get("icon-color-brightness-min"),ge=s.paint.get("icon-color-brightness-max"),je=s.layout.get("symbol-elevation-reference")==="sea",Ae=s.layout.get("icon-image-use-theme")==="none",De=f.context,ze=De.gl,Me=f.transform,Ve=Y==="map",it=X==="map",Ye=J==="map",dt=se==="map",mt=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Tt=!1;const Ot=f.depthModeForSublayer(0,Pi.ReadOnly),st=new Pi(f.context.gl.LEQUAL,Pi.ReadOnly,f.depthRangeFor3D),Xe=[i.aF(Me.center.lng),i.aJ(Me.center.lat)],pt=s.layout.get("text-variable-anchor"),ht=Me.projection.name==="globe",Nt=[],ti=[0,-1,0];for(const gi of m){const Wt=t.getTile(gi),Dt=Wt.getBucket(s);if(!Dt||Dt.projection.name==="mercator"&&ht||Dt.fullyClipped)continue;const Ti=Dt.projection.name==="globe",bi=Ti?i.aj(Me.zoom):0,di=bo(gi,Dt.getProjection(),Me),_i=Me.calculatePixelsToTileUnitsMatrix(Wt),Bi=pt&&Dt.hasTextData(),dn=Dt.hasIconTextFit()&&Bi&&Dt.hasIconData(),Pn=Dt.getProjection().createInversionMatrix(Me,gi.canonical),Jn=(1<<Wt.tileID.canonical.z)*i.al/f.transform.worldSize,wi=ca=>{let Wn=[0,0,0];if(ca){const gn=f.style.directionalLight,Oa=f.style.ambientLight;gn&&Oa&&(Wn=Ds(f.style,gn,Oa))}return Wn},Qn=ca=>{Me.depthOcclusionForSymbolsAndCircles&&(s.hasOcclusionOpacityProperties||f.terrain)&&(ca.push("DEPTH_D24"),ca.push("DEPTH_OCCLUSION"))},Wi=ca=>{s.lut&&!Ae&&(s.lut.texture||(s.lut.texture=new i.d$(f.context,s.lut.image,[s.lut.image.height,s.lut.image.height,s.lut.image.height],De.gl.RGBA8)),De.activeTexture.set(De.gl.TEXTURE0+Ir.LUT),s.lut.texture&&s.lut.texture.bind(De.gl.LINEAR,De.gl.CLAMP_TO_EDGE),ca.push("APPLY_LUT_ON_GPU"))},la=()=>{const ca=Ve&&s.layout.get("symbol-placement")!=="point",Wn=[];Qn(Wn),Wi(Wn);const gn=ca||dn,Oa=Dt.elevationType==="road",Tr=f.shadowRenderer,lr=Oa&&Ye&&!!Tr&&Tr.enabled,Ma=wi(lr),Ao=Oa&&Ye&&!f.terrain?st:Ot,Ns=s.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Ye&&Wn.push("PITCH_WITH_MAP_TERRAIN"),Ti&&(Wn.push("PROJECTION_GLOBE_VIEW"),gn&&Wn.push("PROJECTED_POS_ON_VIEWPORT")),Ns>0&&Dt.hasAnySecondaryIcon&&Wn.push("ICON_TRANSITION"),!Dt.icon.zOffsetVertexBuffer||Oa&&f.terrain||Wn.push("Z_OFFSET"),de===0&&pe===0&&xe===0&&ge===1||Wn.push("COLOR_ADJUSTMENT"),Dt.sdfIcons&&Wn.push("RENDER_SDF"),lr&&Wn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Oa&&Ye&&!f.terrain&&Dt.icon.orientationVertexBuffer&&Wn.push("ELEVATED_ROADS");const Er=Dt.icon.programConfigurations.get(s.id),ks=f.getOrCreateProgram("symbol",{config:Er,defines:Wn}),to=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],Es=Dt.iconSizeData,Al=i.bK(Es,Me.zoom),Zl=Ye||!Me.isOrthographic,$o=zs(di,Wt.tileID.canonical,Ye,Ve,Me,Dt.getProjection(),_i),dr=Fd(di,Wt.tileID.canonical,Ye,Ve,Me,Dt.getProjection(),_i),gr=f.translatePosMatrix(dr,Wt,j,B,!0),Ea=f.translatePosMatrix(di,Wt,j,B),Mr=gn?vd:$o,Dn=Ve&&!Ye&&!ca;let ir=ti;!ht&&!Me.mercatorFromTransition||Ve||(ir=Ec(Me));const lc=Ti?ir:ti,tf=s.getColorAdjustmentMatrix(de,pe,xe,ge),Rc=Nm(Es.kind,Al,Dn,Ye,f,Ea,Mr,gr,je,!1,to,[0,0],0,gi,bi,Xe,Pn,lc,Dt.getProjection(),Ma,Jn,tf,Ns,null),om=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,nf=s.layout.get("icon-size").constantOr(0)!==1||Dt.iconsNeedLinear,Xl=Dt.sdfIcons||f.options.rotating||f.options.zooming||nf||Zl?ze.LINEAR:ze.NEAREST,Cl=Dt.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Cd=f.terrain&&Ye&&ca?i.bl(i.bC(),$o):vd;if(ca&&Dt.icon){const Dc=i.bV.getAtTileOffsetFunc(gi,Me.center.lat,Me.worldSize,Dt.getProjection()),Lc=kh(di,Wt.tileID.canonical,Ye,Ve,Me,Dt.getProjection(),_i),Co=s.layout.get("icon-size-scale-range"),ho=i.aA(f.scaleFactor,Co[0],Co[1]);Em(Dt,di,f,!1,Lc,dr,Ye,ne,Dc,gi,ho)}return{program:ks,buffers:Dt.icon,uniformValues:Rc,atlasTexture:om,atlasTextureIcon:null,atlasInterpolation:Xl,atlasInterpolationIcon:null,isSDF:Dt.sdfIcons,hasHalo:Cl,depthMode:Ao,tile:Wt,renderWithShadows:lr,labelPlaneMatrixInv:Cd}},_a=()=>{const ca=it&&s.layout.get("symbol-placement")!=="point",Wn=[],gn=ca||pt||dn,Oa=Dt.elevationType==="road",Tr=f.shadowRenderer,lr=Oa&&dt&&!!Tr&&Tr.enabled,Ma=wi(lr),Ao=Oa&&dt&&!f.terrain?st:Ot;f.terrainRenderModeElevated()&&dt&&Wn.push("PITCH_WITH_MAP_TERRAIN"),Ti&&(Wn.push("PROJECTION_GLOBE_VIEW"),gn&&Wn.push("PROJECTED_POS_ON_VIEWPORT")),!Dt.text.zOffsetVertexBuffer||Oa&&f.terrain||Wn.push("Z_OFFSET"),Dt.iconsInText&&Wn.push("RENDER_TEXT_AND_SYMBOL"),Wn.push("RENDER_SDF"),lr&&Wn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Oa&&dt&&!f.terrain&&Dt.text.orientationVertexBuffer&&Wn.push("ELEVATED_ROADS"),Qn(Wn);const Ns=Dt.text.programConfigurations.get(s.id),Er=f.getOrCreateProgram("symbol",{config:Ns,defines:Wn});let ks,to=[0,0],Es=null;const Al=Dt.textSizeData;Dt.iconsInText&&(to=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],Es=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,ks=dt||!Me.isOrthographic||f.options.rotating||f.options.zooming||Al.kind==="composite"||Al.kind==="camera"?ze.LINEAR:ze.NEAREST);const Zl=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture.size:[0,0],$o=s.layout.get("text-size-scale-range"),dr=i.aA(f.scaleFactor,$o[0],$o[1]),gr=i.bK(Al,Me.zoom,dr),Ea=zs(di,Wt.tileID.canonical,dt,it,Me,Dt.getProjection(),_i),Mr=Fd(di,Wt.tileID.canonical,dt,it,Me,Dt.getProjection(),_i),Dn=f.translatePosMatrix(Mr,Wt,D,V,!0),ir=f.translatePosMatrix(di,Wt,D,V),lc=gn?vd:Ea,tf=it&&!dt&&!ca;let Rc=ti;!ht&&!Me.mercatorFromTransition||it||(Rc=Ec(Me));const om=Nm(Al.kind,gr,tf,dt,f,ir,lc,Dn,je,!0,Zl,to,0,gi,bi,Xe,Pn,Ti?Rc:ti,Dt.getProjection(),Ma,Jn,null,null,dr),nf=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture:null,Xl=ze.LINEAR,Cl=s.paint.get("text-halo-width").constantOr(1)!==0,Cd=f.terrain&&dt&&ca?i.bl(i.bC(),Ea):vd;if(ca&&Dt.text){const Dc=i.bV.getAtTileOffsetFunc(gi,Me.center.lat,Me.worldSize,Dt.getProjection()),Lc=kh(di,Wt.tileID.canonical,dt,it,Me,Dt.getProjection(),_i);Em(Dt,di,f,!0,Lc,Mr,dt,he,Dc,gi,dr)}return{program:Er,buffers:Dt.text,uniformValues:om,atlasTexture:nf,atlasTextureIcon:Es,atlasInterpolation:Xl,atlasInterpolationIcon:ks,isSDF:!0,hasHalo:Cl,depthMode:Ao,tile:Wt,renderWithShadows:lr,labelPlaneMatrixInv:Cd}},ya=Dt.icon.segments.get().length,Rn=Dt.text.segments.get().length,mn=ya&&!E.onlyText?la():null,ta=Rn&&!E.onlyIcons?_a():null,Va=s.paint.get("icon-opacity").constantOr(1),Za=s.paint.get("text-opacity").constantOr(1);if(mt&&Dt.canOverlap){Tt=!0;const ca=Va&&!E.onlyText?Dt.icon.segments.get():[],Wn=Za&&!E.onlyIcons?Dt.text.segments.get():[];for(const gn of ca)Nt.push({segments:new i.bg([gn]),sortKey:gn.sortKey,state:mn});for(const gn of Wn)Nt.push({segments:new i.bg([gn]),sortKey:gn.sortKey,state:ta})}else E.onlyText||Nt.push({segments:Va?Dt.icon.segments:new i.bg([]),sortKey:0,state:mn}),E.onlyIcons||Nt.push({segments:Za?Dt.text.segments:new i.bg([]),sortKey:0,state:ta})}Tt&&Nt.sort(((gi,Wt)=>gi.sortKey-Wt.sortKey));for(const gi of Nt){const Wt=gi.state;if(Wt)if(f.terrain?f.terrain.setupElevationDraw(Wt.tile,Wt.program,{useDepthForOcclusion:Me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Wt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Me.depthOcclusionForSymbolsAndCircles,Wt.program),De.activeTexture.set(ze.TEXTURE0),Wt.atlasTexture&&Wt.atlasTexture.bind(Wt.atlasInterpolation,ze.CLAMP_TO_EDGE,!0),Wt.atlasTextureIcon&&(De.activeTexture.set(ze.TEXTURE1),Wt.atlasTextureIcon&&Wt.atlasTextureIcon.bind(Wt.atlasInterpolationIcon,ze.CLAMP_TO_EDGE,!0)),Wt.renderWithShadows&&f.shadowRenderer.setupShadows(Wt.tile.tileID.toUnwrapped(),Wt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,Wt.program),Wt.hasHalo){const Dt=Wt.uniformValues;Dt.u_is_halo=1,Df(Wt.buffers,gi.segments,s,f,Wt.program,Wt.depthMode,v,T,Dt,2),Dt.u_is_halo=0}else{if(Wt.isSDF){const Dt=Wt.uniformValues;Wt.hasHalo&&(Dt.u_is_halo=1,Df(Wt.buffers,gi.segments,s,f,Wt.program,Wt.depthMode,v,T,Dt,1)),Dt.u_is_halo=0}Df(Wt.buffers,gi.segments,s,f,Wt.program,Wt.depthMode,v,T,Wt.uniformValues,1)}}}function Df(f,t,s,m,v,T,E,j,D,B){const V=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];v.draw(m,m.context.gl.TRIANGLES,T,E,j,en.disabled,D,s.id,f.layoutVertexBuffer,f.indexBuffer,t,s.paint,m.transform.zoom,f.programConfigurations.get(s.id),V,B)}function Yp(f,t){const s=1<<f.canonical.z,m=(t.x*s-f.canonical.x-f.wrap*s)*i.al,v=(t.y*s-f.canonical.y)*i.al,T=i.e8(t.z,t.y);return i.d5(m,v,T)}function Lf(f,t,s,m,v){if(!s.layout||s.layout.get("fill-elevation-reference")==="none"||s.paint.get("fill-opacity").constantOr(1)===0)return;const T=f.context.gl,E=new Pi(f.context.gl.LEQUAL,Pi.ReadWrite,f.depthRangeFor3D),j=new Pi(f.context.gl.GREATER,Pi.ReadWrite,f.depthRangeFor3D),D=(function(J){let se=.01;return J.isOrthographic&&(se=i.ak(1e-4,se,i.d0(J.pitch>=No?1:J.pitch/No))),2*se})(f.transform),B=f.transform.getFreeCameraOptions().position,V="elevatedStructuresDepthReconstruct",Y=f.getOrCreateProgram(V,{defines:["DEPTH_RECONSTRUCTION"]}),X=f.getOrCreateProgram(V);for(const J of m){const se=t.getTile(J),ne=se.getBucket(s);if(!ne)continue;const he=ne.elevatedStructures;if(!he)continue;const de=ne.elevationBufferData.heightRange,pe=Yp(J.toUnwrapped(),B),xe=f.translatePosMatrix(J.projMatrix,se,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let ge,je,Ae,De;if(v==="initialize"){if(!de||de.min>=1||he.depthSegments.segments[0].primitiveLength===0)continue;ge=gd(xe,pe,D,1,0),je=E,Ae=he.depthSegments,De=Y}else if(v==="reset"){if(!de||de.min>=0||he.maskSegments.segments[0].primitiveLength===0)continue;ge=gd(xe,pe,0,0,1),je=j,Ae=he.maskSegments,De=Y}else if(v==="geometry"){if(he.depthSegments.segments[0].primitiveLength===0)continue;ge=gd(xe,pe,D,1,0),je=E,Ae=he.depthSegments,De=X}De.draw(f,T.TRIANGLES,je,Ki.disabled,sn.disabled,en.disabled,ge,s.id,he.vertexBuffer,he.indexBuffer,Ae,s.paint,f.transform.zoom)}}function Of(f,t,s,m){const{painter:v,sourceCache:T,layer:E,coords:j,colorMode:D,elevationType:B,terrainEnabled:V,pass:Y}=f,X=v.context.gl,J=E.paint.get("fill-pattern"),se=E.paint.get("fill-pattern-cross-fade"),ne=J.constantOr(null);let he=B;B!=="road"||t&&!V||(he="none");const de=he==="road",pe=f.painter.shadowRenderer,xe=de&&!!pe&&pe.enabled,ge=new Pi(v.context.gl.LEQUAL,Pi.ReadOnly,v.depthRangeFor3D);let je=[0,0,0];if(xe){const Me=v.style.directionalLight,Ve=v.style.ambientLight;Me&&Ve&&(je=Ds(v.style,Me,Ve))}const Ae=J&&J.constantOr(1),De=v.terrain&&v.terrain.renderingToTexture,ze=(Me,Ve)=>{let it,Ye,dt,mt,Tt;Ve?(it=Ae&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",dt=X.LINES):(it=Ae?"fillPattern":"fill",dt=X.TRIANGLES);for(const Ot of j){const st=T.getTile(Ot);if(Ae&&!st.patternsLoaded())continue;const Xe=st.getBucket(E);if(!Xe)continue;const pt=t?Xe.elevationBufferData:Xe.bufferData;if(pt.isEmpty())continue;v.prepareDrawTile();const ht=pt.programConfigurations.get(E.id),Nt=v.isTileAffectedByFog(Ot),ti=[],gi=[];de&&(ti.push("ELEVATED_ROADS"),gi.push(pt.elevatedLayoutVertexBuffer)),xe&&ti.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),De&&s&&ti.push("USE_MRT1"),Ae&&(v.context.activeTexture.set(X.TEXTURE0),st.imageAtlasTexture&&st.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),ht.updatePaintBuffers());let Wt=!1;if(ne&&st.imageAtlas){const _i=st.imageAtlas,Bi=i.e3.from(ne),dn=Bi.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Pn=Bi.getSecondary(),Jn=_i.patternPositions.get(dn),wi=Pn?_i.patternPositions.get(Pn.scaleSelf(i.o.devicePixelRatio).toString()):null;Wt=!!Jn&&!!wi,Jn&&ht.setConstantPatternPositions(Jn,wi)}se>0&&(Wt||ht.getPatternTransitionVertexBuffer("fill-pattern"))&&ti.push("FILL_PATTERN_TRANSITION");const Dt=v.getOrCreateProgram(it,{config:ht,overrideFog:Nt,defines:ti}),Ti=v.translatePosMatrix(Ot.projMatrix,st,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor"));xe&&pe.setupShadows(st.tileID.toUnwrapped(),Dt,"vector-tile");const bi=E.paint.get("fill-emissive-strength");if(Ve){mt=pt.lineIndexBuffer,Tt=pt.lineSegments;const _i=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[X.drawingBufferWidth,X.drawingBufferHeight];Ye=it==="fillOutlinePattern"&&Ae?Zd(Ti,bi,v,st,_i,je,se):Rm(Ti,bi,_i,je)}else mt=pt.indexBuffer,Tt=pt.triangleSegments,Ye=Ae?jf(Ti,bi,v,st,je,se):Wd(Ti,bi,je);v.uploadCommonUniforms(v.context,Dt,Ot.toUnwrapped());let di=Me;(B==="road"&&!V||B==="offset")&&(di=ge),Dt.draw(v,dt,di,m||v.stencilModeForClipping(Ot),D,en.disabled,Ye,E.id,pt.layoutVertexBuffer,mt,Tt,E.paint,v.transform.zoom,ht,gi)}};v.renderPass===Y&&ze(v.depthModeForSublayer(1,v.renderPass==="opaque"?Pi.ReadWrite:Pi.ReadOnly),!1),he==="none"&&v.renderPass==="translucent"&&E.paint.get("fill-antialias")&&ze(v.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,Pi.ReadOnly),!0)}function Nf(f,t,s,m,v,T,E,j){s.resetLayerRenderingStats(f);const D=f.context,B=D.gl,V=f.transform,Y=s.paint.get("fill-extrusion-pattern"),X=s.paint.get("fill-extrusion-pattern-cross-fade"),J=Y.constantOr(null),se=Y.constantOr(1),ne=s.paint.get("fill-extrusion-opacity"),he=f.style.enable3dLights(),de=s.paint.get(he&&!se?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),pe=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),de],xe=s.layout.get("fill-extrusion-edge-radius"),ge=xe>0&&!s.paint.get("fill-extrusion-rounded-roof"),je=ge?0:xe,Ae=V.projection.name==="globe"?i.eb():0,De=V.projection.name==="globe",ze=De?i.aj(V.zoom):0,Me=[i.aF(V.center.lng),i.aJ(V.center.lat)],Ve=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",it=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ve?null:s.lut).toArray01().slice(0,3),Ye=s.paint.get("fill-extrusion-flood-light-intensity"),dt=s.paint.get("fill-extrusion-vertical-scale"),mt=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Tt=s.paint.get("fill-extrusion-height-alignment"),Ot=s.paint.get("fill-extrusion-base-alignment"),st=_l(f,s.paint.get("fill-extrusion-cutoff-fade-range")),Xe=[];let pt;De&&Xe.push("PROJECTION_GLOBE_VIEW"),pe[0]>0&&Xe.push("FAUX_AO"),ge&&Xe.push("ZERO_ROOF_RADIUS"),j&&Xe.push("HAS_CENTROID"),Ye>0&&Xe.push("FLOOD_LIGHT"),st.shouldRenderCutoff&&Xe.push("RENDER_CUTOFF"),mt&&Xe.push("RENDER_WALL_MODE");const ht=f.renderPass==="shadow",Nt=f.shadowRenderer,ti=ht&&!!Nt,gi=ht?en.disabled:en.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Wt=[0,0,0];if(Nt){const bi=f.style.directionalLight,di=f.style.ambientLight;bi&&di&&(Wt=Ds(f.style,bi,di)),ht||(Xe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Nt.useNormalOffset&&Xe.push("NORMAL_OFFSET")),pt=Xe.concat(["SHADOWS_SINGLE_CASCADE"])}const Dt=ti?"fillExtrusionDepth":se?"fillExtrusionPattern":"fillExtrusion",Ti=s.getLayerRenderingStats();for(const bi of m){const di=t.getTile(bi),_i=di.getBucket(s);if(!_i||_i.projection.name!==V.projection.name)continue;let Bi=!1;Nt&&(Bi=Nt.getMaxCascadeForTile(bi.toUnwrapped())===0);const dn=f.isTileAffectedByFog(bi),Pn=_i.programConfigurations.get(s.id);let Jn=!1;if(J&&di.imageAtlas){const Rn=di.imageAtlas,mn=i.e3.from(J),ta=mn.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Va=mn.getSecondary(),Za=Rn.patternPositions.get(ta),ca=Va?Rn.patternPositions.get(Va.scaleSelf(i.o.devicePixelRatio).toString()):null;Jn=!!Za&&!!ca,Za&&Pn.setConstantPatternPositions(Za,ca)}X>0&&(Jn||Pn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Xe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const wi=f.getOrCreateProgram(Dt,{config:Pn,defines:Bi?pt:Xe,overrideFog:dn});if(f.terrain&&f.terrain.setupElevationDraw(di,wi,{useMeterToDem:!0}),!_i.centroidVertexBuffer){const Rn=wi.getAttributeLocation(B,"a_centroid_pos");Rn!==-1&&B.vertexAttrib2f(Rn,0,0)}!ht&&Nt&&Nt.setupShadows(di.tileID.toUnwrapped(),wi,"vector-tile"),se&&(f.context.activeTexture.set(B.TEXTURE0),di.imageAtlasTexture&&di.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Pn.updatePaintBuffers());const Qn=s.paint.get("fill-extrusion-vertical-gradient"),Wi=1/_i.tileToMeter;let la;if(ht&&Nt){if(lu(di.tileID,_i.maxHeight,f))continue;const Rn=Nt.calculateShadowPassMatrixFromTile(di.tileID.toUnwrapped());la=Pf(Rn,je,Wi,dt,Tt,Ot)}else{const Rn=f.translatePosMatrix(bi.expandedProjMatrix,di,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),mn=V.projection.createInversionMatrix(V,bi.canonical);la=se?Du(Rn,f,Qn,ne,pe,je,Wi,bi,di,Ae,Tt,Ot,ze,Me,mn,it,dt,X):Lh(Rn,f,Qn,ne,pe,je,Wi,bi,Ae,Tt,Ot,ze,Me,mn,it,dt,Ye,Wt)}f.uploadCommonUniforms(D,wi,bi.toUnwrapped(),null,st);let _a=_i.segments;if(V.projection.name==="mercator"&&!ht&&(_a=_i.getVisibleSegments(di.tileID,f.terrain,f.transform.getFrustum(0)),!_a.get().length))continue;if(Ti)if(ht)for(const Rn of _a.get())Ti.numRenderedVerticesInShadowPass+=Rn.primitiveLength;else for(const Rn of _a.get())Ti.numRenderedVerticesInTransparentPass+=Rn.primitiveLength;const ya=[];(f.terrain||j)&&ya.push(_i.centroidVertexBuffer),De&&ya.push(_i.layoutVertexExtBuffer),mt&&ya.push(_i.wallVertexBuffer),wi.draw(f,D.gl.TRIANGLES,v,T,E,gi,la,s.id,_i.layoutVertexBuffer,_i.indexBuffer,_a,s.paint,f.transform.zoom,Pn,ya)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class $m{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function ou(f,t,s,m,v,T,E,j,D,B,V,Y,X,J,se,ne,he,de,pe,xe){const ge=t.context,je=ge.gl,Ae=t.transform,De=t.transform.zoom,ze=[],Me=f.translate,Ve=f.translateAnchor,it=f.edgeRadius,Ye=_l(t,f.cutoffFadeRange);V==="clear"?(ze.push("CLEAR_SUBPASS"),xe&&(ze.push("CLEAR_FROM_TEXTURE"),ge.activeTexture.set(je.TEXTURE0),xe.bind(je.LINEAR,je.CLAMP_TO_EDGE))):V==="sdf"?ze.push("SDF_SUBPASS"):V==="emissive"&&(ze.push("USE_MRT1"),ge.activeTexture.set(je.TEXTURE0),xe.bind(je.LINEAR,je.CLAMP_TO_EDGE)),de&&ze.push("HAS_CENTROID"),Ye.shouldRenderCutoff&&ze.push("RENDER_CUTOFF");const dt=(mt,Tt,Ot,st,Xe)=>{let pt=ze;Tt.groundRadiusBuffer!=null&&(pt=ze.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const ht=Tt.programConfigurations.get(m.id),Nt=t.isTileAffectedByFog(mt),ti=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:ht,defines:pt,overrideFog:Nt}),gi=Ul(t,st,Y,B,Xe,[X,J*Xe],se,ne,he,De>=17?0:it*Xe,xe?xe.size[0]:0),Wt=[];de&&Wt.push(Tt.hiddenByLandmarkVertexBuffer),Tt.groundRadiusBuffer!=null&&Wt.push(Tt.groundRadiusBuffer),t.uploadCommonUniforms(ge,ti,mt.toUnwrapped(),null,Ye),ti.draw(t,ge.gl.TRIANGLES,T,E,j,D,gi,m.id,Tt.vertexBuffer,Tt.indexBuffer,Ot,m.paint,De,ht,Wt)};for(const mt of v){const Tt=s.getTile(mt),Ot=Tt.getBucket(m);if(!Ot||Ot.projection.name!==Ae.projection.name||!Ot.groundEffect||Ot.groundEffect&&!Ot.groundEffect.hasData())continue;const st=Ot.groundEffect,Xe=1/Ot.tileToMeter;{const pt=t.translatePosMatrix(mt.projMatrix,Tt,Me,Ve),ht=st.getDefaultSegment();dt(mt,st,ht,pt,Xe)}if(pe)for(let pt=0;pt<4;pt++){const ht=i.e9[pt](mt),Nt=s.getTile(ht);if(!Nt)continue;const ti=Nt.getBucket(m);if(!ti||ti.projection.name!==Ae.projection.name||!ti.groundEffect||ti.groundEffect&&!ti.groundEffect.hasData())continue;const gi=ti.groundEffect;let Wt,Dt;pt===0?(Wt=[-i.al,0,0],Dt=1):pt===1?(Wt=[i.al,0,0],Dt=0):pt===2?(Wt=[0,-i.al,0],Dt=3):(Wt=[0,i.al,0],Dt=2);const Ti=gi.regionSegments[Dt];if(!Ti)continue;const bi=new Float32Array(16);i.br(bi,mt.projMatrix,Wt),dt(mt,gi,Ti,t.translatePosMatrix(bi,Tt,Me,Ve),Xe)}}}function Kp(f,t,s,m,v,T,E){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const j=T?T.findDEMTileFor(s):null;if(!(j&&j.dem||E))return;T&&j&&j.dem&&m.selfDEMTileTimestamp!==j.dem._timestamp&&(m.borderDoneWithNeighborZ=[-1,-1,-1,-1],m.selfDEMTileTimestamp=j.dem._timestamp);const D=de=>new i.P(Math.ceil((de+i.ed)*i.ee),0),B=de=>{const pe=t.getSource().minzoom,xe=je=>{const Ae=t.getTileByID(je);if(Ae&&Ae.hasData())return Ae.getBucket(v)},ge=[0,-1,1];for(const je of ge){if(de.overscaledZ+je<pe)continue;const Ae=xe(de.calculateScaledKey(de.overscaledZ+je));if(Ae)return Ae}},V=[0,0,0],Y=(de,pe)=>(V[0]=Math.min(de.min.y,pe.min.y),V[1]=Math.max(de.max.y,pe.max.y),V[2]=i.al-pe.min.x>de.max.x?pe.min.x-i.al:de.max.x,V),X=(de,pe)=>(V[0]=Math.min(de.min.x,pe.min.x),V[1]=Math.max(de.max.x,pe.max.x),V[2]=i.al-pe.min.y>de.max.y?pe.min.y-i.al:de.max.y,V),J=[(de,pe)=>Y(de,pe),(de,pe)=>Y(pe,de),(de,pe)=>X(de,pe),(de,pe)=>X(pe,de)],se=(de,pe,xe,ge,je,Ae,De)=>{if(!T)return 0;const ze=[[Ae?xe:de,Ae?de:xe,0],[Ae?xe:pe,Ae?pe:xe,0]],Me=De<0?i.al+De:De,Ve=[Ae?Me:(de+pe)/2,Ae?(de+pe)/2:Me,0];return xe===0&&De<0||xe!==0&&De>0?T.getForTilePoints(je,[Ve],!0,ge):ze.push(Ve),T.getForTilePoints(s,ze,!0,j),Math.max(ze[0][2],ze[1][2],Ve[2])/T.exaggeration()};for(let de=0;de<4;de++){const pe=m.borderFeatureIndices[de];if(pe.length===0)continue;const xe=i.e9[de](s),ge=B(xe);if(!(ge&&ge instanceof i.ea))continue;const je=T?T.findDEMTileFor(xe):null;if(!(je&&je.dem||E)||(T&&je&&je.dem&&m.borderDEMTileTimestamp[de]!==je.dem._timestamp&&(m.borderDoneWithNeighborZ[de]=-1,m.borderDEMTileTimestamp[de]=je.dem._timestamp),m.borderDoneWithNeighborZ[de]===ge.canonical.z))continue;ge.centroidVertexArray.length===0&&ge.createCentroidsBuffer();const Ae=(de<2?1:5)-de,De=ge.borderDoneWithNeighborZ[Ae]!==m.canonical.z,ze=ge.borderFeatureIndices[Ae];let Me=0;if(m.canonical.z!==ge.canonical.z){for(const Ve of pe)m.showCentroid(m.featuresOnBorder[Ve]);if(De)for(const Ve of ze)ge.showCentroid(ge.featuresOnBorder[Ve]);m.borderDoneWithNeighborZ[de]=ge.canonical.z,ge.borderDoneWithNeighborZ[Ae]=m.canonical.z}for(const Ve of pe){const it=m.featuresOnBorder[Ve],Ye=m.centroidData[it.centroidDataIndex],dt=it.borders[de];let mt;for(;Me<ze.length;){mt=ge.featuresOnBorder[ze[Me]];const Tt=mt.borders[Ae];if(Tt[1]>dt[0]+3||Tt[0]>dt[0]-3)break;ge.showCentroid(mt),Me++}if(mt&&Me<ze.length){const Tt=Me;let Ot=0;for(;!(mt.borders[Ae][0]>dt[1]-3)&&(Ot++,++Me!==ze.length);)mt=ge.featuresOnBorder[ze[Me]];mt=ge.featuresOnBorder[ze[Tt]];let st=!1;if(Ot>=1){const ht=mt.borders[Ae];Math.abs(dt[0]-ht[0])<3&&Math.abs(dt[1]-ht[1])<3&&(Ot=1,st=!0,Me=Tt+1)}else if(Ot===0){m.showCentroid(it);continue}const Xe=ge.centroidData[mt.centroidDataIndex];E&&st&&(((ne=Ye).flags|(he=Xe).flags)&i.ec?(ne.flags|=i.ec,he.flags|=i.ec):(ne.flags&=~i.ec,he.flags&=~i.ec));const pt=it.intersectsCount()>1||mt.intersectsCount()>1;if(Ot>1)Me=Tt,Ye.centroidXY=Xe.centroidXY=new i.P(0,0);else if(je&&je.dem&&!pt){const ht=J[de](Ye,Xe),Nt=de%2?i.al-1:0,ti=se(ht[0],Math.min(i.al-1,ht[1]),Nt,je,xe,de<2,ht[2]);Ye.centroidXY=Xe.centroidXY=D(ti)}else pt?Ye.centroidXY=Xe.centroidXY=new i.P(0,0):(Ye.centroidXY=m.encodeBorderCentroid(it),Xe.centroidXY=ge.encodeBorderCentroid(mt));m.writeCentroidToBuffer(Ye),ge.writeCentroidToBuffer(Xe)}else m.showCentroid(it)}m.borderDoneWithNeighborZ[de]=ge.canonical.z,ge.borderDoneWithNeighborZ[Ae]=m.canonical.z}var ne,he;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(f)}const rl=[1,0,0],Jp=[0,1,0],To=[0,0,1];function lu(f,t,s){const m=s.transform,v=s.shadowRenderer;if(!v)return!0;const T=f.toUnwrapped(),E=m.tileSize*v._cascades[s.currentShadowCascade].scale;let j=t;if(m.elevation){const ne=m.elevation.getMinMaxForTile(f);ne&&(j+=ne.max)}const D=[...v.shadowDirection];D[2]=-D[2];const B=v.computeSimplifiedTileShadowVolume(T,j,E,D);if(!B)return!1;const V=[rl,Jp,To,D,[D[0],0,D[2]],[0,D[1],D[2]]],Y=m.projection.name==="globe",X=m.scaleZoom(E),J=i.cB.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,X,!Y),se=v.getCurrentCascadeFrustum();return J.intersectsPrecise(B.vertices,B.planes,V)===0||se.intersectsPrecise(B.vertices,B.planes,V)===0}function Nh(f){const{painter:t,source:s,layer:m,coords:v}=f;let T=f.defines;const E=t.context,j=t.renderPass==="shadow",D=t.renderPass==="light-beam",B=t.shadowRenderer,V=i.ef(t.transform.center.lat,t.transform.zoom),Y=_l(t,m.paint.get("building-cutoff-fade-range"));Y.shouldRenderCutoff&&(T=T.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(T=T.concat("FLOOD_LIGHT"));for(const X of v){const J=s.getTile(X),se=J.getBucket(m);if(!se)continue;B&&B.getMaxCascadeForTile(X.toUnwrapped())===0&&(T=T.concat("SHADOWS_SINGLE_CASCADE"));const ne=se.programConfigurations.get(m.id);let he,de,pe,xe=t.translatePosMatrix(X.expandedProjMatrix,J,[0,0],"map");if(xe=i.cS(i.bC(),xe,[1,1,f.verticalScale]),j&&B){if(lu(J.tileID,se.maxHeight*V,t))continue;let je=B.calculateShadowPassMatrixFromTile(J.tileID.toUnwrapped());je=i.cS(i.bC(),je,[1,1,f.verticalScale]),pe=kc(je),he=de=t.getOrCreateProgram("buildingDepth",{config:ne,defines:T,overrideFog:!1})}else if(D)he=de=t.getOrCreateProgram("buildingBloom",{config:ne,defines:T,overrideFog:!1}),pe=Xd(xe);else{const je=t.transform.calculatePosMatrix(X.toUnwrapped(),t.transform.worldSize);i.cS(je,je,[1,1,f.verticalScale]);const Ae=i.bC();i.cS(Ae,je,[1,-1,1/V]),i.bl(Ae,Ae),i.eg(Ae,Ae);const De=t.transform.getFreeCameraOptions().position,ze=1<<X.canonical.z;if(pe=zf(xe,Ae,f.opacity,f.facadeAOIntensity,[((De.x-X.wrap)*ze-X.canonical.x)*i.al,(De.y*ze-X.canonical.y)*i.al,De.z*ze*i.al],se.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),de=t.getOrCreateProgram("building",{config:ne,defines:T,overrideFog:!1}),f.depthOnly===!0)he=de;else{const Me=T.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);he=t.getOrCreateProgram("building",{config:ne,defines:Me,overrideFog:!1})}B&&(B.setupShadowsFromMatrix(je,de,!0),he!==de&&B.setupShadowsFromMatrix(je,he,!0))}const ge=(je,Ae)=>{if(D){const De=je.entranceBloom;Ae.draw(t,E.gl.TRIANGLES,f.depthMode,Ki.disabled,f.blendMode,en.disabled,pe,m.id,De.layoutVertexBuffer,De.indexBuffer,De.segmentsBucket,m.paint,t.transform.zoom,ne,[De.layoutAttenuationBuffer,De.layoutColorBuffer])}else{const De=je.segmentsBucket;let ze=[je.layoutNormalBuffer,je.layoutCentroidBuffer,je.layoutColorBuffer,je.layoutFloodLightDataBuffer];je.layoutFacadePaintBuffer&&(ze=ze.concat([je.layoutFacadeDataBuffer,je.layoutFacadeVerticalRangeBuffer,je.layoutFacadePaintBuffer])),Ae.draw(t,E.gl.TRIANGLES,f.depthMode,Ki.disabled,f.blendMode,j?en.disabled:en.backCW,pe,m.id,je.layoutVertexBuffer,je.indexBuffer,De,m.paint,t.transform.zoom,ne,ze)}};t.uploadCommonUniforms(E,de,X.toUnwrapped(),null,Y),se.buildingWithoutFacade&&ge(se.buildingWithoutFacade,de),se.buildingWithFacade&&(he!==de&&t.uploadCommonUniforms(E,he,X.toUnwrapped(),null,Y),ge(se.buildingWithFacade,he))}}function Fh(f,t,s,m,v,T,E,j,D,B,V,Y,X){const J=f.context.gl,se=f.depthModeForSublayer(1,Pi.ReadOnly,J.LEQUAL,!0),ne=.1*(1-(he=V))+3*he;var he;const de=f._showOverdrawInspector,pe=Y,xe=new $m;de||ou(xe,f,t,s,m,se,new Ki({func:J.ALWAYS,mask:255},255,255,J.KEEP,J.KEEP,J.REPLACE),new sn([J.ONE,J.ONE,J.ONE,J.ONE],i.ao.transparent,[!1,!1,!1,!0],J.MIN),en.disabled,v,"sdf",T,E,j,D,B,ne,pe,!1);{const ge=de?Ki.disabled:new Ki({func:J.EQUAL,mask:255},255,255,J.KEEP,J.DECR,J.DECR),je=de?f.colorModeForRenderPass():new sn([J.ONE_MINUS_DST_ALPHA,J.DST_ALPHA,J.ONE,J.ONE],i.ao.transparent,[!0,!0,!0,!0]);ou(xe,f,t,s,m,se,ge,je,en.disabled,v,"color",T,E,j,D,B,ne,pe,!1)}}function Ff(f){return[f[0]*i.eh,f[1]*i.eh,f[2]*i.eh,0]}function Bh(f,t,s,m,v,T,E,j,D){const B=m.getSource(),V=s.globeSharedBuffers;if(!V)return;let Y,X,J;if(t&&(Y=m.getTile(t)),B instanceof i.aU?(X=B.texture,J=i.dK(0,0,s.transform)):Y&&t&&(X=Y.texture,J=i.dK(t.canonical.z,t.canonical.x,s.transform)),!X||!J)return;f||(J=i.cS(i.bC(),J,[1,-1,1]));const se=s.context,ne=se.gl,he=v.paint.get("raster-resampling")==="nearest"?ne.NEAREST:ne.LINEAR,de=s.colorModeForDrapableLayerRenderPass(T),pe=E.defines;pe.push("GLOBE_POLES");const xe=new Pi(ne.LEQUAL,Pi.ReadWrite,s.depthRangeFor3D),ge=Float32Array.from(s.transform.expandedFarZProjMatrix),je=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),se.activeTexture.set(ne.TEXTURE0),X.bind(he,ne.CLAMP_TO_EDGE),se.activeTexture.set(ne.TEXTURE1),X.bind(he,ne.CLAMP_TO_EDGE),"useMipmap"in X&&se.extTextureFilterAnisotropic&&s.transform.pitch>20&&ne.texParameterf(ne.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const[Ae,De,ze,Me]=t?V.getPoleBuffers(t.canonical.z,!1):V.getPoleBuffers(0,!0),Ve=v.paint.get("raster-elevation");let it;f?(it=Ae,s.renderDefaultNorthPole=Ve!==0):(it=De,s.renderDefaultSouthPole=Ve!==0);const Ye=Ff(E.mix),dt=((Tt,Ot,st,Xe,pt,ht,Nt,ti,gi,Wt,Dt,Ti,bi)=>Ts(Tt,Ot,st,new Float32Array(16),new Float32Array(9),[0,0],Xe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ht,[0,0],ti,2,Wt,Dt,Ti,1,0,bi))(ge,je,J,i.aj(s.transform.zoom),0,v,0,Ve,0,Ye,E.offset,E.range,T),mt=s.getOrCreateProgram("raster",{defines:pe});s.uploadCommonUniforms(se,mt,null),mt.draw(s,ne.TRIANGLES,xe,D,de,j,dt,v.id,it,ze,Me)}function Qp(f){const t=f._nearZ,s=f.projection.farthestPixelDistance(f),m=s-t,v=.2*f.height,T=t+v;return[t,s,(T-v-t)/m,(T-t)/m]}function cu(f,t,s,m){if(f)return t instanceof Jr&&f instanceof ar?t.getTextureDescriptor(f,s,!0):{texture:f.texture,mix:Ff(m.mix),offset:m.offset,buffer:0,tileSize:1}}var Da=i.ei([{name:"a_index",type:"Int16",components:1}]);class Vm{constructor(t,s,m,v){const T={width:m[0],height:m[1],data:null},E=t.gl;this.targetColorTexture=new i.T(t,T,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(t,T,E.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,v),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,v=s.width*s.height;this.particleTexture0=new i.T(this.context,s,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,s,m.RGBA8,{premultiply:!1,useMipmap:!1});const T=new i.ej;T.reserve(v);for(let E=0;E<v;E++)T.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(T,Da.members,!0),this.particleSegment=i.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Hm(f,t,s){if(!f)return null;const m=t.getTextureDescriptor(f,s,!0);if(!m)return null;let{texture:v,mix:T,offset:E,tileSize:j,buffer:D,format:B}=m;if(!v||!B)return null;let V=!1;return B==="uint32"&&(V=!0,T[3]=0,T=Ca(i.ek,T,[0,s.paint.get("raster-particle-max-speed")]),E=vr(i.ek,E,[0,s.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[D/(j+2*D),j/(j+2*D)],tileSize:j,scalarData:V,scale:T,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[B]]}}function eh(f){const t=f._nearZ,s=f.projection.farthestPixelDistance(f),m=s-t,v=.2*f.height,T=t+v;return[t,s,(T-v-t)/m,(T-t)/m]}const Bf=new i.ao(1,0,0,1),eg=new i.ao(0,1,0,1),Uf=new i.ao(0,0,1,1),Ac=new i.ao(1,0,1,1),xd=new i.ao(0,1,1,1);function Kt(f,t,s,m,v,T){for(let E=0;E<s.length;E++)if(v){const B=new i.ao(m.r*.8,m.g*.8,m.b*.8,1);si(f,t,s[E],m,-1,-1,T),si(f,t,s[E],m,-1,1,T),si(f,t,s[E],m,1,1,T),si(f,t,s[E],m,1,-1,T),si(f,t,s[E],B,0,0,T)}else si(f,t,s[E],m,0,0,T)}function si(f,t,s,m,v,T,E){const j=f.context,D=f.transform,B=j.gl,V=D.projection.name==="globe",Y=V?["PROJECTION_GLOBE_VIEW"]:[];let X=i.bz(s.projMatrix);if(V&&i.aj(D.zoom)>0){const Ye=i.bj(s.canonical,D),dt=i.el(Ye);X=i.aB(new Float32Array(16),D.globeMatrix,dt),i.aB(X,D.projMatrix,X)}const J=i.bC();J[12]+=2*v/(i.o.devicePixelRatio*D.width),J[13]+=2*T/(i.o.devicePixelRatio*D.height),i.aB(X,J,X);const se=f.getOrCreateProgram("debug",{defines:Y}),ne=t.getTileByID(s.key);f.terrain&&f.terrain.setupElevationDraw(ne,se);const he=Pi.disabled,de=Ki.disabled,pe=f.colorModeForRenderPass(),xe="$debug";j.activeTexture.set(B.TEXTURE0),f.emptyTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),V?ne._makeGlobeTileDebugBuffers(f.context,D):ne._makeDebugTileBoundsBuffers(f.context,D.projection);const ge=ne._tileDebugBuffer||f.debugBuffer,je=ne._tileDebugIndexBuffer||f.debugIndexBuffer,Ae=ne._tileDebugSegments||f.debugSegments;if(se.draw(f,B.LINE_STRIP,he,de,pe,en.disabled,Yd(X,m.toPremultipliedRenderColor(null)),xe,ge,je,Ae,null,null,null,[ne._globeTileDebugBorderBuffer]),E){const Ye=ne.latestRawTileData,dt=Math.floor((Ye&&Ye.byteLength||0)/1024);let mt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(mt+=` => ${s.overscaledZ}`),mt+=` ${ne.state}`,mt+=` ${dt}kb`,(function(Tt,Ot){Tt.initDebugOverlayCanvas();const st=Tt.debugOverlayCanvas,Xe=Tt.context.gl,pt=Tt.debugOverlayCanvas.getContext("2d");pt.clearRect(0,0,st.width,st.height),pt.shadowColor="white",pt.shadowBlur=2,pt.lineWidth=1.5,pt.strokeStyle="white",pt.textBaseline="top",pt.font="bold 36px Open Sans, sans-serif",pt.fillText(Ot,5,5),pt.strokeText(Ot,5,5),Tt.debugOverlayTexture.update(st),Tt.debugOverlayTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE)})(f,mt)}const De=t.getTile(s).tileSize,ze=512/Math.min(De,512)*(s.overscaledZ/D.zoom)*.5,Me=ne._tileDebugTextBuffer||f.debugBuffer,Ve=ne._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,it=ne._tileDebugTextSegments||f.debugSegments;se.draw(f,B.TRIANGLES,he,de,sn.alphaBlended,en.disabled,Yd(X,i.ao.transparent.toPremultipliedRenderColor(null),ze),xe,Me,Ve,it,null,null,null,[ne._globeTileDebugTextBuffer])}function bd(f,t,s,m){at(f,0,t+s/2,f.transform.width,s,m)}function ur(f,t,s,m){at(f,t-s/2,0,s,f.transform.height,m)}function at(f,t,s,m,v,T){const E=f.context,j=E.gl;j.enable(j.SCISSOR_TEST),j.scissor(t*i.o.devicePixelRatio,s*i.o.devicePixelRatio,m*i.o.devicePixelRatio,v*i.o.devicePixelRatio),E.clear({color:T}),j.disable(j.SCISSOR_TEST)}const Gm=i.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$f}=Gm;function Cc(f,t,s,m){f.emplaceBack(t,s,m)}class Uh{constructor(t){this.vertexArray=new i.em,this.indices=new i.b0,Cc(this.vertexArray,-1,-1,1),Cc(this.vertexArray,1,-1,1),Cc(this.vertexArray,-1,1,1),Cc(this.vertexArray,1,1,1),Cc(this.vertexArray,-1,-1,-1),Cc(this.vertexArray,1,-1,-1),Cc(this.vertexArray,-1,1,-1),Cc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,$f),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=i.bg.simpleSegment(0,0,36,12)}}function wd(f,t,s,m,v,T){const E=f.context.gl,j=t.paint.get("sky-atmosphere-color"),D=t.paint.get("sky-atmosphere-halo-color"),B=t.paint.get("sky-atmosphere-sun-intensity"),V=((Y,X,J,se,ne)=>({u_matrix_3f:Y,u_sun_direction:X,u_sun_intensity:J,u_color_tint_r:[se.r,se.g,se.b,se.a],u_color_tint_m:[ne.r,ne.g,ne.b,ne.a],u_luminance:5e-5}))(i.eo(i.dO(),m),v,B,j.toPremultipliedRenderColor(null),D.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+T,t.skyboxTexture,0),s.draw(f,E.TRIANGLES,Pi.disabled,Ki.disabled,sn.unblended,en.frontCW,V,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const tg=i.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class $h{constructor(t){const s=new i.ep;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const m=new i.b0;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,tg.members),this.indexBuffer=t.createIndexBuffer(m),this.segments=i.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ig=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class i_{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ng{constructor(t){this.colorModeAlphaBlendedWriteRGB=new sn([1,pl,1,pl],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new sn([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new i_,this.updateNeeded=!0}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new $h(s);const m=this.params.sizeRange,v=this.params.intensityRange,T=(function(V){const Y=i.eq(30),X=[];for(let J=0;J<V;++J){const se=2*Math.PI*Y(),ne=Math.acos(1-2*Y())-.5*Math.PI;X.push(i.d5(Math.cos(ne)*Math.cos(se),Math.cos(ne)*Math.sin(se),Math.sin(ne)))}return X})(this.params.starsCount),E=i.eq(300),j=new i.er,D=new i.b0;let B=0;for(let V=0;V<T.length;++V){const Y=i.c5([],T[V],200),X=Math.max(0,1+.01*m*(1*E()-.5)),J=Math.max(0,1+.01*v*(1*E()-.5));j.emplaceBack(Y[0],Y[1],Y[2],-1,-1,X,J),j.emplaceBack(Y[0],Y[1],Y[2],1,-1,X,J),j.emplaceBack(Y[0],Y[1],Y[2],1,1,X,J),j.emplaceBack(Y[0],Y[1],Y[2],-1,1,X,J),D.emplaceBack(B+0,B+1,B+2),D.emplaceBack(B+0,B+2,B+3),B+=4}this.starsVx=s.createVertexBuffer(j,ig.members),this.starsIdx=s.createIndexBuffer(D),this.starsSegments=i.bg.simpleSegment(0,0,j.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const m=t.context,v=m.gl,T=t.transform,E=new Pi(v.LEQUAL,Pi.ReadOnly,[0,1]),j=i.aj(T.zoom),D=t.style.getLut(s.scope),B=s.properties.get("color-use-theme")==="none",V=s.properties.get("color").toNonPremultipliedRenderColor(B?null:D),Y=s.properties.get("high-color-use-theme")==="none",X=s.properties.get("high-color").toNonPremultipliedRenderColor(Y?null:D),J=s.properties.get("space-color-use-theme")==="none",se=s.properties.get("space-color").toNonPremultipliedRenderColor(J?null:D),ne=5e-4,he=i.es(s.properties.get("horizon-blend"),0,1,ne,.25),de=i.dE(t,m,T)&&he===ne?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,pe=t.frameCounter/1e3%1,xe=i.ag(T.globeCenterInViewSpace),ge=Math.sqrt(Math.pow(xe,2)-Math.pow(de,2)),je=Math.acos(ge/xe),Ae=De=>{const ze=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];De&&ze.push("ALPHA_PASS");const Me=t.getOrCreateProgram("globeAtmosphere",{defines:ze}),Ve=((Ye,dt,mt,Tt,Ot,st,Xe,pt,ht,Nt,ti,gi)=>({u_frustum_tl:Ye,u_frustum_tr:dt,u_frustum_br:mt,u_frustum_bl:Tt,u_horizon:Ot,u_transition:st,u_fadeout_range:Xe,u_atmosphere_fog_color:pt.toArray01(),u_high_color:ht.toArray01(),u_space_color:Nt.toArray01(),u_temporal_offset:ti,u_horizon_angle:gi}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,j,he,V,X,se,pe,je);t.uploadCommonUniforms(m,Me);const it=this.atmosphereBuffer;it&&Me.draw(t,v.TRIANGLES,E,Ki.disabled,De?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,en.backCW,Ve,De?"atmosphere_glow_alpha":"atmosphere_glow",it.vertexBuffer,it.indexBuffer,it.segments)};Ae(!1),Ae(!0)}drawStars(t,s){const m=i.aA(s.properties.get("star-intensity"),0,1);if(m===0)return;const v=t.context,T=v.gl,E=t.transform,j=t.getOrCreateProgram("stars"),D=i.c7([]);i.c9(D,D,-E._pitch),i.c8(D,D,-E.angle),i.c9(D,D,i.an(E._center.lat)),i.et(D,D,-i.an(E._center.lng));const B=i.cc(new Float32Array(16),D),V=i.aB([],E.starsProjMatrix,B),Y=i.eo([],B),X=i.eu([],Y),J=[0,1,0];i.dQ(J,J,X),i.c5(J,J,this.params.sizeMultiplier);const se=[1,0,0];i.dQ(se,se,X),i.c5(se,se,this.params.sizeMultiplier);const ne=(he=J,de=se,pe=m,{u_matrix:Float32Array.from(V),u_up:he,u_right:de,u_intensity_multiplier:pe});var he,de,pe;t.uploadCommonUniforms(v,j),this.starsVx&&this.starsIdx&&j.draw(t,T.TRIANGLES,Pi.disabled,Ki.disabled,this.colorModeAlphaBlendedWriteRGB,en.disabled,ne,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Vh{constructor(){this.visibleTiles=[]}updateBorders(t,s){const m=[],v=[],T=t._getRenderableCoordinates(!1,!0);for(const D of T){const B=t.getTile(D);if(!B.hasData())continue;const V=B.getBucket(s);V&&(V.isEmpty()||(m.push(D.key),v.push({bucket:V,tileID:D.canonical})))}let E=m.length!==this.visibleTiles.length;if(!E){m.sort();for(let D=0;D<m.length;D++)if(m[D]!==this.visibleTiles[D]){E=!0;break}}if(!E)return;const j=new Set;this.visibleTiles=m,v.sort(((D,B)=>D.tileID.z-B.tileID.z||D.tileID.x-B.tileID.x||D.tileID.y-B.tileID.y));for(const D of v){const B=new Array,V=new Array,Y=D.bucket;for(const X of Y.featuresOnBorder)j.has(X.featureId)?V.push(X.footprintIndex):(j.add(X.featureId),B.push(X.footprintIndex));Y.updateFootprintHiddenFlags(B,i.ev,!1),Y.updateFootprintHiddenFlags(V,i.ev,!0)}}}function Vf(f,t){const s=[...f],m=t.cameraWorldSizeForFog/t.worldSize,v=i.bA([]);return i.cS(v,v,[m,m,1]),i.aB(s,v,s),i.aB(s,t.worldToFogMatrix,s),s}function Hf(f,t,s,m,v){const T=s.material,E=m.context,{baseColorTexture:j,metallicRoughnessTexture:D}=T.pbrMetallicRoughness,{normalTexture:B,occlusionTexture:V,emissionTexture:Y}=T;function X(se,ne,he){if(se&&(f.push(ne),E.activeTexture.set(E.gl.TEXTURE0+he),se.gfxTexture)){const{minFilter:de,magFilter:pe,wrapS:xe,wrapT:ge}=se.sampler;se.gfxTexture.bindExtraParam(de,pe,xe,ge)}}X(j,"HAS_TEXTURE_u_baseColorTexture",Ir.BaseColor),X(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Ir.MetallicRoughness),X(B,"HAS_TEXTURE_u_normalTexture",Ir.Normal),X(V,"HAS_TEXTURE_u_occlusionTexture",Ir.Occlusion),X(Y,"HAS_TEXTURE_u_emissionTexture",Ir.Emission),v&&(v.texture||(v.texture=new i.d$(m.context,v.image,[v.image.height,v.image.height,v.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+Ir.LUT),v.texture&&v.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(f.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||f.push("DIFFUSE_SHADED");const J=m.shadowRenderer;J&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),J.useNormalOffset&&f.push("NORMAL_OFFSET"))}function qm(f,t,s,m,v,T){const E=f.modelOpacity,j=t.context,D=new Pi(t.context.gl.LEQUAL,f.isLightMesh?Pi.ReadOnly:Pi.ReadWrite,t.depthRangeFor3D),B=t.transform,V=f.mesh,Y=V.material,X=Y.pbrMetallicRoughness,J=t.style.fog;let se;se=t.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:i.aB([],m.zScaleMatrix,f.nodeModelMatrix),i.aB(se,m.negCameraPosMatrix,se);const ne=i.bl([],se);i.eg(ne,ne);const he=s.paint.get("model-color-use-theme").constantOr("default")==="none",de=s.paint.get("model-emissive-strength").constantOr(0),pe=yd(new Float32Array(f.worldViewProjection),new Float32Array(se),new Float32Array(ne),null,t,E,X.baseColorFactor,Y.emissiveFactor,X.metallicFactor,X.roughnessFactor,Y,de,s,void 0,void 0,f.materialOverride,f.modelColor),xe={defines:[]},ge=[],je=t.shadowRenderer;je&&(je.useNormalOffset=!1),Hf(xe.defines,ge,V,t,he?null:s.lut);let Ae=null;if(J){const Me=Vf(f.nodeModelMatrix,t.transform);if(Ae=new Float32Array(Me),B.projection.name!=="globe"){const Ve=V.aabb.min,it=V.aabb.max,[Ye,dt]=J.getOpacityForBounds(Me,Ve[0],Ve[1],it[0],it[1]);xe.overrideFog=Ye>=St||dt>=St}}const De=_l(t,s.paint.get("model-cutoff-fade-range"));De.shouldRenderCutoff&&xe.defines.push("RENDER_CUTOFF");const ze=t.getOrCreateProgram("model",xe);t.uploadCommonUniforms(j,ze,null,Ae,De),t.renderPass!=="shadow"&&je&&je.setupShadowsFromMatrix(f.nodeModelMatrix,ze),ze.draw(t,j.gl.TRIANGLES,D,v,T,V.material.doubleSided?en.disabled:en.backCCW,pe,s.id,V.vertexBuffer,V.indexBuffer,V.segments,s.paint,t.transform.zoom,void 0,ge)}function Gf(f,t){return f.style._importedAsBasemap?"basemap":t.scope}function Sd(f,t,s,m,v,T,E,j,D,B){const V=f.transform,Y=!!t.isGeometryBloom&&t.isGeometryBloom;if(Y&&f.renderPass==="shadow")return;const X=V.projection.name==="globe"?i.eD(s,V):[...s];i.aB(X,X,t.globalMatrix);const J=i.aB([],m,X);if(t.meshes)for(const se of t.meshes){const ne=j.get(se.material.name);if(ne&&ne.opacity<=0)continue;if(se.material.alphaMode!=="BLEND"){E.push({mesh:se,depth:0,modelIndex:v,worldViewProjection:J,nodeModelMatrix:X,isLightMesh:Y,materialOverride:ne,modelOpacity:D,modelColor:B});continue}const he=i.af([],se.centroid,J);!V.isOrthographic&&he[2]<=0||T.push({mesh:se,depth:he[2],modelIndex:v,worldViewProjection:J,nodeModelMatrix:X,isLightMesh:Y,materialOverride:ne,modelOpacity:D,modelColor:B})}if(t.children)for(const se of t.children)Sd(f,se,s,m,v,T,E,j,D,B)}function sl(f,t,s,m){const v=s.shadowRenderer;if(!v)return;const T=v.getShadowPassDepthMode(),E=v.getShadowPassColorMode(),j=v.calculateShadowPassMatrixFromMatrix(t),D=Fm(j);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,T,Ki.disabled,E,en.disabled,D,m.id,f.vertexBuffer,f.indexBuffer,f.segments,m.paint,s.transform.zoom,void 0,void 0)}function Wm(f,t,s,m,v,T){for(const E of v){const j=Object.assign({},m);j.part=E;const D={type:"Unknown",id:t,properties:j},B={orientation:f.paint.get("model-rotation").evaluate(D,s)};T.set(E,B)}}function qf(f,t,s,m,v,T){for(const E of v){const j=Object.assign({},m);j.part=E;const D={type:"Unknown",id:t,properties:j},B={color:f.paint.get("model-color").evaluate(D,s),colorMix:f.paint.get("model-color-mix-intensity").evaluate(D,s),opacity:f.paint.get("model-opacity").evaluate(D,s),emissionStrength:f.paint.get("model-emissive-strength").evaluate(D,s)};T.set(E,B)}}function ag(f,t,s,m,v){let T=!1;for(const j of m)j.modelOpacity!==1&&(qm(j,f,t,v[j.modelIndex],Ki.disabled,sn.disabled),T=!0);for(const j of m)qm(j,f,t,v[j.modelIndex],j.modelOpacity!==1?f.stencilModeFor3D():Ki.disabled,f.colorModeForRenderPass());T&&f.resetStencilClippingMasks();const E=sn.additive;for(const j of s)qm(j,f,t,v[j.modelIndex],Ki.disabled,j.isLightMesh?E:f.colorModeForRenderPass())}function rg(f,t,s){const m=t.updateZoomBasedPaintProperties(),v=(function(T,E,j){let D,B,V,Y=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&Y>0){const X=T.terrain,J=X.findDEMTileFor(j);J&&J.dem?D=i.eF.create(X,j,J):Y=0}if(Y===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),Y===E.validForExaggeration&&(Y===0||D&&D._demTile&&D._demTile.tileID===E.validForDEMTile.id&&D._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const X in E.instancesPerModel){const J=E.instancesPerModel[X];for(let se=0;se<J.instancedDataArray.length;++se){const ne=(D?Y*D.getElevationAt(0|J.instancedDataArray.float32[16*se],0|J.instancedDataArray.float32[16*se+1],!0,!0):0)+J.instancesEvaluatedElevation[se];J.instancedDataArray.float32[16*se+6]=ne,B=B?Math.min(E.terrainElevationMin,ne):ne,V=V?Math.max(E.terrainElevationMax,ne):ne}}return E.terrainElevationMin=B||0,E.terrainElevationMax=V||0,E.validForExaggeration=Y,E.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,t,s);(m||v)&&(t.uploaded=!1,t.upload(f.context))}const Vl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d9([0,0,0],[i.al,i.al,0])};function ko(f,t){const s=1<<f.canonical.z,m=t.getFreeCameraOptions().position,v=t.elevation,T=f.canonical.x/s,E=(f.canonical.x+1)/s,j=f.canonical.y/s,D=(f.canonical.y+1)/s;let B=t._centerAltitude;if(v){const J=v.getMinMaxForTile(f);J&&J.max>B&&(B=J.max)}const V=i.aA(m.x,T,E)-m.x,Y=i.aA(m.y,j,D)-m.y,X=i.cf(B,t.center.lat)-m.z;return t._zoomFromMercatorZ(Math.sqrt(V*V+Y*Y+X*X))}function sg(f,t,s,m,v,T,E){const j=f.context,D=f.renderPass==="shadow",B=f.shadowRenderer,V=D&&B?B.getShadowPassDepthMode():new Pi(j.gl.LEQUAL,Pi.ReadWrite,f.depthRangeFor3D),Y=f.isTileAffectedByFog(T),X=f.transform.projection.name==="globe";if(s.meshes)for(const J of s.meshes){const se=X?[]:["MODEL_POSITION_ON_GPU"],ne=[];let he,de,pe;const xe=!X&&m.instancedDataArray.length>20;xe&&se.push("INSTANCED_ARRAYS");const ge=_l(f,t.paint.get("model-cutoff-fade-range"));if(ge.shouldRenderCutoff&&se.push("RENDER_CUTOFF"),D&&B)he=f.getOrCreateProgram("modelDepth",{defines:se}),de=Fm(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(s.globalMatrix)),pe=B.getShadowPassColorMode();else{Hf(se,ne,J,f,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),he=f.getOrCreateProgram("model",{defines:se,overrideFog:Y});const Ae=J.material,De=Ae.pbrMetallicRoughness,ze=t.paint.get("model-opacity").constantOr(1),Me=t.paint.get("model-emissive-strength").constantOr(0);de=yd(T.expandedProjMatrix,Float32Array.from(s.globalMatrix),new Float32Array(16),null,f,ze,De.baseColorFactor,Ae.emissiveFactor,De.metallicFactor,De.roughnessFactor,Ae,Me,t,v),B&&(E.shadowUniformsInitialized?he.setShadowUniformValues(j,B.getShadowUniformValues()):(B.setupShadows(T.toUnwrapped(),he,"model-tile"),E.shadowUniformsInitialized=!0)),pe=ge.shouldRenderCutoff||ze<1||Ae.alphaMode!=="OPAQUE"?sn.alphaBlended:sn.unblended}f.uploadCommonUniforms(j,he,T.toUnwrapped(),null,ge);const je=J.material.doubleSided?en.disabled:en.backCCW;if(xe)ne.push(m.instancedDataBuffer),he.draw(f,j.gl.TRIANGLES,V,Ki.disabled,pe,je,de,t.id,J.vertexBuffer,J.indexBuffer,J.segments,t.paint,f.transform.zoom,void 0,ne,m.instancedDataArray.length);else{const Ae=D?"u_instance":"u_normal_matrix";for(let De=0;De<m.instancedDataArray.length;++De)de[Ae]=new Float32Array(m.instancedDataArray.arrayBuffer,64*De,16),he.draw(f,j.gl.TRIANGLES,V,Ki.disabled,pe,je,de,t.id,J.vertexBuffer,J.indexBuffer,J.segments,t.paint,f.transform.zoom,void 0,ne)}}if(s.children)for(const J of s.children)sg(f,t,J,m,v,T,E)}const Wf=[1,-1,1];function Hh(f,t,s,m){if(!s.modelManager)return!0;const v=s.modelManager;if(!s.shadowRenderer)return!0;const T=s.shadowRenderer,E=t.aabb;let j=!0,D=f.maxHeight;if(D===0){let V=0;for(const Y in f.instancesPerModel){const X=v.getModel(Y,m);X?V=Math.max(V,Math.max(Math.max(X.aabb.max[0],X.aabb.max[1]),X.aabb.max[2])):j=!1}D=f.maxScale*V*1.41+f.maxVerticalOffset,j&&(f.maxHeight=D)}E.max[2]=D,E.min[2]+=f.terrainElevationMin,E.max[2]+=f.terrainElevationMax,i.af(E.min,E.min,t.tileMatrix),i.af(E.max,E.max,t.tileMatrix);const B=E.intersects(T.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=B===2),B===0}function La(f,t){const s=f.uniformValues.u_cutoff_params[0],m=f.uniformValues.u_cutoff_params[1],v=f.uniformValues.u_cutoff_params[2],T=f.uniformValues.u_cutoff_params[3];return m===s||T===v?1:i.aA(((t-s)/(m-s)-v)/(T-v),0,1)}function Mn(f,t,s,m){if(t.pitch<20)return 1;const v=t.getWorldToCameraMatrix();i.aB(v,v,f);const T=i.bU(s.min[0],s.min[1],s.min[2],1);let E=i.aC(i.eG(),T,v),j=E,D=E;T[1]=s.max[1],E=i.aC(i.eG(),T,v),j=E[1]<j[1]?E:j,D=E[1]>D[1]?E:D,T[0]=s.max[0],E=i.aC(i.eG(),T,v),j=E[1]<j[1]?E:j,D=E[1]>D[1]?E:D,T[1]=s.min[1],E=i.aC(i.eG(),T,v),j=E[1]<j[1]?E:j,D=E[1]>D[1]?E:D;const B=i.aA(m[0],0,1),V=100*t.pixelsPerMeter*i.aA(m[1],0,1),Y=i.aA(m[2],0,1),X=i.eH(i.eG(),j,D,B),J=Math.tan(.5*t.fovX),se=-X[2]*J;if(V===0)return X[1]<-Math.abs(se)?Y:1;const ne=(-Math.abs(se)-X[1])/V,he=(pe,xe,ge)=>(1-ge)*pe+ge*xe,de=i.aA(he(1,Y,ne),Y,1);return he(1,de,i.aA((t.pitch-20)/20,0,1))}class Gh{}class Mc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,m){{const Y=this._storage.get(s.id);if(Y)return Y.lastUsedFrameIdx=t,Y.buf}const v=m.gl,T=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),E=new ArrayBuffer(T),j=new Int16Array(E);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const D=new i.eJ;for(let Y=0;Y<T/2;Y+=3){const X=j[Y],J=j[Y+1],se=j[Y+2];D.emplaceBack(X,J),D.emplaceBack(J,se),D.emplaceBack(se,X)}const B=m.bindVertexArrayOES.current,V=new Gh;return V.buf=new $l(m,D),V.lastUsedFrameIdx=t,this._storage.set(s.id,V),m.bindVertexArrayOES.set(B),V.buf}update(t){for(const[s,m]of this._storage)t-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class th{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const ih=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class bl{constructor(t){this.revealStart=11,this.revealRange=2}}const Zm=i.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class wl{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const m=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new i.eK,j=new i.b0;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),j.emplaceBack(0,1,2),j.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(E,Zm.members),this.vignetteIdx=t.context.createIndexBuffer(j)}const v=i.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,m);const E={u_vignetteShape:(T={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:T.vignetteColor};m.draw(t,t.context.gl.TRIANGLES,Pi.disabled,Ki.disabled,sn.alphaBlended,en.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,v)}var T}}class oc{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const m=t.getFreeCameraOptions().position,v=m.toAltitude(),T=m.toLngLat(),E=i.an(T.lng),j=i.an(T.lat),D=t.pixelsPerMeter/s,B=E*i.eM,V=i.eM*Math.log(Math.tan(Math.PI/4+j/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Y=-this._offsetYPrev+V,X=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+B)*D,this._accumulatedOffsetY+=Y*D,this._accumulatedElevation+=X*D,this._offsetXPrev=B,this._offsetYPrev=V,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Pc(f,t){return[-(f[0]-Math.floor(f[0]/t)*t),-(f[1]-Math.floor(f[1]/t)*t),-(f[2]-Math.floor(f[2]/t)*t)]}function Sl(f){const t=i.eq(1323123451230),s=[];for(let m=0;m<f;++m){const v=2*t()-1,T=2*t()-1,E=2*t()-1;s.push(i.d5(v,T,E))}return s}function ms(f,t,s,m,v){const T=i.aA((v-s)/(m-s),0,1);return(1-T)*f+T*t}class ol{constructor(t){this._movement=new oc,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new wl,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const m=t.transform;this._movement.update(m,this._ppmScaleFactor);const v=m.starsProjMatrix,T=i.c7([]);i.c9(T,T,i.an(90)-m._pitch),i.c8(T,T,-m.angle);const E=i.cc(new Float32Array(16),T),j=i.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),D=i.eg([],j),B=i.aB([],D,E),V=Date.now()/1e3;return this._accumulatedTimeFromStart+=(V-this._prevTime)*s,this._prevTime=V,{projectionMatrix:v,modelviewMatrix:B}}}class ps extends ol{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new bl("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const m=Sl(this.particlesCount),v=new i.eN,T=new i.b0;let E=0;const j=i.eq(1323123451230);for(let D=0;D<m.length;++D){const B=m[D],V=[2*j()-1,j(),j(),j()];v.emplaceBack(B[0],B[1],B[2],-1,-1,...V),v.emplaceBack(B[0],B[1],B[2],1,-1,...V),v.emplaceBack(B[0],B[1],B[2],1,1,...V),v.emplaceBack(B[0],B[1],B[2],-1,1,...V),T.emplaceBack(E+0,E+1,E+2),T.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=s.createVertexBuffer(v,ih.members),this.particlesIdx=s.createIndexBuffer(T)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},m=t.transform.zoom;if(s.revealStart>m)return;const v=ms(0,1,s.revealStart,s.revealStart+s.revealRange,m);if(!this.particlesVx||!this.particlesIdx)return;const T=structuredClone(this._params);let E=[-T.direction.x,T.direction.y,-100];i.aw(E,E);const j=structuredClone(this._vignetteParams);j.strength*=v,T.overrideStyleParameters||(T.intensity=t.style.rain.state.density,T.timeFactor=t.style.rain.state.intensity,T.color=structuredClone(t.style.rain.state.color),E=structuredClone(t.style.rain.state.direction),T.screenThinning.intensity=t.style.rain.state.centerThinning,T.dropletSizeX=t.style.rain.state.dropletSize[0],T.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],T.distortionStrength=100*t.style.rain.state.distortionStrength,j.strength=1,j.color=structuredClone(t.style.rain.state.vignetteColor));const D=this.updateOnRender(t,T.timeFactor),B=t.context,V=B.gl,Y=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new i.T(B,{width:t.width,height:t.height,data:null},V.RGBA8)),T.distortionStrength>0&&(B.activeTexture.set(V.TEXTURE0),this.screenTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),V.copyTexSubImage2D(V.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const X=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(B,X),B.activeTexture.set(V.TEXTURE0),this.screenTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const J=[T.color.r,T.color.g,T.color.b,T.color.a],se=(ne,he)=>{const de=Pc(this._movement.getPosition(),ne),pe=T.dropletSizeX,xe=T.dropletSizeX*T.dropletSizeYScale,ge=t.width/2,je=t.height/2,Ae=ms(0,T.screenThinning.start,0,1,T.screenThinning.intensity),De=ms(.001,T.screenThinning.range,0,1,T.screenThinning.intensity),ze=ms(0,T.screenThinning.particleOffset,0,1,T.screenThinning.intensity),Me=(Ve={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:T.velocityConeAperture,velocity:T.velocity,boxSize:ne,rainDropletSize:[pe,xe],distortionStrength:T.distortionStrength,rainDirection:E,color:J,screenSize:[Y.width,Y.height],thinningCenterPos:[ge,je],thinningShape:[Ae,De,Math.pow(10,T.screenThinning.fadePower)],thinningAffectedRatio:T.screenThinning.affectedRatio,thinningParticleOffset:ze,shapeDirectionalPower:T.shapeDirPower,shapeNormalPower:T.shapeNormalPower,mode:he?0:1},{u_modelview:Float32Array.from(Ve.modelview),u_projection:Float32Array.from(Ve.projection),u_time:Ve.time,u_cam_pos:Ve.camPos,u_texScreen:0,u_velocityConeAperture:Ve.velocityConeAperture,u_velocity:Ve.velocity,u_boxSize:Ve.boxSize,u_rainDropletSize:Ve.rainDropletSize,u_distortionStrength:Ve.distortionStrength,u_rainDirection:Ve.rainDirection,u_color:Ve.color,u_screenSize:Ve.screenSize,u_thinningCenterPos:Ve.thinningCenterPos,u_thinningShape:Ve.thinningShape,u_thinningAffectedRatio:Ve.thinningAffectedRatio,u_thinningParticleOffset:Ve.thinningParticleOffset,u_shapeDirectionalPower:Ve.shapeDirectionalPower,u_shapeNormalPower:Ve.shapeNormalPower,u_mode:Ve.mode});var Ve;const it=Math.round(T.intensity*this.particlesCount),Ye=i.bg.simpleSegment(0,0,4*it,2*it);X.draw(t,V.TRIANGLES,Pi.disabled,Ki.disabled,sn.alphaBlended,en.disabled,Me,"rain_particles",this.particlesVx,this.particlesIdx,Ye)};T.distortionStrength>0&&se(T.boxSize,!0),se(T.boxSize,!1),this._vignette.draw(t,j)}}const qh=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Zf extends ol{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new bl("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const m=Sl(this.particlesCount),v=new i.eO,T=new i.b0;let E=0;const j=i.eq(1323123451230);for(let D=0;D<m.length;++D){const B=m[D],V=j(),Y=j(),X=j(),J=[D/m.length,V,Y,X],se=[j(),j()];v.emplaceBack(B[0],B[1],B[2],-1,-1,...J,...se),v.emplaceBack(B[0],B[1],B[2],1,-1,...J,...se),v.emplaceBack(B[0],B[1],B[2],1,1,...J,...se),v.emplaceBack(B[0],B[1],B[2],-1,1,...J,...se),T.emplaceBack(E+0,E+1,E+2),T.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=s.createVertexBuffer(v,qh.members),this.particlesIdx=s.createIndexBuffer(T)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let m=[-s.direction.x,s.direction.y,-100];i.aw(m,m);const v=structuredClone(this._vignetteParams),T=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=t.transform.zoom;if(T.revealStart>E)return;const j=ms(0,1,T.revealStart,T.revealStart+T.revealRange,E);v.strength*=j,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),m=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(t.style.snow.state.vignetteColor));const D=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const B=t.context,V=B.gl,Y=t.transform,X=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(B,X),((J,se,ne)=>{const he=Pc(this._movement.getPosition(),J),de=Y.width/2,pe=Y.height/2,xe=ms(0,ne.screenThinning.start,0,1,ne.screenThinning.intensity),ge=ms(.001,ne.screenThinning.range,0,1,ne.screenThinning.intensity),je=ms(0,ne.screenThinning.particleOffset,0,1,ne.screenThinning.intensity),Ae=(De={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:he,velocityConeAperture:ne.velocityConeAperture,velocity:ne.velocity,horizontalOscillationRadius:ne.horizontalOscillationRadius,horizontalOscillationRate:ne.horizontalOscillationRate,boxSize:J,billboardSize:1*ne.billboardSize,simpleShapeParameters:[ne.shapeFadeStart,ne.shapeFadePower],screenSize:[Y.width,Y.height],thinningCenterPos:[de,pe],thinningShape:[xe,ge,Math.pow(10,ne.screenThinning.fadePower)],thinningAffectedRatio:ne.screenThinning.affectedRatio,thinningParticleOffset:je,color:[ne.color.r,ne.color.g,ne.color.b,ne.color.a],direction:m},{u_modelview:Float32Array.from(De.modelview),u_projection:Float32Array.from(De.projection),u_time:De.time,u_cam_pos:De.camPos,u_velocityConeAperture:De.velocityConeAperture,u_velocity:De.velocity,u_horizontalOscillationRadius:De.horizontalOscillationRadius,u_horizontalOscillationRate:De.horizontalOscillationRate,u_boxSize:De.boxSize,u_billboardSize:De.billboardSize,u_simpleShapeParameters:De.simpleShapeParameters,u_screenSize:De.screenSize,u_thinningCenterPos:De.thinningCenterPos,u_thinningShape:De.thinningShape,u_thinningAffectedRatio:De.thinningAffectedRatio,u_thinningParticleOffset:De.thinningParticleOffset,u_particleColor:De.color,u_direction:De.direction});var De;const ze=Math.round(ne.intensity*this.particlesCount),Me=i.bg.simpleSegment(0,0,4*ze,2*ze);this.particlesVx&&this.particlesIdx&&X.draw(t,V.TRIANGLES,Pi.disabled,Ki.disabled,sn.alphaBlended,en.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,Me)})(s.boxSize,0,s),this._vignette.draw(t,v)}}const uu={symbol:function(f,t,s,m,v){if(f.renderPass!=="translucent")return;const T=Ki.disabled,E=f.colorModeForRenderPass(),j=s.layout.get("text-variable-anchor"),D=s.layout.get("text-size-scale-range"),B=i.aA(f.scaleFactor,D[0],D[1]);j&&(function(X,J,se,ne,he,de,pe,xe){const ge=J.transform,je=he==="map",Ae=de==="map";for(const De of X){const ze=ne.getTile(De),Me=ze.getBucket(se);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const Ve=i.bK(Me.textSizeData,ge.zoom,xe),it=bo(De,Me.getProjection(),ge),Ye=ge.calculatePixelsToTileUnitsMatrix(ze),dt=zs(it,ze.tileID.canonical,Ae,je,ge,Me.getProjection(),Ye),mt=Me.hasIconTextFit()&&Me.hasIconData();Ve&&Hi(Me,je,Ae,pe,ge,dt,De,Math.pow(2,ge.zoom-ze.tileID.overscaledZ),Ve,mt)}})(m,f,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),v,B);const V=s.paint.get("icon-opacity").constantOr(1)!==0,Y=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(V||Y)?Qd(f,t,s,m,T,E):(V&&Qd(f,t,s,m,T,E,{onlyIcons:!0}),Y&&Qd(f,t,s,m,T,E,{onlyText:!0})),t.map.showCollisionBoxes&&(yi(f,t,s,m,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),yi(f,t,s,m,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,s,m){if(f.renderPass!=="translucent")return;const v=s.paint.get("circle-opacity"),T=s.paint.get("circle-stroke-width"),E=s.paint.get("circle-stroke-opacity"),j=s.layout.get("circle-sort-key").constantOr(1)!==void 0,D=s.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(T.constantOr(1)===0||E.constantOr(1)===0))return;const B=f.context,V=B.gl,Y=f.transform,X=!(!f.terrain||!f.terrain.enabled),J=s.layout.get("circle-elevation-reference"),se=f.depthModeForSublayer(0,Pi.ReadOnly),ne=new Pi(f.context.gl.LEQUAL,Pi.ReadOnly,f.depthRangeFor3D),he=J==="none"||X?se:ne,de=Ki.disabled,pe=f.colorModeForDrapableLayerRenderPass(D),xe=Y.projection.name==="globe",ge=[i.aF(Y.center.lng),i.aJ(Y.center.lat)],je=[];for(let De=0;De<m.length;De++){const ze=m[De],Me=t.getTile(ze),Ve=Me.getBucket(s);if(!Ve||Ve.projection.name!==Y.projection.name)continue;const it=Ve.programConfigurations.get(s.id),Ye=Ve.layoutVertexBuffer,dt=Ve.globeExtVertexBuffer,mt=Ve.indexBuffer,Tt=i.e0(s),Ot=[dt],st=f.isTileAffectedByFog(ze);xe&&Tt.push("PROJECTION_GLOBE_VIEW"),Tt.push("DEPTH_D24"),f.terrain&&Y.depthOcclusionForSymbolsAndCircles&&Tt.push("DEPTH_OCCLUSION"),Ve.hasElevation&&!f.terrain&&(Tt.push("ELEVATED_ROADS"),Ot.push(Ve.elevatedLayoutVertexBuffer));const Xe=f.getOrCreateProgram("circle",{config:it,defines:Tt,overrideFog:st}),pt=Y.projection.createInversionMatrix(Y,ze.canonical),ht={programConfiguration:it,program:Xe,layoutVertexBuffer:Ye,dynamicBuffers:Ot,indexBuffer:mt,uniformValues:i.e1(f,ze,Me,pt,ge,s),tile:Me};if(j){const Nt=Ve.segments.get();for(const ti of Nt)je.push({segments:new i.bg([ti]),sortKey:ti.sortKey,state:ht})}else je.push({segments:Ve.segments,sortKey:0,state:ht})}j&&je.sort(((De,ze)=>De.sortKey-ze.sortKey));const Ae={useDepthForOcclusion:Y.depthOcclusionForSymbolsAndCircles};for(const De of je){const{programConfiguration:ze,program:Me,layoutVertexBuffer:Ve,dynamicBuffers:it,indexBuffer:Ye,uniformValues:dt,tile:mt}=De.state,Tt=De.segments;f.terrain&&f.terrain.setupElevationDraw(mt,Me,Ae),f.uploadCommonUniforms(B,Me,mt.tileID.toUnwrapped()),Me.draw(f,V.TRIANGLES,he,de,pe,en.disabled,dt,s.id,Ve,Ye,Tt,s.paint,Y.zoom,ze,it)}},heatmap:function(f,t,s,m){if(s.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const v=f.context,T=v.gl,E=Ki.disabled,j=new sn([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(J,se,ne,he){const de=J.gl,pe=se.width*he,xe=se.height*he;J.activeTexture.set(de.TEXTURE1),J.viewport.set([0,0,pe,xe]);let ge=ne.heatmapFbo;if(!ge||ge&&(ge.width!==pe||ge.height!==xe)){ge&&ge.destroy();const je=de.createTexture();de.bindTexture(de.TEXTURE_2D,je),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_S,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_T,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MIN_FILTER,de.LINEAR),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MAG_FILTER,de.LINEAR),ge=ne.heatmapFbo=J.createFramebuffer(pe,xe,1,null),(function(Ae,De,ze,Me,Ve,it){const Ye=Ae.gl;Ye.texImage2D(Ye.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?Ye.RGBA16F:Ye.RGBA,Ve,it,0,Ye.RGBA,Ae.extRenderToTextureHalfFloat?Ye.HALF_FLOAT:Ye.UNSIGNED_BYTE,null),Me.colorAttachment0.set(ze)})(J,0,je,ge,pe,xe)}else de.bindTexture(de.TEXTURE_2D,ge.colorAttachment0.get()),J.bindFramebuffer.set(ge.framebuffer)})(v,f,s,f.transform.projection.name==="globe"?.5:.25),v.clear({color:i.ao.transparent});const D=f.transform,B=D.projection.name==="globe",V=B?["PROJECTION_GLOBE_VIEW"]:[],Y=B?en.frontCCW:en.disabled,X=[i.aF(D.center.lng),i.aJ(D.center.lat)];for(let J=0;J<m.length;J++){const se=m[J];if(t.hasRenderableParent(se))continue;const ne=t.getTile(se),he=ne.getBucket(s);if(!he||he.projection.name!==D.projection.name)continue;const de=f.isTileAffectedByFog(se),pe=he.programConfigurations.get(s.id),xe=f.getOrCreateProgram("heatmap",{config:pe,defines:V,overrideFog:de}),{zoom:ge}=f.transform;f.terrain&&f.terrain.setupElevationDraw(ne,xe),f.uploadCommonUniforms(v,xe,se.toUnwrapped());const je=D.projection.createInversionMatrix(D,se.canonical);xe.draw(f,T.TRIANGLES,Pi.disabled,E,j,Y,Lu(f,se,ne,je,X,ge,s.paint.get("heatmap-intensity")),s.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,s.paint,f.transform.zoom,pe,B?[he.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(v,T){const E=v.context,j=E.gl,D=T.heatmapFbo;if(!D)return;E.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,D.colorAttachment0.get()),E.activeTexture.set(j.TEXTURE1);let B=T.colorRampTexture;B||(B=T.colorRampTexture=new i.T(E,T.colorRamp,j.RGBA8)),B.bind(j.LINEAR,j.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,j.TRIANGLES,Pi.disabled,Ki.disabled,v.colorModeForRenderPass(),en.disabled,((V,Y,X,J)=>({u_image:0,u_color_ramp:1,u_opacity:Y.paint.get("heatmap-opacity")}))(0,T),T.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,T.paint,v.transform.zoom)})(f,s))},line:function(f,t,s,m){if(f.renderPass!=="translucent")return;const v=s.paint.get("line-opacity"),T=s.paint.get("line-width");if(v.constantOr(1)===0||T.constantOr(1)===0)return;const E=s.paint.get("line-emissive-strength").isConstant(),j=s.paint.get("line-emissive-strength").constantOr(0),D=s.paint.get("line-occlusion-opacity"),B=s.layout.get("line-elevation-reference"),V=s.layout.get("line-width-unit")==="meters",Y=B==="sea",X=!(!f.terrain||!f.terrain.enabled),J=f.context,se=J.gl;if(s.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const ne=s.layout.get("line-cross-slope"),he=ne!==void 0,de=ne<1,pe=f.colorModeForDrapableLayerRenderPass(E?j:null),xe=f.terrain&&f.terrain.renderingToTexture,ge=xe?1:i.o.devicePixelRatio,je=s.paint.get("line-dasharray"),Ae=je.constantOr(1),De=s.layout.get("line-cap"),ze=je.constantOr(null),Me=De.constantOr(null),Ve=s.paint.get("line-pattern"),it=Ve.constantOr(1),Ye=s.paint.get("line-pattern-cross-fade"),dt=Ve.constantOr(null),mt=s.paint.get("line-opacity").constantOr(1);let Tt=!it&&mt!==1||f.depthOcclusion&&D>0&&D<1;const Ot=s.paint.get("line-gradient"),st=it?"linePattern":"line",Xe=i.e2(s);let pt;if(xe&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Tt=!1),D!==0&&f.depthOcclusion){const gi=s.paint._values["line-opacity"];gi&&gi.value&&gi.value.kind==="constant"?pt=gi.value:i.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}T.value.kind!=="constant"&&T.value.isLineProgressConstant===!1&&Xe.push("VARIABLE_LINE_WIDTH"),xe&&(f.emissiveMode!=="dual-source-blending"||E?f.emissiveMode==="mrt-fallback"&&Xe.push("USE_MRT1"):Xe.push("DUAL_SOURCE_BLENDING"));const ht=(gi,Wt,Dt,Ti,bi,di)=>{for(const _i of gi){const Bi=t.getTile(_i);if(it&&!Bi.patternsLoaded())continue;const dn=Bi.getBucket(s);if(!dn||dn.elevationType!=="none"&&!bi||dn.elevationType==="none"&&bi)continue;f.prepareDrawTile();const Pn=[...Wt],Jn=f.shadowRenderer,wi=dn.elevationType==="road"&&!!Jn&&Jn.enabled;let Qn=[0,0,0];if(wi){const gn=f.style.directionalLight,Oa=f.style.ambientLight;gn&&Oa&&(Qn=Ds(f.style,gn,Oa)),Pn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Wi=dn.programConfigurations.get(s.id);let la=!1;if(dt&&Bi.imageAtlas){const gn=i.e3.from(dt),Oa=gn.getPrimary().scaleSelf(ge).toString(),Tr=Bi.imageAtlas.patternPositions.get(Oa),lr=gn.getSecondary(),Ma=lr?Bi.imageAtlas.patternPositions.get(lr.scaleSelf(ge).toString()):null;la=!!Tr&&!!Ma,Tr&&Wi.setConstantPatternPositions(Tr,Ma)}Ye>0&&(la||Wi.getPatternTransitionVertexBuffer("line-pattern"))&&Pn.push("LINE_PATTERN_TRANSITION");const _a=f.isTileAffectedByFog(_i),ya=f.getOrCreateProgram(st,{config:Wi,defines:Pn,overrideFog:_a});if(!it&&ze&&Me&&Bi.lineAtlas){const gn=Bi.lineAtlas.getDash(ze,Me);gn&&Wi.setConstantPatternPositions(gn)}wi&&Jn.setupShadows(Bi.tileID.toUnwrapped(),ya,"vector-tile");let[Rn,mn]=s.paint.get("line-trim-offset");(Me==="round"||Me==="square")&&Rn!==mn&&(Rn===0&&(Rn-=1),mn===1&&(mn+=1));const ta=xe?_i.projMatrix:null,Va=V?1/dn.tileToMeter/i.ay(Bi,1,f.transform.zoom):1,Za=V?1/dn.tileToMeter/i.ay(Bi,1,Math.floor(f.transform.zoom)):1,ca=it?i.e4(f,Bi,s,ta,ge,Va,Za,[Rn,mn],Qn,Ye):i.e5(f,Bi,s,ta,dn.lineClipsArray.length,ge,Va,Za,[Rn,mn],Qn);if(Ot){const gn=dn.gradients[s.id];let Oa=gn.texture;if(s.gradientVersion!==gn.version){let Tr=256;if(s.stepInterpolant){const lr=t.getSource().maxzoom,Ma=_i.canonical.z===lr?Math.ceil(1<<f.transform.maxZoom-_i.canonical.z):1;Tr=i.aA(i.e6(dn.maxLineLength/i.al*1024*Ma),256,J.maxTextureSize)}gn.gradient=i.e7({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Tr,image:gn.gradient||void 0,clips:dn.lineClipsArray}),gn.texture?gn.texture.update(gn.gradient):gn.texture=new i.T(J,gn.gradient,se.RGBA8),gn.version=s.gradientVersion,Oa=gn.texture}J.activeTexture.set(se.TEXTURE1),Oa.bind(s.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}Ae&&(J.activeTexture.set(se.TEXTURE0),Bi.lineAtlasTexture&&Bi.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),Wi.updatePaintBuffers()),it&&(J.activeTexture.set(se.TEXTURE0),Bi.imageAtlasTexture&&Bi.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Wi.updatePaintBuffers()),bi&&!Y&&f.terrain.setupElevationDraw(Bi,ya),f.uploadCommonUniforms(J,ya,_i.toUnwrapped());const Wn=gn=>{pt!=null&&(pt.value=mt*D),ya.draw(f,se.TRIANGLES,Dt,gn,pe,en.disabled,ca,s.id,dn.layoutVertexBuffer,dn.indexBuffer,dn.segments,s.paint,f.transform.zoom,Wi,[dn.layoutVertexBuffer2,dn.patternVertexBuffer,dn.zOffsetVertexBuffer]),pt!=null&&(pt.value=mt)};if(Tt&&!bi){const gn=f.stencilModeForClipping(_i).ref;gn===0&&xe&&J.clear({stencil:0});const Oa={func:se.EQUAL,mask:255};ca.u_alpha_discard_threshold=.8,Wn(new Ki(Oa,gn,255,se.KEEP,se.KEEP,se.INVERT)),ca.u_alpha_discard_threshold=0,Wn(new Ki(Oa,gn,255,se.KEEP,se.KEEP,se.KEEP))}else ca.u_alpha_discard_threshold=Tt&&bi&&di?.8:0,Wn(bi?Ti:f.stencilModeForClipping(_i))}};let Nt=f.depthModeForSublayer(0,Pi.ReadOnly);const ti=new Pi(f.depthOcclusion?se.GREATER:se.LEQUAL,Pi.ReadOnly,f.depthRangeFor3D);if(s.hasNonElevatedBuckets){const gi=!xe&&f.terrain;D!==0&&gi?i.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):gi?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):ht(m,Xe,Nt,Ki.disabled,!1,!0)}if(s.hasElevatedBuckets){B==="hd-road-markup"?X||(Nt=ti,Xe.push("ELEVATED_ROADS")):(Xe.push("ELEVATED"),Nt=ti,he&&Xe.push(de?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Y&&Xe.push("ELEVATION_REFERENCE_SEA"));const gi=Tt?f.stencilModeFor3D():Ki.disabled;f.forceTerrainMode=!0,ht(m,Xe,Nt,gi,!0,!0),Tt&&ht(m,Xe,Nt,gi,!0,!1),f.forceTerrainMode=!1}Tt&&(f.resetStencilClippingMasks(),xe&&J.clear({stencil:0})),D===0||f.depthOcclusion||xe||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,t,s,m){const v=s.paint.get("fill-color"),T=s.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const E=s.paint.get("fill-emissive-strength"),j=f.colorModeForDrapableLayerRenderPass(E),D=s.paint.get("fill-pattern"),B=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&v.constantOr(i.ao.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";let V="none";s.layout.get("fill-elevation-reference")!=="none"?V="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(V="offset");const Y=!(!f.terrain||!f.terrain.enabled),X={painter:f,sourceCache:t,layer:s,coords:m,colorMode:j,elevationType:V,terrainEnabled:Y,pass:B};if(f.renderPass==="shadow")return void(f.shadowRenderer&&V==="road"&&!Y&&(function(se){const{painter:ne,sourceCache:he,layer:de,coords:pe}=se,xe=ne.context.gl,ge=se.painter.shadowRenderer;for(const je of pe){const Ae=he.getTile(je),De=Ae.getBucket(de);if(!De)continue;const ze=De.elevatedStructures;if(!ze||!ze.shadowCasterSegments||ze.shadowCasterSegments.segments[0].primitiveLength===0)continue;ne.prepareDrawTile();const Me=De.bufferData.programConfigurations.get(de.id),Ve=ne.isTileAffectedByFog(je),it=ne.getOrCreateProgram("elevatedStructuresDepth",{config:Me,overrideFog:Ve}),Ye=ge.calculateShadowPassMatrixFromTile(Ae.tileID.toUnwrapped());ne.uploadCommonUniforms(ne.context,it,je.toUnwrapped());const dt={u_matrix:Ye,u_depth_bias:0};it.draw(ne,xe.TRIANGLES,ge.getShadowPassDepthMode(),Ki.disabled,ge.getShadowPassColorMode(),en.disabled,dt,de.id,ze.vertexBuffer,ze.indexBuffer,ze.shadowCasterSegments,de.paint,ne.transform.zoom,Me)}})(X));const J=f.emissiveMode==="mrt-fallback";if(V!=="offset"){if(Of(X,!1,J),V==="road"){const se=!Y&&f.renderPass==="translucent";se&&Lf(f,t,s,m,"geometry"),Of(X,!0,J,Ki.disabled),se&&(function(ne){const{painter:he,sourceCache:de,layer:pe,coords:xe,colorMode:ge}=ne,je=he.context.gl,Ae=ne.painter.shadowRenderer,De=!!Ae&&Ae.enabled,ze=new Pi(he.context.gl.LEQUAL,Pi.ReadOnly,he.depthRangeFor3D);let Me=[0,0,0];if(De){const it=he.style.directionalLight,Ye=he.style.ambientLight;it&&Ye&&(Me=Ds(he.style,it,Ye))}const Ve=it=>{for(const Ye of xe){const dt=de.getTile(Ye),mt=dt.getBucket(pe);if(!mt)continue;const Tt=mt.elevatedStructures;if(!Tt)continue;let Ot,st;if(it?(Ot=Tt.renderableBridgeSegments,st=Tt.bridgeProgramConfigurations.get(pe.id)):(Ot=Tt.renderableTunnelSegments,st=Tt.tunnelProgramConfigurations.get(pe.id)),!Ot||Ot.segments[0].primitiveLength===0)continue;st.updatePaintBuffers(),he.prepareDrawTile();const Xe=he.isTileAffectedByFog(Ye),pt=[];De&&pt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ht=he.getOrCreateProgram("elevatedStructures",{config:st,overrideFog:Xe,defines:pt}),Nt=he.translatePosMatrix(Ye.projMatrix,dt,pe.paint.get("fill-translate"),pe.paint.get("fill-translate-anchor"));De&&Ae.setupShadows(dt.tileID.toUnwrapped(),ht,"vector-tile");const ti=sc(Nt,Me);he.uploadCommonUniforms(he.context,ht,Ye.toUnwrapped()),ht.draw(he,je.TRIANGLES,ze,Ki.disabled,ge,en.backCCW,ti,pe.id,Tt.vertexBuffer,Tt.indexBuffer,Ot,pe.paint,he.transform.zoom,st,[Tt.vertexBufferNormal])}};Ve(!0),Ve(!1)})(X)}}else Of(X,!1,J,f.stencilModeFor3D())},"fill-extrusion":function(f,t,s,m){const v=s.paint.get("fill-extrusion-opacity"),T=f.context,E=T.gl,j=f.terrain,D=j&&j.renderingToTexture;if(v===0)return;const B=f.emissiveMode==="mrt-fallback",V=f.conflationActive&&f.style.isLayerClipped(s,t.getSource()),Y=f.style.order.indexOf(s.fqid);if(V&&(function(X,J,se,ne,he){for(const de of ne){const pe=J.getTile(de).getBucket(se);pe&&(pe.updateReplacement(de,X.replacementSource,he),pe.uploadCentroid(X.context))}})(f,t,s,m,Y),j||V)for(const X of m){const J=t.getTile(X).getBucket(s);J&&Kp(f.context,t,X,J,s,j,V)}if(f.renderPass==="shadow"&&f.shadowRenderer){const X=f.shadowRenderer;if(j&&v<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const J=X.getShadowPassDepthMode(),se=X.getShadowPassColorMode();Nf(f,t,s,m,J,Ki.disabled,se,V)}else if(f.renderPass==="translucent"){const X=!s.paint.get("fill-extrusion-pattern").constantOr(1),J=s.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!D&&J.a!==0){const se=new Pi(f.context.gl.LEQUAL,Pi.ReadWrite,f.depthRangeFor3D);v===1&&X?Nf(f,t,s,m,se,Ki.disabled,sn.unblended,V):(Nf(f,t,s,m,se,Ki.disabled,sn.disabled,V),Nf(f,t,s,m,se,f.stencilModeFor3D(),f.colorModeForRenderPass(),V),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&X&&(!j&&f.transform.projection.name!=="globe"||D)){const se=s.paint.get("fill-extrusion-opacity"),ne=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),he=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),de=s.paint.get("fill-extrusion-flood-light-intensity"),pe=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",xe=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(pe?null:s.lut).toArray01().slice(0,3),ge=ne>0&&he>0,je=de>0,Ae=(Me,Ve,it)=>(1-it)*Me+it*Ve,De=new $m;De.translate=s.paint.get("fill-extrusion-translate"),De.translateAnchor=s.paint.get("fill-extrusion-translate-anchor"),De.edgeRadius=s.layout.get("fill-extrusion-edge-radius"),De.cutoffFadeRange=s.paint.get("fill-extrusion-cutoff-fade-range");const ze=Me=>{const Ve=f.depthModeForSublayer(1,Pi.ReadOnly,E.LEQUAL,!0),it=s.paint.get(Me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ye=Ae(.1,3,it),dt=f._showOverdrawInspector;if(!dt){const mt=new Ki({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Tt=new sn([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!1,!1,!1,!0],E.MIN);ou(De,f,t,s,m,Ve,mt,Tt,en.disabled,Me,"sdf",se,ne,he,de,xe,Ye,V,!1)}{const mt=dt?Ki.disabled:new Ki({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Tt=dt?f.colorModeForRenderPass():new sn([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],i.ao.transparent,[!0,!0,!0,!0]);ou(De,f,t,s,m,Ve,mt,Tt,en.disabled,Me,"color",se,ne,he,de,xe,Ye,V,!1)}};if(D){const Me=()=>{const it=j.drapeBufferSize[0],Ye=j.drapeBufferSize[1];let dt=j.framebufferCopyTexture;return dt&&(!dt||dt.size[0]===it&&dt.size[1]===Ye)||(dt&&dt.destroy(),dt=j.framebufferCopyTexture=new i.T(T,new i.q({width:it,height:Ye}),E.RGBA8)),dt.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,it,Ye),dt},Ve=(it,Ye,dt)=>{const mt=f.depthModeForSublayer(1,Pi.ReadOnly,E.LEQUAL,!1),Tt=s.paint.get(it?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ot=Ae(.1,3,Tt);{const st=new sn([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!1,!1,!1,!0]);ou(De,f,t,s,m,mt,Ki.disabled,st,en.disabled,it,"clear",se,ne,he,de,xe,Ot,V,Ye)}{const st=new Ki({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Xe=new sn([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!1,!1,!1,!0],E.MIN);ou(De,f,t,s,m,mt,st,Xe,en.disabled,it,"sdf",se,ne,he,de,xe,Ot,V,Ye)}B&&!it&&(dt=Me());{const st=it?E.ZERO:E.ONE_MINUS_DST_ALPHA,Xe=new Ki({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),pt=new sn([st,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],i.ao.transparent,[!0,!0,!0,!0]);ou(De,f,t,s,m,mt,Xe,pt,en.disabled,it,"color",se,ne,he,de,xe,Ot,V,Ye)}if(!B||it){const st=new sn([E.ONE,E.ONE,E.ONE,it?E.ZERO:E.ONE],i.ao.transparent,[!1,!1,!1,!0],it?E.FUNC_ADD:E.MAX);ou(De,f,t,s,m,mt,Ki.disabled,st,en.disabled,it,"clear",se,ne,he,de,xe,Ot,V,Ye,dt)}else{E.drawBuffers([E.NONE,E.COLOR_ATTACHMENT1]);const st=new Ki({func:E.EQUAL,mask:255},254,255,E.KEEP,E.DECR,E.DECR),Xe=new sn([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!0,!1,!1,!1],E.MAX);ou(De,f,t,s,m,mt,st,Xe,en.disabled,it,"emissive",se,ne,he,de,xe,Ot,V,Ye,dt),E.drawBuffers([E.COLOR_ATTACHMENT0])}};if(ge||je){let it;f.prepareDrawTile(),B&&!ge||(it=Me()),ge&&Ve(!0,!1,it),je&&Ve(!1,!0,it)}}else ge&&ze(!0),je&&ze(!1),(ge||je)&&f.resetStencilClippingMasks()}}},building:function(f,t,s,m){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const v=s.paint.get("building-ambient-occlusion-ground-intensity"),T=s.paint.get("building-ambient-occlusion-ground-radius"),E=s.paint.get("building-ambient-occlusion-ground-attenuation"),j=s.paint.get("building-opacity");if(j<=0)return;let D=v>0&&T>0,B=!0;const V=s.paint.get("building-vertical-scale");if(V<=0)return;f.shadowRenderer||(B=!1);const Y=f.conflationActive&&f.style.isLayerClipped(s,t.getSource()),X=f.style.order.indexOf(s.fqid);if((function(J,se,ne,he,de,pe){for(const xe of pe){const ge=se.getTile(xe).getBucket(ne);ge&&(de&&ge.updateReplacement(xe,J.replacementSource,he),ge.uploadUpdatedIndexBuffer(J.context))}})(f,t,s,X,Y,m),(function(J,se,ne,he){for(const de of he){const pe=se.getTile(de).getBucket(ne);pe&&pe.needsEvaluation()&&pe.uploadUpdatedColorBuffer(J.context)}})(f,t,s,m),s.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const J=f.shadowRenderer,se=[],ne=J.getShadowPassDepthMode();Nh({painter:f,source:t,layer:s,coords:m,defines:se,blendMode:J.getShadowPassColorMode(),depthMode:ne,opacity:j,verticalScale:V,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let J=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];B&&(J=J.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&(J=J.concat("NORMAL_OFFSET"));const se=s.paint.get("building-facade-emissive-chance"),ne=s.paint.get("building-ambient-occlusion-intensity"),he=s.paint.get("building-flood-light-intensity"),de=s.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",pe=s.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(de?null:s.lut).toArray01().slice(0,3),xe=s.paint.get("building-flood-light-ground-attenuation"),ge=he>0,je=new Pi(f.context.gl.LEQUAL,Pi.ReadWrite,f.depthRangeFor3D);j<1&&Nh({painter:f,source:t,layer:s,coords:m,defines:J,blendMode:sn.disabled,depthMode:je,opacity:j,verticalScale:V,facadeEmissiveChance:se,facadeAOIntensity:ne,floodLightIntensity:he,floodLightColor:pe,depthOnly:!0});const Ae=f.colorModeForRenderPass();Nh({painter:f,source:t,layer:s,coords:m,defines:J,blendMode:Ae,depthMode:je,opacity:j,verticalScale:V,facadeEmissiveChance:se,facadeAOIntensity:ne,floodLightIntensity:he,floodLightColor:pe}),D&&Fh(f,t,s,m,!0,j,v,T,he,pe,E,Y),ge&&Fh(f,t,s,m,!1,j,v,T,he,pe,xe,Y)}else if(f.renderPass==="light-beam"){const J=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],se=new Pi(f.context.gl.LEQUAL,Pi.ReadOnly,f.depthRangeFor3D);Nh({painter:f,source:t,layer:s,coords:m,defines:J,blendMode:sn.alphaBlended,depthMode:se,opacity:j,verticalScale:V,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,t,s,m){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const v=f.context,T=f.terrain&&f.terrain.renderingToTexture,[E,j]=f.renderPass!=="translucent"||T?[{},m]:f.stencilConfigForOverlap(m);for(const D of j){const B=t.getTile(D);if(B.needsHillshadePrepare&&f.renderPass==="offscreen")Bt(f,B,s);else if(f.renderPass==="translucent"){const V=f.depthModeForSublayer(0,Pi.ReadOnly),Y=s.paint.get("hillshade-emissive-strength"),X=f.colorModeForDrapableLayerRenderPass(Y),J=T&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):E[D.overscaledZ];Le(f,D,B,s,V,J,X)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,t,s,m,v,T){if(f.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const E=f.transform.projection.name==="globe",j=s.paint.get("raster-elevation")!==0,D=j&&E;if(f.renderElevatedRasterBackface&&!D)return;const B=f.context,V=B.gl,Y=t.getSource(),X=(function(Ae,De,ze,Me,Ve){const it=De.paint.get("raster-color"),Ye=Ae.type==="raster-array",dt=[],mt=De.paint.get("raster-resampling"),Tt=De.paint.get("raster-color-mix");let Ot=De.paint.get("raster-color-range");const st=[Tt[0],Tt[1],Tt[2],0],Xe=Tt[3];let pt=mt==="nearest"?Me.NEAREST:Me.LINEAR;if(Ye&&(dt.push("RASTER_ARRAY"),it||dt.push("RASTER_COLOR"),mt==="linear"&&dt.push("RASTER_ARRAY_LINEAR"),pt=Me.NEAREST,!Ot&&Ae.rasterLayers)){const ht=Ae.rasterLayers.find((({id:Nt})=>Nt===De.sourceLayer));ht&&ht.fields&&ht.fields.range&&(Ot=ht.fields.range)}if(Ot=Ot||[0,1],it){dt.push("RASTER_COLOR"),ze.activeTexture.set(Me.TEXTURE2),De.updateColorRamp(Ot);let ht=De.colorRampTexture;ht||(ht=De.colorRampTexture=new i.T(ze,De.colorRamp,Me.RGBA8)),ht.bind(Me.LINEAR,Me.CLAMP_TO_EDGE)}return Ve&&dt.push("USE_MRT1"),{mix:st,range:Ot,offset:Xe,defines:dt,resampling:pt}})(Y,s,B,V,f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback");if(Y instanceof i.aU&&!m.length&&!E)return;const J=s.paint.get("raster-emissive-strength"),se=f.colorModeForDrapableLayerRenderPass(J),ne=f.terrain&&f.terrain.renderingToTexture,he=!f.options.moving,de=s.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;if(Y instanceof i.aU&&!m.length&&(Y.onNorthPole||Y.onSouthPole)){const Ae=j?f.stencilModeFor3D():Ki.disabled;return void Bh(!!Y.onNorthPole,null,f,t,s,J,X,en.disabled,Ae)}if(!m.length)return;const[pe,xe]=Y instanceof i.aU||ne?[{},m]:f.stencilConfigForOverlap(m),ge=xe[xe.length-1].overscaledZ;D&&X.defines.push("PROJECTION_GLOBE_VIEW"),j&&X.defines.push("RENDER_CUTOFF");const je=(Ae,De,ze)=>{for(const Me of Ae){const Ve=Me.toUnwrapped(),it=t.getTile(Me);if(ne&&(!it||!it.hasData()))continue;B.activeTexture.set(V.TEXTURE0);const Ye=cu(it,Y,s,X);if(!Ye||!Ye.texture)continue;const{texture:dt,mix:mt,offset:Tt,tileSize:Ot,buffer:st}=Ye;let Xe,pt;ne?(Xe=Pi.disabled,pt=Me.projMatrix):j?(Xe=new Pi(V.LEQUAL,Pi.ReadWrite,f.depthRangeFor3D),pt=E?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Ve,he)):(Xe=f.depthModeForSublayer(Me.overscaledZ-ge,s.paint.get("raster-opacity")===1?Pi.ReadWrite:Pi.ReadOnly,V.LESS),pt=f.transform.calculateProjMatrix(Ve,he));const ht=f.terrain&&ne?f.terrain.stencilModeForRTTOverlap(Me):pe[Me.overscaledZ],Nt=T?0:s.paint.get("raster-fade-duration");it.registerFadeDuration(Nt);const ti=t.findLoadedParent(Me,0),gi=Ih(it,ti,t,f.transform,Nt);let Wt,Dt;!gi.isFading&&it.refreshedUponExpiration&&(it.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),B.activeTexture.set(V.TEXTURE0),dt.bind(de,V.CLAMP_TO_EDGE),B.activeTexture.set(V.TEXTURE1),ti?(ti.texture&&ti.texture.bind(de,V.CLAMP_TO_EDGE),Wt=Math.pow(2,ti.tileID.overscaledZ-it.tileID.overscaledZ),Dt=[it.tileID.canonical.x*Wt%1,it.tileID.canonical.y*Wt%1]):dt.bind(de,V.CLAMP_TO_EDGE),"useMipmap"in dt&&B.extTextureFilterAnisotropic&&f.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const Ti=f.transform;let bi;const di=j?Qp(Ti):[0,0,0,0];let _i,Bi,dn,Pn,Jn,wi=0;if(D&&Y instanceof i.aU&&Y.coordinates.length>3)_i=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0)))),Bi=Float32Array.from(Ti.globeMatrix),dn=Float32Array.from(i.dF(Ti)),Pn=[i.aF(Ti.center.lng),i.aJ(Ti.center.lat)],bi=Y.elevatedGlobePerspectiveTransform,Jn=Y.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const _a=i.dG(Me.canonical);wi=i.dH(_a.getCenter().lat),_i=Float32Array.from(i.bk(i.dJ(Me.canonical))),Bi=Float32Array.from(Ti.globeMatrix),dn=Float32Array.from(i.dF(Ti)),Pn=[i.aF(Ti.center.lng),i.aJ(Ti.center.lat)],bi=[0,0],Jn=Float32Array.from(i.dI(Me.canonical,_a,wi,Ti.worldSize/Ti._pixelsPerMercatorPixel))}else bi=Y instanceof i.aU?Y.perspectiveTransform:[0,0],_i=new Float32Array(16),Bi=new Float32Array(9),dn=new Float32Array(16),Pn=[0,0],Jn=new Float32Array(9);const Qn=Ts(pt,_i,Bi,dn,Jn,Dt||[0,0],i.aj(f.transform.zoom),Pn,di,Wt||1,gi,s,bi,j?s.paint.get("raster-elevation"):0,2,mt,Tt,X.range,Ot,st,J),Wi=f.isTileAffectedByFog(Me),la=f.getOrCreateProgram("raster",{defines:X.defines,overrideFog:Wi});if(f.uploadCommonUniforms(B,la,Ve),Y instanceof i.aU){const _a=Y.elevatedGlobeVertexBuffer,ya=Y.elevatedGlobeIndexBuffer;if(ne||!E)Y.boundsBuffer&&Y.boundsSegments&&la.draw(f,V.TRIANGLES,Xe,Ki.disabled,se,en.disabled,Qn,s.id,Y.boundsBuffer,f.quadTriangleIndexBuffer,Y.boundsSegments);else if(_a&&ya){const Rn=Ti.zoom<=i.c_?Y.elevatedGlobeSegments:Y.getSegmentsForLongitude(Ti.center.lng);Rn&&la.draw(f,V.TRIANGLES,Xe,Ki.disabled,se,De,Qn,s.id,_a,ya,Rn)}}else if(D){Xe=new Pi(V.LEQUAL,Pi.ReadOnly,f.depthRangeFor3D);const _a=f.globeSharedBuffers;if(_a){const[ya,Rn,mn]=_a.getGridBuffers(wi,!1);la.draw(f,V.TRIANGLES,Xe,ze||ht,f.colorModeForRenderPass(),De,Qn,s.id,ya,Rn,mn)}}else{const{tileBoundsBuffer:_a,tileBoundsIndexBuffer:ya,tileBoundsSegments:Rn}=f.getTileBoundsBuffers(it);la.draw(f,V.TRIANGLES,Xe,ht,se,en.disabled,Qn,s.id,_a,ya,Rn)}}if(!(Y instanceof i.aU)&&D)for(const Me of Ae){const Ve=Me.canonical.y===(1<<Me.canonical.z)-1;Me.canonical.y===0&&Bh(!0,Me,f,t,s,J,X,De,ze||Ki.disabled),Ve&&Bh(!1,Me,f,t,s,J,X,De===en.frontCW?en.backCW:en.frontCW,ze||Ki.disabled)}};D?je(xe,f.renderElevatedRasterBackface?en.backCW:en.frontCW,f.stencilModeFor3D()):je(xe,en.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,t,s,m,v,T){f.renderPass==="offscreen"&&(function(E,j,D,B){if(!B.length)return;const V=E.context,Y=V.gl,X=j.getSource();if(!(X instanceof Jr))return;const J=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let se=D.particlePositionRGBAImage;if(!se||se.width!==J){const xe=(function(ge){const je=ge*ge,Ae=new Uint8Array(4*je),De=function(Me){return Me|=0,Me=Math.imul(2747636419^Me,2654435769),Me=Math.imul(Me^Me>>>16,2654435769),((Me=Math.imul(Me^Me>>>16,2654435769))>>>0)/4294967296},ze=1/1.1;for(let Me=0;Me<je;Me++){const Ve=ze*(De(2*Me+0)+nl),it=ze*(De(2*Me+1)+nl),Ye=255*Ve%1,dt=255*it%1,mt=Ye,Tt=it-dt/255,Ot=dt;Ae[4*Me+0]=255*(Ve-Ye/255),Ae[4*Me+1]=255*mt,Ae[4*Me+2]=255*Tt,Ae[4*Me+3]=255*Ot}return Ae})(J);se=D.particlePositionRGBAImage=new i.q({width:J,height:J},xe)}let ne=D.particleFramebuffer;ne?ne.width!==J&&(ne.destroy(),ne=D.particleFramebuffer=V.createFramebuffer(J,J,1,null)):ne=D.particleFramebuffer=V.createFramebuffer(J,J,1,null);const he=[];for(const xe of B){const ge=j.getTile(xe);if(!(ge instanceof ar))continue;const je=Hm(ge,X,D);if(!je)continue;const Ae=[ge.tileSize,ge.tileSize];let De=D.tileFramebuffer;De||(De=D.tileFramebuffer=V.createFramebuffer(Ae[0],Ae[1],1,null));let ze=ge.rasterParticleState;ze||(ze=ge.rasterParticleState=new Vm(V,xe,Ae,se));const Me=ze.update(D.lastInvalidatedAt);ze.particleTextureDimension!==J&&ze.updateParticleTexture(xe,se);const Ve=ze.targetColorTexture;ze.targetColorTexture=ze.backgroundColorTexture,ze.backgroundColorTexture=Ve;const it=ze.particleTexture0;ze.particleTexture0=ze.particleTexture1,ze.particleTexture1=it,he.push([xe,je,ze,Me])}if(he.length===0)return;const de=i.o.now(),pe=D.previousDrawTimestamp?.001*(de-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=de,D.hasColorMap()){V.activeTexture.set(Y.TEXTURE0+2);let xe=D.colorRampTexture;xe||(xe=D.colorRampTexture=new i.T(V,D.colorRamp,Y.RGBA8)),xe.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}V.bindFramebuffer.set(D.tileFramebuffer.framebuffer),(function(xe,ge,je){const Ae=xe.context,De=Ae.gl,ze=ge.tileFramebuffer;Ae.activeTexture.set(De.TEXTURE0);const Me={u_texture:0,u_opacity:1.05*(it=ge.paint.get("raster-particle-fade-opacity-factor"))/(it+.05)},Ve=xe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var it;for(const Ye of je){const[,,dt,mt]=Ye;ze.colorAttachment0.set(dt.targetColorTexture.texture),Ae.viewport.set([0,0,ze.width,ze.height]),Ae.clear({color:i.ao.transparent}),mt&&(dt.backgroundColorTexture.bind(De.NEAREST,De.CLAMP_TO_EDGE),Ve.draw(xe,De.TRIANGLES,Pi.disabled,Ki.disabled,sn.alphaBlended,en.disabled,Me,ge.id,xe.viewportBuffer,xe.quadTriangleIndexBuffer,xe.viewportSegments))}})(E,D,he),(function(xe,ge,je,Ae){const De=xe.context,ze=De.gl,Me=je.tileFramebuffer,Ve=xe.transform.projection.name==="globe",it=je.paint.get("raster-particle-max-speed");for(const Ye of Ae){const[dt,mt,Tt]=Ye;De.activeTexture.set(ze.TEXTURE0+0),mt.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Me.colorAttachment0.set(Tt.targetColorTexture.texture);const Ot=xe.getOrCreateProgram("rasterParticleDraw",{defines:mt.defines,overrideFog:!1});De.activeTexture.set(ze.TEXTURE0+1);const st=mt.scalarData?[]:[0,1,2,3].map((ht=>i.e9[ht](dt)));st.push(dt);const Xe=dt.canonical.x,pt=dt.canonical.y;for(const ht of st){const Nt=ge.getTile(Ve?ht.wrapped():ht);if(!Nt)continue;const ti=Nt.rasterParticleState;if(!ti)continue;const gi=ht.canonical.x+(1<<ht.canonical.z)*(ht.wrap-dt.wrap),Wt=ht.canonical.y;ti.particleTexture0.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const Dt=Om(1,ti.particleTexture0.size[0],[gi-Xe,Wt-pt],0,mt.texture.size,2,it,mt.textureOffset,mt.scale,mt.offset);Ot.draw(xe,ze.POINTS,Pi.disabled,Ki.disabled,sn.alphaBlended,en.disabled,Dt,je.id,ti.particleIndexBuffer,void 0,ti.particleSegment)}}})(E,j,D,he),V.bindFramebuffer.set(D.particleFramebuffer.framebuffer),(function(xe,ge,je,Ae){const De=xe.context,ze=De.gl,Me=ge.paint.get("raster-particle-max-speed"),Ve=Ae*ge.paint.get("raster-particle-speed-factor")*.15,it=(function(dt){return Math.pow(dt,6)})(.01+1*ge.paint.get("raster-particle-reset-rate-factor")),Ye=ge.particleFramebuffer;De.viewport.set([0,0,Ye.width,Ye.height]);for(const dt of je){const[,mt,Tt]=dt;De.activeTexture.set(ze.TEXTURE0+0),mt.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),De.activeTexture.set(ze.TEXTURE0+1);const Ot=Tt.particleTexture0;Ot.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const st=Oh(1,Ot.size[0],0,mt.texture.size,Me,Ve,it,mt.textureOffset,mt.scale,mt.offset);Ye.colorAttachment0.set(Tt.particleTexture1.texture),De.clear({color:i.ao.transparent}),xe.getOrCreateProgram("rasterParticleUpdate",{defines:mt.defines}).draw(xe,ze.TRIANGLES,Pi.disabled,Ki.disabled,sn.unblended,en.disabled,st,ge.id,xe.viewportBuffer,xe.quadTriangleIndexBuffer,xe.viewportSegments)}})(E,D,he,pe)})(f,t,s,m),f.renderPass==="translucent"&&((function(E,j,D,B,V){const Y=E.context,X=Y.gl,J=j.getSource().tileSize,se=5*(1-i.ah(i.cL,i.cL+1,E.transform.zoom))*J+D.paint.get("raster-particle-elevation"),ne=!E.options.moving,he=E.transform.projection.name==="globe";if(!B.length)return;const[de,pe]=E.stencilConfigForOverlap(B),xe=[];he&&xe.push("PROJECTION_GLOBE_VIEW");const ge=E.stencilModeFor3D();for(const je of pe){const Ae=je.toUnwrapped(),De=j.getTile(je);if(!De.rasterParticleState)continue;const ze=De.rasterParticleState,Me=100;De.registerFadeDuration(Me);const Ve=j.findLoadedParent(je,0),it=Ih(De,Ve,j,E.transform,Me);let Ye,dt;E.terrain&&E.terrain.prepareDrawTile(),Y.activeTexture.set(X.TEXTURE0),ze.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Y.activeTexture.set(X.TEXTURE1),Ve&&Ve.rasterParticleState?(Ve.rasterParticleState.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Ye=Math.pow(2,Ve.tileID.overscaledZ-De.tileID.overscaledZ),dt=[De.tileID.canonical.x*Ye%1,De.tileID.canonical.y*Ye%1]):ze.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const mt=he?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ae,ne),Tt=E.transform,Ot=eh(Tt),st=i.dG(je.canonical),Xe=i.dH(st.getCenter().lat);let pt,ht,Nt,ti,gi;he?(pt=Float32Array.from(i.bk(i.dJ(je.canonical))),ht=Float32Array.from(Tt.globeMatrix),Nt=Float32Array.from(i.dF(Tt)),ti=[i.aF(Tt.center.lng),i.aJ(Tt.center.lat)],gi=Float32Array.from(i.dI(je.canonical,st,Xe,Tt.worldSize/Tt._pixelsPerMercatorPixel))):(pt=new Float32Array(16),ht=new Float32Array(9),Nt=new Float32Array(16),ti=[0,0],gi=new Float32Array(9));const Wt=Kd(mt,pt,ht,Nt,gi,dt||[0,0],i.aj(E.transform.zoom),ti,Ot,Ye||1,it,se),Dt=E.isTileAffectedByFog(je),Ti=E.getOrCreateProgram("rasterParticle",{defines:xe,overrideFog:Dt});if(E.uploadCommonUniforms(Y,Ti,Ae),he){const bi=new Pi(X.LEQUAL,Pi.ReadOnly,E.depthRangeFor3D),di=0,_i=E.globeSharedBuffers;if(_i){const[Bi,dn,Pn]=_i.getGridBuffers(Xe,di!==0);Ti.draw(E,X.TRIANGLES,bi,ge,sn.alphaBlended,E.renderElevatedRasterBackface?en.frontCCW:en.backCCW,Wt,D.id,Bi,dn,Pn)}}else{const bi=E.depthModeForSublayer(0,Pi.ReadOnly),di=de[je.overscaledZ],{tileBoundsBuffer:_i,tileBoundsIndexBuffer:Bi,tileBoundsSegments:dn}=E.getTileBoundsBuffers(De);Ti.draw(E,X.TRIANGLES,bi,di,sn.alphaBlended,en.disabled,Wt,D.id,_i,Bi,dn)}}E.resetStencilClippingMasks()})(f,t,s,m),f.style.map.triggerRepaint())},background:function(f,t,s,m){const v=s.paint.get("background-color"),T=s.paint.get("background-color-use-theme").constantOr("default")==="none",E=s.paint.get("background-opacity"),j=s.paint.get("background-emissive-strength"),D=s.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const B=f.context,V=B.gl,Y=f.transform,X=Y.tileSize,J=s.paint.get("background-pattern");let se;if(J!==void 0&&(J===null||(se=f.imageManager.getPattern(i.I.from(J.toString()),s.scope,f.style.getLut(s.scope)),!se)))return;const ne=!J&&v.a===1&&E===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==ne)return;const he=Ki.disabled,de=f.depthModeForSublayer(0,ne==="opaque"?Pi.ReadWrite:Pi.ReadOnly),pe=f.colorModeForDrapableLayerRenderPass(j),xe=J?"backgroundPattern":"background";let ge,je=m;je||(ge=f.getBackgroundTiles(),je=Object.values(ge).map((De=>De.tileID))),J&&(B.activeTexture.set(V.TEXTURE0),f.imageManager.bind(f.context,s.scope));const Ae=[];if(f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&Ae.push("USE_MRT1"),D){const De=f.getOrCreateProgram(xe,{overrideFog:!1,overrideRtt:!0,defines:Ae}),ze=new Float32Array(i.bA([])),Me=new i.aQ(0,0,0,0,0),Ve=J?su(ze,j,E,f,0,s.scope,se,D,{tileID:Me,tileSize:X}):Gr(ze,j,E,v.toPremultipliedRenderColor(T?null:s.lut));De.draw(f,V.TRIANGLES,de,he,pe,en.disabled,Ve,s.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const De of je){const ze=f.isTileAffectedByFog(De),Me=f.getOrCreateProgram(xe,{overrideFog:ze,defines:Ae}),Ve=De.toUnwrapped(),it=m?De.projMatrix:f.transform.calculateProjMatrix(Ve);f.prepareDrawTile();const Ye=t?t.getTile(De):ge?ge[De.key]:new Zs(De,X,Y.zoom,f),dt=J?su(it,j,E,f,0,s.scope,se,D,{tileID:De,tileSize:X}):Gr(it,j,E,v.toPremultipliedRenderColor(T?null:s.lut));f.uploadCommonUniforms(B,Me,Ve);const{tileBoundsBuffer:mt,tileBoundsIndexBuffer:Tt,tileBoundsSegments:Ot}=f.getTileBoundsBuffers(Ye);Me.draw(f,V.TRIANGLES,de,he,pe,en.disabled,dt,s.id,mt,Tt,Ot)}},sky:function(f,t,s){const m=f._atmosphere?i.aj(f.transform.zoom):1,v=s.paint.get("sky-opacity")*m;if(v===0)return;const T=f.context,E=s.paint.get("sky-type"),j=new Pi(T.gl.LEQUAL,Pi.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;E==="atmosphere"?f.renderPass==="offscreen"?s.needsSkyboxCapture(f)&&((function(B,V,Y,X){const J=B.context,se=J.gl;let ne=V.skyboxFbo;if(!ne){ne=V.skyboxFbo=J.createFramebuffer(32,32,1,null),V.skyboxGeometry=new Uh(J),V.skyboxTexture=J.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,V.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let xe=0;xe<6;++xe)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(ne.framebuffer),J.viewport.set([0,0,32,32]);const he=V.getCenter(B,!0),de=B.getOrCreateProgram("skyboxCapture"),pe=new Float64Array(16);i.bA(pe),i.en(pe,pe,.5*-Math.PI),wd(B,V,de,pe,he,0),i.bA(pe),i.en(pe,pe,.5*Math.PI),wd(B,V,de,pe,he,1),i.bA(pe),i.cU(pe,pe,.5*-Math.PI),wd(B,V,de,pe,he,2),i.bA(pe),i.cU(pe,pe,.5*Math.PI),wd(B,V,de,pe,he,3),i.bA(pe),wd(B,V,de,pe,he,4),i.bA(pe),i.en(pe,pe,Math.PI),wd(B,V,de,pe,he,5),J.viewport.set([0,0,B.width,B.height])})(f,s),s.markSkyboxValid(f)):f.renderPass==="sky"&&(function(B,V,Y,X,J){const se=B.context,ne=se.gl,he=B.transform,de=B.getOrCreateProgram("skybox");se.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_CUBE_MAP,V.skyboxTexture);const pe=((xe,ge,je,Ae,De)=>({u_matrix:xe,u_sun_direction:ge,u_cubemap:0,u_opacity:Ae,u_temporal_offset:De}))(he.skyboxMatrix,V.getCenter(B,!1),0,X,J);B.uploadCommonUniforms(se,de),de.draw(B,ne.TRIANGLES,Y,Ki.disabled,B.colorModeForRenderPass(),en.backCW,pe,"skybox",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)})(f,s,j,v,D):E==="gradient"&&f.renderPass==="sky"&&(function(B,V,Y,X,J){const se=B.context,ne=se.gl,he=B.transform,de=B.getOrCreateProgram("skyboxGradient");V.skyboxGeometry||(V.skyboxGeometry=new Uh(se)),se.activeTexture.set(ne.TEXTURE0);let pe=V.colorRampTexture;pe||(pe=V.colorRampTexture=new i.T(se,V.colorRamp,ne.RGBA8)),pe.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const xe=((ge,je,Ae,De,ze)=>({u_matrix:ge,u_color_ramp:0,u_center_direction:je,u_radius:i.an(Ae),u_opacity:De,u_temporal_offset:ze}))(he.skyboxMatrix,V.getCenter(B,!1),V.paint.get("sky-gradient-radius"),X,J);B.uploadCommonUniforms(se,de),de.draw(B,ne.TRIANGLES,Y,Ki.disabled,B.colorModeForRenderPass(),en.backCW,xe,"skyboxGradient",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)})(f,s,j,v,D)},custom:function(f,t,s,m){const v=f.context,T=s.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&s.isDraped(t)){if(f.renderPass==="offscreen"){const E=T.prerender;if(E){if(f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const j=f.transform.pointMerc;E.call(T,v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.aj(f.transform.zoom),[j.x,j.y],f.transform.pixelsPerMeterRatio)}else E.call(T,v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const j=T.renderToTile;if(j){const D=m[0].canonical,B={x:D.x+m[0].wrap*(T.wrapTileId?0:1<<D.z),y:D.y,z:D.z};v.setDepthMode(Pi.disabled),v.setStencilMode(Ki.disabled),v.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),j.call(T,v.gl,B),v.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),v.setStencilMode(Ki.disabled);const E=T.renderingMode==="3d"?new Pi(f.context.gl.LEQUAL,Pi.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Pi.ReadOnly);if(v.setDepthMode(E),f.transform.projection.name==="globe"){const j=f.transform.pointMerc;T.render(v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.aj(f.transform.zoom),[j.x,j.y],f.transform.pixelsPerMeterRatio)}else T.render(v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState(),v.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,t,s,m){if(f.renderPass==="opaque")return;const v=s.paint.get("model-opacity").constantOr(1),T=s.paint.get("model-elevation-reference"),E=T==="ground",j=T==="ground";if(v===0)return;const D=s.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!D||f.terrain&&v<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const B=f.shadowRenderer,V=s.paint.get("model-receive-shadows");B&&(B.useNormalOffset=!0,V||(B.enabled=!1));const Y=()=>{B&&(B.useNormalOffset=!0,V||(B.enabled=!0))},X=t.getSource();if(f.renderPass==="light-beam"&&X.type!=="batched-model")return;if(X.type==="vector"||X.type==="geojson")return(function(ge,je,Ae,De,ze){const Me=ge.transform,Ve=Me.projection.name==="globe",it=Me.getFreeCameraOptions().position;if(!ge.modelManager)return;const Ye=ge.modelManager;Ae.modelManager=Ye;const dt=ge.shadowRenderer;if(!Ae._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const mt=Ae._unevaluatedLayout._values["model-id"],Tt=Object.assign({},Ae.layout.get("model-id").parameters),Ot=ge.style.order.indexOf(Ae.fqid),st=Ae.paint.get("model-opacity").constantOr(1);for(const Xe of De){const pt=je.getTile(Xe).getBucket(Ae);if(!pt||pt.projection.name!==Me.projection.name)continue;const ht=pt.getModelUris();if(ht&&!pt.modelsRequested&&(Ye.addModelsFromBucket(ht,ze),pt.modelsRequested=!0),Ve)Tt.zoom=Xe.overscaledZ;else{const di=ko(Xe,Me);Tt.zoom=di}const Nt=mt.possiblyEvaluate(Tt);if(rg(ge,pt,Xe),Vl.shadowUniformsInitialized=!1,Vl.useSingleShadowCascade=!!dt&&dt.getMaxCascadeForTile(Xe.toUnwrapped())===0,ge.renderPass==="shadow"&&dt){if(ge.currentShadowCascade===1&&pt.isInsideFirstShadowMapFrustum)continue;const di=Me.calculatePosMatrix(Xe.toUnwrapped(),Me.worldSize);if(Vl.tileMatrix.set(di),Vl.shadowTileMatrix=Float32Array.from(dt.calculateShadowPassMatrixFromMatrix(di)),Vl.aabb.min=[0,0,0],Vl.aabb.max[0]=Vl.aabb.max[1]=i.al,Vl.aabb.max[2]=0,Hh(pt,Vl,ge,Ae.scope))continue}const ti=1<<Xe.canonical.z,gi=[((it.x-Xe.wrap)*ti-Xe.canonical.x)*i.al,(it.y*ti-Xe.canonical.y)*i.al,it.z*ti*i.al];ge.conflationActive&&Object.keys(pt.instancesPerModel).length>0&&ge.style.isLayerClipped(Ae,je.getSource())&&pt.updateReplacement(Xe,ge.replacementSource,Ot,Ae.scope)&&(pt.uploaded=!1,pt.upload(ge.context));let Wt=0;const Dt=new Array,Ti=new Array,bi=new Array;for(let di in pt.instancesPerModel){const _i=pt.instancesPerModel[di];_i.features.length>0&&!Ve&&(di=Nt.evaluate(_i.features[0].feature,{}));const Bi=Ye.getModel(di,ze);if(Bi||Ye.hasURLBeenRequested(di)||pt.modelUris.includes(di)||(pt.modelUris.push(di),pt.modelsRequested=!1),Bi&&Bi.uploaded)if(Ve){const dn=i.c5([],[it.x,it.y,it.z],ge.transform.worldSize);i.ew(dn,dn);for(let Pn=0;Pn<_i.instancedDataArray.length;++Pn){const Jn=[0,0,0],wi=[1,1,1],Qn=i.ex(),Wi=_i.tileCoordinatesForInstance(Pn),la=_i.transformForInstance(Pn);i.ey(wi,la),i.ez(Qn,la),i.eA(Jn,Qn);const _a=_i.translationForInstance(Pn),ya=new i.aT(0,0);i.eB(pt.canonical,ya,Wi.x,Wi.y);const Rn=i.bC();i.eC(Rn,Bi,ge.transform,ya,Jn,wi,_a,!0,!1,!1);const mn=_i.colorForInstance(Pn),ta=i.bA([]),Va=i.ef(ya.lat,ge.transform.zoom),Za=i.bq([],[1,1,1/Va]);i.br(ta,ta,dn),bi.push({zScaleMatrix:Za,negCameraPosMatrix:ta});for(const ca of Bi.nodes)Sd(ge,ca,Rn,ge.transform.expandedFarZProjMatrix,Wt,Dt,Ti,Bi.materialOverrides,st,mn);++Wt}}else for(const dn of Bi.nodes)sg(ge,Ae,dn,_i,gi,Xe,Vl)}if(Ve)if(ge.renderPass==="shadow"){for(const di of Ti)sl(di.mesh,di.nodeModelMatrix,ge,Ae);for(const di of Dt)sl(di.mesh,di.nodeModelMatrix,ge,Ae)}else ag(ge,Ae,Dt,Ti,bi)}})(f,t,s,m,Gf(f,s)),void Y();if(!X.loaded())return;if(X.type==="batched-model")return(function(ge,je,Ae,De){Ae.resetLayerRenderingStats(ge);const ze=ge.context,Me=ge.transform,Ve=ge.style.fog,it=ge.shadowRenderer;if(Me.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Me.projection.name} projection is not yet implemented`);const Ye=ge.transform.getFreeCameraOptions().position,dt=i.c5([],[Ye.x,Ye.y,Ye.z],ge.transform.worldSize),mt=i.ew([],dt),Tt=i.bA([]),Ot=i.ef(Me.center.lat,Me.zoom),st=i.bq([],[1,1,1/Ot]);i.br(Tt,Tt,mt);const Xe=Ae.paint.get("model-opacity").constantOr(1),pt=new Pi(ze.gl.LEQUAL,Pi.ReadWrite,ge.depthRangeFor3D),ht=new Pi(ze.gl.LEQUAL,Pi.ReadOnly,ge.depthRangeFor3D),Nt=new i.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ti=ge.renderPass==="shadow",gi=ti&&it?it.getCurrentCascadeFrustum():Me.getFrustum(Me.scaleZoom(Me.worldSize)),Wt=Ae.paint.get("model-front-cutoff"),Dt=Wt[2]<1,Ti=_l(ge,Ae.paint.get("model-cutoff-fade-range")),bi=Ae.getLayerRenderingStats();(function(di,_i,Bi,dn){const Pn=di.terrain?di.terrain.exaggeration():0,Jn=di.transform.zoom;for(const wi of dn){const Qn=_i.getTile(wi).getBucket(Bi);Qn&&(Qn.setFilter(Bi.filter),di.conflationActive&&Qn.updateReplacement(wi,di.replacementSource),Qn.evaluateTransform(di,Bi),di.terrain&&Pn>0&&Qn.elevationUpdate(di.terrain,Pn,wi,Bi.source),Qn.needsReEvaluation(di,Jn,Bi)&&Qn.evaluate(Bi))}})(ge,je,Ae,De),(function(){let di,_i,Bi;Dt?(di=De.length-1,_i=-1,Bi=-1):(di=0,_i=De.length,Bi=1);const dn=new Float64Array(16),Pn=i.cA(),Jn=new i.P(0,0);for(let wi=di;wi!==_i;wi+=Bi){const Qn=De[wi],Wi=je.getTile(Qn).getBucket(Ae);if(!Wi||!Wi.uploaded)continue;let la=!1;it&&(la=it.getMaxCascadeForTile(Qn.toUnwrapped())===0);const _a=Me.calculatePosMatrix(Qn.toUnwrapped(),Me.worldSize),ya=Wi.modelTraits;!ti&&Dt&&(i.bl(dn,_a),i.af(Pn,dt,dn),Jn.x=Pn[0],Jn.y=Pn[1]);const Rn=[];Wi.setFilter(Ae.filter);for(const mn of Wi.getNodesInfo()){if(mn.hiddenByReplacement||!mn.node.meshes)continue;const ta=mn.node;let Va=0;ge.terrain&&ta.elevation&&(Va=ta.elevation*ge.terrain.exaggeration());const Za=(()=>{const ks=mn.aabb;return Nt.min=[...ks.min],Nt.max=[...ks.max],Nt.min[2]+=Va,Nt.max[2]+=Va,i.af(Nt.min,Nt.min,_a),i.af(Nt.max,Nt.max,_a),Nt})(),ca=mn.evaluatedScale;if(ca[0]<=1&&ca[1]<=1&&ca[2]<=1&&Za.intersects(gi)===0)continue;if(!ti&&Dt){const ks=.16666666666666666;mn.cameraCollisionOpacity=dt[0]>Za.min[0]&&dt[0]<Za.max[0]&&dt[1]>Za.min[1]&&dt[1]<Za.max[1]&&dt[2]*Ot<Za.max[2]&&ta.footprint&&i.c0(Jn,ta.footprint)?Math.max(mn.cameraCollisionOpacity-ks,0):Math.min(1,mn.cameraCollisionOpacity+ks)}const Wn=[..._a],gn=1/i.d7(Qn.canonical),Oa=ta.anchor?ta.anchor[0]:0,Tr=ta.anchor?ta.anchor[1]:0;i.br(Wn,Wn,[Oa*(ca[0]-1)+mn.evaluatedTranslation[0]*gn,Tr*(ca[1]-1)+mn.evaluatedTranslation[1]*gn,Va+mn.evaluatedTranslation[2]]),i.cq(ca,i.eE)||i.cS(Wn,Wn,ca);const lr=i.aB([],Wn,ta.globalMatrix),Ma=i.aB([],Me.expandedFarZProjMatrix,lr),Ao=i.aB([],Me.expandedFarZProjMatrix,Wn),Ns=i.aC([],[Oa,Tr,Va,1],Ma)[2];ta.hidden=!1;let Er=Xe;ti||(Dt&&(Er*=mn.cameraCollisionOpacity,Er*=Mn(Wn,Me,mn.aabb,Wt)),Er*=La(Ti,Ns)),Er!==0?Rn.push({nodeInfo:mn,depth:Ns,opacity:Er,wvpForNode:Ma,wvpForTile:Ao,nodeModelMatrix:lr,tileModelMatrix:Wn}):ta.hidden=!0}ti||Rn.sort(((mn,ta)=>!Dt||mn.opacity===1&&ta.opacity===1?mn.depth<ta.depth?-1:1:mn.opacity===1?-1:ta.opacity===1?1:mn.depth>ta.depth?-1:1));for(const mn of Rn){const ta=mn.nodeInfo,Va=ta.node;let Za=i.aB([],st,mn.tileModelMatrix);i.aB(Za,Tt,Za);const ca=i.bl([],Za);i.eg(ca,ca),i.cS(ca,ca,Wf),Za=i.aB(Za,Za,Va.globalMatrix);const Wn=ge.renderPass==="light-beam",gn=Ae.paint.get("model-color-use-theme").constantOr("default")==="none",Oa=ya&i.eI.HasMapboxMeshFeatures,Tr=Oa?0:ta.evaluatedRMEA[0][2];for(let lr=0;lr<Va.meshes.length;++lr){const Ma=Va.meshes[lr],Ao=lr===Va.lightMeshIndex;let Ns=mn.wvpForNode;if(Ao){if(!Wn&&!ge.terrain&&ge.shadowRenderer){ge.currentLayer<ge.firstLightBeamLayer&&(ge.firstLightBeamLayer=ge.currentLayer);continue}Ns=mn.wvpForTile}else if(Wn)continue;const Er={defines:[]},ks=[];if(!ti&&it&&(it.useNormalOffset=!!Ma.normalBuffer),Hf(Er.defines,ks,Ma,ge,gn?null:Ae.lut),Oa||Er.defines.push("DIFFUSE_SHADED"),la&&Er.defines.push("SHADOWS_SINGLE_CASCADE"),bi&&(ti?bi.numRenderedVerticesInShadowPass+=Ma.vertexArray.length:bi.numRenderedVerticesInTransparentPass+=Ma.vertexArray.length),ti){sl(Ma,mn.nodeModelMatrix,ge,Ae);continue}let to=null;if(Ve){const gr=Vf(mn.nodeModelMatrix,ge.transform);if(to=new Float32Array(gr),Me.projection.name!=="globe"){const Ea=Ma.aabb.min,Mr=Ma.aabb.max,[Dn,ir]=Ve.getOpacityForBounds(gr,Ea[0],Ea[1],Mr[0],Mr[1]);Er.overrideFog=Dn>=St||ir>=St}}const Es=Ma.material;let Al;Es.occlusionTexture&&Es.occlusionTexture.offsetScale&&(Al=Es.occlusionTexture.offsetScale,Er.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Zl=ge.getOrCreateProgram("model",Er);!ti&&it&&it.setupShadowsFromMatrix(mn.tileModelMatrix,Zl,it.useNormalOffset),ge.uploadCommonUniforms(ze,Zl,null,to);const $o=Es.pbrMetallicRoughness;$o.metallicFactor=.9,$o.roughnessFactor=.5;const dr=yd(new Float32Array(Ns),new Float32Array(Za),new Float32Array(ca),new Float32Array(Va.globalMatrix),ge,mn.opacity,$o.baseColorFactor,Es.emissiveFactor,$o.metallicFactor,$o.roughnessFactor,Es,Tr,Ae,[0,0,0],Al);!Ao&&(ta.hasTranslucentParts||mn.opacity<1)&&Zl.draw(ge,ze.gl.TRIANGLES,pt,Ki.disabled,sn.disabled,en.backCCW,dr,Ae.id,Ma.vertexBuffer,Ma.indexBuffer,Ma.segments,Ae.paint,ge.transform.zoom,void 0,ks),Zl.draw(ge,ze.gl.TRIANGLES,Ao?ht:pt,Ki.disabled,Ao||mn.opacity<1||ta.hasTranslucentParts?sn.alphaBlended:sn.unblended,en.backCCW,dr,Ae.id,Ma.vertexBuffer,Ma.indexBuffer,Ma.segments,Ae.paint,ge.transform.zoom,void 0,ks)}}}})()})(f,t,s,m),void Y();if(X.type!=="model")return;const J=X.getModels(),se=[],ne=f.transform.getFreeCameraOptions().position,he=i.c5([],[ne.x,ne.y,ne.z],f.transform.worldSize);i.ew(he,he);const de=[],pe=[];let xe=0;for(const ge of J){const je=t.getFeatureState("",ge.id),Ae={type:"Unknown",id:ge.id,properties:ge.featureProperties},De=s.paint.get("model-rotation").evaluate(Ae,je),ze=s.paint.get("model-scale").evaluate(Ae,je),Me=s.paint.get("model-translation").evaluate(Ae,je),Ve=s.paint.get("model-opacity").evaluate(Ae,je);Wm(s,ge.id,je,ge.featureProperties,ge.nodeOverrideNames,ge.nodeOverrides),qf(s,ge.id,je,ge.featureProperties,ge.materialOverrideNames,ge.materialOverrides),ge.nodeOverrides.size>0&&ge.computeBoundsAndApplyParent(),ge.computeModelMatrix(f,De,ze,Me,j,E,!1);const it=i.bA([]),Ye=i.ef(ge.position.lat,f.transform.zoom),dt=i.bq([],[1,1,1/Ye]);i.br(it,it,he),se.push({zScaleMatrix:dt,negCameraPosMatrix:it});for(const mt of ge.nodes)Sd(f,mt,ge.matrix,f.transform.expandedFarZProjMatrix,xe,de,pe,ge.materialOverrides,Ve);xe++}if(de.sort(((ge,je)=>je.depth-ge.depth)),f.renderPass!=="shadow")ag(f,s,de,pe,se),Y();else{for(const ge of pe)sl(ge.mesh,ge.nodeModelMatrix,f,s);for(const ge of de)sl(ge.mesh,ge.nodeModelMatrix,f,s);Y()}}},Xf={line:function(f,t,s){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const m=t.getVisibleCoordinates();for(const v of m){const T=t.getTile(v).getBucket(f);if(T&&(T.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,t,s){const m=t.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,Gf(s,f)));if(m.type==="batched-model"||m.type!=="model")return;const v=m.getModels();for(const T of v)T.upload(s.context)},raster:function(f,t,s){const m=t.getSource();if(!(m instanceof Jr&&m.loaded()))return;const v=f.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const T=f.paint.get("raster-array-band")||m.getInitialBand(v);if(T==null)return;const E=t.getIds().map((j=>t.getTileByID(j)));for(const j of E)j.updateNeeded(f.id,T)&&m.prepareTile(j,v,f.id,T)},"raster-particle":function(f,t,s){const m=t.getSource();if(!(m instanceof Jr&&m.loaded()))return;const v=f.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const T=f.paint.get("raster-particle-array-band")||m.getInitialBand(v);if(T==null)return;const E=t.getIds().map((j=>t.getTileByID(j)));for(const j of E)j.updateNeeded(f.id,T)&&m.prepareTile(j,v,f.id,T)}},Tl={fill:Lf},du={fill:function(f,t,s,m){if(!s.layout||s.layout.get("fill-elevation-reference")==="none"||s.paint.get("fill-opacity").constantOr(1)===0)return;const v=f.context.gl,T=new Pi(v.LEQUAL,Pi.ReadOnly,f.depthRangeFor3D),E=new Ki({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),j=f.transform.getFreeCameraOptions().position,D=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const B of m){const V=t.getTile(B),Y=V.getBucket(s);if(!Y)continue;const X=Y.elevatedStructures;if(!X||X.depthSegments.segments[0].primitiveLength===0)continue;const J=Yp(B.toUnwrapped(),j),se=f.translatePosMatrix(B.projMatrix,V,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),ne=gd(se,J,0,1,0);D.draw(f,v.TRIANGLES,T,E,sn.disabled,en.disabled,ne,s.id,X.vertexBuffer,X.indexBuffer,X.depthSegments,s.paint,f.transform.zoom)}}};class nh{constructor(t,s,m,v,T){this.context=new qr(t,s),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const D of E)this._debugParams.enabledLayers[D]=!0;for(const D of E);this.occlusionParams=new th,this.setup(),this.numSublayers=ds.maxUnderzooming+ds.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new yl(this),this._wireframeDebugCache=new Mc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const j=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,j,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v,this.worldview=T,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,s){const m=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Cf(this,t));const v=this._terrain;this.transform.elevation=m?v:null,v.update(t,this.transform,s),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=s.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const T=m+.78*(v-m);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Cf(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*i.o.devicePixelRatio,this.height=s*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const t=this.context,s=new i.bd;s.emplaceBack(0,0),s.emplaceBack(i.al,0),s.emplaceBack(0,i.al),s.emplaceBack(i.al,i.al),this.tileExtentBuffer=t.createVertexBuffer(s,i.bf.members),this.tileExtentSegments=i.bg.simpleSegment(0,0,4,2);const m=new i.bd;m.emplaceBack(0,0),m.emplaceBack(i.al,0),m.emplaceBack(0,i.al),m.emplaceBack(i.al,i.al),this.debugBuffer=t.createVertexBuffer(m,i.bf.members),this.debugSegments=i.bg.simpleSegment(0,0,4,5);const v=new i.bd;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,i.bf.members),this.viewportSegments=i.bg.simpleSegment(0,0,4,2);const T=new i.b1;T.emplaceBack(0,0,0,0),T.emplaceBack(i.al,0,i.al,0),T.emplaceBack(0,i.al,0,i.al),T.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=t.createVertexBuffer(T,i.bi.members),this.mercatorBoundsSegments=i.bg.simpleSegment(0,0,4,2);const E=new i.b0;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const j=new i.be;for(const B of[0,1,3,2,0])j.emplaceBack(B);this.debugIndexBuffer=t.createIndexBuffer(j),this.emptyTexture=new i.T(t,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=i.bC();const D=this.context.gl;this.stencilClearMode=new Ki({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Pi.disabled,this.stencilClearMode,sn.disabled,en.disabled,fd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,m){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let j=!1;for(const D of m)if(this._tileClippingMaskIDs[D.key]===void 0){j=!0;break}if(!j)return}this.currentStencilSource=s.id;const v=this.context,T=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(sn.disabled),v.setDepthMode(Pi.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const j of m){const D=s.getTile(j),B=this._tileClippingMaskIDs[j.key]=this.nextStencilID++,{tileBoundsBuffer:V,tileBoundsIndexBuffer:Y,tileBoundsSegments:X}=this.getTileBoundsBuffers(D);E.draw(this,T.TRIANGLES,Pi.disabled,new Ki({func:T.ALWAYS,mask:0},B,255,T.KEEP,T.KEEP,T.REPLACE),sn.disabled,en.disabled,fd(j.projMatrix),"$clipping",V,Y,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Ki({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new Ki({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,m=t.sort(((E,j)=>j.overscaledZ-E.overscaledZ)),v=m[m.length-1].overscaledZ,T=m[0].overscaledZ-v+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const E={};for(let j=0;j<T;j++)E[j+v]=new Ki({func:s.GEQUAL,mask:255},j+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=T,[E,m]}return[{[v]:Ki.disabled},m]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new sn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?sn.unblended:sn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new sn([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new sn([s.ONE,s.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,s.ONE_MINUS_SRC_ALPHA],i.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,s,m,v=!1){if(this.depthOcclusion)return new Pi(this.context.gl.GREATER,Pi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return Pi.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Pi(m||this.context.gl.LEQUAL,s,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),m=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),T=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&m!==0&&(this.depthFBO=new al(this.context,s,m,0,"texture"),this.depthTexture=new i.T(this.context,{width:s,height:m,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),t.bindTexture(t.TEXTURE_2D,T),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,m,0,0,s,m,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,s)=>t+s/this._fpsHistory.length),0))}render(t,s){const m=i.o.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const v=this.style._mergedLayers,T=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(T).filter((st=>{const Xe=v[st];return!(Xe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Xe.type]}));let j=E(),D=!1,B=!1,V=null,Y=0,X=!1;for(const st of j){const Xe=v[st];Xe.visibility!=="none"&&(Xe.type==="circle"?D=!0:Xe.type==="building"?(V=Xe,++Y):Xe.type==="symbol"&&(Xe.hasOcclusionOpacityProperties?B=!0:D=!0))}this.updateEmissiveMode();let J=j.map((st=>v[st]));const se=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();for(const st in se){const Xe=se[st];Xe.used&&(Xe.prepare(this.context),Xe.getSource().usedInConflation&&++Y)}let ne=!1;for(const st of J)st.isHidden(this.transform.zoom)||(st.type==="clip"&&(ne=!0),this.prepareLayer(st));const he={},de={},pe={},xe={},ge={};for(const st in se){const Xe=se[st];he[st]=Xe.getVisibleCoordinates(),de[st]=he[st].slice().reverse(),pe[st]=Xe.getVisibleCoordinates(!0).reverse(),xe[st]=Xe.getShadowCasterCoordinates(),ge[st]=Xe.sortCoordinatesByDistance(he[st])}const je=st=>{const Xe=this.style.getLayerSourceCache(st);return Xe&&Xe.used?Xe.getSource():null};if(Y||ne||this._clippingActiveLastFrame){const st=[],Xe=[];let pt=0;for(const ht of J)this.isSourceForClippingOrConflation(ht,je(ht))&&(st.push(ht),Xe.push(pt)),pt++;if(st&&(ne||st.length>1)||this._clippingActiveLastFrame){ne=!1;const ht=[];for(let Nt=0;Nt<st.length;Nt++){const ti=st[Nt],gi=Xe[Nt],Wt=this.style.getLayerSourceCache(ti);if(!Wt||!Wt.used||!Wt.getSource().usedInConflation&&ti.type!=="clip"&&ti.type!=="building")continue;let Dt=i.eQ,Ti=i.b_.None;const bi=[];let di=!0;if(ti.type==="building")Dt=i.eS;else if(ti.type==="clip"){Dt=gi;for(const _i of ti.layout.get("clip-layer-types"))Ti|=_i==="model"?i.b_.Model:_i==="symbol"?i.b_.Symbol:i.b_.FillExtrusion;for(const _i of ti.layout.get("clip-layer-scope"))bi.push(_i);ti.isHidden(this.transform.zoom)?di=!1:ne=!0}di&&ht.push({layer:ti.fqid,cache:Wt,order:Dt,clipMask:Ti,clipScope:bi})}this.replacementSource.setSources(ht),X=!0}}this._clippingActiveLastFrame=ne,X||this.replacementSource.clear(),this.conflationActive=X,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let st=0;st<J.length;st++){const Xe=J[st];if(Xe.visibility==="none")continue;const pt=Xe.cutoffRange();if(this.longestCutoffRange=Math.max(pt,this.longestCutoffRange),pt>0){const ht=je(Xe);ht&&(this.minCutoffZoom=Math.max(ht.minzoom,this.minCutoffZoom)),Xe.minzoom&&(this.minCutoffZoom=Math.max(Xe.minzoom,this.minCutoffZoom))}Xe.is3D(T)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=st),this._lastOcclusionLayer=st)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pe),this.opaquePassCutoff=0,j=E(),J=j.map((st=>v[st])));const De=this._shadowRenderer;if(De){De.updateShadowParameters(this.transform,this.style.directionalLight);for(const st in se)for(const Xe of he[st]){let pt={min:0,max:0};this.terrain&&(pt=this.terrain.getMinMaxForTile(Xe)||pt),De.addShadowReceiver(Xe.toUnwrapped(),pt.min,pt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ng(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ze=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ze&&!this._snow&&(this._snow=new Zf(this)),!ze&&this._snow&&(this._snow.destroy(),delete this._snow),Me&&!this._rain&&(this._rain=new ps(this)),!Me&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),V){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Vh);const st=this.style.getLayerSourceCache(V);this.buildingTileBorderManager.updateBorders(st,V)}if(!ln.has(this.context.gl))return;this.renderPass="offscreen";for(const st of J){const Xe=t.getLayerSourceCache(st);if(!st.hasOffscreenPass()||st.isHidden(this.transform.zoom))continue;const pt=Xe?de[Xe.id]:void 0;(st.type==="custom"||st.type==="raster"||st.type==="raster-particle"||st.isSky()||pt&&pt.length)&&this.renderLayer(this,Xe,st,pt)}this.depthRangeFor3D=[0,1-(J.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,xe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ve=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),it=(()=>{if(s.showOverdrawInspector)return i.ao.black;const st=this.style.fog;if(st&&this.transform.projection.supportsFog){const Xe=this.style.getLut(st.scope);if(!Ve){const pt=st.properties.get("color-use-theme")==="none",ht=st.properties.get("color").toNonPremultipliedRenderColor(pt?null:Xe).toArray01();return new i.ao(...ht)}if(Ve){const pt=st.properties.get("space-color-use-theme")==="none",ht=st.properties.get("space-color").toNonPremultipliedRenderColor(pt?null:Xe).toArray01();return new i.ao(...ht)}}return i.ao.transparent})();if(this.context.clear({color:it,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ve&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=j.length-1;this.currentLayer>=0;this.currentLayer--){const st=J[this.currentLayer],Xe=t.getLayerSourceCache(st);if(st.isSky())continue;const pt=Xe?(st.is3D(T)?ge:de)[Xe.id]:void 0;this._renderTileClippingMasks(st,Xe,pt),this.renderLayer(this,Xe,st,pt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ve&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const st=J[this.currentLayer],Xe=t.getLayerSourceCache(st);st.isSky()&&this.renderLayer(this,Xe,st,Xe?de[Xe.id]:void 0)}function Ye(st,Xe){let pt;return Xe&&(pt=(st.type==="symbol"?pe:st.is3D(T)?ge:de)[Xe.id]),pt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<j.length;){const st=J[this.currentLayer];if(st.type==="raster"||st.type==="raster-particle"){const Xe=t.getLayerSourceCache(st);this.renderLayer(this,Xe,st,Ye(st,Xe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let dt=0;De&&(dt=De.getShadowCastingLayerCount());let mt=!1,Tt=-1;for(let st=0;st<j.length;++st){const Xe=J[st];Xe.isHidden(this.transform.zoom)||Xe.is3D(T)&&(Tt=st)}B&&Tt===-1&&(D=!0);let Ot=!1;for(;this.currentLayer<j.length;){const st=J[this.currentLayer],Xe=t.getLayerSourceCache(st);if(st.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(st)){if(st.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ot&&st.is3D(T)&&!T){const pt=this.currentLayer,ht=Nt=>{for(this.currentLayer=0;this.currentLayer<J.length;this.currentLayer++){const ti=J[this.currentLayer];if(Tl[ti.type]){const gi=this.style.getLayerSourceCache(ti);Tl[ti.type](this,gi,ti,Ye(ti,gi),Nt)}}};ht("initialize"),ht("reset"),this.currentLayer=pt,Ot=!0}if(D&&!mt&&this.terrain&&!this.transform.isOrthographic&&(mt=!0,this.blitDepth()),B&&Tt!==-1&&this.currentLayer===Tt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(st,Xe,Xe?he[Xe.id]:void 0),this.renderLayer(this,Xe,st,Ye(st,Xe)),!this.terrain&&De&&dt>0&&st.hasShadowPass()&&--dt==0){{this.clearStencil(),this.resetStencilClippingMasks();const pt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<J.length;this.currentLayer++){const ht=J[this.currentLayer];if(du[ht.type]){const Nt=this.style.getLayerSourceCache(ht);du[ht.type](this,Nt,ht,Ye(ht,Nt))}}this.currentLayer=pt}if(De.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const pt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=pt;this.currentLayer++){const ht=J[this.currentLayer];if(!ht.hasLightBeamPass())continue;const Nt=t.getLayerSourceCache(ht);this.renderLayer(this,Nt,ht,Nt?de[Nt.id]:void 0)}this.currentLayer=pt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const pt=this.currentLayer;this.depthOcclusion=!0;for(const ht of this.layersWithOcclusionOpacity){this.currentLayer=ht;const Nt=J[this.currentLayer],ti=t.getLayerSourceCache(Nt),gi=ti?de[ti.id]:void 0;this.terrain||this._renderTileClippingMasks(Nt,ti,ti?he[ti.id]:void 0),this.renderLayer(this,ti,Nt,gi)}this.depthOcclusion=!1,this.currentLayer=pt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let st=null;J.forEach((Xe=>{const pt=t.getLayerSourceCache(Xe);pt&&!Xe.isHidden(this.transform.zoom)&&pt.getVisibleCoordinates().length&&(!st||st.getSource().maxzoom<pt.getSource().maxzoom)&&(st=pt)})),st&&this.options.showTileBoundaries&&Kt(this,st,st.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Kt(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(st){const Xe=st.transform.padding;bd(st,st.transform.height-(Xe.top||0),3,Bf),bd(st,Xe.bottom||0,3,eg),ur(st,Xe.left||0,3,Uf),ur(st,st.transform.width-(Xe.right||0),3,Ac);const pt=st.transform.centerPoint;(function(ht,Nt,ti,gi){at(ht,Nt-1,ti-10,2,20,gi),at(ht,Nt-10,ti-1,20,2,gi)})(st,pt.x,st.transform.height-pt.y,xd)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),X||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,m=!s||!s.includes(t.type);if(Xf[t.type]&&(m||this.terrain&&t.type==="custom")){const v=this.style.getLayerSourceCache(t);Xf[t.type](t,v,this)}this.gpuTimingEnd()}renderLayer(t,s,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(m.type)&&(!t.terrain||m.type!=="custom")||m.type==="clip"||uu[m.type](t,s,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,m=this.context.gl;let v=this.gpuTimers[t.id];v||(v=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:m.createQuery()}),v.calls++,m.beginQuery(s.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,m=s.createQuery();this.deferredRenderGpuTimeQueries.push(m),s.beginQuery(t.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const m in t){const v=t[m],T=this.context.extTimerQuery,E=T.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(v.query),s[m]=E}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let m=0;for(const v of t)m+=s.getQueryParameter(v,s.QUERY_RESULT)/1e6,s.deleteQuery(v);return m}translatePosMatrix(t,s,m,v,T){if(!m[0]&&!m[1])return t;const E=T?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(E){const B=Math.sin(E),V=Math.cos(E);m=[m[0]*V-m[1]*B,m[0]*B+m[1]*V]}const j=[T?m[0]:i.ay(s,m[0],this.transform.zoom),T?m[1]:i.ay(s,m[1],this.transform.zoom),0],D=new Float32Array(16);return i.br(D,t,j),D}saveTileTexture(t){if(t.context!==this.context)return;const s=t.size[0],m=this._tileTextures[s];m?m.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,m){const v=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,T=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||T.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||v||s!==void 0&&!s||T.push("FOG","FOG_DITHERING"),v&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(t,s){this.cache=this.cache||{};const m=s&&s.defines||[],v=s&&s.config,T=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(m),E=Dh.cacheKey(b[t],t,T,v);return this.cache[E]||(this.cache[E]=new Dh(this.context,t,b[t],v,Bm[t],T)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const m=this.style.directionalLight,v=this.style.ambientLight;if(m&&v){const T=((E,j,D)=>{const B=E.properties.get("direction"),V=E.properties.get("color-use-theme")==="none",Y=E.properties.get("color").toNonPremultipliedRenderColor(V?null:D.getLut(E.scope)).toArray01(),X=E.properties.get("intensity"),J=j.properties.get("color-use-theme")==="none",se=j.properties.get("color").toNonPremultipliedRenderColor(J?null:D.getLut(j.scope)).toArray01(),ne=j.properties.get("intensity"),he=[B.x,B.y,B.z],de=i.dN(se,ne),pe=i.dN(Y,X);return{u_lighting_ambient_color:de,u_lighting_directional_dir:he,u_lighting_directional_color:pe,u_ground_radiance:qd(he,pe,de)}})(m,v,this.style);s.setLightsUniformValues(t,T)}}}uploadCommonUniforms(t,s,m,v,T){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const j=E.getOpacity(this.transform.pitch),D=((B,V,Y,X,J,se,ne,he,de,pe,xe,ge)=>{const je=B.transform,Ae=V.properties.get("color-use-theme")==="none",De=V.properties.get("color").toNonPremultipliedRenderColor(Ae?null:B.style.getLut(V.scope)).toArray01();De[3]=X;const ze=B.frameCounter/1e3%1,[Me,Ve]=V.properties.get("vertical-range");return{u_fog_matrix:Y?je.calculateFogTileMatrix(Y):ge||B.identityMat,u_fog_range:V.getFovAdjustedRange(je._fov),u_fog_color:De,u_fog_horizon_blend:V.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Me,Ve),Ve],u_fog_temporal_offset:ze,u_frustum_tl:J,u_frustum_tr:se,u_frustum_br:ne,u_frustum_bl:he,u_globe_pos:de,u_globe_radius:pe,u_viewport:xe,u_globe_transition:i.aj(je.zoom),u_is_globe:+(je.projection.name==="globe")}})(this,E,m,j,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],v);s.setFogUniformValues(t,D)}T&&s.setCutoffUniformValues(t,T.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)s[v.key]=t[v.key]||new Zs(v,512,this.transform.tileZoom,this,void 0,this.worldview);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=St||s[1]>=St}setupDepthForOcclusion(t,s,m){const v=this.context,T=v.gl,E=!!m;var j;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(T.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((j=this.depthRangeFor3D)[1]-j[0]),-1-2*j[0]/(j[1]-j[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),v.activeTexture.set(T.TEXTURE0),E||s.setTerrainUniformValues(v,m)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Yf(f,t){let s=!1,m=null;const v=()=>{m=null,s&&(f(),m=setTimeout(v,t),s=!1)};return()=>(s=!0,m||v(),m)}class Xm{constructor(t){this._hashName=t&&encodeURIComponent(t),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yf(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=Wr(t);if(this._hashName){const m=this._hashName;let v=!1;const T=location.hash.slice(1).split("&").map((E=>{const j=E.split("=")[0];return j===m?(v=!0,`${j}=${s}`):E})).filter((E=>E));return v||T.push(`${m}=${s}`),`#${T.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map((m=>m.split("="))).forEach((m=>{m[0]===this._hashName&&(s=m)})),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some((m=>isNaN(Number(m))))){const m=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:m,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Wr(f,t){const s=f.getCenter(),m=Math.round(100*f.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,v),E=Math.round(s.lng*T)/T,j=Math.round(s.lat*T)/T,D=f.getBearing(),B=f.getPitch();let V=t?`/${E}/${j}/${m}`:`${m}/${j}/${E}`;return(D||B)&&(V+="/"+Math.round(10*D)/10),B&&(V+=`/${Math.round(B)}`),V}const Nu={linearity:.3,easing:i.eT(0,0,.3,1)},Ym=Object.assign({deceleration:2500,maxSpeed:1400},Nu),Kf=Object.assign({deceleration:20,maxSpeed:1400},Nu),Td=Object.assign({deceleration:1e3,maxSpeed:360},Nu),Km=Object.assign({deceleration:1e3,maxSpeed:90},Nu);class og{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=i.o.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)s.zoom+=T.zoomDelta||0,s.bearing+=T.bearingDelta||0,s.pitch+=T.pitchDelta||0,T.panDelta&&s.pan._add(T.panDelta),T.around&&(s.around=T.around),T.pinchAround&&(s.pinchAround=T.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(s.pan.mag()){const T=Rr(s.pan.mag(),m,Object.assign({},Ym,t||{}));v.offset=s.pan.mult(T.amount/s.pan.mag()),v.center=this._map.transform.center,ah(v,T)}if(s.zoom){const T=Rr(s.zoom,m,Kf);v.zoom=this._map.transform.zoom+T.amount,ah(v,T)}if(s.bearing){const T=Rr(s.bearing,m,Td);v.bearing=this._map.transform.bearing+i.aA(T.amount,-179,179),ah(v,T)}if(s.pitch){const T=Rr(s.pitch,m,Km);v.pitch=this._map.transform.pitch+T.amount,ah(v,T)}if(v.zoom||v.bearing){const T=s.pinchAround===void 0?s.around:s.pinchAround;v.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function ah(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function Rr(f,t,s){const{maxSpeed:m,linearity:v,deceleration:T}=s,E=i.aA(f*v/(t/1e3),-m,m),j=Math.abs(E)/(T*v);return{easing:s.easing,duration:1e3*j,amount:E*(j/2)}}class xr extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,m,v={}){const T=Ke(s.getCanvasContainer(),m),E=s.unproject(T);super(t,Object.assign({point:T,lngLat:E,originalEvent:m},v)),this._defaultPrevented=!1,this.target=s}}class Fu extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,m){const v=t==="touchend"?m.changedTouches:m.touches,T=lt(s.getCanvasContainer(),v),E=T.map((D=>s.unproject(D))),j=T.reduce(((D,B,V,Y)=>D.add(B.div(Y.length))),new i.P(0,0));super(t,{points:T,point:j,lngLats:E,lngLat:s.unproject(j),originalEvent:m}),this._defaultPrevented=!1}}class Jm extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class Jf{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Jm(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new xr(t.type,this._map,t))}mouseup(t){this._map.fire(new xr(t.type,this._map,t))}preclick(t){const s=new MouseEvent("preclick",t);this._map.fire(new xr(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new xr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new xr(t.type,this._map,t))}mouseover(t){this._map.fire(new xr(t.type,this._map,t))}mouseout(t){this._map.fire(new xr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Fu(t.type,this._map,t))}touchmove(t){this._map.fire(new Fu(t.type,this._map,t))}touchend(t){this._map.fire(new Fu(t.type,this._map,t))}touchcancel(t){this._map.fire(new Fu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qm{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new xr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new xr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qf{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(Qe(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const m=s,v=this._startPos,T=this._lastPos;if(!v||!T||T.equals(m)||!this._box&&m.dist(v)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=ae("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const E=Math.min(v.x,m.x),j=Math.max(v.x,m.x),D=Math.min(v.y,m.y),B=Math.max(v.y,m.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${E}px,${D}px)`,this._box.style.width=j-E+"px",this._box.style.height=B-D+"px")}))}mouseupWindow(t,s){if(!this._active)return;const m=this._startPos,v=s;if(m&&t.button===0){if(this.reset(),tt(),m.x!==v.x||m.y!==v.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:t})),{cameraAnimation:T=>T.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),He(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new i.z(t,{originalEvent:s}))}}function rh(f,t){const s={};for(let m=0;m<f.length;m++)s[f[m].identifier]=t[m];return s}class ep{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),m.length===this.numTouches&&(this.centroid=(function(v){const T=new i.P(0,0);for(const E of v)T._add(E);return T.div(v.length)})(s),this.touches=rh(m,s)))}touchmove(t,s,m){if(this.aborted||!this.centroid)return;const v=rh(m,s);for(const T in this.touches){const E=v[T];(!E||E.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(t,s,m){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class em{constructor(t){this.singleTap=new ep(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,m){this.singleTap.touchstart(t,s,m)}touchmove(t,s,m){this.singleTap.touchmove(t,s,m)}touchend(t,s,m){const v=this.singleTap.touchend(t,s,m);if(v){const T=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(v)<30;if(T&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class lg{constructor(){this._zoomIn=new em({numTouches:1,numTaps:2}),this._zoomOut=new em({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,m){this._zoomIn.touchstart(t,s,m),this._zoomOut.touchstart(t,s,m)}touchmove(t,s,m){this._zoomIn.touchmove(t,s,m),this._zoomOut.touchmove(t,s,m)}touchend(t,s,m){const v=this._zoomIn.touchend(t,s,m),T=this._zoomOut.touchend(t,s,m);return v?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(v)},{originalEvent:t})}):T?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(T)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const cg={0:1,2:2},tm={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Wh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const m=ft(t);this._correctButton(t,m)&&(this._lastPoint=s,this._eventButton=m)}mousemoveWindow(t,s){const m=this._lastPoint;if(m){if(t.preventDefault(),this._eventButton!=null&&(function(v,T){const E=cg[T];return v.buttons===void 0||(v.buttons&E)!==E})(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(m,s)}}mouseupWindow(t){this._lastPoint&&ft(t)===this._eventButton&&(this._moved&&tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tp extends Wh{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class ip extends Wh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?tm[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const m=.8*(s.x-t.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class im extends Wh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?tm[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const m=-.5*(s.y-t.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class nm{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(t,s,m){return this._calculateTransform(t,s,m)}touchmove(t,s,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!i.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,m)}}touchend(t,s,m){this._calculateTransform(t,s,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,m){m.length>0&&(this._active=!0);const v=rh(m,s),T=new i.P(0,0),E=new i.P(0,0);let j=0;for(const B in v){const V=v[B],Y=this._touches[B];Y&&(T._add(V),E._add(V.sub(Y)),j++,v[B]=V)}if(this._touches=v,j<this._minTouches||!E.mag())return;const D=E.div(j);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(j),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ae("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Zh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,m){return{}}touchstart(t,s,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,m){const v=this._firstTwoTouches;if(!v)return;t.preventDefault();const[T,E]=v,j=Xh(m,s,T),D=Xh(m,s,E);if(!j||!D)return;const B=this._aroundCenter?null:j.add(D).div(2);return this._move([j,D],B,t)}touchend(t,s,m){if(!this._firstTwoTouches)return;const[v,T]=this._firstTwoTouches,E=Xh(m,s,v),j=Xh(m,s,T);E&&j||(this._active&&tt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xh(f,t,s){for(let m=0;m<f.length;m++)if(f[m].identifier===s)return t[m]}function np(f,t){return Math.log2(f/t)}class n_ extends Zh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const m=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(np(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:np(this._distance,m),pinchAround:s}}}function hu(f,t){return 180*f.angleWith(t)/Math.PI}class tr extends Zh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const m=this._vector;if(this._vector=t[0].sub(t[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:hu(this._vector,m),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const v=hu(t,m);return Math.abs(v)<s}}function ap(f){return Math.abs(f.y)>Math.abs(f.x)}class a_ extends Zh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ap(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,m){const v=this._lastPoints;if(!v)return;const T=t[0].sub(v[0]),E=t[1].sub(v[1]);return this._map._cooperativeGestures&&!i.eU()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(T,E,m.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(T.y+E.y)/2*-.5})}gestureBeginsVertically(t,s,m){if(this._valid!==void 0)return this._valid;const v=t.mag()>=2,T=s.mag()>=2;if(!v&&!T)return;if(!v||!T)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const E=t.y>0==s.y>0;return ap(t)&&ap(s)&&E}}const Bu={panStep:100,bearingStep:15,pitchStep:10};class r_{constructor(){const t=Bu;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,m=0,v=0,T=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?m=-1:(t.preventDefault(),T=-1);break;case 39:t.shiftKey?m=1:(t.preventDefault(),T=1);break;case 38:t.shiftKey?v=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?v=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:j=>{const D=j.getZoom();j.easeTo({duration:300,easeId:"keyboardHandler",easing:kd,zoom:s?Math.round(D)+s*(t.shiftKey?2:1):D,bearing:j.getBearing()+m*this._bearingStep,pitch:j.getPitch()+v*this._pitchStep,offset:[-T*this._panStep,-E*this._panStep],center:j.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kd(f){return f*(2-f)}const sh=4.000244140625,Zr=1/450;class rp{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Zr,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||i.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const m=i.o.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,s!==0&&s%sh==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(v*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Ke(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>sh?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&V!==0&&(V=1/V);const Y=s(),X=Math.pow(2,Y),J=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):X;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(J*V))),this._type==="wheel"&&(this._startZoom=Y,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:s(),v=this._startZoom,T=this._easing;let E,j=!1;if(this._type==="wheel"&&v&&T){const B=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),V=T(B);E=i.ak(v,m,V),B<1?this._frameId||(this._frameId=!0):j=!0}else E=m,j=!0;this._active=!0,j&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let D=E-s();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!j,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=i.eV;if(this._prevEase){const m=this._prevEase,v=(i.o.now()-m.start)/m.duration,T=m.easing(v+.01)-m.easing(v),E=.27/Math.sqrt(T*T+1e-4)*.01,j=Math.sqrt(.0729-E*E);s=i.eT(E,j,.25,1)}return this._prevEase={start:i.o.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ae("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Uu{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class am{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(t.shiftKey?-1:1),around:m.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cr{constructor(){this._tap=new em({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,m){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=s[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(t,s,m))}touchmove(t,s,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=s[0],T=v.y-this._swipePoint.y;return this._swipePoint=v,t.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(t,s,m)}touchend(t,s,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(t,s,m)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eo{constructor(t,s,m){this._el=t,this._mousePan=s,this._touchPan=m}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yh{constructor(t,s,m){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rm{constructor(t,s,m,v){this._el=t,this._touchZoom=s,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $u=f=>f.zoom||f.drag||f.pitch||f.rotate;class fu extends i.z{}class Kh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const m=i.av([],s,t);this.radius=i.ag(m[2]<0?i.eX([],m,this.constants):[m[0],m[1],0])}projectRay(t){i.eX(t,t,this.constants),i.aw(t,t),i.eY(t,t,this.constants);const s=i.c5([],t,this.radius);if(s[2]>0){const m=i.c5([],[0,0,1],i.bJ(s,[0,0,1])),v=i.c5([],i.aw([],[s[0],s[1],0]),this.radius),T=i.d8([],s,i.c5([],i.av([],i.d8([],v,m),s),2));s[0]=T[0],s[1]=T[1]}return s}}function Jh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class s_{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new og(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Kh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),i.aY(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,T,E]of this._listeners){const j=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(T,j,E)}}destroy(){for(const[t,s,m]of this._listeners){const v=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,v,m)}}_addDefaultHandlers(t){const s=this._map,m=s.getCanvasContainer();this._add("mapEvent",new Jf(s,t));const v=s.boxZoom=new Qf(s,t);this._add("boxZoom",v);const T=new lg,E=new am;s.doubleClickZoom=new Uu(E,T),this._add("tapZoom",T),this._add("clickZoom",E);const j=new Cr;this._add("tapDragZoom",j);const D=s.touchPitch=new a_(s);this._add("touchPitch",D);const B=new ip(t),V=new im(t);s.dragRotate=new Yh(t,B,V),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const Y=new tp(t),X=new nm(s,t);s.dragPan=new Eo(m,Y,X),this._add("mousePan",Y),this._add("touchPan",X,["touchZoom","touchRotate"]);const J=new tr,se=new n_;s.touchZoomRotate=new rm(m,se,J,j),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qm(s));const ne=s.scrollZoom=new rp(s,this);this._add("scrollZoom",ne,["mousePan"]);const he=s.keyboard=new r_;this._add("keyboard",he);for(const de of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[de]&&s[de].enable(t[de])}_add(t,s,m){this._handlers.push({handlerName:t,handler:s,allowed:m}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$u(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,m){for(const v in t)if(v!==m&&(!s||s.indexOf(v)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const m of t)this._el.contains(m.target)&&s.push(m);return s}handleEvent(t,s){this._updatingCamera=!0;const m=t.type==="renderFrame",v=m?void 0:t,T={needsRenderFrame:!1},E={},j={},D=t.touches?this._getMapTouches(t.touches):void 0,B=D?lt(this._el,D):m?void 0:Ke(this._el,t);for(const{handlerName:X,handler:J,allowed:se}of this._handlers){if(!J.isEnabled())continue;let ne;this._blockedByActive(j,se,X)?J.reset():J[s||t.type]&&(ne=J[s||t.type](t,B,D),this.mergeHandlerResult(T,E,ne,X,v),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||J.isActive())&&(j[X]=J)}const V={};for(const X in this._previousActiveHandlers)j[X]||(V[X]=v);this._previousActiveHandlers=j,(Object.keys(V).length||Jh(T))&&(this._changes.push([T,E,V]),this._triggerRenderFrame()),(Object.keys(j).length||Jh(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Y}=T;Y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Y(this._map))}mergeHandlerResult(t,s,m,v,T){if(!m)return;Object.assign(t,m);const E={handlerName:v,originalEvent:m.originalEvent||T};m.zoomDelta!==void 0&&(s.zoom=E),m.panDelta!==void 0&&(s.drag=E),m.pitchDelta!==void 0&&(s.pitch=E),m.bearingDelta!==void 0&&(s.rotate=E)}_applyChanges(){const t={},s={},m={};for(const[v,T,E]of this._changes)v.panDelta&&(t.panDelta=(t.panDelta||new i.P(0,0))._add(v.panDelta)),v.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(t.around=v.around),v.aroundCoord!==void 0&&(t.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(t.pinchAround=v.pinchAround),v.noInertia&&(t.noInertia=v.noInertia),Object.assign(s,T),Object.assign(m,E);this._updateMapTransform(t,s,m),this._changes=[]}_updateMapTransform(t,s,m){const v=this._map,T=v.transform,E=pe=>[pe.x,pe.y,pe.z];if((pe=>{const xe=this._eventsInProgress.drag;return xe&&!this._handlersById[xe.handlerName].isActive()})()&&!Jh(t)){const pe=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),pe!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&v._stop(!0),!Jh(t))return void this._fireEvents(s,m,!0);let{panDelta:j,zoomDelta:D,bearingDelta:B,pitchDelta:V,around:Y,aroundCoord:X,pinchAround:J}=t;T._isCameraConstrained&&(D>0&&(D=0),T._isCameraConstrained=!1),J!==void 0&&(Y=J),(D||(pe=>s[pe]&&!this._eventsInProgress[pe])("drag"))&&Y&&(this._dragOrigin=E(T.pointCoordinate3D(Y)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",v._stop(!0),Y=Y||v.transform.centerPoint,B&&(T.bearing+=B),V&&(T.pitch+=V),T._updateCameraState();const se=[0,0,0];if(j)if(T.projection.name==="mercator"){const pe=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(Y).dir),xe=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(Y.sub(j)).dir);se[0]=xe[0]-pe[0],se[1]=xe[1]-pe[1]}else{const pe=T.pointCoordinate(Y);if(T.projection.name==="globe"){j=j.rotate(-T.angle);const xe=T._pixelsPerMercatorPixel/T.worldSize;se[0]=-j.x*i.eW(i.a$(pe.y))*xe,se[1]=-j.y*i.eW(T.center.lat)*xe}else{const xe=T.pointCoordinate(Y.sub(j));pe&&xe&&(se[0]=xe.x-pe.x,se[1]=xe.y-pe.y)}}const ne=T.zoom,he=[0,0,0];if(D){const pe=E(X||T.pointCoordinate3D(Y)),xe={dir:i.aw([],i.av([],pe,T._camera.position))};if(xe.dir[2]<0){const ge=T.zoomDeltaToMovement(pe,D);i.c5(he,xe.dir,ge)}}const de=i.d8(se,se,he);T._translateCameraConstrained(de),D&&Math.abs(T.zoom-ne)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,m,!0)}_fireEvents(t,s,m){const v=$u(this._eventsInProgress),T=$u(t),E={};for(const V in t){const{originalEvent:Y}=t[V];this._eventsInProgress[V]||(E[`${V}start`]=Y),this._eventsInProgress[V]=t[V]}!v&&T&&this._fireEvent("movestart",T.originalEvent);for(const V in E)this._fireEvent(V,E[V]);T&&this._fireEvent("move",T.originalEvent);for(const V in t){const{originalEvent:Y}=t[V];this._fireEvent(V,Y)}const j={};let D;for(const V in this._eventsInProgress){const{handlerName:Y,originalEvent:X}=this._eventsInProgress[V];this._handlersById[Y].isActive()||(delete this._eventsInProgress[V],D=s[Y]||X,j[`${V}end`]=D)}for(const V in j)this._fireEvent(V,j[V]);const B=$u(this._eventsInProgress);if(m&&(v||T)&&!B){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;V?(Y(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:D})):(this._map.fire(new i.z("moveend",{originalEvent:D})),Y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new i.z(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new fu("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Qh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class sm extends i.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,m){return t=i.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},s),m)}panTo(t,s,m){return this.easeTo(Object.assign({center:t},s),m)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,m){return this.easeTo(Object.assign({zoom:t},s),m)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,m){return this.easeTo(Object.assign({bearing:t},s),m)}resetNorth(t,s){return this.rotateTo(0,Object.assign({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=i.aI.convert(t);const m=s&&s.bearing||0,v=s&&s.pitch||0,T=t.getNorthWest(),E=t.getSouthEast();return this._cameraForBounds(this.transform,T,E,m,v,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},s,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const m=s.max[0]-s.min[0],v=s.max[1]-s.min[1];return m/v>t.aspect?m/(2*Math.tan(.5*t.fovX)*t.aspect):v/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,m,v,T,E){const j=t.clone(),D=this._extendCameraOptions(E);j.bearing=v,j.pitch=T;const B=i.aT.convert(s),V=i.aT.convert(m),Y=.5*(B.lat+V.lat),X=.5*(B.lng+V.lng),J=i.eZ(Y,X),se=i.aw([],J),ne=i.aw([],i.bI([],se,[0,1,0])),he=i.bI([],ne,se),de=[ne[0],ne[1],ne[2],0,he[0],he[1],he[2],0,se[0],se[1],se[2],0,0,0,0,1],pe=[J,i.eZ(B.lat,B.lng),i.eZ(V.lat,B.lng),i.eZ(V.lat,V.lng),i.eZ(B.lat,V.lng),i.eZ(Y,B.lng),i.eZ(Y,V.lng),i.eZ(B.lat,X),i.eZ(V.lat,X)];let xe=i.d9.fromPoints(pe.map((ht=>[i.bJ(ne,ht),i.bJ(he,ht),i.bJ(se,ht)])));const ge=i.af([],xe.center,de);i.e_(ge)===0&&i.e$(ge,0,0,1),i.aw(ge,ge),i.c5(ge,ge,i.aD),j.center=i.f0(ge);const je=j.getWorldToCameraMatrix(),Ae=i.bl(new Float64Array(16),je);xe=i.d9.applyTransform(xe,i.aB([],je,de));const De=this._extendAABB(xe,j,D,v);if(!De)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xe=De,i.af(ge,ge,je);const ze=.5*(xe.max[2]-xe.min[2]),Me=this._minimumAABBFrustumDistance(j,xe),Ve=i.c5([],[0,0,1],ze),it=i.d8(Ve,ge,Ve),Ye=Me+(j.pitch===0?0:i.bG(ge,it)),dt=j.globeCenterInViewSpace,mt=i.av([],ge,[dt[0],dt[1],dt[2]]);i.aw(mt,mt),i.c5(mt,mt,Ye);const Tt=i.d8([],ge,mt);i.af(Tt,Tt,Ae);const Ot=i.eM/i.aD,st=i.ag(Tt),Xe=i.cf(Math.max(st*Ot-i.eM,Number.EPSILON),0),pt=Math.min(j.zoomFromMercatorZAdjusted(Xe),D.maxZoom);return pt>.5*(i.c_+i.cL)?(j.setProjection({name:"mercator"}),j.zoom=pt,this._cameraForBounds(j,s,m,v,T,E)):{center:j.center,zoom:pt,bearing:v,pitch:T}}_extendAABB(t,s,m,v){const T=.5*((m.padding.left||0)+(m.padding.right||0)),E=.5*((m.padding.top||0)+(m.padding.bottom||0)),j=E,D=T,B=T,V=E,Y=s.width-(D+B),X=s.height-(j+V),J=i.av([],t.max,t.min),se=Math.min(Y/J[0],X/J[1]),ne=Math.min(s.scaleZoom(s.scale*se),m.maxZoom);if(isNaN(ne))return null;const he=s.scale/s.zoomScale(ne),de=new i.d9([t.min[0]-D*he,t.min[1]-V*he,t.min[2]],[t.max[0]+B*he,t.max[1]+j*he,t.max[2]]),pe=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new i.P(m.offset.x,m.offset.y):i.P.convert(m.offset)).rotate(-i.an(v));return de.center[0]-=pe.x*he,de.center[1]+=pe.y*he,de}queryTerrainElevation(t,s){const m=this.transform.elevation;return m?(s=Object.assign({},{exaggerated:!0},s),m.getAtPoint(i.ae.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,m,v,T,E){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,m,v,T,E);const j=t.clone(),D=this._extendCameraOptions(E);j.bearing=v,j.pitch=T;const B=i.aT.convert(s),V=i.aT.convert(m),Y=new i.aT(B.lng,V.lat),X=new i.aT(V.lng,B.lat),J=j.project(B),se=j.project(V),ne=this.queryTerrainElevation(B),he=this.queryTerrainElevation(V),de=this.queryTerrainElevation(Y),pe=this.queryTerrainElevation(X),xe=[[J.x,J.y,Math.min(ne||0,he||0,de||0,pe||0)],[se.x,se.y,Math.max(ne||0,he||0,de||0,pe||0)]];let ge=i.d9.fromPoints(xe);const je=j.getWorldToCameraMatrix(),Ae=i.bl(new Float64Array(16),je);ge=i.d9.applyTransform(ge,je);const De=this._extendAABB(ge,j,D,v);if(!De)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ge=De;const ze=.5*i.av([],ge.max,ge.min)[2],Me=this._minimumAABBFrustumDistance(j,ge),Ve=[0,0,1,0];i.aC(Ve,Ve,je),i.f1(Ve,Ve);const it=i.c5([],Ve,Me+ze),Ye=i.d8([],ge.center,it);i.af(ge.center,ge.center,Ae),i.af(Ye,Ye,Ae);const dt=j.unproject(new i.P(ge.center[0],ge.center[1])),mt=i.f2(j.projection,dt),Tt=Math.pow(2,mt),Ot=Math.min(j._zoomFromMercatorZ(Ye[2]*j.pixelsPerMeter*Tt/j.worldSize),D.maxZoom);return j.mercatorFromTransition&&Ot<.5*(i.c_+i.cL)?(j.setProjection({name:"globe"}),j.zoom=Ot,this._cameraForBounds(j,s,m,v,T,E)):{center:dt,zoom:Ot,bearing:v,pitch:T}}fitBounds(t,s,m){const v=this.cameraForBounds(t,s);return this._fitInternal(v,s,m)}fitScreenCoordinates(t,s,m,v,T){const E=i.P.convert(t),j=i.P.convert(s),D=new i.P(Math.min(E.x,j.x),Math.min(E.y,j.y)),B=new i.P(Math.max(E.x,j.x),Math.max(E.y,j.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,j))return this;const V=this.transform.pointLocation3D(D),Y=this.transform.pointLocation3D(B),X=this.transform.pointLocation3D(new i.P(D.x,B.y)),J=this.transform.pointLocation3D(new i.P(B.x,D.y)),se=[Math.min(V.lng,Y.lng,X.lng,J.lng),Math.min(V.lat,Y.lat,X.lat,J.lat)],ne=[Math.max(V.lng,Y.lng,X.lng,J.lng),Math.max(V.lat,Y.lat,X.lat,J.lat)],he=v&&v.pitch?v.pitch:this.getPitch(),de=this._cameraForBounds(this.transform,se,ne,m,he,v);return this._fitInternal(de,v,T)}_fitInternal(t,s,m){return t?(s=Object.assign(t,s)).linear?this.easeTo(s,m):this.flyTo(s,m):this}jumpTo(t,s){this.stop();const m=t.preloadOnly?this.transform.clone():this.transform;let v=!1,T=!1,E=!1;"zoom"in t&&m.zoom!==+t.zoom&&(v=!0,m.zoom=+t.zoom),t.center!==void 0&&(m.center=i.aT.convert(t.center)),"bearing"in t&&m.bearing!==+t.bearing&&(T=!0,m.bearing=+t.bearing),"pitch"in t&&m.pitch!==+t.pitch&&(E=!0,m.pitch=+t.pitch);const j=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!m.isPaddingEqual(j))if(t.retainPadding===!1){const D=m.clone();D.padding=j,m.setLocationAtPoint(m.center,D.centerPoint)}else m.padding=j;return t.preloadOnly?(this._preloadTiles(m),this):(this.fire(new i.z("movestart",s)).fire(new i.z("move",s)),v&&this.fire(new i.z("zoomstart",s)).fire(new i.z("zoom",s)).fire(new i.z("zoomend",s)),T&&this.fire(new i.z("rotatestart",s)).fire(new i.z("rotate",s)).fire(new i.z("rotateend",s)),E&&this.fire(new i.z("pitchstart",s)).fire(new i.z("pitch",s)).fire(new i.z("pitchend",s)),this.fire(new i.z("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Qh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const m=this.transform;if(!m.projection.supportsFreeCamera)return i.w(Qh),this;this.stop();const v=m.zoom,T=m.pitch,E=m.bearing;m.setFreeCameraOptions(t);const j=v!==m.zoom,D=T!==m.pitch,B=E!==m.bearing;return this.fire(new i.z("movestart",s)).fire(new i.z("move",s)),j&&this.fire(new i.z("zoomstart",s)).fire(new i.z("zoom",s)).fire(new i.z("zoomend",s)),B&&this.fire(new i.z("rotatestart",s)).fire(new i.z("rotate",s)).fire(new i.z("rotateend",s)),D&&this.fire(new i.z("pitchstart",s)).fire(new i.z("pitch",s)).fire(new i.z("pitchend",s)),this.fire(new i.z("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:i.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const m=this.transform,v=this.getZoom(),T=this.getBearing(),E=this.getPitch(),j=this.getPadding(),D="zoom"in t?+t.zoom:v,B="bearing"in t?this._normalizeBearing(t.bearing,T):T,V="pitch"in t?+t.pitch:E,Y=this._extendPadding(t.padding),X=i.P.convert(t.offset);let J,se,ne;if(m.projection.name==="globe"){const Ve=i.ae.fromLngLat(m.center),it=X.rotate(-m.angle);Ve.x+=it.x/m.worldSize,Ve.y+=it.y/m.worldSize;const Ye=Ve.toLngLat(),dt=i.aT.convert(t.center||Ye);this._normalizeCenter(dt),J=m.centerPoint.add(it),se=new i.P(Ve.x,Ve.y).mult(m.worldSize),ne=new i.P(i.aF(dt.lng),i.aJ(dt.lat)).mult(m.worldSize).sub(se)}else{J=m.centerPoint.add(X);const Ve=m.pointLocation(J),it=i.aT.convert(t.center||Ve);this._normalizeCenter(it),se=m.project(Ve),ne=m.project(it).sub(se)}const he=m.zoomScale(D-v);let de,pe;t.around&&(de=i.aT.convert(t.around),pe=m.locationPoint(de));const xe=this._zooming||D!==v,ge=this._rotating||T!==B,je=this._pitching||V!==E,Ae=!m.isPaddingEqual(Y),De=t.retainPadding===!1?m.clone():m,ze=Ve=>it=>{if(xe&&(Ve.zoom=i.ak(v,D,it)),ge&&(Ve.bearing=i.ak(T,B,it)),je&&(Ve.pitch=i.ak(E,V,it)),Ae&&(De.interpolatePadding(j,Y,it),J=De.centerPoint.add(X)),de)Ve.setLocationAtPoint(de,pe);else{const Ye=Ve.zoomScale(Ve.zoom-v),dt=D>v?Math.min(2,he):Math.max(.5,he),mt=Math.pow(dt,1-it),Tt=Ve.unproject(se.add(ne.mult(it*mt)).mult(Ye));Ve.setLocationAtPoint(Ve.renderWorldCopies?Tt.wrap():Tt,J)}return t.preloadOnly||this._fireMoveEvents(s),Ve};if(t.preloadOnly){const Ve=this._emulate(ze,t.duration,m);return this._preloadTiles(Ve),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=xe,this._rotating=ge,this._pitching=je,this._padding=Ae,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Me),this._ease(ze(m),(Ve=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(s,Ve)}),t),this}_prepareEase(t,s,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||m.moving||this.fire(new i.z("movestart",t)),this._zooming&&!m.zooming&&this.fire(new i.z("zoomstart",t)),this._rotating&&!m.rotating&&this.fire(new i.z("rotatestart",t)),this._pitching&&!m.pitching&&this.fire(new i.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new i.z("move",t)),this._zooming&&this.fire(new i.z("zoom",t)),this._rotating&&this.fire(new i.z("rotate",t)),this._pitching&&this.fire(new i.z("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new i.z("zoomend",t)),v&&this.fire(new i.z("rotateend",t)),T&&this.fire(new i.z("pitchend",t)),this.fire(new i.z("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const ht=i.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ht,s)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eV},t);const m=this.transform,v=this.getZoom(),T=this.getBearing(),E=this.getPitch(),j=this.getPadding(),D="zoom"in t?i.aA(+t.zoom,m.minZoom,m.maxZoom):v,B="bearing"in t?this._normalizeBearing(t.bearing,T):T,V="pitch"in t?+t.pitch:E,Y=this._extendPadding(t.padding),X=m.zoomScale(D-v),J=i.P.convert(t.offset);let se=m.centerPoint.add(J);const ne=m.pointLocation(se),he=i.aT.convert(t.center||ne);this._normalizeCenter(he);const de=m.project(ne),pe=m.project(he).sub(de);let xe=t.curve;const ge=Math.max(m.width,m.height),je=ge/X,Ae=pe.mag();if("minZoom"in t){const ht=i.aA(Math.min(t.minZoom,v,D),m.minZoom,m.maxZoom),Nt=ge/m.zoomScale(ht-v);xe=Math.sqrt(Nt/Ae*2)}const De=xe*xe;function ze(ht){const Nt=(je*je-ge*ge+(ht?-1:1)*De*De*Ae*Ae)/(2*(ht?je:ge)*De*Ae);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function Me(ht){return(Math.exp(ht)-Math.exp(-ht))/2}function Ve(ht){return(Math.exp(ht)+Math.exp(-ht))/2}const it=ze(0);let Ye=function(ht){return Ve(it)/Ve(it+xe*ht)},dt=function(ht){return ge*((Ve(it)*(Me(Nt=it+xe*ht)/Ve(Nt))-Me(it))/De)/Ae;var Nt},mt=(ze(1)-it)/xe;if(Math.abs(Ae)<1e-6||!isFinite(mt)){if(Math.abs(ge-je)<1e-6)return this.easeTo(t,s);const ht=je<ge?-1:1;mt=Math.abs(Math.log(je/ge))/xe,dt=function(){return 0},Ye=function(Nt){return Math.exp(ht*xe*Nt)}}t.duration="duration"in t?+t.duration:1e3*mt/("screenSpeed"in t?+t.screenSpeed/xe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Tt=T!==B,Ot=V!==E,st=!m.isPaddingEqual(Y),Xe=t.retainPadding===!1?m.clone():m,pt=ht=>Nt=>{const ti=Nt*mt,gi=1/Ye(ti);ht.zoom=Nt===1?D:v+ht.scaleZoom(gi),Tt&&(ht.bearing=i.ak(T,B,Nt)),Ot&&(ht.pitch=i.ak(E,V,Nt)),st&&(Xe.interpolatePadding(j,Y,Nt),se=Xe.centerPoint.add(J));const Wt=Nt===1?he:ht.unproject(de.add(pe.mult(dt(ti))).mult(gi));return ht.setLocationAtPoint(ht.renderWorldCopies?Wt.wrap():Wt,se),ht._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),ht};if(t.preloadOnly){const ht=this._emulate(pt,t.duration,m);return this._preloadTiles(ht),this}return this._zooming=!0,this._rotating=Tt,this._pitching=Ot,this._padding=st,this._prepareEase(s,!1),this._ease(pt(m),(()=>this._afterEase(s)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,s)}if(!t){const m=this.handlers;m&&m.stop(!1)}return this}_ease(t,s,m){m.animate===!1||m.duration===0?(t(1),s()):(this._easeStart=i.o.now(),this._easeOptions=m,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=i.bT(t,-180,180);const m=Math.abs(t-s);return Math.abs(t-360-s)<m&&(t-=360),Math.abs(t+360-s)<m&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const m=t.lng-s.center.lng;t.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,m){const v=Math.ceil(15*s/1e3),T=[],E=t(m.clone());for(let j=0;j<=v;j++){const D=E(j/v);T.push(D.clone())}return T}_preloadTiles(t,s){}}class Ed{constructor(t={}){this.options=t,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,m=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=ae("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ae("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const v=ae("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",m),this._innerContainer=ae("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(t){const m=s.reduce(((v,T,E)=>(T.value&&(v+=`${T.key}=${T.value}${E<s.length-1?"&":""}`),v)),"?");t.href=`${i.e.FEEDBACK_URL}/${m}#${Wr(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const s=this._map.style._mergedSourceCaches;for(const v in s){const T=s[v];if(T.used){const E=T.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t.sort(((v,T)=>v.length-T.length)),t=t.filter(((v,T)=>{for(let E=T+1;E<t.length;E++)if(t[E].indexOf(v)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const m=t.map((v=>(function(T){const E=new DOMParser().parseFromString(T,"text/html");return Array.from(E.body.querySelectorAll("*")).forEach((j=>{const D=j.textContent||"";if(j.tagName!=="A")return void j.replaceWith(E.createTextNode(D));const B=j.getAttribute("href");if(!B||!/^(https?:|mailto:)/i.test(B))return void j.replaceWith(E.createTextNode(D));const V=E.createElement("a");V.href=B,V.textContent=D,V.rel="noopener nofollow";const Y=j.getAttribute("class");Y&&(V.className=Y),j.replaceWith(V)})),E.body.innerHTML})(v))).join(" | ");m!==this._attribHTML&&(this._attribHTML=m,t.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ef{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ae("div","mapboxgl-ctrl");const s=ae("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const m=t[s].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class kl{constructor(){i.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(s=>this._onIndoorUpdate(s))),this._container}_createButton(t,s){const m=ae("button",t,this._container);return m.type="button",m.addEventListener("click",s),m}_createSeparator(){return ae("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,s){this._map&&(t.setAttribute("aria-label",s),t.textContent=s)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const s=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",s&&Array.from(this._container.children).forEach((m=>m.remove())),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const s=this._map;this._model&&s&&s._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));ae("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,s){for(let m=0;m<t.length;m++){const v=t[m],T=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(v.id)}));this._setButtonTitle(T,v.zIndex.toString()),this._model&&v.id===this._model.selectedFloorId&&s&&T.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(T),m<t.length-1&&this._createSeparator()}}}class kr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,m=s?this._queue.concat(s):this._queue;for(const v of m)if(v.id===t)return void(v.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const m of s)if(!m.cancelled&&(m.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class jc{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=i.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,m){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+m}}const mu={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Xr extends i.z{constructor(t,s,m,v){const{point:T,lngLat:E,originalEvent:j,target:D}=t;super(t.type,{point:T,lngLat:E,originalEvent:j,target:D}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=m,this.feature=v}}class zc{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const m=s.filter;let v=s.type;m&&this.filters.set(t,i.b6(m)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const T=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):T.size===0&&this.map.on(v,this.handleType),T.size===0&&this.interactionsByType.set(v,T),T.set(t,s),this.typeById.set(t,v)}get(t){const s=this.typeById.get(t);if(!s)return;const m=this.interactionsByType.get(s);return m?m.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const m=this.interactionsByType.get(s);m&&(m.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):m.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const m=[];for(const[v,T]of s)T.target&&m.push({targetId:v,target:T.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(t,m,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const m=new Map;for(const[v,{feature:T}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||m.set(T.id,T);m.size&&(t.type="mouseleave",this.handleType(t,Array.from(m.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map((({feature:m})=>m));s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const m=t.type==="mouseenter";if(m&&!this.interactionsByType.has(t.type))return void i.w("mouseenter interaction required for mouseleave to work.");const v=Array.from(this.interactionsByType.get(t.type)).reverse(),T=!!s;s=s||this.queryTargets(t.point,v);let E=!1;const j=new Set;for(const D of s){for(const[B,V]of v){if(!V.target)continue;const Y=D.variants?D.variants[B]:null;if(Y){for(const X of Y){if(_o(X,D,j,B))continue;const J=new i.dx(D,X),se=Io(X,D,B);T&&J.id!==void 0&&(J.state=this.map.getFeatureState(J));const ne=m?this.prevHoveredFeatures.get(se):null,he=new Xr(t,B,V,J),de=ne?ne.stop:V.handler(he);if(m&&this.hoveredFeatures.set(se,{feature:D,stop:de}),de!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[D,B]of v){const{handler:V,target:Y}=B;if(!Y&&V(new Xr(t,D,B,null))!==!1)break}}}function o_(f,t){if(Array.isArray(f)&&Array.isArray(t)){const s=new Set(f),m=new Set(t);return s.size===m.size&&f.every((v=>m.has(v)))}return i.by(f,t)}const l_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},ts={showCompass:!0,showZoom:!0,visualizePitch:!1};class El{constructor(t,s,m=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new ip({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,m&&(this.mousePitch=new im({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),Qe()}move(t,s){const m=this.map,v=this.mouseRotate.mousemoveWindow(t,s),T=v&&v.bearingDelta;if(T&&m.setBearing(m.getBearing()+T),this.mousePitch){const E=this.mousePitch.mousemoveWindow(t,s),j=E&&E.pitchDelta;j&&m.setPitch(m.getPitch()+j)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){He(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ke(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ke(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=lt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=lt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ic(f,t,s){if(f=new i.aT(f.lng,f.lat),t){const m=new i.aT(f.lng-360,f.lat),v=new i.aT(f.lng+360,f.lat),T=360*Math.ceil(Math.abs(f.lng-s.center.lng)/360),E=s.locationPoint3D(f).distSqr(t),j=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(m).distSqr(t)<E&&(j||Math.abs(m.lng-s.center.lng)<T)?f=m:s.locationPoint3D(v).distSqr(t)<E&&(j||Math.abs(v.lng-s.center.lng)<T)&&(f=v)}for(;Math.abs(f.lng-s.center.lng)>180;){const m=s.locationPoint3D(f);if(m.x>=0&&m.y>=0&&m.x<=s.width&&m.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f}const eo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Hl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class sp extends i.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=Object.assign({element:t},s)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:m="center",color:v="#3FB1CE",scale:T=1,draggable:E=!1,clickTolerance:j=0,rotation:D=Hl.rotation,rotationAlignment:B=Hl.rotationAlignment,pitchAlignment:V=Hl.pitchAlignment,occludedOpacity:Y=Hl.occludedOpacity,altitude:X=Hl.altitude}=t||{};this._anchor=m,this._color=v,this._scale=T,this._draggable=E,this._clickTolerance=j,this._rotation=D,this._rotationAlignment=B,this._pitchAlignment=V,this._occludedOpacity=Y,this._altitude=X,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=i.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(ne=>{ne.preventDefault()})),this._element.addEventListener("mousedown",(ne=>{ne.preventDefault()}));const J=this._element.classList;for(const ne in eo)J.remove(`mapboxgl-marker-anchor-${ne}`);J.add(`mapboxgl-marker-anchor-${this._anchor}`);const se=t&&t.className?t.className.trim().split(/\s+/):[];J.add(...se),this._popup=null}_createDefaultMarker(){const t=ae("div"),s=ce("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const m=ce("radialGradient",{id:"shadowGradient"},ce("defs",{},s));ce("stop",{offset:"10%","stop-opacity":.4},m),ce("stop",{offset:"100%","stop-opacity":.05},m),ce("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return ce("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),ce("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),ce("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=i.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Hl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,m=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,m=this._element;this._popup&&(s===m||m.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const m=t.unproject(s,this._altitude),v=t.getFreeCameraOptions();if(!v.position)return!1;const T=v.position.toLngLat();return T.distanceTo(m)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const m=t.unproject(s,this._altitude);let v;t._showingGlobe()&&i.f5(t.transform,this._lngLat)?v=0:(v=1-t._queryFogOpacity(m),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${eo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,m=this.getPitchAlignment();if(!s||!t||m!=="map")return"";if(!s._showingGlobe()){const D=s.getPitch();return D?`rotateX(${D}deg)`:""}const v=i.cX(i.f6(s.transform,this._lngLat)),T=t.sub(i.f7(s.transform)),E=Math.abs(T.x)+Math.abs(T.y);if(E===0)return"";const j=v/E;return`rotateX(${-T.y*j}deg) rotateY(${T.x*j}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let m=0;const v=this.getRotationAlignment();if(v==="map")if(s._showingGlobe()){const T=s.project(new i.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=s.project(new i.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(T);m=i.cX(Math.atan2(E.y,E.x))-90}else m=-s.getBearing();else if(v==="horizon"){const T=i.ah(4,6,s.getZoom()),E=i.f7(s.transform);E.y+=T*s.transform.height;const j=t.sub(E),D=i.cX(Math.atan2(j.y,j.x));m=(D>90?D-270:D+90)*(1-T)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Ic(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),s._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=i.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const m=this._pointerdownPos,v=this._positionDelta;if(m&&v){if(!this._isDragging){const T=this._clickTolerance||s._clickTolerance;if(t.point.dist(m)<T)return;this._isDragging=!0}this._pos=t.point.sub(v),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,m=this._pos;s&&m&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(m),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Hl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Hl.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Hl.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Hl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ug={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},uo={maxWidth:100,unit:"metric"},Gl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ql={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},is=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ad(f=new i.P(0,0),t="bottom"){if(typeof f=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(t){case"top":return new i.P(0,f);case"top-left":return new i.P(s,s);case"top-right":return new i.P(-s,s);case"bottom":return new i.P(0,-f);case"bottom-left":return new i.P(s,-s);case"bottom-right":return new i.P(-s,-s);case"left":return new i.P(f,0);case"right":return new i.P(-f,0)}return new i.P(0,0)}return f instanceof i.P||Array.isArray(f)?i.P.convert(f):i.P.convert(f[t]||[0,0])}return{version:M,supported:re.supported,setRTLTextPlugin:i.fb,getRTLTextPluginStatus:i.fa,Map:class extends sm{constructor(f){N.mark(P.create);const t=f;if((f=Object.assign({},l_,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&i.f3(window)&&(f.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Au(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new kr,this._domRenderTaskQueue=new kr,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b2(),this._locale=Object.assign({},mu,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new jc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Vi(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const s=document.getElementById(f.container);if(!s)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=s}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new s_(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||i.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new Xm(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const s=f.bounds;s&&(this.resize(),this.fitBounds(s,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Ed({customAttribution:f.customAttribution})),this._logoControl=new ef,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(s=>{this._update(s.dataType==="style"),this.fire(new i.z(`${s.dataType}data`,s))})),this.on("dataloading",(s=>{this.fire(new i.z(`${s.dataType}dataloading`,s))})),this._interactions=new zc(this)}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[t];return t.indexOf("bottom")!==-1?m.insertBefore(s,m.firstChild):m.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new i.z("movestart",f)).fire(new i.z("move",f)),this.fire(new i.z("resize",f)),t&&this.fire(new i.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(i.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map((t=>t==="auto"?navigator.language:t)):f}setLanguage(f){const t=this._parseLanguage(f);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,t=f.projection.name;let s;t==="globe"&&f.zoom>=i.cL?(f.setMercatorFromTransition(),s=!0):t==="mercator"&&f.zoom<i.cL&&(f.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,t){return this._updateProjection(f||t||{name:"mercator"})}_updateProjection(f){let t;const s=this.transform.mercatorFromTransition;t=f.name==="globe"&&this.transform.zoom>=i.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const m=this.transform.getProjection().name==="mercator"&&s!==this.transform.mercatorFromTransition;return(t||m)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,t){return this.transform.locationPoint3D(i.aT.convert(f),t)}unproject(f,t){return this.transform.pointLocation3D(i.P.convert(f),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,t,s){const m=v=>{let T=[];if(Array.isArray(t)){const E=t.filter((j=>this.getLayer(j)));T=E.length?this.queryRenderedFeatures(v,{layers:E}):[]}else T=this.queryRenderedFeatures(v,{target:t});return T};if(f==="mouseenter"||f==="mouseover"){let v=!1;return{listener:s,targets:t,delegates:{mousemove:E=>{const j=m(E.point);j.length?v||(v=!0,s.call(this,new xr(f,this,E.originalEvent,{features:j}))):v=!1},mouseout:()=>{v=!1}}}}if(f==="mouseleave"||f==="mouseout"){let v=!1;return{listener:s,targets:t,delegates:{mousemove:j=>{m(j.point).length?v=!0:v&&(v=!1,s.call(this,new xr(f,this,j.originalEvent)))},mouseout:j=>{v&&(v=!1,s.call(this,new xr(f,this,j.originalEvent)))}}}}{const v=T=>{const E=m(T.point);E.length&&(T.features=E,s.call(this,T),delete T.features)};return{listener:s,targets:t,delegates:{[f]:v}}}}on(f,t,s){if(typeof t=="function"||s===void 0)return super.on(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const m=this._createDelegatedListener(f,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(f,t,s){if(typeof t=="function"||s===void 0)return super.once(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const m=this._createDelegatedListener(f,t,s);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(f,t,s){if(typeof t=="function"||s===void 0)return super.off(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const m=this._delegatedListeners?this._delegatedListeners[f]:void 0;return m&&(v=>{for(let T=0;T<v.length;T++){const E=v[T];if(E.listener===s&&o_(E.targets,t)){for(const j in E.delegates)this.off(j,E.delegates[j]);return v.splice(T,1),this}}})(m),this}queryRenderedFeatures(f,t){if(!this.style)return[];if(f===void 0||f instanceof i.P||Array.isArray(f)||t!==void 0||(t=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!t){const T=this.style.queryRenderedFeatures(f,void 0,this.transform),E=this.style.queryRenderedFeatureset(f,void 0,this.transform);return T.concat(E)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(f,t,this.transform);let m=!0;if(t.layers&&Array.isArray(t.layers)){for(const T of t.layers)if(!this._isValidId(T)){m=!1;break}if(m&&!t.target)return this.style.queryRenderedFeatures(f,t,this.transform)}let v=[];return m&&(v=v.concat(this.style.queryRenderedFeatures(f,t,this.transform))),s&&(v=v.concat(this.style.queryRenderedFeatureset(f,t,this.transform))),v}querySourceFeatures(f,t){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,t)}queryRasterValue(f,t,s){return this._isValidId(f)?this.style.queryRasterValue(f,t,s):Promise.resolve(null)}isPointOnSurface(f){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&i.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(f))}addInteraction(f,t){return this._interactions.add(f,t),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&f&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(f,((s,m)=>{if(s){const v=typeof s=="string"?s:s instanceof Error?s.message:s.error;i.w(`Unable to perform style diff: ${v}. Rebuilding the style from scratch.`),this._updateStyle(f,t)}else m&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(f,t))}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const s=Object.assign({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new Qr(this,s).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dr(f)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const t of f)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(f)}addSource(f,t){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,s)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,t,{pixelRatio:s=1,sdf:m=!1,stretchX:v,stretchY:T,content:E}={}){this._lazyInitEmptyStyle();const j=i.I.from(f);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:D,height:B,data:V}=i.o.getImageData(t);this.style.addImage(j,{data:new i.q({width:D,height:B},V),pixelRatio:s,stretchX:v,stretchY:T,content:E,sdf:m,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:B}=t,V=t;this.style.addImage(j,{data:new i.q({width:D,height:B},new Uint8Array(V.data)),pixelRatio:s,stretchX:v,stretchY:T,content:E,sdf:m,usvg:!1,version:0,userImage:V}),V.onAdd&&V.onAdd(this,f)}}updateImage(f,t){this._lazyInitEmptyStyle();const s=i.I.from(f),m=this.style.getImage(s);if(!m)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?i.o.getImageData(t):t,{width:T,height:E,data:j}=v;if(T===void 0||E===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(T!==(m.usvg?m.icon.usvg_tree.width:m.data.width)||E!==(m.usvg?m.icon.usvg_tree.height:m.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${T}, ${E})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`)));const D=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let B=!1;m.usvg?(m.data=new i.q({width:T,height:E},new Uint8Array(j)),m.usvg=!1,m.icon=void 0,B=!0):m.data.replace(j,D),this.style.updateImage(s,m,B)}hasImage(f){return f?!!this.style&&!!this.style.getImage(i.I.from(f)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(i.I.from(f))}loadImage(f,t){i.n(this._requestManager.transformRequest(f,i.R.Image),((s,m)=>{t(s,m instanceof HTMLImageElement?i.o.getImageData(m):m)}))}listImages(){return this.style.listImages().map((f=>f.name))}addModel(f,t){this._lazyInitEmptyStyle(),this.style.addModel(f,t)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,t){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)):this}getSlot(f){const t=this.getLayer(f);return t&&t.slot||null}setSlot(f,t){return this.style.setSlot(f,t),this.style.mergeLayers(),this._update(!0)}addImport(f,t){return this.style.addImport(f,t).catch((s=>this.fire(new i.y(new Error("Failed to add import",s))))),this}updateImport(f,t){return typeof t!="string"&&t.id!==f?(this.removeImport(f),this.addImport(t)):(this.style.updateImport(f,t),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,t){return this.style.moveImport(f,t),this._update(!0)}moveLayer(f,t){return this._isValidId(f)?(this.style.moveLayer(f,t),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const t=this.style.getOwnLayer(f);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,t,s){return this._isValidId(f)?(this.style.setLayerZoomRange(f,t,s),this._update(!0)):this}setFilter(f,t,s={}){return this._isValidId(f)?(this.style.setFilter(f,t,s),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,t,s,m={}){return this._isValidId(f)?(this.style.setPaintProperty(f,t,s,m),this._update(!0)):this}getPaintProperty(f,t){return this._isValidId(f)?this.style.getPaintProperty(f,t):null}setLayoutProperty(f,t,s,m={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,t,s,m),this._update(!0)):this}getLayoutProperty(f,t){return this._isValidId(f)?this.style.getLayoutProperty(f,t):null}setLayerProperty(f,t,s,m={}){return this._isValidId(f)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(f,t,s,m),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,t){return this.style.setSchema(f,t),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,t){return this.style.setConfig(f,t),this._update(!0)}getConfigProperty(f,t){return this.style.getConfigProperty(f,t)}setConfigProperty(f,t,s){return this.style.setConfigProperty(f,t,s),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const t=f[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,t),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aT.convert(f),this.transform):0}setFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,t),this._update())}removeFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,t),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.indoor.setActiveFloorsVisibility(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new kl),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,m,v,T=this._container;for(;T&&(!m||!v);){const E=window.getComputedStyle(T).transform;E&&E!=="none"&&(s=E.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(m=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(v=s[3])),T=T.parentElement}this._containerWidth=m?Math.abs(f/m):f,this._containerHeight=v?Math.abs(t/v):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Qc(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=ae("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ae("div","mapboxgl-canvas-container",f);this._canvas=ae("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=ae("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((v=>{m[v]=ae("div",`mapboxgl-ctrl-${v}`,s)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,t){const s=i.o.devicePixelRatio||1;this._canvas.width=s*Math.ceil(f),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const t=this._markers.indexOf(f);t!==-1&&this._markers.splice(t,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const t=this._popups.indexOf(f);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const f=Object.assign({},re.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",f);t?(xn(t,!0),this.painter=new nh(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",(s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),i.k.testSupport(t)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let t;this.fire(new i.z("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,m=i.o.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=v.createQuery(),v.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,V=this.transform.pitch,Y=i.o.now(),X=new i.ac(B,{now:Y,fadeDuration:T,pitch:V,transition:this.style.transition,worldview:this._worldview});this.style.update(X)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(m),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(m);const j=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),j&&(this._placementDirty=j.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(P.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const B=i.o.now()-m;v.endQuery(s.TIME_ELAPSED_EXT),setTimeout((()=>{const V=v.getQueryParameter(t,v.QUERY_RESULT)/1e6;v.deleteQuery(t),this.fire(new i.z("gpu-timing-frame",{cpuTime:B,gpuTime:V}))}),50)}if(this.listens("gpu-timing-layer")){const B=this.painter.collectGpuTimers();setTimeout((()=>{const V=this.painter.queryGpuTimers(B);this.fire(new i.z("gpu-timing-layer",{layerTimes:V}))}),50)}if(this.listens("gpu-timing-deferred-render")){const B=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const V=this.painter.queryGpuTimeDeferredRender(B);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:V}))}),50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(D||this._repaint)this.triggerRepaint();else{const B=this.idle();if(B&&(E=this._updateAverageElevation(m,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),B&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const V=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:V})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,N.mark(P.fullLoad),this._performanceMetricsCollection&&Fi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const t of this._markers)f&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!f||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(f,t=!1){const s=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(t||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const v=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=f;const E=Math.abs(v-T);if(E>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(T),s(T);this._averageElevation.easeTo(T,f,300)}else if(E>1e-4)return this._averageElevation.jumpTo(T),s(T)}return!!this._averageElevation.isEasing(f)&&s(this._averageElevation.getValue(f))}_authenticate(){hn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(f=>{if(f&&(f.message===Ft||f.status===401)){const t=this.painter.context.gl;xn(t,!1),this._logoControl instanceof ef&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),Ci(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Ba(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&qn(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Ja(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,m=s.createFramebuffer();function v(T){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,T,0);const E=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,E),E}return s.bindFramebuffer(s.FRAMEBUFFER,m),this._canvasPixelComparison(v(f),t.canvasCopies.map(v),t.timeStamps)}_canvasPixelComparison(f,t,s){let m=s[1]-s[0];const v=f.length/4;for(let T=0;T<t.length;T++){const E=t[T];let j=0;for(let D=0;D<E.length;D+=4)E[D]===f[D]&&E[D+1]===f[D+1]&&E[D+2]===f[D+2]&&E[D+3]===f[D+3]&&(j+=1);m+=(s[T+2]-s[T+1])*(1-j/v)}return m}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ln.delete(this.painter.context.gl),nn.remove(),oi.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=i.o.frame((t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)})))}_preloadTiles(f){const t=this.style?this.style.getSourceCaches():[];return i.bw(t,((s,m)=>s._preloadTiles(f,m)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this.style&&f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,t){i.f4(f,t)}get version(){return M}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},ts,f),this._container=ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),ae("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),ae("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))})),this._compassIcon=ae("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const t=f.getZoom(),s=t===f.getMaxZoom(),m=t===f.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new El(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,t){const s=ae("button",f,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(f,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);f.setAttribute("aria-label",s),f.firstElementChild&&f.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends i.E{constructor(f={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},ug,f),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,f(s)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((s=>t(s.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),s=f.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const t=new i.aT(f.coords.longitude,f.coords.latitude),s=f.coords.accuracy,m=this._map.getBearing(),v=Object.assign({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),v,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new i.aT(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,t=i.cf(1,f._center.lat)*f.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=ae("button","mapboxgl-ctrl-geolocate",this._container),ae("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ae("div","mapboxgl-user-location"),this._dotElement.appendChild(ae("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ae("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sp({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ae("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sp({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))}))}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&f()})).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ed,ScaleControl:class{constructor(f={}){this.options=Object.assign({},uo,f),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,m=t._containerWidth/2-f/2,v=t.unproject([m,s]),T=t.unproject([m+f,s]),E=v.distanceTo(T);if(this.options.unit==="imperial"){const j=3.2808*E;j>5280?this._setScale(f,j/5280,"mile"):this._setScale(f,j,"foot")}else this.options.unit==="nautical"?this._setScale(f,E/1852,"nautical-mile"):E>=1e3?this._setScale(f,E/1e3,"kilometer"):this._setScale(f,E,"meter")}_setScale(f,t,s){this._map._requestDomTask((()=>{const m=(function(T){const E=Math.pow(10,`${Math.floor(T)}`.length-1);let j=T/E;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:j>=1?1:(function(D){const B=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*B)/B})(j),E*j})(t),v=m/t;this._container.innerHTML=s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(m):`${m}&nbsp;${Gl[s]}`,this._container.style.width=f*v+"px"}))}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=ae("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=ae("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ae("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:kl,Popup:class extends i.E{constructor(f){super(),this.options=Object.assign(Object.create(ql),f),this._altitude=this.options.altitude,i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=i.aT.convert(f),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),s=document.createElement("body");let m;for(s.innerHTML=f;m=s.firstChild,m;)t.appendChild(m);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ae("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(f),this.options.closeButton){const s=this._closeButton=ae("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let t;return this._classList.delete(f)?t=!1:(this._classList.add(f),t=!0),this._updateClassList(),t}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,m=this._pos;if(!t||!s||!m)return"bottom";const v=s.offsetWidth,T=s.offsetHeight,E=m.x<v/2,j=m.x>t.transform.width-v/2;if(m.y+f<T)return E?"top-left":j?"top-right":"top";if(m.y>t.transform.height-T){if(E)return"bottom-left";if(j)return"bottom-right"}return E?"left":j?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),f.className=t.join(" ")}_update(f){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let m=this._container;if(m||(m=this._container=ae("div","mapboxgl-popup",t.getContainer()),this._tip=ae("div","mapboxgl-popup-tip",m),m.appendChild(s)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ic(this._lngLat,this._pos,t.transform)),!this._trackPointer||f){const v=this._pos=this._trackPointer&&f instanceof i.P?f:t.project(this._lngLat,this._altitude),T=Ad(this.options.offset),E=this._anchor=this._getAnchor(T.y),j=Ad(this.options.offset,E),D=v.add(j).round();t._requestDomTask((()=>{this._container&&E&&(this._container.style.transform=`${eo[E]} translate(${D.x}px,${D.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const v=i.f5(t.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(is);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:sp,Style:Qr,LngLat:i.aT,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:Sr,Evented:i.E,config:i.e,prewarm:i.f9,clearPrewarmedResources:i.f8,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(f){i.e.ACCESS_TOKEN=f},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(f){i.e.API_URL=f},get workerCount(){return i.fi.workerCount},set workerCount(f){i.fi.workerCount=f},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){i.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){i.fh(f)},get workerUrl(){return i.fg.workerUrl},set workerUrl(f){i.fg.workerUrl=f},get workerClass(){return i.fg.workerClass},set workerClass(f){i.fg.workerClass=f},get workerParams(){return i.fg.workerParams},set workerParams(f){i.fg.workerParams=f},get dracoUrl(){return i.ff()},set dracoUrl(f){i.fe(f)},get meshoptUrl(){return i.fd()},set meshoptUrl(f){i.fc(f)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}}));var S=p;return S}))})(rb)),rb.exports}var p4=m4();const vm=Cb(p4),g4="/tamulokal.png",_4="mapbox://styles/mapbox/streets-v12",b1=12,Rv=[0,0];vm.accessToken="pk.eyJ1IjoiZmF1emFua2Fzc2ltIiwiYSI6ImNtazdyaWNwazE0cGgzZ29qb3A0b3RrNHoifQ.RAsBIKXQEpekRoQKUrM0Fg";const oA=(o,r,c=64)=>{const[h,p]=o,x=r/1e3,S=[];for(let i=0;i<c;i++){const M=i/c*(2*Math.PI),P=x*Math.cos(M),H=x*Math.sin(M)/111.32,W=P/(111.32*Math.cos(p*Math.PI/180));S.push([h+W,p+H])}return S.push(S[0]),{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[S]}}},tP=ye.forwardRef(({location:o,markers:r=[],distance:c=1e4,routeTo:h=null,onMarkerClick:p,onRouteFound:x,onClose:S,onCancelRoute:i,mapHeight:M="100dvh"},P)=>{const N=ye.useRef(null),H=ye.useRef(null),W=ye.useRef([]),K=ye.useId().replace(/:/g,"_"),[re,ae]=ye.useState(!1),ce=ye.useRef(x),ve=(ke,tt)=>Math.abs(ke-tt)<1e-6;ye.useEffect(()=>{ce.current=x},[x]);const Se=()=>typeof window>"u"?{padding:50,maxZoom:15}:window.innerWidth>window.innerHeight&&window.innerWidth>=1024?{padding:100,maxZoom:15}:{padding:50,maxZoom:15};ye.useImperativeHandle(P,()=>({flyTo:(ke,tt=15)=>{if(!N.current||!ke)return;const[Ke,lt]=ke;N.current.flyTo({center:[lt,Ke],zoom:tt,speed:.8,curve:1.3})},setView:(ke,tt=b1)=>{if(!N.current||!ke)return;const[Ke,lt]=ke;N.current.setCenter([lt,Ke]),N.current.setZoom(tt)},recenterMap:()=>{if(!N.current||!H.current)return;const ke=new vm.LngLatBounds;H.current.geometry.coordinates[0].forEach(lt=>ke.extend(lt));const{padding:tt,maxZoom:Ke}=Se();N.current.fitBounds(ke,{padding:tt,maxZoom:Ke})},getCenter:()=>N.current?.getCenter()??null,getZoom:()=>N.current?.getZoom()??null})),ye.useEffect(()=>{if(!vm.accessToken){console.error("Mapbox token missing");return}if(!document.getElementById(K))return;const ke=new vm.Map({container:K,style:_4,center:o?[o[1],o[0]]:Rv,zoom:o?b1:2,pitch:0,bearing:0});return ke.on("load",()=>{ke.addSource("user",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Point",coordinates:o?[o[1],o[0]]:Rv}}}),ke.addLayer({id:"user-dot",type:"circle",source:"user",paint:{"circle-radius":8,"circle-color":"#FF8225","circle-stroke-width":2,"circle-stroke-color":"#ffffff"}}),H.current=oA(o?[o[1],o[0]]:Rv,c),ke.addSource("radius",{type:"geojson",data:{type:"FeatureCollection",features:[H.current]}}),ke.addLayer({id:"radius-fill",type:"fill",source:"radius",paint:{"fill-color":"#1E90FF","fill-opacity":.12}}),ke.addLayer({id:"radius-outline",type:"line",source:"radius",paint:{"line-color":"#1E90FF","line-width":2,"line-opacity":.6}}),ke.addSource("route",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),ke.addLayer({id:"route-line",type:"line",source:"route",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2563eb","line-width":6,"line-opacity":.8}});const tt=new vm.LngLatBounds;H.current.geometry.coordinates[0].forEach(ft=>tt.extend(ft));const{padding:Ke,maxZoom:lt}=Se();ke.fitBounds(tt,{padding:Ke,maxZoom:lt})}),N.current=ke,()=>{N.current&&(N.current.remove(),N.current=null)}},[K]),ye.useEffect(()=>{const ke=N.current;if(!ke?.getSource("user"))return;const tt=o?[o[1],o[0]]:Rv;ke.getSource("user").setData({type:"Feature",properties:{},geometry:{type:"Point",coordinates:tt}}),o&&ke.flyTo({center:tt,zoom:b1,speed:.8,curve:1.3})},[o]),ye.useEffect(()=>{const ke=N.current;if(!ke)return;W.current.forEach(Ke=>Ke.remove()),W.current=[],(h&&Array.isArray(h)?r.filter(Ke=>ve(Ke.lat,h[0])&&ve(Ke.lng,h[1])):r).forEach(Ke=>{const lt=document.createElement("div");lt.style.width="44px",lt.style.height="44px",lt.style.border="2px solid #FF8225",lt.style.borderRadius="50%",lt.style.background="#ffffff",lt.style.display="flex",lt.style.alignItems="center",lt.style.justifyContent="center",lt.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)",lt.style.cursor="pointer";const ft=document.createElement("img");ft.src=g4,ft.alt=Ke.name||"marker",ft.style.width="70%",ft.style.height="70%",ft.style.objectFit="contain",lt.appendChild(ft),lt.addEventListener("click",()=>{ke.flyTo({center:[Ke.lng,Ke.lat],zoom:15,speed:.8,curve:1.3}),p&&p(Ke.id)});const gt=new vm.Marker({element:lt,anchor:"bottom"}).setLngLat([Ke.lng,Ke.lat]).addTo(ke);W.current.push(gt)})},[r,p,h]),ye.useEffect(()=>{const ke=N.current;if(!ke?.getSource("radius"))return;const tt=o?[o[1],o[0]]:Rv;H.current=oA(tt,c),ke.getSource("radius").setData({type:"FeatureCollection",features:[H.current]});const Ke=new vm.LngLatBounds;H.current.geometry.coordinates[0].forEach(gt=>Ke.extend(gt));const{padding:lt,maxZoom:ft}=Se();ke.fitBounds(Ke,{padding:lt,maxZoom:ft}),ae(!1)},[c,o]),ye.useEffect(()=>{const ke=N.current;if(!ke?.getSource("route"))return;const tt=()=>{ke.getSource("route").setData({type:"FeatureCollection",features:[]})};if(!h||!o){tt();return}return(async()=>{try{const lt=`https://api.mapbox.com/directions/v5/mapbox/driving/${o[1]},${o[0]};${h[1]},${h[0]}?geometries=geojson&overview=full&steps=true&access_token=${vm.accessToken}`,gt=await(await fetch(lt)).json(),ni=gt?.routes?.[0]?.geometry;if(!ni){tt();return}ke.getSource("route").setData({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:ni}]});const Ft=gt?.routes?.[0]?.legs?.[0]?.steps||[];ce.current&&ce.current(Ft),ke.flyTo({center:[o[1],o[0]],zoom:18,speed:.8,curve:1.3}),ae(!0)}catch(lt){console.error("Error fetching route:",lt),tt()}})(),()=>tt()},[h,o]);const Ee=()=>{if(N.current&&H.current){const ke=new vm.LngLatBounds;H.current.geometry.coordinates[0].forEach(lt=>ke.extend(lt));const{padding:tt,maxZoom:Ke}=Se();N.current.fitBounds(ke,{padding:tt,maxZoom:Ke})}},Qe=()=>{S();const ke=N.current;ke&&(o&&!re?(ke.flyTo({center:[o[1],o[0]],zoom:18,speed:.8,curve:1.3}),ae(!0)):(Ee(),ae(!1)))},He=()=>{Ee(),ae(!1),i&&i()};return C.jsxs("div",{className:"relative w-full",style:{height:M},children:[C.jsx("div",{id:K,className:"w-full h-full"}),h&&C.jsx("button",{onClick:He,className:"absolute top-4 left-2 z-[1000] p-4 rounded-xl bg-[var(--white)] shadow-md hover:bg-gray-100 transition-colors flex items-center justify-center",title:"Cancel route",children:C.jsx(Od,{className:"text-xl text-[var(--black)]"})}),C.jsx("button",{onClick:Qe,className:"absolute top-4 right-2 z-[1000] p-4 rounded-xl bg-[var(--white)] shadow-md hover:bg-gray-100 transition-colors flex items-center justify-center",title:"Recenter map",children:C.jsx(FL,{className:"text-xl text-[var(--black)]"})})]})});tP.displayName="MapboxMap";const y4=({market:o,userLocation:r,onGetDirection:c})=>{const{distance:h,loading:p}=ES(o.latitude,o.longitude),x=ye.useMemo(()=>{if(!o.open_time||!o.close_time)return!1;const S=new Date(o.open_time),i=new Date(o.close_time),M=new Date,P=S.getHours()*60+S.getMinutes(),N=i.getHours()*60+i.getMinutes(),H=M.getHours()*60+M.getMinutes();return N<P?H>=P||H<=N:H>=P&&H<=N},[o.open_time,o.close_time]);return C.jsxs("div",{className:"bg-white rounded-2xl shadow-[0_0_4px_rgba(0,0,0,0.25)] font-inter w-[300px] h-[180px] p-3 flex flex-col items-center",children:[C.jsx("img",{src:o.image,alt:o.name,className:"w-[280px] h-[70px] object-cover rounded-xl"}),C.jsxs("div",{className:"w-full flex justify-between items-start mt-3 px-1",children:[C.jsx("h3",{className:"w-1/2 text-sm font-semibold text-[#1E1E1E] leading-tight break-words",children:o.name}),C.jsxs("div",{className:"w-1/2 flex justify-end items-center text-xs gap-1 whitespace-nowrap",children:[C.jsx("span",{className:x?"text-[var(--green)]":"text-[var(--red)]",children:x?"Open":"Closed"}),C.jsxs("span",{children:["| ",p?"Loading...":`${h} km`]})]})]}),C.jsxs("div",{className:"flex justify-between w-full mt-3 px-1 gap-2",children:[C.jsx("button",{onClick:()=>c&&c(o),className:"w-1/2 h-[30px] rounded-xl border border-[#FF8225] text-[#FF8225] text-sm font-medium hover:bg-[#FF8225] hover:text-white transition-colors",children:"Get Direction"}),C.jsx(fo,{to:`/market/${o.id}`,className:"w-1/2 h-[30px] rounded-xl bg-[#FF8225] text-white text-sm font-medium flex items-center justify-center hover:bg-[#e6731f] transition-colors",children:"Check"})]})]})},v4=({markets:o=[],userLocation:r,selectedMarketId:c,onMarketFocus:h,onGetDirection:p})=>{const x=ye.useRef(null),[S,i]=ye.useState(!1);return ye.useEffect(()=>{if(!c||!x.current)return;const M=x.current.querySelector(`[data-id='${c}']`);M&&M.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})},[c]),ye.useEffect(()=>{const M=x.current;if(!M)return;let P;const N=()=>{i(!0),clearTimeout(P),P=setTimeout(()=>{i(!1);const H=M.getBoundingClientRect(),W=H.left+H.width/2;let K=null,re=1/0;if(M.querySelectorAll(".map-card").forEach(ae=>{const ce=ae.getBoundingClientRect(),ve=ce.left+ce.width/2,Se=Math.abs(W-ve);Se<re&&(re=Se,K=ae)}),K){const ae=K.dataset.id,ce=o.find(ve=>ve.id===ae);ce&&h&&h(ce)}},150)};return M.addEventListener("scroll",N),()=>M.removeEventListener("scroll",N)},[o,h]),C.jsx("div",{className:"fixed bottom-[calc(var(--navbar-height)+20px)] left-0 right-0 z-[30] flex justify-center pointer-events-none",children:C.jsx("div",{ref:x,className:`flex gap-4 overflow-x-auto snap-x snap-mandatory scroll-smooth \r
          no-scrollbar px-[calc(50%-150px)] pb-2 pointer-events-auto`,children:o.map(M=>C.jsx("div",{"data-id":M.id,className:"map-card snap-center flex-shrink-0",children:C.jsx(y4,{market:M,userLocation:r,onGetDirection:p})},M.id))})})},x4=()=>{const o=wy(),{markets:r,loading:c}=xy(null,o),[h,p]=ye.useState([]),[x,S]=ye.useState(null),[i,M]=ye.useState(!1),[P,N]=ye.useState(null),[H,W]=ye.useState([]),[K,re]=ye.useState(0),[ae,ce]=ye.useState(!1),ve=ye.useRef(null),[Se,Ee]=ye.useState(1e4);ye.useEffect(()=>{p(r||[])},[r]);const Qe=ye.useMemo(()=>o?(h||[]).map(Ft=>({...Ft,distance_meters:Q1(o[0],o[1],Ft.latitude,Ft.longitude)})).filter(Ft=>Ft.distance_meters<=Se):[],[h,o,Se]),He=ye.useMemo(()=>Qe.map(Ft=>({id:Ft.id,name:Ft.name,lat:Ft.latitude,lng:Ft.longitude})),[Qe]),ke=Ft=>{S(Ft),M(!0),N(null),W([]),re(0),ce(!1)},tt=Ft=>{ve.current&&Ft?.latitude&&Ft?.longitude&&ve.current.flyTo([Ft.latitude,Ft.longitude],15)},Ke=()=>{M(!1),S(null),re(0),ce(!1)},lt=Ft=>{N([Ft.latitude,Ft.longitude]),M(!1),S(null),W([]),re(0),ce(!1)},ft=(Ft=[])=>{W(Ft),re(0),ce(!1)},gt=()=>{N(null),W([]),re(0),ce(!1)};ye.useEffect(()=>{if(!P||!H.length||!o||ae||K>=H.length)return;const Vi=H[K]?.maneuver?.location;if(!Vi)return;const[Ri,We]=Vi,Et=Q1(o[0],o[1],We,Ri),jt=K===H.length-1?20:30;Et<=jt&&(K===H.length-1?ce(!0):re(Gi=>Gi+1))},[o,P,H,K,ae]);const ni=ae&&H.length?"Arrived at destination":H[K]?.maneuver?.instruction||H[K]?.name||null;return c?C.jsx(Qg,{loading:!0}):C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"relative h-screen w-screen z-0",children:C.jsx(tP,{ref:ve,location:o,markers:He,distance:Se,routeTo:P,onMarkerClick:ke,onClose:Ke,onRouteFound:ft,onCancelRoute:gt})}),i&&C.jsx(v4,{markets:Qe,userLocation:o,selectedMarketId:x,onMarketFocus:tt,onGetDirection:lt}),C.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[1000] bg-white px-4 py-2 rounded-xl shadow-md flex flex-col items-center justify-center",style:{width:"240px",minHeight:"52px"},children:P&&(ni||ae)?C.jsx("span",{className:"text-sm font-medium text-center break-words",children:ni||"Loading directions..."}):C.jsxs(C.Fragment,{children:[C.jsxs("span",{className:"text-sm font-medium text-center",children:["Radius ( ",Se/1e3," km )"]}),C.jsx("input",{type:"range",min:5e3,max:2e4,step:5e3,value:Se,className:"w-48 mt-1 cursor-pointer accent-[#FF8225]",onChange:Ft=>Ee(Number(Ft.target.value))})]})})]})};/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function gx(o){return o+.5|0}const Rp=(o,r,c)=>Math.max(Math.min(o,c),r);function Vv(o){return Rp(gx(o*2.55),0,255)}function Fp(o){return Rp(gx(o*255),0,255)}function Sm(o){return Rp(gx(o/2.55)/100,0,1)}function lA(o){return Rp(gx(o*100),0,100)}const Id={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},tS=[..."0123456789ABCDEF"],b4=o=>tS[o&15],w4=o=>tS[(o&240)>>4]+tS[o&15],O0=o=>(o&240)>>4===(o&15),S4=o=>O0(o.r)&&O0(o.g)&&O0(o.b)&&O0(o.a);function T4(o){var r=o.length,c;return o[0]==="#"&&(r===4||r===5?c={r:255&Id[o[1]]*17,g:255&Id[o[2]]*17,b:255&Id[o[3]]*17,a:r===5?Id[o[4]]*17:255}:(r===7||r===9)&&(c={r:Id[o[1]]<<4|Id[o[2]],g:Id[o[3]]<<4|Id[o[4]],b:Id[o[5]]<<4|Id[o[6]],a:r===9?Id[o[7]]<<4|Id[o[8]]:255})),c}const k4=(o,r)=>o<255?r(o):"";function E4(o){var r=S4(o)?b4:w4;return o?"#"+r(o.r)+r(o.g)+r(o.b)+k4(o.a,r):void 0}const A4=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function iP(o,r,c){const h=r*Math.min(c,1-c),p=(x,S=(x+o/30)%12)=>c-h*Math.max(Math.min(S-3,9-S,1),-1);return[p(0),p(8),p(4)]}function C4(o,r,c){const h=(p,x=(p+o/60)%6)=>c-c*r*Math.max(Math.min(x,4-x,1),0);return[h(5),h(3),h(1)]}function M4(o,r,c){const h=iP(o,1,.5);let p;for(r+c>1&&(p=1/(r+c),r*=p,c*=p),p=0;p<3;p++)h[p]*=1-r-c,h[p]+=r;return h}function P4(o,r,c,h,p){return o===p?(r-c)/h+(r<c?6:0):r===p?(c-o)/h+2:(o-r)/h+4}function PS(o){const c=o.r/255,h=o.g/255,p=o.b/255,x=Math.max(c,h,p),S=Math.min(c,h,p),i=(x+S)/2;let M,P,N;return x!==S&&(N=x-S,P=i>.5?N/(2-x-S):N/(x+S),M=P4(c,h,p,N,x),M=M*60+.5),[M|0,P||0,i]}function jS(o,r,c,h){return(Array.isArray(r)?o(r[0],r[1],r[2]):o(r,c,h)).map(Fp)}function zS(o,r,c){return jS(iP,o,r,c)}function j4(o,r,c){return jS(M4,o,r,c)}function z4(o,r,c){return jS(C4,o,r,c)}function nP(o){return(o%360+360)%360}function I4(o){const r=A4.exec(o);let c=255,h;if(!r)return;r[5]!==h&&(c=r[6]?Vv(+r[5]):Fp(+r[5]));const p=nP(+r[2]),x=+r[3]/100,S=+r[4]/100;return r[1]==="hwb"?h=j4(p,x,S):r[1]==="hsv"?h=z4(p,x,S):h=zS(p,x,S),{r:h[0],g:h[1],b:h[2],a:c}}function R4(o,r){var c=PS(o);c[0]=nP(c[0]+r),c=zS(c),o.r=c[0],o.g=c[1],o.b=c[2]}function D4(o){if(!o)return;const r=PS(o),c=r[0],h=lA(r[1]),p=lA(r[2]);return o.a<255?`hsla(${c}, ${h}%, ${p}%, ${Sm(o.a)})`:`hsl(${c}, ${h}%, ${p}%)`}const cA={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},uA={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function L4(){const o={},r=Object.keys(uA),c=Object.keys(cA);let h,p,x,S,i;for(h=0;h<r.length;h++){for(S=i=r[h],p=0;p<c.length;p++)x=c[p],i=i.replace(x,cA[x]);x=parseInt(uA[S],16),o[i]=[x>>16&255,x>>8&255,x&255]}return o}let N0;function O4(o){N0||(N0=L4(),N0.transparent=[0,0,0,0]);const r=N0[o.toLowerCase()];return r&&{r:r[0],g:r[1],b:r[2],a:r.length===4?r[3]:255}}const N4=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function F4(o){const r=N4.exec(o);let c=255,h,p,x;if(r){if(r[7]!==h){const S=+r[7];c=r[8]?Vv(S):Rp(S*255,0,255)}return h=+r[1],p=+r[3],x=+r[5],h=255&(r[2]?Vv(h):Rp(h,0,255)),p=255&(r[4]?Vv(p):Rp(p,0,255)),x=255&(r[6]?Vv(x):Rp(x,0,255)),{r:h,g:p,b:x,a:c}}}function B4(o){return o&&(o.a<255?`rgba(${o.r}, ${o.g}, ${o.b}, ${Sm(o.a)})`:`rgb(${o.r}, ${o.g}, ${o.b})`)}const w1=o=>o<=.0031308?o*12.92:Math.pow(o,1/2.4)*1.055-.055,ay=o=>o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4);function U4(o,r,c){const h=ay(Sm(o.r)),p=ay(Sm(o.g)),x=ay(Sm(o.b));return{r:Fp(w1(h+c*(ay(Sm(r.r))-h))),g:Fp(w1(p+c*(ay(Sm(r.g))-p))),b:Fp(w1(x+c*(ay(Sm(r.b))-x))),a:o.a+c*(r.a-o.a)}}function F0(o,r,c){if(o){let h=PS(o);h[r]=Math.max(0,Math.min(h[r]+h[r]*c,r===0?360:1)),h=zS(h),o.r=h[0],o.g=h[1],o.b=h[2]}}function aP(o,r){return o&&Object.assign(r||{},o)}function dA(o){var r={r:0,g:0,b:0,a:255};return Array.isArray(o)?o.length>=3&&(r={r:o[0],g:o[1],b:o[2],a:255},o.length>3&&(r.a=Fp(o[3]))):(r=aP(o,{r:0,g:0,b:0,a:1}),r.a=Fp(r.a)),r}function $4(o){return o.charAt(0)==="r"?F4(o):I4(o)}class sx{constructor(r){if(r instanceof sx)return r;const c=typeof r;let h;c==="object"?h=dA(r):c==="string"&&(h=T4(r)||O4(r)||$4(r)),this._rgb=h,this._valid=!!h}get valid(){return this._valid}get rgb(){var r=aP(this._rgb);return r&&(r.a=Sm(r.a)),r}set rgb(r){this._rgb=dA(r)}rgbString(){return this._valid?B4(this._rgb):void 0}hexString(){return this._valid?E4(this._rgb):void 0}hslString(){return this._valid?D4(this._rgb):void 0}mix(r,c){if(r){const h=this.rgb,p=r.rgb;let x;const S=c===x?.5:c,i=2*S-1,M=h.a-p.a,P=((i*M===-1?i:(i+M)/(1+i*M))+1)/2;x=1-P,h.r=255&P*h.r+x*p.r+.5,h.g=255&P*h.g+x*p.g+.5,h.b=255&P*h.b+x*p.b+.5,h.a=S*h.a+(1-S)*p.a,this.rgb=h}return this}interpolate(r,c){return r&&(this._rgb=U4(this._rgb,r._rgb,c)),this}clone(){return new sx(this.rgb)}alpha(r){return this._rgb.a=Fp(r),this}clearer(r){const c=this._rgb;return c.a*=1-r,this}greyscale(){const r=this._rgb,c=gx(r.r*.3+r.g*.59+r.b*.11);return r.r=r.g=r.b=c,this}opaquer(r){const c=this._rgb;return c.a*=1+r,this}negate(){const r=this._rgb;return r.r=255-r.r,r.g=255-r.g,r.b=255-r.b,this}lighten(r){return F0(this._rgb,2,r),this}darken(r){return F0(this._rgb,2,-r),this}saturate(r){return F0(this._rgb,1,r),this}desaturate(r){return F0(this._rgb,1,-r),this}rotate(r){return R4(this._rgb,r),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function pm(){}const V4=(()=>{let o=0;return()=>o++})();function cs(o){return o==null}function Rl(o){if(Array.isArray&&Array.isArray(o))return!0;const r=Object.prototype.toString.call(o);return r.slice(0,7)==="[object"&&r.slice(-6)==="Array]"}function jr(o){return o!==null&&Object.prototype.toString.call(o)==="[object Object]"}function Nd(o){return(typeof o=="number"||o instanceof Number)&&isFinite(+o)}function mf(o,r){return Nd(o)?o:r}function Nr(o,r){return typeof o>"u"?r:o}const H4=(o,r)=>typeof o=="string"&&o.endsWith("%")?parseFloat(o)/100*r:+o;function Ms(o,r,c){if(o&&typeof o.call=="function")return o.apply(c,r)}function Yr(o,r,c,h){let p,x,S;if(Rl(o))for(x=o.length,p=0;p<x;p++)r.call(c,o[p],p);else if(jr(o))for(S=Object.keys(o),x=S.length,p=0;p<x;p++)r.call(c,o[S[p]],S[p])}function xb(o,r){let c,h,p,x;if(!o||!r||o.length!==r.length)return!1;for(c=0,h=o.length;c<h;++c)if(p=o[c],x=r[c],p.datasetIndex!==x.datasetIndex||p.index!==x.index)return!1;return!0}function bb(o){if(Rl(o))return o.map(bb);if(jr(o)){const r=Object.create(null),c=Object.keys(o),h=c.length;let p=0;for(;p<h;++p)r[c[p]]=bb(o[c[p]]);return r}return o}function rP(o){return["__proto__","prototype","constructor"].indexOf(o)===-1}function G4(o,r,c,h){if(!rP(o))return;const p=r[o],x=c[o];jr(p)&&jr(x)?ox(p,x,h):r[o]=bb(x)}function ox(o,r,c){const h=Rl(r)?r:[r],p=h.length;if(!jr(o))return o;c=c||{};const x=c.merger||G4;let S;for(let i=0;i<p;++i){if(S=h[i],!jr(S))continue;const M=Object.keys(S);for(let P=0,N=M.length;P<N;++P)x(M[P],o,S,c)}return o}function Xv(o,r){return ox(o,r,{merger:q4})}function q4(o,r,c){if(!rP(o))return;const h=r[o],p=c[o];jr(h)&&jr(p)?Xv(h,p):Object.prototype.hasOwnProperty.call(r,o)||(r[o]=bb(p))}const hA={"":o=>o,x:o=>o.x,y:o=>o.y};function W4(o){const r=o.split("."),c=[];let h="";for(const p of r)h+=p,h.endsWith("\\")?h=h.slice(0,-1)+".":(c.push(h),h="");return c}function Z4(o){const r=W4(o);return c=>{for(const h of r){if(h==="")break;c=c&&c[h]}return c}}function _y(o,r){return(hA[r]||(hA[r]=Z4(r)))(o)}function IS(o){return o.charAt(0).toUpperCase()+o.slice(1)}const lx=o=>typeof o<"u",Hp=o=>typeof o=="function",fA=(o,r)=>{if(o.size!==r.size)return!1;for(const c of o)if(!r.has(c))return!1;return!0};function X4(o){return o.type==="mouseup"||o.type==="click"||o.type==="contextmenu"}const bu=Math.PI,Bp=2*bu,wb=Number.POSITIVE_INFINITY,Y4=bu/180,bh=bu/2,Og=bu/4,mA=bu*2/3,sP=Math.log10,Up=Math.sign;function sb(o,r,c){return Math.abs(o-r)<c}function pA(o){const r=Math.round(o);o=sb(o,r,o/1e3)?r:o;const c=Math.pow(10,Math.floor(sP(o))),h=o/c;return(h<=1?1:h<=2?2:h<=5?5:10)*c}function K4(o){const r=[],c=Math.sqrt(o);let h;for(h=1;h<c;h++)o%h===0&&(r.push(h),r.push(o/h));return c===(c|0)&&r.push(c),r.sort((p,x)=>p-x).pop(),r}function J4(o){return typeof o=="symbol"||typeof o=="object"&&o!==null&&!(Symbol.toPrimitive in o||"toString"in o||"valueOf"in o)}function Sb(o){return!J4(o)&&!isNaN(parseFloat(o))&&isFinite(o)}function Q4(o,r){const c=Math.round(o);return c-r<=o&&c+r>=o}function e5(o,r,c){let h,p,x;for(h=0,p=o.length;h<p;h++)x=o[h][c],isNaN(x)||(r.min=Math.min(r.min,x),r.max=Math.max(r.max,x))}function Wg(o){return o*(bu/180)}function t5(o){return o*(180/bu)}function gA(o){if(!Nd(o))return;let r=1,c=0;for(;Math.round(o*r)/r!==o;)r*=10,c++;return c}function i5(o,r){const c=r.x-o.x,h=r.y-o.y,p=Math.sqrt(c*c+h*h);let x=Math.atan2(h,c);return x<-.5*bu&&(x+=Bp),{angle:x,distance:p}}function n5(o,r){return Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2))}function Ng(o){return(o%Bp+Bp)%Bp}function a5(o,r,c,h){const p=Ng(o),x=Ng(r),S=Ng(c),i=Ng(x-p),M=Ng(S-p),P=Ng(p-x),N=Ng(p-S);return p===x||p===S||h||i>M&&P<N}function wh(o,r,c){return Math.max(r,Math.min(c,o))}function r5(o){return wh(o,-32768,32767)}function cy(o,r,c,h=1e-6){return o>=Math.min(r,c)-h&&o<=Math.max(r,c)+h}function RS(o,r,c){c=c||(S=>o[S]<r);let h=o.length-1,p=0,x;for(;h-p>1;)x=p+h>>1,c(x)?p=x:h=x;return{lo:p,hi:h}}const iS=(o,r,c,h)=>RS(o,c,h?p=>{const x=o[p][r];return x<c||x===c&&o[p+1][r]===c}:p=>o[p][r]<c),s5=(o,r,c)=>RS(o,c,h=>o[h][r]>=c);function o5(o,r,c){let h=0,p=o.length;for(;h<p&&o[h]<r;)h++;for(;p>h&&o[p-1]>c;)p--;return h>0||p<o.length?o.slice(h,p):o}const oP=["push","pop","shift","splice","unshift"];function l5(o,r){if(o._chartjs){o._chartjs.listeners.push(r);return}Object.defineProperty(o,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),oP.forEach(c=>{const h="_onData"+IS(c),p=o[c];Object.defineProperty(o,c,{configurable:!0,enumerable:!1,value(...x){const S=p.apply(this,x);return o._chartjs.listeners.forEach(i=>{typeof i[h]=="function"&&i[h](...x)}),S}})})}function _A(o,r){const c=o._chartjs;if(!c)return;const h=c.listeners,p=h.indexOf(r);p!==-1&&h.splice(p,1),!(h.length>0)&&(oP.forEach(x=>{delete o[x]}),delete o._chartjs)}function lP(o){const r=new Set(o);return r.size===o.length?o:Array.from(r)}const cP=(function(){return typeof window>"u"?function(o){return o()}:window.requestAnimationFrame})();function uP(o,r){let c=[],h=!1;return function(...p){c=p,h||(h=!0,cP.call(window,()=>{h=!1,o.apply(r,c)}))}}function c5(o,r){let c;return function(...h){return r?(clearTimeout(c),c=setTimeout(o,r,h)):o.apply(this,h),r}}const dP=o=>o==="start"?"left":o==="end"?"right":"center",Gu=(o,r,c)=>o==="start"?r:o==="end"?c:(r+c)/2,u5=(o,r,c,h)=>o===(h?"left":"right")?c:o==="center"?(r+c)/2:r,B0=o=>o===0||o===1,yA=(o,r,c)=>-(Math.pow(2,10*(o-=1))*Math.sin((o-r)*Bp/c)),vA=(o,r,c)=>Math.pow(2,-10*o)*Math.sin((o-r)*Bp/c)+1,Yv={linear:o=>o,easeInQuad:o=>o*o,easeOutQuad:o=>-o*(o-2),easeInOutQuad:o=>(o/=.5)<1?.5*o*o:-.5*(--o*(o-2)-1),easeInCubic:o=>o*o*o,easeOutCubic:o=>(o-=1)*o*o+1,easeInOutCubic:o=>(o/=.5)<1?.5*o*o*o:.5*((o-=2)*o*o+2),easeInQuart:o=>o*o*o*o,easeOutQuart:o=>-((o-=1)*o*o*o-1),easeInOutQuart:o=>(o/=.5)<1?.5*o*o*o*o:-.5*((o-=2)*o*o*o-2),easeInQuint:o=>o*o*o*o*o,easeOutQuint:o=>(o-=1)*o*o*o*o+1,easeInOutQuint:o=>(o/=.5)<1?.5*o*o*o*o*o:.5*((o-=2)*o*o*o*o+2),easeInSine:o=>-Math.cos(o*bh)+1,easeOutSine:o=>Math.sin(o*bh),easeInOutSine:o=>-.5*(Math.cos(bu*o)-1),easeInExpo:o=>o===0?0:Math.pow(2,10*(o-1)),easeOutExpo:o=>o===1?1:-Math.pow(2,-10*o)+1,easeInOutExpo:o=>B0(o)?o:o<.5?.5*Math.pow(2,10*(o*2-1)):.5*(-Math.pow(2,-10*(o*2-1))+2),easeInCirc:o=>o>=1?o:-(Math.sqrt(1-o*o)-1),easeOutCirc:o=>Math.sqrt(1-(o-=1)*o),easeInOutCirc:o=>(o/=.5)<1?-.5*(Math.sqrt(1-o*o)-1):.5*(Math.sqrt(1-(o-=2)*o)+1),easeInElastic:o=>B0(o)?o:yA(o,.075,.3),easeOutElastic:o=>B0(o)?o:vA(o,.075,.3),easeInOutElastic(o){return B0(o)?o:o<.5?.5*yA(o*2,.1125,.45):.5+.5*vA(o*2-1,.1125,.45)},easeInBack(o){return o*o*((1.70158+1)*o-1.70158)},easeOutBack(o){return(o-=1)*o*((1.70158+1)*o+1.70158)+1},easeInOutBack(o){let r=1.70158;return(o/=.5)<1?.5*(o*o*(((r*=1.525)+1)*o-r)):.5*((o-=2)*o*(((r*=1.525)+1)*o+r)+2)},easeInBounce:o=>1-Yv.easeOutBounce(1-o),easeOutBounce(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375},easeInOutBounce:o=>o<.5?Yv.easeInBounce(o*2)*.5:Yv.easeOutBounce(o*2-1)*.5+.5};function hP(o){if(o&&typeof o=="object"){const r=o.toString();return r==="[object CanvasPattern]"||r==="[object CanvasGradient]"}return!1}function xA(o){return hP(o)?o:new sx(o)}function S1(o){return hP(o)?o:new sx(o).saturate(.5).darken(.1).hexString()}const d5=["x","y","borderWidth","radius","tension"],h5=["color","borderColor","backgroundColor"];function f5(o){o.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),o.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:r=>r!=="onProgress"&&r!=="onComplete"&&r!=="fn"}),o.set("animations",{colors:{type:"color",properties:h5},numbers:{type:"number",properties:d5}}),o.describe("animations",{_fallback:"animation"}),o.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:r=>r|0}}}})}function m5(o){o.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const bA=new Map;function p5(o,r){r=r||{};const c=o+JSON.stringify(r);let h=bA.get(c);return h||(h=new Intl.NumberFormat(o,r),bA.set(c,h)),h}function fP(o,r,c){return p5(r,c).format(o)}const g5={values(o){return Rl(o)?o:""+o},numeric(o,r,c){if(o===0)return"0";const h=this.chart.options.locale;let p,x=o;if(c.length>1){const P=Math.max(Math.abs(c[0].value),Math.abs(c[c.length-1].value));(P<1e-4||P>1e15)&&(p="scientific"),x=_5(o,c)}const S=sP(Math.abs(x)),i=isNaN(S)?1:Math.max(Math.min(-1*Math.floor(S),20),0),M={notation:p,minimumFractionDigits:i,maximumFractionDigits:i};return Object.assign(M,this.options.ticks.format),fP(o,h,M)}};function _5(o,r){let c=r.length>3?r[2].value-r[1].value:r[1].value-r[0].value;return Math.abs(c)>=1&&o!==Math.floor(o)&&(c=o-Math.floor(o)),c}var mP={formatters:g5};function y5(o){o.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(r,c)=>c.lineWidth,tickColor:(r,c)=>c.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:mP.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),o.route("scale.ticks","color","","color"),o.route("scale.grid","color","","borderColor"),o.route("scale.border","color","","borderColor"),o.route("scale.title","color","","color"),o.describe("scale",{_fallback:!1,_scriptable:r=>!r.startsWith("before")&&!r.startsWith("after")&&r!=="callback"&&r!=="parser",_indexable:r=>r!=="borderDash"&&r!=="tickBorderDash"&&r!=="dash"}),o.describe("scales",{_fallback:"scale"}),o.describe("scale.ticks",{_scriptable:r=>r!=="backdropPadding"&&r!=="callback",_indexable:r=>r!=="backdropPadding"})}const Yg=Object.create(null),nS=Object.create(null);function Kv(o,r){if(!r)return o;const c=r.split(".");for(let h=0,p=c.length;h<p;++h){const x=c[h];o=o[x]||(o[x]=Object.create(null))}return o}function T1(o,r,c){return typeof r=="string"?ox(Kv(o,r),c):ox(Kv(o,""),r)}class v5{constructor(r,c){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=h=>h.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(h,p)=>S1(p.backgroundColor),this.hoverBorderColor=(h,p)=>S1(p.borderColor),this.hoverColor=(h,p)=>S1(p.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(r),this.apply(c)}set(r,c){return T1(this,r,c)}get(r){return Kv(this,r)}describe(r,c){return T1(nS,r,c)}override(r,c){return T1(Yg,r,c)}route(r,c,h,p){const x=Kv(this,r),S=Kv(this,h),i="_"+c;Object.defineProperties(x,{[i]:{value:x[c],writable:!0},[c]:{enumerable:!0,get(){const M=this[i],P=S[p];return jr(M)?Object.assign({},P,M):Nr(M,P)},set(M){this[i]=M}}})}apply(r){r.forEach(c=>c(this))}}var Po=new v5({_scriptable:o=>!o.startsWith("on"),_indexable:o=>o!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[f5,m5,y5]);function x5(o){return!o||cs(o.size)||cs(o.family)?null:(o.style?o.style+" ":"")+(o.weight?o.weight+" ":"")+o.size+"px "+o.family}function wA(o,r,c,h,p){let x=r[p];return x||(x=r[p]=o.measureText(p).width,c.push(p)),x>h&&(h=x),h}function Fg(o,r,c){const h=o.currentDevicePixelRatio,p=c!==0?Math.max(c/2,.5):0;return Math.round((r-p)*h)/h+p}function SA(o,r){!r&&!o||(r=r||o.getContext("2d"),r.save(),r.resetTransform(),r.clearRect(0,0,o.width,o.height),r.restore())}function TA(o,r,c,h){pP(o,r,c,h,null)}function pP(o,r,c,h,p){let x,S,i,M,P,N,H,W;const K=r.pointStyle,re=r.rotation,ae=r.radius;let ce=(re||0)*Y4;if(K&&typeof K=="object"&&(x=K.toString(),x==="[object HTMLImageElement]"||x==="[object HTMLCanvasElement]")){o.save(),o.translate(c,h),o.rotate(ce),o.drawImage(K,-K.width/2,-K.height/2,K.width,K.height),o.restore();return}if(!(isNaN(ae)||ae<=0)){switch(o.beginPath(),K){default:p?o.ellipse(c,h,p/2,ae,0,0,Bp):o.arc(c,h,ae,0,Bp),o.closePath();break;case"triangle":N=p?p/2:ae,o.moveTo(c+Math.sin(ce)*N,h-Math.cos(ce)*ae),ce+=mA,o.lineTo(c+Math.sin(ce)*N,h-Math.cos(ce)*ae),ce+=mA,o.lineTo(c+Math.sin(ce)*N,h-Math.cos(ce)*ae),o.closePath();break;case"rectRounded":P=ae*.516,M=ae-P,S=Math.cos(ce+Og)*M,H=Math.cos(ce+Og)*(p?p/2-P:M),i=Math.sin(ce+Og)*M,W=Math.sin(ce+Og)*(p?p/2-P:M),o.arc(c-H,h-i,P,ce-bu,ce-bh),o.arc(c+W,h-S,P,ce-bh,ce),o.arc(c+H,h+i,P,ce,ce+bh),o.arc(c-W,h+S,P,ce+bh,ce+bu),o.closePath();break;case"rect":if(!re){M=Math.SQRT1_2*ae,N=p?p/2:M,o.rect(c-N,h-M,2*N,2*M);break}ce+=Og;case"rectRot":H=Math.cos(ce)*(p?p/2:ae),S=Math.cos(ce)*ae,i=Math.sin(ce)*ae,W=Math.sin(ce)*(p?p/2:ae),o.moveTo(c-H,h-i),o.lineTo(c+W,h-S),o.lineTo(c+H,h+i),o.lineTo(c-W,h+S),o.closePath();break;case"crossRot":ce+=Og;case"cross":H=Math.cos(ce)*(p?p/2:ae),S=Math.cos(ce)*ae,i=Math.sin(ce)*ae,W=Math.sin(ce)*(p?p/2:ae),o.moveTo(c-H,h-i),o.lineTo(c+H,h+i),o.moveTo(c+W,h-S),o.lineTo(c-W,h+S);break;case"star":H=Math.cos(ce)*(p?p/2:ae),S=Math.cos(ce)*ae,i=Math.sin(ce)*ae,W=Math.sin(ce)*(p?p/2:ae),o.moveTo(c-H,h-i),o.lineTo(c+H,h+i),o.moveTo(c+W,h-S),o.lineTo(c-W,h+S),ce+=Og,H=Math.cos(ce)*(p?p/2:ae),S=Math.cos(ce)*ae,i=Math.sin(ce)*ae,W=Math.sin(ce)*(p?p/2:ae),o.moveTo(c-H,h-i),o.lineTo(c+H,h+i),o.moveTo(c+W,h-S),o.lineTo(c-W,h+S);break;case"line":S=p?p/2:Math.cos(ce)*ae,i=Math.sin(ce)*ae,o.moveTo(c-S,h-i),o.lineTo(c+S,h+i);break;case"dash":o.moveTo(c,h),o.lineTo(c+Math.cos(ce)*(p?p/2:ae),h+Math.sin(ce)*ae);break;case!1:o.closePath();break}o.fill(),r.borderWidth>0&&o.stroke()}}function gP(o,r,c){return c=c||.5,!r||o&&o.x>r.left-c&&o.x<r.right+c&&o.y>r.top-c&&o.y<r.bottom+c}function DS(o,r){o.save(),o.beginPath(),o.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),o.clip()}function LS(o){o.restore()}function b5(o,r){r.translation&&o.translate(r.translation[0],r.translation[1]),cs(r.rotation)||o.rotate(r.rotation),r.color&&(o.fillStyle=r.color),r.textAlign&&(o.textAlign=r.textAlign),r.textBaseline&&(o.textBaseline=r.textBaseline)}function w5(o,r,c,h,p){if(p.strikethrough||p.underline){const x=o.measureText(h),S=r-x.actualBoundingBoxLeft,i=r+x.actualBoundingBoxRight,M=c-x.actualBoundingBoxAscent,P=c+x.actualBoundingBoxDescent,N=p.strikethrough?(M+P)/2:P;o.strokeStyle=o.fillStyle,o.beginPath(),o.lineWidth=p.decorationWidth||2,o.moveTo(S,N),o.lineTo(i,N),o.stroke()}}function S5(o,r){const c=o.fillStyle;o.fillStyle=r.color,o.fillRect(r.left,r.top,r.width,r.height),o.fillStyle=c}function Tb(o,r,c,h,p,x={}){const S=Rl(r)?r:[r],i=x.strokeWidth>0&&x.strokeColor!=="";let M,P;for(o.save(),o.font=p.string,b5(o,x),M=0;M<S.length;++M)P=S[M],x.backdrop&&S5(o,x.backdrop),i&&(x.strokeColor&&(o.strokeStyle=x.strokeColor),cs(x.strokeWidth)||(o.lineWidth=x.strokeWidth),o.strokeText(P,c,h,x.maxWidth)),o.fillText(P,c,h,x.maxWidth),w5(o,c,h,P,x),h+=Number(p.lineHeight);o.restore()}function kb(o,r){const{x:c,y:h,w:p,h:x,radius:S}=r;o.arc(c+S.topLeft,h+S.topLeft,S.topLeft,1.5*bu,bu,!0),o.lineTo(c,h+x-S.bottomLeft),o.arc(c+S.bottomLeft,h+x-S.bottomLeft,S.bottomLeft,bu,bh,!0),o.lineTo(c+p-S.bottomRight,h+x),o.arc(c+p-S.bottomRight,h+x-S.bottomRight,S.bottomRight,bh,0,!0),o.lineTo(c+p,h+S.topRight),o.arc(c+p-S.topRight,h+S.topRight,S.topRight,0,-bh,!0),o.lineTo(c+S.topLeft,h)}const T5=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,k5=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function E5(o,r){const c=(""+o).match(T5);if(!c||c[1]==="normal")return r*1.2;switch(o=+c[2],c[3]){case"px":return o;case"%":o/=100;break}return r*o}const A5=o=>+o||0;function _P(o,r){const c={},h=jr(r),p=h?Object.keys(r):r,x=jr(o)?h?S=>Nr(o[S],o[r[S]]):S=>o[S]:()=>o;for(const S of p)c[S]=A5(x(S));return c}function yP(o){return _P(o,{top:"y",right:"x",bottom:"y",left:"x"})}function hy(o){return _P(o,["topLeft","topRight","bottomLeft","bottomRight"])}function Sh(o){const r=yP(o);return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function xu(o,r){o=o||{},r=r||Po.font;let c=Nr(o.size,r.size);typeof c=="string"&&(c=parseInt(c,10));let h=Nr(o.style,r.style);h&&!(""+h).match(k5)&&(console.warn('Invalid font style specified: "'+h+'"'),h=void 0);const p={family:Nr(o.family,r.family),lineHeight:E5(Nr(o.lineHeight,r.lineHeight),c),size:c,style:h,weight:Nr(o.weight,r.weight),string:""};return p.string=x5(p),p}function U0(o,r,c,h){let p,x,S;for(p=0,x=o.length;p<x;++p)if(S=o[p],S!==void 0&&S!==void 0)return S}function C5(o,r,c){const{min:h,max:p}=o,x=H4(r,(p-h)/2),S=(i,M)=>c&&i===0?0:i+M;return{min:S(h,-Math.abs(x)),max:S(p,x)}}function Sy(o,r){return Object.assign(Object.create(o),r)}function OS(o,r=[""],c,h,p=()=>o[0]){const x=c||o;typeof h>"u"&&(h=wP("_fallback",o));const S={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:o,_rootScopes:x,_fallback:h,_getTarget:p,override:i=>OS([i,...o],r,x,h)};return new Proxy(S,{deleteProperty(i,M){return delete i[M],delete i._keys,delete o[0][M],!0},get(i,M){return xP(i,M,()=>L5(M,r,o,i))},getOwnPropertyDescriptor(i,M){return Reflect.getOwnPropertyDescriptor(i._scopes[0],M)},getPrototypeOf(){return Reflect.getPrototypeOf(o[0])},has(i,M){return EA(i).includes(M)},ownKeys(i){return EA(i)},set(i,M,P){const N=i._storage||(i._storage=p());return i[M]=N[M]=P,delete i._keys,!0}})}function yy(o,r,c,h){const p={_cacheable:!1,_proxy:o,_context:r,_subProxy:c,_stack:new Set,_descriptors:vP(o,h),setContext:x=>yy(o,x,c,h),override:x=>yy(o.override(x),r,c,h)};return new Proxy(p,{deleteProperty(x,S){return delete x[S],delete o[S],!0},get(x,S,i){return xP(x,S,()=>P5(x,S,i))},getOwnPropertyDescriptor(x,S){return x._descriptors.allKeys?Reflect.has(o,S)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(o,S)},getPrototypeOf(){return Reflect.getPrototypeOf(o)},has(x,S){return Reflect.has(o,S)},ownKeys(){return Reflect.ownKeys(o)},set(x,S,i){return o[S]=i,delete x[S],!0}})}function vP(o,r={scriptable:!0,indexable:!0}){const{_scriptable:c=r.scriptable,_indexable:h=r.indexable,_allKeys:p=r.allKeys}=o;return{allKeys:p,scriptable:c,indexable:h,isScriptable:Hp(c)?c:()=>c,isIndexable:Hp(h)?h:()=>h}}const M5=(o,r)=>o?o+IS(r):r,NS=(o,r)=>jr(r)&&o!=="adapters"&&(Object.getPrototypeOf(r)===null||r.constructor===Object);function xP(o,r,c){if(Object.prototype.hasOwnProperty.call(o,r)||r==="constructor")return o[r];const h=c();return o[r]=h,h}function P5(o,r,c){const{_proxy:h,_context:p,_subProxy:x,_descriptors:S}=o;let i=h[r];return Hp(i)&&S.isScriptable(r)&&(i=j5(r,i,o,c)),Rl(i)&&i.length&&(i=z5(r,i,o,S.isIndexable)),NS(r,i)&&(i=yy(i,p,x&&x[r],S)),i}function j5(o,r,c,h){const{_proxy:p,_context:x,_subProxy:S,_stack:i}=c;if(i.has(o))throw new Error("Recursion detected: "+Array.from(i).join("->")+"->"+o);i.add(o);let M=r(x,S||h);return i.delete(o),NS(o,M)&&(M=FS(p._scopes,p,o,M)),M}function z5(o,r,c,h){const{_proxy:p,_context:x,_subProxy:S,_descriptors:i}=c;if(typeof x.index<"u"&&h(o))return r[x.index%r.length];if(jr(r[0])){const M=r,P=p._scopes.filter(N=>N!==M);r=[];for(const N of M){const H=FS(P,p,o,N);r.push(yy(H,x,S&&S[o],i))}}return r}function bP(o,r,c){return Hp(o)?o(r,c):o}const I5=(o,r)=>o===!0?r:typeof o=="string"?_y(r,o):void 0;function R5(o,r,c,h,p){for(const x of r){const S=I5(c,x);if(S){o.add(S);const i=bP(S._fallback,c,p);if(typeof i<"u"&&i!==c&&i!==h)return i}else if(S===!1&&typeof h<"u"&&c!==h)return null}return!1}function FS(o,r,c,h){const p=r._rootScopes,x=bP(r._fallback,c,h),S=[...o,...p],i=new Set;i.add(h);let M=kA(i,S,c,x||c,h);return M===null||typeof x<"u"&&x!==c&&(M=kA(i,S,x,M,h),M===null)?!1:OS(Array.from(i),[""],p,x,()=>D5(r,c,h))}function kA(o,r,c,h,p){for(;c;)c=R5(o,r,c,h,p);return c}function D5(o,r,c){const h=o._getTarget();r in h||(h[r]={});const p=h[r];return Rl(p)&&jr(c)?c:p||{}}function L5(o,r,c,h){let p;for(const x of r)if(p=wP(M5(x,o),c),typeof p<"u")return NS(o,p)?FS(c,h,o,p):p}function wP(o,r){for(const c of r){if(!c)continue;const h=c[o];if(typeof h<"u")return h}}function EA(o){let r=o._keys;return r||(r=o._keys=O5(o._scopes)),r}function O5(o){const r=new Set;for(const c of o)for(const h of Object.keys(c).filter(p=>!p.startsWith("_")))r.add(h);return Array.from(r)}function BS(){return typeof window<"u"&&typeof document<"u"}function US(o){let r=o.parentNode;return r&&r.toString()==="[object ShadowRoot]"&&(r=r.host),r}function Eb(o,r,c){let h;return typeof o=="string"?(h=parseInt(o,10),o.indexOf("%")!==-1&&(h=h/100*r.parentNode[c])):h=o,h}const zb=o=>o.ownerDocument.defaultView.getComputedStyle(o,null);function N5(o,r){return zb(o).getPropertyValue(r)}const F5=["top","right","bottom","left"];function Xg(o,r,c){const h={};c=c?"-"+c:"";for(let p=0;p<4;p++){const x=F5[p];h[x]=parseFloat(o[r+"-"+x+c])||0}return h.width=h.left+h.right,h.height=h.top+h.bottom,h}const B5=(o,r,c)=>(o>0||r>0)&&(!c||!c.shadowRoot);function U5(o,r){const c=o.touches,h=c&&c.length?c[0]:o,{offsetX:p,offsetY:x}=h;let S=!1,i,M;if(B5(p,x,o.target))i=p,M=x;else{const P=r.getBoundingClientRect();i=h.clientX-P.left,M=h.clientY-P.top,S=!0}return{x:i,y:M,box:S}}function $g(o,r){if("native"in o)return o;const{canvas:c,currentDevicePixelRatio:h}=r,p=zb(c),x=p.boxSizing==="border-box",S=Xg(p,"padding"),i=Xg(p,"border","width"),{x:M,y:P,box:N}=U5(o,c),H=S.left+(N&&i.left),W=S.top+(N&&i.top);let{width:K,height:re}=r;return x&&(K-=S.width+i.width,re-=S.height+i.height),{x:Math.round((M-H)/K*c.width/h),y:Math.round((P-W)/re*c.height/h)}}function $5(o,r,c){let h,p;if(r===void 0||c===void 0){const x=o&&US(o);if(!x)r=o.clientWidth,c=o.clientHeight;else{const S=x.getBoundingClientRect(),i=zb(x),M=Xg(i,"border","width"),P=Xg(i,"padding");r=S.width-P.width-M.width,c=S.height-P.height-M.height,h=Eb(i.maxWidth,x,"clientWidth"),p=Eb(i.maxHeight,x,"clientHeight")}}return{width:r,height:c,maxWidth:h||wb,maxHeight:p||wb}}const Dp=o=>Math.round(o*10)/10;function V5(o,r,c,h){const p=zb(o),x=Xg(p,"margin"),S=Eb(p.maxWidth,o,"clientWidth")||wb,i=Eb(p.maxHeight,o,"clientHeight")||wb,M=$5(o,r,c);let{width:P,height:N}=M;if(p.boxSizing==="content-box"){const W=Xg(p,"border","width"),K=Xg(p,"padding");P-=K.width+W.width,N-=K.height+W.height}return P=Math.max(0,P-x.width),N=Math.max(0,h?P/h:N-x.height),P=Dp(Math.min(P,S,M.maxWidth)),N=Dp(Math.min(N,i,M.maxHeight)),P&&!N&&(N=Dp(P/2)),(r!==void 0||c!==void 0)&&h&&M.height&&N>M.height&&(N=M.height,P=Dp(Math.floor(N*h))),{width:P,height:N}}function AA(o,r,c){const h=r||1,p=Dp(o.height*h),x=Dp(o.width*h);o.height=Dp(o.height),o.width=Dp(o.width);const S=o.canvas;return S.style&&(c||!S.style.height&&!S.style.width)&&(S.style.height=`${o.height}px`,S.style.width=`${o.width}px`),o.currentDevicePixelRatio!==h||S.height!==p||S.width!==x?(o.currentDevicePixelRatio=h,S.height=p,S.width=x,o.ctx.setTransform(h,0,0,h,0,0),!0):!1}const H5=(function(){let o=!1;try{const r={get passive(){return o=!0,!1}};BS()&&(window.addEventListener("test",null,r),window.removeEventListener("test",null,r))}catch{}return o})();function CA(o,r){const c=N5(o,r),h=c&&c.match(/^(\d+)(\.\d+)?px$/);return h?+h[1]:void 0}const G5=function(o,r){return{x(c){return o+o+r-c},setWidth(c){r=c},textAlign(c){return c==="center"?c:c==="right"?"left":"right"},xPlus(c,h){return c-h},leftForLtr(c,h){return c-h}}},q5=function(){return{x(o){return o},setWidth(o){},textAlign(o){return o},xPlus(o,r){return o+r},leftForLtr(o,r){return o}}};function fy(o,r,c){return o?G5(r,c):q5()}function SP(o,r){let c,h;(r==="ltr"||r==="rtl")&&(c=o.canvas.style,h=[c.getPropertyValue("direction"),c.getPropertyPriority("direction")],c.setProperty("direction",r,"important"),o.prevTextDirection=h)}function TP(o,r){r!==void 0&&(delete o.prevTextDirection,o.canvas.style.setProperty("direction",r[0],r[1]))}function $0(o,r,c){return o.options.clip?o[c]:r[c]}function W5(o,r){const{xScale:c,yScale:h}=o;return c&&h?{left:$0(c,r,"left"),right:$0(c,r,"right"),top:$0(h,r,"top"),bottom:$0(h,r,"bottom")}:r}function Z5(o,r){const c=r._clip;if(c.disabled)return!1;const h=W5(r,o.chartArea);return{left:c.left===!1?0:h.left-(c.left===!0?0:c.left),right:c.right===!1?o.width:h.right+(c.right===!0?0:c.right),top:c.top===!1?0:h.top-(c.top===!0?0:c.top),bottom:c.bottom===!1?o.height:h.bottom+(c.bottom===!0?0:c.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class X5{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(r,c,h,p){const x=c.listeners[p],S=c.duration;x.forEach(i=>i({chart:r,initial:c.initial,numSteps:S,currentStep:Math.min(h-c.start,S)}))}_refresh(){this._request||(this._running=!0,this._request=cP.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(r=Date.now()){let c=0;this._charts.forEach((h,p)=>{if(!h.running||!h.items.length)return;const x=h.items;let S=x.length-1,i=!1,M;for(;S>=0;--S)M=x[S],M._active?(M._total>h.duration&&(h.duration=M._total),M.tick(r),i=!0):(x[S]=x[x.length-1],x.pop());i&&(p.draw(),this._notify(p,h,r,"progress")),x.length||(h.running=!1,this._notify(p,h,r,"complete"),h.initial=!1),c+=x.length}),this._lastDate=r,c===0&&(this._running=!1)}_getAnims(r){const c=this._charts;let h=c.get(r);return h||(h={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},c.set(r,h)),h}listen(r,c,h){this._getAnims(r).listeners[c].push(h)}add(r,c){!c||!c.length||this._getAnims(r).items.push(...c)}has(r){return this._getAnims(r).items.length>0}start(r){const c=this._charts.get(r);c&&(c.running=!0,c.start=Date.now(),c.duration=c.items.reduce((h,p)=>Math.max(h,p._duration),0),this._refresh())}running(r){if(!this._running)return!1;const c=this._charts.get(r);return!(!c||!c.running||!c.items.length)}stop(r){const c=this._charts.get(r);if(!c||!c.items.length)return;const h=c.items;let p=h.length-1;for(;p>=0;--p)h[p].cancel();c.items=[],this._notify(r,c,Date.now(),"complete")}remove(r){return this._charts.delete(r)}}var xm=new X5;const MA="transparent",Y5={boolean(o,r,c){return c>.5?r:o},color(o,r,c){const h=xA(o||MA),p=h.valid&&xA(r||MA);return p&&p.valid?p.mix(h,c).hexString():r},number(o,r,c){return o+(r-o)*c}};class K5{constructor(r,c,h,p){const x=c[h];p=U0([r.to,p,x,r.from]);const S=U0([r.from,x,p]);this._active=!0,this._fn=r.fn||Y5[r.type||typeof S],this._easing=Yv[r.easing]||Yv.linear,this._start=Math.floor(Date.now()+(r.delay||0)),this._duration=this._total=Math.floor(r.duration),this._loop=!!r.loop,this._target=c,this._prop=h,this._from=S,this._to=p,this._promises=void 0}active(){return this._active}update(r,c,h){if(this._active){this._notify(!1);const p=this._target[this._prop],x=h-this._start,S=this._duration-x;this._start=h,this._duration=Math.floor(Math.max(S,r.duration)),this._total+=x,this._loop=!!r.loop,this._to=U0([r.to,c,p,r.from]),this._from=U0([r.from,p,c])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(r){const c=r-this._start,h=this._duration,p=this._prop,x=this._from,S=this._loop,i=this._to;let M;if(this._active=x!==i&&(S||c<h),!this._active){this._target[p]=i,this._notify(!0);return}if(c<0){this._target[p]=x;return}M=c/h%2,M=S&&M>1?2-M:M,M=this._easing(Math.min(1,Math.max(0,M))),this._target[p]=this._fn(x,i,M)}wait(){const r=this._promises||(this._promises=[]);return new Promise((c,h)=>{r.push({res:c,rej:h})})}_notify(r){const c=r?"res":"rej",h=this._promises||[];for(let p=0;p<h.length;p++)h[p][c]()}}class kP{constructor(r,c){this._chart=r,this._properties=new Map,this.configure(c)}configure(r){if(!jr(r))return;const c=Object.keys(Po.animation),h=this._properties;Object.getOwnPropertyNames(r).forEach(p=>{const x=r[p];if(!jr(x))return;const S={};for(const i of c)S[i]=x[i];(Rl(x.properties)&&x.properties||[p]).forEach(i=>{(i===p||!h.has(i))&&h.set(i,S)})})}_animateOptions(r,c){const h=c.options,p=Q5(r,h);if(!p)return[];const x=this._createAnimations(p,h);return h.$shared&&J5(r.options.$animations,h).then(()=>{r.options=h},()=>{}),x}_createAnimations(r,c){const h=this._properties,p=[],x=r.$animations||(r.$animations={}),S=Object.keys(c),i=Date.now();let M;for(M=S.length-1;M>=0;--M){const P=S[M];if(P.charAt(0)==="$")continue;if(P==="options"){p.push(...this._animateOptions(r,c));continue}const N=c[P];let H=x[P];const W=h.get(P);if(H)if(W&&H.active()){H.update(W,N,i);continue}else H.cancel();if(!W||!W.duration){r[P]=N;continue}x[P]=H=new K5(W,r,P,N),p.push(H)}return p}update(r,c){if(this._properties.size===0){Object.assign(r,c);return}const h=this._createAnimations(r,c);if(h.length)return xm.add(this._chart,h),!0}}function J5(o,r){const c=[],h=Object.keys(r);for(let p=0;p<h.length;p++){const x=o[h[p]];x&&x.active()&&c.push(x.wait())}return Promise.all(c)}function Q5(o,r){if(!r)return;let c=o.options;if(!c){o.options=r;return}return c.$shared&&(o.options=c=Object.assign({},c,{$shared:!1,$animations:{}})),c}function PA(o,r){const c=o&&o.options||{},h=c.reverse,p=c.min===void 0?r:0,x=c.max===void 0?r:0;return{start:h?x:p,end:h?p:x}}function eU(o,r,c){if(c===!1)return!1;const h=PA(o,c),p=PA(r,c);return{top:p.end,right:h.end,bottom:p.start,left:h.start}}function tU(o){let r,c,h,p;return jr(o)?(r=o.top,c=o.right,h=o.bottom,p=o.left):r=c=h=p=o,{top:r,right:c,bottom:h,left:p,disabled:o===!1}}function EP(o,r){const c=[],h=o._getSortedDatasetMetas(r);let p,x;for(p=0,x=h.length;p<x;++p)c.push(h[p].index);return c}function jA(o,r,c,h={}){const p=o.keys,x=h.mode==="single";let S,i,M,P;if(r===null)return;let N=!1;for(S=0,i=p.length;S<i;++S){if(M=+p[S],M===c){if(N=!0,h.all)continue;break}P=o.values[M],Nd(P)&&(x||r===0||Up(r)===Up(P))&&(r+=P)}return!N&&!h.all?0:r}function iU(o,r){const{iScale:c,vScale:h}=r,p=c.axis==="x"?"x":"y",x=h.axis==="x"?"x":"y",S=Object.keys(o),i=new Array(S.length);let M,P,N;for(M=0,P=S.length;M<P;++M)N=S[M],i[M]={[p]:N,[x]:o[N]};return i}function k1(o,r){const c=o&&o.options.stacked;return c||c===void 0&&r.stack!==void 0}function nU(o,r,c){return`${o.id}.${r.id}.${c.stack||c.type}`}function aU(o){const{min:r,max:c,minDefined:h,maxDefined:p}=o.getUserBounds();return{min:h?r:Number.NEGATIVE_INFINITY,max:p?c:Number.POSITIVE_INFINITY}}function rU(o,r,c){const h=o[r]||(o[r]={});return h[c]||(h[c]={})}function zA(o,r,c,h){for(const p of r.getMatchingVisibleMetas(h).reverse()){const x=o[p.index];if(c&&x>0||!c&&x<0)return p.index}return null}function IA(o,r){const{chart:c,_cachedMeta:h}=o,p=c._stacks||(c._stacks={}),{iScale:x,vScale:S,index:i}=h,M=x.axis,P=S.axis,N=nU(x,S,h),H=r.length;let W;for(let K=0;K<H;++K){const re=r[K],{[M]:ae,[P]:ce}=re,ve=re._stacks||(re._stacks={});W=ve[P]=rU(p,N,ae),W[i]=ce,W._top=zA(W,S,!0,h.type),W._bottom=zA(W,S,!1,h.type);const Se=W._visualValues||(W._visualValues={});Se[i]=ce}}function E1(o,r){const c=o.scales;return Object.keys(c).filter(h=>c[h].axis===r).shift()}function sU(o,r){return Sy(o,{active:!1,dataset:void 0,datasetIndex:r,index:r,mode:"default",type:"dataset"})}function oU(o,r,c){return Sy(o,{active:!1,dataIndex:r,parsed:void 0,raw:void 0,element:c,index:r,mode:"default",type:"data"})}function Dv(o,r){const c=o.controller.index,h=o.vScale&&o.vScale.axis;if(h){r=r||o._parsed;for(const p of r){const x=p._stacks;if(!x||x[h]===void 0||x[h][c]===void 0)return;delete x[h][c],x[h]._visualValues!==void 0&&x[h]._visualValues[c]!==void 0&&delete x[h]._visualValues[c]}}}const A1=o=>o==="reset"||o==="none",RA=(o,r)=>r?o:Object.assign({},o),lU=(o,r,c)=>o&&!r.hidden&&r._stacked&&{keys:EP(c,!0),values:null};class AP{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(r,c){this.chart=r,this._ctx=r.ctx,this.index=c,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const r=this._cachedMeta;this.configure(),this.linkScales(),r._stacked=k1(r.vScale,r),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(r){this.index!==r&&Dv(this._cachedMeta),this.index=r}linkScales(){const r=this.chart,c=this._cachedMeta,h=this.getDataset(),p=(H,W,K,re)=>H==="x"?W:H==="r"?re:K,x=c.xAxisID=Nr(h.xAxisID,E1(r,"x")),S=c.yAxisID=Nr(h.yAxisID,E1(r,"y")),i=c.rAxisID=Nr(h.rAxisID,E1(r,"r")),M=c.indexAxis,P=c.iAxisID=p(M,x,S,i),N=c.vAxisID=p(M,S,x,i);c.xScale=this.getScaleForId(x),c.yScale=this.getScaleForId(S),c.rScale=this.getScaleForId(i),c.iScale=this.getScaleForId(P),c.vScale=this.getScaleForId(N)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(r){return this.chart.scales[r]}_getOtherScale(r){const c=this._cachedMeta;return r===c.iScale?c.vScale:c.iScale}reset(){this._update("reset")}_destroy(){const r=this._cachedMeta;this._data&&_A(this._data,this),r._stacked&&Dv(r)}_dataCheck(){const r=this.getDataset(),c=r.data||(r.data=[]),h=this._data;if(jr(c)){const p=this._cachedMeta;this._data=iU(c,p)}else if(h!==c){if(h){_A(h,this);const p=this._cachedMeta;Dv(p),p._parsed=[]}c&&Object.isExtensible(c)&&l5(c,this),this._syncList=[],this._data=c}}addElements(){const r=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(r.dataset=new this.datasetElementType)}buildOrUpdateElements(r){const c=this._cachedMeta,h=this.getDataset();let p=!1;this._dataCheck();const x=c._stacked;c._stacked=k1(c.vScale,c),c.stack!==h.stack&&(p=!0,Dv(c),c.stack=h.stack),this._resyncElements(r),(p||x!==c._stacked)&&(IA(this,c._parsed),c._stacked=k1(c.vScale,c))}configure(){const r=this.chart.config,c=r.datasetScopeKeys(this._type),h=r.getOptionScopes(this.getDataset(),c,!0);this.options=r.createResolver(h,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(r,c){const{_cachedMeta:h,_data:p}=this,{iScale:x,_stacked:S}=h,i=x.axis;let M=r===0&&c===p.length?!0:h._sorted,P=r>0&&h._parsed[r-1],N,H,W;if(this._parsing===!1)h._parsed=p,h._sorted=!0,W=p;else{Rl(p[r])?W=this.parseArrayData(h,p,r,c):jr(p[r])?W=this.parseObjectData(h,p,r,c):W=this.parsePrimitiveData(h,p,r,c);const K=()=>H[i]===null||P&&H[i]<P[i];for(N=0;N<c;++N)h._parsed[N+r]=H=W[N],M&&(K()&&(M=!1),P=H);h._sorted=M}S&&IA(this,W)}parsePrimitiveData(r,c,h,p){const{iScale:x,vScale:S}=r,i=x.axis,M=S.axis,P=x.getLabels(),N=x===S,H=new Array(p);let W,K,re;for(W=0,K=p;W<K;++W)re=W+h,H[W]={[i]:N||x.parse(P[re],re),[M]:S.parse(c[re],re)};return H}parseArrayData(r,c,h,p){const{xScale:x,yScale:S}=r,i=new Array(p);let M,P,N,H;for(M=0,P=p;M<P;++M)N=M+h,H=c[N],i[M]={x:x.parse(H[0],N),y:S.parse(H[1],N)};return i}parseObjectData(r,c,h,p){const{xScale:x,yScale:S}=r,{xAxisKey:i="x",yAxisKey:M="y"}=this._parsing,P=new Array(p);let N,H,W,K;for(N=0,H=p;N<H;++N)W=N+h,K=c[W],P[N]={x:x.parse(_y(K,i),W),y:S.parse(_y(K,M),W)};return P}getParsed(r){return this._cachedMeta._parsed[r]}getDataElement(r){return this._cachedMeta.data[r]}applyStack(r,c,h){const p=this.chart,x=this._cachedMeta,S=c[r.axis],i={keys:EP(p,!0),values:c._stacks[r.axis]._visualValues};return jA(i,S,x.index,{mode:h})}updateRangeFromParsed(r,c,h,p){const x=h[c.axis];let S=x===null?NaN:x;const i=p&&h._stacks[c.axis];p&&i&&(p.values=i,S=jA(p,x,this._cachedMeta.index)),r.min=Math.min(r.min,S),r.max=Math.max(r.max,S)}getMinMax(r,c){const h=this._cachedMeta,p=h._parsed,x=h._sorted&&r===h.iScale,S=p.length,i=this._getOtherScale(r),M=lU(c,h,this.chart),P={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:N,max:H}=aU(i);let W,K;function re(){K=p[W];const ae=K[i.axis];return!Nd(K[r.axis])||N>ae||H<ae}for(W=0;W<S&&!(!re()&&(this.updateRangeFromParsed(P,r,K,M),x));++W);if(x){for(W=S-1;W>=0;--W)if(!re()){this.updateRangeFromParsed(P,r,K,M);break}}return P}getAllParsedValues(r){const c=this._cachedMeta._parsed,h=[];let p,x,S;for(p=0,x=c.length;p<x;++p)S=c[p][r.axis],Nd(S)&&h.push(S);return h}getMaxOverflow(){return!1}getLabelAndValue(r){const c=this._cachedMeta,h=c.iScale,p=c.vScale,x=this.getParsed(r);return{label:h?""+h.getLabelForValue(x[h.axis]):"",value:p?""+p.getLabelForValue(x[p.axis]):""}}_update(r){const c=this._cachedMeta;this.update(r||"default"),c._clip=tU(Nr(this.options.clip,eU(c.xScale,c.yScale,this.getMaxOverflow())))}update(r){}draw(){const r=this._ctx,c=this.chart,h=this._cachedMeta,p=h.data||[],x=c.chartArea,S=[],i=this._drawStart||0,M=this._drawCount||p.length-i,P=this.options.drawActiveElementsOnTop;let N;for(h.dataset&&h.dataset.draw(r,x,i,M),N=i;N<i+M;++N){const H=p[N];H.hidden||(H.active&&P?S.push(H):H.draw(r,x))}for(N=0;N<S.length;++N)S[N].draw(r,x)}getStyle(r,c){const h=c?"active":"default";return r===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(h):this.resolveDataElementOptions(r||0,h)}getContext(r,c,h){const p=this.getDataset();let x;if(r>=0&&r<this._cachedMeta.data.length){const S=this._cachedMeta.data[r];x=S.$context||(S.$context=oU(this.getContext(),r,S)),x.parsed=this.getParsed(r),x.raw=p.data[r],x.index=x.dataIndex=r}else x=this.$context||(this.$context=sU(this.chart.getContext(),this.index)),x.dataset=p,x.index=x.datasetIndex=this.index;return x.active=!!c,x.mode=h,x}resolveDatasetElementOptions(r){return this._resolveElementOptions(this.datasetElementType.id,r)}resolveDataElementOptions(r,c){return this._resolveElementOptions(this.dataElementType.id,c,r)}_resolveElementOptions(r,c="default",h){const p=c==="active",x=this._cachedDataOpts,S=r+"-"+c,i=x[S],M=this.enableOptionSharing&&lx(h);if(i)return RA(i,M);const P=this.chart.config,N=P.datasetElementScopeKeys(this._type,r),H=p?[`${r}Hover`,"hover",r,""]:[r,""],W=P.getOptionScopes(this.getDataset(),N),K=Object.keys(Po.elements[r]),re=()=>this.getContext(h,p,c),ae=P.resolveNamedOptions(W,K,re,H);return ae.$shared&&(ae.$shared=M,x[S]=Object.freeze(RA(ae,M))),ae}_resolveAnimations(r,c,h){const p=this.chart,x=this._cachedDataOpts,S=`animation-${c}`,i=x[S];if(i)return i;let M;if(p.options.animation!==!1){const N=this.chart.config,H=N.datasetAnimationScopeKeys(this._type,c),W=N.getOptionScopes(this.getDataset(),H);M=N.createResolver(W,this.getContext(r,h,c))}const P=new kP(p,M&&M.animations);return M&&M._cacheable&&(x[S]=Object.freeze(P)),P}getSharedOptions(r){if(r.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},r))}includeOptions(r,c){return!c||A1(r)||this.chart._animationsDisabled}_getSharedOptions(r,c){const h=this.resolveDataElementOptions(r,c),p=this._sharedOptions,x=this.getSharedOptions(h),S=this.includeOptions(c,x)||x!==p;return this.updateSharedOptions(x,c,h),{sharedOptions:x,includeOptions:S}}updateElement(r,c,h,p){A1(p)?Object.assign(r,h):this._resolveAnimations(c,p).update(r,h)}updateSharedOptions(r,c,h){r&&!A1(c)&&this._resolveAnimations(void 0,c).update(r,h)}_setStyle(r,c,h,p){r.active=p;const x=this.getStyle(c,p);this._resolveAnimations(c,h,p).update(r,{options:!p&&this.getSharedOptions(x)||x})}removeHoverStyle(r,c,h){this._setStyle(r,h,"active",!1)}setHoverStyle(r,c,h){this._setStyle(r,h,"active",!0)}_removeDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!1)}_setDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!0)}_resyncElements(r){const c=this._data,h=this._cachedMeta.data;for(const[i,M,P]of this._syncList)this[i](M,P);this._syncList=[];const p=h.length,x=c.length,S=Math.min(x,p);S&&this.parse(0,S),x>p?this._insertElements(p,x-p,r):x<p&&this._removeElements(x,p-x)}_insertElements(r,c,h=!0){const p=this._cachedMeta,x=p.data,S=r+c;let i;const M=P=>{for(P.length+=c,i=P.length-1;i>=S;i--)P[i]=P[i-c]};for(M(x),i=r;i<S;++i)x[i]=new this.dataElementType;this._parsing&&M(p._parsed),this.parse(r,c),h&&this.updateElements(x,r,c,"reset")}updateElements(r,c,h,p){}_removeElements(r,c){const h=this._cachedMeta;if(this._parsing){const p=h._parsed.splice(r,c);h._stacked&&Dv(h,p)}h.data.splice(r,c)}_sync(r){if(this._parsing)this._syncList.push(r);else{const[c,h,p]=r;this[c](h,p)}this.chart._dataChanges.push([this.index,...r])}_onDataPush(){const r=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-r,r])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(r,c){c&&this._sync(["_removeElements",r,c]);const h=arguments.length-2;h&&this._sync(["_insertElements",r,h])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function cU(o,r){if(!o._cache.$bar){const c=o.getMatchingVisibleMetas(r);let h=[];for(let p=0,x=c.length;p<x;p++)h=h.concat(c[p].controller.getAllParsedValues(o));o._cache.$bar=lP(h.sort((p,x)=>p-x))}return o._cache.$bar}function uU(o){const r=o.iScale,c=cU(r,o.type);let h=r._length,p,x,S,i;const M=()=>{S===32767||S===-32768||(lx(i)&&(h=Math.min(h,Math.abs(S-i)||h)),i=S)};for(p=0,x=c.length;p<x;++p)S=r.getPixelForValue(c[p]),M();for(i=void 0,p=0,x=r.ticks.length;p<x;++p)S=r.getPixelForTick(p),M();return h}function dU(o,r,c,h){const p=c.barThickness;let x,S;return cs(p)?(x=r.min*c.categoryPercentage,S=c.barPercentage):(x=p*h,S=1),{chunk:x/h,ratio:S,start:r.pixels[o]-x/2}}function hU(o,r,c,h){const p=r.pixels,x=p[o];let S=o>0?p[o-1]:null,i=o<p.length-1?p[o+1]:null;const M=c.categoryPercentage;S===null&&(S=x-(i===null?r.end-r.start:i-x)),i===null&&(i=x+x-S);const P=x-(x-Math.min(S,i))/2*M;return{chunk:Math.abs(i-S)/2*M/h,ratio:c.barPercentage,start:P}}function fU(o,r,c,h){const p=c.parse(o[0],h),x=c.parse(o[1],h),S=Math.min(p,x),i=Math.max(p,x);let M=S,P=i;Math.abs(S)>Math.abs(i)&&(M=i,P=S),r[c.axis]=P,r._custom={barStart:M,barEnd:P,start:p,end:x,min:S,max:i}}function CP(o,r,c,h){return Rl(o)?fU(o,r,c,h):r[c.axis]=c.parse(o,h),r}function DA(o,r,c,h){const p=o.iScale,x=o.vScale,S=p.getLabels(),i=p===x,M=[];let P,N,H,W;for(P=c,N=c+h;P<N;++P)W=r[P],H={},H[p.axis]=i||p.parse(S[P],P),M.push(CP(W,H,x,P));return M}function C1(o){return o&&o.barStart!==void 0&&o.barEnd!==void 0}function mU(o,r,c){return o!==0?Up(o):(r.isHorizontal()?1:-1)*(r.min>=c?1:-1)}function pU(o){let r,c,h,p,x;return o.horizontal?(r=o.base>o.x,c="left",h="right"):(r=o.base<o.y,c="bottom",h="top"),r?(p="end",x="start"):(p="start",x="end"),{start:c,end:h,reverse:r,top:p,bottom:x}}function gU(o,r,c,h){let p=r.borderSkipped;const x={};if(!p){o.borderSkipped=x;return}if(p===!0){o.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:S,end:i,reverse:M,top:P,bottom:N}=pU(o);p==="middle"&&c&&(o.enableBorderRadius=!0,(c._top||0)===h?p=P:(c._bottom||0)===h?p=N:(x[LA(N,S,i,M)]=!0,p=P)),x[LA(p,S,i,M)]=!0,o.borderSkipped=x}function LA(o,r,c,h){return h?(o=_U(o,r,c),o=OA(o,c,r)):o=OA(o,r,c),o}function _U(o,r,c){return o===r?c:o===c?r:o}function OA(o,r,c){return o==="start"?r:o==="end"?c:o}function yU(o,{inflateAmount:r},c){o.inflateAmount=r==="auto"?c===1?.33:0:r}class vU extends AP{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(r,c,h,p){return DA(r,c,h,p)}parseArrayData(r,c,h,p){return DA(r,c,h,p)}parseObjectData(r,c,h,p){const{iScale:x,vScale:S}=r,{xAxisKey:i="x",yAxisKey:M="y"}=this._parsing,P=x.axis==="x"?i:M,N=S.axis==="x"?i:M,H=[];let W,K,re,ae;for(W=h,K=h+p;W<K;++W)ae=c[W],re={},re[x.axis]=x.parse(_y(ae,P),W),H.push(CP(_y(ae,N),re,S,W));return H}updateRangeFromParsed(r,c,h,p){super.updateRangeFromParsed(r,c,h,p);const x=h._custom;x&&c===this._cachedMeta.vScale&&(r.min=Math.min(r.min,x.min),r.max=Math.max(r.max,x.max))}getMaxOverflow(){return 0}getLabelAndValue(r){const c=this._cachedMeta,{iScale:h,vScale:p}=c,x=this.getParsed(r),S=x._custom,i=C1(S)?"["+S.start+", "+S.end+"]":""+p.getLabelForValue(x[p.axis]);return{label:""+h.getLabelForValue(x[h.axis]),value:i}}initialize(){this.enableOptionSharing=!0,super.initialize();const r=this._cachedMeta;r.stack=this.getDataset().stack}update(r){const c=this._cachedMeta;this.updateElements(c.data,0,c.data.length,r)}updateElements(r,c,h,p){const x=p==="reset",{index:S,_cachedMeta:{vScale:i}}=this,M=i.getBasePixel(),P=i.isHorizontal(),N=this._getRuler(),{sharedOptions:H,includeOptions:W}=this._getSharedOptions(c,p);for(let K=c;K<c+h;K++){const re=this.getParsed(K),ae=x||cs(re[i.axis])?{base:M,head:M}:this._calculateBarValuePixels(K),ce=this._calculateBarIndexPixels(K,N),ve=(re._stacks||{})[i.axis],Se={horizontal:P,base:ae.base,enableBorderRadius:!ve||C1(re._custom)||S===ve._top||S===ve._bottom,x:P?ae.head:ce.center,y:P?ce.center:ae.head,height:P?ce.size:Math.abs(ae.size),width:P?Math.abs(ae.size):ce.size};W&&(Se.options=H||this.resolveDataElementOptions(K,r[K].active?"active":p));const Ee=Se.options||r[K].options;gU(Se,Ee,ve,S),yU(Se,Ee,N.ratio),this.updateElement(r[K],K,Se,p)}}_getStacks(r,c){const{iScale:h}=this._cachedMeta,p=h.getMatchingVisibleMetas(this._type).filter(N=>N.controller.options.grouped),x=h.options.stacked,S=[],i=this._cachedMeta.controller.getParsed(c),M=i&&i[h.axis],P=N=>{const H=N._parsed.find(K=>K[h.axis]===M),W=H&&H[N.vScale.axis];if(cs(W)||isNaN(W))return!0};for(const N of p)if(!(c!==void 0&&P(N))&&((x===!1||S.indexOf(N.stack)===-1||x===void 0&&N.stack===void 0)&&S.push(N.stack),N.index===r))break;return S.length||S.push(void 0),S}_getStackCount(r){return this._getStacks(void 0,r).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const r=this.chart.scales,c=this.chart.options.indexAxis;return Object.keys(r).filter(h=>r[h].axis===c).shift()}_getAxis(){const r={},c=this.getFirstScaleIdForIndexAxis();for(const h of this.chart.data.datasets)r[Nr(this.chart.options.indexAxis==="x"?h.xAxisID:h.yAxisID,c)]=!0;return Object.keys(r)}_getStackIndex(r,c,h){const p=this._getStacks(r,h),x=c!==void 0?p.indexOf(c):-1;return x===-1?p.length-1:x}_getRuler(){const r=this.options,c=this._cachedMeta,h=c.iScale,p=[];let x,S;for(x=0,S=c.data.length;x<S;++x)p.push(h.getPixelForValue(this.getParsed(x)[h.axis],x));const i=r.barThickness;return{min:i||uU(c),pixels:p,start:h._startPixel,end:h._endPixel,stackCount:this._getStackCount(),scale:h,grouped:r.grouped,ratio:i?1:r.categoryPercentage*r.barPercentage}}_calculateBarValuePixels(r){const{_cachedMeta:{vScale:c,_stacked:h,index:p},options:{base:x,minBarLength:S}}=this,i=x||0,M=this.getParsed(r),P=M._custom,N=C1(P);let H=M[c.axis],W=0,K=h?this.applyStack(c,M,h):H,re,ae;K!==H&&(W=K-H,K=H),N&&(H=P.barStart,K=P.barEnd-P.barStart,H!==0&&Up(H)!==Up(P.barEnd)&&(W=0),W+=H);const ce=!cs(x)&&!N?x:W;let ve=c.getPixelForValue(ce);if(this.chart.getDataVisibility(r)?re=c.getPixelForValue(W+K):re=ve,ae=re-ve,Math.abs(ae)<S){ae=mU(ae,c,i)*S,H===i&&(ve-=ae/2);const Se=c.getPixelForDecimal(0),Ee=c.getPixelForDecimal(1),Qe=Math.min(Se,Ee),He=Math.max(Se,Ee);ve=Math.max(Math.min(ve,He),Qe),re=ve+ae,h&&!N&&(M._stacks[c.axis]._visualValues[p]=c.getValueForPixel(re)-c.getValueForPixel(ve))}if(ve===c.getPixelForValue(i)){const Se=Up(ae)*c.getLineWidthForValue(i)/2;ve+=Se,ae-=Se}return{size:ae,base:ve,head:re,center:re+ae/2}}_calculateBarIndexPixels(r,c){const h=c.scale,p=this.options,x=p.skipNull,S=Nr(p.maxBarThickness,1/0);let i,M;const P=this._getAxisCount();if(c.grouped){const N=x?this._getStackCount(r):c.stackCount,H=p.barThickness==="flex"?hU(r,c,p,N*P):dU(r,c,p,N*P),W=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,K=this._getAxis().indexOf(Nr(W,this.getFirstScaleIdForIndexAxis())),re=this._getStackIndex(this.index,this._cachedMeta.stack,x?r:void 0)+K;i=H.start+H.chunk*re+H.chunk/2,M=Math.min(S,H.chunk*H.ratio)}else i=h.getPixelForValue(this.getParsed(r)[h.axis],r),M=Math.min(S,c.min*c.ratio);return{base:i-M/2,head:i+M/2,center:i,size:M}}draw(){const r=this._cachedMeta,c=r.vScale,h=r.data,p=h.length;let x=0;for(;x<p;++x)this.getParsed(x)[c.axis]!==null&&!h[x].hidden&&h[x].draw(this._ctx)}}function Bg(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class $S{static override(r){Object.assign($S.prototype,r)}options;constructor(r){this.options=r||{}}init(){}formats(){return Bg()}parse(){return Bg()}format(){return Bg()}add(){return Bg()}diff(){return Bg()}startOf(){return Bg()}endOf(){return Bg()}}var xU={_date:$S};function bU(o,r,c,h){const{controller:p,data:x,_sorted:S}=o,i=p._cachedMeta.iScale,M=o.dataset&&o.dataset.options?o.dataset.options.spanGaps:null;if(i&&r===i.axis&&r!=="r"&&S&&x.length){const P=i._reversePixels?s5:iS;if(h){if(p._sharedOptions){const N=x[0],H=typeof N.getRange=="function"&&N.getRange(r);if(H){const W=P(x,r,c-H),K=P(x,r,c+H);return{lo:W.lo,hi:K.hi}}}}else{const N=P(x,r,c);if(M){const{vScale:H}=p._cachedMeta,{_parsed:W}=o,K=W.slice(0,N.lo+1).reverse().findIndex(ae=>!cs(ae[H.axis]));N.lo-=Math.max(0,K);const re=W.slice(N.hi).findIndex(ae=>!cs(ae[H.axis]));N.hi+=Math.max(0,re)}return N}}return{lo:0,hi:x.length-1}}function Ib(o,r,c,h,p){const x=o.getSortedVisibleDatasetMetas(),S=c[r];for(let i=0,M=x.length;i<M;++i){const{index:P,data:N}=x[i],{lo:H,hi:W}=bU(x[i],r,S,p);for(let K=H;K<=W;++K){const re=N[K];re.skip||h(re,P,K)}}}function wU(o){const r=o.indexOf("x")!==-1,c=o.indexOf("y")!==-1;return function(h,p){const x=r?Math.abs(h.x-p.x):0,S=c?Math.abs(h.y-p.y):0;return Math.sqrt(Math.pow(x,2)+Math.pow(S,2))}}function M1(o,r,c,h,p){const x=[];return!p&&!o.isPointInArea(r)||Ib(o,c,r,function(i,M,P){!p&&!gP(i,o.chartArea,0)||i.inRange(r.x,r.y,h)&&x.push({element:i,datasetIndex:M,index:P})},!0),x}function SU(o,r,c,h){let p=[];function x(S,i,M){const{startAngle:P,endAngle:N}=S.getProps(["startAngle","endAngle"],h),{angle:H}=i5(S,{x:r.x,y:r.y});a5(H,P,N)&&p.push({element:S,datasetIndex:i,index:M})}return Ib(o,c,r,x),p}function TU(o,r,c,h,p,x){let S=[];const i=wU(c);let M=Number.POSITIVE_INFINITY;function P(N,H,W){const K=N.inRange(r.x,r.y,p);if(h&&!K)return;const re=N.getCenterPoint(p);if(!(!!x||o.isPointInArea(re))&&!K)return;const ce=i(r,re);ce<M?(S=[{element:N,datasetIndex:H,index:W}],M=ce):ce===M&&S.push({element:N,datasetIndex:H,index:W})}return Ib(o,c,r,P),S}function P1(o,r,c,h,p,x){return!x&&!o.isPointInArea(r)?[]:c==="r"&&!h?SU(o,r,c,p):TU(o,r,c,h,p,x)}function NA(o,r,c,h,p){const x=[],S=c==="x"?"inXRange":"inYRange";let i=!1;return Ib(o,c,r,(M,P,N)=>{M[S]&&M[S](r[c],p)&&(x.push({element:M,datasetIndex:P,index:N}),i=i||M.inRange(r.x,r.y,p))}),h&&!i?[]:x}var kU={modes:{index(o,r,c,h){const p=$g(r,o),x=c.axis||"x",S=c.includeInvisible||!1,i=c.intersect?M1(o,p,x,h,S):P1(o,p,x,!1,h,S),M=[];return i.length?(o.getSortedVisibleDatasetMetas().forEach(P=>{const N=i[0].index,H=P.data[N];H&&!H.skip&&M.push({element:H,datasetIndex:P.index,index:N})}),M):[]},dataset(o,r,c,h){const p=$g(r,o),x=c.axis||"xy",S=c.includeInvisible||!1;let i=c.intersect?M1(o,p,x,h,S):P1(o,p,x,!1,h,S);if(i.length>0){const M=i[0].datasetIndex,P=o.getDatasetMeta(M).data;i=[];for(let N=0;N<P.length;++N)i.push({element:P[N],datasetIndex:M,index:N})}return i},point(o,r,c,h){const p=$g(r,o),x=c.axis||"xy",S=c.includeInvisible||!1;return M1(o,p,x,h,S)},nearest(o,r,c,h){const p=$g(r,o),x=c.axis||"xy",S=c.includeInvisible||!1;return P1(o,p,x,c.intersect,h,S)},x(o,r,c,h){const p=$g(r,o);return NA(o,p,"x",c.intersect,h)},y(o,r,c,h){const p=$g(r,o);return NA(o,p,"y",c.intersect,h)}}};const MP=["left","top","right","bottom"];function Lv(o,r){return o.filter(c=>c.pos===r)}function FA(o,r){return o.filter(c=>MP.indexOf(c.pos)===-1&&c.box.axis===r)}function Ov(o,r){return o.sort((c,h)=>{const p=r?h:c,x=r?c:h;return p.weight===x.weight?p.index-x.index:p.weight-x.weight})}function EU(o){const r=[];let c,h,p,x,S,i;for(c=0,h=(o||[]).length;c<h;++c)p=o[c],{position:x,options:{stack:S,stackWeight:i=1}}=p,r.push({index:c,box:p,pos:x,horizontal:p.isHorizontal(),weight:p.weight,stack:S&&x+S,stackWeight:i});return r}function AU(o){const r={};for(const c of o){const{stack:h,pos:p,stackWeight:x}=c;if(!h||!MP.includes(p))continue;const S=r[h]||(r[h]={count:0,placed:0,weight:0,size:0});S.count++,S.weight+=x}return r}function CU(o,r){const c=AU(o),{vBoxMaxWidth:h,hBoxMaxHeight:p}=r;let x,S,i;for(x=0,S=o.length;x<S;++x){i=o[x];const{fullSize:M}=i.box,P=c[i.stack],N=P&&i.stackWeight/P.weight;i.horizontal?(i.width=N?N*h:M&&r.availableWidth,i.height=p):(i.width=h,i.height=N?N*p:M&&r.availableHeight)}return c}function MU(o){const r=EU(o),c=Ov(r.filter(P=>P.box.fullSize),!0),h=Ov(Lv(r,"left"),!0),p=Ov(Lv(r,"right")),x=Ov(Lv(r,"top"),!0),S=Ov(Lv(r,"bottom")),i=FA(r,"x"),M=FA(r,"y");return{fullSize:c,leftAndTop:h.concat(x),rightAndBottom:p.concat(M).concat(S).concat(i),chartArea:Lv(r,"chartArea"),vertical:h.concat(p).concat(M),horizontal:x.concat(S).concat(i)}}function BA(o,r,c,h){return Math.max(o[c],r[c])+Math.max(o[h],r[h])}function PP(o,r){o.top=Math.max(o.top,r.top),o.left=Math.max(o.left,r.left),o.bottom=Math.max(o.bottom,r.bottom),o.right=Math.max(o.right,r.right)}function PU(o,r,c,h){const{pos:p,box:x}=c,S=o.maxPadding;if(!jr(p)){c.size&&(o[p]-=c.size);const H=h[c.stack]||{size:0,count:1};H.size=Math.max(H.size,c.horizontal?x.height:x.width),c.size=H.size/H.count,o[p]+=c.size}x.getPadding&&PP(S,x.getPadding());const i=Math.max(0,r.outerWidth-BA(S,o,"left","right")),M=Math.max(0,r.outerHeight-BA(S,o,"top","bottom")),P=i!==o.w,N=M!==o.h;return o.w=i,o.h=M,c.horizontal?{same:P,other:N}:{same:N,other:P}}function jU(o){const r=o.maxPadding;function c(h){const p=Math.max(r[h]-o[h],0);return o[h]+=p,p}o.y+=c("top"),o.x+=c("left"),c("right"),c("bottom")}function zU(o,r){const c=r.maxPadding;function h(p){const x={left:0,top:0,right:0,bottom:0};return p.forEach(S=>{x[S]=Math.max(r[S],c[S])}),x}return h(o?["left","right"]:["top","bottom"])}function Hv(o,r,c,h){const p=[];let x,S,i,M,P,N;for(x=0,S=o.length,P=0;x<S;++x){i=o[x],M=i.box,M.update(i.width||r.w,i.height||r.h,zU(i.horizontal,r));const{same:H,other:W}=PU(r,c,i,h);P|=H&&p.length,N=N||W,M.fullSize||p.push(i)}return P&&Hv(p,r,c,h)||N}function V0(o,r,c,h,p){o.top=c,o.left=r,o.right=r+h,o.bottom=c+p,o.width=h,o.height=p}function UA(o,r,c,h){const p=c.padding;let{x,y:S}=r;for(const i of o){const M=i.box,P=h[i.stack]||{placed:0,weight:1},N=i.stackWeight/P.weight||1;if(i.horizontal){const H=r.w*N,W=P.size||M.height;lx(P.start)&&(S=P.start),M.fullSize?V0(M,p.left,S,c.outerWidth-p.right-p.left,W):V0(M,r.left+P.placed,S,H,W),P.start=S,P.placed+=H,S=M.bottom}else{const H=r.h*N,W=P.size||M.width;lx(P.start)&&(x=P.start),M.fullSize?V0(M,x,p.top,W,c.outerHeight-p.bottom-p.top):V0(M,x,r.top+P.placed,W,H),P.start=x,P.placed+=H,x=M.right}}r.x=x,r.y=S}var Lp={addBox(o,r){o.boxes||(o.boxes=[]),r.fullSize=r.fullSize||!1,r.position=r.position||"top",r.weight=r.weight||0,r._layers=r._layers||function(){return[{z:0,draw(c){r.draw(c)}}]},o.boxes.push(r)},removeBox(o,r){const c=o.boxes?o.boxes.indexOf(r):-1;c!==-1&&o.boxes.splice(c,1)},configure(o,r,c){r.fullSize=c.fullSize,r.position=c.position,r.weight=c.weight},update(o,r,c,h){if(!o)return;const p=Sh(o.options.layout.padding),x=Math.max(r-p.width,0),S=Math.max(c-p.height,0),i=MU(o.boxes),M=i.vertical,P=i.horizontal;Yr(o.boxes,ae=>{typeof ae.beforeLayout=="function"&&ae.beforeLayout()});const N=M.reduce((ae,ce)=>ce.box.options&&ce.box.options.display===!1?ae:ae+1,0)||1,H=Object.freeze({outerWidth:r,outerHeight:c,padding:p,availableWidth:x,availableHeight:S,vBoxMaxWidth:x/2/N,hBoxMaxHeight:S/2}),W=Object.assign({},p);PP(W,Sh(h));const K=Object.assign({maxPadding:W,w:x,h:S,x:p.left,y:p.top},p),re=CU(M.concat(P),H);Hv(i.fullSize,K,H,re),Hv(M,K,H,re),Hv(P,K,H,re)&&Hv(M,K,H,re),jU(K),UA(i.leftAndTop,K,H,re),K.x+=K.w,K.y+=K.h,UA(i.rightAndBottom,K,H,re),o.chartArea={left:K.left,top:K.top,right:K.left+K.w,bottom:K.top+K.h,height:K.h,width:K.w},Yr(i.chartArea,ae=>{const ce=ae.box;Object.assign(ce,o.chartArea),ce.update(K.w,K.h,{left:0,top:0,right:0,bottom:0})})}};class jP{acquireContext(r,c){}releaseContext(r){return!1}addEventListener(r,c,h){}removeEventListener(r,c,h){}getDevicePixelRatio(){return 1}getMaximumSize(r,c,h,p){return c=Math.max(0,c||r.width),h=h||r.height,{width:c,height:Math.max(0,p?Math.floor(c/p):h)}}isAttached(r){return!0}updateConfig(r){}}class IU extends jP{acquireContext(r){return r&&r.getContext&&r.getContext("2d")||null}updateConfig(r){r.options.animation=!1}}const ob="$chartjs",RU={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},$A=o=>o===null||o==="";function DU(o,r){const c=o.style,h=o.getAttribute("height"),p=o.getAttribute("width");if(o[ob]={initial:{height:h,width:p,style:{display:c.display,height:c.height,width:c.width}}},c.display=c.display||"block",c.boxSizing=c.boxSizing||"border-box",$A(p)){const x=CA(o,"width");x!==void 0&&(o.width=x)}if($A(h))if(o.style.height==="")o.height=o.width/(r||2);else{const x=CA(o,"height");x!==void 0&&(o.height=x)}return o}const zP=H5?{passive:!0}:!1;function LU(o,r,c){o&&o.addEventListener(r,c,zP)}function OU(o,r,c){o&&o.canvas&&o.canvas.removeEventListener(r,c,zP)}function NU(o,r){const c=RU[o.type]||o.type,{x:h,y:p}=$g(o,r);return{type:c,chart:r,native:o,x:h!==void 0?h:null,y:p!==void 0?p:null}}function Ab(o,r){for(const c of o)if(c===r||c.contains(r))return!0}function FU(o,r,c){const h=o.canvas,p=new MutationObserver(x=>{let S=!1;for(const i of x)S=S||Ab(i.addedNodes,h),S=S&&!Ab(i.removedNodes,h);S&&c()});return p.observe(document,{childList:!0,subtree:!0}),p}function BU(o,r,c){const h=o.canvas,p=new MutationObserver(x=>{let S=!1;for(const i of x)S=S||Ab(i.removedNodes,h),S=S&&!Ab(i.addedNodes,h);S&&c()});return p.observe(document,{childList:!0,subtree:!0}),p}const cx=new Map;let VA=0;function IP(){const o=window.devicePixelRatio;o!==VA&&(VA=o,cx.forEach((r,c)=>{c.currentDevicePixelRatio!==o&&r()}))}function UU(o,r){cx.size||window.addEventListener("resize",IP),cx.set(o,r)}function $U(o){cx.delete(o),cx.size||window.removeEventListener("resize",IP)}function VU(o,r,c){const h=o.canvas,p=h&&US(h);if(!p)return;const x=uP((i,M)=>{const P=p.clientWidth;c(i,M),P<p.clientWidth&&c()},window),S=new ResizeObserver(i=>{const M=i[0],P=M.contentRect.width,N=M.contentRect.height;P===0&&N===0||x(P,N)});return S.observe(p),UU(o,x),S}function j1(o,r,c){c&&c.disconnect(),r==="resize"&&$U(o)}function HU(o,r,c){const h=o.canvas,p=uP(x=>{o.ctx!==null&&c(NU(x,o))},o);return LU(h,r,p),p}class GU extends jP{acquireContext(r,c){const h=r&&r.getContext&&r.getContext("2d");return h&&h.canvas===r?(DU(r,c),h):null}releaseContext(r){const c=r.canvas;if(!c[ob])return!1;const h=c[ob].initial;["height","width"].forEach(x=>{const S=h[x];cs(S)?c.removeAttribute(x):c.setAttribute(x,S)});const p=h.style||{};return Object.keys(p).forEach(x=>{c.style[x]=p[x]}),c.width=c.width,delete c[ob],!0}addEventListener(r,c,h){this.removeEventListener(r,c);const p=r.$proxies||(r.$proxies={}),S={attach:FU,detach:BU,resize:VU}[c]||HU;p[c]=S(r,c,h)}removeEventListener(r,c){const h=r.$proxies||(r.$proxies={}),p=h[c];if(!p)return;({attach:j1,detach:j1,resize:j1}[c]||OU)(r,c,p),h[c]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(r,c,h,p){return V5(r,c,h,p)}isAttached(r){const c=r&&US(r);return!!(c&&c.isConnected)}}function qU(o){return!BS()||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas?IU:GU}let _x=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(r){const{x:c,y:h}=this.getProps(["x","y"],r);return{x:c,y:h}}hasValue(){return Sb(this.x)&&Sb(this.y)}getProps(r,c){const h=this.$animations;if(!c||!h)return this;const p={};return r.forEach(x=>{p[x]=h[x]&&h[x].active()?h[x]._to:this[x]}),p}};function WU(o,r){const c=o.options.ticks,h=ZU(o),p=Math.min(c.maxTicksLimit||h,h),x=c.major.enabled?YU(r):[],S=x.length,i=x[0],M=x[S-1],P=[];if(S>p)return KU(r,P,x,S/p),P;const N=XU(x,r,p);if(S>0){let H,W;const K=S>1?Math.round((M-i)/(S-1)):null;for(H0(r,P,N,cs(K)?0:i-K,i),H=0,W=S-1;H<W;H++)H0(r,P,N,x[H],x[H+1]);return H0(r,P,N,M,cs(K)?r.length:M+K),P}return H0(r,P,N),P}function ZU(o){const r=o.options.offset,c=o._tickSize(),h=o._length/c+(r?0:1),p=o._maxLength/c;return Math.floor(Math.min(h,p))}function XU(o,r,c){const h=JU(o),p=r.length/c;if(!h)return Math.max(p,1);const x=K4(h);for(let S=0,i=x.length-1;S<i;S++){const M=x[S];if(M>p)return M}return Math.max(p,1)}function YU(o){const r=[];let c,h;for(c=0,h=o.length;c<h;c++)o[c].major&&r.push(c);return r}function KU(o,r,c,h){let p=0,x=c[0],S;for(h=Math.ceil(h),S=0;S<o.length;S++)S===x&&(r.push(o[S]),p++,x=c[p*h])}function H0(o,r,c,h,p){const x=Nr(h,0),S=Math.min(Nr(p,o.length),o.length);let i=0,M,P,N;for(c=Math.ceil(c),p&&(M=p-h,c=M/Math.floor(M/c)),N=x;N<0;)i++,N=Math.round(x+i*c);for(P=Math.max(x,0);P<S;P++)P===N&&(r.push(o[P]),i++,N=Math.round(x+i*c))}function JU(o){const r=o.length;let c,h;if(r<2)return!1;for(h=o[0],c=1;c<r;++c)if(o[c]-o[c-1]!==h)return!1;return h}const QU=o=>o==="left"?"right":o==="right"?"left":o,HA=(o,r,c)=>r==="top"||r==="left"?o[r]+c:o[r]-c,GA=(o,r)=>Math.min(r||o,o);function qA(o,r){const c=[],h=o.length/r,p=o.length;let x=0;for(;x<p;x+=h)c.push(o[Math.floor(x)]);return c}function e$(o,r,c){const h=o.ticks.length,p=Math.min(r,h-1),x=o._startPixel,S=o._endPixel,i=1e-6;let M=o.getPixelForTick(p),P;if(!(c&&(h===1?P=Math.max(M-x,S-M):r===0?P=(o.getPixelForTick(1)-M)/2:P=(M-o.getPixelForTick(p-1))/2,M+=p<r?P:-P,M<x-i||M>S+i)))return M}function t$(o,r){Yr(o,c=>{const h=c.gc,p=h.length/2;let x;if(p>r){for(x=0;x<p;++x)delete c.data[h[x]];h.splice(0,p)}})}function Nv(o){return o.drawTicks?o.tickLength:0}function WA(o,r){if(!o.display)return 0;const c=xu(o.font,r),h=Sh(o.padding);return(Rl(o.text)?o.text.length:1)*c.lineHeight+h.height}function i$(o,r){return Sy(o,{scale:r,type:"scale"})}function n$(o,r,c){return Sy(o,{tick:c,index:r,type:"tick"})}function a$(o,r,c){let h=dP(o);return(c&&r!=="right"||!c&&r==="right")&&(h=QU(h)),h}function r$(o,r,c,h){const{top:p,left:x,bottom:S,right:i,chart:M}=o,{chartArea:P,scales:N}=M;let H=0,W,K,re;const ae=S-p,ce=i-x;if(o.isHorizontal()){if(K=Gu(h,x,i),jr(c)){const ve=Object.keys(c)[0],Se=c[ve];re=N[ve].getPixelForValue(Se)+ae-r}else c==="center"?re=(P.bottom+P.top)/2+ae-r:re=HA(o,c,r);W=i-x}else{if(jr(c)){const ve=Object.keys(c)[0],Se=c[ve];K=N[ve].getPixelForValue(Se)-ce+r}else c==="center"?K=(P.left+P.right)/2-ce+r:K=HA(o,c,r);re=Gu(h,S,p),H=c==="left"?-bh:bh}return{titleX:K,titleY:re,maxWidth:W,rotation:H}}class Ty extends _x{constructor(r){super(),this.id=r.id,this.type=r.type,this.options=void 0,this.ctx=r.ctx,this.chart=r.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(r){this.options=r.setContext(this.getContext()),this.axis=r.axis,this._userMin=this.parse(r.min),this._userMax=this.parse(r.max),this._suggestedMin=this.parse(r.suggestedMin),this._suggestedMax=this.parse(r.suggestedMax)}parse(r,c){return r}getUserBounds(){let{_userMin:r,_userMax:c,_suggestedMin:h,_suggestedMax:p}=this;return r=mf(r,Number.POSITIVE_INFINITY),c=mf(c,Number.NEGATIVE_INFINITY),h=mf(h,Number.POSITIVE_INFINITY),p=mf(p,Number.NEGATIVE_INFINITY),{min:mf(r,h),max:mf(c,p),minDefined:Nd(r),maxDefined:Nd(c)}}getMinMax(r){let{min:c,max:h,minDefined:p,maxDefined:x}=this.getUserBounds(),S;if(p&&x)return{min:c,max:h};const i=this.getMatchingVisibleMetas();for(let M=0,P=i.length;M<P;++M)S=i[M].controller.getMinMax(this,r),p||(c=Math.min(c,S.min)),x||(h=Math.max(h,S.max));return c=x&&c>h?h:c,h=p&&c>h?c:h,{min:mf(c,mf(h,c)),max:mf(h,mf(c,h))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const r=this.chart.data;return this.options.labels||(this.isHorizontal()?r.xLabels:r.yLabels)||r.labels||[]}getLabelItems(r=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(r))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ms(this.options.beforeUpdate,[this])}update(r,c,h){const{beginAtZero:p,grace:x,ticks:S}=this.options,i=S.sampleSize;this.beforeUpdate(),this.maxWidth=r,this.maxHeight=c,this._margins=h=Object.assign({left:0,right:0,top:0,bottom:0},h),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+h.left+h.right:this.height+h.top+h.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=C5(this,x,p),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const M=i<this.ticks.length;this._convertTicksToLabels(M?qA(this.ticks,i):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),S.display&&(S.autoSkip||S.source==="auto")&&(this.ticks=WU(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),M&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let r=this.options.reverse,c,h;this.isHorizontal()?(c=this.left,h=this.right):(c=this.top,h=this.bottom,r=!r),this._startPixel=c,this._endPixel=h,this._reversePixels=r,this._length=h-c,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ms(this.options.afterUpdate,[this])}beforeSetDimensions(){Ms(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ms(this.options.afterSetDimensions,[this])}_callHooks(r){this.chart.notifyPlugins(r,this.getContext()),Ms(this.options[r],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ms(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(r){const c=this.options.ticks;let h,p,x;for(h=0,p=r.length;h<p;h++)x=r[h],x.label=Ms(c.callback,[x.value,h,r],this)}afterTickToLabelConversion(){Ms(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ms(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const r=this.options,c=r.ticks,h=GA(this.ticks.length,r.ticks.maxTicksLimit),p=c.minRotation||0,x=c.maxRotation;let S=p,i,M,P;if(!this._isVisible()||!c.display||p>=x||h<=1||!this.isHorizontal()){this.labelRotation=p;return}const N=this._getLabelSizes(),H=N.widest.width,W=N.highest.height,K=wh(this.chart.width-H,0,this.maxWidth);i=r.offset?this.maxWidth/h:K/(h-1),H+6>i&&(i=K/(h-(r.offset?.5:1)),M=this.maxHeight-Nv(r.grid)-c.padding-WA(r.title,this.chart.options.font),P=Math.sqrt(H*H+W*W),S=t5(Math.min(Math.asin(wh((N.highest.height+6)/i,-1,1)),Math.asin(wh(M/P,-1,1))-Math.asin(wh(W/P,-1,1)))),S=Math.max(p,Math.min(x,S))),this.labelRotation=S}afterCalculateLabelRotation(){Ms(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ms(this.options.beforeFit,[this])}fit(){const r={width:0,height:0},{chart:c,options:{ticks:h,title:p,grid:x}}=this,S=this._isVisible(),i=this.isHorizontal();if(S){const M=WA(p,c.options.font);if(i?(r.width=this.maxWidth,r.height=Nv(x)+M):(r.height=this.maxHeight,r.width=Nv(x)+M),h.display&&this.ticks.length){const{first:P,last:N,widest:H,highest:W}=this._getLabelSizes(),K=h.padding*2,re=Wg(this.labelRotation),ae=Math.cos(re),ce=Math.sin(re);if(i){const ve=h.mirror?0:ce*H.width+ae*W.height;r.height=Math.min(this.maxHeight,r.height+ve+K)}else{const ve=h.mirror?0:ae*H.width+ce*W.height;r.width=Math.min(this.maxWidth,r.width+ve+K)}this._calculatePadding(P,N,ce,ae)}}this._handleMargins(),i?(this.width=this._length=c.width-this._margins.left-this._margins.right,this.height=r.height):(this.width=r.width,this.height=this._length=c.height-this._margins.top-this._margins.bottom)}_calculatePadding(r,c,h,p){const{ticks:{align:x,padding:S},position:i}=this.options,M=this.labelRotation!==0,P=i!=="top"&&this.axis==="x";if(this.isHorizontal()){const N=this.getPixelForTick(0)-this.left,H=this.right-this.getPixelForTick(this.ticks.length-1);let W=0,K=0;M?P?(W=p*r.width,K=h*c.height):(W=h*r.height,K=p*c.width):x==="start"?K=c.width:x==="end"?W=r.width:x!=="inner"&&(W=r.width/2,K=c.width/2),this.paddingLeft=Math.max((W-N+S)*this.width/(this.width-N),0),this.paddingRight=Math.max((K-H+S)*this.width/(this.width-H),0)}else{let N=c.height/2,H=r.height/2;x==="start"?(N=0,H=r.height):x==="end"&&(N=c.height,H=0),this.paddingTop=N+S,this.paddingBottom=H+S}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ms(this.options.afterFit,[this])}isHorizontal(){const{axis:r,position:c}=this.options;return c==="top"||c==="bottom"||r==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(r){this.beforeTickToLabelConversion(),this.generateTickLabels(r);let c,h;for(c=0,h=r.length;c<h;c++)cs(r[c].label)&&(r.splice(c,1),h--,c--);this.afterTickToLabelConversion()}_getLabelSizes(){let r=this._labelSizes;if(!r){const c=this.options.ticks.sampleSize;let h=this.ticks;c<h.length&&(h=qA(h,c)),this._labelSizes=r=this._computeLabelSizes(h,h.length,this.options.ticks.maxTicksLimit)}return r}_computeLabelSizes(r,c,h){const{ctx:p,_longestTextCache:x}=this,S=[],i=[],M=Math.floor(c/GA(c,h));let P=0,N=0,H,W,K,re,ae,ce,ve,Se,Ee,Qe,He;for(H=0;H<c;H+=M){if(re=r[H].label,ae=this._resolveTickFontOptions(H),p.font=ce=ae.string,ve=x[ce]=x[ce]||{data:{},gc:[]},Se=ae.lineHeight,Ee=Qe=0,!cs(re)&&!Rl(re))Ee=wA(p,ve.data,ve.gc,Ee,re),Qe=Se;else if(Rl(re))for(W=0,K=re.length;W<K;++W)He=re[W],!cs(He)&&!Rl(He)&&(Ee=wA(p,ve.data,ve.gc,Ee,He),Qe+=Se);S.push(Ee),i.push(Qe),P=Math.max(Ee,P),N=Math.max(Qe,N)}t$(x,c);const ke=S.indexOf(P),tt=i.indexOf(N),Ke=lt=>({width:S[lt]||0,height:i[lt]||0});return{first:Ke(0),last:Ke(c-1),widest:Ke(ke),highest:Ke(tt),widths:S,heights:i}}getLabelForValue(r){return r}getPixelForValue(r,c){return NaN}getValueForPixel(r){}getPixelForTick(r){const c=this.ticks;return r<0||r>c.length-1?null:this.getPixelForValue(c[r].value)}getPixelForDecimal(r){this._reversePixels&&(r=1-r);const c=this._startPixel+r*this._length;return r5(this._alignToPixels?Fg(this.chart,c,0):c)}getDecimalForPixel(r){const c=(r-this._startPixel)/this._length;return this._reversePixels?1-c:c}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:r,max:c}=this;return r<0&&c<0?c:r>0&&c>0?r:0}getContext(r){const c=this.ticks||[];if(r>=0&&r<c.length){const h=c[r];return h.$context||(h.$context=n$(this.getContext(),r,h))}return this.$context||(this.$context=i$(this.chart.getContext(),this))}_tickSize(){const r=this.options.ticks,c=Wg(this.labelRotation),h=Math.abs(Math.cos(c)),p=Math.abs(Math.sin(c)),x=this._getLabelSizes(),S=r.autoSkipPadding||0,i=x?x.widest.width+S:0,M=x?x.highest.height+S:0;return this.isHorizontal()?M*h>i*p?i/h:M/p:M*p<i*h?M/h:i/p}_isVisible(){const r=this.options.display;return r!=="auto"?!!r:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(r){const c=this.axis,h=this.chart,p=this.options,{grid:x,position:S,border:i}=p,M=x.offset,P=this.isHorizontal(),H=this.ticks.length+(M?1:0),W=Nv(x),K=[],re=i.setContext(this.getContext()),ae=re.display?re.width:0,ce=ae/2,ve=function(We){return Fg(h,We,ae)};let Se,Ee,Qe,He,ke,tt,Ke,lt,ft,gt,ni,Ft;if(S==="top")Se=ve(this.bottom),tt=this.bottom-W,lt=Se-ce,gt=ve(r.top)+ce,Ft=r.bottom;else if(S==="bottom")Se=ve(this.top),gt=r.top,Ft=ve(r.bottom)-ce,tt=Se+ce,lt=this.top+W;else if(S==="left")Se=ve(this.right),ke=this.right-W,Ke=Se-ce,ft=ve(r.left)+ce,ni=r.right;else if(S==="right")Se=ve(this.left),ft=r.left,ni=ve(r.right)-ce,ke=Se+ce,Ke=this.left+W;else if(c==="x"){if(S==="center")Se=ve((r.top+r.bottom)/2+.5);else if(jr(S)){const We=Object.keys(S)[0],Et=S[We];Se=ve(this.chart.scales[We].getPixelForValue(Et))}gt=r.top,Ft=r.bottom,tt=Se+ce,lt=tt+W}else if(c==="y"){if(S==="center")Se=ve((r.left+r.right)/2);else if(jr(S)){const We=Object.keys(S)[0],Et=S[We];Se=ve(this.chart.scales[We].getPixelForValue(Et))}ke=Se-ce,Ke=ke-W,ft=r.left,ni=r.right}const Vi=Nr(p.ticks.maxTicksLimit,H),Ri=Math.max(1,Math.ceil(H/Vi));for(Ee=0;Ee<H;Ee+=Ri){const We=this.getContext(Ee),Et=x.setContext(We),jt=i.setContext(We),Gi=Et.lineWidth,Ce=Et.color,_t=jt.dash||[],At=jt.dashOffset,Ct=Et.tickWidth,oi=Et.tickColor,Ci=Et.tickBorderDash||[],li=Et.tickBorderDashOffset;Qe=e$(this,Ee,M),Qe!==void 0&&(He=Fg(h,Qe,Gi),P?ke=Ke=ft=ni=He:tt=lt=gt=Ft=He,K.push({tx1:ke,ty1:tt,tx2:Ke,ty2:lt,x1:ft,y1:gt,x2:ni,y2:Ft,width:Gi,color:Ce,borderDash:_t,borderDashOffset:At,tickWidth:Ct,tickColor:oi,tickBorderDash:Ci,tickBorderDashOffset:li}))}return this._ticksLength=H,this._borderValue=Se,K}_computeLabelItems(r){const c=this.axis,h=this.options,{position:p,ticks:x}=h,S=this.isHorizontal(),i=this.ticks,{align:M,crossAlign:P,padding:N,mirror:H}=x,W=Nv(h.grid),K=W+N,re=H?-N:K,ae=-Wg(this.labelRotation),ce=[];let ve,Se,Ee,Qe,He,ke,tt,Ke,lt,ft,gt,ni,Ft="middle";if(p==="top")ke=this.bottom-re,tt=this._getXAxisLabelAlignment();else if(p==="bottom")ke=this.top+re,tt=this._getXAxisLabelAlignment();else if(p==="left"){const Ri=this._getYAxisLabelAlignment(W);tt=Ri.textAlign,He=Ri.x}else if(p==="right"){const Ri=this._getYAxisLabelAlignment(W);tt=Ri.textAlign,He=Ri.x}else if(c==="x"){if(p==="center")ke=(r.top+r.bottom)/2+K;else if(jr(p)){const Ri=Object.keys(p)[0],We=p[Ri];ke=this.chart.scales[Ri].getPixelForValue(We)+K}tt=this._getXAxisLabelAlignment()}else if(c==="y"){if(p==="center")He=(r.left+r.right)/2-K;else if(jr(p)){const Ri=Object.keys(p)[0],We=p[Ri];He=this.chart.scales[Ri].getPixelForValue(We)}tt=this._getYAxisLabelAlignment(W).textAlign}c==="y"&&(M==="start"?Ft="top":M==="end"&&(Ft="bottom"));const Vi=this._getLabelSizes();for(ve=0,Se=i.length;ve<Se;++ve){Ee=i[ve],Qe=Ee.label;const Ri=x.setContext(this.getContext(ve));Ke=this.getPixelForTick(ve)+x.labelOffset,lt=this._resolveTickFontOptions(ve),ft=lt.lineHeight,gt=Rl(Qe)?Qe.length:1;const We=gt/2,Et=Ri.color,jt=Ri.textStrokeColor,Gi=Ri.textStrokeWidth;let Ce=tt;S?(He=Ke,tt==="inner"&&(ve===Se-1?Ce=this.options.reverse?"left":"right":ve===0?Ce=this.options.reverse?"right":"left":Ce="center"),p==="top"?P==="near"||ae!==0?ni=-gt*ft+ft/2:P==="center"?ni=-Vi.highest.height/2-We*ft+ft:ni=-Vi.highest.height+ft/2:P==="near"||ae!==0?ni=ft/2:P==="center"?ni=Vi.highest.height/2-We*ft:ni=Vi.highest.height-gt*ft,H&&(ni*=-1),ae!==0&&!Ri.showLabelBackdrop&&(He+=ft/2*Math.sin(ae))):(ke=Ke,ni=(1-gt)*ft/2);let _t;if(Ri.showLabelBackdrop){const At=Sh(Ri.backdropPadding),Ct=Vi.heights[ve],oi=Vi.widths[ve];let Ci=ni-At.top,li=0-At.left;switch(Ft){case"middle":Ci-=Ct/2;break;case"bottom":Ci-=Ct;break}switch(tt){case"center":li-=oi/2;break;case"right":li-=oi;break;case"inner":ve===Se-1?li-=oi:ve>0&&(li-=oi/2);break}_t={left:li,top:Ci,width:oi+At.width,height:Ct+At.height,color:Ri.backdropColor}}ce.push({label:Qe,font:lt,textOffset:ni,options:{rotation:ae,color:Et,strokeColor:jt,strokeWidth:Gi,textAlign:Ce,textBaseline:Ft,translation:[He,ke],backdrop:_t}})}return ce}_getXAxisLabelAlignment(){const{position:r,ticks:c}=this.options;if(-Wg(this.labelRotation))return r==="top"?"left":"right";let p="center";return c.align==="start"?p="left":c.align==="end"?p="right":c.align==="inner"&&(p="inner"),p}_getYAxisLabelAlignment(r){const{position:c,ticks:{crossAlign:h,mirror:p,padding:x}}=this.options,S=this._getLabelSizes(),i=r+x,M=S.widest.width;let P,N;return c==="left"?p?(N=this.right+x,h==="near"?P="left":h==="center"?(P="center",N+=M/2):(P="right",N+=M)):(N=this.right-i,h==="near"?P="right":h==="center"?(P="center",N-=M/2):(P="left",N=this.left)):c==="right"?p?(N=this.left+x,h==="near"?P="right":h==="center"?(P="center",N-=M/2):(P="left",N-=M)):(N=this.left+i,h==="near"?P="left":h==="center"?(P="center",N+=M/2):(P="right",N=this.right)):P="right",{textAlign:P,x:N}}_computeLabelArea(){if(this.options.ticks.mirror)return;const r=this.chart,c=this.options.position;if(c==="left"||c==="right")return{top:0,left:this.left,bottom:r.height,right:this.right};if(c==="top"||c==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:r.width}}drawBackground(){const{ctx:r,options:{backgroundColor:c},left:h,top:p,width:x,height:S}=this;c&&(r.save(),r.fillStyle=c,r.fillRect(h,p,x,S),r.restore())}getLineWidthForValue(r){const c=this.options.grid;if(!this._isVisible()||!c.display)return 0;const p=this.ticks.findIndex(x=>x.value===r);return p>=0?c.setContext(this.getContext(p)).lineWidth:0}drawGrid(r){const c=this.options.grid,h=this.ctx,p=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(r));let x,S;const i=(M,P,N)=>{!N.width||!N.color||(h.save(),h.lineWidth=N.width,h.strokeStyle=N.color,h.setLineDash(N.borderDash||[]),h.lineDashOffset=N.borderDashOffset,h.beginPath(),h.moveTo(M.x,M.y),h.lineTo(P.x,P.y),h.stroke(),h.restore())};if(c.display)for(x=0,S=p.length;x<S;++x){const M=p[x];c.drawOnChartArea&&i({x:M.x1,y:M.y1},{x:M.x2,y:M.y2},M),c.drawTicks&&i({x:M.tx1,y:M.ty1},{x:M.tx2,y:M.ty2},{color:M.tickColor,width:M.tickWidth,borderDash:M.tickBorderDash,borderDashOffset:M.tickBorderDashOffset})}}drawBorder(){const{chart:r,ctx:c,options:{border:h,grid:p}}=this,x=h.setContext(this.getContext()),S=h.display?x.width:0;if(!S)return;const i=p.setContext(this.getContext(0)).lineWidth,M=this._borderValue;let P,N,H,W;this.isHorizontal()?(P=Fg(r,this.left,S)-S/2,N=Fg(r,this.right,i)+i/2,H=W=M):(H=Fg(r,this.top,S)-S/2,W=Fg(r,this.bottom,i)+i/2,P=N=M),c.save(),c.lineWidth=x.width,c.strokeStyle=x.color,c.beginPath(),c.moveTo(P,H),c.lineTo(N,W),c.stroke(),c.restore()}drawLabels(r){if(!this.options.ticks.display)return;const h=this.ctx,p=this._computeLabelArea();p&&DS(h,p);const x=this.getLabelItems(r);for(const S of x){const i=S.options,M=S.font,P=S.label,N=S.textOffset;Tb(h,P,0,N,M,i)}p&&LS(h)}drawTitle(){const{ctx:r,options:{position:c,title:h,reverse:p}}=this;if(!h.display)return;const x=xu(h.font),S=Sh(h.padding),i=h.align;let M=x.lineHeight/2;c==="bottom"||c==="center"||jr(c)?(M+=S.bottom,Rl(h.text)&&(M+=x.lineHeight*(h.text.length-1))):M+=S.top;const{titleX:P,titleY:N,maxWidth:H,rotation:W}=r$(this,M,c,i);Tb(r,h.text,0,0,x,{color:h.color,maxWidth:H,rotation:W,textAlign:a$(i,c,p),textBaseline:"middle",translation:[P,N]})}draw(r){this._isVisible()&&(this.drawBackground(),this.drawGrid(r),this.drawBorder(),this.drawTitle(),this.drawLabels(r))}_layers(){const r=this.options,c=r.ticks&&r.ticks.z||0,h=Nr(r.grid&&r.grid.z,-1),p=Nr(r.border&&r.border.z,0);return!this._isVisible()||this.draw!==Ty.prototype.draw?[{z:c,draw:x=>{this.draw(x)}}]:[{z:h,draw:x=>{this.drawBackground(),this.drawGrid(x),this.drawTitle()}},{z:p,draw:()=>{this.drawBorder()}},{z:c,draw:x=>{this.drawLabels(x)}}]}getMatchingVisibleMetas(r){const c=this.chart.getSortedVisibleDatasetMetas(),h=this.axis+"AxisID",p=[];let x,S;for(x=0,S=c.length;x<S;++x){const i=c[x];i[h]===this.id&&(!r||i.type===r)&&p.push(i)}return p}_resolveTickFontOptions(r){const c=this.options.ticks.setContext(this.getContext(r));return xu(c.font)}_maxDigits(){const r=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/r}}class G0{constructor(r,c,h){this.type=r,this.scope=c,this.override=h,this.items=Object.create(null)}isForType(r){return Object.prototype.isPrototypeOf.call(this.type.prototype,r.prototype)}register(r){const c=Object.getPrototypeOf(r);let h;l$(c)&&(h=this.register(c));const p=this.items,x=r.id,S=this.scope+"."+x;if(!x)throw new Error("class does not have id: "+r);return x in p||(p[x]=r,s$(r,S,h),this.override&&Po.override(r.id,r.overrides)),S}get(r){return this.items[r]}unregister(r){const c=this.items,h=r.id,p=this.scope;h in c&&delete c[h],p&&h in Po[p]&&(delete Po[p][h],this.override&&delete Yg[h])}}function s$(o,r,c){const h=ox(Object.create(null),[c?Po.get(c):{},Po.get(r),o.defaults]);Po.set(r,h),o.defaultRoutes&&o$(r,o.defaultRoutes),o.descriptors&&Po.describe(r,o.descriptors)}function o$(o,r){Object.keys(r).forEach(c=>{const h=c.split("."),p=h.pop(),x=[o].concat(h).join("."),S=r[c].split("."),i=S.pop(),M=S.join(".");Po.route(x,p,M,i)})}function l$(o){return"id"in o&&"defaults"in o}class c${constructor(){this.controllers=new G0(AP,"datasets",!0),this.elements=new G0(_x,"elements"),this.plugins=new G0(Object,"plugins"),this.scales=new G0(Ty,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...r){this._each("register",r)}remove(...r){this._each("unregister",r)}addControllers(...r){this._each("register",r,this.controllers)}addElements(...r){this._each("register",r,this.elements)}addPlugins(...r){this._each("register",r,this.plugins)}addScales(...r){this._each("register",r,this.scales)}getController(r){return this._get(r,this.controllers,"controller")}getElement(r){return this._get(r,this.elements,"element")}getPlugin(r){return this._get(r,this.plugins,"plugin")}getScale(r){return this._get(r,this.scales,"scale")}removeControllers(...r){this._each("unregister",r,this.controllers)}removeElements(...r){this._each("unregister",r,this.elements)}removePlugins(...r){this._each("unregister",r,this.plugins)}removeScales(...r){this._each("unregister",r,this.scales)}_each(r,c,h){[...c].forEach(p=>{const x=h||this._getRegistryForType(p);h||x.isForType(p)||x===this.plugins&&p.id?this._exec(r,x,p):Yr(p,S=>{const i=h||this._getRegistryForType(S);this._exec(r,i,S)})})}_exec(r,c,h){const p=IS(r);Ms(h["before"+p],[],h),c[r](h),Ms(h["after"+p],[],h)}_getRegistryForType(r){for(let c=0;c<this._typedRegistries.length;c++){const h=this._typedRegistries[c];if(h.isForType(r))return h}return this.plugins}_get(r,c,h){const p=c.get(r);if(p===void 0)throw new Error('"'+r+'" is not a registered '+h+".");return p}}var _f=new c$;class u${constructor(){this._init=void 0}notify(r,c,h,p){if(c==="beforeInit"&&(this._init=this._createDescriptors(r,!0),this._notify(this._init,r,"install")),this._init===void 0)return;const x=p?this._descriptors(r).filter(p):this._descriptors(r),S=this._notify(x,r,c,h);return c==="afterDestroy"&&(this._notify(x,r,"stop"),this._notify(this._init,r,"uninstall"),this._init=void 0),S}_notify(r,c,h,p){p=p||{};for(const x of r){const S=x.plugin,i=S[h],M=[c,p,x.options];if(Ms(i,M,S)===!1&&p.cancelable)return!1}return!0}invalidate(){cs(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(r){if(this._cache)return this._cache;const c=this._cache=this._createDescriptors(r);return this._notifyStateChanges(r),c}_createDescriptors(r,c){const h=r&&r.config,p=Nr(h.options&&h.options.plugins,{}),x=d$(h);return p===!1&&!c?[]:f$(r,x,p,c)}_notifyStateChanges(r){const c=this._oldCache||[],h=this._cache,p=(x,S)=>x.filter(i=>!S.some(M=>i.plugin.id===M.plugin.id));this._notify(p(c,h),r,"stop"),this._notify(p(h,c),r,"start")}}function d$(o){const r={},c=[],h=Object.keys(_f.plugins.items);for(let x=0;x<h.length;x++)c.push(_f.getPlugin(h[x]));const p=o.plugins||[];for(let x=0;x<p.length;x++){const S=p[x];c.indexOf(S)===-1&&(c.push(S),r[S.id]=!0)}return{plugins:c,localIds:r}}function h$(o,r){return!r&&o===!1?null:o===!0?{}:o}function f$(o,{plugins:r,localIds:c},h,p){const x=[],S=o.getContext();for(const i of r){const M=i.id,P=h$(h[M],p);P!==null&&x.push({plugin:i,options:m$(o.config,{plugin:i,local:c[M]},P,S)})}return x}function m$(o,{plugin:r,local:c},h,p){const x=o.pluginScopeKeys(r),S=o.getOptionScopes(h,x);return c&&r.defaults&&S.push(r.defaults),o.createResolver(S,p,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function aS(o,r){const c=Po.datasets[o]||{};return((r.datasets||{})[o]||{}).indexAxis||r.indexAxis||c.indexAxis||"x"}function p$(o,r){let c=o;return o==="_index_"?c=r:o==="_value_"&&(c=r==="x"?"y":"x"),c}function g$(o,r){return o===r?"_index_":"_value_"}function ZA(o){if(o==="x"||o==="y"||o==="r")return o}function _$(o){if(o==="top"||o==="bottom")return"x";if(o==="left"||o==="right")return"y"}function rS(o,...r){if(ZA(o))return o;for(const c of r){const h=c.axis||_$(c.position)||o.length>1&&ZA(o[0].toLowerCase());if(h)return h}throw new Error(`Cannot determine type of '${o}' axis. Please provide 'axis' or 'position' option.`)}function XA(o,r,c){if(c[r+"AxisID"]===o)return{axis:r}}function y$(o,r){if(r.data&&r.data.datasets){const c=r.data.datasets.filter(h=>h.xAxisID===o||h.yAxisID===o);if(c.length)return XA(o,"x",c[0])||XA(o,"y",c[0])}return{}}function v$(o,r){const c=Yg[o.type]||{scales:{}},h=r.scales||{},p=aS(o.type,r),x=Object.create(null);return Object.keys(h).forEach(S=>{const i=h[S];if(!jr(i))return console.error(`Invalid scale configuration for scale: ${S}`);if(i._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${S}`);const M=rS(S,i,y$(S,o),Po.scales[i.type]),P=g$(M,p),N=c.scales||{};x[S]=Xv(Object.create(null),[{axis:M},i,N[M],N[P]])}),o.data.datasets.forEach(S=>{const i=S.type||o.type,M=S.indexAxis||aS(i,r),N=(Yg[i]||{}).scales||{};Object.keys(N).forEach(H=>{const W=p$(H,M),K=S[W+"AxisID"]||W;x[K]=x[K]||Object.create(null),Xv(x[K],[{axis:W},h[K],N[H]])})}),Object.keys(x).forEach(S=>{const i=x[S];Xv(i,[Po.scales[i.type],Po.scale])}),x}function RP(o){const r=o.options||(o.options={});r.plugins=Nr(r.plugins,{}),r.scales=v$(o,r)}function DP(o){return o=o||{},o.datasets=o.datasets||[],o.labels=o.labels||[],o}function x$(o){return o=o||{},o.data=DP(o.data),RP(o),o}const YA=new Map,LP=new Set;function q0(o,r){let c=YA.get(o);return c||(c=r(),YA.set(o,c),LP.add(c)),c}const Fv=(o,r,c)=>{const h=_y(r,c);h!==void 0&&o.add(h)};class b${constructor(r){this._config=x$(r),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(r){this._config.type=r}get data(){return this._config.data}set data(r){this._config.data=DP(r)}get options(){return this._config.options}set options(r){this._config.options=r}get plugins(){return this._config.plugins}update(){const r=this._config;this.clearCache(),RP(r)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(r){return q0(r,()=>[[`datasets.${r}`,""]])}datasetAnimationScopeKeys(r,c){return q0(`${r}.transition.${c}`,()=>[[`datasets.${r}.transitions.${c}`,`transitions.${c}`],[`datasets.${r}`,""]])}datasetElementScopeKeys(r,c){return q0(`${r}-${c}`,()=>[[`datasets.${r}.elements.${c}`,`datasets.${r}`,`elements.${c}`,""]])}pluginScopeKeys(r){const c=r.id,h=this.type;return q0(`${h}-plugin-${c}`,()=>[[`plugins.${c}`,...r.additionalOptionScopes||[]]])}_cachedScopes(r,c){const h=this._scopeCache;let p=h.get(r);return(!p||c)&&(p=new Map,h.set(r,p)),p}getOptionScopes(r,c,h){const{options:p,type:x}=this,S=this._cachedScopes(r,h),i=S.get(c);if(i)return i;const M=new Set;c.forEach(N=>{r&&(M.add(r),N.forEach(H=>Fv(M,r,H))),N.forEach(H=>Fv(M,p,H)),N.forEach(H=>Fv(M,Yg[x]||{},H)),N.forEach(H=>Fv(M,Po,H)),N.forEach(H=>Fv(M,nS,H))});const P=Array.from(M);return P.length===0&&P.push(Object.create(null)),LP.has(c)&&S.set(c,P),P}chartOptionScopes(){const{options:r,type:c}=this;return[r,Yg[c]||{},Po.datasets[c]||{},{type:c},Po,nS]}resolveNamedOptions(r,c,h,p=[""]){const x={$shared:!0},{resolver:S,subPrefixes:i}=KA(this._resolverCache,r,p);let M=S;if(S$(S,c)){x.$shared=!1,h=Hp(h)?h():h;const P=this.createResolver(r,h,i);M=yy(S,h,P)}for(const P of c)x[P]=M[P];return x}createResolver(r,c,h=[""],p){const{resolver:x}=KA(this._resolverCache,r,h);return jr(c)?yy(x,c,void 0,p):x}}function KA(o,r,c){let h=o.get(r);h||(h=new Map,o.set(r,h));const p=c.join();let x=h.get(p);return x||(x={resolver:OS(r,c),subPrefixes:c.filter(i=>!i.toLowerCase().includes("hover"))},h.set(p,x)),x}const w$=o=>jr(o)&&Object.getOwnPropertyNames(o).some(r=>Hp(o[r]));function S$(o,r){const{isScriptable:c,isIndexable:h}=vP(o);for(const p of r){const x=c(p),S=h(p),i=(S||x)&&o[p];if(x&&(Hp(i)||w$(i))||S&&Rl(i))return!0}return!1}var T$="4.5.1";const k$=["top","bottom","left","right","chartArea"];function JA(o,r){return o==="top"||o==="bottom"||k$.indexOf(o)===-1&&r==="x"}function QA(o,r){return function(c,h){return c[o]===h[o]?c[r]-h[r]:c[o]-h[o]}}function eC(o){const r=o.chart,c=r.options.animation;r.notifyPlugins("afterRender"),Ms(c&&c.onComplete,[o],r)}function E$(o){const r=o.chart,c=r.options.animation;Ms(c&&c.onProgress,[o],r)}function OP(o){return BS()&&typeof o=="string"?o=document.getElementById(o):o&&o.length&&(o=o[0]),o&&o.canvas&&(o=o.canvas),o}const lb={},tC=o=>{const r=OP(o);return Object.values(lb).filter(c=>c.canvas===r).pop()};function A$(o,r,c){const h=Object.keys(o);for(const p of h){const x=+p;if(x>=r){const S=o[p];delete o[p],(c>0||x>r)&&(o[x+c]=S)}}}function C$(o,r,c,h){return!c||o.type==="mouseout"?null:h?r:o}let yx=class{static defaults=Po;static instances=lb;static overrides=Yg;static registry=_f;static version=T$;static getChart=tC;static register(...r){_f.add(...r),iC()}static unregister(...r){_f.remove(...r),iC()}constructor(r,c){const h=this.config=new b$(c),p=OP(r),x=tC(p);if(x)throw new Error("Canvas is already in use. Chart with ID '"+x.id+"' must be destroyed before the canvas with ID '"+x.canvas.id+"' can be reused.");const S=h.createResolver(h.chartOptionScopes(),this.getContext());this.platform=new(h.platform||qU(p)),this.platform.updateConfig(h);const i=this.platform.acquireContext(p,S.aspectRatio),M=i&&i.canvas,P=M&&M.height,N=M&&M.width;if(this.id=V4(),this.ctx=i,this.canvas=M,this.width=N,this.height=P,this._options=S,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new u$,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=c5(H=>this.update(H),S.resizeDelay||0),this._dataChanges=[],lb[this.id]=this,!i||!M){console.error("Failed to create chart: can't acquire context from the given item");return}xm.listen(this,"complete",eC),xm.listen(this,"progress",E$),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:r,maintainAspectRatio:c},width:h,height:p,_aspectRatio:x}=this;return cs(r)?c&&x?x:p?h/p:null:r}get data(){return this.config.data}set data(r){this.config.data=r}get options(){return this._options}set options(r){this.config.options=r}get registry(){return _f}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():AA(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return SA(this.canvas,this.ctx),this}stop(){return xm.stop(this),this}resize(r,c){xm.running(this)?this._resizeBeforeDraw={width:r,height:c}:this._resize(r,c)}_resize(r,c){const h=this.options,p=this.canvas,x=h.maintainAspectRatio&&this.aspectRatio,S=this.platform.getMaximumSize(p,r,c,x),i=h.devicePixelRatio||this.platform.getDevicePixelRatio(),M=this.width?"resize":"attach";this.width=S.width,this.height=S.height,this._aspectRatio=this.aspectRatio,AA(this,i,!0)&&(this.notifyPlugins("resize",{size:S}),Ms(h.onResize,[this,S],this),this.attached&&this._doResize(M)&&this.render())}ensureScalesHaveIDs(){const c=this.options.scales||{};Yr(c,(h,p)=>{h.id=p})}buildOrUpdateScales(){const r=this.options,c=r.scales,h=this.scales,p=Object.keys(h).reduce((S,i)=>(S[i]=!1,S),{});let x=[];c&&(x=x.concat(Object.keys(c).map(S=>{const i=c[S],M=rS(S,i),P=M==="r",N=M==="x";return{options:i,dposition:P?"chartArea":N?"bottom":"left",dtype:P?"radialLinear":N?"category":"linear"}}))),Yr(x,S=>{const i=S.options,M=i.id,P=rS(M,i),N=Nr(i.type,S.dtype);(i.position===void 0||JA(i.position,P)!==JA(S.dposition))&&(i.position=S.dposition),p[M]=!0;let H=null;if(M in h&&h[M].type===N)H=h[M];else{const W=_f.getScale(N);H=new W({id:M,type:N,ctx:this.ctx,chart:this}),h[H.id]=H}H.init(i,r)}),Yr(p,(S,i)=>{S||delete h[i]}),Yr(h,S=>{Lp.configure(this,S,S.options),Lp.addBox(this,S)})}_updateMetasets(){const r=this._metasets,c=this.data.datasets.length,h=r.length;if(r.sort((p,x)=>p.index-x.index),h>c){for(let p=c;p<h;++p)this._destroyDatasetMeta(p);r.splice(c,h-c)}this._sortedMetasets=r.slice(0).sort(QA("order","index"))}_removeUnreferencedMetasets(){const{_metasets:r,data:{datasets:c}}=this;r.length>c.length&&delete this._stacks,r.forEach((h,p)=>{c.filter(x=>x===h._dataset).length===0&&this._destroyDatasetMeta(p)})}buildOrUpdateControllers(){const r=[],c=this.data.datasets;let h,p;for(this._removeUnreferencedMetasets(),h=0,p=c.length;h<p;h++){const x=c[h];let S=this.getDatasetMeta(h);const i=x.type||this.config.type;if(S.type&&S.type!==i&&(this._destroyDatasetMeta(h),S=this.getDatasetMeta(h)),S.type=i,S.indexAxis=x.indexAxis||aS(i,this.options),S.order=x.order||0,S.index=h,S.label=""+x.label,S.visible=this.isDatasetVisible(h),S.controller)S.controller.updateIndex(h),S.controller.linkScales();else{const M=_f.getController(i),{datasetElementType:P,dataElementType:N}=Po.datasets[i];Object.assign(M,{dataElementType:_f.getElement(N),datasetElementType:P&&_f.getElement(P)}),S.controller=new M(this,h),r.push(S.controller)}}return this._updateMetasets(),r}_resetElements(){Yr(this.data.datasets,(r,c)=>{this.getDatasetMeta(c).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(r){const c=this.config;c.update();const h=this._options=c.createResolver(c.chartOptionScopes(),this.getContext()),p=this._animationsDisabled=!h.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:r,cancelable:!0})===!1)return;const x=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let S=0;for(let P=0,N=this.data.datasets.length;P<N;P++){const{controller:H}=this.getDatasetMeta(P),W=!p&&x.indexOf(H)===-1;H.buildOrUpdateElements(W),S=Math.max(+H.getMaxOverflow(),S)}S=this._minPadding=h.layout.autoPadding?S:0,this._updateLayout(S),p||Yr(x,P=>{P.reset()}),this._updateDatasets(r),this.notifyPlugins("afterUpdate",{mode:r}),this._layers.sort(QA("z","_idx"));const{_active:i,_lastEvent:M}=this;M?this._eventHandler(M,!0):i.length&&this._updateHoverStyles(i,i,!0),this.render()}_updateScales(){Yr(this.scales,r=>{Lp.removeBox(this,r)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const r=this.options,c=new Set(Object.keys(this._listeners)),h=new Set(r.events);(!fA(c,h)||!!this._responsiveListeners!==r.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:r}=this,c=this._getUniformDataChanges()||[];for(const{method:h,start:p,count:x}of c){const S=h==="_removeElements"?-x:x;A$(r,p,S)}}_getUniformDataChanges(){const r=this._dataChanges;if(!r||!r.length)return;this._dataChanges=[];const c=this.data.datasets.length,h=x=>new Set(r.filter(S=>S[0]===x).map((S,i)=>i+","+S.splice(1).join(","))),p=h(0);for(let x=1;x<c;x++)if(!fA(p,h(x)))return;return Array.from(p).map(x=>x.split(",")).map(x=>({method:x[1],start:+x[2],count:+x[3]}))}_updateLayout(r){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Lp.update(this,this.width,this.height,r);const c=this.chartArea,h=c.width<=0||c.height<=0;this._layers=[],Yr(this.boxes,p=>{h&&p.position==="chartArea"||(p.configure&&p.configure(),this._layers.push(...p._layers()))},this),this._layers.forEach((p,x)=>{p._idx=x}),this.notifyPlugins("afterLayout")}_updateDatasets(r){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:r,cancelable:!0})!==!1){for(let c=0,h=this.data.datasets.length;c<h;++c)this.getDatasetMeta(c).controller.configure();for(let c=0,h=this.data.datasets.length;c<h;++c)this._updateDataset(c,Hp(r)?r({datasetIndex:c}):r);this.notifyPlugins("afterDatasetsUpdate",{mode:r})}}_updateDataset(r,c){const h=this.getDatasetMeta(r),p={meta:h,index:r,mode:c,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",p)!==!1&&(h.controller._update(c),p.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",p))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(xm.has(this)?this.attached&&!xm.running(this)&&xm.start(this):(this.draw(),eC({chart:this})))}draw(){let r;if(this._resizeBeforeDraw){const{width:h,height:p}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(h,p)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const c=this._layers;for(r=0;r<c.length&&c[r].z<=0;++r)c[r].draw(this.chartArea);for(this._drawDatasets();r<c.length;++r)c[r].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(r){const c=this._sortedMetasets,h=[];let p,x;for(p=0,x=c.length;p<x;++p){const S=c[p];(!r||S.visible)&&h.push(S)}return h}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const r=this.getSortedVisibleDatasetMetas();for(let c=r.length-1;c>=0;--c)this._drawDataset(r[c]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(r){const c=this.ctx,h={meta:r,index:r.index,cancelable:!0},p=Z5(this,r);this.notifyPlugins("beforeDatasetDraw",h)!==!1&&(p&&DS(c,p),r.controller.draw(),p&&LS(c),h.cancelable=!1,this.notifyPlugins("afterDatasetDraw",h))}isPointInArea(r){return gP(r,this.chartArea,this._minPadding)}getElementsAtEventForMode(r,c,h,p){const x=kU.modes[c];return typeof x=="function"?x(this,r,h,p):[]}getDatasetMeta(r){const c=this.data.datasets[r],h=this._metasets;let p=h.filter(x=>x&&x._dataset===c).pop();return p||(p={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:c&&c.order||0,index:r,_dataset:c,_parsed:[],_sorted:!1},h.push(p)),p}getContext(){return this.$context||(this.$context=Sy(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(r){const c=this.data.datasets[r];if(!c)return!1;const h=this.getDatasetMeta(r);return typeof h.hidden=="boolean"?!h.hidden:!c.hidden}setDatasetVisibility(r,c){const h=this.getDatasetMeta(r);h.hidden=!c}toggleDataVisibility(r){this._hiddenIndices[r]=!this._hiddenIndices[r]}getDataVisibility(r){return!this._hiddenIndices[r]}_updateVisibility(r,c,h){const p=h?"show":"hide",x=this.getDatasetMeta(r),S=x.controller._resolveAnimations(void 0,p);lx(c)?(x.data[c].hidden=!h,this.update()):(this.setDatasetVisibility(r,h),S.update(x,{visible:h}),this.update(i=>i.datasetIndex===r?p:void 0))}hide(r,c){this._updateVisibility(r,c,!1)}show(r,c){this._updateVisibility(r,c,!0)}_destroyDatasetMeta(r){const c=this._metasets[r];c&&c.controller&&c.controller._destroy(),delete this._metasets[r]}_stop(){let r,c;for(this.stop(),xm.remove(this),r=0,c=this.data.datasets.length;r<c;++r)this._destroyDatasetMeta(r)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:r,ctx:c}=this;this._stop(),this.config.clearCache(),r&&(this.unbindEvents(),SA(r,c),this.platform.releaseContext(c),this.canvas=null,this.ctx=null),delete lb[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...r){return this.canvas.toDataURL(...r)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const r=this._listeners,c=this.platform,h=(x,S)=>{c.addEventListener(this,x,S),r[x]=S},p=(x,S,i)=>{x.offsetX=S,x.offsetY=i,this._eventHandler(x)};Yr(this.options.events,x=>h(x,p))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const r=this._responsiveListeners,c=this.platform,h=(M,P)=>{c.addEventListener(this,M,P),r[M]=P},p=(M,P)=>{r[M]&&(c.removeEventListener(this,M,P),delete r[M])},x=(M,P)=>{this.canvas&&this.resize(M,P)};let S;const i=()=>{p("attach",i),this.attached=!0,this.resize(),h("resize",x),h("detach",S)};S=()=>{this.attached=!1,p("resize",x),this._stop(),this._resize(0,0),h("attach",i)},c.isAttached(this.canvas)?i():S()}unbindEvents(){Yr(this._listeners,(r,c)=>{this.platform.removeEventListener(this,c,r)}),this._listeners={},Yr(this._responsiveListeners,(r,c)=>{this.platform.removeEventListener(this,c,r)}),this._responsiveListeners=void 0}updateHoverStyle(r,c,h){const p=h?"set":"remove";let x,S,i,M;for(c==="dataset"&&(x=this.getDatasetMeta(r[0].datasetIndex),x.controller["_"+p+"DatasetHoverStyle"]()),i=0,M=r.length;i<M;++i){S=r[i];const P=S&&this.getDatasetMeta(S.datasetIndex).controller;P&&P[p+"HoverStyle"](S.element,S.datasetIndex,S.index)}}getActiveElements(){return this._active||[]}setActiveElements(r){const c=this._active||[],h=r.map(({datasetIndex:x,index:S})=>{const i=this.getDatasetMeta(x);if(!i)throw new Error("No dataset found at index "+x);return{datasetIndex:x,element:i.data[S],index:S}});!xb(h,c)&&(this._active=h,this._lastEvent=null,this._updateHoverStyles(h,c))}notifyPlugins(r,c,h){return this._plugins.notify(this,r,c,h)}isPluginEnabled(r){return this._plugins._cache.filter(c=>c.plugin.id===r).length===1}_updateHoverStyles(r,c,h){const p=this.options.hover,x=(M,P)=>M.filter(N=>!P.some(H=>N.datasetIndex===H.datasetIndex&&N.index===H.index)),S=x(c,r),i=h?r:x(r,c);S.length&&this.updateHoverStyle(S,p.mode,!1),i.length&&p.mode&&this.updateHoverStyle(i,p.mode,!0)}_eventHandler(r,c){const h={event:r,replay:c,cancelable:!0,inChartArea:this.isPointInArea(r)},p=S=>(S.options.events||this.options.events).includes(r.native.type);if(this.notifyPlugins("beforeEvent",h,p)===!1)return;const x=this._handleEvent(r,c,h.inChartArea);return h.cancelable=!1,this.notifyPlugins("afterEvent",h,p),(x||h.changed)&&this.render(),this}_handleEvent(r,c,h){const{_active:p=[],options:x}=this,S=c,i=this._getActiveElements(r,p,h,S),M=X4(r),P=C$(r,this._lastEvent,h,M);h&&(this._lastEvent=null,Ms(x.onHover,[r,i,this],this),M&&Ms(x.onClick,[r,i,this],this));const N=!xb(i,p);return(N||c)&&(this._active=i,this._updateHoverStyles(i,p,c)),this._lastEvent=P,N}_getActiveElements(r,c,h,p){if(r.type==="mouseout")return[];if(!h)return c;const x=this.options.hover;return this.getElementsAtEventForMode(r,x.mode,x,p)}};function iC(){return Yr(yx.instances,o=>o._plugins.invalidate())}function NP(o,r){const{x:c,y:h,base:p,width:x,height:S}=o.getProps(["x","y","base","width","height"],r);let i,M,P,N,H;return o.horizontal?(H=S/2,i=Math.min(c,p),M=Math.max(c,p),P=h-H,N=h+H):(H=x/2,i=c-H,M=c+H,P=Math.min(h,p),N=Math.max(h,p)),{left:i,top:P,right:M,bottom:N}}function Op(o,r,c,h){return o?0:wh(r,c,h)}function M$(o,r,c){const h=o.options.borderWidth,p=o.borderSkipped,x=yP(h);return{t:Op(p.top,x.top,0,c),r:Op(p.right,x.right,0,r),b:Op(p.bottom,x.bottom,0,c),l:Op(p.left,x.left,0,r)}}function P$(o,r,c){const{enableBorderRadius:h}=o.getProps(["enableBorderRadius"]),p=o.options.borderRadius,x=hy(p),S=Math.min(r,c),i=o.borderSkipped,M=h||jr(p);return{topLeft:Op(!M||i.top||i.left,x.topLeft,0,S),topRight:Op(!M||i.top||i.right,x.topRight,0,S),bottomLeft:Op(!M||i.bottom||i.left,x.bottomLeft,0,S),bottomRight:Op(!M||i.bottom||i.right,x.bottomRight,0,S)}}function j$(o){const r=NP(o),c=r.right-r.left,h=r.bottom-r.top,p=M$(o,c/2,h/2),x=P$(o,c/2,h/2);return{outer:{x:r.left,y:r.top,w:c,h,radius:x},inner:{x:r.left+p.l,y:r.top+p.t,w:c-p.l-p.r,h:h-p.t-p.b,radius:{topLeft:Math.max(0,x.topLeft-Math.max(p.t,p.l)),topRight:Math.max(0,x.topRight-Math.max(p.t,p.r)),bottomLeft:Math.max(0,x.bottomLeft-Math.max(p.b,p.l)),bottomRight:Math.max(0,x.bottomRight-Math.max(p.b,p.r))}}}}function z1(o,r,c,h){const p=r===null,x=c===null,i=o&&!(p&&x)&&NP(o,h);return i&&(p||cy(r,i.left,i.right))&&(x||cy(c,i.top,i.bottom))}function z$(o){return o.topLeft||o.topRight||o.bottomLeft||o.bottomRight}function I$(o,r){o.rect(r.x,r.y,r.w,r.h)}function I1(o,r,c={}){const h=o.x!==c.x?-r:0,p=o.y!==c.y?-r:0,x=(o.x+o.w!==c.x+c.w?r:0)-h,S=(o.y+o.h!==c.y+c.h?r:0)-p;return{x:o.x+h,y:o.y+p,w:o.w+x,h:o.h+S,radius:o.radius}}class FP extends _x{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(r){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,r&&Object.assign(this,r)}draw(r){const{inflateAmount:c,options:{borderColor:h,backgroundColor:p}}=this,{inner:x,outer:S}=j$(this),i=z$(S.radius)?kb:I$;r.save(),(S.w!==x.w||S.h!==x.h)&&(r.beginPath(),i(r,I1(S,c,x)),r.clip(),i(r,I1(x,-c,S)),r.fillStyle=h,r.fill("evenodd")),r.beginPath(),i(r,I1(x,c)),r.fillStyle=p,r.fill(),r.restore()}inRange(r,c,h){return z1(this,r,c,h)}inXRange(r,c){return z1(this,r,null,c)}inYRange(r,c){return z1(this,null,r,c)}getCenterPoint(r){const{x:c,y:h,base:p,horizontal:x}=this.getProps(["x","y","base","horizontal"],r);return{x:x?(c+p)/2:c,y:x?h:(h+p)/2}}getRange(r){return r==="x"?this.width/2:this.height/2}}const nC=(o,r)=>{let{boxHeight:c=r,boxWidth:h=r}=o;return o.usePointStyle&&(c=Math.min(c,r),h=o.pointStyleWidth||Math.min(h,r)),{boxWidth:h,boxHeight:c,itemHeight:Math.max(r,c)}},R$=(o,r)=>o!==null&&r!==null&&o.datasetIndex===r.datasetIndex&&o.index===r.index;class aC extends _x{constructor(r){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,c,h){this.maxWidth=r,this.maxHeight=c,this._margins=h,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const r=this.options.labels||{};let c=Ms(r.generateLabels,[this.chart],this)||[];r.filter&&(c=c.filter(h=>r.filter(h,this.chart.data))),r.sort&&(c=c.sort((h,p)=>r.sort(h,p,this.chart.data))),this.options.reverse&&c.reverse(),this.legendItems=c}fit(){const{options:r,ctx:c}=this;if(!r.display){this.width=this.height=0;return}const h=r.labels,p=xu(h.font),x=p.size,S=this._computeTitleHeight(),{boxWidth:i,itemHeight:M}=nC(h,x);let P,N;c.font=p.string,this.isHorizontal()?(P=this.maxWidth,N=this._fitRows(S,x,i,M)+10):(N=this.maxHeight,P=this._fitCols(S,p,i,M)+10),this.width=Math.min(P,r.maxWidth||this.maxWidth),this.height=Math.min(N,r.maxHeight||this.maxHeight)}_fitRows(r,c,h,p){const{ctx:x,maxWidth:S,options:{labels:{padding:i}}}=this,M=this.legendHitBoxes=[],P=this.lineWidths=[0],N=p+i;let H=r;x.textAlign="left",x.textBaseline="middle";let W=-1,K=-N;return this.legendItems.forEach((re,ae)=>{const ce=h+c/2+x.measureText(re.text).width;(ae===0||P[P.length-1]+ce+2*i>S)&&(H+=N,P[P.length-(ae>0?0:1)]=0,K+=N,W++),M[ae]={left:0,top:K,row:W,width:ce,height:p},P[P.length-1]+=ce+i}),H}_fitCols(r,c,h,p){const{ctx:x,maxHeight:S,options:{labels:{padding:i}}}=this,M=this.legendHitBoxes=[],P=this.columnSizes=[],N=S-r;let H=i,W=0,K=0,re=0,ae=0;return this.legendItems.forEach((ce,ve)=>{const{itemWidth:Se,itemHeight:Ee}=D$(h,c,x,ce,p);ve>0&&K+Ee+2*i>N&&(H+=W+i,P.push({width:W,height:K}),re+=W+i,ae++,W=K=0),M[ve]={left:re,top:K,col:ae,width:Se,height:Ee},W=Math.max(W,Se),K+=Ee+i}),H+=W,P.push({width:W,height:K}),H}adjustHitBoxes(){if(!this.options.display)return;const r=this._computeTitleHeight(),{legendHitBoxes:c,options:{align:h,labels:{padding:p},rtl:x}}=this,S=fy(x,this.left,this.width);if(this.isHorizontal()){let i=0,M=Gu(h,this.left+p,this.right-this.lineWidths[i]);for(const P of c)i!==P.row&&(i=P.row,M=Gu(h,this.left+p,this.right-this.lineWidths[i])),P.top+=this.top+r+p,P.left=S.leftForLtr(S.x(M),P.width),M+=P.width+p}else{let i=0,M=Gu(h,this.top+r+p,this.bottom-this.columnSizes[i].height);for(const P of c)P.col!==i&&(i=P.col,M=Gu(h,this.top+r+p,this.bottom-this.columnSizes[i].height)),P.top=M,P.left+=this.left+p,P.left=S.leftForLtr(S.x(P.left),P.width),M+=P.height+p}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const r=this.ctx;DS(r,this),this._draw(),LS(r)}}_draw(){const{options:r,columnSizes:c,lineWidths:h,ctx:p}=this,{align:x,labels:S}=r,i=Po.color,M=fy(r.rtl,this.left,this.width),P=xu(S.font),{padding:N}=S,H=P.size,W=H/2;let K;this.drawTitle(),p.textAlign=M.textAlign("left"),p.textBaseline="middle",p.lineWidth=.5,p.font=P.string;const{boxWidth:re,boxHeight:ae,itemHeight:ce}=nC(S,H),ve=function(ke,tt,Ke){if(isNaN(re)||re<=0||isNaN(ae)||ae<0)return;p.save();const lt=Nr(Ke.lineWidth,1);if(p.fillStyle=Nr(Ke.fillStyle,i),p.lineCap=Nr(Ke.lineCap,"butt"),p.lineDashOffset=Nr(Ke.lineDashOffset,0),p.lineJoin=Nr(Ke.lineJoin,"miter"),p.lineWidth=lt,p.strokeStyle=Nr(Ke.strokeStyle,i),p.setLineDash(Nr(Ke.lineDash,[])),S.usePointStyle){const ft={radius:ae*Math.SQRT2/2,pointStyle:Ke.pointStyle,rotation:Ke.rotation,borderWidth:lt},gt=M.xPlus(ke,re/2),ni=tt+W;pP(p,ft,gt,ni,S.pointStyleWidth&&re)}else{const ft=tt+Math.max((H-ae)/2,0),gt=M.leftForLtr(ke,re),ni=hy(Ke.borderRadius);p.beginPath(),Object.values(ni).some(Ft=>Ft!==0)?kb(p,{x:gt,y:ft,w:re,h:ae,radius:ni}):p.rect(gt,ft,re,ae),p.fill(),lt!==0&&p.stroke()}p.restore()},Se=function(ke,tt,Ke){Tb(p,Ke.text,ke,tt+ce/2,P,{strikethrough:Ke.hidden,textAlign:M.textAlign(Ke.textAlign)})},Ee=this.isHorizontal(),Qe=this._computeTitleHeight();Ee?K={x:Gu(x,this.left+N,this.right-h[0]),y:this.top+N+Qe,line:0}:K={x:this.left+N,y:Gu(x,this.top+Qe+N,this.bottom-c[0].height),line:0},SP(this.ctx,r.textDirection);const He=ce+N;this.legendItems.forEach((ke,tt)=>{p.strokeStyle=ke.fontColor,p.fillStyle=ke.fontColor;const Ke=p.measureText(ke.text).width,lt=M.textAlign(ke.textAlign||(ke.textAlign=S.textAlign)),ft=re+W+Ke;let gt=K.x,ni=K.y;M.setWidth(this.width),Ee?tt>0&&gt+ft+N>this.right&&(ni=K.y+=He,K.line++,gt=K.x=Gu(x,this.left+N,this.right-h[K.line])):tt>0&&ni+He>this.bottom&&(gt=K.x=gt+c[K.line].width+N,K.line++,ni=K.y=Gu(x,this.top+Qe+N,this.bottom-c[K.line].height));const Ft=M.x(gt);if(ve(Ft,ni,ke),gt=u5(lt,gt+re+W,Ee?gt+ft:this.right,r.rtl),Se(M.x(gt),ni,ke),Ee)K.x+=ft+N;else if(typeof ke.text!="string"){const Vi=P.lineHeight;K.y+=BP(ke,Vi)+N}else K.y+=He}),TP(this.ctx,r.textDirection)}drawTitle(){const r=this.options,c=r.title,h=xu(c.font),p=Sh(c.padding);if(!c.display)return;const x=fy(r.rtl,this.left,this.width),S=this.ctx,i=c.position,M=h.size/2,P=p.top+M;let N,H=this.left,W=this.width;if(this.isHorizontal())W=Math.max(...this.lineWidths),N=this.top+P,H=Gu(r.align,H,this.right-W);else{const re=this.columnSizes.reduce((ae,ce)=>Math.max(ae,ce.height),0);N=P+Gu(r.align,this.top,this.bottom-re-r.labels.padding-this._computeTitleHeight())}const K=Gu(i,H,H+W);S.textAlign=x.textAlign(dP(i)),S.textBaseline="middle",S.strokeStyle=c.color,S.fillStyle=c.color,S.font=h.string,Tb(S,c.text,K,N,h)}_computeTitleHeight(){const r=this.options.title,c=xu(r.font),h=Sh(r.padding);return r.display?c.lineHeight+h.height:0}_getLegendItemAt(r,c){let h,p,x;if(cy(r,this.left,this.right)&&cy(c,this.top,this.bottom)){for(x=this.legendHitBoxes,h=0;h<x.length;++h)if(p=x[h],cy(r,p.left,p.left+p.width)&&cy(c,p.top,p.top+p.height))return this.legendItems[h]}return null}handleEvent(r){const c=this.options;if(!N$(r.type,c))return;const h=this._getLegendItemAt(r.x,r.y);if(r.type==="mousemove"||r.type==="mouseout"){const p=this._hoveredItem,x=R$(p,h);p&&!x&&Ms(c.onLeave,[r,p,this],this),this._hoveredItem=h,h&&!x&&Ms(c.onHover,[r,h,this],this)}else h&&Ms(c.onClick,[r,h,this],this)}}function D$(o,r,c,h,p){const x=L$(h,o,r,c),S=O$(p,h,r.lineHeight);return{itemWidth:x,itemHeight:S}}function L$(o,r,c,h){let p=o.text;return p&&typeof p!="string"&&(p=p.reduce((x,S)=>x.length>S.length?x:S)),r+c.size/2+h.measureText(p).width}function O$(o,r,c){let h=o;return typeof r.text!="string"&&(h=BP(r,c)),h}function BP(o,r){const c=o.text?o.text.length:0;return r*c}function N$(o,r){return!!((o==="mousemove"||o==="mouseout")&&(r.onHover||r.onLeave)||r.onClick&&(o==="click"||o==="mouseup"))}var UP={id:"legend",_element:aC,start(o,r,c){const h=o.legend=new aC({ctx:o.ctx,options:c,chart:o});Lp.configure(o,h,c),Lp.addBox(o,h)},stop(o){Lp.removeBox(o,o.legend),delete o.legend},beforeUpdate(o,r,c){const h=o.legend;Lp.configure(o,h,c),h.options=c},afterUpdate(o){const r=o.legend;r.buildLabels(),r.adjustHitBoxes()},afterEvent(o,r){r.replay||o.legend.handleEvent(r.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(o,r,c){const h=r.datasetIndex,p=c.chart;p.isDatasetVisible(h)?(p.hide(h),r.hidden=!0):(p.show(h),r.hidden=!1)},onHover:null,onLeave:null,labels:{color:o=>o.chart.options.color,boxWidth:40,padding:10,generateLabels(o){const r=o.data.datasets,{labels:{usePointStyle:c,pointStyle:h,textAlign:p,color:x,useBorderRadius:S,borderRadius:i}}=o.legend.options;return o._getSortedDatasetMetas().map(M=>{const P=M.controller.getStyle(c?0:void 0),N=Sh(P.borderWidth);return{text:r[M.index].label,fillStyle:P.backgroundColor,fontColor:x,hidden:!M.visible,lineCap:P.borderCapStyle,lineDash:P.borderDash,lineDashOffset:P.borderDashOffset,lineJoin:P.borderJoinStyle,lineWidth:(N.width+N.height)/4,strokeStyle:P.borderColor,pointStyle:h||P.pointStyle,rotation:P.rotation,textAlign:p||P.textAlign,borderRadius:S&&(i||P.borderRadius),datasetIndex:M.index}},this)}},title:{color:o=>o.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:o=>!o.startsWith("on"),labels:{_scriptable:o=>!["generateLabels","filter","sort"].includes(o)}}};const Gv={average(o){if(!o.length)return!1;let r,c,h=new Set,p=0,x=0;for(r=0,c=o.length;r<c;++r){const i=o[r].element;if(i&&i.hasValue()){const M=i.tooltipPosition();h.add(M.x),p+=M.y,++x}}return x===0||h.size===0?!1:{x:[...h].reduce((i,M)=>i+M)/h.size,y:p/x}},nearest(o,r){if(!o.length)return!1;let c=r.x,h=r.y,p=Number.POSITIVE_INFINITY,x,S,i;for(x=0,S=o.length;x<S;++x){const M=o[x].element;if(M&&M.hasValue()){const P=M.getCenterPoint(),N=n5(r,P);N<p&&(p=N,i=M)}}if(i){const M=i.tooltipPosition();c=M.x,h=M.y}return{x:c,y:h}}};function pf(o,r){return r&&(Rl(r)?Array.prototype.push.apply(o,r):o.push(r)),o}function bm(o){return(typeof o=="string"||o instanceof String)&&o.indexOf(`
`)>-1?o.split(`
`):o}function F$(o,r){const{element:c,datasetIndex:h,index:p}=r,x=o.getDatasetMeta(h).controller,{label:S,value:i}=x.getLabelAndValue(p);return{chart:o,label:S,parsed:x.getParsed(p),raw:o.data.datasets[h].data[p],formattedValue:i,dataset:x.getDataset(),dataIndex:p,datasetIndex:h,element:c}}function rC(o,r){const c=o.chart.ctx,{body:h,footer:p,title:x}=o,{boxWidth:S,boxHeight:i}=r,M=xu(r.bodyFont),P=xu(r.titleFont),N=xu(r.footerFont),H=x.length,W=p.length,K=h.length,re=Sh(r.padding);let ae=re.height,ce=0,ve=h.reduce((Qe,He)=>Qe+He.before.length+He.lines.length+He.after.length,0);if(ve+=o.beforeBody.length+o.afterBody.length,H&&(ae+=H*P.lineHeight+(H-1)*r.titleSpacing+r.titleMarginBottom),ve){const Qe=r.displayColors?Math.max(i,M.lineHeight):M.lineHeight;ae+=K*Qe+(ve-K)*M.lineHeight+(ve-1)*r.bodySpacing}W&&(ae+=r.footerMarginTop+W*N.lineHeight+(W-1)*r.footerSpacing);let Se=0;const Ee=function(Qe){ce=Math.max(ce,c.measureText(Qe).width+Se)};return c.save(),c.font=P.string,Yr(o.title,Ee),c.font=M.string,Yr(o.beforeBody.concat(o.afterBody),Ee),Se=r.displayColors?S+2+r.boxPadding:0,Yr(h,Qe=>{Yr(Qe.before,Ee),Yr(Qe.lines,Ee),Yr(Qe.after,Ee)}),Se=0,c.font=N.string,Yr(o.footer,Ee),c.restore(),ce+=re.width,{width:ce,height:ae}}function B$(o,r){const{y:c,height:h}=r;return c<h/2?"top":c>o.height-h/2?"bottom":"center"}function U$(o,r,c,h){const{x:p,width:x}=h,S=c.caretSize+c.caretPadding;if(o==="left"&&p+x+S>r.width||o==="right"&&p-x-S<0)return!0}function $$(o,r,c,h){const{x:p,width:x}=c,{width:S,chartArea:{left:i,right:M}}=o;let P="center";return h==="center"?P=p<=(i+M)/2?"left":"right":p<=x/2?P="left":p>=S-x/2&&(P="right"),U$(P,o,r,c)&&(P="center"),P}function sC(o,r,c){const h=c.yAlign||r.yAlign||B$(o,c);return{xAlign:c.xAlign||r.xAlign||$$(o,r,c,h),yAlign:h}}function V$(o,r){let{x:c,width:h}=o;return r==="right"?c-=h:r==="center"&&(c-=h/2),c}function H$(o,r,c){let{y:h,height:p}=o;return r==="top"?h+=c:r==="bottom"?h-=p+c:h-=p/2,h}function oC(o,r,c,h){const{caretSize:p,caretPadding:x,cornerRadius:S}=o,{xAlign:i,yAlign:M}=c,P=p+x,{topLeft:N,topRight:H,bottomLeft:W,bottomRight:K}=hy(S);let re=V$(r,i);const ae=H$(r,M,P);return M==="center"?i==="left"?re+=P:i==="right"&&(re-=P):i==="left"?re-=Math.max(N,W)+p:i==="right"&&(re+=Math.max(H,K)+p),{x:wh(re,0,h.width-r.width),y:wh(ae,0,h.height-r.height)}}function W0(o,r,c){const h=Sh(c.padding);return r==="center"?o.x+o.width/2:r==="right"?o.x+o.width-h.right:o.x+h.left}function lC(o){return pf([],bm(o))}function G$(o,r,c){return Sy(o,{tooltip:r,tooltipItems:c,type:"tooltip"})}function cC(o,r){const c=r&&r.dataset&&r.dataset.tooltip&&r.dataset.tooltip.callbacks;return c?o.override(c):o}const $P={beforeTitle:pm,title(o){if(o.length>0){const r=o[0],c=r.chart.data.labels,h=c?c.length:0;if(this&&this.options&&this.options.mode==="dataset")return r.dataset.label||"";if(r.label)return r.label;if(h>0&&r.dataIndex<h)return c[r.dataIndex]}return""},afterTitle:pm,beforeBody:pm,beforeLabel:pm,label(o){if(this&&this.options&&this.options.mode==="dataset")return o.label+": "+o.formattedValue||o.formattedValue;let r=o.dataset.label||"";r&&(r+=": ");const c=o.formattedValue;return cs(c)||(r+=c),r},labelColor(o){const c=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{borderColor:c.borderColor,backgroundColor:c.backgroundColor,borderWidth:c.borderWidth,borderDash:c.borderDash,borderDashOffset:c.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(o){const c=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{pointStyle:c.pointStyle,rotation:c.rotation}},afterLabel:pm,afterBody:pm,beforeFooter:pm,footer:pm,afterFooter:pm};function _u(o,r,c,h){const p=o[r].call(c,h);return typeof p>"u"?$P[r].call(c,h):p}class uC extends _x{static positioners=Gv;constructor(r){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=r.chart,this.options=r.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(r){this.options=r,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const r=this._cachedAnimations;if(r)return r;const c=this.chart,h=this.options.setContext(this.getContext()),p=h.enabled&&c.options.animation&&h.animations,x=new kP(this.chart,p);return p._cacheable&&(this._cachedAnimations=Object.freeze(x)),x}getContext(){return this.$context||(this.$context=G$(this.chart.getContext(),this,this._tooltipItems))}getTitle(r,c){const{callbacks:h}=c,p=_u(h,"beforeTitle",this,r),x=_u(h,"title",this,r),S=_u(h,"afterTitle",this,r);let i=[];return i=pf(i,bm(p)),i=pf(i,bm(x)),i=pf(i,bm(S)),i}getBeforeBody(r,c){return lC(_u(c.callbacks,"beforeBody",this,r))}getBody(r,c){const{callbacks:h}=c,p=[];return Yr(r,x=>{const S={before:[],lines:[],after:[]},i=cC(h,x);pf(S.before,bm(_u(i,"beforeLabel",this,x))),pf(S.lines,_u(i,"label",this,x)),pf(S.after,bm(_u(i,"afterLabel",this,x))),p.push(S)}),p}getAfterBody(r,c){return lC(_u(c.callbacks,"afterBody",this,r))}getFooter(r,c){const{callbacks:h}=c,p=_u(h,"beforeFooter",this,r),x=_u(h,"footer",this,r),S=_u(h,"afterFooter",this,r);let i=[];return i=pf(i,bm(p)),i=pf(i,bm(x)),i=pf(i,bm(S)),i}_createItems(r){const c=this._active,h=this.chart.data,p=[],x=[],S=[];let i=[],M,P;for(M=0,P=c.length;M<P;++M)i.push(F$(this.chart,c[M]));return r.filter&&(i=i.filter((N,H,W)=>r.filter(N,H,W,h))),r.itemSort&&(i=i.sort((N,H)=>r.itemSort(N,H,h))),Yr(i,N=>{const H=cC(r.callbacks,N);p.push(_u(H,"labelColor",this,N)),x.push(_u(H,"labelPointStyle",this,N)),S.push(_u(H,"labelTextColor",this,N))}),this.labelColors=p,this.labelPointStyles=x,this.labelTextColors=S,this.dataPoints=i,i}update(r,c){const h=this.options.setContext(this.getContext()),p=this._active;let x,S=[];if(!p.length)this.opacity!==0&&(x={opacity:0});else{const i=Gv[h.position].call(this,p,this._eventPosition);S=this._createItems(h),this.title=this.getTitle(S,h),this.beforeBody=this.getBeforeBody(S,h),this.body=this.getBody(S,h),this.afterBody=this.getAfterBody(S,h),this.footer=this.getFooter(S,h);const M=this._size=rC(this,h),P=Object.assign({},i,M),N=sC(this.chart,h,P),H=oC(h,P,N,this.chart);this.xAlign=N.xAlign,this.yAlign=N.yAlign,x={opacity:1,x:H.x,y:H.y,width:M.width,height:M.height,caretX:i.x,caretY:i.y}}this._tooltipItems=S,this.$context=void 0,x&&this._resolveAnimations().update(this,x),r&&h.external&&h.external.call(this,{chart:this.chart,tooltip:this,replay:c})}drawCaret(r,c,h,p){const x=this.getCaretPosition(r,h,p);c.lineTo(x.x1,x.y1),c.lineTo(x.x2,x.y2),c.lineTo(x.x3,x.y3)}getCaretPosition(r,c,h){const{xAlign:p,yAlign:x}=this,{caretSize:S,cornerRadius:i}=h,{topLeft:M,topRight:P,bottomLeft:N,bottomRight:H}=hy(i),{x:W,y:K}=r,{width:re,height:ae}=c;let ce,ve,Se,Ee,Qe,He;return x==="center"?(Qe=K+ae/2,p==="left"?(ce=W,ve=ce-S,Ee=Qe+S,He=Qe-S):(ce=W+re,ve=ce+S,Ee=Qe-S,He=Qe+S),Se=ce):(p==="left"?ve=W+Math.max(M,N)+S:p==="right"?ve=W+re-Math.max(P,H)-S:ve=this.caretX,x==="top"?(Ee=K,Qe=Ee-S,ce=ve-S,Se=ve+S):(Ee=K+ae,Qe=Ee+S,ce=ve+S,Se=ve-S),He=Ee),{x1:ce,x2:ve,x3:Se,y1:Ee,y2:Qe,y3:He}}drawTitle(r,c,h){const p=this.title,x=p.length;let S,i,M;if(x){const P=fy(h.rtl,this.x,this.width);for(r.x=W0(this,h.titleAlign,h),c.textAlign=P.textAlign(h.titleAlign),c.textBaseline="middle",S=xu(h.titleFont),i=h.titleSpacing,c.fillStyle=h.titleColor,c.font=S.string,M=0;M<x;++M)c.fillText(p[M],P.x(r.x),r.y+S.lineHeight/2),r.y+=S.lineHeight+i,M+1===x&&(r.y+=h.titleMarginBottom-i)}}_drawColorBox(r,c,h,p,x){const S=this.labelColors[h],i=this.labelPointStyles[h],{boxHeight:M,boxWidth:P}=x,N=xu(x.bodyFont),H=W0(this,"left",x),W=p.x(H),K=M<N.lineHeight?(N.lineHeight-M)/2:0,re=c.y+K;if(x.usePointStyle){const ae={radius:Math.min(P,M)/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:1},ce=p.leftForLtr(W,P)+P/2,ve=re+M/2;r.strokeStyle=x.multiKeyBackground,r.fillStyle=x.multiKeyBackground,TA(r,ae,ce,ve),r.strokeStyle=S.borderColor,r.fillStyle=S.backgroundColor,TA(r,ae,ce,ve)}else{r.lineWidth=jr(S.borderWidth)?Math.max(...Object.values(S.borderWidth)):S.borderWidth||1,r.strokeStyle=S.borderColor,r.setLineDash(S.borderDash||[]),r.lineDashOffset=S.borderDashOffset||0;const ae=p.leftForLtr(W,P),ce=p.leftForLtr(p.xPlus(W,1),P-2),ve=hy(S.borderRadius);Object.values(ve).some(Se=>Se!==0)?(r.beginPath(),r.fillStyle=x.multiKeyBackground,kb(r,{x:ae,y:re,w:P,h:M,radius:ve}),r.fill(),r.stroke(),r.fillStyle=S.backgroundColor,r.beginPath(),kb(r,{x:ce,y:re+1,w:P-2,h:M-2,radius:ve}),r.fill()):(r.fillStyle=x.multiKeyBackground,r.fillRect(ae,re,P,M),r.strokeRect(ae,re,P,M),r.fillStyle=S.backgroundColor,r.fillRect(ce,re+1,P-2,M-2))}r.fillStyle=this.labelTextColors[h]}drawBody(r,c,h){const{body:p}=this,{bodySpacing:x,bodyAlign:S,displayColors:i,boxHeight:M,boxWidth:P,boxPadding:N}=h,H=xu(h.bodyFont);let W=H.lineHeight,K=0;const re=fy(h.rtl,this.x,this.width),ae=function(Ke){c.fillText(Ke,re.x(r.x+K),r.y+W/2),r.y+=W+x},ce=re.textAlign(S);let ve,Se,Ee,Qe,He,ke,tt;for(c.textAlign=S,c.textBaseline="middle",c.font=H.string,r.x=W0(this,ce,h),c.fillStyle=h.bodyColor,Yr(this.beforeBody,ae),K=i&&ce!=="right"?S==="center"?P/2+N:P+2+N:0,Qe=0,ke=p.length;Qe<ke;++Qe){for(ve=p[Qe],Se=this.labelTextColors[Qe],c.fillStyle=Se,Yr(ve.before,ae),Ee=ve.lines,i&&Ee.length&&(this._drawColorBox(c,r,Qe,re,h),W=Math.max(H.lineHeight,M)),He=0,tt=Ee.length;He<tt;++He)ae(Ee[He]),W=H.lineHeight;Yr(ve.after,ae)}K=0,W=H.lineHeight,Yr(this.afterBody,ae),r.y-=x}drawFooter(r,c,h){const p=this.footer,x=p.length;let S,i;if(x){const M=fy(h.rtl,this.x,this.width);for(r.x=W0(this,h.footerAlign,h),r.y+=h.footerMarginTop,c.textAlign=M.textAlign(h.footerAlign),c.textBaseline="middle",S=xu(h.footerFont),c.fillStyle=h.footerColor,c.font=S.string,i=0;i<x;++i)c.fillText(p[i],M.x(r.x),r.y+S.lineHeight/2),r.y+=S.lineHeight+h.footerSpacing}}drawBackground(r,c,h,p){const{xAlign:x,yAlign:S}=this,{x:i,y:M}=r,{width:P,height:N}=h,{topLeft:H,topRight:W,bottomLeft:K,bottomRight:re}=hy(p.cornerRadius);c.fillStyle=p.backgroundColor,c.strokeStyle=p.borderColor,c.lineWidth=p.borderWidth,c.beginPath(),c.moveTo(i+H,M),S==="top"&&this.drawCaret(r,c,h,p),c.lineTo(i+P-W,M),c.quadraticCurveTo(i+P,M,i+P,M+W),S==="center"&&x==="right"&&this.drawCaret(r,c,h,p),c.lineTo(i+P,M+N-re),c.quadraticCurveTo(i+P,M+N,i+P-re,M+N),S==="bottom"&&this.drawCaret(r,c,h,p),c.lineTo(i+K,M+N),c.quadraticCurveTo(i,M+N,i,M+N-K),S==="center"&&x==="left"&&this.drawCaret(r,c,h,p),c.lineTo(i,M+H),c.quadraticCurveTo(i,M,i+H,M),c.closePath(),c.fill(),p.borderWidth>0&&c.stroke()}_updateAnimationTarget(r){const c=this.chart,h=this.$animations,p=h&&h.x,x=h&&h.y;if(p||x){const S=Gv[r.position].call(this,this._active,this._eventPosition);if(!S)return;const i=this._size=rC(this,r),M=Object.assign({},S,this._size),P=sC(c,r,M),N=oC(r,M,P,c);(p._to!==N.x||x._to!==N.y)&&(this.xAlign=P.xAlign,this.yAlign=P.yAlign,this.width=i.width,this.height=i.height,this.caretX=S.x,this.caretY=S.y,this._resolveAnimations().update(this,N))}}_willRender(){return!!this.opacity}draw(r){const c=this.options.setContext(this.getContext());let h=this.opacity;if(!h)return;this._updateAnimationTarget(c);const p={width:this.width,height:this.height},x={x:this.x,y:this.y};h=Math.abs(h)<.001?0:h;const S=Sh(c.padding),i=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;c.enabled&&i&&(r.save(),r.globalAlpha=h,this.drawBackground(x,r,p,c),SP(r,c.textDirection),x.y+=S.top,this.drawTitle(x,r,c),this.drawBody(x,r,c),this.drawFooter(x,r,c),TP(r,c.textDirection),r.restore())}getActiveElements(){return this._active||[]}setActiveElements(r,c){const h=this._active,p=r.map(({datasetIndex:i,index:M})=>{const P=this.chart.getDatasetMeta(i);if(!P)throw new Error("Cannot find a dataset at index "+i);return{datasetIndex:i,element:P.data[M],index:M}}),x=!xb(h,p),S=this._positionChanged(p,c);(x||S)&&(this._active=p,this._eventPosition=c,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(r,c,h=!0){if(c&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const p=this.options,x=this._active||[],S=this._getActiveElements(r,x,c,h),i=this._positionChanged(S,r),M=c||!xb(S,x)||i;return M&&(this._active=S,(p.enabled||p.external)&&(this._eventPosition={x:r.x,y:r.y},this.update(!0,c))),M}_getActiveElements(r,c,h,p){const x=this.options;if(r.type==="mouseout")return[];if(!p)return c.filter(i=>this.chart.data.datasets[i.datasetIndex]&&this.chart.getDatasetMeta(i.datasetIndex).controller.getParsed(i.index)!==void 0);const S=this.chart.getElementsAtEventForMode(r,x.mode,x,h);return x.reverse&&S.reverse(),S}_positionChanged(r,c){const{caretX:h,caretY:p,options:x}=this,S=Gv[x.position].call(this,r,c);return S!==!1&&(h!==S.x||p!==S.y)}}var VP={id:"tooltip",_element:uC,positioners:Gv,afterInit(o,r,c){c&&(o.tooltip=new uC({chart:o,options:c}))},beforeUpdate(o,r,c){o.tooltip&&o.tooltip.initialize(c)},reset(o,r,c){o.tooltip&&o.tooltip.initialize(c)},afterDraw(o){const r=o.tooltip;if(r&&r._willRender()){const c={tooltip:r};if(o.notifyPlugins("beforeTooltipDraw",{...c,cancelable:!0})===!1)return;r.draw(o.ctx),o.notifyPlugins("afterTooltipDraw",c)}},afterEvent(o,r){if(o.tooltip){const c=r.replay;o.tooltip.handleEvent(r.event,c,r.inChartArea)&&(r.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(o,r)=>r.bodyFont.size,boxWidth:(o,r)=>r.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:$P},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:o=>o!=="filter"&&o!=="itemSort"&&o!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const q$=(o,r,c,h)=>(typeof r=="string"?(c=o.push(r)-1,h.unshift({index:c,label:r})):isNaN(r)&&(c=null),c);function W$(o,r,c,h){const p=o.indexOf(r);if(p===-1)return q$(o,r,c,h);const x=o.lastIndexOf(r);return p!==x?c:p}const Z$=(o,r)=>o===null?null:wh(Math.round(o),0,r);function dC(o){const r=this.getLabels();return o>=0&&o<r.length?r[o]:o}class HP extends Ty{static id="category";static defaults={ticks:{callback:dC}};constructor(r){super(r),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(r){const c=this._addedLabels;if(c.length){const h=this.getLabels();for(const{index:p,label:x}of c)h[p]===x&&h.splice(p,1);this._addedLabels=[]}super.init(r)}parse(r,c){if(cs(r))return null;const h=this.getLabels();return c=isFinite(c)&&h[c]===r?c:W$(h,r,Nr(c,r),this._addedLabels),Z$(c,h.length-1)}determineDataLimits(){const{minDefined:r,maxDefined:c}=this.getUserBounds();let{min:h,max:p}=this.getMinMax(!0);this.options.bounds==="ticks"&&(r||(h=0),c||(p=this.getLabels().length-1)),this.min=h,this.max=p}buildTicks(){const r=this.min,c=this.max,h=this.options.offset,p=[];let x=this.getLabels();x=r===0&&c===x.length-1?x:x.slice(r,c+1),this._valueRange=Math.max(x.length-(h?0:1),1),this._startValue=this.min-(h?.5:0);for(let S=r;S<=c;S++)p.push({value:S});return p}getLabelForValue(r){return dC.call(this,r)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(r){return typeof r!="number"&&(r=this.parse(r)),r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getPixelForTick(r){const c=this.ticks;return r<0||r>c.length-1?null:this.getPixelForValue(c[r].value)}getValueForPixel(r){return Math.round(this._startValue+this.getDecimalForPixel(r)*this._valueRange)}getBasePixel(){return this.bottom}}function X$(o,r){const c=[],{bounds:p,step:x,min:S,max:i,precision:M,count:P,maxTicks:N,maxDigits:H,includeBounds:W}=o,K=x||1,re=N-1,{min:ae,max:ce}=r,ve=!cs(S),Se=!cs(i),Ee=!cs(P),Qe=(ce-ae)/(H+1);let He=pA((ce-ae)/re/K)*K,ke,tt,Ke,lt;if(He<1e-14&&!ve&&!Se)return[{value:ae},{value:ce}];lt=Math.ceil(ce/He)-Math.floor(ae/He),lt>re&&(He=pA(lt*He/re/K)*K),cs(M)||(ke=Math.pow(10,M),He=Math.ceil(He*ke)/ke),p==="ticks"?(tt=Math.floor(ae/He)*He,Ke=Math.ceil(ce/He)*He):(tt=ae,Ke=ce),ve&&Se&&x&&Q4((i-S)/x,He/1e3)?(lt=Math.round(Math.min((i-S)/He,N)),He=(i-S)/lt,tt=S,Ke=i):Ee?(tt=ve?S:tt,Ke=Se?i:Ke,lt=P-1,He=(Ke-tt)/lt):(lt=(Ke-tt)/He,sb(lt,Math.round(lt),He/1e3)?lt=Math.round(lt):lt=Math.ceil(lt));const ft=Math.max(gA(He),gA(tt));ke=Math.pow(10,cs(M)?ft:M),tt=Math.round(tt*ke)/ke,Ke=Math.round(Ke*ke)/ke;let gt=0;for(ve&&(W&&tt!==S?(c.push({value:S}),tt<S&&gt++,sb(Math.round((tt+gt*He)*ke)/ke,S,hC(S,Qe,o))&&gt++):tt<S&&gt++);gt<lt;++gt){const ni=Math.round((tt+gt*He)*ke)/ke;if(Se&&ni>i)break;c.push({value:ni})}return Se&&W&&Ke!==i?c.length&&sb(c[c.length-1].value,i,hC(i,Qe,o))?c[c.length-1].value=i:c.push({value:i}):(!Se||Ke===i)&&c.push({value:Ke}),c}function hC(o,r,{horizontal:c,minRotation:h}){const p=Wg(h),x=(c?Math.sin(p):Math.cos(p))||.001,S=.75*r*(""+o).length;return Math.min(r/x,S)}class Y$ extends Ty{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(r,c){return cs(r)||(typeof r=="number"||r instanceof Number)&&!isFinite(+r)?null:+r}handleTickRangeOptions(){const{beginAtZero:r}=this.options,{minDefined:c,maxDefined:h}=this.getUserBounds();let{min:p,max:x}=this;const S=M=>p=c?p:M,i=M=>x=h?x:M;if(r){const M=Up(p),P=Up(x);M<0&&P<0?i(0):M>0&&P>0&&S(0)}if(p===x){let M=x===0?1:Math.abs(x*.05);i(x+M),r||S(p-M)}this.min=p,this.max=x}getTickLimit(){const r=this.options.ticks;let{maxTicksLimit:c,stepSize:h}=r,p;return h?(p=Math.ceil(this.max/h)-Math.floor(this.min/h)+1,p>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${h} would result generating up to ${p} ticks. Limiting to 1000.`),p=1e3)):(p=this.computeTickLimit(),c=c||11),c&&(p=Math.min(c,p)),p}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const r=this.options,c=r.ticks;let h=this.getTickLimit();h=Math.max(2,h);const p={maxTicks:h,bounds:r.bounds,min:r.min,max:r.max,precision:c.precision,step:c.stepSize,count:c.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:c.minRotation||0,includeBounds:c.includeBounds!==!1},x=this._range||this,S=X$(p,x);return r.bounds==="ticks"&&e5(S,this,"value"),r.reverse?(S.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),S}configure(){const r=this.ticks;let c=this.min,h=this.max;if(super.configure(),this.options.offset&&r.length){const p=(h-c)/Math.max(r.length-1,1)/2;c-=p,h+=p}this._startValue=c,this._endValue=h,this._valueRange=h-c}getLabelForValue(r){return fP(r,this.chart.options.locale,this.options.ticks.format)}}class GP extends Y${static id="linear";static defaults={ticks:{callback:mP.formatters.numeric}};determineDataLimits(){const{min:r,max:c}=this.getMinMax(!0);this.min=Nd(r)?r:0,this.max=Nd(c)?c:1,this.handleTickRangeOptions()}computeTickLimit(){const r=this.isHorizontal(),c=r?this.width:this.height,h=Wg(this.options.ticks.minRotation),p=(r?Math.sin(h):Math.cos(h))||.001,x=this._resolveTickFontOptions(0);return Math.ceil(c/Math.min(40,x.lineHeight/p))}getPixelForValue(r){return r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getValueForPixel(r){return this._startValue+this.getDecimalForPixel(r)*this._valueRange}}const Rb={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},vu=Object.keys(Rb);function fC(o,r){return o-r}function mC(o,r){if(cs(r))return null;const c=o._adapter,{parser:h,round:p,isoWeekday:x}=o._parseOpts;let S=r;return typeof h=="function"&&(S=h(S)),Nd(S)||(S=typeof h=="string"?c.parse(S,h):c.parse(S)),S===null?null:(p&&(S=p==="week"&&(Sb(x)||x===!0)?c.startOf(S,"isoWeek",x):c.startOf(S,p)),+S)}function pC(o,r,c,h){const p=vu.length;for(let x=vu.indexOf(o);x<p-1;++x){const S=Rb[vu[x]],i=S.steps?S.steps:Number.MAX_SAFE_INTEGER;if(S.common&&Math.ceil((c-r)/(i*S.size))<=h)return vu[x]}return vu[p-1]}function K$(o,r,c,h,p){for(let x=vu.length-1;x>=vu.indexOf(c);x--){const S=vu[x];if(Rb[S].common&&o._adapter.diff(p,h,S)>=r-1)return S}return vu[c?vu.indexOf(c):0]}function J$(o){for(let r=vu.indexOf(o)+1,c=vu.length;r<c;++r)if(Rb[vu[r]].common)return vu[r]}function gC(o,r,c){if(!c)o[r]=!0;else if(c.length){const{lo:h,hi:p}=RS(c,r),x=c[h]>=r?c[h]:c[p];o[x]=!0}}function Q$(o,r,c,h){const p=o._adapter,x=+p.startOf(r[0].value,h),S=r[r.length-1].value;let i,M;for(i=x;i<=S;i=+p.add(i,1,h))M=c[i],M>=0&&(r[M].major=!0);return r}function _C(o,r,c){const h=[],p={},x=r.length;let S,i;for(S=0;S<x;++S)i=r[S],p[i]=S,h.push({value:i,major:!1});return x===0||!c?h:Q$(o,h,p,c)}class yC extends Ty{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(r){super(r),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(r,c={}){const h=r.time||(r.time={}),p=this._adapter=new xU._date(r.adapters.date);p.init(c),Xv(h.displayFormats,p.formats()),this._parseOpts={parser:h.parser,round:h.round,isoWeekday:h.isoWeekday},super.init(r),this._normalized=c.normalized}parse(r,c){return r===void 0?null:mC(this,r)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const r=this.options,c=this._adapter,h=r.time.unit||"day";let{min:p,max:x,minDefined:S,maxDefined:i}=this.getUserBounds();function M(P){!S&&!isNaN(P.min)&&(p=Math.min(p,P.min)),!i&&!isNaN(P.max)&&(x=Math.max(x,P.max))}(!S||!i)&&(M(this._getLabelBounds()),(r.bounds!=="ticks"||r.ticks.source!=="labels")&&M(this.getMinMax(!1))),p=Nd(p)&&!isNaN(p)?p:+c.startOf(Date.now(),h),x=Nd(x)&&!isNaN(x)?x:+c.endOf(Date.now(),h)+1,this.min=Math.min(p,x-1),this.max=Math.max(p+1,x)}_getLabelBounds(){const r=this.getLabelTimestamps();let c=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;return r.length&&(c=r[0],h=r[r.length-1]),{min:c,max:h}}buildTicks(){const r=this.options,c=r.time,h=r.ticks,p=h.source==="labels"?this.getLabelTimestamps():this._generate();r.bounds==="ticks"&&p.length&&(this.min=this._userMin||p[0],this.max=this._userMax||p[p.length-1]);const x=this.min,S=this.max,i=o5(p,x,S);return this._unit=c.unit||(h.autoSkip?pC(c.minUnit,this.min,this.max,this._getLabelCapacity(x)):K$(this,i.length,c.minUnit,this.min,this.max)),this._majorUnit=!h.major.enabled||this._unit==="year"?void 0:J$(this._unit),this.initOffsets(p),r.reverse&&i.reverse(),_C(this,i,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(r=>+r.value))}initOffsets(r=[]){let c=0,h=0,p,x;this.options.offset&&r.length&&(p=this.getDecimalForValue(r[0]),r.length===1?c=1-p:c=(this.getDecimalForValue(r[1])-p)/2,x=this.getDecimalForValue(r[r.length-1]),r.length===1?h=x:h=(x-this.getDecimalForValue(r[r.length-2]))/2);const S=r.length<3?.5:.25;c=wh(c,0,S),h=wh(h,0,S),this._offsets={start:c,end:h,factor:1/(c+1+h)}}_generate(){const r=this._adapter,c=this.min,h=this.max,p=this.options,x=p.time,S=x.unit||pC(x.minUnit,c,h,this._getLabelCapacity(c)),i=Nr(p.ticks.stepSize,1),M=S==="week"?x.isoWeekday:!1,P=Sb(M)||M===!0,N={};let H=c,W,K;if(P&&(H=+r.startOf(H,"isoWeek",M)),H=+r.startOf(H,P?"day":S),r.diff(h,c,S)>1e5*i)throw new Error(c+" and "+h+" are too far apart with stepSize of "+i+" "+S);const re=p.ticks.source==="data"&&this.getDataTimestamps();for(W=H,K=0;W<h;W=+r.add(W,i,S),K++)gC(N,W,re);return(W===h||p.bounds==="ticks"||K===1)&&gC(N,W,re),Object.keys(N).sort(fC).map(ae=>+ae)}getLabelForValue(r){const c=this._adapter,h=this.options.time;return h.tooltipFormat?c.format(r,h.tooltipFormat):c.format(r,h.displayFormats.datetime)}format(r,c){const p=this.options.time.displayFormats,x=this._unit,S=c||p[x];return this._adapter.format(r,S)}_tickFormatFunction(r,c,h,p){const x=this.options,S=x.ticks.callback;if(S)return Ms(S,[r,c,h],this);const i=x.time.displayFormats,M=this._unit,P=this._majorUnit,N=M&&i[M],H=P&&i[P],W=h[c],K=P&&H&&W&&W.major;return this._adapter.format(r,p||(K?H:N))}generateTickLabels(r){let c,h,p;for(c=0,h=r.length;c<h;++c)p=r[c],p.label=this._tickFormatFunction(p.value,c,r)}getDecimalForValue(r){return r===null?NaN:(r-this.min)/(this.max-this.min)}getPixelForValue(r){const c=this._offsets,h=this.getDecimalForValue(r);return this.getPixelForDecimal((c.start+h)*c.factor)}getValueForPixel(r){const c=this._offsets,h=this.getDecimalForPixel(r)/c.factor-c.end;return this.min+h*(this.max-this.min)}_getLabelSize(r){const c=this.options.ticks,h=this.ctx.measureText(r).width,p=Wg(this.isHorizontal()?c.maxRotation:c.minRotation),x=Math.cos(p),S=Math.sin(p),i=this._resolveTickFontOptions(0).size;return{w:h*x+i*S,h:h*S+i*x}}_getLabelCapacity(r){const c=this.options.time,h=c.displayFormats,p=h[c.unit]||h.millisecond,x=this._tickFormatFunction(r,0,_C(this,[r],this._majorUnit),p),S=this._getLabelSize(x),i=Math.floor(this.isHorizontal()?this.width/S.w:this.height/S.h)-1;return i>0?i:1}getDataTimestamps(){let r=this._cache.data||[],c,h;if(r.length)return r;const p=this.getMatchingVisibleMetas();if(this._normalized&&p.length)return this._cache.data=p[0].controller.getAllParsedValues(this);for(c=0,h=p.length;c<h;++c)r=r.concat(p[c].controller.getAllParsedValues(this));return this._cache.data=this.normalize(r)}getLabelTimestamps(){const r=this._cache.labels||[];let c,h;if(r.length)return r;const p=this.getLabels();for(c=0,h=p.length;c<h;++c)r.push(mC(this,p[c]));return this._cache.labels=this._normalized?r:this.normalize(r)}normalize(r){return lP(r.sort(fC))}}function Z0(o,r,c){let h=0,p=o.length-1,x,S,i,M;c?(r>=o[h].pos&&r<=o[p].pos&&({lo:h,hi:p}=iS(o,"pos",r)),{pos:x,time:i}=o[h],{pos:S,time:M}=o[p]):(r>=o[h].time&&r<=o[p].time&&({lo:h,hi:p}=iS(o,"time",r)),{time:x,pos:i}=o[h],{time:S,pos:M}=o[p]);const P=S-x;return P?i+(M-i)*(r-x)/P:i}class CV extends yC{static id="timeseries";static defaults=yC.defaults;constructor(r){super(r),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const r=this._getTimestampsForTable(),c=this._table=this.buildLookupTable(r);this._minPos=Z0(c,this.min),this._tableRange=Z0(c,this.max)-this._minPos,super.initOffsets(r)}buildLookupTable(r){const{min:c,max:h}=this,p=[],x=[];let S,i,M,P,N;for(S=0,i=r.length;S<i;++S)P=r[S],P>=c&&P<=h&&p.push(P);if(p.length<2)return[{time:c,pos:0},{time:h,pos:1}];for(S=0,i=p.length;S<i;++S)N=p[S+1],M=p[S-1],P=p[S],Math.round((N+M)/2)!==P&&x.push({time:P,pos:S/(i-1)});return x}_generate(){const r=this.min,c=this.max;let h=super.getDataTimestamps();return(!h.includes(r)||!h.length)&&h.splice(0,0,r),(!h.includes(c)||h.length===1)&&h.push(c),h.sort((p,x)=>p-x)}_getTimestampsForTable(){let r=this._cache.all||[];if(r.length)return r;const c=this.getDataTimestamps(),h=this.getLabelTimestamps();return c.length&&h.length?r=this.normalize(c.concat(h)):r=c.length?c:h,r=this._cache.all=r,r}getDecimalForValue(r){return(Z0(this._table,r)-this._minPos)/this._tableRange}getValueForPixel(r){const c=this._offsets,h=this.getDecimalForPixel(r)/c.factor-c.end;return Z0(this._table,h*this._tableRange+this._minPos,!0)}}const qP="label";function vC(o,r){typeof o=="function"?o(r):o&&(o.current=r)}function eV(o,r){const c=o.options;c&&r&&Object.assign(c,r)}function WP(o,r){o.labels=r}function ZP(o,r,c=qP){const h=[];o.datasets=r.map(p=>{const x=o.datasets.find(S=>S[c]===p[c]);return!x||!p.data||h.includes(x)?{...p}:(h.push(x),Object.assign(x,p),x)})}function tV(o,r=qP){const c={labels:[],datasets:[]};return WP(c,o.labels),ZP(c,o.datasets,r),c}function iV(o,r){const{height:c=150,width:h=300,redraw:p=!1,datasetIdKey:x,type:S,data:i,options:M,plugins:P=[],fallbackContent:N,updateMode:H,...W}=o,K=ye.useRef(null),re=ye.useRef(null),ae=()=>{K.current&&(re.current=new yx(K.current,{type:S,data:tV(i,x),options:M&&{...M},plugins:P}),vC(r,re.current))},ce=()=>{vC(r,null),re.current&&(re.current.destroy(),re.current=null)};return ye.useEffect(()=>{!p&&re.current&&M&&eV(re.current,M)},[p,M]),ye.useEffect(()=>{!p&&re.current&&WP(re.current.config.data,i.labels)},[p,i.labels]),ye.useEffect(()=>{!p&&re.current&&i.datasets&&ZP(re.current.config.data,i.datasets,x)},[p,i.datasets]),ye.useEffect(()=>{re.current&&(p?(ce(),setTimeout(ae)):re.current.update(H))},[p,M,i.labels,i.datasets,H]),ye.useEffect(()=>{re.current&&(ce(),setTimeout(ae))},[S]),ye.useEffect(()=>(ae(),()=>ce()),[]),C.jsx("canvas",{ref:K,role:"img",height:c,width:h,...W,children:N})}const nV=ye.forwardRef(iV);function aV(o,r){return yx.register(r),ye.forwardRef((c,h)=>C.jsx(nV,{...c,ref:h,type:o}))}const XP=aV("bar",vU);yx.register(HP,GP,FP,VP,UP);const R1="/v1",rV=o=>{if(!o)return"-";const r=new Date(o);return`${r.getDate()}/${r.getMonth()+1}/${r.getFullYear()} ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}`},sV=()=>{const o=new Date;return`${o.getDate()}/${o.getMonth()+1}/${o.getFullYear()} ${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}`},X0=o=>o||0;function YP(o,r){const c={};return o.forEach(h=>{const p=r(h);c[p]=(c[p]||0)+1}),c}function Mp(o,r="hour"){return YP(o,({created_at:c})=>{const h=new Date(c);return r==="hour"?h.getHours():r==="day"?h.getDay():r==="date"?h.toISOString().slice(0,10):r==="month"?h.getMonth()+1:r==="year"?h.getFullYear():"Unknown"})}const Rd={hour:Array.from({length:24},(o,r)=>`${r}:00`),day:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},KP=({children:o,className:r})=>C.jsx("div",{className:`rounded-xl border border-gray-300 bg-white p-6 mb-8 shadow-none ${r}`,style:{pageBreakInside:"avoid"},children:o}),Y0=({label:o,value:r,description:c})=>C.jsxs("div",{className:"flex flex-col items-center justify-center border border-gray-300 rounded-lg bg-white px-6 py-10",style:{height:"130px",minWidth:"170px",maxWidth:"220px"},children:[C.jsx("div",{className:"uppercase text-xs text-gray-500 font-medium mb-2 tracking-widest letter-spacing-wider",children:o}),C.jsx("div",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:r}),C.jsx("div",{className:"text-xs text-gray-500 font-normal text-center",children:c})]}),D1=({children:o})=>C.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-3 tracking-tight",style:{marginTop:"24px"},children:o}),ry=({labels:o,data:r,title:c,color:h})=>C.jsxs(KP,{className:"p-4 mb-6",style:{width:"100%",maxWidth:"650px",margin:"0 auto",height:"220px",boxShadow:"none"},children:[C.jsx("h4",{className:"font-semibold text-md mb-3 text-gray-700",children:c}),C.jsx(XP,{data:{labels:o,datasets:[{label:c,data:r,backgroundColor:h,borderRadius:8}]},options:{plugins:{legend:{display:!1}},responsive:!1,maintainAspectRatio:!1,layout:{padding:{top:10,bottom:10,left:0,right:0}},scales:{x:{ticks:{color:"#444",font:{size:12}},grid:{color:"#e5e5e5"}},y:{beginAtZero:!0,ticks:{stepSize:1,color:"#444",font:{size:12}}}}},width:650,height:145})]}),oV=()=>{const{market_id:o}=cl(),[r,c]=ye.useState(null),[h,p]=ye.useState([]),[x,S]=ye.useState(null);ye.useEffect(()=>{if(!o)return;const tt=async()=>{try{const ft=await fetch(`${R1}/market/${o}/statistic`);if(!ft.ok)throw new Error("Failed to fetch statistic");const gt=await ft.json();c(gt)}catch(ft){console.error(ft)}},Ke=async()=>{try{const ft=await fetch(`${R1}/market/${o}/vendor`);if(!ft.ok)throw new Error("Failed to fetch vendors");const gt=await ft.json();p(gt)}catch(ft){console.error(ft)}};(async()=>{try{const ft=await fetch(`${R1}/market/${o}`);if(!ft.ok)throw new Error("Failed to fetch market detail");const gt=await ft.json();S(gt)}catch(ft){console.error(ft)}})(),tt(),Ke()},[o]);const i=r?.market_history||[],M=r?.market_review||[],P=r?.market_click||[],N=ye.useMemo(()=>Mp(i,"hour"),[i]),H=ye.useMemo(()=>Mp(i,"day"),[i]),W=ye.useMemo(()=>Mp(i,"month"),[i]);ye.useMemo(()=>Mp(i,"year"),[i]);const K=ye.useMemo(()=>Mp(P,"hour"),[P]),re=ye.useMemo(()=>Mp(P,"day"),[P]),ae=ye.useMemo(()=>Mp(P,"month"),[P]);ye.useMemo(()=>Mp(P,"year"),[P]);const ce=M.length,ve=ce>0?(M.reduce((tt,Ke)=>tt+Number(Ke.rating??0),0)/ce).toFixed(2):"-",Se=ye.useMemo(()=>YP(M,tt=>tt.rating??"-"),[M]);[...h].sort((tt,Ke)=>Ke.avg_rating-tt.avg_rating).slice(0,3);const Ee=r?.market_history?.length||0,Qe=r?.market_review?.length||0,He=r?.market_content?.length||0,ke=r?.market_click?.length||0;return C.jsxs("div",{className:"bg-white text-black",style:{fontFamily:"Inter, Arial, sans-serif",width:"210mm",minHeight:"297mm",margin:"0 auto",boxSizing:"border-box",padding:"36px 30px",background:"#fff"},children:[C.jsxs("div",{className:"mb-8 pb-2 border-b border-gray-200",children:[C.jsxs("div",{className:"flex flex-row items-end gap-2",children:[C.jsx("img",{src:"/tamulokal.png",className:"w-8"}),C.jsx("h1",{className:"text-xl font-bold font-inter",children:"TamuKinabalu"})]}),C.jsx("h1",{className:"text-4xl font-bold text-gray-900 pb-2",children:"Market Statistical Report"}),C.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1 leading-tight",children:x?.name||C.jsx("span",{className:"text-gray-400",children:"Market Name"})}),C.jsxs("div",{className:"flex flex-row justify-between items-center",children:[C.jsxs("div",{className:"text-sm text-gray-500",children:["Created at:"," ",x?.created_at?rV(x.created_at):"-"]}),C.jsxs("div",{className:"text-sm text-gray-500 text-right",children:["Generated on: ",sV()]})]})]}),C.jsxs("div",{className:"flex flex-row gap-6 mb-8",style:{pageBreakInside:"avoid",alignItems:"stretch",justifyContent:"center"},children:[C.jsx(Y0,{label:"Total Visit",value:X0(Ee),description:"Unique individuals who visited this market."}),C.jsx(Y0,{label:"Total Reviews",value:X0(Qe),description:"Total reviews submitted for this market."}),C.jsx(Y0,{label:"Mentions",value:X0(He),description:"Times the market was mentioned in platform posts."}),C.jsx(Y0,{label:"Market Clicks",value:X0(ke),description:"Users who clicked on the market profile."})]}),C.jsxs(KP,{className:"mb-10",style:{maxWidth:"520px",margin:"0 auto"},children:[C.jsx(D1,{children:"Market Rating Summary"}),C.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[C.jsxs("div",{children:[C.jsxs("div",{className:"text-xl font-bold text-gray-800",children:[ve," ",C.jsx(Wo,{className:"inline mb-1 text-yellow-500"})]}),C.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:["Average Rating (",ce," review",ce===1?"":"s",")"]})]}),C.jsxs("div",{children:[C.jsx("div",{className:"flex gap-2",children:[5,4,3,2,1].map(tt=>C.jsxs("div",{className:"flex flex-col items-center",children:[C.jsx("span",{className:"font-semibold text-gray-800",children:tt}),C.jsx(Wo,{className:"text-yellow-500 mb-1"}),C.jsx("span",{className:"text-sm text-gray-500",children:Se[tt]||0})]},tt))}),C.jsx("div",{className:"text-xs text-gray-400 text-right mt-2",children:"Count per rating"})]})]})]}),C.jsxs(C.Fragment,{children:[C.jsx(D1,{children:"Market Visit Peak Times"}),C.jsx(ry,{labels:Rd.hour,data:Rd.hour.map((tt,Ke)=>N[Ke]||0),title:"Visits by Hour",color:"#fb923c"}),C.jsx(ry,{labels:Rd.day,data:Rd.day.map((tt,Ke)=>H[Ke]||0),title:"Visits by Day of Week",color:"#60a5fa"}),C.jsx(ry,{labels:Rd.month,data:Rd.month.map((tt,Ke)=>W[Ke+1]||0),title:"Visits by Month",color:"#34d399"})]}),C.jsxs(C.Fragment,{children:[C.jsx(D1,{children:"Market Profile Click Peak Times"}),C.jsx(ry,{labels:Rd.hour,data:Rd.hour.map((tt,Ke)=>K[Ke]||0),title:"Profile Clicks by Hour",color:"#fbbf24"}),C.jsx(ry,{labels:Rd.day,data:Rd.day.map((tt,Ke)=>re[Ke]||0),title:"Profile Clicks by Day of Week",color:"#818cf8"}),C.jsx(ry,{labels:Rd.month,data:Rd.month.map((tt,Ke)=>ae[Ke+1]||0),title:"Profile Clicks by Month",color:"#67e8f9"})]})]})};yx.register(HP,GP,FP,VP,UP);const xC="/v1",lV=o=>{if(!o)return"-";const r=new Date(o);return`${r.getDate()}/${r.getMonth()+1}/${r.getFullYear()} ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}`},cV=()=>{const o=new Date;return`${o.getDate()}/${o.getMonth()+1}/${o.getFullYear()} ${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}`};function uV(o,r){const c={};return o.forEach(h=>{const p=r(h);c[p]=(c[p]||0)+1}),c}function gm(o,r="hour"){return uV(o,({created_at:c})=>{const h=new Date(c);return r==="hour"?h.getHours():r==="day"?h.getDay():r==="month"?h.getMonth()+1:"Unknown"})}const zl={hour:Array.from({length:24},(o,r)=>`${r}:00`),day:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},dV=({children:o,className:r})=>C.jsx("div",{className:`rounded-xl border border-gray-300 bg-white p-6 mb-8 shadow-none ${r||""}`,style:{pageBreakInside:"avoid"},children:o}),L1=({label:o,value:r,description:c})=>C.jsxs("div",{className:"flex flex-col items-center justify-center border border-gray-300 rounded-lg bg-white px-6 py-10",style:{height:"130px",minWidth:"170px",maxWidth:"220px"},children:[C.jsx("div",{className:"uppercase text-xs text-gray-500 font-medium mb-2 tracking-widest letter-spacing-wider",children:o}),C.jsx("div",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:r}),C.jsx("div",{className:"text-xs text-gray-500 font-normal text-center",children:c})]}),K0=({children:o})=>C.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-3 tracking-tight",style:{marginTop:"24px"},children:o}),_m=({labels:o,data:r,title:c,color:h})=>C.jsxs(dV,{className:"p-4 mb-6",style:{width:"100%",maxWidth:"650px",margin:"0 auto",boxShadow:"none"},children:[C.jsx("h4",{className:"font-semibold text-md mb-3 text-gray-700",children:c}),C.jsx(XP,{data:{labels:o,datasets:[{label:c,data:r,backgroundColor:h,borderRadius:8}]},options:{plugins:{legend:{display:!1}},responsive:!1,maintainAspectRatio:!1,layout:{padding:{top:10,bottom:10,left:0,right:0}},scales:{x:{ticks:{color:"#444",font:{size:12}},grid:{color:"#e5e5e5"}},y:{beginAtZero:!0,ticks:{stepSize:1,color:"#444",font:{size:12}}}}},width:650,height:145})]}),hV=({idx:o,product:r})=>C.jsxs("div",{className:`p-4 rounded-xl border-2 flex items-center gap-4 bg-white shadow mb-3 ${o===0?"border-yellow-300":o===1?"border-gray-300":"border-orange-200"}`,style:{minHeight:90},children:[C.jsx("div",{className:"font-bold text-2xl w-8 text-center flex-shrink-0",children:o+1}),r.image?C.jsx("img",{src:r.image,alt:r.name,className:"w-16 h-16 object-cover rounded-lg border border-gray-100",style:{background:"#f3f3f3"}}):C.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400",children:C.jsx(Wo,{className:"text-2xl"})}),C.jsxs("div",{className:"flex flex-col justify-center flex-1 min-w-0",children:[C.jsx("div",{className:"truncate font-semibold text-gray-900",children:r.name}),C.jsxs("div",{className:"flex items-center mt-1 text-yellow-500 font-medium text-base",children:[C.jsx(Wo,{className:"mr-1"}),r.avg_rating.toFixed(1)]})]})]}),fV=()=>{const[o,r]=ye.useState(null),[c,h]=ye.useState(null),{vendor_id:p}=cl();ye.useEffect(()=>{(async()=>{try{const ke=await fetch(`${xC}/vendor/${p}/statistic`);ke.ok&&r(await ke.json());const tt=await fetch(`${xC}/vendor/${p}`);tt.ok&&h(await tt.json())}catch(ke){console.error(ke)}})()},[]);const x=o?.profile_click||[],S=o?.account_follow||[],i=o?.products?.flatMap(He=>(He.reviews||[]).map(ke=>({...ke,product:He.product})))||[],M=x.length,P=S.length;let N=0;if(o?.products?.length>0){const He=o.products.map(ke=>!ke.reviews||ke.reviews.length===0?null:ke.reviews.reduce((Ke,lt)=>Ke+lt.rating,0)/ke.reviews.length).filter(Boolean);He.length>0&&(N=He.reduce((ke,tt)=>ke+tt,0)/He.length)}const H=ye.useMemo(()=>gm(i,"hour"),[i]),W=ye.useMemo(()=>gm(i,"day"),[i]),K=ye.useMemo(()=>gm(i,"month"),[i]),re=ye.useMemo(()=>gm(x,"hour"),[x]),ae=ye.useMemo(()=>gm(x,"day"),[x]),ce=ye.useMemo(()=>gm(x,"month"),[x]),ve=ye.useMemo(()=>gm(S,"hour"),[S]),Se=ye.useMemo(()=>gm(S,"day"),[S]),Ee=ye.useMemo(()=>gm(S,"month"),[S]),Qe=ye.useMemo(()=>o?.products?.map(He=>{if(!He.reviews||He.reviews.length===0)return null;const ke=He.reviews.reduce((tt,Ke)=>tt+Ke.rating,0)/He.reviews.length;return{...He.product,avg_rating:ke,image:He.product?.image}}).filter(Boolean).sort((He,ke)=>ke.avg_rating-He.avg_rating).slice(0,3)||[],[o]);return C.jsxs("div",{className:"bg-white text-black",style:{fontFamily:"Inter, Arial, sans-serif",width:"210mm",minHeight:"297mm",margin:"0 auto",boxSizing:"border-box",padding:"36px 30px",background:"#fff"},children:[C.jsxs("div",{className:"mb-8 pb-2 border-b border-gray-200",children:[C.jsxs("div",{className:"flex flex-row items-end gap-2",children:[C.jsx("img",{src:"/tamulokal.png",className:"w-8",alt:"TamuKinabalu Logo"}),C.jsx("h1",{className:"text-xl font-bold font-inter",children:"TamuKinabalu"})]}),C.jsx("h1",{className:"text-4xl font-bold text-gray-900 pb-2",children:"Vendor Statistical Report"}),C.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1 leading-tight",children:c?.fullname||C.jsx("span",{className:"text-gray-400",children:"Vendor Name"})}),C.jsxs("div",{className:"flex flex-row justify-between items-center",children:[C.jsxs("div",{className:"text-sm text-gray-500",children:["Joined: ",c?.created_at?lV(c.created_at):"-"]}),C.jsxs("div",{className:"text-sm text-gray-500 text-right",children:["Generated on: ",cV()]})]})]}),C.jsxs("div",{className:"flex flex-row gap-6 mb-8",style:{pageBreakInside:"avoid",alignItems:"stretch",justifyContent:"center"},children:[C.jsx(L1,{label:"Profile Clicks",value:M,description:"Total click counts on your profile"}),C.jsx(L1,{label:"Followers",value:P,description:"Current number of followers"}),C.jsx(L1,{label:"Review Score",value:N?N.toFixed(1):"-",description:"Overall average rating of your products"})]}),C.jsx(K0,{children:"Review Trends"}),C.jsx(_m,{labels:zl.hour,data:zl.hour.map((He,ke)=>H[ke]||0),title:"Reviews by Hour",color:"#fb923c"}),C.jsx(_m,{labels:zl.day,data:zl.day.map((He,ke)=>W[ke]||0),title:"Reviews by Day of Week",color:"#60a5fa"}),C.jsx(_m,{labels:zl.month,data:zl.month.map((He,ke)=>K[ke+1]||0),title:"Reviews by Month",color:"#34d399"}),C.jsx(K0,{children:"Profile Click Trends"}),C.jsx(_m,{labels:zl.hour,data:zl.hour.map((He,ke)=>re[ke]||0),title:"Profile Clicks by Hour",color:"#fbbf24"}),C.jsx(_m,{labels:zl.day,data:zl.day.map((He,ke)=>ae[ke]||0),title:"Profile Clicks by Day of Week",color:"#818cf8"}),C.jsx(_m,{labels:zl.month,data:zl.month.map((He,ke)=>ce[ke+1]||0),title:"Profile Clicks by Month",color:"#67e8f9"}),C.jsx(K0,{children:"Follower Trends"}),C.jsx(_m,{labels:zl.hour,data:zl.hour.map((He,ke)=>ve[ke]||0),title:"Followers by Hour",color:"#a7f3d0"}),C.jsx(_m,{labels:zl.day,data:zl.day.map((He,ke)=>Se[ke]||0),title:"Followers by Day of Week",color:"#f472b6"}),C.jsx(_m,{labels:zl.month,data:zl.month.map((He,ke)=>Ee[ke+1]||0),title:"Followers by Month",color:"#f9fafb"}),Qe.length>0&&C.jsxs("div",{style:{marginTop:60},children:[C.jsx(K0,{children:"Top 3 Products"}),Qe.map((He,ke)=>C.jsx(hV,{idx:ke,product:He},He.id))]})]})},bC="/v1",mV=[{id:1,name:"Fresh Produce",emoji:""},{id:2,name:"Street Food",emoji:""},{id:3,name:"Snacks & Drinks",emoji:""},{id:4,name:"Clothing",emoji:""},{id:5,name:"Handicrafts",emoji:""},{id:6,name:"Fruits",emoji:""},{id:7,name:"Seafood",emoji:""},{id:8,name:"Performance",emoji:""}],wC=({isOwnProfile:o=!1})=>{const r=Uc();console.log(o);const c=$a(),{product_id:h}=cl(),[p,x]=ye.useState(null),[S,i]=ye.useState(!0);if(console.log(p),ye.useEffect(()=>{(async()=>{try{const re=await(await fetch(`${bC}/product/${h}`)).json();x(re)}catch(K){console.error("Failed to fetch product",K)}finally{i(!1)}})()},[h]),S)return C.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loading..."});if(!p||!p.product)return C.jsx("div",{className:"p-6 text-center text-red-500",children:"Product not found"});const{product:M,categories:P}=p,N=P.map(W=>mV.find(K=>K.id===W.category_id)),H=async(W,K)=>{try{await fetch(`${bC}/product/${h}/review?id=${W}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({hide:K})}),x(re=>({...re,product:{...re.product,reviews:re.product.reviews.map(ae=>ae.id===W?{...ae,hide:K}:ae)}}))}catch(re){console.error("Failed to update review visibility",re),alert("Failed to update review visibility")}};return C.jsxs("div",{className:"relative w-full h-screen",children:[C.jsx(dc,{title:M.name}),C.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[C.jsxs("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:[C.jsx("div",{className:"w-full aspect-square bg-gray-100",children:C.jsx("img",{src:M.image||"/default-product.png",alt:M.name,className:"w-full h-full object-cover"})}),C.jsxs("div",{className:"p-4 space-y-2",children:[C.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:M.name}),C.jsxs("p",{className:"text-lg font-bold text-[#FF8225]",children:["RM ",M.price]}),C.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:N.map(W=>W&&C.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded-full",children:[W.emoji," ",W.name]},W.id))})]})]}),C.jsxs("div",{className:"space-y-4",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Customer Reviews"}),C.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[C.jsx(Wo,{className:"text-yellow-500",size:16}),M.reviews.length>0?C.jsxs("span",{className:"text-gray-700 font-medium",children:[(M.reviews.reduce((W,K)=>W+K.rating,0)/M.reviews.length).toFixed(1)," ","(",M.reviews.length," reviews)"]}):C.jsx("span",{className:"text-gray-500",children:"No reviews yet"})]})]}),M.reviews.length===0?C.jsx("div",{className:"text-sm text-gray-500",children:"No reviews yet for this product."}):M.reviews.filter(W=>!W.hide||o).map(W=>C.jsxs("div",{className:`relative rounded-lg p-4 pr-12 space-y-3 shadow-sm
  ${W.hide?"bg-gray-50 border border-dashed border-gray-300 opacity-80":"bg-white"}`,children:[o&&C.jsx("button",{onClick:()=>H(W.id,!W.hide),className:"absolute top-3 right-3 bg-white p-1.5 rounded-full shadow hover:bg-gray-100 transition",title:W.hide?"Unhide review":"Hide review",children:W.hide?C.jsx(yS,{className:"text-red-500",size:18}):C.jsx(fx,{className:"text-green-600",size:18})}),o&&W.hide&&C.jsx("span",{className:"absolute top-3 right-12 text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:"Hidden"}),C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("img",{src:W.visitor_image||"/default-avatar.png",alt:W.visitor_fullname||W.visitor_username||"Visitor",className:"w-10 h-10 object-cover rounded-full"}),C.jsxs("div",{className:"flex flex-col text-sm",children:[C.jsx("span",{className:"font-medium text-gray-800",children:W.visitor_fullname||"Anonymous"}),W.visitor_username&&C.jsxs("span",{className:"text-gray-500",children:["@",W.visitor_username]})]}),C.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[C.jsx(Wo,{className:"text-yellow-500",size:14}),C.jsxs("span",{className:"font-medium text-gray-700",children:[W.rating,".0"]})]})]}),C.jsx("p",{className:"text-gray-700 text-sm",children:W.review}),W.image&&C.jsx("img",{src:W.image,alt:"Review",className:"w-24 h-24 object-cover rounded"}),C.jsx("p",{className:"text-xs text-gray-400",children:new Date(W.created_at).toLocaleDateString()})]},W.id)),C.jsx("div",{className:"mt-4",children:C.jsx("button",{onClick:()=>c(`${r.pathname}/review`),className:"w-full bg-[#FF8225] text-white px-4 py-3 rounded-lg shadow hover:bg-orange-600 transition text-center font-medium",children:"Leave a review"})})]})]})]})},J0="/v1",SC=250,pV=({product_id:o,review_id:r})=>{const h=$r(!0)?.user?.id,[p,x]=ye.useState(0),[S,i]=ye.useState(""),[M,P]=ye.useState(null),[N,H]=ye.useState(null),[W,K]=ye.useState(!1),re=r!=null&&o==null;ye.useEffect(()=>{if(!h||!re)return;(async()=>{try{const Qe=await fetch(`${J0}/visitor/${h}/product-review?id=${r}`);if(!Qe.ok)return;const He=await Qe.json();x(He.rating),i(He.review),H(He.image||null)}catch(Qe){console.error("Failed to fetch review",Qe)}})()},[h,r,re]);const ae=Ee=>{const Qe=Ee.target.files[0];Qe&&(P(Qe),H(URL.createObjectURL(Qe)))},ce=async Ee=>{try{const Qe=await Ee.json();return Qe?.id||Qe?.review_id||Qe?.data?.id||Qe?.data?.review_id}catch{return null}},ve=async Ee=>{if(Ee.preventDefault(),!(!p||!S)){K(!0);try{let Qe=r;if(re){if(!(await fetch(`${J0}/visitor/${h}/product-review?id=${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:p,review:S})})).ok)throw new Error("Failed to update review")}else{const He=await fetch(`${J0}/product/${o}/review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:h,rating:p,review:S})});if(!He.ok)throw new Error("Failed to create review");Qe=await ce(He)}if(M&&Qe){const He=await createImageBitmap(M),ke=document.createElement("canvas");ke.width=He.width,ke.height=He.height,ke.getContext("2d").drawImage(He,0,0);const Ke=await new Promise(Ft=>ke.toBlob(Ft,"image/jpeg",.9)),lt=`product-reviews/${o}/${Qe}.jpg`,{error:ft}=await bs.storage.from("tamulokal").upload(lt,Ke,{upsert:!0,contentType:"image/jpeg"});if(ft)throw ft;const{data:gt}=bs.storage.from("tamulokal").getPublicUrl(lt),ni=`${gt.publicUrl}?t=${new Date().getTime()}`;await fetch(`${J0}/visitor/${h}/product-review?id=${Qe}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:ni})})}}catch(Qe){console.error("Failed to submit review",Qe)}finally{K(!1)}}},Se=S.length>SC?"text-red-500":"text-gray-500";return C.jsxs("form",{onSubmit:ve,className:"py-6 md:py-8",children:[C.jsx("div",{className:"bg-white md:rounded-xl md:border md:border-gray-200 md:shadow-sm px-4 md:px-6 py-4 md:py-6",children:C.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[C.jsx("div",{className:"md:w-1/2",children:C.jsxs("label",{className:"block cursor-pointer",children:[C.jsx("input",{type:"file",accept:"image/*",onChange:ae,className:"hidden"}),C.jsx("div",{className:"w-full aspect-square overflow-hidden rounded-lg border border-dashed border-gray-300 bg-gray-50 flex items-center justify-center",children:N?C.jsx("img",{src:N,alt:"Review",className:"w-full h-full object-cover"}):C.jsxs("div",{className:"flex flex-col items-center text-gray-400",children:[C.jsx(uM,{className:"text-3xl mb-2"}),C.jsx("span",{className:"text-sm md:text-base",children:"No image"})]})})]})}),C.jsxs("div",{className:"md:w-1/2 flex flex-col items-center md:justify-between gap-6",children:[C.jsx("div",{className:"w-full flex justify-center md:justify-center gap-3 md:gap-4 md:mt-10",children:[1,2,3,4,5].map(Ee=>C.jsx("button",{type:"button",onClick:()=>x(Ee),className:"text-3xl md:text-4xl text-orange-500",children:p>=Ee?C.jsx(Wo,{}):C.jsx(vy,{})},Ee))}),C.jsxs("div",{className:"w-full max-w-xl",children:[C.jsx("textarea",{value:S,onChange:Ee=>i(Ee.target.value),rows:6,placeholder:"Share your experience...",className:"w-full border border-gray-300 rounded-lg px-3 py-3 text-sm md:text-base bg-white focus:outline-none focus:ring-2 focus:ring-orange-400"}),C.jsxs("div",{className:`mt-2 text-xs md:text-sm text-right ${Se}`,children:[S.length," / ",SC]})]})]})]})}),C.jsx("div",{className:"mt-6 flex justify-end px-4 md:px-0",children:C.jsx("button",{type:"submit",disabled:W,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-3.5 bg-[#FF8225] text-white rounded-md font-semibold text-sm md:text-base hover:bg-[#e6731f] transition disabled:opacity-60",children:W?"Saving...":re?"Save":"Create"})})]})},TC=()=>{$a();const{review_id:o,product_id:r}=cl();return C.jsxs("div",{className:"w-screen min-h-screen flex flex-col",children:[C.jsx(dc,{title:"Product Review"}),C.jsx("div",{className:"flex-1 w-full px-4 md:px-8 pb-10",children:C.jsx("div",{className:"max-w-3xl mx-auto overflow-hidden",children:C.jsx(pV,{product_id:r,review_id:o})})})]})},gV="/v1",_V=()=>{const o=$r(!0),[r,c]=ye.useState([]),[h,p]=ye.useState(!0),x=o?.user?.id,S=$a(),i=Uc();return ye.useEffect(()=>{(async()=>{if(x){p(!0);try{const N=await(await fetch(`${gV}/visitor/${x}/product-review`)).json();c(N)}catch(P){console.error("Failed to fetch reviews",P)}finally{p(!1)}}})()},[x]),h?C.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loading reviews..."}):C.jsxs("div",{className:"relative w-full min-h-screen",children:[C.jsx(dc,{title:"Your Product Reviews"}),C.jsx("div",{className:"max-w-6xl mx-auto p-4 grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:r.length===0?C.jsx("div",{className:"text-gray-500 text-center py-10 col-span-full",children:"You haven't reviewed any products yet."}):r.map(M=>C.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden flex flex-col gap-4",children:[C.jsxs("div",{className:"flex items-center gap-3 p-4",children:[C.jsx("img",{src:M.image||"/default-product.png",alt:M.name,className:"w-24 h-24 md:w-28 md:h-28 object-cover rounded"}),C.jsxs("div",{className:"flex flex-col",children:[C.jsx("h3",{className:"text-lg md:text-xl font-semibold text-gray-800",children:M.name}),C.jsxs("p",{className:"text-sm md:text-base text-gray-600",children:["Price: RM ",M.price," | Quantity: ",M.quantity]})]})]}),C.jsxs("div",{className:"p-4 flex flex-col justify-between space-y-3 border-t border-gray-100 relative",children:[C.jsx("p",{className:"text-xs md:text-sm text-gray-400 absolute top-4 right-4",children:new Date(M.review_created_at).toLocaleDateString()}),C.jsxs("div",{children:[C.jsxs("div",{className:"flex items-center gap-2 mb-2 text-base md:text-base",children:[C.jsxs("span",{className:"font-medium text-gray-700",children:["Rating: ",M.rating,".0"]}),C.jsx(Wo,{className:"text-yellow-500",size:18})]}),C.jsx("div",{className:"mb-2 text-base md:text-base",children:C.jsxs("p",{className:"text-gray-700",children:[C.jsx("span",{className:"font-medium",children:"Review: "}),M.review_text]})}),M.review_image&&C.jsx("img",{src:M.review_image,alt:"Review",className:"w-32 h-32 md:w-36 md:h-36 object-cover rounded mt-2"})]}),C.jsx("div",{className:"mt-4",children:C.jsx("button",{className:"w-full px-4 py-3 bg-[#FF8225] text-white rounded-md text-sm md:text-base font-medium hover:bg-[#e6731f] transition",onClick:()=>S(`${i.pathname}/${M.review_id}`),children:"Edit Review"})})]})]},M.review_id))})]})},yV=nL(RD(C.jsxs(Sa,{path:"/",children:[C.jsxs(Sa,{path:"/",element:C.jsx(jN,{}),children:[C.jsx(Sa,{index:!0,element:C.jsx(iF,{})}),C.jsx(Sa,{path:"/search",element:C.jsx(nF,{})}),C.jsx(Sa,{path:"/map",element:C.jsx(x4,{})}),C.jsx(Sa,{path:"/profile",element:C.jsx(I0,{})}),C.jsx(Sa,{path:"/community",element:C.jsx(zF,{})})]}),C.jsx(Sa,{path:"/category/:id",element:C.jsx(qF,{})}),C.jsx(Sa,{path:"/hello",element:C.jsx(h4,{})}),C.jsx(Sa,{path:"/notifications",element:C.jsx(HB,{})}),C.jsx(Sa,{path:"/business/marketspace",element:C.jsx(WE,{})}),C.jsx(Sa,{path:"/business/marketspace/application",element:C.jsx(n4,{})}),C.jsx(Sa,{path:"/business/marketspace/available",element:C.jsx(e4,{})}),C.jsx(Sa,{path:"/business/marketspace/:id",element:C.jsx(JB,{})}),C.jsx(Sa,{path:"/business/marketspace/:id/apply",element:C.jsx(i4,{})}),C.jsx(Sa,{path:"/community/add",element:C.jsx(UF,{})}),C.jsx(Sa,{path:"/business/product",element:C.jsx(OF,{})}),C.jsx(Sa,{path:"/business/product/add",element:C.jsx(QE,{})}),C.jsx(Sa,{path:"/business/product/:id/edit",element:C.jsx(QE,{})}),C.jsx(Sa,{path:"/business/product/:product_id",element:C.jsx(wC,{isOwnProfile:!0})}),C.jsx(Sa,{path:"/admin/market/add",element:C.jsx(m1,{})}),C.jsx(Sa,{path:"/:role/registration",element:C.jsx(LF,{})}),C.jsx(Sa,{path:"/auth",element:C.jsx(vF,{})}),C.jsx(Sa,{path:"/market-review/:review_id",element:C.jsx(iA,{})}),C.jsx(Sa,{path:"/market",element:C.jsx(VF,{})}),C.jsx(Sa,{path:"/market/history",element:C.jsx(r4,{})}),C.jsx(Sa,{path:"/market/bookmark",element:C.jsx(o4,{})}),C.jsx(Sa,{path:"/market/:market_id/review",element:C.jsx(iA,{})}),C.jsx(Sa,{path:"/market/:id",element:C.jsx(gF,{})}),C.jsx(Sa,{path:"/admin",element:C.jsx(KF,{})}),C.jsx(Sa,{path:"/product-review",element:C.jsx(_V,{})}),C.jsx(Sa,{path:"/product-review/:review_id",element:C.jsx(TC,{})}),C.jsx(Sa,{path:"/vendor/:id",element:C.jsx(I0,{})}),C.jsx(Sa,{path:"/vendor/:vendor_id/product/:product_id",element:C.jsx(wC,{})}),C.jsx(Sa,{path:"/vendor/:vendor_id/product/:product_id/review",element:C.jsx(TC,{})}),C.jsx(Sa,{path:"/visitor/:id",element:C.jsx(I0,{})}),C.jsx(Sa,{path:"/organizer/:id",element:C.jsx(I0,{})}),C.jsx(Sa,{path:"/business/vendor/:vendor_id/statistic",element:C.jsx(d4,{})}),C.jsx(Sa,{path:"/business/vendor/:vendor_id/statistic-download",element:C.jsx(fV,{})}),C.jsx(Sa,{path:"/business/market",element:C.jsx(WE,{})}),C.jsx(Sa,{path:"/business/market/apply",element:C.jsx(m1,{})}),C.jsx(Sa,{path:"/business/market/:id/edit",element:C.jsx(m1,{})}),C.jsx(Sa,{path:"/business/market/:id/plan",element:C.jsx(qB,{})}),C.jsx(Sa,{path:"/business/market/:id/space",element:C.jsx(XB,{})}),C.jsx(Sa,{path:"/business/market/:market_id/review",element:C.jsx(l4,{})}),C.jsx(Sa,{path:"/business/market/:market_id/statistic",element:C.jsx(c4,{})}),C.jsx(Sa,{path:"/business/market/:market_id/statistic-download",element:C.jsx(oV,{})})]}))),vV=()=>C.jsx(sO,{children:C.jsx(pL,{router:yV})});iR.createRoot(document.getElementById("root")).render(C.jsx(ye.StrictMode,{children:C.jsx(vV,{})}));
