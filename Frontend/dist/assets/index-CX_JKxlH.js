(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))u(f);new MutationObserver(f=>{for(const y of f)if(y.type==="childList")for(const w of y.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&u(w)}).observe(document,{childList:!0,subtree:!0});function l(f){const y={};return f.integrity&&(y.integrity=f.integrity),f.referrerPolicy&&(y.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?y.credentials="include":f.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function u(f){if(f.ep)return;f.ep=!0;const y=l(f);fetch(f.href,y)}})();var xs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ub(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function qI(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var a=s.default;if(typeof a=="function"){var l=function u(){var f=!1;try{f=this instanceof u}catch{}return f?Reflect.construct(a,arguments,this.constructor):a.apply(this,arguments)};l.prototype=a.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(s).forEach(function(u){var f=Object.getOwnPropertyDescriptor(s,u);Object.defineProperty(l,u,f.get?f:{enumerable:!0,get:function(){return s[u]}})}),l}var o1={exports:{}},Pv={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yk;function WI(){if(Yk)return Pv;Yk=1;var s=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function l(u,f,y){var w=null;if(y!==void 0&&(w=""+y),f.key!==void 0&&(w=""+f.key),"key"in f){y={};for(var i in f)i!=="key"&&(y[i]=f[i])}else y=f;return f=y.ref,{$$typeof:s,type:u,key:w,ref:f!==void 0?f:null,props:y}}return Pv.Fragment=a,Pv.jsx=l,Pv.jsxs=l,Pv}var Kk;function ZI(){return Kk||(Kk=1,o1.exports=WI()),o1.exports}var A=ZI(),l1={exports:{}},Qa={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jk;function XI(){if(Jk)return Qa;Jk=1;var s=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),y=Symbol.for("react.consumer"),w=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),P=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),$=Symbol.iterator;function G(Qe){return Qe===null||typeof Qe!="object"?null:(Qe=$&&Qe[$]||Qe["@@iterator"],typeof Qe=="function"?Qe:null)}var X={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},te=Object.assign,le={};function re(Qe,St,Ht){this.props=Qe,this.context=St,this.refs=le,this.updater=Ht||X}re.prototype.isReactComponent={},re.prototype.setState=function(Qe,St){if(typeof Qe!="object"&&typeof Qe!="function"&&Qe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Qe,St,"setState")},re.prototype.forceUpdate=function(Qe){this.updater.enqueueForceUpdate(this,Qe,"forceUpdate")};function fe(){}fe.prototype=re.prototype;function xe(Qe,St,Ht){this.props=Qe,this.context=St,this.refs=le,this.updater=Ht||X}var be=xe.prototype=new fe;be.constructor=xe,te(be,re.prototype),be.isPureReactComponent=!0;var Ne=Array.isArray,Be={H:null,A:null,T:null,S:null,V:null},Ee=Object.prototype.hasOwnProperty;function et(Qe,St,Ht,Ft,_i,At){return Ht=At.ref,{$$typeof:s,type:Qe,key:St,ref:Ht!==void 0?Ht:null,props:At}}function at(Qe,St){return et(Qe.type,St,void 0,void 0,void 0,Qe.props)}function He(Qe){return typeof Qe=="object"&&Qe!==null&&Qe.$$typeof===s}function lt(Qe){var St={"=":"=0",":":"=2"};return"$"+Qe.replace(/[=:]/g,function(Ht){return St[Ht]})}var pt=/\/+/g;function Zt(Qe,St){return typeof Qe=="object"&&Qe!==null&&Qe.key!=null?lt(""+Qe.key):St.toString(36)}function jt(){}function Di(Qe){switch(Qe.status){case"fulfilled":return Qe.value;case"rejected":throw Qe.reason;default:switch(typeof Qe.status=="string"?Qe.then(jt,jt):(Qe.status="pending",Qe.then(function(St){Qe.status==="pending"&&(Qe.status="fulfilled",Qe.value=St)},function(St){Qe.status==="pending"&&(Qe.status="rejected",Qe.reason=St)})),Qe.status){case"fulfilled":return Qe.value;case"rejected":throw Qe.reason}}throw Qe}function Pi(Qe,St,Ht,Ft,_i){var At=typeof Qe;(At==="undefined"||At==="boolean")&&(Qe=null);var Xt=!1;if(Qe===null)Xt=!0;else switch(At){case"bigint":case"string":case"number":Xt=!0;break;case"object":switch(Qe.$$typeof){case s:case a:Xt=!0;break;case D:return Xt=Qe._init,Pi(Xt(Qe._payload),St,Ht,Ft,_i)}}if(Xt)return _i=_i(Qe),Xt=Ft===""?"."+Zt(Qe,0):Ft,Ne(_i)?(Ht="",Xt!=null&&(Ht=Xt.replace(pt,"$&/")+"/"),Pi(_i,St,Ht,"",function(pn){return pn})):_i!=null&&(He(_i)&&(_i=at(_i,Ht+(_i.key==null||Qe&&Qe.key===_i.key?"":(""+_i.key).replace(pt,"$&/")+"/")+Xt)),St.push(_i)),1;Xt=0;var yn=Ft===""?".":Ft+":";if(Ne(Qe))for(var fn=0;fn<Qe.length;fn++)Ft=Qe[fn],At=yn+Zt(Ft,fn),Xt+=Pi(Ft,St,Ht,At,_i);else if(fn=G(Qe),typeof fn=="function")for(Qe=fn.call(Qe),fn=0;!(Ft=Qe.next()).done;)Ft=Ft.value,At=yn+Zt(Ft,fn++),Xt+=Pi(Ft,St,Ht,At,_i);else if(At==="object"){if(typeof Qe.then=="function")return Pi(Di(Qe),St,Ht,Ft,_i);throw St=String(Qe),Error("Objects are not valid as a React child (found: "+(St==="[object Object]"?"object with keys {"+Object.keys(Qe).join(", ")+"}":St)+"). If you meant to render a collection of children, use an array instead.")}return Xt}function qe(Qe,St,Ht){if(Qe==null)return Qe;var Ft=[],_i=0;return Pi(Qe,Ft,"","",function(At){return St.call(Ht,At,_i++)}),Ft}function wt(Qe){if(Qe._status===-1){var St=Qe._result;St=St(),St.then(function(Ht){(Qe._status===0||Qe._status===-1)&&(Qe._status=1,Qe._result=Ht)},function(Ht){(Qe._status===0||Qe._status===-1)&&(Qe._status=2,Qe._result=Ht)}),Qe._status===-1&&(Qe._status=0,Qe._result=St)}if(Qe._status===1)return Qe._result.default;throw Qe._result}var Ct=typeof reportError=="function"?reportError:function(Qe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var St=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Qe=="object"&&Qe!==null&&typeof Qe.message=="string"?String(Qe.message):String(Qe),error:Qe});if(!window.dispatchEvent(St))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Qe);return}console.error(Qe)};function Vi(){}return Qa.Children={map:qe,forEach:function(Qe,St,Ht){qe(Qe,function(){St.apply(this,arguments)},Ht)},count:function(Qe){var St=0;return qe(Qe,function(){St++}),St},toArray:function(Qe){return qe(Qe,function(St){return St})||[]},only:function(Qe){if(!He(Qe))throw Error("React.Children.only expected to receive a single React element child.");return Qe}},Qa.Component=re,Qa.Fragment=l,Qa.Profiler=f,Qa.PureComponent=xe,Qa.StrictMode=u,Qa.Suspense=C,Qa.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Be,Qa.__COMPILER_RUNTIME={__proto__:null,c:function(Qe){return Be.H.useMemoCache(Qe)}},Qa.cache=function(Qe){return function(){return Qe.apply(null,arguments)}},Qa.cloneElement=function(Qe,St,Ht){if(Qe==null)throw Error("The argument must be a React element, but you passed "+Qe+".");var Ft=te({},Qe.props),_i=Qe.key,At=void 0;if(St!=null)for(Xt in St.ref!==void 0&&(At=void 0),St.key!==void 0&&(_i=""+St.key),St)!Ee.call(St,Xt)||Xt==="key"||Xt==="__self"||Xt==="__source"||Xt==="ref"&&St.ref===void 0||(Ft[Xt]=St[Xt]);var Xt=arguments.length-2;if(Xt===1)Ft.children=Ht;else if(1<Xt){for(var yn=Array(Xt),fn=0;fn<Xt;fn++)yn[fn]=arguments[fn+2];Ft.children=yn}return et(Qe.type,_i,void 0,void 0,At,Ft)},Qa.createContext=function(Qe){return Qe={$$typeof:w,_currentValue:Qe,_currentValue2:Qe,_threadCount:0,Provider:null,Consumer:null},Qe.Provider=Qe,Qe.Consumer={$$typeof:y,_context:Qe},Qe},Qa.createElement=function(Qe,St,Ht){var Ft,_i={},At=null;if(St!=null)for(Ft in St.key!==void 0&&(At=""+St.key),St)Ee.call(St,Ft)&&Ft!=="key"&&Ft!=="__self"&&Ft!=="__source"&&(_i[Ft]=St[Ft]);var Xt=arguments.length-2;if(Xt===1)_i.children=Ht;else if(1<Xt){for(var yn=Array(Xt),fn=0;fn<Xt;fn++)yn[fn]=arguments[fn+2];_i.children=yn}if(Qe&&Qe.defaultProps)for(Ft in Xt=Qe.defaultProps,Xt)_i[Ft]===void 0&&(_i[Ft]=Xt[Ft]);return et(Qe,At,void 0,void 0,null,_i)},Qa.createRef=function(){return{current:null}},Qa.forwardRef=function(Qe){return{$$typeof:i,render:Qe}},Qa.isValidElement=He,Qa.lazy=function(Qe){return{$$typeof:D,_payload:{_status:-1,_result:Qe},_init:wt}},Qa.memo=function(Qe,St){return{$$typeof:P,type:Qe,compare:St===void 0?null:St}},Qa.startTransition=function(Qe){var St=Be.T,Ht={};Be.T=Ht;try{var Ft=Qe(),_i=Be.S;_i!==null&&_i(Ht,Ft),typeof Ft=="object"&&Ft!==null&&typeof Ft.then=="function"&&Ft.then(Vi,Ct)}catch(At){Ct(At)}finally{Be.T=St}},Qa.unstable_useCacheRefresh=function(){return Be.H.useCacheRefresh()},Qa.use=function(Qe){return Be.H.use(Qe)},Qa.useActionState=function(Qe,St,Ht){return Be.H.useActionState(Qe,St,Ht)},Qa.useCallback=function(Qe,St){return Be.H.useCallback(Qe,St)},Qa.useContext=function(Qe){return Be.H.useContext(Qe)},Qa.useDebugValue=function(){},Qa.useDeferredValue=function(Qe,St){return Be.H.useDeferredValue(Qe,St)},Qa.useEffect=function(Qe,St,Ht){var Ft=Be.H;if(typeof Ht=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ft.useEffect(Qe,St)},Qa.useId=function(){return Be.H.useId()},Qa.useImperativeHandle=function(Qe,St,Ht){return Be.H.useImperativeHandle(Qe,St,Ht)},Qa.useInsertionEffect=function(Qe,St){return Be.H.useInsertionEffect(Qe,St)},Qa.useLayoutEffect=function(Qe,St){return Be.H.useLayoutEffect(Qe,St)},Qa.useMemo=function(Qe,St){return Be.H.useMemo(Qe,St)},Qa.useOptimistic=function(Qe,St){return Be.H.useOptimistic(Qe,St)},Qa.useReducer=function(Qe,St,Ht){return Be.H.useReducer(Qe,St,Ht)},Qa.useRef=function(Qe){return Be.H.useRef(Qe)},Qa.useState=function(Qe){return Be.H.useState(Qe)},Qa.useSyncExternalStore=function(Qe,St,Ht){return Be.H.useSyncExternalStore(Qe,St,Ht)},Qa.useTransition=function(){return Be.H.useTransition()},Qa.version="19.1.1",Qa}var Qk;function $b(){return Qk||(Qk=1,l1.exports=XI()),l1.exports}var pe=$b();const Up=Ub(pe);var c1={exports:{}},jv={},u1={exports:{}},d1={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eE;function YI(){return eE||(eE=1,(function(s){function a(qe,wt){var Ct=qe.length;qe.push(wt);e:for(;0<Ct;){var Vi=Ct-1>>>1,Qe=qe[Vi];if(0<f(Qe,wt))qe[Vi]=wt,qe[Ct]=Qe,Ct=Vi;else break e}}function l(qe){return qe.length===0?null:qe[0]}function u(qe){if(qe.length===0)return null;var wt=qe[0],Ct=qe.pop();if(Ct!==wt){qe[0]=Ct;e:for(var Vi=0,Qe=qe.length,St=Qe>>>1;Vi<St;){var Ht=2*(Vi+1)-1,Ft=qe[Ht],_i=Ht+1,At=qe[_i];if(0>f(Ft,Ct))_i<Qe&&0>f(At,Ft)?(qe[Vi]=At,qe[_i]=Ct,Vi=_i):(qe[Vi]=Ft,qe[Ht]=Ct,Vi=Ht);else if(_i<Qe&&0>f(At,Ct))qe[Vi]=At,qe[_i]=Ct,Vi=_i;else break e}}return wt}function f(qe,wt){var Ct=qe.sortIndex-wt.sortIndex;return Ct!==0?Ct:qe.id-wt.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var y=performance;s.unstable_now=function(){return y.now()}}else{var w=Date,i=w.now();s.unstable_now=function(){return w.now()-i}}var C=[],P=[],D=1,$=null,G=3,X=!1,te=!1,le=!1,re=!1,fe=typeof setTimeout=="function"?setTimeout:null,xe=typeof clearTimeout=="function"?clearTimeout:null,be=typeof setImmediate<"u"?setImmediate:null;function Ne(qe){for(var wt=l(P);wt!==null;){if(wt.callback===null)u(P);else if(wt.startTime<=qe)u(P),wt.sortIndex=wt.expirationTime,a(C,wt);else break;wt=l(P)}}function Be(qe){if(le=!1,Ne(qe),!te)if(l(C)!==null)te=!0,Ee||(Ee=!0,Zt());else{var wt=l(P);wt!==null&&Pi(Be,wt.startTime-qe)}}var Ee=!1,et=-1,at=5,He=-1;function lt(){return re?!0:!(s.unstable_now()-He<at)}function pt(){if(re=!1,Ee){var qe=s.unstable_now();He=qe;var wt=!0;try{e:{te=!1,le&&(le=!1,xe(et),et=-1),X=!0;var Ct=G;try{t:{for(Ne(qe),$=l(C);$!==null&&!($.expirationTime>qe&&lt());){var Vi=$.callback;if(typeof Vi=="function"){$.callback=null,G=$.priorityLevel;var Qe=Vi($.expirationTime<=qe);if(qe=s.unstable_now(),typeof Qe=="function"){$.callback=Qe,Ne(qe),wt=!0;break t}$===l(C)&&u(C),Ne(qe)}else u(C);$=l(C)}if($!==null)wt=!0;else{var St=l(P);St!==null&&Pi(Be,St.startTime-qe),wt=!1}}break e}finally{$=null,G=Ct,X=!1}wt=void 0}}finally{wt?Zt():Ee=!1}}}var Zt;if(typeof be=="function")Zt=function(){be(pt)};else if(typeof MessageChannel<"u"){var jt=new MessageChannel,Di=jt.port2;jt.port1.onmessage=pt,Zt=function(){Di.postMessage(null)}}else Zt=function(){fe(pt,0)};function Pi(qe,wt){et=fe(function(){qe(s.unstable_now())},wt)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(qe){qe.callback=null},s.unstable_forceFrameRate=function(qe){0>qe||125<qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):at=0<qe?Math.floor(1e3/qe):5},s.unstable_getCurrentPriorityLevel=function(){return G},s.unstable_next=function(qe){switch(G){case 1:case 2:case 3:var wt=3;break;default:wt=G}var Ct=G;G=wt;try{return qe()}finally{G=Ct}},s.unstable_requestPaint=function(){re=!0},s.unstable_runWithPriority=function(qe,wt){switch(qe){case 1:case 2:case 3:case 4:case 5:break;default:qe=3}var Ct=G;G=qe;try{return wt()}finally{G=Ct}},s.unstable_scheduleCallback=function(qe,wt,Ct){var Vi=s.unstable_now();switch(typeof Ct=="object"&&Ct!==null?(Ct=Ct.delay,Ct=typeof Ct=="number"&&0<Ct?Vi+Ct:Vi):Ct=Vi,qe){case 1:var Qe=-1;break;case 2:Qe=250;break;case 5:Qe=1073741823;break;case 4:Qe=1e4;break;default:Qe=5e3}return Qe=Ct+Qe,qe={id:D++,callback:wt,priorityLevel:qe,startTime:Ct,expirationTime:Qe,sortIndex:-1},Ct>Vi?(qe.sortIndex=Ct,a(P,qe),l(C)===null&&qe===l(P)&&(le?(xe(et),et=-1):le=!0,Pi(Be,Ct-Vi))):(qe.sortIndex=Qe,a(C,qe),te||X||(te=!0,Ee||(Ee=!0,Zt()))),qe},s.unstable_shouldYield=lt,s.unstable_wrapCallback=function(qe){var wt=G;return function(){var Ct=G;G=wt;try{return qe.apply(this,arguments)}finally{G=Ct}}}})(d1)),d1}var tE;function KI(){return tE||(tE=1,u1.exports=YI()),u1.exports}var h1={exports:{}},dc={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iE;function JI(){if(iE)return dc;iE=1;var s=$b();function a(C){var P="https://react.dev/errors/"+C;if(1<arguments.length){P+="?args[]="+encodeURIComponent(arguments[1]);for(var D=2;D<arguments.length;D++)P+="&args[]="+encodeURIComponent(arguments[D])}return"Minified React error #"+C+"; visit "+P+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var u={d:{f:l,r:function(){throw Error(a(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},f=Symbol.for("react.portal");function y(C,P,D){var $=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:f,key:$==null?null:""+$,children:C,containerInfo:P,implementation:D}}var w=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function i(C,P){if(C==="font")return"";if(typeof P=="string")return P==="use-credentials"?P:""}return dc.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=u,dc.createPortal=function(C,P){var D=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!P||P.nodeType!==1&&P.nodeType!==9&&P.nodeType!==11)throw Error(a(299));return y(C,P,null,D)},dc.flushSync=function(C){var P=w.T,D=u.p;try{if(w.T=null,u.p=2,C)return C()}finally{w.T=P,u.p=D,u.d.f()}},dc.preconnect=function(C,P){typeof C=="string"&&(P?(P=P.crossOrigin,P=typeof P=="string"?P==="use-credentials"?P:"":void 0):P=null,u.d.C(C,P))},dc.prefetchDNS=function(C){typeof C=="string"&&u.d.D(C)},dc.preinit=function(C,P){if(typeof C=="string"&&P&&typeof P.as=="string"){var D=P.as,$=i(D,P.crossOrigin),G=typeof P.integrity=="string"?P.integrity:void 0,X=typeof P.fetchPriority=="string"?P.fetchPriority:void 0;D==="style"?u.d.S(C,typeof P.precedence=="string"?P.precedence:void 0,{crossOrigin:$,integrity:G,fetchPriority:X}):D==="script"&&u.d.X(C,{crossOrigin:$,integrity:G,fetchPriority:X,nonce:typeof P.nonce=="string"?P.nonce:void 0})}},dc.preinitModule=function(C,P){if(typeof C=="string")if(typeof P=="object"&&P!==null){if(P.as==null||P.as==="script"){var D=i(P.as,P.crossOrigin);u.d.M(C,{crossOrigin:D,integrity:typeof P.integrity=="string"?P.integrity:void 0,nonce:typeof P.nonce=="string"?P.nonce:void 0})}}else P==null&&u.d.M(C)},dc.preload=function(C,P){if(typeof C=="string"&&typeof P=="object"&&P!==null&&typeof P.as=="string"){var D=P.as,$=i(D,P.crossOrigin);u.d.L(C,D,{crossOrigin:$,integrity:typeof P.integrity=="string"?P.integrity:void 0,nonce:typeof P.nonce=="string"?P.nonce:void 0,type:typeof P.type=="string"?P.type:void 0,fetchPriority:typeof P.fetchPriority=="string"?P.fetchPriority:void 0,referrerPolicy:typeof P.referrerPolicy=="string"?P.referrerPolicy:void 0,imageSrcSet:typeof P.imageSrcSet=="string"?P.imageSrcSet:void 0,imageSizes:typeof P.imageSizes=="string"?P.imageSizes:void 0,media:typeof P.media=="string"?P.media:void 0})}},dc.preloadModule=function(C,P){if(typeof C=="string")if(P){var D=i(P.as,P.crossOrigin);u.d.m(C,{as:typeof P.as=="string"&&P.as!=="script"?P.as:void 0,crossOrigin:D,integrity:typeof P.integrity=="string"?P.integrity:void 0})}else u.d.m(C)},dc.requestFormReset=function(C){u.d.r(C)},dc.unstable_batchedUpdates=function(C,P){return C(P)},dc.useFormState=function(C,P,D){return w.H.useFormState(C,P,D)},dc.useFormStatus=function(){return w.H.useHostTransitionStatus()},dc.version="19.1.1",dc}var nE;function hM(){if(nE)return h1.exports;nE=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(a){console.error(a)}}return s(),h1.exports=JI(),h1.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aE;function QI(){if(aE)return jv;aE=1;var s=KI(),a=$b(),l=hM();function u(h){var v="https://react.dev/errors/"+h;if(1<arguments.length){v+="?args[]="+encodeURIComponent(arguments[1]);for(var k=2;k<arguments.length;k++)v+="&args[]="+encodeURIComponent(arguments[k])}return"Minified React error #"+h+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function y(h){var v=h,k=h;if(h.alternate)for(;v.return;)v=v.return;else{h=v;do v=h,(v.flags&4098)!==0&&(k=v.return),h=v.return;while(h)}return v.tag===3?k:null}function w(h){if(h.tag===13){var v=h.memoizedState;if(v===null&&(h=h.alternate,h!==null&&(v=h.memoizedState)),v!==null)return v.dehydrated}return null}function i(h){if(y(h)!==h)throw Error(u(188))}function C(h){var v=h.alternate;if(!v){if(v=y(h),v===null)throw Error(u(188));return v!==h?null:h}for(var k=h,z=v;;){var q=k.return;if(q===null)break;var Q=q.alternate;if(Q===null){if(z=q.return,z!==null){k=z;continue}break}if(q.child===Q.child){for(Q=q.child;Q;){if(Q===k)return i(q),h;if(Q===z)return i(q),v;Q=Q.sibling}throw Error(u(188))}if(k.return!==z.return)k=q,z=Q;else{for(var Te=!1,Ve=q.child;Ve;){if(Ve===k){Te=!0,k=q,z=Q;break}if(Ve===z){Te=!0,z=q,k=Q;break}Ve=Ve.sibling}if(!Te){for(Ve=Q.child;Ve;){if(Ve===k){Te=!0,k=Q,z=q;break}if(Ve===z){Te=!0,z=Q,k=q;break}Ve=Ve.sibling}if(!Te)throw Error(u(189))}}if(k.alternate!==z)throw Error(u(190))}if(k.tag!==3)throw Error(u(188));return k.stateNode.current===k?h:v}function P(h){var v=h.tag;if(v===5||v===26||v===27||v===6)return h;for(h=h.child;h!==null;){if(v=P(h),v!==null)return v;h=h.sibling}return null}var D=Object.assign,$=Symbol.for("react.element"),G=Symbol.for("react.transitional.element"),X=Symbol.for("react.portal"),te=Symbol.for("react.fragment"),le=Symbol.for("react.strict_mode"),re=Symbol.for("react.profiler"),fe=Symbol.for("react.provider"),xe=Symbol.for("react.consumer"),be=Symbol.for("react.context"),Ne=Symbol.for("react.forward_ref"),Be=Symbol.for("react.suspense"),Ee=Symbol.for("react.suspense_list"),et=Symbol.for("react.memo"),at=Symbol.for("react.lazy"),He=Symbol.for("react.activity"),lt=Symbol.for("react.memo_cache_sentinel"),pt=Symbol.iterator;function Zt(h){return h===null||typeof h!="object"?null:(h=pt&&h[pt]||h["@@iterator"],typeof h=="function"?h:null)}var jt=Symbol.for("react.client.reference");function Di(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===jt?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case te:return"Fragment";case re:return"Profiler";case le:return"StrictMode";case Be:return"Suspense";case Ee:return"SuspenseList";case He:return"Activity"}if(typeof h=="object")switch(h.$$typeof){case X:return"Portal";case be:return(h.displayName||"Context")+".Provider";case xe:return(h._context.displayName||"Context")+".Consumer";case Ne:var v=h.render;return h=h.displayName,h||(h=v.displayName||v.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case et:return v=h.displayName||null,v!==null?v:Di(h.type)||"Memo";case at:v=h._payload,h=h._init;try{return Di(h(v))}catch{}}return null}var Pi=Array.isArray,qe=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,wt=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ct={pending:!1,data:null,method:null,action:null},Vi=[],Qe=-1;function St(h){return{current:h}}function Ht(h){0>Qe||(h.current=Vi[Qe],Vi[Qe]=null,Qe--)}function Ft(h,v){Qe++,Vi[Qe]=h.current,h.current=v}var _i=St(null),At=St(null),Xt=St(null),yn=St(null);function fn(h,v){switch(Ft(Xt,v),Ft(At,h),Ft(_i,null),v.nodeType){case 9:case 11:h=(h=v.documentElement)&&(h=h.namespaceURI)?zx(h):0;break;default:if(h=v.tagName,v=v.namespaceURI)v=zx(v),h=hm(v,h);else switch(h){case"svg":h=1;break;case"math":h=2;break;default:h=0}}Ht(_i),Ft(_i,h)}function pn(){Ht(_i),Ht(At),Ht(Xt)}function sn(h){h.memoizedState!==null&&Ft(yn,h);var v=_i.current,k=hm(v,h.type);v!==k&&(Ft(At,h),Ft(_i,k))}function Un(h){At.current===h&&(Ht(_i),Ht(At)),yn.current===h&&(Ht(yn),dh._currentValue=Ct)}var Ui=Object.prototype.hasOwnProperty,Ii=s.unstable_scheduleCallback,nn=s.unstable_cancelCallback,mn=s.unstable_shouldYield,cn=s.unstable_requestPaint,Tn=s.unstable_now,Da=s.unstable_getCurrentPriorityLevel,Hc=s.unstable_ImmediatePriority,Xo=s.unstable_UserBlockingPriority,Hs=s.unstable_NormalPriority,ws=s.unstable_LowPriority,Gs=s.unstable_IdlePriority,Hr=s.log,Yo=s.unstable_setDisableYieldValue,Jr=null,er=null;function ds(h){if(typeof Hr=="function"&&Yo(h),er&&typeof er.setStrictMode=="function")try{er.setStrictMode(Jr,h)}catch{}}var pr=Math.clz32?Math.clz32:qs,dl=Math.log,Ql=Math.LN2;function qs(h){return h>>>=0,h===0?32:31-(dl(h)/Ql|0)|0}var Ko=256,vr=4194304;function Ir(h){var v=h&42;if(v!==0)return v;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function ec(h,v,k){var z=h.pendingLanes;if(z===0)return 0;var q=0,Q=h.suspendedLanes,Te=h.pingedLanes;h=h.warmLanes;var Ve=z&134217727;return Ve!==0?(z=Ve&~Q,z!==0?q=Ir(z):(Te&=Ve,Te!==0?q=Ir(Te):k||(k=Ve&~h,k!==0&&(q=Ir(k))))):(Ve=z&~Q,Ve!==0?q=Ir(Ve):Te!==0?q=Ir(Te):k||(k=z&~h,k!==0&&(q=Ir(k)))),q===0?0:v!==0&&v!==q&&(v&Q)===0&&(Q=q&-q,k=v&-v,Q>=k||Q===32&&(k&4194048)!==0)?v:q}function Ss(h,v){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&v)===0}function po(h,v){switch(h){case 1:case 2:case 4:case 8:case 64:return v+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jo(){var h=Ko;return Ko<<=1,(Ko&4194048)===0&&(Ko=256),h}function Ws(){var h=vr;return vr<<=1,(vr&62914560)===0&&(vr=4194304),h}function tc(h){for(var v=[],k=0;31>k;k++)v.push(h);return v}function go(h,v){h.pendingLanes|=v,v!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function Za(h,v,k,z,q,Q){var Te=h.pendingLanes;h.pendingLanes=k,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=k,h.entangledLanes&=k,h.errorRecoveryDisabledLanes&=k,h.shellSuspendCounter=0;var Ve=h.entanglements,ut=h.expirationTimes,ti=h.hiddenUpdates;for(k=Te&~k;0<k;){var xi=31-pr(k),Ci=1<<xi;Ve[xi]=0,ut[xi]=-1;var ri=ti[xi];if(ri!==null)for(ti[xi]=null,xi=0;xi<ri.length;xi++){var oi=ri[xi];oi!==null&&(oi.lane&=-536870913)}k&=~Ci}z!==0&&Ur(h,z,0),Q!==0&&q===0&&h.tag!==0&&(h.suspendedLanes|=Q&~(Te&~v))}function Ur(h,v,k){h.pendingLanes|=v,h.suspendedLanes&=~v;var z=31-pr(v);h.entangledLanes|=v,h.entanglements[z]=h.entanglements[z]|1073741824|k&4194090}function ic(h,v){var k=h.entangledLanes|=v;for(h=h.entanglements;k;){var z=31-pr(k),q=1<<z;q&v|h[z]&v&&(h[z]|=v),k&=~q}}function Ro(h){switch(h){case 2:h=1;break;case 8:h=4;break;case 32:h=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:h=128;break;case 268435456:h=134217728;break;default:h=0}return h}function _o(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function ku(){var h=wt.p;return h!==0?h:(h=window.event,h===void 0?32:P_(h.type))}function Me(h,v){var k=wt.p;try{return wt.p=h,v()}finally{wt.p=k}}var Rt=Math.random().toString(36).slice(2),ii="__reactFiber$"+Rt,Ai="__reactProps$"+Rt,ui="__reactContainer$"+Rt,Wi="__reactEvents$"+Rt,Ti="__reactListeners$"+Rt,vn="__reactHandles$"+Rt,Mn="__reactResources$"+Rt,Xe="__reactMarker$"+Rt;function ne(h){delete h[ii],delete h[Ai],delete h[Wi],delete h[Ti],delete h[vn]}function ue(h){var v=h[ii];if(v)return v;for(var k=h.parentNode;k;){if(v=k[ui]||k[ii]){if(k=v.alternate,v.child!==null||k!==null&&k.child!==null)for(h=Fy(h);h!==null;){if(k=h[ii])return k;h=Fy(h)}return v}h=k,k=h.parentNode}return null}function ke(h){if(h=h[ii]||h[ui]){var v=h.tag;if(v===5||v===6||v===13||v===26||v===27||v===3)return h}return null}function Fe(h){var v=h.tag;if(v===5||v===26||v===27||v===6)return h.stateNode;throw Error(u(33))}function Ue(h){var v=h[Mn];return v||(v=h[Mn]={hoistableStyles:new Map,hoistableScripts:new Map}),v}function Ze(h){h[Xe]=!0}var st=new Set,Je={};function ct(h,v){It(h,v),It(h+"Capture",v)}function It(h,v){for(Je[h]=v,h=0;h<v.length;h++)st.add(v[h])}var Tt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ci={},Fi={};function mi(h){return Ui.call(Fi,h)?!0:Ui.call(ci,h)?!1:Tt.test(h)?Fi[h]=!0:(ci[h]=!0,!1)}function tn(h,v,k){if(mi(v))if(k===null)h.removeAttribute(v);else{switch(typeof k){case"undefined":case"function":case"symbol":h.removeAttribute(v);return;case"boolean":var z=v.toLowerCase().slice(0,5);if(z!=="data-"&&z!=="aria-"){h.removeAttribute(v);return}}h.setAttribute(v,""+k)}}function rn(h,v,k){if(k===null)h.removeAttribute(v);else{switch(typeof k){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(v);return}h.setAttribute(v,""+k)}}function Xi(h,v,k,z){if(z===null)h.removeAttribute(k);else{switch(typeof z){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(k);return}h.setAttributeNS(v,k,""+z)}}var Hi,Gn;function Oa(h){if(Hi===void 0)try{throw Error()}catch(k){var v=k.stack.trim().match(/\n( *(at )?)/);Hi=v&&v[1]||"",Gn=-1<k.stack.indexOf(`
    at`)?" (<anonymous>)":-1<k.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Hi+h+Gn}var Ea=!1;function Jn(h,v){if(!h||Ea)return"";Ea=!0;var k=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var z={DetermineComponentFrameRoot:function(){try{if(v){var Ci=function(){throw Error()};if(Object.defineProperty(Ci.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ci,[])}catch(oi){var ri=oi}Reflect.construct(h,[],Ci)}else{try{Ci.call()}catch(oi){ri=oi}h.call(Ci.prototype)}}else{try{throw Error()}catch(oi){ri=oi}(Ci=h())&&typeof Ci.catch=="function"&&Ci.catch(function(){})}}catch(oi){if(oi&&ri&&typeof oi.stack=="string")return[oi.stack,ri.stack]}return[null,null]}};z.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var q=Object.getOwnPropertyDescriptor(z.DetermineComponentFrameRoot,"name");q&&q.configurable&&Object.defineProperty(z.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var Q=z.DetermineComponentFrameRoot(),Te=Q[0],Ve=Q[1];if(Te&&Ve){var ut=Te.split(`
`),ti=Ve.split(`
`);for(q=z=0;z<ut.length&&!ut[z].includes("DetermineComponentFrameRoot");)z++;for(;q<ti.length&&!ti[q].includes("DetermineComponentFrameRoot");)q++;if(z===ut.length||q===ti.length)for(z=ut.length-1,q=ti.length-1;1<=z&&0<=q&&ut[z]!==ti[q];)q--;for(;1<=z&&0<=q;z--,q--)if(ut[z]!==ti[q]){if(z!==1||q!==1)do if(z--,q--,0>q||ut[z]!==ti[q]){var xi=`
`+ut[z].replace(" at new "," at ");return h.displayName&&xi.includes("<anonymous>")&&(xi=xi.replace("<anonymous>",h.displayName)),xi}while(1<=z&&0<=q);break}}}finally{Ea=!1,Error.prepareStackTrace=k}return(k=h?h.displayName||h.name:"")?Oa(k):""}function gn(h){switch(h.tag){case 26:case 27:case 5:return Oa(h.type);case 16:return Oa("Lazy");case 13:return Oa("Suspense");case 19:return Oa("SuspenseList");case 0:case 15:return Jn(h.type,!1);case 11:return Jn(h.type.render,!1);case 1:return Jn(h.type,!0);case 31:return Oa("Activity");default:return""}}function an(h){try{var v="";do v+=gn(h),h=h.return;while(h);return v}catch(k){return`
Error generating stack: `+k.message+`
`+k.stack}}function ia(h){switch(typeof h){case"bigint":case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function oa(h){var v=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function An(h){var v=oa(h)?"checked":"value",k=Object.getOwnPropertyDescriptor(h.constructor.prototype,v),z=""+h[v];if(!h.hasOwnProperty(v)&&typeof k<"u"&&typeof k.get=="function"&&typeof k.set=="function"){var q=k.get,Q=k.set;return Object.defineProperty(h,v,{configurable:!0,get:function(){return q.call(this)},set:function(Te){z=""+Te,Q.call(this,Te)}}),Object.defineProperty(h,v,{enumerable:k.enumerable}),{getValue:function(){return z},setValue:function(Te){z=""+Te},stopTracking:function(){h._valueTracker=null,delete h[v]}}}}function Xa(h){h._valueTracker||(h._valueTracker=An(h))}function Dn(h){if(!h)return!1;var v=h._valueTracker;if(!v)return!0;var k=v.getValue(),z="";return h&&(z=oa(h)?h.checked?"true":"false":h.value),h=z,h!==k?(v.setValue(h),!0):!1}function Aa(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}var Zs=/[\n"\\]/g;function ss(h){return h.replace(Zs,function(v){return"\\"+v.charCodeAt(0).toString(16)+" "})}function tr(h,v,k,z,q,Q,Te,Ve){h.name="",Te!=null&&typeof Te!="function"&&typeof Te!="symbol"&&typeof Te!="boolean"?h.type=Te:h.removeAttribute("type"),v!=null?Te==="number"?(v===0&&h.value===""||h.value!=v)&&(h.value=""+ia(v)):h.value!==""+ia(v)&&(h.value=""+ia(v)):Te!=="submit"&&Te!=="reset"||h.removeAttribute("value"),v!=null?Qr(h,Te,ia(v)):k!=null?Qr(h,Te,ia(k)):z!=null&&h.removeAttribute("value"),q==null&&Q!=null&&(h.defaultChecked=!!Q),q!=null&&(h.checked=q&&typeof q!="function"&&typeof q!="symbol"),Ve!=null&&typeof Ve!="function"&&typeof Ve!="symbol"&&typeof Ve!="boolean"?h.name=""+ia(Ve):h.removeAttribute("name")}function Lo(h,v,k,z,q,Q,Te,Ve){if(Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"&&(h.type=Q),v!=null||k!=null){if(!(Q!=="submit"&&Q!=="reset"||v!=null))return;k=k!=null?""+ia(k):"",v=v!=null?""+ia(v):k,Ve||v===h.value||(h.value=v),h.defaultValue=v}z=z??q,z=typeof z!="function"&&typeof z!="symbol"&&!!z,h.checked=Ve?h.checked:!!z,h.defaultChecked=!!z,Te!=null&&typeof Te!="function"&&typeof Te!="symbol"&&typeof Te!="boolean"&&(h.name=Te)}function Qr(h,v,k){v==="number"&&Aa(h.ownerDocument)===h||h.defaultValue===""+k||(h.defaultValue=""+k)}function os(h,v,k,z){if(h=h.options,v){v={};for(var q=0;q<k.length;q++)v["$"+k[q]]=!0;for(k=0;k<h.length;k++)q=v.hasOwnProperty("$"+h[k].value),h[k].selected!==q&&(h[k].selected=q),q&&z&&(h[k].defaultSelected=!0)}else{for(k=""+ia(k),v=null,q=0;q<h.length;q++){if(h[q].value===k){h[q].selected=!0,z&&(h[q].defaultSelected=!0);return}v!==null||h[q].disabled||(v=h[q])}v!==null&&(v.selected=!0)}}function Sa(h,v,k){if(v!=null&&(v=""+ia(v),v!==h.value&&(h.value=v),k==null)){h.defaultValue!==v&&(h.defaultValue=v);return}h.defaultValue=k!=null?""+ia(k):""}function Io(h,v,k,z){if(v==null){if(z!=null){if(k!=null)throw Error(u(92));if(Pi(z)){if(1<z.length)throw Error(u(93));z=z[0]}k=z}k==null&&(k=""),v=k}k=ia(v),h.defaultValue=k,z=h.textContent,z===k&&z!==""&&z!==null&&(h.value=z)}function yo(h,v){if(v){var k=h.firstChild;if(k&&k===h.lastChild&&k.nodeType===3){k.nodeValue=v;return}}h.textContent=v}var Gc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Eu(h,v,k){var z=v.indexOf("--")===0;k==null||typeof k=="boolean"||k===""?z?h.setProperty(v,""):v==="float"?h.cssFloat="":h[v]="":z?h.setProperty(v,k):typeof k!="number"||k===0||Gc.has(v)?v==="float"?h.cssFloat=k:h[v]=(""+k).trim():h[v]=k+"px"}function fc(h,v,k){if(v!=null&&typeof v!="object")throw Error(u(62));if(h=h.style,k!=null){for(var z in k)!k.hasOwnProperty(z)||v!=null&&v.hasOwnProperty(z)||(z.indexOf("--")===0?h.setProperty(z,""):z==="float"?h.cssFloat="":h[z]="");for(var q in v)z=v[q],v.hasOwnProperty(q)&&k[q]!==z&&Eu(h,q,z)}else for(var Q in v)v.hasOwnProperty(Q)&&Eu(h,Q,v[Q])}function mc(h){if(h.indexOf("-")===-1)return!1;switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hl=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ps=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ao(h){return Ps.test(""+h)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":h}var vo=null;function Xs(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var ro=null,xo=null;function qc(h){var v=ke(h);if(v&&(h=v.stateNode)){var k=h[Ai]||null;e:switch(h=v.stateNode,v.type){case"input":if(tr(h,k.value,k.defaultValue,k.defaultValue,k.checked,k.defaultChecked,k.type,k.name),v=k.name,k.type==="radio"&&v!=null){for(k=h;k.parentNode;)k=k.parentNode;for(k=k.querySelectorAll('input[name="'+ss(""+v)+'"][type="radio"]'),v=0;v<k.length;v++){var z=k[v];if(z!==h&&z.form===h.form){var q=z[Ai]||null;if(!q)throw Error(u(90));tr(z,q.value,q.defaultValue,q.defaultValue,q.checked,q.defaultChecked,q.type,q.name)}}for(v=0;v<k.length;v++)z=k[v],z.form===h.form&&Dn(z)}break e;case"textarea":Sa(h,k.value,k.defaultValue);break e;case"select":v=k.value,v!=null&&os(h,!!k.multiple,v,!1)}}}var la=!1;function Ys(h,v,k){if(la)return h(v,k);la=!0;try{var z=h(v);return z}finally{if(la=!1,(ro!==null||xo!==null)&&(_n(),ro&&(v=ro,h=xo,xo=ro=null,qc(v),h)))for(v=0;v<h.length;v++)qc(h[v])}}function rr(h,v){var k=h.stateNode;if(k===null)return null;var z=k[Ai]||null;if(z===null)return null;k=z[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(z=!z.disabled)||(h=h.type,z=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!z;break e;default:h=!1}if(h)return null;if(k&&typeof k!="function")throw Error(u(231,v,typeof k));return k}var Dl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pc=!1;if(Dl)try{var hs={};Object.defineProperty(hs,"passive",{get:function(){pc=!0}}),window.addEventListener("test",hs,hs),window.removeEventListener("test",hs,hs)}catch{pc=!1}var Qo=null,bo=null,zo=null;function Ku(){if(zo)return zo;var h,v=bo,k=v.length,z,q="value"in Qo?Qo.value:Qo.textContent,Q=q.length;for(h=0;h<k&&v[h]===q[h];h++);var Te=k-h;for(z=1;z<=Te&&v[k-z]===q[Q-z];z++);return zo=q.slice(h,1<z?1-z:void 0)}function ls(h){var v=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&v===13&&(h=13)):h=v,h===10&&(h=13),32<=h||h===13?h:0}function Do(){return!0}function qn(){return!1}function js(h){function v(k,z,q,Q,Te){this._reactName=k,this._targetInst=q,this.type=z,this.nativeEvent=Q,this.target=Te,this.currentTarget=null;for(var Ve in h)h.hasOwnProperty(Ve)&&(k=h[Ve],this[Ve]=k?k(Q):Q[Ve]);return this.isDefaultPrevented=(Q.defaultPrevented!=null?Q.defaultPrevented:Q.returnValue===!1)?Do:qn,this.isPropagationStopped=qn,this}return D(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var k=this.nativeEvent;k&&(k.preventDefault?k.preventDefault():typeof k.returnValue!="unknown"&&(k.returnValue=!1),this.isDefaultPrevented=Do)},stopPropagation:function(){var k=this.nativeEvent;k&&(k.stopPropagation?k.stopPropagation():typeof k.cancelBubble!="unknown"&&(k.cancelBubble=!0),this.isPropagationStopped=Do)},persist:function(){},isPersistent:Do}),v}var gc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ju=js(gc),Wc=D({},gc,{view:0,detail:0}),Zc=js(Wc),Xc,Pa,Au,Ks=D({},Wc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yc,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==Au&&(Au&&h.type==="mousemove"?(Xc=h.screenX-Au.screenX,Pa=h.screenY-Au.screenY):Pa=Xc=0,Au=h),Xc)},movementY:function(h){return"movementY"in h?h.movementY:Pa}}),wo=js(Ks),Qu=D({},Ks,{dataTransfer:0}),Tf=js(Qu),nc=D({},Wc,{relatedTarget:0}),_c=js(nc),Rs=D({},gc,{animationName:0,elapsedTime:0,pseudoElement:0}),Ah=js(Rs),Ud=D({},gc,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Oo=js(Ud),ma=D({},gc,{data:0}),fl=js(ma),Pm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ch(h){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(h):(h=Gi[h])?!!v[h]:!1}function Yc(){return Ch}var No=D({},Wc,{key:function(h){if(h.key){var v=Pm[h.key]||h.key;if(v!=="Unidentified")return v}return h.type==="keypress"?(h=ls(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?kf[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yc,charCode:function(h){return h.type==="keypress"?ls(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?ls(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),ed=js(No),ml=D({},Ks,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zi=js(ml),$n=D({},Wc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yc}),_a=js($n),Js=D({},gc,{propertyName:0,elapsedTime:0,pseudoElement:0}),ac=js(Js),ra=D({},Ks,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),$d=js(ra),Kc=D({},gc,{newState:0,oldState:0}),Ol=js(Kc),Ls=[9,13,27,32],lr=Dl&&"CompositionEvent"in window,so=null;Dl&&"documentMode"in document&&(so=document.documentMode);var yc=Dl&&"TextEvent"in window&&!so,Vd=Dl&&(!lr||so&&8<so&&11>=so),td=" ",Cu=!1;function id(h,v){switch(h){case"keyup":return Ls.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hd(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var cs=!1;function rc(h,v){switch(h){case"compositionend":return Hd(v);case"keypress":return v.which!==32?null:(Cu=!0,td);case"textInput":return h=v.data,h===td&&Cu?null:h;default:return null}}function oo(h,v){if(cs)return h==="compositionend"||!lr&&id(h,v)?(h=Ku(),zo=bo=Qo=null,cs=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return Vd&&v.locale!=="ko"?null:v.data;default:return null}}var Qs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pl(h){var v=h&&h.nodeName&&h.nodeName.toLowerCase();return v==="input"?!!Qs[h.type]:v==="textarea"}function Gr(h,v,k,z){ro?xo?xo.push(z):xo=[z]:ro=z,v=vg(v,"onChange"),0<v.length&&(k=new Ju("onChange","change",null,k,z),h.push({event:k,listeners:v}))}var $r=null,el=null;function Sr(h){Rx(h,0)}function nd(h){var v=Fe(h);if(Dn(v))return h}function lo(h,v){if(h==="change")return v}var gl=!1;if(Dl){var on;if(Dl){var ji="oninput"in document;if(!ji){var _l=document.createElement("div");_l.setAttribute("oninput","return;"),ji=typeof _l.oninput=="function"}on=ji}else on=!1;gl=on&&(!document.documentMode||9<document.documentMode)}function Ji(){$r&&($r.detachEvent("onpropertychange",Mu),el=$r=null)}function Mu(h){if(h.propertyName==="value"&&nd(el)){var v=[];Gr(v,el,h,Xs(h)),Ys(Sr,v)}}function ad(h,v,k){h==="focusin"?(Ji(),$r=v,el=k,$r.attachEvent("onpropertychange",Mu)):h==="focusout"&&Ji()}function en(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return nd(el)}function Is(h,v){if(h==="click")return nd(v)}function Ef(h,v){if(h==="input"||h==="change")return nd(v)}function vc(h,v){return h===v&&(h!==0||1/h===1/v)||h!==h&&v!==v}var Tr=typeof Object.is=="function"?Object.is:vc;function co(h,v){if(Tr(h,v))return!0;if(typeof h!="object"||h===null||typeof v!="object"||v===null)return!1;var k=Object.keys(h),z=Object.keys(v);if(k.length!==z.length)return!1;for(z=0;z<k.length;z++){var q=k[z];if(!Ui.call(v,q)||!Tr(h[q],v[q]))return!1}return!0}function zr(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function rd(h,v){var k=zr(h);h=0;for(var z;k;){if(k.nodeType===3){if(z=h+k.textContent.length,h<=v&&z>=v)return{node:k,offset:v-h};h=z}e:{for(;k;){if(k.nextSibling){k=k.nextSibling;break e}k=k.parentNode}k=void 0}k=zr(k)}}function Fo(h,v){return h&&v?h===v?!0:h&&h.nodeType===3?!1:v&&v.nodeType===3?Fo(h,v.parentNode):"contains"in h?h.contains(v):h.compareDocumentPosition?!!(h.compareDocumentPosition(v)&16):!1:!1}function Pu(h){h=h!=null&&h.ownerDocument!=null&&h.ownerDocument.defaultView!=null?h.ownerDocument.defaultView:window;for(var v=Aa(h.document);v instanceof h.HTMLIFrameElement;){try{var k=typeof v.contentWindow.location.href=="string"}catch{k=!1}if(k)h=v.contentWindow;else break;v=Aa(h.document)}return v}function yl(h){var v=h&&h.nodeName&&h.nodeName.toLowerCase();return v&&(v==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||v==="textarea"||h.contentEditable==="true")}var So=Dl&&"documentMode"in document&&11>=document.documentMode,To=null,sd=null,vl=null,Jc=!1;function od(h,v,k){var z=k.window===k?k.document:k.nodeType===9?k:k.ownerDocument;Jc||To==null||To!==Aa(z)||(z=To,"selectionStart"in z&&yl(z)?z={start:z.selectionStart,end:z.selectionEnd}:(z=(z.ownerDocument&&z.ownerDocument.defaultView||window).getSelection(),z={anchorNode:z.anchorNode,anchorOffset:z.anchorOffset,focusNode:z.focusNode,focusOffset:z.focusOffset}),vl&&co(vl,z)||(vl=z,z=vg(sd,"onSelect"),0<z.length&&(v=new Ju("onSelect","select",null,v,k),h.push({event:v,listeners:z}),v.target=To)))}function zs(h,v){var k={};return k[h.toLowerCase()]=v.toLowerCase(),k["Webkit"+h]="webkit"+v,k["Moz"+h]="moz"+v,k}var tl={animationend:zs("Animation","AnimationEnd"),animationiteration:zs("Animation","AnimationIteration"),animationstart:zs("Animation","AnimationStart"),transitionrun:zs("Transition","TransitionRun"),transitionstart:zs("Transition","TransitionStart"),transitioncancel:zs("Transition","TransitionCancel"),transitionend:zs("Transition","TransitionEnd")},Mh={},Ph={};Dl&&(Ph=document.createElement("div").style,"AnimationEvent"in window||(delete tl.animationend.animation,delete tl.animationiteration.animation,delete tl.animationstart.animation),"TransitionEvent"in window||delete tl.transitionend.transition);function Qc(h){if(Mh[h])return Mh[h];if(!tl[h])return h;var v=tl[h],k;for(k in v)if(v.hasOwnProperty(k)&&k in Ph)return Mh[h]=v[k];return h}var Af=Qc("animationend"),xl=Qc("animationiteration"),ju=Qc("animationstart"),eu=Qc("transitionrun"),Gd=Qc("transitionstart"),jm=Qc("transitioncancel"),ld=Qc("transitionend"),xc=new Map,Nl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nl.push("scrollEnd");function es(h,v){xc.set(h,v),ct(v,[h])}var tu=new WeakMap;function Ds(h,v){if(typeof h=="object"&&h!==null){var k=tu.get(h);return k!==void 0?k:(v={value:h,source:v,stack:an(v)},tu.set(h,v),v)}return{value:h,source:v,stack:an(v)}}var Os=[],iu=0,Bo=0;function eo(){for(var h=iu,v=Bo=iu=0;v<h;){var k=Os[v];Os[v++]=null;var z=Os[v];Os[v++]=null;var q=Os[v];Os[v++]=null;var Q=Os[v];if(Os[v++]=null,z!==null&&q!==null){var Te=z.pending;Te===null?q.next=q:(q.next=Te.next,Te.next=q),z.pending=q}Q!==0&&ru(k,q,Q)}}function nu(h,v,k,z){Os[iu++]=h,Os[iu++]=v,Os[iu++]=k,Os[iu++]=z,Bo|=z,h.lanes|=z,h=h.alternate,h!==null&&(h.lanes|=z)}function Jt(h,v,k,z){return nu(h,v,k,z),Fl(h)}function au(h,v){return nu(h,null,null,v),Fl(h)}function ru(h,v,k){h.lanes|=k;var z=h.alternate;z!==null&&(z.lanes|=k);for(var q=!1,Q=h.return;Q!==null;)Q.childLanes|=k,z=Q.alternate,z!==null&&(z.childLanes|=k),Q.tag===22&&(h=Q.stateNode,h===null||h._visibility&1||(q=!0)),h=Q,Q=Q.return;return h.tag===3?(Q=h.stateNode,q&&v!==null&&(q=31-pr(k),h=Q.hiddenUpdates,z=h[q],z===null?h[q]=[v]:z.push(v),v.lane=k|536870912),Q):null}function Fl(h){if(50<In)throw In=0,ea=null,Error(u(185));for(var v=h.return;v!==null;)h=v,v=h.return;return h.tag===3?h.stateNode:null}var bc={};function cd(h,v,k,z){this.tag=h,this.key=k,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ts(h,v,k,z){return new cd(h,v,k,z)}function ud(h){return h=h.prototype,!(!h||!h.isReactComponent)}function uo(h,v){var k=h.alternate;return k===null?(k=ts(h.tag,v,h.key,h.mode),k.elementType=h.elementType,k.type=h.type,k.stateNode=h.stateNode,k.alternate=h,h.alternate=k):(k.pendingProps=v,k.type=h.type,k.flags=0,k.subtreeFlags=0,k.deletions=null),k.flags=h.flags&65011712,k.childLanes=h.childLanes,k.lanes=h.lanes,k.child=h.child,k.memoizedProps=h.memoizedProps,k.memoizedState=h.memoizedState,k.updateQueue=h.updateQueue,v=h.dependencies,k.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},k.sibling=h.sibling,k.index=h.index,k.ref=h.ref,k.refCleanup=h.refCleanup,k}function wc(h,v){h.flags&=65011714;var k=h.alternate;return k===null?(h.childLanes=0,h.lanes=v,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=k.childLanes,h.lanes=k.lanes,h.child=k.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=k.memoizedProps,h.memoizedState=k.memoizedState,h.updateQueue=k.updateQueue,h.type=k.type,v=k.dependencies,h.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),h}function bl(h,v,k,z,q,Q){var Te=0;if(z=h,typeof h=="function")ud(h)&&(Te=1);else if(typeof h=="string")Te=Rd(h,k,_i.current)?26:h==="html"||h==="head"||h==="body"?27:5;else e:switch(h){case He:return h=ts(31,k,v,q),h.elementType=He,h.lanes=Q,h;case te:return Bl(k.children,q,Q,v);case le:Te=8,q|=24;break;case re:return h=ts(12,k,v,q|2),h.elementType=re,h.lanes=Q,h;case Be:return h=ts(13,k,v,q),h.elementType=Be,h.lanes=Q,h;case Ee:return h=ts(19,k,v,q),h.elementType=Ee,h.lanes=Q,h;default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case fe:case be:Te=10;break e;case xe:Te=9;break e;case Ne:Te=11;break e;case et:Te=14;break e;case at:Te=16,z=null;break e}Te=29,k=Error(u(130,h===null?"null":typeof h,"")),z=null}return v=ts(Te,k,v,q),v.elementType=h,v.type=z,v.lanes=Q,v}function Bl(h,v,k,z){return h=ts(7,h,z,v),h.lanes=k,h}function jh(h,v,k){return h=ts(6,h,null,v),h.lanes=k,h}function Ru(h,v,k){return v=ts(4,h.children!==null?h.children:[],h.key,v),v.lanes=k,v.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},v}var Lu=[],Iu=0,b=null,I=0,V=[],ie=0,ge=null,ze=1,dt="";function Bt(h,v){Lu[Iu++]=I,Lu[Iu++]=b,b=h,I=v}function Lt(h,v,k){V[ie++]=ze,V[ie++]=dt,V[ie++]=ge,ge=h;var z=ze;h=dt;var q=32-pr(z)-1;z&=~(1<<q),k+=1;var Q=32-pr(v)+q;if(30<Q){var Te=q-q%5;Q=(z&(1<<Te)-1).toString(32),z>>=Te,q-=Te,ze=1<<32-pr(v)+q|k<<q|z,dt=Q+h}else ze=1<<Q|k<<q|z,dt=h}function Ri(h){h.return!==null&&(Bt(h,1),Lt(h,1,0))}function un(h){for(;h===b;)b=Lu[--Iu],Lu[Iu]=null,I=Lu[--Iu],Lu[Iu]=null;for(;h===ge;)ge=V[--ie],V[ie]=null,dt=V[--ie],V[ie]=null,ze=V[--ie],V[ie]=null}var Sn=null,Pn=null,ca=!1,gr=null,Cr=!1,fs=Error(u(519));function to(h){var v=Error(u(418,""));throw Sc(Ds(v,h)),fs}function Cf(h){var v=h.stateNode,k=h.type,z=h.memoizedProps;switch(v[ii]=h,v[Ai]=z,k){case"dialog":sr("cancel",v),sr("close",v);break;case"iframe":case"object":case"embed":sr("load",v);break;case"video":case"audio":for(k=0;k<mp.length;k++)sr(mp[k],v);break;case"source":sr("error",v);break;case"img":case"image":case"link":sr("error",v),sr("load",v);break;case"details":sr("toggle",v);break;case"input":sr("invalid",v),Lo(v,z.value,z.defaultValue,z.checked,z.defaultChecked,z.type,z.name,!0),Xa(v);break;case"select":sr("invalid",v);break;case"textarea":sr("invalid",v),Io(v,z.value,z.defaultValue,z.children),Xa(v)}k=z.children,typeof k!="string"&&typeof k!="number"&&typeof k!="bigint"||v.textContent===""+k||z.suppressHydrationWarning===!0||Dy(v.textContent,k)?(z.popover!=null&&(sr("beforetoggle",v),sr("toggle",v)),z.onScroll!=null&&sr("scroll",v),z.onScrollEnd!=null&&sr("scrollend",v),z.onClick!=null&&(v.onclick=pp),v=!0):v=!1,v||to(h)}function Rh(h){for(Sn=h.return;Sn;)switch(Sn.tag){case 5:case 13:Cr=!1;return;case 27:case 3:Cr=!0;return;default:Sn=Sn.return}}function dd(h){if(h!==Sn)return!1;if(!ca)return Rh(h),ca=!0,!1;var v=h.tag,k;if((k=v!==3&&v!==27)&&((k=v===5)&&(k=h.type,k=!(k!=="form"&&k!=="button")||v_(h.type,h.memoizedProps)),k=!k),k&&Pn&&to(h),Rh(h),v===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(u(317));e:{for(h=h.nextSibling,v=0;h;){if(h.nodeType===8)if(k=h.data,k==="/$"){if(v===0){Pn=wr(h.nextSibling);break e}v--}else k!=="$"&&k!=="$!"&&k!=="$?"||v++;h=h.nextSibling}Pn=null}}else v===27?(v=Pn,sf(h.type)?(h=of,of=null,Pn=h):Pn=v):Pn=Sn?wr(h.stateNode.nextSibling):null;return!0}function Ul(){Pn=Sn=null,ca=!1}function qd(){var h=gr;return h!==null&&(gt===null?gt=h:gt.push.apply(gt,h),gr=null),h}function Sc(h){gr===null?gr=[h]:gr.push(h)}var Vr=St(null),il=null,nl=null;function Tc(h,v,k){Ft(Vr,v._currentValue),v._currentValue=k}function sc(h){h._currentValue=Vr.current,Ht(Vr)}function hd(h,v,k){for(;h!==null;){var z=h.alternate;if((h.childLanes&v)!==v?(h.childLanes|=v,z!==null&&(z.childLanes|=v)):z!==null&&(z.childLanes&v)!==v&&(z.childLanes|=v),h===k)break;h=h.return}}function kc(h,v,k,z){var q=h.child;for(q!==null&&(q.return=h);q!==null;){var Q=q.dependencies;if(Q!==null){var Te=q.child;Q=Q.firstContext;e:for(;Q!==null;){var Ve=Q;Q=q;for(var ut=0;ut<v.length;ut++)if(Ve.context===v[ut]){Q.lanes|=k,Ve=Q.alternate,Ve!==null&&(Ve.lanes|=k),hd(Q.return,k,h),z||(Te=null);break e}Q=Ve.next}}else if(q.tag===18){if(Te=q.return,Te===null)throw Error(u(341));Te.lanes|=k,Q=Te.alternate,Q!==null&&(Q.lanes|=k),hd(Te,k,h),Te=null}else Te=q.child;if(Te!==null)Te.return=q;else for(Te=q;Te!==null;){if(Te===h){Te=null;break}if(q=Te.sibling,q!==null){q.return=Te.return,Te=q;break}Te=Te.return}q=Te}}function fd(h,v,k,z){h=null;for(var q=v,Q=!1;q!==null;){if(!Q){if((q.flags&524288)!==0)Q=!0;else if((q.flags&262144)!==0)break}if(q.tag===10){var Te=q.alternate;if(Te===null)throw Error(u(387));if(Te=Te.memoizedProps,Te!==null){var Ve=q.type;Tr(q.pendingProps.value,Te.value)||(h!==null?h.push(Ve):h=[Ve])}}else if(q===yn.current){if(Te=q.alternate,Te===null)throw Error(u(387));Te.memoizedState.memoizedState!==q.memoizedState.memoizedState&&(h!==null?h.push(dh):h=[dh])}q=q.return}h!==null&&kc(v,h,k,z),v.flags|=262144}function Rm(h){for(h=h.firstContext;h!==null;){if(!Tr(h.context._currentValue,h.memoizedValue))return!0;h=h.next}return!1}function Wd(h){il=h,nl=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function Uo(h){return Lm(il,h)}function Lh(h,v){return il===null&&Wd(h),Lm(h,v)}function Lm(h,v){var k=v._currentValue;if(v={context:v,memoizedValue:k,next:null},nl===null){if(h===null)throw Error(u(308));nl=v,h.dependencies={lanes:0,firstContext:v},h.flags|=524288}else nl=nl.next=v;return k}var Kp=typeof AbortController<"u"?AbortController:function(){var h=[],v=this.signal={aborted:!1,addEventListener:function(k,z){h.push(z)}};this.abort=function(){v.aborted=!0,h.forEach(function(k){return k()})}},Jp=s.unstable_scheduleCallback,a_=s.unstable_NormalPriority,ms={$$typeof:be,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ih(){return{controller:new Kp,data:new Map,refCount:0}}function su(h){h.refCount--,h.refCount===0&&Jp(a_,function(){h.controller.abort()})}var zu=null,Im=0,ho=0,Du=null;function Mf(h,v){if(zu===null){var k=zu=[];Im=0,ho=fp(),Du={status:"pending",value:void 0,then:function(z){k.push(z)}}}return Im++,v.then(ou,ou),v}function ou(){if(--Im===0&&zu!==null){Du!==null&&(Du.status="fulfilled");var h=zu;zu=null,ho=0,Du=null;for(var v=0;v<h.length;v++)(0,h[v])()}}function zm(h,v){var k=[],z={status:"pending",value:null,reason:null,then:function(q){k.push(q)}};return h.then(function(){z.status="fulfilled",z.value=v;for(var q=0;q<k.length;q++)(0,k[q])(v)},function(q){for(z.status="rejected",z.reason=q,q=0;q<k.length;q++)(0,k[q])(void 0)}),z}var Pf=qe.S;qe.S=function(h,v){typeof v=="object"&&v!==null&&typeof v.then=="function"&&Mf(h,v),Pf!==null&&Pf(h,v)};var Ou=St(null);function md(){var h=Ou.current;return h!==null?h:we.pooledCache}function pd(h,v){v===null?Ft(Ou,Ou.current):Ft(Ou,v.pool)}function zh(){var h=md();return h===null?null:{parent:ms._currentValue,pool:h}}var gd=Error(u(460)),Dm=Error(u(474)),Dh=Error(u(542)),jf={then:function(){}};function Zd(h){return h=h.status,h==="fulfilled"||h==="rejected"}function Om(){}function r_(h,v,k){switch(k=h[k],k===void 0?h.push(v):k!==v&&(v.then(Om,Om),v=k),v.status){case"fulfilled":return v.value;case"rejected":throw h=v.reason,Rf(h),h;default:if(typeof v.status=="string")v.then(Om,Om);else{if(h=we,h!==null&&100<h.shellSuspendCounter)throw Error(u(482));h=v,h.status="pending",h.then(function(z){if(v.status==="pending"){var q=v;q.status="fulfilled",q.value=z}},function(z){if(v.status==="pending"){var q=v;q.status="rejected",q.reason=z}})}switch(v.status){case"fulfilled":return v.value;case"rejected":throw h=v.reason,Rf(h),h}throw Oh=v,gd}}var Oh=null;function Qp(){if(Oh===null)throw Error(u(459));var h=Oh;return Oh=null,h}function Rf(h){if(h===gd||h===Dh)throw Error(u(483))}var _d=!1;function Nh(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Lf(h,v){h=h.updateQueue,v.updateQueue===h&&(v.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function Nu(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function $l(h,v,k){var z=h.updateQueue;if(z===null)return null;if(z=z.shared,(_e&2)!==0){var q=z.pending;return q===null?v.next=v:(v.next=q.next,q.next=v),z.pending=v,v=Fl(h),ru(h,null,k),v}return nu(h,z,v,k),Fl(h)}function Xd(h,v,k){if(v=v.updateQueue,v!==null&&(v=v.shared,(k&4194048)!==0)){var z=v.lanes;z&=h.pendingLanes,k|=z,v.lanes=k,ic(h,k)}}function If(h,v){var k=h.updateQueue,z=h.alternate;if(z!==null&&(z=z.updateQueue,k===z)){var q=null,Q=null;if(k=k.firstBaseUpdate,k!==null){do{var Te={lane:k.lane,tag:k.tag,payload:k.payload,callback:null,next:null};Q===null?q=Q=Te:Q=Q.next=Te,k=k.next}while(k!==null);Q===null?q=Q=v:Q=Q.next=v}else q=Q=v;k={baseState:z.baseState,firstBaseUpdate:q,lastBaseUpdate:Q,shared:z.shared,callbacks:z.callbacks},h.updateQueue=k;return}h=k.lastBaseUpdate,h===null?k.firstBaseUpdate=v:h.next=v,k.lastBaseUpdate=v}var Nm=!1;function Yd(){if(Nm){var h=Du;if(h!==null)throw h}}function oc(h,v,k,z){Nm=!1;var q=h.updateQueue;_d=!1;var Q=q.firstBaseUpdate,Te=q.lastBaseUpdate,Ve=q.shared.pending;if(Ve!==null){q.shared.pending=null;var ut=Ve,ti=ut.next;ut.next=null,Te===null?Q=ti:Te.next=ti,Te=ut;var xi=h.alternate;xi!==null&&(xi=xi.updateQueue,Ve=xi.lastBaseUpdate,Ve!==Te&&(Ve===null?xi.firstBaseUpdate=ti:Ve.next=ti,xi.lastBaseUpdate=ut))}if(Q!==null){var Ci=q.baseState;Te=0,xi=ti=ut=null,Ve=Q;do{var ri=Ve.lane&-536870913,oi=ri!==Ve.lane;if(oi?(Pe&ri)===ri:(z&ri)===ri){ri!==0&&ri===ho&&(Nm=!0),xi!==null&&(xi=xi.next={lane:0,tag:Ve.tag,payload:Ve.payload,callback:null,next:null});e:{var ya=h,Qn=Ve;ri=v;var Or=k;switch(Qn.tag){case 1:if(ya=Qn.payload,typeof ya=="function"){Ci=ya.call(Or,Ci,ri);break e}Ci=ya;break e;case 3:ya.flags=ya.flags&-65537|128;case 0:if(ya=Qn.payload,ri=typeof ya=="function"?ya.call(Or,Ci,ri):ya,ri==null)break e;Ci=D({},Ci,ri);break e;case 2:_d=!0}}ri=Ve.callback,ri!==null&&(h.flags|=64,oi&&(h.flags|=8192),oi=q.callbacks,oi===null?q.callbacks=[ri]:oi.push(ri))}else oi={lane:ri,tag:Ve.tag,payload:Ve.payload,callback:Ve.callback,next:null},xi===null?(ti=xi=oi,ut=Ci):xi=xi.next=oi,Te|=ri;if(Ve=Ve.next,Ve===null){if(Ve=q.shared.pending,Ve===null)break;oi=Ve,Ve=oi.next,oi.next=null,q.lastBaseUpdate=oi,q.shared.pending=null}}while(!0);xi===null&&(ut=Ci),q.baseState=ut,q.firstBaseUpdate=ti,q.lastBaseUpdate=xi,Q===null&&(q.shared.lanes=0),ht|=Te,h.lanes=Te,h.memoizedState=Ci}}function yd(h,v){if(typeof h!="function")throw Error(u(191,h));h.call(v)}function zf(h,v){var k=h.callbacks;if(k!==null)for(h.callbacks=null,h=0;h<k.length;h++)yd(k[h],v)}var Kd=St(null),Ec=St(0);function Fm(h,v){h=it,Ft(Ec,h),Ft(Kd,v),it=h|v.baseLanes}function Jd(){Ft(Ec,it),Ft(Kd,Kd.current)}function Bm(){it=Ec.current,Ht(Kd),Ht(Ec)}var Fu=0,ja=null,xr=null,Ts=null,Df=!1,al=!1,Qd=!1,Um=0,Fh=0,eh=null,$m=0;function qr(){throw Error(u(321))}function lu(h,v){if(v===null)return!1;for(var k=0;k<v.length&&k<h.length;k++)if(!Tr(h[k],v[k]))return!1;return!0}function vd(h,v,k,z,q,Q){return Fu=Q,ja=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,qe.H=h===null||h.memoizedState===null?Eo:ug,Qd=!1,Q=k(z,q),Qd=!1,al&&(Q=Vm(v,k,z,q)),xd(h),Q}function xd(h){qe.H=Hl;var v=xr!==null&&xr.next!==null;if(Fu=0,Ts=xr=ja=null,Df=!1,Fh=0,eh=null,v)throw Error(u(300));h===null||Dr||(h=h.dependencies,h!==null&&Rm(h)&&(Dr=!0))}function Vm(h,v,k,z){ja=h;var q=0;do{if(al&&(eh=null),Fh=0,al=!1,25<=q)throw Error(u(301));if(q+=1,Ts=xr=null,h.updateQueue!=null){var Q=h.updateQueue;Q.lastEffect=null,Q.events=null,Q.stores=null,Q.memoCache!=null&&(Q.memoCache.index=0)}qe.H=Yf,Q=v(k,z)}while(al);return Q}function Hm(){var h=qe.H,v=h.useState()[0];return v=typeof v.then=="function"?vi(v):v,h=h.useState()[0],(xr!==null?xr.memoizedState:null)!==h&&(ja.flags|=1024),v}function Vl(){var h=Um!==0;return Um=0,h}function Of(h,v,k){v.updateQueue=h.updateQueue,v.flags&=-2053,h.lanes&=~k}function Gm(h){if(Df){for(h=h.memoizedState;h!==null;){var v=h.queue;v!==null&&(v.pending=null),h=h.next}Df=!1}Fu=0,Ts=xr=ja=null,al=!1,Fh=Um=0,eh=null}function rl(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ts===null?ja.memoizedState=Ts=h:Ts=Ts.next=h,Ts}function Wr(){if(xr===null){var h=ja.alternate;h=h!==null?h.memoizedState:null}else h=xr.next;var v=Ts===null?ja.memoizedState:Ts.next;if(v!==null)Ts=v,xr=h;else{if(h===null)throw ja.alternate===null?Error(u(467)):Error(u(310));xr=h,h={memoizedState:xr.memoizedState,baseState:xr.baseState,baseQueue:xr.baseQueue,queue:xr.queue,next:null},Ts===null?ja.memoizedState=Ts=h:Ts=Ts.next=h}return Ts}function Bu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function vi(h){var v=Fh;return Fh+=1,eh===null&&(eh=[]),h=r_(eh,h,v),v=ja,(Ts===null?v.memoizedState:Ts.next)===null&&(v=v.alternate,qe.H=v===null||v.memoizedState===null?Eo:ug),h}function bd(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return vi(h);if(h.$$typeof===be)return Uo(h)}throw Error(u(438,String(h)))}function Ac(h){var v=null,k=ja.updateQueue;if(k!==null&&(v=k.memoCache),v==null){var z=ja.alternate;z!==null&&(z=z.updateQueue,z!==null&&(z=z.memoCache,z!=null&&(v={data:z.data.map(function(q){return q.slice()}),index:0})))}if(v==null&&(v={data:[],index:0}),k===null&&(k=Bu(),ja.updateQueue=k),k.memoCache=v,k=v.data[v.index],k===void 0)for(k=v.data[v.index]=Array(h),z=0;z<h;z++)k[z]=lt;return v.index++,k}function $o(h,v){return typeof v=="function"?v(h):v}function qi(h){var v=Wr();return th(v,xr,h)}function th(h,v,k){var z=h.queue;if(z===null)throw Error(u(311));z.lastRenderedReducer=k;var q=h.baseQueue,Q=z.pending;if(Q!==null){if(q!==null){var Te=q.next;q.next=Q.next,Q.next=Te}v.baseQueue=q=Q,z.pending=null}if(Q=h.baseState,q===null)h.memoizedState=Q;else{v=q.next;var Ve=Te=null,ut=null,ti=v,xi=!1;do{var Ci=ti.lane&-536870913;if(Ci!==ti.lane?(Pe&Ci)===Ci:(Fu&Ci)===Ci){var ri=ti.revertLane;if(ri===0)ut!==null&&(ut=ut.next={lane:0,revertLane:0,action:ti.action,hasEagerState:ti.hasEagerState,eagerState:ti.eagerState,next:null}),Ci===ho&&(xi=!0);else if((Fu&ri)===ri){ti=ti.next,ri===ho&&(xi=!0);continue}else Ci={lane:0,revertLane:ti.revertLane,action:ti.action,hasEagerState:ti.hasEagerState,eagerState:ti.eagerState,next:null},ut===null?(Ve=ut=Ci,Te=Q):ut=ut.next=Ci,ja.lanes|=ri,ht|=ri;Ci=ti.action,Qd&&k(Q,Ci),Q=ti.hasEagerState?ti.eagerState:k(Q,Ci)}else ri={lane:Ci,revertLane:ti.revertLane,action:ti.action,hasEagerState:ti.hasEagerState,eagerState:ti.eagerState,next:null},ut===null?(Ve=ut=ri,Te=Q):ut=ut.next=ri,ja.lanes|=Ci,ht|=Ci;ti=ti.next}while(ti!==null&&ti!==v);if(ut===null?Te=Q:ut.next=Ve,!Tr(Q,h.memoizedState)&&(Dr=!0,xi&&(k=Du,k!==null)))throw k;h.memoizedState=Q,h.baseState=Te,h.baseQueue=ut,z.lastRenderedState=Q}return q===null&&(z.lanes=0),[h.memoizedState,z.dispatch]}function Nf(h){var v=Wr(),k=v.queue;if(k===null)throw Error(u(311));k.lastRenderedReducer=h;var z=k.dispatch,q=k.pending,Q=v.memoizedState;if(q!==null){k.pending=null;var Te=q=q.next;do Q=h(Q,Te.action),Te=Te.next;while(Te!==q);Tr(Q,v.memoizedState)||(Dr=!0),v.memoizedState=Q,v.baseQueue===null&&(v.baseState=Q),k.lastRenderedState=Q}return[Q,z]}function eg(h,v,k){var z=ja,q=Wr(),Q=ca;if(Q){if(k===void 0)throw Error(u(407));k=k()}else k=v();var Te=!Tr((xr||q).memoizedState,k);Te&&(q.memoizedState=k,Dr=!0),q=q.queue;var Ve=Uf.bind(null,z,q,h);if(Cc(2048,8,Ve,[h]),q.getSnapshot!==v||Te||Ts!==null&&Ts.memoizedState.tag&1){if(z.flags|=2048,ih(9,Vf(),Bf.bind(null,z,q,k,v),null),we===null)throw Error(u(349));Q||(Fu&124)!==0||Ff(z,v,k)}return k}function Ff(h,v,k){h.flags|=16384,h={getSnapshot:v,value:k},v=ja.updateQueue,v===null?(v=Bu(),ja.updateQueue=v,v.stores=[h]):(k=v.stores,k===null?v.stores=[h]:k.push(h))}function Bf(h,v,k,z){v.value=k,v.getSnapshot=z,qm(v)&&cu(h)}function Uf(h,v,k){return k(function(){qm(v)&&cu(h)})}function qm(h){var v=h.getSnapshot;h=h.value;try{var k=v();return!Tr(h,k)}catch{return!0}}function cu(h){var v=au(h,2);v!==null&&Zi(v,h,2)}function tg(h){var v=rl();if(typeof h=="function"){var k=h;if(h=k(),Qd){ds(!0);try{k()}finally{ds(!1)}}}return v.memoizedState=v.baseState=h,v.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$o,lastRenderedState:h},v}function sl(h,v,k,z){return h.baseState=k,th(h,xr,typeof z=="function"?z:$o)}function ig(h,v,k,z,q){if(Xf(h))throw Error(u(485));if(h=v.action,h!==null){var Q={payload:q,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Te){Q.listeners.push(Te)}};qe.T!==null?k(!0):Q.isTransition=!1,z(Q),k=v.pending,k===null?(Q.next=v.pending=Q,ko(v,Q)):(Q.next=k.next,v.pending=k.next=Q)}}function ko(h,v){var k=v.action,z=v.payload,q=h.state;if(v.isTransition){var Q=qe.T,Te={};qe.T=Te;try{var Ve=k(q,z),ut=qe.S;ut!==null&&ut(Te,Ve),uu(h,v,Ve)}catch(ti){Uh(h,v,ti)}finally{qe.T=Q}}else try{Q=k(q,z),uu(h,v,Q)}catch(ti){Uh(h,v,ti)}}function uu(h,v,k){k!==null&&typeof k=="object"&&typeof k.then=="function"?k.then(function(z){Bh(h,v,z)},function(z){return Uh(h,v,z)}):Bh(h,v,k)}function Bh(h,v,k){v.status="fulfilled",v.value=k,$f(v),h.state=k,v=h.pending,v!==null&&(k=v.next,k===v?h.pending=null:(k=k.next,v.next=k,ko(h,k)))}function Uh(h,v,k){var z=h.pending;if(h.pending=null,z!==null){z=z.next;do v.status="rejected",v.reason=k,$f(v),v=v.next;while(v!==z)}h.action=null}function $f(h){h=h.listeners;for(var v=0;v<h.length;v++)(0,h[v])()}function $h(h,v){return v}function ng(h,v){if(ca){var k=we.formState;if(k!==null){e:{var z=ja;if(ca){if(Pn){t:{for(var q=Pn,Q=Cr;q.nodeType!==8;){if(!Q){q=null;break t}if(q=wr(q.nextSibling),q===null){q=null;break t}}Q=q.data,q=Q==="F!"||Q==="F"?q:null}if(q){Pn=wr(q.nextSibling),z=q.data==="F!";break e}}to(z)}z=!1}z&&(v=k[0])}}return k=rl(),k.memoizedState=k.baseState=v,z={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$h,lastRenderedState:v},k.queue=z,k=kd.bind(null,ja,z),z.dispatch=k,z=tg(!1),Q=Km.bind(null,ja,!1,z.queue),z=rl(),q={state:v,dispatch:null,action:h,pending:null},z.queue=q,k=ig.bind(null,ja,q,Q,k),q.dispatch=k,z.memoizedState=h,[v,k,!1]}function du(h){var v=Wr();return Fa(v,xr,h)}function Fa(h,v,k){if(v=th(h,v,$h)[0],h=qi($o)[0],typeof v=="object"&&v!==null&&typeof v.then=="function")try{var z=vi(v)}catch(Te){throw Te===gd?Dh:Te}else z=v;v=Wr();var q=v.queue,Q=q.dispatch;return k!==v.memoizedState&&(ja.flags|=2048,ih(9,Vf(),Wm.bind(null,q,k),null)),[z,Q,h]}function Wm(h,v){h.action=v}function Zm(h){var v=Wr(),k=xr;if(k!==null)return Fa(v,k,h);Wr(),v=v.memoizedState,k=Wr();var z=k.queue.dispatch;return k.memoizedState=h,[v,z,!1]}function ih(h,v,k,z){return h={tag:h,create:k,deps:z,inst:v,next:null},v=ja.updateQueue,v===null&&(v=Bu(),ja.updateQueue=v),k=v.lastEffect,k===null?v.lastEffect=h.next=h:(z=k.next,k.next=h,h.next=z,v.lastEffect=h),h}function Vf(){return{destroy:void 0,resource:void 0}}function ag(){return Wr().memoizedState}function Hf(h,v,k,z){var q=rl();z=z===void 0?null:z,ja.flags|=h,q.memoizedState=ih(1|v,Vf(),k,z)}function Cc(h,v,k,z){var q=Wr();z=z===void 0?null:z;var Q=q.memoizedState.inst;xr!==null&&z!==null&&lu(z,xr.memoizedState.deps)?q.memoizedState=ih(v,Q,k,z):(ja.flags|=h,q.memoizedState=ih(1|v,Q,k,z))}function wd(h,v){Hf(8390656,8,h,v)}function ei(h,v){Cc(2048,8,h,v)}function li(h,v){return Cc(4,2,h,v)}function Sd(h,v){return Cc(4,4,h,v)}function dr(h,v){if(typeof v=="function"){h=h();var k=v(h);return function(){typeof k=="function"?k():v(null)}}if(v!=null)return h=h(),v.current=h,function(){v.current=null}}function rt(h,v,k){k=k!=null?k.concat([h]):null,Cc(4,4,dr.bind(null,v,h),k)}function Xm(){}function Gf(h,v){var k=Wr();v=v===void 0?null:v;var z=k.memoizedState;return v!==null&&lu(v,z[1])?z[0]:(k.memoizedState=[h,v],h)}function Mc(h,v){var k=Wr();v=v===void 0?null:v;var z=k.memoizedState;if(v!==null&&lu(v,z[1]))return z[0];if(z=h(),Qd){ds(!0);try{h()}finally{ds(!1)}}return k.memoizedState=[z,v],z}function Vh(h,v,k){return k===void 0||(Fu&1073741824)!==0?h.memoizedState=v:(h.memoizedState=k,h=ta(),ja.lanes|=h,ht|=h,k)}function Td(h,v,k,z){return Tr(k,v)?k:Kd.current!==null?(h=Vh(h,k,z),Tr(h,v)||(Dr=!0),h):(Fu&42)===0?(Dr=!0,h.memoizedState=k):(h=ta(),ja.lanes|=h,ht|=h,v)}function rg(h,v,k,z,q){var Q=wt.p;wt.p=Q!==0&&8>Q?Q:8;var Te=qe.T,Ve={};qe.T=Ve,Km(h,!1,v,k);try{var ut=q(),ti=qe.S;if(ti!==null&&ti(Ve,ut),ut!==null&&typeof ut=="object"&&typeof ut.then=="function"){var xi=zm(ut,z);ol(h,v,xi,Si(h))}else ol(h,v,z,Si(h))}catch(Ci){ol(h,v,{then:function(){},status:"rejected",reason:Ci},Si())}finally{wt.p=Q,qe.T=Te}}function Hh(){}function sg(h,v,k,z){if(h.tag!==5)throw Error(u(476));var q=s_(h).queue;rg(h,q,v,Ct,k===null?Hh:function(){return og(h),k(z)})}function s_(h){var v=h.memoizedState;if(v!==null)return v;v={memoizedState:Ct,baseState:Ct,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$o,lastRenderedState:Ct},next:null};var k={};return v.next={memoizedState:k,baseState:k,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$o,lastRenderedState:k},next:null},h.memoizedState=v,h=h.alternate,h!==null&&(h.memoizedState=v),v}function og(h){var v=s_(h).next.queue;ol(h,v,{},Si())}function Gh(){return Uo(dh)}function qf(){return Wr().memoizedState}function Wf(){return Wr().memoizedState}function Ym(h){for(var v=h.return;v!==null;){switch(v.tag){case 24:case 3:var k=Si();h=Nu(k);var z=$l(v,h,k);z!==null&&(Zi(z,v,k),Xd(z,v,k)),v={cache:Ih()},h.payload=v;return}v=v.return}}function Zf(h,v,k){var z=Si();k={lane:z,revertLane:0,action:k,hasEagerState:!1,eagerState:null,next:null},Xf(h)?lg(v,k):(k=Jt(h,v,k,z),k!==null&&(Zi(k,h,z),cg(k,v,z)))}function kd(h,v,k){var z=Si();ol(h,v,k,z)}function ol(h,v,k,z){var q={lane:z,revertLane:0,action:k,hasEagerState:!1,eagerState:null,next:null};if(Xf(h))lg(v,q);else{var Q=h.alternate;if(h.lanes===0&&(Q===null||Q.lanes===0)&&(Q=v.lastRenderedReducer,Q!==null))try{var Te=v.lastRenderedState,Ve=Q(Te,k);if(q.hasEagerState=!0,q.eagerState=Ve,Tr(Ve,Te))return nu(h,v,q,0),we===null&&eo(),!1}catch{}finally{}if(k=Jt(h,v,q,z),k!==null)return Zi(k,h,z),cg(k,v,z),!0}return!1}function Km(h,v,k,z){if(z={lane:2,revertLane:fp(),action:z,hasEagerState:!1,eagerState:null,next:null},Xf(h)){if(v)throw Error(u(479))}else v=Jt(h,k,z,2),v!==null&&Zi(v,h,2)}function Xf(h){var v=h.alternate;return h===ja||v!==null&&v===ja}function lg(h,v){al=Df=!0;var k=h.pending;k===null?v.next=v:(v.next=k.next,k.next=v),h.pending=v}function cg(h,v,k){if((k&4194048)!==0){var z=v.lanes;z&=h.pendingLanes,k|=z,v.lanes=k,ic(h,k)}}var Hl={readContext:Uo,use:bd,useCallback:qr,useContext:qr,useEffect:qr,useImperativeHandle:qr,useLayoutEffect:qr,useInsertionEffect:qr,useMemo:qr,useReducer:qr,useRef:qr,useState:qr,useDebugValue:qr,useDeferredValue:qr,useTransition:qr,useSyncExternalStore:qr,useId:qr,useHostTransitionStatus:qr,useFormState:qr,useActionState:qr,useOptimistic:qr,useMemoCache:qr,useCacheRefresh:qr},Eo={readContext:Uo,use:bd,useCallback:function(h,v){return rl().memoizedState=[h,v===void 0?null:v],h},useContext:Uo,useEffect:wd,useImperativeHandle:function(h,v,k){k=k!=null?k.concat([h]):null,Hf(4194308,4,dr.bind(null,v,h),k)},useLayoutEffect:function(h,v){return Hf(4194308,4,h,v)},useInsertionEffect:function(h,v){Hf(4,2,h,v)},useMemo:function(h,v){var k=rl();v=v===void 0?null:v;var z=h();if(Qd){ds(!0);try{h()}finally{ds(!1)}}return k.memoizedState=[z,v],z},useReducer:function(h,v,k){var z=rl();if(k!==void 0){var q=k(v);if(Qd){ds(!0);try{k(v)}finally{ds(!1)}}}else q=v;return z.memoizedState=z.baseState=q,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:q},z.queue=h,h=h.dispatch=Zf.bind(null,ja,h),[z.memoizedState,h]},useRef:function(h){var v=rl();return h={current:h},v.memoizedState=h},useState:function(h){h=tg(h);var v=h.queue,k=kd.bind(null,ja,v);return v.dispatch=k,[h.memoizedState,k]},useDebugValue:Xm,useDeferredValue:function(h,v){var k=rl();return Vh(k,h,v)},useTransition:function(){var h=tg(!1);return h=rg.bind(null,ja,h.queue,!0,!1),rl().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,v,k){var z=ja,q=rl();if(ca){if(k===void 0)throw Error(u(407));k=k()}else{if(k=v(),we===null)throw Error(u(349));(Pe&124)!==0||Ff(z,v,k)}q.memoizedState=k;var Q={value:k,getSnapshot:v};return q.queue=Q,wd(Uf.bind(null,z,Q,h),[h]),z.flags|=2048,ih(9,Vf(),Bf.bind(null,z,Q,k,v),null),k},useId:function(){var h=rl(),v=we.identifierPrefix;if(ca){var k=dt,z=ze;k=(z&~(1<<32-pr(z)-1)).toString(32)+k,v=""+v+"R"+k,k=Um++,0<k&&(v+="H"+k.toString(32)),v+=""}else k=$m++,v=""+v+"r"+k.toString(32)+"";return h.memoizedState=v},useHostTransitionStatus:Gh,useFormState:ng,useActionState:ng,useOptimistic:function(h){var v=rl();v.memoizedState=v.baseState=h;var k={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return v.queue=k,v=Km.bind(null,ja,!0,k),k.dispatch=v,[h,v]},useMemoCache:Ac,useCacheRefresh:function(){return rl().memoizedState=Ym.bind(null,ja)}},ug={readContext:Uo,use:bd,useCallback:Gf,useContext:Uo,useEffect:ei,useImperativeHandle:rt,useInsertionEffect:li,useLayoutEffect:Sd,useMemo:Mc,useReducer:qi,useRef:ag,useState:function(){return qi($o)},useDebugValue:Xm,useDeferredValue:function(h,v){var k=Wr();return Td(k,xr.memoizedState,h,v)},useTransition:function(){var h=qi($o)[0],v=Wr().memoizedState;return[typeof h=="boolean"?h:vi(h),v]},useSyncExternalStore:eg,useId:qf,useHostTransitionStatus:Gh,useFormState:du,useActionState:du,useOptimistic:function(h,v){var k=Wr();return sl(k,xr,h,v)},useMemoCache:Ac,useCacheRefresh:Wf},Yf={readContext:Uo,use:bd,useCallback:Gf,useContext:Uo,useEffect:ei,useImperativeHandle:rt,useInsertionEffect:li,useLayoutEffect:Sd,useMemo:Mc,useReducer:Nf,useRef:ag,useState:function(){return Nf($o)},useDebugValue:Xm,useDeferredValue:function(h,v){var k=Wr();return xr===null?Vh(k,h,v):Td(k,xr.memoizedState,h,v)},useTransition:function(){var h=Nf($o)[0],v=Wr().memoizedState;return[typeof h=="boolean"?h:vi(h),v]},useSyncExternalStore:eg,useId:qf,useHostTransitionStatus:Gh,useFormState:Zm,useActionState:Zm,useOptimistic:function(h,v){var k=Wr();return xr!==null?sl(k,xr,h,v):(k.baseState=h,[h,k.queue.dispatch])},useMemoCache:Ac,useCacheRefresh:Wf},qh=null,Ba=0;function Ln(h){var v=Ba;return Ba+=1,qh===null&&(qh=[]),r_(qh,h,v)}function Wh(h,v){v=v.props.ref,h.ref=v!==void 0?v:null}function Pc(h,v){throw v.$$typeof===$?Error(u(525)):(h=Object.prototype.toString.call(v),Error(u(31,h==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":h)))}function nh(h){var v=h._init;return v(h._payload)}function ah(h){function v(Dt,Et){if(h){var Kt=Dt.deletions;Kt===null?(Dt.deletions=[Et],Dt.flags|=16):Kt.push(Et)}}function k(Dt,Et){if(!h)return null;for(;Et!==null;)v(Dt,Et),Et=Et.sibling;return null}function z(Dt){for(var Et=new Map;Dt!==null;)Dt.key!==null?Et.set(Dt.key,Dt):Et.set(Dt.index,Dt),Dt=Dt.sibling;return Et}function q(Dt,Et){return Dt=uo(Dt,Et),Dt.index=0,Dt.sibling=null,Dt}function Q(Dt,Et,Kt){return Dt.index=Kt,h?(Kt=Dt.alternate,Kt!==null?(Kt=Kt.index,Kt<Et?(Dt.flags|=67108866,Et):Kt):(Dt.flags|=67108866,Et)):(Dt.flags|=1048576,Et)}function Te(Dt){return h&&Dt.alternate===null&&(Dt.flags|=67108866),Dt}function Ve(Dt,Et,Kt,Ei){return Et===null||Et.tag!==6?(Et=jh(Kt,Dt.mode,Ei),Et.return=Dt,Et):(Et=q(Et,Kt),Et.return=Dt,Et)}function ut(Dt,Et,Kt,Ei){var zn=Kt.type;return zn===te?xi(Dt,Et,Kt.props.children,Ei,Kt.key):Et!==null&&(Et.elementType===zn||typeof zn=="object"&&zn!==null&&zn.$$typeof===at&&nh(zn)===Et.type)?(Et=q(Et,Kt.props),Wh(Et,Kt),Et.return=Dt,Et):(Et=bl(Kt.type,Kt.key,Kt.props,null,Dt.mode,Ei),Wh(Et,Kt),Et.return=Dt,Et)}function ti(Dt,Et,Kt,Ei){return Et===null||Et.tag!==4||Et.stateNode.containerInfo!==Kt.containerInfo||Et.stateNode.implementation!==Kt.implementation?(Et=Ru(Kt,Dt.mode,Ei),Et.return=Dt,Et):(Et=q(Et,Kt.children||[]),Et.return=Dt,Et)}function xi(Dt,Et,Kt,Ei,zn){return Et===null||Et.tag!==7?(Et=Bl(Kt,Dt.mode,Ei,zn),Et.return=Dt,Et):(Et=q(Et,Kt),Et.return=Dt,Et)}function Ci(Dt,Et,Kt){if(typeof Et=="string"&&Et!==""||typeof Et=="number"||typeof Et=="bigint")return Et=jh(""+Et,Dt.mode,Kt),Et.return=Dt,Et;if(typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case G:return Kt=bl(Et.type,Et.key,Et.props,null,Dt.mode,Kt),Wh(Kt,Et),Kt.return=Dt,Kt;case X:return Et=Ru(Et,Dt.mode,Kt),Et.return=Dt,Et;case at:var Ei=Et._init;return Et=Ei(Et._payload),Ci(Dt,Et,Kt)}if(Pi(Et)||Zt(Et))return Et=Bl(Et,Dt.mode,Kt,null),Et.return=Dt,Et;if(typeof Et.then=="function")return Ci(Dt,Ln(Et),Kt);if(Et.$$typeof===be)return Ci(Dt,Lh(Dt,Et),Kt);Pc(Dt,Et)}return null}function ri(Dt,Et,Kt,Ei){var zn=Et!==null?Et.key:null;if(typeof Kt=="string"&&Kt!==""||typeof Kt=="number"||typeof Kt=="bigint")return zn!==null?null:Ve(Dt,Et,""+Kt,Ei);if(typeof Kt=="object"&&Kt!==null){switch(Kt.$$typeof){case G:return Kt.key===zn?ut(Dt,Et,Kt,Ei):null;case X:return Kt.key===zn?ti(Dt,Et,Kt,Ei):null;case at:return zn=Kt._init,Kt=zn(Kt._payload),ri(Dt,Et,Kt,Ei)}if(Pi(Kt)||Zt(Kt))return zn!==null?null:xi(Dt,Et,Kt,Ei,null);if(typeof Kt.then=="function")return ri(Dt,Et,Ln(Kt),Ei);if(Kt.$$typeof===be)return ri(Dt,Et,Lh(Dt,Kt),Ei);Pc(Dt,Kt)}return null}function oi(Dt,Et,Kt,Ei,zn){if(typeof Ei=="string"&&Ei!==""||typeof Ei=="number"||typeof Ei=="bigint")return Dt=Dt.get(Kt)||null,Ve(Et,Dt,""+Ei,zn);if(typeof Ei=="object"&&Ei!==null){switch(Ei.$$typeof){case G:return Dt=Dt.get(Ei.key===null?Kt:Ei.key)||null,ut(Et,Dt,Ei,zn);case X:return Dt=Dt.get(Ei.key===null?Kt:Ei.key)||null,ti(Et,Dt,Ei,zn);case at:var Ka=Ei._init;return Ei=Ka(Ei._payload),oi(Dt,Et,Kt,Ei,zn)}if(Pi(Ei)||Zt(Ei))return Dt=Dt.get(Kt)||null,xi(Et,Dt,Ei,zn,null);if(typeof Ei.then=="function")return oi(Dt,Et,Kt,Ln(Ei),zn);if(Ei.$$typeof===be)return oi(Dt,Et,Kt,Lh(Et,Ei),zn);Pc(Et,Ei)}return null}function ya(Dt,Et,Kt,Ei){for(var zn=null,Ka=null,Bn=Et,sa=Et=0,_s=null;Bn!==null&&sa<Kt.length;sa++){Bn.index>sa?(_s=Bn,Bn=null):_s=Bn.sibling;var or=ri(Dt,Bn,Kt[sa],Ei);if(or===null){Bn===null&&(Bn=_s);break}h&&Bn&&or.alternate===null&&v(Dt,Bn),Et=Q(or,Et,sa),Ka===null?zn=or:Ka.sibling=or,Ka=or,Bn=_s}if(sa===Kt.length)return k(Dt,Bn),ca&&Bt(Dt,sa),zn;if(Bn===null){for(;sa<Kt.length;sa++)Bn=Ci(Dt,Kt[sa],Ei),Bn!==null&&(Et=Q(Bn,Et,sa),Ka===null?zn=Bn:Ka.sibling=Bn,Ka=Bn);return ca&&Bt(Dt,sa),zn}for(Bn=z(Bn);sa<Kt.length;sa++)_s=oi(Bn,Dt,sa,Kt[sa],Ei),_s!==null&&(h&&_s.alternate!==null&&Bn.delete(_s.key===null?sa:_s.key),Et=Q(_s,Et,sa),Ka===null?zn=_s:Ka.sibling=_s,Ka=_s);return h&&Bn.forEach(function(_u){return v(Dt,_u)}),ca&&Bt(Dt,sa),zn}function Qn(Dt,Et,Kt,Ei){if(Kt==null)throw Error(u(151));for(var zn=null,Ka=null,Bn=Et,sa=Et=0,_s=null,or=Kt.next();Bn!==null&&!or.done;sa++,or=Kt.next()){Bn.index>sa?(_s=Bn,Bn=null):_s=Bn.sibling;var _u=ri(Dt,Bn,or.value,Ei);if(_u===null){Bn===null&&(Bn=_s);break}h&&Bn&&_u.alternate===null&&v(Dt,Bn),Et=Q(_u,Et,sa),Ka===null?zn=_u:Ka.sibling=_u,Ka=_u,Bn=_s}if(or.done)return k(Dt,Bn),ca&&Bt(Dt,sa),zn;if(Bn===null){for(;!or.done;sa++,or=Kt.next())or=Ci(Dt,or.value,Ei),or!==null&&(Et=Q(or,Et,sa),Ka===null?zn=or:Ka.sibling=or,Ka=or);return ca&&Bt(Dt,sa),zn}for(Bn=z(Bn);!or.done;sa++,or=Kt.next())or=oi(Bn,Dt,sa,or.value,Ei),or!==null&&(h&&or.alternate!==null&&Bn.delete(or.key===null?sa:or.key),Et=Q(or,Et,sa),Ka===null?zn=or:Ka.sibling=or,Ka=or);return h&&Bn.forEach(function(tv){return v(Dt,tv)}),ca&&Bt(Dt,sa),zn}function Or(Dt,Et,Kt,Ei){if(typeof Kt=="object"&&Kt!==null&&Kt.type===te&&Kt.key===null&&(Kt=Kt.props.children),typeof Kt=="object"&&Kt!==null){switch(Kt.$$typeof){case G:e:{for(var zn=Kt.key;Et!==null;){if(Et.key===zn){if(zn=Kt.type,zn===te){if(Et.tag===7){k(Dt,Et.sibling),Ei=q(Et,Kt.props.children),Ei.return=Dt,Dt=Ei;break e}}else if(Et.elementType===zn||typeof zn=="object"&&zn!==null&&zn.$$typeof===at&&nh(zn)===Et.type){k(Dt,Et.sibling),Ei=q(Et,Kt.props),Wh(Ei,Kt),Ei.return=Dt,Dt=Ei;break e}k(Dt,Et);break}else v(Dt,Et);Et=Et.sibling}Kt.type===te?(Ei=Bl(Kt.props.children,Dt.mode,Ei,Kt.key),Ei.return=Dt,Dt=Ei):(Ei=bl(Kt.type,Kt.key,Kt.props,null,Dt.mode,Ei),Wh(Ei,Kt),Ei.return=Dt,Dt=Ei)}return Te(Dt);case X:e:{for(zn=Kt.key;Et!==null;){if(Et.key===zn)if(Et.tag===4&&Et.stateNode.containerInfo===Kt.containerInfo&&Et.stateNode.implementation===Kt.implementation){k(Dt,Et.sibling),Ei=q(Et,Kt.children||[]),Ei.return=Dt,Dt=Ei;break e}else{k(Dt,Et);break}else v(Dt,Et);Et=Et.sibling}Ei=Ru(Kt,Dt.mode,Ei),Ei.return=Dt,Dt=Ei}return Te(Dt);case at:return zn=Kt._init,Kt=zn(Kt._payload),Or(Dt,Et,Kt,Ei)}if(Pi(Kt))return ya(Dt,Et,Kt,Ei);if(Zt(Kt)){if(zn=Zt(Kt),typeof zn!="function")throw Error(u(150));return Kt=zn.call(Kt),Qn(Dt,Et,Kt,Ei)}if(typeof Kt.then=="function")return Or(Dt,Et,Ln(Kt),Ei);if(Kt.$$typeof===be)return Or(Dt,Et,Lh(Dt,Kt),Ei);Pc(Dt,Kt)}return typeof Kt=="string"&&Kt!==""||typeof Kt=="number"||typeof Kt=="bigint"?(Kt=""+Kt,Et!==null&&Et.tag===6?(k(Dt,Et.sibling),Ei=q(Et,Kt),Ei.return=Dt,Dt=Ei):(k(Dt,Et),Ei=jh(Kt,Dt.mode,Ei),Ei.return=Dt,Dt=Ei),Te(Dt)):k(Dt,Et)}return function(Dt,Et,Kt,Ei){try{Ba=0;var zn=Or(Dt,Et,Kt,Ei);return qh=null,zn}catch(Bn){if(Bn===gd||Bn===Dh)throw Bn;var Ka=ts(29,Bn,null,Dt.mode);return Ka.lanes=Ei,Ka.return=Dt,Ka}finally{}}}var wl=ah(!0),Jm=ah(!1),Sl=St(null),lc=null;function jc(h){var v=h.alternate;Ft(gs,gs.current&1),Ft(Sl,h),lc===null&&(v===null||Kd.current!==null||v.memoizedState!==null)&&(lc=h)}function Tl(h){if(h.tag===22){if(Ft(gs,gs.current),Ft(Sl,h),lc===null){var v=h.alternate;v!==null&&v.memoizedState!==null&&(lc=h)}}else ps()}function ps(){Ft(gs,gs.current),Ft(Sl,Sl.current)}function ll(h){Ht(Sl),lc===h&&(lc=null),Ht(gs)}var gs=St(0);function Zh(h){for(var v=h;v!==null;){if(v.tag===13){var k=v.memoizedState;if(k!==null&&(k=k.dehydrated,k===null||k.data==="$?"||fm(k)))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===h)break;for(;v.sibling===null;){if(v.return===null||v.return===h)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}function Kf(h,v,k,z){v=h.memoizedState,k=k(z,v),k=k==null?v:D({},v,k),h.memoizedState=k,h.lanes===0&&(h.updateQueue.baseState=k)}var hu={enqueueSetState:function(h,v,k){h=h._reactInternals;var z=Si(),q=Nu(z);q.payload=v,k!=null&&(q.callback=k),v=$l(h,q,z),v!==null&&(Zi(v,h,z),Xd(v,h,z))},enqueueReplaceState:function(h,v,k){h=h._reactInternals;var z=Si(),q=Nu(z);q.tag=1,q.payload=v,k!=null&&(q.callback=k),v=$l(h,q,z),v!==null&&(Zi(v,h,z),Xd(v,h,z))},enqueueForceUpdate:function(h,v){h=h._reactInternals;var k=Si(),z=Nu(k);z.tag=2,v!=null&&(z.callback=v),v=$l(h,z,k),v!==null&&(Zi(v,h,k),Xd(v,h,k))}};function Jf(h,v,k,z,q,Q,Te){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(z,Q,Te):v.prototype&&v.prototype.isPureReactComponent?!co(k,z)||!co(q,Q):!0}function kl(h,v,k,z){h=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(k,z),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(k,z),v.state!==h&&hu.enqueueReplaceState(v,v.state,null)}function fu(h,v){var k=v;if("ref"in v){k={};for(var z in v)z!=="ref"&&(k[z]=v[z])}if(h=h.defaultProps){k===v&&(k=D({},k));for(var q in h)k[q]===void 0&&(k[q]=h[q])}return k}var rh=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var v=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(v))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)};function Qf(h){rh(h)}function Qm(h){console.error(h)}function Zr(h){rh(h)}function Uu(h,v){try{var k=h.onUncaughtError;k(v.value,{componentStack:v.stack})}catch(z){setTimeout(function(){throw z})}}function ep(h,v,k){try{var z=h.onCaughtError;z(k.value,{componentStack:k.stack,errorBoundary:v.tag===1?v.stateNode:null})}catch(q){setTimeout(function(){throw q})}}function em(h,v,k){return k=Nu(k),k.tag=3,k.payload={element:null},k.callback=function(){Uu(h,v)},k}function Ed(h){return h=Nu(h),h.tag=3,h}function tp(h,v,k,z){var q=k.type.getDerivedStateFromError;if(typeof q=="function"){var Q=z.value;h.payload=function(){return q(Q)},h.callback=function(){ep(v,k,z)}}var Te=k.stateNode;Te!==null&&typeof Te.componentDidCatch=="function"&&(h.callback=function(){ep(v,k,z),typeof q!="function"&&(Yt===null?Yt=new Set([this]):Yt.add(this));var Ve=z.stack;this.componentDidCatch(z.value,{componentStack:Ve!==null?Ve:""})})}function dg(h,v,k,z,q){if(k.flags|=32768,z!==null&&typeof z=="object"&&typeof z.then=="function"){if(v=k.alternate,v!==null&&fd(v,k,q,!0),k=Sl.current,k!==null){switch(k.tag){case 13:return lc===null?xn():k.alternate===null&&Ke===0&&(Ke=3),k.flags&=-257,k.flags|=65536,k.lanes=q,z===jf?k.flags|=16384:(v=k.updateQueue,v===null?k.updateQueue=new Set([z]):v.add(z),nr(h,z,q)),!1;case 22:return k.flags|=65536,z===jf?k.flags|=16384:(v=k.updateQueue,v===null?(v={transitions:null,markerInstances:null,retryQueue:new Set([z])},k.updateQueue=v):(k=v.retryQueue,k===null?v.retryQueue=new Set([z]):k.add(z)),nr(h,z,q)),!1}throw Error(u(435,k.tag))}return nr(h,z,q),xn(),!1}if(ca)return v=Sl.current,v!==null?((v.flags&65536)===0&&(v.flags|=256),v.flags|=65536,v.lanes=q,z!==fs&&(h=Error(u(422),{cause:z}),Sc(Ds(h,k)))):(z!==fs&&(v=Error(u(423),{cause:z}),Sc(Ds(v,k))),h=h.current.alternate,h.flags|=65536,q&=-q,h.lanes|=q,z=Ds(z,k),q=em(h.stateNode,z,q),If(h,q),Ke!==4&&(Ke=2)),!1;var Q=Error(u(520),{cause:z});if(Q=Ds(Q,k),Ye===null?Ye=[Q]:Ye.push(Q),Ke!==4&&(Ke=2),v===null)return!0;z=Ds(z,k),k=v;do{switch(k.tag){case 3:return k.flags|=65536,h=q&-q,k.lanes|=h,h=em(k.stateNode,z,h),If(k,h),!1;case 1:if(v=k.type,Q=k.stateNode,(k.flags&128)===0&&(typeof v.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(Yt===null||!Yt.has(Q))))return k.flags|=65536,q&=-q,k.lanes|=q,q=Ed(q),tp(q,h,k,z),If(k,q),!1}k=k.return}while(k!==null);return!1}var sh=Error(u(461)),Dr=!1;function br(h,v,k,z){v.child=h===null?Jm(v,null,k,z):wl(v,h.child,k,z)}function $u(h,v,k,z,q){k=k.render;var Q=v.ref;if("ref"in z){var Te={};for(var Ve in z)Ve!=="ref"&&(Te[Ve]=z[Ve])}else Te=z;return Wd(v),z=vd(h,v,k,Te,Q,q),Ve=Vl(),h!==null&&!Dr?(Of(h,v,q),mu(h,v,q)):(ca&&Ve&&Ri(v),v.flags|=1,br(h,v,z,q),v.child)}function ip(h,v,k,z,q){if(h===null){var Q=k.type;return typeof Q=="function"&&!ud(Q)&&Q.defaultProps===void 0&&k.compare===null?(v.tag=15,v.type=Q,tm(h,v,Q,z,q)):(h=bl(k.type,null,z,v,v.mode,q),h.ref=v.ref,h.return=v,v.child=h)}if(Q=h.child,!ir(h,q)){var Te=Q.memoizedProps;if(k=k.compare,k=k!==null?k:co,k(Te,z)&&h.ref===v.ref)return mu(h,v,q)}return v.flags|=1,h=uo(Q,z),h.ref=v.ref,h.return=v,v.child=h}function tm(h,v,k,z,q){if(h!==null){var Q=h.memoizedProps;if(co(Q,z)&&h.ref===v.ref)if(Dr=!1,v.pendingProps=z=Q,ir(h,q))(h.flags&131072)!==0&&(Dr=!0);else return v.lanes=h.lanes,mu(h,v,q)}return ap(h,v,k,z,q)}function np(h,v,k){var z=v.pendingProps,q=z.children,Q=h!==null?h.memoizedState:null;if(z.mode==="hidden"){if((v.flags&128)!==0){if(z=Q!==null?Q.baseLanes|k:k,h!==null){for(q=v.child=h.child,Q=0;q!==null;)Q=Q|q.lanes|q.childLanes,q=q.sibling;v.childLanes=Q&~z}else v.childLanes=0,v.child=null;return im(h,v,z,k)}if((k&536870912)!==0)v.memoizedState={baseLanes:0,cachePool:null},h!==null&&pd(v,Q!==null?Q.cachePool:null),Q!==null?Fm(v,Q):Jd(),Tl(v);else return v.lanes=v.childLanes=536870912,im(h,v,Q!==null?Q.baseLanes|k:k,k)}else Q!==null?(pd(v,Q.cachePool),Fm(v,Q),ps(),v.memoizedState=null):(h!==null&&pd(v,null),Jd(),ps());return br(h,v,q,k),v.child}function im(h,v,k,z){var q=md();return q=q===null?null:{parent:ms._currentValue,pool:q},v.memoizedState={baseLanes:k,cachePool:q},h!==null&&pd(v,null),Jd(),Tl(v),h!==null&&fd(h,v,z,!0),null}function oh(h,v){var k=v.ref;if(k===null)h!==null&&h.ref!==null&&(v.flags|=4194816);else{if(typeof k!="function"&&typeof k!="object")throw Error(u(284));(h===null||h.ref!==k)&&(v.flags|=4194816)}}function ap(h,v,k,z,q){return Wd(v),k=vd(h,v,k,z,void 0,q),z=Vl(),h!==null&&!Dr?(Of(h,v,q),mu(h,v,q)):(ca&&z&&Ri(v),v.flags|=1,br(h,v,k,q),v.child)}function nm(h,v,k,z,q,Q){return Wd(v),v.updateQueue=null,k=Vm(v,z,k,q),xd(h),z=Vl(),h!==null&&!Dr?(Of(h,v,Q),mu(h,v,Q)):(ca&&z&&Ri(v),v.flags|=1,br(h,v,k,Q),v.child)}function hg(h,v,k,z,q){if(Wd(v),v.stateNode===null){var Q=bc,Te=k.contextType;typeof Te=="object"&&Te!==null&&(Q=Uo(Te)),Q=new k(z,Q),v.memoizedState=Q.state!==null&&Q.state!==void 0?Q.state:null,Q.updater=hu,v.stateNode=Q,Q._reactInternals=v,Q=v.stateNode,Q.props=z,Q.state=v.memoizedState,Q.refs={},Nh(v),Te=k.contextType,Q.context=typeof Te=="object"&&Te!==null?Uo(Te):bc,Q.state=v.memoizedState,Te=k.getDerivedStateFromProps,typeof Te=="function"&&(Kf(v,k,Te,z),Q.state=v.memoizedState),typeof k.getDerivedStateFromProps=="function"||typeof Q.getSnapshotBeforeUpdate=="function"||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(Te=Q.state,typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount(),Te!==Q.state&&hu.enqueueReplaceState(Q,Q.state,null),oc(v,z,Q,q),Yd(),Q.state=v.memoizedState),typeof Q.componentDidMount=="function"&&(v.flags|=4194308),z=!0}else if(h===null){Q=v.stateNode;var Ve=v.memoizedProps,ut=fu(k,Ve);Q.props=ut;var ti=Q.context,xi=k.contextType;Te=bc,typeof xi=="object"&&xi!==null&&(Te=Uo(xi));var Ci=k.getDerivedStateFromProps;xi=typeof Ci=="function"||typeof Q.getSnapshotBeforeUpdate=="function",Ve=v.pendingProps!==Ve,xi||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(Ve||ti!==Te)&&kl(v,Q,z,Te),_d=!1;var ri=v.memoizedState;Q.state=ri,oc(v,z,Q,q),Yd(),ti=v.memoizedState,Ve||ri!==ti||_d?(typeof Ci=="function"&&(Kf(v,k,Ci,z),ti=v.memoizedState),(ut=_d||Jf(v,k,ut,z,ri,ti,Te))?(xi||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(v.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=z,v.memoizedState=ti),Q.props=z,Q.state=ti,Q.context=Te,z=ut):(typeof Q.componentDidMount=="function"&&(v.flags|=4194308),z=!1)}else{Q=v.stateNode,Lf(h,v),Te=v.memoizedProps,xi=fu(k,Te),Q.props=xi,Ci=v.pendingProps,ri=Q.context,ti=k.contextType,ut=bc,typeof ti=="object"&&ti!==null&&(ut=Uo(ti)),Ve=k.getDerivedStateFromProps,(ti=typeof Ve=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(Te!==Ci||ri!==ut)&&kl(v,Q,z,ut),_d=!1,ri=v.memoizedState,Q.state=ri,oc(v,z,Q,q),Yd();var oi=v.memoizedState;Te!==Ci||ri!==oi||_d||h!==null&&h.dependencies!==null&&Rm(h.dependencies)?(typeof Ve=="function"&&(Kf(v,k,Ve,z),oi=v.memoizedState),(xi=_d||Jf(v,k,xi,z,ri,oi,ut)||h!==null&&h.dependencies!==null&&Rm(h.dependencies))?(ti||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(z,oi,ut),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(z,oi,ut)),typeof Q.componentDidUpdate=="function"&&(v.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof Q.componentDidUpdate!="function"||Te===h.memoizedProps&&ri===h.memoizedState||(v.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||Te===h.memoizedProps&&ri===h.memoizedState||(v.flags|=1024),v.memoizedProps=z,v.memoizedState=oi),Q.props=z,Q.state=oi,Q.context=ut,z=xi):(typeof Q.componentDidUpdate!="function"||Te===h.memoizedProps&&ri===h.memoizedState||(v.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||Te===h.memoizedProps&&ri===h.memoizedState||(v.flags|=1024),z=!1)}return Q=z,oh(h,v),z=(v.flags&128)!==0,Q||z?(Q=v.stateNode,k=z&&typeof k.getDerivedStateFromError!="function"?null:Q.render(),v.flags|=1,h!==null&&z?(v.child=wl(v,h.child,null,q),v.child=wl(v,null,k,q)):br(h,v,k,q),v.memoizedState=Q.state,h=v.child):h=mu(h,v,q),h}function fg(h,v,k,z){return Ul(),v.flags|=256,br(h,v,k,z),v.child}var am={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Xh(h){return{baseLanes:h,cachePool:zh()}}function rp(h,v,k){return h=h!==null?h.childLanes&~k:0,v&&(h|=Ot),h}function sp(h,v,k){var z=v.pendingProps,q=!1,Q=(v.flags&128)!==0,Te;if((Te=Q)||(Te=h!==null&&h.memoizedState===null?!1:(gs.current&2)!==0),Te&&(q=!0,v.flags&=-129),Te=(v.flags&32)!==0,v.flags&=-33,h===null){if(ca){if(q?jc(v):ps(),ca){var Ve=Pn,ut;if(ut=Ve){e:{for(ut=Ve,Ve=Cr;ut.nodeType!==8;){if(!Ve){Ve=null;break e}if(ut=wr(ut.nextSibling),ut===null){Ve=null;break e}}Ve=ut}Ve!==null?(v.memoizedState={dehydrated:Ve,treeContext:ge!==null?{id:ze,overflow:dt}:null,retryLane:536870912,hydrationErrors:null},ut=ts(18,null,null,0),ut.stateNode=Ve,ut.return=v,v.child=ut,Sn=v,Pn=null,ut=!0):ut=!1}ut||to(v)}if(Ve=v.memoizedState,Ve!==null&&(Ve=Ve.dehydrated,Ve!==null))return fm(Ve)?v.lanes=32:v.lanes=536870912,null;ll(v)}return Ve=z.children,z=z.fallback,q?(ps(),q=v.mode,Ve=sm({mode:"hidden",children:Ve},q),z=Bl(z,q,k,null),Ve.return=v,z.return=v,Ve.sibling=z,v.child=Ve,q=v.child,q.memoizedState=Xh(k),q.childLanes=rp(h,Te,k),v.memoizedState=am,z):(jc(v),rm(v,Ve))}if(ut=h.memoizedState,ut!==null&&(Ve=ut.dehydrated,Ve!==null)){if(Q)v.flags&256?(jc(v),v.flags&=-257,v=Yh(h,v,k)):v.memoizedState!==null?(ps(),v.child=h.child,v.flags|=128,v=null):(ps(),q=z.fallback,Ve=v.mode,z=sm({mode:"visible",children:z.children},Ve),q=Bl(q,Ve,k,null),q.flags|=2,z.return=v,q.return=v,z.sibling=q,v.child=z,wl(v,h.child,null,k),z=v.child,z.memoizedState=Xh(k),z.childLanes=rp(h,Te,k),v.memoizedState=am,v=q);else if(jc(v),fm(Ve)){if(Te=Ve.nextSibling&&Ve.nextSibling.dataset,Te)var ti=Te.dgst;Te=ti,z=Error(u(419)),z.stack="",z.digest=Te,Sc({value:z,source:null,stack:null}),v=Yh(h,v,k)}else if(Dr||fd(h,v,k,!1),Te=(k&h.childLanes)!==0,Dr||Te){if(Te=we,Te!==null&&(z=k&-k,z=(z&42)!==0?1:Ro(z),z=(z&(Te.suspendedLanes|k))!==0?0:z,z!==0&&z!==ut.retryLane))throw ut.retryLane=z,au(h,z),Zi(Te,h,z),sh;Ve.data==="$?"||xn(),v=Yh(h,v,k)}else Ve.data==="$?"?(v.flags|=192,v.child=h.child,v=null):(h=ut.treeContext,Pn=wr(Ve.nextSibling),Sn=v,ca=!0,gr=null,Cr=!1,h!==null&&(V[ie++]=ze,V[ie++]=dt,V[ie++]=ge,ze=h.id,dt=h.overflow,ge=v),v=rm(v,z.children),v.flags|=4096);return v}return q?(ps(),q=z.fallback,Ve=v.mode,ut=h.child,ti=ut.sibling,z=uo(ut,{mode:"hidden",children:z.children}),z.subtreeFlags=ut.subtreeFlags&65011712,ti!==null?q=uo(ti,q):(q=Bl(q,Ve,k,null),q.flags|=2),q.return=v,z.return=v,z.sibling=q,v.child=z,z=q,q=v.child,Ve=h.child.memoizedState,Ve===null?Ve=Xh(k):(ut=Ve.cachePool,ut!==null?(ti=ms._currentValue,ut=ut.parent!==ti?{parent:ti,pool:ti}:ut):ut=zh(),Ve={baseLanes:Ve.baseLanes|k,cachePool:ut}),q.memoizedState=Ve,q.childLanes=rp(h,Te,k),v.memoizedState=am,z):(jc(v),k=h.child,h=k.sibling,k=uo(k,{mode:"visible",children:z.children}),k.return=v,k.sibling=null,h!==null&&(Te=v.deletions,Te===null?(v.deletions=[h],v.flags|=16):Te.push(h)),v.child=k,v.memoizedState=null,k)}function rm(h,v){return v=sm({mode:"visible",children:v},h.mode),v.return=h,h.child=v}function sm(h,v){return h=ts(22,h,null,v),h.lanes=0,h.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},h}function Yh(h,v,k){return wl(v,h.child,null,k),h=rm(v,v.pendingProps.children),h.flags|=2,v.memoizedState=null,h}function Kh(h,v,k){h.lanes|=v;var z=h.alternate;z!==null&&(z.lanes|=v),hd(h.return,v,k)}function op(h,v,k,z,q){var Q=h.memoizedState;Q===null?h.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:z,tail:k,tailMode:q}:(Q.isBackwards=v,Q.rendering=null,Q.renderingStartTime=0,Q.last=z,Q.tail=k,Q.tailMode=q)}function o_(h,v,k){var z=v.pendingProps,q=z.revealOrder,Q=z.tail;if(br(h,v,z.children,k),z=gs.current,(z&2)!==0)z=z&1|2,v.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=v.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&Kh(h,k,v);else if(h.tag===19)Kh(h,k,v);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===v)break e;for(;h.sibling===null;){if(h.return===null||h.return===v)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}z&=1}switch(Ft(gs,z),q){case"forwards":for(k=v.child,q=null;k!==null;)h=k.alternate,h!==null&&Zh(h)===null&&(q=k),k=k.sibling;k=q,k===null?(q=v.child,v.child=null):(q=k.sibling,k.sibling=null),op(v,!1,q,k,Q);break;case"backwards":for(k=null,q=v.child,v.child=null;q!==null;){if(h=q.alternate,h!==null&&Zh(h)===null){v.child=q;break}h=q.sibling,q.sibling=k,k=q,q=h}op(v,!0,k,null,Q);break;case"together":op(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function mu(h,v,k){if(h!==null&&(v.dependencies=h.dependencies),ht|=v.lanes,(k&v.childLanes)===0)if(h!==null){if(fd(h,v,k,!1),(k&v.childLanes)===0)return null}else return null;if(h!==null&&v.child!==h.child)throw Error(u(153));if(v.child!==null){for(h=v.child,k=uo(h,h.pendingProps),v.child=k,k.return=v;h.sibling!==null;)h=h.sibling,k=k.sibling=uo(h,h.pendingProps),k.return=v;k.sibling=null}return v.child}function ir(h,v){return(h.lanes&v)!==0?!0:(h=h.dependencies,!!(h!==null&&Rm(h)))}function lp(h,v,k){switch(v.tag){case 3:fn(v,v.stateNode.containerInfo),Tc(v,ms,h.memoizedState.cache),Ul();break;case 27:case 5:sn(v);break;case 4:fn(v,v.stateNode.containerInfo);break;case 10:Tc(v,v.type,v.memoizedProps.value);break;case 13:var z=v.memoizedState;if(z!==null)return z.dehydrated!==null?(jc(v),v.flags|=128,null):(k&v.child.childLanes)!==0?sp(h,v,k):(jc(v),h=mu(h,v,k),h!==null?h.sibling:null);jc(v);break;case 19:var q=(h.flags&128)!==0;if(z=(k&v.childLanes)!==0,z||(fd(h,v,k,!1),z=(k&v.childLanes)!==0),q){if(z)return o_(h,v,k);v.flags|=128}if(q=v.memoizedState,q!==null&&(q.rendering=null,q.tail=null,q.lastEffect=null),Ft(gs,gs.current),z)break;return null;case 22:case 23:return v.lanes=0,np(h,v,k);case 24:Tc(v,ms,h.memoizedState.cache)}return mu(h,v,k)}function l_(h,v,k){if(h!==null)if(h.memoizedProps!==v.pendingProps)Dr=!0;else{if(!ir(h,k)&&(v.flags&128)===0)return Dr=!1,lp(h,v,k);Dr=(h.flags&131072)!==0}else Dr=!1,ca&&(v.flags&1048576)!==0&&Lt(v,I,v.index);switch(v.lanes=0,v.tag){case 16:e:{h=v.pendingProps;var z=v.elementType,q=z._init;if(z=q(z._payload),v.type=z,typeof z=="function")ud(z)?(h=fu(z,h),v.tag=1,v=hg(null,v,z,h,k)):(v.tag=0,v=ap(null,v,z,h,k));else{if(z!=null){if(q=z.$$typeof,q===Ne){v.tag=11,v=$u(null,v,z,h,k);break e}else if(q===et){v.tag=14,v=ip(null,v,z,h,k);break e}}throw v=Di(z)||z,Error(u(306,v,""))}}return v;case 0:return ap(h,v,v.type,v.pendingProps,k);case 1:return z=v.type,q=fu(z,v.pendingProps),hg(h,v,z,q,k);case 3:e:{if(fn(v,v.stateNode.containerInfo),h===null)throw Error(u(387));z=v.pendingProps;var Q=v.memoizedState;q=Q.element,Lf(h,v),oc(v,z,null,k);var Te=v.memoizedState;if(z=Te.cache,Tc(v,ms,z),z!==Q.cache&&kc(v,[ms],k,!0),Yd(),z=Te.element,Q.isDehydrated)if(Q={element:z,isDehydrated:!1,cache:Te.cache},v.updateQueue.baseState=Q,v.memoizedState=Q,v.flags&256){v=fg(h,v,z,k);break e}else if(z!==q){q=Ds(Error(u(424)),v),Sc(q),v=fg(h,v,z,k);break e}else{switch(h=v.stateNode.containerInfo,h.nodeType){case 9:h=h.body;break;default:h=h.nodeName==="HTML"?h.ownerDocument.body:h}for(Pn=wr(h.firstChild),Sn=v,ca=!0,gr=null,Cr=!0,k=Jm(v,null,z,k),v.child=k;k;)k.flags=k.flags&-3|4096,k=k.sibling}else{if(Ul(),z===q){v=mu(h,v,k);break e}br(h,v,z,k)}v=v.child}return v;case 26:return oh(h,v),h===null?(k=Gy(v.type,null,v.pendingProps,null))?v.memoizedState=k:ca||(k=v.type,h=v.pendingProps,z=y_(Xt.current).createElement(k),z[ii]=v,z[Ai]=h,Ho(z,k,h),Ze(z),v.stateNode=z):v.memoizedState=Gy(v.type,h.memoizedProps,v.pendingProps,h.memoizedState),null;case 27:return sn(v),h===null&&ca&&(z=v.stateNode=Sg(v.type,v.pendingProps,Xt.current),Sn=v,Cr=!0,q=Pn,sf(v.type)?(of=q,Pn=wr(z.firstChild)):Pn=q),br(h,v,v.pendingProps.children,k),oh(h,v),h===null&&(v.flags|=4194304),v.child;case 5:return h===null&&ca&&((q=z=Pn)&&(z=ew(z,v.type,v.pendingProps,Cr),z!==null?(v.stateNode=z,Sn=v,Pn=wr(z.firstChild),Cr=!1,q=!0):q=!1),q||to(v)),sn(v),q=v.type,Q=v.pendingProps,Te=h!==null?h.memoizedProps:null,z=Q.children,v_(q,Q)?z=null:Te!==null&&v_(q,Te)&&(v.flags|=32),v.memoizedState!==null&&(q=vd(h,v,Hm,null,null,k),dh._currentValue=q),oh(h,v),br(h,v,z,k),v.child;case 6:return h===null&&ca&&((h=k=Pn)&&(k=Fx(k,v.pendingProps,Cr),k!==null?(v.stateNode=k,Sn=v,Pn=null,h=!0):h=!1),h||to(v)),null;case 13:return sp(h,v,k);case 4:return fn(v,v.stateNode.containerInfo),z=v.pendingProps,h===null?v.child=wl(v,null,z,k):br(h,v,z,k),v.child;case 11:return $u(h,v,v.type,v.pendingProps,k);case 7:return br(h,v,v.pendingProps,k),v.child;case 8:return br(h,v,v.pendingProps.children,k),v.child;case 12:return br(h,v,v.pendingProps.children,k),v.child;case 10:return z=v.pendingProps,Tc(v,v.type,z.value),br(h,v,z.children,k),v.child;case 9:return q=v.type._context,z=v.pendingProps.children,Wd(v),q=Uo(q),z=z(q),v.flags|=1,br(h,v,z,k),v.child;case 14:return ip(h,v,v.type,v.pendingProps,k);case 15:return tm(h,v,v.type,v.pendingProps,k);case 19:return o_(h,v,k);case 31:return z=v.pendingProps,k=v.mode,z={mode:z.mode,children:z.children},h===null?(k=sm(z,k),k.ref=v.ref,v.child=k,k.return=v,v=k):(k=uo(h.child,z),k.ref=v.ref,v.child=k,k.return=v,v=k),v;case 22:return np(h,v,k);case 24:return Wd(v),z=Uo(ms),h===null?(q=md(),q===null&&(q=we,Q=Ih(),q.pooledCache=Q,Q.refCount++,Q!==null&&(q.pooledCacheLanes|=k),q=Q),v.memoizedState={parent:z,cache:q},Nh(v),Tc(v,ms,q)):((h.lanes&k)!==0&&(Lf(h,v),oc(v,null,null,k),Yd()),q=h.memoizedState,Q=v.memoizedState,q.parent!==z?(q={parent:z,cache:z},v.memoizedState=q,v.lanes===0&&(v.memoizedState=v.updateQueue.baseState=q),Tc(v,ms,z)):(z=Q.cache,Tc(v,ms,z),z!==q.cache&&kc(v,[ms],k,!0))),br(h,v,v.pendingProps.children,k),v.child;case 29:throw v.pendingProps}throw Error(u(156,v.tag))}function Vu(h){h.flags|=4}function c_(h,v){if(v.type!=="stylesheet"||(v.state.loading&4)!==0)h.flags&=-16777217;else if(h.flags|=16777216,!Wy(v)){if(v=Sl.current,v!==null&&((Pe&4194048)===Pe?lc!==null:(Pe&62914560)!==Pe&&(Pe&536870912)===0||v!==lc))throw Oh=jf,Dm;h.flags|=8192}}function Ad(h,v){v!==null&&(h.flags|=4),h.flags&16384&&(v=h.tag!==22?Ws():536870912,h.lanes|=v,ot|=v)}function lh(h,v){if(!ca)switch(h.tailMode){case"hidden":v=h.tail;for(var k=null;v!==null;)v.alternate!==null&&(k=v),v=v.sibling;k===null?h.tail=null:k.sibling=null;break;case"collapsed":k=h.tail;for(var z=null;k!==null;)k.alternate!==null&&(z=k),k=k.sibling;z===null?v||h.tail===null?h.tail=null:h.tail.sibling=null:z.sibling=null}}function Xr(h){var v=h.alternate!==null&&h.alternate.child===h.child,k=0,z=0;if(v)for(var q=h.child;q!==null;)k|=q.lanes|q.childLanes,z|=q.subtreeFlags&65011712,z|=q.flags&65011712,q.return=h,q=q.sibling;else for(q=h.child;q!==null;)k|=q.lanes|q.childLanes,z|=q.subtreeFlags,z|=q.flags,q.return=h,q=q.sibling;return h.subtreeFlags|=z,h.childLanes=k,v}function cp(h,v,k){var z=v.pendingProps;switch(un(v),v.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xr(v),null;case 1:return Xr(v),null;case 3:return k=v.stateNode,z=null,h!==null&&(z=h.memoizedState.cache),v.memoizedState.cache!==z&&(v.flags|=2048),sc(ms),pn(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(h===null||h.child===null)&&(dd(v)?Vu(v):h===null||h.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,qd())),Xr(v),null;case 26:return k=v.memoizedState,h===null?(Vu(v),k!==null?(Xr(v),c_(v,k)):(Xr(v),v.flags&=-16777217)):k?k!==h.memoizedState?(Vu(v),Xr(v),c_(v,k)):(Xr(v),v.flags&=-16777217):(h.memoizedProps!==z&&Vu(v),Xr(v),v.flags&=-16777217),null;case 27:Un(v),k=Xt.current;var q=v.type;if(h!==null&&v.stateNode!=null)h.memoizedProps!==z&&Vu(v);else{if(!z){if(v.stateNode===null)throw Error(u(166));return Xr(v),null}h=_i.current,dd(v)?Cf(v):(h=Sg(q,z,k),v.stateNode=h,Vu(v))}return Xr(v),null;case 5:if(Un(v),k=v.type,h!==null&&v.stateNode!=null)h.memoizedProps!==z&&Vu(v);else{if(!z){if(v.stateNode===null)throw Error(u(166));return Xr(v),null}if(h=_i.current,dd(v))Cf(v);else{switch(q=y_(Xt.current),h){case 1:h=q.createElementNS("http://www.w3.org/2000/svg",k);break;case 2:h=q.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;default:switch(k){case"svg":h=q.createElementNS("http://www.w3.org/2000/svg",k);break;case"math":h=q.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;case"script":h=q.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof z.is=="string"?q.createElement("select",{is:z.is}):q.createElement("select"),z.multiple?h.multiple=!0:z.size&&(h.size=z.size);break;default:h=typeof z.is=="string"?q.createElement(k,{is:z.is}):q.createElement(k)}}h[ii]=v,h[Ai]=z;e:for(q=v.child;q!==null;){if(q.tag===5||q.tag===6)h.appendChild(q.stateNode);else if(q.tag!==4&&q.tag!==27&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===v)break e;for(;q.sibling===null;){if(q.return===null||q.return===v)break e;q=q.return}q.sibling.return=q.return,q=q.sibling}v.stateNode=h;e:switch(Ho(h,k,z),k){case"button":case"input":case"select":case"textarea":h=!!z.autoFocus;break e;case"img":h=!0;break e;default:h=!1}h&&Vu(v)}}return Xr(v),v.flags&=-16777217,null;case 6:if(h&&v.stateNode!=null)h.memoizedProps!==z&&Vu(v);else{if(typeof z!="string"&&v.stateNode===null)throw Error(u(166));if(h=Xt.current,dd(v)){if(h=v.stateNode,k=v.memoizedProps,z=null,q=Sn,q!==null)switch(q.tag){case 27:case 5:z=q.memoizedProps}h[ii]=v,h=!!(h.nodeValue===k||z!==null&&z.suppressHydrationWarning===!0||Dy(h.nodeValue,k)),h||to(v)}else h=y_(h).createTextNode(z),h[ii]=v,v.stateNode=h}return Xr(v),null;case 13:if(z=v.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(q=dd(v),z!==null&&z.dehydrated!==null){if(h===null){if(!q)throw Error(u(318));if(q=v.memoizedState,q=q!==null?q.dehydrated:null,!q)throw Error(u(317));q[ii]=v}else Ul(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;Xr(v),q=!1}else q=qd(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=q),q=!0;if(!q)return v.flags&256?(ll(v),v):(ll(v),null)}if(ll(v),(v.flags&128)!==0)return v.lanes=k,v;if(k=z!==null,h=h!==null&&h.memoizedState!==null,k){z=v.child,q=null,z.alternate!==null&&z.alternate.memoizedState!==null&&z.alternate.memoizedState.cachePool!==null&&(q=z.alternate.memoizedState.cachePool.pool);var Q=null;z.memoizedState!==null&&z.memoizedState.cachePool!==null&&(Q=z.memoizedState.cachePool.pool),Q!==q&&(z.flags|=2048)}return k!==h&&k&&(v.child.flags|=8192),Ad(v,v.updateQueue),Xr(v),null;case 4:return pn(),h===null&&jy(v.stateNode.containerInfo),Xr(v),null;case 10:return sc(v.type),Xr(v),null;case 19:if(Ht(gs),q=v.memoizedState,q===null)return Xr(v),null;if(z=(v.flags&128)!==0,Q=q.rendering,Q===null)if(z)lh(q,!1);else{if(Ke!==0||h!==null&&(h.flags&128)!==0)for(h=v.child;h!==null;){if(Q=Zh(h),Q!==null){for(v.flags|=128,lh(q,!1),h=Q.updateQueue,v.updateQueue=h,Ad(v,h),v.subtreeFlags=0,h=k,k=v.child;k!==null;)wc(k,h),k=k.sibling;return Ft(gs,gs.current&1|2),v.child}h=h.sibling}q.tail!==null&&Tn()>ai&&(v.flags|=128,z=!0,lh(q,!1),v.lanes=4194304)}else{if(!z)if(h=Zh(Q),h!==null){if(v.flags|=128,z=!0,h=h.updateQueue,v.updateQueue=h,Ad(v,h),lh(q,!0),q.tail===null&&q.tailMode==="hidden"&&!Q.alternate&&!ca)return Xr(v),null}else 2*Tn()-q.renderingStartTime>ai&&k!==536870912&&(v.flags|=128,z=!0,lh(q,!1),v.lanes=4194304);q.isBackwards?(Q.sibling=v.child,v.child=Q):(h=q.last,h!==null?h.sibling=Q:v.child=Q,q.last=Q)}return q.tail!==null?(v=q.tail,q.rendering=v,q.tail=v.sibling,q.renderingStartTime=Tn(),v.sibling=null,h=gs.current,Ft(gs,z?h&1|2:h&1),v):(Xr(v),null);case 22:case 23:return ll(v),Bm(),z=v.memoizedState!==null,h!==null?h.memoizedState!==null!==z&&(v.flags|=8192):z&&(v.flags|=8192),z?(k&536870912)!==0&&(v.flags&128)===0&&(Xr(v),v.subtreeFlags&6&&(v.flags|=8192)):Xr(v),k=v.updateQueue,k!==null&&Ad(v,k.retryQueue),k=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(k=h.memoizedState.cachePool.pool),z=null,v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(z=v.memoizedState.cachePool.pool),z!==k&&(v.flags|=2048),h!==null&&Ht(Ou),null;case 24:return k=null,h!==null&&(k=h.memoizedState.cache),v.memoizedState.cache!==k&&(v.flags|=2048),sc(ms),Xr(v),null;case 25:return null;case 30:return null}throw Error(u(156,v.tag))}function Hu(h,v){switch(un(v),v.tag){case 1:return h=v.flags,h&65536?(v.flags=h&-65537|128,v):null;case 3:return sc(ms),pn(),h=v.flags,(h&65536)!==0&&(h&128)===0?(v.flags=h&-65537|128,v):null;case 26:case 27:case 5:return Un(v),null;case 13:if(ll(v),h=v.memoizedState,h!==null&&h.dehydrated!==null){if(v.alternate===null)throw Error(u(340));Ul()}return h=v.flags,h&65536?(v.flags=h&-65537|128,v):null;case 19:return Ht(gs),null;case 4:return pn(),null;case 10:return sc(v.type),null;case 22:case 23:return ll(v),Bm(),h!==null&&Ht(Ou),h=v.flags,h&65536?(v.flags=h&-65537|128,v):null;case 24:return sc(ms),null;case 25:return null;default:return null}}function om(h,v){switch(un(v),v.tag){case 3:sc(ms),pn();break;case 26:case 27:case 5:Un(v);break;case 4:pn();break;case 13:ll(v);break;case 19:Ht(gs);break;case 10:sc(v.type);break;case 22:case 23:ll(v),Bm(),h!==null&&Ht(Ou);break;case 24:sc(ms)}}function Mr(h,v){try{var k=v.updateQueue,z=k!==null?k.lastEffect:null;if(z!==null){var q=z.next;k=q;do{if((k.tag&h)===h){z=void 0;var Q=k.create,Te=k.inst;z=Q(),Te.destroy=z}k=k.next}while(k!==q)}}catch(Ve){Fn(v,v.return,Ve)}}function Ao(h,v,k){try{var z=v.updateQueue,q=z!==null?z.lastEffect:null;if(q!==null){var Q=q.next;z=Q;do{if((z.tag&h)===h){var Te=z.inst,Ve=Te.destroy;if(Ve!==void 0){Te.destroy=void 0,q=v;var ut=k,ti=Ve;try{ti()}catch(xi){Fn(q,ut,xi)}}}z=z.next}while(z!==Q)}}catch(xi){Fn(v,v.return,xi)}}function Jh(h){var v=h.updateQueue;if(v!==null){var k=h.stateNode;try{zf(v,k)}catch(z){Fn(h,h.return,z)}}}function lm(h,v,k){k.props=fu(h.type,h.memoizedProps),k.state=h.memoizedState;try{k.componentWillUnmount()}catch(z){Fn(h,v,z)}}function Gu(h,v){try{var k=h.ref;if(k!==null){switch(h.tag){case 26:case 27:case 5:var z=h.stateNode;break;case 30:z=h.stateNode;break;default:z=h.stateNode}typeof k=="function"?h.refCleanup=k(z):k.current=z}}catch(q){Fn(h,v,q)}}function pu(h,v){var k=h.ref,z=h.refCleanup;if(k!==null)if(typeof z=="function")try{z()}catch(q){Fn(h,v,q)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof k=="function")try{k(null)}catch(q){Fn(h,v,q)}else k.current=null}function Qh(h){var v=h.type,k=h.memoizedProps,z=h.stateNode;try{e:switch(v){case"button":case"input":case"select":case"textarea":k.autoFocus&&z.focus();break e;case"img":k.src?z.src=k.src:k.srcSet&&(z.srcset=k.srcSet)}}catch(q){Fn(h,h.return,q)}}function ef(h,v,k){try{var z=h.stateNode;xg(z,h.type,k,v),z[Ai]=v}catch(q){Fn(h,h.return,q)}}function u_(h){return h.tag===5||h.tag===3||h.tag===26||h.tag===27&&sf(h.type)||h.tag===4}function tf(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||u_(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.tag===27&&sf(h.type)||h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function cm(h,v,k){var z=h.tag;if(z===5||z===6)h=h.stateNode,v?(k.nodeType===9?k.body:k.nodeName==="HTML"?k.ownerDocument.body:k).insertBefore(h,v):(v=k.nodeType===9?k.body:k.nodeName==="HTML"?k.ownerDocument.body:k,v.appendChild(h),k=k._reactRootContainer,k!=null||v.onclick!==null||(v.onclick=pp));else if(z!==4&&(z===27&&sf(h.type)&&(k=h.stateNode,v=null),h=h.child,h!==null))for(cm(h,v,k),h=h.sibling;h!==null;)cm(h,v,k),h=h.sibling}function Cd(h,v,k){var z=h.tag;if(z===5||z===6)h=h.stateNode,v?k.insertBefore(h,v):k.appendChild(h);else if(z!==4&&(z===27&&sf(h.type)&&(k=h.stateNode),h=h.child,h!==null))for(Cd(h,v,k),h=h.sibling;h!==null;)Cd(h,v,k),h=h.sibling}function nf(h){var v=h.stateNode,k=h.memoizedProps;try{for(var z=h.type,q=v.attributes;q.length;)v.removeAttributeNode(q[0]);Ho(v,z,k),v[ii]=h,v[Ai]=k}catch(Q){Fn(h,h.return,Q)}}var El=!1,Er=!1,Rc=!1,gu=typeof WeakSet=="function"?WeakSet:Set,Yr=null;function Lc(h,v){if(h=h.containerInfo,Oy=E_,h=Pu(h),yl(h)){if("selectionStart"in h)var k={start:h.selectionStart,end:h.selectionEnd};else e:{k=(k=h.ownerDocument)&&k.defaultView||window;var z=k.getSelection&&k.getSelection();if(z&&z.rangeCount!==0){k=z.anchorNode;var q=z.anchorOffset,Q=z.focusNode;z=z.focusOffset;try{k.nodeType,Q.nodeType}catch{k=null;break e}var Te=0,Ve=-1,ut=-1,ti=0,xi=0,Ci=h,ri=null;t:for(;;){for(var oi;Ci!==k||q!==0&&Ci.nodeType!==3||(Ve=Te+q),Ci!==Q||z!==0&&Ci.nodeType!==3||(ut=Te+z),Ci.nodeType===3&&(Te+=Ci.nodeValue.length),(oi=Ci.firstChild)!==null;)ri=Ci,Ci=oi;for(;;){if(Ci===h)break t;if(ri===k&&++ti===q&&(Ve=Te),ri===Q&&++xi===z&&(ut=Te),(oi=Ci.nextSibling)!==null)break;Ci=ri,ri=Ci.parentNode}Ci=oi}k=Ve===-1||ut===-1?null:{start:Ve,end:ut}}else k=null}k=k||{start:0,end:0}}else k=null;for(Ny={focusedElem:h,selectionRange:k},E_=!1,Yr=v;Yr!==null;)if(v=Yr,h=v.child,(v.subtreeFlags&1024)!==0&&h!==null)h.return=v,Yr=h;else for(;Yr!==null;){switch(v=Yr,Q=v.alternate,h=v.flags,v.tag){case 0:break;case 11:case 15:break;case 1:if((h&1024)!==0&&Q!==null){h=void 0,k=v,q=Q.memoizedProps,Q=Q.memoizedState,z=k.stateNode;try{var ya=fu(k.type,q,k.elementType===k.type);h=z.getSnapshotBeforeUpdate(ya,Q),z.__reactInternalSnapshotBeforeUpdate=h}catch(Qn){Fn(k,k.return,Qn)}}break;case 3:if((h&1024)!==0){if(h=v.stateNode.containerInfo,k=h.nodeType,k===9)wg(h);else if(k===1)switch(h.nodeName){case"HEAD":case"HTML":case"BODY":wg(h);break;default:h.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((h&1024)!==0)throw Error(u(163))}if(h=v.sibling,h!==null){h.return=v.return,Yr=h;break}Yr=v.return}}function d_(h,v,k){var z=k.flags;switch(k.tag){case 0:case 11:case 15:Zl(h,k),z&4&&Mr(5,k);break;case 1:if(Zl(h,k),z&4)if(h=k.stateNode,v===null)try{h.componentDidMount()}catch(Te){Fn(k,k.return,Te)}else{var q=fu(k.type,v.memoizedProps);v=v.memoizedState;try{h.componentDidUpdate(q,v,h.__reactInternalSnapshotBeforeUpdate)}catch(Te){Fn(k,k.return,Te)}}z&64&&Jh(k),z&512&&Gu(k,k.return);break;case 3:if(Zl(h,k),z&64&&(h=k.updateQueue,h!==null)){if(v=null,k.child!==null)switch(k.child.tag){case 27:case 5:v=k.child.stateNode;break;case 1:v=k.child.stateNode}try{zf(h,v)}catch(Te){Fn(k,k.return,Te)}}break;case 27:v===null&&z&4&&nf(k);case 26:case 5:Zl(h,k),v===null&&z&4&&Qh(k),z&512&&Gu(k,k.return);break;case 12:Zl(h,k);break;case 13:Zl(h,k),z&4&&Gl(h,k),z&64&&(h=k.memoizedState,h!==null&&(h=h.dehydrated,h!==null&&(k=zc.bind(null,k),tw(h,k))));break;case 22:if(z=k.memoizedState!==null||El,!z){v=v!==null&&v.memoizedState!==null||Er,q=El;var Q=Er;El=z,(Er=v)&&!Q?t(h,k,(k.subtreeFlags&8772)!==0):Zl(h,k),El=q,Er=Q}break;case 30:break;default:Zl(h,k)}}function h_(h){var v=h.alternate;v!==null&&(h.alternate=null,h_(v)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(v=h.stateNode,v!==null&&ne(v)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}var is=null,Al=!1;function Ic(h,v,k){for(k=k.child;k!==null;)io(h,v,k),k=k.sibling}function io(h,v,k){if(er&&typeof er.onCommitFiberUnmount=="function")try{er.onCommitFiberUnmount(Jr,k)}catch{}switch(k.tag){case 26:Er||pu(k,v),Ic(h,v,k),k.memoizedState?k.memoizedState.count--:k.stateNode&&(k=k.stateNode,k.parentNode.removeChild(k));break;case 27:Er||pu(k,v);var z=is,q=Al;sf(k.type)&&(is=k.stateNode,Al=!1),Ic(h,v,k),lf(k.stateNode),is=z,Al=q;break;case 5:Er||pu(k,v);case 6:if(z=is,q=Al,is=null,Ic(h,v,k),is=z,Al=q,is!==null)if(Al)try{(is.nodeType===9?is.body:is.nodeName==="HTML"?is.ownerDocument.body:is).removeChild(k.stateNode)}catch(Q){Fn(k,v,Q)}else try{is.removeChild(k.stateNode)}catch(Q){Fn(k,v,Q)}break;case 18:is!==null&&(Al?(h=is,Nx(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,k.stateNode),pm(h)):Nx(is,k.stateNode));break;case 4:z=is,q=Al,is=k.stateNode.containerInfo,Al=!0,Ic(h,v,k),is=z,Al=q;break;case 0:case 11:case 14:case 15:Er||Ao(2,k,v),Er||Ao(4,k,v),Ic(h,v,k);break;case 1:Er||(pu(k,v),z=k.stateNode,typeof z.componentWillUnmount=="function"&&lm(k,v,z)),Ic(h,v,k);break;case 21:Ic(h,v,k);break;case 22:Er=(z=Er)||k.memoizedState!==null,Ic(h,v,k),Er=z;break;default:Ic(h,v,k)}}function Gl(h,v){if(v.memoizedState===null&&(h=v.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{pm(h)}catch(k){Fn(v,v.return,k)}}function up(h){switch(h.tag){case 13:case 19:var v=h.stateNode;return v===null&&(v=h.stateNode=new gu),v;case 22:return h=h.stateNode,v=h._retryCache,v===null&&(v=h._retryCache=new gu),v;default:throw Error(u(435,h.tag))}}function mg(h,v){var k=up(h);v.forEach(function(z){var q=um.bind(null,h,z);k.has(z)||(k.add(z),z.then(q,q))})}function fo(h,v){var k=v.deletions;if(k!==null)for(var z=0;z<k.length;z++){var q=k[z],Q=h,Te=v,Ve=Te;e:for(;Ve!==null;){switch(Ve.tag){case 27:if(sf(Ve.type)){is=Ve.stateNode,Al=!1;break e}break;case 5:is=Ve.stateNode,Al=!1;break e;case 3:case 4:is=Ve.stateNode.containerInfo,Al=!0;break e}Ve=Ve.return}if(is===null)throw Error(u(160));io(Q,Te,q),is=null,Al=!1,Q=q.alternate,Q!==null&&(Q.return=null),q.return=null}if(v.subtreeFlags&13878)for(v=v.child;v!==null;)Wl(v,h),v=v.sibling}var ql=null;function Wl(h,v){var k=h.alternate,z=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:fo(v,h),ns(h),z&4&&(Ao(3,h,h.return),Mr(3,h),Ao(5,h,h.return));break;case 1:fo(v,h),ns(h),z&512&&(Er||k===null||pu(k,k.return)),z&64&&El&&(h=h.updateQueue,h!==null&&(z=h.callbacks,z!==null&&(k=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=k===null?z:k.concat(z))));break;case 26:var q=ql;if(fo(v,h),ns(h),z&512&&(Er||k===null||pu(k,k.return)),z&4){var Q=k!==null?k.memoizedState:null;if(z=h.memoizedState,k===null)if(z===null)if(h.stateNode===null){e:{z=h.type,k=h.memoizedProps,q=q.ownerDocument||q;t:switch(z){case"title":Q=q.getElementsByTagName("title")[0],(!Q||Q[Xe]||Q[ii]||Q.namespaceURI==="http://www.w3.org/2000/svg"||Q.hasAttribute("itemprop"))&&(Q=q.createElement(z),q.head.insertBefore(Q,q.querySelector("head > title"))),Ho(Q,z,k),Q[ii]=h,Ze(Q),z=Q;break e;case"link":var Te=qy("link","href",q).get(z+(k.href||""));if(Te){for(var Ve=0;Ve<Te.length;Ve++)if(Q=Te[Ve],Q.getAttribute("href")===(k.href==null||k.href===""?null:k.href)&&Q.getAttribute("rel")===(k.rel==null?null:k.rel)&&Q.getAttribute("title")===(k.title==null?null:k.title)&&Q.getAttribute("crossorigin")===(k.crossOrigin==null?null:k.crossOrigin)){Te.splice(Ve,1);break t}}Q=q.createElement(z),Ho(Q,z,k),q.head.appendChild(Q);break;case"meta":if(Te=qy("meta","content",q).get(z+(k.content||""))){for(Ve=0;Ve<Te.length;Ve++)if(Q=Te[Ve],Q.getAttribute("content")===(k.content==null?null:""+k.content)&&Q.getAttribute("name")===(k.name==null?null:k.name)&&Q.getAttribute("property")===(k.property==null?null:k.property)&&Q.getAttribute("http-equiv")===(k.httpEquiv==null?null:k.httpEquiv)&&Q.getAttribute("charset")===(k.charSet==null?null:k.charSet)){Te.splice(Ve,1);break t}}Q=q.createElement(z),Ho(Q,z,k),q.head.appendChild(Q);break;default:throw Error(u(468,z))}Q[ii]=h,Ze(Q),z=Q}h.stateNode=z}else Ag(q,h.type,h.stateNode);else h.stateNode=x_(q,z,h.memoizedProps);else Q!==z?(Q===null?k.stateNode!==null&&(k=k.stateNode,k.parentNode.removeChild(k)):Q.count--,z===null?Ag(q,h.type,h.stateNode):x_(q,z,h.memoizedProps)):z===null&&h.stateNode!==null&&ef(h,h.memoizedProps,k.memoizedProps)}break;case 27:fo(v,h),ns(h),z&512&&(Er||k===null||pu(k,k.return)),k!==null&&z&4&&ef(h,h.memoizedProps,k.memoizedProps);break;case 5:if(fo(v,h),ns(h),z&512&&(Er||k===null||pu(k,k.return)),h.flags&32){q=h.stateNode;try{yo(q,"")}catch(oi){Fn(h,h.return,oi)}}z&4&&h.stateNode!=null&&(q=h.memoizedProps,ef(h,q,k!==null?k.memoizedProps:q)),z&1024&&(Rc=!0);break;case 6:if(fo(v,h),ns(h),z&4){if(h.stateNode===null)throw Error(u(162));z=h.memoizedProps,k=h.stateNode;try{k.nodeValue=z}catch(oi){Fn(h,h.return,oi)}}break;case 3:if(Eg=null,q=ql,ql=Tg(v.containerInfo),fo(v,h),ql=q,ns(h),z&4&&k!==null&&k.memoizedState.isDehydrated)try{pm(v.containerInfo)}catch(oi){Fn(h,h.return,oi)}Rc&&(Rc=!1,Md(h));break;case 4:z=ql,ql=Tg(h.stateNode.containerInfo),fo(v,h),ns(h),ql=z;break;case 12:fo(v,h),ns(h);break;case 13:fo(v,h),ns(h),h.child.flags&8192&&h.memoizedState!==null!=(k!==null&&k.memoizedState!==null)&&(Nt=Tn()),z&4&&(z=h.updateQueue,z!==null&&(h.updateQueue=null,mg(h,z)));break;case 22:q=h.memoizedState!==null;var ut=k!==null&&k.memoizedState!==null,ti=El,xi=Er;if(El=ti||q,Er=xi||ut,fo(v,h),Er=xi,El=ti,ns(h),z&8192)e:for(v=h.stateNode,v._visibility=q?v._visibility&-2:v._visibility|1,q&&(k===null||ut||El||Er||m(h)),k=null,v=h;;){if(v.tag===5||v.tag===26){if(k===null){ut=k=v;try{if(Q=ut.stateNode,q)Te=Q.style,typeof Te.setProperty=="function"?Te.setProperty("display","none","important"):Te.display="none";else{Ve=ut.stateNode;var Ci=ut.memoizedProps.style,ri=Ci!=null&&Ci.hasOwnProperty("display")?Ci.display:null;Ve.style.display=ri==null||typeof ri=="boolean"?"":(""+ri).trim()}}catch(oi){Fn(ut,ut.return,oi)}}}else if(v.tag===6){if(k===null){ut=v;try{ut.stateNode.nodeValue=q?"":ut.memoizedProps}catch(oi){Fn(ut,ut.return,oi)}}}else if((v.tag!==22&&v.tag!==23||v.memoizedState===null||v===h)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===h)break e;for(;v.sibling===null;){if(v.return===null||v.return===h)break e;k===v&&(k=null),v=v.return}k===v&&(k=null),v.sibling.return=v.return,v=v.sibling}z&4&&(z=h.updateQueue,z!==null&&(k=z.retryQueue,k!==null&&(z.retryQueue=null,mg(h,k))));break;case 19:fo(v,h),ns(h),z&4&&(z=h.updateQueue,z!==null&&(h.updateQueue=null,mg(h,z)));break;case 30:break;case 21:break;default:fo(v,h),ns(h)}}function ns(h){var v=h.flags;if(v&2){try{for(var k,z=h.return;z!==null;){if(u_(z)){k=z;break}z=z.return}if(k==null)throw Error(u(160));switch(k.tag){case 27:var q=k.stateNode,Q=tf(h);Cd(h,Q,q);break;case 5:var Te=k.stateNode;k.flags&32&&(yo(Te,""),k.flags&=-33);var Ve=tf(h);Cd(h,Ve,Te);break;case 3:case 4:var ut=k.stateNode.containerInfo,ti=tf(h);cm(h,ti,ut);break;default:throw Error(u(161))}}catch(xi){Fn(h,h.return,xi)}h.flags&=-3}v&4096&&(h.flags&=-4097)}function Md(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var v=h;Md(v),v.tag===5&&v.flags&1024&&v.stateNode.reset(),h=h.sibling}}function Zl(h,v){if(v.subtreeFlags&8772)for(v=v.child;v!==null;)d_(h,v.alternate,v),v=v.sibling}function m(h){for(h=h.child;h!==null;){var v=h;switch(v.tag){case 0:case 11:case 14:case 15:Ao(4,v,v.return),m(v);break;case 1:pu(v,v.return);var k=v.stateNode;typeof k.componentWillUnmount=="function"&&lm(v,v.return,k),m(v);break;case 27:lf(v.stateNode);case 26:case 5:pu(v,v.return),m(v);break;case 22:v.memoizedState===null&&m(v);break;case 30:m(v);break;default:m(v)}h=h.sibling}}function t(h,v,k){for(k=k&&(v.subtreeFlags&8772)!==0,v=v.child;v!==null;){var z=v.alternate,q=h,Q=v,Te=Q.flags;switch(Q.tag){case 0:case 11:case 15:t(q,Q,k),Mr(4,Q);break;case 1:if(t(q,Q,k),z=Q,q=z.stateNode,typeof q.componentDidMount=="function")try{q.componentDidMount()}catch(ti){Fn(z,z.return,ti)}if(z=Q,q=z.updateQueue,q!==null){var Ve=z.stateNode;try{var ut=q.shared.hiddenCallbacks;if(ut!==null)for(q.shared.hiddenCallbacks=null,q=0;q<ut.length;q++)yd(ut[q],Ve)}catch(ti){Fn(z,z.return,ti)}}k&&Te&64&&Jh(Q),Gu(Q,Q.return);break;case 27:nf(Q);case 26:case 5:t(q,Q,k),k&&z===null&&Te&4&&Qh(Q),Gu(Q,Q.return);break;case 12:t(q,Q,k);break;case 13:t(q,Q,k),k&&Te&4&&Gl(q,Q);break;case 22:Q.memoizedState===null&&t(q,Q,k),Gu(Q,Q.return);break;case 30:break;default:t(q,Q,k)}v=v.sibling}}function o(h,v){var k=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(k=h.memoizedState.cachePool.pool),h=null,v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(h=v.memoizedState.cachePool.pool),h!==k&&(h!=null&&h.refCount++,k!=null&&su(k))}function p(h,v){h=null,v.alternate!==null&&(h=v.alternate.memoizedState.cache),v=v.memoizedState.cache,v!==h&&(v.refCount++,h!=null&&su(h))}function x(h,v,k,z){if(v.subtreeFlags&10256)for(v=v.child;v!==null;)T(h,v,k,z),v=v.sibling}function T(h,v,k,z){var q=v.flags;switch(v.tag){case 0:case 11:case 15:x(h,v,k,z),q&2048&&Mr(9,v);break;case 1:x(h,v,k,z);break;case 3:x(h,v,k,z),q&2048&&(h=null,v.alternate!==null&&(h=v.alternate.memoizedState.cache),v=v.memoizedState.cache,v!==h&&(v.refCount++,h!=null&&su(h)));break;case 12:if(q&2048){x(h,v,k,z),h=v.stateNode;try{var Q=v.memoizedProps,Te=Q.id,Ve=Q.onPostCommit;typeof Ve=="function"&&Ve(Te,v.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(ut){Fn(v,v.return,ut)}}else x(h,v,k,z);break;case 13:x(h,v,k,z);break;case 23:break;case 22:Q=v.stateNode,Te=v.alternate,v.memoizedState!==null?Q._visibility&2?x(h,v,k,z):j(h,v):Q._visibility&2?x(h,v,k,z):(Q._visibility|=2,E(h,v,k,z,(v.subtreeFlags&10256)!==0)),q&2048&&o(Te,v);break;case 24:x(h,v,k,z),q&2048&&p(v.alternate,v);break;default:x(h,v,k,z)}}function E(h,v,k,z,q){for(q=q&&(v.subtreeFlags&10256)!==0,v=v.child;v!==null;){var Q=h,Te=v,Ve=k,ut=z,ti=Te.flags;switch(Te.tag){case 0:case 11:case 15:E(Q,Te,Ve,ut,q),Mr(8,Te);break;case 23:break;case 22:var xi=Te.stateNode;Te.memoizedState!==null?xi._visibility&2?E(Q,Te,Ve,ut,q):j(Q,Te):(xi._visibility|=2,E(Q,Te,Ve,ut,q)),q&&ti&2048&&o(Te.alternate,Te);break;case 24:E(Q,Te,Ve,ut,q),q&&ti&2048&&p(Te.alternate,Te);break;default:E(Q,Te,Ve,ut,q)}v=v.sibling}}function j(h,v){if(v.subtreeFlags&10256)for(v=v.child;v!==null;){var k=h,z=v,q=z.flags;switch(z.tag){case 22:j(k,z),q&2048&&o(z.alternate,z);break;case 24:j(k,z),q&2048&&p(z.alternate,z);break;default:j(k,z)}v=v.sibling}}var O=8192;function B(h){if(h.subtreeFlags&O)for(h=h.child;h!==null;)H(h),h=h.sibling}function H(h){switch(h.tag){case 26:B(h),h.flags&O&&h.memoizedState!==null&&rw(ql,h.memoizedState,h.memoizedProps);break;case 5:B(h);break;case 3:case 4:var v=ql;ql=Tg(h.stateNode.containerInfo),B(h),ql=v;break;case 22:h.memoizedState===null&&(v=h.alternate,v!==null&&v.memoizedState!==null?(v=O,O=16777216,B(h),O=v):B(h));break;default:B(h)}}function K(h){var v=h.alternate;if(v!==null&&(h=v.child,h!==null)){v.child=null;do v=h.sibling,h.sibling=null,h=v;while(h!==null)}}function Y(h){var v=h.deletions;if((h.flags&16)!==0){if(v!==null)for(var k=0;k<v.length;k++){var z=v[k];Yr=z,ae(z,h)}K(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)J(h),h=h.sibling}function J(h){switch(h.tag){case 0:case 11:case 15:Y(h),h.flags&2048&&Ao(9,h,h.return);break;case 3:Y(h);break;case 12:Y(h);break;case 22:var v=h.stateNode;h.memoizedState!==null&&v._visibility&2&&(h.return===null||h.return.tag!==13)?(v._visibility&=-3,se(h)):Y(h);break;default:Y(h)}}function se(h){var v=h.deletions;if((h.flags&16)!==0){if(v!==null)for(var k=0;k<v.length;k++){var z=v[k];Yr=z,ae(z,h)}K(h)}for(h=h.child;h!==null;){switch(v=h,v.tag){case 0:case 11:case 15:Ao(8,v,v.return),se(v);break;case 22:k=v.stateNode,k._visibility&2&&(k._visibility&=-3,se(v));break;default:se(v)}h=h.sibling}}function ae(h,v){for(;Yr!==null;){var k=Yr;switch(k.tag){case 0:case 11:case 15:Ao(8,k,v);break;case 23:case 22:if(k.memoizedState!==null&&k.memoizedState.cachePool!==null){var z=k.memoizedState.cachePool.pool;z!=null&&z.refCount++}break;case 24:su(k.memoizedState.cache)}if(z=k.child,z!==null)z.return=k,Yr=z;else e:for(k=h;Yr!==null;){z=Yr;var q=z.sibling,Q=z.return;if(h_(z),z===k){Yr=null;break e}if(q!==null){q.return=Q,Yr=q;break e}Yr=Q}}}var he={getCacheForType:function(h){var v=Uo(ms),k=v.data.get(h);return k===void 0&&(k=h(),v.data.set(h,k)),k}},de=typeof WeakMap=="function"?WeakMap:Map,_e=0,we=null,ye=null,Pe=0,Ae=0,Ie=null,je=!1,Ce=!1,Ge=!1,it=0,Ke=0,ht=0,mt=0,kt=0,Ot=0,ot=0,Ye=null,gt=null,ft=!1,Nt=0,ai=1/0,gi=null,Yt=null,zt=0,ki=null,wi=null,di=0,yi=0,$i=null,hn=null,In=0,ea=null;function Si(){if((_e&2)!==0&&Pe!==0)return Pe&-Pe;if(qe.T!==null){var h=ho;return h!==0?h:fp()}return ku()}function ta(){Ot===0&&(Ot=(Pe&536870912)===0||ca?Jo():536870912);var h=Sl.current;return h!==null&&(h.flags|=32),Ot}function Zi(h,v,k){(h===we&&(Ae===2||Ae===9)||h.cancelPendingCommit!==null)&&(Ga(h,0),Nn(h,Pe,Ot,!1)),go(h,k),((_e&2)===0||h!==we)&&(h===we&&((_e&2)===0&&(mt|=k),Ke===4&&Nn(h,Pe,Ot,!1)),mo(h))}function ua(h,v,k){if((_e&6)!==0)throw Error(u(327));var z=!k&&(v&124)===0&&(v&h.expiredLanes)===0||Ss(h,v),q=z?cr(h,v):Ua(h,v,!0),Q=z;do{if(q===0){Ce&&!z&&Nn(h,v,0,!1);break}else{if(k=h.current.alternate,Q&&!xa(k)){q=Ua(h,v,!1),Q=!1;continue}if(q===2){if(Q=v,h.errorRecoveryDisabledLanes&Q)var Te=0;else Te=h.pendingLanes&-536870913,Te=Te!==0?Te:Te&536870912?536870912:0;if(Te!==0){v=Te;e:{var Ve=h;q=Ye;var ut=Ve.current.memoizedState.isDehydrated;if(ut&&(Ga(Ve,Te).flags|=256),Te=Ua(Ve,Te,!1),Te!==2){if(Ge&&!ut){Ve.errorRecoveryDisabledLanes|=Q,mt|=Q,q=4;break e}Q=gt,gt=q,Q!==null&&(gt===null?gt=Q:gt.push.apply(gt,Q))}q=Te}if(Q=!1,q!==2)continue}}if(q===1){Ga(h,0),Nn(h,v,0,!0);break}e:{switch(z=h,Q=q,Q){case 0:case 1:throw Error(u(345));case 4:if((v&4194048)!==v)break;case 6:Nn(z,v,Ot,!je);break e;case 2:gt=null;break;case 3:case 5:break;default:throw Error(u(329))}if((v&62914560)===v&&(q=Nt+300-Tn(),10<q)){if(Nn(z,v,Ot,!je),ec(z,0,!0)!==0)break e;z.timeoutHandle=Dx(va.bind(null,z,k,gt,gi,ft,v,Ot,mt,ot,je,Q,2,-0,0),q);break e}va(z,k,gt,gi,ft,v,Ot,mt,ot,je,Q,0,-0,0)}}break}while(!0);mo(h)}function va(h,v,k,z,q,Q,Te,Ve,ut,ti,xi,Ci,ri,oi){if(h.timeoutHandle=-1,Ci=v.subtreeFlags,(Ci&8192||(Ci&16785408)===16785408)&&(Cg={stylesheets:null,count:0,unsuspend:aw},H(v),Ci=sw(),Ci!==null)){h.cancelPendingCommit=Ci(Es.bind(null,h,v,Q,k,z,q,Te,Ve,ut,xi,1,ri,oi)),Nn(h,Q,Te,!ti);return}Es(h,v,Q,k,z,q,Te,Ve,ut)}function xa(h){for(var v=h;;){var k=v.tag;if((k===0||k===11||k===15)&&v.flags&16384&&(k=v.updateQueue,k!==null&&(k=k.stores,k!==null)))for(var z=0;z<k.length;z++){var q=k[z],Q=q.getSnapshot;q=q.value;try{if(!Tr(Q(),q))return!1}catch{return!1}}if(k=v.child,v.subtreeFlags&16384&&k!==null)k.return=v,v=k;else{if(v===h)break;for(;v.sibling===null;){if(v.return===null||v.return===h)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function Nn(h,v,k,z){v&=~kt,v&=~mt,h.suspendedLanes|=v,h.pingedLanes&=~v,z&&(h.warmLanes|=v),z=h.expirationTimes;for(var q=v;0<q;){var Q=31-pr(q),Te=1<<Q;z[Q]=-1,q&=~Te}k!==0&&Ur(h,k,v)}function _n(){return(_e&6)===0?(dp(0),!1):!0}function na(){if(ye!==null){if(Ae===0)var h=ye.return;else h=ye,nl=il=null,Gm(h),qh=null,Ba=0,h=ye;for(;h!==null;)om(h.alternate,h),h=h.return;ye=null}}function Ga(h,v){var k=h.timeoutHandle;k!==-1&&(h.timeoutHandle=-1,Kb(k)),k=h.cancelPendingCommit,k!==null&&(h.cancelPendingCommit=null,k()),na(),we=h,ye=k=uo(h.current,null),Pe=v,Ae=0,Ie=null,je=!1,Ce=Ss(h,v),Ge=!1,ot=Ot=kt=mt=ht=Ke=0,gt=Ye=null,ft=!1,(v&8)!==0&&(v|=v&32);var z=h.entangledLanes;if(z!==0)for(h=h.entanglements,z&=v;0<z;){var q=31-pr(z),Q=1<<q;v|=h[q],z&=~Q}return it=v,eo(),k}function Ya(h,v){ja=null,qe.H=Hl,v===gd||v===Dh?(v=Qp(),Ae=3):v===Dm?(v=Qp(),Ae=4):Ae=v===sh?8:v!==null&&typeof v=="object"&&typeof v.then=="function"?6:1,Ie=v,ye===null&&(Ke=1,Uu(h,Ds(v,h.current)))}function da(){var h=qe.H;return qe.H=Hl,h===null?Hl:h}function Xn(){var h=qe.A;return qe.A=he,h}function xn(){Ke=4,je||(Pe&4194048)!==Pe&&Sl.current!==null||(Ce=!0),(ht&134217727)===0&&(mt&134217727)===0||we===null||Nn(we,Pe,Ot,!1)}function Ua(h,v,k){var z=_e;_e|=2;var q=da(),Q=Xn();(we!==h||Pe!==v)&&(gi=null,Ga(h,v)),v=!1;var Te=Ke;e:do try{if(Ae!==0&&ye!==null){var Ve=ye,ut=Ie;switch(Ae){case 8:na(),Te=6;break e;case 3:case 2:case 9:case 6:Sl.current===null&&(v=!0);var ti=Ae;if(Ae=0,Ie=null,Ar(h,Ve,ut,ti),k&&Ce){Te=0;break e}break;default:ti=Ae,Ae=0,Ie=null,Ar(h,Ve,ut,ti)}}kr(),Te=Ke;break}catch(xi){Ya(h,xi)}while(!0);return v&&h.shellSuspendCounter++,nl=il=null,_e=z,qe.H=q,qe.A=Q,ye===null&&(we=null,Pe=0,eo()),Te}function kr(){for(;ye!==null;)Co(ye)}function cr(h,v){var k=_e;_e|=2;var z=da(),q=Xn();we!==h||Pe!==v?(gi=null,ai=Tn()+500,Ga(h,v)):Ce=Ss(h,v);e:do try{if(Ae!==0&&ye!==null){v=ye;var Q=Ie;t:switch(Ae){case 1:Ae=0,Ie=null,Ar(h,v,Q,1);break;case 2:case 9:if(Zd(Q)){Ae=0,Ie=null,Ns(v);break}v=function(){Ae!==2&&Ae!==9||we!==h||(Ae=7),mo(h)},Q.then(v,v);break e;case 3:Ae=7;break e;case 4:Ae=5;break e;case 7:Zd(Q)?(Ae=0,Ie=null,Ns(v)):(Ae=0,Ie=null,Ar(h,v,Q,7));break;case 5:var Te=null;switch(ye.tag){case 26:Te=ye.memoizedState;case 5:case 27:var Ve=ye;if(!Te||Wy(Te)){Ae=0,Ie=null;var ut=Ve.sibling;if(ut!==null)ye=ut;else{var ti=Ve.return;ti!==null?(ye=ti,ks(ti)):ye=null}break t}}Ae=0,Ie=null,Ar(h,v,Q,5);break;case 6:Ae=0,Ie=null,Ar(h,v,Q,6);break;case 8:na(),Ke=6;break e;default:throw Error(u(462))}}Ra();break}catch(xi){Ya(h,xi)}while(!0);return nl=il=null,qe.H=z,qe.A=q,_e=k,ye!==null?0:(we=null,Pe=0,eo(),Ke)}function Ra(){for(;ye!==null&&!mn();)Co(ye)}function Co(h){var v=l_(h.alternate,h,it);h.memoizedProps=h.pendingProps,v===null?ks(h):ye=v}function Ns(h){var v=h,k=v.alternate;switch(v.tag){case 15:case 0:v=nm(k,v,v.pendingProps,v.type,void 0,Pe);break;case 11:v=nm(k,v,v.pendingProps,v.type.render,v.ref,Pe);break;case 5:Gm(v);default:om(k,v),v=ye=wc(v,it),v=l_(k,v,it)}h.memoizedProps=h.pendingProps,v===null?ks(h):ye=v}function Ar(h,v,k,z){nl=il=null,Gm(v),qh=null,Ba=0;var q=v.return;try{if(dg(h,q,v,k,Pe)){Ke=1,Uu(h,Ds(k,h.current)),ye=null;return}}catch(Q){if(q!==null)throw ye=q,Q;Ke=1,Uu(h,Ds(k,h.current)),ye=null;return}v.flags&32768?(ca||z===1?h=!0:Ce||(Pe&536870912)!==0?h=!1:(je=h=!0,(z===2||z===9||z===3||z===6)&&(z=Sl.current,z!==null&&z.tag===13&&(z.flags|=16384))),no(v,h)):ks(v)}function ks(h){var v=h;do{if((v.flags&32768)!==0){no(v,je);return}h=v.return;var k=cp(v.alternate,v,it);if(k!==null){ye=k;return}if(v=v.sibling,v!==null){ye=v;return}ye=v=h}while(v!==null);Ke===0&&(Ke=5)}function no(h,v){do{var k=Hu(h.alternate,h);if(k!==null){k.flags&=32767,ye=k;return}if(k=h.return,k!==null&&(k.flags|=32768,k.subtreeFlags=0,k.deletions=null),!v&&(h=h.sibling,h!==null)){ye=h;return}ye=h=k}while(h!==null);Ke=6,ye=null}function Es(h,v,k,z,q,Q,Te,Ve,ut){h.cancelPendingCommit=null;do _r();while(zt!==0);if((_e&6)!==0)throw Error(u(327));if(v!==null){if(v===h.current)throw Error(u(177));if(Q=v.lanes|v.childLanes,Q|=Bo,Za(h,k,Q,Te,Ve,ut),h===we&&(ye=we=null,Pe=0),wi=v,ki=h,di=k,yi=Q,$i=q,hn=z,(v.subtreeFlags&10256)!==0||(v.flags&10256)!==0?(h.callbackNode=null,h.callbackPriority=0,rf(Hs,function(){return Ca(),null})):(h.callbackNode=null,h.callbackPriority=0),z=(v.flags&13878)!==0,(v.subtreeFlags&13878)!==0||z){z=qe.T,qe.T=null,q=wt.p,wt.p=2,Te=_e,_e|=4;try{Lc(h,v,k)}finally{_e=Te,wt.p=q,qe.T=z}}zt=1,Cl(),Xl(),Vo()}}function Cl(){if(zt===1){zt=0;var h=ki,v=wi,k=(v.flags&13878)!==0;if((v.subtreeFlags&13878)!==0||k){k=qe.T,qe.T=null;var z=wt.p;wt.p=2;var q=_e;_e|=4;try{Wl(v,h);var Q=Ny,Te=Pu(h.containerInfo),Ve=Q.focusedElem,ut=Q.selectionRange;if(Te!==Ve&&Ve&&Ve.ownerDocument&&Fo(Ve.ownerDocument.documentElement,Ve)){if(ut!==null&&yl(Ve)){var ti=ut.start,xi=ut.end;if(xi===void 0&&(xi=ti),"selectionStart"in Ve)Ve.selectionStart=ti,Ve.selectionEnd=Math.min(xi,Ve.value.length);else{var Ci=Ve.ownerDocument||document,ri=Ci&&Ci.defaultView||window;if(ri.getSelection){var oi=ri.getSelection(),ya=Ve.textContent.length,Qn=Math.min(ut.start,ya),Or=ut.end===void 0?Qn:Math.min(ut.end,ya);!oi.extend&&Qn>Or&&(Te=Or,Or=Qn,Qn=Te);var Dt=rd(Ve,Qn),Et=rd(Ve,Or);if(Dt&&Et&&(oi.rangeCount!==1||oi.anchorNode!==Dt.node||oi.anchorOffset!==Dt.offset||oi.focusNode!==Et.node||oi.focusOffset!==Et.offset)){var Kt=Ci.createRange();Kt.setStart(Dt.node,Dt.offset),oi.removeAllRanges(),Qn>Or?(oi.addRange(Kt),oi.extend(Et.node,Et.offset)):(Kt.setEnd(Et.node,Et.offset),oi.addRange(Kt))}}}}for(Ci=[],oi=Ve;oi=oi.parentNode;)oi.nodeType===1&&Ci.push({element:oi,left:oi.scrollLeft,top:oi.scrollTop});for(typeof Ve.focus=="function"&&Ve.focus(),Ve=0;Ve<Ci.length;Ve++){var Ei=Ci[Ve];Ei.element.scrollLeft=Ei.left,Ei.element.scrollTop=Ei.top}}E_=!!Oy,Ny=Oy=null}finally{_e=q,wt.p=z,qe.T=k}}h.current=v,zt=2}}function Xl(){if(zt===2){zt=0;var h=ki,v=wi,k=(v.flags&8772)!==0;if((v.subtreeFlags&8772)!==0||k){k=qe.T,qe.T=null;var z=wt.p;wt.p=2;var q=_e;_e|=4;try{d_(h,v.alternate,v)}finally{_e=q,wt.p=z,qe.T=k}}zt=3}}function Vo(){if(zt===4||zt===3){zt=0,cn();var h=ki,v=wi,k=di,z=hn;(v.subtreeFlags&10256)!==0||(v.flags&10256)!==0?zt=5:(zt=0,wi=ki=null,hr(h,h.pendingLanes));var q=h.pendingLanes;if(q===0&&(Yt=null),_o(k),v=v.stateNode,er&&typeof er.onCommitFiberRoot=="function")try{er.onCommitFiberRoot(Jr,v,void 0,(v.current.flags&128)===128)}catch{}if(z!==null){v=qe.T,q=wt.p,wt.p=2,qe.T=null;try{for(var Q=h.onRecoverableError,Te=0;Te<z.length;Te++){var Ve=z[Te];Q(Ve.value,{componentStack:Ve.stack})}}finally{qe.T=v,wt.p=q}}(di&3)!==0&&_r(),mo(h),q=h.pendingLanes,(k&4194090)!==0&&(q&42)!==0?h===ea?In++:(In=0,ea=h):In=0,dp(0)}}function hr(h,v){(h.pooledCacheLanes&=v)===0&&(v=h.pooledCache,v!=null&&(h.pooledCache=null,su(v)))}function _r(h){return Cl(),Xl(),Vo(),Ca()}function Ca(){if(zt!==5)return!1;var h=ki,v=yi;yi=0;var k=_o(di),z=qe.T,q=wt.p;try{wt.p=32>k?32:k,qe.T=null,k=$i,$i=null;var Q=ki,Te=di;if(zt=0,wi=ki=null,di=0,(_e&6)!==0)throw Error(u(331));var Ve=_e;if(_e|=4,J(Q.current),T(Q,Q.current,Te,k),_e=Ve,dp(0,!1),er&&typeof er.onPostCommitFiberRoot=="function")try{er.onPostCommitFiberRoot(Jr,Q)}catch{}return!0}finally{wt.p=q,qe.T=z,hr(h,v)}}function Pr(h,v,k){v=Ds(k,v),v=em(h.stateNode,v,2),h=$l(h,v,2),h!==null&&(go(h,2),mo(h))}function Fn(h,v,k){if(h.tag===3)Pr(h,h,k);else for(;v!==null;){if(v.tag===3){Pr(v,h,k);break}else if(v.tag===1){var z=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof z.componentDidCatch=="function"&&(Yt===null||!Yt.has(z))){h=Ds(k,h),k=Ed(2),z=$l(v,k,2),z!==null&&(tp(k,z,v,h),go(z,2),mo(z));break}}v=v.return}}function nr(h,v,k){var z=h.pingCache;if(z===null){z=h.pingCache=new de;var q=new Set;z.set(v,q)}else q=z.get(v),q===void 0&&(q=new Set,z.set(v,q));q.has(k)||(Ge=!0,q.add(k),h=cc.bind(null,h,v,k),v.then(h,h))}function cc(h,v,k){var z=h.pingCache;z!==null&&z.delete(v),h.pingedLanes|=h.suspendedLanes&k,h.warmLanes&=~k,we===h&&(Pe&k)===k&&(Ke===4||Ke===3&&(Pe&62914560)===Pe&&300>Tn()-Nt?(_e&2)===0&&Ga(h,0):kt|=k,ot===Pe&&(ot=0)),mo(h)}function af(h,v){v===0&&(v=Ws()),h=au(h,v),h!==null&&(go(h,v),mo(h))}function zc(h){var v=h.memoizedState,k=0;v!==null&&(k=v.retryLane),af(h,k)}function um(h,v){var k=0;switch(h.tag){case 13:var z=h.stateNode,q=h.memoizedState;q!==null&&(k=q.retryLane);break;case 19:z=h.stateNode;break;case 22:z=h.stateNode._retryCache;break;default:throw Error(u(314))}z!==null&&z.delete(v),af(h,k)}function rf(h,v){return Ii(h,v)}var Yl=null,Ml=null,Pd=!1,Dc=!1,Oc=!1,Mo=0;function mo(h){h!==Ml&&h.next===null&&(Ml===null?Yl=Ml=h:Ml=Ml.next=h),Dc=!0,Pd||(Pd=!0,Mx())}function dp(h,v){if(!Oc&&Dc){Oc=!0;do for(var k=!1,z=Yl;z!==null;){if(h!==0){var q=z.pendingLanes;if(q===0)var Q=0;else{var Te=z.suspendedLanes,Ve=z.pingedLanes;Q=(1<<31-pr(42|h)+1)-1,Q&=q&~(Te&~Ve),Q=Q&201326741?Q&201326741|1:Q?Q|2:0}Q!==0&&(k=!0,gg(z,Q))}else Q=Pe,Q=ec(z,z===we?Q:0,z.cancelPendingCommit!==null||z.timeoutHandle!==-1),(Q&3)===0||Ss(z,Q)||(k=!0,gg(z,Q));z=z.next}while(k);Oc=!1}}function Cx(){pg()}function pg(){Dc=Pd=!1;var h=0;Mo!==0&&(bg()&&(h=Mo),Mo=0);for(var v=Tn(),k=null,z=Yl;z!==null;){var q=z.next,Q=f_(z,v);Q===0?(z.next=null,k===null?Yl=q:k.next=q,q===null&&(Ml=k)):(k=z,(h!==0||(Q&3)!==0)&&(Dc=!0)),z=q}dp(h)}function f_(h,v){for(var k=h.suspendedLanes,z=h.pingedLanes,q=h.expirationTimes,Q=h.pendingLanes&-62914561;0<Q;){var Te=31-pr(Q),Ve=1<<Te,ut=q[Te];ut===-1?((Ve&k)===0||(Ve&z)!==0)&&(q[Te]=po(Ve,v)):ut<=v&&(h.expiredLanes|=Ve),Q&=~Ve}if(v=we,k=Pe,k=ec(h,h===v?k:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),z=h.callbackNode,k===0||h===v&&(Ae===2||Ae===9)||h.cancelPendingCommit!==null)return z!==null&&z!==null&&nn(z),h.callbackNode=null,h.callbackPriority=0;if((k&3)===0||Ss(h,k)){if(v=k&-k,v===h.callbackPriority)return v;switch(z!==null&&nn(z),_o(k)){case 2:case 8:k=Xo;break;case 32:k=Hs;break;case 268435456:k=Gs;break;default:k=Hs}return z=hp.bind(null,h),k=Ii(k,z),h.callbackPriority=v,h.callbackNode=k,v}return z!==null&&z!==null&&nn(z),h.callbackPriority=2,h.callbackNode=null,2}function hp(h,v){if(zt!==0&&zt!==5)return h.callbackNode=null,h.callbackPriority=0,null;var k=h.callbackNode;if(_r()&&h.callbackNode!==k)return null;var z=Pe;return z=ec(h,h===we?z:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),z===0?null:(ua(h,z,v),f_(h,Tn()),h.callbackNode!=null&&h.callbackNode===k?hp.bind(null,h):null)}function gg(h,v){if(_r())return null;ua(h,v,!0)}function Mx(){Jb(function(){(_e&6)!==0?Ii(Hc,Cx):pg()})}function fp(){return Mo===0&&(Mo=Jo()),Mo}function m_(h){return h==null||typeof h=="symbol"||typeof h=="boolean"?null:typeof h=="function"?h:ao(""+h)}function p_(h,v){var k=v.ownerDocument.createElement("input");return k.name=v.name,k.value=v.value,h.id&&k.setAttribute("form",h.id),v.parentNode.insertBefore(k,v),h=new FormData(h),k.parentNode.removeChild(k),h}function Px(h,v,k,z,q){if(v==="submit"&&k&&k.stateNode===q){var Q=m_((q[Ai]||null).action),Te=z.submitter;Te&&(v=(v=Te[Ai]||null)?m_(v.formAction):Te.getAttribute("formAction"),v!==null&&(Q=v,Te=null));var Ve=new Ju("action","action",null,z,q);h.push({event:Ve,listeners:[{instance:null,listener:function(){if(z.defaultPrevented){if(Mo!==0){var ut=Te?p_(q,Te):new FormData(q);sg(k,{pending:!0,data:ut,method:q.method,action:Q},null,ut)}}else typeof Q=="function"&&(Ve.preventDefault(),ut=Te?p_(q,Te):new FormData(q),sg(k,{pending:!0,data:ut,method:q.method,action:Q},Q,ut))},currentTarget:q}]})}}for(var g_=0;g_<Nl.length;g_++){var jd=Nl[g_],jx=jd.toLowerCase(),Py=jd[0].toUpperCase()+jd.slice(1);es(jx,"on"+Py)}es(Af,"onAnimationEnd"),es(xl,"onAnimationIteration"),es(ju,"onAnimationStart"),es("dblclick","onDoubleClick"),es("focusin","onFocus"),es("focusout","onBlur"),es(eu,"onTransitionRun"),es(Gd,"onTransitionStart"),es(jm,"onTransitionCancel"),es(ld,"onTransitionEnd"),It("onMouseEnter",["mouseout","mouseover"]),It("onMouseLeave",["mouseout","mouseover"]),It("onPointerEnter",["pointerout","pointerover"]),It("onPointerLeave",["pointerout","pointerover"]),ct("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ct("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ct("onBeforeInput",["compositionend","keypress","textInput","paste"]),ct("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ct("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ct("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yb=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mp));function Rx(h,v){v=(v&4)!==0;for(var k=0;k<h.length;k++){var z=h[k],q=z.event;z=z.listeners;e:{var Q=void 0;if(v)for(var Te=z.length-1;0<=Te;Te--){var Ve=z[Te],ut=Ve.instance,ti=Ve.currentTarget;if(Ve=Ve.listener,ut!==Q&&q.isPropagationStopped())break e;Q=Ve,q.currentTarget=ti;try{Q(q)}catch(xi){rh(xi)}q.currentTarget=null,Q=ut}else for(Te=0;Te<z.length;Te++){if(Ve=z[Te],ut=Ve.instance,ti=Ve.currentTarget,Ve=Ve.listener,ut!==Q&&q.isPropagationStopped())break e;Q=Ve,q.currentTarget=ti;try{Q(q)}catch(xi){rh(xi)}q.currentTarget=null,Q=ut}}}}function sr(h,v){var k=v[Wi];k===void 0&&(k=v[Wi]=new Set);var z=h+"__bubble";k.has(z)||(Ry(v,h,2,!1),k.add(z))}function __(h,v,k){var z=0;v&&(z|=4),Ry(k,h,z,v)}var _g="_reactListening"+Math.random().toString(36).slice(2);function jy(h){if(!h[_g]){h[_g]=!0,st.forEach(function(k){k!=="selectionchange"&&(Yb.has(k)||__(k,!1,h),__(k,!0,h))});var v=h.nodeType===9?h:h.ownerDocument;v===null||v[_g]||(v[_g]=!0,__("selectionchange",!1,v))}}function Ry(h,v,k,z){switch(P_(v)){case 2:var q=Jy;break;case 8:q=Hx;break;default:q=A_}k=q.bind(null,v,k,h),q=void 0,!pc||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(q=!0),z?q!==void 0?h.addEventListener(v,k,{capture:!0,passive:q}):h.addEventListener(v,k,!0):q!==void 0?h.addEventListener(v,k,{passive:q}):h.addEventListener(v,k,!1)}function Ly(h,v,k,z,q){var Q=z;if((v&1)===0&&(v&2)===0&&z!==null)e:for(;;){if(z===null)return;var Te=z.tag;if(Te===3||Te===4){var Ve=z.stateNode.containerInfo;if(Ve===q)break;if(Te===4)for(Te=z.return;Te!==null;){var ut=Te.tag;if((ut===3||ut===4)&&Te.stateNode.containerInfo===q)return;Te=Te.return}for(;Ve!==null;){if(Te=ue(Ve),Te===null)return;if(ut=Te.tag,ut===5||ut===6||ut===26||ut===27){z=Q=Te;continue e}Ve=Ve.parentNode}}z=z.return}Ys(function(){var ti=Q,xi=Xs(k),Ci=[];e:{var ri=xc.get(h);if(ri!==void 0){var oi=Ju,ya=h;switch(h){case"keypress":if(ls(k)===0)break e;case"keydown":case"keyup":oi=ed;break;case"focusin":ya="focus",oi=_c;break;case"focusout":ya="blur",oi=_c;break;case"beforeblur":case"afterblur":oi=_c;break;case"click":if(k.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":oi=wo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":oi=Tf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":oi=_a;break;case Af:case xl:case ju:oi=Ah;break;case ld:oi=ac;break;case"scroll":case"scrollend":oi=Zc;break;case"wheel":oi=$d;break;case"copy":case"cut":case"paste":oi=Oo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":oi=zi;break;case"toggle":case"beforetoggle":oi=Ol}var Qn=(v&4)!==0,Or=!Qn&&(h==="scroll"||h==="scrollend"),Dt=Qn?ri!==null?ri+"Capture":null:ri;Qn=[];for(var Et=ti,Kt;Et!==null;){var Ei=Et;if(Kt=Ei.stateNode,Ei=Ei.tag,Ei!==5&&Ei!==26&&Ei!==27||Kt===null||Dt===null||(Ei=rr(Et,Dt),Ei!=null&&Qn.push(yg(Et,Ei,Kt))),Or)break;Et=Et.return}0<Qn.length&&(ri=new oi(ri,ya,null,k,xi),Ci.push({event:ri,listeners:Qn}))}}if((v&7)===0){e:{if(ri=h==="mouseover"||h==="pointerover",oi=h==="mouseout"||h==="pointerout",ri&&k!==vo&&(ya=k.relatedTarget||k.fromElement)&&(ue(ya)||ya[ui]))break e;if((oi||ri)&&(ri=xi.window===xi?xi:(ri=xi.ownerDocument)?ri.defaultView||ri.parentWindow:window,oi?(ya=k.relatedTarget||k.toElement,oi=ti,ya=ya?ue(ya):null,ya!==null&&(Or=y(ya),Qn=ya.tag,ya!==Or||Qn!==5&&Qn!==27&&Qn!==6)&&(ya=null)):(oi=null,ya=ti),oi!==ya)){if(Qn=wo,Ei="onMouseLeave",Dt="onMouseEnter",Et="mouse",(h==="pointerout"||h==="pointerover")&&(Qn=zi,Ei="onPointerLeave",Dt="onPointerEnter",Et="pointer"),Or=oi==null?ri:Fe(oi),Kt=ya==null?ri:Fe(ya),ri=new Qn(Ei,Et+"leave",oi,k,xi),ri.target=Or,ri.relatedTarget=Kt,Ei=null,ue(xi)===ti&&(Qn=new Qn(Dt,Et+"enter",ya,k,xi),Qn.target=Kt,Qn.relatedTarget=Or,Ei=Qn),Or=Ei,oi&&ya)t:{for(Qn=oi,Dt=ya,Et=0,Kt=Qn;Kt;Kt=dm(Kt))Et++;for(Kt=0,Ei=Dt;Ei;Ei=dm(Ei))Kt++;for(;0<Et-Kt;)Qn=dm(Qn),Et--;for(;0<Kt-Et;)Dt=dm(Dt),Kt--;for(;Et--;){if(Qn===Dt||Dt!==null&&Qn===Dt.alternate)break t;Qn=dm(Qn),Dt=dm(Dt)}Qn=null}else Qn=null;oi!==null&&Iy(Ci,ri,oi,Qn,!1),ya!==null&&Or!==null&&Iy(Ci,Or,ya,Qn,!0)}}e:{if(ri=ti?Fe(ti):window,oi=ri.nodeName&&ri.nodeName.toLowerCase(),oi==="select"||oi==="input"&&ri.type==="file")var zn=lo;else if(pl(ri))if(gl)zn=Ef;else{zn=en;var Ka=ad}else oi=ri.nodeName,!oi||oi.toLowerCase()!=="input"||ri.type!=="checkbox"&&ri.type!=="radio"?ti&&mc(ti.elementType)&&(zn=lo):zn=Is;if(zn&&(zn=zn(h,ti))){Gr(Ci,zn,k,xi);break e}Ka&&Ka(h,ri,ti),h==="focusout"&&ti&&ri.type==="number"&&ti.memoizedProps.value!=null&&Qr(ri,"number",ri.value)}switch(Ka=ti?Fe(ti):window,h){case"focusin":(pl(Ka)||Ka.contentEditable==="true")&&(To=Ka,sd=ti,vl=null);break;case"focusout":vl=sd=To=null;break;case"mousedown":Jc=!0;break;case"contextmenu":case"mouseup":case"dragend":Jc=!1,od(Ci,k,xi);break;case"selectionchange":if(So)break;case"keydown":case"keyup":od(Ci,k,xi)}var Bn;if(lr)e:{switch(h){case"compositionstart":var sa="onCompositionStart";break e;case"compositionend":sa="onCompositionEnd";break e;case"compositionupdate":sa="onCompositionUpdate";break e}sa=void 0}else cs?id(h,k)&&(sa="onCompositionEnd"):h==="keydown"&&k.keyCode===229&&(sa="onCompositionStart");sa&&(Vd&&k.locale!=="ko"&&(cs||sa!=="onCompositionStart"?sa==="onCompositionEnd"&&cs&&(Bn=Ku()):(Qo=xi,bo="value"in Qo?Qo.value:Qo.textContent,cs=!0)),Ka=vg(ti,sa),0<Ka.length&&(sa=new fl(sa,h,null,k,xi),Ci.push({event:sa,listeners:Ka}),Bn?sa.data=Bn:(Bn=Hd(k),Bn!==null&&(sa.data=Bn)))),(Bn=yc?rc(h,k):oo(h,k))&&(sa=vg(ti,"onBeforeInput"),0<sa.length&&(Ka=new fl("onBeforeInput","beforeinput",null,k,xi),Ci.push({event:Ka,listeners:sa}),Ka.data=Bn)),Px(Ci,h,ti,k,xi)}Rx(Ci,v)})}function yg(h,v,k){return{instance:h,listener:v,currentTarget:k}}function vg(h,v){for(var k=v+"Capture",z=[];h!==null;){var q=h,Q=q.stateNode;if(q=q.tag,q!==5&&q!==26&&q!==27||Q===null||(q=rr(h,k),q!=null&&z.unshift(yg(h,q,Q)),q=rr(h,v),q!=null&&z.push(yg(h,q,Q))),h.tag===3)return z;h=h.return}return[]}function dm(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5&&h.tag!==27);return h||null}function Iy(h,v,k,z,q){for(var Q=v._reactName,Te=[];k!==null&&k!==z;){var Ve=k,ut=Ve.alternate,ti=Ve.stateNode;if(Ve=Ve.tag,ut!==null&&ut===z)break;Ve!==5&&Ve!==26&&Ve!==27||ti===null||(ut=ti,q?(ti=rr(k,Q),ti!=null&&Te.unshift(yg(k,ti,ut))):q||(ti=rr(k,Q),ti!=null&&Te.push(yg(k,ti,ut)))),k=k.return}Te.length!==0&&h.push({event:v,listeners:Te})}var Lx=/\r\n?/g,Ix=/\u0000|\uFFFD/g;function zy(h){return(typeof h=="string"?h:""+h).replace(Lx,`
`).replace(Ix,"")}function Dy(h,v){return v=zy(v),zy(h)===v}function pp(){}function fr(h,v,k,z,q,Q){switch(k){case"children":typeof z=="string"?v==="body"||v==="textarea"&&z===""||yo(h,z):(typeof z=="number"||typeof z=="bigint")&&v!=="body"&&yo(h,""+z);break;case"className":rn(h,"class",z);break;case"tabIndex":rn(h,"tabindex",z);break;case"dir":case"role":case"viewBox":case"width":case"height":rn(h,k,z);break;case"style":fc(h,z,Q);break;case"data":if(v!=="object"){rn(h,"data",z);break}case"src":case"href":if(z===""&&(v!=="a"||k!=="href")){h.removeAttribute(k);break}if(z==null||typeof z=="function"||typeof z=="symbol"||typeof z=="boolean"){h.removeAttribute(k);break}z=ao(""+z),h.setAttribute(k,z);break;case"action":case"formAction":if(typeof z=="function"){h.setAttribute(k,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof Q=="function"&&(k==="formAction"?(v!=="input"&&fr(h,v,"name",q.name,q,null),fr(h,v,"formEncType",q.formEncType,q,null),fr(h,v,"formMethod",q.formMethod,q,null),fr(h,v,"formTarget",q.formTarget,q,null)):(fr(h,v,"encType",q.encType,q,null),fr(h,v,"method",q.method,q,null),fr(h,v,"target",q.target,q,null)));if(z==null||typeof z=="symbol"||typeof z=="boolean"){h.removeAttribute(k);break}z=ao(""+z),h.setAttribute(k,z);break;case"onClick":z!=null&&(h.onclick=pp);break;case"onScroll":z!=null&&sr("scroll",h);break;case"onScrollEnd":z!=null&&sr("scrollend",h);break;case"dangerouslySetInnerHTML":if(z!=null){if(typeof z!="object"||!("__html"in z))throw Error(u(61));if(k=z.__html,k!=null){if(q.children!=null)throw Error(u(60));h.innerHTML=k}}break;case"multiple":h.multiple=z&&typeof z!="function"&&typeof z!="symbol";break;case"muted":h.muted=z&&typeof z!="function"&&typeof z!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(z==null||typeof z=="function"||typeof z=="boolean"||typeof z=="symbol"){h.removeAttribute("xlink:href");break}k=ao(""+z),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",k);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":z!=null&&typeof z!="function"&&typeof z!="symbol"?h.setAttribute(k,""+z):h.removeAttribute(k);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":z&&typeof z!="function"&&typeof z!="symbol"?h.setAttribute(k,""):h.removeAttribute(k);break;case"capture":case"download":z===!0?h.setAttribute(k,""):z!==!1&&z!=null&&typeof z!="function"&&typeof z!="symbol"?h.setAttribute(k,z):h.removeAttribute(k);break;case"cols":case"rows":case"size":case"span":z!=null&&typeof z!="function"&&typeof z!="symbol"&&!isNaN(z)&&1<=z?h.setAttribute(k,z):h.removeAttribute(k);break;case"rowSpan":case"start":z==null||typeof z=="function"||typeof z=="symbol"||isNaN(z)?h.removeAttribute(k):h.setAttribute(k,z);break;case"popover":sr("beforetoggle",h),sr("toggle",h),tn(h,"popover",z);break;case"xlinkActuate":Xi(h,"http://www.w3.org/1999/xlink","xlink:actuate",z);break;case"xlinkArcrole":Xi(h,"http://www.w3.org/1999/xlink","xlink:arcrole",z);break;case"xlinkRole":Xi(h,"http://www.w3.org/1999/xlink","xlink:role",z);break;case"xlinkShow":Xi(h,"http://www.w3.org/1999/xlink","xlink:show",z);break;case"xlinkTitle":Xi(h,"http://www.w3.org/1999/xlink","xlink:title",z);break;case"xlinkType":Xi(h,"http://www.w3.org/1999/xlink","xlink:type",z);break;case"xmlBase":Xi(h,"http://www.w3.org/XML/1998/namespace","xml:base",z);break;case"xmlLang":Xi(h,"http://www.w3.org/XML/1998/namespace","xml:lang",z);break;case"xmlSpace":Xi(h,"http://www.w3.org/XML/1998/namespace","xml:space",z);break;case"is":tn(h,"is",z);break;case"innerText":case"textContent":break;default:(!(2<k.length)||k[0]!=="o"&&k[0]!=="O"||k[1]!=="n"&&k[1]!=="N")&&(k=hl.get(k)||k,tn(h,k,z))}}function Fs(h,v,k,z,q,Q){switch(k){case"style":fc(h,z,Q);break;case"dangerouslySetInnerHTML":if(z!=null){if(typeof z!="object"||!("__html"in z))throw Error(u(61));if(k=z.__html,k!=null){if(q.children!=null)throw Error(u(60));h.innerHTML=k}}break;case"children":typeof z=="string"?yo(h,z):(typeof z=="number"||typeof z=="bigint")&&yo(h,""+z);break;case"onScroll":z!=null&&sr("scroll",h);break;case"onScrollEnd":z!=null&&sr("scrollend",h);break;case"onClick":z!=null&&(h.onclick=pp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Je.hasOwnProperty(k))e:{if(k[0]==="o"&&k[1]==="n"&&(q=k.endsWith("Capture"),v=k.slice(2,q?k.length-7:void 0),Q=h[Ai]||null,Q=Q!=null?Q[k]:null,typeof Q=="function"&&h.removeEventListener(v,Q,q),typeof z=="function")){typeof Q!="function"&&Q!==null&&(k in h?h[k]=null:h.hasAttribute(k)&&h.removeAttribute(k)),h.addEventListener(v,z,q);break e}k in h?h[k]=z:z===!0?h.setAttribute(k,""):tn(h,k,z)}}}function Ho(h,v,k){switch(v){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":sr("error",h),sr("load",h);var z=!1,q=!1,Q;for(Q in k)if(k.hasOwnProperty(Q)){var Te=k[Q];if(Te!=null)switch(Q){case"src":z=!0;break;case"srcSet":q=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(u(137,v));default:fr(h,v,Q,Te,k,null)}}q&&fr(h,v,"srcSet",k.srcSet,k,null),z&&fr(h,v,"src",k.src,k,null);return;case"input":sr("invalid",h);var Ve=Q=Te=q=null,ut=null,ti=null;for(z in k)if(k.hasOwnProperty(z)){var xi=k[z];if(xi!=null)switch(z){case"name":q=xi;break;case"type":Te=xi;break;case"checked":ut=xi;break;case"defaultChecked":ti=xi;break;case"value":Q=xi;break;case"defaultValue":Ve=xi;break;case"children":case"dangerouslySetInnerHTML":if(xi!=null)throw Error(u(137,v));break;default:fr(h,v,z,xi,k,null)}}Lo(h,Q,Ve,ut,ti,Te,q,!1),Xa(h);return;case"select":sr("invalid",h),z=Te=Q=null;for(q in k)if(k.hasOwnProperty(q)&&(Ve=k[q],Ve!=null))switch(q){case"value":Q=Ve;break;case"defaultValue":Te=Ve;break;case"multiple":z=Ve;default:fr(h,v,q,Ve,k,null)}v=Q,k=Te,h.multiple=!!z,v!=null?os(h,!!z,v,!1):k!=null&&os(h,!!z,k,!0);return;case"textarea":sr("invalid",h),Q=q=z=null;for(Te in k)if(k.hasOwnProperty(Te)&&(Ve=k[Te],Ve!=null))switch(Te){case"value":z=Ve;break;case"defaultValue":q=Ve;break;case"children":Q=Ve;break;case"dangerouslySetInnerHTML":if(Ve!=null)throw Error(u(91));break;default:fr(h,v,Te,Ve,k,null)}Io(h,z,q,Q),Xa(h);return;case"option":for(ut in k)if(k.hasOwnProperty(ut)&&(z=k[ut],z!=null))switch(ut){case"selected":h.selected=z&&typeof z!="function"&&typeof z!="symbol";break;default:fr(h,v,ut,z,k,null)}return;case"dialog":sr("beforetoggle",h),sr("toggle",h),sr("cancel",h),sr("close",h);break;case"iframe":case"object":sr("load",h);break;case"video":case"audio":for(z=0;z<mp.length;z++)sr(mp[z],h);break;case"image":sr("error",h),sr("load",h);break;case"details":sr("toggle",h);break;case"embed":case"source":case"link":sr("error",h),sr("load",h);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ti in k)if(k.hasOwnProperty(ti)&&(z=k[ti],z!=null))switch(ti){case"children":case"dangerouslySetInnerHTML":throw Error(u(137,v));default:fr(h,v,ti,z,k,null)}return;default:if(mc(v)){for(xi in k)k.hasOwnProperty(xi)&&(z=k[xi],z!==void 0&&Fs(h,v,xi,z,k,void 0));return}}for(Ve in k)k.hasOwnProperty(Ve)&&(z=k[Ve],z!=null&&fr(h,v,Ve,z,k,null))}function xg(h,v,k,z){switch(v){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var q=null,Q=null,Te=null,Ve=null,ut=null,ti=null,xi=null;for(oi in k){var Ci=k[oi];if(k.hasOwnProperty(oi)&&Ci!=null)switch(oi){case"checked":break;case"value":break;case"defaultValue":ut=Ci;default:z.hasOwnProperty(oi)||fr(h,v,oi,null,z,Ci)}}for(var ri in z){var oi=z[ri];if(Ci=k[ri],z.hasOwnProperty(ri)&&(oi!=null||Ci!=null))switch(ri){case"type":Q=oi;break;case"name":q=oi;break;case"checked":ti=oi;break;case"defaultChecked":xi=oi;break;case"value":Te=oi;break;case"defaultValue":Ve=oi;break;case"children":case"dangerouslySetInnerHTML":if(oi!=null)throw Error(u(137,v));break;default:oi!==Ci&&fr(h,v,ri,oi,z,Ci)}}tr(h,Te,Ve,ut,ti,xi,Q,q);return;case"select":oi=Te=Ve=ri=null;for(Q in k)if(ut=k[Q],k.hasOwnProperty(Q)&&ut!=null)switch(Q){case"value":break;case"multiple":oi=ut;default:z.hasOwnProperty(Q)||fr(h,v,Q,null,z,ut)}for(q in z)if(Q=z[q],ut=k[q],z.hasOwnProperty(q)&&(Q!=null||ut!=null))switch(q){case"value":ri=Q;break;case"defaultValue":Ve=Q;break;case"multiple":Te=Q;default:Q!==ut&&fr(h,v,q,Q,z,ut)}v=Ve,k=Te,z=oi,ri!=null?os(h,!!k,ri,!1):!!z!=!!k&&(v!=null?os(h,!!k,v,!0):os(h,!!k,k?[]:"",!1));return;case"textarea":oi=ri=null;for(Ve in k)if(q=k[Ve],k.hasOwnProperty(Ve)&&q!=null&&!z.hasOwnProperty(Ve))switch(Ve){case"value":break;case"children":break;default:fr(h,v,Ve,null,z,q)}for(Te in z)if(q=z[Te],Q=k[Te],z.hasOwnProperty(Te)&&(q!=null||Q!=null))switch(Te){case"value":ri=q;break;case"defaultValue":oi=q;break;case"children":break;case"dangerouslySetInnerHTML":if(q!=null)throw Error(u(91));break;default:q!==Q&&fr(h,v,Te,q,z,Q)}Sa(h,ri,oi);return;case"option":for(var ya in k)if(ri=k[ya],k.hasOwnProperty(ya)&&ri!=null&&!z.hasOwnProperty(ya))switch(ya){case"selected":h.selected=!1;break;default:fr(h,v,ya,null,z,ri)}for(ut in z)if(ri=z[ut],oi=k[ut],z.hasOwnProperty(ut)&&ri!==oi&&(ri!=null||oi!=null))switch(ut){case"selected":h.selected=ri&&typeof ri!="function"&&typeof ri!="symbol";break;default:fr(h,v,ut,ri,z,oi)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qn in k)ri=k[Qn],k.hasOwnProperty(Qn)&&ri!=null&&!z.hasOwnProperty(Qn)&&fr(h,v,Qn,null,z,ri);for(ti in z)if(ri=z[ti],oi=k[ti],z.hasOwnProperty(ti)&&ri!==oi&&(ri!=null||oi!=null))switch(ti){case"children":case"dangerouslySetInnerHTML":if(ri!=null)throw Error(u(137,v));break;default:fr(h,v,ti,ri,z,oi)}return;default:if(mc(v)){for(var Or in k)ri=k[Or],k.hasOwnProperty(Or)&&ri!==void 0&&!z.hasOwnProperty(Or)&&Fs(h,v,Or,void 0,z,ri);for(xi in z)ri=z[xi],oi=k[xi],!z.hasOwnProperty(xi)||ri===oi||ri===void 0&&oi===void 0||Fs(h,v,xi,ri,z,oi);return}}for(var Dt in k)ri=k[Dt],k.hasOwnProperty(Dt)&&ri!=null&&!z.hasOwnProperty(Dt)&&fr(h,v,Dt,null,z,ri);for(Ci in z)ri=z[Ci],oi=k[Ci],!z.hasOwnProperty(Ci)||ri===oi||ri==null&&oi==null||fr(h,v,Ci,ri,z,oi)}var Oy=null,Ny=null;function y_(h){return h.nodeType===9?h:h.ownerDocument}function zx(h){switch(h){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hm(h,v){if(h===0)switch(v){case"svg":return 1;case"math":return 2;default:return 0}return h===1&&v==="foreignObject"?0:h}function v_(h,v){return h==="textarea"||h==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.children=="bigint"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var ch=null;function bg(){var h=window.event;return h&&h.type==="popstate"?h===ch?!1:(ch=h,!0):(ch=null,!1)}var Dx=typeof setTimeout=="function"?setTimeout:void 0,Kb=typeof clearTimeout=="function"?clearTimeout:void 0,Ox=typeof Promise=="function"?Promise:void 0,Jb=typeof queueMicrotask=="function"?queueMicrotask:typeof Ox<"u"?function(h){return Ox.resolve(null).then(h).catch(Qb)}:Dx;function Qb(h){setTimeout(function(){throw h})}function sf(h){return h==="head"}function Nx(h,v){var k=v,z=0,q=0;do{var Q=k.nextSibling;if(h.removeChild(k),Q&&Q.nodeType===8)if(k=Q.data,k==="/$"){if(0<z&&8>z){k=z;var Te=h.ownerDocument;if(k&1&&lf(Te.documentElement),k&2&&lf(Te.body),k&4)for(k=Te.head,lf(k),Te=k.firstChild;Te;){var Ve=Te.nextSibling,ut=Te.nodeName;Te[Xe]||ut==="SCRIPT"||ut==="STYLE"||ut==="LINK"&&Te.rel.toLowerCase()==="stylesheet"||k.removeChild(Te),Te=Ve}}if(q===0){h.removeChild(Q),pm(v);return}q--}else k==="$"||k==="$?"||k==="$!"?q++:z=k.charCodeAt(0)-48;else z=0;k=Q}while(k);pm(v)}function wg(h){var v=h.firstChild;for(v&&v.nodeType===10&&(v=v.nextSibling);v;){var k=v;switch(v=v.nextSibling,k.nodeName){case"HTML":case"HEAD":case"BODY":wg(k),ne(k);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(k.rel.toLowerCase()==="stylesheet")continue}h.removeChild(k)}}function ew(h,v,k,z){for(;h.nodeType===1;){var q=k;if(h.nodeName.toLowerCase()!==v.toLowerCase()){if(!z&&(h.nodeName!=="INPUT"||h.type!=="hidden"))break}else if(z){if(!h[Xe])switch(v){case"meta":if(!h.hasAttribute("itemprop"))break;return h;case"link":if(Q=h.getAttribute("rel"),Q==="stylesheet"&&h.hasAttribute("data-precedence"))break;if(Q!==q.rel||h.getAttribute("href")!==(q.href==null||q.href===""?null:q.href)||h.getAttribute("crossorigin")!==(q.crossOrigin==null?null:q.crossOrigin)||h.getAttribute("title")!==(q.title==null?null:q.title))break;return h;case"style":if(h.hasAttribute("data-precedence"))break;return h;case"script":if(Q=h.getAttribute("src"),(Q!==(q.src==null?null:q.src)||h.getAttribute("type")!==(q.type==null?null:q.type)||h.getAttribute("crossorigin")!==(q.crossOrigin==null?null:q.crossOrigin))&&Q&&h.hasAttribute("async")&&!h.hasAttribute("itemprop"))break;return h;default:return h}}else if(v==="input"&&h.type==="hidden"){var Q=q.name==null?null:""+q.name;if(q.type==="hidden"&&h.getAttribute("name")===Q)return h}else return h;if(h=wr(h.nextSibling),h===null)break}return null}function Fx(h,v,k){if(v==="")return null;for(;h.nodeType!==3;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!k||(h=wr(h.nextSibling),h===null))return null;return h}function fm(h){return h.data==="$!"||h.data==="$?"&&h.ownerDocument.readyState==="complete"}function tw(h,v){var k=h.ownerDocument;if(h.data!=="$?"||k.readyState==="complete")v();else{var z=function(){v(),k.removeEventListener("DOMContentLoaded",z)};k.addEventListener("DOMContentLoaded",z),h._reactRetry=z}}function wr(h){for(;h!=null;h=h.nextSibling){var v=h.nodeType;if(v===1||v===3)break;if(v===8){if(v=h.data,v==="$"||v==="$!"||v==="$?"||v==="F!"||v==="F")break;if(v==="/$")return null}}return h}var of=null;function Fy(h){h=h.previousSibling;for(var v=0;h;){if(h.nodeType===8){var k=h.data;if(k==="$"||k==="$!"||k==="$?"){if(v===0)return h;v--}else k==="/$"&&v++}h=h.previousSibling}return null}function Sg(h,v,k){switch(v=y_(k),h){case"html":if(h=v.documentElement,!h)throw Error(u(452));return h;case"head":if(h=v.head,!h)throw Error(u(453));return h;case"body":if(h=v.body,!h)throw Error(u(454));return h;default:throw Error(u(451))}}function lf(h){for(var v=h.attributes;v.length;)h.removeAttributeNode(v[0]);ne(h)}var Pl=new Map,By=new Set;function Tg(h){return typeof h.getRootNode=="function"?h.getRootNode():h.nodeType===9?h:h.ownerDocument}var Nc=wt.d;wt.d={f:Uy,r:kg,D:Vy,C:Hy,L:Bx,m:uh,X:Kl,S:iw,M:Ux};function Uy(){var h=Nc.f(),v=_n();return h||v}function kg(h){var v=ke(h);v!==null&&v.tag===5&&v.type==="form"?og(v):Nc.r(h)}var gp=typeof document>"u"?null:document;function $y(h,v,k){var z=gp;if(z&&typeof v=="string"&&v){var q=ss(v);q='link[rel="'+h+'"][href="'+q+'"]',typeof k=="string"&&(q+='[crossorigin="'+k+'"]'),By.has(q)||(By.add(q),h={rel:h,crossOrigin:k,href:v},z.querySelector(q)===null&&(v=z.createElement("link"),Ho(v,"link",h),Ze(v),z.head.appendChild(v)))}}function Vy(h){Nc.D(h),$y("dns-prefetch",h,null)}function Hy(h,v){Nc.C(h,v),$y("preconnect",h,v)}function Bx(h,v,k){Nc.L(h,v,k);var z=gp;if(z&&h&&v){var q='link[rel="preload"][as="'+ss(v)+'"]';v==="image"&&k&&k.imageSrcSet?(q+='[imagesrcset="'+ss(k.imageSrcSet)+'"]',typeof k.imageSizes=="string"&&(q+='[imagesizes="'+ss(k.imageSizes)+'"]')):q+='[href="'+ss(h)+'"]';var Q=q;switch(v){case"style":Q=mm(h);break;case"script":Q=uf(h)}Pl.has(Q)||(h=D({rel:"preload",href:v==="image"&&k&&k.imageSrcSet?void 0:h,as:v},k),Pl.set(Q,h),z.querySelector(q)!==null||v==="style"&&z.querySelector(cf(Q))||v==="script"&&z.querySelector(_p(Q))||(v=z.createElement("link"),Ho(v,"link",h),Ze(v),z.head.appendChild(v)))}}function uh(h,v){Nc.m(h,v);var k=gp;if(k&&h){var z=v&&typeof v.as=="string"?v.as:"script",q='link[rel="modulepreload"][as="'+ss(z)+'"][href="'+ss(h)+'"]',Q=q;switch(z){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":Q=uf(h)}if(!Pl.has(Q)&&(h=D({rel:"modulepreload",href:h},v),Pl.set(Q,h),k.querySelector(q)===null)){switch(z){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(k.querySelector(_p(Q)))return}z=k.createElement("link"),Ho(z,"link",h),Ze(z),k.head.appendChild(z)}}}function iw(h,v,k){Nc.S(h,v,k);var z=gp;if(z&&h){var q=Ue(z).hoistableStyles,Q=mm(h);v=v||"default";var Te=q.get(Q);if(!Te){var Ve={loading:0,preload:null};if(Te=z.querySelector(cf(Q)))Ve.loading=5;else{h=D({rel:"stylesheet",href:h,"data-precedence":v},k),(k=Pl.get(Q))&&b_(h,k);var ut=Te=z.createElement("link");Ze(ut),Ho(ut,"link",h),ut._p=new Promise(function(ti,xi){ut.onload=ti,ut.onerror=xi}),ut.addEventListener("load",function(){Ve.loading|=1}),ut.addEventListener("error",function(){Ve.loading|=2}),Ve.loading|=4,yp(Te,v,z)}Te={type:"stylesheet",instance:Te,count:1,state:Ve},q.set(Q,Te)}}}function Kl(h,v){Nc.X(h,v);var k=gp;if(k&&h){var z=Ue(k).hoistableScripts,q=uf(h),Q=z.get(q);Q||(Q=k.querySelector(_p(q)),Q||(h=D({src:h,async:!0},v),(v=Pl.get(q))&&w_(h,v),Q=k.createElement("script"),Ze(Q),Ho(Q,"link",h),k.head.appendChild(Q)),Q={type:"script",instance:Q,count:1,state:null},z.set(q,Q))}}function Ux(h,v){Nc.M(h,v);var k=gp;if(k&&h){var z=Ue(k).hoistableScripts,q=uf(h),Q=z.get(q);Q||(Q=k.querySelector(_p(q)),Q||(h=D({src:h,async:!0,type:"module"},v),(v=Pl.get(q))&&w_(h,v),Q=k.createElement("script"),Ze(Q),Ho(Q,"link",h),k.head.appendChild(Q)),Q={type:"script",instance:Q,count:1,state:null},z.set(q,Q))}}function Gy(h,v,k,z){var q=(q=Xt.current)?Tg(q):null;if(!q)throw Error(u(446));switch(h){case"meta":case"title":return null;case"style":return typeof k.precedence=="string"&&typeof k.href=="string"?(v=mm(k.href),k=Ue(q).hoistableStyles,z=k.get(v),z||(z={type:"style",instance:null,count:0,state:null},k.set(v,z)),z):{type:"void",instance:null,count:0,state:null};case"link":if(k.rel==="stylesheet"&&typeof k.href=="string"&&typeof k.precedence=="string"){h=mm(k.href);var Q=Ue(q).hoistableStyles,Te=Q.get(h);if(Te||(q=q.ownerDocument||q,Te={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},Q.set(h,Te),(Q=q.querySelector(cf(h)))&&!Q._p&&(Te.instance=Q,Te.state.loading=5),Pl.has(h)||(k={rel:"preload",as:"style",href:k.href,crossOrigin:k.crossOrigin,integrity:k.integrity,media:k.media,hrefLang:k.hrefLang,referrerPolicy:k.referrerPolicy},Pl.set(h,k),Q||nw(q,h,k,Te.state))),v&&z===null)throw Error(u(528,""));return Te}if(v&&z!==null)throw Error(u(529,""));return null;case"script":return v=k.async,k=k.src,typeof k=="string"&&v&&typeof v!="function"&&typeof v!="symbol"?(v=uf(k),k=Ue(q).hoistableScripts,z=k.get(v),z||(z={type:"script",instance:null,count:0,state:null},k.set(v,z)),z):{type:"void",instance:null,count:0,state:null};default:throw Error(u(444,h))}}function mm(h){return'href="'+ss(h)+'"'}function cf(h){return'link[rel="stylesheet"]['+h+"]"}function $x(h){return D({},h,{"data-precedence":h.precedence,precedence:null})}function nw(h,v,k,z){h.querySelector('link[rel="preload"][as="style"]['+v+"]")?z.loading=1:(v=h.createElement("link"),z.preload=v,v.addEventListener("load",function(){return z.loading|=1}),v.addEventListener("error",function(){return z.loading|=2}),Ho(v,"link",k),Ze(v),h.head.appendChild(v))}function uf(h){return'[src="'+ss(h)+'"]'}function _p(h){return"script[async]"+h}function x_(h,v,k){if(v.count++,v.instance===null)switch(v.type){case"style":var z=h.querySelector('style[data-href~="'+ss(k.href)+'"]');if(z)return v.instance=z,Ze(z),z;var q=D({},k,{"data-href":k.href,"data-precedence":k.precedence,href:null,precedence:null});return z=(h.ownerDocument||h).createElement("style"),Ze(z),Ho(z,"style",q),yp(z,k.precedence,h),v.instance=z;case"stylesheet":q=mm(k.href);var Q=h.querySelector(cf(q));if(Q)return v.state.loading|=4,v.instance=Q,Ze(Q),Q;z=$x(k),(q=Pl.get(q))&&b_(z,q),Q=(h.ownerDocument||h).createElement("link"),Ze(Q);var Te=Q;return Te._p=new Promise(function(Ve,ut){Te.onload=Ve,Te.onerror=ut}),Ho(Q,"link",z),v.state.loading|=4,yp(Q,k.precedence,h),v.instance=Q;case"script":return Q=uf(k.src),(q=h.querySelector(_p(Q)))?(v.instance=q,Ze(q),q):(z=k,(q=Pl.get(Q))&&(z=D({},k),w_(z,q)),h=h.ownerDocument||h,q=h.createElement("script"),Ze(q),Ho(q,"link",z),h.head.appendChild(q),v.instance=q);case"void":return null;default:throw Error(u(443,v.type))}else v.type==="stylesheet"&&(v.state.loading&4)===0&&(z=v.instance,v.state.loading|=4,yp(z,k.precedence,h));return v.instance}function yp(h,v,k){for(var z=k.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),q=z.length?z[z.length-1]:null,Q=q,Te=0;Te<z.length;Te++){var Ve=z[Te];if(Ve.dataset.precedence===v)Q=Ve;else if(Q!==q)break}Q?Q.parentNode.insertBefore(h,Q.nextSibling):(v=k.nodeType===9?k.head:k,v.insertBefore(h,v.firstChild))}function b_(h,v){h.crossOrigin==null&&(h.crossOrigin=v.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=v.referrerPolicy),h.title==null&&(h.title=v.title)}function w_(h,v){h.crossOrigin==null&&(h.crossOrigin=v.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=v.referrerPolicy),h.integrity==null&&(h.integrity=v.integrity)}var Eg=null;function qy(h,v,k){if(Eg===null){var z=new Map,q=Eg=new Map;q.set(k,z)}else q=Eg,z=q.get(k),z||(z=new Map,q.set(k,z));if(z.has(h))return z;for(z.set(h,null),k=k.getElementsByTagName(h),q=0;q<k.length;q++){var Q=k[q];if(!(Q[Xe]||Q[ii]||h==="link"&&Q.getAttribute("rel")==="stylesheet")&&Q.namespaceURI!=="http://www.w3.org/2000/svg"){var Te=Q.getAttribute(v)||"";Te=h+Te;var Ve=z.get(Te);Ve?Ve.push(Q):z.set(Te,[Q])}}return z}function Ag(h,v,k){h=h.ownerDocument||h,h.head.insertBefore(k,v==="title"?h.querySelector("head > title"):null)}function Rd(h,v,k){if(k===1||v.itemProp!=null)return!1;switch(h){case"meta":case"title":return!0;case"style":if(typeof v.precedence!="string"||typeof v.href!="string"||v.href==="")break;return!0;case"link":if(typeof v.rel!="string"||typeof v.href!="string"||v.href===""||v.onLoad||v.onError)break;switch(v.rel){case"stylesheet":return h=v.disabled,typeof v.precedence=="string"&&h==null;default:return!0}case"script":if(v.async&&typeof v.async!="function"&&typeof v.async!="symbol"&&!v.onLoad&&!v.onError&&v.src&&typeof v.src=="string")return!0}return!1}function Wy(h){return!(h.type==="stylesheet"&&(h.state.loading&3)===0)}var Cg=null;function aw(){}function rw(h,v,k){if(Cg===null)throw Error(u(475));var z=Cg;if(v.type==="stylesheet"&&(typeof k.media!="string"||matchMedia(k.media).matches!==!1)&&(v.state.loading&4)===0){if(v.instance===null){var q=mm(k.href),Q=h.querySelector(cf(q));if(Q){h=Q._p,h!==null&&typeof h=="object"&&typeof h.then=="function"&&(z.count++,z=S_.bind(z),h.then(z,z)),v.state.loading|=4,v.instance=Q,Ze(Q);return}Q=h.ownerDocument||h,k=$x(k),(q=Pl.get(q))&&b_(k,q),Q=Q.createElement("link"),Ze(Q);var Te=Q;Te._p=new Promise(function(Ve,ut){Te.onload=Ve,Te.onerror=ut}),Ho(Q,"link",k),v.instance=Q}z.stylesheets===null&&(z.stylesheets=new Map),z.stylesheets.set(v,h),(h=v.state.preload)&&(v.state.loading&3)===0&&(z.count++,v=S_.bind(z),h.addEventListener("load",v),h.addEventListener("error",v))}}function sw(){if(Cg===null)throw Error(u(475));var h=Cg;return h.stylesheets&&h.count===0&&Zy(h,h.stylesheets),0<h.count?function(v){var k=setTimeout(function(){if(h.stylesheets&&Zy(h,h.stylesheets),h.unsuspend){var z=h.unsuspend;h.unsuspend=null,z()}},6e4);return h.unsuspend=v,function(){h.unsuspend=null,clearTimeout(k)}}:null}function S_(){if(this.count--,this.count===0){if(this.stylesheets)Zy(this,this.stylesheets);else if(this.unsuspend){var h=this.unsuspend;this.unsuspend=null,h()}}}var T_=null;function Zy(h,v){h.stylesheets=null,h.unsuspend!==null&&(h.count++,T_=new Map,v.forEach(ow,h),T_=null,S_.call(h))}function ow(h,v){if(!(v.state.loading&4)){var k=T_.get(h);if(k)var z=k.get(null);else{k=new Map,T_.set(h,k);for(var q=h.querySelectorAll("link[data-precedence],style[data-precedence]"),Q=0;Q<q.length;Q++){var Te=q[Q];(Te.nodeName==="LINK"||Te.getAttribute("media")!=="not all")&&(k.set(Te.dataset.precedence,Te),z=Te)}z&&k.set(null,z)}q=v.instance,Te=q.getAttribute("data-precedence"),Q=k.get(Te)||z,Q===z&&k.set(null,q),k.set(Te,q),this.count++,z=S_.bind(this),q.addEventListener("load",z),q.addEventListener("error",z),Q?Q.parentNode.insertBefore(q,Q.nextSibling):(h=h.nodeType===9?h.head:h,h.insertBefore(q,h.firstChild)),v.state.loading|=4}}var dh={$$typeof:be,Provider:null,Consumer:null,_currentValue:Ct,_currentValue2:Ct,_threadCount:0};function Vx(h,v,k,z,q,Q,Te,Ve){this.tag=1,this.containerInfo=h,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=tc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tc(0),this.hiddenUpdates=tc(null),this.identifierPrefix=z,this.onUncaughtError=q,this.onCaughtError=Q,this.onRecoverableError=Te,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ve,this.incompleteTransitions=new Map}function Xy(h,v,k,z,q,Q,Te,Ve,ut,ti,xi,Ci){return h=new Vx(h,v,k,Te,Ve,ut,ti,Ci),v=1,Q===!0&&(v|=24),Q=ts(3,null,null,v),h.current=Q,Q.stateNode=h,v=Ih(),v.refCount++,h.pooledCache=v,v.refCount++,Q.memoizedState={element:z,isDehydrated:k,cache:v},Nh(Q),h}function Mg(h){return h?(h=bc,h):bc}function Yy(h,v,k,z,q,Q){q=Mg(q),z.context===null?z.context=q:z.pendingContext=q,z=Nu(v),z.payload={element:k},Q=Q===void 0?null:Q,Q!==null&&(z.callback=Q),k=$l(h,z,v),k!==null&&(Zi(k,h,v),Xd(k,h,v))}function k_(h,v){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var k=h.retryLane;h.retryLane=k!==0&&k<v?k:v}}function vp(h,v){k_(h,v),(h=h.alternate)&&k_(h,v)}function Ky(h){if(h.tag===13){var v=au(h,67108864);v!==null&&Zi(v,h,67108864),vp(h,67108864)}}var E_=!0;function Jy(h,v,k,z){var q=qe.T;qe.T=null;var Q=wt.p;try{wt.p=2,A_(h,v,k,z)}finally{wt.p=Q,qe.T=q}}function Hx(h,v,k,z){var q=qe.T;qe.T=null;var Q=wt.p;try{wt.p=8,A_(h,v,k,z)}finally{wt.p=Q,qe.T=q}}function A_(h,v,k,z){if(E_){var q=C_(z);if(q===null)Ly(h,v,z,xp,k),wp(h,z);else if(j_(q,h,v,k,z))z.stopPropagation();else if(wp(h,z),v&4&&-1<Gx.indexOf(h)){for(;q!==null;){var Q=ke(q);if(Q!==null)switch(Q.tag){case 3:if(Q=Q.stateNode,Q.current.memoizedState.isDehydrated){var Te=Ir(Q.pendingLanes);if(Te!==0){var Ve=Q;for(Ve.pendingLanes|=2,Ve.entangledLanes|=2;Te;){var ut=1<<31-pr(Te);Ve.entanglements[1]|=ut,Te&=~ut}mo(Q),(_e&6)===0&&(ai=Tn()+500,dp(0))}}break;case 13:Ve=au(Q,2),Ve!==null&&Zi(Ve,Q,2),_n(),vp(Q,2)}if(Q=C_(z),Q===null&&Ly(h,v,z,xp,k),Q===q)break;q=Q}q!==null&&z.stopPropagation()}else Ly(h,v,z,null,k)}}function C_(h){return h=Xs(h),M_(h)}var xp=null;function M_(h){if(xp=null,h=ue(h),h!==null){var v=y(h);if(v===null)h=null;else{var k=v.tag;if(k===13){if(h=w(v),h!==null)return h;h=null}else if(k===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;h=null}else v!==h&&(h=null)}}return xp=h,null}function P_(h){switch(h){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Da()){case Hc:return 2;case Xo:return 8;case Hs:case ws:return 32;case Gs:return 268435456;default:return 32}default:return 32}}var Qy=!1,df=null,hf=null,ff=null,bp=new Map,Fc=new Map,hh=[],Gx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function wp(h,v){switch(h){case"focusin":case"focusout":df=null;break;case"dragenter":case"dragleave":hf=null;break;case"mouseover":case"mouseout":ff=null;break;case"pointerover":case"pointerout":bp.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fc.delete(v.pointerId)}}function fh(h,v,k,z,q,Q){return h===null||h.nativeEvent!==Q?(h={blockedOn:v,domEventName:k,eventSystemFlags:z,nativeEvent:Q,targetContainers:[q]},v!==null&&(v=ke(v),v!==null&&Ky(v)),h):(h.eventSystemFlags|=z,v=h.targetContainers,q!==null&&v.indexOf(q)===-1&&v.push(q),h)}function j_(h,v,k,z,q){switch(v){case"focusin":return df=fh(df,h,v,k,z,q),!0;case"dragenter":return hf=fh(hf,h,v,k,z,q),!0;case"mouseover":return ff=fh(ff,h,v,k,z,q),!0;case"pointerover":var Q=q.pointerId;return bp.set(Q,fh(bp.get(Q)||null,h,v,k,z,q)),!0;case"gotpointercapture":return Q=q.pointerId,Fc.set(Q,fh(Fc.get(Q)||null,h,v,k,z,q)),!0}return!1}function Sp(h){var v=ue(h.target);if(v!==null){var k=y(v);if(k!==null){if(v=k.tag,v===13){if(v=w(k),v!==null){h.blockedOn=v,Me(h.priority,function(){if(k.tag===13){var z=Si();z=Ro(z);var q=au(k,z);q!==null&&Zi(q,k,z),vp(k,z)}});return}}else if(v===3&&k.stateNode.current.memoizedState.isDehydrated){h.blockedOn=k.tag===3?k.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Pg(h){if(h.blockedOn!==null)return!1;for(var v=h.targetContainers;0<v.length;){var k=C_(h.nativeEvent);if(k===null){k=h.nativeEvent;var z=new k.constructor(k.type,k);vo=z,k.target.dispatchEvent(z),vo=null}else return v=ke(k),v!==null&&Ky(v),h.blockedOn=k,!1;v.shift()}return!0}function ev(h,v,k){Pg(h)&&k.delete(v)}function qx(){Qy=!1,df!==null&&Pg(df)&&(df=null),hf!==null&&Pg(hf)&&(hf=null),ff!==null&&Pg(ff)&&(ff=null),bp.forEach(ev),Fc.forEach(ev)}function jg(h,v){h.blockedOn===v&&(h.blockedOn=null,Qy||(Qy=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,qx)))}var R_=null;function Wx(h){R_!==h&&(R_=h,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){R_===h&&(R_=null);for(var v=0;v<h.length;v+=3){var k=h[v],z=h[v+1],q=h[v+2];if(typeof z!="function"){if(M_(z||k)===null)continue;break}var Q=ke(k);Q!==null&&(h.splice(v,3),v-=3,sg(Q,{pending:!0,data:q,method:k.method,action:z},z,q))}}))}function pm(h){function v(ut){return jg(ut,h)}df!==null&&jg(df,h),hf!==null&&jg(hf,h),ff!==null&&jg(ff,h),bp.forEach(v),Fc.forEach(v);for(var k=0;k<hh.length;k++){var z=hh[k];z.blockedOn===h&&(z.blockedOn=null)}for(;0<hh.length&&(k=hh[0],k.blockedOn===null);)Sp(k),k.blockedOn===null&&hh.shift();if(k=(h.ownerDocument||h).$$reactFormReplay,k!=null)for(z=0;z<k.length;z+=3){var q=k[z],Q=k[z+1],Te=q[Ai]||null;if(typeof Q=="function")Te||Wx(k);else if(Te){var Ve=null;if(Q&&Q.hasAttribute("formAction")){if(q=Q,Te=Q[Ai]||null)Ve=Te.formAction;else if(M_(q)!==null)continue}else Ve=Te.action;typeof Ve=="function"?k[z+1]=Ve:(k.splice(z,3),z-=3),Wx(k)}}}function Tp(h){this._internalRoot=h}Rg.prototype.render=Tp.prototype.render=function(h){var v=this._internalRoot;if(v===null)throw Error(u(409));var k=v.current,z=Si();Yy(k,z,h,v,null,null)},Rg.prototype.unmount=Tp.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var v=h.containerInfo;Yy(h.current,2,null,h,null,null),_n(),v[ui]=null}};function Rg(h){this._internalRoot=h}Rg.prototype.unstable_scheduleHydration=function(h){if(h){var v=ku();h={blockedOn:null,target:h,priority:v};for(var k=0;k<hh.length&&v!==0&&v<hh[k].priority;k++);hh.splice(k,0,h),k===0&&Sp(h)}};var Zx=a.version;if(Zx!=="19.1.1")throw Error(u(527,Zx,"19.1.1"));wt.findDOMNode=function(h){var v=h._reactInternals;if(v===void 0)throw typeof h.render=="function"?Error(u(188)):(h=Object.keys(h).join(","),Error(u(268,h)));return h=C(v),h=h!==null?P(h):null,h=h===null?null:h.stateNode,h};var Xx={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:qe,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kp.isDisabled&&kp.supportsFiber)try{Jr=kp.inject(Xx),er=kp}catch{}}return jv.createRoot=function(h,v){if(!f(h))throw Error(u(299));var k=!1,z="",q=Qf,Q=Qm,Te=Zr,Ve=null;return v!=null&&(v.unstable_strictMode===!0&&(k=!0),v.identifierPrefix!==void 0&&(z=v.identifierPrefix),v.onUncaughtError!==void 0&&(q=v.onUncaughtError),v.onCaughtError!==void 0&&(Q=v.onCaughtError),v.onRecoverableError!==void 0&&(Te=v.onRecoverableError),v.unstable_transitionCallbacks!==void 0&&(Ve=v.unstable_transitionCallbacks)),v=Xy(h,1,!1,null,null,k,z,q,Q,Te,Ve,null),h[ui]=v.current,jy(h),new Tp(v)},jv.hydrateRoot=function(h,v,k){if(!f(h))throw Error(u(299));var z=!1,q="",Q=Qf,Te=Qm,Ve=Zr,ut=null,ti=null;return k!=null&&(k.unstable_strictMode===!0&&(z=!0),k.identifierPrefix!==void 0&&(q=k.identifierPrefix),k.onUncaughtError!==void 0&&(Q=k.onUncaughtError),k.onCaughtError!==void 0&&(Te=k.onCaughtError),k.onRecoverableError!==void 0&&(Ve=k.onRecoverableError),k.unstable_transitionCallbacks!==void 0&&(ut=k.unstable_transitionCallbacks),k.formState!==void 0&&(ti=k.formState)),v=Xy(h,1,!0,v,k??null,z,q,Q,Te,Ve,ut,ti),v.context=Mg(null),k=v.current,z=Si(),z=Ro(z),q=Nu(z),q.callback=null,$l(k,q,z),k=z,v.current.lanes=k,go(v,k),mo(v),h[ui]=v.current,jy(h),new Rg(v)},jv.version="19.1.1",jv}var rE;function ez(){if(rE)return c1.exports;rE=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(a){console.error(a)}}return s(),c1.exports=QI(),c1.exports}var tz=ez();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var fM=s=>{throw TypeError(s)},iz=(s,a,l)=>a.has(s)||fM("Cannot "+l),f1=(s,a,l)=>(iz(s,a,"read from private field"),l?l.call(s):a.get(s)),nz=(s,a,l)=>a.has(s)?fM("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(s):a.set(s,l),sE="popstate";function az(s={}){function a(u,f){let{pathname:y,search:w,hash:i}=u.location;return sx("",{pathname:y,search:w,hash:i},f.state&&f.state.usr||null,f.state&&f.state.key||"default")}function l(u,f){return typeof f=="string"?f:Gp(f)}return sz(a,l,null,s)}function ar(s,a){if(s===!1||s===null||typeof s>"u")throw new Error(a)}function Wo(s,a){if(!s){typeof console<"u"&&console.warn(a);try{throw new Error(a)}catch{}}}function rz(){return Math.random().toString(36).substring(2,10)}function oE(s,a){return{usr:s.state,key:s.key,idx:a}}function sx(s,a,l=null,u){return{pathname:typeof s=="string"?s:s.pathname,search:"",hash:"",...typeof a=="string"?Zp(a):a,state:l,key:a&&a.key||u||rz()}}function Gp({pathname:s="/",search:a="",hash:l=""}){return a&&a!=="?"&&(s+=a.charAt(0)==="?"?a:"?"+a),l&&l!=="#"&&(s+=l.charAt(0)==="#"?l:"#"+l),s}function Zp(s){let a={};if(s){let l=s.indexOf("#");l>=0&&(a.hash=s.substring(l),s=s.substring(0,l));let u=s.indexOf("?");u>=0&&(a.search=s.substring(u),s=s.substring(0,u)),s&&(a.pathname=s)}return a}function sz(s,a,l,u={}){let{window:f=document.defaultView,v5Compat:y=!1}=u,w=f.history,i="POP",C=null,P=D();P==null&&(P=0,w.replaceState({...w.state,idx:P},""));function D(){return(w.state||{idx:null}).idx}function $(){i="POP";let re=D(),fe=re==null?null:re-P;P=re,C&&C({action:i,location:le.location,delta:fe})}function G(re,fe){i="PUSH";let xe=sx(le.location,re,fe);P=D()+1;let be=oE(xe,P),Ne=le.createHref(xe);try{w.pushState(be,"",Ne)}catch(Be){if(Be instanceof DOMException&&Be.name==="DataCloneError")throw Be;f.location.assign(Ne)}y&&C&&C({action:i,location:le.location,delta:1})}function X(re,fe){i="REPLACE";let xe=sx(le.location,re,fe);P=D();let be=oE(xe,P),Ne=le.createHref(xe);w.replaceState(be,"",Ne),y&&C&&C({action:i,location:le.location,delta:0})}function te(re){return mM(re)}let le={get action(){return i},get location(){return s(f,w)},listen(re){if(C)throw new Error("A history only accepts one active listener");return f.addEventListener(sE,$),C=re,()=>{f.removeEventListener(sE,$),C=null}},createHref(re){return a(f,re)},createURL:te,encodeLocation(re){let fe=te(re);return{pathname:fe.pathname,search:fe.search,hash:fe.hash}},push:G,replace:X,go(re){return w.go(re)}};return le}function mM(s,a=!1){let l="http://localhost";typeof window<"u"&&(l=window.location.origin!=="null"?window.location.origin:window.location.href),ar(l,"No window.location.(origin|href) available to create URL");let u=typeof s=="string"?s:Gp(s);return u=u.replace(/ $/,"%20"),!a&&u.startsWith("//")&&(u=l+u),new URL(u,l)}var qv,lE=class{constructor(s){if(nz(this,qv,new Map),s)for(let[a,l]of s)this.set(a,l)}get(s){if(f1(this,qv).has(s))return f1(this,qv).get(s);if(s.defaultValue!==void 0)return s.defaultValue;throw new Error("No value found for context")}set(s,a){f1(this,qv).set(s,a)}};qv=new WeakMap;var oz=new Set(["lazy","caseSensitive","path","id","index","children"]);function lz(s){return oz.has(s)}var cz=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function uz(s){return cz.has(s)}function dz(s){return s.index===!0}function ox(s,a,l=[],u={},f=!1){return s.map((y,w)=>{let i=[...l,String(w)],C=typeof y.id=="string"?y.id:i.join("-");if(ar(y.index!==!0||!y.children,"Cannot specify children on an index route"),ar(f||!u[C],`Found a route id collision on id "${C}".  Route id's must be globally unique within Data Router usages`),dz(y)){let P={...y,...a(y),id:C};return u[C]=P,P}else{let P={...y,...a(y),id:C,children:void 0};return u[C]=P,y.children&&(P.children=ox(y.children,a,i,u,f)),P}})}function Ip(s,a,l="/"){return cb(s,a,l,!1)}function cb(s,a,l,u){let f=typeof a=="string"?Zp(a):a,y=Nd(f.pathname||"/",l);if(y==null)return null;let w=pM(s);fz(w);let i=null;for(let C=0;i==null&&C<w.length;++C){let P=Tz(y);i=wz(w[C],P,u)}return i}function hz(s,a){let{route:l,pathname:u,params:f}=s;return{id:l.id,pathname:u,params:f,data:a[l.id],loaderData:a[l.id],handle:l.handle}}function pM(s,a=[],l=[],u="",f=!1){let y=(w,i,C=f,P)=>{let D={relativePath:P===void 0?w.path||"":P,caseSensitive:w.caseSensitive===!0,childrenIndex:i,route:w};if(D.relativePath.startsWith("/")){if(!D.relativePath.startsWith(u)&&C)return;ar(D.relativePath.startsWith(u),`Absolute route path "${D.relativePath}" nested under path "${u}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),D.relativePath=D.relativePath.slice(u.length)}let $=wf([u,D.relativePath]),G=l.concat(D);w.children&&w.children.length>0&&(ar(w.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${$}".`),pM(w.children,a,G,$,C)),!(w.path==null&&!w.index)&&a.push({path:$,score:xz($,w.index),routesMeta:G})};return s.forEach((w,i)=>{if(w.path===""||!w.path?.includes("?"))y(w,i);else for(let C of gM(w.path))y(w,i,!0,C)}),a}function gM(s){let a=s.split("/");if(a.length===0)return[];let[l,...u]=a,f=l.endsWith("?"),y=l.replace(/\?$/,"");if(u.length===0)return f?[y,""]:[y];let w=gM(u.join("/")),i=[];return i.push(...w.map(C=>C===""?y:[y,C].join("/"))),f&&i.push(...w),i.map(C=>s.startsWith("/")&&C===""?"/":C)}function fz(s){s.sort((a,l)=>a.score!==l.score?l.score-a.score:bz(a.routesMeta.map(u=>u.childrenIndex),l.routesMeta.map(u=>u.childrenIndex)))}var mz=/^:[\w-]+$/,pz=3,gz=2,_z=1,yz=10,vz=-2,cE=s=>s==="*";function xz(s,a){let l=s.split("/"),u=l.length;return l.some(cE)&&(u+=vz),a&&(u+=gz),l.filter(f=>!cE(f)).reduce((f,y)=>f+(mz.test(y)?pz:y===""?_z:yz),u)}function bz(s,a){return s.length===a.length&&s.slice(0,-1).every((u,f)=>u===a[f])?s[s.length-1]-a[a.length-1]:0}function wz(s,a,l=!1){let{routesMeta:u}=s,f={},y="/",w=[];for(let i=0;i<u.length;++i){let C=u[i],P=i===u.length-1,D=y==="/"?a:a.slice(y.length)||"/",$=vb({path:C.relativePath,caseSensitive:C.caseSensitive,end:P},D),G=C.route;if(!$&&P&&l&&!u[u.length-1].route.index&&($=vb({path:C.relativePath,caseSensitive:C.caseSensitive,end:!1},D)),!$)return null;Object.assign(f,$.params),w.push({params:f,pathname:wf([y,$.pathname]),pathnameBase:Cz(wf([y,$.pathnameBase])),route:G}),$.pathnameBase!=="/"&&(y=wf([y,$.pathnameBase]))}return w}function vb(s,a){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[l,u]=Sz(s.path,s.caseSensitive,s.end),f=a.match(l);if(!f)return null;let y=f[0],w=y.replace(/(.)\/+$/,"$1"),i=f.slice(1);return{params:u.reduce((P,{paramName:D,isOptional:$},G)=>{if(D==="*"){let te=i[G]||"";w=y.slice(0,y.length-te.length).replace(/(.)\/+$/,"$1")}const X=i[G];return $&&!X?P[D]=void 0:P[D]=(X||"").replace(/%2F/g,"/"),P},{}),pathname:y,pathnameBase:w,pattern:s}}function Sz(s,a=!1,l=!0){Wo(s==="*"||!s.endsWith("*")||s.endsWith("/*"),`Route path "${s}" will be treated as if it were "${s.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${s.replace(/\*$/,"/*")}".`);let u=[],f="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(w,i,C)=>(u.push({paramName:i,isOptional:C!=null}),C?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return s.endsWith("*")?(u.push({paramName:"*"}),f+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?f+="\\/*$":s!==""&&s!=="/"&&(f+="(?:(?=\\/|$))"),[new RegExp(f,a?void 0:"i"),u]}function Tz(s){try{return s.split("/").map(a=>decodeURIComponent(a).replace(/\//g,"%2F")).join("/")}catch(a){return Wo(!1,`The URL path "${s}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${a}).`),s}}function Nd(s,a){if(a==="/")return s;if(!s.toLowerCase().startsWith(a.toLowerCase()))return null;let l=a.endsWith("/")?a.length-1:a.length,u=s.charAt(l);return u&&u!=="/"?null:s.slice(l)||"/"}function kz({basename:s,pathname:a}){return a==="/"?s:wf([s,a])}function Ez(s,a="/"){let{pathname:l,search:u="",hash:f=""}=typeof s=="string"?Zp(s):s;return{pathname:l?l.startsWith("/")?l:Az(l,a):a,search:Mz(u),hash:Pz(f)}}function Az(s,a){let l=a.replace(/\/+$/,"").split("/");return s.split("/").forEach(f=>{f===".."?l.length>1&&l.pop():f!=="."&&l.push(f)}),l.length>1?l.join("/"):"/"}function m1(s,a,l,u){return`Cannot include a '${s}' character in a manually specified \`to.${a}\` field [${JSON.stringify(u)}].  Please separate it out to the \`to.${l}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function _M(s){return s.filter((a,l)=>l===0||a.route.path&&a.route.path.length>0)}function jS(s){let a=_M(s);return a.map((l,u)=>u===a.length-1?l.pathname:l.pathnameBase)}function RS(s,a,l,u=!1){let f;typeof s=="string"?f=Zp(s):(f={...s},ar(!f.pathname||!f.pathname.includes("?"),m1("?","pathname","search",f)),ar(!f.pathname||!f.pathname.includes("#"),m1("#","pathname","hash",f)),ar(!f.search||!f.search.includes("#"),m1("#","search","hash",f)));let y=s===""||f.pathname==="",w=y?"/":f.pathname,i;if(w==null)i=l;else{let $=a.length-1;if(!u&&w.startsWith("..")){let G=w.split("/");for(;G[0]==="..";)G.shift(),$-=1;f.pathname=G.join("/")}i=$>=0?a[$]:"/"}let C=Ez(f,i),P=w&&w!=="/"&&w.endsWith("/"),D=(y||w===".")&&l.endsWith("/");return!C.pathname.endsWith("/")&&(P||D)&&(C.pathname+="/"),C}var wf=s=>s.join("/").replace(/\/\/+/g,"/"),Cz=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),Mz=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,Pz=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s,xb=class{constructor(s,a,l,u=!1){this.status=s,this.statusText=a||"",this.internal=u,l instanceof Error?(this.data=l.toString(),this.error=l):this.data=l}};function lx(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}var yM=["POST","PUT","PATCH","DELETE"],jz=new Set(yM),Rz=["GET",...yM],Lz=new Set(Rz),Iz=new Set([301,302,303,307,308]),zz=new Set([307,308]),p1={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Dz={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Rv={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},Oz=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,LS=s=>Oz.test(s),Nz=s=>({hasErrorBoundary:!!s.hasErrorBoundary}),vM="remix-router-transitions",xM=Symbol("ResetLoaderData");function Fz(s){const a=s.window?s.window:typeof window<"u"?window:void 0,l=typeof a<"u"&&typeof a.document<"u"&&typeof a.document.createElement<"u";ar(s.routes.length>0,"You must provide a non-empty routes array to createRouter");let u=s.hydrationRouteProperties||[],f=s.mapRouteProperties||Nz,y={},w=ox(s.routes,f,void 0,y),i,C=s.basename||"/";C.startsWith("/")||(C=`/${C}`);let P=s.dataStrategy||Hz,D={...s.future},$=null,G=new Set,X=null,te=null,le=null,re=s.hydrationData!=null,fe=Ip(w,s.history.location,C),xe=!1,be=null,Ne;if(fe==null&&!s.patchRoutesOnNavigation){let Me=Od(404,{pathname:s.history.location.pathname}),{matches:Rt,route:ii}=j0(w);Ne=!0,fe=Rt,be={[ii.id]:Me}}else if(fe&&!s.hydrationData&&ic(fe,w,s.history.location.pathname).active&&(fe=null),fe)if(fe.some(Me=>Me.route.lazy))Ne=!1;else if(!fe.some(Me=>IS(Me.route)))Ne=!0;else{let Me=s.hydrationData?s.hydrationData.loaderData:null,Rt=s.hydrationData?s.hydrationData.errors:null;if(Rt){let ii=fe.findIndex(Ai=>Rt[Ai.route.id]!==void 0);Ne=fe.slice(0,ii+1).every(Ai=>!rS(Ai.route,Me,Rt))}else Ne=fe.every(ii=>!rS(ii.route,Me,Rt))}else{Ne=!1,fe=[];let Me=ic(null,w,s.history.location.pathname);Me.active&&Me.matches&&(xe=!0,fe=Me.matches)}let Be,Ee={historyAction:s.history.action,location:s.history.location,matches:fe,initialized:Ne,navigation:p1,restoreScrollPosition:s.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:s.hydrationData&&s.hydrationData.loaderData||{},actionData:s.hydrationData&&s.hydrationData.actionData||null,errors:s.hydrationData&&s.hydrationData.errors||be,fetchers:new Map,blockers:new Map},et="POP",at=!1,He,lt=!1,pt=new Map,Zt=null,jt=!1,Di=!1,Pi=new Set,qe=new Map,wt=0,Ct=-1,Vi=new Map,Qe=new Set,St=new Map,Ht=new Map,Ft=new Set,_i=new Map,At,Xt=null;function yn(){if($=s.history.listen(({action:Me,location:Rt,delta:ii})=>{if(At){At(),At=void 0;return}Wo(_i.size===0||ii!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Ai=Jo({currentLocation:Ee.location,nextLocation:Rt,historyAction:Me});if(Ai&&ii!=null){let ui=new Promise(Wi=>{At=Wi});s.history.go(ii*-1),po(Ai,{state:"blocked",location:Rt,proceed(){po(Ai,{state:"proceeding",proceed:void 0,reset:void 0,location:Rt}),ui.then(()=>s.history.go(ii))},reset(){let Wi=new Map(Ee.blockers);Wi.set(Ai,Rv),sn({blockers:Wi})}});return}return nn(Me,Rt)}),l){rD(a,pt);let Me=()=>sD(a,pt);a.addEventListener("pagehide",Me),Zt=()=>a.removeEventListener("pagehide",Me)}return Ee.initialized||nn("POP",Ee.location,{initialHydration:!0}),Be}function fn(){$&&$(),Zt&&Zt(),G.clear(),He&&He.abort(),Ee.fetchers.forEach((Me,Rt)=>dl(Rt)),Ee.blockers.forEach((Me,Rt)=>Ss(Rt))}function pn(Me){return G.add(Me),()=>G.delete(Me)}function sn(Me,Rt={}){Me.matches&&(Me.matches=Me.matches.map(ui=>{let Wi=y[ui.route.id],Ti=ui.route;return Ti.element!==Wi.element||Ti.errorElement!==Wi.errorElement||Ti.hydrateFallbackElement!==Wi.hydrateFallbackElement?{...ui,route:Wi}:ui})),Ee={...Ee,...Me};let ii=[],Ai=[];Ee.fetchers.forEach((ui,Wi)=>{ui.state==="idle"&&(Ft.has(Wi)?ii.push(Wi):Ai.push(Wi))}),Ft.forEach(ui=>{!Ee.fetchers.has(ui)&&!qe.has(ui)&&ii.push(ui)}),[...G].forEach(ui=>ui(Ee,{deletedFetchers:ii,viewTransitionOpts:Rt.viewTransitionOpts,flushSync:Rt.flushSync===!0})),ii.forEach(ui=>dl(ui)),Ai.forEach(ui=>Ee.fetchers.delete(ui))}function Un(Me,Rt,{flushSync:ii}={}){let Ai=Ee.actionData!=null&&Ee.navigation.formMethod!=null&&bu(Ee.navigation.formMethod)&&Ee.navigation.state==="loading"&&Me.state?._isRedirect!==!0,ui;Rt.actionData?Object.keys(Rt.actionData).length>0?ui=Rt.actionData:ui=null:Ai?ui=Ee.actionData:ui=null;let Wi=Rt.loaderData?vE(Ee.loaderData,Rt.loaderData,Rt.matches||[],Rt.errors):Ee.loaderData,Ti=Ee.blockers;Ti.size>0&&(Ti=new Map(Ti),Ti.forEach((ne,ue)=>Ti.set(ue,Rv)));let vn=jt?!1:Ur(Me,Rt.matches||Ee.matches),Mn=at===!0||Ee.navigation.formMethod!=null&&bu(Ee.navigation.formMethod)&&Me.state?._isRedirect!==!0;i&&(w=i,i=void 0),jt||et==="POP"||(et==="PUSH"?s.history.push(Me,Me.state):et==="REPLACE"&&s.history.replace(Me,Me.state));let Xe;if(et==="POP"){let ne=pt.get(Ee.location.pathname);ne&&ne.has(Me.pathname)?Xe={currentLocation:Ee.location,nextLocation:Me}:pt.has(Me.pathname)&&(Xe={currentLocation:Me,nextLocation:Ee.location})}else if(lt){let ne=pt.get(Ee.location.pathname);ne?ne.add(Me.pathname):(ne=new Set([Me.pathname]),pt.set(Ee.location.pathname,ne)),Xe={currentLocation:Ee.location,nextLocation:Me}}sn({...Rt,actionData:ui,loaderData:Wi,historyAction:et,location:Me,initialized:!0,navigation:p1,revalidation:"idle",restoreScrollPosition:vn,preventScrollReset:Mn,blockers:Ti},{viewTransitionOpts:Xe,flushSync:ii===!0}),et="POP",at=!1,lt=!1,jt=!1,Di=!1,Xt?.resolve(),Xt=null}async function Ui(Me,Rt){if(typeof Me=="number"){s.history.go(Me);return}let ii=aS(Ee.location,Ee.matches,C,Me,Rt?.fromRouteId,Rt?.relative),{path:Ai,submission:ui,error:Wi}=uE(!1,ii,Rt),Ti=Ee.location,vn=sx(Ee.location,Ai,Rt&&Rt.state);vn={...vn,...s.history.encodeLocation(vn)};let Mn=Rt&&Rt.replace!=null?Rt.replace:void 0,Xe="PUSH";Mn===!0?Xe="REPLACE":Mn===!1||ui!=null&&bu(ui.formMethod)&&ui.formAction===Ee.location.pathname+Ee.location.search&&(Xe="REPLACE");let ne=Rt&&"preventScrollReset"in Rt?Rt.preventScrollReset===!0:void 0,ue=(Rt&&Rt.flushSync)===!0,ke=Jo({currentLocation:Ti,nextLocation:vn,historyAction:Xe});if(ke){po(ke,{state:"blocked",location:vn,proceed(){po(ke,{state:"proceeding",proceed:void 0,reset:void 0,location:vn}),Ui(Me,Rt)},reset(){let Fe=new Map(Ee.blockers);Fe.set(ke,Rv),sn({blockers:Fe})}});return}await nn(Xe,vn,{submission:ui,pendingError:Wi,preventScrollReset:ne,replace:Rt&&Rt.replace,enableViewTransition:Rt&&Rt.viewTransition,flushSync:ue})}function Ii(){Xt||(Xt=oD()),Yo(),sn({revalidation:"loading"});let Me=Xt.promise;return Ee.navigation.state==="submitting"?Me:Ee.navigation.state==="idle"?(nn(Ee.historyAction,Ee.location,{startUninterruptedRevalidation:!0}),Me):(nn(et||Ee.historyAction,Ee.navigation.location,{overrideNavigation:Ee.navigation,enableViewTransition:lt===!0}),Me)}async function nn(Me,Rt,ii){He&&He.abort(),He=null,et=Me,jt=(ii&&ii.startUninterruptedRevalidation)===!0,Za(Ee.location,Ee.matches),at=(ii&&ii.preventScrollReset)===!0,lt=(ii&&ii.enableViewTransition)===!0;let Ai=i||w,ui=ii&&ii.overrideNavigation,Wi=ii?.initialHydration&&Ee.matches&&Ee.matches.length>0&&!xe?Ee.matches:Ip(Ai,Rt,C),Ti=(ii&&ii.flushSync)===!0;if(Wi&&Ee.initialized&&!Di&&Jz(Ee.location,Rt)&&!(ii&&ii.submission&&bu(ii.submission.formMethod))){Un(Rt,{matches:Wi},{flushSync:Ti});return}let vn=ic(Wi,Ai,Rt.pathname);if(vn.active&&vn.matches&&(Wi=vn.matches),!Wi){let{error:Ze,notFoundMatches:st,route:Je}=Ws(Rt.pathname);Un(Rt,{matches:st,loaderData:{},errors:{[Je.id]:Ze}},{flushSync:Ti});return}He=new AbortController;let Mn=dy(s.history,Rt,He.signal,ii&&ii.submission),Xe=s.getContext?await s.getContext():new lE,ne;if(ii&&ii.pendingError)ne=[zp(Wi).route.id,{type:"error",error:ii.pendingError}];else if(ii&&ii.submission&&bu(ii.submission.formMethod)){let Ze=await mn(Mn,Rt,ii.submission,Wi,Xe,vn.active,ii&&ii.initialHydration===!0,{replace:ii.replace,flushSync:Ti});if(Ze.shortCircuited)return;if(Ze.pendingActionResult){let[st,Je]=Ze.pendingActionResult;if(Xu(Je)&&lx(Je.error)&&Je.error.status===404){He=null,Un(Rt,{matches:Ze.matches,loaderData:{},errors:{[st]:Je.error}});return}}Wi=Ze.matches||Wi,ne=Ze.pendingActionResult,ui=g1(Rt,ii.submission),Ti=!1,vn.active=!1,Mn=dy(s.history,Mn.url,Mn.signal)}let{shortCircuited:ue,matches:ke,loaderData:Fe,errors:Ue}=await cn(Mn,Rt,Wi,Xe,vn.active,ui,ii&&ii.submission,ii&&ii.fetcherSubmission,ii&&ii.replace,ii&&ii.initialHydration===!0,Ti,ne);ue||(He=null,Un(Rt,{matches:ke||Wi,...xE(ne),loaderData:Fe,errors:Ue}))}async function mn(Me,Rt,ii,Ai,ui,Wi,Ti,vn={}){Yo();let Mn=nD(Rt,ii);if(sn({navigation:Mn},{flushSync:vn.flushSync===!0}),Wi){let ue=await Ro(Ai,Rt.pathname,Me.signal);if(ue.type==="aborted")return{shortCircuited:!0};if(ue.type==="error"){if(ue.partialMatches.length===0){let{matches:Fe,route:Ue}=j0(w);return{matches:Fe,pendingActionResult:[Ue.id,{type:"error",error:ue.error}]}}let ke=zp(ue.partialMatches).route.id;return{matches:ue.partialMatches,pendingActionResult:[ke,{type:"error",error:ue.error}]}}else if(ue.matches)Ai=ue.matches;else{let{notFoundMatches:ke,error:Fe,route:Ue}=Ws(Rt.pathname);return{matches:ke,pendingActionResult:[Ue.id,{type:"error",error:Fe}]}}}let Xe,ne=ub(Ai,Rt);if(!ne.route.action&&!ne.route.lazy)Xe={type:"error",error:Od(405,{method:Me.method,pathname:Rt.pathname,routeId:ne.route.id})};else{let ue=py(f,y,Me,Ai,ne,Ti?[]:u,ui),ke=await Gs(Me,ue,ui,null);if(Xe=ke[ne.route.id],!Xe){for(let Fe of Ai)if(ke[Fe.route.id]){Xe=ke[Fe.route.id];break}}if(Me.signal.aborted)return{shortCircuited:!0}}if(Xg(Xe)){let ue;return vn&&vn.replace!=null?ue=vn.replace:ue=gE(Xe.response.headers.get("Location"),new URL(Me.url),C)===Ee.location.pathname+Ee.location.search,await ws(Me,Xe,!0,{submission:ii,replace:ue}),{shortCircuited:!0}}if(Xu(Xe)){let ue=zp(Ai,ne.route.id);return(vn&&vn.replace)!==!0&&(et="PUSH"),{matches:Ai,pendingActionResult:[ue.route.id,Xe,ne.route.id]}}return{matches:Ai,pendingActionResult:[ne.route.id,Xe]}}async function cn(Me,Rt,ii,Ai,ui,Wi,Ti,vn,Mn,Xe,ne,ue){let ke=Wi||g1(Rt,Ti),Fe=Ti||vn||wE(ke),Ue=!jt&&!Xe;if(ui){if(Ue){let Gn=Tn(ue);sn({navigation:ke,...Gn!==void 0?{actionData:Gn}:{}},{flushSync:ne})}let Hi=await Ro(ii,Rt.pathname,Me.signal);if(Hi.type==="aborted")return{shortCircuited:!0};if(Hi.type==="error"){if(Hi.partialMatches.length===0){let{matches:Oa,route:Ea}=j0(w);return{matches:Oa,loaderData:{},errors:{[Ea.id]:Hi.error}}}let Gn=zp(Hi.partialMatches).route.id;return{matches:Hi.partialMatches,loaderData:{},errors:{[Gn]:Hi.error}}}else if(Hi.matches)ii=Hi.matches;else{let{error:Gn,notFoundMatches:Oa,route:Ea}=Ws(Rt.pathname);return{matches:Oa,loaderData:{},errors:{[Ea.id]:Gn}}}}let Ze=i||w,{dsMatches:st,revalidatingFetchers:Je}=dE(Me,Ai,f,y,s.history,Ee,ii,Fe,Rt,Xe?[]:u,Xe===!0,Di,Pi,Ft,St,Qe,Ze,C,s.patchRoutesOnNavigation!=null,ue);if(Ct=++wt,!s.dataStrategy&&!st.some(Hi=>Hi.shouldLoad)&&!st.some(Hi=>Hi.route.middleware&&Hi.route.middleware.length>0)&&Je.length===0){let Hi=vr();return Un(Rt,{matches:ii,loaderData:{},errors:ue&&Xu(ue[1])?{[ue[0]]:ue[1].error}:null,...xE(ue),...Hi?{fetchers:new Map(Ee.fetchers)}:{}},{flushSync:ne}),{shortCircuited:!0}}if(Ue){let Hi={};if(!ui){Hi.navigation=ke;let Gn=Tn(ue);Gn!==void 0&&(Hi.actionData=Gn)}Je.length>0&&(Hi.fetchers=Da(Je)),sn(Hi,{flushSync:ne})}Je.forEach(Hi=>{qs(Hi.key),Hi.controller&&qe.set(Hi.key,Hi.controller)});let ct=()=>Je.forEach(Hi=>qs(Hi.key));He&&He.signal.addEventListener("abort",ct);let{loaderResults:It,fetcherResults:Tt}=await Hr(st,Je,Me,Ai);if(Me.signal.aborted)return{shortCircuited:!0};He&&He.signal.removeEventListener("abort",ct),Je.forEach(Hi=>qe.delete(Hi.key));let ci=R0(It);if(ci)return await ws(Me,ci.result,!0,{replace:Mn}),{shortCircuited:!0};if(ci=R0(Tt),ci)return Qe.add(ci.key),await ws(Me,ci.result,!0,{replace:Mn}),{shortCircuited:!0};let{loaderData:Fi,errors:mi}=yE(Ee,ii,It,ue,Je,Tt);Xe&&Ee.errors&&(mi={...Ee.errors,...mi});let tn=vr(),rn=Ir(Ct),Xi=tn||rn||Je.length>0;return{matches:ii,loaderData:Fi,errors:mi,...Xi?{fetchers:new Map(Ee.fetchers)}:{}}}function Tn(Me){if(Me&&!Xu(Me[1]))return{[Me[0]]:Me[1].data};if(Ee.actionData)return Object.keys(Ee.actionData).length===0?null:Ee.actionData}function Da(Me){return Me.forEach(Rt=>{let ii=Ee.fetchers.get(Rt.key),Ai=Lv(void 0,ii?ii.data:void 0);Ee.fetchers.set(Rt.key,Ai)}),new Map(Ee.fetchers)}async function Hc(Me,Rt,ii,Ai){qs(Me);let ui=(Ai&&Ai.flushSync)===!0,Wi=i||w,Ti=aS(Ee.location,Ee.matches,C,ii,Rt,Ai?.relative),vn=Ip(Wi,Ti,C),Mn=ic(vn,Wi,Ti);if(Mn.active&&Mn.matches&&(vn=Mn.matches),!vn){er(Me,Rt,Od(404,{pathname:Ti}),{flushSync:ui});return}let{path:Xe,submission:ne,error:ue}=uE(!0,Ti,Ai);if(ue){er(Me,Rt,ue,{flushSync:ui});return}let ke=s.getContext?await s.getContext():new lE,Fe=(Ai&&Ai.preventScrollReset)===!0;if(ne&&bu(ne.formMethod)){await Xo(Me,Rt,Xe,vn,ke,Mn.active,ui,Fe,ne);return}St.set(Me,{routeId:Rt,path:Xe}),await Hs(Me,Rt,Xe,vn,ke,Mn.active,ui,Fe,ne)}async function Xo(Me,Rt,ii,Ai,ui,Wi,Ti,vn,Mn){Yo(),St.delete(Me);let Xe=Ee.fetchers.get(Me);Jr(Me,aD(Mn,Xe),{flushSync:Ti});let ne=new AbortController,ue=dy(s.history,ii,ne.signal,Mn);if(Wi){let Jn=await Ro(Ai,new URL(ue.url).pathname,ue.signal,Me);if(Jn.type==="aborted")return;if(Jn.type==="error"){er(Me,Rt,Jn.error,{flushSync:Ti});return}else if(Jn.matches)Ai=Jn.matches;else{er(Me,Rt,Od(404,{pathname:ii}),{flushSync:Ti});return}}let ke=ub(Ai,ii);if(!ke.route.action&&!ke.route.lazy){let Jn=Od(405,{method:Mn.formMethod,pathname:ii,routeId:Rt});er(Me,Rt,Jn,{flushSync:Ti});return}qe.set(Me,ne);let Fe=wt,Ue=py(f,y,ue,Ai,ke,u,ui),st=(await Gs(ue,Ue,ui,Me))[ke.route.id];if(ue.signal.aborted){qe.get(Me)===ne&&qe.delete(Me);return}if(Ft.has(Me)){if(Xg(st)||Xu(st)){Jr(Me,wm(void 0));return}}else{if(Xg(st))if(qe.delete(Me),Ct>Fe){Jr(Me,wm(void 0));return}else return Qe.add(Me),Jr(Me,Lv(Mn)),ws(ue,st,!1,{fetcherSubmission:Mn,preventScrollReset:vn});if(Xu(st)){er(Me,Rt,st.error);return}}let Je=Ee.navigation.location||Ee.location,ct=dy(s.history,Je,ne.signal),It=i||w,Tt=Ee.navigation.state!=="idle"?Ip(It,Ee.navigation.location,C):Ee.matches;ar(Tt,"Didn't find any matches after fetcher action");let ci=++wt;Vi.set(Me,ci);let Fi=Lv(Mn,st.data);Ee.fetchers.set(Me,Fi);let{dsMatches:mi,revalidatingFetchers:tn}=dE(ct,ui,f,y,s.history,Ee,Tt,Mn,Je,u,!1,Di,Pi,Ft,St,Qe,It,C,s.patchRoutesOnNavigation!=null,[ke.route.id,st]);tn.filter(Jn=>Jn.key!==Me).forEach(Jn=>{let gn=Jn.key,an=Ee.fetchers.get(gn),ia=Lv(void 0,an?an.data:void 0);Ee.fetchers.set(gn,ia),qs(gn),Jn.controller&&qe.set(gn,Jn.controller)}),sn({fetchers:new Map(Ee.fetchers)});let rn=()=>tn.forEach(Jn=>qs(Jn.key));ne.signal.addEventListener("abort",rn);let{loaderResults:Xi,fetcherResults:Hi}=await Hr(mi,tn,ct,ui);if(ne.signal.aborted)return;if(ne.signal.removeEventListener("abort",rn),Vi.delete(Me),qe.delete(Me),tn.forEach(Jn=>qe.delete(Jn.key)),Ee.fetchers.has(Me)){let Jn=wm(st.data);Ee.fetchers.set(Me,Jn)}let Gn=R0(Xi);if(Gn)return ws(ct,Gn.result,!1,{preventScrollReset:vn});if(Gn=R0(Hi),Gn)return Qe.add(Gn.key),ws(ct,Gn.result,!1,{preventScrollReset:vn});let{loaderData:Oa,errors:Ea}=yE(Ee,Tt,Xi,void 0,tn,Hi);Ir(ci),Ee.navigation.state==="loading"&&ci>Ct?(ar(et,"Expected pending action"),He&&He.abort(),Un(Ee.navigation.location,{matches:Tt,loaderData:Oa,errors:Ea,fetchers:new Map(Ee.fetchers)})):(sn({errors:Ea,loaderData:vE(Ee.loaderData,Oa,Tt,Ea),fetchers:new Map(Ee.fetchers)}),Di=!1)}async function Hs(Me,Rt,ii,Ai,ui,Wi,Ti,vn,Mn){let Xe=Ee.fetchers.get(Me);Jr(Me,Lv(Mn,Xe?Xe.data:void 0),{flushSync:Ti});let ne=new AbortController,ue=dy(s.history,ii,ne.signal);if(Wi){let Je=await Ro(Ai,new URL(ue.url).pathname,ue.signal,Me);if(Je.type==="aborted")return;if(Je.type==="error"){er(Me,Rt,Je.error,{flushSync:Ti});return}else if(Je.matches)Ai=Je.matches;else{er(Me,Rt,Od(404,{pathname:ii}),{flushSync:Ti});return}}let ke=ub(Ai,ii);qe.set(Me,ne);let Fe=wt,Ue=py(f,y,ue,Ai,ke,u,ui),st=(await Gs(ue,Ue,ui,Me))[ke.route.id];if(qe.get(Me)===ne&&qe.delete(Me),!ue.signal.aborted){if(Ft.has(Me)){Jr(Me,wm(void 0));return}if(Xg(st))if(Ct>Fe){Jr(Me,wm(void 0));return}else{Qe.add(Me),await ws(ue,st,!1,{preventScrollReset:vn});return}if(Xu(st)){er(Me,Rt,st.error);return}Jr(Me,wm(st.data))}}async function ws(Me,Rt,ii,{submission:Ai,fetcherSubmission:ui,preventScrollReset:Wi,replace:Ti}={}){Rt.response.headers.has("X-Remix-Revalidate")&&(Di=!0);let vn=Rt.response.headers.get("Location");ar(vn,"Expected a Location header on the redirect Response"),vn=gE(vn,new URL(Me.url),C);let Mn=sx(Ee.location,vn,{_isRedirect:!0});if(l){let Ue=!1;if(Rt.response.headers.has("X-Remix-Reload-Document"))Ue=!0;else if(LS(vn)){const Ze=mM(vn,!0);Ue=Ze.origin!==a.location.origin||Nd(Ze.pathname,C)==null}if(Ue){Ti?a.location.replace(vn):a.location.assign(vn);return}}He=null;let Xe=Ti===!0||Rt.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:ne,formAction:ue,formEncType:ke}=Ee.navigation;!Ai&&!ui&&ne&&ue&&ke&&(Ai=wE(Ee.navigation));let Fe=Ai||ui;if(zz.has(Rt.response.status)&&Fe&&bu(Fe.formMethod))await nn(Xe,Mn,{submission:{...Fe,formAction:vn},preventScrollReset:Wi||at,enableViewTransition:ii?lt:void 0});else{let Ue=g1(Mn,Ai);await nn(Xe,Mn,{overrideNavigation:Ue,fetcherSubmission:ui,preventScrollReset:Wi||at,enableViewTransition:ii?lt:void 0})}}async function Gs(Me,Rt,ii,Ai){let ui,Wi={};try{ui=await qz(P,Me,Rt,Ai,ii,!1)}catch(Ti){return Rt.filter(vn=>vn.shouldLoad).forEach(vn=>{Wi[vn.route.id]={type:"error",error:Ti}}),Wi}if(Me.signal.aborted)return Wi;for(let[Ti,vn]of Object.entries(ui))if(tD(vn)){let Mn=vn.result;Wi[Ti]={type:"redirect",response:Yz(Mn,Me,Ti,Rt,C)}}else Wi[Ti]=await Xz(vn);return Wi}async function Hr(Me,Rt,ii,Ai){let ui=Gs(ii,Me,Ai,null),Wi=Promise.all(Rt.map(async Mn=>{if(Mn.matches&&Mn.match&&Mn.request&&Mn.controller){let ne=(await Gs(Mn.request,Mn.matches,Ai,Mn.key))[Mn.match.route.id];return{[Mn.key]:ne}}else return Promise.resolve({[Mn.key]:{type:"error",error:Od(404,{pathname:Mn.path})}})})),Ti=await ui,vn=(await Wi).reduce((Mn,Xe)=>Object.assign(Mn,Xe),{});return{loaderResults:Ti,fetcherResults:vn}}function Yo(){Di=!0,St.forEach((Me,Rt)=>{qe.has(Rt)&&Pi.add(Rt),qs(Rt)})}function Jr(Me,Rt,ii={}){Ee.fetchers.set(Me,Rt),sn({fetchers:new Map(Ee.fetchers)},{flushSync:(ii&&ii.flushSync)===!0})}function er(Me,Rt,ii,Ai={}){let ui=zp(Ee.matches,Rt);dl(Me),sn({errors:{[ui.route.id]:ii},fetchers:new Map(Ee.fetchers)},{flushSync:(Ai&&Ai.flushSync)===!0})}function ds(Me){return Ht.set(Me,(Ht.get(Me)||0)+1),Ft.has(Me)&&Ft.delete(Me),Ee.fetchers.get(Me)||Dz}function pr(Me,Rt){qs(Me,Rt?.reason),Jr(Me,wm(null))}function dl(Me){let Rt=Ee.fetchers.get(Me);qe.has(Me)&&!(Rt&&Rt.state==="loading"&&Vi.has(Me))&&qs(Me),St.delete(Me),Vi.delete(Me),Qe.delete(Me),Ft.delete(Me),Pi.delete(Me),Ee.fetchers.delete(Me)}function Ql(Me){let Rt=(Ht.get(Me)||0)-1;Rt<=0?(Ht.delete(Me),Ft.add(Me)):Ht.set(Me,Rt),sn({fetchers:new Map(Ee.fetchers)})}function qs(Me,Rt){let ii=qe.get(Me);ii&&(ii.abort(Rt),qe.delete(Me))}function Ko(Me){for(let Rt of Me){let ii=ds(Rt),Ai=wm(ii.data);Ee.fetchers.set(Rt,Ai)}}function vr(){let Me=[],Rt=!1;for(let ii of Qe){let Ai=Ee.fetchers.get(ii);ar(Ai,`Expected fetcher: ${ii}`),Ai.state==="loading"&&(Qe.delete(ii),Me.push(ii),Rt=!0)}return Ko(Me),Rt}function Ir(Me){let Rt=[];for(let[ii,Ai]of Vi)if(Ai<Me){let ui=Ee.fetchers.get(ii);ar(ui,`Expected fetcher: ${ii}`),ui.state==="loading"&&(qs(ii),Vi.delete(ii),Rt.push(ii))}return Ko(Rt),Rt.length>0}function ec(Me,Rt){let ii=Ee.blockers.get(Me)||Rv;return _i.get(Me)!==Rt&&_i.set(Me,Rt),ii}function Ss(Me){Ee.blockers.delete(Me),_i.delete(Me)}function po(Me,Rt){let ii=Ee.blockers.get(Me)||Rv;ar(ii.state==="unblocked"&&Rt.state==="blocked"||ii.state==="blocked"&&Rt.state==="blocked"||ii.state==="blocked"&&Rt.state==="proceeding"||ii.state==="blocked"&&Rt.state==="unblocked"||ii.state==="proceeding"&&Rt.state==="unblocked",`Invalid blocker state transition: ${ii.state} -> ${Rt.state}`);let Ai=new Map(Ee.blockers);Ai.set(Me,Rt),sn({blockers:Ai})}function Jo({currentLocation:Me,nextLocation:Rt,historyAction:ii}){if(_i.size===0)return;_i.size>1&&Wo(!1,"A router only supports one blocker at a time");let Ai=Array.from(_i.entries()),[ui,Wi]=Ai[Ai.length-1],Ti=Ee.blockers.get(ui);if(!(Ti&&Ti.state==="proceeding")&&Wi({currentLocation:Me,nextLocation:Rt,historyAction:ii}))return ui}function Ws(Me){let Rt=Od(404,{pathname:Me}),ii=i||w,{matches:Ai,route:ui}=j0(ii);return{notFoundMatches:Ai,route:ui,error:Rt}}function tc(Me,Rt,ii){if(X=Me,le=Rt,te=ii||null,!re&&Ee.navigation===p1){re=!0;let Ai=Ur(Ee.location,Ee.matches);Ai!=null&&sn({restoreScrollPosition:Ai})}return()=>{X=null,le=null,te=null}}function go(Me,Rt){return te&&te(Me,Rt.map(Ai=>hz(Ai,Ee.loaderData)))||Me.key}function Za(Me,Rt){if(X&&le){let ii=go(Me,Rt);X[ii]=le()}}function Ur(Me,Rt){if(X){let ii=go(Me,Rt),Ai=X[ii];if(typeof Ai=="number")return Ai}return null}function ic(Me,Rt,ii){if(s.patchRoutesOnNavigation)if(Me){if(Object.keys(Me[0].params).length>0)return{active:!0,matches:cb(Rt,ii,C,!0)}}else return{active:!0,matches:cb(Rt,ii,C,!0)||[]};return{active:!1,matches:null}}async function Ro(Me,Rt,ii,Ai){if(!s.patchRoutesOnNavigation)return{type:"success",matches:Me};let ui=Me;for(;;){let Wi=i==null,Ti=i||w,vn=y;try{await s.patchRoutesOnNavigation({signal:ii,path:Rt,matches:ui,fetcherKey:Ai,patch:(ne,ue)=>{ii.aborted||hE(ne,ue,Ti,vn,f,!1)}})}catch(ne){return{type:"error",error:ne,partialMatches:ui}}finally{Wi&&!ii.aborted&&(w=[...w])}if(ii.aborted)return{type:"aborted"};let Mn=Ip(Ti,Rt,C);if(Mn)return{type:"success",matches:Mn};let Xe=cb(Ti,Rt,C,!0);if(!Xe||ui.length===Xe.length&&ui.every((ne,ue)=>ne.route.id===Xe[ue].route.id))return{type:"success",matches:null};ui=Xe}}function _o(Me){y={},i=ox(Me,f,void 0,y)}function ku(Me,Rt,ii=!1){let Ai=i==null;hE(Me,Rt,i||w,y,f,ii),Ai&&(w=[...w],sn({}))}return Be={get basename(){return C},get future(){return D},get state(){return Ee},get routes(){return w},get window(){return a},initialize:yn,subscribe:pn,enableScrollRestoration:tc,navigate:Ui,fetch:Hc,revalidate:Ii,createHref:Me=>s.history.createHref(Me),encodeLocation:Me=>s.history.encodeLocation(Me),getFetcher:ds,resetFetcher:pr,deleteFetcher:Ql,dispose:fn,getBlocker:ec,deleteBlocker:Ss,patchRoutes:ku,_internalFetchControllers:qe,_internalSetRoutes:_o,_internalSetStateDoNotUseOrYouWillBreakYourApp(Me){sn(Me)}},Be}function Bz(s){return s!=null&&("formData"in s&&s.formData!=null||"body"in s&&s.body!==void 0)}function aS(s,a,l,u,f,y){let w,i;if(f){w=[];for(let P of a)if(w.push(P),P.route.id===f){i=P;break}}else w=a,i=a[a.length-1];let C=RS(u||".",jS(w),Nd(s.pathname,l)||s.pathname,y==="path");if(u==null&&(C.search=s.search,C.hash=s.hash),(u==null||u===""||u===".")&&i){let P=zS(C.search);if(i.route.index&&!P)C.search=C.search?C.search.replace(/^\?/,"?index&"):"?index";else if(!i.route.index&&P){let D=new URLSearchParams(C.search),$=D.getAll("index");D.delete("index"),$.filter(X=>X).forEach(X=>D.append("index",X));let G=D.toString();C.search=G?`?${G}`:""}}return l!=="/"&&(C.pathname=kz({basename:l,pathname:C.pathname})),Gp(C)}function uE(s,a,l){if(!l||!Bz(l))return{path:a};if(l.formMethod&&!iD(l.formMethod))return{path:a,error:Od(405,{method:l.formMethod})};let u=()=>({path:a,error:Od(400,{type:"invalid-body"})}),y=(l.formMethod||"get").toUpperCase(),w=EM(a);if(l.body!==void 0){if(l.formEncType==="text/plain"){if(!bu(y))return u();let $=typeof l.body=="string"?l.body:l.body instanceof FormData||l.body instanceof URLSearchParams?Array.from(l.body.entries()).reduce((G,[X,te])=>`${G}${X}=${te}
`,""):String(l.body);return{path:a,submission:{formMethod:y,formAction:w,formEncType:l.formEncType,formData:void 0,json:void 0,text:$}}}else if(l.formEncType==="application/json"){if(!bu(y))return u();try{let $=typeof l.body=="string"?JSON.parse(l.body):l.body;return{path:a,submission:{formMethod:y,formAction:w,formEncType:l.formEncType,formData:void 0,json:$,text:void 0}}}catch{return u()}}}ar(typeof FormData=="function","FormData is not available in this environment");let i,C;if(l.formData)i=oS(l.formData),C=l.formData;else if(l.body instanceof FormData)i=oS(l.body),C=l.body;else if(l.body instanceof URLSearchParams)i=l.body,C=_E(i);else if(l.body==null)i=new URLSearchParams,C=new FormData;else try{i=new URLSearchParams(l.body),C=_E(i)}catch{return u()}let P={formMethod:y,formAction:w,formEncType:l&&l.formEncType||"application/x-www-form-urlencoded",formData:C,json:void 0,text:void 0};if(bu(P.formMethod))return{path:a,submission:P};let D=Zp(a);return s&&D.search&&zS(D.search)&&i.append("index",""),D.search=`?${i}`,{path:Gp(D),submission:P}}function dE(s,a,l,u,f,y,w,i,C,P,D,$,G,X,te,le,re,fe,xe,be){let Ne=be?Xu(be[1])?be[1].error:be[1].data:void 0,Be=f.createURL(y.location),Ee=f.createURL(C),et;if(D&&y.errors){let jt=Object.keys(y.errors)[0];et=w.findIndex(Di=>Di.route.id===jt)}else if(be&&Xu(be[1])){let jt=be[0];et=w.findIndex(Di=>Di.route.id===jt)-1}let at=be?be[1].statusCode:void 0,He=at&&at>=400,lt={currentUrl:Be,currentParams:y.matches[0]?.params||{},nextUrl:Ee,nextParams:w[0].params,...i,actionResult:Ne,actionStatus:at},pt=w.map((jt,Di)=>{let{route:Pi}=jt,qe=null;if(et!=null&&Di>et?qe=!1:Pi.lazy?qe=!0:IS(Pi)?D?qe=rS(Pi,y.loaderData,y.errors):Uz(y.loaderData,y.matches[Di],jt)&&(qe=!0):qe=!1,qe!==null)return sS(l,u,s,jt,P,a,qe);let wt=He?!1:$||Be.pathname+Be.search===Ee.pathname+Ee.search||Be.search!==Ee.search||$z(y.matches[Di],jt),Ct={...lt,defaultShouldRevalidate:wt},Vi=bb(jt,Ct);return sS(l,u,s,jt,P,a,Vi,Ct)}),Zt=[];return te.forEach((jt,Di)=>{if(D||!w.some(Ht=>Ht.route.id===jt.routeId)||X.has(Di))return;let Pi=y.fetchers.get(Di),qe=Pi&&Pi.state!=="idle"&&Pi.data===void 0,wt=Ip(re,jt.path,fe);if(!wt){if(xe&&qe)return;Zt.push({key:Di,routeId:jt.routeId,path:jt.path,matches:null,match:null,request:null,controller:null});return}if(le.has(Di))return;let Ct=ub(wt,jt.path),Vi=new AbortController,Qe=dy(f,jt.path,Vi.signal),St=null;if(G.has(Di))G.delete(Di),St=py(l,u,Qe,wt,Ct,P,a);else if(qe)$&&(St=py(l,u,Qe,wt,Ct,P,a));else{let Ht={...lt,defaultShouldRevalidate:He?!1:$};bb(Ct,Ht)&&(St=py(l,u,Qe,wt,Ct,P,a,Ht))}St&&Zt.push({key:Di,routeId:jt.routeId,path:jt.path,matches:St,match:Ct,request:Qe,controller:Vi})}),{dsMatches:pt,revalidatingFetchers:Zt}}function IS(s){return s.loader!=null||s.middleware!=null&&s.middleware.length>0}function rS(s,a,l){if(s.lazy)return!0;if(!IS(s))return!1;let u=a!=null&&s.id in a,f=l!=null&&l[s.id]!==void 0;return!u&&f?!1:typeof s.loader=="function"&&s.loader.hydrate===!0?!0:!u&&!f}function Uz(s,a,l){let u=!a||l.route.id!==a.route.id,f=!s.hasOwnProperty(l.route.id);return u||f}function $z(s,a){let l=s.route.path;return s.pathname!==a.pathname||l!=null&&l.endsWith("*")&&s.params["*"]!==a.params["*"]}function bb(s,a){if(s.route.shouldRevalidate){let l=s.route.shouldRevalidate(a);if(typeof l=="boolean")return l}return a.defaultShouldRevalidate}function hE(s,a,l,u,f,y){let w;if(s){let P=u[s];ar(P,`No route found to patch children into: routeId = ${s}`),P.children||(P.children=[]),w=P.children}else w=l;let i=[],C=[];if(a.forEach(P=>{let D=w.find($=>bM(P,$));D?C.push({existingRoute:D,newRoute:P}):i.push(P)}),i.length>0){let P=ox(i,f,[s||"_","patch",String(w?.length||"0")],u);w.push(...P)}if(y&&C.length>0)for(let P=0;P<C.length;P++){let{existingRoute:D,newRoute:$}=C[P],G=D,[X]=ox([$],f,[],{},!0);Object.assign(G,{element:X.element?X.element:G.element,errorElement:X.errorElement?X.errorElement:G.errorElement,hydrateFallbackElement:X.hydrateFallbackElement?X.hydrateFallbackElement:G.hydrateFallbackElement})}}function bM(s,a){return"id"in s&&"id"in a&&s.id===a.id?!0:s.index===a.index&&s.path===a.path&&s.caseSensitive===a.caseSensitive?(!s.children||s.children.length===0)&&(!a.children||a.children.length===0)?!0:s.children.every((l,u)=>a.children?.some(f=>bM(l,f))):!1}var fE=new WeakMap,wM=({key:s,route:a,manifest:l,mapRouteProperties:u})=>{let f=l[a.id];if(ar(f,"No route found in manifest"),!f.lazy||typeof f.lazy!="object")return;let y=f.lazy[s];if(!y)return;let w=fE.get(f);w||(w={},fE.set(f,w));let i=w[s];if(i)return i;let C=(async()=>{let P=lz(s),$=f[s]!==void 0&&s!=="hasErrorBoundary";if(P)Wo(!P,"Route property "+s+" is not a supported lazy route property. This property will be ignored."),w[s]=Promise.resolve();else if($)Wo(!1,`Route "${f.id}" has a static property "${s}" defined. The lazy property will be ignored.`);else{let G=await y();G!=null&&(Object.assign(f,{[s]:G}),Object.assign(f,u(f)))}typeof f.lazy=="object"&&(f.lazy[s]=void 0,Object.values(f.lazy).every(G=>G===void 0)&&(f.lazy=void 0))})();return w[s]=C,C},mE=new WeakMap;function Vz(s,a,l,u,f){let y=l[s.id];if(ar(y,"No route found in manifest"),!s.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof s.lazy=="function"){let D=mE.get(y);if(D)return{lazyRoutePromise:D,lazyHandlerPromise:D};let $=(async()=>{ar(typeof s.lazy=="function","No lazy route function found");let G=await s.lazy(),X={};for(let te in G){let le=G[te];if(le===void 0)continue;let re=uz(te),xe=y[te]!==void 0&&te!=="hasErrorBoundary";re?Wo(!re,"Route property "+te+" is not a supported property to be returned from a lazy route function. This property will be ignored."):xe?Wo(!xe,`Route "${y.id}" has a static property "${te}" defined but its lazy function is also returning a value for this property. The lazy route property "${te}" will be ignored.`):X[te]=le}Object.assign(y,X),Object.assign(y,{...u(y),lazy:void 0})})();return mE.set(y,$),$.catch(()=>{}),{lazyRoutePromise:$,lazyHandlerPromise:$}}let w=Object.keys(s.lazy),i=[],C;for(let D of w){if(f&&f.includes(D))continue;let $=wM({key:D,route:s,manifest:l,mapRouteProperties:u});$&&(i.push($),D===a&&(C=$))}let P=i.length>0?Promise.all(i).then(()=>{}):void 0;return P?.catch(()=>{}),C?.catch(()=>{}),{lazyRoutePromise:P,lazyHandlerPromise:C}}async function pE(s){let a=s.matches.filter(f=>f.shouldLoad),l={};return(await Promise.all(a.map(f=>f.resolve()))).forEach((f,y)=>{l[a[y].route.id]=f}),l}async function Hz(s){return s.matches.some(a=>a.route.middleware)?SM(s,()=>pE(s)):pE(s)}function SM(s,a){return Gz(s,a,u=>u,Qz,l);function l(u,f,y){if(y)return Promise.resolve(Object.assign(y.value,{[f]:{type:"error",result:u}}));{let{matches:w}=s,i=Math.min(Math.max(w.findIndex(P=>P.route.id===f),0),Math.max(w.findIndex(P=>P.unstable_shouldCallHandler()),0)),C=zp(w,w[i].route.id).route.id;return Promise.resolve({[C]:{type:"error",result:u}})}}}async function Gz(s,a,l,u,f){let{matches:y,request:w,params:i,context:C}=s,P=y.flatMap($=>$.route.middleware?$.route.middleware.map(G=>[$.route.id,G]):[]);return await TM({request:w,params:i,context:C},P,a,l,u,f)}async function TM(s,a,l,u,f,y,w=0){let{request:i}=s;if(i.signal.aborted)throw i.signal.reason??new Error(`Request aborted: ${i.method} ${i.url}`);let C=a[w];if(!C)return await l();let[P,D]=C,$,G=async()=>{if($)throw new Error("You may only call `next()` once per middleware");try{return $={value:await TM(s,a,l,u,f,y,w+1)},$.value}catch(X){return $={value:await y(X,P,$)},$.value}};try{let X=await D(s,G),te=X!=null?u(X):void 0;return f(te)?te:$?te??$.value:($={value:await G()},$.value)}catch(X){return await y(X,P,$)}}function kM(s,a,l,u,f){let y=wM({key:"middleware",route:u.route,manifest:a,mapRouteProperties:s}),w=Vz(u.route,bu(l.method)?"action":"loader",a,s,f);return{middleware:y,route:w.lazyRoutePromise,handler:w.lazyHandlerPromise}}function sS(s,a,l,u,f,y,w,i=null){let C=!1,P=kM(s,a,l,u,f);return{...u,_lazyPromises:P,shouldLoad:w,unstable_shouldRevalidateArgs:i,unstable_shouldCallHandler(D){return C=!0,i?typeof D=="boolean"?bb(u,{...i,defaultShouldRevalidate:D}):bb(u,i):w},resolve(D){let{lazy:$,loader:G,middleware:X}=u.route,te=C||w||D&&!bu(l.method)&&($||G),le=X&&X.length>0&&!G&&!$;return te&&!le?Wz({request:l,match:u,lazyHandlerPromise:P?.handler,lazyRoutePromise:P?.route,handlerOverride:D,scopedContext:y}):Promise.resolve({type:"data",result:void 0})}}}function py(s,a,l,u,f,y,w,i=null){return u.map(C=>C.route.id!==f.route.id?{...C,shouldLoad:!1,unstable_shouldRevalidateArgs:i,unstable_shouldCallHandler:()=>!1,_lazyPromises:kM(s,a,l,C,y),resolve:()=>Promise.resolve({type:"data",result:void 0})}:sS(s,a,l,C,y,w,!0,i))}async function qz(s,a,l,u,f,y){l.some(P=>P._lazyPromises?.middleware)&&await Promise.all(l.map(P=>P._lazyPromises?.middleware));let w={request:a,params:l[0].params,context:f,matches:l},C=await s({...w,fetcherKey:u,runClientMiddleware:P=>{let D=w;return SM(D,()=>P({...D,fetcherKey:u,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(l.flatMap(P=>[P._lazyPromises?.handler,P._lazyPromises?.route]))}catch{}return C}async function Wz({request:s,match:a,lazyHandlerPromise:l,lazyRoutePromise:u,handlerOverride:f,scopedContext:y}){let w,i,C=bu(s.method),P=C?"action":"loader",D=$=>{let G,X=new Promise((re,fe)=>G=fe);i=()=>G(),s.signal.addEventListener("abort",i);let te=re=>typeof $!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${P}" [routeId: ${a.route.id}]`)):$({request:s,params:a.params,context:y},...re!==void 0?[re]:[]),le=(async()=>{try{return{type:"data",result:await(f?f(fe=>te(fe)):te())}}catch(re){return{type:"error",result:re}}})();return Promise.race([le,X])};try{let $=C?a.route.action:a.route.loader;if(l||u)if($){let G,[X]=await Promise.all([D($).catch(te=>{G=te}),l,u]);if(G!==void 0)throw G;w=X}else{await l;let G=C?a.route.action:a.route.loader;if(G)[w]=await Promise.all([D(G),u]);else if(P==="action"){let X=new URL(s.url),te=X.pathname+X.search;throw Od(405,{method:s.method,pathname:te,routeId:a.route.id})}else return{type:"data",result:void 0}}else if($)w=await D($);else{let G=new URL(s.url),X=G.pathname+G.search;throw Od(404,{pathname:X})}}catch($){return{type:"error",result:$}}finally{i&&s.signal.removeEventListener("abort",i)}return w}async function Zz(s){let a=s.headers.get("Content-Type");return a&&/\bapplication\/json\b/.test(a)?s.body==null?null:s.json():s.text()}async function Xz(s){let{result:a,type:l}=s;if(AM(a)){let u;try{u=await Zz(a)}catch(f){return{type:"error",error:f}}return l==="error"?{type:"error",error:new xb(a.status,a.statusText,u),statusCode:a.status,headers:a.headers}:{type:"data",data:u,statusCode:a.status,headers:a.headers}}return l==="error"?bE(a)?a.data instanceof Error?{type:"error",error:a.data,statusCode:a.init?.status,headers:a.init?.headers?new Headers(a.init.headers):void 0}:{type:"error",error:new xb(a.init?.status||500,void 0,a.data),statusCode:lx(a)?a.status:void 0,headers:a.init?.headers?new Headers(a.init.headers):void 0}:{type:"error",error:a,statusCode:lx(a)?a.status:void 0}:bE(a)?{type:"data",data:a.data,statusCode:a.init?.status,headers:a.init?.headers?new Headers(a.init.headers):void 0}:{type:"data",data:a}}function Yz(s,a,l,u,f){let y=s.headers.get("Location");if(ar(y,"Redirects returned/thrown from loaders/actions must have a Location header"),!LS(y)){let w=u.slice(0,u.findIndex(i=>i.route.id===l)+1);y=aS(new URL(a.url),w,f,y),s.headers.set("Location",y)}return s}function gE(s,a,l){if(LS(s)){let u=s,f=u.startsWith("//")?new URL(a.protocol+u):new URL(u),y=Nd(f.pathname,l)!=null;if(f.origin===a.origin&&y)return f.pathname+f.search+f.hash}return s}function dy(s,a,l,u){let f=s.createURL(EM(a)).toString(),y={signal:l};if(u&&bu(u.formMethod)){let{formMethod:w,formEncType:i}=u;y.method=w.toUpperCase(),i==="application/json"?(y.headers=new Headers({"Content-Type":i}),y.body=JSON.stringify(u.json)):i==="text/plain"?y.body=u.text:i==="application/x-www-form-urlencoded"&&u.formData?y.body=oS(u.formData):y.body=u.formData}return new Request(f,y)}function oS(s){let a=new URLSearchParams;for(let[l,u]of s.entries())a.append(l,typeof u=="string"?u:u.name);return a}function _E(s){let a=new FormData;for(let[l,u]of s.entries())a.append(l,u);return a}function Kz(s,a,l,u=!1,f=!1){let y={},w=null,i,C=!1,P={},D=l&&Xu(l[1])?l[1].error:void 0;return s.forEach($=>{if(!($.route.id in a))return;let G=$.route.id,X=a[G];if(ar(!Xg(X),"Cannot handle redirect results in processLoaderData"),Xu(X)){let te=X.error;if(D!==void 0&&(te=D,D=void 0),w=w||{},f)w[G]=te;else{let le=zp(s,G);w[le.route.id]==null&&(w[le.route.id]=te)}u||(y[G]=xM),C||(C=!0,i=lx(X.error)?X.error.status:500),X.headers&&(P[G]=X.headers)}else y[G]=X.data,X.statusCode&&X.statusCode!==200&&!C&&(i=X.statusCode),X.headers&&(P[G]=X.headers)}),D!==void 0&&l&&(w={[l[0]]:D},l[2]&&(y[l[2]]=void 0)),{loaderData:y,errors:w,statusCode:i||200,loaderHeaders:P}}function yE(s,a,l,u,f,y){let{loaderData:w,errors:i}=Kz(a,l,u);return f.filter(C=>!C.matches||C.matches.some(P=>P.shouldLoad)).forEach(C=>{let{key:P,match:D,controller:$}=C;if($&&$.signal.aborted)return;let G=y[P];if(ar(G,"Did not find corresponding fetcher result"),Xu(G)){let X=zp(s.matches,D?.route.id);i&&i[X.route.id]||(i={...i,[X.route.id]:G.error}),s.fetchers.delete(P)}else if(Xg(G))ar(!1,"Unhandled fetcher revalidation redirect");else{let X=wm(G.data);s.fetchers.set(P,X)}}),{loaderData:w,errors:i}}function vE(s,a,l,u){let f=Object.entries(a).filter(([,y])=>y!==xM).reduce((y,[w,i])=>(y[w]=i,y),{});for(let y of l){let w=y.route.id;if(!a.hasOwnProperty(w)&&s.hasOwnProperty(w)&&y.route.loader&&(f[w]=s[w]),u&&u.hasOwnProperty(w))break}return f}function xE(s){return s?Xu(s[1])?{actionData:{}}:{actionData:{[s[0]]:s[1].data}}:{}}function zp(s,a){return(a?s.slice(0,s.findIndex(u=>u.route.id===a)+1):[...s]).reverse().find(u=>u.route.hasErrorBoundary===!0)||s[0]}function j0(s){let a=s.length===1?s[0]:s.find(l=>l.index||!l.path||l.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:a}],route:a}}function Od(s,{pathname:a,routeId:l,method:u,type:f,message:y}={}){let w="Unknown Server Error",i="Unknown @remix-run/router error";return s===400?(w="Bad Request",u&&a&&l?i=`You made a ${u} request to "${a}" but did not provide a \`loader\` for route "${l}", so there is no way to handle the request.`:f==="invalid-body"&&(i="Unable to encode submission body")):s===403?(w="Forbidden",i=`Route "${l}" does not match URL "${a}"`):s===404?(w="Not Found",i=`No route matches URL "${a}"`):s===405&&(w="Method Not Allowed",u&&a&&l?i=`You made a ${u.toUpperCase()} request to "${a}" but did not provide an \`action\` for route "${l}", so there is no way to handle the request.`:u&&(i=`Invalid request method "${u.toUpperCase()}"`)),new xb(s||500,w,new Error(i),!0)}function R0(s){let a=Object.entries(s);for(let l=a.length-1;l>=0;l--){let[u,f]=a[l];if(Xg(f))return{key:u,result:f}}}function EM(s){let a=typeof s=="string"?Zp(s):s;return Gp({...a,hash:""})}function Jz(s,a){return s.pathname!==a.pathname||s.search!==a.search?!1:s.hash===""?a.hash!=="":s.hash===a.hash?!0:a.hash!==""}function Qz(s){return s!=null&&typeof s=="object"&&Object.entries(s).every(([a,l])=>typeof a=="string"&&eD(l))}function eD(s){return s!=null&&typeof s=="object"&&"type"in s&&"result"in s&&(s.type==="data"||s.type==="error")}function tD(s){return AM(s.result)&&Iz.has(s.result.status)}function Xu(s){return s.type==="error"}function Xg(s){return(s&&s.type)==="redirect"}function bE(s){return typeof s=="object"&&s!=null&&"type"in s&&"data"in s&&"init"in s&&s.type==="DataWithResponseInit"}function AM(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.headers=="object"&&typeof s.body<"u"}function iD(s){return Lz.has(s.toUpperCase())}function bu(s){return jz.has(s.toUpperCase())}function zS(s){return new URLSearchParams(s).getAll("index").some(a=>a==="")}function ub(s,a){let l=typeof a=="string"?Zp(a).search:a.search;if(s[s.length-1].route.index&&zS(l||""))return s[s.length-1];let u=_M(s);return u[u.length-1]}function wE(s){let{formMethod:a,formAction:l,formEncType:u,text:f,formData:y,json:w}=s;if(!(!a||!l||!u)){if(f!=null)return{formMethod:a,formAction:l,formEncType:u,formData:void 0,json:void 0,text:f};if(y!=null)return{formMethod:a,formAction:l,formEncType:u,formData:y,json:void 0,text:void 0};if(w!==void 0)return{formMethod:a,formAction:l,formEncType:u,formData:void 0,json:w,text:void 0}}}function g1(s,a){return a?{state:"loading",location:s,formMethod:a.formMethod,formAction:a.formAction,formEncType:a.formEncType,formData:a.formData,json:a.json,text:a.text}:{state:"loading",location:s,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function nD(s,a){return{state:"submitting",location:s,formMethod:a.formMethod,formAction:a.formAction,formEncType:a.formEncType,formData:a.formData,json:a.json,text:a.text}}function Lv(s,a){return s?{state:"loading",formMethod:s.formMethod,formAction:s.formAction,formEncType:s.formEncType,formData:s.formData,json:s.json,text:s.text,data:a}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:a}}function aD(s,a){return{state:"submitting",formMethod:s.formMethod,formAction:s.formAction,formEncType:s.formEncType,formData:s.formData,json:s.json,text:s.text,data:a?a.data:void 0}}function wm(s){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:s}}function rD(s,a){try{let l=s.sessionStorage.getItem(vM);if(l){let u=JSON.parse(l);for(let[f,y]of Object.entries(u||{}))y&&Array.isArray(y)&&a.set(f,new Set(y||[]))}}catch{}}function sD(s,a){if(a.size>0){let l={};for(let[u,f]of a)l[u]=[...f];try{s.sessionStorage.setItem(vM,JSON.stringify(l))}catch(u){Wo(!1,`Failed to save applied view transitions in sessionStorage (${u}).`)}}}function oD(){let s,a,l=new Promise((u,f)=>{s=async y=>{u(y);try{await l}catch{}},a=async y=>{f(y);try{await l}catch{}}});return{promise:l,resolve:s,reject:a}}var i_=pe.createContext(null);i_.displayName="DataRouter";var vx=pe.createContext(null);vx.displayName="DataRouterState";pe.createContext(!1);var DS=pe.createContext({isTransitioning:!1});DS.displayName="ViewTransition";var CM=pe.createContext(new Map);CM.displayName="Fetchers";var lD=pe.createContext(null);lD.displayName="Await";var Sf=pe.createContext(null);Sf.displayName="Navigation";var Vb=pe.createContext(null);Vb.displayName="Location";var Eh=pe.createContext({outlet:null,matches:[],isDataRoute:!1});Eh.displayName="Route";var OS=pe.createContext(null);OS.displayName="RouteError";function cD(s,{relative:a}={}){ar(xx(),"useHref() may be used only in the context of a <Router> component.");let{basename:l,navigator:u}=pe.useContext(Sf),{hash:f,pathname:y,search:w}=bx(s,{relative:a}),i=y;return l!=="/"&&(i=y==="/"?l:wf([l,y])),u.createHref({pathname:i,search:w,hash:f})}function xx(){return pe.useContext(Vb)!=null}function $c(){return ar(xx(),"useLocation() may be used only in the context of a <Router> component."),pe.useContext(Vb).location}var MM="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function PM(s){pe.useContext(Sf).static||pe.useLayoutEffect(s)}function Ma(){let{isDataRoute:s}=pe.useContext(Eh);return s?TD():uD()}function uD(){ar(xx(),"useNavigate() may be used only in the context of a <Router> component.");let s=pe.useContext(i_),{basename:a,navigator:l}=pe.useContext(Sf),{matches:u}=pe.useContext(Eh),{pathname:f}=$c(),y=JSON.stringify(jS(u)),w=pe.useRef(!1);return PM(()=>{w.current=!0}),pe.useCallback((C,P={})=>{if(Wo(w.current,MM),!w.current)return;if(typeof C=="number"){l.go(C);return}let D=RS(C,JSON.parse(y),f,P.relative==="path");s==null&&a!=="/"&&(D.pathname=D.pathname==="/"?a:wf([a,D.pathname])),(P.replace?l.replace:l.push)(D,P.state,P)},[a,l,y,f,s])}var dD=pe.createContext(null);function hD(s){let a=pe.useContext(Eh).outlet;return pe.useMemo(()=>a&&pe.createElement(dD.Provider,{value:s},a),[a,s])}function ul(){let{matches:s}=pe.useContext(Eh),a=s[s.length-1];return a?a.params:{}}function bx(s,{relative:a}={}){let{matches:l}=pe.useContext(Eh),{pathname:u}=$c(),f=JSON.stringify(jS(l));return pe.useMemo(()=>RS(s,JSON.parse(f),u,a==="path"),[s,f,u,a])}function fD(s,a,l,u,f){ar(xx(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:y}=pe.useContext(Sf),{matches:w}=pe.useContext(Eh),i=w[w.length-1],C=i?i.params:{},P=i?i.pathname:"/",D=i?i.pathnameBase:"/",$=i&&i.route;{let xe=$&&$.path||"";jM(P,!$||xe.endsWith("*")||xe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${P}" (under <Route path="${xe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${xe}"> to <Route path="${xe==="/"?"*":`${xe}/*`}">.`)}let G=$c(),X;X=G;let te=X.pathname||"/",le=te;if(D!=="/"){let xe=D.replace(/^\//,"").split("/");le="/"+te.replace(/^\//,"").split("/").slice(xe.length).join("/")}let re=Ip(s,{pathname:le});return Wo($||re!=null,`No routes matched location "${X.pathname}${X.search}${X.hash}" `),Wo(re==null||re[re.length-1].route.element!==void 0||re[re.length-1].route.Component!==void 0||re[re.length-1].route.lazy!==void 0,`Matched leaf route at location "${X.pathname}${X.search}${X.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),yD(re&&re.map(xe=>Object.assign({},xe,{params:Object.assign({},C,xe.params),pathname:wf([D,y.encodeLocation?y.encodeLocation(xe.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:xe.pathname]),pathnameBase:xe.pathnameBase==="/"?D:wf([D,y.encodeLocation?y.encodeLocation(xe.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:xe.pathnameBase])})),w,l,u,f)}function mD(){let s=SD(),a=lx(s)?`${s.status} ${s.statusText}`:s instanceof Error?s.message:JSON.stringify(s),l=s instanceof Error?s.stack:null,u="rgba(200,200,200, 0.5)",f={padding:"0.5rem",backgroundColor:u},y={padding:"2px 4px",backgroundColor:u},w=null;return console.error("Error handled by React Router default ErrorBoundary:",s),w=pe.createElement(pe.Fragment,null,pe.createElement("p",null," Hey developer "),pe.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",pe.createElement("code",{style:y},"ErrorBoundary")," or"," ",pe.createElement("code",{style:y},"errorElement")," prop on your route.")),pe.createElement(pe.Fragment,null,pe.createElement("h2",null,"Unexpected Application Error!"),pe.createElement("h3",{style:{fontStyle:"italic"}},a),l?pe.createElement("pre",{style:f},l):null,w)}var pD=pe.createElement(mD,null),gD=class extends pe.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,a){return a.location!==s.location||a.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:a.error,location:a.location,revalidation:s.revalidation||a.revalidation}}componentDidCatch(s,a){this.props.unstable_onError?this.props.unstable_onError(s,a):console.error("React Router caught the following error during render",s)}render(){return this.state.error!==void 0?pe.createElement(Eh.Provider,{value:this.props.routeContext},pe.createElement(OS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function _D({routeContext:s,match:a,children:l}){let u=pe.useContext(i_);return u&&u.static&&u.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=a.route.id),pe.createElement(Eh.Provider,{value:s},l)}function yD(s,a=[],l=null,u=null,f=null){if(s==null){if(!l)return null;if(l.errors)s=l.matches;else if(a.length===0&&!l.initialized&&l.matches.length>0)s=l.matches;else return null}let y=s,w=l?.errors;if(w!=null){let P=y.findIndex(D=>D.route.id&&w?.[D.route.id]!==void 0);ar(P>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(w).join(",")}`),y=y.slice(0,Math.min(y.length,P+1))}let i=!1,C=-1;if(l)for(let P=0;P<y.length;P++){let D=y[P];if((D.route.HydrateFallback||D.route.hydrateFallbackElement)&&(C=P),D.route.id){let{loaderData:$,errors:G}=l,X=D.route.loader&&!$.hasOwnProperty(D.route.id)&&(!G||G[D.route.id]===void 0);if(D.route.lazy||X){i=!0,C>=0?y=y.slice(0,C+1):y=[y[0]];break}}}return y.reduceRight((P,D,$)=>{let G,X=!1,te=null,le=null;l&&(G=w&&D.route.id?w[D.route.id]:void 0,te=D.route.errorElement||pD,i&&(C<0&&$===0?(jM("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),X=!0,le=null):C===$&&(X=!0,le=D.route.hydrateFallbackElement||null)));let re=a.concat(y.slice(0,$+1)),fe=()=>{let xe;return G?xe=te:X?xe=le:D.route.Component?xe=pe.createElement(D.route.Component,null):D.route.element?xe=D.route.element:xe=P,pe.createElement(_D,{match:D,routeContext:{outlet:P,matches:re,isDataRoute:l!=null},children:xe})};return l&&(D.route.ErrorBoundary||D.route.errorElement||$===0)?pe.createElement(gD,{location:l.location,revalidation:l.revalidation,component:te,error:G,children:fe(),routeContext:{outlet:null,matches:re,isDataRoute:!0},unstable_onError:u}):fe()},null)}function NS(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function vD(s){let a=pe.useContext(i_);return ar(a,NS(s)),a}function xD(s){let a=pe.useContext(vx);return ar(a,NS(s)),a}function bD(s){let a=pe.useContext(Eh);return ar(a,NS(s)),a}function FS(s){let a=bD(s),l=a.matches[a.matches.length-1];return ar(l.route.id,`${s} can only be used on routes that contain a unique "id"`),l.route.id}function wD(){return FS("useRouteId")}function SD(){let s=pe.useContext(OS),a=xD("useRouteError"),l=FS("useRouteError");return s!==void 0?s:a.errors?.[l]}function TD(){let{router:s}=vD("useNavigate"),a=FS("useNavigate"),l=pe.useRef(!1);return PM(()=>{l.current=!0}),pe.useCallback(async(f,y={})=>{Wo(l.current,MM),l.current&&(typeof f=="number"?s.navigate(f):await s.navigate(f,{fromRouteId:a,...y}))},[s,a])}var SE={};function jM(s,a,l){!a&&!SE[s]&&(SE[s]=!0,Wo(!1,l))}var TE={};function kE(s,a){!s&&!TE[a]&&(TE[a]=!0,console.warn(a))}function kD(s){let a={hasErrorBoundary:s.hasErrorBoundary||s.ErrorBoundary!=null||s.errorElement!=null};return s.Component&&(s.element&&Wo(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(a,{element:pe.createElement(s.Component),Component:void 0})),s.HydrateFallback&&(s.hydrateFallbackElement&&Wo(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(a,{hydrateFallbackElement:pe.createElement(s.HydrateFallback),HydrateFallback:void 0})),s.ErrorBoundary&&(s.errorElement&&Wo(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(a,{errorElement:pe.createElement(s.ErrorBoundary),ErrorBoundary:void 0})),a}var ED=["HydrateFallback","hydrateFallbackElement"],AD=class{constructor(){this.status="pending",this.promise=new Promise((a,l)=>{this.resolve=u=>{this.status==="pending"&&(this.status="resolved",a(u))},this.reject=u=>{this.status==="pending"&&(this.status="rejected",l(u))}})}};function CD({router:s,flushSync:a,unstable_onError:l}){let[u,f]=pe.useState(s.state),[y,w]=pe.useState(),[i,C]=pe.useState({isTransitioning:!1}),[P,D]=pe.useState(),[$,G]=pe.useState(),[X,te]=pe.useState(),le=pe.useRef(new Map),re=pe.useCallback(Be=>{f(Ee=>(Be.errors&&l&&Object.entries(Be.errors).forEach(([et,at])=>{Ee.errors?.[et]!==at&&l(at)}),Be))},[l]),fe=pe.useCallback((Be,{deletedFetchers:Ee,flushSync:et,viewTransitionOpts:at})=>{Be.fetchers.forEach((lt,pt)=>{lt.data!==void 0&&le.current.set(pt,lt.data)}),Ee.forEach(lt=>le.current.delete(lt)),kE(et===!1||a!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let He=s.window!=null&&s.window.document!=null&&typeof s.window.document.startViewTransition=="function";if(kE(at==null||He,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!at||!He){a&&et?a(()=>re(Be)):pe.startTransition(()=>re(Be));return}if(a&&et){a(()=>{$&&(P&&P.resolve(),$.skipTransition()),C({isTransitioning:!0,flushSync:!0,currentLocation:at.currentLocation,nextLocation:at.nextLocation})});let lt=s.window.document.startViewTransition(()=>{a(()=>re(Be))});lt.finished.finally(()=>{a(()=>{D(void 0),G(void 0),w(void 0),C({isTransitioning:!1})})}),a(()=>G(lt));return}$?(P&&P.resolve(),$.skipTransition(),te({state:Be,currentLocation:at.currentLocation,nextLocation:at.nextLocation})):(w(Be),C({isTransitioning:!0,flushSync:!1,currentLocation:at.currentLocation,nextLocation:at.nextLocation}))},[s.window,a,$,P,re]);pe.useLayoutEffect(()=>s.subscribe(fe),[s,fe]),pe.useEffect(()=>{i.isTransitioning&&!i.flushSync&&D(new AD)},[i]),pe.useEffect(()=>{if(P&&y&&s.window){let Be=y,Ee=P.promise,et=s.window.document.startViewTransition(async()=>{pe.startTransition(()=>re(Be)),await Ee});et.finished.finally(()=>{D(void 0),G(void 0),w(void 0),C({isTransitioning:!1})}),G(et)}},[y,P,s.window,re]),pe.useEffect(()=>{P&&y&&u.location.key===y.location.key&&P.resolve()},[P,$,u.location,y]),pe.useEffect(()=>{!i.isTransitioning&&X&&(w(X.state),C({isTransitioning:!0,flushSync:!1,currentLocation:X.currentLocation,nextLocation:X.nextLocation}),te(void 0))},[i.isTransitioning,X]);let xe=pe.useMemo(()=>({createHref:s.createHref,encodeLocation:s.encodeLocation,go:Be=>s.navigate(Be),push:(Be,Ee,et)=>s.navigate(Be,{state:Ee,preventScrollReset:et?.preventScrollReset}),replace:(Be,Ee,et)=>s.navigate(Be,{replace:!0,state:Ee,preventScrollReset:et?.preventScrollReset})}),[s]),be=s.basename||"/",Ne=pe.useMemo(()=>({router:s,navigator:xe,static:!1,basename:be,unstable_onError:l}),[s,xe,be,l]);return pe.createElement(pe.Fragment,null,pe.createElement(i_.Provider,{value:Ne},pe.createElement(vx.Provider,{value:u},pe.createElement(CM.Provider,{value:le.current},pe.createElement(DS.Provider,{value:i},pe.createElement(RD,{basename:be,location:u.location,navigationType:u.historyAction,navigator:xe},pe.createElement(MD,{routes:s.routes,future:s.future,state:u,unstable_onError:l})))))),null)}var MD=pe.memo(PD);function PD({routes:s,future:a,state:l,unstable_onError:u}){return fD(s,void 0,l,u,a)}function jD(s){return hD(s.context)}function wa(s){ar(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function RD({basename:s="/",children:a=null,location:l,navigationType:u="POP",navigator:f,static:y=!1}){ar(!xx(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let w=s.replace(/^\/*/,"/"),i=pe.useMemo(()=>({basename:w,navigator:f,static:y,future:{}}),[w,f,y]);typeof l=="string"&&(l=Zp(l));let{pathname:C="/",search:P="",hash:D="",state:$=null,key:G="default"}=l,X=pe.useMemo(()=>{let te=Nd(C,w);return te==null?null:{location:{pathname:te,search:P,hash:D,state:$,key:G},navigationType:u}},[w,C,P,D,$,G,u]);return Wo(X!=null,`<Router basename="${w}"> is not able to match the URL "${C}${P}${D}" because it does not start with the basename, so the <Router> won't render anything.`),X==null?null:pe.createElement(Sf.Provider,{value:i},pe.createElement(Vb.Provider,{children:a,value:X}))}function lS(s,a=[]){let l=[];return pe.Children.forEach(s,(u,f)=>{if(!pe.isValidElement(u))return;let y=[...a,f];if(u.type===pe.Fragment){l.push.apply(l,lS(u.props.children,y));return}ar(u.type===wa,`[${typeof u.type=="string"?u.type:u.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ar(!u.props.index||!u.props.children,"An index route cannot have child routes.");let w={id:u.props.id||y.join("-"),caseSensitive:u.props.caseSensitive,element:u.props.element,Component:u.props.Component,index:u.props.index,path:u.props.path,middleware:u.props.middleware,loader:u.props.loader,action:u.props.action,hydrateFallbackElement:u.props.hydrateFallbackElement,HydrateFallback:u.props.HydrateFallback,errorElement:u.props.errorElement,ErrorBoundary:u.props.ErrorBoundary,hasErrorBoundary:u.props.hasErrorBoundary===!0||u.props.ErrorBoundary!=null||u.props.errorElement!=null,shouldRevalidate:u.props.shouldRevalidate,handle:u.props.handle,lazy:u.props.lazy};u.props.children&&(w.children=lS(u.props.children,y)),l.push(w)}),l}var LD=lS,db="get",hb="application/x-www-form-urlencoded";function Hb(s){return s!=null&&typeof s.tagName=="string"}function ID(s){return Hb(s)&&s.tagName.toLowerCase()==="button"}function zD(s){return Hb(s)&&s.tagName.toLowerCase()==="form"}function DD(s){return Hb(s)&&s.tagName.toLowerCase()==="input"}function OD(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function ND(s,a){return s.button===0&&(!a||a==="_self")&&!OD(s)}var L0=null;function FD(){if(L0===null)try{new FormData(document.createElement("form"),0),L0=!1}catch{L0=!0}return L0}var BD=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function _1(s){return s!=null&&!BD.has(s)?(Wo(!1,`"${s}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${hb}"`),null):s}function UD(s,a){let l,u,f,y,w;if(zD(s)){let i=s.getAttribute("action");u=i?Nd(i,a):null,l=s.getAttribute("method")||db,f=_1(s.getAttribute("enctype"))||hb,y=new FormData(s)}else if(ID(s)||DD(s)&&(s.type==="submit"||s.type==="image")){let i=s.form;if(i==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let C=s.getAttribute("formaction")||i.getAttribute("action");if(u=C?Nd(C,a):null,l=s.getAttribute("formmethod")||i.getAttribute("method")||db,f=_1(s.getAttribute("formenctype"))||_1(i.getAttribute("enctype"))||hb,y=new FormData(i,s),!FD()){let{name:P,type:D,value:$}=s;if(D==="image"){let G=P?`${P}.`:"";y.append(`${G}x`,"0"),y.append(`${G}y`,"0")}else P&&y.append(P,$)}}else{if(Hb(s))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');l=db,u=null,f=hb,w=s}return y&&f==="text/plain"&&(w=y,y=void 0),{action:u,method:l.toLowerCase(),encType:f,formData:y,body:w}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function BS(s,a){if(s===!1||s===null||typeof s>"u")throw new Error(a)}function $D(s,a,l){let u=typeof s=="string"?new URL(s,typeof window>"u"?"server://singlefetch/":window.location.origin):s;return u.pathname==="/"?u.pathname=`_root.${l}`:a&&Nd(u.pathname,a)==="/"?u.pathname=`${a.replace(/\/$/,"")}/_root.${l}`:u.pathname=`${u.pathname.replace(/\/$/,"")}.${l}`,u}async function VD(s,a){if(s.id in a)return a[s.id];try{let l=await import(s.module);return a[s.id]=l,l}catch(l){return console.error(`Error loading route module \`${s.module}\`, reloading page...`),console.error(l),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function HD(s){return s==null?!1:s.href==null?s.rel==="preload"&&typeof s.imageSrcSet=="string"&&typeof s.imageSizes=="string":typeof s.rel=="string"&&typeof s.href=="string"}async function GD(s,a,l){let u=await Promise.all(s.map(async f=>{let y=a.routes[f.route.id];if(y){let w=await VD(y,l);return w.links?w.links():[]}return[]}));return XD(u.flat(1).filter(HD).filter(f=>f.rel==="stylesheet"||f.rel==="preload").map(f=>f.rel==="stylesheet"?{...f,rel:"prefetch",as:"style"}:{...f,rel:"prefetch"}))}function EE(s,a,l,u,f,y){let w=(C,P)=>l[P]?C.route.id!==l[P].route.id:!0,i=(C,P)=>l[P].pathname!==C.pathname||l[P].route.path?.endsWith("*")&&l[P].params["*"]!==C.params["*"];return y==="assets"?a.filter((C,P)=>w(C,P)||i(C,P)):y==="data"?a.filter((C,P)=>{let D=u.routes[C.route.id];if(!D||!D.hasLoader)return!1;if(w(C,P)||i(C,P))return!0;if(C.route.shouldRevalidate){let $=C.route.shouldRevalidate({currentUrl:new URL(f.pathname+f.search+f.hash,window.origin),currentParams:l[0]?.params||{},nextUrl:new URL(s,window.origin),nextParams:C.params,defaultShouldRevalidate:!0});if(typeof $=="boolean")return $}return!0}):[]}function qD(s,a,{includeHydrateFallback:l}={}){return WD(s.map(u=>{let f=a.routes[u.route.id];if(!f)return[];let y=[f.module];return f.clientActionModule&&(y=y.concat(f.clientActionModule)),f.clientLoaderModule&&(y=y.concat(f.clientLoaderModule)),l&&f.hydrateFallbackModule&&(y=y.concat(f.hydrateFallbackModule)),f.imports&&(y=y.concat(f.imports)),y}).flat(1))}function WD(s){return[...new Set(s)]}function ZD(s){let a={},l=Object.keys(s).sort();for(let u of l)a[u]=s[u];return a}function XD(s,a){let l=new Set;return new Set(a),s.reduce((u,f)=>{let y=JSON.stringify(ZD(f));return l.has(y)||(l.add(y),u.push({key:y,link:f})),u},[])}function RM(){let s=pe.useContext(i_);return BS(s,"You must render this element inside a <DataRouterContext.Provider> element"),s}function YD(){let s=pe.useContext(vx);return BS(s,"You must render this element inside a <DataRouterStateContext.Provider> element"),s}var US=pe.createContext(void 0);US.displayName="FrameworkContext";function LM(){let s=pe.useContext(US);return BS(s,"You must render this element inside a <HydratedRouter> element"),s}function KD(s,a){let l=pe.useContext(US),[u,f]=pe.useState(!1),[y,w]=pe.useState(!1),{onFocus:i,onBlur:C,onMouseEnter:P,onMouseLeave:D,onTouchStart:$}=a,G=pe.useRef(null);pe.useEffect(()=>{if(s==="render"&&w(!0),s==="viewport"){let le=fe=>{fe.forEach(xe=>{w(xe.isIntersecting)})},re=new IntersectionObserver(le,{threshold:.5});return G.current&&re.observe(G.current),()=>{re.disconnect()}}},[s]),pe.useEffect(()=>{if(u){let le=setTimeout(()=>{w(!0)},100);return()=>{clearTimeout(le)}}},[u]);let X=()=>{f(!0)},te=()=>{f(!1),w(!1)};return l?s!=="intent"?[y,G,{}]:[y,G,{onFocus:Iv(i,X),onBlur:Iv(C,te),onMouseEnter:Iv(P,X),onMouseLeave:Iv(D,te),onTouchStart:Iv($,X)}]:[!1,G,{}]}function Iv(s,a){return l=>{s&&s(l),l.defaultPrevented||a(l)}}function JD({page:s,...a}){let{router:l}=RM(),u=pe.useMemo(()=>Ip(l.routes,s,l.basename),[l.routes,s,l.basename]);return u?pe.createElement(eO,{page:s,matches:u,...a}):null}function QD(s){let{manifest:a,routeModules:l}=LM(),[u,f]=pe.useState([]);return pe.useEffect(()=>{let y=!1;return GD(s,a,l).then(w=>{y||f(w)}),()=>{y=!0}},[s,a,l]),u}function eO({page:s,matches:a,...l}){let u=$c(),{manifest:f,routeModules:y}=LM(),{basename:w}=RM(),{loaderData:i,matches:C}=YD(),P=pe.useMemo(()=>EE(s,a,C,f,u,"data"),[s,a,C,f,u]),D=pe.useMemo(()=>EE(s,a,C,f,u,"assets"),[s,a,C,f,u]),$=pe.useMemo(()=>{if(s===u.pathname+u.search+u.hash)return[];let te=new Set,le=!1;if(a.forEach(fe=>{let xe=f.routes[fe.route.id];!xe||!xe.hasLoader||(!P.some(be=>be.route.id===fe.route.id)&&fe.route.id in i&&y[fe.route.id]?.shouldRevalidate||xe.hasClientLoader?le=!0:te.add(fe.route.id))}),te.size===0)return[];let re=$D(s,w,"data");return le&&te.size>0&&re.searchParams.set("_routes",a.filter(fe=>te.has(fe.route.id)).map(fe=>fe.route.id).join(",")),[re.pathname+re.search]},[w,i,u,f,P,a,s,y]),G=pe.useMemo(()=>qD(D,f),[D,f]),X=QD(D);return pe.createElement(pe.Fragment,null,$.map(te=>pe.createElement("link",{key:te,rel:"prefetch",as:"fetch",href:te,...l})),G.map(te=>pe.createElement("link",{key:te,rel:"modulepreload",href:te,...l})),X.map(({key:te,link:le})=>pe.createElement("link",{key:te,nonce:l.nonce,...le})))}function tO(...s){return a=>{s.forEach(l=>{typeof l=="function"?l(a):l!=null&&(l.current=a)})}}var IM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{IM&&(window.__reactRouterVersion="7.9.3")}catch{}function iO(s,a){return Fz({basename:a?.basename,getContext:a?.getContext,future:a?.future,history:az({window:a?.window}),hydrationData:nO(),routes:s,mapRouteProperties:kD,hydrationRouteProperties:ED,dataStrategy:a?.dataStrategy,patchRoutesOnNavigation:a?.patchRoutesOnNavigation,window:a?.window}).initialize()}function nO(){let s=window?.__staticRouterHydrationData;return s&&s.errors&&(s={...s,errors:aO(s.errors)}),s}function aO(s){if(!s)return null;let a=Object.entries(s),l={};for(let[u,f]of a)if(f&&f.__type==="RouteErrorResponse")l[u]=new xb(f.status,f.statusText,f.data,f.internal===!0);else if(f&&f.__type==="Error"){if(f.__subType){let y=window[f.__subType];if(typeof y=="function")try{let w=new y(f.message);w.stack="",l[u]=w}catch{}}if(l[u]==null){let y=new Error(f.message);y.stack="",l[u]=y}}else l[u]=f;return l}var zM=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,DM=pe.forwardRef(function({onClick:a,discover:l="render",prefetch:u="none",relative:f,reloadDocument:y,replace:w,state:i,target:C,to:P,preventScrollReset:D,viewTransition:$,...G},X){let{basename:te}=pe.useContext(Sf),le=typeof P=="string"&&zM.test(P),re,fe=!1;if(typeof P=="string"&&le&&(re=P,IM))try{let He=new URL(window.location.href),lt=P.startsWith("//")?new URL(He.protocol+P):new URL(P),pt=Nd(lt.pathname,te);lt.origin===He.origin&&pt!=null?P=pt+lt.search+lt.hash:fe=!0}catch{Wo(!1,`<Link to="${P}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let xe=cD(P,{relative:f}),[be,Ne,Be]=KD(u,G),Ee=oO(P,{replace:w,state:i,target:C,preventScrollReset:D,relative:f,viewTransition:$});function et(He){a&&a(He),He.defaultPrevented||Ee(He)}let at=pe.createElement("a",{...G,...Be,href:re||xe,onClick:fe||y?a:et,ref:tO(X,Ne),target:C,"data-discover":!le&&l==="render"?"true":void 0});return be&&!le?pe.createElement(pe.Fragment,null,at,pe.createElement(JD,{page:xe})):at});DM.displayName="Link";var $s=pe.forwardRef(function({"aria-current":a="page",caseSensitive:l=!1,className:u="",end:f=!1,style:y,to:w,viewTransition:i,children:C,...P},D){let $=bx(w,{relative:P.relative}),G=$c(),X=pe.useContext(vx),{navigator:te,basename:le}=pe.useContext(Sf),re=X!=null&&hO($)&&i===!0,fe=te.encodeLocation?te.encodeLocation($).pathname:$.pathname,xe=G.pathname,be=X&&X.navigation&&X.navigation.location?X.navigation.location.pathname:null;l||(xe=xe.toLowerCase(),be=be?be.toLowerCase():null,fe=fe.toLowerCase()),be&&le&&(be=Nd(be,le)||be);const Ne=fe!=="/"&&fe.endsWith("/")?fe.length-1:fe.length;let Be=xe===fe||!f&&xe.startsWith(fe)&&xe.charAt(Ne)==="/",Ee=be!=null&&(be===fe||!f&&be.startsWith(fe)&&be.charAt(fe.length)==="/"),et={isActive:Be,isPending:Ee,isTransitioning:re},at=Be?a:void 0,He;typeof u=="function"?He=u(et):He=[u,Be?"active":null,Ee?"pending":null,re?"transitioning":null].filter(Boolean).join(" ");let lt=typeof y=="function"?y(et):y;return pe.createElement(DM,{...P,"aria-current":at,className:He,ref:D,style:lt,to:w,viewTransition:i},typeof C=="function"?C(et):C)});$s.displayName="NavLink";var rO=pe.forwardRef(({discover:s="render",fetcherKey:a,navigate:l,reloadDocument:u,replace:f,state:y,method:w=db,action:i,onSubmit:C,relative:P,preventScrollReset:D,viewTransition:$,...G},X)=>{let te=uO(),le=dO(i,{relative:P}),re=w.toLowerCase()==="get"?"get":"post",fe=typeof i=="string"&&zM.test(i),xe=be=>{if(C&&C(be),be.defaultPrevented)return;be.preventDefault();let Ne=be.nativeEvent.submitter,Be=Ne?.getAttribute("formmethod")||w;te(Ne||be.currentTarget,{fetcherKey:a,method:Be,navigate:l,replace:f,state:y,relative:P,preventScrollReset:D,viewTransition:$})};return pe.createElement("form",{ref:X,method:re,action:le,onSubmit:u?C:xe,...G,"data-discover":!fe&&s==="render"?"true":void 0})});rO.displayName="Form";function sO(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function OM(s){let a=pe.useContext(i_);return ar(a,sO(s)),a}function oO(s,{target:a,replace:l,state:u,preventScrollReset:f,relative:y,viewTransition:w}={}){let i=Ma(),C=$c(),P=bx(s,{relative:y});return pe.useCallback(D=>{if(ND(D,a)){D.preventDefault();let $=l!==void 0?l:Gp(C)===Gp(P);i(s,{replace:$,state:u,preventScrollReset:f,relative:y,viewTransition:w})}},[C,i,P,l,u,a,s,f,y,w])}var lO=0,cO=()=>`__${String(++lO)}__`;function uO(){let{router:s}=OM("useSubmit"),{basename:a}=pe.useContext(Sf),l=wD();return pe.useCallback(async(u,f={})=>{let{action:y,method:w,encType:i,formData:C,body:P}=UD(u,a);if(f.navigate===!1){let D=f.fetcherKey||cO();await s.fetch(D,l,f.action||y,{preventScrollReset:f.preventScrollReset,formData:C,body:P,formMethod:f.method||w,formEncType:f.encType||i,flushSync:f.flushSync})}else await s.navigate(f.action||y,{preventScrollReset:f.preventScrollReset,formData:C,body:P,formMethod:f.method||w,formEncType:f.encType||i,replace:f.replace,state:f.state,fromRouteId:l,flushSync:f.flushSync,viewTransition:f.viewTransition})},[s,a,l])}function dO(s,{relative:a}={}){let{basename:l}=pe.useContext(Sf),u=pe.useContext(Eh);ar(u,"useFormAction must be used inside a RouteContext");let[f]=u.matches.slice(-1),y={...bx(s||".",{relative:a})},w=$c();if(s==null){y.search=w.search;let i=new URLSearchParams(y.search),C=i.getAll("index");if(C.some(D=>D==="")){i.delete("index"),C.filter($=>$).forEach($=>i.append("index",$));let D=i.toString();y.search=D?`?${D}`:""}}return(!s||s===".")&&f.route.index&&(y.search=y.search?y.search.replace(/^\?/,"?index&"):"?index"),l!=="/"&&(y.pathname=y.pathname==="/"?l:wf([l,y.pathname])),Gp(y)}function hO(s,{relative:a}={}){let l=pe.useContext(DS);ar(l!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:u}=OM("useViewTransitionState"),f=bx(s,{relative:a});if(!l.isTransitioning)return!1;let y=Nd(l.currentLocation.pathname,u)||l.currentLocation.pathname,w=Nd(l.nextLocation.pathname,u)||l.nextLocation.pathname;return vb(f.pathname,w)!=null||vb(f.pathname,y)!=null}var fO=hM();function mO(s){return pe.createElement(CD,{flushSync:fO.flushSync,...s})}var NM={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},AE=Up.createContext&&Up.createContext(NM),pO=["attr","size","title"];function gO(s,a){if(s==null)return{};var l=_O(s,a),u,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(s);for(f=0;f<y.length;f++)u=y[f],!(a.indexOf(u)>=0)&&Object.prototype.propertyIsEnumerable.call(s,u)&&(l[u]=s[u])}return l}function _O(s,a){if(s==null)return{};var l={};for(var u in s)if(Object.prototype.hasOwnProperty.call(s,u)){if(a.indexOf(u)>=0)continue;l[u]=s[u]}return l}function wb(){return wb=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var l=arguments[a];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(s[u]=l[u])}return s},wb.apply(this,arguments)}function CE(s,a){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(s);a&&(u=u.filter(function(f){return Object.getOwnPropertyDescriptor(s,f).enumerable})),l.push.apply(l,u)}return l}function Sb(s){for(var a=1;a<arguments.length;a++){var l=arguments[a]!=null?arguments[a]:{};a%2?CE(Object(l),!0).forEach(function(u){yO(s,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):CE(Object(l)).forEach(function(u){Object.defineProperty(s,u,Object.getOwnPropertyDescriptor(l,u))})}return s}function yO(s,a,l){return a=vO(a),a in s?Object.defineProperty(s,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[a]=l,s}function vO(s){var a=xO(s,"string");return typeof a=="symbol"?a:a+""}function xO(s,a){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var u=l.call(s,a);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function FM(s){return s&&s.map((a,l)=>Up.createElement(a.tag,Sb({key:l},a.attr),FM(a.child)))}function Rn(s){return a=>Up.createElement(bO,wb({attr:Sb({},s.attr)},a),FM(s.child))}function bO(s){var a=l=>{var{attr:u,size:f,title:y}=s,w=gO(s,pO),i=f||l.size||"1em",C;return l.className&&(C=l.className),s.className&&(C=(C?C+" ":"")+s.className),Up.createElement("svg",wb({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},l.attr,u,w,{className:C,style:Sb(Sb({color:s.color||l.color},l.style),s.style),height:i,width:i,xmlns:"http://www.w3.org/2000/svg"}),y&&Up.createElement("title",null,y),s.children)};return AE!==void 0?Up.createElement(AE.Consumer,null,l=>a(l)):a(NM)}function wO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10 2l-.15 .005a2 2 0 0 0 -1.85 1.995v6.999l-2.586 .001a2 2 0 0 0 -1.414 3.414l6.586 6.586a2 2 0 0 0 2.828 0l6.586 -6.586a2 2 0 0 0 .434 -2.18l-.068 -.145a2 2 0 0 0 -1.78 -1.089l-2.586 -.001v-6.999a2 2 0 0 0 -2 -2h-4z"},child:[]}]})(s)}function SO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9.586 4l-6.586 6.586a2 2 0 0 0 0 2.828l6.586 6.586a2 2 0 0 0 2.18 .434l.145 -.068a2 2 0 0 0 1.089 -1.78v-2.586h7a2 2 0 0 0 2 -2v-4l-.005 -.15a2 2 0 0 0 -1.995 -1.85l-7 -.001v-2.585a2 2 0 0 0 -3.414 -1.414z"},child:[]}]})(s)}function TO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z"},child:[]}]})(s)}function kO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10.586 3l-6.586 6.586a2 2 0 0 0 -.434 2.18l.068 .145a2 2 0 0 0 1.78 1.089h2.586v7a2 2 0 0 0 2 2h4l.15 -.005a2 2 0 0 0 1.85 -1.995l-.001 -7h2.587a2 2 0 0 0 1.414 -3.414l-6.586 -6.586a2 2 0 0 0 -2.828 0z"},child:[]}]})(s)}function EO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M14 2a5 5 0 0 1 5 5v14a1 1 0 0 1 -1.555 .832l-5.445 -3.63l-5.444 3.63a1 1 0 0 1 -1.55 -.72l-.006 -.112v-14a5 5 0 0 1 5 -5h4z"},child:[]}]})(s)}function BM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18 9c.852 0 1.297 .986 .783 1.623l-.076 .084l-6 6a1 1 0 0 1 -1.32 .083l-.094 -.083l-6 -6l-.083 -.094l-.054 -.077l-.054 -.096l-.017 -.036l-.027 -.067l-.032 -.108l-.01 -.053l-.01 -.06l-.004 -.057v-.118l.005 -.058l.009 -.06l.01 -.052l.032 -.108l.027 -.067l.07 -.132l.065 -.09l.073 -.081l.094 -.083l.077 -.054l.096 -.054l.036 -.017l.067 -.027l.108 -.032l.053 -.01l.06 -.01l.057 -.004l12.059 -.002z"},child:[]}]})(s)}function UM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11.293 7.293a1 1 0 0 1 1.32 -.083l.094 .083l6 6l.083 .094l.054 .077l.054 .096l.017 .036l.027 .067l.032 .108l.01 .053l.01 .06l.004 .057l.002 .059l-.002 .059l-.005 .058l-.009 .06l-.01 .052l-.032 .108l-.027 .067l-.07 .132l-.065 .09l-.073 .081l-.094 .083l-.077 .054l-.096 .054l-.036 .017l-.067 .027l-.108 .032l-.053 .01l-.06 .01l-.057 .004l-.059 .002h-12c-.852 0 -1.297 -.986 -.783 -1.623l.076 -.084l6 -6z"},child:[]}]})(s)}function AO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M7 3.34a10 10 0 1 1 -4.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 4.995 -8.336z"},child:[]}]})(s)}function $M(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z"},child:[]}]})(s)}function CO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 1a.993 .993 0 0 1 .823 .443l.067 .116l2.852 5.781l6.38 .925c.741 .108 1.08 .94 .703 1.526l-.07 .095l-.078 .086l-4.624 4.499l1.09 6.355a1.001 1.001 0 0 1 -1.249 1.135l-.101 -.035l-.101 -.046l-5.693 -3l-5.706 3c-.105 .055 -.212 .09 -.32 .106l-.106 .01a1.003 1.003 0 0 1 -1.038 -1.06l.013 -.11l1.09 -6.355l-4.623 -4.5a1.001 1.001 0 0 1 .328 -1.647l.113 -.036l.114 -.023l6.379 -.925l2.853 -5.78a.968 .968 0 0 1 .904 -.56zm0 3.274v12.476a1 1 0 0 1 .239 .029l.115 .036l.112 .05l4.363 2.299l-.836 -4.873a1 1 0 0 1 .136 -.696l.07 -.099l.082 -.09l3.546 -3.453l-4.891 -.708a1 1 0 0 1 -.62 -.344l-.073 -.097l-.06 -.106l-2.183 -4.424z"},child:[]}]})(s)}function Zo(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8.243 7.34l-6.38 .925l-.113 .023a1 1 0 0 0 -.44 1.684l4.622 4.499l-1.09 6.355l-.013 .11a1 1 0 0 0 1.464 .944l5.706 -3l5.693 3l.1 .046a1 1 0 0 0 1.352 -1.1l-1.091 -6.355l4.624 -4.5l.078 -.085a1 1 0 0 0 -.633 -1.62l-6.38 -.926l-2.852 -5.78a1 1 0 0 0 -1.794 0l-2.853 5.78z"},child:[]}]})(s)}function MO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M4 6l8 0"},child:[]},{tag:"path",attr:{d:"M16 6l4 0"},child:[]},{tag:"path",attr:{d:"M8 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M4 12l2 0"},child:[]},{tag:"path",attr:{d:"M10 12l10 0"},child:[]},{tag:"path",attr:{d:"M17 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M4 18l11 0"},child:[]},{tag:"path",attr:{d:"M19 18l1 0"},child:[]}]})(s)}function VM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12l14 0"},child:[]},{tag:"path",attr:{d:"M13 18l6 -6"},child:[]},{tag:"path",attr:{d:"M13 6l6 6"},child:[]}]})(s)}function PO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 5a2 2 0 1 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3h-16a4 4 0 0 0 2 -3v-3a7 7 0 0 1 4 -6"},child:[]},{tag:"path",attr:{d:"M9 17v1a3 3 0 0 0 6 0v-1"},child:[]}]})(s)}function HM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 7v14l-6 -4l-6 4v-14a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4z"},child:[]}]})(s)}function jO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12.4 3a5.34 5.34 0 0 1 4.906 3.239a5.333 5.333 0 0 1 -1.195 10.6a4.26 4.26 0 0 1 -5.28 1.863l-3.831 2.298v-3.134a2.668 2.668 0 0 1 -1.795 -3.773a4.8 4.8 0 0 1 2.908 -8.933a5.33 5.33 0 0 1 4.287 -2.16"},child:[]}]})(s)}function Cm(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 21l18 0"},child:[]},{tag:"path",attr:{d:"M3 7v1a3 3 0 0 0 6 0v-1m0 1a3 3 0 0 0 6 0v-1m0 1a3 3 0 0 0 6 0v-1h-18l2 -4h14l2 4"},child:[]},{tag:"path",attr:{d:"M5 21l0 -10.15"},child:[]},{tag:"path",attr:{d:"M19 21l0 -10.15"},child:[]},{tag:"path",attr:{d:"M9 21v-4a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v4"},child:[]}]})(s)}function RO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 13a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M15 9a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M9 5a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M4 20h14"},child:[]}]})(s)}function LO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 3.2a9 9 0 1 0 10.8 10.8a1 1 0 0 0 -1 -1h-6.8a2 2 0 0 1 -2 -2v-7a.9 .9 0 0 0 -1 -.8"},child:[]},{tag:"path",attr:{d:"M15 3.5a9 9 0 0 1 5.5 5.5h-4.5a1 1 0 0 1 -1 -1v-4.5"},child:[]}]})(s)}function GM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12l5 5l10 -10"},child:[]}]})(s)}function qM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6 9l6 6l6 -6"},child:[]}]})(s)}function Mm(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 6l-6 6l6 6"},child:[]}]})(s)}function xf(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 6l6 6l-6 6"},child:[]}]})(s)}function WM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6 15l6 -6l6 6"},child:[]}]})(s)}function IO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"},child:[]},{tag:"path",attr:{d:"M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z"},child:[]},{tag:"path",attr:{d:"M9 12l.01 0"},child:[]},{tag:"path",attr:{d:"M13 12l2 0"},child:[]},{tag:"path",attr:{d:"M9 16l.01 0"},child:[]},{tag:"path",attr:{d:"M13 16l2 0"},child:[]}]})(s)}function ZM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"},child:[]},{tag:"path",attr:{d:"M12 7v5l3 3"},child:[]}]})(s)}function zO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 16l2 -6l6 -2l-2 6l-6 2"},child:[]},{tag:"path",attr:{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"},child:[]},{tag:"path",attr:{d:"M12 3l0 2"},child:[]},{tag:"path",attr:{d:"M12 19l0 2"},child:[]},{tag:"path",attr:{d:"M3 12l2 0"},child:[]},{tag:"path",attr:{d:"M19 12l2 0"},child:[]}]})(s)}function DO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"},child:[]},{tag:"path",attr:{d:"M12 12m-8 0a8 8 0 1 0 16 0a8 8 0 1 0 -16 0"},child:[]},{tag:"path",attr:{d:"M12 2l0 2"},child:[]},{tag:"path",attr:{d:"M12 20l0 2"},child:[]},{tag:"path",attr:{d:"M20 12l2 0"},child:[]},{tag:"path",attr:{d:"M2 12l2 0"},child:[]}]})(s)}function OO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"},child:[]},{tag:"path",attr:{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M14 4l0 4l-6 0l0 -4"},child:[]}]})(s)}function NO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"},child:[]},{tag:"path",attr:{d:"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"},child:[]},{tag:"path",attr:{d:"M16 5l3 3"},child:[]}]})(s)}function XM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 9c-2.4 2.667 -5.4 4 -9 4c-3.6 0 -6.6 -1.333 -9 -4"},child:[]},{tag:"path",attr:{d:"M3 15l2.5 -3.8"},child:[]},{tag:"path",attr:{d:"M21 14.976l-2.492 -3.776"},child:[]},{tag:"path",attr:{d:"M9 17l.5 -4"},child:[]},{tag:"path",attr:{d:"M15 17l-.5 -4"},child:[]}]})(s)}function $S(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10.585 10.587a2 2 0 0 0 2.829 2.828"},child:[]},{tag:"path",attr:{d:"M16.681 16.673a8.717 8.717 0 0 1 -4.681 1.327c-3.6 0 -6.6 -2 -9 -6c1.272 -2.12 2.712 -3.678 4.32 -4.674m2.86 -1.146a9.055 9.055 0 0 1 1.82 -.18c3.6 0 6.6 2 9 6c-.666 1.11 -1.379 2.067 -2.138 2.87"},child:[]},{tag:"path",attr:{d:"M3 3l18 18"},child:[]}]})(s)}function wx(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"},child:[]},{tag:"path",attr:{d:"M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6"},child:[]}]})(s)}function YM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 3v4a1 1 0 0 0 1 1h4"},child:[]},{tag:"path",attr:{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4"},child:[]},{tag:"path",attr:{d:"M5 18h1.5a1.5 1.5 0 0 0 0 -3h-1.5v6"},child:[]},{tag:"path",attr:{d:"M17 18h2"},child:[]},{tag:"path",attr:{d:"M20 15h-3v6"},child:[]},{tag:"path",attr:{d:"M11 15v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1z"},child:[]}]})(s)}function VS(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z"},child:[]}]})(s)}function FO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M12 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M19 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M12 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M19 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]}]})(s)}function BO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 13v-8.5a1.5 1.5 0 0 1 3 0v7.5"},child:[]},{tag:"path",attr:{d:"M11 11.5v-2a1.5 1.5 0 0 1 3 0v2.5"},child:[]},{tag:"path",attr:{d:"M14 10.5a1.5 1.5 0 0 1 3 0v1.5"},child:[]},{tag:"path",attr:{d:"M17 11.5a1.5 1.5 0 0 1 3 0v4.5a6 6 0 0 1 -6 6h-2h.208a6 6 0 0 1 -5.012 -2.7l-.196 -.3c-.312 -.479 -1.407 -2.388 -3.286 -5.728a1.5 1.5 0 0 1 .536 -2.022a1.867 1.867 0 0 1 2.28 .28l1.47 1.47"},child:[]},{tag:"path",attr:{d:"M2.541 5.594a13.487 13.487 0 0 1 2.46 -1.427"},child:[]},{tag:"path",attr:{d:"M14 3.458c1.32 .354 2.558 .902 3.685 1.612"},child:[]}]})(s)}function KM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572"},child:[]}]})(s)}function UO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 20.777a8.942 8.942 0 0 1 -2.48 -.969"},child:[]},{tag:"path",attr:{d:"M14 3.223a9.003 9.003 0 0 1 0 17.554"},child:[]},{tag:"path",attr:{d:"M4.579 17.093a8.961 8.961 0 0 1 -1.227 -2.592"},child:[]},{tag:"path",attr:{d:"M3.124 10.5c.16 -.95 .468 -1.85 .9 -2.675l.169 -.305"},child:[]},{tag:"path",attr:{d:"M6.907 4.579a8.954 8.954 0 0 1 3.093 -1.356"},child:[]},{tag:"path",attr:{d:"M12 8v4l3 3"},child:[]}]})(s)}function $O(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12l-2 0l9 -9l9 9l-2 0"},child:[]},{tag:"path",attr:{d:"M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"},child:[]},{tag:"path",attr:{d:"M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"},child:[]}]})(s)}function VO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6.5 7h11"},child:[]},{tag:"path",attr:{d:"M6.5 17h11"},child:[]},{tag:"path",attr:{d:"M6 20v-2a6 6 0 1 1 12 0v2a1 1 0 0 1 -1 1h-10a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M6 4v2a6 6 0 1 0 12 0v-2a1 1 0 0 0 -1 -1h-10a1 1 0 0 0 -1 1z"},child:[]}]})(s)}function vy(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M14 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M4 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M14 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"},child:[]}]})(s)}function ME(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 6l11 0"},child:[]},{tag:"path",attr:{d:"M9 12l11 0"},child:[]},{tag:"path",attr:{d:"M9 18l11 0"},child:[]},{tag:"path",attr:{d:"M5 6l0 .01"},child:[]},{tag:"path",attr:{d:"M5 12l0 .01"},child:[]},{tag:"path",attr:{d:"M5 18l0 .01"},child:[]}]})(s)}function HO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2"},child:[]},{tag:"path",attr:{d:"M9 12h12l-3 -3"},child:[]},{tag:"path",attr:{d:"M18 15l3 -3"},child:[]}]})(s)}function GO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 18.5l-3 -1.5l-6 3v-13l6 -3l6 3l6 -3v7"},child:[]},{tag:"path",attr:{d:"M9 4v13"},child:[]},{tag:"path",attr:{d:"M15 7v5"},child:[]},{tag:"path",attr:{d:"M21.121 20.121a3 3 0 1 0 -4.242 0c.418 .419 1.125 1.045 2.121 1.879c1.051 -.89 1.759 -1.516 2.121 -1.879z"},child:[]},{tag:"path",attr:{d:"M19 18v.01"},child:[]}]})(s)}function HS(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"},child:[]},{tag:"path",attr:{d:"M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z"},child:[]}]})(s)}function qO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 6l16 0"},child:[]},{tag:"path",attr:{d:"M4 12l16 0"},child:[]},{tag:"path",attr:{d:"M4 18l16 0"},child:[]}]})(s)}function WO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 8l16 0"},child:[]},{tag:"path",attr:{d:"M4 16l16 0"},child:[]}]})(s)}function GS(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 20l1.3 -3.9c-2.324 -3.437 -1.426 -7.872 2.1 -10.374c3.526 -2.501 8.59 -2.296 11.845 .48c3.255 2.777 3.695 7.266 1.029 10.501c-2.666 3.235 -7.615 4.215 -11.574 2.293l-4.7 1"},child:[]}]})(s)}function ZO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"},child:[]},{tag:"path",attr:{d:"M9 7l6 0"},child:[]},{tag:"path",attr:{d:"M9 11l6 0"},child:[]},{tag:"path",attr:{d:"M9 15l4 0"},child:[]}]})(s)}function cx(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 3l8 4.5l0 9l-8 4.5l-8 -4.5l0 -9l8 -4.5"},child:[]},{tag:"path",attr:{d:"M12 12l8 -4.5"},child:[]},{tag:"path",attr:{d:"M12 12l0 9"},child:[]},{tag:"path",attr:{d:"M12 12l-8 -4.5"},child:[]},{tag:"path",attr:{d:"M16 5.25l-8 4.5"},child:[]}]})(s)}function JM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4"},child:[]},{tag:"path",attr:{d:"M13.5 6.5l4 4"},child:[]}]})(s)}function QM(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 8h.01"},child:[]},{tag:"path",attr:{d:"M12.5 21h-6.5a3 3 0 0 1 -3 -3v-12a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v6.5"},child:[]},{tag:"path",attr:{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l4 4"},child:[]},{tag:"path",attr:{d:"M14 14l1 -1c.67 -.644 1.45 -.824 2.182 -.54"},child:[]},{tag:"path",attr:{d:"M16 19h6"},child:[]},{tag:"path",attr:{d:"M19 16v6"},child:[]}]})(s)}function eP(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 8h.01"},child:[]},{tag:"path",attr:{d:"M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z"},child:[]},{tag:"path",attr:{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5"},child:[]},{tag:"path",attr:{d:"M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3"},child:[]}]})(s)}function ux(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 5l0 14"},child:[]},{tag:"path",attr:{d:"M5 12l14 0"},child:[]}]})(s)}function XO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"},child:[]},{tag:"path",attr:{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"},child:[]}]})(s)}function xy(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"},child:[]},{tag:"path",attr:{d:"M21 21l-6 -6"},child:[]}]})(s)}function YO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"},child:[]},{tag:"path",attr:{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"},child:[]}]})(s)}function tP(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 9h-1a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-8a2 2 0 0 0 -2 -2h-1"},child:[]},{tag:"path",attr:{d:"M12 14v-11"},child:[]},{tag:"path",attr:{d:"M9 6l3 -3l3 3"},child:[]}]})(s)}function Ty(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"},child:[]}]})(s)}function KO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 5l0 2"},child:[]},{tag:"path",attr:{d:"M15 11l0 2"},child:[]},{tag:"path",attr:{d:"M15 17l0 2"},child:[]},{tag:"path",attr:{d:"M5 5h14a2 2 0 0 1 2 2v3a2 2 0 0 0 0 4v3a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-3a2 2 0 0 0 0 -4v-3a2 2 0 0 1 2 -2"},child:[]}]})(s)}function JO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 7l16 0"},child:[]},{tag:"path",attr:{d:"M10 11l0 6"},child:[]},{tag:"path",attr:{d:"M14 11l0 6"},child:[]},{tag:"path",attr:{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"},child:[]},{tag:"path",attr:{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"},child:[]}]})(s)}function QO(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"},child:[]},{tag:"path",attr:{d:"M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"},child:[]},{tag:"path",attr:{d:"M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855"},child:[]}]})(s)}function fb(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"},child:[]},{tag:"path",attr:{d:"M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"},child:[]},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"},child:[]},{tag:"path",attr:{d:"M21 21v-2a4 4 0 0 0 -3 -3.85"},child:[]}]})(s)}function eN(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 4m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"},child:[]},{tag:"path",attr:{d:"M7 21l3 -4"},child:[]},{tag:"path",attr:{d:"M16 21l-2 -4l-3 -3l1 -6"},child:[]},{tag:"path",attr:{d:"M6 12l2 -3l4 -1l3 3l3 1"},child:[]}]})(s)}function iP(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"},child:[]},{tag:"path",attr:{d:"M3.6 9h16.8"},child:[]},{tag:"path",attr:{d:"M3.6 15h16.8"},child:[]},{tag:"path",attr:{d:"M11.5 3a17 17 0 0 0 0 18"},child:[]},{tag:"path",attr:{d:"M12.5 3a17 17 0 0 1 0 18"},child:[]}]})(s)}function Fd(s){return Rn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 6l-12 12"},child:[]},{tag:"path",attr:{d:"M6 6l12 12"},child:[]}]})(s)}const tN=()=>{pe.useEffect(()=>{const a=document.getElementById("navbar");if(a){const l=()=>{document.documentElement.style.setProperty("--navbar-height",`${a.offsetHeight}px`)};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)}},[]);const s=[{id:"home",label:"Home",icon:A.jsx($O,{}),path:"/"},{id:"search",label:"Search",icon:A.jsx(xy,{}),path:"/search"},{id:"map",label:"Map",icon:A.jsx(GO,{}),path:"/map"},{id:"community",label:"Community",icon:A.jsx(jO,{}),path:"/community"},{id:"profile",label:"Profile",icon:A.jsx(QO,{}),path:"/profile"}];return A.jsx("nav",{id:"navbar",className:"fixed bottom-0 left-0 right-0 border-t border-gray-200 shadow-md bg-[var(--white)] font-inter z-50",children:A.jsx("ul",{className:"flex justify-around items-center py-2",children:s.map(a=>A.jsx("li",{className:"flex flex-col items-center",children:A.jsxs($s,{to:a.path,className:({isActive:l})=>`flex flex-col items-center cursor-pointer transition-colors duration-200 ${l?"text-[var(--orange)]":"text-[var(--black)]"}`,children:[A.jsx("div",{className:"text-lg",children:a.icon}),A.jsx("span",{className:"text-[10px] mt-1",children:a.label})]})},a.id))})})};function iN({market:s,onClose:a}){const[l,u]=pe.useState(10),f=14,y=2*Math.PI*f,w=l/10*y;return pe.useEffect(()=>{const i=setInterval(()=>{u(C=>(C<=1&&(clearInterval(i),a()),C-1))},1e3);return()=>clearInterval(i)},[a]),A.jsxs("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",background:"white",padding:"16px 28px",borderRadius:"20px",boxShadow:"0 6px 25px rgba(0,0,0,0.18)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"space-between",minWidth:"360px",maxWidth:"90vw",gap:"18px"},children:[A.jsxs("div",{style:{flex:1},children:[A.jsxs("h3",{style:{margin:0,fontWeight:"bold"},children:["You're at ",s.name," "]}),A.jsx("p",{style:{marginTop:"6px",marginBottom:0},children:"Youve entered an open market area."})]}),A.jsxs("div",{onClick:a,style:{width:"36px",height:"36px",borderRadius:"50%",cursor:"pointer",position:"relative"},children:[A.jsxs("svg",{width:"36",height:"36",children:[A.jsx("circle",{cx:"18",cy:"18",r:f,fill:"none",stroke:"#e5e7eb",strokeWidth:"4"}),A.jsx("circle",{cx:"18",cy:"18",r:f,fill:"none",stroke:"#007bff",strokeWidth:"4",strokeDasharray:y,strokeDashoffset:y-w,strokeLinecap:"round",style:{transition:"stroke-dashoffset 1s linear"}})]}),A.jsx(Fd,{size:20,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",pointerEvents:"none"}})]})]})}const nP=pe.createContext();function nN({children:s}){const[a,l]=pe.useState(null),[u,f]=pe.useState(!0);return pe.useEffect(()=>{navigator.geolocation.getCurrentPosition(y=>{const w={lat:y.coords.latitude,lng:y.coords.longitude};l(w),f(!1),console.log("[Global LocationContext] location set:",w)},y=>{console.error("[Global LocationContext] location error:",y),f(!1)})},[]),A.jsx(nP.Provider,{value:{location:a,loading:u,setLocation:l},children:s})}function aP(){return pe.useContext(nP)}const ky=(s=null,a=null)=>{const[l,u]=pe.useState([]),[f,y]=pe.useState(!1),[w,i]=pe.useState(null),C="/v1",{location:P,loading:D}=aP(),$=a||P;return pe.useEffect(()=>{if(D)return;if(!$){y(!1);return}(async()=>{try{y(!0),i(null);const{lat:X,lng:te}=$;let le=`${C}/market?user_latitude=${X}&user_longitude=${te}`;s&&(le+=`&limit=${s}`);const re=await fetch(le);if(!re.ok)throw new Error(`HTTP error: ${re.status}`);const fe=await re.json();u(fe)}catch(X){i(X.message)}finally{y(!1)}})()},[C,s,$]),{markets:l,loading:f,error:w}},aN="modulepreload",rN=function(s){return"/"+s},PE={},Sx=function(a,l,u){let f=Promise.resolve();if(l&&l.length>0){let P=function(D){return Promise.all(D.map($=>Promise.resolve($).then(G=>({status:"fulfilled",value:G}),G=>({status:"rejected",reason:G}))))};var w=P;document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),C=i?.nonce||i?.getAttribute("nonce");f=P(l.map(D=>{if(D=rN(D),D in PE)return;PE[D]=!0;const $=D.endsWith(".css"),G=$?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${D}"]${G}`))return;const X=document.createElement("link");if(X.rel=$?"stylesheet":aN,$||(X.as="script"),X.crossOrigin="",X.href=D,C&&X.setAttribute("nonce",C),document.head.appendChild(X),$)return new Promise((te,le)=>{X.addEventListener("load",te),X.addEventListener("error",()=>le(new Error(`Unable to preload CSS for ${D}`)))})}))}function y(i){const C=new Event("vite:preloadError",{cancelable:!0});if(C.payload=i,window.dispatchEvent(C),!C.defaultPrevented)throw i}return f.then(i=>{for(const C of i||[])C.status==="rejected"&&y(C.reason);return a().catch(y)})},sN=s=>{let a;return s?a=s:typeof fetch>"u"?a=(...l)=>Sx(async()=>{const{default:u}=await Promise.resolve().then(()=>Ey);return{default:u}},[]).then(({default:u})=>u(...l)):a=fetch,(...l)=>a(...l)};class qS extends Error{constructor(a,l="FunctionsError",u){super(a),this.name=l,this.context=u}}class jE extends qS{constructor(a){super("Failed to send a request to the Edge Function","FunctionsFetchError",a)}}class RE extends qS{constructor(a){super("Relay Error invoking the Edge Function","FunctionsRelayError",a)}}class LE extends qS{constructor(a){super("Edge Function returned a non-2xx status code","FunctionsHttpError",a)}}var cS;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(cS||(cS={}));var oN=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};class lN{constructor(a,{headers:l={},customFetch:u,region:f=cS.Any}={}){this.url=a,this.headers=l,this.region=f,this.fetch=sN(u)}setAuth(a){this.headers.Authorization=`Bearer ${a}`}invoke(a){return oN(this,arguments,void 0,function*(l,u={}){var f;try{const{headers:y,method:w,body:i,signal:C}=u;let P={},{region:D}=u;D||(D=this.region);const $=new URL(`${this.url}/${l}`);D&&D!=="any"&&(P["x-region"]=D,$.searchParams.set("forceFunctionRegion",D));let G;i&&(y&&!Object.prototype.hasOwnProperty.call(y,"Content-Type")||!y)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(P["Content-Type"]="application/octet-stream",G=i):typeof i=="string"?(P["Content-Type"]="text/plain",G=i):typeof FormData<"u"&&i instanceof FormData?G=i:(P["Content-Type"]="application/json",G=JSON.stringify(i)));const X=yield this.fetch($.toString(),{method:w||"POST",headers:Object.assign(Object.assign(Object.assign({},P),this.headers),y),body:G,signal:C}).catch(fe=>{throw fe.name==="AbortError"?fe:new jE(fe)}),te=X.headers.get("x-relay-error");if(te&&te==="true")throw new RE(X);if(!X.ok)throw new LE(X);let le=((f=X.headers.get("Content-Type"))!==null&&f!==void 0?f:"text/plain").split(";")[0].trim(),re;return le==="application/json"?re=yield X.json():le==="application/octet-stream"?re=yield X.blob():le==="text/event-stream"?re=X:le==="multipart/form-data"?re=yield X.formData():re=yield X.text(),{data:re,error:null,response:X}}catch(y){return y instanceof Error&&y.name==="AbortError"?{data:null,error:new jE(y)}:{data:null,error:y,response:y instanceof LE||y instanceof RE?y.context:void 0}}})}}var Rl={},K_={},J_={},Q_={},ey={},ty={},cN=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},by=cN();const uN=by.fetch,rP=by.fetch.bind(by),sP=by.Headers,dN=by.Request,hN=by.Response,Ey=Object.freeze(Object.defineProperty({__proto__:null,Headers:sP,Request:dN,Response:hN,default:rP,fetch:uN},Symbol.toStringTag,{value:"Module"})),fN=qI(Ey);var I0={},IE;function oP(){if(IE)return I0;IE=1,Object.defineProperty(I0,"__esModule",{value:!0});class s extends Error{constructor(l){super(l.message),this.name="PostgrestError",this.details=l.details,this.hint=l.hint,this.code=l.code}}return I0.default=s,I0}var zE;function lP(){if(zE)return ty;zE=1;var s=ty&&ty.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(ty,"__esModule",{value:!0});const a=s(fN),l=s(oP());class u{constructor(y){var w,i;this.shouldThrowOnError=!1,this.method=y.method,this.url=y.url,this.headers=new Headers(y.headers),this.schema=y.schema,this.body=y.body,this.shouldThrowOnError=(w=y.shouldThrowOnError)!==null&&w!==void 0?w:!1,this.signal=y.signal,this.isMaybeSingle=(i=y.isMaybeSingle)!==null&&i!==void 0?i:!1,y.fetch?this.fetch=y.fetch:typeof fetch>"u"?this.fetch=a.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(y,w){return this.headers=new Headers(this.headers),this.headers.set(y,w),this}then(y,w){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let C=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async P=>{var D,$,G,X;let te=null,le=null,re=null,fe=P.status,xe=P.statusText;if(P.ok){if(this.method!=="HEAD"){const Ee=await P.text();Ee===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((D=this.headers.get("Accept"))===null||D===void 0)&&D.includes("application/vnd.pgrst.plan+text"))?le=Ee:le=JSON.parse(Ee))}const Ne=($=this.headers.get("Prefer"))===null||$===void 0?void 0:$.match(/count=(exact|planned|estimated)/),Be=(G=P.headers.get("content-range"))===null||G===void 0?void 0:G.split("/");Ne&&Be&&Be.length>1&&(re=parseInt(Be[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(le)&&(le.length>1?(te={code:"PGRST116",details:`Results contain ${le.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},le=null,re=null,fe=406,xe="Not Acceptable"):le.length===1?le=le[0]:le=null)}else{const Ne=await P.text();try{te=JSON.parse(Ne),Array.isArray(te)&&P.status===404&&(le=[],te=null,fe=200,xe="OK")}catch{P.status===404&&Ne===""?(fe=204,xe="No Content"):te={message:Ne}}if(te&&this.isMaybeSingle&&(!((X=te?.details)===null||X===void 0)&&X.includes("0 rows"))&&(te=null,fe=200,xe="OK"),te&&this.shouldThrowOnError)throw new l.default(te)}return{error:te,data:le,count:re,status:fe,statusText:xe}});return this.shouldThrowOnError||(C=C.catch(P=>{var D,$,G;return{error:{message:`${(D=P?.name)!==null&&D!==void 0?D:"FetchError"}: ${P?.message}`,details:`${($=P?.stack)!==null&&$!==void 0?$:""}`,hint:"",code:`${(G=P?.code)!==null&&G!==void 0?G:""}`},data:null,count:null,status:0,statusText:""}})),C.then(y,w)}returns(){return this}overrideTypes(){return this}}return ty.default=u,ty}var DE;function cP(){if(DE)return ey;DE=1;var s=ey&&ey.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ey,"__esModule",{value:!0});const a=s(lP());class l extends a.default{select(f){let y=!1;const w=(f??"*").split("").map(i=>/\s/.test(i)&&!y?"":(i==='"'&&(y=!y),i)).join("");return this.url.searchParams.set("select",w),this.headers.append("Prefer","return=representation"),this}order(f,{ascending:y=!0,nullsFirst:w,foreignTable:i,referencedTable:C=i}={}){const P=C?`${C}.order`:"order",D=this.url.searchParams.get(P);return this.url.searchParams.set(P,`${D?`${D},`:""}${f}.${y?"asc":"desc"}${w===void 0?"":w?".nullsfirst":".nullslast"}`),this}limit(f,{foreignTable:y,referencedTable:w=y}={}){const i=typeof w>"u"?"limit":`${w}.limit`;return this.url.searchParams.set(i,`${f}`),this}range(f,y,{foreignTable:w,referencedTable:i=w}={}){const C=typeof i>"u"?"offset":`${i}.offset`,P=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(C,`${f}`),this.url.searchParams.set(P,`${y-f+1}`),this}abortSignal(f){return this.signal=f,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:f=!1,verbose:y=!1,settings:w=!1,buffers:i=!1,wal:C=!1,format:P="text"}={}){var D;const $=[f?"analyze":null,y?"verbose":null,w?"settings":null,i?"buffers":null,C?"wal":null].filter(Boolean).join("|"),G=(D=this.headers.get("Accept"))!==null&&D!==void 0?D:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${P}; for="${G}"; options=${$};`),P==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(f){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${f}`),this}}return ey.default=l,ey}var OE;function WS(){if(OE)return Q_;OE=1;var s=Q_&&Q_.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Q_,"__esModule",{value:!0});const a=s(cP());class l extends a.default{eq(f,y){return this.url.searchParams.append(f,`eq.${y}`),this}neq(f,y){return this.url.searchParams.append(f,`neq.${y}`),this}gt(f,y){return this.url.searchParams.append(f,`gt.${y}`),this}gte(f,y){return this.url.searchParams.append(f,`gte.${y}`),this}lt(f,y){return this.url.searchParams.append(f,`lt.${y}`),this}lte(f,y){return this.url.searchParams.append(f,`lte.${y}`),this}like(f,y){return this.url.searchParams.append(f,`like.${y}`),this}likeAllOf(f,y){return this.url.searchParams.append(f,`like(all).{${y.join(",")}}`),this}likeAnyOf(f,y){return this.url.searchParams.append(f,`like(any).{${y.join(",")}}`),this}ilike(f,y){return this.url.searchParams.append(f,`ilike.${y}`),this}ilikeAllOf(f,y){return this.url.searchParams.append(f,`ilike(all).{${y.join(",")}}`),this}ilikeAnyOf(f,y){return this.url.searchParams.append(f,`ilike(any).{${y.join(",")}}`),this}is(f,y){return this.url.searchParams.append(f,`is.${y}`),this}in(f,y){const w=Array.from(new Set(y)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(f,`in.(${w})`),this}contains(f,y){return typeof y=="string"?this.url.searchParams.append(f,`cs.${y}`):Array.isArray(y)?this.url.searchParams.append(f,`cs.{${y.join(",")}}`):this.url.searchParams.append(f,`cs.${JSON.stringify(y)}`),this}containedBy(f,y){return typeof y=="string"?this.url.searchParams.append(f,`cd.${y}`):Array.isArray(y)?this.url.searchParams.append(f,`cd.{${y.join(",")}}`):this.url.searchParams.append(f,`cd.${JSON.stringify(y)}`),this}rangeGt(f,y){return this.url.searchParams.append(f,`sr.${y}`),this}rangeGte(f,y){return this.url.searchParams.append(f,`nxl.${y}`),this}rangeLt(f,y){return this.url.searchParams.append(f,`sl.${y}`),this}rangeLte(f,y){return this.url.searchParams.append(f,`nxr.${y}`),this}rangeAdjacent(f,y){return this.url.searchParams.append(f,`adj.${y}`),this}overlaps(f,y){return typeof y=="string"?this.url.searchParams.append(f,`ov.${y}`):this.url.searchParams.append(f,`ov.{${y.join(",")}}`),this}textSearch(f,y,{config:w,type:i}={}){let C="";i==="plain"?C="pl":i==="phrase"?C="ph":i==="websearch"&&(C="w");const P=w===void 0?"":`(${w})`;return this.url.searchParams.append(f,`${C}fts${P}.${y}`),this}match(f){return Object.entries(f).forEach(([y,w])=>{this.url.searchParams.append(y,`eq.${w}`)}),this}not(f,y,w){return this.url.searchParams.append(f,`not.${y}.${w}`),this}or(f,{foreignTable:y,referencedTable:w=y}={}){const i=w?`${w}.or`:"or";return this.url.searchParams.append(i,`(${f})`),this}filter(f,y,w){return this.url.searchParams.append(f,`${y}.${w}`),this}}return Q_.default=l,Q_}var NE;function uP(){if(NE)return J_;NE=1;var s=J_&&J_.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(J_,"__esModule",{value:!0});const a=s(WS());class l{constructor(f,{headers:y={},schema:w,fetch:i}){this.url=f,this.headers=new Headers(y),this.schema=w,this.fetch=i}select(f,y){const{head:w=!1,count:i}=y??{},C=w?"HEAD":"GET";let P=!1;const D=(f??"*").split("").map($=>/\s/.test($)&&!P?"":($==='"'&&(P=!P),$)).join("");return this.url.searchParams.set("select",D),i&&this.headers.append("Prefer",`count=${i}`),new a.default({method:C,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(f,{count:y,defaultToNull:w=!0}={}){var i;const C="POST";if(y&&this.headers.append("Prefer",`count=${y}`),w||this.headers.append("Prefer","missing=default"),Array.isArray(f)){const P=f.reduce((D,$)=>D.concat(Object.keys($)),[]);if(P.length>0){const D=[...new Set(P)].map($=>`"${$}"`);this.url.searchParams.set("columns",D.join(","))}}return new a.default({method:C,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(f,{onConflict:y,ignoreDuplicates:w=!1,count:i,defaultToNull:C=!0}={}){var P;const D="POST";if(this.headers.append("Prefer",`resolution=${w?"ignore":"merge"}-duplicates`),y!==void 0&&this.url.searchParams.set("on_conflict",y),i&&this.headers.append("Prefer",`count=${i}`),C||this.headers.append("Prefer","missing=default"),Array.isArray(f)){const $=f.reduce((G,X)=>G.concat(Object.keys(X)),[]);if($.length>0){const G=[...new Set($)].map(X=>`"${X}"`);this.url.searchParams.set("columns",G.join(","))}}return new a.default({method:D,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(P=this.fetch)!==null&&P!==void 0?P:fetch})}update(f,{count:y}={}){var w;const i="PATCH";return y&&this.headers.append("Prefer",`count=${y}`),new a.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(w=this.fetch)!==null&&w!==void 0?w:fetch})}delete({count:f}={}){var y;const w="DELETE";return f&&this.headers.append("Prefer",`count=${f}`),new a.default({method:w,url:this.url,headers:this.headers,schema:this.schema,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}}return J_.default=l,J_}var FE;function mN(){if(FE)return K_;FE=1;var s=K_&&K_.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(K_,"__esModule",{value:!0});const a=s(uP()),l=s(WS());class u{constructor(y,{headers:w={},schema:i,fetch:C}={}){this.url=y,this.headers=new Headers(w),this.schemaName=i,this.fetch=C}from(y){const w=new URL(`${this.url}/${y}`);return new a.default(w,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(y){return new u(this.url,{headers:this.headers,schema:y,fetch:this.fetch})}rpc(y,w={},{head:i=!1,get:C=!1,count:P}={}){var D;let $;const G=new URL(`${this.url}/rpc/${y}`);let X;i||C?($=i?"HEAD":"GET",Object.entries(w).filter(([le,re])=>re!==void 0).map(([le,re])=>[le,Array.isArray(re)?`{${re.join(",")}}`:`${re}`]).forEach(([le,re])=>{G.searchParams.append(le,re)})):($="POST",X=w);const te=new Headers(this.headers);return P&&te.set("Prefer",`count=${P}`),new l.default({method:$,url:G,headers:te,schema:this.schemaName,body:X,fetch:(D=this.fetch)!==null&&D!==void 0?D:fetch})}}return K_.default=u,K_}var BE;function pN(){if(BE)return Rl;BE=1;var s=Rl&&Rl.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Rl,"__esModule",{value:!0}),Rl.PostgrestError=Rl.PostgrestBuilder=Rl.PostgrestTransformBuilder=Rl.PostgrestFilterBuilder=Rl.PostgrestQueryBuilder=Rl.PostgrestClient=void 0;const a=s(mN());Rl.PostgrestClient=a.default;const l=s(uP());Rl.PostgrestQueryBuilder=l.default;const u=s(WS());Rl.PostgrestFilterBuilder=u.default;const f=s(cP());Rl.PostgrestTransformBuilder=f.default;const y=s(lP());Rl.PostgrestBuilder=y.default;const w=s(oP());return Rl.PostgrestError=w.default,Rl.default={PostgrestClient:a.default,PostgrestQueryBuilder:l.default,PostgrestFilterBuilder:u.default,PostgrestTransformBuilder:f.default,PostgrestBuilder:y.default,PostgrestError:w.default},Rl}var gN=pN();const _N=Ub(gN),{PostgrestClient:yN,PostgrestQueryBuilder:i8,PostgrestFilterBuilder:n8,PostgrestTransformBuilder:a8,PostgrestBuilder:r8,PostgrestError:s8}=_N;class vN{static detectEnvironment(){var a;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((a=navigator.userAgent)===null||a===void 0)&&a.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const l=process.versions;if(l&&l.node){const u=l.node,f=parseInt(u.replace(/^v/,"").split(".")[0]);return f>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${f} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${f} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const a=this.detectEnvironment();if(a.constructor)return a.constructor;let l=a.error||"WebSocket not supported in this environment.";throw a.workaround&&(l+=`

Suggested solution: ${a.workaround}`),new Error(l)}static createWebSocket(a,l){const u=this.getWebSocketConstructor();return new u(a,l)}static isWebSocketSupported(){try{const a=this.detectEnvironment();return a.type==="native"||a.type==="ws"}catch{return!1}}}const xN="2.74.0",bN=`realtime-js/${xN}`,wN="1.0.0",uS=1e4,SN=1e3,TN=100;var Jv;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Jv||(Jv={}));var cl;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(cl||(cl={}));var wh;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(wh||(wh={}));var dS;(function(s){s.websocket="websocket"})(dS||(dS={}));var Wg;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Wg||(Wg={}));class kN{constructor(){this.HEADER_LENGTH=1}decode(a,l){return a.constructor===ArrayBuffer?l(this._binaryDecode(a)):l(typeof a=="string"?JSON.parse(a):{})}_binaryDecode(a){const l=new DataView(a),u=new TextDecoder;return this._decodeBroadcast(a,l,u)}_decodeBroadcast(a,l,u){const f=l.getUint8(1),y=l.getUint8(2);let w=this.HEADER_LENGTH+2;const i=u.decode(a.slice(w,w+f));w=w+f;const C=u.decode(a.slice(w,w+y));w=w+y;const P=JSON.parse(u.decode(a.slice(w,a.byteLength)));return{ref:null,topic:i,event:C,payload:P}}}class dP{constructor(a,l){this.callback=a,this.timerCalc=l,this.timer=void 0,this.tries=0,this.callback=a,this.timerCalc=l}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var bs;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(bs||(bs={}));const UE=(s,a,l={})=>{var u;const f=(u=l.skipTypes)!==null&&u!==void 0?u:[];return a?Object.keys(a).reduce((y,w)=>(y[w]=EN(w,s,a,f),y),{}):{}},EN=(s,a,l,u)=>{const f=a.find(i=>i.name===s),y=f?.type,w=l[s];return y&&!u.includes(y)?hP(y,w):hS(w)},hP=(s,a)=>{if(s.charAt(0)==="_"){const l=s.slice(1,s.length);return PN(a,l)}switch(s){case bs.bool:return AN(a);case bs.float4:case bs.float8:case bs.int2:case bs.int4:case bs.int8:case bs.numeric:case bs.oid:return CN(a);case bs.json:case bs.jsonb:return MN(a);case bs.timestamp:return jN(a);case bs.abstime:case bs.date:case bs.daterange:case bs.int4range:case bs.int8range:case bs.money:case bs.reltime:case bs.text:case bs.time:case bs.timestamptz:case bs.timetz:case bs.tsrange:case bs.tstzrange:return hS(a);default:return hS(a)}},hS=s=>s,AN=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},CN=s=>{if(typeof s=="string"){const a=parseFloat(s);if(!Number.isNaN(a))return a}return s},MN=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(a){return console.log(`JSON parse error: ${a}`),s}return s},PN=(s,a)=>{if(typeof s!="string")return s;const l=s.length-1,u=s[l];if(s[0]==="{"&&u==="}"){let y;const w=s.slice(1,l);try{y=JSON.parse("["+w+"]")}catch{y=w?w.split(","):[]}return y.map(i=>hP(a,i))}return s},jN=s=>typeof s=="string"?s.replace(" ","T"):s,fP=s=>{let a=s;return a=a.replace(/^ws/i,"http"),a=a.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),a.replace(/\/+$/,"")+"/api/broadcast"};class y1{constructor(a,l,u={},f=uS){this.channel=a,this.event=l,this.payload=u,this.timeout=f,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(a){this.timeout=a,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(a){this.payload=Object.assign(Object.assign({},this.payload),a)}receive(a,l){var u;return this._hasReceived(a)&&l((u=this.receivedResp)===null||u===void 0?void 0:u.response),this.recHooks.push({status:a,callback:l}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const a=l=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=l,this._matchReceive(l)};this.channel._on(this.refEvent,{},a),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(a,l){this.refEvent&&this.channel._trigger(this.refEvent,{status:a,response:l})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:a,response:l}){this.recHooks.filter(u=>u.status===a).forEach(u=>u.callback(l))}_hasReceived(a){return this.receivedResp&&this.receivedResp.status===a}}var $E;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})($E||($E={}));class Qv{constructor(a,l){this.channel=a,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const u=l?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(u.state,{},f=>{const{onJoin:y,onLeave:w,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Qv.syncState(this.state,f,y,w),this.pendingDiffs.forEach(C=>{this.state=Qv.syncDiff(this.state,C,y,w)}),this.pendingDiffs=[],i()}),this.channel._on(u.diff,{},f=>{const{onJoin:y,onLeave:w,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(f):(this.state=Qv.syncDiff(this.state,f,y,w),i())}),this.onJoin((f,y,w)=>{this.channel._trigger("presence",{event:"join",key:f,currentPresences:y,newPresences:w})}),this.onLeave((f,y,w)=>{this.channel._trigger("presence",{event:"leave",key:f,currentPresences:y,leftPresences:w})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(a,l,u,f){const y=this.cloneDeep(a),w=this.transformState(l),i={},C={};return this.map(y,(P,D)=>{w[P]||(C[P]=D)}),this.map(w,(P,D)=>{const $=y[P];if($){const G=D.map(re=>re.presence_ref),X=$.map(re=>re.presence_ref),te=D.filter(re=>X.indexOf(re.presence_ref)<0),le=$.filter(re=>G.indexOf(re.presence_ref)<0);te.length>0&&(i[P]=te),le.length>0&&(C[P]=le)}else i[P]=D}),this.syncDiff(y,{joins:i,leaves:C},u,f)}static syncDiff(a,l,u,f){const{joins:y,leaves:w}={joins:this.transformState(l.joins),leaves:this.transformState(l.leaves)};return u||(u=()=>{}),f||(f=()=>{}),this.map(y,(i,C)=>{var P;const D=(P=a[i])!==null&&P!==void 0?P:[];if(a[i]=this.cloneDeep(C),D.length>0){const $=a[i].map(X=>X.presence_ref),G=D.filter(X=>$.indexOf(X.presence_ref)<0);a[i].unshift(...G)}u(i,D,C)}),this.map(w,(i,C)=>{let P=a[i];if(!P)return;const D=C.map($=>$.presence_ref);P=P.filter($=>D.indexOf($.presence_ref)<0),a[i]=P,f(i,P,C),P.length===0&&delete a[i]}),a}static map(a,l){return Object.getOwnPropertyNames(a).map(u=>l(u,a[u]))}static transformState(a){return a=this.cloneDeep(a),Object.getOwnPropertyNames(a).reduce((l,u)=>{const f=a[u];return"metas"in f?l[u]=f.metas.map(y=>(y.presence_ref=y.phx_ref,delete y.phx_ref,delete y.phx_ref_prev,y)):l[u]=f,l},{})}static cloneDeep(a){return JSON.parse(JSON.stringify(a))}onJoin(a){this.caller.onJoin=a}onLeave(a){this.caller.onLeave=a}onSync(a){this.caller.onSync=a}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var VE;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(VE||(VE={}));var ex;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(ex||(ex={}));var Em;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Em||(Em={}));class ZS{constructor(a,l={config:{}},u){var f,y;if(this.topic=a,this.params=l,this.socket=u,this.bindings={},this.state=cl.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=a.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},l.config),this.timeout=this.socket.timeout,this.joinPush=new y1(this,wh.join,this.params,this.timeout),this.rejoinTimer=new dP(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=cl.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(w=>w.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=cl.closed,this.socket._remove(this)}),this._onError(w=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,w),this.state=cl.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=cl.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",w=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,w),this.state=cl.errored,this.rejoinTimer.scheduleTimeout())}),this._on(wh.reply,{},(w,i)=>{this._trigger(this._replyEventName(i),w)}),this.presence=new Qv(this),this.broadcastEndpointURL=fP(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((y=(f=this.params.config)===null||f===void 0?void 0:f.broadcast)===null||y===void 0)&&y.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(a,l=this.timeout){var u,f,y;if(this.socket.isConnected()||this.socket.connect(),this.state==cl.closed){const{config:{broadcast:w,presence:i,private:C}}=this.params,P=(f=(u=this.bindings.postgres_changes)===null||u===void 0?void 0:u.map(X=>X.filter))!==null&&f!==void 0?f:[],D=!!this.bindings[ex.PRESENCE]&&this.bindings[ex.PRESENCE].length>0||((y=this.params.config.presence)===null||y===void 0?void 0:y.enabled)===!0,$={},G={broadcast:w,presence:Object.assign(Object.assign({},i),{enabled:D}),postgres_changes:P,private:C};this.socket.accessTokenValue&&($.access_token=this.socket.accessTokenValue),this._onError(X=>a?.(Em.CHANNEL_ERROR,X)),this._onClose(()=>a?.(Em.CLOSED)),this.updateJoinPayload(Object.assign({config:G},$)),this.joinedOnce=!0,this._rejoin(l),this.joinPush.receive("ok",async({postgres_changes:X})=>{var te;if(this.socket.setAuth(),X===void 0){a?.(Em.SUBSCRIBED);return}else{const le=this.bindings.postgres_changes,re=(te=le?.length)!==null&&te!==void 0?te:0,fe=[];for(let xe=0;xe<re;xe++){const be=le[xe],{filter:{event:Ne,schema:Be,table:Ee,filter:et}}=be,at=X&&X[xe];if(at&&at.event===Ne&&at.schema===Be&&at.table===Ee&&at.filter===et)fe.push(Object.assign(Object.assign({},be),{id:at.id}));else{this.unsubscribe(),this.state=cl.errored,a?.(Em.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=fe,a&&a(Em.SUBSCRIBED);return}}).receive("error",X=>{this.state=cl.errored,a?.(Em.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(X).join(", ")||"error")))}).receive("timeout",()=>{a?.(Em.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(a,l={}){return await this.send({type:"presence",event:"track",payload:a},l.timeout||this.timeout)}async untrack(a={}){return await this.send({type:"presence",event:"untrack"},a)}on(a,l,u){return this.state===cl.joined&&a===ex.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(a,l,u)}async send(a,l={}){var u,f;if(!this._canPush()&&a.type==="broadcast"){const{event:y,payload:w}=a,C={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:y,payload:w,private:this.private}]})};try{const P=await this._fetchWithTimeout(this.broadcastEndpointURL,C,(u=l.timeout)!==null&&u!==void 0?u:this.timeout);return await((f=P.body)===null||f===void 0?void 0:f.cancel()),P.ok?"ok":"error"}catch(P){return P.name==="AbortError"?"timed out":"error"}}else return new Promise(y=>{var w,i,C;const P=this._push(a.type,a,l.timeout||this.timeout);a.type==="broadcast"&&!(!((C=(i=(w=this.params)===null||w===void 0?void 0:w.config)===null||i===void 0?void 0:i.broadcast)===null||C===void 0)&&C.ack)&&y("ok"),P.receive("ok",()=>y("ok")),P.receive("error",()=>y("error")),P.receive("timeout",()=>y("timed out"))})}updateJoinPayload(a){this.joinPush.updatePayload(a)}unsubscribe(a=this.timeout){this.state=cl.leaving;const l=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(wh.close,"leave",this._joinRef())};this.joinPush.destroy();let u=null;return new Promise(f=>{u=new y1(this,wh.leave,{},a),u.receive("ok",()=>{l(),f("ok")}).receive("timeout",()=>{l(),f("timed out")}).receive("error",()=>{f("error")}),u.send(),this._canPush()||u.trigger("ok",{})}).finally(()=>{u?.destroy()})}teardown(){this.pushBuffer.forEach(a=>a.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=cl.closed,this.bindings={}}async _fetchWithTimeout(a,l,u){const f=new AbortController,y=setTimeout(()=>f.abort(),u),w=await this.socket.fetch(a,Object.assign(Object.assign({},l),{signal:f.signal}));return clearTimeout(y),w}_push(a,l,u=this.timeout){if(!this.joinedOnce)throw`tried to push '${a}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let f=new y1(this,a,l,u);return this._canPush()?f.send():this._addToPushBuffer(f),f}_addToPushBuffer(a){if(a.startTimeout(),this.pushBuffer.push(a),this.pushBuffer.length>TN){const l=this.pushBuffer.shift();l&&(l.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${l.event}`,l.payload))}}_onMessage(a,l,u){return l}_isMember(a){return this.topic===a}_joinRef(){return this.joinPush.ref}_trigger(a,l,u){var f,y;const w=a.toLocaleLowerCase(),{close:i,error:C,leave:P,join:D}=wh;if(u&&[i,C,P,D].indexOf(w)>=0&&u!==this._joinRef())return;let G=this._onMessage(w,l,u);if(l&&!G)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(w)?(f=this.bindings.postgres_changes)===null||f===void 0||f.filter(X=>{var te,le,re;return((te=X.filter)===null||te===void 0?void 0:te.event)==="*"||((re=(le=X.filter)===null||le===void 0?void 0:le.event)===null||re===void 0?void 0:re.toLocaleLowerCase())===w}).map(X=>X.callback(G,u)):(y=this.bindings[w])===null||y===void 0||y.filter(X=>{var te,le,re,fe,xe,be;if(["broadcast","presence","postgres_changes"].includes(w))if("id"in X){const Ne=X.id,Be=(te=X.filter)===null||te===void 0?void 0:te.event;return Ne&&((le=l.ids)===null||le===void 0?void 0:le.includes(Ne))&&(Be==="*"||Be?.toLocaleLowerCase()===((re=l.data)===null||re===void 0?void 0:re.type.toLocaleLowerCase()))}else{const Ne=(xe=(fe=X?.filter)===null||fe===void 0?void 0:fe.event)===null||xe===void 0?void 0:xe.toLocaleLowerCase();return Ne==="*"||Ne===((be=l?.event)===null||be===void 0?void 0:be.toLocaleLowerCase())}else return X.type.toLocaleLowerCase()===w}).map(X=>{if(typeof G=="object"&&"ids"in G){const te=G.data,{schema:le,table:re,commit_timestamp:fe,type:xe,errors:be}=te;G=Object.assign(Object.assign({},{schema:le,table:re,commit_timestamp:fe,eventType:xe,new:{},old:{},errors:be}),this._getPayloadRecords(te))}X.callback(G,u)})}_isClosed(){return this.state===cl.closed}_isJoined(){return this.state===cl.joined}_isJoining(){return this.state===cl.joining}_isLeaving(){return this.state===cl.leaving}_replyEventName(a){return`chan_reply_${a}`}_on(a,l,u){const f=a.toLocaleLowerCase(),y={type:f,filter:l,callback:u};return this.bindings[f]?this.bindings[f].push(y):this.bindings[f]=[y],this}_off(a,l){const u=a.toLocaleLowerCase();return this.bindings[u]&&(this.bindings[u]=this.bindings[u].filter(f=>{var y;return!(((y=f.type)===null||y===void 0?void 0:y.toLocaleLowerCase())===u&&ZS.isEqual(f.filter,l))})),this}static isEqual(a,l){if(Object.keys(a).length!==Object.keys(l).length)return!1;for(const u in a)if(a[u]!==l[u])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(a){this._on(wh.close,{},a)}_onError(a){this._on(wh.error,{},l=>a(l))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(a=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=cl.joining,this.joinPush.resend(a))}_getPayloadRecords(a){const l={new:{},old:{}};return(a.type==="INSERT"||a.type==="UPDATE")&&(l.new=UE(a.columns,a.record)),(a.type==="UPDATE"||a.type==="DELETE")&&(l.old=UE(a.columns,a.old_record)),l}}const v1=()=>{},z0={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},RN=[1e3,2e3,5e3,1e4],LN=1e4,IN=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class zN{constructor(a,l){var u;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=uS,this.transport=null,this.heartbeatIntervalMs=z0.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=v1,this.ref=0,this.reconnectTimer=null,this.logger=v1,this.conn=null,this.sendBuffer=[],this.serializer=new kN,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=f=>{let y;return f?y=f:typeof fetch>"u"?y=(...w)=>Sx(async()=>{const{default:i}=await Promise.resolve().then(()=>Ey);return{default:i}},void 0).then(({default:i})=>i(...w)).catch(i=>{throw new Error(`Failed to load @supabase/node-fetch: ${i.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):y=fetch,(...w)=>y(...w)},!(!((u=l?.params)===null||u===void 0)&&u.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=l.params.apikey,this.endPoint=`${a}/${dS.websocket}`,this.httpEndpoint=fP(a),this._initializeOptions(l),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(l?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=vN.createWebSocket(this.endpointURL())}catch(a){this._setConnectionState("disconnected");const l=a.message;throw l.includes("Node.js")?new Error(`${l}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${l}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:wN}))}disconnect(a,l){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const u=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(u),this._setConnectionState("disconnected")},a?this.conn.close(a,l??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(a){const l=await a.unsubscribe();return this.channels.length===0&&this.disconnect(),l}async removeAllChannels(){const a=await Promise.all(this.channels.map(l=>l.unsubscribe()));return this.channels=[],this.disconnect(),a}log(a,l,u){this.logger(a,l,u)}connectionState(){switch(this.conn&&this.conn.readyState){case Jv.connecting:return Wg.Connecting;case Jv.open:return Wg.Open;case Jv.closing:return Wg.Closing;default:return Wg.Closed}}isConnected(){return this.connectionState()===Wg.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(a,l={config:{}}){const u=`realtime:${a}`,f=this.getChannels().find(y=>y.topic===u);if(f)return f;{const y=new ZS(`realtime:${a}`,l,this);return this.channels.push(y),y}}push(a){const{topic:l,event:u,payload:f,ref:y}=a,w=()=>{this.encode(a,i=>{var C;(C=this.conn)===null||C===void 0||C.send(i)})};this.log("push",`${l} ${u} (${y})`,f),this.isConnected()?w():this.sendBuffer.push(w)}async setAuth(a=null){this._authPromise=this._performAuth(a);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var a;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(l){this.log("error","error in heartbeat callback",l)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(l){this.log("error","error in heartbeat callback",l)}this._wasManualDisconnect=!1,(a=this.conn)===null||a===void 0||a.close(SN,"heartbeat timeout"),setTimeout(()=>{var l;this.isConnected()||(l=this.reconnectTimer)===null||l===void 0||l.scheduleTimeout()},z0.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(l){this.log("error","error in heartbeat callback",l)}this._setAuthSafely("heartbeat")}onHeartbeat(a){this.heartbeatCallback=a}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(a=>a()),this.sendBuffer=[])}_makeRef(){let a=this.ref+1;return a===this.ref?this.ref=0:this.ref=a,this.ref.toString()}_leaveOpenTopic(a){let l=this.channels.find(u=>u.topic===a&&(u._isJoined()||u._isJoining()));l&&(this.log("transport",`leaving duplicate topic "${a}"`),l.unsubscribe())}_remove(a){this.channels=this.channels.filter(l=>l.topic!==a.topic)}_onConnMessage(a){this.decode(a.data,l=>{if(l.topic==="phoenix"&&l.event==="phx_reply")try{this.heartbeatCallback(l.payload.status==="ok"?"ok":"error")}catch(P){this.log("error","error in heartbeat callback",P)}l.ref&&l.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:u,event:f,payload:y,ref:w}=l,i=w?`(${w})`:"",C=y.status||"";this.log("receive",`${C} ${u} ${f} ${i}`.trim(),y),this.channels.filter(P=>P._isMember(u)).forEach(P=>P._trigger(f,y,w)),this._triggerStateCallbacks("message",l)})}_clearTimer(a){var l;a==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):a==="reconnect"&&((l=this.reconnectTimer)===null||l===void 0||l.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=a=>this._onConnError(a),this.conn.onmessage=a=>this._onConnMessage(a),this.conn.onclose=a=>this._onConnClose(a))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(a=>a.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const a=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(a),this.workerRef.onerror=l=>{this.log("worker","worker error",l.message),this.workerRef.terminate()},this.workerRef.onmessage=l=>{l.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(a){var l;this._setConnectionState("disconnected"),this.log("transport","close",a),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(l=this.reconnectTimer)===null||l===void 0||l.scheduleTimeout(),this._triggerStateCallbacks("close",a)}_onConnError(a){this._setConnectionState("disconnected"),this.log("transport",`${a}`),this._triggerChanError(),this._triggerStateCallbacks("error",a)}_triggerChanError(){this.channels.forEach(a=>a._trigger(wh.error))}_appendParams(a,l){if(Object.keys(l).length===0)return a;const u=a.match(/\?/)?"&":"?",f=new URLSearchParams(l);return`${a}${u}${f}`}_workerObjectUrl(a){let l;if(a)l=a;else{const u=new Blob([IN],{type:"application/javascript"});l=URL.createObjectURL(u)}return l}_setConnectionState(a,l=!1){this._connectionState=a,a==="connecting"?this._wasManualDisconnect=!1:a==="disconnecting"&&(this._wasManualDisconnect=l)}async _performAuth(a=null){let l;a?l=a:this.accessToken?l=await this.accessToken():l=this.accessTokenValue,this.accessTokenValue!=l&&(this.accessTokenValue=l,this.channels.forEach(u=>{const f={access_token:l,version:bN};l&&u.updateJoinPayload(f),u.joinedOnce&&u._isJoined()&&u._push(wh.access_token,{access_token:l})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(a="general"){this.setAuth().catch(l=>{this.log("error",`error setting auth in ${a}`,l)})}_triggerStateCallbacks(a,l){try{this.stateChangeCallbacks[a].forEach(u=>{try{u(l)}catch(f){this.log("error",`error in ${a} callback`,f)}})}catch(u){this.log("error",`error triggering ${a} callbacks`,u)}}_setupReconnectionTimer(){this.reconnectTimer=new dP(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},z0.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(a){var l,u,f,y,w,i,C,P,D;if(this.transport=(l=a?.transport)!==null&&l!==void 0?l:null,this.timeout=(u=a?.timeout)!==null&&u!==void 0?u:uS,this.heartbeatIntervalMs=(f=a?.heartbeatIntervalMs)!==null&&f!==void 0?f:z0.HEARTBEAT_INTERVAL,this.worker=(y=a?.worker)!==null&&y!==void 0?y:!1,this.accessToken=(w=a?.accessToken)!==null&&w!==void 0?w:null,this.heartbeatCallback=(i=a?.heartbeatCallback)!==null&&i!==void 0?i:v1,a?.params&&(this.params=a.params),a?.logger&&(this.logger=a.logger),(a?.logLevel||a?.log_level)&&(this.logLevel=a.logLevel||a.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(C=a?.reconnectAfterMs)!==null&&C!==void 0?C:($=>RN[$-1]||LN),this.encode=(P=a?.encode)!==null&&P!==void 0?P:(($,G)=>G(JSON.stringify($))),this.decode=(D=a?.decode)!==null&&D!==void 0?D:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=a?.workerUrl}}}class XS extends Error{constructor(a){super(a),this.__isStorageError=!0,this.name="StorageError"}}function qo(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class DN extends XS{constructor(a,l,u){super(a),this.name="StorageApiError",this.status=l,this.statusCode=u}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class fS extends XS{constructor(a,l){super(a),this.name="StorageUnknownError",this.originalError=l}}var ON=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};const mP=s=>{let a;return s?a=s:typeof fetch>"u"?a=(...l)=>Sx(async()=>{const{default:u}=await Promise.resolve().then(()=>Ey);return{default:u}},void 0).then(({default:u})=>u(...l)):a=fetch,(...l)=>a(...l)},NN=()=>ON(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Sx(()=>Promise.resolve().then(()=>Ey),void 0)).Response:Response}),mS=s=>{if(Array.isArray(s))return s.map(l=>mS(l));if(typeof s=="function"||s!==Object(s))return s;const a={};return Object.entries(s).forEach(([l,u])=>{const f=l.replace(/([-_][a-z])/gi,y=>y.toUpperCase().replace(/[-_]/g,""));a[f]=mS(u)}),a},FN=s=>{if(typeof s!="object"||s===null)return!1;const a=Object.getPrototypeOf(s);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)};var n_=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};const x1=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),BN=(s,a,l)=>n_(void 0,void 0,void 0,function*(){const u=yield NN();s instanceof u&&!l?.noResolveJson?s.json().then(f=>{const y=s.status||500,w=f?.statusCode||y+"";a(new DN(x1(f),y,w))}).catch(f=>{a(new fS(x1(f),f))}):a(new fS(x1(s),s))}),UN=(s,a,l,u)=>{const f={method:s,headers:a?.headers||{}};return s==="GET"||!u?f:(FN(u)?(f.headers=Object.assign({"Content-Type":"application/json"},a?.headers),f.body=JSON.stringify(u)):f.body=u,a?.duplex&&(f.duplex=a.duplex),Object.assign(Object.assign({},f),l))};function Tx(s,a,l,u,f,y){return n_(this,void 0,void 0,function*(){return new Promise((w,i)=>{s(l,UN(a,u,f,y)).then(C=>{if(!C.ok)throw C;return u?.noResolveJson?C:C.json()}).then(C=>w(C)).catch(C=>BN(C,i,u))})})}function Tb(s,a,l,u){return n_(this,void 0,void 0,function*(){return Tx(s,"GET",a,l,u)})}function yf(s,a,l,u,f){return n_(this,void 0,void 0,function*(){return Tx(s,"POST",a,u,f,l)})}function pS(s,a,l,u,f){return n_(this,void 0,void 0,function*(){return Tx(s,"PUT",a,u,f,l)})}function $N(s,a,l,u){return n_(this,void 0,void 0,function*(){return Tx(s,"HEAD",a,Object.assign(Object.assign({},l),{noResolveJson:!0}),u)})}function pP(s,a,l,u,f){return n_(this,void 0,void 0,function*(){return Tx(s,"DELETE",a,u,f,l)})}var VN=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};class HN{constructor(a,l){this.downloadFn=a,this.shouldThrowOnError=l}then(a,l){return this.execute().then(a,l)}execute(){return VN(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(qo(a))return{data:null,error:a};throw a}})}}var GN=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};class qN{constructor(a,l){this.downloadFn=a,this.shouldThrowOnError=l}asStream(){return new HN(this.downloadFn,this.shouldThrowOnError)}then(a,l){return this.execute().then(a,l)}execute(){return GN(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(qo(a))return{data:null,error:a};throw a}})}}var yu=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};const WN={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},HE={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ZN{constructor(a,l={},u,f){this.shouldThrowOnError=!1,this.url=a,this.headers=l,this.bucketId=u,this.fetch=mP(f)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(a,l,u,f){return yu(this,void 0,void 0,function*(){try{let y;const w=Object.assign(Object.assign({},HE),f);let i=Object.assign(Object.assign({},this.headers),a==="POST"&&{"x-upsert":String(w.upsert)});const C=w.metadata;typeof Blob<"u"&&u instanceof Blob?(y=new FormData,y.append("cacheControl",w.cacheControl),C&&y.append("metadata",this.encodeMetadata(C)),y.append("",u)):typeof FormData<"u"&&u instanceof FormData?(y=u,y.append("cacheControl",w.cacheControl),C&&y.append("metadata",this.encodeMetadata(C))):(y=u,i["cache-control"]=`max-age=${w.cacheControl}`,i["content-type"]=w.contentType,C&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(C)))),f?.headers&&(i=Object.assign(Object.assign({},i),f.headers));const P=this._removeEmptyFolders(l),D=this._getFinalPath(P),$=yield(a=="PUT"?pS:yf)(this.fetch,`${this.url}/object/${D}`,y,Object.assign({headers:i},w?.duplex?{duplex:w.duplex}:{}));return{data:{path:P,id:$.Id,fullPath:$.Key},error:null}}catch(y){if(this.shouldThrowOnError)throw y;if(qo(y))return{data:null,error:y};throw y}})}upload(a,l,u){return yu(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",a,l,u)})}uploadToSignedUrl(a,l,u,f){return yu(this,void 0,void 0,function*(){const y=this._removeEmptyFolders(a),w=this._getFinalPath(y),i=new URL(this.url+`/object/upload/sign/${w}`);i.searchParams.set("token",l);try{let C;const P=Object.assign({upsert:HE.upsert},f),D=Object.assign(Object.assign({},this.headers),{"x-upsert":String(P.upsert)});typeof Blob<"u"&&u instanceof Blob?(C=new FormData,C.append("cacheControl",P.cacheControl),C.append("",u)):typeof FormData<"u"&&u instanceof FormData?(C=u,C.append("cacheControl",P.cacheControl)):(C=u,D["cache-control"]=`max-age=${P.cacheControl}`,D["content-type"]=P.contentType);const $=yield pS(this.fetch,i.toString(),C,{headers:D});return{data:{path:y,fullPath:$.Key},error:null}}catch(C){if(this.shouldThrowOnError)throw C;if(qo(C))return{data:null,error:C};throw C}})}createSignedUploadUrl(a,l){return yu(this,void 0,void 0,function*(){try{let u=this._getFinalPath(a);const f=Object.assign({},this.headers);l?.upsert&&(f["x-upsert"]="true");const y=yield yf(this.fetch,`${this.url}/object/upload/sign/${u}`,{},{headers:f}),w=new URL(this.url+y.url),i=w.searchParams.get("token");if(!i)throw new XS("No token returned by API");return{data:{signedUrl:w.toString(),path:a,token:i},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(qo(u))return{data:null,error:u};throw u}})}update(a,l,u){return yu(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",a,l,u)})}move(a,l,u){return yu(this,void 0,void 0,function*(){try{return{data:yield yf(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:a,destinationKey:l,destinationBucket:u?.destinationBucket},{headers:this.headers}),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(qo(f))return{data:null,error:f};throw f}})}copy(a,l,u){return yu(this,void 0,void 0,function*(){try{return{data:{path:(yield yf(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:a,destinationKey:l,destinationBucket:u?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(qo(f))return{data:null,error:f};throw f}})}createSignedUrl(a,l,u){return yu(this,void 0,void 0,function*(){try{let f=this._getFinalPath(a),y=yield yf(this.fetch,`${this.url}/object/sign/${f}`,Object.assign({expiresIn:l},u?.transform?{transform:u.transform}:{}),{headers:this.headers});const w=u?.download?`&download=${u.download===!0?"":u.download}`:"";return y={signedUrl:encodeURI(`${this.url}${y.signedURL}${w}`)},{data:y,error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(qo(f))return{data:null,error:f};throw f}})}createSignedUrls(a,l,u){return yu(this,void 0,void 0,function*(){try{const f=yield yf(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:l,paths:a},{headers:this.headers}),y=u?.download?`&download=${u.download===!0?"":u.download}`:"";return{data:f.map(w=>Object.assign(Object.assign({},w),{signedUrl:w.signedURL?encodeURI(`${this.url}${w.signedURL}${y}`):null})),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(qo(f))return{data:null,error:f};throw f}})}download(a,l){const f=typeof l?.transform<"u"?"render/image/authenticated":"object",y=this.transformOptsToQueryString(l?.transform||{}),w=y?`?${y}`:"",i=this._getFinalPath(a),C=()=>Tb(this.fetch,`${this.url}/${f}/${i}${w}`,{headers:this.headers,noResolveJson:!0});return new qN(C,this.shouldThrowOnError)}info(a){return yu(this,void 0,void 0,function*(){const l=this._getFinalPath(a);try{const u=yield Tb(this.fetch,`${this.url}/object/info/${l}`,{headers:this.headers});return{data:mS(u),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(qo(u))return{data:null,error:u};throw u}})}exists(a){return yu(this,void 0,void 0,function*(){const l=this._getFinalPath(a);try{return yield $N(this.fetch,`${this.url}/object/${l}`,{headers:this.headers}),{data:!0,error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(qo(u)&&u instanceof fS){const f=u.originalError;if([400,404].includes(f?.status))return{data:!1,error:u}}throw u}})}getPublicUrl(a,l){const u=this._getFinalPath(a),f=[],y=l?.download?`download=${l.download===!0?"":l.download}`:"";y!==""&&f.push(y);const i=typeof l?.transform<"u"?"render/image":"object",C=this.transformOptsToQueryString(l?.transform||{});C!==""&&f.push(C);let P=f.join("&");return P!==""&&(P=`?${P}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${u}${P}`)}}}remove(a){return yu(this,void 0,void 0,function*(){try{return{data:yield pP(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:a},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(qo(l))return{data:null,error:l};throw l}})}list(a,l,u){return yu(this,void 0,void 0,function*(){try{const f=Object.assign(Object.assign(Object.assign({},WN),l),{prefix:a||""});return{data:yield yf(this.fetch,`${this.url}/object/list/${this.bucketId}`,f,{headers:this.headers},u),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(qo(f))return{data:null,error:f};throw f}})}listV2(a,l){return yu(this,void 0,void 0,function*(){try{const u=Object.assign({},a);return{data:yield yf(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,u,{headers:this.headers},l),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(qo(u))return{data:null,error:u};throw u}})}encodeMetadata(a){return JSON.stringify(a)}toBase64(a){return typeof Buffer<"u"?Buffer.from(a).toString("base64"):btoa(a)}_getFinalPath(a){return`${this.bucketId}/${a.replace(/^\/+/,"")}`}_removeEmptyFolders(a){return a.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(a){const l=[];return a.width&&l.push(`width=${a.width}`),a.height&&l.push(`height=${a.height}`),a.resize&&l.push(`resize=${a.resize}`),a.format&&l.push(`format=${a.format}`),a.quality&&l.push(`quality=${a.quality}`),l.join("&")}}const XN="2.74.0",YN={"X-Client-Info":`storage-js/${XN}`};var iy=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};class KN{constructor(a,l={},u,f){this.shouldThrowOnError=!1;const y=new URL(a);f?.useNewHostname&&/supabase\.(co|in|red)$/.test(y.hostname)&&!y.hostname.includes("storage.supabase.")&&(y.hostname=y.hostname.replace("supabase.","storage.supabase.")),this.url=y.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},YN),l),this.fetch=mP(u)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return iy(this,void 0,void 0,function*(){try{return{data:yield Tb(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(qo(a))return{data:null,error:a};throw a}})}getBucket(a){return iy(this,void 0,void 0,function*(){try{return{data:yield Tb(this.fetch,`${this.url}/bucket/${a}`,{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(qo(l))return{data:null,error:l};throw l}})}createBucket(a){return iy(this,arguments,void 0,function*(l,u={public:!1}){try{return{data:yield yf(this.fetch,`${this.url}/bucket`,{id:l,name:l,type:u.type,public:u.public,file_size_limit:u.fileSizeLimit,allowed_mime_types:u.allowedMimeTypes},{headers:this.headers}),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(qo(f))return{data:null,error:f};throw f}})}updateBucket(a,l){return iy(this,void 0,void 0,function*(){try{return{data:yield pS(this.fetch,`${this.url}/bucket/${a}`,{id:a,name:a,public:l.public,file_size_limit:l.fileSizeLimit,allowed_mime_types:l.allowedMimeTypes},{headers:this.headers}),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(qo(u))return{data:null,error:u};throw u}})}emptyBucket(a){return iy(this,void 0,void 0,function*(){try{return{data:yield yf(this.fetch,`${this.url}/bucket/${a}/empty`,{},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(qo(l))return{data:null,error:l};throw l}})}deleteBucket(a){return iy(this,void 0,void 0,function*(){try{return{data:yield pP(this.fetch,`${this.url}/bucket/${a}`,{},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(qo(l))return{data:null,error:l};throw l}})}}class JN extends KN{constructor(a,l={},u,f){super(a,l,u,f)}from(a){return new ZN(this.url,this.headers,a,this.fetch)}}const QN="2.74.0";let Wv="";typeof Deno<"u"?Wv="deno":typeof document<"u"?Wv="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Wv="react-native":Wv="node";const e3={"X-Client-Info":`supabase-js-${Wv}/${QN}`},t3={headers:e3},i3={schema:"public"},n3={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},a3={};var r3=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};const s3=s=>{let a;return s?a=s:typeof fetch>"u"?a=rP:a=fetch,(...l)=>a(...l)},o3=()=>typeof Headers>"u"?sP:Headers,l3=(s,a,l)=>{const u=s3(l),f=o3();return(y,w)=>r3(void 0,void 0,void 0,function*(){var i;const C=(i=yield a())!==null&&i!==void 0?i:s;let P=new f(w?.headers);return P.has("apikey")||P.set("apikey",s),P.has("Authorization")||P.set("Authorization",`Bearer ${C}`),u(y,Object.assign(Object.assign({},w),{headers:P}))})};var c3=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};function u3(s){return s.endsWith("/")?s:s+"/"}function d3(s,a){var l,u;const{db:f,auth:y,realtime:w,global:i}=s,{db:C,auth:P,realtime:D,global:$}=a,G={db:Object.assign(Object.assign({},C),f),auth:Object.assign(Object.assign({},P),y),realtime:Object.assign(Object.assign({},D),w),storage:{},global:Object.assign(Object.assign(Object.assign({},$),i),{headers:Object.assign(Object.assign({},(l=$?.headers)!==null&&l!==void 0?l:{}),(u=i?.headers)!==null&&u!==void 0?u:{})}),accessToken:()=>c3(this,void 0,void 0,function*(){return""})};return s.accessToken?G.accessToken=s.accessToken:delete G.accessToken,G}function h3(s){const a=s?.trim();if(!a)throw new Error("supabaseUrl is required.");if(!a.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(u3(a))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const gP="2.74.0",hy=30*1e3,gS=3,b1=gS*hy,f3="http://localhost:9999",m3="supabase.auth.token",p3={"X-Client-Info":`gotrue-js/${gP}`},_S="X-Supabase-Api-Version",_P={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},g3=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,_3=600*1e3;class dx extends Error{constructor(a,l,u){super(a),this.__isAuthError=!0,this.name="AuthError",this.status=l,this.code=u}}function ga(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class y3 extends dx{constructor(a,l,u){super(a,l,u),this.name="AuthApiError",this.status=l,this.code=u}}function v3(s){return ga(s)&&s.name==="AuthApiError"}class Zg extends dx{constructor(a,l){super(a),this.name="AuthUnknownError",this.originalError=l}}class Xp extends dx{constructor(a,l,u,f){super(a,u,f),this.name=l,this.status=u}}class Lp extends Xp{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function x3(s){return ga(s)&&s.name==="AuthSessionMissingError"}class ny extends Xp{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class D0 extends Xp{constructor(a){super(a,"AuthInvalidCredentialsError",400,void 0)}}class O0 extends Xp{constructor(a,l=null){super(a,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=l}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function b3(s){return ga(s)&&s.name==="AuthImplicitGrantRedirectError"}class GE extends Xp{constructor(a,l=null){super(a,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=l}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class yS extends Xp{constructor(a,l){super(a,"AuthRetryableFetchError",l,void 0)}}function w1(s){return ga(s)&&s.name==="AuthRetryableFetchError"}class qE extends Xp{constructor(a,l,u){super(a,"AuthWeakPasswordError",l,"weak_password"),this.reasons=u}}class vS extends Xp{constructor(a){super(a,"AuthInvalidJwtError",400,"invalid_jwt")}}const kb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),WE=` 	
\r=`.split(""),w3=(()=>{const s=new Array(128);for(let a=0;a<s.length;a+=1)s[a]=-1;for(let a=0;a<WE.length;a+=1)s[WE[a].charCodeAt(0)]=-2;for(let a=0;a<kb.length;a+=1)s[kb[a].charCodeAt(0)]=a;return s})();function ZE(s,a,l){if(s!==null)for(a.queue=a.queue<<8|s,a.queuedBits+=8;a.queuedBits>=6;){const u=a.queue>>a.queuedBits-6&63;l(kb[u]),a.queuedBits-=6}else if(a.queuedBits>0)for(a.queue=a.queue<<6-a.queuedBits,a.queuedBits=6;a.queuedBits>=6;){const u=a.queue>>a.queuedBits-6&63;l(kb[u]),a.queuedBits-=6}}function yP(s,a,l){const u=w3[s];if(u>-1)for(a.queue=a.queue<<6|u,a.queuedBits+=6;a.queuedBits>=8;)l(a.queue>>a.queuedBits-8&255),a.queuedBits-=8;else{if(u===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function XE(s){const a=[],l=w=>{a.push(String.fromCodePoint(w))},u={utf8seq:0,codepoint:0},f={queue:0,queuedBits:0},y=w=>{k3(w,u,l)};for(let w=0;w<s.length;w+=1)yP(s.charCodeAt(w),f,y);return a.join("")}function S3(s,a){if(s<=127){a(s);return}else if(s<=2047){a(192|s>>6),a(128|s&63);return}else if(s<=65535){a(224|s>>12),a(128|s>>6&63),a(128|s&63);return}else if(s<=1114111){a(240|s>>18),a(128|s>>12&63),a(128|s>>6&63),a(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function T3(s,a){for(let l=0;l<s.length;l+=1){let u=s.charCodeAt(l);if(u>55295&&u<=56319){const f=(u-55296)*1024&65535;u=(s.charCodeAt(l+1)-56320&65535|f)+65536,l+=1}S3(u,a)}}function k3(s,a,l){if(a.utf8seq===0){if(s<=127){l(s);return}for(let u=1;u<6;u+=1)if((s>>7-u&1)===0){a.utf8seq=u;break}if(a.utf8seq===2)a.codepoint=s&31;else if(a.utf8seq===3)a.codepoint=s&15;else if(a.utf8seq===4)a.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");a.utf8seq-=1}else if(a.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");a.codepoint=a.codepoint<<6|s&63,a.utf8seq-=1,a.utf8seq===0&&l(a.codepoint)}}function gy(s){const a=[],l={queue:0,queuedBits:0},u=f=>{a.push(f)};for(let f=0;f<s.length;f+=1)yP(s.charCodeAt(f),l,u);return new Uint8Array(a)}function E3(s){const a=[];return T3(s,l=>a.push(l)),new Uint8Array(a)}function Yg(s){const a=[],l={queue:0,queuedBits:0},u=f=>{a.push(f)};return s.forEach(f=>ZE(f,l,u)),ZE(null,l,u),a.join("")}function A3(s){return Math.round(Date.now()/1e3)+s}function C3(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const a=Math.random()*16|0;return(s=="x"?a:a&3|8).toString(16)})}const Wu=()=>typeof window<"u"&&typeof document<"u",Fg={tested:!1,writable:!1},vP=()=>{if(!Wu())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Fg.tested)return Fg.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Fg.tested=!0,Fg.writable=!0}catch{Fg.tested=!0,Fg.writable=!1}return Fg.writable};function M3(s){const a={},l=new URL(s);if(l.hash&&l.hash[0]==="#")try{new URLSearchParams(l.hash.substring(1)).forEach((f,y)=>{a[y]=f})}catch{}return l.searchParams.forEach((u,f)=>{a[f]=u}),a}const xP=s=>{let a;return s?a=s:typeof fetch>"u"?a=(...l)=>Sx(async()=>{const{default:u}=await Promise.resolve().then(()=>Ey);return{default:u}},void 0).then(({default:u})=>u(...l)):a=fetch,(...l)=>a(...l)},P3=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",fy=async(s,a,l)=>{await s.setItem(a,JSON.stringify(l))},Bg=async(s,a)=>{const l=await s.getItem(a);if(!l)return null;try{return JSON.parse(l)}catch{return l}},jp=async(s,a)=>{await s.removeItem(a)};class Gb{constructor(){this.promise=new Gb.promiseConstructor((a,l)=>{this.resolve=a,this.reject=l})}}Gb.promiseConstructor=Promise;function S1(s){const a=s.split(".");if(a.length!==3)throw new vS("Invalid JWT structure");for(let u=0;u<a.length;u++)if(!g3.test(a[u]))throw new vS("JWT not in base64url format");return{header:JSON.parse(XE(a[0])),payload:JSON.parse(XE(a[1])),signature:gy(a[2]),raw:{header:a[0],payload:a[1]}}}async function j3(s){return await new Promise(a=>{setTimeout(()=>a(null),s)})}function R3(s,a){return new Promise((u,f)=>{(async()=>{for(let y=0;y<1/0;y++)try{const w=await s(y);if(!a(y,null,w)){u(w);return}}catch(w){if(!a(y,w)){f(w);return}}})()})}function L3(s){return("0"+s.toString(16)).substr(-2)}function I3(){const a=new Uint32Array(56);if(typeof crypto>"u"){const l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",u=l.length;let f="";for(let y=0;y<56;y++)f+=l.charAt(Math.floor(Math.random()*u));return f}return crypto.getRandomValues(a),Array.from(a,L3).join("")}async function z3(s){const l=new TextEncoder().encode(s),u=await crypto.subtle.digest("SHA-256",l),f=new Uint8Array(u);return Array.from(f).map(y=>String.fromCharCode(y)).join("")}async function D3(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const l=await z3(s);return btoa(l).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ay(s,a,l=!1){const u=I3();let f=u;l&&(f+="/PASSWORD_RECOVERY"),await fy(s,`${a}-code-verifier`,f);const y=await D3(u);return[y,u===y?"plain":"s256"]}const O3=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function N3(s){const a=s.headers.get(_S);if(!a||!a.match(O3))return null;try{return new Date(`${a}T00:00:00.0Z`)}catch{return null}}function F3(s){if(!s)throw new Error("Missing exp claim");const a=Math.floor(Date.now()/1e3);if(s<=a)throw new Error("JWT has expired")}function B3(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const U3=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ry(s){if(!U3.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function T1(){const s={};return new Proxy(s,{get:(a,l)=>{if(l==="__isUserNotAvailableProxy")return!0;if(typeof l=="symbol"){const u=l.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${l}" property of the session object is not supported. Please use getUser() instead.`)},set:(a,l)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${l}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(a,l)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${l}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function YE(s){return JSON.parse(JSON.stringify(s))}var $3=function(s,a){var l={};for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&a.indexOf(u)<0&&(l[u]=s[u]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,u=Object.getOwnPropertySymbols(s);f<u.length;f++)a.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(s,u[f])&&(l[u[f]]=s[u[f]]);return l};const Gg=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),V3=[502,503,504];async function KE(s){var a;if(!P3(s))throw new yS(Gg(s),0);if(V3.includes(s.status))throw new yS(Gg(s),s.status);let l;try{l=await s.json()}catch(y){throw new Zg(Gg(y),y)}let u;const f=N3(s);if(f&&f.getTime()>=_P["2024-01-01"].timestamp&&typeof l=="object"&&l&&typeof l.code=="string"?u=l.code:typeof l=="object"&&l&&typeof l.error_code=="string"&&(u=l.error_code),u){if(u==="weak_password")throw new qE(Gg(l),s.status,((a=l.weak_password)===null||a===void 0?void 0:a.reasons)||[]);if(u==="session_not_found")throw new Lp}else if(typeof l=="object"&&l&&typeof l.weak_password=="object"&&l.weak_password&&Array.isArray(l.weak_password.reasons)&&l.weak_password.reasons.length&&l.weak_password.reasons.reduce((y,w)=>y&&typeof w=="string",!0))throw new qE(Gg(l),s.status,l.weak_password.reasons);throw new y3(Gg(l),s.status||500,u)}const H3=(s,a,l,u)=>{const f={method:s,headers:a?.headers||{}};return s==="GET"?f:(f.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},a?.headers),f.body=JSON.stringify(u),Object.assign(Object.assign({},f),l))};async function Va(s,a,l,u){var f;const y=Object.assign({},u?.headers);y[_S]||(y[_S]=_P["2024-01-01"].name),u?.jwt&&(y.Authorization=`Bearer ${u.jwt}`);const w=(f=u?.query)!==null&&f!==void 0?f:{};u?.redirectTo&&(w.redirect_to=u.redirectTo);const i=Object.keys(w).length?"?"+new URLSearchParams(w).toString():"",C=await G3(s,a,l+i,{headers:y,noResolveJson:u?.noResolveJson},{},u?.body);return u?.xform?u?.xform(C):{data:Object.assign({},C),error:null}}async function G3(s,a,l,u,f,y){const w=H3(a,u,f,y);let i;try{i=await s(l,Object.assign({},w))}catch(C){throw console.error(C),new yS(Gg(C),0)}if(i.ok||await KE(i),u?.noResolveJson)return i;try{return await i.json()}catch(C){await KE(C)}}function bh(s){var a;let l=null;Z3(s)&&(l=Object.assign({},s),s.expires_at||(l.expires_at=A3(s.expires_in)));const u=(a=s.user)!==null&&a!==void 0?a:s;return{data:{session:l,user:u},error:null}}function JE(s){const a=bh(s);return!a.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0)&&(a.data.weak_password=s.weak_password),a}function Dp(s){var a;return{data:{user:(a=s.user)!==null&&a!==void 0?a:s},error:null}}function q3(s){return{data:s,error:null}}function W3(s){const{action_link:a,email_otp:l,hashed_token:u,redirect_to:f,verification_type:y}=s,w=$3(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),i={action_link:a,email_otp:l,hashed_token:u,redirect_to:f,verification_type:y},C=Object.assign({},w);return{data:{properties:i,user:C},error:null}}function QE(s){return s}function Z3(s){return s.access_token&&s.refresh_token&&s.expires_in}const k1=["global","local","others"];var X3=function(s,a){var l={};for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&a.indexOf(u)<0&&(l[u]=s[u]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,u=Object.getOwnPropertySymbols(s);f<u.length;f++)a.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(s,u[f])&&(l[u[f]]=s[u[f]]);return l};class Y3{constructor({url:a="",headers:l={},fetch:u}){this.url=a,this.headers=l,this.fetch=xP(u),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(a,l=k1[0]){if(k1.indexOf(l)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${k1.join(", ")}`);try{return await Va(this.fetch,"POST",`${this.url}/logout?scope=${l}`,{headers:this.headers,jwt:a,noResolveJson:!0}),{data:null,error:null}}catch(u){if(ga(u))return{data:null,error:u};throw u}}async inviteUserByEmail(a,l={}){try{return await Va(this.fetch,"POST",`${this.url}/invite`,{body:{email:a,data:l.data},headers:this.headers,redirectTo:l.redirectTo,xform:Dp})}catch(u){if(ga(u))return{data:{user:null},error:u};throw u}}async generateLink(a){try{const{options:l}=a,u=X3(a,["options"]),f=Object.assign(Object.assign({},u),l);return"newEmail"in u&&(f.new_email=u?.newEmail,delete f.newEmail),await Va(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:f,headers:this.headers,xform:W3,redirectTo:l?.redirectTo})}catch(l){if(ga(l))return{data:{properties:null,user:null},error:l};throw l}}async createUser(a){try{return await Va(this.fetch,"POST",`${this.url}/admin/users`,{body:a,headers:this.headers,xform:Dp})}catch(l){if(ga(l))return{data:{user:null},error:l};throw l}}async listUsers(a){var l,u,f,y,w,i,C;try{const P={nextPage:null,lastPage:0,total:0},D=await Va(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(u=(l=a?.page)===null||l===void 0?void 0:l.toString())!==null&&u!==void 0?u:"",per_page:(y=(f=a?.perPage)===null||f===void 0?void 0:f.toString())!==null&&y!==void 0?y:""},xform:QE});if(D.error)throw D.error;const $=await D.json(),G=(w=D.headers.get("x-total-count"))!==null&&w!==void 0?w:0,X=(C=(i=D.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&C!==void 0?C:[];return X.length>0&&(X.forEach(te=>{const le=parseInt(te.split(";")[0].split("=")[1].substring(0,1)),re=JSON.parse(te.split(";")[1].split("=")[1]);P[`${re}Page`]=le}),P.total=parseInt(G)),{data:Object.assign(Object.assign({},$),P),error:null}}catch(P){if(ga(P))return{data:{users:[]},error:P};throw P}}async getUserById(a){ry(a);try{return await Va(this.fetch,"GET",`${this.url}/admin/users/${a}`,{headers:this.headers,xform:Dp})}catch(l){if(ga(l))return{data:{user:null},error:l};throw l}}async updateUserById(a,l){ry(a);try{return await Va(this.fetch,"PUT",`${this.url}/admin/users/${a}`,{body:l,headers:this.headers,xform:Dp})}catch(u){if(ga(u))return{data:{user:null},error:u};throw u}}async deleteUser(a,l=!1){ry(a);try{return await Va(this.fetch,"DELETE",`${this.url}/admin/users/${a}`,{headers:this.headers,body:{should_soft_delete:l},xform:Dp})}catch(u){if(ga(u))return{data:{user:null},error:u};throw u}}async _listFactors(a){ry(a.userId);try{const{data:l,error:u}=await Va(this.fetch,"GET",`${this.url}/admin/users/${a.userId}/factors`,{headers:this.headers,xform:f=>({data:{factors:f},error:null})});return{data:l,error:u}}catch(l){if(ga(l))return{data:null,error:l};throw l}}async _deleteFactor(a){ry(a.userId),ry(a.id);try{return{data:await Va(this.fetch,"DELETE",`${this.url}/admin/users/${a.userId}/factors/${a.id}`,{headers:this.headers}),error:null}}catch(l){if(ga(l))return{data:null,error:l};throw l}}async _listOAuthClients(a){var l,u,f,y,w,i,C;try{const P={nextPage:null,lastPage:0,total:0},D=await Va(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(u=(l=a?.page)===null||l===void 0?void 0:l.toString())!==null&&u!==void 0?u:"",per_page:(y=(f=a?.perPage)===null||f===void 0?void 0:f.toString())!==null&&y!==void 0?y:""},xform:QE});if(D.error)throw D.error;const $=await D.json(),G=(w=D.headers.get("x-total-count"))!==null&&w!==void 0?w:0,X=(C=(i=D.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&C!==void 0?C:[];return X.length>0&&(X.forEach(te=>{const le=parseInt(te.split(";")[0].split("=")[1].substring(0,1)),re=JSON.parse(te.split(";")[1].split("=")[1]);P[`${re}Page`]=le}),P.total=parseInt(G)),{data:Object.assign(Object.assign({},$),P),error:null}}catch(P){if(ga(P))return{data:{clients:[]},error:P};throw P}}async _createOAuthClient(a){try{return await Va(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:a,headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(ga(l))return{data:null,error:l};throw l}}async _getOAuthClient(a){try{return await Va(this.fetch,"GET",`${this.url}/admin/oauth/clients/${a}`,{headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(ga(l))return{data:null,error:l};throw l}}async _deleteOAuthClient(a){try{return await Va(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${a}`,{headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(ga(l))return{data:null,error:l};throw l}}async _regenerateOAuthClientSecret(a){try{return await Va(this.fetch,"POST",`${this.url}/admin/oauth/clients/${a}/regenerate_secret`,{headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(ga(l))return{data:null,error:l};throw l}}}function eA(s={}){return{getItem:a=>s[a]||null,setItem:(a,l)=>{s[a]=l},removeItem:a=>{delete s[a]}}}const sy={debug:!!(globalThis&&vP()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class bP extends Error{constructor(a){super(a),this.isAcquireTimeout=!0}}class K3 extends bP{}async function J3(s,a,l){sy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,a);const u=new globalThis.AbortController;return a>0&&setTimeout(()=>{u.abort(),sy.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},a),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,a===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:u.signal},async f=>{if(f){sy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,f.name);try{return await l()}finally{sy.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,f.name)}}else{if(a===0)throw sy.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new K3(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(sy.debug)try{const y=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(y,null,"  "))}catch(y){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",y)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await l()}}))}function Q3(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function wP(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function eF(s){return parseInt(s,16)}function tF(s){const a=new TextEncoder().encode(s);return"0x"+Array.from(a,u=>u.toString(16).padStart(2,"0")).join("")}function iF(s){var a;const{chainId:l,domain:u,expirationTime:f,issuedAt:y=new Date,nonce:w,notBefore:i,requestId:C,resources:P,scheme:D,uri:$,version:G}=s;{if(!Number.isInteger(l))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${l}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(w&&w.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${w}`);if(!$)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(G!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${G}`);if(!((a=s.statement)===null||a===void 0)&&a.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const X=wP(s.address),te=D?`${D}://${u}`:u,le=s.statement?`${s.statement}
`:"",re=`${te} wants you to sign in with your Ethereum account:
${X}

${le}`;let fe=`URI: ${$}
Version: ${G}
Chain ID: ${l}${w?`
Nonce: ${w}`:""}
Issued At: ${y.toISOString()}`;if(f&&(fe+=`
Expiration Time: ${f.toISOString()}`),i&&(fe+=`
Not Before: ${i.toISOString()}`),C&&(fe+=`
Request ID: ${C}`),P){let xe=`
Resources:`;for(const be of P){if(!be||typeof be!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${be}`);xe+=`
- ${be}`}fe+=xe}return`${re}
${fe}`}class Go extends Error{constructor({message:a,code:l,cause:u,name:f}){var y;super(a,{cause:u}),this.__isWebAuthnError=!0,this.name=(y=f??(u instanceof Error?u.name:void 0))!==null&&y!==void 0?y:"Unknown Error",this.code=l}}class Eb extends Go{constructor(a,l){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l,message:a}),this.name="WebAuthnUnknownError",this.originalError=l}}function nF({error:s,options:a}){var l,u,f;const{publicKey:y}=a;if(!y)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(a.signal instanceof AbortSignal)return new Go({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else if(s.name==="ConstraintError"){if(((l=y.authenticatorSelection)===null||l===void 0?void 0:l.requireResidentKey)===!0)return new Go({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:s});if(a.mediation==="conditional"&&((u=y.authenticatorSelection)===null||u===void 0?void 0:u.userVerification)==="required")return new Go({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:s});if(((f=y.authenticatorSelection)===null||f===void 0?void 0:f.userVerification)==="required")return new Go({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:s})}else{if(s.name==="InvalidStateError")return new Go({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:s});if(s.name==="NotAllowedError")return new Go({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="NotSupportedError")return y.pubKeyCredParams.filter(i=>i.type==="public-key").length===0?new Go({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:s}):new Go({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:s});if(s.name==="SecurityError"){const w=window.location.hostname;if(TP(w)){if(y.rp.id!==w)return new Go({message:`The RP ID "${y.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new Go({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="TypeError"){if(y.user.id.byteLength<1||y.user.id.byteLength>64)return new Go({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:s})}else if(s.name==="UnknownError")return new Go({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new Go({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}function aF({error:s,options:a}){const{publicKey:l}=a;if(!l)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(a.signal instanceof AbortSignal)return new Go({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else{if(s.name==="NotAllowedError")return new Go({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="SecurityError"){const u=window.location.hostname;if(TP(u)){if(l.rpId!==u)return new Go({message:`The RP ID "${l.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new Go({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="UnknownError")return new Go({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new Go({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}var SP=function(s,a){var l={};for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&a.indexOf(u)<0&&(l[u]=s[u]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,u=Object.getOwnPropertySymbols(s);f<u.length;f++)a.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(s,u[f])&&(l[u[f]]=s[u[f]]);return l};class rF{createNewAbortSignal(){if(this.controller){const l=new Error("Cancelling existing WebAuthn API call for new one");l.name="AbortError",this.controller.abort(l)}const a=new AbortController;return this.controller=a,a.signal}cancelCeremony(){if(this.controller){const a=new Error("Manually cancelling existing WebAuthn API call");a.name="AbortError",this.controller.abort(a),this.controller=void 0}}}const sF=new rF;function oF(s){if(!s)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(s);const{challenge:a,user:l,excludeCredentials:u}=s,f=SP(s,["challenge","user","excludeCredentials"]),y=gy(a).buffer,w=Object.assign(Object.assign({},l),{id:gy(l.id).buffer}),i=Object.assign(Object.assign({},f),{challenge:y,user:w});if(u&&u.length>0){i.excludeCredentials=new Array(u.length);for(let C=0;C<u.length;C++){const P=u[C];i.excludeCredentials[C]=Object.assign(Object.assign({},P),{id:gy(P.id).buffer,type:P.type||"public-key",transports:P.transports})}}return i}function lF(s){if(!s)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(s);const{challenge:a,allowCredentials:l}=s,u=SP(s,["challenge","allowCredentials"]),f=gy(a).buffer,y=Object.assign(Object.assign({},u),{challenge:f});if(l&&l.length>0){y.allowCredentials=new Array(l.length);for(let w=0;w<l.length;w++){const i=l[w];y.allowCredentials[w]=Object.assign(Object.assign({},i),{id:gy(i.id).buffer,type:i.type||"public-key",transports:i.transports})}}return y}function cF(s){var a;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const l=s;return{id:s.id,rawId:s.id,response:{attestationObject:Yg(new Uint8Array(s.response.attestationObject)),clientDataJSON:Yg(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:(a=l.authenticatorAttachment)!==null&&a!==void 0?a:void 0}}function uF(s){var a;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const l=s,u=s.getClientExtensionResults(),f=s.response;return{id:s.id,rawId:s.id,response:{authenticatorData:Yg(new Uint8Array(f.authenticatorData)),clientDataJSON:Yg(new Uint8Array(f.clientDataJSON)),signature:Yg(new Uint8Array(f.signature)),userHandle:f.userHandle?Yg(new Uint8Array(f.userHandle)):void 0},type:"public-key",clientExtensionResults:u,authenticatorAttachment:(a=l.authenticatorAttachment)!==null&&a!==void 0?a:void 0}}function TP(s){return s==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(s)}function tA(){var s,a;return!!(Wu()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((s=navigator?.credentials)===null||s===void 0?void 0:s.create)=="function"&&typeof((a=navigator?.credentials)===null||a===void 0?void 0:a.get)=="function")}async function dF(s){try{const a=await navigator.credentials.create(s);return a?a instanceof PublicKeyCredential?{data:a,error:null}:{data:null,error:new Eb("Browser returned unexpected credential type",a)}:{data:null,error:new Eb("Empty credential response",a)}}catch(a){return{data:null,error:nF({error:a,options:s})}}}async function hF(s){try{const a=await navigator.credentials.get(s);return a?a instanceof PublicKeyCredential?{data:a,error:null}:{data:null,error:new Eb("Browser returned unexpected credential type",a)}:{data:null,error:new Eb("Empty credential response",a)}}catch(a){return{data:null,error:aF({error:a,options:s})}}}const fF={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},mF={userVerification:"preferred",hints:["security-key"]};function Ab(...s){const a=f=>f!==null&&typeof f=="object"&&!Array.isArray(f),l=f=>f instanceof ArrayBuffer||ArrayBuffer.isView(f),u={};for(const f of s)if(f)for(const y in f){const w=f[y];if(w!==void 0)if(Array.isArray(w))u[y]=w;else if(l(w))u[y]=w;else if(a(w)){const i=u[y];a(i)?u[y]=Ab(i,w):u[y]=Ab(w)}else u[y]=w}return u}function pF(s,a){return Ab(fF,s,a||{})}function gF(s,a){return Ab(mF,s,a||{})}class _F{constructor(a){this.client=a,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(a){return this.client.mfa.enroll(Object.assign(Object.assign({},a),{factorType:"webauthn"}))}async _challenge({factorId:a,webauthn:l,friendlyName:u,signal:f},y){try{const{data:w,error:i}=await this.client.mfa.challenge({factorId:a,webauthn:l});if(!w)return{data:null,error:i};const C=f??sF.createNewAbortSignal();if(w.webauthn.type==="create"){const{user:P}=w.webauthn.credential_options.publicKey;P.name||(P.name=`${P.id}:${u}`),P.displayName||(P.displayName=P.name)}switch(w.webauthn.type){case"create":{const P=pF(w.webauthn.credential_options.publicKey,y?.create),{data:D,error:$}=await dF({publicKey:P,signal:C});return D?{data:{factorId:a,challengeId:w.id,webauthn:{type:w.webauthn.type,credential_response:D}},error:null}:{data:null,error:$}}case"request":{const P=gF(w.webauthn.credential_options.publicKey,y?.request),{data:D,error:$}=await hF(Object.assign(Object.assign({},w.webauthn.credential_options),{publicKey:P,signal:C}));return D?{data:{factorId:a,challengeId:w.id,webauthn:{type:w.webauthn.type,credential_response:D}},error:null}:{data:null,error:$}}}}catch(w){return ga(w)?{data:null,error:w}:{data:null,error:new Zg("Unexpected error in challenge",w)}}}async _verify({challengeId:a,factorId:l,webauthn:u}){return this.client.mfa.verify({factorId:l,challengeId:a,webauthn:u})}async _authenticate({factorId:a,webauthn:{rpId:l=typeof window<"u"?window.location.hostname:void 0,rpOrigins:u=typeof window<"u"?[window.location.origin]:void 0,signal:f}},y){if(!l)return{data:null,error:new dx("rpId is required for WebAuthn authentication")};try{if(!tA())return{data:null,error:new Zg("Browser does not support WebAuthn",null)};const{data:w,error:i}=await this.challenge({factorId:a,webauthn:{rpId:l,rpOrigins:u},signal:f},{request:y});if(!w)return{data:null,error:i};const{webauthn:C}=w;return this._verify({factorId:a,challengeId:w.challengeId,webauthn:{type:C.type,rpId:l,rpOrigins:u,credential_response:C.credential_response}})}catch(w){return ga(w)?{data:null,error:w}:{data:null,error:new Zg("Unexpected error in authenticate",w)}}}async _register({friendlyName:a,rpId:l=typeof window<"u"?window.location.hostname:void 0,rpOrigins:u=typeof window<"u"?[window.location.origin]:void 0,signal:f},y){if(!l)return{data:null,error:new dx("rpId is required for WebAuthn registration")};try{if(!tA())return{data:null,error:new Zg("Browser does not support WebAuthn",null)};const{data:w,error:i}=await this._enroll({friendlyName:a});if(!w)return await this.client.mfa.listFactors().then(D=>{var $;return($=D.data)===null||$===void 0?void 0:$.all.find(G=>G.factor_type==="webauthn"&&G.friendly_name===a&&G.status!=="unverified")}).then(D=>D?this.client.mfa.unenroll({factorId:D?.id}):void 0),{data:null,error:i};const{data:C,error:P}=await this._challenge({factorId:w.id,friendlyName:w.friendly_name,webauthn:{rpId:l,rpOrigins:u},signal:f},{create:y});return C?this._verify({factorId:w.id,challengeId:C.challengeId,webauthn:{rpId:l,rpOrigins:u,type:C.webauthn.type,credential_response:C.webauthn.credential_response}}):{data:null,error:P}}catch(w){return ga(w)?{data:null,error:w}:{data:null,error:new Zg("Unexpected error in register",w)}}}}Q3();const yF={url:f3,storageKey:m3,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:p3,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function iA(s,a,l){return await l()}const oy={};class hx{get jwks(){var a,l;return(l=(a=oy[this.storageKey])===null||a===void 0?void 0:a.jwks)!==null&&l!==void 0?l:{keys:[]}}set jwks(a){oy[this.storageKey]=Object.assign(Object.assign({},oy[this.storageKey]),{jwks:a})}get jwks_cached_at(){var a,l;return(l=(a=oy[this.storageKey])===null||a===void 0?void 0:a.cachedAt)!==null&&l!==void 0?l:Number.MIN_SAFE_INTEGER}set jwks_cached_at(a){oy[this.storageKey]=Object.assign(Object.assign({},oy[this.storageKey]),{cachedAt:a})}constructor(a){var l,u;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=hx.nextInstanceID,hx.nextInstanceID+=1,this.instanceID>0&&Wu()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const f=Object.assign(Object.assign({},yF),a);if(this.logDebugMessages=!!f.debug,typeof f.debug=="function"&&(this.logger=f.debug),this.persistSession=f.persistSession,this.storageKey=f.storageKey,this.autoRefreshToken=f.autoRefreshToken,this.admin=new Y3({url:f.url,headers:f.headers,fetch:f.fetch}),this.url=f.url,this.headers=f.headers,this.fetch=xP(f.fetch),this.lock=f.lock||iA,this.detectSessionInUrl=f.detectSessionInUrl,this.flowType=f.flowType,this.hasCustomAuthorizationHeader=f.hasCustomAuthorizationHeader,f.lock?this.lock=f.lock:Wu()&&(!((l=globalThis?.navigator)===null||l===void 0)&&l.locks)?this.lock=J3:this.lock=iA,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new _F(this)},this.persistSession?(f.storage?this.storage=f.storage:vP()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=eA(this.memoryStorage)),f.userStorage&&(this.userStorage=f.userStorage)):(this.memoryStorage={},this.storage=eA(this.memoryStorage)),Wu()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(y){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",y)}(u=this.broadcastChannel)===null||u===void 0||u.addEventListener("message",async y=>{this._debug("received broadcast notification from other tab or client",y),await this._notifyAllSubscribers(y.data.event,y.data.session,!1)})}this.initialize()}_debug(...a){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${gP}) ${new Date().toISOString()}`,...a),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var a;try{const l=M3(window.location.href);let u="none";if(this._isImplicitGrantCallback(l)?u="implicit":await this._isPKCECallback(l)&&(u="pkce"),Wu()&&this.detectSessionInUrl&&u!=="none"){const{data:f,error:y}=await this._getSessionFromURL(l,u);if(y){if(this._debug("#_initialize()","error detecting session from URL",y),b3(y)){const C=(a=y.details)===null||a===void 0?void 0:a.code;if(C==="identity_already_exists"||C==="identity_not_found"||C==="single_identity_not_deletable")return{error:y}}return await this._removeSession(),{error:y}}const{session:w,redirectType:i}=f;return this._debug("#_initialize()","detected session in URL",w,"redirect type",i),await this._saveSession(w),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",w):await this._notifyAllSubscribers("SIGNED_IN",w)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(l){return ga(l)?{error:l}:{error:new Zg("Unexpected error during initialization",l)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(a){var l,u,f;try{const y=await Va(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(u=(l=a?.options)===null||l===void 0?void 0:l.data)!==null&&u!==void 0?u:{},gotrue_meta_security:{captcha_token:(f=a?.options)===null||f===void 0?void 0:f.captchaToken}},xform:bh}),{data:w,error:i}=y;if(i||!w)return{data:{user:null,session:null},error:i};const C=w.session,P=w.user;return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",C)),{data:{user:P,session:C},error:null}}catch(y){if(ga(y))return{data:{user:null,session:null},error:y};throw y}}async signUp(a){var l,u,f;try{let y;if("email"in a){const{email:D,password:$,options:G}=a;let X=null,te=null;this.flowType==="pkce"&&([X,te]=await ay(this.storage,this.storageKey)),y=await Va(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:G?.emailRedirectTo,body:{email:D,password:$,data:(l=G?.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:G?.captchaToken},code_challenge:X,code_challenge_method:te},xform:bh})}else if("phone"in a){const{phone:D,password:$,options:G}=a;y=await Va(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:D,password:$,data:(u=G?.data)!==null&&u!==void 0?u:{},channel:(f=G?.channel)!==null&&f!==void 0?f:"sms",gotrue_meta_security:{captcha_token:G?.captchaToken}},xform:bh})}else throw new D0("You must provide either an email or phone number and a password");const{data:w,error:i}=y;if(i||!w)return{data:{user:null,session:null},error:i};const C=w.session,P=w.user;return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",C)),{data:{user:P,session:C},error:null}}catch(y){if(ga(y))return{data:{user:null,session:null},error:y};throw y}}async signInWithPassword(a){try{let l;if("email"in a){const{email:y,password:w,options:i}=a;l=await Va(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:y,password:w,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:JE})}else if("phone"in a){const{phone:y,password:w,options:i}=a;l=await Va(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:y,password:w,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:JE})}else throw new D0("You must provide either an email or phone number and a password");const{data:u,error:f}=l;return f?{data:{user:null,session:null},error:f}:!u||!u.session||!u.user?{data:{user:null,session:null},error:new ny}:(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),{data:Object.assign({user:u.user,session:u.session},u.weak_password?{weakPassword:u.weak_password}:null),error:f})}catch(l){if(ga(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithOAuth(a){var l,u,f,y;return await this._handleProviderSignIn(a.provider,{redirectTo:(l=a.options)===null||l===void 0?void 0:l.redirectTo,scopes:(u=a.options)===null||u===void 0?void 0:u.scopes,queryParams:(f=a.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:(y=a.options)===null||y===void 0?void 0:y.skipBrowserRedirect})}async exchangeCodeForSession(a){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(a))}async signInWithWeb3(a){const{chain:l}=a;switch(l){case"ethereum":return await this.signInWithEthereum(a);case"solana":return await this.signInWithSolana(a);default:throw new Error(`@supabase/auth-js: Unsupported chain "${l}"`)}}async signInWithEthereum(a){var l,u,f,y,w,i,C,P,D,$,G;let X,te;if("message"in a)X=a.message,te=a.signature;else{const{chain:le,wallet:re,statement:fe,options:xe}=a;let be;if(Wu())if(typeof re=="object")be=re;else{const He=window;if("ethereum"in He&&typeof He.ethereum=="object"&&"request"in He.ethereum&&typeof He.ethereum.request=="function")be=He.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof re!="object"||!xe?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");be=re}const Ne=new URL((l=xe?.url)!==null&&l!==void 0?l:window.location.href),Be=await be.request({method:"eth_requestAccounts"}).then(He=>He).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Be||Be.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Ee=wP(Be[0]);let et=(u=xe?.signInWithEthereum)===null||u===void 0?void 0:u.chainId;if(!et){const He=await be.request({method:"eth_chainId"});et=eF(He)}const at={domain:Ne.host,address:Ee,statement:fe,uri:Ne.href,version:"1",chainId:et,nonce:(f=xe?.signInWithEthereum)===null||f===void 0?void 0:f.nonce,issuedAt:(w=(y=xe?.signInWithEthereum)===null||y===void 0?void 0:y.issuedAt)!==null&&w!==void 0?w:new Date,expirationTime:(i=xe?.signInWithEthereum)===null||i===void 0?void 0:i.expirationTime,notBefore:(C=xe?.signInWithEthereum)===null||C===void 0?void 0:C.notBefore,requestId:(P=xe?.signInWithEthereum)===null||P===void 0?void 0:P.requestId,resources:(D=xe?.signInWithEthereum)===null||D===void 0?void 0:D.resources};X=iF(at),te=await be.request({method:"personal_sign",params:[tF(X),Ee]})}try{const{data:le,error:re}=await Va(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:X,signature:te},!(($=a.options)===null||$===void 0)&&$.captchaToken?{gotrue_meta_security:{captcha_token:(G=a.options)===null||G===void 0?void 0:G.captchaToken}}:null),xform:bh});if(re)throw re;return!le||!le.session||!le.user?{data:{user:null,session:null},error:new ny}:(le.session&&(await this._saveSession(le.session),await this._notifyAllSubscribers("SIGNED_IN",le.session)),{data:Object.assign({},le),error:re})}catch(le){if(ga(le))return{data:{user:null,session:null},error:le};throw le}}async signInWithSolana(a){var l,u,f,y,w,i,C,P,D,$,G,X;let te,le;if("message"in a)te=a.message,le=a.signature;else{const{chain:re,wallet:fe,statement:xe,options:be}=a;let Ne;if(Wu())if(typeof fe=="object")Ne=fe;else{const Ee=window;if("solana"in Ee&&typeof Ee.solana=="object"&&("signIn"in Ee.solana&&typeof Ee.solana.signIn=="function"||"signMessage"in Ee.solana&&typeof Ee.solana.signMessage=="function"))Ne=Ee.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof fe!="object"||!be?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Ne=fe}const Be=new URL((l=be?.url)!==null&&l!==void 0?l:window.location.href);if("signIn"in Ne&&Ne.signIn){const Ee=await Ne.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},be?.signInWithSolana),{version:"1",domain:Be.host,uri:Be.href}),xe?{statement:xe}:null));let et;if(Array.isArray(Ee)&&Ee[0]&&typeof Ee[0]=="object")et=Ee[0];else if(Ee&&typeof Ee=="object"&&"signedMessage"in Ee&&"signature"in Ee)et=Ee;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in et&&"signature"in et&&(typeof et.signedMessage=="string"||et.signedMessage instanceof Uint8Array)&&et.signature instanceof Uint8Array)te=typeof et.signedMessage=="string"?et.signedMessage:new TextDecoder().decode(et.signedMessage),le=et.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Ne)||typeof Ne.signMessage!="function"||!("publicKey"in Ne)||typeof Ne!="object"||!Ne.publicKey||!("toBase58"in Ne.publicKey)||typeof Ne.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");te=[`${Be.host} wants you to sign in with your Solana account:`,Ne.publicKey.toBase58(),...xe?["",xe,""]:[""],"Version: 1",`URI: ${Be.href}`,`Issued At: ${(f=(u=be?.signInWithSolana)===null||u===void 0?void 0:u.issuedAt)!==null&&f!==void 0?f:new Date().toISOString()}`,...!((y=be?.signInWithSolana)===null||y===void 0)&&y.notBefore?[`Not Before: ${be.signInWithSolana.notBefore}`]:[],...!((w=be?.signInWithSolana)===null||w===void 0)&&w.expirationTime?[`Expiration Time: ${be.signInWithSolana.expirationTime}`]:[],...!((i=be?.signInWithSolana)===null||i===void 0)&&i.chainId?[`Chain ID: ${be.signInWithSolana.chainId}`]:[],...!((C=be?.signInWithSolana)===null||C===void 0)&&C.nonce?[`Nonce: ${be.signInWithSolana.nonce}`]:[],...!((P=be?.signInWithSolana)===null||P===void 0)&&P.requestId?[`Request ID: ${be.signInWithSolana.requestId}`]:[],...!(($=(D=be?.signInWithSolana)===null||D===void 0?void 0:D.resources)===null||$===void 0)&&$.length?["Resources",...be.signInWithSolana.resources.map(et=>`- ${et}`)]:[]].join(`
`);const Ee=await Ne.signMessage(new TextEncoder().encode(te),"utf8");if(!Ee||!(Ee instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");le=Ee}}try{const{data:re,error:fe}=await Va(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:te,signature:Yg(le)},!((G=a.options)===null||G===void 0)&&G.captchaToken?{gotrue_meta_security:{captcha_token:(X=a.options)===null||X===void 0?void 0:X.captchaToken}}:null),xform:bh});if(fe)throw fe;return!re||!re.session||!re.user?{data:{user:null,session:null},error:new ny}:(re.session&&(await this._saveSession(re.session),await this._notifyAllSubscribers("SIGNED_IN",re.session)),{data:Object.assign({},re),error:fe})}catch(re){if(ga(re))return{data:{user:null,session:null},error:re};throw re}}async _exchangeCodeForSession(a){const l=await Bg(this.storage,`${this.storageKey}-code-verifier`),[u,f]=(l??"").split("/");try{const{data:y,error:w}=await Va(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:a,code_verifier:u},xform:bh});if(await jp(this.storage,`${this.storageKey}-code-verifier`),w)throw w;return!y||!y.session||!y.user?{data:{user:null,session:null,redirectType:null},error:new ny}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign(Object.assign({},y),{redirectType:f??null}),error:w})}catch(y){if(ga(y))return{data:{user:null,session:null,redirectType:null},error:y};throw y}}async signInWithIdToken(a){try{const{options:l,provider:u,token:f,access_token:y,nonce:w}=a,i=await Va(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:u,id_token:f,access_token:y,nonce:w,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:bh}),{data:C,error:P}=i;return P?{data:{user:null,session:null},error:P}:!C||!C.session||!C.user?{data:{user:null,session:null},error:new ny}:(C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",C.session)),{data:C,error:P})}catch(l){if(ga(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithOtp(a){var l,u,f,y,w;try{if("email"in a){const{email:i,options:C}=a;let P=null,D=null;this.flowType==="pkce"&&([P,D]=await ay(this.storage,this.storageKey));const{error:$}=await Va(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:(l=C?.data)!==null&&l!==void 0?l:{},create_user:(u=C?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:C?.captchaToken},code_challenge:P,code_challenge_method:D},redirectTo:C?.emailRedirectTo});return{data:{user:null,session:null},error:$}}if("phone"in a){const{phone:i,options:C}=a,{data:P,error:D}=await Va(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:i,data:(f=C?.data)!==null&&f!==void 0?f:{},create_user:(y=C?.shouldCreateUser)!==null&&y!==void 0?y:!0,gotrue_meta_security:{captcha_token:C?.captchaToken},channel:(w=C?.channel)!==null&&w!==void 0?w:"sms"}});return{data:{user:null,session:null,messageId:P?.message_id},error:D}}throw new D0("You must provide either an email or phone number.")}catch(i){if(ga(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(a){var l,u;try{let f,y;"options"in a&&(f=(l=a.options)===null||l===void 0?void 0:l.redirectTo,y=(u=a.options)===null||u===void 0?void 0:u.captchaToken);const{data:w,error:i}=await Va(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},a),{gotrue_meta_security:{captcha_token:y}}),redirectTo:f,xform:bh});if(i)throw i;if(!w)throw new Error("An error occurred on token verification.");const C=w.session,P=w.user;return C?.access_token&&(await this._saveSession(C),await this._notifyAllSubscribers(a.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",C)),{data:{user:P,session:C},error:null}}catch(f){if(ga(f))return{data:{user:null,session:null},error:f};throw f}}async signInWithSSO(a){var l,u,f;try{let y=null,w=null;return this.flowType==="pkce"&&([y,w]=await ay(this.storage,this.storageKey)),await Va(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in a?{provider_id:a.providerId}:null),"domain"in a?{domain:a.domain}:null),{redirect_to:(u=(l=a.options)===null||l===void 0?void 0:l.redirectTo)!==null&&u!==void 0?u:void 0}),!((f=a?.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:a.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:y,code_challenge_method:w}),headers:this.headers,xform:q3})}catch(y){if(ga(y))return{data:null,error:y};throw y}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async a=>{const{data:{session:l},error:u}=a;if(u)throw u;if(!l)throw new Lp;const{error:f}=await Va(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:l.access_token});return{data:{user:null,session:null},error:f}})}catch(a){if(ga(a))return{data:{user:null,session:null},error:a};throw a}}async resend(a){try{const l=`${this.url}/resend`;if("email"in a){const{email:u,type:f,options:y}=a,{error:w}=await Va(this.fetch,"POST",l,{headers:this.headers,body:{email:u,type:f,gotrue_meta_security:{captcha_token:y?.captchaToken}},redirectTo:y?.emailRedirectTo});return{data:{user:null,session:null},error:w}}else if("phone"in a){const{phone:u,type:f,options:y}=a,{data:w,error:i}=await Va(this.fetch,"POST",l,{headers:this.headers,body:{phone:u,type:f,gotrue_meta_security:{captcha_token:y?.captchaToken}}});return{data:{user:null,session:null,messageId:w?.message_id},error:i}}throw new D0("You must provide either an email or phone number and a type")}catch(l){if(ga(l))return{data:{user:null,session:null},error:l};throw l}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async l=>l))}async _acquireLock(a,l){this._debug("#_acquireLock","begin",a);try{if(this.lockAcquired){const u=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),f=(async()=>(await u,await l()))();return this.pendingInLock.push((async()=>{try{await f}catch{}})()),f}return await this.lock(`lock:${this.storageKey}`,a,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const u=l();for(this.pendingInLock.push((async()=>{try{await u}catch{}})()),await u;this.pendingInLock.length;){const f=[...this.pendingInLock];await Promise.all(f),this.pendingInLock.splice(0,f.length)}return await u}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(a){this._debug("#_useSession","begin");try{const l=await this.__loadSession();return await a(l)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let a=null;const l=await Bg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",l),l!==null&&(this._isValidSession(l)?a=l:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!a)return{data:{session:null},error:null};const u=a.expires_at?a.expires_at*1e3-Date.now()<b1:!1;if(this._debug("#__loadSession()",`session has${u?"":" not"} expired`,"expires_at",a.expires_at),!u){if(this.userStorage){const w=await Bg(this.userStorage,this.storageKey+"-user");w?.user?a.user=w.user:a.user=T1()}if(this.storage.isServer&&a.user){let w=this.suppressGetSessionWarning;a=new Proxy(a,{get:(C,P,D)=>(!w&&P==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),w=!0,this.suppressGetSessionWarning=!0),Reflect.get(C,P,D))})}return{data:{session:a},error:null}}const{data:f,error:y}=await this._callRefreshToken(a.refresh_token);return y?{data:{session:null},error:y}:{data:{session:f},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(a){return a?await this._getUser(a):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(a){try{return a?await Va(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:a,xform:Dp}):await this._useSession(async l=>{var u,f,y;const{data:w,error:i}=l;if(i)throw i;return!(!((u=w.session)===null||u===void 0)&&u.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Lp}:await Va(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(y=(f=w.session)===null||f===void 0?void 0:f.access_token)!==null&&y!==void 0?y:void 0,xform:Dp})})}catch(l){if(ga(l))return x3(l)&&(await this._removeSession(),await jp(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:l};throw l}}async updateUser(a,l={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(a,l))}async _updateUser(a,l={}){try{return await this._useSession(async u=>{const{data:f,error:y}=u;if(y)throw y;if(!f.session)throw new Lp;const w=f.session;let i=null,C=null;this.flowType==="pkce"&&a.email!=null&&([i,C]=await ay(this.storage,this.storageKey));const{data:P,error:D}=await Va(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:l?.emailRedirectTo,body:Object.assign(Object.assign({},a),{code_challenge:i,code_challenge_method:C}),jwt:w.access_token,xform:Dp});if(D)throw D;return w.user=P.user,await this._saveSession(w),await this._notifyAllSubscribers("USER_UPDATED",w),{data:{user:w.user},error:null}})}catch(u){if(ga(u))return{data:{user:null},error:u};throw u}}async setSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(a))}async _setSession(a){try{if(!a.access_token||!a.refresh_token)throw new Lp;const l=Date.now()/1e3;let u=l,f=!0,y=null;const{payload:w}=S1(a.access_token);if(w.exp&&(u=w.exp,f=u<=l),f){const{data:i,error:C}=await this._callRefreshToken(a.refresh_token);if(C)return{data:{user:null,session:null},error:C};if(!i)return{data:{user:null,session:null},error:null};y=i}else{const{data:i,error:C}=await this._getUser(a.access_token);if(C)throw C;y={access_token:a.access_token,refresh_token:a.refresh_token,user:i.user,token_type:"bearer",expires_in:u-l,expires_at:u},await this._saveSession(y),await this._notifyAllSubscribers("SIGNED_IN",y)}return{data:{user:y.user,session:y},error:null}}catch(l){if(ga(l))return{data:{session:null,user:null},error:l};throw l}}async refreshSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(a))}async _refreshSession(a){try{return await this._useSession(async l=>{var u;if(!a){const{data:w,error:i}=l;if(i)throw i;a=(u=w.session)!==null&&u!==void 0?u:void 0}if(!a?.refresh_token)throw new Lp;const{data:f,error:y}=await this._callRefreshToken(a.refresh_token);return y?{data:{user:null,session:null},error:y}:f?{data:{user:f.user,session:f},error:null}:{data:{user:null,session:null},error:null}})}catch(l){if(ga(l))return{data:{user:null,session:null},error:l};throw l}}async _getSessionFromURL(a,l){try{if(!Wu())throw new O0("No browser detected.");if(a.error||a.error_description||a.error_code)throw new O0(a.error_description||"Error in URL with unspecified error_description",{error:a.error||"unspecified_error",code:a.error_code||"unspecified_code"});switch(l){case"implicit":if(this.flowType==="pkce")throw new GE("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new O0("Not a valid implicit grant flow url.");break;default:}if(l==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!a.code)throw new GE("No code detected.");const{data:xe,error:be}=await this._exchangeCodeForSession(a.code);if(be)throw be;const Ne=new URL(window.location.href);return Ne.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Ne.toString()),{data:{session:xe.session,redirectType:null},error:null}}const{provider_token:u,provider_refresh_token:f,access_token:y,refresh_token:w,expires_in:i,expires_at:C,token_type:P}=a;if(!y||!i||!w||!P)throw new O0("No session defined in URL");const D=Math.round(Date.now()/1e3),$=parseInt(i);let G=D+$;C&&(G=parseInt(C));const X=G-D;X*1e3<=hy&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${X}s, should have been closer to ${$}s`);const te=G-$;D-te>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",te,G,D):D-te<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",te,G,D);const{data:le,error:re}=await this._getUser(y);if(re)throw re;const fe={provider_token:u,provider_refresh_token:f,access_token:y,expires_in:$,expires_at:G,refresh_token:w,token_type:P,user:le.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:fe,redirectType:a.type},error:null}}catch(u){if(ga(u))return{data:{session:null,redirectType:null},error:u};throw u}}_isImplicitGrantCallback(a){return!!(a.access_token||a.error_description)}async _isPKCECallback(a){const l=await Bg(this.storage,`${this.storageKey}-code-verifier`);return!!(a.code&&l)}async signOut(a={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(a))}async _signOut({scope:a}={scope:"global"}){return await this._useSession(async l=>{var u;const{data:f,error:y}=l;if(y)return{error:y};const w=(u=f.session)===null||u===void 0?void 0:u.access_token;if(w){const{error:i}=await this.admin.signOut(w,a);if(i&&!(v3(i)&&(i.status===404||i.status===401||i.status===403)))return{error:i}}return a!=="others"&&(await this._removeSession(),await jp(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(a){const l=C3(),u={id:l,callback:a,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",l),this.stateChangeEmitters.delete(l)}};return this._debug("#onAuthStateChange()","registered callback with id",l),this.stateChangeEmitters.set(l,u),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(l)})))(),{data:{subscription:u}}}async _emitInitialSession(a){return await this._useSession(async l=>{var u,f;try{const{data:{session:y},error:w}=l;if(w)throw w;await((u=this.stateChangeEmitters.get(a))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",y)),this._debug("INITIAL_SESSION","callback id",a,"session",y)}catch(y){await((f=this.stateChangeEmitters.get(a))===null||f===void 0?void 0:f.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",a,"error",y),console.error(y)}})}async resetPasswordForEmail(a,l={}){let u=null,f=null;this.flowType==="pkce"&&([u,f]=await ay(this.storage,this.storageKey,!0));try{return await Va(this.fetch,"POST",`${this.url}/recover`,{body:{email:a,code_challenge:u,code_challenge_method:f,gotrue_meta_security:{captcha_token:l.captchaToken}},headers:this.headers,redirectTo:l.redirectTo})}catch(y){if(ga(y))return{data:null,error:y};throw y}}async getUserIdentities(){var a;try{const{data:l,error:u}=await this.getUser();if(u)throw u;return{data:{identities:(a=l.user.identities)!==null&&a!==void 0?a:[]},error:null}}catch(l){if(ga(l))return{data:null,error:l};throw l}}async linkIdentity(a){return"token"in a?this.linkIdentityIdToken(a):this.linkIdentityOAuth(a)}async linkIdentityOAuth(a){var l;try{const{data:u,error:f}=await this._useSession(async y=>{var w,i,C,P,D;const{data:$,error:G}=y;if(G)throw G;const X=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,a.provider,{redirectTo:(w=a.options)===null||w===void 0?void 0:w.redirectTo,scopes:(i=a.options)===null||i===void 0?void 0:i.scopes,queryParams:(C=a.options)===null||C===void 0?void 0:C.queryParams,skipBrowserRedirect:!0});return await Va(this.fetch,"GET",X,{headers:this.headers,jwt:(D=(P=$.session)===null||P===void 0?void 0:P.access_token)!==null&&D!==void 0?D:void 0})});if(f)throw f;return Wu()&&!(!((l=a.options)===null||l===void 0)&&l.skipBrowserRedirect)&&window.location.assign(u?.url),{data:{provider:a.provider,url:u?.url},error:null}}catch(u){if(ga(u))return{data:{provider:a.provider,url:null},error:u};throw u}}async linkIdentityIdToken(a){return await this._useSession(async l=>{var u;try{const{error:f,data:{session:y}}=l;if(f)throw f;const{options:w,provider:i,token:C,access_token:P,nonce:D}=a,$=await Va(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(u=y?.access_token)!==null&&u!==void 0?u:void 0,body:{provider:i,id_token:C,access_token:P,nonce:D,link_identity:!0,gotrue_meta_security:{captcha_token:w?.captchaToken}},xform:bh}),{data:G,error:X}=$;return X?{data:{user:null,session:null},error:X}:!G||!G.session||!G.user?{data:{user:null,session:null},error:new ny}:(G.session&&(await this._saveSession(G.session),await this._notifyAllSubscribers("USER_UPDATED",G.session)),{data:G,error:X})}catch(f){if(ga(f))return{data:{user:null,session:null},error:f};throw f}})}async unlinkIdentity(a){try{return await this._useSession(async l=>{var u,f;const{data:y,error:w}=l;if(w)throw w;return await Va(this.fetch,"DELETE",`${this.url}/user/identities/${a.identity_id}`,{headers:this.headers,jwt:(f=(u=y.session)===null||u===void 0?void 0:u.access_token)!==null&&f!==void 0?f:void 0})})}catch(l){if(ga(l))return{data:null,error:l};throw l}}async _refreshAccessToken(a){const l=`#_refreshAccessToken(${a.substring(0,5)}...)`;this._debug(l,"begin");try{const u=Date.now();return await R3(async f=>(f>0&&await j3(200*Math.pow(2,f-1)),this._debug(l,"refreshing attempt",f),await Va(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:a},headers:this.headers,xform:bh})),(f,y)=>{const w=200*Math.pow(2,f);return y&&w1(y)&&Date.now()+w-u<hy})}catch(u){if(this._debug(l,"error",u),ga(u))return{data:{session:null,user:null},error:u};throw u}finally{this._debug(l,"end")}}_isValidSession(a){return typeof a=="object"&&a!==null&&"access_token"in a&&"refresh_token"in a&&"expires_at"in a}async _handleProviderSignIn(a,l){const u=await this._getUrlForProvider(`${this.url}/authorize`,a,{redirectTo:l.redirectTo,scopes:l.scopes,queryParams:l.queryParams});return this._debug("#_handleProviderSignIn()","provider",a,"options",l,"url",u),Wu()&&!l.skipBrowserRedirect&&window.location.assign(u),{data:{provider:a,url:u},error:null}}async _recoverAndRefresh(){var a,l;const u="#_recoverAndRefresh()";this._debug(u,"begin");try{const f=await Bg(this.storage,this.storageKey);if(f&&this.userStorage){let w=await Bg(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!w&&(w={user:f.user},await fy(this.userStorage,this.storageKey+"-user",w)),f.user=(a=w?.user)!==null&&a!==void 0?a:T1()}else if(f&&!f.user&&!f.user){const w=await Bg(this.storage,this.storageKey+"-user");w&&w?.user?(f.user=w.user,await jp(this.storage,this.storageKey+"-user"),await fy(this.storage,this.storageKey,f)):f.user=T1()}if(this._debug(u,"session from storage",f),!this._isValidSession(f)){this._debug(u,"session is not valid"),f!==null&&await this._removeSession();return}const y=((l=f.expires_at)!==null&&l!==void 0?l:1/0)*1e3-Date.now()<b1;if(this._debug(u,`session has${y?"":" not"} expired with margin of ${b1}s`),y){if(this.autoRefreshToken&&f.refresh_token){const{error:w}=await this._callRefreshToken(f.refresh_token);w&&(console.error(w),w1(w)||(this._debug(u,"refresh failed with a non-retryable error, removing the session",w),await this._removeSession()))}}else if(f.user&&f.user.__isUserNotAvailableProxy===!0)try{const{data:w,error:i}=await this._getUser(f.access_token);!i&&w?.user?(f.user=w.user,await this._saveSession(f),await this._notifyAllSubscribers("SIGNED_IN",f)):this._debug(u,"could not get user data, skipping SIGNED_IN notification")}catch(w){console.error("Error getting user data:",w),this._debug(u,"error getting user data, skipping SIGNED_IN notification",w)}else await this._notifyAllSubscribers("SIGNED_IN",f)}catch(f){this._debug(u,"error",f),console.error(f);return}finally{this._debug(u,"end")}}async _callRefreshToken(a){var l,u;if(!a)throw new Lp;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const f=`#_callRefreshToken(${a.substring(0,5)}...)`;this._debug(f,"begin");try{this.refreshingDeferred=new Gb;const{data:y,error:w}=await this._refreshAccessToken(a);if(w)throw w;if(!y.session)throw new Lp;await this._saveSession(y.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",y.session);const i={data:y.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(y){if(this._debug(f,"error",y),ga(y)){const w={data:null,error:y};return w1(y)||await this._removeSession(),(l=this.refreshingDeferred)===null||l===void 0||l.resolve(w),w}throw(u=this.refreshingDeferred)===null||u===void 0||u.reject(y),y}finally{this.refreshingDeferred=null,this._debug(f,"end")}}async _notifyAllSubscribers(a,l,u=!0){const f=`#_notifyAllSubscribers(${a})`;this._debug(f,"begin",l,`broadcast = ${u}`);try{this.broadcastChannel&&u&&this.broadcastChannel.postMessage({event:a,session:l});const y=[],w=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(a,l)}catch(C){y.push(C)}});if(await Promise.all(w),y.length>0){for(let i=0;i<y.length;i+=1)console.error(y[i]);throw y[0]}}finally{this._debug(f,"end")}}async _saveSession(a){this._debug("#_saveSession()",a),this.suppressGetSessionWarning=!0;const l=Object.assign({},a),u=l.user&&l.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!u&&l.user&&await fy(this.userStorage,this.storageKey+"-user",{user:l.user});const f=Object.assign({},l);delete f.user;const y=YE(f);await fy(this.storage,this.storageKey,y)}else{const f=YE(l);await fy(this.storage,this.storageKey,f)}}async _removeSession(){this._debug("#_removeSession()"),await jp(this.storage,this.storageKey),await jp(this.storage,this.storageKey+"-code-verifier"),await jp(this.storage,this.storageKey+"-user"),this.userStorage&&await jp(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const a=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{a&&Wu()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",a)}catch(l){console.error("removing visibilitychange callback failed",l)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const a=setInterval(()=>this._autoRefreshTokenTick(),hy);this.autoRefreshTicker=a,a&&typeof a=="object"&&typeof a.unref=="function"?a.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(a),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const a=this.autoRefreshTicker;this.autoRefreshTicker=null,a&&clearInterval(a)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const a=Date.now();try{return await this._useSession(async l=>{const{data:{session:u}}=l;if(!u||!u.refresh_token||!u.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const f=Math.floor((u.expires_at*1e3-a)/hy);this._debug("#_autoRefreshTokenTick()",`access token expires in ${f} ticks, a tick lasts ${hy}ms, refresh threshold is ${gS} ticks`),f<=gS&&await this._callRefreshToken(u.refresh_token)})}catch(l){console.error("Auto refresh tick failed with error. This is likely a transient error.",l)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(a){if(a.isAcquireTimeout||a instanceof bP)this._debug("auto refresh token tick lock not available");else throw a}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Wu()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(a){console.error("_handleVisibilityChange",a)}}async _onVisibilityChanged(a){const l=`#_onVisibilityChanged(${a})`;this._debug(l,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),a||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(l,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(a,l,u){const f=[`provider=${encodeURIComponent(l)}`];if(u?.redirectTo&&f.push(`redirect_to=${encodeURIComponent(u.redirectTo)}`),u?.scopes&&f.push(`scopes=${encodeURIComponent(u.scopes)}`),this.flowType==="pkce"){const[y,w]=await ay(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(y)}`,code_challenge_method:`${encodeURIComponent(w)}`});f.push(i.toString())}if(u?.queryParams){const y=new URLSearchParams(u.queryParams);f.push(y.toString())}return u?.skipBrowserRedirect&&f.push(`skip_http_redirect=${u.skipBrowserRedirect}`),`${a}?${f.join("&")}`}async _unenroll(a){try{return await this._useSession(async l=>{var u;const{data:f,error:y}=l;return y?{data:null,error:y}:await Va(this.fetch,"DELETE",`${this.url}/factors/${a.factorId}`,{headers:this.headers,jwt:(u=f?.session)===null||u===void 0?void 0:u.access_token})})}catch(l){if(ga(l))return{data:null,error:l};throw l}}async _enroll(a){try{return await this._useSession(async l=>{var u,f;const{data:y,error:w}=l;if(w)return{data:null,error:w};const i=Object.assign({friendly_name:a.friendlyName,factor_type:a.factorType},a.factorType==="phone"?{phone:a.phone}:a.factorType==="totp"?{issuer:a.issuer}:{}),{data:C,error:P}=await Va(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:(u=y?.session)===null||u===void 0?void 0:u.access_token});return P?{data:null,error:P}:(a.factorType==="totp"&&C.type==="totp"&&(!((f=C?.totp)===null||f===void 0)&&f.qr_code)&&(C.totp.qr_code=`data:image/svg+xml;utf-8,${C.totp.qr_code}`),{data:C,error:null})})}catch(l){if(ga(l))return{data:null,error:l};throw l}}async _verify(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async l=>{var u;const{data:f,error:y}=l;if(y)return{data:null,error:y};const w=Object.assign({challenge_id:a.challengeId},"webauthn"in a?{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_response:a.webauthn.type==="create"?cF(a.webauthn.credential_response):uF(a.webauthn.credential_response)})}:{code:a.code}),{data:i,error:C}=await Va(this.fetch,"POST",`${this.url}/factors/${a.factorId}/verify`,{body:w,headers:this.headers,jwt:(u=f?.session)===null||u===void 0?void 0:u.access_token});return C?{data:null,error:C}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:C})})}catch(l){if(ga(l))return{data:null,error:l};throw l}})}async _challenge(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async l=>{var u;const{data:f,error:y}=l;if(y)return{data:null,error:y};const w=await Va(this.fetch,"POST",`${this.url}/factors/${a.factorId}/challenge`,{body:a,headers:this.headers,jwt:(u=f?.session)===null||u===void 0?void 0:u.access_token});if(w.error)return w;const{data:i}=w;if(i.type!=="webauthn")return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:oF(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:lF(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(l){if(ga(l))return{data:null,error:l};throw l}})}async _challengeAndVerify(a){const{data:l,error:u}=await this._challenge({factorId:a.factorId});return u?{data:null,error:u}:await this._verify({factorId:a.factorId,challengeId:l.id,code:a.code})}async _listFactors(){var a;const{data:{user:l},error:u}=await this.getUser();if(u)return{data:null,error:u};const f={all:[],phone:[],totp:[],webauthn:[]};for(const y of(a=l?.factors)!==null&&a!==void 0?a:[])f.all.push(y),y.status==="verified"&&f[y.factor_type].push(y);return{data:f,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async a=>{var l,u;const{data:{session:f},error:y}=a;if(y)return{data:null,error:y};if(!f)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:w}=S1(f.access_token);let i=null;w.aal&&(i=w.aal);let C=i;((u=(l=f.user.factors)===null||l===void 0?void 0:l.filter($=>$.status==="verified"))!==null&&u!==void 0?u:[]).length>0&&(C="aal2");const D=w.amr||[];return{data:{currentLevel:i,nextLevel:C,currentAuthenticationMethods:D},error:null}}))}async fetchJwk(a,l={keys:[]}){let u=l.keys.find(i=>i.kid===a);if(u)return u;const f=Date.now();if(u=this.jwks.keys.find(i=>i.kid===a),u&&this.jwks_cached_at+_3>f)return u;const{data:y,error:w}=await Va(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(w)throw w;return!y.keys||y.keys.length===0||(this.jwks=y,this.jwks_cached_at=f,u=y.keys.find(i=>i.kid===a),!u)?null:u}async getClaims(a,l={}){try{let u=a;if(!u){const{data:X,error:te}=await this.getSession();if(te||!X.session)return{data:null,error:te};u=X.session.access_token}const{header:f,payload:y,signature:w,raw:{header:i,payload:C}}=S1(u);l?.allowExpired||F3(y.exp);const P=!f.alg||f.alg.startsWith("HS")||!f.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(f.kid,l?.keys?{keys:l.keys}:l?.jwks);if(!P){const{error:X}=await this.getUser(u);if(X)throw X;return{data:{claims:y,header:f,signature:w},error:null}}const D=B3(f.alg),$=await crypto.subtle.importKey("jwk",P,D,!0,["verify"]);if(!await crypto.subtle.verify(D,$,w,E3(`${i}.${C}`)))throw new vS("Invalid JWT signature");return{data:{claims:y,header:f,signature:w},error:null}}catch(u){if(ga(u))return{data:null,error:u};throw u}}}hx.nextInstanceID=0;const vF=hx;class xF extends vF{constructor(a){super(a)}}var bF=function(s,a,l,u){function f(y){return y instanceof l?y:new l(function(w){w(y)})}return new(l||(l=Promise))(function(y,w){function i(D){try{P(u.next(D))}catch($){w($)}}function C(D){try{P(u.throw(D))}catch($){w($)}}function P(D){D.done?y(D.value):f(D.value).then(i,C)}P((u=u.apply(s,a||[])).next())})};class wF{constructor(a,l,u){var f,y,w;this.supabaseUrl=a,this.supabaseKey=l;const i=h3(a);if(!l)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const C=`sb-${i.hostname.split(".")[0]}-auth-token`,P={db:i3,realtime:a3,auth:Object.assign(Object.assign({},n3),{storageKey:C}),global:t3},D=d3(u??{},P);this.storageKey=(f=D.auth.storageKey)!==null&&f!==void 0?f:"",this.headers=(y=D.global.headers)!==null&&y!==void 0?y:{},D.accessToken?(this.accessToken=D.accessToken,this.auth=new Proxy({},{get:($,G)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(G)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((w=D.auth)!==null&&w!==void 0?w:{},this.headers,D.global.fetch),this.fetch=l3(l,this._getAccessToken.bind(this),D.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},D.realtime)),this.rest=new yN(new URL("rest/v1",i).href,{headers:this.headers,schema:D.db.schema,fetch:this.fetch}),this.storage=new JN(this.storageUrl.href,this.headers,this.fetch,u?.storage),D.accessToken||this._listenForAuthEvents()}get functions(){return new lN(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(a){return this.rest.from(a)}schema(a){return this.rest.schema(a)}rpc(a,l={},u={}){return this.rest.rpc(a,l,u)}channel(a,l={config:{}}){return this.realtime.channel(a,l)}getChannels(){return this.realtime.getChannels()}removeChannel(a){return this.realtime.removeChannel(a)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return bF(this,void 0,void 0,function*(){var a,l;if(this.accessToken)return yield this.accessToken();const{data:u}=yield this.auth.getSession();return(l=(a=u.session)===null||a===void 0?void 0:a.access_token)!==null&&l!==void 0?l:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:a,persistSession:l,detectSessionInUrl:u,storage:f,userStorage:y,storageKey:w,flowType:i,lock:C,debug:P},D,$){const G={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new xF({url:this.authUrl.href,headers:Object.assign(Object.assign({},G),D),storageKey:w,autoRefreshToken:a,persistSession:l,detectSessionInUrl:u,storage:f,userStorage:y,flowType:i,lock:C,debug:P,fetch:$,hasCustomAuthorizationHeader:Object.keys(this.headers).some(X=>X.toLowerCase()==="authorization")})}_initRealtimeClient(a){return new zN(this.realtimeUrl.href,Object.assign(Object.assign({},a),{params:Object.assign({apikey:this.supabaseKey},a?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((l,u)=>{this._handleTokenChanged(l,"CLIENT",u?.access_token)})}_handleTokenChanged(a,l,u){(a==="TOKEN_REFRESHED"||a==="SIGNED_IN")&&this.changedAccessToken!==u?(this.changedAccessToken=u,this.realtime.setAuth(u)):a==="SIGNED_OUT"&&(this.realtime.setAuth(),l=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const SF=(s,a,l)=>new wF(s,a,l);function TF(){if(typeof window<"u"||typeof process>"u")return!1;const s=process.version;if(s==null)return!1;const a=s.match(/^v(\d+)\./);return a?parseInt(a[1],10)<=18:!1}TF()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const kF="https://jraryrxoyhdjsbojezow.supabase.co",EF="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyYXJ5cnhveWhkanNib2plem93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1Njk2NjAsImV4cCI6MjA2MjE0NTY2MH0.j42O4xJQodo3pIinATA3C4aylhRdmIemPHMBr6FWRic",Vs=SF(kF,EF),Lr=(s=!1,a="/auth")=>{const[l,u]=pe.useState(null),f=Ma();return pe.useEffect(()=>{(async()=>{try{const{data:w,error:i}=await Vs.auth.getSession();if(i){console.error("Error fetching session:",i);return}u(w.session||null),s&&!w.session&&f(a,{replace:!0})}catch(w){console.error(w)}})()},[f,s,a]),l};function xS(s,a,l,u){const y=D=>D*Math.PI/180,w=y(l-s),i=y(u-a),C=Math.sin(w/2)**2+Math.cos(y(s))*Math.cos(y(l))*Math.sin(i/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)))}function AF(){const{location:s,setLocation:a}=aP(),l=$c(),{markets:u}=ky(null),f=Lr(),[y,w]=pe.useState(null);return pe.useEffect(()=>{if(l.pathname==="/map")return;navigator.geolocation.getCurrentPosition(C=>{const P={lat:C.coords.latitude,lng:C.coords.longitude};a(P)});const i=setInterval(()=>{navigator.geolocation.getCurrentPosition(C=>{const P={lat:C.coords.latitude,lng:C.coords.longitude};a(P)})},6e4);return()=>clearInterval(i)},[l.pathname,a]),pe.useEffect(()=>{if(!s||!u?.length||!f?.user)return;const i=5e3,C=f.user.id;(async()=>{for(const D of u)if(xS(s.lat,s.lng,D.latitude,D.longitude)<=i)try{(await(await fetch(`/v1/market/${D.id}/visit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:C})})).json())?.created_at&&w(D)}catch(G){console.error("[CheckIn] Error:",G)}})()},[s,u,f]),A.jsx(A.Fragment,{children:y&&A.jsx(iN,{market:y,onClose:()=>w(null)})})}const CF=()=>A.jsxs("div",{className:"bg-[var(--white)] min-h-screen flex flex-col",children:[A.jsx(AF,{}),A.jsx("div",{className:"flex-1",children:A.jsx(jD,{})}),A.jsx(tN,{})]});let bS={},kP;function E1(s={}){bS={animate:!0,allowClose:!0,overlayClickBehavior:"close",overlayOpacity:.7,smoothScroll:!1,disableActiveInteraction:!1,showProgress:!1,stagePadding:10,stageRadius:5,popoverOffset:10,showButtons:["next","previous","close"],disableButtons:[],overlayColor:"#000",...s}}function On(s){return s?bS[s]:bS}function MF(s){kP=s}function Yu(){return kP}let Cb={};function N0(s,a){Cb[s]=a}function Jg(s){var a;(a=Cb[s])==null||a.call(Cb)}function PF(){Cb={}}function F0(s,a,l,u){return(s/=u/2)<1?l/2*s*s+a:-l/2*(--s*(s-2)-1)+a}function EP(s){const a='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])';return s.flatMap(l=>{const u=l.matches(a),f=Array.from(l.querySelectorAll(a));return[...u?[l]:[],...f]}).filter(l=>getComputedStyle(l).pointerEvents!=="none"&&LF(l))}function AP(s){if(!s||RF(s))return;const a=On("smoothScroll"),l=s.offsetHeight>window.innerHeight;s.scrollIntoView({behavior:!a||jF(s)?"auto":"smooth",inline:"center",block:l?"start":"center"})}function jF(s){if(!s||!s.parentElement)return;const a=s.parentElement;return a.scrollHeight>a.clientHeight}function RF(s){const a=s.getBoundingClientRect();return a.top>=0&&a.left>=0&&a.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&a.right<=(window.innerWidth||document.documentElement.clientWidth)}function LF(s){return!!(s.offsetWidth||s.offsetHeight||s.getClientRects().length)}let Mb={};function Il(s,a){Mb[s]=a}function Zn(s){return s?Mb[s]:Mb}function nA(){Mb={}}function IF(s,a,l,u){let f=Zn("__activeStagePosition");const y=f||l.getBoundingClientRect(),w=u.getBoundingClientRect(),i=F0(s,y.x,w.x-y.x,a),C=F0(s,y.y,w.y-y.y,a),P=F0(s,y.width,w.width-y.width,a),D=F0(s,y.height,w.height-y.height,a);f={x:i,y:C,width:P,height:D},MP(f),Il("__activeStagePosition",f)}function CP(s){if(!s)return;const a=s.getBoundingClientRect(),l={x:a.x,y:a.y,width:a.width,height:a.height};Il("__activeStagePosition",l),MP(l)}function zF(){const s=Zn("__activeStagePosition"),a=Zn("__overlaySvg");if(!s)return;if(!a){console.warn("No stage svg found.");return}const l=window.innerWidth,u=window.innerHeight;a.setAttribute("viewBox",`0 0 ${l} ${u}`)}function DF(s){const a=OF(s);document.body.appendChild(a),RP(a,l=>{l.target.tagName==="path"&&Jg("overlayClick")}),Il("__overlaySvg",a)}function MP(s){const a=Zn("__overlaySvg");if(!a){DF(s);return}const l=a.firstElementChild;if(l?.tagName!=="path")throw new Error("no path element found in stage svg");l.setAttribute("d",PP(s))}function OF(s){const a=window.innerWidth,l=window.innerHeight,u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.classList.add("driver-overlay","driver-overlay-animated"),u.setAttribute("viewBox",`0 0 ${a} ${l}`),u.setAttribute("xmlSpace","preserve"),u.setAttribute("xmlnsXlink","http://www.w3.org/1999/xlink"),u.setAttribute("version","1.1"),u.setAttribute("preserveAspectRatio","xMinYMin slice"),u.style.fillRule="evenodd",u.style.clipRule="evenodd",u.style.strokeLinejoin="round",u.style.strokeMiterlimit="2",u.style.zIndex="10000",u.style.position="fixed",u.style.top="0",u.style.left="0",u.style.width="100%",u.style.height="100%";const f=document.createElementNS("http://www.w3.org/2000/svg","path");return f.setAttribute("d",PP(s)),f.style.fill=On("overlayColor")||"rgb(0,0,0)",f.style.opacity=`${On("overlayOpacity")}`,f.style.pointerEvents="auto",f.style.cursor="auto",u.appendChild(f),u}function PP(s){const a=window.innerWidth,l=window.innerHeight,u=On("stagePadding")||0,f=On("stageRadius")||0,y=s.width+u*2,w=s.height+u*2,i=Math.min(f,y/2,w/2),C=Math.floor(Math.max(i,0)),P=s.x-u+C,D=s.y-u,$=y-C*2,G=w-C*2;return`M${a},0L0,0L0,${l}L${a},${l}L${a},0Z
    M${P},${D} h${$} a${C},${C} 0 0 1 ${C},${C} v${G} a${C},${C} 0 0 1 -${C},${C} h-${$} a${C},${C} 0 0 1 -${C},-${C} v-${G} a${C},${C} 0 0 1 ${C},-${C} z`}function NF(){const s=Zn("__overlaySvg");s&&s.remove()}function FF(){const s=document.getElementById("driver-dummy-element");if(s)return s;let a=document.createElement("div");return a.id="driver-dummy-element",a.style.width="0",a.style.height="0",a.style.pointerEvents="none",a.style.opacity="0",a.style.position="fixed",a.style.top="50%",a.style.left="50%",document.body.appendChild(a),a}function aA(s){const{element:a}=s;let l=typeof a=="function"?a():typeof a=="string"?document.querySelector(a):a;l||(l=FF()),UF(l,s)}function BF(){const s=Zn("__activeElement"),a=Zn("__activeStep");s&&(CP(s),zF(),IP(s,a))}function UF(s,a){var l;const u=Date.now(),f=Zn("__activeStep"),y=Zn("__activeElement")||s,w=!y||y===s,i=s.id==="driver-dummy-element",C=y.id==="driver-dummy-element",P=On("animate"),D=a.onHighlightStarted||On("onHighlightStarted"),$=a?.onHighlighted||On("onHighlighted"),G=f?.onDeselected||On("onDeselected"),X=On(),te=Zn();!w&&G&&G(C?void 0:y,f,{config:X,state:te,driver:Yu()}),D&&D(i?void 0:s,a,{config:X,state:te,driver:Yu()});const le=!w&&P;let re=!1;qF(),Il("previousStep",f),Il("previousElement",y),Il("activeStep",a),Il("activeElement",s);const fe=()=>{if(Zn("__transitionCallback")!==fe)return;const xe=Date.now()-u,be=400-xe<=400/2;a.popover&&be&&!re&&le&&(rA(s,a),re=!0),On("animate")&&xe<400?IF(xe,400,y,s):(CP(s),$&&$(i?void 0:s,a,{config:On(),state:Zn(),driver:Yu()}),Il("__transitionCallback",void 0),Il("__previousStep",f),Il("__previousElement",y),Il("__activeStep",a),Il("__activeElement",s)),window.requestAnimationFrame(fe)};Il("__transitionCallback",fe),window.requestAnimationFrame(fe),AP(s),!le&&a.popover&&rA(s,a),y.classList.remove("driver-active-element","driver-no-interaction"),y.removeAttribute("aria-haspopup"),y.removeAttribute("aria-expanded"),y.removeAttribute("aria-controls"),((l=a.disableActiveInteraction)!=null?l:On("disableActiveInteraction"))&&s.classList.add("driver-no-interaction"),s.classList.add("driver-active-element"),s.setAttribute("aria-haspopup","dialog"),s.setAttribute("aria-expanded","true"),s.setAttribute("aria-controls","driver-popover-content")}function $F(){var s;(s=document.getElementById("driver-dummy-element"))==null||s.remove(),document.querySelectorAll(".driver-active-element").forEach(a=>{a.classList.remove("driver-active-element","driver-no-interaction"),a.removeAttribute("aria-haspopup"),a.removeAttribute("aria-expanded"),a.removeAttribute("aria-controls")})}function fx(){const s=Zn("__resizeTimeout");s&&window.cancelAnimationFrame(s),Il("__resizeTimeout",window.requestAnimationFrame(BF))}function VF(s){var a;if(!Zn("isInitialized")||!(s.key==="Tab"||s.keyCode===9))return;const l=Zn("__activeElement"),u=(a=Zn("popover"))==null?void 0:a.wrapper,f=EP([...u?[u]:[],...l?[l]:[]]),y=f[0],w=f[f.length-1];if(s.preventDefault(),s.shiftKey){const i=f[f.indexOf(document.activeElement)-1]||w;i?.focus()}else{const i=f[f.indexOf(document.activeElement)+1]||y;i?.focus()}}function jP(s){var a;((a=On("allowKeyboardControl"))==null||a)&&(s.key==="Escape"?Jg("escapePress"):s.key==="ArrowRight"?Jg("arrowRightPress"):s.key==="ArrowLeft"&&Jg("arrowLeftPress"))}function RP(s,a,l){const u=(f,y)=>{const w=f.target;s.contains(w)&&((!l||l(w))&&(f.preventDefault(),f.stopPropagation(),f.stopImmediatePropagation()),y?.(f))};document.addEventListener("pointerdown",u,!0),document.addEventListener("mousedown",u,!0),document.addEventListener("pointerup",u,!0),document.addEventListener("mouseup",u,!0),document.addEventListener("click",f=>{u(f,a)},!0)}function HF(){window.addEventListener("keyup",jP,!1),window.addEventListener("keydown",VF,!1),window.addEventListener("resize",fx),window.addEventListener("scroll",fx)}function GF(){window.removeEventListener("keyup",jP),window.removeEventListener("resize",fx),window.removeEventListener("scroll",fx)}function qF(){const s=Zn("popover");s&&(s.wrapper.style.display="none")}function rA(s,a){var l,u;let f=Zn("popover");f&&document.body.removeChild(f.wrapper),f=ZF(),document.body.appendChild(f.wrapper);const{title:y,description:w,showButtons:i,disableButtons:C,showProgress:P,nextBtnText:D=On("nextBtnText")||"Next &rarr;",prevBtnText:$=On("prevBtnText")||"&larr; Previous",progressText:G=On("progressText")||"{current} of {total}"}=a.popover||{};f.nextButton.innerHTML=D,f.previousButton.innerHTML=$,f.progress.innerHTML=G,y?(f.title.innerHTML=y,f.title.style.display="block"):f.title.style.display="none",w?(f.description.innerHTML=w,f.description.style.display="block"):f.description.style.display="none";const X=i||On("showButtons"),te=P||On("showProgress")||!1,le=X?.includes("next")||X?.includes("previous")||te;f.closeButton.style.display=X.includes("close")?"block":"none",le?(f.footer.style.display="flex",f.progress.style.display=te?"block":"none",f.nextButton.style.display=X.includes("next")?"block":"none",f.previousButton.style.display=X.includes("previous")?"block":"none"):f.footer.style.display="none";const re=C||On("disableButtons")||[];re!=null&&re.includes("next")&&(f.nextButton.disabled=!0,f.nextButton.classList.add("driver-popover-btn-disabled")),re!=null&&re.includes("previous")&&(f.previousButton.disabled=!0,f.previousButton.classList.add("driver-popover-btn-disabled")),re!=null&&re.includes("close")&&(f.closeButton.disabled=!0,f.closeButton.classList.add("driver-popover-btn-disabled"));const fe=f.wrapper;fe.style.display="block",fe.style.left="",fe.style.top="",fe.style.bottom="",fe.style.right="",fe.id="driver-popover-content",fe.setAttribute("role","dialog"),fe.setAttribute("aria-labelledby","driver-popover-title"),fe.setAttribute("aria-describedby","driver-popover-description");const xe=f.arrow;xe.className="driver-popover-arrow";const be=((l=a.popover)==null?void 0:l.popoverClass)||On("popoverClass")||"";fe.className=`driver-popover ${be}`.trim(),RP(f.wrapper,et=>{var at,He,lt;const pt=et.target,Zt=((at=a.popover)==null?void 0:at.onNextClick)||On("onNextClick"),jt=((He=a.popover)==null?void 0:He.onPrevClick)||On("onPrevClick"),Di=((lt=a.popover)==null?void 0:lt.onCloseClick)||On("onCloseClick");if(pt.closest(".driver-popover-next-btn"))return Zt?Zt(s,a,{config:On(),state:Zn(),driver:Yu()}):Jg("nextClick");if(pt.closest(".driver-popover-prev-btn"))return jt?jt(s,a,{config:On(),state:Zn(),driver:Yu()}):Jg("prevClick");if(pt.closest(".driver-popover-close-btn"))return Di?Di(s,a,{config:On(),state:Zn(),driver:Yu()}):Jg("closeClick")},et=>!(f!=null&&f.description.contains(et))&&!(f!=null&&f.title.contains(et))&&typeof et.className=="string"&&et.className.includes("driver-popover")),Il("popover",f);const Ne=((u=a.popover)==null?void 0:u.onPopoverRender)||On("onPopoverRender");Ne&&Ne(f,{config:On(),state:Zn(),driver:Yu()}),IP(s,a),AP(fe);const Be=s.classList.contains("driver-dummy-element"),Ee=EP([fe,...Be?[]:[s]]);Ee.length>0&&Ee[0].focus()}function LP(){const s=Zn("popover");if(!(s!=null&&s.wrapper))return;const a=s.wrapper.getBoundingClientRect(),l=On("stagePadding")||0,u=On("popoverOffset")||0;return{width:a.width+l+u,height:a.height+l+u,realWidth:a.width,realHeight:a.height}}function sA(s,a){const{elementDimensions:l,popoverDimensions:u,popoverPadding:f,popoverArrowDimensions:y}=a;return s==="start"?Math.max(Math.min(l.top-f,window.innerHeight-u.realHeight-y.width),y.width):s==="end"?Math.max(Math.min(l.top-u?.realHeight+l.height+f,window.innerHeight-u?.realHeight-y.width),y.width):s==="center"?Math.max(Math.min(l.top+l.height/2-u?.realHeight/2,window.innerHeight-u?.realHeight-y.width),y.width):0}function oA(s,a){const{elementDimensions:l,popoverDimensions:u,popoverPadding:f,popoverArrowDimensions:y}=a;return s==="start"?Math.max(Math.min(l.left-f,window.innerWidth-u.realWidth-y.width),y.width):s==="end"?Math.max(Math.min(l.left-u?.realWidth+l.width+f,window.innerWidth-u?.realWidth-y.width),y.width):s==="center"?Math.max(Math.min(l.left+l.width/2-u?.realWidth/2,window.innerWidth-u?.realWidth-y.width),y.width):0}function IP(s,a){const l=Zn("popover");if(!l)return;const{align:u="start",side:f="left"}=a?.popover||{},y=u,w=s.id==="driver-dummy-element"?"over":f,i=On("stagePadding")||0,C=LP(),P=l.arrow.getBoundingClientRect(),D=s.getBoundingClientRect(),$=D.top-C.height;let G=$>=0;const X=window.innerHeight-(D.bottom+C.height);let te=X>=0;const le=D.left-C.width;let re=le>=0;const fe=window.innerWidth-(D.right+C.width);let xe=fe>=0;const be=!G&&!te&&!re&&!xe;let Ne=w;if(w==="top"&&G?xe=re=te=!1:w==="bottom"&&te?xe=re=G=!1:w==="left"&&re?xe=G=te=!1:w==="right"&&xe&&(re=G=te=!1),w==="over"){const Be=window.innerWidth/2-C.realWidth/2,Ee=window.innerHeight/2-C.realHeight/2;l.wrapper.style.left=`${Be}px`,l.wrapper.style.right="auto",l.wrapper.style.top=`${Ee}px`,l.wrapper.style.bottom="auto"}else if(be){const Be=window.innerWidth/2-C?.realWidth/2,Ee=10;l.wrapper.style.left=`${Be}px`,l.wrapper.style.right="auto",l.wrapper.style.bottom=`${Ee}px`,l.wrapper.style.top="auto"}else if(re){const Be=Math.min(le,window.innerWidth-C?.realWidth-P.width),Ee=sA(y,{elementDimensions:D,popoverDimensions:C,popoverPadding:i,popoverArrowDimensions:P});l.wrapper.style.left=`${Be}px`,l.wrapper.style.top=`${Ee}px`,l.wrapper.style.bottom="auto",l.wrapper.style.right="auto",Ne="left"}else if(xe){const Be=Math.min(fe,window.innerWidth-C?.realWidth-P.width),Ee=sA(y,{elementDimensions:D,popoverDimensions:C,popoverPadding:i,popoverArrowDimensions:P});l.wrapper.style.right=`${Be}px`,l.wrapper.style.top=`${Ee}px`,l.wrapper.style.bottom="auto",l.wrapper.style.left="auto",Ne="right"}else if(G){const Be=Math.min($,window.innerHeight-C.realHeight-P.width);let Ee=oA(y,{elementDimensions:D,popoverDimensions:C,popoverPadding:i,popoverArrowDimensions:P});l.wrapper.style.top=`${Be}px`,l.wrapper.style.left=`${Ee}px`,l.wrapper.style.bottom="auto",l.wrapper.style.right="auto",Ne="top"}else if(te){const Be=Math.min(X,window.innerHeight-C?.realHeight-P.width);let Ee=oA(y,{elementDimensions:D,popoverDimensions:C,popoverPadding:i,popoverArrowDimensions:P});l.wrapper.style.left=`${Ee}px`,l.wrapper.style.bottom=`${Be}px`,l.wrapper.style.top="auto",l.wrapper.style.right="auto",Ne="bottom"}be?l.arrow.classList.add("driver-popover-arrow-none"):WF(y,Ne,s)}function WF(s,a,l){const u=Zn("popover");if(!u)return;const f=l.getBoundingClientRect(),y=LP(),w=u.arrow,i=y.width,C=window.innerWidth,P=f.width,D=f.left,$=y.height,G=window.innerHeight,X=f.top,te=f.height;w.className="driver-popover-arrow";let le=a,re=s;if(a==="top"?(D+P<=0?(le="right",re="end"):D+P-i<=0&&(le="top",re="start"),D>=C?(le="left",re="end"):D+i>=C&&(le="top",re="end")):a==="bottom"?(D+P<=0?(le="right",re="start"):D+P-i<=0&&(le="bottom",re="start"),D>=C?(le="left",re="start"):D+i>=C&&(le="bottom",re="end")):a==="left"?(X+te<=0?(le="bottom",re="end"):X+te-$<=0&&(le="left",re="start"),X>=G?(le="top",re="end"):X+$>=G&&(le="left",re="end")):a==="right"&&(X+te<=0?(le="bottom",re="start"):X+te-$<=0&&(le="right",re="start"),X>=G?(le="top",re="start"):X+$>=G&&(le="right",re="end")),!le)w.classList.add("driver-popover-arrow-none");else{w.classList.add(`driver-popover-arrow-side-${le}`),w.classList.add(`driver-popover-arrow-align-${re}`);const fe=l.getBoundingClientRect(),xe=w.getBoundingClientRect(),be=On("stagePadding")||0,Ne=fe.left-be<window.innerWidth&&fe.right+be>0&&fe.top-be<window.innerHeight&&fe.bottom+be>0;a==="bottom"&&Ne&&(xe.x>fe.x&&xe.x+xe.width<fe.x+fe.width?u.wrapper.style.transform="translateY(0)":(w.classList.remove(`driver-popover-arrow-align-${re}`),w.classList.add("driver-popover-arrow-none"),u.wrapper.style.transform=`translateY(-${be/2}px)`))}}function ZF(){const s=document.createElement("div");s.classList.add("driver-popover");const a=document.createElement("div");a.classList.add("driver-popover-arrow");const l=document.createElement("header");l.id="driver-popover-title",l.classList.add("driver-popover-title"),l.style.display="none",l.innerText="Popover Title";const u=document.createElement("div");u.id="driver-popover-description",u.classList.add("driver-popover-description"),u.style.display="none",u.innerText="Popover description is here";const f=document.createElement("button");f.type="button",f.classList.add("driver-popover-close-btn"),f.setAttribute("aria-label","Close"),f.innerHTML="&times;";const y=document.createElement("footer");y.classList.add("driver-popover-footer");const w=document.createElement("span");w.classList.add("driver-popover-progress-text"),w.innerText="";const i=document.createElement("span");i.classList.add("driver-popover-navigation-btns");const C=document.createElement("button");C.type="button",C.classList.add("driver-popover-prev-btn"),C.innerHTML="&larr; Previous";const P=document.createElement("button");return P.type="button",P.classList.add("driver-popover-next-btn"),P.innerHTML="Next &rarr;",i.appendChild(C),i.appendChild(P),y.appendChild(w),y.appendChild(i),s.appendChild(f),s.appendChild(a),s.appendChild(l),s.appendChild(u),s.appendChild(y),{wrapper:s,arrow:a,title:l,description:u,footer:y,previousButton:C,nextButton:P,closeButton:f,footerButtons:i,progress:w}}function XF(){var s;const a=Zn("popover");a&&((s=a.wrapper.parentElement)==null||s.removeChild(a.wrapper))}function zP(s={}){E1(s);function a(){On("allowClose")&&D()}function l(){const G=On("overlayClickBehavior");if(On("allowClose")&&G==="close"){D();return}if(typeof G=="function"){const X=Zn("__activeStep"),te=Zn("__activeElement");G(te,X,{config:On(),state:Zn(),driver:Yu()});return}G==="nextStep"&&u()}function u(){const G=Zn("activeIndex"),X=On("steps")||[];if(typeof G>"u")return;const te=G+1;X[te]?P(te):D()}function f(){const G=Zn("activeIndex"),X=On("steps")||[];if(typeof G>"u")return;const te=G-1;X[te]?P(te):D()}function y(G){(On("steps")||[])[G]?P(G):D()}function w(){var G;if(Zn("__transitionCallback"))return;const X=Zn("activeIndex"),te=Zn("__activeStep"),le=Zn("__activeElement");if(typeof X>"u"||typeof te>"u"||typeof Zn("activeIndex")>"u")return;const re=((G=te.popover)==null?void 0:G.onPrevClick)||On("onPrevClick");if(re)return re(le,te,{config:On(),state:Zn(),driver:Yu()});f()}function i(){var G;if(Zn("__transitionCallback"))return;const X=Zn("activeIndex"),te=Zn("__activeStep"),le=Zn("__activeElement");if(typeof X>"u"||typeof te>"u")return;const re=((G=te.popover)==null?void 0:G.onNextClick)||On("onNextClick");if(re)return re(le,te,{config:On(),state:Zn(),driver:Yu()});u()}function C(){Zn("isInitialized")||(Il("isInitialized",!0),document.body.classList.add("driver-active",On("animate")?"driver-fade":"driver-simple"),HF(),N0("overlayClick",l),N0("escapePress",a),N0("arrowLeftPress",w),N0("arrowRightPress",i))}function P(G=0){var X,te,le,re,fe,xe,be,Ne;const Be=On("steps");if(!Be){console.error("No steps to drive through"),D();return}if(!Be[G]){D();return}Il("__activeOnDestroyed",document.activeElement),Il("activeIndex",G);const Ee=Be[G],et=Be[G+1],at=Be[G-1],He=((X=Ee.popover)==null?void 0:X.doneBtnText)||On("doneBtnText")||"Done",lt=On("allowClose"),pt=typeof((te=Ee.popover)==null?void 0:te.showProgress)<"u"?(le=Ee.popover)==null?void 0:le.showProgress:On("showProgress"),Zt=(((re=Ee.popover)==null?void 0:re.progressText)||On("progressText")||"{{current}} of {{total}}").replace("{{current}}",`${G+1}`).replace("{{total}}",`${Be.length}`),jt=((fe=Ee.popover)==null?void 0:fe.showButtons)||On("showButtons"),Di=["next","previous",...lt?["close"]:[]].filter(Ct=>!(jt!=null&&jt.length)||jt.includes(Ct)),Pi=((xe=Ee.popover)==null?void 0:xe.onNextClick)||On("onNextClick"),qe=((be=Ee.popover)==null?void 0:be.onPrevClick)||On("onPrevClick"),wt=((Ne=Ee.popover)==null?void 0:Ne.onCloseClick)||On("onCloseClick");aA({...Ee,popover:{showButtons:Di,nextBtnText:et?void 0:He,disableButtons:[...at?[]:["previous"]],showProgress:pt,progressText:Zt,onNextClick:Pi||(()=>{et?P(G+1):D()}),onPrevClick:qe||(()=>{P(G-1)}),onCloseClick:wt||(()=>{D()}),...Ee?.popover||{}}})}function D(G=!0){const X=Zn("__activeElement"),te=Zn("__activeStep"),le=Zn("__activeOnDestroyed"),re=On("onDestroyStarted");if(G&&re){const be=!X||X?.id==="driver-dummy-element";re(be?void 0:X,te,{config:On(),state:Zn(),driver:Yu()});return}const fe=te?.onDeselected||On("onDeselected"),xe=On("onDestroyed");if(document.body.classList.remove("driver-active","driver-fade","driver-simple"),GF(),XF(),$F(),NF(),PF(),nA(),X&&te){const be=X.id==="driver-dummy-element";fe&&fe(be?void 0:X,te,{config:On(),state:Zn(),driver:Yu()}),xe&&xe(be?void 0:X,te,{config:On(),state:Zn(),driver:Yu()})}le&&le.focus()}const $={isActive:()=>Zn("isInitialized")||!1,refresh:fx,drive:(G=0)=>{C(),P(G)},setConfig:E1,setSteps:G=>{nA(),E1({...On(),steps:G})},getConfig:On,getState:Zn,getActiveIndex:()=>Zn("activeIndex"),isFirstStep:()=>Zn("activeIndex")===0,isLastStep:()=>{const G=On("steps")||[],X=Zn("activeIndex");return X!==void 0&&X===G.length-1},getActiveStep:()=>Zn("activeStep"),getActiveElement:()=>Zn("activeElement"),getPreviousElement:()=>Zn("previousElement"),getPreviousStep:()=>Zn("previousStep"),moveNext:u,movePrevious:f,moveTo:y,hasNextStep:()=>{const G=On("steps")||[],X=Zn("activeIndex");return X!==void 0&&!!G[X+1]},hasPreviousStep:()=>{const G=On("steps")||[],X=Zn("activeIndex");return X!==void 0&&!!G[X-1]},highlight:G=>{C(),aA({...G,popover:G.popover?{showButtons:[],showProgress:!1,progressText:"",...G.popover}:void 0})},destroy:()=>{D(!1)}};return MF($),$}const Ay=()=>{const[s,a]=pe.useState(null);return pe.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(l=>{a([l.coords.latitude,l.coords.longitude])},l=>{console.error("Error getting location:",l),a(null)})},[]),s};function YS(s,a,l){const[u,f]=pe.useState(null),[y,w]=pe.useState(!0),[i,C]=pe.useState(null),P=Ay();return pe.useEffect(()=>{if(!P||!s||!a)return;(async()=>{const[$,G]=P,le=`https://api.openrouteservice.org/v2/directions/foot-walking?api_key=eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6Ijk2YjUyZGU4NzRiNDQyMWVhODZjZDhhZjkzNmFkODNmIiwiaCI6Im11cm11cjY0In0=&start=${G},${$}&end=${a},${s}`;try{const fe=await(await fetch(le)).json();if(!fe.features?.[0]?.properties?.summary?.distance)throw new Error("Invalid response from routing API");const xe=fe.features[0].properties.summary.distance;f((xe/1e3).toFixed(1))}catch(re){console.error("Error fetching distance:",re),C(re)}finally{w(!1)}})()},[P,s,a]),{distance:u,loading:y,error:i}}const DP=({market:s,height:a=250})=>{const{distance:l,loading:u}=YS(s.latitude,s.longitude),f=new Date,y=f.getDay()+1,w=D=>{if(!D)return 0;const[$,G]=D.split(":").map(Number);return $*60+G},i=(s.schedules||[]).filter(D=>!!(D.daily_day&&D.daily_day===y||D.weekly_day&&D.weekly_day===y||D.once_date&&new Date(D.once_date).toDateString()===f.toDateString()));let C=!1,P="";if(i.length>0){const D=i[0],$=w(D.open_time),G=w(D.close_time),X=f.getHours()*60+f.getMinutes();$<=G?C=X>=$&&X<=G:C=X>=$||X<=G;const le=C?G>=X?G-X:1440-X+G:$>=X?$-X:1440-X+$,re=Math.floor(le/60),fe=le%60;P=C?re>0?`Closes in ${re}h ${fe}m`:`Closes in ${fe}m`:re>0?`Opens in ${re}h ${fe}m`:`Opens in ${fe}m`}else{const D=f.getTime(),$=(s.schedules||[]).map(G=>{if(G.daily_day)return{...G,type:"daily",dayOfWeek:G.daily_day};if(G.weekly_day)return{...G,type:"weekly",dayOfWeek:G.weekly_day};if(G.once_date){const X=new Date(G.once_date);return{...G,type:"once",onceDate:X.getTime(),originalDate:X}}return null}).filter(Boolean);if($.length>0){const G=$.filter(te=>te.type==="once"&&te.onceDate<D),X=$.filter(te=>te.type!=="once"||te.onceDate>=D);if(X.length>0){const le=X.sort((re,fe)=>{const xe=re.type==="once"?re.onceDate-D:(re.dayOfWeek+7-(f.getDay()+1))%7*24*60*60*1e3,be=fe.type==="once"?fe.onceDate-D:(fe.dayOfWeek+7-(f.getDay()+1))%7*24*60*60*1e3;return xe-be})[0];if(le.type==="once"){const re={weekday:"long",month:"short",day:"numeric"};P=`Opens on ${le.originalDate.toLocaleDateString("en-US",re)}`}else P=`Opens on ${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][le.dayOfWeek%7]}`}else if(G.length>0){const te=G.sort((re,fe)=>fe.onceDate-re.onceDate)[0],le={weekday:"long",month:"short",day:"numeric"};P=`Market has ended on ${te.originalDate.toLocaleDateString("en-US",le)}`}else P="No upcoming schedule"}else P="No upcoming schedule"}return A.jsxs($s,{to:`/market/${s.id}`,className:`\r
        relative rounded-2xl overflow-hidden\r
        hover:scale-[1.01] active:scale-[0.99]\r
        transition-all duration-300 block\r
        snap-start flex-shrink-0 shadow-md\r
      `,style:{height:`${a}px`},children:[A.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"}),A.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/85 via-black/20 to-transparent"}),A.jsx("div",{className:"absolute top-3 left-3 flex flex-col gap-1",children:A.jsx("div",{className:"bg-black/40 backdrop-blur px-2 py-1 rounded-lg flex items-center text-white text-xs gap-1 shadow",children:s.total_reviews>0?A.jsxs(A.Fragment,{children:[A.jsx(Zo,{className:"text-yellow-300 w-3.5 h-3.5"}),A.jsx("span",{className:"font-medium",children:s.average_rating.toFixed(1)})]}):A.jsx("span",{className:"text-white/70",children:"No reviews yet"})})}),A.jsxs("div",{className:"absolute top-3 right-3 text-xs bg-black/40 backdrop-blur px-2 py-1 rounded-lg flex items-center gap-1 text-white shadow",children:[A.jsx(eN,{className:"w-3.5 h-3.5 opacity-80"}),u?"...":`${l} km`]}),A.jsxs("div",{className:"absolute bottom-3 left-3 right-3 text-white flex flex-col gap-2",children:[A.jsx("h2",{className:"font-semibold text-lg drop-shadow leading-tight line-clamp-1",children:s.name}),A.jsxs("div",{className:"flex items-center gap-2 text-[11px] bg-white/20 backdrop-blur px-2 py-1 rounded-full w-fit",children:[A.jsx(AO,{className:`w-3 h-3 ${C?"text-green-400":"text-red-400"}`}),A.jsxs("span",{className:"font-medium",children:[C?"Open now":"Closed","  ",P]})]})]}),A.jsx(VM,{className:"absolute bottom-3 right-3 w-6 h-6 text-white opacity-80 group-hover:translate-x-1 transition-all"})]})},YF=({height:s=250})=>A.jsxs("div",{className:`\r
        relative rounded-2xl overflow-hidden\r
        block snap-start flex-shrink-0 shadow-md\r
        animate-pulse\r
      `,style:{height:`${s}px`},children:[A.jsx("div",{className:"w-full h-full bg-gray-300"}),A.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/85 via-black/20 to-transparent"}),A.jsx("div",{className:"absolute top-3 left-3 flex flex-col gap-1",children:A.jsx("div",{className:"bg-black/40 px-2 py-1 rounded-lg w-16 h-4"})}),A.jsx("div",{className:"absolute top-3 right-3 text-xs bg-black/40 px-2 py-1 rounded-lg w-12 h-4"}),A.jsxs("div",{className:"absolute bottom-3 left-3 right-3 flex flex-col gap-2",children:[A.jsx("div",{className:"h-5 w-3/4 bg-gray-400 rounded"})," ",A.jsx("div",{className:"h-4 w-1/2 bg-gray-400 rounded-full flex items-center"})," "]}),A.jsx("div",{className:"absolute bottom-3 right-3 w-6 h-6 bg-gray-400 rounded-full"})]}),za=s=>typeof s=="string",zv=()=>{let s,a;const l=new Promise((u,f)=>{s=u,a=f});return l.resolve=s,l.reject=a,l},lA=s=>s==null?"":""+s,KF=(s,a,l)=>{s.forEach(u=>{a[u]&&(l[u]=a[u])})},JF=/###/g,cA=s=>s&&s.indexOf("###")>-1?s.replace(JF,"."):s,uA=s=>!s||za(s),tx=(s,a,l)=>{const u=za(a)?a.split("."):a;let f=0;for(;f<u.length-1;){if(uA(s))return{};const y=cA(u[f]);!s[y]&&l&&(s[y]=new l),Object.prototype.hasOwnProperty.call(s,y)?s=s[y]:s={},++f}return uA(s)?{}:{obj:s,k:cA(u[f])}},dA=(s,a,l)=>{const{obj:u,k:f}=tx(s,a,Object);if(u!==void 0||a.length===1){u[f]=l;return}let y=a[a.length-1],w=a.slice(0,a.length-1),i=tx(s,w,Object);for(;i.obj===void 0&&w.length;)y=`${w[w.length-1]}.${y}`,w=w.slice(0,w.length-1),i=tx(s,w,Object),i?.obj&&typeof i.obj[`${i.k}.${y}`]<"u"&&(i.obj=void 0);i.obj[`${i.k}.${y}`]=l},QF=(s,a,l,u)=>{const{obj:f,k:y}=tx(s,a,Object);f[y]=f[y]||[],f[y].push(l)},Pb=(s,a)=>{const{obj:l,k:u}=tx(s,a);if(l&&Object.prototype.hasOwnProperty.call(l,u))return l[u]},eB=(s,a,l)=>{const u=Pb(s,l);return u!==void 0?u:Pb(a,l)},OP=(s,a,l)=>{for(const u in a)u!=="__proto__"&&u!=="constructor"&&(u in s?za(s[u])||s[u]instanceof String||za(a[u])||a[u]instanceof String?l&&(s[u]=a[u]):OP(s[u],a[u],l):s[u]=a[u]);return s},ly=s=>s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var tB={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const iB=s=>za(s)?s.replace(/[&<>"'\/]/g,a=>tB[a]):s;class nB{constructor(a){this.capacity=a,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(a){const l=this.regExpMap.get(a);if(l!==void 0)return l;const u=new RegExp(a);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(a,u),this.regExpQueue.push(a),u}}const aB=[" ",",","?","!",";"],rB=new nB(20),sB=(s,a,l)=>{a=a||"",l=l||"";const u=aB.filter(w=>a.indexOf(w)<0&&l.indexOf(w)<0);if(u.length===0)return!0;const f=rB.getRegExp(`(${u.map(w=>w==="?"?"\\?":w).join("|")})`);let y=!f.test(s);if(!y){const w=s.indexOf(l);w>0&&!f.test(s.substring(0,w))&&(y=!0)}return y},wS=(s,a,l=".")=>{if(!s)return;if(s[a])return Object.prototype.hasOwnProperty.call(s,a)?s[a]:void 0;const u=a.split(l);let f=s;for(let y=0;y<u.length;){if(!f||typeof f!="object")return;let w,i="";for(let C=y;C<u.length;++C)if(C!==y&&(i+=l),i+=u[C],w=f[i],w!==void 0){if(["string","number","boolean"].indexOf(typeof w)>-1&&C<u.length-1)continue;y+=C-y+1;break}f=w}return f},mx=s=>s?.replace("_","-"),oB={type:"logger",log(s){this.output("log",s)},warn(s){this.output("warn",s)},error(s){this.output("error",s)},output(s,a){console?.[s]?.apply?.(console,a)}};class jb{constructor(a,l={}){this.init(a,l)}init(a,l={}){this.prefix=l.prefix||"i18next:",this.logger=a||oB,this.options=l,this.debug=l.debug}log(...a){return this.forward(a,"log","",!0)}warn(...a){return this.forward(a,"warn","",!0)}error(...a){return this.forward(a,"error","")}deprecate(...a){return this.forward(a,"warn","WARNING DEPRECATED: ",!0)}forward(a,l,u,f){return f&&!this.debug?null:(za(a[0])&&(a[0]=`${u}${this.prefix} ${a[0]}`),this.logger[l](a))}create(a){return new jb(this.logger,{prefix:`${this.prefix}:${a}:`,...this.options})}clone(a){return a=a||this.options,a.prefix=a.prefix||this.prefix,new jb(this.logger,a)}}var bf=new jb;class qb{constructor(){this.observers={}}on(a,l){return a.split(" ").forEach(u=>{this.observers[u]||(this.observers[u]=new Map);const f=this.observers[u].get(l)||0;this.observers[u].set(l,f+1)}),this}off(a,l){if(this.observers[a]){if(!l){delete this.observers[a];return}this.observers[a].delete(l)}}emit(a,...l){this.observers[a]&&Array.from(this.observers[a].entries()).forEach(([f,y])=>{for(let w=0;w<y;w++)f(...l)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([f,y])=>{for(let w=0;w<y;w++)f.apply(f,[a,...l])})}}class hA extends qb{constructor(a,l={ns:["translation"],defaultNS:"translation"}){super(),this.data=a||{},this.options=l,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(a){this.options.ns.indexOf(a)<0&&this.options.ns.push(a)}removeNamespaces(a){const l=this.options.ns.indexOf(a);l>-1&&this.options.ns.splice(l,1)}getResource(a,l,u,f={}){const y=f.keySeparator!==void 0?f.keySeparator:this.options.keySeparator,w=f.ignoreJSONStructure!==void 0?f.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;a.indexOf(".")>-1?i=a.split("."):(i=[a,l],u&&(Array.isArray(u)?i.push(...u):za(u)&&y?i.push(...u.split(y)):i.push(u)));const C=Pb(this.data,i);return!C&&!l&&!u&&a.indexOf(".")>-1&&(a=i[0],l=i[1],u=i.slice(2).join(".")),C||!w||!za(u)?C:wS(this.data?.[a]?.[l],u,y)}addResource(a,l,u,f,y={silent:!1}){const w=y.keySeparator!==void 0?y.keySeparator:this.options.keySeparator;let i=[a,l];u&&(i=i.concat(w?u.split(w):u)),a.indexOf(".")>-1&&(i=a.split("."),f=l,l=i[1]),this.addNamespaces(l),dA(this.data,i,f),y.silent||this.emit("added",a,l,u,f)}addResources(a,l,u,f={silent:!1}){for(const y in u)(za(u[y])||Array.isArray(u[y]))&&this.addResource(a,l,y,u[y],{silent:!0});f.silent||this.emit("added",a,l,u)}addResourceBundle(a,l,u,f,y,w={silent:!1,skipCopy:!1}){let i=[a,l];a.indexOf(".")>-1&&(i=a.split("."),f=u,u=l,l=i[1]),this.addNamespaces(l);let C=Pb(this.data,i)||{};w.skipCopy||(u=JSON.parse(JSON.stringify(u))),f?OP(C,u,y):C={...C,...u},dA(this.data,i,C),w.silent||this.emit("added",a,l,u)}removeResourceBundle(a,l){this.hasResourceBundle(a,l)&&delete this.data[a][l],this.removeNamespaces(l),this.emit("removed",a,l)}hasResourceBundle(a,l){return this.getResource(a,l)!==void 0}getResourceBundle(a,l){return l||(l=this.options.defaultNS),this.getResource(a,l)}getDataByLanguage(a){return this.data[a]}hasLanguageSomeTranslations(a){const l=this.getDataByLanguage(a);return!!(l&&Object.keys(l)||[]).find(f=>l[f]&&Object.keys(l[f]).length>0)}toJSON(){return this.data}}var NP={processors:{},addPostProcessor(s){this.processors[s.name]=s},handle(s,a,l,u,f){return s.forEach(y=>{a=this.processors[y]?.process(a,l,u,f)??a}),a}};const FP=Symbol("i18next/PATH_KEY");function lB(){const s=[],a=Object.create(null);let l;return a.get=(u,f)=>(l?.revoke?.(),f===FP?s:(s.push(f),l=Proxy.revocable(u,a),l.proxy)),Proxy.revocable(Object.create(null),a).proxy}function SS(s,a){const{[FP]:l}=s(lB());return l.join(a?.keySeparator??".")}const fA={},A1=s=>!za(s)&&typeof s!="boolean"&&typeof s!="number";class Rb extends qb{constructor(a,l={}){super(),KF(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],a,this),this.options=l,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=bf.create("translator")}changeLanguage(a){a&&(this.language=a)}exists(a,l={interpolation:{}}){const u={...l};if(a==null)return!1;const f=this.resolve(a,u);if(f?.res===void 0)return!1;const y=A1(f.res);return!(u.returnObjects===!1&&y)}extractFromKey(a,l){let u=l.nsSeparator!==void 0?l.nsSeparator:this.options.nsSeparator;u===void 0&&(u=":");const f=l.keySeparator!==void 0?l.keySeparator:this.options.keySeparator;let y=l.ns||this.options.defaultNS||[];const w=u&&a.indexOf(u)>-1,i=!this.options.userDefinedKeySeparator&&!l.keySeparator&&!this.options.userDefinedNsSeparator&&!l.nsSeparator&&!sB(a,u,f);if(w&&!i){const C=a.match(this.interpolator.nestingRegexp);if(C&&C.length>0)return{key:a,namespaces:za(y)?[y]:y};const P=a.split(u);(u!==f||u===f&&this.options.ns.indexOf(P[0])>-1)&&(y=P.shift()),a=P.join(f)}return{key:a,namespaces:za(y)?[y]:y}}translate(a,l,u){let f=typeof l=="object"?{...l}:l;if(typeof f!="object"&&this.options.overloadTranslationOptionHandler&&(f=this.options.overloadTranslationOptionHandler(arguments)),typeof f=="object"&&(f={...f}),f||(f={}),a==null)return"";typeof a=="function"&&(a=SS(a,{...this.options,...f})),Array.isArray(a)||(a=[String(a)]);const y=f.returnDetails!==void 0?f.returnDetails:this.options.returnDetails,w=f.keySeparator!==void 0?f.keySeparator:this.options.keySeparator,{key:i,namespaces:C}=this.extractFromKey(a[a.length-1],f),P=C[C.length-1];let D=f.nsSeparator!==void 0?f.nsSeparator:this.options.nsSeparator;D===void 0&&(D=":");const $=f.lng||this.language,G=f.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if($?.toLowerCase()==="cimode")return G?y?{res:`${P}${D}${i}`,usedKey:i,exactUsedKey:i,usedLng:$,usedNS:P,usedParams:this.getUsedParamsDetails(f)}:`${P}${D}${i}`:y?{res:i,usedKey:i,exactUsedKey:i,usedLng:$,usedNS:P,usedParams:this.getUsedParamsDetails(f)}:i;const X=this.resolve(a,f);let te=X?.res;const le=X?.usedKey||i,re=X?.exactUsedKey||i,fe=["[object Number]","[object Function]","[object RegExp]"],xe=f.joinArrays!==void 0?f.joinArrays:this.options.joinArrays,be=!this.i18nFormat||this.i18nFormat.handleAsObject,Ne=f.count!==void 0&&!za(f.count),Be=Rb.hasDefaultValue(f),Ee=Ne?this.pluralResolver.getSuffix($,f.count,f):"",et=f.ordinal&&Ne?this.pluralResolver.getSuffix($,f.count,{ordinal:!1}):"",at=Ne&&!f.ordinal&&f.count===0,He=at&&f[`defaultValue${this.options.pluralSeparator}zero`]||f[`defaultValue${Ee}`]||f[`defaultValue${et}`]||f.defaultValue;let lt=te;be&&!te&&Be&&(lt=He);const pt=A1(lt),Zt=Object.prototype.toString.apply(lt);if(be&&lt&&pt&&fe.indexOf(Zt)<0&&!(za(xe)&&Array.isArray(lt))){if(!f.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const jt=this.options.returnedObjectHandler?this.options.returnedObjectHandler(le,lt,{...f,ns:C}):`key '${i} (${this.language})' returned an object instead of string.`;return y?(X.res=jt,X.usedParams=this.getUsedParamsDetails(f),X):jt}if(w){const jt=Array.isArray(lt),Di=jt?[]:{},Pi=jt?re:le;for(const qe in lt)if(Object.prototype.hasOwnProperty.call(lt,qe)){const wt=`${Pi}${w}${qe}`;Be&&!te?Di[qe]=this.translate(wt,{...f,defaultValue:A1(He)?He[qe]:void 0,joinArrays:!1,ns:C}):Di[qe]=this.translate(wt,{...f,joinArrays:!1,ns:C}),Di[qe]===wt&&(Di[qe]=lt[qe])}te=Di}}else if(be&&za(xe)&&Array.isArray(te))te=te.join(xe),te&&(te=this.extendTranslation(te,a,f,u));else{let jt=!1,Di=!1;!this.isValidLookup(te)&&Be&&(jt=!0,te=He),this.isValidLookup(te)||(Di=!0,te=i);const qe=(f.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&Di?void 0:te,wt=Be&&He!==te&&this.options.updateMissing;if(Di||jt||wt){if(this.logger.log(wt?"updateKey":"missingKey",$,P,i,wt?He:te),w){const St=this.resolve(i,{...f,keySeparator:!1});St&&St.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let Ct=[];const Vi=this.languageUtils.getFallbackCodes(this.options.fallbackLng,f.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Vi&&Vi[0])for(let St=0;St<Vi.length;St++)Ct.push(Vi[St]);else this.options.saveMissingTo==="all"?Ct=this.languageUtils.toResolveHierarchy(f.lng||this.language):Ct.push(f.lng||this.language);const Qe=(St,Ht,Ft)=>{const _i=Be&&Ft!==te?Ft:qe;this.options.missingKeyHandler?this.options.missingKeyHandler(St,P,Ht,_i,wt,f):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(St,P,Ht,_i,wt,f),this.emit("missingKey",St,P,Ht,te)};this.options.saveMissing&&(this.options.saveMissingPlurals&&Ne?Ct.forEach(St=>{const Ht=this.pluralResolver.getSuffixes(St,f);at&&f[`defaultValue${this.options.pluralSeparator}zero`]&&Ht.indexOf(`${this.options.pluralSeparator}zero`)<0&&Ht.push(`${this.options.pluralSeparator}zero`),Ht.forEach(Ft=>{Qe([St],i+Ft,f[`defaultValue${Ft}`]||He)})}):Qe(Ct,i,He))}te=this.extendTranslation(te,a,f,X,u),Di&&te===i&&this.options.appendNamespaceToMissingKey&&(te=`${P}${D}${i}`),(Di||jt)&&this.options.parseMissingKeyHandler&&(te=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${P}${D}${i}`:i,jt?te:void 0,f))}return y?(X.res=te,X.usedParams=this.getUsedParamsDetails(f),X):te}extendTranslation(a,l,u,f,y){if(this.i18nFormat?.parse)a=this.i18nFormat.parse(a,{...this.options.interpolation.defaultVariables,...u},u.lng||this.language||f.usedLng,f.usedNS,f.usedKey,{resolved:f});else if(!u.skipInterpolation){u.interpolation&&this.interpolator.init({...u,interpolation:{...this.options.interpolation,...u.interpolation}});const C=za(a)&&(u?.interpolation?.skipOnVariables!==void 0?u.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let P;if(C){const $=a.match(this.interpolator.nestingRegexp);P=$&&$.length}let D=u.replace&&!za(u.replace)?u.replace:u;if(this.options.interpolation.defaultVariables&&(D={...this.options.interpolation.defaultVariables,...D}),a=this.interpolator.interpolate(a,D,u.lng||this.language||f.usedLng,u),C){const $=a.match(this.interpolator.nestingRegexp),G=$&&$.length;P<G&&(u.nest=!1)}!u.lng&&f&&f.res&&(u.lng=this.language||f.usedLng),u.nest!==!1&&(a=this.interpolator.nest(a,(...$)=>y?.[0]===$[0]&&!u.context?(this.logger.warn(`It seems you are nesting recursively key: ${$[0]} in key: ${l[0]}`),null):this.translate(...$,l),u)),u.interpolation&&this.interpolator.reset()}const w=u.postProcess||this.options.postProcess,i=za(w)?[w]:w;return a!=null&&i?.length&&u.applyPostProcessor!==!1&&(a=NP.handle(i,a,l,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...f,usedParams:this.getUsedParamsDetails(u)},...u}:u,this)),a}resolve(a,l={}){let u,f,y,w,i;return za(a)&&(a=[a]),a.forEach(C=>{if(this.isValidLookup(u))return;const P=this.extractFromKey(C,l),D=P.key;f=D;let $=P.namespaces;this.options.fallbackNS&&($=$.concat(this.options.fallbackNS));const G=l.count!==void 0&&!za(l.count),X=G&&!l.ordinal&&l.count===0,te=l.context!==void 0&&(za(l.context)||typeof l.context=="number")&&l.context!=="",le=l.lngs?l.lngs:this.languageUtils.toResolveHierarchy(l.lng||this.language,l.fallbackLng);$.forEach(re=>{this.isValidLookup(u)||(i=re,!fA[`${le[0]}-${re}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(i)&&(fA[`${le[0]}-${re}`]=!0,this.logger.warn(`key "${f}" for languages "${le.join(", ")}" won't get resolved as namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),le.forEach(fe=>{if(this.isValidLookup(u))return;w=fe;const xe=[D];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(xe,D,fe,re,l);else{let Ne;G&&(Ne=this.pluralResolver.getSuffix(fe,l.count,l));const Be=`${this.options.pluralSeparator}zero`,Ee=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(G&&(l.ordinal&&Ne.indexOf(Ee)===0&&xe.push(D+Ne.replace(Ee,this.options.pluralSeparator)),xe.push(D+Ne),X&&xe.push(D+Be)),te){const et=`${D}${this.options.contextSeparator||"_"}${l.context}`;xe.push(et),G&&(l.ordinal&&Ne.indexOf(Ee)===0&&xe.push(et+Ne.replace(Ee,this.options.pluralSeparator)),xe.push(et+Ne),X&&xe.push(et+Be))}}let be;for(;be=xe.pop();)this.isValidLookup(u)||(y=be,u=this.getResource(fe,re,be,l))}))})}),{res:u,usedKey:f,exactUsedKey:y,usedLng:w,usedNS:i}}isValidLookup(a){return a!==void 0&&!(!this.options.returnNull&&a===null)&&!(!this.options.returnEmptyString&&a==="")}getResource(a,l,u,f={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(a,l,u,f):this.resourceStore.getResource(a,l,u,f)}getUsedParamsDetails(a={}){const l=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],u=a.replace&&!za(a.replace);let f=u?a.replace:a;if(u&&typeof a.count<"u"&&(f.count=a.count),this.options.interpolation.defaultVariables&&(f={...this.options.interpolation.defaultVariables,...f}),!u){f={...f};for(const y of l)delete f[y]}return f}static hasDefaultValue(a){const l="defaultValue";for(const u in a)if(Object.prototype.hasOwnProperty.call(a,u)&&l===u.substring(0,l.length)&&a[u]!==void 0)return!0;return!1}}class mA{constructor(a){this.options=a,this.supportedLngs=this.options.supportedLngs||!1,this.logger=bf.create("languageUtils")}getScriptPartFromCode(a){if(a=mx(a),!a||a.indexOf("-")<0)return null;const l=a.split("-");return l.length===2||(l.pop(),l[l.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(l.join("-"))}getLanguagePartFromCode(a){if(a=mx(a),!a||a.indexOf("-")<0)return a;const l=a.split("-");return this.formatLanguageCode(l[0])}formatLanguageCode(a){if(za(a)&&a.indexOf("-")>-1){let l;try{l=Intl.getCanonicalLocales(a)[0]}catch{}return l&&this.options.lowerCaseLng&&(l=l.toLowerCase()),l||(this.options.lowerCaseLng?a.toLowerCase():a)}return this.options.cleanCode||this.options.lowerCaseLng?a.toLowerCase():a}isSupportedCode(a){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(a=this.getLanguagePartFromCode(a)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(a)>-1}getBestMatchFromCodes(a){if(!a)return null;let l;return a.forEach(u=>{if(l)return;const f=this.formatLanguageCode(u);(!this.options.supportedLngs||this.isSupportedCode(f))&&(l=f)}),!l&&this.options.supportedLngs&&a.forEach(u=>{if(l)return;const f=this.getScriptPartFromCode(u);if(this.isSupportedCode(f))return l=f;const y=this.getLanguagePartFromCode(u);if(this.isSupportedCode(y))return l=y;l=this.options.supportedLngs.find(w=>{if(w===y)return w;if(!(w.indexOf("-")<0&&y.indexOf("-")<0)&&(w.indexOf("-")>0&&y.indexOf("-")<0&&w.substring(0,w.indexOf("-"))===y||w.indexOf(y)===0&&y.length>1))return w})}),l||(l=this.getFallbackCodes(this.options.fallbackLng)[0]),l}getFallbackCodes(a,l){if(!a)return[];if(typeof a=="function"&&(a=a(l)),za(a)&&(a=[a]),Array.isArray(a))return a;if(!l)return a.default||[];let u=a[l];return u||(u=a[this.getScriptPartFromCode(l)]),u||(u=a[this.formatLanguageCode(l)]),u||(u=a[this.getLanguagePartFromCode(l)]),u||(u=a.default),u||[]}toResolveHierarchy(a,l){const u=this.getFallbackCodes((l===!1?[]:l)||this.options.fallbackLng||[],a),f=[],y=w=>{w&&(this.isSupportedCode(w)?f.push(w):this.logger.warn(`rejecting language code not found in supportedLngs: ${w}`))};return za(a)&&(a.indexOf("-")>-1||a.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&y(this.formatLanguageCode(a)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&y(this.getScriptPartFromCode(a)),this.options.load!=="currentOnly"&&y(this.getLanguagePartFromCode(a))):za(a)&&y(this.formatLanguageCode(a)),u.forEach(w=>{f.indexOf(w)<0&&y(this.formatLanguageCode(w))}),f}}const pA={zero:0,one:1,two:2,few:3,many:4,other:5},gA={select:s=>s===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class cB{constructor(a,l={}){this.languageUtils=a,this.options=l,this.logger=bf.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(a,l={}){const u=mx(a==="dev"?"en":a),f=l.ordinal?"ordinal":"cardinal",y=JSON.stringify({cleanedCode:u,type:f});if(y in this.pluralRulesCache)return this.pluralRulesCache[y];let w;try{w=new Intl.PluralRules(u,{type:f})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),gA;if(!a.match(/-|_/))return gA;const C=this.languageUtils.getLanguagePartFromCode(a);w=this.getRule(C,l)}return this.pluralRulesCache[y]=w,w}needsPlural(a,l={}){let u=this.getRule(a,l);return u||(u=this.getRule("dev",l)),u?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(a,l,u={}){return this.getSuffixes(a,u).map(f=>`${l}${f}`)}getSuffixes(a,l={}){let u=this.getRule(a,l);return u||(u=this.getRule("dev",l)),u?u.resolvedOptions().pluralCategories.sort((f,y)=>pA[f]-pA[y]).map(f=>`${this.options.prepend}${l.ordinal?`ordinal${this.options.prepend}`:""}${f}`):[]}getSuffix(a,l,u={}){const f=this.getRule(a,u);return f?`${this.options.prepend}${u.ordinal?`ordinal${this.options.prepend}`:""}${f.select(l)}`:(this.logger.warn(`no plural rule found for: ${a}`),this.getSuffix("dev",l,u))}}const _A=(s,a,l,u=".",f=!0)=>{let y=eB(s,a,l);return!y&&f&&za(l)&&(y=wS(s,l,u),y===void 0&&(y=wS(a,l,u))),y},C1=s=>s.replace(/\$/g,"$$$$");class yA{constructor(a={}){this.logger=bf.create("interpolator"),this.options=a,this.format=a?.interpolation?.format||(l=>l),this.init(a)}init(a={}){a.interpolation||(a.interpolation={escapeValue:!0});const{escape:l,escapeValue:u,useRawValueToEscape:f,prefix:y,prefixEscaped:w,suffix:i,suffixEscaped:C,formatSeparator:P,unescapeSuffix:D,unescapePrefix:$,nestingPrefix:G,nestingPrefixEscaped:X,nestingSuffix:te,nestingSuffixEscaped:le,nestingOptionsSeparator:re,maxReplaces:fe,alwaysFormat:xe}=a.interpolation;this.escape=l!==void 0?l:iB,this.escapeValue=u!==void 0?u:!0,this.useRawValueToEscape=f!==void 0?f:!1,this.prefix=y?ly(y):w||"{{",this.suffix=i?ly(i):C||"}}",this.formatSeparator=P||",",this.unescapePrefix=D?"":$||"-",this.unescapeSuffix=this.unescapePrefix?"":D||"",this.nestingPrefix=G?ly(G):X||ly("$t("),this.nestingSuffix=te?ly(te):le||ly(")"),this.nestingOptionsSeparator=re||",",this.maxReplaces=fe||1e3,this.alwaysFormat=xe!==void 0?xe:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const a=(l,u)=>l?.source===u?(l.lastIndex=0,l):new RegExp(u,"g");this.regexp=a(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=a(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=a(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(a,l,u,f){let y,w,i;const C=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},P=X=>{if(X.indexOf(this.formatSeparator)<0){const fe=_A(l,C,X,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(fe,void 0,u,{...f,...l,interpolationkey:X}):fe}const te=X.split(this.formatSeparator),le=te.shift().trim(),re=te.join(this.formatSeparator).trim();return this.format(_A(l,C,le,this.options.keySeparator,this.options.ignoreJSONStructure),re,u,{...f,...l,interpolationkey:le})};this.resetRegExp();const D=f?.missingInterpolationHandler||this.options.missingInterpolationHandler,$=f?.interpolation?.skipOnVariables!==void 0?f.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:X=>C1(X)},{regex:this.regexp,safeValue:X=>this.escapeValue?C1(this.escape(X)):C1(X)}].forEach(X=>{for(i=0;y=X.regex.exec(a);){const te=y[1].trim();if(w=P(te),w===void 0)if(typeof D=="function"){const re=D(a,y,f);w=za(re)?re:""}else if(f&&Object.prototype.hasOwnProperty.call(f,te))w="";else if($){w=y[0];continue}else this.logger.warn(`missed to pass in variable ${te} for interpolating ${a}`),w="";else!za(w)&&!this.useRawValueToEscape&&(w=lA(w));const le=X.safeValue(w);if(a=a.replace(y[0],le),$?(X.regex.lastIndex+=w.length,X.regex.lastIndex-=y[0].length):X.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),a}nest(a,l,u={}){let f,y,w;const i=(C,P)=>{const D=this.nestingOptionsSeparator;if(C.indexOf(D)<0)return C;const $=C.split(new RegExp(`${D}[ ]*{`));let G=`{${$[1]}`;C=$[0],G=this.interpolate(G,w);const X=G.match(/'/g),te=G.match(/"/g);((X?.length??0)%2===0&&!te||te.length%2!==0)&&(G=G.replace(/'/g,'"'));try{w=JSON.parse(G),P&&(w={...P,...w})}catch(le){return this.logger.warn(`failed parsing options string in nesting for key ${C}`,le),`${C}${D}${G}`}return w.defaultValue&&w.defaultValue.indexOf(this.prefix)>-1&&delete w.defaultValue,C};for(;f=this.nestingRegexp.exec(a);){let C=[];w={...u},w=w.replace&&!za(w.replace)?w.replace:w,w.applyPostProcessor=!1,delete w.defaultValue;const P=/{.*}/.test(f[1])?f[1].lastIndexOf("}")+1:f[1].indexOf(this.formatSeparator);if(P!==-1&&(C=f[1].slice(P).split(this.formatSeparator).map(D=>D.trim()).filter(Boolean),f[1]=f[1].slice(0,P)),y=l(i.call(this,f[1].trim(),w),w),y&&f[0]===a&&!za(y))return y;za(y)||(y=lA(y)),y||(this.logger.warn(`missed to resolve ${f[1]} for nesting ${a}`),y=""),C.length&&(y=C.reduce((D,$)=>this.format(D,$,u.lng,{...u,interpolationkey:f[1].trim()}),y.trim())),a=a.replace(f[0],y),this.regexp.lastIndex=0}return a}}const uB=s=>{let a=s.toLowerCase().trim();const l={};if(s.indexOf("(")>-1){const u=s.split("(");a=u[0].toLowerCase().trim();const f=u[1].substring(0,u[1].length-1);a==="currency"&&f.indexOf(":")<0?l.currency||(l.currency=f.trim()):a==="relativetime"&&f.indexOf(":")<0?l.range||(l.range=f.trim()):f.split(";").forEach(w=>{if(w){const[i,...C]=w.split(":"),P=C.join(":").trim().replace(/^'+|'+$/g,""),D=i.trim();l[D]||(l[D]=P),P==="false"&&(l[D]=!1),P==="true"&&(l[D]=!0),isNaN(P)||(l[D]=parseInt(P,10))}})}return{formatName:a,formatOptions:l}},vA=s=>{const a={};return(l,u,f)=>{let y=f;f&&f.interpolationkey&&f.formatParams&&f.formatParams[f.interpolationkey]&&f[f.interpolationkey]&&(y={...y,[f.interpolationkey]:void 0});const w=u+JSON.stringify(y);let i=a[w];return i||(i=s(mx(u),f),a[w]=i),i(l)}},dB=s=>(a,l,u)=>s(mx(l),u)(a);class hB{constructor(a={}){this.logger=bf.create("formatter"),this.options=a,this.init(a)}init(a,l={interpolation:{}}){this.formatSeparator=l.interpolation.formatSeparator||",";const u=l.cacheInBuiltFormats?vA:dB;this.formats={number:u((f,y)=>{const w=new Intl.NumberFormat(f,{...y});return i=>w.format(i)}),currency:u((f,y)=>{const w=new Intl.NumberFormat(f,{...y,style:"currency"});return i=>w.format(i)}),datetime:u((f,y)=>{const w=new Intl.DateTimeFormat(f,{...y});return i=>w.format(i)}),relativetime:u((f,y)=>{const w=new Intl.RelativeTimeFormat(f,{...y});return i=>w.format(i,y.range||"day")}),list:u((f,y)=>{const w=new Intl.ListFormat(f,{...y});return i=>w.format(i)})}}add(a,l){this.formats[a.toLowerCase().trim()]=l}addCached(a,l){this.formats[a.toLowerCase().trim()]=vA(l)}format(a,l,u,f={}){const y=l.split(this.formatSeparator);if(y.length>1&&y[0].indexOf("(")>1&&y[0].indexOf(")")<0&&y.find(i=>i.indexOf(")")>-1)){const i=y.findIndex(C=>C.indexOf(")")>-1);y[0]=[y[0],...y.splice(1,i)].join(this.formatSeparator)}return y.reduce((i,C)=>{const{formatName:P,formatOptions:D}=uB(C);if(this.formats[P]){let $=i;try{const G=f?.formatParams?.[f.interpolationkey]||{},X=G.locale||G.lng||f.locale||f.lng||u;$=this.formats[P](i,X,{...D,...f,...G})}catch(G){this.logger.warn(G)}return $}else this.logger.warn(`there was no format function for ${P}`);return i},a)}}const fB=(s,a)=>{s.pending[a]!==void 0&&(delete s.pending[a],s.pendingCount--)};class mB extends qb{constructor(a,l,u,f={}){super(),this.backend=a,this.store=l,this.services=u,this.languageUtils=u.languageUtils,this.options=f,this.logger=bf.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=f.maxParallelReads||10,this.readingCalls=0,this.maxRetries=f.maxRetries>=0?f.maxRetries:5,this.retryTimeout=f.retryTimeout>=1?f.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(u,f.backend,f)}queueLoad(a,l,u,f){const y={},w={},i={},C={};return a.forEach(P=>{let D=!0;l.forEach($=>{const G=`${P}|${$}`;!u.reload&&this.store.hasResourceBundle(P,$)?this.state[G]=2:this.state[G]<0||(this.state[G]===1?w[G]===void 0&&(w[G]=!0):(this.state[G]=1,D=!1,w[G]===void 0&&(w[G]=!0),y[G]===void 0&&(y[G]=!0),C[$]===void 0&&(C[$]=!0)))}),D||(i[P]=!0)}),(Object.keys(y).length||Object.keys(w).length)&&this.queue.push({pending:w,pendingCount:Object.keys(w).length,loaded:{},errors:[],callback:f}),{toLoad:Object.keys(y),pending:Object.keys(w),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(C)}}loaded(a,l,u){const f=a.split("|"),y=f[0],w=f[1];l&&this.emit("failedLoading",y,w,l),!l&&u&&this.store.addResourceBundle(y,w,u,void 0,void 0,{skipCopy:!0}),this.state[a]=l?-1:2,l&&u&&(this.state[a]=0);const i={};this.queue.forEach(C=>{QF(C.loaded,[y],w),fB(C,a),l&&C.errors.push(l),C.pendingCount===0&&!C.done&&(Object.keys(C.loaded).forEach(P=>{i[P]||(i[P]={});const D=C.loaded[P];D.length&&D.forEach($=>{i[P][$]===void 0&&(i[P][$]=!0)})}),C.done=!0,C.errors.length?C.callback(C.errors):C.callback())}),this.emit("loaded",i),this.queue=this.queue.filter(C=>!C.done)}read(a,l,u,f=0,y=this.retryTimeout,w){if(!a.length)return w(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:a,ns:l,fcName:u,tried:f,wait:y,callback:w});return}this.readingCalls++;const i=(P,D)=>{if(this.readingCalls--,this.waitingReads.length>0){const $=this.waitingReads.shift();this.read($.lng,$.ns,$.fcName,$.tried,$.wait,$.callback)}if(P&&D&&f<this.maxRetries){setTimeout(()=>{this.read.call(this,a,l,u,f+1,y*2,w)},y);return}w(P,D)},C=this.backend[u].bind(this.backend);if(C.length===2){try{const P=C(a,l);P&&typeof P.then=="function"?P.then(D=>i(null,D)).catch(i):i(null,P)}catch(P){i(P)}return}return C(a,l,i)}prepareLoading(a,l,u={},f){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),f&&f();za(a)&&(a=this.languageUtils.toResolveHierarchy(a)),za(l)&&(l=[l]);const y=this.queueLoad(a,l,u,f);if(!y.toLoad.length)return y.pending.length||f(),null;y.toLoad.forEach(w=>{this.loadOne(w)})}load(a,l,u){this.prepareLoading(a,l,{},u)}reload(a,l,u){this.prepareLoading(a,l,{reload:!0},u)}loadOne(a,l=""){const u=a.split("|"),f=u[0],y=u[1];this.read(f,y,"read",void 0,void 0,(w,i)=>{w&&this.logger.warn(`${l}loading namespace ${y} for language ${f} failed`,w),!w&&i&&this.logger.log(`${l}loaded namespace ${y} for language ${f}`,i),this.loaded(a,w,i)})}saveMissing(a,l,u,f,y,w={},i=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(l)){this.logger.warn(`did not save key "${u}" as the namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(u==null||u==="")){if(this.backend?.create){const C={...w,isUpdate:y},P=this.backend.create.bind(this.backend);if(P.length<6)try{let D;P.length===5?D=P(a,l,u,f,C):D=P(a,l,u,f),D&&typeof D.then=="function"?D.then($=>i(null,$)).catch(i):i(null,D)}catch(D){i(D)}else P(a,l,u,f,i,C)}!a||!a[0]||this.store.addResource(a[0],l,u,f)}}}const M1=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:s=>{let a={};if(typeof s[1]=="object"&&(a=s[1]),za(s[1])&&(a.defaultValue=s[1]),za(s[2])&&(a.tDescription=s[2]),typeof s[2]=="object"||typeof s[3]=="object"){const l=s[3]||s[2];Object.keys(l).forEach(u=>{a[u]=l[u]})}return a},interpolation:{escapeValue:!0,format:s=>s,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),xA=s=>(za(s.ns)&&(s.ns=[s.ns]),za(s.fallbackLng)&&(s.fallbackLng=[s.fallbackLng]),za(s.fallbackNS)&&(s.fallbackNS=[s.fallbackNS]),s.supportedLngs?.indexOf?.("cimode")<0&&(s.supportedLngs=s.supportedLngs.concat(["cimode"])),typeof s.initImmediate=="boolean"&&(s.initAsync=s.initImmediate),s),B0=()=>{},pB=s=>{Object.getOwnPropertyNames(Object.getPrototypeOf(s)).forEach(l=>{typeof s[l]=="function"&&(s[l]=s[l].bind(s))})};class ix extends qb{constructor(a={},l){if(super(),this.options=xA(a),this.services={},this.logger=bf,this.modules={external:[]},pB(this),l&&!this.isInitialized&&!a.isClone){if(!this.options.initAsync)return this.init(a,l),this;setTimeout(()=>{this.init(a,l)},0)}}init(a={},l){this.isInitializing=!0,typeof a=="function"&&(l=a,a={}),a.defaultNS==null&&a.ns&&(za(a.ns)?a.defaultNS=a.ns:a.ns.indexOf("translation")<0&&(a.defaultNS=a.ns[0]));const u=M1();this.options={...u,...this.options,...xA(a)},this.options.interpolation={...u.interpolation,...this.options.interpolation},a.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=a.keySeparator),a.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=a.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=u.overloadTranslationOptionHandler);const f=P=>P?typeof P=="function"?new P:P:null;if(!this.options.isClone){this.modules.logger?bf.init(f(this.modules.logger),this.options):bf.init(null,this.options);let P;this.modules.formatter?P=this.modules.formatter:P=hB;const D=new mA(this.options);this.store=new hA(this.options.resources,this.options);const $=this.services;$.logger=bf,$.resourceStore=this.store,$.languageUtils=D,$.pluralResolver=new cB(D,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==u.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),P&&(!this.options.interpolation.format||this.options.interpolation.format===u.interpolation.format)&&($.formatter=f(P),$.formatter.init&&$.formatter.init($,this.options),this.options.interpolation.format=$.formatter.format.bind($.formatter)),$.interpolator=new yA(this.options),$.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},$.backendConnector=new mB(f(this.modules.backend),$.resourceStore,$,this.options),$.backendConnector.on("*",(X,...te)=>{this.emit(X,...te)}),this.modules.languageDetector&&($.languageDetector=f(this.modules.languageDetector),$.languageDetector.init&&$.languageDetector.init($,this.options.detection,this.options)),this.modules.i18nFormat&&($.i18nFormat=f(this.modules.i18nFormat),$.i18nFormat.init&&$.i18nFormat.init(this)),this.translator=new Rb(this.services,this.options),this.translator.on("*",(X,...te)=>{this.emit(X,...te)}),this.modules.external.forEach(X=>{X.init&&X.init(this)})}if(this.format=this.options.interpolation.format,l||(l=B0),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const P=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);P.length>0&&P[0]!=="dev"&&(this.options.lng=P[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(P=>{this[P]=(...D)=>this.store[P](...D)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(P=>{this[P]=(...D)=>(this.store[P](...D),this)});const i=zv(),C=()=>{const P=(D,$)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),i.resolve($),l(D,$)};if(this.languages&&!this.isInitialized)return P(null,this.t.bind(this));this.changeLanguage(this.options.lng,P)};return this.options.resources||!this.options.initAsync?C():setTimeout(C,0),i}loadResources(a,l=B0){let u=l;const f=za(a)?a:this.language;if(typeof a=="function"&&(u=a),!this.options.resources||this.options.partialBundledLanguages){if(f?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return u();const y=[],w=i=>{if(!i||i==="cimode")return;this.services.languageUtils.toResolveHierarchy(i).forEach(P=>{P!=="cimode"&&y.indexOf(P)<0&&y.push(P)})};f?w(f):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(C=>w(C)),this.options.preload?.forEach?.(i=>w(i)),this.services.backendConnector.load(y,this.options.ns,i=>{!i&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),u(i)})}else u(null)}reloadResources(a,l,u){const f=zv();return typeof a=="function"&&(u=a,a=void 0),typeof l=="function"&&(u=l,l=void 0),a||(a=this.languages),l||(l=this.options.ns),u||(u=B0),this.services.backendConnector.reload(a,l,y=>{f.resolve(),u(y)}),f}use(a){if(!a)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!a.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return a.type==="backend"&&(this.modules.backend=a),(a.type==="logger"||a.log&&a.warn&&a.error)&&(this.modules.logger=a),a.type==="languageDetector"&&(this.modules.languageDetector=a),a.type==="i18nFormat"&&(this.modules.i18nFormat=a),a.type==="postProcessor"&&NP.addPostProcessor(a),a.type==="formatter"&&(this.modules.formatter=a),a.type==="3rdParty"&&this.modules.external.push(a),this}setResolvedLanguage(a){if(!(!a||!this.languages)&&!(["cimode","dev"].indexOf(a)>-1)){for(let l=0;l<this.languages.length;l++){const u=this.languages[l];if(!(["cimode","dev"].indexOf(u)>-1)&&this.store.hasLanguageSomeTranslations(u)){this.resolvedLanguage=u;break}}!this.resolvedLanguage&&this.languages.indexOf(a)<0&&this.store.hasLanguageSomeTranslations(a)&&(this.resolvedLanguage=a,this.languages.unshift(a))}}changeLanguage(a,l){this.isLanguageChangingTo=a;const u=zv();this.emit("languageChanging",a);const f=i=>{this.language=i,this.languages=this.services.languageUtils.toResolveHierarchy(i),this.resolvedLanguage=void 0,this.setResolvedLanguage(i)},y=(i,C)=>{C?this.isLanguageChangingTo===a&&(f(C),this.translator.changeLanguage(C),this.isLanguageChangingTo=void 0,this.emit("languageChanged",C),this.logger.log("languageChanged",C)):this.isLanguageChangingTo=void 0,u.resolve((...P)=>this.t(...P)),l&&l(i,(...P)=>this.t(...P))},w=i=>{!a&&!i&&this.services.languageDetector&&(i=[]);const C=za(i)?i:i&&i[0],P=this.store.hasLanguageSomeTranslations(C)?C:this.services.languageUtils.getBestMatchFromCodes(za(i)?[i]:i);P&&(this.language||f(P),this.translator.language||this.translator.changeLanguage(P),this.services.languageDetector?.cacheUserLanguage?.(P)),this.loadResources(P,D=>{y(D,P)})};return!a&&this.services.languageDetector&&!this.services.languageDetector.async?w(this.services.languageDetector.detect()):!a&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(w):this.services.languageDetector.detect(w):w(a),u}getFixedT(a,l,u){const f=(y,w,...i)=>{let C;typeof w!="object"?C=this.options.overloadTranslationOptionHandler([y,w].concat(i)):C={...w},C.lng=C.lng||f.lng,C.lngs=C.lngs||f.lngs,C.ns=C.ns||f.ns,C.keyPrefix!==""&&(C.keyPrefix=C.keyPrefix||u||f.keyPrefix);const P=this.options.keySeparator||".";let D;return C.keyPrefix&&Array.isArray(y)?D=y.map($=>(typeof $=="function"&&($=SS($,{...this.options,...w})),`${C.keyPrefix}${P}${$}`)):(typeof y=="function"&&(y=SS(y,{...this.options,...w})),D=C.keyPrefix?`${C.keyPrefix}${P}${y}`:y),this.t(D,C)};return za(a)?f.lng=a:f.lngs=a,f.ns=l,f.keyPrefix=u,f}t(...a){return this.translator?.translate(...a)}exists(...a){return this.translator?.exists(...a)}setDefaultNamespace(a){this.options.defaultNS=a}hasLoadedNamespace(a,l={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const u=l.lng||this.resolvedLanguage||this.languages[0],f=this.options?this.options.fallbackLng:!1,y=this.languages[this.languages.length-1];if(u.toLowerCase()==="cimode")return!0;const w=(i,C)=>{const P=this.services.backendConnector.state[`${i}|${C}`];return P===-1||P===0||P===2};if(l.precheck){const i=l.precheck(this,w);if(i!==void 0)return i}return!!(this.hasResourceBundle(u,a)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||w(u,a)&&(!f||w(y,a)))}loadNamespaces(a,l){const u=zv();return this.options.ns?(za(a)&&(a=[a]),a.forEach(f=>{this.options.ns.indexOf(f)<0&&this.options.ns.push(f)}),this.loadResources(f=>{u.resolve(),l&&l(f)}),u):(l&&l(),Promise.resolve())}loadLanguages(a,l){const u=zv();za(a)&&(a=[a]);const f=this.options.preload||[],y=a.filter(w=>f.indexOf(w)<0&&this.services.languageUtils.isSupportedCode(w));return y.length?(this.options.preload=f.concat(y),this.loadResources(w=>{u.resolve(),l&&l(w)}),u):(l&&l(),Promise.resolve())}dir(a){if(a||(a=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!a)return"rtl";try{const f=new Intl.Locale(a);if(f&&f.getTextInfo){const y=f.getTextInfo();if(y&&y.direction)return y.direction}}catch{}const l=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],u=this.services?.languageUtils||new mA(M1());return a.toLowerCase().indexOf("-latn")>1?"ltr":l.indexOf(u.getLanguagePartFromCode(a))>-1||a.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(a={},l){const u=new ix(a,l);return u.createInstance=ix.createInstance,u}cloneInstance(a={},l=B0){const u=a.forkResourceStore;u&&delete a.forkResourceStore;const f={...this.options,...a,isClone:!0},y=new ix(f);if((a.debug!==void 0||a.prefix!==void 0)&&(y.logger=y.logger.clone(a)),["store","services","language"].forEach(i=>{y[i]=this[i]}),y.services={...this.services},y.services.utils={hasLoadedNamespace:y.hasLoadedNamespace.bind(y)},u){const i=Object.keys(this.store.data).reduce((C,P)=>(C[P]={...this.store.data[P]},C[P]=Object.keys(C[P]).reduce((D,$)=>(D[$]={...C[P][$]},D),C[P]),C),{});y.store=new hA(i,f),y.services.resourceStore=y.store}if(a.interpolation){const C={...M1().interpolation,...this.options.interpolation,...a.interpolation},P={...f,interpolation:C};y.services.interpolator=new yA(P)}return y.translator=new Rb(y.services,f),y.translator.on("*",(i,...C)=>{y.emit(i,...C)}),y.init(f,l),y.translator.options=f,y.translator.backendConnector.services.utils={hasLoadedNamespace:y.hasLoadedNamespace.bind(y)},y}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Vc=ix.createInstance();Vc.createInstance;Vc.dir;Vc.init;Vc.loadResources;Vc.reloadResources;Vc.use;Vc.changeLanguage;Vc.getFixedT;Vc.t;Vc.exists;Vc.setDefaultNamespace;Vc.hasLoadedNamespace;Vc.loadNamespaces;Vc.loadLanguages;const gB=(s,a,l,u)=>{const f=[l,{code:a,...u||{}}];if(s?.services?.logger?.forward)return s.services.logger.forward(f,"warn","react-i18next::",!0);e_(f[0])&&(f[0]=`react-i18next:: ${f[0]}`),s?.services?.logger?.warn?s.services.logger.warn(...f):console?.warn&&console.warn(...f)},bA={},BP=(s,a,l,u)=>{e_(l)&&bA[l]||(e_(l)&&(bA[l]=new Date),gB(s,a,l,u))},UP=(s,a)=>()=>{if(s.isInitialized)a();else{const l=()=>{setTimeout(()=>{s.off("initialized",l)},0),a()};s.on("initialized",l)}},TS=(s,a,l)=>{s.loadNamespaces(a,UP(s,l))},wA=(s,a,l,u)=>{if(e_(l)&&(l=[l]),s.options.preload&&s.options.preload.indexOf(a)>-1)return TS(s,l,u);l.forEach(f=>{s.options.ns.indexOf(f)<0&&s.options.ns.push(f)}),s.loadLanguages(a,UP(s,u))},_B=(s,a,l={})=>!a.languages||!a.languages.length?(BP(a,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:a.languages}),!0):a.hasLoadedNamespace(s,{lng:l.lng,precheck:(u,f)=>{if(l.bindI18n&&l.bindI18n.indexOf("languageChanging")>-1&&u.services.backendConnector.backend&&u.isLanguageChangingTo&&!f(u.isLanguageChangingTo,s))return!1}}),e_=s=>typeof s=="string",yB=s=>typeof s=="object"&&s!==null,vB=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,xB={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},bB=s=>xB[s],wB=s=>s.replace(vB,bB);let kS={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:wB,transDefaultProps:void 0};const SB=(s={})=>{kS={...kS,...s}},TB=()=>kS;let $P;const kB=s=>{$P=s},EB=()=>$P,AB={type:"3rdParty",init(s){SB(s.options.react),kB(s)}},CB=pe.createContext();class MB{constructor(){this.usedNamespaces={}}addUsedNamespaces(a){a.forEach(l=>{this.usedNamespaces[l]||(this.usedNamespaces[l]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var P1={exports:{}},j1={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SA;function PB(){if(SA)return j1;SA=1;var s=$b();function a($,G){return $===G&&($!==0||1/$===1/G)||$!==$&&G!==G}var l=typeof Object.is=="function"?Object.is:a,u=s.useState,f=s.useEffect,y=s.useLayoutEffect,w=s.useDebugValue;function i($,G){var X=G(),te=u({inst:{value:X,getSnapshot:G}}),le=te[0].inst,re=te[1];return y(function(){le.value=X,le.getSnapshot=G,C(le)&&re({inst:le})},[$,X,G]),f(function(){return C(le)&&re({inst:le}),$(function(){C(le)&&re({inst:le})})},[$]),w(X),X}function C($){var G=$.getSnapshot;$=$.value;try{var X=G();return!l($,X)}catch{return!0}}function P($,G){return G()}var D=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?P:i;return j1.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:D,j1}var TA;function jB(){return TA||(TA=1,P1.exports=PB()),P1.exports}var RB=jB();const LB=(s,a)=>e_(a)?a:yB(a)&&e_(a.defaultValue)?a.defaultValue:Array.isArray(s)?s[s.length-1]:s,IB={t:LB,ready:!1},zB=()=>()=>{},VP=(s,a={})=>{const{i18n:l}=a,{i18n:u,defaultNS:f}=pe.useContext(CB)||{},y=l||u||EB();y&&!y.reportNamespaces&&(y.reportNamespaces=new MB),y||BP(y,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const w=pe.useMemo(()=>({...TB(),...y?.options?.react,...a}),[y,a]),{useSuspense:i,keyPrefix:C}=w,P=f||y?.options?.defaultNS,D=e_(P)?[P]:P||["translation"],$=pe.useMemo(()=>D,D);y?.reportNamespaces?.addUsedNamespaces?.($);const G=pe.useRef(0),X=pe.useCallback(He=>{if(!y)return zB;const{bindI18n:lt,bindI18nStore:pt}=w,Zt=()=>{G.current+=1,He()};return lt&&y.on(lt,Zt),pt&&y.store.on(pt,Zt),()=>{lt&&lt.split(" ").forEach(jt=>y.off(jt,Zt)),pt&&pt.split(" ").forEach(jt=>y.store.off(jt,Zt))}},[y,w]),te=pe.useRef(),le=pe.useCallback(()=>{if(!y)return IB;const He=!!(y.isInitialized||y.initializedStoreOnce)&&$.every(Pi=>_B(Pi,y,w)),lt=a.lng||y.language,pt=G.current,Zt=te.current;if(Zt&&Zt.ready===He&&Zt.lng===lt&&Zt.keyPrefix===C&&Zt.revision===pt)return Zt;const Di={t:y.getFixedT(lt,w.nsMode==="fallback"?$:$[0],C),ready:He,lng:lt,keyPrefix:C,revision:pt};return te.current=Di,Di},[y,$,C,w,a.lng]),[re,fe]=pe.useState(0),{t:xe,ready:be}=RB.useSyncExternalStore(X,le,le);pe.useEffect(()=>{if(y&&!be&&!i){const He=()=>fe(lt=>lt+1);a.lng?wA(y,a.lng,$,He):TS(y,$,He)}},[y,a.lng,$,be,i,re]);const Ne=y||{},Be=pe.useRef(null),Ee=pe.useRef(),et=He=>{const lt=Object.getOwnPropertyDescriptors(He);lt.__original&&delete lt.__original;const pt=Object.create(Object.getPrototypeOf(He),lt);if(!Object.prototype.hasOwnProperty.call(pt,"__original"))try{Object.defineProperty(pt,"__original",{value:He,writable:!1,enumerable:!1,configurable:!1})}catch{}return pt},at=pe.useMemo(()=>{const He=Ne,lt=He?.language;let pt=He;He&&(Be.current&&Be.current.__original===He?Ee.current!==lt?(pt=et(He),Be.current=pt,Ee.current=lt):pt=Be.current:(pt=et(He),Be.current=pt,Ee.current=lt));const Zt=[xe,pt,be];return Zt.t=xe,Zt.i18n=pt,Zt.ready=be,Zt},[xe,Ne,be,Ne.resolvedLanguage,Ne.language,Ne.languages]);if(y&&i&&!be)throw new Promise(He=>{const lt=()=>He();a.lng?wA(y,a.lng,$,lt):TS(y,$,lt)});return at},DB=[{id:1,name:"Fresh Produce",emoji:""},{id:2,name:"Street Food",emoji:""},{id:3,name:"Snacks & Drinks",emoji:""},{id:4,name:"Clothing",emoji:""},{id:5,name:"Handicrafts",emoji:""},{id:6,name:"Fruits",emoji:""},{id:7,name:"Seafood",emoji:""},{id:8,name:"Performance",emoji:""}],OB=["Food","Fresh Produce","Handicraft","Fashion","Local Snack"],NB=()=>{const{t:s,i18n:a}=VP(),l=be=>a.changeLanguage(be),u=Ma(),f=Lr(!1);localStorage.getItem("isHello")||(window.location.href="/hello");const w=localStorage.getItem("signupRole");w&&f?.user?.id&&(localStorage.removeItem("signupRole"),u(`/${w}/registration`));const{markets:i,loading:C}=ky(),P=Ay(),[D,$]=pe.useState(!1),[G,X]=pe.useState({distance:null,rating:null,openNow:!1,tags:[]}),te=()=>{zP({showProgress:!0,allowClose:!0,overlayOpacity:.5,steps:[{element:"#tour-categories",popover:{title:s("Product Categories"),description:s("Browse food, crafts, fashion, and more from local vendors by category."),side:"bottom",align:"start"}},{element:"#tour-markets",popover:{title:s("Street Markets"),description:s("Explore nearby street markets and tamu. Filter by distance, rating, and availability."),side:"top",align:"start"}}],onDestroyed:()=>{localStorage.setItem("home_tour_seen","true")}}).drive()};pe.useEffect(()=>{!localStorage.getItem("home_tour_seen")&&!C&&i?.length>0&&te()},[C,i]);const le=be=>{if(!be?.open_time||!be?.close_time)return!1;const Ne=new Date().getHours(),Be=new Date(be.open_time).getHours(),Ee=new Date(be.close_time).getHours();return Be<=Ee?Ne>=Be&&Ne<=Ee:Ne>=Be||Ne<=Ee},fe=(i||[]).filter(be=>!(G.openNow&&!le(be)||G.rating&&be.average_rating<G.rating||G.distance&&be.distance>G.distance||G.tags.length>0&&!G.tags.some(Ne=>be.tags?.includes(Ne)))),xe=be=>{X(Ne=>({...Ne,tags:Ne.tags.includes(be)?Ne.tags.filter(Be=>Be!==be):[...Ne.tags,be]}))};return A.jsxs("div",{className:"relative min-h-screen bg-[var(--white)]",children:[A.jsx("header",{className:"w-full bg-[var(--white)]",children:A.jsxs("div",{className:"w-full px-4 sm:px-6 py-3 flex items-center justify-between gap-3",children:[A.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[A.jsx("img",{src:"/tamulokal.png",alt:"Tamukinabalu logo",className:"h-8 w-8 sm:h-10 sm:w-10 object-contain"}),A.jsx("span",{className:"text-base sm:text-xl font-semibold text-[var(--black)]",children:"TamuKinabalu"})]}),A.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 shrink-0",children:[A.jsxs("button",{type:"button",className:`inline-flex items-center gap-1.5 px-3 py-2 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm font-semibold transition shadow-sm hover:shadow-md border bg-[var(--white)] ${P?"border-[var(--green)] text-[var(--green)]":"border-[var(--red)] text-[var(--red)]"}`,title:P?"Location enabled":"Location disabled",children:[A.jsx(HS,{className:"text-sm sm:text-base"}),A.jsx("p",{children:s(P?"Enabled":"Disabled")})]}),A.jsxs("button",{onClick:()=>l(a.language==="en"?"ms":"en"),className:"inline-flex items-center gap-1.5 px-3 py-2 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm font-semibold transition shadow-sm hover:shadow-md border border-[var(--gray)] bg-[color-mix(in srgb,var(--white) 70%,transparent)] text-[var(--black)]",children:[A.jsx(iP,{className:"text-base sm:text-lg"}),a.language==="en"?"EN":"MS"]})]})]})}),A.jsxs("main",{className:"max-w-6xl mx-auto w-full pt-4 pb-24",children:[A.jsxs("div",{id:"tour-categories",className:"px-4 pt-2",children:[A.jsx("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-2",children:A.jsxs("div",{children:[A.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:s("Product Categories")}),A.jsx("p",{className:"text-sm text-[var(--gray)] max-w-2xl mt-1",children:s("Browse by category to quickly find food, crafts, fashion, and more from local vendors.")})]})}),A.jsx("div",{className:"w-full grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-3 mt-4",children:DB.map(be=>A.jsxs($s,{to:`/category/${be.id}`,className:`\r
                  bg-[var(--white)] rounded-xl shadow-sm border border-[var(--gray)]\r
                  flex flex-col items-center justify-center\r
                  aspect-square\r
                  hover:border-[var(--orange)] hover:shadow-md transition\r
                `,children:[A.jsx("span",{className:"text-2xl mb-1",children:be.emoji}),A.jsx("span",{className:"text-xs font-medium text-[var(--black)] text-center px-1",children:s(be.name)})]},be.id))})]}),A.jsxs("div",{id:"tour-markets",className:"px-4 mt-8",children:[A.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[A.jsxs("div",{children:[A.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:s("Street Markets")}),A.jsx("p",{className:"text-sm text-[var(--gray)] max-w-2xl mt-1",children:s("Filter by distance, ratings, whats open now, and tags to find the perfect market to visit.")})]}),A.jsx("div",{className:"grid grid-cols-1 sm:flex sm:flex-row gap-2 w-full sm:w-auto",children:A.jsxs("button",{onClick:()=>$(!0),className:"inline-flex items-center justify-center gap-2 px-3 py-2 rounded-full bg-[var(--orange)] text-white text-sm font-semibold shadow-sm hover:shadow-md transition border border-[var(--orange)]",children:[A.jsx(VS,{size:16}),s("Filters")]})})]}),A.jsx("div",{className:"mt-4",children:A.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[!C&&fe.length===0&&A.jsx("p",{className:"text-gray-600 text-center col-span-full",children:s("No markets found with selected filters.")}),C?Array.from({length:6}).map((be,Ne)=>A.jsx("div",{className:"w-full h-[350px]",children:A.jsx(YF,{height:350})},Ne)):fe.map(be=>A.jsx("div",{className:"w-full h-[350px]",children:A.jsx(DP,{market:be,height:350})},be.id))]})})]})]}),D&&A.jsx("div",{className:"fixed inset-0 bg-black/50 z-[80] flex items-end justify-center lg:items-stretch lg:justify-start",children:A.jsxs("div",{className:"bg-white w-full max-w-xl rounded-t-2xl p-6 shadow-lg lg:h-full lg:max-w-md lg:rounded-none lg:rounded-r-2xl lg:shadow-2xl lg:overflow-y-auto",children:[A.jsxs("div",{className:"flex justify-between items-center mb-4",children:[A.jsx("button",{onClick:()=>X({distance:null,rating:null,openNow:!1,tags:[]}),className:"text-sm text-gray-500 font-medium",children:s("Reset")}),A.jsx("h3",{className:"text-lg font-semibold",children:s("Filter")}),A.jsx("button",{onClick:()=>$(!1),className:"text-sm text-[var(--orange)] font-medium",children:s("Apply")})]}),A.jsxs("div",{className:"mb-5",children:[A.jsxs("p",{className:"font-medium mb-2",children:[s("Distance")," ",G.distance?`( ${G.distance} km )`:s("Any")]}),A.jsx("input",{type:"range",min:5,max:20,step:5,value:G.distance||20,onChange:be=>X({...G,distance:Number(be.target.value)}),className:"w-full accent-orange-500"})]}),A.jsxs("div",{className:"mb-5",children:[A.jsxs("p",{className:"font-medium mb-2 flex items-center gap-1",children:[s("Rating"),G.rating?A.jsxs("span",{className:"flex items-center gap-0.5",children:["( ",G.rating," ",A.jsx(Zo,{className:"text-yellow-400"})," )"]}):` ${s("Any")}`]}),A.jsx("input",{type:"range",min:1,max:5,step:1,value:G.rating||1,onChange:be=>X({...G,rating:Number(be.target.value)}),className:"w-full accent-orange-500"})]}),A.jsxs("div",{className:"mb-5 flex items-center justify-between",children:[A.jsx("p",{className:"font-medium mb-0",children:s("Open Only")}),A.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[A.jsx("input",{type:"checkbox",checked:G.openNow,onChange:()=>X({...G,openNow:!G.openNow}),className:"sr-only peer"}),A.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-orange-300 rounded-full peer peer-checked:bg-orange-500 transition-colors"}),A.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-md peer-checked:translate-x-5 transition-transform"})]})]}),A.jsxs("div",{className:"mb-2",children:[A.jsx("p",{className:"font-medium mb-2",children:s("Tags")}),A.jsx("div",{className:"flex flex-wrap gap-2",children:OB.map(be=>A.jsx("button",{onClick:()=>xe(be),className:`px-3 py-1 rounded-full text-xs border ${G.tags.includes(be)?"bg-orange-500 text-white border-orange-500":"bg-white text-gray-700 border-gray-300"}`,children:s(be)},be))})]})]})})]})},FB=()=>{const[s,a]=pe.useState(""),[l,u]=pe.useState(s),[f,y]=pe.useState([]),[w,i]=pe.useState(!1),[C,P]=pe.useState({sortBy:"Relevance",selectedEntities:["All"]}),D=pe.useRef(null),$=pe.useRef(null),G="/v1",X=Ma(),te=()=>{zP({showProgress:!0,allowClose:!0,overlayOpacity:.5,steps:[{element:"#search-input",popover:{title:"Search Input",description:"Type here to search for markets, vendors, or visitors.",side:"bottom",align:"start"}},{element:"#filter-button",popover:{title:"Filters",description:"Click here to filter your search results.",side:"top",align:"start"}}],onDestroyed:()=>{localStorage.setItem("search_tour_seen","true")}}).drive()};pe.useEffect(()=>{localStorage.getItem("search_tour_seen")||te()},[]),pe.useEffect(()=>{const fe=setTimeout(()=>D.current?.focus(),50);return()=>clearTimeout(fe)},[]),pe.useEffect(()=>{const fe=setTimeout(()=>u(s),500);return()=>clearTimeout(fe)},[s]),pe.useEffect(()=>{if(!l){y([]),i(!1);return}(async()=>{try{const be=await(await fetch(`${G}/user?search=${l}`)).json();y(be||[]),i(!0)}catch(xe){console.error(xe)}})()},[l,G]),pe.useEffect(()=>{const fe=xe=>{$.current&&!$.current.contains(xe.target)&&i(!1)};return document.addEventListener("mousedown",fe),()=>document.removeEventListener("mousedown",fe)},[]);const le=fe=>{if(a(fe.name),i(!1),!(!fe?.id||!fe?.type))switch(fe.type){case"market":X(`/market/${fe.id}`);break;case"vendor":X(`/vendor/${fe.id}`);break;case"visitor":X(`/visitor/${fe.id}`);break;case"organizer":X(`/organizer/${fe.id}`);break;default:console.warn("Unknown type:",fe.type)}},re=f.filter(fe=>C.selectedEntities.includes("All")?!0:C.selectedEntities.map(xe=>xe.toLowerCase()).includes(fe.type));return A.jsx("div",{className:"px-4 py-4 relative",ref:$,children:A.jsxs("div",{className:"flex gap-2 items-start relative",children:[A.jsxs("div",{className:"flex-1 relative",children:[A.jsxs("div",{id:"search-input",className:"flex items-center bg-[var(--white)] border border-[var(--black)] rounded-xl shadow-md px-4 py-4 gap-2",children:[A.jsx(xy,{className:"text-[var(--gray)]"}),A.jsx("input",{ref:D,value:s,onChange:fe=>a(fe.target.value),placeholder:"Search by market or visitor",className:"flex-1 bg-transparent outline-none text-[var(--gray)]"})]}),w&&A.jsx("div",{className:"fixed z-10 mt-4 left-0 right-0 max-h-64 overflow-y-auto px-4",children:re.length>0?re.map((fe,xe)=>A.jsxs("div",{onClick:()=>le(fe),className:"py-2 cursor-pointer flex items-center gap-2",children:[A.jsx("img",{src:fe.image===""?"/profile.png":fe.image,alt:fe.name,className:"w-8 h-8 rounded-full object-cover"}),A.jsx("span",{className:"text-[var(--black)]",children:fe.name})]},fe.id)):A.jsx("div",{className:"py-2 text-[var(--gray)]",children:"No results found."})})]}),A.jsx(BB,{filters:C,setFilters:P})]})})},BB=({filters:s,setFilters:a})=>{const[l,u]=pe.useState(!1),f=["Relevance","Newest","Oldest","Popular"],y=["Visitor","Vendor","Organizer","Market"],[w,i]=pe.useState(s.sortBy),[C,P]=pe.useState(s.selectedEntities);pe.useEffect(()=>{a({sortBy:w,selectedEntities:C})},[w,C,a]);const D=$=>{if($==="All")return P(["All"]);let G=C.includes("All")?[]:[...C];G=G.includes($)?G.filter(X=>X!==$):[...G,$],G.length===0&&(G=["All"]),P(G)};return A.jsxs(A.Fragment,{children:[A.jsx("button",{id:"filter-button",onClick:()=>u(!l),className:"w-14 h-14 bg-[var(--orange)] rounded-xl shadow-md flex items-center justify-center",children:A.jsx(MO,{className:"text-[var(--white)]"})}),l&&A.jsx("div",{className:"fixed inset-0 bg-[var(--black)]/40 z-40",onClick:()=>u(!1)}),A.jsxs("div",{className:`
          fixed bg-[var(--white)] rounded-t-2xl p-6 shadow-xl transition-all duration-300 z-70
          w-full lg:w-96
          ${l?"bottom-0 left-0 rounded-t-2xl lg:rounded-r-2xl lg:rounded-t-none":"-bottom-[60%] lg:-left-96"}
          lg:top-0
          lg:h-full
          lg:rounded-t-none
        `,children:[A.jsxs("div",{className:"flex justify-between items-center mb-4",children:[A.jsx("button",{onClick:()=>{i("Relevance"),P(["All"])},className:"text-sm text-[var(--gray)]",children:"Reset"}),A.jsx("h3",{className:"text-lg font-semibold",children:"Filter"}),A.jsx("button",{onClick:()=>u(!1),className:"text-sm text-[var(--orange)]",children:"Apply"})]}),A.jsx("p",{className:"font-medium mb-2",children:"Sort By"}),A.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:f.map($=>A.jsx("button",{onClick:()=>i($),className:`px-3 py-1 rounded-full border border-[var(--black)] ${w===$?"bg-[var(--orange)] text-[var(--white)]":""}`,children:$},$))}),A.jsx("p",{className:"font-medium mb-2",children:"Search Target"}),A.jsxs("div",{className:"flex flex-wrap gap-2",children:[A.jsx("button",{onClick:()=>D("All"),className:`px-3 py-1 rounded-full border ${C.includes("All")?"bg-[var(--orange)] text-[var(--white)]":""}`,children:"All"}),y.map($=>A.jsx("button",{onClick:()=>D($),className:`px-3 py-1 rounded-full border ${C.includes($)?"bg-[var(--orange)] text-[var(--white)]":""}`,children:$},$))]})]})]})},UB=({schedules:s=[],isOpen:a,onToggle:l})=>{const u=new Date,f=u.getDay()===0?7:u.getDay(),y=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],w=$=>{if(!$)return"";const[G,X]=$.split(":").map(Number),te=new Date;return te.setHours(G,X,0,0),te.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})},i=$=>{if(!$)return!1;const G=u.getHours()*60+u.getMinutes(),X=$.open_time.split(":").map(Number),te=$.close_time.split(":").map(Number);let le=X[0]*60+X[1],re=te[0]*60+te[1];return re<=le&&(re+=1440),G>=le&&G<re},C=s.find($=>$.weekly_day===f),P=C?i(C)?`Open until ${w(C.close_time)}`:"Closed":"Closed today",D=C&&i(C)?"var(--green)":"var(--red)";return A.jsxs("div",{className:"w-full overflow-hidden font-inter mt-2 border-b border-gray-200",children:[A.jsxs("button",{onClick:l,className:"w-full flex justify-between items-center px-4 py-3 text-sm font-medium transition-colors",style:{color:D},children:[A.jsxs("span",{className:"flex items-center gap-2",children:[A.jsx(ZM,{className:"w-4 h-4",style:{color:D}}),P]}),a?A.jsx(WM,{className:"w-4 h-4 text-[var(--gray)]"}):A.jsx(qM,{className:"w-4 h-4 text-[var(--gray)]"})]}),a&&A.jsxs("div",{className:"px-4 py-2 text-sm text-[var(--black)] space-y-1",children:[y.map(($,G)=>{const X=G+1,te=s.find(xe=>xe.weekly_day===X),le=X===f;let re="var(--black)";le&&(re=te?"var(--green)":"var(--red)");const fe=te?`${w(te.open_time)} - ${w(te.close_time)}`:"Closed";return A.jsxs("p",{className:`flex justify-between ${le?"font-semibold":""}`,style:{color:re},children:[A.jsx("span",{className:"capitalize",children:$}),A.jsx("span",{children:fe})]},$)}),s.filter($=>$.once_date).map($=>A.jsxs("p",{className:"flex justify-between font-medium text-[var(--blue)]",children:[A.jsxs("span",{children:["Special: ",new Date($.once_date).toLocaleDateString()]}),A.jsxs("span",{children:[w($.open_time)," - ",w($.close_time)]})]},$.id))]})]})};var Zv={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var $B=Zv.exports,kA;function VB(){return kA||(kA=1,(function(s,a){(function(l,u){u(a)})($B,(function(l){var u="1.9.4";function f(b){var I,V,ie,ge;for(V=1,ie=arguments.length;V<ie;V++){ge=arguments[V];for(I in ge)b[I]=ge[I]}return b}var y=Object.create||(function(){function b(){}return function(I){return b.prototype=I,new b}})();function w(b,I){var V=Array.prototype.slice;if(b.bind)return b.bind.apply(b,V.call(arguments,1));var ie=V.call(arguments,2);return function(){return b.apply(I,ie.length?ie.concat(V.call(arguments)):arguments)}}var i=0;function C(b){return"_leaflet_id"in b||(b._leaflet_id=++i),b._leaflet_id}function P(b,I,V){var ie,ge,ze,dt;return dt=function(){ie=!1,ge&&(ze.apply(V,ge),ge=!1)},ze=function(){ie?ge=arguments:(b.apply(V,arguments),setTimeout(dt,I),ie=!0)},ze}function D(b,I,V){var ie=I[1],ge=I[0],ze=ie-ge;return b===ie&&V?b:((b-ge)%ze+ze)%ze+ge}function $(){return!1}function G(b,I){if(I===!1)return b;var V=Math.pow(10,I===void 0?6:I);return Math.round(b*V)/V}function X(b){return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")}function te(b){return X(b).split(/\s+/)}function le(b,I){Object.prototype.hasOwnProperty.call(b,"options")||(b.options=b.options?y(b.options):{});for(var V in I)b.options[V]=I[V];return b.options}function re(b,I,V){var ie=[];for(var ge in b)ie.push(encodeURIComponent(V?ge.toUpperCase():ge)+"="+encodeURIComponent(b[ge]));return(!I||I.indexOf("?")===-1?"?":"&")+ie.join("&")}var fe=/\{ *([\w_ -]+) *\}/g;function xe(b,I){return b.replace(fe,function(V,ie){var ge=I[ie];if(ge===void 0)throw new Error("No value provided for variable "+V);return typeof ge=="function"&&(ge=ge(I)),ge})}var be=Array.isArray||function(b){return Object.prototype.toString.call(b)==="[object Array]"};function Ne(b,I){for(var V=0;V<b.length;V++)if(b[V]===I)return V;return-1}var Be="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Ee(b){return window["webkit"+b]||window["moz"+b]||window["ms"+b]}var et=0;function at(b){var I=+new Date,V=Math.max(0,16-(I-et));return et=I+V,window.setTimeout(b,V)}var He=window.requestAnimationFrame||Ee("RequestAnimationFrame")||at,lt=window.cancelAnimationFrame||Ee("CancelAnimationFrame")||Ee("CancelRequestAnimationFrame")||function(b){window.clearTimeout(b)};function pt(b,I,V){if(V&&He===at)b.call(I);else return He.call(window,w(b,I))}function Zt(b){b&&lt.call(window,b)}var jt={__proto__:null,extend:f,create:y,bind:w,get lastId(){return i},stamp:C,throttle:P,wrapNum:D,falseFn:$,formatNum:G,trim:X,splitWords:te,setOptions:le,getParamString:re,template:xe,isArray:be,indexOf:Ne,emptyImageUrl:Be,requestFn:He,cancelFn:lt,requestAnimFrame:pt,cancelAnimFrame:Zt};function Di(){}Di.extend=function(b){var I=function(){le(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},V=I.__super__=this.prototype,ie=y(V);ie.constructor=I,I.prototype=ie;for(var ge in this)Object.prototype.hasOwnProperty.call(this,ge)&&ge!=="prototype"&&ge!=="__super__"&&(I[ge]=this[ge]);return b.statics&&f(I,b.statics),b.includes&&(Pi(b.includes),f.apply(null,[ie].concat(b.includes))),f(ie,b),delete ie.statics,delete ie.includes,ie.options&&(ie.options=V.options?y(V.options):{},f(ie.options,b.options)),ie._initHooks=[],ie.callInitHooks=function(){if(!this._initHooksCalled){V.callInitHooks&&V.callInitHooks.call(this),this._initHooksCalled=!0;for(var ze=0,dt=ie._initHooks.length;ze<dt;ze++)ie._initHooks[ze].call(this)}},I},Di.include=function(b){var I=this.prototype.options;return f(this.prototype,b),b.options&&(this.prototype.options=I,this.mergeOptions(b.options)),this},Di.mergeOptions=function(b){return f(this.prototype.options,b),this},Di.addInitHook=function(b){var I=Array.prototype.slice.call(arguments,1),V=typeof b=="function"?b:function(){this[b].apply(this,I)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(V),this};function Pi(b){if(!(typeof L>"u"||!L||!L.Mixin)){b=be(b)?b:[b];for(var I=0;I<b.length;I++)b[I]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var qe={on:function(b,I,V){if(typeof b=="object")for(var ie in b)this._on(ie,b[ie],I);else{b=te(b);for(var ge=0,ze=b.length;ge<ze;ge++)this._on(b[ge],I,V)}return this},off:function(b,I,V){if(!arguments.length)delete this._events;else if(typeof b=="object")for(var ie in b)this._off(ie,b[ie],I);else{b=te(b);for(var ge=arguments.length===1,ze=0,dt=b.length;ze<dt;ze++)ge?this._off(b[ze]):this._off(b[ze],I,V)}return this},_on:function(b,I,V,ie){if(typeof I!="function"){console.warn("wrong listener type: "+typeof I);return}if(this._listens(b,I,V)===!1){V===this&&(V=void 0);var ge={fn:I,ctx:V};ie&&(ge.once=!0),this._events=this._events||{},this._events[b]=this._events[b]||[],this._events[b].push(ge)}},_off:function(b,I,V){var ie,ge,ze;if(this._events&&(ie=this._events[b],!!ie)){if(arguments.length===1){if(this._firingCount)for(ge=0,ze=ie.length;ge<ze;ge++)ie[ge].fn=$;delete this._events[b];return}if(typeof I!="function"){console.warn("wrong listener type: "+typeof I);return}var dt=this._listens(b,I,V);if(dt!==!1){var Bt=ie[dt];this._firingCount&&(Bt.fn=$,this._events[b]=ie=ie.slice()),ie.splice(dt,1)}}},fire:function(b,I,V){if(!this.listens(b,V))return this;var ie=f({},I,{type:b,target:this,sourceTarget:I&&I.sourceTarget||this});if(this._events){var ge=this._events[b];if(ge){this._firingCount=this._firingCount+1||1;for(var ze=0,dt=ge.length;ze<dt;ze++){var Bt=ge[ze],Lt=Bt.fn;Bt.once&&this.off(b,Lt,Bt.ctx),Lt.call(Bt.ctx||this,ie)}this._firingCount--}}return V&&this._propagateEvent(ie),this},listens:function(b,I,V,ie){typeof b!="string"&&console.warn('"string" type argument expected');var ge=I;typeof I!="function"&&(ie=!!I,ge=void 0,V=void 0);var ze=this._events&&this._events[b];if(ze&&ze.length&&this._listens(b,ge,V)!==!1)return!0;if(ie){for(var dt in this._eventParents)if(this._eventParents[dt].listens(b,I,V,ie))return!0}return!1},_listens:function(b,I,V){if(!this._events)return!1;var ie=this._events[b]||[];if(!I)return!!ie.length;V===this&&(V=void 0);for(var ge=0,ze=ie.length;ge<ze;ge++)if(ie[ge].fn===I&&ie[ge].ctx===V)return ge;return!1},once:function(b,I,V){if(typeof b=="object")for(var ie in b)this._on(ie,b[ie],I,!0);else{b=te(b);for(var ge=0,ze=b.length;ge<ze;ge++)this._on(b[ge],I,V,!0)}return this},addEventParent:function(b){return this._eventParents=this._eventParents||{},this._eventParents[C(b)]=b,this},removeEventParent:function(b){return this._eventParents&&delete this._eventParents[C(b)],this},_propagateEvent:function(b){for(var I in this._eventParents)this._eventParents[I].fire(b.type,f({layer:b.target,propagatedFrom:b.target},b),!0)}};qe.addEventListener=qe.on,qe.removeEventListener=qe.clearAllEventListeners=qe.off,qe.addOneTimeEventListener=qe.once,qe.fireEvent=qe.fire,qe.hasEventListeners=qe.listens;var wt=Di.extend(qe);function Ct(b,I,V){this.x=V?Math.round(b):b,this.y=V?Math.round(I):I}var Vi=Math.trunc||function(b){return b>0?Math.floor(b):Math.ceil(b)};Ct.prototype={clone:function(){return new Ct(this.x,this.y)},add:function(b){return this.clone()._add(Qe(b))},_add:function(b){return this.x+=b.x,this.y+=b.y,this},subtract:function(b){return this.clone()._subtract(Qe(b))},_subtract:function(b){return this.x-=b.x,this.y-=b.y,this},divideBy:function(b){return this.clone()._divideBy(b)},_divideBy:function(b){return this.x/=b,this.y/=b,this},multiplyBy:function(b){return this.clone()._multiplyBy(b)},_multiplyBy:function(b){return this.x*=b,this.y*=b,this},scaleBy:function(b){return new Ct(this.x*b.x,this.y*b.y)},unscaleBy:function(b){return new Ct(this.x/b.x,this.y/b.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Vi(this.x),this.y=Vi(this.y),this},distanceTo:function(b){b=Qe(b);var I=b.x-this.x,V=b.y-this.y;return Math.sqrt(I*I+V*V)},equals:function(b){return b=Qe(b),b.x===this.x&&b.y===this.y},contains:function(b){return b=Qe(b),Math.abs(b.x)<=Math.abs(this.x)&&Math.abs(b.y)<=Math.abs(this.y)},toString:function(){return"Point("+G(this.x)+", "+G(this.y)+")"}};function Qe(b,I,V){return b instanceof Ct?b:be(b)?new Ct(b[0],b[1]):b==null?b:typeof b=="object"&&"x"in b&&"y"in b?new Ct(b.x,b.y):new Ct(b,I,V)}function St(b,I){if(b)for(var V=I?[b,I]:b,ie=0,ge=V.length;ie<ge;ie++)this.extend(V[ie])}St.prototype={extend:function(b){var I,V;if(!b)return this;if(b instanceof Ct||typeof b[0]=="number"||"x"in b)I=V=Qe(b);else if(b=Ht(b),I=b.min,V=b.max,!I||!V)return this;return!this.min&&!this.max?(this.min=I.clone(),this.max=V.clone()):(this.min.x=Math.min(I.x,this.min.x),this.max.x=Math.max(V.x,this.max.x),this.min.y=Math.min(I.y,this.min.y),this.max.y=Math.max(V.y,this.max.y)),this},getCenter:function(b){return Qe((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,b)},getBottomLeft:function(){return Qe(this.min.x,this.max.y)},getTopRight:function(){return Qe(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(b){var I,V;return typeof b[0]=="number"||b instanceof Ct?b=Qe(b):b=Ht(b),b instanceof St?(I=b.min,V=b.max):I=V=b,I.x>=this.min.x&&V.x<=this.max.x&&I.y>=this.min.y&&V.y<=this.max.y},intersects:function(b){b=Ht(b);var I=this.min,V=this.max,ie=b.min,ge=b.max,ze=ge.x>=I.x&&ie.x<=V.x,dt=ge.y>=I.y&&ie.y<=V.y;return ze&&dt},overlaps:function(b){b=Ht(b);var I=this.min,V=this.max,ie=b.min,ge=b.max,ze=ge.x>I.x&&ie.x<V.x,dt=ge.y>I.y&&ie.y<V.y;return ze&&dt},isValid:function(){return!!(this.min&&this.max)},pad:function(b){var I=this.min,V=this.max,ie=Math.abs(I.x-V.x)*b,ge=Math.abs(I.y-V.y)*b;return Ht(Qe(I.x-ie,I.y-ge),Qe(V.x+ie,V.y+ge))},equals:function(b){return b?(b=Ht(b),this.min.equals(b.getTopLeft())&&this.max.equals(b.getBottomRight())):!1}};function Ht(b,I){return!b||b instanceof St?b:new St(b,I)}function Ft(b,I){if(b)for(var V=I?[b,I]:b,ie=0,ge=V.length;ie<ge;ie++)this.extend(V[ie])}Ft.prototype={extend:function(b){var I=this._southWest,V=this._northEast,ie,ge;if(b instanceof At)ie=b,ge=b;else if(b instanceof Ft){if(ie=b._southWest,ge=b._northEast,!ie||!ge)return this}else return b?this.extend(Xt(b)||_i(b)):this;return!I&&!V?(this._southWest=new At(ie.lat,ie.lng),this._northEast=new At(ge.lat,ge.lng)):(I.lat=Math.min(ie.lat,I.lat),I.lng=Math.min(ie.lng,I.lng),V.lat=Math.max(ge.lat,V.lat),V.lng=Math.max(ge.lng,V.lng)),this},pad:function(b){var I=this._southWest,V=this._northEast,ie=Math.abs(I.lat-V.lat)*b,ge=Math.abs(I.lng-V.lng)*b;return new Ft(new At(I.lat-ie,I.lng-ge),new At(V.lat+ie,V.lng+ge))},getCenter:function(){return new At((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new At(this.getNorth(),this.getWest())},getSouthEast:function(){return new At(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(b){typeof b[0]=="number"||b instanceof At||"lat"in b?b=Xt(b):b=_i(b);var I=this._southWest,V=this._northEast,ie,ge;return b instanceof Ft?(ie=b.getSouthWest(),ge=b.getNorthEast()):ie=ge=b,ie.lat>=I.lat&&ge.lat<=V.lat&&ie.lng>=I.lng&&ge.lng<=V.lng},intersects:function(b){b=_i(b);var I=this._southWest,V=this._northEast,ie=b.getSouthWest(),ge=b.getNorthEast(),ze=ge.lat>=I.lat&&ie.lat<=V.lat,dt=ge.lng>=I.lng&&ie.lng<=V.lng;return ze&&dt},overlaps:function(b){b=_i(b);var I=this._southWest,V=this._northEast,ie=b.getSouthWest(),ge=b.getNorthEast(),ze=ge.lat>I.lat&&ie.lat<V.lat,dt=ge.lng>I.lng&&ie.lng<V.lng;return ze&&dt},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(b,I){return b?(b=_i(b),this._southWest.equals(b.getSouthWest(),I)&&this._northEast.equals(b.getNorthEast(),I)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function _i(b,I){return b instanceof Ft?b:new Ft(b,I)}function At(b,I,V){if(isNaN(b)||isNaN(I))throw new Error("Invalid LatLng object: ("+b+", "+I+")");this.lat=+b,this.lng=+I,V!==void 0&&(this.alt=+V)}At.prototype={equals:function(b,I){if(!b)return!1;b=Xt(b);var V=Math.max(Math.abs(this.lat-b.lat),Math.abs(this.lng-b.lng));return V<=(I===void 0?1e-9:I)},toString:function(b){return"LatLng("+G(this.lat,b)+", "+G(this.lng,b)+")"},distanceTo:function(b){return fn.distance(this,Xt(b))},wrap:function(){return fn.wrapLatLng(this)},toBounds:function(b){var I=180*b/40075017,V=I/Math.cos(Math.PI/180*this.lat);return _i([this.lat-I,this.lng-V],[this.lat+I,this.lng+V])},clone:function(){return new At(this.lat,this.lng,this.alt)}};function Xt(b,I,V){return b instanceof At?b:be(b)&&typeof b[0]!="object"?b.length===3?new At(b[0],b[1],b[2]):b.length===2?new At(b[0],b[1]):null:b==null?b:typeof b=="object"&&"lat"in b?new At(b.lat,"lng"in b?b.lng:b.lon,b.alt):I===void 0?null:new At(b,I,V)}var yn={latLngToPoint:function(b,I){var V=this.projection.project(b),ie=this.scale(I);return this.transformation._transform(V,ie)},pointToLatLng:function(b,I){var V=this.scale(I),ie=this.transformation.untransform(b,V);return this.projection.unproject(ie)},project:function(b){return this.projection.project(b)},unproject:function(b){return this.projection.unproject(b)},scale:function(b){return 256*Math.pow(2,b)},zoom:function(b){return Math.log(b/256)/Math.LN2},getProjectedBounds:function(b){if(this.infinite)return null;var I=this.projection.bounds,V=this.scale(b),ie=this.transformation.transform(I.min,V),ge=this.transformation.transform(I.max,V);return new St(ie,ge)},infinite:!1,wrapLatLng:function(b){var I=this.wrapLng?D(b.lng,this.wrapLng,!0):b.lng,V=this.wrapLat?D(b.lat,this.wrapLat,!0):b.lat,ie=b.alt;return new At(V,I,ie)},wrapLatLngBounds:function(b){var I=b.getCenter(),V=this.wrapLatLng(I),ie=I.lat-V.lat,ge=I.lng-V.lng;if(ie===0&&ge===0)return b;var ze=b.getSouthWest(),dt=b.getNorthEast(),Bt=new At(ze.lat-ie,ze.lng-ge),Lt=new At(dt.lat-ie,dt.lng-ge);return new Ft(Bt,Lt)}},fn=f({},yn,{wrapLng:[-180,180],R:6371e3,distance:function(b,I){var V=Math.PI/180,ie=b.lat*V,ge=I.lat*V,ze=Math.sin((I.lat-b.lat)*V/2),dt=Math.sin((I.lng-b.lng)*V/2),Bt=ze*ze+Math.cos(ie)*Math.cos(ge)*dt*dt,Lt=2*Math.atan2(Math.sqrt(Bt),Math.sqrt(1-Bt));return this.R*Lt}}),pn=6378137,sn={R:pn,MAX_LATITUDE:85.0511287798,project:function(b){var I=Math.PI/180,V=this.MAX_LATITUDE,ie=Math.max(Math.min(V,b.lat),-V),ge=Math.sin(ie*I);return new Ct(this.R*b.lng*I,this.R*Math.log((1+ge)/(1-ge))/2)},unproject:function(b){var I=180/Math.PI;return new At((2*Math.atan(Math.exp(b.y/this.R))-Math.PI/2)*I,b.x*I/this.R)},bounds:(function(){var b=pn*Math.PI;return new St([-b,-b],[b,b])})()};function Un(b,I,V,ie){if(be(b)){this._a=b[0],this._b=b[1],this._c=b[2],this._d=b[3];return}this._a=b,this._b=I,this._c=V,this._d=ie}Un.prototype={transform:function(b,I){return this._transform(b.clone(),I)},_transform:function(b,I){return I=I||1,b.x=I*(this._a*b.x+this._b),b.y=I*(this._c*b.y+this._d),b},untransform:function(b,I){return I=I||1,new Ct((b.x/I-this._b)/this._a,(b.y/I-this._d)/this._c)}};function Ui(b,I,V,ie){return new Un(b,I,V,ie)}var Ii=f({},fn,{code:"EPSG:3857",projection:sn,transformation:(function(){var b=.5/(Math.PI*sn.R);return Ui(b,.5,-b,.5)})()}),nn=f({},Ii,{code:"EPSG:900913"});function mn(b){return document.createElementNS("http://www.w3.org/2000/svg",b)}function cn(b,I){var V="",ie,ge,ze,dt,Bt,Lt;for(ie=0,ze=b.length;ie<ze;ie++){for(Bt=b[ie],ge=0,dt=Bt.length;ge<dt;ge++)Lt=Bt[ge],V+=(ge?"L":"M")+Lt.x+" "+Lt.y;V+=I?Ti.svg?"z":"x":""}return V||"M0 0"}var Tn=document.documentElement.style,Da="ActiveXObject"in window,Hc=Da&&!document.addEventListener,Xo="msLaunchUri"in navigator&&!("documentMode"in document),Hs=Wi("webkit"),ws=Wi("android"),Gs=Wi("android 2")||Wi("android 3"),Hr=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Yo=ws&&Wi("Google")&&Hr<537&&!("AudioNode"in window),Jr=!!window.opera,er=!Xo&&Wi("chrome"),ds=Wi("gecko")&&!Hs&&!Jr&&!Da,pr=!er&&Wi("safari"),dl=Wi("phantom"),Ql="OTransition"in Tn,qs=navigator.platform.indexOf("Win")===0,Ko=Da&&"transition"in Tn,vr="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Gs,Ir="MozPerspective"in Tn,ec=!window.L_DISABLE_3D&&(Ko||vr||Ir)&&!Ql&&!dl,Ss=typeof orientation<"u"||Wi("mobile"),po=Ss&&Hs,Jo=Ss&&vr,Ws=!window.PointerEvent&&window.MSPointerEvent,tc=!!(window.PointerEvent||Ws),go="ontouchstart"in window||!!window.TouchEvent,Za=!window.L_NO_TOUCH&&(go||tc),Ur=Ss&&Jr,ic=Ss&&ds,Ro=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,_o=(function(){var b=!1;try{var I=Object.defineProperty({},"passive",{get:function(){b=!0}});window.addEventListener("testPassiveEventSupport",$,I),window.removeEventListener("testPassiveEventSupport",$,I)}catch{}return b})(),ku=(function(){return!!document.createElement("canvas").getContext})(),Me=!!(document.createElementNS&&mn("svg").createSVGRect),Rt=!!Me&&(function(){var b=document.createElement("div");return b.innerHTML="<svg/>",(b.firstChild&&b.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),ii=!Me&&(function(){try{var b=document.createElement("div");b.innerHTML='<v:shape adj="1"/>';var I=b.firstChild;return I.style.behavior="url(#default#VML)",I&&typeof I.adj=="object"}catch{return!1}})(),Ai=navigator.platform.indexOf("Mac")===0,ui=navigator.platform.indexOf("Linux")===0;function Wi(b){return navigator.userAgent.toLowerCase().indexOf(b)>=0}var Ti={ie:Da,ielt9:Hc,edge:Xo,webkit:Hs,android:ws,android23:Gs,androidStock:Yo,opera:Jr,chrome:er,gecko:ds,safari:pr,phantom:dl,opera12:Ql,win:qs,ie3d:Ko,webkit3d:vr,gecko3d:Ir,any3d:ec,mobile:Ss,mobileWebkit:po,mobileWebkit3d:Jo,msPointer:Ws,pointer:tc,touch:Za,touchNative:go,mobileOpera:Ur,mobileGecko:ic,retina:Ro,passiveEvents:_o,canvas:ku,svg:Me,vml:ii,inlineSvg:Rt,mac:Ai,linux:ui},vn=Ti.msPointer?"MSPointerDown":"pointerdown",Mn=Ti.msPointer?"MSPointerMove":"pointermove",Xe=Ti.msPointer?"MSPointerUp":"pointerup",ne=Ti.msPointer?"MSPointerCancel":"pointercancel",ue={touchstart:vn,touchmove:Mn,touchend:Xe,touchcancel:ne},ke={touchstart:Fi,touchmove:ci,touchend:ci,touchcancel:ci},Fe={},Ue=!1;function Ze(b,I,V){return I==="touchstart"&&Tt(),ke[I]?(V=ke[I].bind(this,V),b.addEventListener(ue[I],V,!1),V):(console.warn("wrong event specified:",I),$)}function st(b,I,V){if(!ue[I]){console.warn("wrong event specified:",I);return}b.removeEventListener(ue[I],V,!1)}function Je(b){Fe[b.pointerId]=b}function ct(b){Fe[b.pointerId]&&(Fe[b.pointerId]=b)}function It(b){delete Fe[b.pointerId]}function Tt(){Ue||(document.addEventListener(vn,Je,!0),document.addEventListener(Mn,ct,!0),document.addEventListener(Xe,It,!0),document.addEventListener(ne,It,!0),Ue=!0)}function ci(b,I){if(I.pointerType!==(I.MSPOINTER_TYPE_MOUSE||"mouse")){I.touches=[];for(var V in Fe)I.touches.push(Fe[V]);I.changedTouches=[I],b(I)}}function Fi(b,I){I.MSPOINTER_TYPE_TOUCH&&I.pointerType===I.MSPOINTER_TYPE_TOUCH&&ls(I),ci(b,I)}function mi(b){var I={},V,ie;for(ie in b)V=b[ie],I[ie]=V&&V.bind?V.bind(b):V;return b=I,I.type="dblclick",I.detail=2,I.isTrusted=!1,I._simulated=!0,I}var tn=200;function rn(b,I){b.addEventListener("dblclick",I);var V=0,ie;function ge(ze){if(ze.detail!==1){ie=ze.detail;return}if(!(ze.pointerType==="mouse"||ze.sourceCapabilities&&!ze.sourceCapabilities.firesTouchEvents)){var dt=qn(ze);if(!(dt.some(function(Lt){return Lt instanceof HTMLLabelElement&&Lt.attributes.for})&&!dt.some(function(Lt){return Lt instanceof HTMLInputElement||Lt instanceof HTMLSelectElement}))){var Bt=Date.now();Bt-V<=tn?(ie++,ie===2&&I(mi(ze))):ie=1,V=Bt}}}return b.addEventListener("click",ge),{dblclick:I,simDblclick:ge}}function Xi(b,I){b.removeEventListener("dblclick",I.dblclick),b.removeEventListener("click",I.simDblclick)}var Hi=Qr(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Gn=Qr(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Oa=Gn==="webkitTransition"||Gn==="OTransition"?Gn+"End":"transitionend";function Ea(b){return typeof b=="string"?document.getElementById(b):b}function Jn(b,I){var V=b.style[I]||b.currentStyle&&b.currentStyle[I];if((!V||V==="auto")&&document.defaultView){var ie=document.defaultView.getComputedStyle(b,null);V=ie?ie[I]:null}return V==="auto"?null:V}function gn(b,I,V){var ie=document.createElement(b);return ie.className=I||"",V&&V.appendChild(ie),ie}function an(b){var I=b.parentNode;I&&I.removeChild(b)}function ia(b){for(;b.firstChild;)b.removeChild(b.firstChild)}function oa(b){var I=b.parentNode;I&&I.lastChild!==b&&I.appendChild(b)}function An(b){var I=b.parentNode;I&&I.firstChild!==b&&I.insertBefore(b,I.firstChild)}function Xa(b,I){if(b.classList!==void 0)return b.classList.contains(I);var V=ss(b);return V.length>0&&new RegExp("(^|\\s)"+I+"(\\s|$)").test(V)}function Dn(b,I){if(b.classList!==void 0)for(var V=te(I),ie=0,ge=V.length;ie<ge;ie++)b.classList.add(V[ie]);else if(!Xa(b,I)){var ze=ss(b);Zs(b,(ze?ze+" ":"")+I)}}function Aa(b,I){b.classList!==void 0?b.classList.remove(I):Zs(b,X((" "+ss(b)+" ").replace(" "+I+" "," ")))}function Zs(b,I){b.className.baseVal===void 0?b.className=I:b.className.baseVal=I}function ss(b){return b.correspondingElement&&(b=b.correspondingElement),b.className.baseVal===void 0?b.className:b.className.baseVal}function tr(b,I){"opacity"in b.style?b.style.opacity=I:"filter"in b.style&&Lo(b,I)}function Lo(b,I){var V=!1,ie="DXImageTransform.Microsoft.Alpha";try{V=b.filters.item(ie)}catch{if(I===1)return}I=Math.round(I*100),V?(V.Enabled=I!==100,V.Opacity=I):b.style.filter+=" progid:"+ie+"(opacity="+I+")"}function Qr(b){for(var I=document.documentElement.style,V=0;V<b.length;V++)if(b[V]in I)return b[V];return!1}function os(b,I,V){var ie=I||new Ct(0,0);b.style[Hi]=(Ti.ie3d?"translate("+ie.x+"px,"+ie.y+"px)":"translate3d("+ie.x+"px,"+ie.y+"px,0)")+(V?" scale("+V+")":"")}function Sa(b,I){b._leaflet_pos=I,Ti.any3d?os(b,I):(b.style.left=I.x+"px",b.style.top=I.y+"px")}function Io(b){return b._leaflet_pos||new Ct(0,0)}var yo,Gc,Eu;if("onselectstart"in document)yo=function(){la(window,"selectstart",ls)},Gc=function(){rr(window,"selectstart",ls)};else{var fc=Qr(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);yo=function(){if(fc){var b=document.documentElement.style;Eu=b[fc],b[fc]="none"}},Gc=function(){fc&&(document.documentElement.style[fc]=Eu,Eu=void 0)}}function mc(){la(window,"dragstart",ls)}function hl(){rr(window,"dragstart",ls)}var Ps,ao;function vo(b){for(;b.tabIndex===-1;)b=b.parentNode;b.style&&(Xs(),Ps=b,ao=b.style.outlineStyle,b.style.outlineStyle="none",la(window,"keydown",Xs))}function Xs(){Ps&&(Ps.style.outlineStyle=ao,Ps=void 0,ao=void 0,rr(window,"keydown",Xs))}function ro(b){do b=b.parentNode;while((!b.offsetWidth||!b.offsetHeight)&&b!==document.body);return b}function xo(b){var I=b.getBoundingClientRect();return{x:I.width/b.offsetWidth||1,y:I.height/b.offsetHeight||1,boundingClientRect:I}}var qc={__proto__:null,TRANSFORM:Hi,TRANSITION:Gn,TRANSITION_END:Oa,get:Ea,getStyle:Jn,create:gn,remove:an,empty:ia,toFront:oa,toBack:An,hasClass:Xa,addClass:Dn,removeClass:Aa,setClass:Zs,getClass:ss,setOpacity:tr,testProp:Qr,setTransform:os,setPosition:Sa,getPosition:Io,get disableTextSelection(){return yo},get enableTextSelection(){return Gc},disableImageDrag:mc,enableImageDrag:hl,preventOutline:vo,restoreOutline:Xs,getSizedParentNode:ro,getScale:xo};function la(b,I,V,ie){if(I&&typeof I=="object")for(var ge in I)hs(b,ge,I[ge],V);else{I=te(I);for(var ze=0,dt=I.length;ze<dt;ze++)hs(b,I[ze],V,ie)}return this}var Ys="_leaflet_events";function rr(b,I,V,ie){if(arguments.length===1)Dl(b),delete b[Ys];else if(I&&typeof I=="object")for(var ge in I)Qo(b,ge,I[ge],V);else if(I=te(I),arguments.length===2)Dl(b,function(Bt){return Ne(I,Bt)!==-1});else for(var ze=0,dt=I.length;ze<dt;ze++)Qo(b,I[ze],V,ie);return this}function Dl(b,I){for(var V in b[Ys]){var ie=V.split(/\d/)[0];(!I||I(ie))&&Qo(b,ie,null,null,V)}}var pc={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function hs(b,I,V,ie){var ge=I+C(V)+(ie?"_"+C(ie):"");if(b[Ys]&&b[Ys][ge])return this;var ze=function(Bt){return V.call(ie||b,Bt||window.event)},dt=ze;!Ti.touchNative&&Ti.pointer&&I.indexOf("touch")===0?ze=Ze(b,I,ze):Ti.touch&&I==="dblclick"?ze=rn(b,ze):"addEventListener"in b?I==="touchstart"||I==="touchmove"||I==="wheel"||I==="mousewheel"?b.addEventListener(pc[I]||I,ze,Ti.passiveEvents?{passive:!1}:!1):I==="mouseenter"||I==="mouseleave"?(ze=function(Bt){Bt=Bt||window.event,Wc(b,Bt)&&dt(Bt)},b.addEventListener(pc[I],ze,!1)):b.addEventListener(I,dt,!1):b.attachEvent("on"+I,ze),b[Ys]=b[Ys]||{},b[Ys][ge]=ze}function Qo(b,I,V,ie,ge){ge=ge||I+C(V)+(ie?"_"+C(ie):"");var ze=b[Ys]&&b[Ys][ge];if(!ze)return this;!Ti.touchNative&&Ti.pointer&&I.indexOf("touch")===0?st(b,I,ze):Ti.touch&&I==="dblclick"?Xi(b,ze):"removeEventListener"in b?b.removeEventListener(pc[I]||I,ze,!1):b.detachEvent("on"+I,ze),b[Ys][ge]=null}function bo(b){return b.stopPropagation?b.stopPropagation():b.originalEvent?b.originalEvent._stopped=!0:b.cancelBubble=!0,this}function zo(b){return hs(b,"wheel",bo),this}function Ku(b){return la(b,"mousedown touchstart dblclick contextmenu",bo),b._leaflet_disable_click=!0,this}function ls(b){return b.preventDefault?b.preventDefault():b.returnValue=!1,this}function Do(b){return ls(b),bo(b),this}function qn(b){if(b.composedPath)return b.composedPath();for(var I=[],V=b.target;V;)I.push(V),V=V.parentNode;return I}function js(b,I){if(!I)return new Ct(b.clientX,b.clientY);var V=xo(I),ie=V.boundingClientRect;return new Ct((b.clientX-ie.left)/V.x-I.clientLeft,(b.clientY-ie.top)/V.y-I.clientTop)}var gc=Ti.linux&&Ti.chrome?window.devicePixelRatio:Ti.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ju(b){return Ti.edge?b.wheelDeltaY/2:b.deltaY&&b.deltaMode===0?-b.deltaY/gc:b.deltaY&&b.deltaMode===1?-b.deltaY*20:b.deltaY&&b.deltaMode===2?-b.deltaY*60:b.deltaX||b.deltaZ?0:b.wheelDelta?(b.wheelDeltaY||b.wheelDelta)/2:b.detail&&Math.abs(b.detail)<32765?-b.detail*20:b.detail?b.detail/-32765*60:0}function Wc(b,I){var V=I.relatedTarget;if(!V)return!0;try{for(;V&&V!==b;)V=V.parentNode}catch{return!1}return V!==b}var Zc={__proto__:null,on:la,off:rr,stopPropagation:bo,disableScrollPropagation:zo,disableClickPropagation:Ku,preventDefault:ls,stop:Do,getPropagationPath:qn,getMousePosition:js,getWheelDelta:Ju,isExternalTarget:Wc,addListener:la,removeListener:rr},Xc=wt.extend({run:function(b,I,V,ie){this.stop(),this._el=b,this._inProgress=!0,this._duration=V||.25,this._easeOutPower=1/Math.max(ie||.5,.2),this._startPos=Io(b),this._offset=I.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=pt(this._animate,this),this._step()},_step:function(b){var I=+new Date-this._startTime,V=this._duration*1e3;I<V?this._runFrame(this._easeOut(I/V),b):(this._runFrame(1),this._complete())},_runFrame:function(b,I){var V=this._startPos.add(this._offset.multiplyBy(b));I&&V._round(),Sa(this._el,V),this.fire("step")},_complete:function(){Zt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(b){return 1-Math.pow(1-b,this._easeOutPower)}}),Pa=wt.extend({options:{crs:Ii,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(b,I){I=le(this,I),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(b),this._initLayout(),this._onResize=w(this._onResize,this),this._initEvents(),I.maxBounds&&this.setMaxBounds(I.maxBounds),I.zoom!==void 0&&(this._zoom=this._limitZoom(I.zoom)),I.center&&I.zoom!==void 0&&this.setView(Xt(I.center),I.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Gn&&Ti.any3d&&!Ti.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),la(this._proxy,Oa,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(b,I,V){if(I=I===void 0?this._zoom:this._limitZoom(I),b=this._limitCenter(Xt(b),I,this.options.maxBounds),V=V||{},this._stop(),this._loaded&&!V.reset&&V!==!0){V.animate!==void 0&&(V.zoom=f({animate:V.animate},V.zoom),V.pan=f({animate:V.animate,duration:V.duration},V.pan));var ie=this._zoom!==I?this._tryAnimatedZoom&&this._tryAnimatedZoom(b,I,V.zoom):this._tryAnimatedPan(b,V.pan);if(ie)return clearTimeout(this._sizeTimer),this}return this._resetView(b,I,V.pan&&V.pan.noMoveStart),this},setZoom:function(b,I){return this._loaded?this.setView(this.getCenter(),b,{zoom:I}):(this._zoom=b,this)},zoomIn:function(b,I){return b=b||(Ti.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+b,I)},zoomOut:function(b,I){return b=b||(Ti.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-b,I)},setZoomAround:function(b,I,V){var ie=this.getZoomScale(I),ge=this.getSize().divideBy(2),ze=b instanceof Ct?b:this.latLngToContainerPoint(b),dt=ze.subtract(ge).multiplyBy(1-1/ie),Bt=this.containerPointToLatLng(ge.add(dt));return this.setView(Bt,I,{zoom:V})},_getBoundsCenterZoom:function(b,I){I=I||{},b=b.getBounds?b.getBounds():_i(b);var V=Qe(I.paddingTopLeft||I.padding||[0,0]),ie=Qe(I.paddingBottomRight||I.padding||[0,0]),ge=this.getBoundsZoom(b,!1,V.add(ie));if(ge=typeof I.maxZoom=="number"?Math.min(I.maxZoom,ge):ge,ge===1/0)return{center:b.getCenter(),zoom:ge};var ze=ie.subtract(V).divideBy(2),dt=this.project(b.getSouthWest(),ge),Bt=this.project(b.getNorthEast(),ge),Lt=this.unproject(dt.add(Bt).divideBy(2).add(ze),ge);return{center:Lt,zoom:ge}},fitBounds:function(b,I){if(b=_i(b),!b.isValid())throw new Error("Bounds are not valid.");var V=this._getBoundsCenterZoom(b,I);return this.setView(V.center,V.zoom,I)},fitWorld:function(b){return this.fitBounds([[-90,-180],[90,180]],b)},panTo:function(b,I){return this.setView(b,this._zoom,{pan:I})},panBy:function(b,I){if(b=Qe(b).round(),I=I||{},!b.x&&!b.y)return this.fire("moveend");if(I.animate!==!0&&!this.getSize().contains(b))return this._resetView(this.unproject(this.project(this.getCenter()).add(b)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Xc,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),I.noMoveStart||this.fire("movestart"),I.animate!==!1){Dn(this._mapPane,"leaflet-pan-anim");var V=this._getMapPanePos().subtract(b).round();this._panAnim.run(this._mapPane,V,I.duration||.25,I.easeLinearity)}else this._rawPanBy(b),this.fire("move").fire("moveend");return this},flyTo:function(b,I,V){if(V=V||{},V.animate===!1||!Ti.any3d)return this.setView(b,I,V);this._stop();var ie=this.project(this.getCenter()),ge=this.project(b),ze=this.getSize(),dt=this._zoom;b=Xt(b),I=I===void 0?dt:I;var Bt=Math.max(ze.x,ze.y),Lt=Bt*this.getZoomScale(dt,I),Ri=ge.distanceTo(ie)||1,un=1.42,Sn=un*un;function Pn(Vr){var il=Vr?-1:1,nl=Vr?Lt:Bt,Tc=Lt*Lt-Bt*Bt+il*Sn*Sn*Ri*Ri,sc=2*nl*Sn*Ri,hd=Tc/sc,kc=Math.sqrt(hd*hd+1)-hd,fd=kc<1e-9?-18:Math.log(kc);return fd}function ca(Vr){return(Math.exp(Vr)-Math.exp(-Vr))/2}function gr(Vr){return(Math.exp(Vr)+Math.exp(-Vr))/2}function Cr(Vr){return ca(Vr)/gr(Vr)}var fs=Pn(0);function to(Vr){return Bt*(gr(fs)/gr(fs+un*Vr))}function Cf(Vr){return Bt*(gr(fs)*Cr(fs+un*Vr)-ca(fs))/Sn}function Rh(Vr){return 1-Math.pow(1-Vr,1.5)}var dd=Date.now(),Ul=(Pn(1)-fs)/un,qd=V.duration?1e3*V.duration:1e3*Ul*.8;function Sc(){var Vr=(Date.now()-dd)/qd,il=Rh(Vr)*Ul;Vr<=1?(this._flyToFrame=pt(Sc,this),this._move(this.unproject(ie.add(ge.subtract(ie).multiplyBy(Cf(il)/Ri)),dt),this.getScaleZoom(Bt/to(il),dt),{flyTo:!0})):this._move(b,I)._moveEnd(!0)}return this._moveStart(!0,V.noMoveStart),Sc.call(this),this},flyToBounds:function(b,I){var V=this._getBoundsCenterZoom(b,I);return this.flyTo(V.center,V.zoom,I)},setMaxBounds:function(b){return b=_i(b),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),b.isValid()?(this.options.maxBounds=b,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(b){var I=this.options.minZoom;return this.options.minZoom=b,this._loaded&&I!==b&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(b):this},setMaxZoom:function(b){var I=this.options.maxZoom;return this.options.maxZoom=b,this._loaded&&I!==b&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(b):this},panInsideBounds:function(b,I){this._enforcingBounds=!0;var V=this.getCenter(),ie=this._limitCenter(V,this._zoom,_i(b));return V.equals(ie)||this.panTo(ie,I),this._enforcingBounds=!1,this},panInside:function(b,I){I=I||{};var V=Qe(I.paddingTopLeft||I.padding||[0,0]),ie=Qe(I.paddingBottomRight||I.padding||[0,0]),ge=this.project(this.getCenter()),ze=this.project(b),dt=this.getPixelBounds(),Bt=Ht([dt.min.add(V),dt.max.subtract(ie)]),Lt=Bt.getSize();if(!Bt.contains(ze)){this._enforcingBounds=!0;var Ri=ze.subtract(Bt.getCenter()),un=Bt.extend(ze).getSize().subtract(Lt);ge.x+=Ri.x<0?-un.x:un.x,ge.y+=Ri.y<0?-un.y:un.y,this.panTo(this.unproject(ge),I),this._enforcingBounds=!1}return this},invalidateSize:function(b){if(!this._loaded)return this;b=f({animate:!1,pan:!0},b===!0?{animate:!0}:b);var I=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var V=this.getSize(),ie=I.divideBy(2).round(),ge=V.divideBy(2).round(),ze=ie.subtract(ge);return!ze.x&&!ze.y?this:(b.animate&&b.pan?this.panBy(ze):(b.pan&&this._rawPanBy(ze),this.fire("move"),b.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(w(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:I,newSize:V}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(b){if(b=this._locateOptions=f({timeout:1e4,watch:!1},b),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var I=w(this._handleGeolocationResponse,this),V=w(this._handleGeolocationError,this);return b.watch?this._locationWatchId=navigator.geolocation.watchPosition(I,V,b):navigator.geolocation.getCurrentPosition(I,V,b),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(b){if(this._container._leaflet_id){var I=b.code,V=b.message||(I===1?"permission denied":I===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:I,message:"Geolocation error: "+V+"."})}},_handleGeolocationResponse:function(b){if(this._container._leaflet_id){var I=b.coords.latitude,V=b.coords.longitude,ie=new At(I,V),ge=ie.toBounds(b.coords.accuracy*2),ze=this._locateOptions;if(ze.setView){var dt=this.getBoundsZoom(ge);this.setView(ie,ze.maxZoom?Math.min(dt,ze.maxZoom):dt)}var Bt={latlng:ie,bounds:ge,timestamp:b.timestamp};for(var Lt in b.coords)typeof b.coords[Lt]=="number"&&(Bt[Lt]=b.coords[Lt]);this.fire("locationfound",Bt)}},addHandler:function(b,I){if(!I)return this;var V=this[b]=new I(this);return this._handlers.push(V),this.options[b]&&V.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),an(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Zt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var b;for(b in this._layers)this._layers[b].remove();for(b in this._panes)an(this._panes[b]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(b,I){var V="leaflet-pane"+(b?" leaflet-"+b.replace("Pane","")+"-pane":""),ie=gn("div",V,I||this._mapPane);return b&&(this._panes[b]=ie),ie},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var b=this.getPixelBounds(),I=this.unproject(b.getBottomLeft()),V=this.unproject(b.getTopRight());return new Ft(I,V)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(b,I,V){b=_i(b),V=Qe(V||[0,0]);var ie=this.getZoom()||0,ge=this.getMinZoom(),ze=this.getMaxZoom(),dt=b.getNorthWest(),Bt=b.getSouthEast(),Lt=this.getSize().subtract(V),Ri=Ht(this.project(Bt,ie),this.project(dt,ie)).getSize(),un=Ti.any3d?this.options.zoomSnap:1,Sn=Lt.x/Ri.x,Pn=Lt.y/Ri.y,ca=I?Math.max(Sn,Pn):Math.min(Sn,Pn);return ie=this.getScaleZoom(ca,ie),un&&(ie=Math.round(ie/(un/100))*(un/100),ie=I?Math.ceil(ie/un)*un:Math.floor(ie/un)*un),Math.max(ge,Math.min(ze,ie))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Ct(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(b,I){var V=this._getTopLeftPoint(b,I);return new St(V,V.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(b){return this.options.crs.getProjectedBounds(b===void 0?this.getZoom():b)},getPane:function(b){return typeof b=="string"?this._panes[b]:b},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(b,I){var V=this.options.crs;return I=I===void 0?this._zoom:I,V.scale(b)/V.scale(I)},getScaleZoom:function(b,I){var V=this.options.crs;I=I===void 0?this._zoom:I;var ie=V.zoom(b*V.scale(I));return isNaN(ie)?1/0:ie},project:function(b,I){return I=I===void 0?this._zoom:I,this.options.crs.latLngToPoint(Xt(b),I)},unproject:function(b,I){return I=I===void 0?this._zoom:I,this.options.crs.pointToLatLng(Qe(b),I)},layerPointToLatLng:function(b){var I=Qe(b).add(this.getPixelOrigin());return this.unproject(I)},latLngToLayerPoint:function(b){var I=this.project(Xt(b))._round();return I._subtract(this.getPixelOrigin())},wrapLatLng:function(b){return this.options.crs.wrapLatLng(Xt(b))},wrapLatLngBounds:function(b){return this.options.crs.wrapLatLngBounds(_i(b))},distance:function(b,I){return this.options.crs.distance(Xt(b),Xt(I))},containerPointToLayerPoint:function(b){return Qe(b).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(b){return Qe(b).add(this._getMapPanePos())},containerPointToLatLng:function(b){var I=this.containerPointToLayerPoint(Qe(b));return this.layerPointToLatLng(I)},latLngToContainerPoint:function(b){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Xt(b)))},mouseEventToContainerPoint:function(b){return js(b,this._container)},mouseEventToLayerPoint:function(b){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(b))},mouseEventToLatLng:function(b){return this.layerPointToLatLng(this.mouseEventToLayerPoint(b))},_initContainer:function(b){var I=this._container=Ea(b);if(I){if(I._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");la(I,"scroll",this._onScroll,this),this._containerId=C(I)},_initLayout:function(){var b=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ti.any3d,Dn(b,"leaflet-container"+(Ti.touch?" leaflet-touch":"")+(Ti.retina?" leaflet-retina":"")+(Ti.ielt9?" leaflet-oldie":"")+(Ti.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var I=Jn(b,"position");I!=="absolute"&&I!=="relative"&&I!=="fixed"&&I!=="sticky"&&(b.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var b=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Sa(this._mapPane,new Ct(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Dn(b.markerPane,"leaflet-zoom-hide"),Dn(b.shadowPane,"leaflet-zoom-hide"))},_resetView:function(b,I,V){Sa(this._mapPane,new Ct(0,0));var ie=!this._loaded;this._loaded=!0,I=this._limitZoom(I),this.fire("viewprereset");var ge=this._zoom!==I;this._moveStart(ge,V)._move(b,I)._moveEnd(ge),this.fire("viewreset"),ie&&this.fire("load")},_moveStart:function(b,I){return b&&this.fire("zoomstart"),I||this.fire("movestart"),this},_move:function(b,I,V,ie){I===void 0&&(I=this._zoom);var ge=this._zoom!==I;return this._zoom=I,this._lastCenter=b,this._pixelOrigin=this._getNewPixelOrigin(b),ie?V&&V.pinch&&this.fire("zoom",V):((ge||V&&V.pinch)&&this.fire("zoom",V),this.fire("move",V)),this},_moveEnd:function(b){return b&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Zt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(b){Sa(this._mapPane,this._getMapPanePos().subtract(b))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(b){this._targets={},this._targets[C(this._container)]=this;var I=b?rr:la;I(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&I(window,"resize",this._onResize,this),Ti.any3d&&this.options.transform3DLimit&&(b?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Zt(this._resizeRequest),this._resizeRequest=pt(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var b=this._getMapPanePos();Math.max(Math.abs(b.x),Math.abs(b.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(b,I){for(var V=[],ie,ge=I==="mouseout"||I==="mouseover",ze=b.target||b.srcElement,dt=!1;ze;){if(ie=this._targets[C(ze)],ie&&(I==="click"||I==="preclick")&&this._draggableMoved(ie)){dt=!0;break}if(ie&&ie.listens(I,!0)&&(ge&&!Wc(ze,b)||(V.push(ie),ge))||ze===this._container)break;ze=ze.parentNode}return!V.length&&!dt&&!ge&&this.listens(I,!0)&&(V=[this]),V},_isClickDisabled:function(b){for(;b&&b!==this._container;){if(b._leaflet_disable_click)return!0;b=b.parentNode}},_handleDOMEvent:function(b){var I=b.target||b.srcElement;if(!(!this._loaded||I._leaflet_disable_events||b.type==="click"&&this._isClickDisabled(I))){var V=b.type;V==="mousedown"&&vo(I),this._fireDOMEvent(b,V)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(b,I,V){if(b.type==="click"){var ie=f({},b);ie.type="preclick",this._fireDOMEvent(ie,ie.type,V)}var ge=this._findEventTargets(b,I);if(V){for(var ze=[],dt=0;dt<V.length;dt++)V[dt].listens(I,!0)&&ze.push(V[dt]);ge=ze.concat(ge)}if(ge.length){I==="contextmenu"&&ls(b);var Bt=ge[0],Lt={originalEvent:b};if(b.type!=="keypress"&&b.type!=="keydown"&&b.type!=="keyup"){var Ri=Bt.getLatLng&&(!Bt._radius||Bt._radius<=10);Lt.containerPoint=Ri?this.latLngToContainerPoint(Bt.getLatLng()):this.mouseEventToContainerPoint(b),Lt.layerPoint=this.containerPointToLayerPoint(Lt.containerPoint),Lt.latlng=Ri?Bt.getLatLng():this.layerPointToLatLng(Lt.layerPoint)}for(dt=0;dt<ge.length;dt++)if(ge[dt].fire(I,Lt,!0),Lt.originalEvent._stopped||ge[dt].options.bubblingMouseEvents===!1&&Ne(this._mouseEvents,I)!==-1)return}},_draggableMoved:function(b){return b=b.dragging&&b.dragging.enabled()?b:this,b.dragging&&b.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var b=0,I=this._handlers.length;b<I;b++)this._handlers[b].disable()},whenReady:function(b,I){return this._loaded?b.call(I||this,{target:this}):this.on("load",b,I),this},_getMapPanePos:function(){return Io(this._mapPane)||new Ct(0,0)},_moved:function(){var b=this._getMapPanePos();return b&&!b.equals([0,0])},_getTopLeftPoint:function(b,I){var V=b&&I!==void 0?this._getNewPixelOrigin(b,I):this.getPixelOrigin();return V.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(b,I){var V=this.getSize()._divideBy(2);return this.project(b,I)._subtract(V)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(b,I,V){var ie=this._getNewPixelOrigin(V,I);return this.project(b,I)._subtract(ie)},_latLngBoundsToNewLayerBounds:function(b,I,V){var ie=this._getNewPixelOrigin(V,I);return Ht([this.project(b.getSouthWest(),I)._subtract(ie),this.project(b.getNorthWest(),I)._subtract(ie),this.project(b.getSouthEast(),I)._subtract(ie),this.project(b.getNorthEast(),I)._subtract(ie)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(b){return this.latLngToLayerPoint(b).subtract(this._getCenterLayerPoint())},_limitCenter:function(b,I,V){if(!V)return b;var ie=this.project(b,I),ge=this.getSize().divideBy(2),ze=new St(ie.subtract(ge),ie.add(ge)),dt=this._getBoundsOffset(ze,V,I);return Math.abs(dt.x)<=1&&Math.abs(dt.y)<=1?b:this.unproject(ie.add(dt),I)},_limitOffset:function(b,I){if(!I)return b;var V=this.getPixelBounds(),ie=new St(V.min.add(b),V.max.add(b));return b.add(this._getBoundsOffset(ie,I))},_getBoundsOffset:function(b,I,V){var ie=Ht(this.project(I.getNorthEast(),V),this.project(I.getSouthWest(),V)),ge=ie.min.subtract(b.min),ze=ie.max.subtract(b.max),dt=this._rebound(ge.x,-ze.x),Bt=this._rebound(ge.y,-ze.y);return new Ct(dt,Bt)},_rebound:function(b,I){return b+I>0?Math.round(b-I)/2:Math.max(0,Math.ceil(b))-Math.max(0,Math.floor(I))},_limitZoom:function(b){var I=this.getMinZoom(),V=this.getMaxZoom(),ie=Ti.any3d?this.options.zoomSnap:1;return ie&&(b=Math.round(b/ie)*ie),Math.max(I,Math.min(V,b))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Aa(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(b,I){var V=this._getCenterOffset(b)._trunc();return(I&&I.animate)!==!0&&!this.getSize().contains(V)?!1:(this.panBy(V,I),!0)},_createAnimProxy:function(){var b=this._proxy=gn("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(b),this.on("zoomanim",function(I){var V=Hi,ie=this._proxy.style[V];os(this._proxy,this.project(I.center,I.zoom),this.getZoomScale(I.zoom,1)),ie===this._proxy.style[V]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){an(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var b=this.getCenter(),I=this.getZoom();os(this._proxy,this.project(b,I),this.getZoomScale(I,1))},_catchTransitionEnd:function(b){this._animatingZoom&&b.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(b,I,V){if(this._animatingZoom)return!0;if(V=V||{},!this._zoomAnimated||V.animate===!1||this._nothingToAnimate()||Math.abs(I-this._zoom)>this.options.zoomAnimationThreshold)return!1;var ie=this.getZoomScale(I),ge=this._getCenterOffset(b)._divideBy(1-1/ie);return V.animate!==!0&&!this.getSize().contains(ge)?!1:(pt(function(){this._moveStart(!0,V.noMoveStart||!1)._animateZoom(b,I,!0)},this),!0)},_animateZoom:function(b,I,V,ie){this._mapPane&&(V&&(this._animatingZoom=!0,this._animateToCenter=b,this._animateToZoom=I,Dn(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:b,zoom:I,noUpdate:ie}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(w(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Aa(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Au(b,I){return new Pa(b,I)}var Ks=Di.extend({options:{position:"topright"},initialize:function(b){le(this,b)},getPosition:function(){return this.options.position},setPosition:function(b){var I=this._map;return I&&I.removeControl(this),this.options.position=b,I&&I.addControl(this),this},getContainer:function(){return this._container},addTo:function(b){this.remove(),this._map=b;var I=this._container=this.onAdd(b),V=this.getPosition(),ie=b._controlCorners[V];return Dn(I,"leaflet-control"),V.indexOf("bottom")!==-1?ie.insertBefore(I,ie.firstChild):ie.appendChild(I),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(an(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(b){this._map&&b&&b.screenX>0&&b.screenY>0&&this._map.getContainer().focus()}}),wo=function(b){return new Ks(b)};Pa.include({addControl:function(b){return b.addTo(this),this},removeControl:function(b){return b.remove(),this},_initControlPos:function(){var b=this._controlCorners={},I="leaflet-",V=this._controlContainer=gn("div",I+"control-container",this._container);function ie(ge,ze){var dt=I+ge+" "+I+ze;b[ge+ze]=gn("div",dt,V)}ie("top","left"),ie("top","right"),ie("bottom","left"),ie("bottom","right")},_clearControlPos:function(){for(var b in this._controlCorners)an(this._controlCorners[b]);an(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Qu=Ks.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(b,I,V,ie){return V<ie?-1:ie<V?1:0}},initialize:function(b,I,V){le(this,V),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var ie in b)this._addLayer(b[ie],ie);for(ie in I)this._addLayer(I[ie],ie,!0)},onAdd:function(b){this._initLayout(),this._update(),this._map=b,b.on("zoomend",this._checkDisabledLayers,this);for(var I=0;I<this._layers.length;I++)this._layers[I].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(b){return Ks.prototype.addTo.call(this,b),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var b=0;b<this._layers.length;b++)this._layers[b].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(b,I){return this._addLayer(b,I),this._map?this._update():this},addOverlay:function(b,I){return this._addLayer(b,I,!0),this._map?this._update():this},removeLayer:function(b){b.off("add remove",this._onLayerChange,this);var I=this._getLayer(C(b));return I&&this._layers.splice(this._layers.indexOf(I),1),this._map?this._update():this},expand:function(){Dn(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var b=this._map.getSize().y-(this._container.offsetTop+50);return b<this._section.clientHeight?(Dn(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=b+"px"):Aa(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Aa(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var b="leaflet-control-layers",I=this._container=gn("div",b),V=this.options.collapsed;I.setAttribute("aria-haspopup",!0),Ku(I),zo(I);var ie=this._section=gn("section",b+"-list");V&&(this._map.on("click",this.collapse,this),la(I,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var ge=this._layersLink=gn("a",b+"-toggle",I);ge.href="#",ge.title="Layers",ge.setAttribute("role","button"),la(ge,{keydown:function(ze){ze.keyCode===13&&this._expandSafely()},click:function(ze){ls(ze),this._expandSafely()}},this),V||this.expand(),this._baseLayersList=gn("div",b+"-base",ie),this._separator=gn("div",b+"-separator",ie),this._overlaysList=gn("div",b+"-overlays",ie),I.appendChild(ie)},_getLayer:function(b){for(var I=0;I<this._layers.length;I++)if(this._layers[I]&&C(this._layers[I].layer)===b)return this._layers[I]},_addLayer:function(b,I,V){this._map&&b.on("add remove",this._onLayerChange,this),this._layers.push({layer:b,name:I,overlay:V}),this.options.sortLayers&&this._layers.sort(w(function(ie,ge){return this.options.sortFunction(ie.layer,ge.layer,ie.name,ge.name)},this)),this.options.autoZIndex&&b.setZIndex&&(this._lastZIndex++,b.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ia(this._baseLayersList),ia(this._overlaysList),this._layerControlInputs=[];var b,I,V,ie,ge=0;for(V=0;V<this._layers.length;V++)ie=this._layers[V],this._addItem(ie),I=I||ie.overlay,b=b||!ie.overlay,ge+=ie.overlay?0:1;return this.options.hideSingleBase&&(b=b&&ge>1,this._baseLayersList.style.display=b?"":"none"),this._separator.style.display=I&&b?"":"none",this},_onLayerChange:function(b){this._handlingClick||this._update();var I=this._getLayer(C(b.target)),V=I.overlay?b.type==="add"?"overlayadd":"overlayremove":b.type==="add"?"baselayerchange":null;V&&this._map.fire(V,I)},_createRadioElement:function(b,I){var V='<input type="radio" class="leaflet-control-layers-selector" name="'+b+'"'+(I?' checked="checked"':"")+"/>",ie=document.createElement("div");return ie.innerHTML=V,ie.firstChild},_addItem:function(b){var I=document.createElement("label"),V=this._map.hasLayer(b.layer),ie;b.overlay?(ie=document.createElement("input"),ie.type="checkbox",ie.className="leaflet-control-layers-selector",ie.defaultChecked=V):ie=this._createRadioElement("leaflet-base-layers_"+C(this),V),this._layerControlInputs.push(ie),ie.layerId=C(b.layer),la(ie,"click",this._onInputClick,this);var ge=document.createElement("span");ge.innerHTML=" "+b.name;var ze=document.createElement("span");I.appendChild(ze),ze.appendChild(ie),ze.appendChild(ge);var dt=b.overlay?this._overlaysList:this._baseLayersList;return dt.appendChild(I),this._checkDisabledLayers(),I},_onInputClick:function(){if(!this._preventClick){var b=this._layerControlInputs,I,V,ie=[],ge=[];this._handlingClick=!0;for(var ze=b.length-1;ze>=0;ze--)I=b[ze],V=this._getLayer(I.layerId).layer,I.checked?ie.push(V):I.checked||ge.push(V);for(ze=0;ze<ge.length;ze++)this._map.hasLayer(ge[ze])&&this._map.removeLayer(ge[ze]);for(ze=0;ze<ie.length;ze++)this._map.hasLayer(ie[ze])||this._map.addLayer(ie[ze]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var b=this._layerControlInputs,I,V,ie=this._map.getZoom(),ge=b.length-1;ge>=0;ge--)I=b[ge],V=this._getLayer(I.layerId).layer,I.disabled=V.options.minZoom!==void 0&&ie<V.options.minZoom||V.options.maxZoom!==void 0&&ie>V.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var b=this._section;this._preventClick=!0,la(b,"click",ls),this.expand();var I=this;setTimeout(function(){rr(b,"click",ls),I._preventClick=!1})}}),Tf=function(b,I,V){return new Qu(b,I,V)},nc=Ks.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(b){var I="leaflet-control-zoom",V=gn("div",I+" leaflet-bar"),ie=this.options;return this._zoomInButton=this._createButton(ie.zoomInText,ie.zoomInTitle,I+"-in",V,this._zoomIn),this._zoomOutButton=this._createButton(ie.zoomOutText,ie.zoomOutTitle,I+"-out",V,this._zoomOut),this._updateDisabled(),b.on("zoomend zoomlevelschange",this._updateDisabled,this),V},onRemove:function(b){b.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(b){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(b.shiftKey?3:1))},_zoomOut:function(b){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(b.shiftKey?3:1))},_createButton:function(b,I,V,ie,ge){var ze=gn("a",V,ie);return ze.innerHTML=b,ze.href="#",ze.title=I,ze.setAttribute("role","button"),ze.setAttribute("aria-label",I),Ku(ze),la(ze,"click",Do),la(ze,"click",ge,this),la(ze,"click",this._refocusOnMap,this),ze},_updateDisabled:function(){var b=this._map,I="leaflet-disabled";Aa(this._zoomInButton,I),Aa(this._zoomOutButton,I),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||b._zoom===b.getMinZoom())&&(Dn(this._zoomOutButton,I),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||b._zoom===b.getMaxZoom())&&(Dn(this._zoomInButton,I),this._zoomInButton.setAttribute("aria-disabled","true"))}});Pa.mergeOptions({zoomControl:!0}),Pa.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new nc,this.addControl(this.zoomControl))});var _c=function(b){return new nc(b)},Rs=Ks.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(b){var I="leaflet-control-scale",V=gn("div",I),ie=this.options;return this._addScales(ie,I+"-line",V),b.on(ie.updateWhenIdle?"moveend":"move",this._update,this),b.whenReady(this._update,this),V},onRemove:function(b){b.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(b,I,V){b.metric&&(this._mScale=gn("div",I,V)),b.imperial&&(this._iScale=gn("div",I,V))},_update:function(){var b=this._map,I=b.getSize().y/2,V=b.distance(b.containerPointToLatLng([0,I]),b.containerPointToLatLng([this.options.maxWidth,I]));this._updateScales(V)},_updateScales:function(b){this.options.metric&&b&&this._updateMetric(b),this.options.imperial&&b&&this._updateImperial(b)},_updateMetric:function(b){var I=this._getRoundNum(b),V=I<1e3?I+" m":I/1e3+" km";this._updateScale(this._mScale,V,I/b)},_updateImperial:function(b){var I=b*3.2808399,V,ie,ge;I>5280?(V=I/5280,ie=this._getRoundNum(V),this._updateScale(this._iScale,ie+" mi",ie/V)):(ge=this._getRoundNum(I),this._updateScale(this._iScale,ge+" ft",ge/I))},_updateScale:function(b,I,V){b.style.width=Math.round(this.options.maxWidth*V)+"px",b.innerHTML=I},_getRoundNum:function(b){var I=Math.pow(10,(Math.floor(b)+"").length-1),V=b/I;return V=V>=10?10:V>=5?5:V>=3?3:V>=2?2:1,I*V}}),Ah=function(b){return new Rs(b)},Ud='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Oo=Ks.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ti.inlineSvg?Ud+" ":"")+"Leaflet</a>"},initialize:function(b){le(this,b),this._attributions={}},onAdd:function(b){b.attributionControl=this,this._container=gn("div","leaflet-control-attribution"),Ku(this._container);for(var I in b._layers)b._layers[I].getAttribution&&this.addAttribution(b._layers[I].getAttribution());return this._update(),b.on("layeradd",this._addAttribution,this),this._container},onRemove:function(b){b.off("layeradd",this._addAttribution,this)},_addAttribution:function(b){b.layer.getAttribution&&(this.addAttribution(b.layer.getAttribution()),b.layer.once("remove",function(){this.removeAttribution(b.layer.getAttribution())},this))},setPrefix:function(b){return this.options.prefix=b,this._update(),this},addAttribution:function(b){return b?(this._attributions[b]||(this._attributions[b]=0),this._attributions[b]++,this._update(),this):this},removeAttribution:function(b){return b?(this._attributions[b]&&(this._attributions[b]--,this._update()),this):this},_update:function(){if(this._map){var b=[];for(var I in this._attributions)this._attributions[I]&&b.push(I);var V=[];this.options.prefix&&V.push(this.options.prefix),b.length&&V.push(b.join(", ")),this._container.innerHTML=V.join(' <span aria-hidden="true">|</span> ')}}});Pa.mergeOptions({attributionControl:!0}),Pa.addInitHook(function(){this.options.attributionControl&&new Oo().addTo(this)});var ma=function(b){return new Oo(b)};Ks.Layers=Qu,Ks.Zoom=nc,Ks.Scale=Rs,Ks.Attribution=Oo,wo.layers=Tf,wo.zoom=_c,wo.scale=Ah,wo.attribution=ma;var fl=Di.extend({initialize:function(b){this._map=b},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});fl.addTo=function(b,I){return b.addHandler(I,this),this};var Pm={Events:qe},kf=Ti.touch?"touchstart mousedown":"mousedown",Gi=wt.extend({options:{clickTolerance:3},initialize:function(b,I,V,ie){le(this,ie),this._element=b,this._dragStartTarget=I||b,this._preventOutline=V},enable:function(){this._enabled||(la(this._dragStartTarget,kf,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Gi._dragging===this&&this.finishDrag(!0),rr(this._dragStartTarget,kf,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(b){if(this._enabled&&(this._moved=!1,!Xa(this._element,"leaflet-zoom-anim"))){if(b.touches&&b.touches.length!==1){Gi._dragging===this&&this.finishDrag();return}if(!(Gi._dragging||b.shiftKey||b.which!==1&&b.button!==1&&!b.touches)&&(Gi._dragging=this,this._preventOutline&&vo(this._element),mc(),yo(),!this._moving)){this.fire("down");var I=b.touches?b.touches[0]:b,V=ro(this._element);this._startPoint=new Ct(I.clientX,I.clientY),this._startPos=Io(this._element),this._parentScale=xo(V);var ie=b.type==="mousedown";la(document,ie?"mousemove":"touchmove",this._onMove,this),la(document,ie?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(b){if(this._enabled){if(b.touches&&b.touches.length>1){this._moved=!0;return}var I=b.touches&&b.touches.length===1?b.touches[0]:b,V=new Ct(I.clientX,I.clientY)._subtract(this._startPoint);!V.x&&!V.y||Math.abs(V.x)+Math.abs(V.y)<this.options.clickTolerance||(V.x/=this._parentScale.x,V.y/=this._parentScale.y,ls(b),this._moved||(this.fire("dragstart"),this._moved=!0,Dn(document.body,"leaflet-dragging"),this._lastTarget=b.target||b.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Dn(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(V),this._moving=!0,this._lastEvent=b,this._updatePosition())}},_updatePosition:function(){var b={originalEvent:this._lastEvent};this.fire("predrag",b),Sa(this._element,this._newPos),this.fire("drag",b)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(b){Aa(document.body,"leaflet-dragging"),this._lastTarget&&(Aa(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),rr(document,"mousemove touchmove",this._onMove,this),rr(document,"mouseup touchend touchcancel",this._onUp,this),hl(),Gc();var I=this._moved&&this._moving;this._moving=!1,Gi._dragging=!1,I&&this.fire("dragend",{noInertia:b,distance:this._newPos.distanceTo(this._startPos)})}});function Ch(b,I,V){var ie,ge=[1,4,2,8],ze,dt,Bt,Lt,Ri,un,Sn,Pn;for(ze=0,un=b.length;ze<un;ze++)b[ze]._code=Ol(b[ze],I);for(Bt=0;Bt<4;Bt++){for(Sn=ge[Bt],ie=[],ze=0,un=b.length,dt=un-1;ze<un;dt=ze++)Lt=b[ze],Ri=b[dt],Lt._code&Sn?Ri._code&Sn||(Pn=Kc(Ri,Lt,Sn,I,V),Pn._code=Ol(Pn,I),ie.push(Pn)):(Ri._code&Sn&&(Pn=Kc(Ri,Lt,Sn,I,V),Pn._code=Ol(Pn,I),ie.push(Pn)),ie.push(Lt));b=ie}return b}function Yc(b,I){var V,ie,ge,ze,dt,Bt,Lt,Ri,un;if(!b||b.length===0)throw new Error("latlngs not passed");so(b)||(console.warn("latlngs are not flat! Only the first ring will be used"),b=b[0]);var Sn=Xt([0,0]),Pn=_i(b),ca=Pn.getNorthWest().distanceTo(Pn.getSouthWest())*Pn.getNorthEast().distanceTo(Pn.getNorthWest());ca<1700&&(Sn=No(b));var gr=b.length,Cr=[];for(V=0;V<gr;V++){var fs=Xt(b[V]);Cr.push(I.project(Xt([fs.lat-Sn.lat,fs.lng-Sn.lng])))}for(Bt=Lt=Ri=0,V=0,ie=gr-1;V<gr;ie=V++)ge=Cr[V],ze=Cr[ie],dt=ge.y*ze.x-ze.y*ge.x,Lt+=(ge.x+ze.x)*dt,Ri+=(ge.y+ze.y)*dt,Bt+=dt*3;Bt===0?un=Cr[0]:un=[Lt/Bt,Ri/Bt];var to=I.unproject(Qe(un));return Xt([to.lat+Sn.lat,to.lng+Sn.lng])}function No(b){for(var I=0,V=0,ie=0,ge=0;ge<b.length;ge++){var ze=Xt(b[ge]);I+=ze.lat,V+=ze.lng,ie++}return Xt([I/ie,V/ie])}var ed={__proto__:null,clipPolygon:Ch,polygonCenter:Yc,centroid:No};function ml(b,I){if(!I||!b.length)return b.slice();var V=I*I;return b=ac(b,V),b=_a(b,V),b}function zi(b,I,V){return Math.sqrt(lr(b,I,V,!0))}function $n(b,I,V){return lr(b,I,V)}function _a(b,I){var V=b.length,ie=typeof Uint8Array<"u"?Uint8Array:Array,ge=new ie(V);ge[0]=ge[V-1]=1,Js(b,ge,I,0,V-1);var ze,dt=[];for(ze=0;ze<V;ze++)ge[ze]&&dt.push(b[ze]);return dt}function Js(b,I,V,ie,ge){var ze=0,dt,Bt,Lt;for(Bt=ie+1;Bt<=ge-1;Bt++)Lt=lr(b[Bt],b[ie],b[ge],!0),Lt>ze&&(dt=Bt,ze=Lt);ze>V&&(I[dt]=1,Js(b,I,V,ie,dt),Js(b,I,V,dt,ge))}function ac(b,I){for(var V=[b[0]],ie=1,ge=0,ze=b.length;ie<ze;ie++)Ls(b[ie],b[ge])>I&&(V.push(b[ie]),ge=ie);return ge<ze-1&&V.push(b[ze-1]),V}var ra;function $d(b,I,V,ie,ge){var ze=ie?ra:Ol(b,V),dt=Ol(I,V),Bt,Lt,Ri;for(ra=dt;;){if(!(ze|dt))return[b,I];if(ze&dt)return!1;Bt=ze||dt,Lt=Kc(b,I,Bt,V,ge),Ri=Ol(Lt,V),Bt===ze?(b=Lt,ze=Ri):(I=Lt,dt=Ri)}}function Kc(b,I,V,ie,ge){var ze=I.x-b.x,dt=I.y-b.y,Bt=ie.min,Lt=ie.max,Ri,un;return V&8?(Ri=b.x+ze*(Lt.y-b.y)/dt,un=Lt.y):V&4?(Ri=b.x+ze*(Bt.y-b.y)/dt,un=Bt.y):V&2?(Ri=Lt.x,un=b.y+dt*(Lt.x-b.x)/ze):V&1&&(Ri=Bt.x,un=b.y+dt*(Bt.x-b.x)/ze),new Ct(Ri,un,ge)}function Ol(b,I){var V=0;return b.x<I.min.x?V|=1:b.x>I.max.x&&(V|=2),b.y<I.min.y?V|=4:b.y>I.max.y&&(V|=8),V}function Ls(b,I){var V=I.x-b.x,ie=I.y-b.y;return V*V+ie*ie}function lr(b,I,V,ie){var ge=I.x,ze=I.y,dt=V.x-ge,Bt=V.y-ze,Lt=dt*dt+Bt*Bt,Ri;return Lt>0&&(Ri=((b.x-ge)*dt+(b.y-ze)*Bt)/Lt,Ri>1?(ge=V.x,ze=V.y):Ri>0&&(ge+=dt*Ri,ze+=Bt*Ri)),dt=b.x-ge,Bt=b.y-ze,ie?dt*dt+Bt*Bt:new Ct(ge,ze)}function so(b){return!be(b[0])||typeof b[0][0]!="object"&&typeof b[0][0]<"u"}function yc(b){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),so(b)}function Vd(b,I){var V,ie,ge,ze,dt,Bt,Lt,Ri;if(!b||b.length===0)throw new Error("latlngs not passed");so(b)||(console.warn("latlngs are not flat! Only the first ring will be used"),b=b[0]);var un=Xt([0,0]),Sn=_i(b),Pn=Sn.getNorthWest().distanceTo(Sn.getSouthWest())*Sn.getNorthEast().distanceTo(Sn.getNorthWest());Pn<1700&&(un=No(b));var ca=b.length,gr=[];for(V=0;V<ca;V++){var Cr=Xt(b[V]);gr.push(I.project(Xt([Cr.lat-un.lat,Cr.lng-un.lng])))}for(V=0,ie=0;V<ca-1;V++)ie+=gr[V].distanceTo(gr[V+1])/2;if(ie===0)Ri=gr[0];else for(V=0,ze=0;V<ca-1;V++)if(dt=gr[V],Bt=gr[V+1],ge=dt.distanceTo(Bt),ze+=ge,ze>ie){Lt=(ze-ie)/ge,Ri=[Bt.x-Lt*(Bt.x-dt.x),Bt.y-Lt*(Bt.y-dt.y)];break}var fs=I.unproject(Qe(Ri));return Xt([fs.lat+un.lat,fs.lng+un.lng])}var td={__proto__:null,simplify:ml,pointToSegmentDistance:zi,closestPointOnSegment:$n,clipSegment:$d,_getEdgeIntersection:Kc,_getBitCode:Ol,_sqClosestPointOnSegment:lr,isFlat:so,_flat:yc,polylineCenter:Vd},Cu={project:function(b){return new Ct(b.lng,b.lat)},unproject:function(b){return new At(b.y,b.x)},bounds:new St([-180,-90],[180,90])},id={R:6378137,R_MINOR:6356752314245179e-9,bounds:new St([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(b){var I=Math.PI/180,V=this.R,ie=b.lat*I,ge=this.R_MINOR/V,ze=Math.sqrt(1-ge*ge),dt=ze*Math.sin(ie),Bt=Math.tan(Math.PI/4-ie/2)/Math.pow((1-dt)/(1+dt),ze/2);return ie=-V*Math.log(Math.max(Bt,1e-10)),new Ct(b.lng*I*V,ie)},unproject:function(b){for(var I=180/Math.PI,V=this.R,ie=this.R_MINOR/V,ge=Math.sqrt(1-ie*ie),ze=Math.exp(-b.y/V),dt=Math.PI/2-2*Math.atan(ze),Bt=0,Lt=.1,Ri;Bt<15&&Math.abs(Lt)>1e-7;Bt++)Ri=ge*Math.sin(dt),Ri=Math.pow((1-Ri)/(1+Ri),ge/2),Lt=Math.PI/2-2*Math.atan(ze*Ri)-dt,dt+=Lt;return new At(dt*I,b.x*I/V)}},Hd={__proto__:null,LonLat:Cu,Mercator:id,SphericalMercator:sn},cs=f({},fn,{code:"EPSG:3395",projection:id,transformation:(function(){var b=.5/(Math.PI*id.R);return Ui(b,.5,-b,.5)})()}),rc=f({},fn,{code:"EPSG:4326",projection:Cu,transformation:Ui(1/180,1,-1/180,.5)}),oo=f({},yn,{projection:Cu,transformation:Ui(1,0,-1,0),scale:function(b){return Math.pow(2,b)},zoom:function(b){return Math.log(b)/Math.LN2},distance:function(b,I){var V=I.lng-b.lng,ie=I.lat-b.lat;return Math.sqrt(V*V+ie*ie)},infinite:!0});yn.Earth=fn,yn.EPSG3395=cs,yn.EPSG3857=Ii,yn.EPSG900913=nn,yn.EPSG4326=rc,yn.Simple=oo;var Qs=wt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(b){return b.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(b){return b&&b.removeLayer(this),this},getPane:function(b){return this._map.getPane(b?this.options[b]||b:this.options.pane)},addInteractiveTarget:function(b){return this._map._targets[C(b)]=this,this},removeInteractiveTarget:function(b){return delete this._map._targets[C(b)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(b){var I=b.target;if(I.hasLayer(this)){if(this._map=I,this._zoomAnimated=I._zoomAnimated,this.getEvents){var V=this.getEvents();I.on(V,this),this.once("remove",function(){I.off(V,this)},this)}this.onAdd(I),this.fire("add"),I.fire("layeradd",{layer:this})}}});Pa.include({addLayer:function(b){if(!b._layerAdd)throw new Error("The provided object is not a Layer.");var I=C(b);return this._layers[I]?this:(this._layers[I]=b,b._mapToAdd=this,b.beforeAdd&&b.beforeAdd(this),this.whenReady(b._layerAdd,b),this)},removeLayer:function(b){var I=C(b);return this._layers[I]?(this._loaded&&b.onRemove(this),delete this._layers[I],this._loaded&&(this.fire("layerremove",{layer:b}),b.fire("remove")),b._map=b._mapToAdd=null,this):this},hasLayer:function(b){return C(b)in this._layers},eachLayer:function(b,I){for(var V in this._layers)b.call(I,this._layers[V]);return this},_addLayers:function(b){b=b?be(b)?b:[b]:[];for(var I=0,V=b.length;I<V;I++)this.addLayer(b[I])},_addZoomLimit:function(b){(!isNaN(b.options.maxZoom)||!isNaN(b.options.minZoom))&&(this._zoomBoundLayers[C(b)]=b,this._updateZoomLevels())},_removeZoomLimit:function(b){var I=C(b);this._zoomBoundLayers[I]&&(delete this._zoomBoundLayers[I],this._updateZoomLevels())},_updateZoomLevels:function(){var b=1/0,I=-1/0,V=this._getZoomSpan();for(var ie in this._zoomBoundLayers){var ge=this._zoomBoundLayers[ie].options;b=ge.minZoom===void 0?b:Math.min(b,ge.minZoom),I=ge.maxZoom===void 0?I:Math.max(I,ge.maxZoom)}this._layersMaxZoom=I===-1/0?void 0:I,this._layersMinZoom=b===1/0?void 0:b,V!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var pl=Qs.extend({initialize:function(b,I){le(this,I),this._layers={};var V,ie;if(b)for(V=0,ie=b.length;V<ie;V++)this.addLayer(b[V])},addLayer:function(b){var I=this.getLayerId(b);return this._layers[I]=b,this._map&&this._map.addLayer(b),this},removeLayer:function(b){var I=b in this._layers?b:this.getLayerId(b);return this._map&&this._layers[I]&&this._map.removeLayer(this._layers[I]),delete this._layers[I],this},hasLayer:function(b){var I=typeof b=="number"?b:this.getLayerId(b);return I in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(b){var I=Array.prototype.slice.call(arguments,1),V,ie;for(V in this._layers)ie=this._layers[V],ie[b]&&ie[b].apply(ie,I);return this},onAdd:function(b){this.eachLayer(b.addLayer,b)},onRemove:function(b){this.eachLayer(b.removeLayer,b)},eachLayer:function(b,I){for(var V in this._layers)b.call(I,this._layers[V]);return this},getLayer:function(b){return this._layers[b]},getLayers:function(){var b=[];return this.eachLayer(b.push,b),b},setZIndex:function(b){return this.invoke("setZIndex",b)},getLayerId:function(b){return C(b)}}),Gr=function(b,I){return new pl(b,I)},$r=pl.extend({addLayer:function(b){return this.hasLayer(b)?this:(b.addEventParent(this),pl.prototype.addLayer.call(this,b),this.fire("layeradd",{layer:b}))},removeLayer:function(b){return this.hasLayer(b)?(b in this._layers&&(b=this._layers[b]),b.removeEventParent(this),pl.prototype.removeLayer.call(this,b),this.fire("layerremove",{layer:b})):this},setStyle:function(b){return this.invoke("setStyle",b)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var b=new Ft;for(var I in this._layers){var V=this._layers[I];b.extend(V.getBounds?V.getBounds():V.getLatLng())}return b}}),el=function(b,I){return new $r(b,I)},Sr=Di.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(b){le(this,b)},createIcon:function(b){return this._createIcon("icon",b)},createShadow:function(b){return this._createIcon("shadow",b)},_createIcon:function(b,I){var V=this._getIconUrl(b);if(!V){if(b==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var ie=this._createImg(V,I&&I.tagName==="IMG"?I:null);return this._setIconStyles(ie,b),(this.options.crossOrigin||this.options.crossOrigin==="")&&(ie.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),ie},_setIconStyles:function(b,I){var V=this.options,ie=V[I+"Size"];typeof ie=="number"&&(ie=[ie,ie]);var ge=Qe(ie),ze=Qe(I==="shadow"&&V.shadowAnchor||V.iconAnchor||ge&&ge.divideBy(2,!0));b.className="leaflet-marker-"+I+" "+(V.className||""),ze&&(b.style.marginLeft=-ze.x+"px",b.style.marginTop=-ze.y+"px"),ge&&(b.style.width=ge.x+"px",b.style.height=ge.y+"px")},_createImg:function(b,I){return I=I||document.createElement("img"),I.src=b,I},_getIconUrl:function(b){return Ti.retina&&this.options[b+"RetinaUrl"]||this.options[b+"Url"]}});function nd(b){return new Sr(b)}var lo=Sr.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(b){return typeof lo.imagePath!="string"&&(lo.imagePath=this._detectIconPath()),(this.options.imagePath||lo.imagePath)+Sr.prototype._getIconUrl.call(this,b)},_stripUrl:function(b){var I=function(V,ie,ge){var ze=ie.exec(V);return ze&&ze[ge]};return b=I(b,/^url\((['"])?(.+)\1\)$/,2),b&&I(b,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var b=gn("div","leaflet-default-icon-path",document.body),I=Jn(b,"background-image")||Jn(b,"backgroundImage");if(document.body.removeChild(b),I=this._stripUrl(I),I)return I;var V=document.querySelector('link[href$="leaflet.css"]');return V?V.href.substring(0,V.href.length-11-1):""}}),gl=fl.extend({initialize:function(b){this._marker=b},addHooks:function(){var b=this._marker._icon;this._draggable||(this._draggable=new Gi(b,b,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Dn(b,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Aa(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(b){var I=this._marker,V=I._map,ie=this._marker.options.autoPanSpeed,ge=this._marker.options.autoPanPadding,ze=Io(I._icon),dt=V.getPixelBounds(),Bt=V.getPixelOrigin(),Lt=Ht(dt.min._subtract(Bt).add(ge),dt.max._subtract(Bt).subtract(ge));if(!Lt.contains(ze)){var Ri=Qe((Math.max(Lt.max.x,ze.x)-Lt.max.x)/(dt.max.x-Lt.max.x)-(Math.min(Lt.min.x,ze.x)-Lt.min.x)/(dt.min.x-Lt.min.x),(Math.max(Lt.max.y,ze.y)-Lt.max.y)/(dt.max.y-Lt.max.y)-(Math.min(Lt.min.y,ze.y)-Lt.min.y)/(dt.min.y-Lt.min.y)).multiplyBy(ie);V.panBy(Ri,{animate:!1}),this._draggable._newPos._add(Ri),this._draggable._startPos._add(Ri),Sa(I._icon,this._draggable._newPos),this._onDrag(b),this._panRequest=pt(this._adjustPan.bind(this,b))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(b){this._marker.options.autoPan&&(Zt(this._panRequest),this._panRequest=pt(this._adjustPan.bind(this,b)))},_onDrag:function(b){var I=this._marker,V=I._shadow,ie=Io(I._icon),ge=I._map.layerPointToLatLng(ie);V&&Sa(V,ie),I._latlng=ge,b.latlng=ge,b.oldLatLng=this._oldLatLng,I.fire("move",b).fire("drag",b)},_onDragEnd:function(b){Zt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",b)}}),on=Qs.extend({options:{icon:new lo,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(b,I){le(this,I),this._latlng=Xt(b)},onAdd:function(b){this._zoomAnimated=this._zoomAnimated&&b.options.markerZoomAnimation,this._zoomAnimated&&b.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(b){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&b.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(b){var I=this._latlng;return this._latlng=Xt(b),this.update(),this.fire("move",{oldLatLng:I,latlng:this._latlng})},setZIndexOffset:function(b){return this.options.zIndexOffset=b,this.update()},getIcon:function(){return this.options.icon},setIcon:function(b){return this.options.icon=b,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var b=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(b)}return this},_initIcon:function(){var b=this.options,I="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),V=b.icon.createIcon(this._icon),ie=!1;V!==this._icon&&(this._icon&&this._removeIcon(),ie=!0,b.title&&(V.title=b.title),V.tagName==="IMG"&&(V.alt=b.alt||"")),Dn(V,I),b.keyboard&&(V.tabIndex="0",V.setAttribute("role","button")),this._icon=V,b.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&la(V,"focus",this._panOnFocus,this);var ge=b.icon.createShadow(this._shadow),ze=!1;ge!==this._shadow&&(this._removeShadow(),ze=!0),ge&&(Dn(ge,I),ge.alt=""),this._shadow=ge,b.opacity<1&&this._updateOpacity(),ie&&this.getPane().appendChild(this._icon),this._initInteraction(),ge&&ze&&this.getPane(b.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&rr(this._icon,"focus",this._panOnFocus,this),an(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&an(this._shadow),this._shadow=null},_setPos:function(b){this._icon&&Sa(this._icon,b),this._shadow&&Sa(this._shadow,b),this._zIndex=b.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(b){this._icon&&(this._icon.style.zIndex=this._zIndex+b)},_animateZoom:function(b){var I=this._map._latLngToNewLayerPoint(this._latlng,b.zoom,b.center).round();this._setPos(I)},_initInteraction:function(){if(this.options.interactive&&(Dn(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),gl)){var b=this.options.draggable;this.dragging&&(b=this.dragging.enabled(),this.dragging.disable()),this.dragging=new gl(this),b&&this.dragging.enable()}},setOpacity:function(b){return this.options.opacity=b,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var b=this.options.opacity;this._icon&&tr(this._icon,b),this._shadow&&tr(this._shadow,b)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var b=this._map;if(b){var I=this.options.icon.options,V=I.iconSize?Qe(I.iconSize):Qe(0,0),ie=I.iconAnchor?Qe(I.iconAnchor):Qe(0,0);b.panInside(this._latlng,{paddingTopLeft:ie,paddingBottomRight:V.subtract(ie)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function ji(b,I){return new on(b,I)}var _l=Qs.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(b){this._renderer=b.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(b){return le(this,b),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&b&&Object.prototype.hasOwnProperty.call(b,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ji=_l.extend({options:{fill:!0,radius:10},initialize:function(b,I){le(this,I),this._latlng=Xt(b),this._radius=this.options.radius},setLatLng:function(b){var I=this._latlng;return this._latlng=Xt(b),this.redraw(),this.fire("move",{oldLatLng:I,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(b){return this.options.radius=this._radius=b,this.redraw()},getRadius:function(){return this._radius},setStyle:function(b){var I=b&&b.radius||this._radius;return _l.prototype.setStyle.call(this,b),this.setRadius(I),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var b=this._radius,I=this._radiusY||b,V=this._clickTolerance(),ie=[b+V,I+V];this._pxBounds=new St(this._point.subtract(ie),this._point.add(ie))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(b){return b.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Mu(b,I){return new Ji(b,I)}var ad=Ji.extend({initialize:function(b,I,V){if(typeof I=="number"&&(I=f({},V,{radius:I})),le(this,I),this._latlng=Xt(b),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(b){return this._mRadius=b,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var b=[this._radius,this._radiusY||this._radius];return new Ft(this._map.layerPointToLatLng(this._point.subtract(b)),this._map.layerPointToLatLng(this._point.add(b)))},setStyle:_l.prototype.setStyle,_project:function(){var b=this._latlng.lng,I=this._latlng.lat,V=this._map,ie=V.options.crs;if(ie.distance===fn.distance){var ge=Math.PI/180,ze=this._mRadius/fn.R/ge,dt=V.project([I+ze,b]),Bt=V.project([I-ze,b]),Lt=dt.add(Bt).divideBy(2),Ri=V.unproject(Lt).lat,un=Math.acos((Math.cos(ze*ge)-Math.sin(I*ge)*Math.sin(Ri*ge))/(Math.cos(I*ge)*Math.cos(Ri*ge)))/ge;(isNaN(un)||un===0)&&(un=ze/Math.cos(Math.PI/180*I)),this._point=Lt.subtract(V.getPixelOrigin()),this._radius=isNaN(un)?0:Lt.x-V.project([Ri,b-un]).x,this._radiusY=Lt.y-dt.y}else{var Sn=ie.unproject(ie.project(this._latlng).subtract([this._mRadius,0]));this._point=V.latLngToLayerPoint(this._latlng),this._radius=this._point.x-V.latLngToLayerPoint(Sn).x}this._updateBounds()}});function en(b,I,V){return new ad(b,I,V)}var Is=_l.extend({options:{smoothFactor:1,noClip:!1},initialize:function(b,I){le(this,I),this._setLatLngs(b)},getLatLngs:function(){return this._latlngs},setLatLngs:function(b){return this._setLatLngs(b),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(b){for(var I=1/0,V=null,ie=lr,ge,ze,dt=0,Bt=this._parts.length;dt<Bt;dt++)for(var Lt=this._parts[dt],Ri=1,un=Lt.length;Ri<un;Ri++){ge=Lt[Ri-1],ze=Lt[Ri];var Sn=ie(b,ge,ze,!0);Sn<I&&(I=Sn,V=ie(b,ge,ze))}return V&&(V.distance=Math.sqrt(I)),V},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Vd(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(b,I){return I=I||this._defaultShape(),b=Xt(b),I.push(b),this._bounds.extend(b),this.redraw()},_setLatLngs:function(b){this._bounds=new Ft,this._latlngs=this._convertLatLngs(b)},_defaultShape:function(){return so(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(b){for(var I=[],V=so(b),ie=0,ge=b.length;ie<ge;ie++)V?(I[ie]=Xt(b[ie]),this._bounds.extend(I[ie])):I[ie]=this._convertLatLngs(b[ie]);return I},_project:function(){var b=new St;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,b),this._bounds.isValid()&&b.isValid()&&(this._rawPxBounds=b,this._updateBounds())},_updateBounds:function(){var b=this._clickTolerance(),I=new Ct(b,b);this._rawPxBounds&&(this._pxBounds=new St([this._rawPxBounds.min.subtract(I),this._rawPxBounds.max.add(I)]))},_projectLatlngs:function(b,I,V){var ie=b[0]instanceof At,ge=b.length,ze,dt;if(ie){for(dt=[],ze=0;ze<ge;ze++)dt[ze]=this._map.latLngToLayerPoint(b[ze]),V.extend(dt[ze]);I.push(dt)}else for(ze=0;ze<ge;ze++)this._projectLatlngs(b[ze],I,V)},_clipPoints:function(){var b=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(b))){if(this.options.noClip){this._parts=this._rings;return}var I=this._parts,V,ie,ge,ze,dt,Bt,Lt;for(V=0,ge=0,ze=this._rings.length;V<ze;V++)for(Lt=this._rings[V],ie=0,dt=Lt.length;ie<dt-1;ie++)Bt=$d(Lt[ie],Lt[ie+1],b,ie,!0),Bt&&(I[ge]=I[ge]||[],I[ge].push(Bt[0]),(Bt[1]!==Lt[ie+1]||ie===dt-2)&&(I[ge].push(Bt[1]),ge++))}},_simplifyPoints:function(){for(var b=this._parts,I=this.options.smoothFactor,V=0,ie=b.length;V<ie;V++)b[V]=ml(b[V],I)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(b,I){var V,ie,ge,ze,dt,Bt,Lt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(b))return!1;for(V=0,ze=this._parts.length;V<ze;V++)for(Bt=this._parts[V],ie=0,dt=Bt.length,ge=dt-1;ie<dt;ge=ie++)if(!(!I&&ie===0)&&zi(b,Bt[ge],Bt[ie])<=Lt)return!0;return!1}});function Ef(b,I){return new Is(b,I)}Is._flat=yc;var vc=Is.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Yc(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(b){var I=Is.prototype._convertLatLngs.call(this,b),V=I.length;return V>=2&&I[0]instanceof At&&I[0].equals(I[V-1])&&I.pop(),I},_setLatLngs:function(b){Is.prototype._setLatLngs.call(this,b),so(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return so(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var b=this._renderer._bounds,I=this.options.weight,V=new Ct(I,I);if(b=new St(b.min.subtract(V),b.max.add(V)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(b))){if(this.options.noClip){this._parts=this._rings;return}for(var ie=0,ge=this._rings.length,ze;ie<ge;ie++)ze=Ch(this._rings[ie],b,!0),ze.length&&this._parts.push(ze)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(b){var I=!1,V,ie,ge,ze,dt,Bt,Lt,Ri;if(!this._pxBounds||!this._pxBounds.contains(b))return!1;for(ze=0,Lt=this._parts.length;ze<Lt;ze++)for(V=this._parts[ze],dt=0,Ri=V.length,Bt=Ri-1;dt<Ri;Bt=dt++)ie=V[dt],ge=V[Bt],ie.y>b.y!=ge.y>b.y&&b.x<(ge.x-ie.x)*(b.y-ie.y)/(ge.y-ie.y)+ie.x&&(I=!I);return I||Is.prototype._containsPoint.call(this,b,!0)}});function Tr(b,I){return new vc(b,I)}var co=$r.extend({initialize:function(b,I){le(this,I),this._layers={},b&&this.addData(b)},addData:function(b){var I=be(b)?b:b.features,V,ie,ge;if(I){for(V=0,ie=I.length;V<ie;V++)ge=I[V],(ge.geometries||ge.geometry||ge.features||ge.coordinates)&&this.addData(ge);return this}var ze=this.options;if(ze.filter&&!ze.filter(b))return this;var dt=zr(b,ze);return dt?(dt.feature=sd(b),dt.defaultOptions=dt.options,this.resetStyle(dt),ze.onEachFeature&&ze.onEachFeature(b,dt),this.addLayer(dt)):this},resetStyle:function(b){return b===void 0?this.eachLayer(this.resetStyle,this):(b.options=f({},b.defaultOptions),this._setLayerStyle(b,this.options.style),this)},setStyle:function(b){return this.eachLayer(function(I){this._setLayerStyle(I,b)},this)},_setLayerStyle:function(b,I){b.setStyle&&(typeof I=="function"&&(I=I(b.feature)),b.setStyle(I))}});function zr(b,I){var V=b.type==="Feature"?b.geometry:b,ie=V?V.coordinates:null,ge=[],ze=I&&I.pointToLayer,dt=I&&I.coordsToLatLng||Fo,Bt,Lt,Ri,un;if(!ie&&!V)return null;switch(V.type){case"Point":return Bt=dt(ie),rd(ze,b,Bt,I);case"MultiPoint":for(Ri=0,un=ie.length;Ri<un;Ri++)Bt=dt(ie[Ri]),ge.push(rd(ze,b,Bt,I));return new $r(ge);case"LineString":case"MultiLineString":return Lt=Pu(ie,V.type==="LineString"?0:1,dt),new Is(Lt,I);case"Polygon":case"MultiPolygon":return Lt=Pu(ie,V.type==="Polygon"?1:2,dt),new vc(Lt,I);case"GeometryCollection":for(Ri=0,un=V.geometries.length;Ri<un;Ri++){var Sn=zr({geometry:V.geometries[Ri],type:"Feature",properties:b.properties},I);Sn&&ge.push(Sn)}return new $r(ge);case"FeatureCollection":for(Ri=0,un=V.features.length;Ri<un;Ri++){var Pn=zr(V.features[Ri],I);Pn&&ge.push(Pn)}return new $r(ge);default:throw new Error("Invalid GeoJSON object.")}}function rd(b,I,V,ie){return b?b(I,V):new on(V,ie&&ie.markersInheritOptions&&ie)}function Fo(b){return new At(b[1],b[0],b[2])}function Pu(b,I,V){for(var ie=[],ge=0,ze=b.length,dt;ge<ze;ge++)dt=I?Pu(b[ge],I-1,V):(V||Fo)(b[ge]),ie.push(dt);return ie}function yl(b,I){return b=Xt(b),b.alt!==void 0?[G(b.lng,I),G(b.lat,I),G(b.alt,I)]:[G(b.lng,I),G(b.lat,I)]}function So(b,I,V,ie){for(var ge=[],ze=0,dt=b.length;ze<dt;ze++)ge.push(I?So(b[ze],so(b[ze])?0:I-1,V,ie):yl(b[ze],ie));return!I&&V&&ge.length>0&&ge.push(ge[0].slice()),ge}function To(b,I){return b.feature?f({},b.feature,{geometry:I}):sd(I)}function sd(b){return b.type==="Feature"||b.type==="FeatureCollection"?b:{type:"Feature",properties:{},geometry:b}}var vl={toGeoJSON:function(b){return To(this,{type:"Point",coordinates:yl(this.getLatLng(),b)})}};on.include(vl),ad.include(vl),Ji.include(vl),Is.include({toGeoJSON:function(b){var I=!so(this._latlngs),V=So(this._latlngs,I?1:0,!1,b);return To(this,{type:(I?"Multi":"")+"LineString",coordinates:V})}}),vc.include({toGeoJSON:function(b){var I=!so(this._latlngs),V=I&&!so(this._latlngs[0]),ie=So(this._latlngs,V?2:I?1:0,!0,b);return I||(ie=[ie]),To(this,{type:(V?"Multi":"")+"Polygon",coordinates:ie})}}),pl.include({toMultiPoint:function(b){var I=[];return this.eachLayer(function(V){I.push(V.toGeoJSON(b).geometry.coordinates)}),To(this,{type:"MultiPoint",coordinates:I})},toGeoJSON:function(b){var I=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(I==="MultiPoint")return this.toMultiPoint(b);var V=I==="GeometryCollection",ie=[];return this.eachLayer(function(ge){if(ge.toGeoJSON){var ze=ge.toGeoJSON(b);if(V)ie.push(ze.geometry);else{var dt=sd(ze);dt.type==="FeatureCollection"?ie.push.apply(ie,dt.features):ie.push(dt)}}}),V?To(this,{geometries:ie,type:"GeometryCollection"}):{type:"FeatureCollection",features:ie}}});function Jc(b,I){return new co(b,I)}var od=Jc,zs=Qs.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(b,I,V){this._url=b,this._bounds=_i(I),le(this,V)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Dn(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){an(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(b){return this.options.opacity=b,this._image&&this._updateOpacity(),this},setStyle:function(b){return b.opacity&&this.setOpacity(b.opacity),this},bringToFront:function(){return this._map&&oa(this._image),this},bringToBack:function(){return this._map&&An(this._image),this},setUrl:function(b){return this._url=b,this._image&&(this._image.src=b),this},setBounds:function(b){return this._bounds=_i(b),this._map&&this._reset(),this},getEvents:function(){var b={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(b.zoomanim=this._animateZoom),b},setZIndex:function(b){return this.options.zIndex=b,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var b=this._url.tagName==="IMG",I=this._image=b?this._url:gn("img");if(Dn(I,"leaflet-image-layer"),this._zoomAnimated&&Dn(I,"leaflet-zoom-animated"),this.options.className&&Dn(I,this.options.className),I.onselectstart=$,I.onmousemove=$,I.onload=w(this.fire,this,"load"),I.onerror=w(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(I.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),b){this._url=I.src;return}I.src=this._url,I.alt=this.options.alt},_animateZoom:function(b){var I=this._map.getZoomScale(b.zoom),V=this._map._latLngBoundsToNewLayerBounds(this._bounds,b.zoom,b.center).min;os(this._image,V,I)},_reset:function(){var b=this._image,I=new St(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),V=I.getSize();Sa(b,I.min),b.style.width=V.x+"px",b.style.height=V.y+"px"},_updateOpacity:function(){tr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var b=this.options.errorOverlayUrl;b&&this._url!==b&&(this._url=b,this._image.src=b)},getCenter:function(){return this._bounds.getCenter()}}),tl=function(b,I,V){return new zs(b,I,V)},Mh=zs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var b=this._url.tagName==="VIDEO",I=this._image=b?this._url:gn("video");if(Dn(I,"leaflet-image-layer"),this._zoomAnimated&&Dn(I,"leaflet-zoom-animated"),this.options.className&&Dn(I,this.options.className),I.onselectstart=$,I.onmousemove=$,I.onloadeddata=w(this.fire,this,"load"),b){for(var V=I.getElementsByTagName("source"),ie=[],ge=0;ge<V.length;ge++)ie.push(V[ge].src);this._url=V.length>0?ie:[I.src];return}be(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(I.style,"objectFit")&&(I.style.objectFit="fill"),I.autoplay=!!this.options.autoplay,I.loop=!!this.options.loop,I.muted=!!this.options.muted,I.playsInline=!!this.options.playsInline;for(var ze=0;ze<this._url.length;ze++){var dt=gn("source");dt.src=this._url[ze],I.appendChild(dt)}}});function Ph(b,I,V){return new Mh(b,I,V)}var Qc=zs.extend({_initImage:function(){var b=this._image=this._url;Dn(b,"leaflet-image-layer"),this._zoomAnimated&&Dn(b,"leaflet-zoom-animated"),this.options.className&&Dn(b,this.options.className),b.onselectstart=$,b.onmousemove=$}});function Af(b,I,V){return new Qc(b,I,V)}var xl=Qs.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(b,I){b&&(b instanceof At||be(b))?(this._latlng=Xt(b),le(this,I)):(le(this,b),this._source=I),this.options.content&&(this._content=this.options.content)},openOn:function(b){return b=arguments.length?b:this._source._map,b.hasLayer(this)||b.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(b){return this._map?this.close():(arguments.length?this._source=b:b=this._source,this._prepareOpen(),this.openOn(b._map)),this},onAdd:function(b){this._zoomAnimated=b._zoomAnimated,this._container||this._initLayout(),b._fadeAnimated&&tr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),b._fadeAnimated&&tr(this._container,1),this.bringToFront(),this.options.interactive&&(Dn(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(b){b._fadeAnimated?(tr(this._container,0),this._removeTimeout=setTimeout(w(an,void 0,this._container),200)):an(this._container),this.options.interactive&&(Aa(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(b){return this._latlng=Xt(b),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(b){return this._content=b,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var b={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(b.zoomanim=this._animateZoom),b},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&oa(this._container),this},bringToBack:function(){return this._map&&An(this._container),this},_prepareOpen:function(b){var I=this._source;if(!I._map)return!1;if(I instanceof $r){I=null;var V=this._source._layers;for(var ie in V)if(V[ie]._map){I=V[ie];break}if(!I)return!1;this._source=I}if(!b)if(I.getCenter)b=I.getCenter();else if(I.getLatLng)b=I.getLatLng();else if(I.getBounds)b=I.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(b),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var b=this._contentNode,I=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof I=="string")b.innerHTML=I;else{for(;b.hasChildNodes();)b.removeChild(b.firstChild);b.appendChild(I)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var b=this._map.latLngToLayerPoint(this._latlng),I=Qe(this.options.offset),V=this._getAnchor();this._zoomAnimated?Sa(this._container,b.add(V)):I=I.add(b).add(V);var ie=this._containerBottom=-I.y,ge=this._containerLeft=-Math.round(this._containerWidth/2)+I.x;this._container.style.bottom=ie+"px",this._container.style.left=ge+"px"}},_getAnchor:function(){return[0,0]}});Pa.include({_initOverlay:function(b,I,V,ie){var ge=I;return ge instanceof b||(ge=new b(ie).setContent(I)),V&&ge.setLatLng(V),ge}}),Qs.include({_initOverlay:function(b,I,V,ie){var ge=V;return ge instanceof b?(le(ge,ie),ge._source=this):(ge=I&&!ie?I:new b(ie,this),ge.setContent(V)),ge}});var ju=xl.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(b){return b=arguments.length?b:this._source._map,!b.hasLayer(this)&&b._popup&&b._popup.options.autoClose&&b.removeLayer(b._popup),b._popup=this,xl.prototype.openOn.call(this,b)},onAdd:function(b){xl.prototype.onAdd.call(this,b),b.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof _l||this._source.on("preclick",bo))},onRemove:function(b){xl.prototype.onRemove.call(this,b),b.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof _l||this._source.off("preclick",bo))},getEvents:function(){var b=xl.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(b.preclick=this.close),this.options.keepInView&&(b.moveend=this._adjustPan),b},_initLayout:function(){var b="leaflet-popup",I=this._container=gn("div",b+" "+(this.options.className||"")+" leaflet-zoom-animated"),V=this._wrapper=gn("div",b+"-content-wrapper",I);if(this._contentNode=gn("div",b+"-content",V),Ku(I),zo(this._contentNode),la(I,"contextmenu",bo),this._tipContainer=gn("div",b+"-tip-container",I),this._tip=gn("div",b+"-tip",this._tipContainer),this.options.closeButton){var ie=this._closeButton=gn("a",b+"-close-button",I);ie.setAttribute("role","button"),ie.setAttribute("aria-label","Close popup"),ie.href="#close",ie.innerHTML='<span aria-hidden="true">&#215;</span>',la(ie,"click",function(ge){ls(ge),this.close()},this)}},_updateLayout:function(){var b=this._contentNode,I=b.style;I.width="",I.whiteSpace="nowrap";var V=b.offsetWidth;V=Math.min(V,this.options.maxWidth),V=Math.max(V,this.options.minWidth),I.width=V+1+"px",I.whiteSpace="",I.height="";var ie=b.offsetHeight,ge=this.options.maxHeight,ze="leaflet-popup-scrolled";ge&&ie>ge?(I.height=ge+"px",Dn(b,ze)):Aa(b,ze),this._containerWidth=this._container.offsetWidth},_animateZoom:function(b){var I=this._map._latLngToNewLayerPoint(this._latlng,b.zoom,b.center),V=this._getAnchor();Sa(this._container,I.add(V))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var b=this._map,I=parseInt(Jn(this._container,"marginBottom"),10)||0,V=this._container.offsetHeight+I,ie=this._containerWidth,ge=new Ct(this._containerLeft,-V-this._containerBottom);ge._add(Io(this._container));var ze=b.layerPointToContainerPoint(ge),dt=Qe(this.options.autoPanPadding),Bt=Qe(this.options.autoPanPaddingTopLeft||dt),Lt=Qe(this.options.autoPanPaddingBottomRight||dt),Ri=b.getSize(),un=0,Sn=0;ze.x+ie+Lt.x>Ri.x&&(un=ze.x+ie-Ri.x+Lt.x),ze.x-un-Bt.x<0&&(un=ze.x-Bt.x),ze.y+V+Lt.y>Ri.y&&(Sn=ze.y+V-Ri.y+Lt.y),ze.y-Sn-Bt.y<0&&(Sn=ze.y-Bt.y),(un||Sn)&&(this.options.keepInView&&(this._autopanning=!0),b.fire("autopanstart").panBy([un,Sn]))}},_getAnchor:function(){return Qe(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),eu=function(b,I){return new ju(b,I)};Pa.mergeOptions({closePopupOnClick:!0}),Pa.include({openPopup:function(b,I,V){return this._initOverlay(ju,b,I,V).openOn(this),this},closePopup:function(b){return b=arguments.length?b:this._popup,b&&b.close(),this}}),Qs.include({bindPopup:function(b,I){return this._popup=this._initOverlay(ju,this._popup,b,I),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(b){return this._popup&&(this instanceof $r||(this._popup._source=this),this._popup._prepareOpen(b||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(b){return this._popup&&this._popup.setContent(b),this},getPopup:function(){return this._popup},_openPopup:function(b){if(!(!this._popup||!this._map)){Do(b);var I=b.layer||b.target;if(this._popup._source===I&&!(I instanceof _l)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(b.latlng);return}this._popup._source=I,this.openPopup(b.latlng)}},_movePopup:function(b){this._popup.setLatLng(b.latlng)},_onKeyPress:function(b){b.originalEvent.keyCode===13&&this._openPopup(b)}});var Gd=xl.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(b){xl.prototype.onAdd.call(this,b),this.setOpacity(this.options.opacity),b.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(b){xl.prototype.onRemove.call(this,b),b.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var b=xl.prototype.getEvents.call(this);return this.options.permanent||(b.preclick=this.close),b},_initLayout:function(){var b="leaflet-tooltip",I=b+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=gn("div",I),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+C(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(b){var I,V,ie=this._map,ge=this._container,ze=ie.latLngToContainerPoint(ie.getCenter()),dt=ie.layerPointToContainerPoint(b),Bt=this.options.direction,Lt=ge.offsetWidth,Ri=ge.offsetHeight,un=Qe(this.options.offset),Sn=this._getAnchor();Bt==="top"?(I=Lt/2,V=Ri):Bt==="bottom"?(I=Lt/2,V=0):Bt==="center"?(I=Lt/2,V=Ri/2):Bt==="right"?(I=0,V=Ri/2):Bt==="left"?(I=Lt,V=Ri/2):dt.x<ze.x?(Bt="right",I=0,V=Ri/2):(Bt="left",I=Lt+(un.x+Sn.x)*2,V=Ri/2),b=b.subtract(Qe(I,V,!0)).add(un).add(Sn),Aa(ge,"leaflet-tooltip-right"),Aa(ge,"leaflet-tooltip-left"),Aa(ge,"leaflet-tooltip-top"),Aa(ge,"leaflet-tooltip-bottom"),Dn(ge,"leaflet-tooltip-"+Bt),Sa(ge,b)},_updatePosition:function(){var b=this._map.latLngToLayerPoint(this._latlng);this._setPosition(b)},setOpacity:function(b){this.options.opacity=b,this._container&&tr(this._container,b)},_animateZoom:function(b){var I=this._map._latLngToNewLayerPoint(this._latlng,b.zoom,b.center);this._setPosition(I)},_getAnchor:function(){return Qe(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),jm=function(b,I){return new Gd(b,I)};Pa.include({openTooltip:function(b,I,V){return this._initOverlay(Gd,b,I,V).openOn(this),this},closeTooltip:function(b){return b.close(),this}}),Qs.include({bindTooltip:function(b,I){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Gd,this._tooltip,b,I),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(b){if(!(!b&&this._tooltipHandlersAdded)){var I=b?"off":"on",V={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?V.add=this._openTooltip:(V.mouseover=this._openTooltip,V.mouseout=this.closeTooltip,V.click=this._openTooltip,this._map?this._addFocusListeners():V.add=this._addFocusListeners),this._tooltip.options.sticky&&(V.mousemove=this._moveTooltip),this[I](V),this._tooltipHandlersAdded=!b}},openTooltip:function(b){return this._tooltip&&(this instanceof $r||(this._tooltip._source=this),this._tooltip._prepareOpen(b)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(b){return this._tooltip&&this._tooltip.setContent(b),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(b){var I=typeof b.getElement=="function"&&b.getElement();I&&(la(I,"focus",function(){this._tooltip._source=b,this.openTooltip()},this),la(I,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(b){var I=typeof b.getElement=="function"&&b.getElement();I&&I.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(b){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var I=this;this._map.once("moveend",function(){I._openOnceFlag=!1,I._openTooltip(b)});return}this._tooltip._source=b.layer||b.target,this.openTooltip(this._tooltip.options.sticky?b.latlng:void 0)}},_moveTooltip:function(b){var I=b.latlng,V,ie;this._tooltip.options.sticky&&b.originalEvent&&(V=this._map.mouseEventToContainerPoint(b.originalEvent),ie=this._map.containerPointToLayerPoint(V),I=this._map.layerPointToLatLng(ie)),this._tooltip.setLatLng(I)}});var ld=Sr.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(b){var I=b&&b.tagName==="DIV"?b:document.createElement("div"),V=this.options;if(V.html instanceof Element?(ia(I),I.appendChild(V.html)):I.innerHTML=V.html!==!1?V.html:"",V.bgPos){var ie=Qe(V.bgPos);I.style.backgroundPosition=-ie.x+"px "+-ie.y+"px"}return this._setIconStyles(I,"icon"),I},createShadow:function(){return null}});function xc(b){return new ld(b)}Sr.Default=lo;var Nl=Qs.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ti.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(b){le(this,b)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(b){b._addZoomLimit(this)},onRemove:function(b){this._removeAllTiles(),an(this._container),b._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(oa(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(An(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(b){return this.options.opacity=b,this._updateOpacity(),this},setZIndex:function(b){return this.options.zIndex=b,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var b=this._clampZoom(this._map.getZoom());b!==this._tileZoom&&(this._tileZoom=b,this._updateLevels()),this._update()}return this},getEvents:function(){var b={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=P(this._onMoveEnd,this.options.updateInterval,this)),b.move=this._onMove),this._zoomAnimated&&(b.zoomanim=this._animateZoom),b},createTile:function(){return document.createElement("div")},getTileSize:function(){var b=this.options.tileSize;return b instanceof Ct?b:new Ct(b,b)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(b){for(var I=this.getPane().children,V=-b(-1/0,1/0),ie=0,ge=I.length,ze;ie<ge;ie++)ze=I[ie].style.zIndex,I[ie]!==this._container&&ze&&(V=b(V,+ze));isFinite(V)&&(this.options.zIndex=V+b(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ti.ielt9){tr(this._container,this.options.opacity);var b=+new Date,I=!1,V=!1;for(var ie in this._tiles){var ge=this._tiles[ie];if(!(!ge.current||!ge.loaded)){var ze=Math.min(1,(b-ge.loaded)/200);tr(ge.el,ze),ze<1?I=!0:(ge.active?V=!0:this._onOpaqueTile(ge),ge.active=!0)}}V&&!this._noPrune&&this._pruneTiles(),I&&(Zt(this._fadeFrame),this._fadeFrame=pt(this._updateOpacity,this))}},_onOpaqueTile:$,_initContainer:function(){this._container||(this._container=gn("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var b=this._tileZoom,I=this.options.maxZoom;if(b!==void 0){for(var V in this._levels)V=Number(V),this._levels[V].el.children.length||V===b?(this._levels[V].el.style.zIndex=I-Math.abs(b-V),this._onUpdateLevel(V)):(an(this._levels[V].el),this._removeTilesAtZoom(V),this._onRemoveLevel(V),delete this._levels[V]);var ie=this._levels[b],ge=this._map;return ie||(ie=this._levels[b]={},ie.el=gn("div","leaflet-tile-container leaflet-zoom-animated",this._container),ie.el.style.zIndex=I,ie.origin=ge.project(ge.unproject(ge.getPixelOrigin()),b).round(),ie.zoom=b,this._setZoomTransform(ie,ge.getCenter(),ge.getZoom()),$(ie.el.offsetWidth),this._onCreateLevel(ie)),this._level=ie,ie}},_onUpdateLevel:$,_onRemoveLevel:$,_onCreateLevel:$,_pruneTiles:function(){if(this._map){var b,I,V=this._map.getZoom();if(V>this.options.maxZoom||V<this.options.minZoom){this._removeAllTiles();return}for(b in this._tiles)I=this._tiles[b],I.retain=I.current;for(b in this._tiles)if(I=this._tiles[b],I.current&&!I.active){var ie=I.coords;this._retainParent(ie.x,ie.y,ie.z,ie.z-5)||this._retainChildren(ie.x,ie.y,ie.z,ie.z+2)}for(b in this._tiles)this._tiles[b].retain||this._removeTile(b)}},_removeTilesAtZoom:function(b){for(var I in this._tiles)this._tiles[I].coords.z===b&&this._removeTile(I)},_removeAllTiles:function(){for(var b in this._tiles)this._removeTile(b)},_invalidateAll:function(){for(var b in this._levels)an(this._levels[b].el),this._onRemoveLevel(Number(b)),delete this._levels[b];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(b,I,V,ie){var ge=Math.floor(b/2),ze=Math.floor(I/2),dt=V-1,Bt=new Ct(+ge,+ze);Bt.z=+dt;var Lt=this._tileCoordsToKey(Bt),Ri=this._tiles[Lt];return Ri&&Ri.active?(Ri.retain=!0,!0):(Ri&&Ri.loaded&&(Ri.retain=!0),dt>ie?this._retainParent(ge,ze,dt,ie):!1)},_retainChildren:function(b,I,V,ie){for(var ge=2*b;ge<2*b+2;ge++)for(var ze=2*I;ze<2*I+2;ze++){var dt=new Ct(ge,ze);dt.z=V+1;var Bt=this._tileCoordsToKey(dt),Lt=this._tiles[Bt];if(Lt&&Lt.active){Lt.retain=!0;continue}else Lt&&Lt.loaded&&(Lt.retain=!0);V+1<ie&&this._retainChildren(ge,ze,V+1,ie)}},_resetView:function(b){var I=b&&(b.pinch||b.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),I,I)},_animateZoom:function(b){this._setView(b.center,b.zoom,!0,b.noUpdate)},_clampZoom:function(b){var I=this.options;return I.minNativeZoom!==void 0&&b<I.minNativeZoom?I.minNativeZoom:I.maxNativeZoom!==void 0&&I.maxNativeZoom<b?I.maxNativeZoom:b},_setView:function(b,I,V,ie){var ge=Math.round(I);this.options.maxZoom!==void 0&&ge>this.options.maxZoom||this.options.minZoom!==void 0&&ge<this.options.minZoom?ge=void 0:ge=this._clampZoom(ge);var ze=this.options.updateWhenZooming&&ge!==this._tileZoom;(!ie||ze)&&(this._tileZoom=ge,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),ge!==void 0&&this._update(b),V||this._pruneTiles(),this._noPrune=!!V),this._setZoomTransforms(b,I)},_setZoomTransforms:function(b,I){for(var V in this._levels)this._setZoomTransform(this._levels[V],b,I)},_setZoomTransform:function(b,I,V){var ie=this._map.getZoomScale(V,b.zoom),ge=b.origin.multiplyBy(ie).subtract(this._map._getNewPixelOrigin(I,V)).round();Ti.any3d?os(b.el,ge,ie):Sa(b.el,ge)},_resetGrid:function(){var b=this._map,I=b.options.crs,V=this._tileSize=this.getTileSize(),ie=this._tileZoom,ge=this._map.getPixelWorldBounds(this._tileZoom);ge&&(this._globalTileRange=this._pxBoundsToTileRange(ge)),this._wrapX=I.wrapLng&&!this.options.noWrap&&[Math.floor(b.project([0,I.wrapLng[0]],ie).x/V.x),Math.ceil(b.project([0,I.wrapLng[1]],ie).x/V.y)],this._wrapY=I.wrapLat&&!this.options.noWrap&&[Math.floor(b.project([I.wrapLat[0],0],ie).y/V.x),Math.ceil(b.project([I.wrapLat[1],0],ie).y/V.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(b){var I=this._map,V=I._animatingZoom?Math.max(I._animateToZoom,I.getZoom()):I.getZoom(),ie=I.getZoomScale(V,this._tileZoom),ge=I.project(b,this._tileZoom).floor(),ze=I.getSize().divideBy(ie*2);return new St(ge.subtract(ze),ge.add(ze))},_update:function(b){var I=this._map;if(I){var V=this._clampZoom(I.getZoom());if(b===void 0&&(b=I.getCenter()),this._tileZoom!==void 0){var ie=this._getTiledPixelBounds(b),ge=this._pxBoundsToTileRange(ie),ze=ge.getCenter(),dt=[],Bt=this.options.keepBuffer,Lt=new St(ge.getBottomLeft().subtract([Bt,-Bt]),ge.getTopRight().add([Bt,-Bt]));if(!(isFinite(ge.min.x)&&isFinite(ge.min.y)&&isFinite(ge.max.x)&&isFinite(ge.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ri in this._tiles){var un=this._tiles[Ri].coords;(un.z!==this._tileZoom||!Lt.contains(new Ct(un.x,un.y)))&&(this._tiles[Ri].current=!1)}if(Math.abs(V-this._tileZoom)>1){this._setView(b,V);return}for(var Sn=ge.min.y;Sn<=ge.max.y;Sn++)for(var Pn=ge.min.x;Pn<=ge.max.x;Pn++){var ca=new Ct(Pn,Sn);if(ca.z=this._tileZoom,!!this._isValidTile(ca)){var gr=this._tiles[this._tileCoordsToKey(ca)];gr?gr.current=!0:dt.push(ca)}}if(dt.sort(function(fs,to){return fs.distanceTo(ze)-to.distanceTo(ze)}),dt.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Cr=document.createDocumentFragment();for(Pn=0;Pn<dt.length;Pn++)this._addTile(dt[Pn],Cr);this._level.el.appendChild(Cr)}}}},_isValidTile:function(b){var I=this._map.options.crs;if(!I.infinite){var V=this._globalTileRange;if(!I.wrapLng&&(b.x<V.min.x||b.x>V.max.x)||!I.wrapLat&&(b.y<V.min.y||b.y>V.max.y))return!1}if(!this.options.bounds)return!0;var ie=this._tileCoordsToBounds(b);return _i(this.options.bounds).overlaps(ie)},_keyToBounds:function(b){return this._tileCoordsToBounds(this._keyToTileCoords(b))},_tileCoordsToNwSe:function(b){var I=this._map,V=this.getTileSize(),ie=b.scaleBy(V),ge=ie.add(V),ze=I.unproject(ie,b.z),dt=I.unproject(ge,b.z);return[ze,dt]},_tileCoordsToBounds:function(b){var I=this._tileCoordsToNwSe(b),V=new Ft(I[0],I[1]);return this.options.noWrap||(V=this._map.wrapLatLngBounds(V)),V},_tileCoordsToKey:function(b){return b.x+":"+b.y+":"+b.z},_keyToTileCoords:function(b){var I=b.split(":"),V=new Ct(+I[0],+I[1]);return V.z=+I[2],V},_removeTile:function(b){var I=this._tiles[b];I&&(an(I.el),delete this._tiles[b],this.fire("tileunload",{tile:I.el,coords:this._keyToTileCoords(b)}))},_initTile:function(b){Dn(b,"leaflet-tile");var I=this.getTileSize();b.style.width=I.x+"px",b.style.height=I.y+"px",b.onselectstart=$,b.onmousemove=$,Ti.ielt9&&this.options.opacity<1&&tr(b,this.options.opacity)},_addTile:function(b,I){var V=this._getTilePos(b),ie=this._tileCoordsToKey(b),ge=this.createTile(this._wrapCoords(b),w(this._tileReady,this,b));this._initTile(ge),this.createTile.length<2&&pt(w(this._tileReady,this,b,null,ge)),Sa(ge,V),this._tiles[ie]={el:ge,coords:b,current:!0},I.appendChild(ge),this.fire("tileloadstart",{tile:ge,coords:b})},_tileReady:function(b,I,V){I&&this.fire("tileerror",{error:I,tile:V,coords:b});var ie=this._tileCoordsToKey(b);V=this._tiles[ie],V&&(V.loaded=+new Date,this._map._fadeAnimated?(tr(V.el,0),Zt(this._fadeFrame),this._fadeFrame=pt(this._updateOpacity,this)):(V.active=!0,this._pruneTiles()),I||(Dn(V.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:V.el,coords:b})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ti.ielt9||!this._map._fadeAnimated?pt(this._pruneTiles,this):setTimeout(w(this._pruneTiles,this),250)))},_getTilePos:function(b){return b.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(b){var I=new Ct(this._wrapX?D(b.x,this._wrapX):b.x,this._wrapY?D(b.y,this._wrapY):b.y);return I.z=b.z,I},_pxBoundsToTileRange:function(b){var I=this.getTileSize();return new St(b.min.unscaleBy(I).floor(),b.max.unscaleBy(I).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var b in this._tiles)if(!this._tiles[b].loaded)return!1;return!0}});function es(b){return new Nl(b)}var tu=Nl.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(b,I){this._url=b,I=le(this,I),I.detectRetina&&Ti.retina&&I.maxZoom>0?(I.tileSize=Math.floor(I.tileSize/2),I.zoomReverse?(I.zoomOffset--,I.minZoom=Math.min(I.maxZoom,I.minZoom+1)):(I.zoomOffset++,I.maxZoom=Math.max(I.minZoom,I.maxZoom-1)),I.minZoom=Math.max(0,I.minZoom)):I.zoomReverse?I.minZoom=Math.min(I.maxZoom,I.minZoom):I.maxZoom=Math.max(I.minZoom,I.maxZoom),typeof I.subdomains=="string"&&(I.subdomains=I.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(b,I){return this._url===b&&I===void 0&&(I=!0),this._url=b,I||this.redraw(),this},createTile:function(b,I){var V=document.createElement("img");return la(V,"load",w(this._tileOnLoad,this,I,V)),la(V,"error",w(this._tileOnError,this,I,V)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(V.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(V.referrerPolicy=this.options.referrerPolicy),V.alt="",V.src=this.getTileUrl(b),V},getTileUrl:function(b){var I={r:Ti.retina?"@2x":"",s:this._getSubdomain(b),x:b.x,y:b.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var V=this._globalTileRange.max.y-b.y;this.options.tms&&(I.y=V),I["-y"]=V}return xe(this._url,f(I,this.options))},_tileOnLoad:function(b,I){Ti.ielt9?setTimeout(w(b,this,null,I),0):b(null,I)},_tileOnError:function(b,I,V){var ie=this.options.errorTileUrl;ie&&I.getAttribute("src")!==ie&&(I.src=ie),b(V,I)},_onTileRemove:function(b){b.tile.onload=null},_getZoomForUrl:function(){var b=this._tileZoom,I=this.options.maxZoom,V=this.options.zoomReverse,ie=this.options.zoomOffset;return V&&(b=I-b),b+ie},_getSubdomain:function(b){var I=Math.abs(b.x+b.y)%this.options.subdomains.length;return this.options.subdomains[I]},_abortLoading:function(){var b,I;for(b in this._tiles)if(this._tiles[b].coords.z!==this._tileZoom&&(I=this._tiles[b].el,I.onload=$,I.onerror=$,!I.complete)){I.src=Be;var V=this._tiles[b].coords;an(I),delete this._tiles[b],this.fire("tileabort",{tile:I,coords:V})}},_removeTile:function(b){var I=this._tiles[b];if(I)return I.el.setAttribute("src",Be),Nl.prototype._removeTile.call(this,b)},_tileReady:function(b,I,V){if(!(!this._map||V&&V.getAttribute("src")===Be))return Nl.prototype._tileReady.call(this,b,I,V)}});function Ds(b,I){return new tu(b,I)}var Os=tu.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(b,I){this._url=b;var V=f({},this.defaultWmsParams);for(var ie in I)ie in this.options||(V[ie]=I[ie]);I=le(this,I);var ge=I.detectRetina&&Ti.retina?2:1,ze=this.getTileSize();V.width=ze.x*ge,V.height=ze.y*ge,this.wmsParams=V},onAdd:function(b){this._crs=this.options.crs||b.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var I=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[I]=this._crs.code,tu.prototype.onAdd.call(this,b)},getTileUrl:function(b){var I=this._tileCoordsToNwSe(b),V=this._crs,ie=Ht(V.project(I[0]),V.project(I[1])),ge=ie.min,ze=ie.max,dt=(this._wmsVersion>=1.3&&this._crs===rc?[ge.y,ge.x,ze.y,ze.x]:[ge.x,ge.y,ze.x,ze.y]).join(","),Bt=tu.prototype.getTileUrl.call(this,b);return Bt+re(this.wmsParams,Bt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+dt},setParams:function(b,I){return f(this.wmsParams,b),I||this.redraw(),this}});function iu(b,I){return new Os(b,I)}tu.WMS=Os,Ds.wms=iu;var Bo=Qs.extend({options:{padding:.1},initialize:function(b){le(this,b),C(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Dn(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var b={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(b.zoomanim=this._onAnimZoom),b},_onAnimZoom:function(b){this._updateTransform(b.center,b.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(b,I){var V=this._map.getZoomScale(I,this._zoom),ie=this._map.getSize().multiplyBy(.5+this.options.padding),ge=this._map.project(this._center,I),ze=ie.multiplyBy(-V).add(ge).subtract(this._map._getNewPixelOrigin(b,I));Ti.any3d?os(this._container,ze,V):Sa(this._container,ze)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var b in this._layers)this._layers[b]._reset()},_onZoomEnd:function(){for(var b in this._layers)this._layers[b]._project()},_updatePaths:function(){for(var b in this._layers)this._layers[b]._update()},_update:function(){var b=this.options.padding,I=this._map.getSize(),V=this._map.containerPointToLayerPoint(I.multiplyBy(-b)).round();this._bounds=new St(V,V.add(I.multiplyBy(1+b*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),eo=Bo.extend({options:{tolerance:0},getEvents:function(){var b=Bo.prototype.getEvents.call(this);return b.viewprereset=this._onViewPreReset,b},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Bo.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var b=this._container=document.createElement("canvas");la(b,"mousemove",this._onMouseMove,this),la(b,"click dblclick mousedown mouseup contextmenu",this._onClick,this),la(b,"mouseout",this._handleMouseOut,this),b._leaflet_disable_events=!0,this._ctx=b.getContext("2d")},_destroyContainer:function(){Zt(this._redrawRequest),delete this._ctx,an(this._container),rr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var b;this._redrawBounds=null;for(var I in this._layers)b=this._layers[I],b._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Bo.prototype._update.call(this);var b=this._bounds,I=this._container,V=b.getSize(),ie=Ti.retina?2:1;Sa(I,b.min),I.width=ie*V.x,I.height=ie*V.y,I.style.width=V.x+"px",I.style.height=V.y+"px",Ti.retina&&this._ctx.scale(2,2),this._ctx.translate(-b.min.x,-b.min.y),this.fire("update")}},_reset:function(){Bo.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(b){this._updateDashArray(b),this._layers[C(b)]=b;var I=b._order={layer:b,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=I),this._drawLast=I,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(b){this._requestRedraw(b)},_removePath:function(b){var I=b._order,V=I.next,ie=I.prev;V?V.prev=ie:this._drawLast=ie,ie?ie.next=V:this._drawFirst=V,delete b._order,delete this._layers[C(b)],this._requestRedraw(b)},_updatePath:function(b){this._extendRedrawBounds(b),b._project(),b._update(),this._requestRedraw(b)},_updateStyle:function(b){this._updateDashArray(b),this._requestRedraw(b)},_updateDashArray:function(b){if(typeof b.options.dashArray=="string"){var I=b.options.dashArray.split(/[, ]+/),V=[],ie,ge;for(ge=0;ge<I.length;ge++){if(ie=Number(I[ge]),isNaN(ie))return;V.push(ie)}b.options._dashArray=V}else b.options._dashArray=b.options.dashArray},_requestRedraw:function(b){this._map&&(this._extendRedrawBounds(b),this._redrawRequest=this._redrawRequest||pt(this._redraw,this))},_extendRedrawBounds:function(b){if(b._pxBounds){var I=(b.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new St,this._redrawBounds.extend(b._pxBounds.min.subtract([I,I])),this._redrawBounds.extend(b._pxBounds.max.add([I,I]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var b=this._redrawBounds;if(b){var I=b.getSize();this._ctx.clearRect(b.min.x,b.min.y,I.x,I.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var b,I=this._redrawBounds;if(this._ctx.save(),I){var V=I.getSize();this._ctx.beginPath(),this._ctx.rect(I.min.x,I.min.y,V.x,V.y),this._ctx.clip()}this._drawing=!0;for(var ie=this._drawFirst;ie;ie=ie.next)b=ie.layer,(!I||b._pxBounds&&b._pxBounds.intersects(I))&&b._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(b,I){if(this._drawing){var V,ie,ge,ze,dt=b._parts,Bt=dt.length,Lt=this._ctx;if(Bt){for(Lt.beginPath(),V=0;V<Bt;V++){for(ie=0,ge=dt[V].length;ie<ge;ie++)ze=dt[V][ie],Lt[ie?"lineTo":"moveTo"](ze.x,ze.y);I&&Lt.closePath()}this._fillStroke(Lt,b)}}},_updateCircle:function(b){if(!(!this._drawing||b._empty())){var I=b._point,V=this._ctx,ie=Math.max(Math.round(b._radius),1),ge=(Math.max(Math.round(b._radiusY),1)||ie)/ie;ge!==1&&(V.save(),V.scale(1,ge)),V.beginPath(),V.arc(I.x,I.y/ge,ie,0,Math.PI*2,!1),ge!==1&&V.restore(),this._fillStroke(V,b)}},_fillStroke:function(b,I){var V=I.options;V.fill&&(b.globalAlpha=V.fillOpacity,b.fillStyle=V.fillColor||V.color,b.fill(V.fillRule||"evenodd")),V.stroke&&V.weight!==0&&(b.setLineDash&&b.setLineDash(I.options&&I.options._dashArray||[]),b.globalAlpha=V.opacity,b.lineWidth=V.weight,b.strokeStyle=V.color,b.lineCap=V.lineCap,b.lineJoin=V.lineJoin,b.stroke())},_onClick:function(b){for(var I=this._map.mouseEventToLayerPoint(b),V,ie,ge=this._drawFirst;ge;ge=ge.next)V=ge.layer,V.options.interactive&&V._containsPoint(I)&&(!(b.type==="click"||b.type==="preclick")||!this._map._draggableMoved(V))&&(ie=V);this._fireEvent(ie?[ie]:!1,b)},_onMouseMove:function(b){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var I=this._map.mouseEventToLayerPoint(b);this._handleMouseHover(b,I)}},_handleMouseOut:function(b){var I=this._hoveredLayer;I&&(Aa(this._container,"leaflet-interactive"),this._fireEvent([I],b,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(b,I){if(!this._mouseHoverThrottled){for(var V,ie,ge=this._drawFirst;ge;ge=ge.next)V=ge.layer,V.options.interactive&&V._containsPoint(I)&&(ie=V);ie!==this._hoveredLayer&&(this._handleMouseOut(b),ie&&(Dn(this._container,"leaflet-interactive"),this._fireEvent([ie],b,"mouseover"),this._hoveredLayer=ie)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,b),this._mouseHoverThrottled=!0,setTimeout(w(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(b,I,V){this._map._fireDOMEvent(I,V||I.type,b)},_bringToFront:function(b){var I=b._order;if(I){var V=I.next,ie=I.prev;if(V)V.prev=ie;else return;ie?ie.next=V:V&&(this._drawFirst=V),I.prev=this._drawLast,this._drawLast.next=I,I.next=null,this._drawLast=I,this._requestRedraw(b)}},_bringToBack:function(b){var I=b._order;if(I){var V=I.next,ie=I.prev;if(ie)ie.next=V;else return;V?V.prev=ie:ie&&(this._drawLast=ie),I.prev=null,I.next=this._drawFirst,this._drawFirst.prev=I,this._drawFirst=I,this._requestRedraw(b)}}});function nu(b){return Ti.canvas?new eo(b):null}var Jt=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(b){return document.createElement("<lvml:"+b+' class="lvml">')}}catch{}return function(b){return document.createElement("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),au={_initContainer:function(){this._container=gn("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Bo.prototype._update.call(this),this.fire("update"))},_initPath:function(b){var I=b._container=Jt("shape");Dn(I,"leaflet-vml-shape "+(this.options.className||"")),I.coordsize="1 1",b._path=Jt("path"),I.appendChild(b._path),this._updateStyle(b),this._layers[C(b)]=b},_addPath:function(b){var I=b._container;this._container.appendChild(I),b.options.interactive&&b.addInteractiveTarget(I)},_removePath:function(b){var I=b._container;an(I),b.removeInteractiveTarget(I),delete this._layers[C(b)]},_updateStyle:function(b){var I=b._stroke,V=b._fill,ie=b.options,ge=b._container;ge.stroked=!!ie.stroke,ge.filled=!!ie.fill,ie.stroke?(I||(I=b._stroke=Jt("stroke")),ge.appendChild(I),I.weight=ie.weight+"px",I.color=ie.color,I.opacity=ie.opacity,ie.dashArray?I.dashStyle=be(ie.dashArray)?ie.dashArray.join(" "):ie.dashArray.replace(/( *, *)/g," "):I.dashStyle="",I.endcap=ie.lineCap.replace("butt","flat"),I.joinstyle=ie.lineJoin):I&&(ge.removeChild(I),b._stroke=null),ie.fill?(V||(V=b._fill=Jt("fill")),ge.appendChild(V),V.color=ie.fillColor||ie.color,V.opacity=ie.fillOpacity):V&&(ge.removeChild(V),b._fill=null)},_updateCircle:function(b){var I=b._point.round(),V=Math.round(b._radius),ie=Math.round(b._radiusY||V);this._setPath(b,b._empty()?"M0 0":"AL "+I.x+","+I.y+" "+V+","+ie+" 0,"+65535*360)},_setPath:function(b,I){b._path.v=I},_bringToFront:function(b){oa(b._container)},_bringToBack:function(b){An(b._container)}},ru=Ti.vml?Jt:mn,Fl=Bo.extend({_initContainer:function(){this._container=ru("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ru("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){an(this._container),rr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Bo.prototype._update.call(this);var b=this._bounds,I=b.getSize(),V=this._container;(!this._svgSize||!this._svgSize.equals(I))&&(this._svgSize=I,V.setAttribute("width",I.x),V.setAttribute("height",I.y)),Sa(V,b.min),V.setAttribute("viewBox",[b.min.x,b.min.y,I.x,I.y].join(" ")),this.fire("update")}},_initPath:function(b){var I=b._path=ru("path");b.options.className&&Dn(I,b.options.className),b.options.interactive&&Dn(I,"leaflet-interactive"),this._updateStyle(b),this._layers[C(b)]=b},_addPath:function(b){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(b._path),b.addInteractiveTarget(b._path)},_removePath:function(b){an(b._path),b.removeInteractiveTarget(b._path),delete this._layers[C(b)]},_updatePath:function(b){b._project(),b._update()},_updateStyle:function(b){var I=b._path,V=b.options;I&&(V.stroke?(I.setAttribute("stroke",V.color),I.setAttribute("stroke-opacity",V.opacity),I.setAttribute("stroke-width",V.weight),I.setAttribute("stroke-linecap",V.lineCap),I.setAttribute("stroke-linejoin",V.lineJoin),V.dashArray?I.setAttribute("stroke-dasharray",V.dashArray):I.removeAttribute("stroke-dasharray"),V.dashOffset?I.setAttribute("stroke-dashoffset",V.dashOffset):I.removeAttribute("stroke-dashoffset")):I.setAttribute("stroke","none"),V.fill?(I.setAttribute("fill",V.fillColor||V.color),I.setAttribute("fill-opacity",V.fillOpacity),I.setAttribute("fill-rule",V.fillRule||"evenodd")):I.setAttribute("fill","none"))},_updatePoly:function(b,I){this._setPath(b,cn(b._parts,I))},_updateCircle:function(b){var I=b._point,V=Math.max(Math.round(b._radius),1),ie=Math.max(Math.round(b._radiusY),1)||V,ge="a"+V+","+ie+" 0 1,0 ",ze=b._empty()?"M0 0":"M"+(I.x-V)+","+I.y+ge+V*2+",0 "+ge+-V*2+",0 ";this._setPath(b,ze)},_setPath:function(b,I){b._path.setAttribute("d",I)},_bringToFront:function(b){oa(b._path)},_bringToBack:function(b){An(b._path)}});Ti.vml&&Fl.include(au);function bc(b){return Ti.svg||Ti.vml?new Fl(b):null}Pa.include({getRenderer:function(b){var I=b.options.renderer||this._getPaneRenderer(b.options.pane)||this.options.renderer||this._renderer;return I||(I=this._renderer=this._createRenderer()),this.hasLayer(I)||this.addLayer(I),I},_getPaneRenderer:function(b){if(b==="overlayPane"||b===void 0)return!1;var I=this._paneRenderers[b];return I===void 0&&(I=this._createRenderer({pane:b}),this._paneRenderers[b]=I),I},_createRenderer:function(b){return this.options.preferCanvas&&nu(b)||bc(b)}});var cd=vc.extend({initialize:function(b,I){vc.prototype.initialize.call(this,this._boundsToLatLngs(b),I)},setBounds:function(b){return this.setLatLngs(this._boundsToLatLngs(b))},_boundsToLatLngs:function(b){return b=_i(b),[b.getSouthWest(),b.getNorthWest(),b.getNorthEast(),b.getSouthEast()]}});function ts(b,I){return new cd(b,I)}Fl.create=ru,Fl.pointsToPath=cn,co.geometryToLayer=zr,co.coordsToLatLng=Fo,co.coordsToLatLngs=Pu,co.latLngToCoords=yl,co.latLngsToCoords=So,co.getFeature=To,co.asFeature=sd,Pa.mergeOptions({boxZoom:!0});var ud=fl.extend({initialize:function(b){this._map=b,this._container=b._container,this._pane=b._panes.overlayPane,this._resetStateTimeout=0,b.on("unload",this._destroy,this)},addHooks:function(){la(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){rr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){an(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(b){if(!b.shiftKey||b.which!==1&&b.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),yo(),mc(),this._startPoint=this._map.mouseEventToContainerPoint(b),la(document,{contextmenu:Do,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(b){this._moved||(this._moved=!0,this._box=gn("div","leaflet-zoom-box",this._container),Dn(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(b);var I=new St(this._point,this._startPoint),V=I.getSize();Sa(this._box,I.min),this._box.style.width=V.x+"px",this._box.style.height=V.y+"px"},_finish:function(){this._moved&&(an(this._box),Aa(this._container,"leaflet-crosshair")),Gc(),hl(),rr(document,{contextmenu:Do,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(b){if(!(b.which!==1&&b.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(w(this._resetState,this),0);var I=new Ft(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(I).fire("boxzoomend",{boxZoomBounds:I})}},_onKeyDown:function(b){b.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Pa.addInitHook("addHandler","boxZoom",ud),Pa.mergeOptions({doubleClickZoom:!0});var uo=fl.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(b){var I=this._map,V=I.getZoom(),ie=I.options.zoomDelta,ge=b.originalEvent.shiftKey?V-ie:V+ie;I.options.doubleClickZoom==="center"?I.setZoom(ge):I.setZoomAround(b.containerPoint,ge)}});Pa.addInitHook("addHandler","doubleClickZoom",uo),Pa.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var wc=fl.extend({addHooks:function(){if(!this._draggable){var b=this._map;this._draggable=new Gi(b._mapPane,b._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),b.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),b.on("zoomend",this._onZoomEnd,this),b.whenReady(this._onZoomEnd,this))}Dn(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Aa(this._map._container,"leaflet-grab"),Aa(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var b=this._map;if(b._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var I=_i(this._map.options.maxBounds);this._offsetLimit=Ht(this._map.latLngToContainerPoint(I.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(I.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;b.fire("movestart").fire("dragstart"),b.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(b){if(this._map.options.inertia){var I=this._lastTime=+new Date,V=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(V),this._times.push(I),this._prunePositions(I)}this._map.fire("move",b).fire("drag",b)},_prunePositions:function(b){for(;this._positions.length>1&&b-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var b=this._map.getSize().divideBy(2),I=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=I.subtract(b).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(b,I){return b-(b-I)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var b=this._draggable._newPos.subtract(this._draggable._startPos),I=this._offsetLimit;b.x<I.min.x&&(b.x=this._viscousLimit(b.x,I.min.x)),b.y<I.min.y&&(b.y=this._viscousLimit(b.y,I.min.y)),b.x>I.max.x&&(b.x=this._viscousLimit(b.x,I.max.x)),b.y>I.max.y&&(b.y=this._viscousLimit(b.y,I.max.y)),this._draggable._newPos=this._draggable._startPos.add(b)}},_onPreDragWrap:function(){var b=this._worldWidth,I=Math.round(b/2),V=this._initialWorldOffset,ie=this._draggable._newPos.x,ge=(ie-I+V)%b+I-V,ze=(ie+I+V)%b-I-V,dt=Math.abs(ge+V)<Math.abs(ze+V)?ge:ze;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=dt},_onDragEnd:function(b){var I=this._map,V=I.options,ie=!V.inertia||b.noInertia||this._times.length<2;if(I.fire("dragend",b),ie)I.fire("moveend");else{this._prunePositions(+new Date);var ge=this._lastPos.subtract(this._positions[0]),ze=(this._lastTime-this._times[0])/1e3,dt=V.easeLinearity,Bt=ge.multiplyBy(dt/ze),Lt=Bt.distanceTo([0,0]),Ri=Math.min(V.inertiaMaxSpeed,Lt),un=Bt.multiplyBy(Ri/Lt),Sn=Ri/(V.inertiaDeceleration*dt),Pn=un.multiplyBy(-Sn/2).round();!Pn.x&&!Pn.y?I.fire("moveend"):(Pn=I._limitOffset(Pn,I.options.maxBounds),pt(function(){I.panBy(Pn,{duration:Sn,easeLinearity:dt,noMoveStart:!0,animate:!0})}))}}});Pa.addInitHook("addHandler","dragging",wc),Pa.mergeOptions({keyboard:!0,keyboardPanDelta:80});var bl=fl.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(b){this._map=b,this._setPanDelta(b.options.keyboardPanDelta),this._setZoomDelta(b.options.zoomDelta)},addHooks:function(){var b=this._map._container;b.tabIndex<=0&&(b.tabIndex="0"),la(b,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),rr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var b=document.body,I=document.documentElement,V=b.scrollTop||I.scrollTop,ie=b.scrollLeft||I.scrollLeft;this._map._container.focus(),window.scrollTo(ie,V)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(b){var I=this._panKeys={},V=this.keyCodes,ie,ge;for(ie=0,ge=V.left.length;ie<ge;ie++)I[V.left[ie]]=[-1*b,0];for(ie=0,ge=V.right.length;ie<ge;ie++)I[V.right[ie]]=[b,0];for(ie=0,ge=V.down.length;ie<ge;ie++)I[V.down[ie]]=[0,b];for(ie=0,ge=V.up.length;ie<ge;ie++)I[V.up[ie]]=[0,-1*b]},_setZoomDelta:function(b){var I=this._zoomKeys={},V=this.keyCodes,ie,ge;for(ie=0,ge=V.zoomIn.length;ie<ge;ie++)I[V.zoomIn[ie]]=b;for(ie=0,ge=V.zoomOut.length;ie<ge;ie++)I[V.zoomOut[ie]]=-b},_addHooks:function(){la(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){rr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(b){if(!(b.altKey||b.ctrlKey||b.metaKey)){var I=b.keyCode,V=this._map,ie;if(I in this._panKeys){if(!V._panAnim||!V._panAnim._inProgress)if(ie=this._panKeys[I],b.shiftKey&&(ie=Qe(ie).multiplyBy(3)),V.options.maxBounds&&(ie=V._limitOffset(Qe(ie),V.options.maxBounds)),V.options.worldCopyJump){var ge=V.wrapLatLng(V.unproject(V.project(V.getCenter()).add(ie)));V.panTo(ge)}else V.panBy(ie)}else if(I in this._zoomKeys)V.setZoom(V.getZoom()+(b.shiftKey?3:1)*this._zoomKeys[I]);else if(I===27&&V._popup&&V._popup.options.closeOnEscapeKey)V.closePopup();else return;Do(b)}}});Pa.addInitHook("addHandler","keyboard",bl),Pa.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Bl=fl.extend({addHooks:function(){la(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){rr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(b){var I=Ju(b),V=this._map.options.wheelDebounceTime;this._delta+=I,this._lastMousePos=this._map.mouseEventToContainerPoint(b),this._startTime||(this._startTime=+new Date);var ie=Math.max(V-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(w(this._performZoom,this),ie),Do(b)},_performZoom:function(){var b=this._map,I=b.getZoom(),V=this._map.options.zoomSnap||0;b._stop();var ie=this._delta/(this._map.options.wheelPxPerZoomLevel*4),ge=4*Math.log(2/(1+Math.exp(-Math.abs(ie))))/Math.LN2,ze=V?Math.ceil(ge/V)*V:ge,dt=b._limitZoom(I+(this._delta>0?ze:-ze))-I;this._delta=0,this._startTime=null,dt&&(b.options.scrollWheelZoom==="center"?b.setZoom(I+dt):b.setZoomAround(this._lastMousePos,I+dt))}});Pa.addInitHook("addHandler","scrollWheelZoom",Bl);var jh=600;Pa.mergeOptions({tapHold:Ti.touchNative&&Ti.safari&&Ti.mobile,tapTolerance:15});var Ru=fl.extend({addHooks:function(){la(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){rr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(b){if(clearTimeout(this._holdTimeout),b.touches.length===1){var I=b.touches[0];this._startPos=this._newPos=new Ct(I.clientX,I.clientY),this._holdTimeout=setTimeout(w(function(){this._cancel(),this._isTapValid()&&(la(document,"touchend",ls),la(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",I))},this),jh),la(document,"touchend touchcancel contextmenu",this._cancel,this),la(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function b(){rr(document,"touchend",ls),rr(document,"touchend touchcancel",b)},_cancel:function(){clearTimeout(this._holdTimeout),rr(document,"touchend touchcancel contextmenu",this._cancel,this),rr(document,"touchmove",this._onMove,this)},_onMove:function(b){var I=b.touches[0];this._newPos=new Ct(I.clientX,I.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(b,I){var V=new MouseEvent(b,{bubbles:!0,cancelable:!0,view:window,screenX:I.screenX,screenY:I.screenY,clientX:I.clientX,clientY:I.clientY});V._simulated=!0,I.target.dispatchEvent(V)}});Pa.addInitHook("addHandler","tapHold",Ru),Pa.mergeOptions({touchZoom:Ti.touch,bounceAtZoomLimits:!0});var Lu=fl.extend({addHooks:function(){Dn(this._map._container,"leaflet-touch-zoom"),la(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Aa(this._map._container,"leaflet-touch-zoom"),rr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(b){var I=this._map;if(!(!b.touches||b.touches.length!==2||I._animatingZoom||this._zooming)){var V=I.mouseEventToContainerPoint(b.touches[0]),ie=I.mouseEventToContainerPoint(b.touches[1]);this._centerPoint=I.getSize()._divideBy(2),this._startLatLng=I.containerPointToLatLng(this._centerPoint),I.options.touchZoom!=="center"&&(this._pinchStartLatLng=I.containerPointToLatLng(V.add(ie)._divideBy(2))),this._startDist=V.distanceTo(ie),this._startZoom=I.getZoom(),this._moved=!1,this._zooming=!0,I._stop(),la(document,"touchmove",this._onTouchMove,this),la(document,"touchend touchcancel",this._onTouchEnd,this),ls(b)}},_onTouchMove:function(b){if(!(!b.touches||b.touches.length!==2||!this._zooming)){var I=this._map,V=I.mouseEventToContainerPoint(b.touches[0]),ie=I.mouseEventToContainerPoint(b.touches[1]),ge=V.distanceTo(ie)/this._startDist;if(this._zoom=I.getScaleZoom(ge,this._startZoom),!I.options.bounceAtZoomLimits&&(this._zoom<I.getMinZoom()&&ge<1||this._zoom>I.getMaxZoom()&&ge>1)&&(this._zoom=I._limitZoom(this._zoom)),I.options.touchZoom==="center"){if(this._center=this._startLatLng,ge===1)return}else{var ze=V._add(ie)._divideBy(2)._subtract(this._centerPoint);if(ge===1&&ze.x===0&&ze.y===0)return;this._center=I.unproject(I.project(this._pinchStartLatLng,this._zoom).subtract(ze),this._zoom)}this._moved||(I._moveStart(!0,!1),this._moved=!0),Zt(this._animRequest);var dt=w(I._move,I,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=pt(dt,this,!0),ls(b)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Zt(this._animRequest),rr(document,"touchmove",this._onTouchMove,this),rr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Pa.addInitHook("addHandler","touchZoom",Lu),Pa.BoxZoom=ud,Pa.DoubleClickZoom=uo,Pa.Drag=wc,Pa.Keyboard=bl,Pa.ScrollWheelZoom=Bl,Pa.TapHold=Ru,Pa.TouchZoom=Lu,l.Bounds=St,l.Browser=Ti,l.CRS=yn,l.Canvas=eo,l.Circle=ad,l.CircleMarker=Ji,l.Class=Di,l.Control=Ks,l.DivIcon=ld,l.DivOverlay=xl,l.DomEvent=Zc,l.DomUtil=qc,l.Draggable=Gi,l.Evented=wt,l.FeatureGroup=$r,l.GeoJSON=co,l.GridLayer=Nl,l.Handler=fl,l.Icon=Sr,l.ImageOverlay=zs,l.LatLng=At,l.LatLngBounds=Ft,l.Layer=Qs,l.LayerGroup=pl,l.LineUtil=td,l.Map=Pa,l.Marker=on,l.Mixin=Pm,l.Path=_l,l.Point=Ct,l.PolyUtil=ed,l.Polygon=vc,l.Polyline=Is,l.Popup=ju,l.PosAnimation=Xc,l.Projection=Hd,l.Rectangle=cd,l.Renderer=Bo,l.SVG=Fl,l.SVGOverlay=Qc,l.TileLayer=tu,l.Tooltip=Gd,l.Transformation=Un,l.Util=jt,l.VideoOverlay=Mh,l.bind=w,l.bounds=Ht,l.canvas=nu,l.circle=en,l.circleMarker=Mu,l.control=wo,l.divIcon=xc,l.extend=f,l.featureGroup=el,l.geoJSON=Jc,l.geoJson=od,l.gridLayer=es,l.icon=nd,l.imageOverlay=tl,l.latLng=Xt,l.latLngBounds=_i,l.layerGroup=Gr,l.map=Au,l.marker=ji,l.point=Qe,l.polygon=Tr,l.polyline=Ef,l.popup=eu,l.rectangle=ts,l.setOptions=le,l.stamp=C,l.svg=bc,l.svgOverlay=Af,l.tileLayer=Ds,l.tooltip=jm,l.transformation=Ui,l.version=u,l.videoOverlay=Ph;var Iu=window.L;l.noConflict=function(){return window.L=Iu,this},window.L=l}))})(Zv,Zv.exports)),Zv.exports}var HB=VB();const xu=Ub(HB);function U0(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var EA={},AA;function GB(){return AA||(AA=1,(function(){function s(a,l,u){function f(i,C){if(!l[i]){if(!a[i]){var P=typeof U0=="function"&&U0;if(!C&&P)return P(i,!0);if(y)return y(i,!0);var D=new Error("Cannot find module '"+i+"'");throw D.code="MODULE_NOT_FOUND",D}var $=l[i]={exports:{}};a[i][0].call($.exports,function(G){var X=a[i][1][G];return f(X||G)},$,$.exports,s,a,l,u)}return l[i].exports}for(var y=typeof U0=="function"&&U0,w=0;w<u.length;w++)f(u[w]);return f}return s})()({1:[function(s,a,l){function u(f,y,w){var i=!1;if(typeof window.XMLHttpRequest>"u")return y(Error("Browser not supported"));if(typeof w>"u"){var C=f.match(/^\s*https?:\/\/[^\/]*/);w=C&&C[0]!==location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}var P=new window.XMLHttpRequest;function D(X){return X>=200&&X<300||X===304}if(w&&!("withCredentials"in P)){P=new window.XDomainRequest;var $=y;y=function(){if(i)$.apply(this,arguments);else{var X=this,te=arguments;setTimeout(function(){$.apply(X,te)},0)}}}function G(){P.status===void 0||D(P.status)?y.call(P,null,P):y.call(P,P,null)}return"onload"in P?P.onload=G:P.onreadystatechange=function(){P.readyState===4&&G()},P.onerror=function(te){y.call(this,te||!0,null),y=function(){}},P.onprogress=function(){},P.ontimeout=function(X){y.call(this,X,null),y=function(){}},P.onabort=function(X){y.call(this,X,null),y=function(){}},P.open("GET",f,!0),P.send(null),i=!0,P}typeof a<"u"&&(a.exports=u)},{}],2:[function(s,a,l){var u={};function f(i){return Math.floor(Math.abs(i)+.5)*Math.sign(i)}function y(i,C,P){i=f(i*P),C=f(C*P);var D=i-C;D<<=1,i-C<0&&(D=~D);for(var $="";D>=32;)$+=String.fromCharCode((32|D&31)+63),D>>=5;return $+=String.fromCharCode(D+63),$}u.decode=function(i,C){for(var P=0,D=0,$=0,G=[],X=0,te=0,le=null,re,fe,xe=Math.pow(10,C||5);P<i.length;){le=null,X=0,te=0;do le=i.charCodeAt(P++)-63,te|=(le&31)<<X,X+=5;while(le>=32);re=te&1?~(te>>1):te>>1,X=te=0;do le=i.charCodeAt(P++)-63,te|=(le&31)<<X,X+=5;while(le>=32);fe=te&1?~(te>>1):te>>1,D+=re,$+=fe,G.push([D/xe,$/xe])}return G},u.encode=function(i,C){if(!i.length)return"";for(var P=Math.pow(10,C||5),D=y(i[0][0],0,P)+y(i[0][1],0,P),$=1;$<i.length;$++){var G=i[$],X=i[$-1];D+=y(G[0],X[0],P),D+=y(G[1],X[1],P)}return D};function w(i){for(var C=[],P=0;P<i.length;P++)C.push(i[P].slice().reverse());return C}u.fromGeoJSON=function(i,C){if(i&&i.type==="Feature"&&(i=i.geometry),!i||i.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return u.encode(w(i.coordinates),C)},u.toGeoJSON=function(i,C){var P=u.decode(i,C);return{type:"LineString",coordinates:w(P)}},typeof a=="object"&&a.exports&&(a.exports=u)},{}],3:[function(s,a,l){var u=s("./languages"),f=u.instructions,y=u.grammars,w=u.abbreviations;a.exports=function(i){return Object.keys(f).forEach(function(C){if(!f[C][i])throw"invalid version "+i+": "+C+" not supported"}),{capitalizeFirstLetter:function(C,P){return P.charAt(0).toLocaleUpperCase(C)+P.slice(1)},ordinalize:function(C,P){if(!C)throw new Error("No language code provided");return f[C][i].constants.ordinalize[P.toString()]||""},directionFromDegree:function(C,P){if(!C)throw new Error("No language code provided");if(!P&&P!==0)return"";if(P>=0&&P<=20)return f[C][i].constants.direction.north;if(P>20&&P<70)return f[C][i].constants.direction.northeast;if(P>=70&&P<=110)return f[C][i].constants.direction.east;if(P>110&&P<160)return f[C][i].constants.direction.southeast;if(P>=160&&P<=200)return f[C][i].constants.direction.south;if(P>200&&P<250)return f[C][i].constants.direction.southwest;if(P>=250&&P<=290)return f[C][i].constants.direction.west;if(P>290&&P<340)return f[C][i].constants.direction.northwest;if(P>=340&&P<=360)return f[C][i].constants.direction.north;throw new Error("Degree "+P+" invalid")},laneConfig:function(C){if(!C.intersections||!C.intersections[0].lanes)throw new Error("No lanes object");var P=[],D=null;return C.intersections[0].lanes.forEach(function($){(D===null||D!==$.valid)&&($.valid?P.push("o"):P.push("x"),D=$.valid)}),P.join("")},getWayName:function(C,P,D){var $=D?D.classes||[]:[];if(typeof P!="object")throw new Error("step must be an Object");if(!C)throw new Error("No language code provided");if(!Array.isArray($))throw new Error("classes must be an Array or undefined");var G,X=P.name||"",te=(P.ref||"").split(";")[0];X===P.ref&&(X=""),X=X.replace(" ("+P.ref+")","");var le=$.indexOf("motorway")!==-1;if(X&&te&&X!==te&&!le){var re=f[C][i].phrase["name and ref"]||f.en[i].phrase["name and ref"];G=this.tokenize(C,re,{name:X,ref:te},D)}else X&&te&&le&&/\d/.test(te)||!X&&te?G=D&&D.formatToken?D.formatToken("ref",te):te:G=D&&D.formatToken?D.formatToken("name",X):X;return G},compile:function(C,P,D){if(!C)throw new Error("No language code provided");if(u.supportedCodes.indexOf(C)===-1)throw new Error("language code "+C+" not loaded");if(!P.maneuver)throw new Error("No step maneuver provided");var $=D||{},G=P.maneuver.type,X=P.maneuver.modifier,te=P.mode,le=P.driving_side;if(!G)throw new Error("Missing step maneuver type");if(G!=="depart"&&G!=="arrive"&&!X)throw new Error("Missing step maneuver modifier");f[C][i][G]||(console.log("Encountered unknown instruction type: "+G),G="turn");var re;if(f[C][i].modes[te])re=f[C][i].modes[te];else{var fe=G==="off ramp"&&X.indexOf(le)>=0;f[C][i][G][X]&&!fe?re=f[C][i][G][X]:re=f[C][i][G].default}var xe;switch(G){case"use lane":xe=f[C][i].constants.lanes[this.laneConfig(P)],xe||(re=f[C][i]["use lane"].no_lanes);break;case"rotary":case"roundabout":P.rotary_name&&P.maneuver.exit&&re.name_exit?re=re.name_exit:P.rotary_name&&re.name?re=re.name:P.maneuver.exit&&re.exit?re=re.exit:re=re.default;break}var be=this.getWayName(C,P,$),Ne;P.destinations&&P.exits&&re.exit_destination?Ne=re.exit_destination:P.destinations&&re.destination?Ne=re.destination:P.exits&&re.exit?Ne=re.exit:be&&re.name?Ne=re.name:$.waypointName&&re.named?Ne=re.named:Ne=re.default;var Be=P.destinations&&P.destinations.split(": "),Ee=Be&&Be[0].split(",")[0],et=Be&&Be[1]&&Be[1].split(",")[0],at;et&&Ee?at=Ee+": "+et:at=Ee||et||"";var He=$.legIndex>=0&&$.legIndex!==$.legCount-1?this.ordinalize(C,$.legIndex+1):"",lt={way_name:be,destination:at,exit:(P.exits||"").split(";")[0],exit_number:this.ordinalize(C,P.maneuver.exit||1),rotary_name:P.rotary_name,lane_instruction:xe,modifier:f[C][i].constants.modifier[X],direction:this.directionFromDegree(C,P.maneuver.bearing_after),nth:He,waypoint_name:$.waypointName};return this.tokenize(C,Ne,lt,$)},grammarize:function(C,P,D){if(!C)throw new Error("No language code provided");if(P&&D&&y&&y[C]&&y[C][i]){var $=y[C][i][D];if($){var G=" "+P+" ",X=y[C].meta.regExpFlags||"";return $.forEach(function(te){var le=new RegExp(te[0],X);G=G.replace(le,te[1])}),G.trim()}}return P},abbreviations:w,tokenize:function(C,P,D,$){if(!C)throw new Error("No language code provided");var G=this,X=!1,te=P.replace(/\{(\w+)(?::(\w+))?\}/g,function(le,re,fe,xe){var be=D[re];return typeof be>"u"?le:(be=G.grammarize(C,be,fe),xe===0&&f[C].meta.capitalizeFirstLetter&&(X=!0,be=G.capitalizeFirstLetter(C,be)),$&&$.formatToken&&(be=$.formatToken(re,be)),be)}).replace(/ {2}/g," ");return!X&&f[C].meta.capitalizeFirstLetter?this.capitalizeFirstLetter(C,te):te}}}},{"./languages":4}],4:[function(s,a,l){var u=s("./languages/translations/da.json"),f=s("./languages/translations/de.json"),y=s("./languages/translations/en.json"),w=s("./languages/translations/eo.json"),i=s("./languages/translations/es.json"),C=s("./languages/translations/es-ES.json"),P=s("./languages/translations/fi.json"),D=s("./languages/translations/fr.json"),$=s("./languages/translations/he.json"),G=s("./languages/translations/id.json"),X=s("./languages/translations/it.json"),te=s("./languages/translations/ko.json"),le=s("./languages/translations/my.json"),re=s("./languages/translations/nl.json"),fe=s("./languages/translations/no.json"),xe=s("./languages/translations/pl.json"),be=s("./languages/translations/pt-BR.json"),Ne=s("./languages/translations/pt-PT.json"),Be=s("./languages/translations/ro.json"),Ee=s("./languages/translations/ru.json"),et=s("./languages/translations/sv.json"),at=s("./languages/translations/tr.json"),He=s("./languages/translations/uk.json"),lt=s("./languages/translations/vi.json"),pt=s("./languages/translations/zh-Hans.json"),Zt=s("./languages/grammar/fr.json"),jt=s("./languages/grammar/ru.json"),Di=s("./languages/abbreviations/bg.json"),Pi=s("./languages/abbreviations/ca.json"),qe=s("./languages/abbreviations/da.json"),wt=s("./languages/abbreviations/de.json"),Ct=s("./languages/abbreviations/en.json"),Vi=s("./languages/abbreviations/es.json"),Qe=s("./languages/abbreviations/fr.json"),St=s("./languages/abbreviations/he.json"),Ht=s("./languages/abbreviations/hu.json"),Ft=s("./languages/abbreviations/lt.json"),_i=s("./languages/abbreviations/nl.json"),At=s("./languages/abbreviations/ru.json"),Xt=s("./languages/abbreviations/sl.json"),yn=s("./languages/abbreviations/sv.json"),fn=s("./languages/abbreviations/uk.json"),pn=s("./languages/abbreviations/vi.json"),sn={da:u,de:f,en:y,eo:w,es:i,"es-ES":C,fi:P,fr:D,he:$,id:G,it:X,ko:te,my:le,nl:re,no:fe,pl:xe,"pt-BR":be,"pt-PT":Ne,ro:Be,ru:Ee,sv:et,tr:at,uk:He,vi:lt,"zh-Hans":pt},Un={fr:Zt,ru:jt},Ui={bg:Di,ca:Pi,da:qe,de:wt,en:Ct,es:Vi,fr:Qe,he:St,hu:Ht,lt:Ft,nl:_i,ru:At,sl:Xt,sv:yn,uk:fn,vi:pn};a.exports={supportedCodes:Object.keys(sn),instructions:sn,grammars:Un,abbreviations:Ui}},{"./languages/abbreviations/bg.json":5,"./languages/abbreviations/ca.json":6,"./languages/abbreviations/da.json":7,"./languages/abbreviations/de.json":8,"./languages/abbreviations/en.json":9,"./languages/abbreviations/es.json":10,"./languages/abbreviations/fr.json":11,"./languages/abbreviations/he.json":12,"./languages/abbreviations/hu.json":13,"./languages/abbreviations/lt.json":14,"./languages/abbreviations/nl.json":15,"./languages/abbreviations/ru.json":16,"./languages/abbreviations/sl.json":17,"./languages/abbreviations/sv.json":18,"./languages/abbreviations/uk.json":19,"./languages/abbreviations/vi.json":20,"./languages/grammar/fr.json":21,"./languages/grammar/ru.json":22,"./languages/translations/da.json":23,"./languages/translations/de.json":24,"./languages/translations/en.json":25,"./languages/translations/eo.json":26,"./languages/translations/es-ES.json":27,"./languages/translations/es.json":28,"./languages/translations/fi.json":29,"./languages/translations/fr.json":30,"./languages/translations/he.json":31,"./languages/translations/id.json":32,"./languages/translations/it.json":33,"./languages/translations/ko.json":34,"./languages/translations/my.json":35,"./languages/translations/nl.json":36,"./languages/translations/no.json":37,"./languages/translations/pl.json":38,"./languages/translations/pt-BR.json":39,"./languages/translations/pt-PT.json":40,"./languages/translations/ro.json":41,"./languages/translations/ru.json":42,"./languages/translations/sv.json":43,"./languages/translations/tr.json":44,"./languages/translations/uk.json":45,"./languages/translations/vi.json":46,"./languages/translations/zh-Hans.json":47}],5:[function(s,a,l){a.exports={abbreviations:{:"",:"",:"",:"Mkt",:"",:"",:"",:"",:"",:"",:"-",:"",:"-",:"",:"",:"",:"",:"-",:"-",:"-",:"",:"",:"",:"",:"",:".",:"",:"",:"-",:"",:""},classifications:{:"",:"",:"",:"",:"-",:"",:"",:"-",:"-",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},directions:{:"",:"",:"",:"",:"",:"",:""}}},{}],6:[function(s,a,l){a.exports={abbreviations:{comunicacions:"Com.","entitat de poblaci":"Nucli",disseminat:"Diss.","cap de municipi":"Cap",indret:"Indr.",comarca:"Cca.","relleu del litoral":"Lit.",municipi:"Mun.","xarxa hidrogrfica":"Curs Fluv.",equipament:"Equip.",orografia:"Orogr.",barri:"Barri",edificaci:"Edif.","edificaci histrica":"Edif. Hist.","entitat descentralitzada":"E.M.D.","element hidrogrfic":"Hidr."},classifications:{rotonda:"Rot.",carrerada:"Ca.",jard:"J.",paratge:"Pge.",pont:"Pont",lloc:"Lloc",rambla:"Rbla.",cases:"Cses.",barranc:"Bnc.",plana:"Plana",polgon:"Pol.",muralla:"Mur.",enlla:"Ella","antiga carretera":"Actra",glorieta:"Glor.",autovia:"Autv.",prolongaci:"Prol.",calada:"Cda.",carretera:"Ctra.",pujada:"Pda.",torrent:"T.",disseminat:"Disse",barri:"B.",cintur:"Cinto",passera:"Psera",sender:"Send.",carrer:"C.",squia:"Sq.",blocs:"Bloc",rambleta:"Rblt.",partida:"Par.",costa:"Cos.",sector:"Sec.",corral:"Crral",urbanitzaci:"Urb.",autopista:"Autp.",grup:"Gr.",platja:"Pja.",jardins:"J.",complex:"Comp.",portals:"Ptals",finca:"Fin.",travessera:"Trav.",plaa:"Pl.",travessia:"Trv.","polgon industrial":"PI.",passatge:"Ptge.",apartaments:"Apmt.",mirador:"Mira.",antic:"Antic",accs:"Acc.",colnia:"Col.",corriol:"Crol.",portal:"Ptal.",porta:"Pta.",port:"Port",carrer:"Cr.",riera:"Ra.","circumvallaci":"Cval.",baixada:"Bda.",placeta:"Plta.",escala:"Esc.","gran via":"GV",rial:"Rial",conjunt:"Conj.",avinguda:"Av.",esplanada:"Esp.",cantonada:"Cant.",ronda:"Rda.",corredor:"Cdor.",drecera:"Drec.",passads:"Pds.",viaducte:"Vdct.",passeig:"Pg.",venat:"Ve."},directions:{sudest:"SE",sudoest:"SO",nordest:"NE",nordoest:"NO",est:"E",nord:"N",oest:"O",sud:"S"}}},{}],7:[function(s,a,l){a.exports={abbreviations:{skole:"Sk.",ved:"v.",centrum:"C.",sankt:"Skt.",vestre:"v.",hospital:"Hosp.",strde:"Str.",nordre:"Nr.",plads:"Pl.",universitet:"Uni.",vnge:"vg.",station:"St."},classifications:{avenue:"Ave",gammel:"Gl.",dronning:"Dronn.",snder:"Sdr.",nrre:"Nr.",vester:"V.",vestre:"V.",ster:".",stre:".",boulevard:"Boul."},directions:{sydst:"S",nordvest:"NV",syd:"S",nordst:"N",sydvest:"SV",vest:"V",nord:"N",st:""}}},{}],8:[function(s,a,l){a.exports={abbreviations:{},classifications:{},directions:{osten:"O",nordosten:"NO",sden:"S",nordwest:"NW",norden:"N",sdost:"SO",sdwest:"SW",westen:"W"}}},{}],9:[function(s,a,l){a.exports={abbreviations:{square:"Sq",centre:"Ctr",sister:"Sr",lake:"Lk",fort:"Ft",route:"Rte",william:"Wm",national:"Natl",junction:"Jct",center:"Ctr",saint:"St",saints:"SS",station:"Sta",mount:"Mt",junior:"Jr",mountain:"Mtn",heights:"Hts",university:"Univ",school:"Sch",international:"Intl",apartments:"Apts",crossing:"Xing",creek:"Crk",township:"Twp",downtown:"Dtwn",father:"Fr",senior:"Sr",point:"Pt",river:"Riv",market:"Mkt",village:"Vil",park:"Pk",memorial:"Mem"},classifications:{place:"Pl",circle:"Cir",bypass:"Byp",motorway:"Mwy",crescent:"Cres",road:"Rd",cove:"Cv",lane:"Ln",square:"Sq",street:"St",freeway:"Fwy",walk:"Wk",plaza:"Plz",parkway:"Pky",avenue:"Ave",pike:"Pk",drive:"Dr",highway:"Hwy",footway:"Ftwy",point:"Pt",court:"Ct",terrace:"Ter",walkway:"Wky",alley:"Aly",expressway:"Expy",bridge:"Br",boulevard:"Blvd",turnpike:"Tpk"},directions:{southeast:"SE",northwest:"NW",south:"S",west:"W",southwest:"SW",north:"N",east:"E",northeast:"NE"}}},{}],10:[function(s,a,l){a.exports={abbreviations:{segunda:"2",octubre:"8bre",doctores:"Drs",doctora:"Dra",internacional:"Intl",doctor:"Dr",segundo:"2",seorita:"Srta",doctoras:"Drs",primera:"1",primero:"1",san:"S",colonia:"Col",doa:"Da",septiembre:"7bre",diciembre:"10bre",seor:"Sr",ayuntamiento:"Ayto",seora:"Sra",tercera:"3",tercero:"3",don:"D",santa:"Sta",ciudad:"Cdad",noviembre:"9bre",departamento:"Dep"},classifications:{camino:"Cmno",avenida:"Av",paseo:"P",autopista:"Auto",calle:"C",plaza:"Pza",carretera:"Crta"},directions:{este:"E",noreste:"NE",sur:"S",suroeste:"SO",noroeste:"NO",oeste:"O",sureste:"SE",norte:"N"}}},{}],11:[function(s,a,l){a.exports={abbreviations:{alle:"All",arodrome:"Arod",aroport:"Arop"},classifications:{centrale:"Ctrale",campings:"Camp.",urbains:"Urb.",mineure:"Min.",publique:"Publ.",suprieur:"Sup.",fdration:"Fd.","notre-dame":"ND",saint:"St","centre hospitalier rgional":"CHR",exploitation:"Exploit.",gnral:"Gal",civiles:"Civ.",maritimes:"Marit.",aviation:"Aviat.",iii:"3",archologique:"Archo.",musical:"Music.",musicale:"Music.",immeuble:"Imm.",xv:"15",htel:"Ht.",alpine:"Alp.",communale:"Commun.",v:"5",global:"Glob.",universit:"Univ.",confdral:"Confd.",xx:"20",x:"10",piscine:"Pisc.",dimanche:"di.",fleuve:"Flv",postaux:"Post.",musicienne:"Music.",dpartement:"Dpt",fvrier:"Fvr.",municipales:"Munic.",province:"Prov.",communauts:"Commts",barrage:"Barr.",mercredi:"me.",prsidentes:"Pdtes",caftrias:"Caft.",thtral:"Th.",viticulteur:"Vitic.",poste:"Post.",spcialise:"Spc.",agriculture:"Agric.",infirmier:"Infirm.",animation:"Anim.",mondiale:"Mond.",arrt:"Arr.",zone:"zon.",municipaux:"Munic.",grand:"Gd",janvier:"Janv.",fondateur:"Fond.",premire:"1re",municipale:"Munic.",direction:"Dir.",anonyme:"Anon.",dpartementale:"Dpt",moyens:"Moy.",novembre:"Nov.",jardin:"Jard.",petites:"Pet.",priv:"Priv.",centres:"Ctres",forestier:"Forest.",xiv:"14",africaines:"Afric.",sergent:"Sgt",europenne:"Eur.",prive:"Priv.",caf:"Cf",xix:"19",hautes:"Htes",major:"Mjr",vendredi:"ve.",municipalit:"Munic.","sous-prfecture":"Ss-prf.",spciales:"Spc.",secondaires:"Second.",viie:"7e",moyenne:"Moy.",commerciale:"Commerc.",rgion:"Rg.",amricaines:"Amr.",amricains:"Amr.",service:"Sce",professeur:"Prof.",dpartemental:"Dpt",htels:"Ht.",mondiales:"Mond.",ire:"1re",caporal:"Capo.",militaire:"Milit.","lyce d'enseignement professionnel":"LEP",adjudant:"Adj.",mdicale:"Md.",confrences:"Confr.",universelle:"Univ.",xiie:"12e",suprieures:"Sup.",naturel:"Natur.","socit nationale":"SN",hospitalier:"Hosp.",culturelle:"Cult.",amricain:"Amr.","son altesse royale":"S.A.R.",infirmire:"Infirm.",viii:"8",fondatrice:"Fond.",madame:"Mme",mtropolitain:"Mtrop.",ophtalmologues:"Ophtalmos",xviie:"18e",viiie:"8e",commerante:"Commer.","centre d'enseignement du second degr":"CES",septembre:"Sept.",agriculteur:"Agric.",xiii:"13",pontifical:"Pontif.",caftria:"Caft.",prince:"Pce",vie:"6e",archiduchesse:"Archid.",occidental:"Occ.",spectacles:"Spect.",camping:"Camp.",mtro:"M",arrondissement:"Arrond.",viticole:"Vitic.",ii:"2",sicle:"Si.",chapelles:"Chap.",centre:"Ctre","sapeur-pompiers":"Sap.-pomp.",tablissements:"tabts","socit anonyme":"SA",directeurs:"Dir.",vii:"7",culturel:"Cult.",central:"Ctral",mtropolitaine:"Mtrop.",administrations:"Admin.",amiraux:"Amir.",sur:"s/",premiers:"1ers","provence-alpes-cte d'azur":"PACA",cathdrale:"Cathd.",iv:"4",postale:"Post.",social:"Soc.",spcialis:"Spc.",district:"Distr.",technologique:"Techno.",viticoles:"Vitic.",ix:"9",protgs:"Prot.",historiques:"Hist.",sous:"s/s",national:"Nal",ambassade:"Amb.",cafs:"Cfs",agronomie:"Agro.",sapeurs:"Sap.",petits:"Pet.",monsieur:"M.",boucher:"Bouch.",restaurant:"Restau.",lyce:"Lyc.",urbaine:"Urb.",prfecture:"Prf.",districts:"Distr.",civil:"Civ.",protges:"Prot.",sapeur:"Sap.",thtre:"Th.",collge:"Coll.",mardi:"ma.",mmorial:"Mmor.",africain:"Afric.",rpublicaine:"Rpubl.",sociale:"Soc.",spcial:"Spc.",technologie:"Techno.",charcuterie:"Charc.",commerces:"Commerc.",fluviale:"Flv",parachutistes:"Para.",primaires:"Prim.",directions:"Dir.",prsidentiel:"Pdtl",nationales:"Nales",aprs:"apr.",samedi:"sa.",unit:"U.",xxiii:"23",associ:"Assoc.",lectrique:"lectr.",populaire:"Pop.",asiatique:"Asiat.",navigable:"Navig.",prsidente:"Pdte",xive:"14e",associs:"Assoc.",pompiers:"Pomp.",agricoles:"Agric.",lm:"lm.",dcembre:"Dc.","son altesse":"S.Alt.","aprs-midi":"a.-m.",mineures:"Min.",juillet:"Juil.",aviatrices:"Aviat.",fondation:"Fond.",pontificaux:"Pontif.",temple:"Tple",europennes:"Eur.",rgionale:"Rg.",informations:"Infos",mondiaux:"Mond.",infanterie:"Infant.",archologie:"Archo.",dans:"d/",hospice:"Hosp.",spectacle:"Spect.","htels-restaurants":"Ht.-Rest.","htel-restaurant":"Ht.-Rest.",hlicoptre:"hlico",xixe:"19e",cliniques:"Clin.",docteur:"Dr",secondaire:"Second.",municipal:"Munic.",gnrale:"Gale",chteau:"Cht.",commerant:"Commer.",avril:"Avr.",clinique:"Clin.",urbaines:"Urb.",navale:"Nav.",navigation:"Navig.",asiatiques:"Asiat.",pontificales:"Pontif.",administrative:"Admin.",syndicat:"Synd.",lundi:"lu.",petite:"Pet.",maritime:"Marit.",mtros:"M",enseignement:"Enseign.",fluviales:"Flv",historique:"Hist.",comts:"Cts",rsidentiel:"Rsid.",international:"Int.",suprieure:"Sup.","centre hospitalier universitaire":"CHU",confdration:"Confd.",boucherie:"Bouch.",fondatrices:"Fond.",mdicaux:"Md.",europens:"Eur.",orientaux:"Ori.",naval:"Nav.",tang:"tg",provincial:"Prov.",junior:"Jr",dpartementales:"Dpt",musique:"Musiq.",directrices:"Dir.",marchal:"Mal",civils:"Civ.",protg:"Prot.",tablissement:"tabt",trafic:"Traf.",aviateur:"Aviat.",archives:"Arch.",africains:"Afric.",maternelle:"Matern.",industrielle:"Ind.",administratif:"Admin.",oriental:"Ori.",universitaire:"Univ.",majeur:"Maj.",haute:"Hte",communal:"Commun.",petit:"Pet.",commune:"Commun.",exploitant:"Exploit.",confrence:"Confr.",monseigneur:"Mgr",pharmacien:"Pharm.",jeudi:"je.",primaire:"Prim.",hlicoptres:"hlicos",agronomique:"Agro.",mdecin:"Md.",ve:"5e",pontificale:"Pontif.",ier:"1er",cinma:"Cin",fluvial:"Flv",occidentaux:"Occ.",commerants:"Commer.",banque:"Bq",moyennes:"Moy.",pharmacienne:"Pharm.",dmocratique:"Dm.",cinmas:"Cins",spciale:"Spc.",prsidents:"Pdts",directrice:"Dir.",vi:"6",basse:"Bas.",xve:"15e",tat:".",aviateurs:"Aviat.",majeurs:"Maj.",infirmiers:"Infirm.",glise:"gl.",confdrale:"Confd.",xxie:"21e",comte:"Cte",europen:"Eur.",union:"U.",pharmacie:"Pharm.",infirmires:"Infirm.",comt:"Ct",sportive:"Sport.",deuxime:"2e",xvi:"17",haut:"Ht",mdicales:"Md.",dvelopp:"Dvelop.",btiment:"Bt.",commerce:"Commerc.",ive:"4e",associatif:"Assoc.",rural:"Rur.",cimetire:"Cim.",rgional:"Rg.",ferroviaire:"Ferr.",vers:"v/",mosque:"Mosq.",mineurs:"Min.",nautique:"Naut.",chteaux:"Cht.",sportif:"Sport.",mademoiselle:"Mle",cole:"c.",doyen:"Doy.",industriel:"Ind.",chapelle:"Chap.",socits:"Sts",internationale:"Int.",coopratif:"Coop.",hospices:"Hosp.",xxii:"22",parachutiste:"Para.",alpines:"Alp.",civile:"Civ.",xvie:"17e",tats:".",muse:"Mse",centrales:"Ctrales",globaux:"Glob.",suprieurs:"Sup.",syndicats:"Synd.",archevque:"Archev.",docteurs:"Drs",bibliothque:"Biblio.",lieutenant:"Lieut.",rpublique:"Rp.",vtrinaire:"Vt.",dpartementaux:"Dpt",premier:"1er",fluviaux:"Flv",anim:"Anim.",orientales:"Ori.",technologiques:"Techno.",princesse:"Pse",routire:"Rout.",cooprative:"Coop.",scolaire:"Scol.",coles:"c.",football:"Foot",territoriale:"Territ.",commercial:"Commerc.",mineur:"Min.",millnaires:"Mill.",association:"Assoc.",catholique:"Cathol.",administration:"Admin.",mairie:"Mair.",portuaire:"Port.",tertiaires:"Terti.",thtrale:"Th.",palais:"Pal.",troisime:"3e",directeur:"Dir.",vtrinaires:"Vt.",facult:"Fac.",occidentales:"Occ.",viticulteurs:"Vitic.",xvii:"18",occidentale:"Occ.",amiral:"Amir.",professionnel:"Profess.",administratives:"Admin.",commerciales:"Commerc.",saints:"Sts",agronomes:"Agro.",stade:"Std","sous-prfet":"Ss-prf.",senior:"Sr",agronome:"Agro.",terrain:"Terr.",catholiques:"Cathol.",rsidentielle:"Rsid.",grands:"Gds",exploitants:"Exploit.",xiiie:"13e",croix:"Cx",gnraux:"Gaux",crdit:"Crd.",cimetires:"Cim.",antenne:"Ant.",mdical:"Md.",collges:"Coll.",musicien:"Music.",apostolique:"Apost.",postal:"Post.",territorial:"Territ.",urbanisme:"Urb.",prfectorale:"Prf.",fondateurs:"Fond.",information:"Info.",glises:"gl.",ophtalmologue:"Ophtalmo",congrgation:"Congrg.",charcutier:"Charc.",tage:"t.",consulat:"Consul.",public:"Publ.",ferre:"Ferr.",matin:"mat.","socit anonyme  responsabilit limite":"SARL",monuments:"Mmts",protection:"Prot.",universel:"Univ.",nationale:"Nale",prsident:"Pdt",provinciale:"Prov.",agriculteurs:"Agric.",prfectoral:"Prf.",xxe:"20e",alpins:"Alp.",avant:"av.",infirmerie:"Infirm.","deux mil":"2000",rurale:"Rur.",administratifs:"Admin.",octobre:"Oct.",archipel:"Archip.",communaut:"Commt",globales:"Glob.",alpin:"Alp.",numros:"N","lieutenant-colonel":"Lieut.-Col.","jsus-christ":"J.-C.",agricole:"Agric.","sa majest":"S.Maj.",associative:"Assoc.",xxi:"21",prsidentielle:"Pdtle",moyen:"Moy.",fdral:"Fd.",professionnelle:"Profess.",tertiaire:"Terti.",ixe:"9e",hpital:"Hp.",technologies:"Techno.",iiie:"3e",dveloppement:"Dvelop.",monument:"Mmt",forestire:"Forest.",numro:"N",viticulture:"Vitic.",traversire:"Traver.",technique:"Tech.",lectriques:"lectr.",militaires:"Milit.",pompier:"Pomp.",amricaine:"Amr.",prfet:"Prf.",congrgations:"Congrg.",ptissier:"Ptiss.",mondial:"Mond.",ophtalmologie:"Ophtalm.",sainte:"Ste",africaine:"Afric.",aviatrice:"Aviat.",doyens:"Doy.",socit:"St",majeures:"Maj.",orientale:"Ori.",ministre:"Min.",archiduc:"Archid.",territoire:"Territ.",techniques:"Tech.","le-de-france":"IDF",globale:"Glob.",xe:"10e",xie:"11e",majeure:"Maj.",commerciaux:"Commerc.",maire:"Mair.",spciaux:"Spc.",grande:"Gde",messieurs:"MM",colonel:"Col.",millnaire:"Mill.",xi:"11",urbain:"Urb.",fdrale:"Fd.",ferr:"Ferr.",rivire:"Riv.",rpublicain:"Rpubl.",grandes:"Gdes",rgiment:"Rgim.",hauts:"Hts",catgorie:"Catg.",basses:"Bas.",xii:"12",agronomiques:"Agro.",iie:"2e",protge:"Prot.","sapeur-pompier":"Sap.-pomp."},directions:{"est-nord-est":"ENE","nord-est":"NE",ouest:"O","sud-est":"SE","est-sud-est":"ESE","nord-nord-est":"NNE",sud:"S","nord-nord-ouest":"NNO","nord-ouest":"NO",nord:"N","ouest-sud-ouest":"OSO","ouest-nord-ouest":"ONO","sud-ouest":"SO","sud-sud-est":"SSE","sud-sud-ouest":"SSO",est:"E"}}},{}],12:[function(s,a,l){a.exports={abbreviations:{:"'"},classifications:{},directions:{}}},{}],13:[function(s,a,l){a.exports={abbreviations:{},classifications:{},directions:{kelet:"K",szakkelet:"K",dl:"D",szaknyugat:"NY",szak:"",dlkelet:"DK",dlnyugat:"DNY",nyugat:"NY"}}},{}],14:[function(s,a,l){a.exports={abbreviations:{apartamentai:"Apt",auktumos:"Auk",centras:"Ctr",eeras:"E",fortas:"Ft",greitkelis:"Grtkl",juosta:"Jst",kaimas:"Km",kalnas:"Kln",kelias:"Kl",kiemelis:"Kml",miestelis:"Mstl","miesto centras":"M.Ctr",mokykla:"Mok",nacionalinis:"Nac",paminklas:"Pmkl",parkas:"Pk",pusratis:"Psrt",sankrya:"Skr",ses:"Ses",skveras:"Skv",stotis:"St",v:"v",tarptautinis:"Trptaut",takas:"Tk",tvas:"Tv",turgus:"Tgs",universitetas:"Univ",up:"Up",upelis:"Up",vieta:"Vt"},classifications:{aikt:"a.",alja:"al.",aplinkkelis:"aplinkl.",autostrada:"auto.",bulvaras:"b.",gatv:"g.",kelias:"kel.",krantin:"krant.",prospektas:"pr.",plentas:"pl.",skersgatvis:"skg.",takas:"tak.",tiltas:"tlt."},directions:{piets:"P",vakarai:"V",iaur:"","iaurs vakarai":"V",pietryiai:"PR","iaurs rytai":"R",rytai:"R",pietvakariai:"PV"}}},{}],15:[function(s,a,l){a.exports={abbreviations:{centrum:"Cntrm",nationaal:"Natl",berg:"Brg",meer:"Mr",kruising:"Krsng",toetreden:"Ttrdn"},classifications:{bypass:"Pass",brug:"Br",straat:"Str",rechtbank:"Rbank",snoek:"Snk",autobaan:"Baan",terras:"Trrs",punt:"Pt",plaza:"Plz",rijden:"Rijd",parkway:"Pky",inham:"Nham",snelweg:"Weg","halve maan":"Maan",cirkel:"Crkl",laan:"Ln",rijbaan:"Strook",weg:"Weg",lopen:"Lpn",autoweg:"Weg",boulevard:"Blvd",plaats:"Plts",steeg:"Stg",voetpad:"Stoep"},directions:{noordoost:"NO",westen:"W",zuiden:"Z",zuidwest:"ZW",oost:"O",zuidoost:"ZO",noordwest:"NW",noorden:"N"}}},{}],16:[function(s,a,l){a.exports={abbreviations:{:".",:".",:"",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:".",:"."},classifications:{:"-",:".",:".",:".",:".",:".",:".",:".",:"."},directions:{:"","-":"","-":"","-":"","-":"",:"",:"",:""}}},{}],17:[function(s,a,l){a.exports={abbreviations:{},classifications:{},directions:{vzhod:"V",severovzhod:"SV",jug:"J",severozahod:"SZ",sever:"S",jugovzhod:"JV",jugozahod:"JZ",zahod:"Z"}}},{}],18:[function(s,a,l){a.exports={abbreviations:{sankta:"s:ta",gamla:"G:la",sankt:"s:t"},classifications:{Bro:"Br"},directions:{norr:"N",sydst:"SO",vster:"V",ster:"O",nordvst:"NV",sydvst:"SV",sder:"S",nordst:"NO"}}},{}],19:[function(s,a,l){a.exports={abbreviations:{},classifications:{},directions:{:""," ":"",:""," ":"",:""," ":""," ":"",:""}}},{}],20:[function(s,a,l){a.exports={abbreviations:{"vin bo tng":"VBT","th trn":"Tt","i hc":"H","cn c khng quan":"CCKQ","cu lc b":"CLB","bu in":"B","khch sn":"KS","khu du lch":"KDL","khu cng nghip":"KCN","khu ngh mt":"KNM","th x":"Tx","khu chung c":"KCC","phi trng":"PT","trung tm":"TT","tng cng ty":"TCty","trung hc c s":"THCS","sn bay quc t":"SBQT","trung hc ph thng":"THPT","cao ng":"C","cng ty":"Cty","sn bay":"SB","thnh ph":"Tp","cng vin":"CV","sn vn ng":"SV","linh mc":"LM","vn quc gia":"VQG"},classifications:{"huyn l":"HL","ng tnh":"T","quc l":"QL","xa l":"XL","hng l":"HL","tnh l":"TL","ng huyn":"H","ng cao tc":"CT","i l":"L","vit nam":"VN","qung trng":"QT","ng b":"B"},directions:{ty:"T",nam:"N","ng nam":"N","ng bc":"B","ty nam":"TN",ng:"",bc:"B"}}},{}],21:[function(s,a,l){a.exports={meta:{regExpFlags:"gi"},v5:{article:[["^ Acc[e]s "," laccs "],["^ Aire "," laire "],["^ All[e]e "," lalle "],["^ Anse "," lanse "],["^ (L['])?Autoroute "," lautoroute "],["^ Avenue "," lavenue "],["^ Barreau "," le barreau "],["^ Boulevard "," le boulevard "],["^ Chemin "," le chemin "],["^ Petit[\\- ]Chemin "," le petit chemin "],["^ Cit[e] "," la cit "],["^ Clos "," le clos "],["^ Corniche "," la corniche "],["^ Cour "," la cour "],["^ Cours "," le cours "],["^ D[e]viation "," la dviation "],["^ Entr[e]e "," lentre "],["^ Esplanade "," lesplanade "],["^ Galerie "," la galerie "],["^ Impasse "," limpasse "],["^ Lotissement "," le lotissement "],["^ Mont[e]e "," la monte "],["^ Parc "," le parc "],["^ Parvis "," le parvis "],["^ Passage "," le passage "],["^ Place "," la place "],["^ Petit[\\- ]Pont "," le petit-pont "],["^ Pont "," le pont "],["^ Promenade "," la promenade "],["^ Quai "," le quai "],["^ Rocade "," la rocade "],["^ Rond[\\- ]?Point "," le rond-point "],["^ Route "," la route "],["^ Rue "," la rue "],["^ Grande Rue "," la grande rue "],["^ Sente "," la sente "],["^ Sentier "," le sentier "],["^ Sortie "," la sortie "],["^ Souterrain "," le souterrain "],["^ Square "," le square "],["^ Terrasse "," la terrasse "],["^ Traverse "," la traverse "],["^ Tunnel "," le tunnel "],["^ Viaduc "," le viaduc "],["^ Villa "," la villa "],["^ Village "," le village "],["^ Voie "," la voie "],[" ([dl])'"," $1"]],preposition:[["^ Le ","  du "],["^ Les ","  des "],["^ La ","  de La "],["^ Acc[e]s ","  de laccs "],["^ Aire ","  de laire "],["^ All[e]e ","  de lalle "],["^ Anse ","  de lanse "],["^ (L['])?Autoroute ","  de lautoroute "],["^ Avenue ","  de lavenue "],["^ Barreau ","  du barreau "],["^ Boulevard ","  du boulevard "],["^ Chemin ","  du chemin "],["^ Petit[\\- ]Chemin ","  du petit chemin "],["^ Cit[e] ","  de la cit "],["^ Clos ","  du clos "],["^ Corniche ","  de la corniche "],["^ Cour ","  de la cour "],["^ Cours ","  du cours "],["^ D[e]viation ","  de la dviation "],["^ Entr[e]e ","  de lentre "],["^ Esplanade ","  de lesplanade "],["^ Galerie ","  de la galerie "],["^ Impasse ","  de limpasse "],["^ Lotissement ","  du lotissement "],["^ Mont[e]e ","  de la monte "],["^ Parc ","  du parc "],["^ Parvis ","  du parvis "],["^ Passage ","  du passage "],["^ Place ","  de la place "],["^ Petit[\\- ]Pont ","  du petit-pont "],["^ Pont ","  du pont "],["^ Promenade ","  de la promenade "],["^ Quai ","  du quai "],["^ Rocade ","  de la rocade "],["^ Rond[\\- ]?Point ","  du rond-point "],["^ Route ","  de la route "],["^ Rue ","  de la rue "],["^ Grande Rue ","  de la grande rue "],["^ Sente ","  de la sente "],["^ Sentier ","  du sentier "],["^ Sortie ","  de la sortie "],["^ Souterrain ","  du souterrain "],["^ Square ","  du square "],["^ Terrasse ","  de la terrasse "],["^ Traverse ","  de la traverse "],["^ Tunnel ","  du tunnel "],["^ Viaduc ","  du viaduc "],["^ Villa ","  de la villa "],["^ Village ","  du village "],["^ Voie ","  de la voie "],["^ ([AEIOUY])","  d$1"],["^ (\\S)","  de $1"],[" ([dl])'"," $1"]],rotary:[["^ Le ","  le rond-point du "],["^ Les ","  le rond-point des "],["^ La ","  le rond-point de La "],["^ Acc[e]s "," le rond-point de laccs "],["^ Aire ","  le rond-point de laire "],["^ All[e]e ","  le rond-point de lalle "],["^ Anse ","  le rond-point de lanse "],["^ (L['])?Autoroute ","  le rond-point de lautoroute "],["^ Avenue ","  le rond-point de lavenue "],["^ Barreau ","  le rond-point du barreau "],["^ Boulevard ","  le rond-point du boulevard "],["^ Chemin ","  le rond-point du chemin "],["^ Petit[\\- ]Chemin ","  le rond-point du petit chemin "],["^ Cit[e] ","  le rond-point de la cit "],["^ Clos ","  le rond-point du clos "],["^ Corniche ","  le rond-point de la corniche "],["^ Cour ","  le rond-point de la cour "],["^ Cours ","  le rond-point du cours "],["^ D[e]viation ","  le rond-point de la dviation "],["^ Entr[e]e ","  le rond-point de lentre "],["^ Esplanade ","  le rond-point de lesplanade "],["^ Galerie ","  le rond-point de la galerie "],["^ Impasse ","  le rond-point de limpasse "],["^ Lotissement ","  le rond-point du lotissement "],["^ Mont[e]e ","  le rond-point de la monte "],["^ Parc ","  le rond-point du parc "],["^ Parvis ","  le rond-point du parvis "],["^ Passage ","  le rond-point du passage "],["^ Place ","  le rond-point de la place "],["^ Petit[\\- ]Pont ","  le rond-point du petit-pont "],["^ Pont ","  le rond-point du pont "],["^ Promenade ","  le rond-point de la promenade "],["^ Quai ","  le rond-point du quai "],["^ Rocade ","  le rond-point de la rocade "],["^ Rond[\\- ]?Point ","  le rond-point "],["^ Route ","  le rond-point de la route "],["^ Rue ","  le rond-point de la rue "],["^ Grande Rue ","  le rond-point de la grande rue "],["^ Sente ","  le rond-point de la sente "],["^ Sentier ","  le rond-point du sentier "],["^ Sortie ","  le rond-point de la sortie "],["^ Souterrain ","  le rond-point du souterrain "],["^ Square ","  le rond-point du square "],["^ Terrasse ","  le rond-point de la terrasse "],["^ Traverse ","  le rond-point de la traverse "],["^ Tunnel ","  le rond-point du tunnel "],["^ Viaduc ","  le rond-point du viaduc "],["^ Villa ","  le rond-point de la villa "],["^ Village ","  le rond-point du village "],["^ Voie ","  le rond-point de la voie "],["^ ([AEIOUY])","  le rond-point d$1"],["^ (\\S)","  le rond-point de $1"],[" ([dl])'"," $1"]],arrival:[["^ Le ","  au "],["^ Les ","  aux "],["^ La ","   La "],["^ (\\S)","   $1"],[" ([dl])'"," $1"]]}}},{}],22:[function(s,a,l){a.exports={meta:{regExpFlags:""},v5:{accusative:[['^ (["])',"  $1"],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)-(\\S+) [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^  [] ","   "],["^  [] ","   "],["^  [] ","   "],["^ [] ","  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) (\\S+) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ [][] ","  "]],dative:[['^ (["])',"  $1"],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)-(\\S+) [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^  [] ","   "],["^  [] ","   "],["^  [] ","   "],["^ [] ","  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) (\\S+) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)[]-(\\S+)[] [] "," $1-$2  "],["^ (\\d+)- (\\S+)[]-(\\S+)[] [] "," $1- $2-$3  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [] ","  "],["^ (\\S+[])-(\\S+)[] [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) (\\S+)[] [] "," $1- $2 $3  "],["^ (\\d+)- (\\S+)[] (\\S+)[] [] "," $1- $2 $3  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [][] "," $1  "],["^ (\\S+)[] [][] "," $1  "],["^ (\\S+[]) [][] "," $1  "],["^ (\\S+)[] (\\S+) [][] "," $1 $2  "],["^ (\\S+) (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [][] "," $1 $2  "],["^ (\\d+)- (\\S+) [][] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [][] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [][] "," $1- $2  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+[]) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+[]) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\S+) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+[]) ([])?[] "," $1- $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) (\\S+[]) [] "," $1 $2  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],[" ([]) "," $1 "],["([]) ","$1 "],["([]) ","$1 "]],genitive:[['^ (["])',"  $1"],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)-(\\S+) [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^  [] ","   "],["^  [] ","   "],["^  [] ","   "],["^ [] ","  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) (\\S+) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)[]-(\\S+)[] [] "," $1-$2  "],["^ (\\d+)- (\\S+)[]-(\\S+)[] [] "," $1- $2-$3  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [] ","  "],["^ (\\S+[])-(\\S+)[] [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) (\\S+)[] [] "," $1- $2 $3  "],["^ (\\d+)- (\\S+)[] (\\S+)[] [] "," $1- $2 $3  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [][] "," $1  "],["^ (\\S+)[] [][] "," $1  "],["^ (\\S+[]) [][] "," $1  "],["^ (\\S+)[] (\\S+) [][] "," $1 $2  "],["^ (\\S+) (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [][] "," $1 $2  "],["^ (\\d+)- (\\S+) [][] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [][] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [][] "," $1- $2  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+[]) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+[]) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\S+) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+[]) ([])?[] "," $1- $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) (\\S+[]) [] "," $1 $2  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],[" ([]) "," $1 "],["([]) ","$1 "]],prepositional:[['^ (["])',"  $1"],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)-(\\S+) [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^  [] ","   "],["^  [] ","   "],["^  [] ","   "],["^ [] ","  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\d+)-(\\d+)- [] "," $1-$2-  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- [] "," $1-  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) (\\S+) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+) (\\S+) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+)[]-(\\S+)[] [] "," $1-$2  "],["^ (\\d+)- (\\S+)[]-(\\S+)[] [] "," $1- $2-$3  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ [] ","  "],["^ (\\S+[])-(\\S+)[] [] "," $1-$2  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) (\\S+)[] [] "," $1- $2 $3  "],["^ (\\d+)- (\\S+)[] (\\S+)[] [] "," $1- $2 $3  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [][] "," $1  "],["^ (\\S+)[] [][] "," $1  "],["^ (\\S+[]) [][] "," $1  "],["^ (\\S+)[] (\\S+) [][] "," $1 $2  "],["^ (\\S+) (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [][] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [][] "," $1 $2  "],["^ (\\d+)- (\\S+) [][] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [][] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [][] "," $1- $2  "],["^ [][] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+) [] "," $1  "],["^ (\\S+)[] [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+)[] (\\S+) [] "," $1 $2  "],["^ (\\S+) (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+)[] [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\S+)[] (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- [] "," $1-  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],["^ (\\d+)- (\\S+)[] [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ [] ","  "],["^ (\\S+[]) ([])?[] "," $1 $2 "],["^ (\\S+) ([])?[] "," $1 $2 "],["^ (\\S+[]) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\S+) (\\S+[]) ([])?[] "," $1 $2 $3 "],["^ (\\d+)- (\\S+[]) ([])?[] "," $1- $2 $3 "],["^ (\\d+)- (\\S+) ([])?[] "," $1- $2 $3 "],["^ ([])?[] "," $1 "],["^ (\\S+[]) [] "," $1  "],["^ (\\S+) [] "," $1  "],["^ (\\S+[]) (\\S+[]) [] "," $1 $2  "],["^ (\\S+) (\\S+[]) [] "," $1 $2  "],["^ (\\d+)- (\\S+[]) [] "," $1- $2  "],["^ (\\d+)- (\\S+) [] "," $1- $2  "],[" ([]) "," $1 "],["([]) ","$1 "]]}}},{}],23:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"frste",2:"anden",3:"tredje",4:"fjerde",5:"femte",6:"sjette",7:"syvende",8:"ottende",9:"niende",10:"tiende"},direction:{north:"Nord",northeast:"Nordst",east:"st",southeast:"Sydst",south:"Syd",southwest:"Sydvest",west:"Vest",northwest:"Nordvest"},modifier:{left:"venstresving",right:"hjresving","sharp left":"skarpt venstresving","sharp right":"skarpt hjresving","slight left":"svagt venstresving","slight right":"svagt hjresving",straight:"ligeud",uturn:"U-vending"},lanes:{xo:"Hold til hjre",ox:"Hold til venstre",xox:"Benyt midterste spor",oxo:"Hold til hjre eller venstre"}},modes:{ferry:{default:"Tag frgen",name:"Tag frgen {way_name}",destination:"Tag frgen i retning {destination}"}},phrase:{"two linked by distance":"{instruction_one} derefter, efter {distance}, {instruction_two}","two linked":"{instruction_one}, derefter {instruction_two}","one in distance":"Efter {distance} {instruction_one}","name and ref":"{name} ({ref})","exit with number":"afkrsel {exit}"},arrive:{default:{default:"Du er ankommet til din {nth} destination",upcoming:"Du vil ankomme til din {nth} destination",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}"},left:{default:"Du er ankommet til din {nth} destination, som befinder sig til venstre",upcoming:"Du vil ankomme til din {nth} destination p venstre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til venstre"},right:{default:"Du er ankommet til din {nth} destination, som befinder sig til hjre",upcoming:"Du vil ankomme til din {nth} destination p hjre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til hjre"},"sharp left":{default:"Du er ankommet til din {nth} destination, som befinder sig til venstre",upcoming:"Du vil ankomme til din {nth} destination p venstre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til venstre"},"sharp right":{default:"Du er ankommet til din {nth} destination, som befinder sig til hjre",upcoming:"Du vil ankomme til din {nth} destination p hjre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til hjre"},"slight right":{default:"Du er ankommet til din {nth} destination, som befinder sig til hjre",upcoming:"Du vil ankomme til din {nth} destination p hjre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til hjre"},"slight left":{default:"Du er ankommet til din {nth} destination, som befinder sig til venstre",upcoming:"Du vil ankomme til din {nth} destination p venstre hnd",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, som befinder sig til venstre"},straight:{default:"Du er ankommet til din {nth} destination, der befinder sig lige frem",upcoming:"Du vil ankomme til din {nth} destination foran dig",short:"Du er ankommet","short-upcoming":"Du vil ankomme",named:"Du er ankommet til {waypoint_name}, der befinder sig lige frem"}},continue:{default:{default:"Drej til {modifier}",name:"Drej til {modifier} videre ad {way_name}",destination:"Drej til {modifier} mod {destination}",exit:"Drej til {modifier} ad {way_name}"},straight:{default:"Fortst ligeud",name:"Fortst ligeud ad {way_name}",destination:"Fortst mod {destination}",distance:"Fortst {distance} ligeud",namedistance:"Fortst {distance} ad {way_name}"},"sharp left":{default:"Drej skarpt til venstre",name:"Drej skarpt til venstre videre ad {way_name}",destination:"Drej skarpt til venstre mod {destination}"},"sharp right":{default:"Drej skarpt til hjre",name:"Drej skarpt til hjre videre ad {way_name}",destination:"Drej skarpt til hjre mod {destination}"},"slight left":{default:"Drej left til venstre",name:"Drej let til venstre videre ad {way_name}",destination:"Drej let til venstre mod {destination}"},"slight right":{default:"Drej let til hjre",name:"Drej let til hjre videre ad {way_name}",destination:"Drej let til hjre mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending tilbage ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},depart:{default:{default:"Kr mod {direction}",name:"Kr mod {direction} ad {way_name}",namedistance:"Fortst {distance} ad {way_name}mod {direction}"}},"end of road":{default:{default:"Drej til {modifier}",name:"Drej til {modifier} ad {way_name}",destination:"Drej til {modifier} mof {destination}"},straight:{default:"Fortst ligeud",name:"Fortst ligeud ad {way_name}",destination:"Fortst ligeud mod {destination}"},uturn:{default:"Foretag en U-vending for enden af vejen",name:"Foretag en U-vending ad {way_name} for enden af vejen",destination:"Foretag en U-vending mod {destination} for enden af vejen"}},fork:{default:{default:"Hold til {modifier} ved udfletningen",name:"Hold mod {modifier} p {way_name}",destination:"Hold mod {modifier} mod {destination}"},"slight left":{default:"Hold til venstre ved udfletningen",name:"Hold til venstre p {way_name}",destination:"Hold til venstre mod {destination}"},"slight right":{default:"Hold til hjre ved udfletningen",name:"Hold til hjre p {way_name}",destination:"Hold til hjre mod {destination}"},"sharp left":{default:"Drej skarpt til venstre ved udfletningen",name:"Drej skarpt til venstre ad {way_name}",destination:"Drej skarpt til venstre mod {destination}"},"sharp right":{default:"Drej skarpt til hjre ved udfletningen",name:"Drej skarpt til hjre ad {way_name}",destination:"Drej skarpt til hjre mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},merge:{default:{default:"Flet til {modifier}",name:"Flet til {modifier} ad {way_name}",destination:"Flet til {modifier} mod {destination}"},straight:{default:"Flet",name:"Flet ind p {way_name}",destination:"Flet ind mod {destination}"},"slight left":{default:"Flet til venstre",name:"Flet til venstre ad {way_name}",destination:"Flet til venstre mod {destination}"},"slight right":{default:"Flet til hjre",name:"Flet til hjre ad {way_name}",destination:"Flet til hjre mod {destination}"},"sharp left":{default:"Flet til venstre",name:"Flet til venstre ad {way_name}",destination:"Flet til venstre mod {destination}"},"sharp right":{default:"Flet til hjre",name:"Flet til hjre ad {way_name}",destination:"Flet til hjre mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},"new name":{default:{default:"Fortst {modifier}",name:"Fortst {modifier} ad {way_name}",destination:"Fortst {modifier} mod {destination}"},straight:{default:"Fortst ligeud",name:"Fortst ad {way_name}",destination:"Fortst mod {destination}"},"sharp left":{default:"Drej skarpt til venstre",name:"Drej skarpt til venstre ad {way_name}",destination:"Drej skarpt til venstre mod {destination}"},"sharp right":{default:"Drej skarpt til hjre",name:"Drej skarpt til hjre ad {way_name}",destination:"Drej skarpt til hjre mod {destination}"},"slight left":{default:"Fortst til venstre",name:"Fortst til venstre ad {way_name}",destination:"Fortst til venstre mod {destination}"},"slight right":{default:"Fortst til hjre",name:"Fortst til hjre ad {way_name}",destination:"Fortst til hjre mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},notification:{default:{default:"Fortst {modifier}",name:"Fortst {modifier} ad {way_name}",destination:"Fortst {modifier} mod {destination}"},uturn:{default:"Foretag en U-vending",name:"Foretag en U-vending ad {way_name}",destination:"Foretag en U-vending mod {destination}"}},"off ramp":{default:{default:"Tag afkrslen",name:"Tag afkrslen ad {way_name}",destination:"Tag afkrslen mod {destination}",exit:"Vlg afkrsel {exit}",exit_destination:"Vlg afkrsel {exit} mod {destination}"},left:{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}",exit:"Vlg afkrsel {exit} til venstre",exit_destination:`Vlg afkrsel {exit} til venstre mod {destination}
`},right:{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}",exit:"Vlg afkrsel {exit} til hjre",exit_destination:"Vlg afkrsel {exit} til hjre mod {destination}"},"sharp left":{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}",exit:"Vlg afkrsel {exit} til venstre",exit_destination:`Vlg afkrsel {exit} til venstre mod {destination}
`},"sharp right":{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}",exit:"Vlg afkrsel {exit} til hjre",exit_destination:"Vlg afkrsel {exit} til hjre mod {destination}"},"slight left":{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}",exit:"Vlg afkrsel {exit} til venstre",exit_destination:`Vlg afkrsel {exit} til venstre mod {destination}
`},"slight right":{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}",exit:"Vlg afkrsel {exit} til hjre",exit_destination:"Vlg afkrsel {exit} til hjre mod {destination}"}},"on ramp":{default:{default:"Tag afkrslen",name:"Tag afkrslen ad {way_name}",destination:"Tag afkrslen mod {destination}"},left:{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}"},right:{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}"},"sharp left":{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}"},"sharp right":{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}"},"slight left":{default:"Tag afkrslen til venstre",name:"Tag afkrslen til venstre ad {way_name}",destination:"Tag afkrslen til venstre mod {destination}"},"slight right":{default:"Tag afkrslen til hjre",name:"Tag afkrslen til hjre ad {way_name}",destination:"Tag afkrslen til hjre mod {destination}"}},rotary:{default:{default:{default:"Kr ind i rundkrslen",name:"Tag rundkrslen og kr fra ad {way_name}",destination:"Tag rundkrslen og kr mod {destination}"},name:{default:"Kr ind i {rotary_name}",name:"Kr ind i {rotary_name} og kr ad {way_name} ",destination:"Kr ind i {rotary_name} og kr mod {destination}"},exit:{default:"Tag rundkrslen og forlad ved {exit_number} afkrsel",name:"Tag rundkrslen og forlad ved {exit_number} afkrsel ad {way_name}",destination:"Tag rundkrslen og forlad ved {exit_number} afkrsel mod {destination}"},name_exit:{default:"Kr ind i {rotary_name} og forlad ved {exit_number} afkrsel",name:"Kr ind i {rotary_name} og forlad ved {exit_number} afkrsel ad {way_name}",destination:"Kr ind i {rotary_name} og forlad ved {exit_number} afkrsel mod {destination}"}}},roundabout:{default:{exit:{default:"Tag rundkrslen og forlad ved {exit_number} afkrsel",name:"Tag rundkrslen og forlad ved {exit_number} afkrsel ad {way_name}",destination:"Tag rundkrslen og forlad ved {exit_number} afkrsel mod {destination}"},default:{default:"Kr ind i rundkrslen",name:"Tag rundkrslen og kr fra ad {way_name}",destination:"Tag rundkrslen og kr mod {destination}"}}},"roundabout turn":{default:{default:"Foretag et {modifier}",name:"Foretag et {modifier} ad {way_name}",destination:"Foretag et {modifier} mod {destination}"},left:{default:"Drej til venstre",name:"Drej til venstre ad {way_name}",destination:"Drej til venstre mod {destination}"},right:{default:"Drej til hjre",name:"Drej til hjre ad {way_name}",destination:"Drej til hjre mod {destination}"},straight:{default:"Fortst ligeud",name:"Fortst ligeud ad {way_name}",destination:"Fortst ligeud mod {destination}"}},"exit roundabout":{default:{default:"Forlad rundkrslen",name:"Forlad rundkrslen ad {way_name}",destination:"Forlad rundkrslen mod  {destination}"}},"exit rotary":{default:{default:"Forlad rundkrslen",name:"Forlad rundkrslen ad {way_name}",destination:"Forlad rundkrslen mod {destination}"}},turn:{default:{default:"Foretag et {modifier}",name:"Foretag et {modifier} ad {way_name}",destination:"Foretag et {modifier} mod {destination}"},left:{default:"Drej til venstre",name:"Drej til venstre ad {way_name}",destination:"Drej til venstre mod {destination}"},right:{default:"Drej til hjre",name:"Drej til hjre ad {way_name}",destination:"Drej til hjre mod {destination}"},straight:{default:"Fortst ligeud",name:"Kr ligeud ad {way_name}",destination:"Kr ligeud mod {destination}"}},"use lane":{no_lanes:{default:"Fortst ligeud"},default:{default:"{lane_instruction}"}}}}},{}],24:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"erste",2:"zweite",3:"dritte",4:"vierte",5:"fnfte",6:"sechste",7:"siebente",8:"achte",9:"neunte",10:"zehnte"},direction:{north:"Norden",northeast:"Nordosten",east:"Osten",southeast:"Sdosten",south:"Sden",southwest:"Sdwesten",west:"Westen",northwest:"Nordwesten"},modifier:{left:"links",right:"rechts","sharp left":"scharf links","sharp right":"scharf rechts","slight left":"leicht links","slight right":"leicht rechts",straight:"geradeaus",uturn:"180-Wendung"},lanes:{xo:"Rechts halten",ox:"Links halten",xox:"Mittlere Spur nutzen",oxo:"Rechts oder links halten"}},modes:{ferry:{default:"Fhre nehmen",name:"Fhre nehmen {way_name}",destination:"Fhre nehmen Richtung {destination}"}},phrase:{"two linked by distance":"{instruction_one} danach in {distance} {instruction_two}","two linked":"{instruction_one} danach {instruction_two}","one in distance":"In {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Sie haben Ihr {nth} Ziel erreicht",upcoming:"Sie haben Ihr {nth} Ziel erreicht",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}"},left:{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich links"},right:{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich rechts"},"sharp left":{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich links"},"sharp right":{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich rechts"},"slight right":{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich rechts",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich rechts"},"slight left":{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich links",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich links"},straight:{default:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich geradeaus",upcoming:"Sie haben Ihr {nth} Ziel erreicht, es befindet sich geradeaus",short:"Sie haben Ihr {nth} Ziel erreicht","short-upcoming":"Sie haben Ihr {nth} Ziel erreicht",named:"Sie haben Ihr {waypoint_name}, es befindet sich geradeaus"}},continue:{default:{default:"{modifier} abbiegen",name:"{modifier} weiterfahren auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}",exit:"{modifier} abbiegen auf {way_name}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Weiterfahren in Richtung {destination}",distance:"Geradeaus weiterfahren fr {distance}",namedistance:"Geradeaus weiterfahren auf {way_name} fr {distance}"},"sharp left":{default:"Scharf links",name:"Scharf links weiterfahren auf {way_name}",destination:"Scharf links Richtung {destination}"},"sharp right":{default:"Scharf rechts",name:"Scharf rechts weiterfahren auf {way_name}",destination:"Scharf rechts Richtung {destination}"},"slight left":{default:"Leicht links",name:"Leicht links weiter auf {way_name}",destination:"Leicht links weiter Richtung {destination}"},"slight right":{default:"Leicht rechts weiter",name:"Leicht rechts weiter auf {way_name}",destination:"Leicht rechts weiter Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},depart:{default:{default:"Fahren Sie Richtung {direction}",name:"Fahren Sie Richtung {direction} auf {way_name}",namedistance:"Fahren Sie Richtung {direction} auf {way_name} fr {distance}"}},"end of road":{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"},uturn:{default:"180-Wendung am Ende der Strae",name:"180-Wendung auf {way_name} am Ende der Strae",destination:"180-Wendung Richtung {destination} am Ende der Strae"}},fork:{default:{default:"{modifier} halten an der Gabelung",name:"{modifier} halten an der Gabelung auf {way_name}",destination:"{modifier}  halten an der Gabelung Richtung {destination}"},"slight left":{default:"Links halten an der Gabelung",name:"Links halten an der Gabelung auf {way_name}",destination:"Links halten an der Gabelung Richtung {destination}"},"slight right":{default:"Rechts halten an der Gabelung",name:"Rechts halten an der Gabelung auf {way_name}",destination:"Rechts halten an der Gabelung Richtung {destination}"},"sharp left":{default:"Scharf links abbiegen an der Gabelung",name:"Scharf links auf {way_name}",destination:"Scharf links Richtung {destination}"},"sharp right":{default:"Scharf rechts abbiegen an der Gabelung",name:"Scharf rechts auf {way_name}",destination:"Scharf rechts Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},merge:{default:{default:"{modifier} auffahren",name:"{modifier} auffahren auf {way_name}",destination:"{modifier} auffahren Richtung {destination}"},straight:{default:"geradeaus auffahren",name:"geradeaus auffahren auf {way_name}",destination:"geradeaus auffahren Richtung {destination}"},"slight left":{default:"Leicht links auffahren",name:"Leicht links auffahren auf {way_name}",destination:"Leicht links auffahren Richtung {destination}"},"slight right":{default:"Leicht rechts auffahren",name:"Leicht rechts auffahren auf {way_name}",destination:"Leicht rechts auffahren Richtung {destination}"},"sharp left":{default:"Scharf links auffahren",name:"Scharf links auffahren auf {way_name}",destination:"Scharf links auffahren Richtung {destination}"},"sharp right":{default:"Scharf rechts auffahren",name:"Scharf rechts auffahren auf {way_name}",destination:"Scharf rechts auffahren Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},"new name":{default:{default:"{modifier} weiterfahren",name:"{modifier} weiterfahren auf {way_name}",destination:"{modifier} weiterfahren Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Weiterfahren auf {way_name}",destination:"Weiterfahren in Richtung {destination}"},"sharp left":{default:"Scharf links",name:"Scharf links auf {way_name}",destination:"Scharf links Richtung {destination}"},"sharp right":{default:"Scharf rechts",name:"Scharf rechts auf {way_name}",destination:"Scharf rechts Richtung {destination}"},"slight left":{default:"Leicht links weiter",name:"Leicht links weiter auf {way_name}",destination:"Leicht links weiter Richtung {destination}"},"slight right":{default:"Leicht rechts weiter",name:"Leicht rechts weiter auf {way_name}",destination:"Leicht rechts weiter Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},notification:{default:{default:"{modifier} weiterfahren",name:"{modifier} weiterfahren auf {way_name}",destination:"{modifier} weiterfahren Richtung {destination}"},uturn:{default:"180-Wendung",name:"180-Wendung auf {way_name}",destination:"180-Wendung Richtung {destination}"}},"off ramp":{default:{default:"Ausfahrt nehmen",name:"Ausfahrt nehmen auf {way_name}",destination:"Ausfahrt nehmen Richtung {destination}",exit:"Ausfahrt {exit} nehmen",exit_destination:"Ausfahrt {exit} nehmen Richtung {destination}"},left:{default:"Ausfahrt links nehmen",name:"Ausfahrt links nehmen auf {way_name}",destination:"Ausfahrt links nehmen Richtung {destination}",exit:"Ausfahrt {exit} links nehmen",exit_destination:"Ausfahrt {exit} links nehmen Richtung {destination}"},right:{default:"Ausfahrt rechts nehmen",name:"Ausfahrt rechts nehmen Richtung {way_name}",destination:"Ausfahrt rechts nehmen Richtung {destination}",exit:"Ausfahrt {exit} rechts nehmen",exit_destination:"Ausfahrt {exit} nehmen Richtung {destination}"},"sharp left":{default:"Ausfahrt links nehmen",name:"Ausfahrt links Seite nehmen auf {way_name}",destination:"Ausfahrt links nehmen Richtung {destination}",exit:"Ausfahrt {exit} links nehmen",exit_destination:"Ausfahrt{exit} links nehmen Richtung {destination}"},"sharp right":{default:"Ausfahrt rechts nehmen",name:"Ausfahrt rechts nehmen auf {way_name}",destination:"Ausfahrt rechts nehmen Richtung {destination}",exit:"Ausfahrt {exit} rechts nehmen",exit_destination:"Ausfahrt {exit} nehmen Richtung {destination}"},"slight left":{default:"Ausfahrt links nehmen",name:"Ausfahrt links nehmen auf {way_name}",destination:"Ausfahrt links nehmen Richtung {destination}",exit:"Ausfahrt {exit} nehmen",exit_destination:"Ausfahrt {exit} links nehmen Richtung {destination}"},"slight right":{default:"Ausfahrt rechts nehmen",name:"Ausfahrt rechts nehmen auf {way_name}",destination:"Ausfahrt rechts nehmen Richtung {destination}",exit:"Ausfahrt {exit} rechts nehmen",exit_destination:"Ausfahrt {exit} nehmen Richtung {destination}"}},"on ramp":{default:{default:"Auffahrt nehmen",name:"Auffahrt nehmen auf {way_name}",destination:"Auffahrt nehmen Richtung {destination}"},left:{default:"Auffahrt links nehmen",name:"Auffahrt links nehmen auf {way_name}",destination:"Auffahrt links nehmen Richtung {destination}"},right:{default:"Auffahrt rechts nehmen",name:"Auffahrt rechts nehmen auf {way_name}",destination:"Auffahrt rechts nehmen Richtung {destination}"},"sharp left":{default:"Auffahrt links nehmen",name:"Auffahrt links nehmen auf {way_name}",destination:"Auffahrt links nehmen Richtung {destination}"},"sharp right":{default:"Auffahrt rechts nehmen",name:"Auffahrt rechts nehmen auf {way_name}",destination:"Auffahrt rechts nehmen Richtung {destination}"},"slight left":{default:"Auffahrt links Seite nehmen",name:"Auffahrt links nehmen auf {way_name}",destination:"Auffahrt links nehmen Richtung {destination}"},"slight right":{default:"Auffahrt rechts nehmen",name:"Auffahrt rechts nehmen auf {way_name}",destination:"Auffahrt rechts nehmen Richtung {destination}"}},rotary:{default:{default:{default:"In den Kreisverkehr fahren",name:"Im Kreisverkehr die Ausfahrt auf {way_name} nehmen",destination:"Im Kreisverkehr die Ausfahrt Richtung {destination} nehmen"},name:{default:"In {rotary_name} fahren",name:"In {rotary_name} die Ausfahrt auf {way_name} nehmen",destination:"In {rotary_name} die Ausfahrt Richtung {destination} nehmen"},exit:{default:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen",name:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen auf {way_name}",destination:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen Richtung {destination}"},name_exit:{default:"In den Kreisverkehr fahren und {exit_number} Ausfahrt nehmen",name:"In den Kreisverkehr fahren und {exit_number} Ausfahrt nehmen auf {way_name}",destination:"In den Kreisverkehr fahren und {exit_number} Ausfahrt nehmen Richtung {destination}"}}},roundabout:{default:{exit:{default:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen",name:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen auf {way_name}",destination:"Im Kreisverkehr die {exit_number} Ausfahrt nehmen Richtung {destination}"},default:{default:"In den Kreisverkehr fahren",name:"Im Kreisverkehr die Ausfahrt auf {way_name} nehmen",destination:"Im Kreisverkehr die Ausfahrt Richtung {destination} nehmen"}}},"roundabout turn":{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},left:{default:"Links abbiegen",name:"Links abbiegen auf {way_name}",destination:"Links abbiegen Richtung {destination}"},right:{default:"Rechts abbiegen",name:"Rechts abbiegen auf {way_name}",destination:"Rechts abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"}},"exit roundabout":{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},left:{default:"Links abbiegen",name:"Links abbiegen auf {way_name}",destination:"Links abbiegen Richtung {destination}"},right:{default:"Rechts abbiegen",name:"Rechts abbiegen auf {way_name}",destination:"Rechts abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"}},"exit rotary":{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},left:{default:"Links abbiegen",name:"Links abbiegen auf {way_name}",destination:"Links abbiegen Richtung {destination}"},right:{default:"Rechts abbiegen",name:"Rechts abbiegen auf {way_name}",destination:"Rechts abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"}},turn:{default:{default:"{modifier} abbiegen",name:"{modifier} abbiegen auf {way_name}",destination:"{modifier} abbiegen Richtung {destination}"},left:{default:"Links abbiegen",name:"Links abbiegen auf {way_name}",destination:"Links abbiegen Richtung {destination}"},right:{default:"Rechts abbiegen",name:"Rechts abbiegen auf {way_name}",destination:"Rechts abbiegen Richtung {destination}"},straight:{default:"Geradeaus weiterfahren",name:"Geradeaus weiterfahren auf {way_name}",destination:"Geradeaus weiterfahren Richtung {destination}"}},"use lane":{no_lanes:{default:"Geradeaus weiterfahren"},default:{default:"{lane_instruction}"}}}}},{}],25:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1st",2:"2nd",3:"3rd",4:"4th",5:"5th",6:"6th",7:"7th",8:"8th",9:"9th",10:"10th"},direction:{north:"north",northeast:"northeast",east:"east",southeast:"southeast",south:"south",southwest:"southwest",west:"west",northwest:"northwest"},modifier:{left:"left",right:"right","sharp left":"sharp left","sharp right":"sharp right","slight left":"slight left","slight right":"slight right",straight:"straight",uturn:"U-turn"},lanes:{xo:"Keep right",ox:"Keep left",xox:"Keep in the middle",oxo:"Keep left or right"}},modes:{ferry:{default:"Take the ferry",name:"Take the ferry {way_name}",destination:"Take the ferry towards {destination}"}},phrase:{"two linked by distance":"{instruction_one}, then, in {distance}, {instruction_two}","two linked":"{instruction_one}, then {instruction_two}","one in distance":"In {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"You have arrived at your {nth} destination",upcoming:"You will arrive at your {nth} destination",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}"},left:{default:"You have arrived at your {nth} destination, on the left",upcoming:"You will arrive at your {nth} destination, on the left",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the left"},right:{default:"You have arrived at your {nth} destination, on the right",upcoming:"You will arrive at your {nth} destination, on the right",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the right"},"sharp left":{default:"You have arrived at your {nth} destination, on the left",upcoming:"You will arrive at your {nth} destination, on the left",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the left"},"sharp right":{default:"You have arrived at your {nth} destination, on the right",upcoming:"You will arrive at your {nth} destination, on the right",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the right"},"slight right":{default:"You have arrived at your {nth} destination, on the right",upcoming:"You will arrive at your {nth} destination, on the right",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the right"},"slight left":{default:"You have arrived at your {nth} destination, on the left",upcoming:"You will arrive at your {nth} destination, on the left",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, on the left"},straight:{default:"You have arrived at your {nth} destination, straight ahead",upcoming:"You will arrive at your {nth} destination, straight ahead",short:"You have arrived","short-upcoming":"You will arrive",named:"You have arrived at {waypoint_name}, straight ahead"}},continue:{default:{default:"Turn {modifier}",name:"Turn {modifier} to stay on {way_name}",destination:"Turn {modifier} towards {destination}",exit:"Turn {modifier} onto {way_name}"},straight:{default:"Continue straight",name:"Continue straight to stay on {way_name}",destination:"Continue towards {destination}",distance:"Continue straight for {distance}",namedistance:"Continue on {way_name} for {distance}"},"sharp left":{default:"Make a sharp left",name:"Make a sharp left to stay on {way_name}",destination:"Make a sharp left towards {destination}"},"sharp right":{default:"Make a sharp right",name:"Make a sharp right to stay on {way_name}",destination:"Make a sharp right towards {destination}"},"slight left":{default:"Make a slight left",name:"Make a slight left to stay on {way_name}",destination:"Make a slight left towards {destination}"},"slight right":{default:"Make a slight right",name:"Make a slight right to stay on {way_name}",destination:"Make a slight right towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn and continue on {way_name}",destination:"Make a U-turn towards {destination}"}},depart:{default:{default:"Head {direction}",name:"Head {direction} on {way_name}",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"Turn {modifier}",name:"Turn {modifier} onto {way_name}",destination:"Turn {modifier} towards {destination}"},straight:{default:"Continue straight",name:"Continue straight onto {way_name}",destination:"Continue straight towards {destination}"},uturn:{default:"Make a U-turn at the end of the road",name:"Make a U-turn onto {way_name} at the end of the road",destination:"Make a U-turn towards {destination} at the end of the road"}},fork:{default:{default:"Keep {modifier} at the fork",name:"Keep {modifier} onto {way_name}",destination:"Keep {modifier} towards {destination}"},"slight left":{default:"Keep left at the fork",name:"Keep left onto {way_name}",destination:"Keep left towards {destination}"},"slight right":{default:"Keep right at the fork",name:"Keep right onto {way_name}",destination:"Keep right towards {destination}"},"sharp left":{default:"Take a sharp left at the fork",name:"Take a sharp left onto {way_name}",destination:"Take a sharp left towards {destination}"},"sharp right":{default:"Take a sharp right at the fork",name:"Take a sharp right onto {way_name}",destination:"Take a sharp right towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn onto {way_name}",destination:"Make a U-turn towards {destination}"}},merge:{default:{default:"Merge {modifier}",name:"Merge {modifier} onto {way_name}",destination:"Merge {modifier} towards {destination}"},straight:{default:"Merge",name:"Merge onto {way_name}",destination:"Merge towards {destination}"},"slight left":{default:"Merge left",name:"Merge left onto {way_name}",destination:"Merge left towards {destination}"},"slight right":{default:"Merge right",name:"Merge right onto {way_name}",destination:"Merge right towards {destination}"},"sharp left":{default:"Merge left",name:"Merge left onto {way_name}",destination:"Merge left towards {destination}"},"sharp right":{default:"Merge right",name:"Merge right onto {way_name}",destination:"Merge right towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn onto {way_name}",destination:"Make a U-turn towards {destination}"}},"new name":{default:{default:"Continue {modifier}",name:"Continue {modifier} onto {way_name}",destination:"Continue {modifier} towards {destination}"},straight:{default:"Continue straight",name:"Continue onto {way_name}",destination:"Continue towards {destination}"},"sharp left":{default:"Take a sharp left",name:"Take a sharp left onto {way_name}",destination:"Take a sharp left towards {destination}"},"sharp right":{default:"Take a sharp right",name:"Take a sharp right onto {way_name}",destination:"Take a sharp right towards {destination}"},"slight left":{default:"Continue slightly left",name:"Continue slightly left onto {way_name}",destination:"Continue slightly left towards {destination}"},"slight right":{default:"Continue slightly right",name:"Continue slightly right onto {way_name}",destination:"Continue slightly right towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn onto {way_name}",destination:"Make a U-turn towards {destination}"}},notification:{default:{default:"Continue {modifier}",name:"Continue {modifier} onto {way_name}",destination:"Continue {modifier} towards {destination}"},uturn:{default:"Make a U-turn",name:"Make a U-turn onto {way_name}",destination:"Make a U-turn towards {destination}"}},"off ramp":{default:{default:"Take the ramp",name:"Take the ramp onto {way_name}",destination:"Take the ramp towards {destination}",exit:"Take exit {exit}",exit_destination:"Take exit {exit} towards {destination}"},left:{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},right:{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"},"sharp left":{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},"sharp right":{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"},"slight left":{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},"slight right":{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"}},"on ramp":{default:{default:"Take the ramp",name:"Take the ramp onto {way_name}",destination:"Take the ramp towards {destination}"},left:{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}"},right:{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}"},"sharp left":{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}"},"sharp right":{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}"},"slight left":{default:"Take the ramp on the left",name:"Take the ramp on the left onto {way_name}",destination:"Take the ramp on the left towards {destination}"},"slight right":{default:"Take the ramp on the right",name:"Take the ramp on the right onto {way_name}",destination:"Take the ramp on the right towards {destination}"}},rotary:{default:{default:{default:"Enter the traffic circle",name:"Enter the traffic circle and exit onto {way_name}",destination:"Enter the traffic circle and exit towards {destination}"},name:{default:"Enter {rotary_name}",name:"Enter {rotary_name} and exit onto {way_name}",destination:"Enter {rotary_name} and exit towards {destination}"},exit:{default:"Enter the traffic circle and take the {exit_number} exit",name:"Enter the traffic circle and take the {exit_number} exit onto {way_name}",destination:"Enter the traffic circle and take the {exit_number} exit towards {destination}"},name_exit:{default:"Enter {rotary_name} and take the {exit_number} exit",name:"Enter {rotary_name} and take the {exit_number} exit onto {way_name}",destination:"Enter {rotary_name} and take the {exit_number} exit towards {destination}"}}},roundabout:{default:{exit:{default:"Enter the traffic circle and take the {exit_number} exit",name:"Enter the traffic circle and take the {exit_number} exit onto {way_name}",destination:"Enter the traffic circle and take the {exit_number} exit towards {destination}"},default:{default:"Enter the traffic circle",name:"Enter the traffic circle and exit onto {way_name}",destination:"Enter the traffic circle and exit towards {destination}"}}},"roundabout turn":{default:{default:"Make a {modifier}",name:"Make a {modifier} onto {way_name}",destination:"Make a {modifier} towards {destination}"},left:{default:"Turn left",name:"Turn left onto {way_name}",destination:"Turn left towards {destination}"},right:{default:"Turn right",name:"Turn right onto {way_name}",destination:"Turn right towards {destination}"},straight:{default:"Continue straight",name:"Continue straight onto {way_name}",destination:"Continue straight towards {destination}"}},"exit roundabout":{default:{default:"Exit the traffic circle",name:"Exit the traffic circle onto {way_name}",destination:"Exit the traffic circle towards {destination}"}},"exit rotary":{default:{default:"Exit the traffic circle",name:"Exit the traffic circle onto {way_name}",destination:"Exit the traffic circle towards {destination}"}},turn:{default:{default:"Make a {modifier}",name:"Make a {modifier} onto {way_name}",destination:"Make a {modifier} towards {destination}"},left:{default:"Turn left",name:"Turn left onto {way_name}",destination:"Turn left towards {destination}"},right:{default:"Turn right",name:"Turn right onto {way_name}",destination:"Turn right towards {destination}"},straight:{default:"Go straight",name:"Go straight onto {way_name}",destination:"Go straight towards {destination}"}},"use lane":{no_lanes:{default:"Continue straight"},default:{default:"{lane_instruction}"}}}}},{}],26:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1.",2:"2.",3:"3.",4:"4.",5:"5.",6:"6.",7:"7.",8:"8.",9:"9.",10:"10."},direction:{north:"norden",northeast:"nord-orienten",east:"orienten",southeast:"sud-orienten",south:"suden",southwest:"sud-okcidenten",west:"okcidenten",northwest:"nord-okcidenten"},modifier:{left:"maldekstren",right:"dekstren","sharp left":"maldekstregen","sharp right":"dekstregen","slight left":"maldekstreten","slight right":"dekstreten",straight:"rekten",uturn:"turniu malantaen"},lanes:{xo:"Veturu dekstre",ox:"Veturu maldekstre",xox:"Veturu meze",oxo:"Veturu dekstre a maldekstre"}},modes:{ferry:{default:"Enpramiu",name:"Enpramiu {way_name}",destination:"Enpramiu direkte al {destination}"}},phrase:{"two linked by distance":"{instruction_one} kaj post {distance} {instruction_two}","two linked":"{instruction_one} kaj sekve {instruction_two}","one in distance":"Post {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"elveturejo {exit}"},arrive:{default:{default:"Vi atingis vian {nth} celon",upcoming:"Vi atingos vian {nth} celon",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}"},left:{default:"Vi atingis vian {nth} celon e maldekstre",upcoming:"Vi atingos vian {nth} celon e maldekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e maldekstre"},right:{default:"Vi atingis vian {nth} celon e dekstre",upcoming:"Vi atingos vian {nth} celon e dekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e dekstre"},"sharp left":{default:"Vi atingis vian {nth} celon e maldekstre",upcoming:"Vi atingos vian {nth} celon e maldekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e maldekstre"},"sharp right":{default:"Vi atingis vian {nth} celon e dekstre",upcoming:"Vi atingos vian {nth} celon e dekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e dekstre"},"slight right":{default:"Vi atingis vian {nth} celon e dekstre",upcoming:"Vi atingos vian {nth} celon e dekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e dekstre"},"slight left":{default:"Vi atingis vian {nth} celon e maldekstre",upcoming:"Vi atingos vian {nth} celon e maldekstre",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name}, e maldekstre"},straight:{default:"Vi atingis vian {nth} celon",upcoming:"Vi atingos vian {nth} celon rekte",short:"Vi atingis","short-upcoming":"Vi atingos",named:"Vi atingis {waypoint_name} antae"}},continue:{default:{default:"Veturu {modifier}",name:"Veturu {modifier} al {way_name}",destination:"Veturu {modifier} direkte al {destination}",exit:"Veturu {modifier} direkte al {way_name}"},straight:{default:"Veturu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}",distance:"Veturu rekten dum {distance}",namedistance:"Veturu rekten al {way_name} dum {distance}"},"sharp left":{default:"Turniu ege maldekstren",name:"Turniu ege maldekstren al {way_name}",destination:"Turniu ege maldekstren direkte al {destination}"},"sharp right":{default:"Turniu ege dekstren",name:"Turniu ege dekstren al {way_name}",destination:"Turniu ege dekstren direkte al {destination}"},"slight left":{default:"Turniu ete maldekstren",name:"Turniu ete maldekstren al {way_name}",destination:"Turniu ete maldekstren direkte al {destination}"},"slight right":{default:"Turniu ete dekstren",name:"Turniu ete dekstren al {way_name}",destination:"Turniu ete dekstren direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},depart:{default:{default:"Direktiu {direction}",name:"Direktiu {direction} al {way_name}",namedistance:"Direktiu {direction} al {way_name} tra {distance}"}},"end of road":{default:{default:"Veturu {modifier}",name:"Veturu {modifier} direkte al {way_name}",destination:"Veturu {modifier} direkte al {destination}"},straight:{default:"Veturu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}"},uturn:{default:"Turniu malantaen e fino de la vojo",name:"Turniu malantaen al {way_name} e fino de la vojo",destination:"Turniu malantaen direkte al {destination} e fino de la vojo"}},fork:{default:{default:"Daru {modifier} e la vojforko",name:"Pluu {modifier} al {way_name}",destination:"Pluu {modifier} direkte al {destination}"},"slight left":{default:"Maldekstren e la vojforko",name:"Pluu maldekstren al {way_name}",destination:"Pluu maldekstren direkte al {destination}"},"slight right":{default:"Dekstren e la vojforko",name:"Pluu dekstren al {way_name}",destination:"Pluu dekstren direkte al {destination}"},"sharp left":{default:"Ege maldekstren e la vojforko",name:"Turniu ege maldekstren al {way_name}",destination:"Turniu ege maldekstren direkte al {destination}"},"sharp right":{default:"Ege dekstren e la vojforko",name:"Turniu ege dekstren al {way_name}",destination:"Turniu ege dekstren direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},merge:{default:{default:"Enveturu {modifier}",name:"Enveturu {modifier} al {way_name}",destination:"Enveturu {modifier} direkte al {destination}"},straight:{default:"Enveturu",name:"Enveturu al {way_name}",destination:"Enveturu direkte al {destination}"},"slight left":{default:"Enveturu de maldekstre",name:"Enveturu de maldekstre al {way_name}",destination:"Enveturu de maldekstre direkte al {destination}"},"slight right":{default:"Enveturu de dekstre",name:"Enveturu de dekstre al {way_name}",destination:"Enveturu de dekstre direkte al {destination}"},"sharp left":{default:"Enveturu de maldekstre",name:"Enveture de maldekstre al {way_name}",destination:"Enveturu de maldekstre direkte al {destination}"},"sharp right":{default:"Enveturu de dekstre",name:"Enveturu de dekstre al {way_name}",destination:"Enveturu de dekstre direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},"new name":{default:{default:"Pluu {modifier}",name:"Pluu {modifier} al {way_name}",destination:"Pluu {modifier} direkte al {destination}"},straight:{default:"Veturu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}"},"sharp left":{default:"Turniu ege maldekstren",name:"Turniu ege maldekstren al {way_name}",destination:"Turniu ege maldekstren direkte al {destination}"},"sharp right":{default:"Turniu ege dekstren",name:"Turniu ege dekstren al {way_name}",destination:"Turniu ege dekstren direkte al {destination}"},"slight left":{default:"Pluu ete maldekstren",name:"Pluu ete maldekstren al {way_name}",destination:"Pluu ete maldekstren direkte al {destination}"},"slight right":{default:"Pluu ete dekstren",name:"Pluu ete dekstren al {way_name}",destination:"Pluu ete dekstren direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},notification:{default:{default:"Pluu {modifier}",name:"Pluu {modifier} al {way_name}",destination:"Pluu {modifier} direkte al {destination}"},uturn:{default:"Turniu malantaen",name:"Turniu malantaen al {way_name}",destination:"Turniu malantaen direkte al {destination}"}},"off ramp":{default:{default:"Direktiu al enveturejo",name:"Direktiu al enveturejo al {way_name}",destination:"Direktiu al enveturejo direkte al {destination}",exit:"Direktiu al elveturejo {exit}",exit_destination:"Direktiu al elveturejo {exit} direkte al {destination}"},left:{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}",exit:"Direktiu al elveturejo {exit} e maldekstre",exit_destination:"Direktiu al elveturejo {exit} e maldekstre direkte al {destination}"},right:{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}",exit:"Direktiu al {exit} elveturejo e ldekstre",exit_destination:"Direktiu al elveturejo {exit} e dekstre direkte al {destination}"},"sharp left":{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}",exit:"Direktiu al {exit} elveturejo e maldekstre",exit_destination:"Direktiu al elveturejo {exit} e maldekstre direkte al {destination}"},"sharp right":{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}",exit:"Direktiu al elveturejo {exit} e dekstre",exit_destination:"Direktiu al elveturejo {exit} e dekstre direkte al {destination}"},"slight left":{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}",exit:"Direktiu al {exit} elveturejo e maldekstre",exit_destination:"Direktiu al elveturejo {exit} e maldekstre direkte al {destination}"},"slight right":{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}",exit:"Direktiu al {exit} elveturejo e ldekstre",exit_destination:"Direktiu al elveturejo {exit} e dekstre direkte al {destination}"}},"on ramp":{default:{default:"Direktiu al enveturejo",name:"Direktiu al enveturejo al {way_name}",destination:"Direktiu al enveturejo direkte al {destination}"},left:{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}"},right:{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}"},"sharp left":{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}"},"sharp right":{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}"},"slight left":{default:"Direktiu al enveturejo e maldekstre",name:"Direktiu al enveturejo e maldekstre al {way_name}",destination:"Direktiu al enveturejo e maldekstre al {destination}"},"slight right":{default:"Direktiu al enveturejo e dekstre",name:"Direktiu al enveturejo e dekstre al {way_name}",destination:"Direktiu al enveturejo e dekstre al {destination}"}},rotary:{default:{default:{default:"Enveturu trafikcirklegon",name:"Enveturu trafikcirklegon kaj elveturu al {way_name}",destination:"Enveturu trafikcirklegon kaj elveturu direkte al {destination}"},name:{default:"Enveturu {rotary_name}",name:"Enveturu {rotary_name} kaj elveturu al {way_name}",destination:"Enveturu {rotary_name} kaj elveturu direkte al {destination}"},exit:{default:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo",name:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo al {way_name}",destination:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo direkte al {destination}"},name_exit:{default:"Enveturu {rotary_name} kaj sekve al {exit_number} elveturejo",name:"Enveturu {rotary_name} kaj sekve al {exit_number} elveturejo al {way_name}",destination:"Enveturu {rotary_name} kaj sekve al {exit_number} elveturejo direkte al {destination}"}}},roundabout:{default:{exit:{default:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo",name:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo al {way_name}",destination:"Enveturu trafikcirklegon kaj sekve al {exit_number} elveturejo direkte al {destination}"},default:{default:"Enveturu trafikcirklegon",name:"Enveturu trafikcirklegon kaj elveturu al {way_name}",destination:"Enveturu trafikcirklegon kaj elveturu direkte al {destination}"}}},"roundabout turn":{default:{default:"Veturu {modifier}",name:"Veturu {modifier} al {way_name}",destination:"Veturu {modifier} direkte al {destination}"},left:{default:"Turniu maldekstren",name:"Turniu maldekstren al {way_name}",destination:"Turniu maldekstren direkte al {destination}"},right:{default:"Turniu dekstren",name:"Turniu dekstren al {way_name}",destination:"Turniu dekstren direkte al {destination}"},straight:{default:"Pluu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}"}},"exit roundabout":{default:{default:"Elveturu trafikcirklegon",name:"Elveturu trafikcirklegon al {way_name}",destination:"Elveturu trafikcirklegon direkte al {destination}"}},"exit rotary":{default:{default:"Eliru trafikcirklegon",name:"Elveturu trafikcirklegon al {way_name}",destination:"Elveturu trafikcirklegon direkte al {destination}"}},turn:{default:{default:"Veturu {modifier}",name:"Veturu {modifier} al {way_name}",destination:"Veturu {modifier} direkte al {destination}"},left:{default:"Turniu maldekstren",name:"Turniu maldekstren al {way_name}",destination:"Turniu maldekstren direkte al {destination}"},right:{default:"Turniu dekstren",name:"Turniu dekstren al {way_name}",destination:"Turniu dekstren direkte al {destination}"},straight:{default:"Veturu rekten",name:"Veturu rekten al {way_name}",destination:"Veturu rekten direkte al {destination}"}},"use lane":{no_lanes:{default:"Pluu rekten"},default:{default:"{lane_instruction}"}}}}},{}],27:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"norte",northeast:"noreste",east:"este",southeast:"sureste",south:"sur",southwest:"suroeste",west:"oeste",northwest:"noroeste"},modifier:{left:"a la izquierda",right:"a la derecha","sharp left":"cerrada a la izquierda","sharp right":"cerrada a la derecha","slight left":"ligeramente a la izquierda","slight right":"ligeramente a la derecha",straight:"recto",uturn:"cambio de sentido"},lanes:{xo:"Mantente a la derecha",ox:"Mantente a la izquierda",xox:"Mantente en el medio",oxo:"Mantente a la izquierda o a la derecha"}},modes:{ferry:{default:"Coge el ferry",name:"Coge el ferry {way_name}",destination:"Coge el ferry hacia {destination}"}},phrase:{"two linked by distance":"{instruction_one} y luego en {distance}, {instruction_two}","two linked":"{instruction_one} y luego {instruction_two}","one in distance":"A {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"salida {exit}"},arrive:{default:{default:"Has llegado a tu {nth} destino",upcoming:"Vas a llegar a tu {nth} destino",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}"},left:{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},right:{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"sharp left":{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},"sharp right":{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"slight right":{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"slight left":{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},straight:{default:"Has llegado a tu {nth} destino, en frente",upcoming:"Vas a llegar a tu {nth} destino, en frente",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, en frente"}},continue:{default:{default:"Gire {modifier}",name:"Cruce {modifier} en {way_name}",destination:"Gire {modifier} hacia {destination}",exit:"Gire {modifier} en {way_name}"},straight:{default:"Contina recto",name:"Contina en {way_name}",destination:"Contina hacia {destination}",distance:"Contina recto por {distance}",namedistance:"Contina recto en {way_name} por {distance}"},"sharp left":{default:"Gire a la izquierda",name:"Gire a la izquierda en {way_name}",destination:"Gire a la izquierda hacia {destination}"},"sharp right":{default:"Gire a la derecha",name:"Gire a la derecha en {way_name}",destination:"Gire a la derecha hacia {destination}"},"slight left":{default:"Gire a la izquierda",name:"Doble levementea la izquierda en {way_name}",destination:"Gire a la izquierda hacia {destination}"},"slight right":{default:"Gire a la izquierda",name:"Doble levemente a la derecha en {way_name}",destination:"Gire a la izquierda hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido y contina en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},depart:{default:{default:"Dirgete al {direction}",name:"Dirgete al {direction} por {way_name}",namedistance:"Dirgete al {direction} en {way_name} por {distance}"}},"end of road":{default:{default:"Al final de la calle gira {modifier}",name:"Al final de la calle gira {modifier} por {way_name}",destination:"Al final de la calle gira {modifier} hacia {destination}"},straight:{default:"Al final de la calle contina recto",name:"Al final de la calle contina recto por {way_name}",destination:"Al final de la calle contina recto hacia {destination}"},uturn:{default:"Al final de la calle haz un cambio de sentido",name:"Al final de la calle haz un cambio de sentido en {way_name}",destination:"Al final de la calle haz un cambio de sentido hacia {destination}"}},fork:{default:{default:"Mantente {modifier} en el cruce",name:"Mantente {modifier} por {way_name}",destination:"Mantente {modifier} hacia {destination}"},"slight left":{default:"Mantente a la izquierda en el cruce",name:"Mantente a la izquierda por {way_name}",destination:"Mantente a la izquierda hacia {destination}"},"slight right":{default:"Mantente a la derecha en el cruce",name:"Mantente a la derecha por {way_name}",destination:"Mantente a la derecha hacia {destination}"},"sharp left":{default:"Gira la izquierda en el cruce",name:"Gira a la izquierda por {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha en el cruce",name:"Gira a la derecha por {way_name}",destination:"Gira a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},merge:{default:{default:"Incorprate {modifier}",name:"Incorprate {modifier} por {way_name}",destination:"Incorprate {modifier} hacia {destination}"},straight:{default:"Incorprate",name:"Incorprate por {way_name}",destination:"Incorprate hacia {destination}"},"slight left":{default:"Incorprate a la izquierda",name:"Incorprate a la izquierda por {way_name}",destination:"Incorprate a la izquierda hacia {destination}"},"slight right":{default:"Incorprate a la derecha",name:"Incorprate a la derecha por {way_name}",destination:"Incorprate a la derecha hacia {destination}"},"sharp left":{default:"Incorprate a la izquierda",name:"Incorprate a la izquierda por {way_name}",destination:"Incorprate a la izquierda hacia {destination}"},"sharp right":{default:"Incorprate a la derecha",name:"Incorprate a la derecha por {way_name}",destination:"Incorprate a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},"new name":{default:{default:"Contina {modifier}",name:"Contina {modifier} por {way_name}",destination:"Contina {modifier} hacia {destination}"},straight:{default:"Contina recto",name:"Contina por {way_name}",destination:"Contina hacia {destination}"},"sharp left":{default:"Gira a la izquierda",name:"Gira a la izquierda por {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha",name:"Gira a la derecha por {way_name}",destination:"Gira a la derecha hacia {destination}"},"slight left":{default:"Contina ligeramente por la izquierda",name:"Contina ligeramente por la izquierda por {way_name}",destination:"Contina ligeramente por la izquierda hacia {destination}"},"slight right":{default:"Contina ligeramente por la derecha",name:"Contina ligeramente por la derecha por {way_name}",destination:"Contina ligeramente por la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},notification:{default:{default:"Contina {modifier}",name:"Contina {modifier} por {way_name}",destination:"Contina {modifier} hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},"off ramp":{default:{default:"Coge la cuesta abajo",name:"Coge la cuesta abajo por {way_name}",destination:"Coge la cuesta abajo hacia {destination}",exit:"Coge la cuesta abajo {exit}",exit_destination:"Coge la cuesta abajo {exit} hacia {destination}"},left:{default:"Coge la cuesta abajo de la izquierda",name:"Coge la cuesta abajo de la izquierda por {way_name}",destination:"Coge la cuesta abajo de la izquierda hacia {destination}",exit:"Coge la cuesta abajo {exit} a tu izquierda",exit_destination:"Coge la cuesta abajo {exit} a tu izquierda hacia {destination}"},right:{default:"Coge la cuesta abajo de la derecha",name:"Coge la cuesta abajo de la derecha por {way_name}",destination:"Coge la cuesta abajo de la derecha hacia {destination}",exit:"Coge la cuesta abajo {exit}",exit_destination:"Coge la cuesta abajo {exit} hacia {destination}"},"sharp left":{default:"Coge la cuesta abajo de la izquierda",name:"Coge la cuesta abajo de la izquierda por {way_name}",destination:"Coge la cuesta abajo de la izquierda hacia {destination}",exit:"Coge la cuesta abajo {exit} a tu izquierda",exit_destination:"Coge la cuesta abajo {exit} a tu izquierda hacia {destination}"},"sharp right":{default:"Coge la cuesta abajo de la derecha",name:"Coge la cuesta abajo de la derecha por {way_name}",destination:"Coge la cuesta abajo de la derecha hacia {destination}",exit:"Coge la cuesta abajo {exit}",exit_destination:"Coge la cuesta abajo {exit} hacia {destination}"},"slight left":{default:"Coge la cuesta abajo de la izquierda",name:"Coge la cuesta abajo de la izquierda por {way_name}",destination:"Coge la cuesta abajo de la izquierda hacia {destination}",exit:"Coge la cuesta abajo {exit} a tu izquierda",exit_destination:"Coge la cuesta abajo{exit} a tu izquierda hacia {destination}"},"slight right":{default:"Coge la cuesta abajo de la derecha",name:"Coge la cuesta abajo de la derecha por {way_name}",destination:"Coge la cuesta abajo de la derecha hacia {destination}",exit:"Coge la cuesta abajo {exit}",exit_destination:"Coge la cuesta abajo {exit} hacia {destination}"}},"on ramp":{default:{default:"Coge la cuesta",name:"Coge la cuesta por {way_name}",destination:"Coge la cuesta hacia {destination}"},left:{default:"Coge la cuesta de la izquierda",name:"Coge la cuesta de la izquierda por {way_name}",destination:"Coge la cuesta de la izquierda hacia {destination}"},right:{default:"Coge la cuesta de la derecha",name:"Coge la cuesta de la derecha por {way_name}",destination:"Coge la cuesta de la derecha hacia {destination}"},"sharp left":{default:"Coge la cuesta de la izquierda",name:"Coge la cuesta de la izquierda por {way_name}",destination:"Coge la cuesta de la izquierda hacia {destination}"},"sharp right":{default:"Coge la cuesta de la derecha",name:"Coge la cuesta de la derecha por {way_name}",destination:"Coge la cuesta de la derecha hacia {destination}"},"slight left":{default:"Coge la cuesta de la izquierda",name:"Coge la cuesta de la izquierda por {way_name}",destination:"Coge la cuesta de la izquierda hacia {destination}"},"slight right":{default:"Coge la cuesta de la derecha",name:"Coge la cuesta de la derecha por {way_name}",destination:"Coge la cuesta de la derecha hacia {destination}"}},rotary:{default:{default:{default:"Incorprate en la rotonda",name:"En la rotonda sal por {way_name}",destination:"En la rotonda sal hacia {destination}"},name:{default:"En {rotary_name}",name:"En {rotary_name} sal por {way_name}",destination:"En {rotary_name} sal hacia {destination}"},exit:{default:"En la rotonda toma la {exit_number} salida",name:"En la rotonda toma la {exit_number} salida por {way_name}",destination:"En la rotonda toma la {exit_number} salida hacia {destination}"},name_exit:{default:"En {rotary_name} toma la {exit_number} salida",name:"En {rotary_name} toma la {exit_number} salida por {way_name}",destination:"En {rotary_name} toma la {exit_number} salida hacia {destination}"}}},roundabout:{default:{exit:{default:"En la rotonda toma la {exit_number} salida",name:"En la rotonda toma la {exit_number} salida por {way_name}",destination:"En la rotonda toma la {exit_number} salida hacia {destination}"},default:{default:"Incorprate en la rotonda",name:"Incorprate en la rotonda y sal en {way_name}",destination:"Incorprate en la rotonda y sal hacia {destination}"}}},"roundabout turn":{default:{default:"Siga {modifier}",name:"Siga {modifier} en {way_name}",destination:"Siga {modifier} hacia {destination}"},left:{default:"Gire a la izquierda",name:"Gire a la izquierda en {way_name}",destination:"Gire a la izquierda hacia {destination}"},right:{default:"Gire a la derecha",name:"Gire a la derecha en {way_name}",destination:"Gire a la derecha hacia {destination}"},straight:{default:"Contina recto",name:"Contina recto por {way_name}",destination:"Contina recto hacia {destination}"}},"exit roundabout":{default:{default:"Sal la rotonda",name:"Toma la salida por {way_name}",destination:"Toma la salida hacia {destination}"}},"exit rotary":{default:{default:"Sal la rotonda",name:"Toma la salida por {way_name}",destination:"Toma la salida hacia {destination}"}},turn:{default:{default:"Gira {modifier}",name:"Gira {modifier} por {way_name}",destination:"Gira {modifier} hacia {destination}"},left:{default:"Gira a la izquierda",name:"Gira a la izquierda por {way_name}",destination:"Gira a la izquierda hacia {destination}"},right:{default:"Gira a la derecha",name:"Gira a la derecha por {way_name}",destination:"Gira a la derecha hacia {destination}"},straight:{default:"Contina recto",name:"Contina recto por {way_name}",destination:"Contina recto hacia {destination}"}},"use lane":{no_lanes:{default:"Contina recto"},default:{default:"{lane_instruction}"}}}}},{}],28:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"norte",northeast:"noreste",east:"este",southeast:"sureste",south:"sur",southwest:"suroeste",west:"oeste",northwest:"noroeste"},modifier:{left:"izquierda",right:"derecha","sharp left":"cerrada a la izquierda","sharp right":"cerrada a la derecha","slight left":"levemente a la izquierda","slight right":"levemente a la derecha",straight:"recto",uturn:"cambio de sentido"},lanes:{xo:"Mantente a la derecha",ox:"Mantente a la izquierda",xox:"Mantente en el medio",oxo:"Mantente a la izquierda o derecha"}},modes:{ferry:{default:"Coge el ferry",name:"Coge el ferry {way_name}",destination:"Coge el ferry a {destination}"}},phrase:{"two linked by distance":"{instruction_one} y luego a {distance}, {instruction_two}","two linked":"{instruction_one} y luego {instruction_two}","one in distance":"A {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"salida {exit}"},arrive:{default:{default:"Has llegado a tu {nth} destino",upcoming:"Vas a llegar a tu {nth} destino",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}"},left:{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},right:{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"sharp left":{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},"sharp right":{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"slight right":{default:"Has llegado a tu {nth} destino, a la derecha",upcoming:"Vas a llegar a tu {nth} destino, a la derecha",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la derecha"},"slight left":{default:"Has llegado a tu {nth} destino, a la izquierda",upcoming:"Vas a llegar a tu {nth} destino, a la izquierda",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, a la izquierda"},straight:{default:"Has llegado a tu {nth} destino, en frente",upcoming:"Vas a llegar a tu {nth} destino, en frente",short:"Has llegado","short-upcoming":"Vas a llegar",named:"Has llegado a {waypoint_name}, en frente"}},continue:{default:{default:"Gira a {modifier}",name:"Cruza a la{modifier}  en {way_name}",destination:"Gira a {modifier} hacia {destination}",exit:"Gira a {modifier} en {way_name}"},straight:{default:"Contina recto",name:"Contina en {way_name}",destination:"Contina hacia {destination}",distance:"Contina recto por {distance}",namedistance:"Contina recto en {way_name} por {distance}"},"sharp left":{default:"Gira a la izquierda",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},"slight left":{default:"Gira a la izquierda",name:"Dobla levemente a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},"slight right":{default:"Gira a la izquierda",name:"Dobla levemente a la derecha en {way_name}",destination:"Gira a la izquierda hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido y contina en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},depart:{default:{default:"Ve a {direction}",name:"Ve a {direction} en {way_name}",namedistance:"Ve a {direction} en {way_name} por {distance}"}},"end of road":{default:{default:"Gira  a {modifier}",name:"Gira a {modifier} en {way_name}",destination:"Gira a {modifier} hacia {destination}"},straight:{default:"Contina recto",name:"Contina recto en {way_name}",destination:"Contina recto hacia {destination}"},uturn:{default:"Haz un cambio de sentido al final de la via",name:"Haz un cambio de sentido en {way_name} al final de la via",destination:"Haz un cambio de sentido hacia {destination} al final de la via"}},fork:{default:{default:"Mantente  {modifier} en el cruza",name:"Mantente {modifier} en {way_name}",destination:"Mantente {modifier} hacia {destination}"},"slight left":{default:"Mantente a la izquierda en el cruza",name:"Mantente a la izquierda en {way_name}",destination:"Mantente a la izquierda hacia {destination}"},"slight right":{default:"Mantente a la derecha en el cruza",name:"Mantente a la derecha en {way_name}",destination:"Mantente a la derecha hacia {destination}"},"sharp left":{default:"Gira a la izquierda en el cruza",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha en el cruza",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},merge:{default:{default:"Incorprate a {modifier}",name:"Incorprate a {modifier} en {way_name}",destination:"Incorprate a {modifier} hacia {destination}"},straight:{default:"Incorprate",name:"Incorprate a {way_name}",destination:"Incorprate hacia {destination}"},"slight left":{default:"Incorprate a la izquierda",name:"Incorprate a la izquierda en {way_name}",destination:"Incorprate a la izquierda hacia {destination}"},"slight right":{default:"Incorprate a la derecha",name:"Incorprate a la derecha en {way_name}",destination:"Incorprate a la derecha hacia {destination}"},"sharp left":{default:"Incorprate a la izquierda",name:"Incorprate a la izquierda en {way_name}",destination:"Incorprate a la izquierda hacia {destination}"},"sharp right":{default:"Incorprate a la derecha",name:"Incorprate a la derecha en {way_name}",destination:"Incorprate a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},"new name":{default:{default:"Contina {modifier}",name:"Contina {modifier} en {way_name}",destination:"Contina {modifier} hacia {destination}"},straight:{default:"Contina recto",name:"Contina en {way_name}",destination:"Contina hacia {destination}"},"sharp left":{default:"Gira a la izquierda",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},"sharp right":{default:"Gira a la derecha",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},"slight left":{default:"Contina levemente a la izquierda",name:"Contina levemente a la izquierda en {way_name}",destination:"Contina levemente a la izquierda hacia {destination}"},"slight right":{default:"Contina levemente a la derecha",name:"Contina levemente a la derecha en {way_name}",destination:"Contina levemente a la derecha hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},notification:{default:{default:"Contina {modifier}",name:"Contina {modifier} en {way_name}",destination:"Contina {modifier} hacia {destination}"},uturn:{default:"Haz un cambio de sentido",name:"Haz un cambio de sentido en {way_name}",destination:"Haz un cambio de sentido hacia {destination}"}},"off ramp":{default:{default:"Toma la salida",name:"Toma la salida en {way_name}",destination:"Toma la salida hacia {destination}",exit:"Toma la salida {exit}",exit_destination:"Toma la salida {exit} hacia {destination}"},left:{default:"Toma la salida en la izquierda",name:"Toma la salida en la izquierda en {way_name}",destination:"Toma la salida en la izquierda en {destination}",exit:"Toma la salida {exit} en la izquierda",exit_destination:"Toma la salida {exit} en la izquierda hacia {destination}"},right:{default:"Toma la salida en la derecha",name:"Toma la salida en la derecha en {way_name}",destination:"Toma la salida en la derecha hacia {destination}",exit:"Toma la salida {exit} en la derecha",exit_destination:"Toma la salida {exit} en la derecha hacia {destination}"},"sharp left":{default:"Ve cuesta abajo en la izquierda",name:"Ve cuesta abajo en la izquierda en {way_name}",destination:"Ve cuesta abajo en la izquierda hacia {destination}",exit:"Toma la salida {exit} en la izquierda",exit_destination:"Toma la salida {exit} en la izquierda hacia {destination}"},"sharp right":{default:"Ve cuesta abajo en la derecha",name:"Ve cuesta abajo en la derecha en {way_name}",destination:"Ve cuesta abajo en la derecha hacia {destination}",exit:"Toma la salida {exit} en la derecha",exit_destination:"Toma la salida {exit} en la derecha hacia {destination}"},"slight left":{default:"Ve cuesta abajo en la izquierda",name:"Ve cuesta abajo en la izquierda en {way_name}",destination:"Ve cuesta abajo en la izquierda hacia {destination}",exit:"Toma la salida {exit} en la izquierda",exit_destination:"Toma la salida {exit} en la izquierda hacia {destination}"},"slight right":{default:"Toma la salida en la derecha",name:"Toma la salida en la derecha en {way_name}",destination:"Toma la salida en la derecha hacia {destination}",exit:"Toma la salida {exit} en la derecha",exit_destination:"Toma la salida {exit} en la derecha hacia {destination}"}},"on ramp":{default:{default:"Toma la rampa",name:"Toma la rampa en {way_name}",destination:"Toma la rampa hacia {destination}"},left:{default:"Toma la rampa en la izquierda",name:"Toma la rampa en la izquierda en {way_name}",destination:"Toma la rampa en la izquierda hacia {destination}"},right:{default:"Toma la rampa en la derecha",name:"Toma la rampa en la derecha en {way_name}",destination:"Toma la rampa en la derecha hacia {destination}"},"sharp left":{default:"Toma la rampa en la izquierda",name:"Toma la rampa en la izquierda en {way_name}",destination:"Toma la rampa en la izquierda hacia {destination}"},"sharp right":{default:"Toma la rampa en la derecha",name:"Toma la rampa en la derecha en {way_name}",destination:"Toma la rampa en la derecha hacia {destination}"},"slight left":{default:"Toma la rampa en la izquierda",name:"Toma la rampa en la izquierda en {way_name}",destination:"Toma la rampa en la izquierda hacia {destination}"},"slight right":{default:"Toma la rampa en la derecha",name:"Toma la rampa en la derecha en {way_name}",destination:"Toma la rampa en la derecha hacia {destination}"}},rotary:{default:{default:{default:"Entra en la rotonda",name:"Entra en la rotonda y sal en {way_name}",destination:"Entra en la rotonda y sal hacia {destination}"},name:{default:"Entra en {rotary_name}",name:"Entra en {rotary_name} y sal en {way_name}",destination:"Entra en {rotary_name} y sal hacia {destination}"},exit:{default:"Entra en la rotonda y toma la {exit_number} salida",name:"Entra en la rotonda y toma la {exit_number} salida a {way_name}",destination:"Entra en la rotonda y toma la {exit_number} salida hacia {destination}"},name_exit:{default:"Entra en {rotary_name} y coge la {exit_number} salida",name:"Entra en {rotary_name} y coge la {exit_number} salida en {way_name}",destination:"Entra en {rotary_name} y coge la {exit_number} salida hacia {destination}"}}},roundabout:{default:{exit:{default:"Entra en la rotonda y toma la {exit_number} salida",name:"Entra en la rotonda y toma la {exit_number} salida a {way_name}",destination:"Entra en la rotonda y toma la {exit_number} salida hacia {destination}"},default:{default:"Entra en la rotonda",name:"Entra en la rotonda y sal en {way_name}",destination:"Entra en la rotonda y sal hacia {destination}"}}},"roundabout turn":{default:{default:"Sigue {modifier}",name:"Sigue {modifier} en {way_name}",destination:"Sigue {modifier} hacia {destination}"},left:{default:"Gira a la izquierda",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},right:{default:"Gira a la derecha",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},straight:{default:"Contina recto",name:"Contina recto en {way_name}",destination:"Contina recto hacia {destination}"}},"exit roundabout":{default:{default:"Sal la rotonda",name:"Sal la rotonda en {way_name}",destination:"Sal la rotonda hacia {destination}"}},"exit rotary":{default:{default:"Sal la rotonda",name:"Sal la rotonda en {way_name}",destination:"Sal la rotonda hacia {destination}"}},turn:{default:{default:"Sigue {modifier}",name:"Sigue {modifier} en {way_name}",destination:"Sigue {modifier} hacia {destination}"},left:{default:"Gira a la izquierda",name:"Gira a la izquierda en {way_name}",destination:"Gira a la izquierda hacia {destination}"},right:{default:"Gira a la derecha",name:"Gira a la derecha en {way_name}",destination:"Gira a la derecha hacia {destination}"},straight:{default:"Ve recto",name:"Ve recto en {way_name}",destination:"Ve recto hacia {destination}"}},"use lane":{no_lanes:{default:"Contina recto"},default:{default:"{lane_instruction}"}}}}},{}],29:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1.",2:"2.",3:"3.",4:"4.",5:"5.",6:"6.",7:"7.",8:"8.",9:"9.",10:"10."},direction:{north:"pohjoiseen",northeast:"koilliseen",east:"itn",southeast:"kaakkoon",south:"eteln",southwest:"lounaaseen",west:"lnteen",northwest:"luoteeseen"},modifier:{left:"vasemmall(e/a)",right:"oikeall(e/a)","sharp left":"jyrksti vasempaan","sharp right":"jyrksti oikeaan","slight left":"loivasti vasempaan","slight right":"loivasti oikeaan",straight:"suoraan eteenpin",uturn:"U-knns"},lanes:{xo:"Pysy oikealla",ox:"Pysy vasemmalla",xox:"Pysy keskell",oxo:"Pysy vasemmalla tai oikealla"}},modes:{ferry:{default:"Aja lautalle",name:"Aja lautalle {way_name}",destination:"Aja lautalle, jonka mrnp on {destination}"}},phrase:{"two linked by distance":"{instruction_one}, sitten {distance} pst, {instruction_two}","two linked":"{instruction_one}, sitten {instruction_two}","one in distance":"{distance} pst, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"{exit}"},arrive:{default:{default:"Olet saapunut {nth} mrnphsi",upcoming:"Saavut {nth} mrnphsi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}"},left:{default:"Olet saapunut {nth} mrnphsi, joka on vasemmalla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on vasemmalla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on vasemmalla puolellasi"},right:{default:"Olet saapunut {nth} mrnphsi, joka on oikealla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on oikealla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on oikealla puolellasi"},"sharp left":{default:"Olet saapunut {nth} mrnphsi, joka on vasemmalla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on vasemmalla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on vasemmalla puolellasi"},"sharp right":{default:"Olet saapunut {nth} mrnphsi, joka on oikealla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on oikealla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on oikealla puolellasi"},"slight right":{default:"Olet saapunut {nth} mrnphsi, joka on oikealla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on oikealla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on oikealla puolellasi"},"slight left":{default:"Olet saapunut {nth} mrnphsi, joka on vasemmalla puolellasi",upcoming:"Saavut {nth} mrnphsi, joka on vasemmalla puolellasi",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on vasemmalla puolellasi"},straight:{default:"Olet saapunut {nth} mrnphsi, joka on suoraan edesssi",upcoming:"Saavut {nth} mrnphsi, suoraan edess",short:"Olet saapunut","short-upcoming":"Saavut",named:"Olet saapunut mrnphn {waypoint_name}, joka on suoraan edesssi"}},continue:{default:{default:"Knny {modifier}",name:"Knny {modifier} pysyksesi tiell {way_name}",destination:"Knny {modifier} suuntana {destination}",exit:"Knny {modifier} tielle {way_name}"},straight:{default:"Jatka suoraan eteenpin",name:"Jatka suoraan pysyksesi tiell {way_name}",destination:"Jatka suuntana {destination}",distance:"Jatka suoraan {distance}",namedistance:"Jatka tiell {way_name} {distance}"},"sharp left":{default:"Jatka jyrksti vasempaan",name:"Jatka jyrksti vasempaan pysyksesi tiell {way_name}",destination:"Jatka jyrksti vasempaan suuntana {destination}"},"sharp right":{default:"Jatka jyrksti oikeaan",name:"Jatka jyrksti oikeaan pysyksesi tiell {way_name}",destination:"Jatka jyrksti oikeaan suuntana {destination}"},"slight left":{default:"Jatka loivasti vasempaan",name:"Jatka loivasti vasempaan pysyksesi tiell {way_name}",destination:"Jatka loivasti vasempaan suuntana {destination}"},"slight right":{default:"Jatka loivasti oikeaan",name:"Jatka loivasti oikeaan pysyksesi tiell {way_name}",destination:"Jatka loivasti oikeaan suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns ja jatka tiet {way_name}",destination:"Tee U-knns suuntana {destination}"}},depart:{default:{default:"Aja {direction}",name:"Aja tiet {way_name} {direction}",namedistance:"Aja {distance} {direction} tiet {way_name} "}},"end of road":{default:{default:"Knny {modifier}",name:"Knny {modifier} tielle {way_name}",destination:"Knny {modifier} suuntana {destination}"},straight:{default:"Jatka suoraan eteenpin",name:"Jatka suoraan eteenpin tielle {way_name}",destination:"Jatka suoraan eteenpin suuntana {destination}"},uturn:{default:"Tien pss tee U-knns",name:"Tien pss tee U-knns tielle {way_name}",destination:"Tien pss tee U-knns suuntana {destination}"}},fork:{default:{default:"Jatka tienhaarassa {modifier}",name:"Jatka {modifier} tielle {way_name}",destination:"Jatka {modifier} suuntana {destination}"},"slight left":{default:"Pysy vasemmalla tienhaarassa",name:"Pysy vasemmalla tielle {way_name}",destination:"Pysy vasemmalla suuntana {destination}"},"slight right":{default:"Pysy oikealla tienhaarassa",name:"Pysy oikealla tielle {way_name}",destination:"Pysy oikealla suuntana {destination}"},"sharp left":{default:"Knny tienhaarassa jyrksti vasempaan",name:"Knny tienhaarassa jyrksti vasempaan tielle {way_name}",destination:"Knny tienhaarassa jyrksti vasempaan suuntana {destination}"},"sharp right":{default:"Knny tienhaarassa jyrksti oikeaan",name:"Knny tienhaarassa jyrksti oikeaan tielle {way_name}",destination:"Knny tienhaarassa jyrksti oikeaan suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns tielle {way_name}",destination:"Tee U-knns suuntana {destination}"}},merge:{default:{default:"Liity {modifier}",name:"Liity {modifier}, tielle {way_name}",destination:"Liity {modifier}, suuntana {destination}"},straight:{default:"Liity",name:"Liity tielle {way_name}",destination:"Liity suuntana {destination}"},"slight left":{default:"Liity vasemmalle",name:"Liity vasemmalle, tielle {way_name}",destination:"Liity vasemmalle, suuntana {destination}"},"slight right":{default:"Liity oikealle",name:"Liity oikealle, tielle {way_name}",destination:"Liity oikealle, suuntana {destination}"},"sharp left":{default:"Liity vasemmalle",name:"Liity vasemmalle, tielle {way_name}",destination:"Liity vasemmalle, suuntana {destination}"},"sharp right":{default:"Liity oikealle",name:"Liity oikealle, tielle {way_name}",destination:"Liity oikealle, suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns tielle {way_name}",destination:"Tee U-knns suuntana {destination}"}},"new name":{default:{default:"Jatka {modifier}",name:"Jatka {modifier} tielle {way_name}",destination:"Jatka {modifier} suuntana {destination}"},straight:{default:"Jatka suoraan eteenpin",name:"Jatka tielle {way_name}",destination:"Jatka suuntana {destination}"},"sharp left":{default:"Knny jyrksti vasempaan",name:"Knny jyrksti vasempaan tielle {way_name}",destination:"Knny jyrksti vasempaan suuntana {destination}"},"sharp right":{default:"Knny jyrksti oikeaan",name:"Knny jyrksti oikeaan tielle {way_name}",destination:"Knny jyrksti oikeaan suuntana {destination}"},"slight left":{default:"Jatka loivasti vasempaan",name:"Jatka loivasti vasempaan tielle {way_name}",destination:"Jatka loivasti vasempaan suuntana {destination}"},"slight right":{default:"Jatka loivasti oikeaan",name:"Jatka loivasti oikeaan tielle {way_name}",destination:"Jatka loivasti oikeaan suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns tielle {way_name}",destination:"Tee U-knns suuntana {destination}"}},notification:{default:{default:"Jatka {modifier}",name:"Jatka {modifier} tielle {way_name}",destination:"Jatka {modifier} suuntana {destination}"},uturn:{default:"Tee U-knns",name:"Tee U-knns tielle {way_name}",destination:"Tee U-knns suuntana {destination}"}},"off ramp":{default:{default:"Aja erkanemiskaistalle",name:"Aja erkanemiskaistaa tielle {way_name}",destination:"Aja erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit}",exit_destination:"Ota poistuminen {exit}, suuntana {destination}"},left:{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} vasemmalla",exit_destination:"Ota poistuminen {exit} vasemmalla, suuntana {destination}"},right:{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} oikealla",exit_destination:"Ota poistuminen {exit} oikealla, suuntana {destination}"},"sharp left":{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} vasemmalla",exit_destination:"Ota poistuminen {exit} vasemmalla, suuntana {destination}"},"sharp right":{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} oikealla",exit_destination:"Ota poistuminen {exit} oikealla, suuntana {destination}"},"slight left":{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} vasemmalla",exit_destination:"Ota poistuminen {exit} vasemmalla, suuntana {destination}"},"slight right":{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}",exit:"Ota poistuminen {exit} oikealla",exit_destination:"Ota poistuminen {exit} oikealla, suuntana {destination}"}},"on ramp":{default:{default:"Aja erkanemiskaistalle",name:"Aja erkanemiskaistaa tielle {way_name}",destination:"Aja erkanemiskaistalle suuntana {destination}"},left:{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}"},right:{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}"},"sharp left":{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}"},"sharp right":{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}"},"slight left":{default:"Aja vasemmalla olevalle erkanemiskaistalle",name:"Aja vasemmalla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja vasemmalla olevalle erkanemiskaistalle suuntana {destination}"},"slight right":{default:"Aja oikealla olevalle erkanemiskaistalle",name:"Aja oikealla olevaa erkanemiskaistaa tielle {way_name}",destination:"Aja oikealla olevalle erkanemiskaistalle suuntana {destination}"}},rotary:{default:{default:{default:"Aja liikenneympyrn",name:"Aja liikenneympyrn ja valitse erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn ja valitse erkanemiskaista suuntana {destination}"},name:{default:"Aja liikenneympyrn {rotary_name}",name:"Aja liikenneympyrn {rotary_name} ja valitse erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn {rotary_name} ja valitse erkanemiskaista suuntana {destination}"},exit:{default:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista",name:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista suuntana {destination}"},name_exit:{default:"Aja liikenneympyrn {rotary_name} ja valitse {exit_number} erkanemiskaista",name:"Aja liikenneympyrn {rotary_name} ja valitse {exit_number} erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn {rotary_name} ja valitse {exit_number} erkanemiskaista suuntana {destination}"}}},roundabout:{default:{exit:{default:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista",name:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn ja valitse {exit_number} erkanemiskaista suuntana {destination}"},default:{default:"Aja liikenneympyrn",name:"Aja liikenneympyrn ja valitse erkanemiskaista tielle {way_name}",destination:"Aja liikenneympyrn ja valitse erkanemiskaista suuntana {destination}"}}},"roundabout turn":{default:{default:"Knny {modifier}",name:"Knny {modifier} tielle {way_name}",destination:"Knny {modifier} suuntana {destination}"},left:{default:"Knny vasempaan",name:"Knny vasempaan tielle {way_name}",destination:"Knny vasempaan suuntana {destination}"},right:{default:"Knny oikeaan",name:"Knny oikeaan tielle {way_name}",destination:"Knny oikeaan suuntana {destination}"},straight:{default:"Jatka suoraan eteenpin",name:"Jatka suoraan eteenpin tielle {way_name}",destination:"Jatka suoraan eteenpin suuntana {destination}"}},"exit roundabout":{default:{default:"Poistu liikenneympyrst",name:"Poistu liikenneympyrst tielle {way_name}",destination:"Poistu liikenneympyrst suuntana {destination}"}},"exit rotary":{default:{default:"Poistu liikenneympyrst",name:"Poistu liikenneympyrst tielle {way_name}",destination:"Poistu liikenneympyrst suuntana {destination}"}},turn:{default:{default:"Knny {modifier}",name:"Knny {modifier} tielle {way_name}",destination:"Knny {modifier} suuntana {destination}"},left:{default:"Knny vasempaan",name:"Knny vasempaan tielle {way_name}",destination:"Knny vasempaan suuntana {destination}"},right:{default:"Knny oikeaan",name:"Knny oikeaan tielle {way_name}",destination:"Knny oikeaan suuntana {destination}"},straight:{default:"Aja suoraan eteenpin",name:"Aja suoraan eteenpin tielle {way_name}",destination:"Aja suoraan eteenpin suuntana {destination}"}},"use lane":{no_lanes:{default:"Jatka suoraan eteenpin"},default:{default:"{lane_instruction}"}}}}},{}],30:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"premire",2:"seconde",3:"troisime",4:"quatrime",5:"cinquime",6:"sixime",7:"septime",8:"huitime",9:"neuvime",10:"dixime"},direction:{north:"le nord",northeast:"le nord-est",east:"lest",southeast:"le sud-est",south:"le sud",southwest:"le sud-ouest",west:"louest",northwest:"le nord-ouest"},modifier:{left:" gauche",right:" droite","sharp left":"franchement  gauche","sharp right":"franchement  droite","slight left":"lgrement  gauche","slight right":"lgrement  droite",straight:"tout droit",uturn:"demi-tour"},lanes:{xo:"Tenir la droite",ox:"Tenir la gauche",xox:"Rester au milieu",oxo:"Tenir la gauche ou la droite"}},modes:{ferry:{default:"Prendre le ferry",name:"Prendre le ferry {way_name:article}",destination:"Prendre le ferry en direction {destination:preposition}"}},phrase:{"two linked by distance":"{instruction_one}, puis, dans {distance}, {instruction_two}","two linked":"{instruction_one}, puis {instruction_two}","one in distance":"Dans {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"sortie n{exit}"},arrive:{default:{default:"Vous tes arriv  votre {nth} destination",upcoming:"Vous arriverez  votre {nth} destination",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}"},left:{default:"Vous tes arriv  votre {nth} destination, sur la gauche",upcoming:"Vous arriverez  votre {nth} destination, sur la gauche",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}, sur la gauche"},right:{default:"Vous tes arriv  votre {nth} destination, sur la droite",upcoming:"Vous arriverez  votre {nth} destination, sur la droite",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv   {waypoint_name:arrival}, sur la droite"},"sharp left":{default:"Vous tes arriv  votre {nth} destination, sur la gauche",upcoming:"Vous arriverez  votre {nth} destination, sur la gauche",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}, sur la gauche"},"sharp right":{default:"Vous tes arriv  votre {nth} destination, sur la droite",upcoming:"Vous arriverez  votre {nth} destination, sur la droite",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}, sur la droite"},"slight right":{default:"Vous tes arriv  votre {nth} destination, sur la droite",upcoming:"Vous arriverez  votre {nth} destination, sur la droite",short:"Vous tes arriv","short-upcoming":"Vous arriverez",named:"Vous tes arriv {waypoint_name:arrival}, sur la droite"},"slight left":{default:"Vous tes arriv  votre {nth} destination, sur la gauche",upcoming:"Vous arriverez  votre {nth} destination, sur la gauche",short:"Vous tes arriv","short-upcoming":"Vous tes arriv",named:"Vous tes arriv {waypoint_name:arrival}, sur la gauche"},straight:{default:"Vous tes arriv  votre {nth} destination, droit devant",upcoming:"Vous arriverez  votre {nth} destination, droit devant",short:"Vous tes arriv","short-upcoming":"Vous tes arriv",named:"Vous tes arriv {waypoint_name:arrival}, droit devant"}},continue:{default:{default:"Tourner {modifier}",name:"Tourner {modifier} pour rester sur {way_name:article}",destination:"Tourner {modifier} en direction {destination:preposition}",exit:"Tourner {modifier} sur {way_name:article}"},straight:{default:"Continuer tout droit",name:"Continuer tout droit pour rester sur {way_name:article}",destination:"Continuer tout droit en direction {destination:preposition}",distance:"Continuer tout droit sur {distance}",namedistance:"Continuer sur {way_name:article} sur {distance}"},"sharp left":{default:"Tourner franchement  gauche",name:"Tourner franchement  gauche pour rester sur {way_name:article}",destination:"Tourner franchement  gauche en direction {destination:preposition}"},"sharp right":{default:"Tourner franchement  droite",name:"Tourner franchement  droite pour rester sur {way_name:article}",destination:"Tourner franchement  droite en direction {destination:preposition}"},"slight left":{default:"Tourner lgrement  gauche",name:"Tourner lgrement  gauche pour rester sur {way_name:article}",destination:"Tourner lgrement  gauche en direction {destination:preposition}"},"slight right":{default:"Tourner lgrement  droite",name:"Tourner lgrement  droite pour rester sur {way_name:article}",destination:"Tourner lgrement  droite en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour et continuer sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},depart:{default:{default:"Se diriger vers {direction}",name:"Se diriger vers {direction} sur {way_name:article}",namedistance:"Se diriger vers {direction} sur {way_name:article} sur {distance}"}},"end of road":{default:{default:"Tourner {modifier}",name:"Tourner {modifier} sur {way_name:article}",destination:"Tourner {modifier} en direction {destination:preposition}"},straight:{default:"Continuer tout droit",name:"Continuer tout droit sur {way_name:article}",destination:"Continuer tout droit en direction {destination:preposition}"},uturn:{default:"Faire demi-tour  la fin de la route",name:"Faire demi-tour  la fin {way_name:preposition}",destination:"Faire demi-tour  la fin de la route en direction {destination:preposition}"}},fork:{default:{default:"Tenir {modifier}  lembranchement",name:"Tenir {modifier} sur {way_name:article}",destination:"Tenir {modifier} en direction {destination:preposition}"},"slight left":{default:"Tenir la gauche  lembranchement",name:"Tenir la gauche sur {way_name:article}",destination:"Tenir la gauche en direction {destination:preposition}"},"slight right":{default:"Tenir la droite  lembranchement",name:"Tenir la droite sur {way_name:article}",destination:"Tenir la droite en direction {destination:preposition}"},"sharp left":{default:"Tourner franchement  gauche  lembranchement",name:"Tourner franchement  gauche sur {way_name:article}",destination:"Tourner franchement  gauche en direction {destination:preposition}"},"sharp right":{default:"Tourner franchement  droite  lembranchement",name:"Tourner franchement  droite sur {way_name:article}",destination:"Tourner franchement  droite en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},merge:{default:{default:"Sinsrer {modifier}",name:"Sinsrer {modifier} sur {way_name:article}",destination:"Sinsrer {modifier} en direction {destination:preposition}"},straight:{default:"Sinsrer",name:"Sinsrer sur {way_name:article}",destination:"Sinsrer en direction {destination:preposition}"},"slight left":{default:"Sinsrer lgrement  gauche",name:"Sinsrer lgrement  gauche sur {way_name:article}",destination:"Sinsrer lgrement  gauche en direction {destination:preposition}"},"slight right":{default:"Sinsrer lgrement  droite",name:"Sinsrer lgrement  droite sur {way_name:article}",destination:"Sinsrer  droite en direction {destination:preposition}"},"sharp left":{default:"Sinsrer  gauche",name:"Sinsrer  gauche sur {way_name:article}",destination:"Sinsrer  gauche en direction {destination:preposition}"},"sharp right":{default:"Sinsrer  droite",name:"Sinsrer  droite sur {way_name:article}",destination:"Sinsrer  droite en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},"new name":{default:{default:"Continuer {modifier}",name:"Continuer {modifier} sur {way_name:article}",destination:"Continuer {modifier} en direction {destination:preposition}"},straight:{default:"Continuer tout droit",name:"Continuer tout droit sur {way_name:article}",destination:"Continuer tout droit en direction {destination:preposition}"},"sharp left":{default:"Tourner franchement  gauche",name:"Tourner franchement  gauche sur {way_name:article}",destination:"Tourner franchement  gauche en direction {destination:preposition}"},"sharp right":{default:"Tourner franchement  droite",name:"Tourner franchement  droite sur {way_name:article}",destination:"Tourner franchement  droite en direction {destination:preposition}"},"slight left":{default:"Continuer lgrement  gauche",name:"Continuer lgrement  gauche sur {way_name:article}",destination:"Continuer lgrement  gauche en direction {destination:preposition}"},"slight right":{default:"Continuer lgrement  droite",name:"Continuer lgrement  droite sur {way_name:article}",destination:"Continuer lgrement  droite en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},notification:{default:{default:"Continuer {modifier}",name:"Continuer {modifier} sur {way_name:article}",destination:"Continuer {modifier} en direction {destination:preposition}"},uturn:{default:"Faire demi-tour",name:"Faire demi-tour sur {way_name:article}",destination:"Faire demi-tour en direction {destination:preposition}"}},"off ramp":{default:{default:"Prendre la sortie",name:"Prendre la sortie sur {way_name:article}",destination:"Prendre la sortie en direction {destination:preposition}",exit:"Prendre la sortie {exit}",exit_destination:"Prendre la sortie {exit} en direction {destination:preposition}"},left:{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la gauche",exit_destination:"Prendre la sortie {exit} sur la gauche en direction {destination:preposition}"},right:{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la droite",exit_destination:"Prendre la sortie {exit} sur la droite en direction {destination:preposition}"},"sharp left":{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la gauche",exit_destination:"Prendre la sortie {exit} sur la gauche en direction {destination:preposition}"},"sharp right":{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la droite",exit_destination:"Prendre la sortie {exit} sur la droite en direction {destination:preposition}"},"slight left":{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la gauche",exit_destination:"Prendre la sortie {exit} sur la gauche en direction {destination:preposition}"},"slight right":{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}",exit:"Prendre la sortie {exit} sur la droite",exit_destination:"Prendre la sortie {exit} sur la droite en direction {destination:preposition}"}},"on ramp":{default:{default:"Prendre la sortie",name:"Prendre la sortie sur {way_name:article}",destination:"Prendre la sortie en direction {destination:preposition}"},left:{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}"},right:{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}"},"sharp left":{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}"},"sharp right":{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}"},"slight left":{default:"Prendre la sortie  gauche",name:"Prendre la sortie  gauche sur {way_name:article}",destination:"Prendre la sortie  gauche en direction {destination:preposition}"},"slight right":{default:"Prendre la sortie  droite",name:"Prendre la sortie  droite sur {way_name:article}",destination:"Prendre la sortie  droite en direction {destination:preposition}"}},rotary:{default:{default:{default:"Prendre le rond-point",name:"Prendre le rond-point, puis sortir sur {way_name:article}",destination:"Prendre le rond-point, puis sortir en direction {destination:preposition}"},name:{default:"Prendre {rotary_name:rotary}",name:"Prendre {rotary_name:rotary}, puis sortir par {way_name:article}",destination:"Prendre {rotary_name:rotary}, puis sortir en direction {destination:preposition}"},exit:{default:"Prendre le rond-point, puis la {exit_number} sortie",name:"Prendre le rond-point, puis la {exit_number} sortie sur {way_name:article}",destination:"Prendre le rond-point, puis la {exit_number} sortie en direction {destination:preposition}"},name_exit:{default:"Prendre {rotary_name:rotary}, puis la {exit_number} sortie",name:"Prendre {rotary_name:rotary}, puis la {exit_number} sortie sur {way_name:article}",destination:"Prendre {rotary_name:rotary}, puis la {exit_number} sortie en direction {destination:preposition}"}}},roundabout:{default:{exit:{default:"Prendre le rond-point, puis la {exit_number} sortie",name:"Prendre le rond-point, puis la {exit_number} sortie sur {way_name:article}",destination:"Prendre le rond-point, puis la {exit_number} sortie en direction {destination:preposition}"},default:{default:"Prendre le rond-point",name:"Prendre le rond-point, puis sortir sur {way_name:article}",destination:"Prendre le rond-point, puis sortir en direction {destination:preposition}"}}},"roundabout turn":{default:{default:"Tourner {modifier}",name:"Tourner {modifier} sur {way_name:article}",destination:"Tourner {modifier} en direction {destination:preposition}"},left:{default:"Tourner  gauche",name:"Tourner  gauche sur {way_name:article}",destination:"Tourner  gauche en direction {destination:preposition}"},right:{default:"Tourner  droite",name:"Tourner  droite sur {way_name:article}",destination:"Tourner  droite en direction {destination:preposition}"},straight:{default:"Continuer tout droit",name:"Continuer tout droit sur {way_name:article}",destination:"Continuer tout droit en direction {destination:preposition}"}},"exit roundabout":{default:{default:"Sortir du rond-point",name:"Sortir du rond-point sur {way_name:article}",destination:"Sortir du rond-point en direction {destination:preposition}"}},"exit rotary":{default:{default:"Sortir du rond-point",name:"Sortir du rond-point sur {way_name:article}",destination:"Sortir du rond-point en direction {destination:preposition}"}},turn:{default:{default:"Tourner {modifier}",name:"Tourner {modifier} sur {way_name:article}",destination:"Tourner {modifier} en direction {destination:preposition}"},left:{default:"Tourner  gauche",name:"Tourner  gauche sur {way_name:article}",destination:"Tourner  gauche en direction {destination:preposition}"},right:{default:"Tourner  droite",name:"Tourner  droite sur {way_name:article}",destination:"Tourner  droite en direction {destination:preposition}"},straight:{default:"Aller tout droit",name:"Aller tout droit sur {way_name:article}",destination:"Aller tout droit en direction {destination:preposition}"}},"use lane":{no_lanes:{default:"Continuer tout droit"},default:{default:"{lane_instruction}"}}}}},{}],31:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:" ",east:"",southeast:" ",south:"",southwest:" ",west:"",northwest:" "},modifier:{left:"",right:"","sharp left":" ","sharp right":" ","slight left":" ","slight right":" ",straight:"",uturn:" "},lanes:{xo:" ",ox:" ",xox:"  ",oxo:"   "}},modes:{ferry:{default:"  ",name:"   {way_name}",destination:"    {destination}"}},phrase:{"two linked by distance":"{instruction_one}, , {distance}, {instruction_two}","two linked":"{instruction_one},  {instruction_two}","one in distance":" {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":" {exit}"},arrive:{default:{default:"   {nth} ",upcoming:"    {nth} ",short:"","short-upcoming":"",named:"  {waypoint_name}"},left:{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},right:{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},"sharp left":{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},"sharp right":{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},"slight right":{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},"slight left":{default:"   {nth}  ",upcoming:"    {nth}  ",short:"","short-upcoming":"",named:"  {waypoint_name}  "},straight:{default:"   {nth} , ",upcoming:"    {nth} , ",short:"","short-upcoming":"",named:"  {waypoint_name}, "}},continue:{default:{default:" {modifier}",name:" {modifier}   {way_name}",destination:" {modifier}  {destination}",exit:" {modifier}  {way_name}"},straight:{default:" ",name:"     {way_name}",destination:"  {destination}",distance:"   {distance}",namedistance:"  {way_name}  {distance}"},"sharp left":{default:"  ",name:"      {way_name}",destination:"    {destination}"},"sharp right":{default:"  ",name:"      {way_name}",destination:"    {destination}"},"slight left":{default:"  ",name:"      {way_name}",destination:"    {destination}"},"slight right":{default:"  ",name:"      {way_name}",destination:"    {destination}"},uturn:{default:"  ",name:"     {way_name}",destination:"    {destination}"}},depart:{default:{default:" {direction}",name:" {direction}  {way_name}",namedistance:" {direction}  {way_name}  {distance}"}},"end of road":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},straight:{default:" ",name:"   {way_name}",destination:"   {destination}"},uturn:{default:"    ",name:"    {way_name}  ",destination:"    {destination}  "}},fork:{default:{default:" {modifier} ",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},"slight left":{default:"  ",name:"   {way_name}",destination:"   {destination}"},"slight right":{default:"  ",name:"   {way_name}",destination:"   {destination}"},"sharp left":{default:"   ",name:"    {way_name}",destination:"    {destination}"},"sharp right":{default:"   ",name:"    {way_name}",destination:"    {destination}"},uturn:{default:"  ",name:"    {way_name}",destination:"    {destination}"}},merge:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},straight:{default:"",name:"  {way_name}",destination:"  {destination}"},"slight left":{default:" ",name:"   {way_name}",destination:"   {destination}"},"slight right":{default:" ",name:"   {way_name}",destination:"   {destination}"},"sharp left":{default:" ",name:"   {way_name}",destination:"   {destination}"},"sharp right":{default:" ",name:"   {way_name}",destination:"   {destination}"},uturn:{default:"  ",name:"    {way_name}",destination:"    {destination}"}},"new name":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},straight:{default:" ",name:"  {way_name}",destination:"  {destination}"},"sharp left":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"sharp right":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"     {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"     {destination}"},uturn:{default:"  ",name:"    {way_name}",destination:"    {destination}"}},notification:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},uturn:{default:"  ",name:"    {way_name}",destination:"    {destination}"}},"off ramp":{default:{default:" ",name:"   {way_name}",destination:"   {destination}",exit:"  {exit}",exit_destination:"  {exit}  {destination}"},left:{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},right:{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},"sharp left":{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},"sharp right":{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},"slight left":{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"},"slight right":{default:"  ",name:"    {way_name}",destination:"    {destination}",exit:"  {exit} ",exit_destination:"  {exit}   {destination}"}},"on ramp":{default:{default:" ",name:"   {way_name}",destination:"   {destination}"},left:{default:"  ",name:"    {way_name}",destination:"    {destination}"},right:{default:"  ",name:"    {way_name}",destination:"    {destination}"},"sharp left":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"sharp right":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"slight left":{default:"  ",name:"    {way_name}",destination:"    {destination}"},"slight right":{default:"  ",name:"    {way_name}",destination:"    {destination}"}},rotary:{default:{default:{default:"  ",name:"     {way_name}",destination:"     {destination}"},name:{default:" {rotary_name}",name:" {rotary_name}   {way_name}",destination:" {rotary_name}   {destination}"},exit:{default:"     {exit_number}",name:"     {exit_number} {way_name}",destination:"     {exit_number}  {destination}"},name_exit:{default:" {rotary_name}   {exit_number}",name:" {rotary_name}   {exit_number} {way_name}",destination:" {rotary_name}   {exit_number}  {destination}"}}},roundabout:{default:{exit:{default:"     {exit_number}",name:"     {exit_number} {way_name}",destination:"     {exit_number}  {destination}"},default:{default:"  ",name:"     {way_name}",destination:"     {destination}"}}},"roundabout turn":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},left:{default:" ",name:"  {way_name}",destination:"   {destination}"},right:{default:" ",name:"  {way_name}",destination:"   {destination}"},straight:{default:" ",name:"   {way_name}",destination:"   {destination}"}},"exit roundabout":{default:{default:"  ",name:"   {way_name}",destination:"    {destination}"}},"exit rotary":{default:{default:"  ",name:"   {way_name}",destination:"    {destination}"}},turn:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}  {destination}"},left:{default:" ",name:"  {way_name}",destination:"   {destination}"},right:{default:" ",name:"  {way_name}",destination:"   {destination}"},straight:{default:" ",name:"  {way_name}",destination:"   {destination}"}},"use lane":{no_lanes:{default:" "},default:{default:"{lane_instruction}"}}}}},{}],32:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"utara",northeast:"timur laut",east:"timur",southeast:"tenggara",south:"selatan",southwest:"barat daya",west:"barat",northwest:"barat laut"},modifier:{left:"kiri",right:"kanan","sharp left":"tajam kiri","sharp right":"tajam kanan","slight left":"agak ke kiri","slight right":"agak ke kanan",straight:"lurus",uturn:"putar balik"},lanes:{xo:"Tetap di kanan",ox:"Tetap di kiri",xox:"Tetap di tengah",oxo:"Tetap di kiri atau kanan"}},modes:{ferry:{default:"Naik ferry",name:"Naik ferry di {way_name}",destination:"Naik ferry menuju {destination}"}},phrase:{"two linked by distance":"{instruction_one}, then, in {distance}, {instruction_two}","two linked":"{instruction_one}, then {instruction_two}","one in distance":"In {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Anda telah tiba di tujuan ke-{nth}",upcoming:"Anda telah tiba di tujuan ke-{nth}",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}"},left:{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kiri"},right:{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kanan"},"sharp left":{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kiri"},"sharp right":{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kanan"},"slight right":{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kanan",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kanan"},"slight left":{default:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",upcoming:"Anda telah tiba di tujuan ke-{nth}, di sebelah kiri",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, di sebelah kiri"},straight:{default:"Anda telah tiba di tujuan ke-{nth}, lurus saja",upcoming:"Anda telah tiba di tujuan ke-{nth}, lurus saja",short:"Anda telah tiba di tujuan ke-{nth}","short-upcoming":"Anda telah tiba di tujuan ke-{nth}",named:"Anda telah tiba di {waypoint_name}, lurus saja"}},continue:{default:{default:"Belok {modifier}",name:"Terus {modifier} ke {way_name}",destination:"Belok {modifier} menuju {destination}",exit:"Belok {modifier} ke {way_name}"},straight:{default:"Lurus terus",name:"Terus ke {way_name}",destination:"Terus menuju {destination}",distance:"Continue straight for {distance}",namedistance:"Continue on {way_name} for {distance}"},"sharp left":{default:"Belok kiri tajam",name:"Make a sharp left to stay on {way_name}",destination:"Belok kiri tajam menuju {destination}"},"sharp right":{default:"Belok kanan tajam",name:"Make a sharp right to stay on {way_name}",destination:"Belok kanan tajam menuju {destination}"},"slight left":{default:"Tetap agak di kiri",name:"Tetap agak di kiri ke {way_name}",destination:"Tetap agak di kiri menuju {destination}"},"slight right":{default:"Tetap agak di kanan",name:"Tetap agak di kanan ke {way_name}",destination:"Tetap agak di kanan menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},depart:{default:{default:"Arah {direction}",name:"Arah {direction} di {way_name}",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"Belok {modifier}",name:"Belok {modifier} ke {way_name}",destination:"Belok {modifier} menuju {destination}"},straight:{default:"Lurus terus",name:"Tetap lurus ke {way_name} ",destination:"Tetap lurus menuju {destination}"},uturn:{default:"Putar balik di akhir jalan",name:"Putar balik di {way_name} di akhir jalan",destination:"Putar balik menuju {destination} di akhir jalan"}},fork:{default:{default:"Tetap {modifier} di pertigaan",name:"Tetap {modifier} di pertigaan ke {way_name}",destination:"Tetap {modifier} di pertigaan menuju {destination}"},"slight left":{default:"Tetap di kiri pada pertigaan",name:"Tetap di kiri pada pertigaan ke arah {way_name}",destination:"Tetap di kiri pada pertigaan menuju {destination}"},"slight right":{default:"Tetap di kanan pada pertigaan",name:"Tetap di kanan pada pertigaan ke arah {way_name}",destination:"Tetap di kanan pada pertigaan menuju {destination}"},"sharp left":{default:"Belok kiri pada pertigaan",name:"Belok kiri tajam ke arah {way_name}",destination:"Belok kiri tajam menuju {destination}"},"sharp right":{default:"Belok kanan pada pertigaan",name:"Belok kanan tajam ke arah {way_name}",destination:"Belok kanan tajam menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},merge:{default:{default:"Bergabung {modifier}",name:"Bergabung {modifier} ke arah {way_name}",destination:"Bergabung {modifier} menuju {destination}"},straight:{default:"Bergabung lurus",name:"Bergabung lurus ke arah {way_name}",destination:"Bergabung lurus menuju {destination}"},"slight left":{default:"Bergabung di kiri",name:"Bergabung di kiri ke arah {way_name}",destination:"Bergabung di kiri menuju {destination}"},"slight right":{default:"Bergabung di kanan",name:"Bergabung di kanan ke arah {way_name}",destination:"Bergabung di kanan menuju {destination}"},"sharp left":{default:"Bergabung di kiri",name:"Bergabung di kiri ke arah {way_name}",destination:"Bergabung di kiri menuju {destination}"},"sharp right":{default:"Bergabung di kanan",name:"Bergabung di kanan ke arah {way_name}",destination:"Bergabung di kanan menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},"new name":{default:{default:"Lanjutkan {modifier}",name:"Lanjutkan {modifier} menuju {way_name}",destination:"Lanjutkan {modifier} menuju {destination}"},straight:{default:"Lurus terus",name:"Terus ke {way_name}",destination:"Terus menuju {destination}"},"sharp left":{default:"Belok kiri tajam",name:"Belok kiri tajam ke arah {way_name}",destination:"Belok kiri tajam menuju {destination}"},"sharp right":{default:"Belok kanan tajam",name:"Belok kanan tajam ke arah {way_name}",destination:"Belok kanan tajam menuju {destination}"},"slight left":{default:"Lanjut dengan agak ke kiri",name:"Lanjut dengan agak di kiri ke {way_name}",destination:"Tetap agak di kiri menuju {destination}"},"slight right":{default:"Tetap agak di kanan",name:"Tetap agak di kanan ke {way_name}",destination:"Tetap agak di kanan menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},notification:{default:{default:"Lanjutkan {modifier}",name:"Lanjutkan {modifier} menuju {way_name}",destination:"Lanjutkan {modifier} menuju {destination}"},uturn:{default:"Putar balik",name:"Putar balik ke arah {way_name}",destination:"Putar balik menuju {destination}"}},"off ramp":{default:{default:"Ambil jalan melandai",name:"Ambil jalan melandai ke {way_name}",destination:"Ambil jalan melandai menuju {destination}",exit:"Take exit {exit}",exit_destination:"Take exit {exit} towards {destination}"},left:{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},right:{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan menuju {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"},"sharp left":{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},"sharp right":{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan menuju {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"},"slight left":{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}",exit:"Take exit {exit} on the left",exit_destination:"Take exit {exit} on the left towards {destination}"},"slight right":{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan  menuju {destination}",exit:"Take exit {exit} on the right",exit_destination:"Take exit {exit} on the right towards {destination}"}},"on ramp":{default:{default:"Ambil jalan melandai",name:"Ambil jalan melandai ke {way_name}",destination:"Ambil jalan melandai menuju {destination}"},left:{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}"},right:{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan  menuju {destination}"},"sharp left":{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}"},"sharp right":{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan  menuju {destination}"},"slight left":{default:"Ambil jalan yang melandai di sebelah kiri",name:"Ambil jalan melandai di sebelah kiri ke arah {way_name}",destination:"Ambil jalan melandai di sebelah kiri menuju {destination}"},"slight right":{default:"Ambil jalan melandai di sebelah kanan",name:"Ambil jalan melandai di sebelah kanan ke {way_name}",destination:"Ambil jalan melandai di sebelah kanan  menuju {destination}"}},rotary:{default:{default:{default:"Masuk bundaran",name:"Masuk bundaran dan keluar arah {way_name}",destination:"Masuk bundaran dan keluar menuju {destination}"},name:{default:"Masuk {rotary_name}",name:"Masuk {rotary_name} dan keluar arah {way_name}",destination:"Masuk {rotary_name} dan keluar menuju {destination}"},exit:{default:"Masuk bundaran dan ambil jalan keluar {exit_number}",name:"Masuk bundaran dan ambil jalan keluar {exit_number} arah {way_name}",destination:"Masuk bundaran dan ambil jalan keluar {exit_number} menuju {destination}"},name_exit:{default:"Masuk {rotary_name} dan ambil jalan keluar {exit_number}",name:"Masuk {rotary_name} dan ambil jalan keluar {exit_number} arah {way_name}",destination:"Masuk {rotary_name} dan ambil jalan keluar {exit_number} menuju {destination}"}}},roundabout:{default:{exit:{default:"Masuk bundaran dan ambil jalan keluar {exit_number}",name:"Masuk bundaran dan ambil jalan keluar {exit_number} arah {way_name}",destination:"Masuk bundaran dan ambil jalan keluar {exit_number} menuju {destination}"},default:{default:"Masuk bundaran",name:"Masuk bundaran dan keluar arah {way_name}",destination:"Masuk bundaran dan keluar menuju {destination}"}}},"roundabout turn":{default:{default:"Lakukan {modifier}",name:"Lakukan {modifier} ke arah {way_name}",destination:"Lakukan {modifier} menuju {destination}"},left:{default:"Belok kiri",name:"Belok kiri ke {way_name}",destination:"Belok kiri menuju {destination}"},right:{default:"Belok kanan",name:"Belok kanan ke {way_name}",destination:"Belok kanan menuju {destination}"},straight:{default:"Lurus terus",name:"Tetap lurus ke {way_name} ",destination:"Tetap lurus menuju {destination}"}},"exit roundabout":{default:{default:"Lakukan {modifier}",name:"Lakukan {modifier} ke arah {way_name}",destination:"Lakukan {modifier} menuju {destination}"},left:{default:"Belok kiri",name:"Belok kiri ke {way_name}",destination:"Belok kiri menuju {destination}"},right:{default:"Belok kanan",name:"Belok kanan ke {way_name}",destination:"Belok kanan menuju {destination}"},straight:{default:"Lurus terus",name:"Tetap lurus ke {way_name} ",destination:"Tetap lurus menuju {destination}"}},"exit rotary":{default:{default:"Lakukan {modifier}",name:"Lakukan {modifier} ke arah {way_name}",destination:"Lakukan {modifier} menuju {destination}"},left:{default:"Belok kiri",name:"Belok kiri ke {way_name}",destination:"Belok kiri menuju {destination}"},right:{default:"Belok kanan",name:"Belok kanan ke {way_name}",destination:"Belok kanan menuju {destination}"},straight:{default:"Lurus",name:"Lurus arah {way_name}",destination:"Lurus menuju {destination}"}},turn:{default:{default:"Lakukan {modifier}",name:"Lakukan {modifier} ke arah {way_name}",destination:"Lakukan {modifier} menuju {destination}"},left:{default:"Belok kiri",name:"Belok kiri ke {way_name}",destination:"Belok kiri menuju {destination}"},right:{default:"Belok kanan",name:"Belok kanan ke {way_name}",destination:"Belok kanan menuju {destination}"},straight:{default:"Lurus",name:"Lurus arah {way_name}",destination:"Lurus menuju {destination}"}},"use lane":{no_lanes:{default:"Lurus terus"},default:{default:"{lane_instruction}"}}}}},{}],33:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"nord",northeast:"nord-est",east:"est",southeast:"sud-est",south:"sud",southwest:"sud-ovest",west:"ovest",northwest:"nord-ovest"},modifier:{left:"sinistra",right:"destra","sharp left":"sinistra","sharp right":"destra","slight left":"sinistra leggermente","slight right":"destra leggermente",straight:"dritto",uturn:"inversione a U"},lanes:{xo:"Mantieni la destra",ox:"Mantieni la sinistra",xox:"Rimani in mezzo",oxo:"Mantieni la destra o la sinistra"}},modes:{ferry:{default:"Prendi il traghetto",name:"Prendi il traghetto {way_name}",destination:"Prendi il traghetto verso {destination}"}},phrase:{"two linked by distance":"{instruction_one}, poi tra {distance},{instruction_two}","two linked":"{instruction_one}, poi {instruction_two}","one in distance":"tra {distance} {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Sei arrivato alla tua {nth} destinazione",upcoming:"Sei arrivato alla tua {nth} destinazione",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"Sei arrivato a {waypoint_name}"},left:{default:"sei arrivato alla tua {nth} destinazione, sulla sinistra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla sinistra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla sinistra"},right:{default:"sei arrivato alla tua {nth} destinazione, sulla destra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla destra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla destra"},"sharp left":{default:"sei arrivato alla tua {nth} destinazione, sulla sinistra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla sinistra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla sinistra"},"sharp right":{default:"sei arrivato alla tua {nth} destinazione, sulla destra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla destra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla destra"},"slight right":{default:"sei arrivato alla tua {nth} destinazione, sulla destra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla destra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla destra"},"slight left":{default:"sei arrivato alla tua {nth} destinazione, sulla sinistra",upcoming:"sei arrivato alla tua {nth} destinazione, sulla sinistra",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, sulla sinistra"},straight:{default:"sei arrivato alla tua {nth} destinazione, si trova davanti a te",upcoming:"sei arrivato alla tua {nth} destinazione, si trova davanti a te",short:"Sei arrivato alla tua {nth} destinazione","short-upcoming":"Sei arrivato alla tua {nth} destinazione",named:"sei arrivato a {waypoint_name}, si trova davanti a te"}},continue:{default:{default:"Gira a {modifier}",name:"Gira a {modifier} per stare su {way_name}",destination:"Gira a {modifier} verso {destination}",exit:"Gira a {modifier} in {way_name}"},straight:{default:"Continua dritto",name:"Continua dritto per stare su {way_name}",destination:"Continua verso {destination}",distance:"Continua dritto per {distance}",namedistance:"Continua su {way_name} per {distance}"},"sharp left":{default:"Svolta a sinistra",name:"Fai una stretta curva a sinistra per stare su {way_name}",destination:"Svolta a sinistra verso {destination}"},"sharp right":{default:"Svolta a destra",name:"Fau una stretta curva a destra per stare su {way_name}",destination:"Svolta a destra verso {destination}"},"slight left":{default:"Fai una leggera curva a sinistra",name:"Fai una leggera curva a sinistra per stare su {way_name}",destination:"Fai una leggera curva a sinistra verso {destination}"},"slight right":{default:"Fai una leggera curva a destra",name:"Fai una leggera curva a destra per stare su {way_name}",destination:"Fai una leggera curva a destra verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione ad U poi continua su {way_name}",destination:"Fai un'inversione a U verso {destination}"}},depart:{default:{default:"Continua verso {direction}",name:"Continua verso {direction} in {way_name}",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"Gira a {modifier}",name:"Gira a {modifier} in {way_name}",destination:"Gira a {modifier} verso {destination}"},straight:{default:"Continua dritto",name:"Continua dritto in {way_name}",destination:"Continua dritto verso {destination}"},uturn:{default:"Fai un'inversione a U alla fine della strada",name:"Fai un'inversione a U in {way_name} alla fine della strada",destination:"Fai un'inversione a U verso {destination} alla fine della strada"}},fork:{default:{default:"Mantieni la {modifier} al bivio",name:"Mantieni la {modifier} al bivio in {way_name}",destination:"Mantieni la {modifier} al bivio verso {destination}"},"slight left":{default:"Mantieni la sinistra al bivio",name:"Mantieni la sinistra al bivio in {way_name}",destination:"Mantieni la sinistra al bivio verso {destination}"},"slight right":{default:"Mantieni la destra al bivio",name:"Mantieni la destra al bivio in {way_name}",destination:"Mantieni la destra al bivio verso {destination}"},"sharp left":{default:"Svolta a sinistra al bivio",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},"sharp right":{default:"Svolta a destra al bivio",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione a U in {way_name}",destination:"Fai un'inversione a U verso {destination}"}},merge:{default:{default:"Immettiti a {modifier}",name:"Immettiti {modifier} in {way_name}",destination:"Immettiti {modifier} verso {destination}"},straight:{default:"Immettiti a dritto",name:"Immettiti dritto in {way_name}",destination:"Immettiti dritto verso {destination}"},"slight left":{default:"Immettiti a sinistra",name:"Immettiti a sinistra in {way_name}",destination:"Immettiti a sinistra verso {destination}"},"slight right":{default:"Immettiti a destra",name:"Immettiti a destra in {way_name}",destination:"Immettiti a destra verso {destination}"},"sharp left":{default:"Immettiti a sinistra",name:"Immettiti a sinistra in {way_name}",destination:"Immettiti a sinistra verso {destination}"},"sharp right":{default:"Immettiti a destra",name:"Immettiti a destra in {way_name}",destination:"Immettiti a destra verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione a U in {way_name}",destination:"Fai un'inversione a U verso {destination}"}},"new name":{default:{default:"Continua a {modifier}",name:"Continua a {modifier} in {way_name}",destination:"Continua a {modifier} verso {destination}"},straight:{default:"Continua dritto",name:"Continua in {way_name}",destination:"Continua verso {destination}"},"sharp left":{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},"sharp right":{default:"Svolta a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},"slight left":{default:"Continua leggermente a sinistra",name:"Continua leggermente a sinistra in {way_name}",destination:"Continua leggermente a sinistra verso {destination}"},"slight right":{default:"Continua leggermente a destra",name:"Continua leggermente a destra in {way_name} ",destination:"Continua leggermente a destra verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione a U in {way_name}",destination:"Fai un'inversione a U verso {destination}"}},notification:{default:{default:"Continua a {modifier}",name:"Continua a {modifier} in {way_name}",destination:"Continua a {modifier} verso {destination}"},uturn:{default:"Fai un'inversione a U",name:"Fai un'inversione a U in {way_name}",destination:"Fai un'inversione a U verso {destination}"}},"off ramp":{default:{default:"Prendi la rampa",name:"Prendi la rampa in {way_name}",destination:"Prendi la rampa verso {destination}",exit:"Prendi l'uscita {exit}",exit_destination:"Prendi l'uscita  {exit} verso {destination}"},left:{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}",exit:"Prendi l'uscita {exit} a sinistra",exit_destination:"Prendi la {exit}  uscita a sinistra verso {destination}"},right:{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}",exit:"Prendi la {exit} uscita a destra",exit_destination:"Prendi la {exit} uscita a destra verso {destination}"},"sharp left":{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}",exit:"Prendi l'uscita {exit} a sinistra",exit_destination:"Prendi la {exit}  uscita a sinistra verso {destination}"},"sharp right":{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}",exit:"Prendi la {exit} uscita a destra",exit_destination:"Prendi la {exit} uscita a destra verso {destination}"},"slight left":{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}",exit:"Prendi l'uscita {exit} a sinistra",exit_destination:"Prendi la {exit}  uscita a sinistra verso {destination}"},"slight right":{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}",exit:"Prendi la {exit} uscita a destra",exit_destination:"Prendi la {exit} uscita a destra verso {destination}"}},"on ramp":{default:{default:"Prendi la rampa",name:"Prendi la rampa in {way_name}",destination:"Prendi la rampa verso {destination}"},left:{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}"},right:{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}"},"sharp left":{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}"},"sharp right":{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}"},"slight left":{default:"Prendi la rampa a sinistra",name:"Prendi la rampa a sinistra in {way_name}",destination:"Prendi la rampa a sinistra verso {destination}"},"slight right":{default:"Prendi la rampa a destra",name:"Prendi la rampa a destra in {way_name}",destination:"Prendi la rampa a destra verso {destination}"}},rotary:{default:{default:{default:"Immettiti nella rotonda",name:"Immettiti nella ritonda ed esci in {way_name}",destination:"Immettiti nella ritonda ed esci verso {destination}"},name:{default:"Immettiti in {rotary_name}",name:"Immettiti in {rotary_name} ed esci su {way_name}",destination:"Immettiti in {rotary_name} ed esci verso {destination}"},exit:{default:"Immettiti nella rotonda e prendi la {exit_number} uscita",name:"Immettiti nella rotonda e prendi la {exit_number} uscita in {way_name}",destination:"Immettiti nella rotonda e prendi la {exit_number} uscita verso   {destination}"},name_exit:{default:"Immettiti in {rotary_name} e prendi la {exit_number} uscita",name:"Immettiti in {rotary_name} e prendi la {exit_number} uscita in {way_name}",destination:"Immettiti in {rotary_name} e prendi la {exit_number}  uscita verso {destination}"}}},roundabout:{default:{exit:{default:"Immettiti nella rotonda e prendi la {exit_number} uscita",name:"Immettiti nella rotonda e prendi la {exit_number} uscita in {way_name}",destination:"Immettiti nella rotonda e prendi la {exit_number} uscita verso {destination}"},default:{default:"Entra nella rotonda",name:"Entra nella rotonda e prendi l'uscita in {way_name}",destination:"Entra nella rotonda e prendi l'uscita verso {destination}"}}},"roundabout turn":{default:{default:"Fai una {modifier}",name:"Fai una {modifier} in {way_name}",destination:"Fai una {modifier} verso {destination}"},left:{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},right:{default:"Gira a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},straight:{default:"Continua dritto",name:"Continua dritto in {way_name}",destination:"Continua dritto verso {destination}"}},"exit roundabout":{default:{default:"Fai una {modifier}",name:"Fai una {modifier} in {way_name}",destination:"Fai una {modifier} verso {destination}"},left:{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},right:{default:"Gira a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},straight:{default:"Continua dritto",name:"Continua dritto in {way_name}",destination:"Continua dritto verso {destination}"}},"exit rotary":{default:{default:"Fai una {modifier}",name:"Fai una {modifier} in {way_name}",destination:"Fai una {modifier} verso {destination}"},left:{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},right:{default:"Gira a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},straight:{default:"Prosegui dritto",name:"Continua su {way_name}",destination:"Continua verso {destination}"}},turn:{default:{default:"Fai una {modifier}",name:"Fai una {modifier} in {way_name}",destination:"Fai una {modifier} verso {destination}"},left:{default:"Svolta a sinistra",name:"Svolta a sinistra in {way_name}",destination:"Svolta a sinistra verso {destination}"},right:{default:"Gira a destra",name:"Svolta a destra in {way_name}",destination:"Svolta a destra verso {destination}"},straight:{default:"Prosegui dritto",name:"Continua su {way_name}",destination:"Continua verso {destination}"}},"use lane":{no_lanes:{default:"Continua dritto"},default:{default:"{lane_instruction}"}}}}},{}],34:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!1},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:"",east:"",southeast:"",south:"",southwest:"",west:"",northwest:""},modifier:{left:"",right:"","sharp left":"","sharp right":"","slight left":"","slight right":"",straight:"",uturn:""},lanes:{xo:" ",ox:" ",xox:"",oxo:"    "}},modes:{ferry:{default:" ",name:"  {way_name}",destination:"  {destination} ."}},phrase:{"two linked by distance":"{instruction_one}, , {distance} , {instruction_two}","two linked":"{instruction_one},  {instruction_two}","one in distance":"{distance} , {instruction_one}","name and ref":"{name} ({ref})","exit with number":"{exit} ."},arrive:{default:{default:" {nth} .",upcoming:"{nth}   .",short:"","short-upcoming":" .",named:" {waypoint_name} ."},left:{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},right:{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},"sharp left":{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},"sharp right":{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},"slight right":{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},"slight left":{default:" {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."},straight:{default:"  {nth}  .",upcoming:" {nth}   .",short:"","short-upcoming":"   .",named:"  {waypoint_name} ."}},continue:{default:{default:"{modifier} ",name:"{modifier}  {way_name}  .",destination:"{modifier}  {destination} .",exit:"{way_name}  {modifier}  ."},straight:{default:"  .",name:"{way_name}    .",destination:"{destination}  .",distance:"{distance}  .",namedistance:"{distance} {way_name} ."},"sharp left":{default:" .",name:"   {way_name} .",destination:"   {destination} ."},"sharp right":{default:" .",name:"  {way_name} .",destination:"   {destination} ."},"slight left":{default:" .",name:"   {way_name} .",destination:"    {destination} ."},"slight right":{default:" .",name:"   {way_name} .",destination:"    {destination} ."},uturn:{default:" ",name:" {way_name} .",destination:"  {destination} ."}},depart:{default:{default:"{direction} ",name:"{direction}   {way_name}  . ",namedistance:"{direction} {way_name}  {distance} ."}},"end of road":{default:{default:"{modifier} .",name:"{modifier} {way_name} .",destination:"{modifier}   {destination} ."},straight:{default:"  .",name:"{way_name}   .",destination:"{destination}  ."},uturn:{default:"    .",name:"    {way_name} .",destination:"    {destination}  ."}},fork:{default:{default:" {modifier}  .",name:"{modifier} {way_name} .",destination:"{modifier} {destination} ."},"slight left":{default:"  .",name:"  {way_name} .",destination:"  {destination} ."},"slight right":{default:"  .",name:"  {way_name} .",destination:"  {destination} ."},"sharp left":{default:"  .",name:"  {way_name} .",destination:"  {destination} ."},"sharp right":{default:"  .",name:"  {way_name} .",destination:"  {destination} ."},uturn:{default:".",name:" {way_name} .",destination:" {destination} ."}},merge:{default:{default:"{modifier} ",name:"{modifier}  {way_name} .",destination:"{modifier}  {destination} ."},straight:{default:"",name:"{way_name} .",destination:"{destination} ."},"slight left":{default:" .",name:"{way_name} .",destination:"  {destination} ."},"slight right":{default:" .",name:"{way_name} .",destination:"  {destination} ."},"sharp left":{default:" .",name:"{way_name} .",destination:"  {destination} ."},"sharp right":{default:" .",name:"{way_name} .",destination:"  {destination} ."},uturn:{default:".",name:" {way_name} .",destination:" {destination} ."}},"new name":{default:{default:"{modifier} .",name:"{modifier}  {way_name} .",destination:"{modifier}  {destination} ."},straight:{default:".",name:"{way_name}  .",destination:"{destination}  ."},"sharp left":{default:" .",name:"  {way_name} .",destination:"  {destination} ."},"sharp right":{default:" .",name:"  {way_name} .",destination:"  {destination} ."},"slight left":{default:"  .",name:"  {way_name} .",destination:"   {destination} ."},"slight right":{default:"  .",name:"  {way_name} .",destination:"   {destination} ."},uturn:{default:".",name:" {way_name} .",destination:" {destination} ."}},notification:{default:{default:"{modifier} .",name:"{modifier} {way_name} .",destination:"{modifier} {destination} ."},uturn:{default:".",name:" {way_name} .",destination:" {destination} ."}},"off ramp":{default:{default:"  ..",name:"  {way_name} .",destination:"  {destination} .",exit:"{exit}  .",exit_destination:"{exit}   {destination} ."},left:{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},right:{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},"sharp left":{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},"sharp right":{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},"slight left":{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."},"slight right":{default:"   .",name:"   {way_name} .",destination:"   {destination} .",exit:"{exit}   .",exit_destination:"{exit}    {destination} ."}},"on ramp":{default:{default:"  ..",name:"  {way_name} .",destination:"  {destination} ."},left:{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},right:{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},"sharp left":{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},"sharp right":{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},"slight left":{default:"   .",name:"   {way_name} .",destination:"   {destination} ."},"slight right":{default:"   .",name:"   {way_name} .",destination:"   {destination} ."}},rotary:{default:{default:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},name:{default:"{rotary_name} .",name:"{rotary_name}  {way_name} .",destination:"{rotary_name}  {destination} ."},exit:{default:"  {exit_number}  .",name:"  {exit_number}   {way_name} .",destination:"  {exit_number}   {destination} ."},name_exit:{default:"{rotary_name}  {exit_number}  .",name:"{rotary_name}  {exit_number}   {way_name} .",destination:"{rotary_name}  {exit_number}   {destination} ."}}},roundabout:{default:{exit:{default:"  {exit_number} .",name:"  {exit_number}  {way_name} .",destination:"  {exit_number}  {destination} ."},default:{default:" .",name:"  {way_name} .",destination:"  {destination} ."}}},"roundabout turn":{default:{default:"{modifier} .",name:"{modifier}  {way_name} .",destination:"{modifier}  {destination} ."},left:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},right:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},straight:{default:" .",name:" {way_name} .",destination:" {destination} ."}},"exit roundabout":{default:{default:" .",name:"  {way_name} .",destination:"  {destination} ."}},"exit rotary":{default:{default:" .",name:"  {way_name} .",destination:"  {destination} ."}},turn:{default:{default:"{modifier} .",name:"{modifier}  {way_name} .",destination:"{modifier}  {destination} ."},left:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},right:{default:" .",name:"  {way_name} .",destination:"  {destination} ."},straight:{default:" .",name:" {way_name} .",destination:" {destination} ."}},"use lane":{no_lanes:{default:"."},default:{default:"{lane_instruction}"}}}}},{}],35:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!1},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:"",east:"",southeast:"",south:"",southwest:"",west:"",northwest:""},modifier:{left:"",right:"","sharp left":" ","sharp right":" ","slight left":" ","slight right":" ",straight:"",uturn:"-"},lanes:{xo:"",ox:"",xox:"",oxo:"   "}},modes:{ferry:{default:" ",name:"{way_name} ",destination:"{destination} "}},phrase:{"two linked by distance":"{instruction_one} {distance} {instruction_two}","two linked":"{instruction_one} {instruction_two}","one in distance":"{distance} {instruction_one}","name and ref":"{name}( {ref})","exit with number":"{exit}"},arrive:{default:{default:"{nth}  ",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name}  "},left:{default:"  {nth}",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name} "},right:{default:"  {nth}  ",upcoming:" {nth}   ",short:"  ","short-upcoming":"  ",named:"  {waypoint_name}  "},"sharp left":{default:"  {nth}",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name} "},"sharp right":{default:"  {nth}  ",upcoming:" {nth}   ",short:"  ","short-upcoming":"  ",named:"  {waypoint_name}  "},"slight right":{default:"  {nth}  ",upcoming:" {nth}   ",short:"  ","short-upcoming":"  ",named:"  {waypoint_name}  "},"slight left":{default:"  {nth}",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name} "},straight:{default:"  {nth}",upcoming:"  {nth}",short:"  ","short-upcoming":"  ",named:"  {waypoint_name} "}},continue:{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} ",exit:"{way_name} {modifier}"},straight:{default:" ",name:"{way_name}",destination:"{destination}",distance:"{distance}  ",namedistance:"{way_name}{distance}"},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} "},"sharp right":{default:" ",name:"{way_name} ",destination:"{destination} "},"slight left":{default:" ",name:"{way_name} ",destination:"{destination} "},"slight right":{default:" ",name:"{way_name} ",destination:"{destination} "},uturn:{default:"- ",name:"{way_name} -",destination:"{destination} "}},depart:{default:{default:"{direction} ",name:"{direction} {way_name} ",namedistance:"{direction} {way_name}{distance} "}},"end of road":{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},straight:{default:" ",name:"{way_name}",destination:"{destination}"},uturn:{default:" -",name:" {way_name}-",destination:"{destination} "}},fork:{default:{default:" {modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},"slight left":{default:"",name:"{way_name}",destination:"{destination} "},"slight right":{default:"",name:"{way_name}",destination:"{destination} "},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} "},"sharp right":{default:"",name:"{way_name} ",destination:"{destination} "},uturn:{default:"- ",name:"{way_name}-",destination:"{destination} "}},merge:{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},straight:{default:"",name:"{way_name}",destination:"{destination} "},"slight left":{default:"",name:"{way_name}",destination:"{destination} "},"slight right":{default:"",name:"{way_name}",destination:"{destination} "},"sharp left":{default:"",name:"{way_name}",destination:"{destination} "},"sharp right":{default:"",name:"{way_name}",destination:"{destination} "},uturn:{default:"- ",name:"{way_name} -  ",destination:"{destination} "}},"new name":{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},straight:{default:" ",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} "},"sharp right":{default:" ",name:"{way_name} ",destination:"{destination} "},"slight left":{default:" ",name:"{way_name} ",destination:"{destination}"},"slight right":{default:" ",name:"{way_name} ",destination:"{destination}"},uturn:{default:"- ",name:"{way_name} - ",destination:"{destination} "}},notification:{default:{default:"{modifier}",name:"{way_name} {modifier}",destination:"{destination} {modifier} "},uturn:{default:"- ",name:"{way_name} - ",destination:"{destination} "}},"off ramp":{default:{default:"",name:"{way_name}",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},left:{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},right:{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},"sharp right":{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},"slight left":{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "},"slight right":{default:"",name:"{way_name} ",destination:"{destination} ",exit:"{exit} ",exit_destination:"{destination} {exit} "}},"on ramp":{default:{default:"",name:"{way_name}",destination:"{destination} "},left:{default:"",name:"{way_name} ",destination:"{destination} "},right:{default:"",name:"{way_name} ",destination:"{destination} "},"sharp left":{default:"",name:"{way_name} ",destination:"{destination} "},"sharp right":{default:"",name:"{way_name} ",destination:"{destination} "},"slight left":{default:"",name:"{way_name} ",destination:"{destination} "},"slight right":{default:"",name:"{way_name} ",destination:"{destination} "}},rotary:{default:{default:{default:"",name:"{way_name}",destination:"{destination}"},name:{default:"{rotary_name}",name:"{rotary_name}{way_name}",destination:"{rotary_name}{destination}"},exit:{default:"{exit_number}",name:"{exit_number}{way_name}",destination:"{exit_number}{destination}"},name_exit:{default:"{rotary_name} {exit_number}",name:"{rotary_name}{exit_number}{way_name}",destination:"{rotary_name}{exit_number}{destination}"}}},roundabout:{default:{exit:{default:"{exit_number}",name:"{exit_number}{way_name}",destination:"{exit_number}{destination}"},default:{default:"",name:"{way_name}",destination:"{destination}"}}},"roundabout turn":{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination} "},left:{default:"",name:"{way_name}",destination:"{destination} "},right:{default:"",name:"{way_name}",destination:"{destination} "},straight:{default:" ",name:"{way_name}",destination:"{destination}"}},"exit roundabout":{default:{default:"",name:"{way_name}",destination:"{destination}"}},"exit rotary":{default:{default:"",name:"{way_name}",destination:"{destination}"}},turn:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination} "},left:{default:"",name:"{way_name}",destination:"{destination} "},right:{default:"",name:"{way_name}",destination:"{destination} "},straight:{default:"",name:"{way_name}",destination:"{destination}"}},"use lane":{no_lanes:{default:" "},default:{default:"{lane_instruction}"}}}}},{}],36:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1e",2:"2e",3:"3e",4:"4e",5:"5e",6:"6e",7:"7e",8:"8e",9:"9e",10:"10e"},direction:{north:"noord",northeast:"noordoost",east:"oost",southeast:"zuidoost",south:"zuid",southwest:"zuidwest",west:"west",northwest:"noordwest"},modifier:{left:"links",right:"rechts","sharp left":"scherpe bocht naar links","sharp right":"scherpe bocht naar rechts","slight left":"iets naar links","slight right":"iets naar rechts",straight:"rechtdoor",uturn:"omkeren"},lanes:{xo:"Rechts aanhouden",ox:"Links aanhouden",xox:"In het midden blijven",oxo:"Links of rechts blijven"}},modes:{ferry:{default:"Neem de veerpont",name:"Neem de veerpont {way_name}",destination:"Neem de veerpont richting {destination}"}},phrase:{"two linked by distance":"{instruction_one}, dan na {distance}, {instruction_two}","two linked":"{instruction_one}, daarna {instruction_two}","one in distance":"Over {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"afslag {exit}"},arrive:{default:{default:"Je bent gearriveerd op de {nth} bestemming.",upcoming:"U arriveert op de {nth} bestemming",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}"},left:{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich links.",upcoming:"Uw {nth} bestemming bevindt zich aan de linkerkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}, de bestemming is aan de linkerkant"},right:{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich rechts.",upcoming:"Uw {nth} bestemming bevindt zich aan de rechterkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}, de bestemming is aan de  rechterkant"},"sharp left":{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich links.",upcoming:"Uw {nth} bestemming bevindt zich aan de linkerkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}, de bestemming is aan de linkerkant"},"sharp right":{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich rechts.",upcoming:"Uw {nth} bestemming bevindt zich aan de rechterkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name},  de bestemming is aan de rechterkant"},"slight right":{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich rechts.",upcoming:"Uw {nth} bestemming bevindt zich aan de rechterkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name},  de bestemming is aan de rechterkant"},"slight left":{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich links.",upcoming:"Uw {nth} bestemming bevindt zich aan de linkerkant",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name},  de bestemming is aan de linkerkant"},straight:{default:"Je bent gearriveerd. De {nth} bestemming bevindt zich voor je.",upcoming:"Uw {nth} bestemming is recht voor u",short:"U bent gearriveerd","short-upcoming":"U zult aankomen",named:"U bent gearriveerd bij {waypoint_name}, de bestemming is recht voor u"}},continue:{default:{default:"Ga {modifier}",name:"Sla {modifier} om op {way_name} te blijven",destination:"Ga {modifier} richting {destination}",exit:"Ga {modifier} naar {way_name}"},straight:{default:"Ga rechtdoor",name:"Blijf rechtdoor gaan op {way_name}",destination:"Ga rechtdoor richting {destination}",distance:"Ga rechtdoor voor {distance}",namedistance:"Ga verder op {way_name} voor {distance}"},"sharp left":{default:"Linksaf",name:"Sla scherp links af om op {way_name} te blijven",destination:"Linksaf richting {destination}"},"sharp right":{default:"Rechtsaf",name:"Sla scherp rechts af om op {way_name} te blijven",destination:"Rechtsaf richting {destination}"},"slight left":{default:"Ga links",name:"Links afbuigen om op {way_name} te blijven",destination:"Rechts afbuigen om op {destination} te blijven"},"slight right":{default:"Rechts afbuigen",name:"Rechts afbuigen om op {way_name} te blijven",destination:"Rechts afbuigen richting {destination}"},uturn:{default:"Keer om",name:"Draai om en ga verder op {way_name}",destination:"Keer om richting {destination}"}},depart:{default:{default:"Vertrek in {direction}elijke richting",name:"Neem {way_name} in {direction}elijke richting",namedistance:"Ga richting {direction} op {way_name} voor {distance}"}},"end of road":{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},straight:{default:"Ga in de aangegeven richting",name:"Ga naar {way_name}",destination:"Ga richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},fork:{default:{default:"Ga {modifier} op de splitsing",name:"Houd {modifier} aan, tot {way_name}",destination:"Houd {modifier}, in de richting van {destination}"},"slight left":{default:"Links aanhouden op de splitsing",name:"Houd links aan, tot {way_name}",destination:"Houd links aan, richting {destination}"},"slight right":{default:"Rechts aanhouden op de splitsing",name:"Houd rechts aan, tot {way_name}",destination:"Houd rechts aan, richting {destination}"},"sharp left":{default:"Neem bij de splitsing, een scherpe bocht, naar links ",name:"Neem een scherpe bocht naar links, tot aan {way_name}",destination:"Neem een scherpe bocht naar links, richting {destination}"},"sharp right":{default:"Neem  op de splitsing, een scherpe bocht, naar rechts",name:"Neem een scherpe bocht naar rechts, tot aan {way_name}",destination:"Neem een scherpe bocht naar rechts, richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},merge:{default:{default:"Bij de splitsing {modifier}",name:"Bij de splitsing {modifier} naar {way_name}",destination:"Bij de splitsing {modifier} richting {destination}"},straight:{default:"Samenvoegen",name:"Ga verder op {way_name}",destination:"Ga verder richting {destination}"},"slight left":{default:"Bij de splitsing links aanhouden",name:"Bij de splitsing links aanhouden naar {way_name}",destination:"Bij de splitsing links aanhouden richting {destination}"},"slight right":{default:"Bij de splitsing rechts aanhouden",name:"Bij de splitsing rechts aanhouden naar {way_name}",destination:"Bij de splitsing rechts aanhouden richting {destination}"},"sharp left":{default:"Bij de splitsing linksaf",name:"Bij de splitsing linksaf naar {way_name}",destination:"Bij de splitsing linksaf richting {destination}"},"sharp right":{default:"Bij de splitsing rechtsaf",name:"Bij de splitsing rechtsaf naar {way_name}",destination:"Bij de splitsing rechtsaf richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},"new name":{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},straight:{default:"Ga in de aangegeven richting",name:"Ga rechtdoor naar {way_name}",destination:"Ga rechtdoor richting {destination}"},"sharp left":{default:"Neem een scherpe bocht, naar links",name:"Linksaf naar {way_name}",destination:"Linksaf richting {destination}"},"sharp right":{default:"Neem een scherpe bocht, naar rechts",name:"Rechtsaf naar {way_name}",destination:"Rechtsaf richting {destination}"},"slight left":{default:"Links aanhouden",name:"Links aanhouden naar {way_name}",destination:"Links aanhouden richting {destination}"},"slight right":{default:"Rechts aanhouden",name:"Rechts aanhouden naar {way_name}",destination:"Rechts aanhouden richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},notification:{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},uturn:{default:"Keer om",name:"Keer om naar {way_name}",destination:"Keer om richting {destination}"}},"off ramp":{default:{default:"Neem de afrit",name:"Neem de afrit naar {way_name}",destination:"Neem de afrit richting {destination}",exit:"Neem afslag {exit}",exit_destination:"Neem afslag {exit} richting {destination}"},left:{default:"Neem de afrit links",name:"Neem de afrit links naar {way_name}",destination:"Neem de afrit links richting {destination}",exit:"Neem afslag {exit} aan de linkerkant",exit_destination:"Neem afslag {exit} aan de linkerkant richting {destination}"},right:{default:"Neem de afrit rechts",name:"Neem de afrit rechts naar {way_name}",destination:"Neem de afrit rechts richting {destination}",exit:"Neem afslag {exit} aan de rechterkant",exit_destination:"Neem afslag {exit} aan de rechterkant richting {destination}"},"sharp left":{default:"Neem de afrit links",name:"Neem de afrit links naar {way_name}",destination:"Neem de afrit links richting {destination}",exit:"Neem afslag {exit} aan de linkerkant",exit_destination:"Neem afslag {exit} aan de linkerkant richting {destination}"},"sharp right":{default:"Neem de afrit rechts",name:"Neem de afrit rechts naar {way_name}",destination:"Neem de afrit rechts richting {destination}",exit:"Neem afslag {exit} aan de rechterkant",exit_destination:"Neem afslag {exit} aan de rechterkant richting {destination}"},"slight left":{default:"Neem de afrit links",name:"Neem de afrit links naar {way_name}",destination:"Neem de afrit links richting {destination}",exit:"Neem afslag {exit} aan de linkerkant",exit_destination:"Neem afslag {exit} aan de linkerkant richting {destination}"},"slight right":{default:"Neem de afrit rechts",name:"Neem de afrit rechts naar {way_name}",destination:"Neem de afrit rechts richting {destination}",exit:"Neem afslag {exit} aan de rechterkant",exit_destination:"Neem afslag {exit} aan de rechterkant richting {destination}"}},"on ramp":{default:{default:"Neem de oprit",name:"Neem de oprit naar {way_name}",destination:"Neem de oprit richting {destination}"},left:{default:"Neem de oprit links",name:"Neem de oprit links naar {way_name}",destination:"Neem de oprit links richting {destination}"},right:{default:"Neem de oprit rechts",name:"Neem de oprit rechts naar {way_name}",destination:"Neem de oprit rechts richting {destination}"},"sharp left":{default:"Neem de oprit links",name:"Neem de oprit links naar {way_name}",destination:"Neem de oprit links richting {destination}"},"sharp right":{default:"Neem de oprit rechts",name:"Neem de oprit rechts naar {way_name}",destination:"Neem de oprit rechts richting {destination}"},"slight left":{default:"Neem de oprit links",name:"Neem de oprit links naar {way_name}",destination:"Neem de oprit links richting {destination}"},"slight right":{default:"Neem de oprit rechts",name:"Neem de oprit rechts naar {way_name}",destination:"Neem de oprit rechts richting {destination}"}},rotary:{default:{default:{default:"Betreedt de rotonde",name:"Betreedt rotonde en sla af op {way_name}",destination:"Betreedt rotonde en sla af richting {destination}"},name:{default:"Ga het knooppunt {rotary_name} op",name:"Verlaat het knooppunt {rotary_name} naar {way_name}",destination:"Verlaat het knooppunt {rotary_name} richting {destination}"},exit:{default:"Betreedt rotonde en neem afslag {exit_number}",name:"Betreedt rotonde en neem afslag {exit_number} naar {way_name}",destination:"Betreedt rotonde en neem afslag {exit_number} richting {destination}"},name_exit:{default:"Ga het knooppunt {rotary_name} op en neem afslag {exit_number}",name:"Ga het knooppunt {rotary_name} op en neem afslag {exit_number} naar {way_name}",destination:"Ga het knooppunt {rotary_name} op en neem afslag {exit_number} richting {destination}"}}},roundabout:{default:{exit:{default:"Betreedt rotonde en neem afslag {exit_number}",name:"Betreedt rotonde en neem afslag {exit_number} naar {way_name}",destination:"Betreedt rotonde en neem afslag {exit_number} richting {destination}"},default:{default:"Betreedt de rotonde",name:"Betreedt rotonde en sla af op {way_name}",destination:"Betreedt rotonde en sla af richting {destination}"}}},"roundabout turn":{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},left:{default:"Ga linksaf",name:"Ga linksaf naar {way_name}",destination:"Ga linksaf richting {destination}"},right:{default:"Ga rechtsaf",name:"Ga rechtsaf naar {way_name}",destination:"Ga rechtsaf richting {destination}"},straight:{default:"Ga in de aangegeven richting",name:"Ga naar {way_name}",destination:"Ga richting {destination}"}},"exit roundabout":{default:{default:"Verlaat de rotonde",name:"Verlaat de rotonde en ga verder op {way_name}",destination:"Verlaat de rotonde richting {destination}"}},"exit rotary":{default:{default:"Verlaat de rotonde",name:"Verlaat de rotonde en ga verder op {way_name}",destination:"Verlaat de rotonde richting {destination}"}},turn:{default:{default:"Ga {modifier}",name:"Ga {modifier} naar {way_name}",destination:"Ga {modifier} richting {destination}"},left:{default:"Ga linksaf",name:"Ga linksaf naar {way_name}",destination:"Ga linksaf richting {destination}"},right:{default:"Ga rechtsaf",name:"Ga rechtsaf naar {way_name}",destination:"Ga rechtsaf richting {destination}"},straight:{default:"Ga rechtdoor",name:"Ga rechtdoor naar {way_name}",destination:"Ga rechtdoor richting {destination}"}},"use lane":{no_lanes:{default:"Rechtdoor"},default:{default:"{lane_instruction}"}}}}},{}],37:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1.",2:"2.",3:"3.",4:"4.",5:"5.",6:"6.",7:"7.",8:"8.",9:"9.",10:"10."},direction:{north:"nord",northeast:"nordst",east:"st",southeast:"srst",south:"sr",southwest:"srvest",west:"vest",northwest:"nordvest"},modifier:{left:"venstre",right:"hyre","sharp left":"skarp venstre","sharp right":"skarp hyre","slight left":"litt til venstre","slight right":"litt til hyre",straight:"rett frem",uturn:"U-sving"},lanes:{xo:"Hold til hyre",ox:"Hold til venstre",xox:"Hold deg i midten",oxo:"Hold til venstre eller hyre"}},modes:{ferry:{default:"Ta ferja",name:"Ta ferja {way_name}",destination:"Ta ferja til {destination}"}},phrase:{"two linked by distance":"{instruction_one}, deretter {instruction_two} om {distance}","two linked":"{instruction_one}, deretter {instruction_two}","one in distance":"Om {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"avkjrsel {exit}"},arrive:{default:{default:"Du har ankommet din {nth} destinasjon",upcoming:"Du vil ankomme din {nth} destinasjon",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}"},left:{default:"Du har ankommet din {nth} destinasjon, p din venstre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din venstre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din venstre side"},right:{default:"Du har ankommet din {nth} destinasjon, p din hyre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din hyre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din hyre side"},"sharp left":{default:"Du har ankommet din {nth} destinasjon, p din venstre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din venstre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din venstre side"},"sharp right":{default:"Du har ankommet din {nth} destinasjon, p din hyre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din hyre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din hyre side"},"slight right":{default:"Du har ankommet din {nth} destinasjon, p din hyre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din hyre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din hyre side"},"slight left":{default:"Du har ankommet din {nth} destinasjon, p din venstre side",upcoming:"Du vil ankomme din {nth} destinasjon, p din venstre side",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, p din venstre side"},straight:{default:"Du har ankommet din {nth} destinasjon, rett forut",upcoming:"Du vil ankomme din {nth} destinasjon, rett forut",short:"Du har ankommet","short-upcoming":"Du vil ankomme",named:"Du har ankommet {waypoint_name}, rett forut"}},continue:{default:{default:"Ta til {modifier}",name:"Ta til {modifier} for  bli vrende p {way_name}",destination:"Ta til {modifier} mot {destination}",exit:"Ta til {modifier} inn p {way_name}"},straight:{default:"Fortsett rett frem",name:"Fortsett rett frem for  bli vrende p {way_name}",destination:"Fortsett mot {destination}",distance:"Fortsett rett frem, {distance} ",namedistance:"Fortsett p {way_name}, {distance}"},"sharp left":{default:"Sving skarpt til venstre",name:"Sving skarpt til venstre for  bli vrende p {way_name}",destination:"Sving skarpt til venstre mot {destination}"},"sharp right":{default:"Sving skarpt til hyre",name:"Sving skarpt til hyre for  bli vrende p {way_name}",destination:"Sving skarpt mot {destination}"},"slight left":{default:"Sving svakt til venstre",name:"Sving svakt til venstre for  bli vrende p {way_name}",destination:"Sving svakt til venstre mot {destination}"},"slight right":{default:"Sving svakt til hyre",name:"Sving svakt til hyre for  bli vrende p {way_name}",destination:"Sving svakt til hyre mot {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving og fortsett p {way_name}",destination:"Ta en U-sving mot {destination}"}},depart:{default:{default:"Kjr i retning {direction}",name:"Kjr i retning {direction} p {way_name}",namedistance:"Kjr i retning {direction} p {way_name}, {distance}"}},"end of road":{default:{default:"Sving {modifier}",name:"Ta til {modifier} inn p {way_name}",destination:"Sving {modifier} mot {destination}"},straight:{default:"Fortsett rett frem",name:"Fortsett rett frem til  {way_name}",destination:"Fortsett rett frem mot {destination}"},uturn:{default:"Ta en U-sving i enden av veien",name:"Ta en U-sving til {way_name} i enden av veien",destination:"Ta en U-sving mot {destination} i enden av veien"}},fork:{default:{default:"Hold til {modifier} i veikrysset",name:"Hold til {modifier} inn p {way_name}",destination:"Hold til {modifier} mot {destination}"},"slight left":{default:"Hold til venstre i veikrysset",name:"Hold til venstre inn p {way_name}",destination:"Hold til venstre mot {destination}"},"slight right":{default:"Hold til hyre i veikrysset",name:"Hold til hyre inn p {way_name}",destination:"Hold til hyre mot {destination}"},"sharp left":{default:"Sving skarpt til venstre i veikrysset",name:"Sving skarpt til venstre inn p {way_name}",destination:"Sving skarpt til venstre mot {destination}"},"sharp right":{default:"Sving skarpt til hyre i veikrysset",name:"Sving skarpt til hyre inn p {way_name}",destination:"Svings skarpt til hyre mot {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving til {way_name}",destination:"Ta en U-sving mot {destination}"}},merge:{default:{default:"Hold {modifier} kjrefelt",name:"Hold {modifier} kjrefelt inn p {way_name}",destination:"Hold {modifier} kjrefelt mot {destination}"},straight:{default:"Hold kjrefelt",name:"Hold kjrefelt inn p {way_name}",destination:"Hold kjrefelt mot {destination}"},"slight left":{default:"Hold venstre kjrefelt",name:"Hold venstre kjrefelt inn p {way_name}",destination:"Hold venstre kjrefelt mot {destination}"},"slight right":{default:"Hold hyre kjrefelt",name:"Hold hyre kjrefelt inn p {way_name}",destination:"Hold hyre kjrefelt mot {destination}"},"sharp left":{default:"Hold venstre kjrefelt",name:"Hold venstre kjrefelt inn p {way_name}",destination:"Hold venstre kjrefelt mot {destination}"},"sharp right":{default:"Hold hyre kjrefelt",name:"Hold hyre kjrefelt inn p {way_name}",destination:"Hold hyre kjrefelt mot {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving til {way_name}",destination:"Ta en U-sving mot {destination}"}},"new name":{default:{default:"Fortsett {modifier}",name:"Fortsett {modifier} til {way_name}",destination:"Fortsett {modifier} mot  {destination}"},straight:{default:"Fortsett rett frem",name:"Fortsett inn p {way_name}",destination:"Fortsett mot {destination}"},"sharp left":{default:"Sving skarpt til venstre",name:"Sving skarpt til venstre inn p {way_name}",destination:"Sving skarpt til venstre mot {destination}"},"sharp right":{default:"Sving skarpt til hyre",name:"Sving skarpt til hyre inn p {way_name}",destination:"Svings skarpt til hyre mot {destination}"},"slight left":{default:"Fortsett litt mot venstre",name:"Fortsett litt mot venstre til {way_name}",destination:"Fortsett litt mot venstre mot {destination}"},"slight right":{default:"Fortsett litt mot hyre",name:"Fortsett litt mot hyre til {way_name}",destination:"Fortsett litt mot hyre mot {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving til {way_name}",destination:"Ta en U-sving mot {destination}"}},notification:{default:{default:"Fortsett {modifier}",name:"Fortsett {modifier} til {way_name}",destination:"Fortsett {modifier} mot  {destination}"},uturn:{default:"Ta en U-sving",name:"Ta en U-sving til {way_name}",destination:"Ta en U-sving mot {destination}"}},"off ramp":{default:{default:"Ta avkjrselen",name:"Ta avkjrselen inn p {way_name}",destination:"Ta avkjrselen mot {destination}",exit:"Ta avkjrsel {exit}",exit_destination:"Ta avkjrsel {exit} mot {destination}"},left:{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}",exit:"Ta avkjrsel {exit} p venstre side",exit_destination:"Ta avkjrsel {exit} p venstre side mot {destination}"},right:{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}",exit:"Ta avkjrsel {exit} p hyre side",exit_destination:"Ta avkjrsel {exit} p hyre side mot {destination}"},"sharp left":{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}",exit:"Ta avkjrsel {exit} p venstre side",exit_destination:"Ta avkjrsel {exit} p venstre side mot {destination}"},"sharp right":{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}",exit:"Ta avkjrsel {exit} p hyre side",exit_destination:"Ta avkjrsel {exit} p hyre side mot {destination}"},"slight left":{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}",exit:"Ta avkjrsel {exit} p venstre side",exit_destination:"Ta avkjrsel {exit} p venstre side mot {destination}"},"slight right":{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}",exit:"Ta avkjrsel {exit} p hyre side",exit_destination:"Ta avkjrsel {exit} p hyre side mot {destination}"}},"on ramp":{default:{default:"Ta avkjrselen",name:"Ta avkjrselen inn p {way_name}",destination:"Ta avkjrselen mot {destination}"},left:{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}"},right:{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}"},"sharp left":{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}"},"sharp right":{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}"},"slight left":{default:"Ta avkjrselen p venstre side",name:"Ta avkjrselen p venstre side inn p {way_name}",destination:"Ta avkjrselen p venstre side mot {destination}"},"slight right":{default:"Ta avkjrselen p hyre side",name:"Ta avkjrselen p hyre side inn p {way_name}",destination:"Ta avkjrselen p hyre side mot {destination}"}},rotary:{default:{default:{default:"Kjr inn i rundkjringen",name:"Kjr inn i rundkjringen og deretter ut p {way_name}",destination:"Kjr inn i rundkjringen og deretter ut mot {destination}"},name:{default:"Kjr inn i {rotary_name}",name:"Kjr inn i {rotary_name} og deretter ut p {way_name}",destination:"Kjr inn i {rotary_name} og deretter ut mot {destination}"},exit:{default:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel",name:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel ut p {way_name}",destination:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel ut mot {destination} "},name_exit:{default:"Kjr inn i {rotary_name} og ta {exit_number} avkjrsel",name:"Kjr inn i {rotary_name} og ta {exit_number} avkjrsel inn p {way_name}",destination:"Kjr inn i {rotary_name} og ta {exit_number} avkjrsel mot {destination}"}}},roundabout:{default:{exit:{default:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel",name:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel inn p {way_name}",destination:"Kjr inn i rundkjringen og ta {exit_number} avkjrsel ut mot {destination} "},default:{default:"Kjr inn i rundkjringen",name:"Kjr inn i rundkjringen og deretter ut p {way_name}",destination:"Kjr inn i rundkjringen og deretter ut mot {destination}"}}},"roundabout turn":{default:{default:"Ta en {modifier}",name:"Ta en {modifier} inn p {way_name}",destination:"Ta en {modifier} mot {destination}"},left:{default:"Sving til venstre",name:"Sving til venstre inn p {way_name}",destination:"Sving til venstre mot {destination}"},right:{default:"Sving til hyre",name:"Sving til hyre inn p {way_name}",destination:"Sving til hyre mot {destination}"},straight:{default:"Fortsett rett frem",name:"Fortsett rett frem til  {way_name}",destination:"Fortsett rett frem mot {destination}"}},"exit roundabout":{default:{default:"Kjr ut av rundkjringen",name:"Kjr ut av rundkjringen og inn p {way_name}",destination:"Kjr ut av rundkjringen mot {destination}"}},"exit rotary":{default:{default:"Kjr ut av rundkjringen",name:"Kjr ut av rundkjringen og inn p {way_name}",destination:"Kjr ut av rundkjringen mot {destination}"}},turn:{default:{default:"Ta en {modifier}",name:"Ta en {modifier} inn p {way_name}",destination:"Ta en {modifier} mot {destination}"},left:{default:"Sving til venstre",name:"Sving til venstre inn p {way_name}",destination:"Sving til venstre mot {destination}"},right:{default:"Sving til hyre",name:"Sving til hyre inn p {way_name}",destination:"Sving til hyre mot {destination}"},straight:{default:"Kjr rett frem",name:"Kjr rett frem og inn p {way_name}",destination:"Kjr rett frem mot {destination}"}},"use lane":{no_lanes:{default:"Fortsett rett frem"},default:{default:"{lane_instruction}"}}}}},{}],38:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1.",2:"2.",3:"3.",4:"4.",5:"5.",6:"6.",7:"7.",8:"8.",9:"9.",10:"10."},direction:{north:"pnoc",northeast:"pnocny wschd",east:"wschd",southeast:"poudniowy wschd",south:"poudnie",southwest:"poudniowy zachd",west:"zachd",northwest:"pnocny zachd"},modifier:{left:"lewo",right:"prawo","sharp left":"ostro w lewo","sharp right":"ostro w prawo","slight left":"agodnie w lewo","slight right":"agodnie w prawo",straight:"prosto",uturn:"zawr"},lanes:{xo:"Trzymaj si prawej strony",ox:"Trzymaj si lewej strony",xox:"Trzymaj si rodka",oxo:"Trzymaj si lewej lub prawej strony"}},modes:{ferry:{default:"We prom",name:"We prom {way_name}",destination:"We prom w kierunku {destination}"}},phrase:{"two linked by distance":"{instruction_one}, nastpnie za {distance} {instruction_two}","two linked":"{instruction_one}, nastpnie {instruction_two}","one in distance":"Za {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Dojechano do miejsca docelowego {nth}",upcoming:"Dojechano do miejsca docelowego {nth}",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}"},left:{default:"Dojechano do miejsca docelowego {nth}, po lewej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po lewej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po lewej stronie"},right:{default:"Dojechano do miejsca docelowego {nth}, po prawej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po prawej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po prawej stronie"},"sharp left":{default:"Dojechano do miejsca docelowego {nth}, po lewej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po lewej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po lewej stronie"},"sharp right":{default:"Dojechano do miejsca docelowego {nth}, po prawej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po prawej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po prawej stronie"},"slight right":{default:"Dojechano do miejsca docelowego {nth}, po prawej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po prawej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po prawej stronie"},"slight left":{default:"Dojechano do miejsca docelowego {nth}, po lewej stronie",upcoming:"Dojechano do miejsca docelowego {nth}, po lewej stronie",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, po lewej stronie"},straight:{default:"Dojechano do miejsca docelowego {nth} , prosto",upcoming:"Dojechano do miejsca docelowego {nth} , prosto",short:"Dojechano do miejsca docelowego {nth}","short-upcoming":"Dojechano do miejsca docelowego {nth}",named:"Dojechano do {waypoint_name}, prosto"}},continue:{default:{default:"Skr {modifier}",name:"Skr w {modifier}, aby pozosta na {way_name}",destination:"Skr {modifier} w kierunku {destination}",exit:"Skr {modifier} na {way_name}"},straight:{default:"Kontynuuj prosto",name:"Jed dalej prosto, aby pozosta na {way_name}",destination:"Kontynuuj w kierunku {destination}",distance:"Jed dalej prosto przez {distance}",namedistance:"Jed dalej {way_name} przez {distance}"},"sharp left":{default:"Skr ostro w lewo",name:"Skr w lewo w ostry zakrt, aby pozosta na {way_name}",destination:"Skr ostro w lewo w kierunku {destination}"},"sharp right":{default:"Skr ostro w prawo",name:"Skr w prawo w ostry zakrt, aby pozosta na {way_name}",destination:"Skr ostro w prawo w kierunku {destination}"},"slight left":{default:"Skr w lewo w agodny zakrt",name:"Skr w lewo w agodny zakrt, aby pozosta na {way_name}",destination:"Skr w lewo w agodny zakrt na {destination}"},"slight right":{default:"Skr w prawo w agodny zakrt",name:"Skr w prawo w agodny zakrt, aby pozosta na {way_name}",destination:"Skr w prawo w agodny zakrt na {destination}"},uturn:{default:"Zawr",name:"Zawr i jed dalej {way_name}",destination:"Zawr w kierunku {destination}"}},depart:{default:{default:"Kieruj si {direction}",name:"Kieruj si {direction} na {way_name}",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"Skr {modifier}",name:"Skr {modifier} na {way_name}",destination:"Skr {modifier} w kierunku {destination}"},straight:{default:"Kontynuuj prosto",name:"Kontynuuj prosto na {way_name}",destination:"Kontynuuj prosto w kierunku {destination}"},uturn:{default:"Zawr na kocu ulicy",name:"Zawr na kocu ulicy na {way_name}",destination:"Zawr na kocu ulicy w kierunku {destination}"}},fork:{default:{default:"Na rozwidleniu trzymaj si {modifier}",name:"Na rozwidleniu trzymaj si {modifier} na {way_name}",destination:"Na rozwidleniu trzymaj si {modifier} w kierunku {destination}"},"slight left":{default:"Na rozwidleniu trzymaj si lewej strony",name:"Na rozwidleniu trzymaj si lewej strony w {way_name}",destination:"Na rozwidleniu trzymaj si lewej strony w kierunku {destination}"},"slight right":{default:"Na rozwidleniu trzymaj si prawej strony",name:"Na rozwidleniu trzymaj si prawej strony na {way_name}",destination:"Na rozwidleniu trzymaj si prawej strony w kierunku {destination}"},"sharp left":{default:"Na rozwidleniu skr ostro w lewo",name:"Skr ostro w lewo w {way_name}",destination:"Skr ostro w lewo w kierunku {destination}"},"sharp right":{default:"Na rozwidleniu skr ostro w prawo",name:"Skr ostro w prawo na {way_name}",destination:"Skr ostro w prawo w kierunku {destination}"},uturn:{default:"Zawr",name:"Zawr na {way_name}",destination:"Zawr w kierunku {destination}"}},merge:{default:{default:"Wcz si {modifier}",name:"Wcz si {modifier} na {way_name}",destination:"Wcz si {modifier} w kierunku {destination}"},straight:{default:"Wcz si prosto",name:"Wcz si prosto na {way_name}",destination:"Wcz si prosto w kierunku {destination}"},"slight left":{default:"Wcz si z lewej strony",name:"Wcz si z lewej strony na {way_name}",destination:"Wcz si z lewej strony w kierunku {destination}"},"slight right":{default:"Wcz si z prawej strony",name:"Wcz si z prawej strony na {way_name}",destination:"Wcz si z prawej strony w kierunku {destination}"},"sharp left":{default:"Wcz si z lewej strony",name:"Wcz si z lewej strony na {way_name}",destination:"Wcz si z lewej strony w kierunku {destination}"},"sharp right":{default:"Wcz si z prawej strony",name:"Wcz si z prawej strony na {way_name}",destination:"Wcz si z prawej strony w kierunku {destination}"},uturn:{default:"Zawr",name:"Zawr na {way_name}",destination:"Zawr w kierunku {destination}"}},"new name":{default:{default:"Kontynuuj {modifier}",name:"Kontynuuj {modifier} na {way_name}",destination:"Kontynuuj {modifier} w kierunku {destination}"},straight:{default:"Kontynuuj prosto",name:"Kontynuuj na {way_name}",destination:"Kontynuuj w kierunku {destination}"},"sharp left":{default:"Skr ostro w lewo",name:"Skr ostro w lewo w {way_name}",destination:"Skr ostro w lewo w kierunku {destination}"},"sharp right":{default:"Skr ostro w prawo",name:"Skr ostro w prawo na {way_name}",destination:"Skr ostro w prawo w kierunku {destination}"},"slight left":{default:"Kontynuuj agodnie w lewo",name:"Kontynuuj agodnie w lewo na {way_name}",destination:"Kontynuuj agodnie w lewo w kierunku {destination}"},"slight right":{default:"Kontynuuj agodnie w prawo",name:"Kontynuuj agodnie w prawo na {way_name}",destination:"Kontynuuj agodnie w prawo w kierunku {destination}"},uturn:{default:"Zawr",name:"Zawr na {way_name}",destination:"Zawr w kierunku {destination}"}},notification:{default:{default:"Kontynuuj {modifier}",name:"Kontynuuj {modifier} na {way_name}",destination:"Kontynuuj {modifier} w kierunku {destination}"},uturn:{default:"Zawr",name:"Zawr na {way_name}",destination:"Zawr w kierunku {destination}"}},"off ramp":{default:{default:"Zjed",name:"We zjazd na {way_name}",destination:"We zjazd w kierunku {destination}",exit:"Zjed zjazdem {exit}",exit_destination:"Zjed zjazdem {exit} na {destination}"},left:{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}",exit:"Zjed zjazdem {exit} po lewej stronie",exit_destination:"Zjed zjazdem {exit} po lewej stronie na {destination}"},right:{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}",exit:"Zjed zjazdem {exit} po prawej stronie",exit_destination:"Zjed zjazdem {exit} po prawej stronie na {destination}"},"sharp left":{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}",exit:"Zjed zjazdem {exit} po lewej stronie",exit_destination:"Zjed zjazdem {exit} po lewej stronie na {destination}"},"sharp right":{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}",exit:"Zjed zjazdem {exit} po prawej stronie",exit_destination:"Zjed zjazdem {exit} po prawej stronie na {destination}"},"slight left":{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}",exit:"Zjed zjazdem {exit} po lewej stronie",exit_destination:"Zjed zjazdem {exit} po lewej stronie na {destination}"},"slight right":{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}",exit:"Zjed zjazdem {exit} po prawej stronie",exit_destination:"Zjed zjazdem {exit} po prawej stronie na {destination}"}},"on ramp":{default:{default:"We zjazd",name:"We zjazd na {way_name}",destination:"We zjazd w kierunku {destination}"},left:{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}"},right:{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}"},"sharp left":{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}"},"sharp right":{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}"},"slight left":{default:"We zjazd po lewej",name:"We zjazd po lewej na {way_name}",destination:"We zjazd po lewej w kierunku {destination}"},"slight right":{default:"We zjazd po prawej",name:"We zjazd po prawej na {way_name}",destination:"We zjazd po prawej w kierunku {destination}"}},rotary:{default:{default:{default:"Wjed na rondo",name:"Wjed na rondo i skr na {way_name}",destination:"Wjed na rondo i skr w kierunku {destination}"},name:{default:"Wjed na {rotary_name}",name:"Wjed na {rotary_name} i skr na {way_name}",destination:"Wjed na {rotary_name} i skr w kierunku {destination}"},exit:{default:"Wjed na rondo i wyjed {exit_number} zjazdem",name:"Wjed na rondo i wyjed {exit_number} zjazdem na {way_name}",destination:"Wjed na rondo i wyjed {exit_number} zjazdem w kierunku {destination}"},name_exit:{default:"Wjed na {rotary_name} i wyjed {exit_number} zjazdem",name:"Wjed na {rotary_name} i wyjed {exit_number} zjazdem na {way_name}",destination:"Wjed na {rotary_name} i wyjed {exit_number} zjazdem w kierunku {destination}"}}},roundabout:{default:{exit:{default:"Wjed na rondo i wyjed {exit_number} zjazdem",name:"Wjed na rondo i wyjed {exit_number} zjazdem na {way_name}",destination:"Wjed na rondo i wyjed {exit_number} zjazdem w kierunku {destination}"},default:{default:"Wjed na rondo",name:"Wjed na rondo i wyjed na {way_name}",destination:"Wjed na rondo i wyjed w kierunku {destination}"}}},"roundabout turn":{default:{default:"{modifier}",name:"{modifier} na {way_name}",destination:"{modifier} w kierunku {destination}"},left:{default:"Skr w lewo",name:"Skr w lewo na {way_name}",destination:"Skr w lewo w kierunku {destination}"},right:{default:"Skr w prawo",name:"Skr w prawo na {way_name}",destination:"Skr w prawo w kierunku {destination}"},straight:{default:"Kontynuuj prosto",name:"Kontynuuj prosto na {way_name}",destination:"Kontynuuj prosto w kierunku {destination}"}},"exit roundabout":{default:{default:"{modifier}",name:"{modifier} na {way_name}",destination:"{modifier} w kierunku {destination}"},left:{default:"Skr w lewo",name:"Skr w lewo na {way_name}",destination:"Skr w lewo w kierunku {destination}"},right:{default:"Skr w prawo",name:"Skr w prawo na {way_name}",destination:"Skr w prawo w kierunku {destination}"},straight:{default:"Kontynuuj prosto",name:"Kontynuuj prosto na {way_name}",destination:"Kontynuuj prosto w kierunku {destination}"}},"exit rotary":{default:{default:"{modifier}",name:"{modifier} na {way_name}",destination:"{modifier} w kierunku {destination}"},left:{default:"Skr w lewo",name:"Skr w lewo na {way_name}",destination:"Skr w lewo w kierunku {destination}"},right:{default:"Skr w prawo",name:"Skr w prawo na {way_name}",destination:"Skr w prawo w kierunku {destination}"},straight:{default:"Jed prosto",name:"Jed prosto na {way_name}",destination:"Jed prosto w kierunku {destination}"}},turn:{default:{default:"{modifier}",name:"{modifier} na {way_name}",destination:"{modifier} w kierunku {destination}"},left:{default:"Skr w lewo",name:"Skr w lewo na {way_name}",destination:"Skr w lewo w kierunku {destination}"},right:{default:"Skr w prawo",name:"Skr w prawo na {way_name}",destination:"Skr w prawo w kierunku {destination}"},straight:{default:"Jed prosto",name:"Jed prosto na {way_name}",destination:"Jed prosto w kierunku {destination}"}},"use lane":{no_lanes:{default:"Kontynuuj prosto"},default:{default:"{lane_instruction}"}}}}},{}],39:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"norte",northeast:"nordeste",east:"leste",southeast:"sudeste",south:"sul",southwest:"sudoeste",west:"oeste",northwest:"noroeste"},modifier:{left:" esquerda",right:" direita","sharp left":"fechada  esquerda","sharp right":"fechada  direita","slight left":"suave  esquerda","slight right":"suave  direita",straight:"em frente",uturn:"retorno"},lanes:{xo:"Mantenha-se  direita",ox:"Mantenha-se  esquerda",xox:"Mantenha-se ao centro",oxo:"Mantenha-se  esquerda ou direita"}},modes:{ferry:{default:"Pegue a balsa",name:"Pegue a balsa {way_name}",destination:"Pegue a balsa sentido {destination}"}},phrase:{"two linked by distance":"{instruction_one}, ento, em {distance}, {instruction_two}","two linked":"{instruction_one}, ento {instruction_two}","one in distance":"Em {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"sada {exit}"},arrive:{default:{default:"Voc chegou ao seu {nth} destino",upcoming:"Voc chegar ao seu {nth} destino",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou a {waypoint_name}"},left:{default:"Voc chegou ao seu {nth} destino,  esquerda",upcoming:"Voc chegar ao seu {nth} destino,  esquerda",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  esquerda"},right:{default:"Voc chegou ao seu {nth} destino,  direita",upcoming:"Voc chegar ao seu {nth} destino,  direita",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  direita"},"sharp left":{default:"Voc chegou ao seu {nth} destino,  esquerda",upcoming:"Voc chegar ao seu {nth} destino,  esquerda",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  esquerda"},"sharp right":{default:"Voc chegou ao seu {nth} destino,  direita",upcoming:"Voc chegar ao seu {nth} destino,  direita",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  direita"},"slight right":{default:"Voc chegou ao seu {nth} destino,  direita",upcoming:"Voc chegar ao seu {nth} destino,  direita",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  direita"},"slight left":{default:"Voc chegou ao seu {nth} destino,  esquerda",upcoming:"Voc chegar ao seu {nth} destino,  esquerda",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"Voc chegou {waypoint_name},  esquerda"},straight:{default:"Voc chegou ao seu {nth} destino, em frente",upcoming:"Voc vai chegar ao seu {nth} destino, em frente",short:"Voc chegou","short-upcoming":"Voc vai chegar",named:"You have arrived at {waypoint_name}, straight ahead"}},continue:{default:{default:"Vire {modifier}",name:"Vire {modifier} para manter-se na {way_name}",destination:"Vire {modifier} sentido {destination}",exit:"Vire {modifier} em {way_name}"},straight:{default:"Continue em frente",name:"Continue em frente para manter-se na {way_name}",destination:"Continue em direo  {destination}",distance:"Continue em frente por {distance}",namedistance:"Continue na {way_name} por {distance}"},"sharp left":{default:"Faa uma curva fechada a esquerda",name:"Faa uma curva fechada a esquerda para manter-se na {way_name}",destination:"Faa uma curva fechada a esquerda sentido {destination}"},"sharp right":{default:"Faa uma curva fechada a direita",name:"Faa uma curva fechada a direita para manter-se na {way_name}",destination:"Faa uma curva fechada a direita sentido {destination}"},"slight left":{default:"Faa uma curva suave a esquerda",name:"Faa uma curva suave a esquerda para manter-se na {way_name}",destination:"Faa uma curva suave a esquerda em direo a {destination}"},"slight right":{default:"Faa uma curva suave a direita",name:"Faa uma curva suave a direita para manter-se na {way_name}",destination:"Faa uma curva suave a direita em direo a {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno e continue em {way_name}",destination:"Faa o retorno sentido {destination}"}},depart:{default:{default:"Siga {direction}",name:"Siga {direction} em {way_name}",namedistance:"Siga {direction} na {way_name} por {distance}"}},"end of road":{default:{default:"Vire {modifier}",name:"Vire {modifier} em {way_name}",destination:"Vire {modifier} sentido {destination}"},straight:{default:"Continue em frente",name:"Continue em frente em {way_name}",destination:"Continue em frente sentido {destination}"},uturn:{default:"Faa o retorno no fim da rua",name:"Faa o retorno em {way_name} no fim da rua",destination:"Faa o retorno sentido {destination} no fim da rua"}},fork:{default:{default:"Mantenha-se {modifier} na bifurcao",name:"Mantenha-se {modifier} na bifurcao em {way_name}",destination:"Mantenha-se {modifier} na bifurcao sentido {destination}"},"slight left":{default:"Mantenha-se  esquerda na bifurcao",name:"Mantenha-se  esquerda na bifurcao em {way_name}",destination:"Mantenha-se  esquerda na bifurcao sentido {destination}"},"slight right":{default:"Mantenha-se  direita na bifurcao",name:"Mantenha-se  direita na bifurcao em {way_name}",destination:"Mantenha-se  direita na bifurcao sentido {destination}"},"sharp left":{default:"Faa uma curva fechada  esquerda na bifurcao",name:"Faa uma curva fechada  esquerda em {way_name}",destination:"Faa uma curva fechada  esquerda sentido {destination}"},"sharp right":{default:"Faa uma curva fechada  direita na bifurcao",name:"Faa uma curva fechada  direita em {way_name}",destination:"Faa uma curva fechada  direita sentido {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno em {way_name}",destination:"Faa o retorno sentido {destination}"}},merge:{default:{default:"Entre {modifier}",name:"Entre {modifier} na {way_name}",destination:"Entre {modifier} em direo  {destination}"},straight:{default:"Mesclar",name:"Entre reto na {way_name}",destination:"Entre reto em direo  {destination}"},"slight left":{default:"Entre  esquerda",name:"Entre  esquerda na {way_name}",destination:"Entre  esquerda em direo  {destination}"},"slight right":{default:"Entre  direita",name:"Entre  direita na {way_name}",destination:"Entre  direita em direo  {destination}"},"sharp left":{default:"Entre  esquerda",name:"Entre  esquerda na {way_name}",destination:"Entre  esquerda em direo  {destination}"},"sharp right":{default:"Entre  direita",name:"Entre  direita na {way_name}",destination:"Entre  direita em direo  {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno em {way_name}",destination:"Faa o retorno sentido {destination}"}},"new name":{default:{default:"Continue {modifier}",name:"Continue {modifier} em {way_name}",destination:"Continue {modifier} sentido {destination}"},straight:{default:"Continue em frente",name:"Continue em {way_name}",destination:"Continue em direo  {destination}"},"sharp left":{default:"Faa uma curva fechada  esquerda",name:"Faa uma curva fechada  esquerda em {way_name}",destination:"Faa uma curva fechada  esquerda sentido {destination}"},"sharp right":{default:"Faa uma curva fechada  direita",name:"Faa uma curva fechada  direita em {way_name}",destination:"Faa uma curva fechada  direita sentido {destination}"},"slight left":{default:"Continue ligeiramente  esquerda",name:"Continue ligeiramente  esquerda em {way_name}",destination:"Continue ligeiramente  esquerda sentido {destination}"},"slight right":{default:"Continue ligeiramente  direita",name:"Continue ligeiramente  direita em {way_name}",destination:"Continue ligeiramente  direita sentido {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno em {way_name}",destination:"Faa o retorno sentido {destination}"}},notification:{default:{default:"Continue {modifier}",name:"Continue {modifier} em {way_name}",destination:"Continue {modifier} sentido {destination}"},uturn:{default:"Faa o retorno",name:"Faa o retorno em {way_name}",destination:"Faa o retorno sentido {destination}"}},"off ramp":{default:{default:"Pegue a rampa",name:"Pegue a rampa em {way_name}",destination:"Pegue a rampa sentido {destination}",exit:"Pegue a sada {exit}",exit_destination:"Pegue a sada {exit} em direo  {destination}"},left:{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}",exit:"Pegue a sada {exit}  esquerda",exit_destination:"Pegue a sada {exit}   esquerda em direo  {destination}"},right:{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}",exit:"Pegue a sada {exit}  direita",exit_destination:"Pegue a sada {exit}  direita em direo  {destination}"},"sharp left":{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}",exit:"Pegue a sada {exit}  esquerda",exit_destination:"Pegue a sada {exit}   esquerda em direo  {destination}"},"sharp right":{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}",exit:"Pegue a sada {exit}  direita",exit_destination:"Pegue a sada {exit}  direita em direo  {destination}"},"slight left":{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}",exit:"Pegue a sada {exit}  esquerda",exit_destination:"Pegue a sada {exit}   esquerda em direo  {destination}"},"slight right":{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}",exit:"Pegue a sada {exit}  direita",exit_destination:"Pegue a sada {exit}  direita em direo  {destination}"}},"on ramp":{default:{default:"Pegue a rampa",name:"Pegue a rampa em {way_name}",destination:"Pegue a rampa sentido {destination}"},left:{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}"},right:{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentid {destination}"},"sharp left":{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}"},"sharp right":{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}"},"slight left":{default:"Pegue a rampa  esquerda",name:"Pegue a rampa  esquerda em {way_name}",destination:"Pegue a rampa  esquerda sentido {destination}"},"slight right":{default:"Pegue a rampa  direita",name:"Pegue a rampa  direita em {way_name}",destination:"Pegue a rampa  direita sentido {destination}"}},rotary:{default:{default:{default:"Entre na rotatria",name:"Entre na rotatria e saia na {way_name}",destination:"Entre na rotatria e saia sentido {destination}"},name:{default:"Entre em {rotary_name}",name:"Entre em {rotary_name} e saia em {way_name}",destination:"Entre em {rotary_name} e saia sentido {destination}"},exit:{default:"Entre na rotatria e pegue a {exit_number} sada",name:"Entre na rotatria e pegue a {exit_number} sada na {way_name}",destination:"Entre na rotatria e pegue a {exit_number} sada sentido {destination}"},name_exit:{default:"Entre em {rotary_name} e saia na {exit_number} sada",name:"Entre em {rotary_name} e saia na {exit_number} sada em {way_name}",destination:"Entre em {rotary_name} e saia na {exit_number} sada sentido {destination}"}}},roundabout:{default:{exit:{default:"Entre na rotatria e pegue a {exit_number} sada",name:"Entre na rotatria e pegue a {exit_number} sada na {way_name}",destination:"Entre na rotatria e pegue a {exit_number} sada sentido {destination}"},default:{default:"Entre na rotatria",name:"Entre na rotatria e saia na {way_name}",destination:"Entre na rotatria e saia sentido {destination}"}}},"roundabout turn":{default:{default:"Siga {modifier}",name:"Siga {modifier} em {way_name}",destination:"Siga {modifier} sentido {destination}"},left:{default:"Vire  esquerda",name:"Vire  esquerda em {way_name}",destination:"Vire  esquerda sentido {destination}"},right:{default:"Vire  direita",name:"Vire  direita em {way_name}",destination:"Vire  direita sentido {destination}"},straight:{default:"Continue em frente",name:"Continue em frente em {way_name}",destination:"Continue em frente sentido {destination}"}},"exit roundabout":{default:{default:"Saia da rotatria",name:"Exit the traffic circle onto {way_name}",destination:"Exit the traffic circle towards {destination}"}},"exit rotary":{default:{default:"Saia da rotatria",name:"Exit the traffic circle onto {way_name}",destination:"Exit the traffic circle towards {destination}"}},turn:{default:{default:"Siga {modifier}",name:"Siga {modifier} em {way_name}",destination:"Siga {modifier} sentido {destination}"},left:{default:"Vire  esquerda",name:"Vire  esquerda em {way_name}",destination:"Vire  esquerda sentido {destination}"},right:{default:"Vire  direita",name:"Vire  direita em {way_name}",destination:"Vire  direita sentido {destination}"},straight:{default:"Siga em frente",name:"Siga em frente em {way_name}",destination:"Siga em frente sentido {destination}"}},"use lane":{no_lanes:{default:"Continue em frente"},default:{default:"{lane_instruction}"}}}}},{}],40:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"norte",northeast:"nordeste",east:"este",southeast:"sudeste",south:"sul",southwest:"sudoeste",west:"oeste",northwest:"noroeste"},modifier:{left:" esquerda",right:" direita","sharp left":"acentuadamente  esquerda","sharp right":"acentuadamente  direita","slight left":"ligeiramente  esquerda","slight right":"ligeiramente  direita",straight:"em frente",uturn:"inverso de marcha"},lanes:{xo:"Mantenha-se  direita",ox:"Mantenha-se  esquerda",xox:"Mantenha-se ao meio",oxo:"Mantenha-se  esquerda ou  direita"}},modes:{ferry:{default:"Apanhe o ferry",name:"Apanhe o ferry {way_name}",destination:"Apanhe o ferry para {destination}"}},phrase:{"two linked by distance":"{instruction_one}, depois, a {distance}, {instruction_two}","two linked":"{instruction_one}, depois {instruction_two}","one in distance":"A {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"sada {exit}"},arrive:{default:{default:"Chegou ao seu {nth} destino",upcoming:"Est a chegar ao seu {nth} destino",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name}"},left:{default:"Chegou ao seu {nth} destino,  esquerda",upcoming:"Est a chegar ao seu {nth} destino,  esquerda",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  esquerda"},right:{default:"Chegou ao seu {nth} destino,  direita",upcoming:"Est a chegar ao seu {nth} destino,  direita",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  direita"},"sharp left":{default:"Chegou ao seu {nth} destino,  esquerda",upcoming:"Est a chegar ao seu {nth} destino,  esquerda",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  esquerda"},"sharp right":{default:"Chegou ao seu {nth} destino,  direita",upcoming:"Est a chegar ao seu {nth} destino,  direita",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  direita"},"slight right":{default:"Chegou ao seu {nth} destino,  direita",upcoming:"Est a chegar ao seu {nth} destino,  direita",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  direita"},"slight left":{default:"Chegou ao seu {nth} destino,  esquerda",upcoming:"Est a chegar ao seu {nth} destino,  esquerda",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name},  esquerda"},straight:{default:"Chegou ao seu {nth} destino, em frente",upcoming:"Est a chegar ao seu {nth} destino, em frente",short:"Chegou","short-upcoming":"Est a chegar",named:"Chegou a {waypoint_name}, em frente"}},continue:{default:{default:"Vire {modifier}",name:"Vire {modifier} para se manter em {way_name}",destination:"Vire {modifier} em direo a {destination}",exit:"Vire {modifier} para {way_name}"},straight:{default:"Continue em frente",name:"Continue em frente para se manter em {way_name}",destination:"Continue em direo a {destination}",distance:"Continue em frente por {distance}",namedistance:"Continue em {way_name} por {distance}"},"sharp left":{default:"Vire acentuadamente  esquerda",name:"Vire acentuadamente  esquerda para se manter em {way_name}",destination:"Vire acentuadamente  esquerda em direo a {destination}"},"sharp right":{default:"Vire acentuadamente  direita",name:"Vire acentuadamente  direita para se manter em {way_name}",destination:"Vire acentuadamente  direita em direo a {destination}"},"slight left":{default:"Vire ligeiramente  esquerda",name:"Vire ligeiramente  esquerda para se manter em {way_name}",destination:"Vire ligeiramente  esquerda em direo a {destination}"},"slight right":{default:"Vire ligeiramente  direita",name:"Vire ligeiramente  direita para se manter em {way_name}",destination:"Vire ligeiramente  direita em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha e continue em {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},depart:{default:{default:"Dirija-se para {direction}",name:"Dirija-se para {direction} em {way_name}",namedistance:"Dirija-se para {direction} em {way_name} por {distance}"}},"end of road":{default:{default:"Vire {modifier}",name:"Vire {modifier} para {way_name}",destination:"Vire {modifier} em direo a {destination}"},straight:{default:"Continue em frente",name:"Continue em frente para {way_name}",destination:"Continue em frente em direo a {destination}"},uturn:{default:"No final da estrada faa uma inverso de marcha",name:"No final da estrada faa uma inverso de marcha para {way_name} ",destination:"No final da estrada faa uma inverso de marcha em direo a {destination}"}},fork:{default:{default:"Na bifurcao mantenha-se {modifier}",name:"Mantenha-se {modifier} para {way_name}",destination:"Mantenha-se {modifier} em direo a {destination}"},"slight left":{default:"Na bifurcao mantenha-se  esquerda",name:"Mantenha-se  esquerda para {way_name}",destination:"Mantenha-se  esquerda em direo a {destination}"},"slight right":{default:"Na bifurcao mantenha-se  direita",name:"Mantenha-se  direita para {way_name}",destination:"Mantenha-se  direita em direo a {destination}"},"sharp left":{default:"Na bifurcao vire acentuadamente  esquerda",name:"Vire acentuadamente  esquerda para {way_name}",destination:"Vire acentuadamente  esquerda em direo a {destination}"},"sharp right":{default:"Na bifurcao vire acentuadamente  direita",name:"Vire acentuadamente  direita para {way_name}",destination:"Vire acentuadamente  direita em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha para {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},merge:{default:{default:"Una-se ao trfego {modifier}",name:"Una-se ao trfego {modifier} para {way_name}",destination:"Una-se ao trfego {modifier} em direo a {destination}"},straight:{default:"Una-se ao trfego",name:" Una-se ao trfego para {way_name}",destination:"Una-se ao trfego em direo a {destination}"},"slight left":{default:"Una-se ao trfego  esquerda",name:"Una-se ao trfego  esquerda para {way_name}",destination:"Una-se ao trfego  esquerda em direo a {destination}"},"slight right":{default:"Una-se ao trfego  direita",name:"Una-se ao trfego  direita para {way_name}",destination:"Una-se ao trfego  direita em direo a {destination}"},"sharp left":{default:"Una-se ao trfego  esquerda",name:"Una-se ao trfego  esquerda para {way_name}",destination:"Una-se ao trfego  esquerda em direo a {destination}"},"sharp right":{default:"Una-se ao trfego  direita",name:"Una-se ao trfego  direita para {way_name}",destination:"Una-se ao trfego  direita em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha para {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},"new name":{default:{default:"Continue {modifier}",name:"Continue {modifier} para {way_name}",destination:"Continue {modifier} em direo a {destination}"},straight:{default:"Continue em frente",name:"Continue para {way_name}",destination:"Continue em direo a {destination}"},"sharp left":{default:"Vire acentuadamente  esquerda",name:"Vire acentuadamente  esquerda para {way_name}",destination:"Vire acentuadamente  esquerda em direo a{destination}"},"sharp right":{default:"Vire acentuadamente  direita",name:"Vire acentuadamente  direita para {way_name}",destination:"Vire acentuadamente  direita em direo a {destination}"},"slight left":{default:"Continue ligeiramente  esquerda",name:"Continue ligeiramente  esquerda para {way_name}",destination:"Continue ligeiramente  esquerda em direo a {destination}"},"slight right":{default:"Continue ligeiramente  direita",name:"Continue ligeiramente  direita para {way_name}",destination:"Continue ligeiramente  direita em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha para {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},notification:{default:{default:"Continue {modifier}",name:"Continue {modifier} para {way_name}",destination:"Continue {modifier} em direo a {destination}"},uturn:{default:"Faa inverso de marcha",name:"Faa inverso de marcha para {way_name}",destination:"Faa inverso de marcha em direo a {destination}"}},"off ramp":{default:{default:"Saia na sada",name:"Saia na sada para {way_name}",destination:"Saia na sada em direo a {destination}",exit:"Saia na sada {exit}",exit_destination:"Saia na sada {exit} em direo a {destination}"},left:{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}",exit:"Saia na sada {exit}  esquerda",exit_destination:"Saia na sada {exit}  esquerda em direo a {destination}"},right:{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}",exit:"Saia na sada {exit}  direita",exit_destination:"Saia na sada {exit}  direita em direo a {destination}"},"sharp left":{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}",exit:"Saia na sada {exit}  esquerda",exit_destination:"Saia na sada {exit}  esquerda em direo a {destination}"},"sharp right":{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}",exit:"Saia na sada {exit}  direita",exit_destination:"Saia na sada {exit}  direita em direo a {destination}"},"slight left":{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}",exit:"Saia na sada {exit}  esquerda",exit_destination:"Saia na sada {exit}  esquerda em direo a {destination}"},"slight right":{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}",exit:"Saia na sada {exit}  direita",exit_destination:"Saia na sada {exit}  direita em direo a {destination}"}},"on ramp":{default:{default:"Saia na sada",name:"Saia na sada para {way_name}",destination:"Saia na sada em direo a {destination}"},left:{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}"},right:{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}"},"sharp left":{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}"},"sharp right":{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}"},"slight left":{default:"Saia na sada  esquerda",name:"Saia na sada  esquerda para {way_name}",destination:"Saia na sada  esquerda em direo a {destination}"},"slight right":{default:"Saia na sada  direita",name:"Saia na sada  direita para {way_name}",destination:"Saia na sada  direita em direo a {destination}"}},rotary:{default:{default:{default:"Entre na rotunda",name:"Entre na rotunda e saia para {way_name}",destination:"Entre na rotunda e saia em direo a {destination}"},name:{default:"Entre em {rotary_name}",name:"Entre em {rotary_name} e saia para {way_name}",destination:"Entre em {rotary_name} e saia em direo a {destination}"},exit:{default:"Entre na rotunda e saia na sada {exit_number}",name:"Entre na rotunda e saia na sada {exit_number} para {way_name}",destination:"Entre na rotunda e saia na sada {exit_number} em direo a {destination}"},name_exit:{default:"Entre em {rotary_name} e saia na sada {exit_number}",name:"Entre em {rotary_name} e saia na sada {exit_number} para {way_name}",destination:"Entre em{rotary_name} e saia na sada {exit_number} em direo a {destination}"}}},roundabout:{default:{exit:{default:"Entre na rotunda e saia na sada {exit_number}",name:"Entre na rotunda e saia na sada {exit_number} para {way_name}",destination:"Entre na rotunda e saia na sada {exit_number} em direo a {destination}"},default:{default:"Entre na rotunda",name:"Entre na rotunda e saia para {way_name}",destination:"Entre na rotunda e saia em direo a {destination}"}}},"roundabout turn":{default:{default:"Siga {modifier}",name:"Siga {modifier} para {way_name}",destination:"Siga {modifier} em direo a {destination}"},left:{default:"Vire  esquerda",name:"Vire  esquerda para {way_name}",destination:"Vire  esquerda em direo a {destination}"},right:{default:"Vire  direita",name:"Vire  direita para {way_name}",destination:"Vire  direita em direo a {destination}"},straight:{default:"Continue em frente",name:"Continue em frente para {way_name}",destination:"Continue em frente em direo a {destination}"}},"exit roundabout":{default:{default:"Saia da rotunda",name:"Saia da rotunda para {way_name}",destination:"Saia da rotunda em direo a {destination}"}},"exit rotary":{default:{default:"Saia da rotunda",name:"Saia da rotunda para {way_name}",destination:"Saia da rotunda em direo a {destination}"}},turn:{default:{default:"Siga {modifier}",name:"Siga {modifier} para{way_name}",destination:"Siga {modifier} em direo a {destination}"},left:{default:"Vire  esquerda",name:"Vire  esquerda para {way_name}",destination:"Vire  esquerda em direo a {destination}"},right:{default:"Vire  direita",name:"Vire  direita para {way_name}",destination:"Vire  direita em direo a {destination}"},straight:{default:"V em frente",name:"V em frente para {way_name}",destination:"V em frente em direo a {destination}"}},"use lane":{no_lanes:{default:"Continue em frente"},default:{default:"{lane_instruction}"}}}}},{}],41:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"prima",2:"a doua",3:"a treia",4:"a patra",5:"a cincea",6:"a asea",7:"a aptea",8:"a opta",9:"a noua",10:"a zecea"},direction:{north:"nord",northeast:"nord-est",east:"est",southeast:"sud-est",south:"sud",southwest:"sud-vest",west:"vest",northwest:"nord-vest"},modifier:{left:"stnga",right:"dreapta","sharp left":"puternic stnga","sharp right":"puternic dreapta","slight left":"uor stnga","slight right":"uor dreapta",straight:"nainte",uturn:"ntoarcere"},lanes:{xo:"inei stnga",ox:"inei dreapta",xox:"inei pe mijloc",oxo:"inei pe laterale"}},modes:{ferry:{default:"Luai feribotul",name:"Luai feribotul {way_name}",destination:"Luai feribotul spre {destination}"}},phrase:{"two linked by distance":"{instruction_one}, apoi n {distance}, {instruction_two}","two linked":"{instruction_one} apoi {instruction_two}","one in distance":"n {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"ieirea {exit}"},arrive:{default:{default:"Ai ajuns la {nth} destinaie",upcoming:"Ai ajuns la {nth} destinaie",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}"},left:{default:"Ai ajuns la {nth} destinaie, pe stnga",upcoming:"Ai ajuns la {nth} destinaie, pe stnga",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe stnga"},right:{default:"Ai ajuns la {nth} destinaie, pe dreapta",upcoming:"Ai ajuns la {nth} destinaie, pe dreapta",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe dreapta"},"sharp left":{default:"Ai ajuns la {nth} destinaie, pe stnga",upcoming:"Ai ajuns la {nth} destinaie, pe stnga",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe stnga"},"sharp right":{default:"Ai ajuns la {nth} destinaie, pe dreapta",upcoming:"Ai ajuns la {nth} destinaie, pe dreapta",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe dreapta"},"slight right":{default:"Ai ajuns la {nth} destinaie, pe dreapta",upcoming:"Ai ajuns la {nth} destinaie, pe dreapta",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe dreapta"},"slight left":{default:"Ai ajuns la {nth} destinaie, pe stnga",upcoming:"Ai ajuns la {nth} destinaie, pe stnga",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, pe stnga"},straight:{default:"Ai ajuns la {nth} destinaie, n fa",upcoming:"Ai ajuns la {nth} destinaie, n fa",short:"Ai ajuns","short-upcoming":"Vei ajunge",named:"Ai ajuns {waypoint_name}, n fa"}},continue:{default:{default:"Virai {modifier}",name:"Virai {modifier} pe {way_name}",destination:"Virai {modifier} spre {destination}",exit:"Virai {modifier} pe {way_name}"},straight:{default:"Mergei nainte",name:"Mergei nainte pe {way_name}",destination:"Continuai spre {destination}",distance:"Mergei nainte pentru {distance}",namedistance:"Continuai pe {way_name} pentru {distance}"},"sharp left":{default:"Virai puternic la stnga",name:"Virai puternic la stnga pe {way_name}",destination:"Virai puternic la stnga spre {destination}"},"sharp right":{default:"Virai puternic la dreapta",name:"Virai puternic la dreapta pe {way_name}",destination:"Virai puternic la dreapta spre {destination}"},"slight left":{default:"Virai uor la stnga",name:"Virai uor la stnga pe {way_name}",destination:"Virai uor la stnga spre {destination}"},"slight right":{default:"Virai uor la dreapta",name:"Virai uor la dreapta pe {way_name}",destination:"Virai uor la dreapta spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v i continuai pe {way_name}",destination:"ntoarcei-v spre {destination}"}},depart:{default:{default:"Mergei spre {direction}",name:"Mergei spre {direction} pe {way_name}",namedistance:"Mergei spre {direction} pe {way_name} pentru {distance}"}},"end of road":{default:{default:"Virai {modifier}",name:"Virai {modifier} pe {way_name}",destination:"Virai {modifier} spre {destination}"},straight:{default:"Continuai nainte",name:"Continuai nainte pe {way_name}",destination:"Continuai nainte spre {destination}"},uturn:{default:"ntoarcei-v la sfritul drumului",name:"ntoarcei-v pe {way_name} la sfritul drumului",destination:"ntoarcei-v spre {destination} la sfritul drumului"}},fork:{default:{default:"inei {modifier} la bifurcaie",name:"inei {modifier} la bifurcaie pe {way_name}",destination:"inei {modifier} la bifurcaie spre {destination}"},"slight left":{default:"inei pe stnga la bifurcaie",name:"inei pe stnga la bifurcaie pe {way_name}",destination:"inei pe stnga la bifurcaie spre {destination}"},"slight right":{default:"inei pe dreapta la bifurcaie",name:"inei pe dreapta la bifurcaie pe {way_name}",destination:"inei pe dreapta la bifurcaie spre {destination}"},"sharp left":{default:"Virai puternic stnga la bifurcaie",name:"Virai puternic stnga la bifurcaie pe {way_name}",destination:"Virai puternic stnga la bifurcaie spre {destination}"},"sharp right":{default:"Virai puternic dreapta la bifurcaie",name:"Virai puternic dreapta la bifurcaie pe {way_name}",destination:"Virai puternic dreapta la bifurcaie spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v pe {way_name}",destination:"ntoarcei-v spre {destination}"}},merge:{default:{default:"Intrai n {modifier}",name:"Intrai n {modifier} pe {way_name}",destination:"Intrai n {modifier} spre {destination}"},straight:{default:"Intrai",name:"Intrai pe {way_name}",destination:"Intrai spre {destination}"},"slight left":{default:"Intrai n stnga",name:"Intrai n stnga pe {way_name}",destination:"Intrai n stnga spre {destination}"},"slight right":{default:"Intrai n dreapta",name:"Intrai n dreapta pe {way_name}",destination:"Intrai n dreapta spre {destination}"},"sharp left":{default:"Intrai n stnga",name:"Intrai n stnga pe {way_name}",destination:"Intrai n stnga spre {destination}"},"sharp right":{default:"Intrai n dreapta",name:"Intrai n dreapta pe {way_name}",destination:"Intrai n dreapta spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v pe {way_name}",destination:"ntoarcei-v spre {destination}"}},"new name":{default:{default:"Continuai {modifier}",name:"Continuai {modifier} pe {way_name}",destination:"Continuai {modifier} spre {destination}"},straight:{default:"Continuai nainte",name:"Continuai pe {way_name}",destination:"Continuai spre {destination}"},"sharp left":{default:"Virai puternic la stnga",name:"Virai puternic la stnga pe {way_name}",destination:"Virai puternic la stnga spre {destination}"},"sharp right":{default:"Virai puternic la dreapta",name:"Virai puternic la dreapta pe {way_name}",destination:"Virai puternic la dreapta spre {destination}"},"slight left":{default:"Continuai uor la stnga",name:"Continuai uor la stnga pe {way_name}",destination:"Continuai uor la stnga spre {destination}"},"slight right":{default:"Continuai uor la dreapta",name:"Continuai uor la dreapta pe {way_name}",destination:"Continuai uor la dreapta spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v pe {way_name}",destination:"ntoarcei-v spre {destination}"}},notification:{default:{default:"Continuai {modifier}",name:"Continuai {modifier} pe {way_name}",destination:"Continuai {modifier} spre {destination}"},uturn:{default:"ntoarcei-v",name:"ntoarcei-v pe {way_name}",destination:"ntoarcei-v spre {destination}"}},"off ramp":{default:{default:"Urmai breteaua",name:"Urmai breteaua pe {way_name}",destination:"Urmai breteaua spre {destination}",exit:"Urmai ieirea {exit}",exit_destination:"Urmai ieirea {exit} spre {destination}"},left:{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}",exit:"Urmai ieirea {exit} pe stnga",exit_destination:"Urmai ieirea {exit} pe stnga spre {destination}"},right:{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}",exit:"Urmai ieirea {exit} pe dreapta",exit_destination:"Urmai ieirea {exit} pe dreapta spre {destination}"},"sharp left":{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}",exit:"Urmai ieirea {exit} pe stnga",exit_destination:"Urmai ieirea {exit} pe stnga spre {destination}"},"sharp right":{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}",exit:"Urmai ieirea {exit} pe dreapta",exit_destination:"Urmai ieirea {exit} pe dreapta spre {destination}"},"slight left":{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}",exit:"Urmai ieirea {exit} pe stnga",exit_destination:"Urmai ieirea {exit} pe stnga spre {destination}"},"slight right":{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}",exit:"Urmai ieirea {exit} pe dreapta",exit_destination:"Urmai ieirea {exit} pe dreapta spre {destination}"}},"on ramp":{default:{default:"Urmai breteaua de intrare",name:"Urmai breteaua pe {way_name}",destination:"Urmai breteaua spre {destination}"},left:{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}"},right:{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}"},"sharp left":{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}"},"sharp right":{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}"},"slight left":{default:"Urmai breteaua din stnga",name:"Urmai breteaua din stnga pe {way_name}",destination:"Urmai breteaua din stnga spre {destination}"},"slight right":{default:"Urmai breteaua din dreapta",name:"Urmai breteaua din dreapta pe {way_name}",destination:"Urmai breteaua din dreapta spre {destination}"}},rotary:{default:{default:{default:"Intrai n sensul giratoriu",name:"Intrai n sensul giratoriu i ieii pe {way_name}",destination:"Intrai n sensul giratoriu i ieii spre {destination}"},name:{default:"Intrai n {rotary_name}",name:"Intrai n {rotary_name} i ieii pe {way_name}",destination:"Intrai n {rotary_name} i ieii spre {destination}"},exit:{default:"Intrai n sensul giratoriu i urmai {exit_number} ieire",name:"Intrai n sensul giratoriu i urmai {exit_number} ieire pe {way_name}",destination:"Intrai n sensul giratoriu i urmai {exit_number} ieire spre {destination}"},name_exit:{default:"Intrai n {rotary_name} i urmai {exit_number} ieire",name:"Intrai n {rotary_name} i urmai {exit_number} ieire pe {way_name}",destination:"Intrai n  {rotary_name} i urmai {exit_number} ieire spre {destination}"}}},roundabout:{default:{exit:{default:"Intrai n sensul giratoriu i urmai {exit_number} ieire",name:"Intrai n sensul giratoriu i urmai {exit_number} ieire pe {way_name}",destination:"Intrai n sensul giratoriu i urmai {exit_number} ieire spre {destination}"},default:{default:"Intrai n sensul giratoriu",name:"Intrai n sensul giratoriu i ieii pe {way_name}",destination:"Intrai n sensul giratoriu i ieii spre {destination}"}}},"roundabout turn":{default:{default:"La sensul giratoriu virai {modifier}",name:"La sensul giratoriu virai {modifier} pe {way_name}",destination:"La sensul giratoriu virai {modifier} spre {destination}"},left:{default:"La sensul giratoriu virai la stnga",name:"La sensul giratoriu virai la stnga pe {way_name}",destination:"La sensul giratoriu virai la stnga spre {destination}"},right:{default:"La sensul giratoriu virai la dreapta",name:"La sensul giratoriu virai la dreapta pe {way_name}",destination:"La sensul giratoriu virai la dreapta spre {destination}"},straight:{default:"La sensul giratoriu continuai nainte",name:"La sensul giratoriu continuai nainte pe {way_name}",destination:"La sensul giratoriu continuai nainte spre {destination}"}},"exit roundabout":{default:{default:"Ieii din sensul giratoriu",name:"Ieii din sensul giratoriu pe {way_name}",destination:"Ieii din sensul giratoriu spre {destination}"}},"exit rotary":{default:{default:"Ieii din sensul giratoriu",name:"Ieii din sensul giratoriu pe {way_name}",destination:"Ieii din sensul giratoriu spre {destination}"}},turn:{default:{default:"Virai {modifier}",name:"Virai {modifier} pe {way_name}",destination:"Virai {modifier} spre {destination}"},left:{default:"Virai la stnga",name:"Virai la stnga pe {way_name}",destination:"Virai la stnga spre {destination}"},right:{default:"Virai la dreapta",name:"Virai la dreapta pe {way_name}",destination:"Virai la dreapta spre {destination}"},straight:{default:"Mergei nainte",name:"Mergei nainte pe {way_name}",destination:"Mergei nainte spre {destination}"}},"use lane":{no_lanes:{default:"Mergei nainte"},default:{default:"{lane_instruction}"}}}}},{}],42:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:"-",east:"",southeast:"-",south:"",southwest:"-",west:"",northwest:"-"},modifier:{left:"",right:"","sharp left":"","sharp right":"","slight left":"","slight right":"",straight:"",uturn:" "},lanes:{xo:" ",ox:" ",xox:" ",oxo:"   "}},modes:{ferry:{default:"  ",name:"   {way_name}",destination:"     {destination}"}},phrase:{"two linked by distance":"{instruction_one},   {distance} {instruction_two}","two linked":"{instruction_one},  {instruction_two}","one in distance":" {distance} {instruction_one}","name and ref":"{name} ({ref})","exit with number":" {exit}"},arrive:{default:{default:"   {nth}  ",upcoming:"   {nth}  ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name}"},left:{default:"   {nth}  ,   ",upcoming:"   {nth}  ,   ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},   "},right:{default:"   {nth}  ,   ",upcoming:"   {nth}  ,   ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},   "},"sharp left":{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "},"sharp right":{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "},"slight right":{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "},"slight left":{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "},straight:{default:"   {nth}  ,    ",upcoming:"   {nth}  ,    ",short:" ","short-upcoming":"  ",named:"    , {waypoint_name},    "}},continue:{default:{default:" {modifier}",name:" {modifier}  {way_name:dative}",destination:" {modifier}   {destination}",exit:" {modifier}  {way_name:accusative}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}",distance:"  {distance}",namedistance:"  {distance}  {way_name:dative}"},"sharp left":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},"sharp right":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},"slight left":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},"slight right":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},uturn:{default:"",name:"     {way_name:dative}",destination:"   {destination}"}},depart:{default:{default:"  {direction} ",name:"  {direction}   {way_name:dative}",namedistance:" {distance}  {direction}   {way_name:dative}"}},"end of road":{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}   {destination}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}"},uturn:{default:"   ",name:"   {way_name:genitive}",destination:"      {destination}"}},fork:{default:{default:"   {modifier}",name:"   {modifier}  {way_name:accusative}",destination:"   {modifier}   {destination}"},"slight left":{default:"   ",name:"     {way_name:accusative}",destination:"         {destination}"},"slight right":{default:"   ",name:"     {way_name:accusative}",destination:"         {destination}"},"sharp left":{default:"    ",name:"    {way_name:accusative}",destination:"        {destination}"},"sharp right":{default:"    ",name:"    {way_name:accusative}",destination:"        {destination}"},uturn:{default:"  ",name:"    {way_name:prepositional}",destination:"        {destination}"}},merge:{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}   {destination}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}"},"slight left":{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},"slight right":{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},"sharp left":{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},"sharp right":{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},uturn:{default:"",name:"  {way_name:prepositional}",destination:"   {destination}"}},"new name":{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}   {destination}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}"},"sharp left":{default:"  ",name:"    {way_name:accusative}",destination:"        {destination}"},"sharp right":{default:"  ",name:"    {way_name:accusative}",destination:"        {destination}"},"slight left":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},"slight right":{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}"},uturn:{default:"",name:"  {way_name:prepositional}",destination:"      {destination}"}},notification:{default:{default:" {modifier}",name:" {modifier}  {way_name:dative}",destination:" {modifier}   {destination}"},uturn:{default:"",name:"  {way_name:prepositional}",destination:"      {destination}"}},"off ramp":{default:{default:"  ",name:"    {way_name:accusative}",destination:"     {destination}",exit:"   {exit}",exit_destination:"   {exit}   {destination}"},left:{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"   {exit} ",exit_destination:"   {exit}    {destination}"},right:{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"   {exit} ",exit_destination:"   {exit}    {destination}"},"sharp left":{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"    {exit}",exit_destination:"    {exit}   {destination}"},"sharp right":{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"    {exit}",exit_destination:"    {exit}   {destination}"},"slight left":{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"   {exit}",exit_destination:"    {exit}   {destination}"},"slight right":{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}",exit:"    {exit}",exit_destination:"    {exit}   {destination}"}},"on ramp":{default:{default:"  ",name:"    {way_name:accusative}",destination:"       {destination}"},left:{default:"     ",name:"     {way_name:accusative}",destination:"        {destination}"},right:{default:"     ",name:"     {way_name:accusative}",destination:"        {destination}"},"sharp left":{default:"     ",name:"     {way_name:accusative}",destination:"        {destination}"},"sharp right":{default:"     ",name:"     {way_name:accusative}",destination:"        {destination}"},"slight left":{default:"     ",name:"   {way_name:accusative}",destination:"      {destination}"},"slight right":{default:"     ",name:"   {way_name:accusative}",destination:"      {destination}"}},rotary:{default:{default:{default:"    ",name:"     {way_name:accusative}",destination:"      {destination}"},name:{default:"   {rotary_name:dative}",name:" {rotary_name:prepositional}   {way_name:accusative}",destination:" {rotary_name:prepositional}    {destination}"},exit:{default:"     {exit_number} ",name:"     {exit_number}   {way_name:accusative}",destination:"     {exit_number}    {destination}"},name_exit:{default:" {rotary_name:prepositional}   {exit_number} ",name:" {rotary_name:prepositional}   {exit_number}   {way_name:accusative}",destination:" {rotary_name:prepositional}   {exit_number}    {destination}"}}},roundabout:{default:{exit:{default:"     {exit_number} ",name:"     {exit_number}   {way_name:accusative}",destination:"     {exit_number}    {destination}"},default:{default:"    ",name:"     {way_name:accusative}",destination:"      {destination}"}}},"roundabout turn":{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}   {destination}"},left:{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},right:{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},straight:{default:" ",name:"   {way_name:dative}",destination:"    {destination}"}},"exit roundabout":{default:{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}"}},"exit rotary":{default:{default:"   ",name:"     {way_name:accusative}",destination:"      {destination}"}},turn:{default:{default:" {modifier}",name:" {modifier}  {way_name:accusative}",destination:" {modifier}    {destination}"},left:{default:" ",name:"   {way_name:accusative}",destination:"    {destination}"},right:{default:" ",name:"   {way_name:accusative}",destination:"     {destination}"},straight:{default:" ",name:"  {way_name:dative}",destination:"   {destination}"}},"use lane":{no_lanes:{default:"  "},default:{default:"{lane_instruction}"}}}}},{}],43:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1:a",2:"2:a",3:"3:e",4:"4:e",5:"5:e",6:"6:e",7:"7:e",8:"8:e",9:"9:e",10:"10:e"},direction:{north:"norr",northeast:"nordost",east:"ster",southeast:"sydost",south:"sder",southwest:"sydvst",west:"vster",northwest:"nordvst"},modifier:{left:"vnster",right:"hger","sharp left":"vnster","sharp right":"hger","slight left":"vnster","slight right":"hger",straight:"rakt fram",uturn:"U-svng"},lanes:{xo:"Hll till hger",ox:"Hll till vnster",xox:"Hll till mitten",oxo:"Hll till vnster eller hger"}},modes:{ferry:{default:"Ta frjan",name:"Ta frjan p {way_name}",destination:"Ta frjan mot {destination}"}},phrase:{"two linked by distance":"{instruction_one}, sedan efter {distance}, {instruction_two}","two linked":"{instruction_one}, sedan {instruction_two}","one in distance":"Om {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"Du r framme vid din {nth} destination",upcoming:"Du r snart framme vid din {nth} destination",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}"},left:{default:"Du r framme vid din {nth} destination, till vnster",upcoming:"Du r snart framme vid din {nth} destination, till vnster",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till vnster"},right:{default:"Du r framme vid din {nth} destination, till hger",upcoming:"Du r snart framme vid din {nth} destination, till hger",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till hger"},"sharp left":{default:"Du r framme vid din {nth} destination, till vnster",upcoming:"Du r snart framme vid din {nth} destination, till vnster",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till vnster"},"sharp right":{default:"Du r framme vid din {nth} destination, till hger",upcoming:"Du r snart framme vid din {nth} destination, till hger",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till hger"},"slight right":{default:"Du r framme vid din {nth} destination, till hger",upcoming:"Du r snart framme vid din {nth} destination, till hger",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till hger"},"slight left":{default:"Du r framme vid din {nth} destination, till vnster",upcoming:"Du r snart framme vid din {nth} destination, till vnster",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, till vnster"},straight:{default:"Du r framme vid din {nth} destination, rakt fram",upcoming:"Du r snart framme vid din {nth} destination, rakt fram",short:"Du r framme","short-upcoming":"Du r snart framme",named:"Du r framme vid {waypoint_name}, rakt fram"}},continue:{default:{default:"Svng {modifier}",name:"Svng {modifier} och fortstt p {way_name}",destination:"Svng {modifier} mot {destination}",exit:"Svng {modifier} in p {way_name}"},straight:{default:"Fortstt rakt fram",name:"Kr rakt fram och fortstt p {way_name}",destination:"Fortstt mot {destination}",distance:"Fortstt rakt fram i {distance}",namedistance:"Fortstt p {way_name} i {distance}"},"sharp left":{default:"Svng vnster",name:"Svng vnster och fortstt p {way_name}",destination:"Svng vnster mot {destination}"},"sharp right":{default:"Svng hger",name:"Svng hger och fortstt p {way_name}",destination:"Svng hger mot {destination}"},"slight left":{default:"Svng vnster",name:"Svng vnster och fortstt p {way_name}",destination:"Svng vnster mot {destination}"},"slight right":{default:"Svng hger",name:"Svng hger och fortstt p {way_name}",destination:"Svng hger mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng och fortstt p {way_name}",destination:"Gr en U-svng mot {destination}"}},depart:{default:{default:"Kr t {direction}",name:"Kr t {direction} p {way_name}",namedistance:"Kr {distance} t {direction} p {way_name}"}},"end of road":{default:{default:"Svng {modifier}",name:"Svng {modifier} in p {way_name}",destination:"Svng {modifier} mot {destination}"},straight:{default:"Fortstt rakt fram",name:"Fortstt rakt fram in p {way_name}",destination:"Fortstt rakt fram mot {destination}"},uturn:{default:"Gr en U-svng i slutet av vgen",name:"Gr en U-svng in p {way_name} i slutet av vgen",destination:"Gr en U-svng mot {destination} i slutet av vgen"}},fork:{default:{default:"Hll till {modifier} dr vgen delar sig",name:"Hll till {modifier} in p {way_name}",destination:"Hll till {modifier} mot {destination}"},"slight left":{default:"Hll till vnster dr vgen delar sig",name:"Hll till vnster in p {way_name}",destination:"Hll till vnster mot {destination}"},"slight right":{default:"Hll till hger dr vgen delar sig",name:"Hll till hger in p {way_name}",destination:"Hll till hger mot {destination}"},"sharp left":{default:"Svng vnster dr vgen delar sig",name:"Svng vnster in p {way_name}",destination:"Svng vnster mot {destination}"},"sharp right":{default:"Svng hger dr vgen delar sig",name:"Svng hger in p {way_name}",destination:"Svng hger mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng in p {way_name}",destination:"Gr en U-svng mot {destination}"}},merge:{default:{default:"Byt till {modifier} krflt",name:"Byt till {modifier} krflt, in p {way_name}",destination:"Byt till {modifier} krflt, mot {destination}"},straight:{default:"Fortstt",name:"Kr in p {way_name}",destination:"Kr mot {destination}"},"slight left":{default:"Byt till vnstra krfltet",name:"Byt till vnstra krfltet, in p {way_name}",destination:"Byt till vnstra krfltet, mot {destination}"},"slight right":{default:"Byt till hgra krfltet",name:"Byt till hgra krfltet, in p {way_name}",destination:"Byt till hgra krfltet, mot {destination}"},"sharp left":{default:"Byt till vnstra krfltet",name:"Byt till vnstra krfltet, in p {way_name}",destination:"Byt till vnstra krfltet, mot {destination}"},"sharp right":{default:"Byt till hgra krfltet",name:"Byt till hgra krfltet, in p {way_name}",destination:"Byt till hgra krfltet, mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng in p {way_name}",destination:"Gr en U-svng mot {destination}"}},"new name":{default:{default:"Fortstt {modifier}",name:"Fortstt {modifier} p {way_name}",destination:"Fortstt {modifier} mot {destination}"},straight:{default:"Fortstt rakt fram",name:"Fortstt in p {way_name}",destination:"Fortstt mot {destination}"},"sharp left":{default:"Gr en skarp vnstersvng",name:"Gr en skarp vnstersvng in p {way_name}",destination:"Gr en skarp vnstersvng mot {destination}"},"sharp right":{default:"Gr en skarp hgersvng",name:"Gr en skarp hgersvng in p {way_name}",destination:"Gr en skarp hgersvng mot {destination}"},"slight left":{default:"Fortstt med ltt vnstersvng",name:"Fortstt med ltt vnstersvng in p {way_name}",destination:"Fortstt med ltt vnstersvng mot {destination}"},"slight right":{default:"Fortstt med ltt hgersvng",name:"Fortstt med ltt hgersvng in p {way_name}",destination:"Fortstt med ltt hgersvng mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng in p {way_name}",destination:"Gr en U-svng mot {destination}"}},notification:{default:{default:"Fortstt {modifier}",name:"Fortstt {modifier} p {way_name}",destination:"Fortstt {modifier} mot {destination}"},uturn:{default:"Gr en U-svng",name:"Gr en U-svng in p {way_name}",destination:"Gr en U-svng mot {destination}"}},"off ramp":{default:{default:"Ta avfarten",name:"Ta avfarten in p {way_name}",destination:"Ta avfarten mot {destination}",exit:"Ta avfart {exit} ",exit_destination:"Ta avfart {exit} mot {destination}"},left:{default:"Ta avfarten till vnster",name:"Ta avfarten till vnster in p {way_name}",destination:"Ta avfarten till vnster mot {destination}",exit:"Ta avfart {exit} till vnster",exit_destination:"Ta avfart {exit} till vnster mot {destination}"},right:{default:"Ta avfarten till hger",name:"Ta avfarten till hger in p {way_name}",destination:"Ta avfarten till hger mot {destination}",exit:"Ta avfart {exit} till hger",exit_destination:"Ta avfart {exit} till hger mot {destination}"},"sharp left":{default:"Ta avfarten till vnster",name:"Ta avfarten till vnster in p {way_name}",destination:"Ta avfarten till vnster mot {destination}",exit:"Ta avfart {exit} till vnster",exit_destination:"Ta avfart {exit} till vnster mot {destination}"},"sharp right":{default:"Ta avfarten till hger",name:"Ta avfarten till hger in p {way_name}",destination:"Ta avfarten till hger mot {destination}",exit:"Ta avfart {exit} till hger",exit_destination:"Ta avfart {exit} till hger mot {destination}"},"slight left":{default:"Ta avfarten till vnster",name:"Ta avfarten till vnster in p {way_name}",destination:"Ta avfarten till vnster mot {destination}",exit:"Ta avfart {exit} till vnster",exit_destination:"Ta avfart{exit} till vnster mot {destination}"},"slight right":{default:"Ta avfarten till hger",name:"Ta avfarten till hger in p {way_name}",destination:"Ta avfarten till hger mot {destination}",exit:"Ta avfart {exit} till hger",exit_destination:"Ta avfart {exit} till hger mot {destination}"}},"on ramp":{default:{default:"Ta pfarten",name:"Ta pfarten in p {way_name}",destination:"Ta pfarten mot {destination}"},left:{default:"Ta pfarten till vnster",name:"Ta pfarten till vnster in p {way_name}",destination:"Ta pfarten till vnster mot {destination}"},right:{default:"Ta pfarten till hger",name:"Ta pfarten till hger in p {way_name}",destination:"Ta pfarten till hger mot {destination}"},"sharp left":{default:"Ta pfarten till vnster",name:"Ta pfarten till vnster in p {way_name}",destination:"Ta pfarten till vnster mot {destination}"},"sharp right":{default:"Ta pfarten till hger",name:"Ta pfarten till hger in p {way_name}",destination:"Ta pfarten till hger mot {destination}"},"slight left":{default:"Ta pfarten till vnster",name:"Ta pfarten till vnster in p {way_name}",destination:"Ta pfarten till vnster mot {destination}"},"slight right":{default:"Ta pfarten till hger",name:"Ta pfarten till hger in p {way_name}",destination:"Ta pfarten till hger mot {destination}"}},rotary:{default:{default:{default:"Kr in i rondellen",name:"I rondellen, ta avfarten in p {way_name}",destination:"I rondellen, ta av mot {destination}"},name:{default:"Kr in i {rotary_name}",name:"I {rotary_name}, ta av in p {way_name}",destination:"I {rotary_name}, ta av mot {destination}"},exit:{default:"I rondellen, ta {exit_number} avfarten",name:"I rondellen, ta {exit_number} avfarten in p {way_name}",destination:"I rondellen, ta {exit_number} avfarten mot {destination}"},name_exit:{default:"I {rotary_name}, ta {exit_number} avfarten",name:"I {rotary_name}, ta {exit_number}  avfarten in p {way_name}",destination:"I {rotary_name}, ta {exit_number} avfarten mot {destination}"}}},roundabout:{default:{exit:{default:"I rondellen, ta {exit_number} avfarten",name:"I rondellen, ta {exit_number} avfarten in p {way_name}",destination:"I rondellen, ta {exit_number} avfarten mot {destination}"},default:{default:"Kr in i rondellen",name:"I rondellen, ta avfarten in p {way_name}",destination:"I rondellen, ta av mot {destination}"}}},"roundabout turn":{default:{default:"Svng {modifier}",name:"Svng {modifier} in p {way_name}",destination:"Svng {modifier} mot {destination}"},left:{default:"Svng vnster",name:"Svng vnster in p {way_name}",destination:"Svng vnster mot {destination}"},right:{default:"Svng hger",name:"Svng hger in p {way_name}",destination:"Svng hger mot {destination}"},straight:{default:"Fortstt rakt fram",name:"Fortstt rakt fram in p {way_name}",destination:"Fortstt rakt fram mot {destination}"}},"exit roundabout":{default:{default:"Kr ut ur rondellen",name:"Kr ut ur rondellen in p {way_name}",destination:"Kr ut ur rondellen mot {destination}"}},"exit rotary":{default:{default:"Kr ut ur rondellen",name:"Kr ut ur rondellen in p {way_name}",destination:"Kr ut ur rondellen mot {destination}"}},turn:{default:{default:"Svng {modifier}",name:"Svng {modifier} in p {way_name}",destination:"Svng {modifier} mot {destination}"},left:{default:"Svng vnster",name:"Svng vnster in p {way_name}",destination:"Svng vnster mot {destination}"},right:{default:"Svng hger",name:"Svng hger in p {way_name}",destination:"Svng hger mot {destination}"},straight:{default:"Kr rakt fram",name:"Kr rakt fram in p {way_name}",destination:"Kr rakt fram mot {destination}"}},"use lane":{no_lanes:{default:"Fortstt rakt fram"},default:{default:"{lane_instruction}"}}}}},{}],44:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"birinci",2:"ikinci",3:"nc",4:"drdnc",5:"beinci",6:"altnc",7:"yedinci",8:"sekizinci",9:"dokuzuncu",10:"onuncu"},direction:{north:"kuzey",northeast:"kuzeydou",east:"dou",southeast:"gneydou",south:"gney",southwest:"gneybat",west:"bat",northwest:"kuzeybat"},modifier:{left:"sol",right:"sa","sharp left":"keskin sol","sharp right":"keskin sa","slight left":"hafif sol","slight right":"hafif sa",straight:"dz",uturn:"U dn"},lanes:{xo:"Sada kaln",ox:"Solda kaln",xox:"Ortada kaln",oxo:"Solda veya sada kaln"}},modes:{ferry:{default:"Vapur kullan",name:"{way_name} vapurunu kullan",destination:"{destination} istikametine giden vapuru kullan"}},phrase:{"two linked by distance":"{instruction_one} ve {distance} sonra {instruction_two}","two linked":"{instruction_one} ve sonra {instruction_two}","one in distance":"{distance} sonra, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"exit {exit}"},arrive:{default:{default:"{nth} hedefinize ulatnz",upcoming:"{nth} hedefinize ulatnz",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz"},left:{default:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz solunuzdadr"},right:{default:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz sanzdadr"},"sharp left":{default:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz solunuzdadr"},"sharp right":{default:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz sanzdadr"},"slight right":{default:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz sanzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz sanzdadr"},"slight left":{default:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz solunuzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz solunuzdadr"},straight:{default:"{nth} hedefinize ulatnz, hedefiniz karnzdadr",upcoming:"{nth} hedefinize ulatnz, hedefiniz karnzdadr",short:"{nth} hedefinize ulatnz","short-upcoming":"{nth} hedefinize ulatnz",named:"{waypoint_name} ulatnz, hedefiniz karnzdadr"}},continue:{default:{default:"{modifier} yne dn",name:"{way_name} zerinde kalmak iin {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn",exit:"{way_name} zerinde {modifier} yne dn"},straight:{default:"Dz devam edin",name:"{way_name} zerinde kalmak iin dz devam et",destination:"{destination} istikametinde devam et",distance:"{distance} boyunca dz devam et",namedistance:"{distance} boyunca {way_name} zerinde devam et"},"sharp left":{default:"Sola keskin dn yap",name:"{way_name} zerinde kalmak iin sola keskin dn yap",destination:"{destination} istikametinde sola keskin dn yap"},"sharp right":{default:"Saa keskin dn yap",name:"{way_name} zerinde kalmak iin saa keskin dn yap",destination:"{destination} istikametinde saa keskin dn yap"},"slight left":{default:"Sola hafif dn yap",name:"{way_name} zerinde kalmak iin sola hafif dn yap",destination:"{destination} istikametinde sola hafif dn yap"},"slight right":{default:"Saa hafif dn yap",name:"{way_name} zerinde kalmak iin saa hafif dn yap",destination:"{destination} istikametinde saa hafif dn yap"},uturn:{default:"U dn yapn",name:"Bir U-dn yap ve {way_name} devam et",destination:"{destination} istikametinde bir U-dn yap"}},depart:{default:{default:"{direction} tarafna ynelin",name:"{way_name} zerinde {direction} yne git",namedistance:"Head {direction} on {way_name} for {distance}"}},"end of road":{default:{default:"{modifier} tarafa dnn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},straight:{default:"Dz devam edin",name:"{way_name} zerinde dz devam et",destination:"{destination} istikametinde dz devam et"},uturn:{default:"Yolun sonunda U dn yapn",name:"Yolun sonunda {way_name} zerinde bir U-dn yap",destination:"Yolun sonunda {destination} istikametinde bir U-dn yap"}},fork:{default:{default:"Yol ayrmnda {modifier} ynde kal",name:"{way_name} zerindeki yol ayrmnda {modifier} ynde kal",destination:"{destination} istikametindeki yol ayrmnda {modifier} ynde kal"},"slight left":{default:"ataln solundan devam edin",name:"ataln solundan {way_name} yoluna doru ",destination:"{destination} istikametindeki yol ayrmnda solda kal"},"slight right":{default:"ataln sandan devam edin",name:"{way_name} zerindeki yol ayrmnda sada kal",destination:"{destination} istikametindeki yol ayrmnda sada kal"},"sharp left":{default:"atalda keskin sola dnn",name:"{way_name} yoluna doru sola keskin dn yapn",destination:"{destination} istikametinde sola keskin dn yap"},"sharp right":{default:"atalda keskin saa dnn",name:"{way_name} yoluna doru saa keskin dn yapn",destination:"{destination} istikametinde saa keskin dn yap"},uturn:{default:"U dn yapn",name:"{way_name} yoluna U dn yapn",destination:"{destination} istikametinde bir U-dn yap"}},merge:{default:{default:"{modifier} yne gir",name:"{way_name} zerinde {modifier} yne gir",destination:"{destination} istikametinde {modifier} yne gir"},straight:{default:"dz yne gir",name:"{way_name} zerinde dz yne gir",destination:"{destination} istikametinde dz yne gir"},"slight left":{default:"Sola gir",name:"{way_name} zerinde sola gir",destination:"{destination} istikametinde sola gir"},"slight right":{default:"Saa gir",name:"{way_name} zerinde saa gir",destination:"{destination} istikametinde saa gir"},"sharp left":{default:"Sola gir",name:"{way_name} zerinde sola gir",destination:"{destination} istikametinde sola gir"},"sharp right":{default:"Saa gir",name:"{way_name} zerinde saa gir",destination:"{destination} istikametinde saa gir"},uturn:{default:"U dn yapn",name:"{way_name} yoluna U dn yapn",destination:"{destination} istikametinde bir U-dn yap"}},"new name":{default:{default:"{modifier} ynde devam et",name:"{way_name} zerinde {modifier} ynde devam et",destination:"{destination} istikametinde {modifier} ynde devam et"},straight:{default:"Dz devam et",name:"{way_name} zerinde devam et",destination:"{destination} istikametinde devam et"},"sharp left":{default:"Sola keskin dn yapn",name:"{way_name} yoluna doru sola keskin dn yapn",destination:"{destination} istikametinde sola keskin dn yap"},"sharp right":{default:"Saa keskin dn yapn",name:"{way_name} yoluna doru saa keskin dn yapn",destination:"{destination} istikametinde saa keskin dn yap"},"slight left":{default:"Hafif soldan devam edin",name:"{way_name} zerinde hafif solda devam et",destination:"{destination} istikametinde hafif solda devam et"},"slight right":{default:"Hafif sadan devam edin",name:"{way_name} zerinde hafif sada devam et",destination:"{destination} istikametinde hafif sada devam et"},uturn:{default:"U dn yapn",name:"{way_name} yoluna U dn yapn",destination:"{destination} istikametinde bir U-dn yap"}},notification:{default:{default:"{modifier} ynde devam et",name:"{way_name} zerinde {modifier} ynde devam et",destination:"{destination} istikametinde {modifier} ynde devam et"},uturn:{default:"U dn yapn",name:"{way_name} yoluna U dn yapn",destination:"{destination} istikametinde bir U-dn yap"}},"off ramp":{default:{default:"Balant yoluna ge",name:"{way_name} zerindeki balant yoluna ge",destination:"{destination} istikametine giden balant yoluna ge",exit:"{exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} k yoluna ge"},left:{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge",exit:"Soldaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sol k yoluna ge"},right:{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge",exit:"Sadaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sa k yoluna ge"},"sharp left":{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge",exit:"Soldaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sol k yoluna ge"},"sharp right":{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge",exit:"Sadaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sa k yoluna ge"},"slight left":{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge",exit:"Soldaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sol k yoluna ge"},"slight right":{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge",exit:"Sadaki {exit} k yoluna ge",exit_destination:"{destination} istikametindeki {exit} sa k yoluna ge"}},"on ramp":{default:{default:"Balant yoluna ge",name:"{way_name} zerindeki balant yoluna ge",destination:"{destination} istikametine giden balant yoluna ge"},left:{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge"},right:{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge"},"sharp left":{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge"},"sharp right":{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge"},"slight left":{default:"Soldaki balant yoluna ge",name:"{way_name} zerindeki sol balant yoluna ge",destination:"{destination} istikametine giden sol balant yoluna ge"},"slight right":{default:"Sadaki balant yoluna ge",name:"{way_name} zerindeki sa balant yoluna ge",destination:"{destination} istikametine giden sa balant yoluna ge"}},rotary:{default:{default:{default:"Dnel kavaa gir",name:"Dnel kavaa gir ve {way_name} zerinde k",destination:"Dnel kavaa gir ve {destination} istikametinde k"},name:{default:"{rotary_name} dnel kavaa gir",name:"{rotary_name} dnel kavaa gir ve {way_name} zerinde k",destination:"{rotary_name} dnel kavaa gir ve {destination} istikametinde k"},exit:{default:"Dnel kavaa gir ve {exit_number} numaral ka gir",name:"Dnel kavaa gir ve {way_name} zerindeki {exit_number} numaral ka gir",destination:"Dnel kavaa gir ve {destination} istikametindeki {exit_number} numaral ka gir"},name_exit:{default:"{rotary_name} dnel kavaa gir ve {exit_number} numaral ka gir",name:"{rotary_name} dnel kavaa gir ve {way_name} zerindeki {exit_number} numaral ka gir",destination:"{rotary_name} dnel kavaa gir ve {destination} istikametindeki {exit_number} numaral ka gir"}}},roundabout:{default:{exit:{default:"Gbekli kavaa gir ve {exit_number} numaral ka gir",name:"Gbekli kavaa gir ve {way_name} zerindeki {exit_number} numaral ka gir",destination:"Gbekli kavaa gir ve {destination} istikametindeki {exit_number} numaral ka gir"},default:{default:"Gbekli kavaa gir",name:"Gbekli kavaa gir ve {way_name} zerinde k",destination:"Gbekli kavaa gir ve {destination} istikametinde k"}}},"roundabout turn":{default:{default:"{modifier} yne dn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},left:{default:"Sola dn",name:"{way_name} zerinde sola dn",destination:"{destination} istikametinde sola dn"},right:{default:"Saa dn",name:"{way_name} zerinde saa dn",destination:"{destination} istikametinde saa dn"},straight:{default:"Dz devam et",name:"{way_name} zerinde dz devam et",destination:"{destination} istikametinde dz devam et"}},"exit roundabout":{default:{default:"{modifier} yne dn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},left:{default:"Sola dn",name:"{way_name} zerinde sola dn",destination:"{destination} istikametinde sola dn"},right:{default:"Saa dn",name:"{way_name} zerinde saa dn",destination:"{destination} istikametinde saa dn"},straight:{default:"Dz devam et",name:"{way_name} zerinde dz devam et",destination:"{destination} istikametinde dz devam et"}},"exit rotary":{default:{default:"{modifier} yne dn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},left:{default:"Sola dn",name:"{way_name} zerinde sola dn",destination:"{destination} istikametinde sola dn"},right:{default:"Saa dn",name:"{way_name} zerinde saa dn",destination:"{destination} istikametinde saa dn"},straight:{default:"Dz devam et",name:"{way_name} zerinde dz devam et",destination:"{destination} istikametinde dz devam et"}},turn:{default:{default:"{modifier} yne dn",name:"{way_name} zerinde {modifier} yne dn",destination:"{destination} istikametinde {modifier} yne dn"},left:{default:"Sola dnn",name:"{way_name} zerinde sola dn",destination:"{destination} istikametinde sola dn"},right:{default:"Saa dnn",name:"{way_name} zerinde saa dn",destination:"{destination} istikametinde saa dn"},straight:{default:"Dz git",name:"{way_name} zerinde dz git",destination:"{destination} istikametinde dz git"}},"use lane":{no_lanes:{default:"Dz devam edin"},default:{default:"{lane_instruction}"}}}}},{}],45:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},direction:{north:"",northeast:" ",east:"",southeast:" ",south:"",southwest:" ",west:"",northwest:" "},modifier:{left:"",right:"","sharp left":" ","sharp right":" ","slight left":" ","slight right":" ",straight:"",uturn:""},lanes:{xo:" ",ox:" ",xox:"  ",oxo:"   "}},modes:{ferry:{default:" ",name:"  {way_name}",destination:"    {destination}"}},phrase:{"two linked by distance":"{instruction_one}, ,  {distance}, {instruction_two}","two linked":"{instruction_one},  {instruction_two}","one in distance":" {distance}, {instruction_one}","name and ref":"{name} ({ref})","exit with number":"' {exit}"},arrive:{default:{default:"    {nth}  ",upcoming:"    {nth}  ",short:" ","short-upcoming":" ",named:"   {waypoint_name}"},left:{default:"    {nth}  ,  ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},right:{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},"sharp left":{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},"sharp right":{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},"slight right":{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},"slight left":{default:"    {nth}  ,   ",upcoming:"    {nth}  , ",short:" ","short-upcoming":" ",named:"   {waypoint_name} "},straight:{default:"    {nth}  ,     ",upcoming:"    {nth}  ,   ",short:" ","short-upcoming":" ",named:"   {waypoint_name}   "}},continue:{default:{default:" {modifier}",name:"{modifier}   {way_name}",destination:" {modifier}   {destination}",exit:" {modifier}  {way_name}"},straight:{default:"  ",name:"     {way_name}",destination:"   {destination}",distance:"   {distance}",namedistance:"   {way_name} {distance}"},"sharp left":{default:"  ",name:"      {way_name}",destination:"     {destination}"},"sharp right":{default:"  ",name:"      {way_name}",destination:"     {destination}"},"slight left":{default:"  ",name:"      {way_name}",destination:"     {destination}"},"slight right":{default:"  ",name:"      {way_name}",destination:"     {destination}"},uturn:{default:" ",name:"     {way_name}",destination:"    {destination}"}},depart:{default:{default:"  {direction}",name:"  {direction}  {way_name}",namedistance:"  {direction}  {way_name} {distance}"}},"end of road":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},straight:{default:"  ",name:"    {way_name}",destination:"     {destination}"},uturn:{default:"    ",name:"   {way_name}   ",destination:"    {destination}   "}},fork:{default:{default:"   {modifier}",name:" {modifier}    {way_name}",destination:" {modifier}   {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"    {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"    {destination}"},"sharp left":{default:"    ",name:"    {way_name}",destination:"     {destination}"},"sharp right":{default:"    ",name:"    {way_name}",destination:"     {destination}"},uturn:{default:" ",name:"   {way_name}",destination:"    {destination}"}},merge:{default:{default:"   {modifier}",name:"   {modifier}  {way_name}",destination:"   {modifier}   {destination}"},straight:{default:"  ",name:"    {way_name}",destination:"     {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"sharp left":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"sharp right":{default:"   ",name:"     {way_name}",destination:"      {destination}"},uturn:{default:" ",name:"   {way_name}",destination:"    {destination}"}},"new name":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},straight:{default:" ",name:"  {way_name}",destination:"   {destination}"},"sharp left":{default:"  ",name:"    {way_name}",destination:"     {destination}"},"sharp right":{default:"  ",name:"    {way_name}",destination:"     {destination}"},"slight left":{default:"  ",name:"    {way_name}",destination:"     {destination}"},"slight right":{default:"  ",name:"    {way_name}",destination:"     {destination}"},uturn:{default:" ",name:"   {way_name}",destination:"    {destination}"}},notification:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},uturn:{default:" ",name:"   {way_name}",destination:"    {destination}"}},"off ramp":{default:{default:"  ",name:"    {way_name}",destination:"     {destination}",exit:" ' {exit}",exit_destination:" ' {exit}   {destination}"},left:{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},right:{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},"sharp left":{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},"sharp right":{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"      {destination}",exit:" ' {exit} ",exit_destination:" ' {exit}    {destination}"}},"on ramp":{default:{default:"  ",name:"    {way_name}",destination:"     {destination}"},left:{default:"   ",name:"     {way_name}",destination:"      {destination}"},right:{default:"   ",name:"     {way_name}",destination:"      {destination}"},"sharp left":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"sharp right":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"slight left":{default:"   ",name:"     {way_name}",destination:"      {destination}"},"slight right":{default:"   ",name:"     {way_name}",destination:"      {destination}"}},rotary:{default:{default:{default:"  ",name:"    {way_name}",destination:"     {destination}"},name:{default:"  {rotary_name}",name:"  {rotary_name}    {way_name}",destination:"  {rotary_name}     {destination}"},exit:{default:"      {exit_number} '",name:"      {exit_number} '  {way_name}",destination:"      {exit_number} '   {destination}"},name_exit:{default:"  {rotary_name}    {exit_number} '",name:"  {rotary_name}    {exit_number} '  {way_name}",destination:"  {rotary_name}    {exit_number} '   {destination}"}}},roundabout:{default:{exit:{default:"      {exit_number} '",name:"      {exit_number} '  {way_name}",destination:"      {exit_number} '   {destination}"},default:{default:"  ",name:"    {way_name}",destination:"     {destination}"}}},"roundabout turn":{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},left:{default:" ",name:"   {way_name}",destination:"    {destination}"},right:{default:" ",name:"   {way_name}",destination:"    {destination}"},straight:{default:" ",name:"    {way_name}",destination:"     {destination}"}},"exit roundabout":{default:{default:" ",name:"   {way_name} ",destination:"    {destination}"}},"exit rotary":{default:{default:" ",name:"   {way_name} ",destination:"    {destination}"}},turn:{default:{default:" {modifier}",name:" {modifier}  {way_name}",destination:" {modifier}   {destination}"},left:{default:" ",name:"   {way_name}",destination:"    {destination}"},right:{default:" ",name:"   {way_name}",destination:"    {destination}"},straight:{default:" ",name:"   {way_name}",destination:"    {destination}"}},"use lane":{no_lanes:{default:"  "},default:{default:"{lane_instruction}"}}}}},{}],46:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!0},v5:{constants:{ordinalize:{1:"u tin",2:"th 2",3:"th 3",4:"th 4",5:"th 5",6:"th 6",7:"th 7",8:"th 8",9:"th 9",10:"th 10"},direction:{north:"bc",northeast:"ng bc",east:"ng",southeast:"ng nam",south:"nam",southwest:"ty nam",west:"ty",northwest:"ty bc"},modifier:{left:"tri",right:"phi","sharp left":"tri gt","sharp right":"phi gt","slight left":"tri nghing","slight right":"phi nghing",straight:"thng",uturn:"ngc"},lanes:{xo:"i bn phi",ox:"i bn tri",xox:"i vo gia",oxo:"i bn tri hay bn phi"}},modes:{ferry:{default:"Ln ph",name:"Ln ph {way_name}",destination:"Ln ph i {destination}"}},phrase:{"two linked by distance":"{instruction_one}, ri {distance} na th {instruction_two}","two linked":"{instruction_one}, ri {instruction_two}","one in distance":"{distance} na th {instruction_one}","name and ref":"{name} ({ref})","exit with number":"li ra {exit}"},arrive:{default:{default:"n ni {nth}",upcoming:"n ni {nth}",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}"},left:{default:"n ni {nth}  bn tri",upcoming:"n ni {nth}  bn tri",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn tri"},right:{default:"n ni {nth}  bn phi",upcoming:"n ni {nth}  bn phi",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn phi"},"sharp left":{default:"n ni {nth}  bn tri",upcoming:"n ni {nth}  bn tri",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn tri"},"sharp right":{default:"n ni {nth}  bn phi",upcoming:"n ni {nth}  bn phi",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn phi"},"slight right":{default:"n ni {nth}  bn phi",upcoming:"n ni {nth}  bn phi",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn phi"},"slight left":{default:"n ni {nth}  bn tri",upcoming:"n ni {nth}  bn tri",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  bn tri"},straight:{default:"n ni {nth}  trc mt",upcoming:"n ni {nth}  trc mt",short:"n ni","short-upcoming":"n ni",named:"n {waypoint_name}  trc mt"}},continue:{default:{default:"Quo {modifier}",name:"Quo {modifier}  chy tip trn {way_name}",destination:"Quo {modifier} v {destination}",exit:"Quo {modifier} vo {way_name}"},straight:{default:"Chy thng",name:"Chy tip trn {way_name}",destination:"Chy tip v {destination}",distance:"Chy thng cho {distance}",namedistance:"Chy tip trn {way_name} cho {distance}"},"sharp left":{default:"Quo gt bn tri",name:"Quo gt bn tri  chy tip trn {way_name}",destination:"Quo gt bn tri v {destination}"},"sharp right":{default:"Quo gt bn phi",name:"Quo gt bn phi  chy tip trn {way_name}",destination:"Quo gt bn phi v {destination}"},"slight left":{default:"Nghing v bn tri",name:"Nghing v bn tri  chy tip trn {way_name}",destination:"Nghing v bn tri v {destination}"},"slight right":{default:"Nghing v bn phi",name:"Nghing v bn phi  chy tip trn {way_name}",destination:"Nghing v bn phi v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li trn {way_name}",destination:"Quo ngc v {destination}"}},depart:{default:{default:"i v hng {direction}",name:"i v hng {direction} trn {way_name}",namedistance:"i v hng {direction} trn {way_name} cho {distance}"}},"end of road":{default:{default:"Quo {modifier}",name:"Quo {modifier} vo {way_name}",destination:"Quo {modifier} v {destination}"},straight:{default:"Chy thng",name:"Chy tip trn {way_name}",destination:"Chy tip v {destination}"},uturn:{default:"Quo ngc li ti cui ng",name:"Quo ngc vo {way_name} ti cui ng",destination:"Quo ngc v {destination} ti cui ng"}},fork:{default:{default:"i bn {modifier}  ng ba",name:"Gi bn {modifier} vo {way_name}",destination:"Gi bn {modifier} v {destination}"},"slight left":{default:"Nghing v bn tri  ng ba",name:"Gi bn tri vo {way_name}",destination:"Gi bn tri v {destination}"},"slight right":{default:"Nghing v bn phi  ng ba",name:"Gi bn phi vo {way_name}",destination:"Gi bn phi v {destination}"},"sharp left":{default:"Quo gt bn tri  ng ba",name:"Quo gt bn tri vo {way_name}",destination:"Quo gt bn tri v {destination}"},"sharp right":{default:"Quo gt bn phi  ng ba",name:"Quo gt bn phi vo {way_name}",destination:"Quo gt bn phi v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li {way_name}",destination:"Quo ngc li v {destination}"}},merge:{default:{default:"Nhp sang {modifier}",name:"Nhp sang {modifier} vo {way_name}",destination:"Nhp sang {modifier} v {destination}"},straight:{default:"Nhp ng",name:"Nhp vo {way_name}",destination:"Nhp ng v {destination}"},"slight left":{default:"Nhp sang tri",name:"Nhp sang tri vo {way_name}",destination:"Nhp sang tri v {destination}"},"slight right":{default:"Nhp sang phi",name:"Nhp sang phi vo {way_name}",destination:"Nhp sang phi v {destination}"},"sharp left":{default:"Nhp sang tri",name:"Nhp sang tri vo {way_name}",destination:"Nhp sang tri v {destination}"},"sharp right":{default:"Nhp sang phi",name:"Nhp sang phi vo {way_name}",destination:"Nhp sang phi v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li {way_name}",destination:"Quo ngc li v {destination}"}},"new name":{default:{default:"Chy tip bn {modifier}",name:"Chy tip bn {modifier} trn {way_name}",destination:"Chy tip bn {modifier} v {destination}"},straight:{default:"Chy thng",name:"Chy tip trn {way_name}",destination:"Chy tip v {destination}"},"sharp left":{default:"Quo gt bn tri",name:"Quo gt bn tri vo {way_name}",destination:"Quo gt bn tri v {destination}"},"sharp right":{default:"Quo gt bn phi",name:"Quo gt bn phi vo {way_name}",destination:"Quo gt bn phi v {destination}"},"slight left":{default:"Nghing v bn tri",name:"Nghing v bn tri vo {way_name}",destination:"Nghing v bn tri v {destination}"},"slight right":{default:"Nghing v bn phi",name:"Nghing v bn phi vo {way_name}",destination:"Nghing v bn phi v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li {way_name}",destination:"Quo ngc li v {destination}"}},notification:{default:{default:"Chy tip bn {modifier}",name:"Chy tip bn {modifier} trn {way_name}",destination:"Chy tip bn {modifier} v {destination}"},uturn:{default:"Quo ngc li",name:"Quo ngc li {way_name}",destination:"Quo ngc li v {destination}"}},"off ramp":{default:{default:"i ng nhnh",name:"i ng nhnh {way_name}",destination:"i ng nhnh v {destination}",exit:"i theo li ra {exit}",exit_destination:"i theo li ra {exit} v {destination}"},left:{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}",exit:"i theo li ra {exit} bn tri",exit_destination:"i theo li ra {exit} bn tri v {destination}"},right:{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}",exit:"i theo li ra {exit} bn phi",exit_destination:"i theo li ra {exit} bn phi v {destination}"},"sharp left":{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}",exit:"i theo li ra {exit} bn tri",exit_destination:"i theo li ra {exit} bn tri v {destination}"},"sharp right":{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}",exit:"i theo li ra {exit} bn phi",exit_destination:"i theo li ra {exit} bn phi v {destination}"},"slight left":{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}",exit:"i theo li ra {exit} bn tri",exit_destination:"i theo li ra {exit} bn tri v {destination}"},"slight right":{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}",exit:"i theo li ra {exit} bn phi",exit_destination:"i theo li ra {exit} bn phi v {destination}"}},"on ramp":{default:{default:"i ng nhnh",name:"i ng nhnh {way_name}",destination:"i ng nhnh v {destination}"},left:{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}"},right:{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}"},"sharp left":{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}"},"sharp right":{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}"},"slight left":{default:"i ng nhnh bn tri",name:"i ng nhnh {way_name} bn tri",destination:"i ng nhnh bn tri v {destination}"},"slight right":{default:"i ng nhnh bn phi",name:"i ng nhnh {way_name} bn phi",destination:"i ng nhnh bn phi v {destination}"}},rotary:{default:{default:{default:"i vo bng binh",name:"i vo bng binh v ra ti {way_name}",destination:"i vo bng binh v ra v {destination}"},name:{default:"i vo {rotary_name}",name:"i vo {rotary_name} v ra ti {way_name}",destination:"i v {rotary_name} v ra v {destination}"},exit:{default:"i vo bng binh v ra ti ng {exit_number}",name:"i vo bng binh v ra ti ng {exit_number} tc {way_name}",destination:"i vo bng binh v ra ti ng {exit_number} v {destination}"},name_exit:{default:"i vo {rotary_name} v ra ti ng {exit_number}",name:"i vo {rotary_name} v ra ti ng {exit_number} tc {way_name}",destination:"i vo {rotary_name} v ra ti ng {exit_number} v {destination}"}}},roundabout:{default:{exit:{default:"i vo bng binh v ra ti ng {exit_number}",name:"i vo bng binh v ra ti ng {exit_number} tc {way_name}",destination:"i vo bng binh v ra ti ng {exit_number} v {destination}"},default:{default:"i vo bng binh",name:"i vo bng binh v ra ti {way_name}",destination:"i vo bng binh v ra v {destination}"}}},"roundabout turn":{default:{default:"Quo {modifier}",name:"Quo {modifier} vo {way_name}",destination:"Quo {modifier} v {destination}"},left:{default:"Quo tri",name:"Quo tri vo {way_name}",destination:"Quo tri v {destination}"},right:{default:"Quo phi",name:"Quo phi vo {way_name}",destination:"Quo phi v {destination}"},straight:{default:"Chy thng",name:"Chy tip trn {way_name}",destination:"Chy tip v {destination}"}},"exit roundabout":{default:{default:"Ra bng binh",name:"Ra bng binh vo {way_name}",destination:"Ra bng binh v {destination}"}},"exit rotary":{default:{default:"Ra bng binh",name:"Ra bng binh vo {way_name}",destination:"Ra bng binh v {destination}"}},turn:{default:{default:"Quo {modifier}",name:"Quo {modifier} vo {way_name}",destination:"Quo {modifier} v {destination}"},left:{default:"Quo tri",name:"Quo tri vo {way_name}",destination:"Quo tri v {destination}"},right:{default:"Quo phi",name:"Quo phi vo {way_name}",destination:"Quo phi v {destination}"},straight:{default:"Chy thng",name:"Chy thng vo {way_name}",destination:"Chy thng v {destination}"}},"use lane":{no_lanes:{default:"Chy thng"},default:{default:"{lane_instruction}"}}}}},{}],47:[function(s,a,l){a.exports={meta:{capitalizeFirstLetter:!1},v5:{constants:{ordinalize:{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:""},direction:{north:"",northeast:"",east:"",southeast:"",south:"",southwest:"",west:"",northwest:""},modifier:{left:"",right:"","sharp left":"","sharp right":"","slight left":"","slight right":"",straight:"",uturn:""},lanes:{xo:"",ox:"",xox:"",oxo:""}},modes:{ferry:{default:"",name:"{way_name}",destination:"{destination}"}},phrase:{"two linked by distance":"{instruction_one}{distance}{instruction_two}","two linked":"{instruction_one}{instruction_two}","one in distance":"{distance}{instruction_one}","name and ref":"{name}{ref}","exit with number":"{exit}"},arrive:{default:{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},left:{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},right:{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},"sharp left":{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},"sharp right":{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},"slight right":{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},"slight left":{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"},straight:{default:"{nth}",upcoming:"{nth}",short:"","short-upcoming":"",named:"{waypoint_name}"}},continue:{default:{default:"{modifier}",name:"{way_name}{modifier}",destination:"{modifier}{destination}",exit:"{modifier}{way_name}"},straight:{default:"",name:"{way_name}",destination:"{destination}",distance:"{distance}",namedistance:"{way_name}{distance}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},depart:{default:{default:"{direction}",name:"{direction}{way_name}",namedistance:"{direction}{way_name}{distance}"}},"end of road":{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},fork:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},merge:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},"new name":{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},notification:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},uturn:{default:"",name:"{way_name}",destination:"{destination}"}},"off ramp":{default:{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},left:{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},right:{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}",exit:"{exit}",exit_destination:"{exit}{destination}"}},"on ramp":{default:{default:"",name:"{way_name}",destination:"{destination}"},left:{default:"",name:"{way_name}",destination:"{destination}"},right:{default:"",name:"{way_name}",destination:"{destination}"},"sharp left":{default:"",name:"{way_name}",destination:"{destination}"},"sharp right":{default:"",name:"{way_name}",destination:"{destination}"},"slight left":{default:"",name:"{way_name}",destination:"{destination}"},"slight right":{default:"",name:"{way_name}",destination:"{destination}"}},rotary:{default:{default:{default:"",name:"{way_name}",destination:"{destination}"},name:{default:"{rotary_name}",name:"{rotary_name}{way_name}",destination:"{rotary_name}{destination}"},exit:{default:"{exit_number}",name:"{exit_number}{way_name}",destination:"{exit_number}{destination}"},name_exit:{default:"{rotary_name}{exit_number}",name:"{rotary_name}{exit_number}{way_name}",destination:"{rotary_name}{exit_number}{destination}"}}},roundabout:{default:{exit:{default:"{exit_number}",name:"{exit_number}{way_name}",destination:"{exit_number}{destination}"},default:{default:"",name:"{way_name}",destination:"{destination}"}}},"roundabout turn":{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},left:{default:"",name:"{way_name}",destination:"{destination}"},right:{default:"",name:"{way_name}",destination:"{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"}},"exit roundabout":{default:{default:"",name:"{way_name}",destination:"{destination}"}},"exit rotary":{default:{default:"",name:"{way_name}",destination:"{destination}"}},turn:{default:{default:"{modifier}",name:"{modifier}{way_name}",destination:"{modifier}{destination}"},left:{default:"",name:"{way_name}",destination:"{destination}"},right:{default:"",name:"{way_name}",destination:"{destination}"},straight:{default:"",name:"{way_name}",destination:"{destination}"}},"use lane":{no_lanes:{default:""},default:{default:"{lane_instruction}"}}}}},{}],48:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null;a.exports=f.Class.extend({options:{timeout:500,blurTimeout:100,noResultsMessage:"No results found."},initialize:function(y,w,i,C){f.setOptions(this,C),this._elem=y,this._resultFn=C.resultFn?f.Util.bind(C.resultFn,C.resultContext):null,this._autocomplete=C.autocompleteFn?f.Util.bind(C.autocompleteFn,C.autocompleteContext):null,this._selectFn=f.Util.bind(w,i),this._container=f.DomUtil.create("div","leaflet-routing-geocoder-result"),this._resultTable=f.DomUtil.create("table","",this._container),f.DomEvent.addListener(this._elem,"input",this._keyPressed,this),f.DomEvent.addListener(this._elem,"keypress",this._keyPressed,this),f.DomEvent.addListener(this._elem,"keydown",this._keyDown,this),f.DomEvent.addListener(this._elem,"blur",function(){this._isOpen&&this.close()},this)},close:function(){f.DomUtil.removeClass(this._container,"leaflet-routing-geocoder-result-open"),this._isOpen=!1},_open:function(){var y=this._elem.getBoundingClientRect();if(!this._container.parentElement){var w=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,i=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;this._container.style.left=y.left+w+"px",this._container.style.top=y.bottom+i+"px",this._container.style.width=y.right-y.left+"px",document.body.appendChild(this._container)}f.DomUtil.addClass(this._container,"leaflet-routing-geocoder-result-open"),this._isOpen=!0},_setResults:function(y){var w,i,C,P;for(delete this._selection,this._results=y;this._resultTable.firstChild;)this._resultTable.removeChild(this._resultTable.firstChild);for(w=0;w<y.length;w++)i=f.DomUtil.create("tr","",this._resultTable),i.setAttribute("data-result-index",w),C=f.DomUtil.create("td","",i),P=document.createTextNode(y[w].name),C.appendChild(P),f.DomEvent.addListener(C,"mousedown",f.DomEvent.preventDefault),f.DomEvent.addListener(C,"click",this._createClickListener(y[w]));w||(i=f.DomUtil.create("tr","",this._resultTable),C=f.DomUtil.create("td","leaflet-routing-geocoder-no-results",i),C.innerHTML=this.options.noResultsMessage),this._open(),y.length>0&&this._select(1)},_createClickListener:function(y){var w=this._resultSelected(y);return f.bind(function(){this._elem.blur(),w()},this)},_resultSelected:function(y){return f.bind(function(){this.close(),this._elem.value=y.name,this._lastCompletedText=y.name,this._selectFn(y)},this)},_keyPressed:function(y){var w;if(this._isOpen&&y.keyCode===13&&this._selection){w=parseInt(this._selection.getAttribute("data-result-index"),10),this._resultSelected(this._results[w])(),f.DomEvent.preventDefault(y);return}if(y.keyCode===13){f.DomEvent.preventDefault(y),this._complete(this._resultFn,!0);return}if(this._autocomplete&&document.activeElement===this._elem){this._timer&&clearTimeout(this._timer),this._timer=setTimeout(f.Util.bind(function(){this._complete(this._autocomplete)},this),this.options.timeout);return}this._unselect()},_select:function(y){var w=this._selection;w&&(f.DomUtil.removeClass(w.firstChild,"leaflet-routing-geocoder-selected"),w=w[y>0?"nextSibling":"previousSibling"]),w||(w=this._resultTable[y>0?"firstChild":"lastChild"]),w&&(f.DomUtil.addClass(w.firstChild,"leaflet-routing-geocoder-selected"),this._selection=w)},_unselect:function(){this._selection&&f.DomUtil.removeClass(this._selection.firstChild,"leaflet-routing-geocoder-selected"),delete this._selection},_keyDown:function(y){if(this._isOpen)switch(y.keyCode){case 27:this.close(),f.DomEvent.preventDefault(y);return;case 38:this._select(-1),f.DomEvent.preventDefault(y);return;case 40:this._select(1),f.DomEvent.preventDefault(y);return}},_complete:function(y,w){var i=this._elem.value;function C(P){this._lastCompletedText=i,w&&P.length===1?this._resultSelected(P[0])():this._setResults(P)}i&&(i!==this._lastCompletedText?y(i,C,this):w&&C.call(this,this._results))}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],49:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null,y=s("./itinerary"),w=s("./line"),i=s("./plan"),C=s("./osrm-v1");a.exports=y.extend({options:{fitSelectedRoutes:"smart",routeLine:function(P,D){return new w(P,D)},autoRoute:!0,routeWhileDragging:!1,routeDragInterval:500,waypointMode:"connect",showAlternatives:!1,defaultErrorHandler:function(P){console.error("Routing error:",P.error)}},initialize:function(P){f.Util.setOptions(this,P),this._router=this.options.router||new C(P),this._plan=this.options.plan||new i(this.options.waypoints,P),this._requestCount=0,y.prototype.initialize.call(this,P),this.on("routeselected",this._routeSelected,this),this.options.defaultErrorHandler&&this.on("routingerror",this.options.defaultErrorHandler),this._plan.on("waypointschanged",this._onWaypointsChanged,this),P.routeWhileDragging&&this._setupRouteDragging()},_onZoomEnd:function(){if(!(!this._selectedRoute||!this._router.requiresMoreDetail)){var P=this._map;this._router.requiresMoreDetail(this._selectedRoute,P.getZoom(),P.getBounds())&&this.route({callback:f.bind(function(D,$){var G;if(!D){for(G=0;G<$.length;G++)this._routes[G].properties=$[G].properties;this._updateLineCallback(D,$)}},this),simplifyGeometry:!1,geometryOnly:!0})}},onAdd:function(P){this.options.autoRoute&&this.route();var D=y.prototype.onAdd.call(this,P);return this._map=P,this._map.addLayer(this._plan),this._map.on("zoomend",this._onZoomEnd,this),this._plan.options.geocoder&&D.insertBefore(this._plan.createGeocoders(),D.firstChild),D},onRemove:function(P){if(P.off("zoomend",this._onZoomEnd,this),this._line&&P.removeLayer(this._line),P.removeLayer(this._plan),this._alternatives&&this._alternatives.length>0)for(var D=0,$=this._alternatives.length;D<$;D++)P.removeLayer(this._alternatives[D]);return y.prototype.onRemove.call(this,P)},getWaypoints:function(){return this._plan.getWaypoints()},setWaypoints:function(P){return this._plan.setWaypoints(P),this},spliceWaypoints:function(){var P=this._plan.spliceWaypoints.apply(this._plan,arguments);return P},getPlan:function(){return this._plan},getRouter:function(){return this._router},_routeSelected:function(P){var D=this._selectedRoute=P.route,$=this.options.showAlternatives&&P.alternatives,G=this.options.fitSelectedRoutes,X=G==="smart"&&!this._waypointsVisible()||G!=="smart"&&G;this._updateLines({route:D,alternatives:$}),X&&this._map.fitBounds(this._line.getBounds()),this.options.waypointMode==="snap"&&(this._plan.off("waypointschanged",this._onWaypointsChanged,this),this.setWaypoints(D.waypoints),this._plan.on("waypointschanged",this._onWaypointsChanged,this))},_waypointsVisible:function(){var P=this.getWaypoints(),D,$,G,X,te;try{for(D=this._map.getSize(),X=0;X<P.length;X++)te=this._map.latLngToLayerPoint(P[X].latLng),$?$.extend(te):$=f.bounds([te]);return G=$.getSize(),(G.x>D.x/5||G.y>D.y/5)&&this._waypointsInViewport()}catch{return!1}},_waypointsInViewport:function(){var P=this.getWaypoints(),D,$;try{D=this._map.getBounds()}catch{return!1}for($=0;$<P.length;$++)if(D.contains(P[$].latLng))return!0;return!1},_updateLines:function(P){var D=this.options.addWaypoints!==void 0?this.options.addWaypoints:!0;this._clearLines(),this._alternatives=[],P.alternatives&&P.alternatives.forEach(function($,G){this._alternatives[G]=this.options.routeLine($,f.extend({isAlternative:!0},this.options.altLineOptions||this.options.lineOptions)),this._alternatives[G].addTo(this._map),this._hookAltEvents(this._alternatives[G])},this),this._line=this.options.routeLine(P.route,f.extend({addWaypoints:D,extendToWaypoints:this.options.waypointMode==="connect"},this.options.lineOptions)),this._line.addTo(this._map),this._hookEvents(this._line)},_hookEvents:function(P){P.on("linetouched",function(D){this._plan.dragNewWaypoint(D)},this)},_hookAltEvents:function(P){P.on("linetouched",function(D){var $=this._routes.slice(),G=$.splice(D.target._route.routesIndex,1)[0];this.fire("routeselected",{route:G,alternatives:$})},this)},_onWaypointsChanged:function(P){this.options.autoRoute&&this.route({}),this._plan.isReady()||(this._clearLines(),this._clearAlts()),this.fire("waypointschanged",{waypoints:P.waypoints})},_setupRouteDragging:function(){var P=0,D;this._plan.on("waypointdrag",f.bind(function($){D=$.waypoints,P||(P=setTimeout(f.bind(function(){this.route({waypoints:D,geometryOnly:!0,callback:f.bind(this._updateLineCallback,this)}),P=void 0},this),this.options.routeDragInterval))},this)),this._plan.on("waypointdragend",function(){P&&(clearTimeout(P),P=void 0),this.route()},this)},_updateLineCallback:function(P,D){if(P)P.type!=="abort"&&this._clearLines();else{D=D.slice();var $=D.splice(this._selectedRoute.routesIndex,1)[0];this._updateLines({route:$,alternatives:this.options.showAlternatives?D:[]})}},route:function(P){var D=++this._requestCount,$;this._pendingRequest&&this._pendingRequest.abort&&(this._pendingRequest.abort(),this._pendingRequest=null),P=P||{},this._plan.isReady()&&(this.options.useZoomParameter&&(P.z=this._map&&this._map.getZoom()),$=P&&P.waypoints||this._plan.getWaypoints(),this.fire("routingstart",{waypoints:$}),this._pendingRequest=this._router.route($,function(G,X){if(this._pendingRequest=null,P.callback)return P.callback.call(this,G,X);if(D===this._requestCount){if(this._clearLines(),this._clearAlts(),G&&G.type!=="abort"){this.fire("routingerror",{error:G});return}if(X.forEach(function(le,re){le.routesIndex=re}),!P.geometryOnly)this.fire("routesfound",{waypoints:$,routes:X}),this.setAlternatives(X);else{var te=X.splice(0,1)[0];this._routeSelected({route:te,alternatives:X})}}},this,P))},_clearLines:function(){if(this._line&&(this._map.removeLayer(this._line),delete this._line),this._alternatives&&this._alternatives.length){for(var P in this._alternatives)this._map.removeLayer(this._alternatives[P]);this._alternatives=[]}}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./itinerary":55,"./line":56,"./osrm-v1":59,"./plan":60}],50:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null;a.exports=f.Control.extend({options:{header:"Routing error",formatMessage:function(y){return y.status<0?"Calculating the route caused an error. Technical description follows: <code><pre>"+y.message+"</pre></code":"The route could not be calculated. "+y.message}},initialize:function(y,w){f.Control.prototype.initialize.call(this,w),y.on("routingerror",f.bind(function(i){this._element&&(this._element.children[1].innerHTML=this.options.formatMessage(i.error),this._element.style.visibility="visible")},this)).on("routingstart",f.bind(function(){this._element&&(this._element.style.visibility="hidden")},this))},onAdd:function(){var y;return this._element=f.DomUtil.create("div","leaflet-bar leaflet-routing-error"),this._element.style.visibility="hidden",y=f.DomUtil.create("h3",null,this._element),f.DomUtil.create("span",null,this._element),y.innerHTML=this.options.header,this._element},onRemove:function(){delete this._element}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],51:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null,y=s("./localization");a.exports=f.Class.extend({options:{units:"metric",unitNames:null,language:"en",roundingSensitivity:1,distanceTemplate:"{value} {unit}"},initialize:function(w){f.setOptions(this,w);var i=f.Util.isArray(this.options.language)?this.options.language:[this.options.language,"en"];this._localization=new y(i)},formatDistance:function(w,i){var C=this.options.unitNames||this._localization.localize("units"),P=i<=0,D=P?function(te){return te}:f.bind(this._round,this),$,G,X;return this.options.units==="imperial"?(G=w/.9144,G>=1e3?X={value:D(w/1609.344,i),unit:C.miles}:X={value:D(G,i),unit:C.yards}):($=D(w,i),X={value:$>=1e3?$/1e3:$,unit:$>=1e3?C.kilometers:C.meters}),P&&(X.value=X.value.toFixed(-i)),f.Util.template(this.options.distanceTemplate,X)},_round:function(w,i){var C=i||this.options.roundingSensitivity,P=Math.pow(10,(Math.floor(w/C)+"").length-1),D=Math.floor(w/P),$=D>5?P:P/2;return Math.round(w/$)*$},formatTime:function(w){var i=this.options.unitNames||this._localization.localize("units");return w=Math.round(w/30)*30,w>86400?Math.round(w/3600)+" "+i.hours:w>3600?Math.floor(w/3600)+" "+i.hours+" "+Math.round(w%3600/60)+" "+i.minutes:w>300?Math.round(w/60)+" "+i.minutes:w>60?Math.floor(w/60)+" "+i.minutes+(w%60!==0?" "+w%60+" "+i.seconds:""):w+" "+i.seconds},formatInstruction:function(w,i){return w.text===void 0?this.capitalize(f.Util.template(this._getInstructionTemplate(w,i),f.extend({},w,{exitStr:w.exit?this._localization.localize("formatOrder")(w.exit):"",dir:this._localization.localize(["directions",w.direction]),modifier:this._localization.localize(["directions",w.modifier])}))):w.text},getIconName:function(w,i){switch(w.type){case"Head":if(i===0)return"depart";break;case"WaypointReached":return"via";case"Roundabout":return"enter-roundabout";case"DestinationReached":return"arrive"}switch(w.modifier){case"Straight":return"continue";case"SlightRight":return"bear-right";case"Right":return"turn-right";case"SharpRight":return"sharp-right";case"TurnAround":case"Uturn":return"u-turn";case"SharpLeft":return"sharp-left";case"Left":return"turn-left";case"SlightLeft":return"bear-left"}},capitalize:function(w){return w.charAt(0).toUpperCase()+w.substring(1)},_getInstructionTemplate:function(w,i){var C=w.type==="Straight"?i===0?"Head":"Continue":w.type,P=this._localization.localize(["instructions",C]);return P||(P=[this._localization.localize(["directions",C])," "+this._localization.localize(["instructions","Onto"])]),P[0]+(P.length>1&&w.road?P[1]:"")}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./localization":57}],52:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null,y=s("./autocomplete"),w=s("./localization");function i(C){C.setSelectionRange?C.setSelectionRange(0,9999):C.select()}a.exports=f.Class.extend({includes:typeof f.Evented<"u"&&f.Evented.prototype||f.Mixin.Events,options:{createGeocoder:function(C,P,D){var $=f.DomUtil.create("div","leaflet-routing-geocoder"),G=f.DomUtil.create("input","",$),X=D.addWaypoints?f.DomUtil.create("span","leaflet-routing-remove-waypoint",$):void 0;return G.disabled=!D.addWaypoints,{container:$,input:G,closeButton:X}},geocoderPlaceholder:function(C,P,D){var $=new w(D.options.language).localize("ui");return C===0?$.startPlaceholder:C<P-1?f.Util.template($.viaPlaceholder,{viaNumber:C}):$.endPlaceholder},geocoderClass:function(){return""},waypointNameFallback:function(C){var P=C.lat<0?"S":"N",D=C.lng<0?"W":"E",$=(Math.round(Math.abs(C.lat)*1e4)/1e4).toString(),G=(Math.round(Math.abs(C.lng)*1e4)/1e4).toString();return P+$+", "+D+G},maxGeocoderTolerance:200,autocompleteOptions:{},language:"en"},initialize:function(C,P,D,$){f.setOptions(this,$);var G=this.options.createGeocoder(P,D,this.options),X=G.closeButton,te=G.input;te.setAttribute("placeholder",this.options.geocoderPlaceholder(P,D,this)),te.className=this.options.geocoderClass(P,D),this._element=G,this._waypoint=C,this.update(),te.value=C.name,f.DomEvent.addListener(te,"click",function(){i(this)},te),X&&f.DomEvent.addListener(X,"click",function(){this.fire("delete",{waypoint:this._waypoint})},this),new y(te,function(le){te.value=le.name,C.name=le.name,C.latLng=le.center,this.fire("geocoded",{waypoint:C,value:le})},this,f.extend({resultFn:this.options.geocoder.geocode,resultContext:this.options.geocoder,autocompleteFn:this.options.geocoder.suggest,autocompleteContext:this.options.geocoder},this.options.autocompleteOptions))},getContainer:function(){return this._element.container},setValue:function(C){this._element.input.value=C},update:function(C){var P=this._waypoint,D;P.name=P.name||"",P.latLng&&(C||!P.name)&&(D=this.options.waypointNameFallback(P.latLng),this.options.geocoder&&this.options.geocoder.reverse?this.options.geocoder.reverse(P.latLng,67108864,function($){$.length>0&&$[0].center.distanceTo(P.latLng)<this.options.maxGeocoderTolerance?P.name=$[0].name:P.name=D,this._update()},this):(P.name=D,this._update()))},focus:function(){var C=this._element.input;C.focus(),i(C)},_update:function(){var C=this._waypoint,P=C&&C.name?C.name:"";this.setValue(P),this.fire("reversegeocoded",{waypoint:C,value:P})}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./autocomplete":48,"./localization":57}],53:[function(s,a,l){(function(u){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null,y=s("./control"),w=s("./itinerary"),i=s("./line"),C=s("./osrm-v1"),P=s("./plan"),D=s("./waypoint"),$=s("./autocomplete"),G=s("./formatter"),X=s("./geocoder-element"),te=s("./localization"),le=s("./itinerary-builder"),re=s("./mapbox"),fe=s("./error-control");f.routing={control:function(xe){return new y(xe)},itinerary:function(xe){return w(xe)},line:function(xe,be){return new i(xe,be)},plan:function(xe,be){return new P(xe,be)},waypoint:function(xe,be,Ne){return new D(xe,be,Ne)},osrmv1:function(xe){return new C(xe)},localization:function(xe){return new te(xe)},formatter:function(xe){return new G(xe)},geocoderElement:function(xe,be,Ne,Be){return new f.Routing.GeocoderElement(xe,be,Ne,Be)},itineraryBuilder:function(xe){return new le(xe)},mapbox:function(xe,be){return new re(xe,be)},errorControl:function(xe,be){return new fe(xe,be)},autocomplete:function(xe,be,Ne,Be){return new $(xe,be,Ne,Be)}},a.exports=f.Routing={Control:y,Itinerary:w,Line:i,OSRMv1:C,Plan:P,Waypoint:D,Autocomplete:$,Formatter:G,GeocoderElement:X,Localization:te,Formatter:G,ItineraryBuilder:le,control:f.routing.control,itinerary:f.routing.itinerary,line:f.routing.line,plan:f.routing.plan,waypoint:f.routing.waypoint,osrmv1:f.routing.osrmv1,geocoderElement:f.routing.geocoderElement,mapbox:f.routing.mapbox,errorControl:f.routing.errorControl}}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./autocomplete":48,"./control":49,"./error-control":50,"./formatter":51,"./geocoder-element":52,"./itinerary":55,"./itinerary-builder":54,"./line":56,"./localization":57,"./mapbox":58,"./osrm-v1":59,"./plan":60,"./waypoint":61}],54:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null;a.exports=f.Class.extend({options:{containerClassName:""},initialize:function(y){f.setOptions(this,y)},createContainer:function(y){var w=f.DomUtil.create("table",(y||"")+" "+this.options.containerClassName),i=f.DomUtil.create("colgroup","",w);return f.DomUtil.create("col","leaflet-routing-instruction-icon",i),f.DomUtil.create("col","leaflet-routing-instruction-text",i),f.DomUtil.create("col","leaflet-routing-instruction-distance",i),w},createStepsContainer:function(){return f.DomUtil.create("tbody","")},createStep:function(y,w,i,C){var P=f.DomUtil.create("tr","",C),D,$;return $=f.DomUtil.create("td","",P),D=f.DomUtil.create("span","leaflet-routing-icon leaflet-routing-icon-"+i,$),$.appendChild(D),$=f.DomUtil.create("td","",P),$.appendChild(document.createTextNode(y)),$=f.DomUtil.create("td","",P),$.appendChild(document.createTextNode(w)),P}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],55:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null,y=s("./formatter"),w=s("./itinerary-builder");a.exports=f.Control.extend({includes:typeof f.Evented<"u"&&f.Evented.prototype||f.Mixin.Events,options:{pointMarkerStyle:{radius:5,color:"#03f",fillColor:"white",opacity:1,fillOpacity:.7},summaryTemplate:"<h2>{name}</h2><h3>{distance}, {time}</h3>",timeTemplate:"{time}",containerClassName:"",alternativeClassName:"",minimizedClassName:"",itineraryClassName:"",totalDistanceRoundingSensitivity:-1,show:!0,collapsible:void 0,collapseBtn:function(i){var C=f.DomUtil.create("span",i.options.collapseBtnClass);f.DomEvent.on(C,"click",i._toggle,i),i._container.insertBefore(C,i._container.firstChild)},collapseBtnClass:"leaflet-routing-collapse-btn"},initialize:function(i){f.setOptions(this,i),this._formatter=this.options.formatter||new y(this.options),this._itineraryBuilder=this.options.itineraryBuilder||new w({containerClassName:this.options.itineraryClassName})},onAdd:function(i){var C=this.options.collapsible;return C=C||C===void 0&&i.getSize().x<=640,this._container=f.DomUtil.create("div","leaflet-routing-container leaflet-bar "+(this.options.show?"":"leaflet-routing-container-hide ")+(C?"leaflet-routing-collapsible ":"")+this.options.containerClassName),this._altContainer=this.createAlternativesContainer(),this._container.appendChild(this._altContainer),f.DomEvent.disableClickPropagation(this._container),f.DomEvent.addListener(this._container,"mousewheel",function(P){f.DomEvent.stopPropagation(P)}),C&&this.options.collapseBtn(this),this._container},onRemove:function(){},createAlternativesContainer:function(){return f.DomUtil.create("div","leaflet-routing-alternatives-container")},setAlternatives:function(i){var C,P,D;for(this._clearAlts(),this._routes=i,C=0;C<this._routes.length;C++)P=this._routes[C],D=this._createAlternative(P,C),this._altContainer.appendChild(D),this._altElements.push(D);return this._selectRoute({route:this._routes[0],alternatives:this._routes.slice(1)}),this},show:function(){f.DomUtil.removeClass(this._container,"leaflet-routing-container-hide")},hide:function(){f.DomUtil.addClass(this._container,"leaflet-routing-container-hide")},_toggle:function(){var i=f.DomUtil.hasClass(this._container,"leaflet-routing-container-hide");this[i?"show":"hide"]()},_createAlternative:function(i,C){var P=f.DomUtil.create("div","leaflet-routing-alt "+this.options.alternativeClassName+(C>0?" leaflet-routing-alt-minimized "+this.options.minimizedClassName:"")),D=this.options.summaryTemplate,$=f.extend({name:i.name,distance:this._formatter.formatDistance(i.summary.totalDistance,this.options.totalDistanceRoundingSensitivity),time:this._formatter.formatTime(i.summary.totalTime)},i);return P.innerHTML=typeof D=="function"?D($):f.Util.template(D,$),f.DomEvent.addListener(P,"click",this._onAltClicked,this),this.on("routeselected",this._selectAlt,this),P.appendChild(this._createItineraryContainer(i)),P},_clearAlts:function(){for(var i=this._altContainer;i&&i.firstChild;)i.removeChild(i.firstChild);this._altElements=[]},_createItineraryContainer:function(i){var C=this._itineraryBuilder.createContainer(),P=this._itineraryBuilder.createStepsContainer(),D,$,G,X,te,le;for(C.appendChild(P),D=0;D<i.instructions.length;D++)$=i.instructions[D],te=this._formatter.formatInstruction($,D),X=this._formatter.formatDistance($.distance),le=this._formatter.getIconName($,D),G=this._itineraryBuilder.createStep(te,X,le,P),$.index&&this._addRowListeners(G,i.coordinates[$.index]);return C},_addRowListeners:function(i,C){f.DomEvent.addListener(i,"mouseover",function(){this._marker=f.circleMarker(C,this.options.pointMarkerStyle).addTo(this._map)},this),f.DomEvent.addListener(i,"mouseout",function(){this._marker&&(this._map.removeLayer(this._marker),delete this._marker)},this),f.DomEvent.addListener(i,"click",function(P){this._map.panTo(C),f.DomEvent.stopPropagation(P)},this)},_onAltClicked:function(i){for(var C=i.target||window.event.srcElement;!f.DomUtil.hasClass(C,"leaflet-routing-alt");)C=C.parentElement;var P=this._altElements.indexOf(C),D=this._routes.slice(),$=D.splice(P,1)[0];this.fire("routeselected",{route:$,alternatives:D})},_selectAlt:function(i){var C,P,D,$;if(C=this._altElements[i.route.routesIndex],f.DomUtil.hasClass(C,"leaflet-routing-alt-minimized"))for(P=0;P<this._altElements.length;P++)D=this._altElements[P],$=P===i.route.routesIndex?"removeClass":"addClass",f.DomUtil[$](D,"leaflet-routing-alt-minimized"),this.options.minimizedClassName&&f.DomUtil[$](D,this.options.minimizedClassName),P!==i.route.routesIndex&&(D.scrollTop=0);f.DomEvent.stop(i)},_selectRoute:function(i){this._marker&&(this._map.removeLayer(this._marker),delete this._marker),this.fire("routeselected",i)}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./formatter":51,"./itinerary-builder":54}],56:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null;a.exports=f.LayerGroup.extend({includes:typeof f.Evented<"u"&&f.Evented.prototype||f.Mixin.Events,options:{styles:[{color:"black",opacity:.15,weight:9},{color:"white",opacity:.8,weight:6},{color:"red",opacity:1,weight:2}],missingRouteStyles:[{color:"black",opacity:.15,weight:7},{color:"white",opacity:.6,weight:4},{color:"gray",opacity:.8,weight:2,dashArray:"7,12"}],addWaypoints:!0,extendToWaypoints:!0,missingRouteTolerance:10},initialize:function(y,w){f.setOptions(this,w),f.LayerGroup.prototype.initialize.call(this,w),this._route=y,this.options.extendToWaypoints&&this._extendToWaypoints(),this._addSegment(y.coordinates,this.options.styles,this.options.addWaypoints)},getBounds:function(){return f.latLngBounds(this._route.coordinates)},_findWaypointIndices:function(){var y=this._route.inputWaypoints,w=[],i;for(i=0;i<y.length;i++)w.push(this._findClosestRoutePoint(y[i].latLng));return w},_findClosestRoutePoint:function(y){var w=Number.MAX_VALUE,i,C,P;for(C=this._route.coordinates.length-1;C>=0;C--)P=y.distanceTo(this._route.coordinates[C]),P<w&&(i=C,w=P);return i},_extendToWaypoints:function(){var y=this._route.inputWaypoints,w=this._getWaypointIndices(),i,C,P;for(i=0;i<y.length;i++)C=y[i].latLng,P=f.latLng(this._route.coordinates[w[i]]),C.distanceTo(P)>this.options.missingRouteTolerance&&this._addSegment([C,P],this.options.missingRouteStyles)},_addSegment:function(y,w,i){var C,P;for(C=0;C<w.length;C++)P=f.polyline(y,w[C]),this.addLayer(P),i&&P.on("mousedown",this._onLineTouched,this)},_findNearestWpBefore:function(y){for(var w=this._getWaypointIndices(),i=w.length-1;i>=0&&w[i]>y;)i--;return i},_onLineTouched:function(y){var w=this._findNearestWpBefore(this._findClosestRoutePoint(y.latlng));this.fire("linetouched",{afterIndex:w,latlng:y.latlng}),f.DomEvent.stop(y)},_getWaypointIndices:function(){return this._wpIndices||(this._wpIndices=this._route.waypointIndices||this._findWaypointIndices()),this._wpIndices}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],57:[function(s,a,l){(function(){var u={directions:{N:"norte",NE:"noreste",E:"este",SE:"sureste",S:"sur",SW:"suroeste",W:"oeste",NW:"noroeste",SlightRight:"leve giro a la derecha",Right:"derecha",SharpRight:"giro pronunciado a la derecha",SlightLeft:"leve giro a la izquierda",Left:"izquierda",SharpLeft:"giro pronunciado a la izquierda",Uturn:"media vuelta"},instructions:{Head:["Derecho {dir}"," sobre {road}"],Continue:["Continuar {dir}"," en {road}"],TurnAround:["Dar vuelta"],WaypointReached:["Lleg a un punto del camino"],Roundabout:["Tomar {exitStr} salida en la rotonda"," en {road}"],DestinationReached:["Llegada a destino"],Fork:["En el cruce gira a {modifier}"," hacia {road}"],Merge:["Incorprate {modifier}"," hacia {road}"],OnRamp:["Gira {modifier} en la salida"," hacia {road}"],OffRamp:["Toma la salida {modifier}"," hacia {road}"],EndOfRoad:["Gira {modifier} al final de la carretera"," hacia {road}"],Onto:"hacia {road}"},formatOrder:function(y){return y+""},ui:{startPlaceholder:"Inicio",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Destino"},units:{meters:"m",kilometers:"km",yards:"yd",miles:"mi",hours:"h",minutes:"min",seconds:"s"}};L.Routing=L.Routing||{};var f=L.Class.extend({initialize:function(y){this._langs=L.Util.isArray(y)?y.slice():[y,"en"];for(var w=0,i=this._langs.length;w<i;w++){var C=/([A-Za-z]+)/.exec(this._langs[w])[1];if(!f[this._langs[w]])if(f[C])this._langs[w]=C;else throw new Error('No localization for language "'+this._langs[w]+'".')}},localize:function(y){var w,i,C;y=L.Util.isArray(y)?y:[y];for(var P=0,D=this._langs.length;P<D;P++){w=f[this._langs[P]];for(var $=0,G=y.length;w&&$<G;$++)i=y[$],C=w[i],w=C;if(C)return C}}});a.exports=L.extend(f,{en:{directions:{N:"north",NE:"northeast",E:"east",SE:"southeast",S:"south",SW:"southwest",W:"west",NW:"northwest",SlightRight:"slight right",Right:"right",SharpRight:"sharp right",SlightLeft:"slight left",Left:"left",SharpLeft:"sharp left",Uturn:"Turn around"},instructions:{Head:["Head {dir}"," on {road}"],Continue:["Continue {dir}"],TurnAround:["Turn around"],WaypointReached:["Waypoint reached"],Roundabout:["Take the {exitStr} exit in the roundabout"," onto {road}"],DestinationReached:["Destination reached"],Fork:["At the fork, turn {modifier}"," onto {road}"],Merge:["Merge {modifier}"," onto {road}"],OnRamp:["Turn {modifier} on the ramp"," onto {road}"],OffRamp:["Take the ramp on the {modifier}"," onto {road}"],EndOfRoad:["Turn {modifier} at the end of the road"," onto {road}"],Onto:"onto {road}"},formatOrder:function(y){var w=y%10-1,i=["st","nd","rd"];return i[w]?y+i[w]:y+"th"},ui:{startPlaceholder:"Start",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"End"},units:{meters:"m",kilometers:"km",yards:"yd",miles:"mi",hours:"h",minutes:"min",seconds:"s"}},de:{directions:{N:"Norden",NE:"Nordosten",E:"Osten",SE:"Sdosten",S:"Sden",SW:"Sdwesten",W:"Westen",NW:"Nordwesten",SlightRight:"leicht rechts",Right:"rechts",SharpRight:"scharf rechts",SlightLeft:"leicht links",Left:"links",SharpLeft:"scharf links",Uturn:"Wenden"},instructions:{Head:["Richtung {dir}"," auf {road}"],Continue:["Geradeaus Richtung {dir}"," auf {road}"],SlightRight:["Leicht rechts abbiegen"," auf {road}"],Right:["Rechts abbiegen"," auf {road}"],SharpRight:["Scharf rechts abbiegen"," auf {road}"],TurnAround:["Wenden"],SharpLeft:["Scharf links abbiegen"," auf {road}"],Left:["Links abbiegen"," auf {road}"],SlightLeft:["Leicht links abbiegen"," auf {road}"],WaypointReached:["Zwischenhalt erreicht"],Roundabout:["Nehmen Sie die {exitStr} Ausfahrt im Kreisverkehr"," auf {road}"],DestinationReached:["Sie haben ihr Ziel erreicht"],Fork:["An der Kreuzung {modifier}"," auf {road}"],Merge:["Fahren Sie {modifier} weiter"," auf {road}"],OnRamp:["Fahren Sie {modifier} auf die Auffahrt"," auf {road}"],OffRamp:["Nehmen Sie die Ausfahrt {modifier}"," auf {road}"],EndOfRoad:["Fahren Sie {modifier} am Ende der Strae"," auf {road}"],Onto:"auf {road}"},formatOrder:function(y){return y+"."},ui:{startPlaceholder:"Start",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Ziel"}},sv:{directions:{N:"norr",NE:"nordost",E:"st",SE:"sydost",S:"syd",SW:"sydvst",W:"vst",NW:"nordvst",SlightRight:"svagt hger",Right:"hger",SharpRight:"skarpt hger",SlightLeft:"svagt vnster",Left:"vnster",SharpLeft:"skarpt vnster",Uturn:"Vnd"},instructions:{Head:["k t {dir}"," till {road}"],Continue:["Fortstt {dir}"],SlightRight:["Svagt hger"," till {road}"],Right:["Svng hger"," till {road}"],SharpRight:["Skarpt hger"," till {road}"],TurnAround:["Vnd"],SharpLeft:["Skarpt vnster"," till {road}"],Left:["Svng vnster"," till {road}"],SlightLeft:["Svagt vnster"," till {road}"],WaypointReached:["Viapunkt ndd"],Roundabout:["Tag {exitStr} avfarten i rondellen"," till {road}"],DestinationReached:["Framme vid resans ml"],Fork:["Tag av {modifier}"," till {road}"],Merge:["Anslut {modifier} "," till {road}"],OnRamp:["Tag pfarten {modifier}"," till {road}"],OffRamp:["Tag avfarten {modifier}"," till {road}"],EndOfRoad:["Svng {modifier} vid vgens slut"," till {road}"],Onto:"till {road}"},formatOrder:function(y){return["frsta","andra","tredje","fjrde","femte","sjtte","sjunde","ttonde","nionde","tionde"][y-1]},ui:{startPlaceholder:"Frn",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Till"}},es:u,sp:u,nl:{directions:{N:"noordelijke",NE:"noordoostelijke",E:"oostelijke",SE:"zuidoostelijke",S:"zuidelijke",SW:"zuidewestelijke",W:"westelijke",NW:"noordwestelijke"},instructions:{Head:["Vertrek in {dir} richting"," de {road} op"],Continue:["Ga in {dir} richting"," de {road} op"],SlightRight:["Volg de weg naar rechts"," de {road} op"],Right:["Ga rechtsaf"," de {road} op"],SharpRight:["Ga scherpe bocht naar rechts"," de {road} op"],TurnAround:["Keer om"],SharpLeft:["Ga scherpe bocht naar links"," de {road} op"],Left:["Ga linksaf"," de {road} op"],SlightLeft:["Volg de weg naar links"," de {road} op"],WaypointReached:["Aangekomen bij tussenpunt"],Roundabout:["Neem de {exitStr} afslag op de rotonde"," de {road} op"],DestinationReached:["Aangekomen op eindpunt"]},formatOrder:function(y){return y===1||y>=20?y+"ste":y+"de"},ui:{startPlaceholder:"Vertrekpunt",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Bestemming"}},fr:{directions:{N:"nord",NE:"nord-est",E:"est",SE:"sud-est",S:"sud",SW:"sud-ouest",W:"ouest",NW:"nord-ouest"},instructions:{Head:["Tout droit au {dir}"," sur {road}"],Continue:["Continuer au {dir}"," sur {road}"],SlightRight:["Lgrement  droite"," sur {road}"],Right:["A droite"," sur {road}"],SharpRight:["Compltement  droite"," sur {road}"],TurnAround:["Faire demi-tour"],SharpLeft:["Compltement  gauche"," sur {road}"],Left:["A gauche"," sur {road}"],SlightLeft:["Lgrement  gauche"," sur {road}"],WaypointReached:["Point d'tape atteint"],Roundabout:["Au rond-point, prenez la {exitStr} sortie"," sur {road}"],DestinationReached:["Destination atteinte"]},formatOrder:function(y){return y+""},ui:{startPlaceholder:"Dpart",viaPlaceholder:"Intermdiaire {viaNumber}",endPlaceholder:"Arrive"}},it:{directions:{N:"nord",NE:"nord-est",E:"est",SE:"sud-est",S:"sud",SW:"sud-ovest",W:"ovest",NW:"nord-ovest"},instructions:{Head:["Dritto verso {dir}"," su {road}"],Continue:["Continuare verso {dir}"," su {road}"],SlightRight:["Mantenere la destra"," su {road}"],Right:["A destra"," su {road}"],SharpRight:["Strettamente a destra"," su {road}"],TurnAround:["Fare inversione di marcia"],SharpLeft:["Strettamente a sinistra"," su {road}"],Left:["A sinistra"," sur {road}"],SlightLeft:["Mantenere la sinistra"," su {road}"],WaypointReached:["Punto di passaggio raggiunto"],Roundabout:["Alla rotonda, prendere la {exitStr} uscita"],DestinationReached:["Destinazione raggiunta"]},formatOrder:function(y){return y+""},ui:{startPlaceholder:"Partenza",viaPlaceholder:"Intermedia {viaNumber}",endPlaceholder:"Destinazione"}},pt:{directions:{N:"norte",NE:"nordeste",E:"leste",SE:"sudeste",S:"sul",SW:"sudoeste",W:"oeste",NW:"noroeste",SlightRight:"curva ligeira a direita",Right:"direita",SharpRight:"curva fechada a direita",SlightLeft:"ligeira a esquerda",Left:"esquerda",SharpLeft:"curva fechada a esquerda",Uturn:"Meia volta"},instructions:{Head:["Siga {dir}"," na {road}"],Continue:["Continue {dir}"," na {road}"],SlightRight:["Curva ligeira a direita"," na {road}"],Right:["Curva a direita"," na {road}"],SharpRight:["Curva fechada a direita"," na {road}"],TurnAround:["Retorne"],SharpLeft:["Curva fechada a esquerda"," na {road}"],Left:["Curva a esquerda"," na {road}"],SlightLeft:["Curva ligueira a esquerda"," na {road}"],WaypointReached:["Ponto de interesse atingido"],Roundabout:["Pegue a {exitStr} sada na rotatria"," na {road}"],DestinationReached:["Destino atingido"],Fork:["Na encruzilhada, vire a {modifier}"," na {road}"],Merge:["Entre  {modifier}"," na {road}"],OnRamp:["Vire {modifier} na rampa"," na {road}"],OffRamp:["Entre na rampa na {modifier}"," na {road}"],EndOfRoad:["Vire {modifier} no fim da rua"," na {road}"],Onto:"na {road}"},formatOrder:function(y){return y+""},ui:{startPlaceholder:"Origem",viaPlaceholder:"Intermdio {viaNumber}",endPlaceholder:"Destino"}},sk:{directions:{N:"sever",NE:"serverovchod",E:"vchod",SE:"juhovchod",S:"juh",SW:"juhozpad",W:"zpad",NW:"serverozpad"},instructions:{Head:["Mierte na {dir}"," na {road}"],Continue:["Pokraujte na {dir}"," na {road}"],SlightRight:["Mierne doprava"," na {road}"],Right:["Doprava"," na {road}"],SharpRight:["Prudko doprava"," na {road}"],TurnAround:["Otote sa"],SharpLeft:["Prudko doava"," na {road}"],Left:["Doava"," na {road}"],SlightLeft:["Mierne doava"," na {road}"],WaypointReached:["Ste v prejazdovom bode."],Roundabout:["Odbote na {exitStr} vjazde"," na {road}"],DestinationReached:["Prili ste do ciea."]},formatOrder:function(y){var w=y%10-1,i=[".",".","."];return i[w]?y+i[w]:y+"."},ui:{startPlaceholder:"Zaiatok",viaPlaceholder:"Cez {viaNumber}",endPlaceholder:"Koniec"}},el:{directions:{N:"",NE:"",E:"",SE:"",S:"",SW:"",W:"",NW:""},instructions:{Head:[" {dir}","  {road}"],Continue:[" {dir}","  {road}"],SlightRight:[" ","  {road}"],Right:["","  {road}"],SharpRight:["  ","  {road}"],TurnAround:[" "],SharpLeft:["  ","  {road}"],Left:["","  {road}"],SlightLeft:[" ","  {road}"],WaypointReached:["   "],Roundabout:["  {exitStr}    ","  {road}"],DestinationReached:["   "]},formatOrder:function(y){return y+""},ui:{startPlaceholder:"",viaPlaceholder:" {viaNumber}",endPlaceholder:""}},ca:{directions:{N:"nord",NE:"nord-est",E:"est",SE:"sud-est",S:"sud",SW:"sud-oest",W:"oest",NW:"nord-oest",SlightRight:"lleu gir a la dreta",Right:"dreta",SharpRight:"gir pronunciat a la dreta",SlightLeft:"gir pronunciat a l'esquerra",Left:"esquerra",SharpLeft:"lleu gir a l'esquerra",Uturn:"mitja volta"},instructions:{Head:["Recte {dir}"," sobre {road}"],Continue:["Continuar {dir}"],TurnAround:["Donar la volta"],WaypointReached:["Ha arribat a un punt del cam"],Roundabout:["Agafar {exitStr} sortida a la rotonda"," a {road}"],DestinationReached:["Arribada al dest"],Fork:["A la crulla gira a la {modifier}"," cap a {road}"],Merge:["Incorpora't {modifier}"," a {road}"],OnRamp:["Gira {modifier} a la sortida"," cap a {road}"],OffRamp:["Pren la sortida {modifier}"," cap a {road}"],EndOfRoad:["Gira {modifier} al final de la carretera"," cap a {road}"],Onto:"cap a {road}"},formatOrder:function(y){return y+""},ui:{startPlaceholder:"Origen",viaPlaceholder:"Via {viaNumber}",endPlaceholder:"Dest"},units:{meters:"m",kilometers:"km",yards:"yd",miles:"mi",hours:"h",minutes:"min",seconds:"s"}},ru:{directions:{N:"",NE:"",E:"",SE:"",S:"",SW:"",W:"",NW:"",SlightRight:" ",Right:"",SharpRight:" ",SlightLeft:" ",Left:"",SharpLeft:" ",Uturn:""},instructions:{Head:["   {dir}","  {road}"],Continue:["   {dir}","  {road}"],SlightRight:["  ","  {road}"],Right:["","  {road}"],SharpRight:["  ","  {road}"],TurnAround:[""],SharpLeft:["  ","  {road}"],Left:[" ","  {road}"],SlightLeft:["  ","  {road}"],WaypointReached:[" "],Roundabout:["{exitStr}   ","  {road}"],DestinationReached:[" "],Fork:["   {modifier}","  {road}"],Merge:[" {modifier}","  {road}"],OnRamp:[" {modifier}  ","  {road}"],OffRamp:["  {modifier}","  {road}"],EndOfRoad:[" {modifier}   ","  {road}"],Onto:" {road}"},formatOrder:function(y){return y+"-"},ui:{startPlaceholder:"",viaPlaceholder:" {viaNumber}",endPlaceholder:""},units:{meters:"",kilometers:"",yards:"",miles:"",hours:"",minutes:"",seconds:""}},pl:{directions:{N:"pnoc",NE:"pnocny wschd",E:"wschd",SE:"poudniowy wschd",S:"poudnie",SW:"poudniowy zachd",W:"zachd",NW:"pnocny zachd",SlightRight:"lekko w prawo",Right:"w prawo",SharpRight:"ostro w prawo",SlightLeft:"lekko w lewo",Left:"w lewo",SharpLeft:"ostro w lewo",Uturn:"zawr"},instructions:{Head:["Kieruj si na {dir}"," na {road}"],Continue:["Jed dalej przez {dir}"],TurnAround:["Zawr"],WaypointReached:["Punkt poredni"],Roundabout:["Wyjed {exitStr} zjazdem na rondzie"," na {road}"],DestinationReached:["Dojechano do miejsca docelowego"],Fork:["Na rozwidleniu {modifier}"," na {road}"],Merge:["Zjed {modifier}"," na {road}"],OnRamp:["Wjazd {modifier}"," na {road}"],OffRamp:["Zjazd {modifier}"," na {road}"],EndOfRoad:["Skr {modifier} na kocu drogi"," na {road}"],Onto:"na {road}"},formatOrder:function(y){return y+"."},ui:{startPlaceholder:"Pocztek",viaPlaceholder:"Przez {viaNumber}",endPlaceholder:"Koniec"},units:{meters:"m",kilometers:"km",yards:"yd",miles:"mi",hours:"godz",minutes:"min",seconds:"s"}}})})()},{}],58:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null,y=s("./osrm-v1");a.exports=y.extend({options:{serviceUrl:"https://api.mapbox.com/directions/v5",profile:"mapbox/driving",useHints:!1},initialize:function(w,i){f.Routing.OSRMv1.prototype.initialize.call(this,i),this.options.requestParameters=this.options.requestParameters||{},this.options.requestParameters.access_token=w}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./osrm-v1":59}],59:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null,y=s("@mapbox/corslite"),w=s("@mapbox/polyline"),i=s("osrm-text-instructions")("v5"),C=s("./waypoint");a.exports=f.Class.extend({options:{serviceUrl:"https://router.project-osrm.org/route/v1",profile:"driving",timeout:30*1e3,routingOptions:{alternatives:!0,steps:!0},polylinePrecision:5,useHints:!0,suppressDemoServerWarning:!1,language:"en"},initialize:function(P){f.Util.setOptions(this,P),this._hints={locations:{}},!this.options.suppressDemoServerWarning&&this.options.serviceUrl.indexOf("//router.project-osrm.org")>=0&&console.warn(`You are using OSRM's demo server. Please note that it is **NOT SUITABLE FOR PRODUCTION USE**.
Refer to the demo server's usage policy: https://github.com/Project-OSRM/osrm-backend/wiki/Api-usage-policy

To change, set the serviceUrl option.

Please do not report issues with this server to neither Leaflet Routing Machine or OSRM - it's for
demo only, and will sometimes not be available, or work in unexpected ways.

Please set up your own OSRM server, or use a paid service provider for production.`)},route:function(P,D,$,G){var X=!1,te=[],le,re,fe,xe,be;for(G=f.extend({},this.options.routingOptions,G),le=this.buildRouteUrl(P,G),this.options.requestParameters&&(le+=f.Util.getParamString(this.options.requestParameters,le)),re=setTimeout(function(){X=!0,D.call($||D,{status:-1,message:"OSRM request timed out."})},this.options.timeout),xe=0;xe<P.length;xe++)fe=P[xe],te.push(new C(fe.latLng,fe.name,fe.options));return be=y(le,f.bind(function(Ne,Be){var Ee,et={};if(clearTimeout(re),X)be.abort();else{if(Ne)et.message="HTTP request failed: "+Ne.type+(Ne.target&&Ne.target.status?" HTTP "+Ne.target.status+": "+Ne.target.statusText:""),et.url=le,et.status=-1,et.target=Ne;else try{Ee=JSON.parse(Be.responseText);try{return this._routeDone(Ee,te,G,D,$)}catch(at){et.status=-3,et.message=at.toString()}}catch(at){et.status=-2,et.message="Error parsing OSRM response: "+at.toString()}D.call($||D,et)}},this))},requiresMoreDetail:function(P,D,$){if(!P.properties.isSimplified)return!1;var G=P.inputWaypoints,X;for(X=0;X<G.length;++X)if(!$.contains(G[X].latLng))return!0;return!1},_routeDone:function(P,D,$,G,X){var te=[],le,re,fe;if(X=X||G,P.code!=="Ok"){G.call(X,{status:P.code});return}for(le=this._toWaypoints(D,P.waypoints),re=0;re<P.routes.length;re++)fe=this._convertRoute(P.routes[re]),fe.inputWaypoints=D,fe.waypoints=le,fe.properties={isSimplified:!$||!$.geometryOnly||$.simplifyGeometry},te.push(fe);this._saveHintData(P.waypoints,D),G.call(X,null,te)},_convertRoute:function(P){var D={name:"",coordinates:[],instructions:[],summary:{totalDistance:P.distance,totalTime:P.duration}},$=[],G=[],X=0,te=P.legs.length,le=P.legs[0].steps.length>0,re,fe,xe,be,Ne,Be,Ee,et,at;for(this.options.stepToText?at=this.options.stepToText:at=f.bind(i.compile,i,this.options.language),re=0;re<te;re++)for(xe=P.legs[re],$.push(xe.summary&&xe.summary.charAt(0).toUpperCase()+xe.summary.substring(1)),fe=0;fe<xe.steps.length;fe++)be=xe.steps[fe],Ne=this._decodePolyline(be.geometry),D.coordinates.push.apply(D.coordinates,Ne),Be=this._maneuverToInstructionType(be.maneuver,re===te-1),Ee=this._maneuverToModifier(be.maneuver),et=at(be,{legCount:te,legIndex:re}),Be&&((re==0&&be.maneuver.type=="depart"||be.maneuver.type=="arrive")&&G.push(X),D.instructions.push({type:Be,distance:be.distance,time:be.duration,road:be.name,direction:this._bearingToDirection(be.maneuver.bearing_after),exit:be.maneuver.exit,index:X,mode:be.mode,modifier:Ee,text:et})),X+=Ne.length;return D.name=$.join(", "),le?D.waypointIndices=G:D.coordinates=this._decodePolyline(P.geometry),D},_bearingToDirection:function(P){var D=Math.round(P/45)%8;return["N","NE","E","SE","S","SW","W","NW"][D]},_maneuverToInstructionType:function(P,D){switch(P.type){case"new name":return"Continue";case"depart":return"Head";case"arrive":return D?"DestinationReached":"WaypointReached";case"roundabout":case"rotary":return"Roundabout";case"merge":case"fork":case"on ramp":case"off ramp":case"end of road":return this._camelCase(P.type);default:return this._camelCase(P.modifier)}},_maneuverToModifier:function(P){var D=P.modifier;switch(P.type){case"merge":case"fork":case"on ramp":case"off ramp":case"end of road":D=this._leftOrRight(D)}return D&&this._camelCase(D)},_camelCase:function(P){for(var D=P.split(" "),$="",G=0,X=D.length;G<X;G++)$+=D[G].charAt(0).toUpperCase()+D[G].substring(1);return $},_leftOrRight:function(P){return P.indexOf("left")>=0?"Left":"Right"},_decodePolyline:function(P){var D=w.decode(P,this.options.polylinePrecision),$=new Array(D.length),G;for(G=D.length-1;G>=0;G--)$[G]=f.latLng(D[G]);return $},_toWaypoints:function(P,D){var $=[],G,X;for(G=0;G<D.length;G++)X=D[G].location,$.push(new C(f.latLng(X[1],X[0]),P[G].name,P[G].options));return $},buildRouteUrl:function(P,D){for(var $=[],G=[],X,te,le,re=!0,fe=0;fe<P.length;fe++)X=P[fe],te=X.latLng,$.push(te.lng+","+te.lat),G.push(this._hints.locations[this._locationKey(te)]||"");return le=!0,this.options.serviceUrl+"/"+this.options.profile+"/"+$.join(";")+"?"+(D.geometryOnly?D.simplifyGeometry?"":"overview=full":"overview=false")+"&alternatives="+re.toString()+"&steps="+le.toString()+(this.options.useHints?"&hints="+G.join(";"):"")+(D.allowUTurns?"&continue_straight="+!D.allowUTurns:"")},_locationKey:function(P){return P.lat+","+P.lng},_saveHintData:function(P,D){var $;this._hints={locations:{}};for(var G=P.length-1;G>=0;G--)$=D[G].latLng,this._hints.locations[this._locationKey($)]=P[G].hint}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./waypoint":61,"@mapbox/corslite":1,"@mapbox/polyline":2,"osrm-text-instructions":3}],60:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null,y=s("./geocoder-element"),w=s("./waypoint");a.exports=(f.Layer||f.Class).extend({includes:typeof f.Evented<"u"&&f.Evented.prototype||f.Mixin.Events,options:{dragStyles:[{color:"black",opacity:.15,weight:9},{color:"white",opacity:.8,weight:6},{color:"red",opacity:1,weight:2,dashArray:"7,12"}],draggableWaypoints:!0,routeWhileDragging:!1,addWaypoints:!0,reverseWaypoints:!1,addButtonClassName:"",language:"en",createGeocoderElement:function(i,C,P,D){return new y(i,C,P,D)},createMarker:function(i,C){var P={draggable:this.draggableWaypoints},D=f.marker(C.latLng,P);return D},geocodersClassName:""},initialize:function(i,C){f.Util.setOptions(this,C),this._waypoints=[],this.setWaypoints(i)},isReady:function(){var i;for(i=0;i<this._waypoints.length;i++)if(!this._waypoints[i].latLng)return!1;return!0},getWaypoints:function(){var i,C=[];for(i=0;i<this._waypoints.length;i++)C.push(this._waypoints[i]);return C},setWaypoints:function(i){var C=[0,this._waypoints.length].concat(i);return this.spliceWaypoints.apply(this,C),this},spliceWaypoints:function(){var i=[arguments[0],arguments[1]],C;for(C=2;C<arguments.length;C++)i.push(arguments[C]&&arguments[C].hasOwnProperty("latLng")?arguments[C]:new w(arguments[C]));for([].splice.apply(this._waypoints,i);this._waypoints.length<2;)this.spliceWaypoints(this._waypoints.length,0,null);this._updateMarkers(),this._fireChanged.apply(this,i)},onAdd:function(i){this._map=i,this._updateMarkers()},onRemove:function(){var i;if(this._removeMarkers(),this._newWp)for(i=0;i<this._newWp.lines.length;i++)this._map.removeLayer(this._newWp.lines[i]);delete this._map},createGeocoders:function(){var i=f.DomUtil.create("div","leaflet-routing-geocoders "+this.options.geocodersClassName),C=this._waypoints,P,D;return this._geocoderContainer=i,this._geocoderElems=[],this.options.addWaypoints&&(P=f.DomUtil.create("button","leaflet-routing-add-waypoint "+this.options.addButtonClassName,i),P.setAttribute("type","button"),f.DomEvent.addListener(P,"click",function(){this.spliceWaypoints(C.length,0,null)},this)),this.options.reverseWaypoints&&(D=f.DomUtil.create("button","leaflet-routing-reverse-waypoints",i),D.setAttribute("type","button"),f.DomEvent.addListener(D,"click",function(){this._waypoints.reverse(),this.setWaypoints(this._waypoints)},this)),this._updateGeocoders(),this.on("waypointsspliced",this._updateGeocoders),i},_createGeocoder:function(i){var C=this.options.createGeocoderElement(this._waypoints[i],i,this._waypoints.length,this.options);return C.on("delete",function(){i>0||this._waypoints.length>2?this.spliceWaypoints(i,1):this.spliceWaypoints(i,1,new w)},this).on("geocoded",function(P){this._updateMarkers(),this._fireChanged(),this._focusGeocoder(i+1),this.fire("waypointgeocoded",{waypointIndex:i,waypoint:P.waypoint})},this).on("reversegeocoded",function(P){this.fire("waypointgeocoded",{waypointIndex:i,waypoint:P.waypoint})},this),C},_updateGeocoders:function(){var i=[],C,P;for(C=0;C<this._geocoderElems.length;C++)this._geocoderContainer.removeChild(this._geocoderElems[C].getContainer());for(C=this._waypoints.length-1;C>=0;C--)P=this._createGeocoder(C),this._geocoderContainer.insertBefore(P.getContainer(),this._geocoderContainer.firstChild),i.push(P);this._geocoderElems=i.reverse()},_removeMarkers:function(){var i;if(this._markers)for(i=0;i<this._markers.length;i++)this._markers[i]&&this._map.removeLayer(this._markers[i]);this._markers=[]},_updateMarkers:function(){var i,C;if(this._map)for(this._removeMarkers(),i=0;i<this._waypoints.length;i++)this._waypoints[i].latLng?(C=this.options.createMarker(i,this._waypoints[i],this._waypoints.length),C&&(C.addTo(this._map),this.options.draggableWaypoints&&this._hookWaypointEvents(C,i))):C=null,this._markers.push(C)},_fireChanged:function(){this.fire("waypointschanged",{waypoints:this.getWaypoints()}),arguments.length>=2&&this.fire("waypointsspliced",{index:Array.prototype.shift.call(arguments),nRemoved:Array.prototype.shift.call(arguments),added:arguments})},_hookWaypointEvents:function(i,C,P){var D=function(re){return P?re.latlng:re.target.getLatLng()},$=f.bind(function(re){this.fire("waypointdragstart",{index:C,latlng:D(re)})},this),G=f.bind(function(re){this._waypoints[C].latLng=D(re),this.fire("waypointdrag",{index:C,latlng:D(re)})},this),X=f.bind(function(re){this._waypoints[C].latLng=D(re),this._waypoints[C].name="",this._geocoderElems&&this._geocoderElems[C].update(!0),this.fire("waypointdragend",{index:C,latlng:D(re)}),this._fireChanged()},this),te,le;P?(te=f.bind(function(re){this._markers[C].setLatLng(re.latlng),G(re)},this),le=f.bind(function(re){this._map.dragging.enable(),this._map.off("mouseup",le),this._map.off("mousemove",te),X(re)},this),this._map.dragging.disable(),this._map.on("mousemove",te),this._map.on("mouseup",le),$({latlng:this._waypoints[C].latLng})):(i.on("dragstart",$),i.on("drag",G),i.on("dragend",X))},dragNewWaypoint:function(i){var C=i.afterIndex+1;this.options.routeWhileDragging?(this.spliceWaypoints(C,0,i.latlng),this._hookWaypointEvents(this._markers[C],C,!0)):this._dragNewWaypoint(C,i.latlng)},_dragNewWaypoint:function(i,C){var P=new w(C),D=this._waypoints[i-1],$=this._waypoints[i],G=this.options.createMarker(i,P,this._waypoints.length+1),X=[],te=this._map.dragging.enabled(),le=f.bind(function(xe){var be,Ne;for(G&&G.setLatLng(xe.latlng),be=0;be<X.length;be++)Ne=X[be].getLatLngs(),Ne.splice(1,1,xe.latlng),X[be].setLatLngs(Ne);f.DomEvent.stop(xe)},this),re=f.bind(function(xe){var be;for(G&&this._map.removeLayer(G),be=0;be<X.length;be++)this._map.removeLayer(X[be]);this._map.off("mousemove",le),this._map.off("mouseup",re),this.spliceWaypoints(i,0,xe.latlng),te&&this._map.dragging.enable(),f.DomEvent.stop(xe)},this),fe;for(G&&G.addTo(this._map),fe=0;fe<this.options.dragStyles.length;fe++)X.push(f.polyline([D.latLng,C,$.latLng],this.options.dragStyles[fe]).addTo(this._map));te&&this._map.dragging.disable(),this._map.on("mousemove",le),this._map.on("mouseup",re)},_focusGeocoder:function(i){this._geocoderElems[i]?this._geocoderElems[i].focus():document.activeElement.blur()}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{"./geocoder-element":52,"./waypoint":61}],61:[function(s,a,l){(function(u){(function(){var f=typeof window<"u"?window.L:typeof u<"u"?u.L:null;a.exports=f.Class.extend({options:{allowUTurn:!1},initialize:function(y,w,i){f.Util.setOptions(this,i),this.latLng=f.latLng(y),this.name=w}})})()}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[53])),EA}GB();const qB="/assets/tamulokal-uwfeNl1Q.png",WB=({address:s,userLat:a,userLng:l,marketLat:u,marketLng:f,isOpen:y,onToggle:w,markerSize:i=40})=>{const C=Ma(),P=pe.useRef(null),D=`market-map-${u}-${f}`,{distance:$,loading:G}=YS(u,f),X=()=>xu.divIcon({html:'<div class="rounded-full bg-[#FF8225] border-2 border-white" style="width:16px; height:16px;"></div>',className:"",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,-8]});return pe.useEffect(()=>{if(!y||!a||!l||!u||!f)return;P.current&&P.current.remove();const te=xu.map(D);P.current=te,xu.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/">OSM</a> contributors'}).addTo(te);const le=fe=>xu.divIcon({html:`
          <div class="flex items-center justify-center rounded-full border-2 border-blue-500 bg-white"
               style="width: ${i}px; height: ${i}px;">
            <img src="${fe}" class="w-3/4 h-3/4 object-contain" />
          </div>
        `,className:"",iconSize:[i,i],iconAnchor:[i/2,i],popupAnchor:[0,-i]}),re=xu.latLngBounds([a,l],[u,f]);te.fitBounds(re,{padding:[50,50]}),xu.circle([a,l],{radius:8,color:"#FF8225",fillColor:"#FF8225",fillOpacity:1}).addTo(te),xu.Routing.control({waypoints:[xu.latLng(a,l),xu.latLng(u,f)],lineOptions:{styles:[{color:"#FF8225",weight:4}]},show:!1,addWaypoints:!1,draggableWaypoints:!1,routeWhileDragging:!1,fitSelectedRoutes:!1,createMarker:(fe,xe)=>fe===0?xu.marker([a,l],{icon:X()}).addTo(te):xu.marker(xe.latLng,{icon:le(qB)})}).addTo(te)},[y,a,l,u,f,i]),A.jsxs("div",{className:"w-full overflow-hidden font-inter mt-2 border-b border-gray-200",children:[A.jsxs("button",{onClick:w,className:"w-full flex justify-between items-center px-4 py-3 text-sm font-medium transition-colors",children:[y?A.jsx("span",{children:"Market Address"}):A.jsxs("span",{className:"flex items-center gap-2",children:[A.jsx(HS,{className:"text-[var(--black)]"}),G?"Calculating...":`${$} km from you`]}),y?A.jsx(WM,{className:"text-[var(--black)]"}):A.jsx(qM,{className:"text-[var(--black)]"})]}),y&&A.jsxs("div",{className:"px-4 py-2 text-sm text-[#585858] flex flex-col gap-3",children:[A.jsx("p",{className:"mb-2",children:s}),A.jsx("div",{id:D,className:"h-64 w-full rounded-lg shadow-sm"}),A.jsx("button",{className:"bg-[#FF8225] text-white rounded-xl text-sm font-medium hover:bg-[#e6731f] transition-colors w-full h-[35px]",onClick:()=>C("/map"),children:"Get Direction"})]})]})},HP=({review:s,onToggleHide:a,isOwnProfile:l=!1})=>{const u=new Date(s.created_at),f=()=>{const i=new Date,P=(i-u)/(1e3*60*60);if(P<24){const D=Math.floor(P);return D===0?"Just now":`${D} hour${D>1?"s":""} ago`}return P<48?"Yesterday":i.getFullYear()===u.getFullYear()?u.toLocaleDateString(void 0,{day:"numeric",month:"short"}):u.toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"})},y=s.hide,w=`
    relative border rounded-lg p-4 shadow-sm transition
    ${y&&!l?"hidden":""}
    ${y&&l?"bg-gray-50 border-dashed opacity-80":"bg-white border-gray-200"}
  `;return A.jsxs("div",{className:w,children:[l&&A.jsx("button",{onClick:()=>a(s.id,!s.hide),className:"absolute top-3 right-3 bg-white p-1.5 rounded-full shadow hover:bg-gray-100 transition",title:y?"Unhide review":"Hide review",children:y?A.jsx($S,{className:"text-red-500",size:18}):A.jsx(wx,{className:"text-green-600",size:18})}),y&&l&&A.jsx("span",{className:"absolute top-3 left-3 text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded-full",children:"Hidden from public"}),A.jsxs("div",{className:"flex items-center mb-2",children:[A.jsx("img",{src:s.visitor.image||"/default-avatar.png",alt:s.visitor.username||"Visitor",className:"w-10 h-10 rounded-full mr-3 object-cover"}),A.jsxs("div",{className:"flex-1",children:[A.jsx("p",{className:"font-semibold text-gray-800",children:s.visitor.fullname||"Anonymous"}),s.visitor.username&&A.jsxs("p",{className:"text-xs text-gray-500",children:["@",s.visitor.username]}),A.jsxs("div",{className:"flex justify-between items-center mt-1",children:[A.jsx("div",{className:"flex",children:[1,2,3,4,5].map(i=>i<=s.rating?A.jsx(Zo,{className:"text-yellow-400 text-sm"},i):A.jsx(Ty,{className:"text-gray-300 text-sm"},i))}),A.jsx("p",{className:"text-xs text-gray-500",children:f()})]})]})]}),A.jsx("p",{className:"text-gray-700 text-sm mt-2",children:s.review}),s.image&&A.jsx("img",{src:s.image,alt:"Review",className:"w-full max-w-xs h-auto mt-2 rounded-lg object-cover"})]})},ZB=({marketId:s})=>{const[a,l]=pe.useState([]),u="/v1";return pe.useEffect(()=>{(async()=>{try{const w=await(await fetch(`${u}/market/${s}/review`)).json();l(w)}catch(y){console.error("Error fetching reviews:",y)}})()},[s]),A.jsx("div",{className:"space-y-4",children:a.length>0?a.map(f=>A.jsx(HP,{review:f},f.id)):A.jsx("p",{className:"text-center text-gray-500 py-8",children:"No reviews yet."})})},$0="/v1",CA=250,GP=({market_id:s,review_id:a})=>{const u=Lr(!0)?.user?.id,[f,y]=pe.useState(null),[w,i]=pe.useState(0),[C,P]=pe.useState(""),[D,$]=pe.useState(null),[G,X]=pe.useState(null),[te,le]=pe.useState(!1),re=a!=null&&s==null;pe.useEffect(()=>{if(!u||!re)return;(async()=>{try{const Ee=await fetch(`${$0}/visitor/${u}/market-review?id=${a}`);if(!Ee.ok)return;const et=await Ee.json();i(et.rating),P(et.review),X(et.image||null),y(et.market_id)}catch(Ee){console.error("Failed to fetch review",Ee)}})()},[u,a,re]);const fe=Be=>{const Ee=Be.target.files[0];Ee&&($(Ee),X(URL.createObjectURL(Ee)))},xe=async Be=>{try{const Ee=await Be.json();return Ee?.id||Ee?.review_id||Ee?.data?.id||Ee?.data?.review_id}catch{return null}},be=async Be=>{if(Be.preventDefault(),!(!w||!C)){le(!0);try{let Ee=a;if(re){if(!(await fetch(`${$0}/visitor/${u}/market-review?id=${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:w,review:C})})).ok)throw new Error("Failed to update review")}else{const et=await fetch(`${$0}/market/${s}/review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:u,rating:w,review:C})});if(!et.ok)throw new Error("Failed to create review");Ee=await xe(et)}if(D&&Ee){const et=await createImageBitmap(D),at=document.createElement("canvas");at.width=et.width,at.height=et.height,at.getContext("2d").drawImage(et,0,0);const lt=await new Promise(qe=>at.toBlob(qe,"image/jpeg",.9)),pt=s||f;if(!pt)throw new Error("Market ID is required for image upload");const Zt=`markets/${pt}/${Ee}.jpg`,{error:jt}=await Vs.storage.from("tamulokal").upload(Zt,lt,{upsert:!0,contentType:"image/jpeg"});if(jt)throw jt;const{data:Di}=Vs.storage.from("tamulokal").getPublicUrl(Zt),Pi=`${Di.publicUrl}?t=${new Date().getTime()}`;await fetch(`${$0}/visitor/${u}/market-review?id=${Ee}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:Pi})})}}catch(Ee){console.error("Failed to submit review",Ee)}finally{le(!1)}}},Ne=C.length>CA?"text-red-500":"text-gray-500";return A.jsxs("form",{onSubmit:be,className:"py-6 md:py-8",children:[A.jsx("div",{className:"bg-white md:rounded-xl md:border md:border-gray-200 md:shadow-sm px-4 md:px-6 py-4 md:py-6",children:A.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[A.jsx("div",{className:"md:w-1/2",children:A.jsxs("label",{className:"block cursor-pointer",children:[A.jsx("input",{type:"file",accept:"image/*",onChange:fe,className:"hidden"}),A.jsx("div",{className:"w-full aspect-square overflow-hidden rounded-lg border border-dashed border-gray-300 bg-gray-50 flex items-center justify-center",children:G?A.jsx("img",{src:G,alt:"Review",className:"w-full h-full object-cover"}):A.jsxs("div",{className:"flex flex-col items-center text-gray-400",children:[A.jsx(eP,{className:"text-3xl mb-2"}),A.jsx("span",{className:"text-sm md:text-base",children:"No image"})]})})]})}),A.jsxs("div",{className:"md:w-1/2 flex flex-col items-center md:justify-between gap-6",children:[A.jsx("div",{className:"w-full flex justify-center md:justify-center gap-3 md:gap-4 md:mt-10",children:[1,2,3,4,5].map(Be=>A.jsx("button",{type:"button",onClick:()=>i(Be),className:"text-3xl md:text-4xl text-orange-500",children:w>=Be?A.jsx(Zo,{}):A.jsx(Ty,{})},Be))}),A.jsxs("div",{className:"w-full max-w-xl",children:[A.jsx("textarea",{value:C,onChange:Be=>P(Be.target.value),rows:6,placeholder:"Share your experience...",className:"w-full border border-gray-300 rounded-lg px-3 py-3 text-sm md:text-base bg-white focus:outline-none focus:ring-2 focus:ring-orange-400"}),A.jsxs("div",{className:`mt-2 text-xs md:text-sm text-right ${Ne}`,children:[C.length," / ",CA]})]})]})]})}),A.jsx("div",{className:"mt-6 flex justify-end px-4 md:px-0",children:A.jsx("button",{type:"submit",disabled:te,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-3.5 bg-[#FF8225] text-white rounded-md font-semibold text-sm md:text-base hover:bg-[#e6731f] transition disabled:opacity-60",children:te?"Saving...":re?"Save":"Create"})})]})},XB=({marketId:s})=>{const[a,l]=pe.useState(null),u="/v1";if(pe.useEffect(()=>{(async()=>{try{const be=await(await fetch(`${u}/market/${s}/rating`)).json();l(be)}catch(xe){console.error("Error fetching market rating:",xe)}})()},[s]),!a)return A.jsx("p",{className:"text-gray-500 text-center",children:"Loading rating..."});const{average_rating:f=0,total_reviews:y=0,rating_counts:w,rating_1:i,rating_2:C,rating_3:P,rating_4:D,rating_5:$}=a;let G;w&&typeof w=="object"?G=[w[5]||0,w[4]||0,w[3]||0,w[2]||0,w[1]||0]:G=[Number($||0),Number(D||0),Number(P||0),Number(C||0),Number(i||0)];const te=G.reduce((fe,xe)=>fe+xe,0)||y||1,le=Math.round((Number(f)||0)*2)/2,re=()=>{const fe=[];for(let xe=1;xe<=5;xe++)xe<=Math.floor(le)?fe.push(A.jsx(Zo,{className:"text-[var(--orange)] text-lg"},xe)):xe-.5===le?fe.push(A.jsx(CO,{className:"text-[var(--orange)] text-lg"},xe)):fe.push(A.jsx(Ty,{className:"text-[var(--orange)] text-lg"},xe));return fe};return A.jsxs("div",{className:"flex items-center justify-between p-2 gap-4",children:[A.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[100px]",children:[A.jsx("h2",{className:"text-4xl font-bold text-[var(--black)]",children:Number(f).toFixed(1)}),A.jsx("div",{className:"flex gap-1 mt-1",children:re()}),A.jsxs("p",{className:"text-sm text-[var(--gray)] mt-1",children:[y," reviews"]})]}),A.jsx("div",{className:"h-20 w-px bg-[var(--gray)]"}),A.jsx("div",{className:"flex flex-col justify-between w-full space-y-1",children:[5,4,3,2,1].map((fe,xe)=>{const Ne=(G[xe]||0)/te*100;return A.jsxs("div",{className:"flex items-center gap-1",children:[A.jsx("span",{className:"w-4 text-sm text-[var(--gray)]",children:fe}),A.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 overflow-hidden",children:A.jsx("div",{className:"bg-[var(--orange)] h-full rounded-full transition-all duration-500",style:{width:`${Ne}%`}})})]},fe)})})]})},YB=({vendor:s})=>{const{name:a,image:l,avg_rating:u,total_reviews:f,lot:y}=s,w=u>0&&f>0,i=["Fresh Produce","Street Food","Snacks & Drinks"];return A.jsxs("div",{className:"flex flex-col",children:[A.jsx("img",{src:l||"/placeholder.jpg",alt:a,className:"w-full h-36 object-cover rounded-lg border border-gray-200 shadow-md"}),A.jsx("h3",{className:"mt-2 text-base font-semibold text-gray-800 line-clamp-1",children:a}),A.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:i.map((C,P)=>A.jsx("span",{className:"text-[10px] bg-orange-100 text-orange-700 px-1 py-0.5 rounded-full whitespace-nowrap",children:C},P))}),A.jsxs("div",{className:"mt-1 flex justify-between items-center text-sm text-gray-700",children:[A.jsxs("span",{className:"font-medium",children:["Lot ",y]}),A.jsx("span",{className:"flex items-center",children:w?A.jsxs(A.Fragment,{children:[A.jsx(Zo,{className:"text-orange-400 text-base mr-1"}),u.toFixed(1)," (",f,")"]}):"No reviews yet"})]})]})},KB=({marketId:s})=>{const[a,l]=pe.useState([]),[u,f]=pe.useState(!0),y="/v1";return pe.useEffect(()=>{(async()=>{try{const C=await(await fetch(`${y}/market/${s}/vendor`)).json();l(C||[])}catch(i){console.error("Error fetching vendors:",i)}finally{f(!1)}})()},[s]),u?A.jsx("p",{className:"text-gray-500 text-center",children:"Loading vendors..."}):a.length===0?A.jsx("p",{className:"text-gray-500 text-center",children:"No vendors found."}):A.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:a.map(w=>A.jsx($s,{to:`/vendor/${w.vendor_id}`,className:"block",children:A.jsx(YB,{vendor:w})},w.vendor_id))})},JB=()=>{const s=Ay(),l=Lr(!1)?.user?.id,{id:u}=ul(),f=Ma(),[y,w]=pe.useState(null),[i,C]=pe.useState("detail"),[P,D]=pe.useState(null),[$,G]=pe.useState(!1),[X,te]=pe.useState(!1),[le,re]=pe.useState(!1),fe="/v1";pe.useEffect(()=>{(async()=>{try{const at=await fetch(`${fe}/market/${u}`);if(!at.ok)throw new Error(`HTTP error: ${at.status}`);const He=await at.json();w(He)}catch(at){console.log("Error fetching market",at)}})()},[u,fe]),pe.useEffect(()=>{if(!l||!u)return;(async()=>{try{const at=await fetch(`${fe}/market/${u}/bookmark?visitor_id=${l}`);if(!at.ok)return;const He=await at.json();te(He.hasBookmarked)}catch(at){console.error("Failed to fetch bookmark status",at)}})()},[u,l,fe]),pe.useEffect(()=>{if(!l||!u)return;(async()=>{try{await fetch(`${fe}/market/${u}/click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({viewer_id:l})})}catch(at){console.error("Failed to record market click",at)}})()},[u,l,fe]);const xe=async()=>{if(!(!l||!u||le)){re(!0);try{if(X){if(!(await fetch(`${fe}/market/${u}/bookmark`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:l})})).ok)throw new Error("Failed to remove bookmark");te(!1)}else{if(!(await fetch(`${fe}/market/${u}/bookmark`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:l})})).ok)throw new Error("Failed to add bookmark");te(!0)}}catch(et){console.error("Bookmark toggle error:",et)}finally{re(!1)}}};if(!y||!s||!s[0]||!s[1])return A.jsx("div",{className:"flex justify-center items-center h-screen",children:A.jsx("p",{className:"text-gray-600",children:"Loading..."})});const be=new Date,Ne=be.getDay()===0?7:be.getDay(),Be=y.schedules?.find(et=>et.daily_day===Ne),Ee=[{id:"detail",label:"Detail"},{id:"vendors",label:"Vendors"},{id:"reviews",label:"Reviews"}];return A.jsxs("div",{className:"relative bg-[var(--white)] min-h-screen",children:[A.jsxs("div",{className:"max-w-6xl mx-auto w-full px-0 md:px-6 pb-8 md:pt-6",children:[A.jsx("div",{className:"hidden md:flex justify-end px-4 md:px-0 mb-3",children:A.jsx("button",{onClick:()=>f(-1),className:" rounded-full w-9 h-9 flex items-center justify-center shadow-md hover:bg-gray-100 transition-colors",children:A.jsx(Fd,{className:"w-5 h-10"})})}),A.jsxs("div",{className:"flex flex-col md:flex-row md:gap-6",children:[A.jsxs("div",{className:"relative md:w-2/5 w-full",children:[A.jsx("div",{className:"w-full aspect-[16/9] md:rounded-xl overflow-hidden bg-gray-100",children:A.jsx("img",{src:y.image,alt:y.name,className:"w-full h-full object-cover"})}),A.jsx("button",{onClick:()=>f(-1),className:"md:hidden absolute top-4 right-4 bg-[var(--white)] rounded-full w-8 h-8 flex items-center justify-center shadow-md hover:bg-gray-100 transition-colors",children:A.jsx(Fd,{size:20,className:"text-[var(--black)]"})}),A.jsx("button",{onClick:xe,disabled:le||!l,className:"md:hidden absolute top-4 left-4 bg-[var(--white)] rounded-full w-8 h-8 flex items-center justify-center shadow-md hover:bg-gray-100 transition-colors",title:X?"Remove bookmark":"Bookmark",children:X?A.jsx(EO,{size:20,className:"text-orange-500"}):A.jsx(HM,{size:20,className:"text-gray-700"})})]}),A.jsx("div",{className:`flex-1 mt-4 md:mt-0  md:rounded-xl md:border md:border-gray-200 md:shadow-sm\r
                      md:flex md:flex-col md:justify-center`,style:{minHeight:"0"},children:A.jsxs("div",{className:"px-4 md:px-6 py-4",children:[A.jsx("h1",{className:"font-bold text-[var(--black)] text-xl md:text-2xl mb-2",children:y.name}),A.jsx(XB,{marketId:u})]})})]}),A.jsxs("div",{className:"mt-4  md:rounded-xl md:border md:border-gray-200 md:shadow-sm",children:[A.jsx("div",{className:"px-4 md:px-6",children:A.jsx("div",{className:"flex justify-around py-2 z-10",children:Ee.map(et=>A.jsx("button",{onClick:()=>C(et.id),className:`text-sm font-medium px-4 py-2 transition-colors ${i===et.id?"text-[var(--orange)] border-b-2 border-[var(--orange)]":"text-[var(--gray)]"}`,children:et.label},et.id))})}),A.jsxs("div",{className:"px-4 md:px-6 pb-6 flex flex-col",children:[i==="detail"&&A.jsxs(A.Fragment,{children:[A.jsx("p",{className:"text-gray-700 mt-4",children:y.description}),A.jsx(UB,{schedules:y.schedules,frequency:y.recurrence_type,todaysSchedule:Be,isOpen:P==="time",onToggle:()=>D(P==="time"?null:"time")}),A.jsx(WB,{address:y.address,userLat:s[0],userLng:s[1],marketLat:y.latitude,marketLng:y.longitude,marketId:u,isOpen:P==="distance",onToggle:()=>D(P==="distance"?null:"distance")})]}),i==="vendors"&&A.jsx("div",{className:"mt-4",children:A.jsx(KB,{marketId:u})}),i==="reviews"&&A.jsx("div",{className:"relative pb-10 mt-4",children:A.jsx(ZB,{marketId:u})})]})]})]}),$&&A.jsx(GP,{market:y,type:"new",onClose:()=>G(!1)})]})};function qP(s){return Rn({attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"},child:[]}]})(s)}const QB=()=>{const s=Ma(),[a,l]=pe.useState(!1),[u,f]=pe.useState({username:"",email:"",password:""}),[y,w]=pe.useState(!1),[i,C]=pe.useState(null),[P,D]=pe.useState(!1),[$,G]=pe.useState(null),X=pe.useRef(null),te=async xe=>{if(!xe){C(null);return}D(!0);const{data:be,error:Ne}=await Vs.from("visitor").select("username").eq("username",xe).maybeSingle();Ne&&console.error(Ne),C(!be),D(!1)},le=xe=>{f({...u,[xe.target.name]:xe.target.value}),xe.target.name==="username"&&(X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{te(xe.target.value)},500))},re=()=>l(!a),fe=async xe=>{xe.preventDefault(),w(!0);try{const{data:be,error:Ne}=await Vs.auth.signUp({email:u.email,password:u.password,options:{data:{username:u.username}}});if(Ne)throw Ne;if(!be.user)throw new Error("Signup failed: user not created.");alert("Signup successful! Please check your email for verification."),s("/")}catch(be){console.error("Signup failed:",be),alert(be.message||"Signup failed. Please try again.")}finally{w(!1)}};return A.jsxs("div",{className:"flex flex-col items-center font-inter",children:[A.jsx("h1",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Create your account"}),A.jsxs("form",{onSubmit:fe,className:"flex flex-col items-center gap-2 w-[300px]",children:[A.jsxs("div",{className:"w-full",children:[A.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),A.jsx("input",{id:"username",type:"text",name:"username",value:u.username,onChange:le,onFocus:()=>G("username"),onBlur:()=>G(null),placeholder:"Enter your username",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                       text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]`,required:!0}),$==="username"&&A.jsxs(A.Fragment,{children:[P&&A.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Checking username..."}),i===!1&&!P&&A.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Username already taken"}),i===!0&&!P&&A.jsx("p",{className:"text-xs text-green-500 mt-1",children:"Username available"})]})]}),A.jsxs("div",{className:"w-full",children:[A.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),A.jsx("input",{id:"email",type:"email",name:"email",value:u.email,onChange:le,onFocus:()=>G("email"),placeholder:"example@gmail.com",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                       text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]`,required:!0})]}),A.jsxs("div",{className:"w-full mb-4",children:[A.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),A.jsxs("div",{className:"relative",children:[A.jsx("input",{id:"password",type:a?"text":"password",name:"password",value:u.password,onChange:le,onFocus:()=>G("password"),placeholder:"Enter your password",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                         text-sm pr-10 focus:outline-none focus:ring-2 focus:ring-[#FF8225]`,required:!0}),A.jsx("button",{type:"button",onClick:re,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:a?A.jsx(wx,{}):A.jsx(XM,{})})]})]}),A.jsx("button",{type:"submit",disabled:y,className:`w-full h-[40px] rounded-xl bg-[#FF8225] text-white \r
                     font-medium text-sm hover:bg-[#e6731f] transition-colors disabled:opacity-50`,children:y?"Signing Up...":"Sign Up"}),A.jsxs("div",{className:"flex items-center w-full my-2",children:[A.jsx("hr",{className:"flex-grow border-gray-300"}),A.jsx("span",{className:"px-2 text-sm text-gray-500",children:"or"}),A.jsx("hr",{className:"flex-grow border-gray-300"})]}),A.jsxs("button",{type:"button",className:`w-full h-[40px] rounded-xl border border-gray-300 \r
                     flex items-center justify-center gap-2 text-sm font-medium \r
                     hover:bg-gray-50 transition-colors`,onClick:async()=>{const{data:xe,error:be}=await Vs.auth.signInWithOAuth({provider:"google"});be&&console.error(be)},children:[A.jsx(qP,{className:"text-[#DB4437]"}),"Continue with Google"]})]})]})},e4=()=>{const[s,a]=pe.useState(!1),[l,u]=pe.useState({email:"",password:""}),f=Ma(),y=C=>{u({...l,[C.target.name]:C.target.value})},w=()=>a(!s),i=async C=>{C.preventDefault();try{const{data:P,error:D}=await Vs.auth.signInWithPassword({email:l.email,password:l.password});if(D)throw D;localStorage.setItem("isHello","true"),f("/",{replace:!0})}catch(P){console.error(P),alert("Sign in failed. Please check your credentials.")}};return A.jsxs("div",{className:"flex flex-col items-center font-inter",children:[A.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Sign into your account"}),A.jsxs("form",{onSubmit:i,className:"flex flex-col items-center gap-4 w-[300px]",children:[A.jsxs("div",{className:"w-full",children:[A.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),A.jsx("input",{id:"email",type:"email",name:"email",value:l.email,onChange:y,placeholder:"example@gmail.com",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                       text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]`})]}),A.jsxs("div",{className:"w-full",children:[A.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),A.jsxs("div",{className:"relative",children:[A.jsx("input",{id:"password",type:s?"text":"password",name:"password",value:l.password,onChange:y,placeholder:"Enter your password",className:`w-full h-[40px] border border-gray-300 rounded-xl px-3 \r
                         text-sm pr-10 focus:outline-none focus:ring-2 focus:ring-[#FF8225]`}),A.jsx("button",{type:"button",onClick:w,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:s?A.jsx(wx,{}):A.jsx(XM,{})})]})]}),A.jsx("button",{type:"submit",className:`w-full h-[40px] rounded-xl bg-[#FF8225] text-white \r
                     font-medium text-sm hover:bg-[#e6731f] transition-colors`,children:"Sign In"}),A.jsxs("div",{className:"flex items-center w-full my-2",children:[A.jsx("hr",{className:"flex-grow border-gray-300"}),A.jsx("span",{className:"px-2 text-sm text-gray-500",children:"or"}),A.jsx("hr",{className:"flex-grow border-gray-300"})]}),A.jsxs("button",{type:"button",className:`w-full h-[40px] rounded-xl border border-gray-300 \r
                     flex items-center justify-center gap-2 text-sm font-medium \r
                     hover:bg-gray-50 transition-colors`,onClick:async()=>{const{data:C,error:P}=await Vs.auth.signInWithOAuth({provider:"google"});P&&console.error(P)},children:[A.jsx(qP,{className:"text-[#DB4437]"}),"Continue with Google"]})]})]})},t4=()=>{const[s,a]=pe.useState(!0),l=$c(),u=Ma(),f=l.state?.from||"/",y=Lr(!1,"/");pe.useEffect(()=>(document.body.style.overflow="hidden",console.log("AuthPage opened from:",f),y&&(console.log("Existing session found, redirecting..."),u("/",{replace:!0})),()=>{document.body.style.overflow="auto"}),[f,u,y]);const w=()=>{console.log("Closing auth, going back to:",f),u(f,{replace:!0})},i=()=>a(!s);return A.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[100dvh] bg-[#FFFDFA] px-4 font-inter relative",children:[A.jsxs("button",{onClick:w,className:"absolute top-4 right-4 w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center text-gray-600 hover:bg-gray-100",children:[A.jsx(Fd,{className:"w-5 h-5"})," "]}),A.jsx("img",{src:"/tamulokal.png",alt:"tamulokal",className:"w-16 h-16"}),s?A.jsx(QB,{}):A.jsx(e4,{}),A.jsx("div",{className:"mt-4 text-sm text-gray-600 text-center",children:s?A.jsxs(A.Fragment,{children:["Already have an account?"," ",A.jsx("button",{type:"button",onClick:i,className:"text-[#FF8225] font-medium hover:underline",children:"Login"})]}):A.jsxs(A.Fragment,{children:["Dont have an account?"," ",A.jsx("button",{type:"button",onClick:i,className:"text-[#FF8225] font-medium hover:underline",children:"Sign Up"})]})})]})},WP=({userId:s,isOwnProfile:a=!0})=>{const[l,u]=pe.useState(null),[f,y]=pe.useState({fullname:"",username:"",image:""}),[w,i]=pe.useState(null),[C,P]=pe.useState(null),[D,$]=pe.useState(!1),[G,X]=pe.useState(!0),[te,le]=pe.useState(!1),re="/v1",xe=Lr()?.user?.id;pe.useEffect(()=>{if(!s)return;(async()=>{try{const lt=await fetch(`${re}/user/${s}/profile`);if(!lt.ok)throw new Error("Failed to fetch profile");const pt=await lt.json();u(pt),y({fullname:pt.fullname||pt.name||"",username:pt.username||"",image:pt.image||""})}catch(lt){console.error("Error fetching profile:",lt)}finally{X(!1)}})()},[s,re]),pe.useEffect(()=>{(async()=>{if(!(!xe||!s))try{const pt=await(await fetch(`${re}/user/follow?follower_id=${xe}&following_id=${s}`)).json();le(pt.length>0)}catch(lt){console.error("Follow status check failed:",lt)}})()},[xe,s,re]);const be=He=>{const{name:lt,value:pt}=He.target;y(Zt=>({...Zt,[lt]:pt}))},Ne=He=>{const lt=He.target.files[0];lt&&(P(lt),i(URL.createObjectURL(lt)))},Be=async()=>{try{let He=f.image;if(C){const Zt=await createImageBitmap(C),jt=document.createElement("canvas");jt.width=Zt.width,jt.height=Zt.height,jt.getContext("2d").drawImage(Zt,0,0);const Pi=await new Promise(Vi=>jt.toBlob(Vi,"image/jpeg",.9)),qe=`$visitors/${s}/${s}.jpg`,{error:wt}=await Vs.storage.from("tamulokal").upload(qe,Pi,{upsert:!0,contentType:"image/jpeg"});if(wt)throw wt;const{data:{publicUrl:Ct}}=Vs.storage.from("tamulokal").getPublicUrl(qe);He=`${Ct}?t=${new Date().getTime()}`}const lt=await fetch(`${re}/visitor/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullname:f.fullname,username:f.username,image:He})});if(!lt.ok)throw new Error("Failed to update profile");const pt=await lt.json();u(pt),y({fullname:pt.fullname,username:pt.username,image:pt.image}),i(null),P(null),$(!1)}catch(He){console.error("Error saving profile:",He),alert("Failed to save changes")}},Ee=()=>{y({fullname:l.fullname,username:l.username,image:l.image}),i(null),P(null),$(!1)},et=async()=>{if(!xe)return alert("You must be logged in.");try{if(te){if(!(await fetch(`${re}/user/follow?follower_id=${xe}&following_id=${s}`,{method:"DELETE"})).ok)throw new Error("Failed to unfollow");le(!1),u(lt=>({...lt,follower_count:lt.follower_count-1}))}else{if(!(await fetch(`${re}/user/follow`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({follower_id:xe,following_id:s})})).ok)throw new Error("Failed to follow");le(!0),u(lt=>({...lt,follower_count:lt.follower_count+1}))}}catch(He){console.error(He),alert("Failed to update follow status")}};if(G)return A.jsx("div",{className:"text-center text-gray-500 mt-10",children:"Loading profile..."});const at=w||f.image||"/profile.png";return A.jsxs("div",{className:"flex flex-col items-start w-full px-4",children:[A.jsxs("div",{className:"flex items-center gap-4 w-full",children:[A.jsxs("div",{className:"relative",children:[A.jsx("img",{src:at,alt:"Profile",className:"w-20 h-20 rounded-full object-cover border shadow-md"}),D&&a&&A.jsxs("label",{className:"absolute bottom-0 right-0 bg-[#FF8225] text-white text-xs px-2 py-1 rounded-full cursor-pointer hover:bg-[#e6731f]",children:["Edit",A.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:Ne})]})]}),A.jsx("div",{className:"flex flex-col items-start justify-center",children:D?A.jsxs(A.Fragment,{children:[A.jsx("input",{type:"text",name:"fullname",value:f.fullname,onChange:be,className:"border rounded-lg px-2 py-1 text-sm w-[150px]"}),A.jsx("input",{type:"text",name:"username",value:f.username,onChange:be,placeholder:"@username",className:"border rounded-lg px-2 py-1 text-sm w-[150px] mt-2"})]}):A.jsxs(A.Fragment,{children:[A.jsx("h2",{className:"text-lg font-semibold text-gray-800 max-w-[200px]",children:l.fullname}),A.jsxs("p",{className:"text-sm text-gray-500",children:["@",l.username]})]})})]}),A.jsxs("div",{className:"flex justify-between items-center w-full mt-6",children:[A.jsxs("div",{className:"flex items-center gap-8",children:[A.jsxs("div",{className:"flex flex-col items-left",children:[A.jsx("span",{className:"text-sm text-gray-500",children:"Following"}),A.jsx("span",{className:"font-semibold text-gray-900",children:l.following_count})]}),A.jsxs("div",{className:"flex flex-col items-left",children:[A.jsx("span",{className:"text-sm text-gray-500",children:"Followers"}),A.jsx("span",{className:"font-semibold text-gray-900",children:l.follower_count})]})]}),a?A.jsx("div",{className:"flex gap-2",children:D?A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:Ee,className:"px-4 py-1.5 rounded-full text-sm font-medium border border-gray-300 text-gray-600 hover:bg-gray-100",children:"Cancel"}),A.jsx("button",{onClick:Be,className:"px-4 py-1.5 rounded-full text-sm font-medium bg-[#4CAF50] text-white hover:bg-[#45a049]",children:"Save"})]}):A.jsx("button",{onClick:()=>$(!0),className:"px-4 py-1.5 rounded-xl text-sm font-medium border border-[#FF8225] text-[#FF8225] bg-white hover:bg-[#FF8225] hover:text-white transition-colors duration-200",children:"Edit Profile"})}):A.jsx("button",{onClick:et,className:`px-4 py-1.5 rounded-xl text-sm font-medium border transition-colors duration-200 ${te?"border-gray-300 text-gray-600 bg-gray-100":"border-[#FF8225] text-[#FF8225] bg-white hover:bg-[#FF8225] hover:text-white"}`,children:te?"Following":"Follow"})]})]})},R1="/v1",i4=({product:s,isOwnProfile:a,showAvailabilityToggle:l=!1})=>{const u=Ma(),{id:f}=ul(),y=$c(),[w,i]=pe.useState(!0),[C,P]=pe.useState(!1),[D,$]=pe.useState(!1);pe.useEffect(()=>{if(!l||!f)return;(async()=>{P(!0);try{const te=await fetch(`${R1}/marketspace/${f}/product?product_id=${s.id}`);if(!te.ok)throw new Error("Failed to check availability");const le=await te.json();i(!!le)}catch(te){console.error("Failed to check availability",te),i(!1)}finally{P(!1)}})()},[l,f,s.id]);const G=async X=>{if(X.stopPropagation(),D||C)return;const te=!w;i(te),$(!0);try{let le;if(te?le=await fetch(`${R1}/marketspace/${f}/product`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:s.id})}):le=await fetch(`${R1}/marketspace/${f}/product?product_id=${s.id}`,{method:"DELETE"}),!le.ok)throw new Error("Availability update failed")}catch(le){console.error(le),i(!te),alert("Failed to update product availability")}finally{$(!1)}};return A.jsxs("div",{className:`relative rounded-xl overflow-hidden transition
        ${w?"bg-white shadow-sm hover:shadow-md":"bg-gray-100 opacity-60"}
      `,children:[A.jsx("div",{className:"w-full aspect-square bg-gray-100",children:A.jsx("img",{src:s.image||"/default-product.png",alt:s.name,className:"w-full h-full object-cover"})}),!w&&A.jsx("div",{className:"absolute top-2 left-2 text-xs bg-black/70 text-white px-2 py-0.5 rounded",children:"Unavailable"}),A.jsx("div",{onClick:()=>{a&&u(`/business/product/${s.id}`)},className:`absolute top-2 left-2 bg-white/90 backdrop-blur px-2 py-0.5 rounded-full shadow
          flex items-center gap-1 text-xs
          ${a?"cursor-pointer hover:bg-white":""}
        `,children:s.review_count>0?A.jsxs(A.Fragment,{children:[A.jsx(Zo,{className:"text-yellow-500",size:14}),A.jsxs("span",{className:"font-medium text-gray-700",children:[s.avg_rating," (",s.review_count,")"]})]}):A.jsx("span",{className:"text-gray-500",children:"No reviews"})}),A.jsxs("div",{className:"p-3",children:[A.jsx("h3",{className:"text-sm font-semibold text-gray-800 truncate",children:s.name}),A.jsxs("p",{className:"text-[#FF8225] font-medium text-sm mt-1",children:["RM ",s.price||"0.00"]})]}),l&&!C&&A.jsx("button",{onClick:G,disabled:D,className:"absolute top-2 right-2 bg-white/90 backdrop-blur p-1.5 rounded-full shadow hover:bg-white transition",title:w?"Set Unavailable":"Set Available",children:w?A.jsx(wx,{className:"text-green-600",size:18}):A.jsx($S,{className:"text-red-500",size:18})}),a&&A.jsx("button",{onClick:()=>u(`/business/product/${s.id}/edit`),className:"absolute bottom-2 right-2 bg-white rounded-full p-1 shadow hover:bg-gray-100 transition",children:A.jsx(JM,{className:"text-gray-600",size:20})}),!a&&A.jsx("button",{onClick:()=>u(`${y.pathname}/product/${s.id}`),className:"absolute bottom-2 right-2 p-1 transition",title:"Leave a review",children:A.jsx(xf,{className:"text-yellow-500",size:20})})]})},hc=({title:s,backPath:a=-1})=>{const l=Ma();return A.jsx("div",{className:"px-4 py-4",children:A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("button",{onClick:()=>l(a),className:"text-[var(--black)] hover:text-[var(--orange)] transition",children:A.jsx(Mm,{className:"text-2xl"})}),A.jsx("h1",{className:"text-xl font-semibold text-[var(--black)]",children:s})]})})},n4="/v1",KS=({vendorId:s,isOwnProfile:a,showAvailabilityToggle:l=!1})=>{const[u,f]=pe.useState([]),[y,w]=pe.useState(!0),i=Ma();return pe.useEffect(()=>{if(!s)return;(async()=>{try{const P=await fetch(`${n4}/product?vendor_id=${s}`);if(!P.ok)throw new Error("Failed to fetch products");const D=await P.json();f(D||[])}catch(P){console.error(P)}finally{w(!1)}})()},[s]),y?A.jsx("div",{className:"text-gray-500 text-center mt-4",children:"Loading products..."}):A.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 pb-12 max-w-6xl",children:[a&&A.jsxs("div",{onClick:()=>i("/business/product/add"),className:"flex flex-col border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-[#FF8225] transition-colors overflow-hidden",children:[A.jsx("div",{className:"w-full aspect-square flex items-center justify-center bg-gray-100",children:A.jsx(ux,{className:"text-4xl text-gray-400"})}),A.jsx("div",{className:"p-3 flex-1 flex items-center justify-center",children:A.jsx("span",{className:"text-gray-500 text-sm text-center",children:"Add Product"})})]}),u.map(C=>A.jsx(i4,{product:C,isOwnProfile:a,showAvailabilityToggle:l},C.id))]})},ZP=()=>{const[s,a]=pe.useState(!1),[l,u]=pe.useState(!0),[f,y]=pe.useState(!1),[w,i]=pe.useState(!0),[C,P]=pe.useState([]),[D,$]=pe.useState(!1),G=Ma();$c();const X=Lr(!0),te=()=>a(be=>!be);pe.useEffect(()=>{(async()=>{if(!X||!X.user)return;const Ne=X.user.id;try{const Be=await fetch(`/v1/user/${Ne}/roles`),Ee=await Be.json();let et=[];if(Be.ok&&Ee.roles?(et=Ee.roles,P(et)):P([]),et.includes("Vendor")){const He=await(await fetch(`/v1/vendor/${Ne}/verify`)).json();$(He.verified)}if(et.includes("Organizer")){const He=await(await fetch(`/v1/organizer/${Ne}/verify`)).json();$(He.verified)}}catch(Be){console.error("Error fetching roles or verification:",Be),P([])}})()},[X]);const le=async()=>{try{a(!1),localStorage.clear();const{error:be}=await Vs.auth.signOut();if(be)throw be;G("/auth",{replace:!0})}catch(be){console.error("Sign-out error:",be.message),alert("Failed to sign out: "+be.message)}},re=C.includes("Vendor"),fe=C.includes("Organizer"),xe=re||fe;return A.jsxs("div",{className:"relative z-[60]",children:[A.jsx("button",{onClick:te,className:`text-3xl text-gray-800 hover:text-[#FF8225] transition-colors duration-200 relative z-[70]
          ${s?"md:hidden":""}
        `,children:s?A.jsx(Fd,{}):A.jsx(qO,{})}),s&&A.jsxs("div",{className:"fixed inset-0 bg-[var(--white)] z-[60] flex flex-col justify-between transition-all duration-300",children:[A.jsx("button",{onClick:te,className:"absolute top-4 right-4 text-3xl text-gray-800 hover:text-[#FF8225] transition-colors duration-200",children:A.jsx(Fd,{})}),A.jsxs("div",{className:"flex flex-col mt-16 px-6 gap-8 overflow-y-auto",children:[A.jsxs("div",{children:[A.jsx("h2",{className:"text-sm uppercase tracking-wide text-gray-400 mb-3",children:"My Account"}),A.jsxs("button",{onClick:()=>{G("/market/history"),a(!1)},className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[A.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[A.jsx(UO,{className:"text-xl"}),"Market History"]}),A.jsx(xf,{className:"text-gray-400 ml-auto"})]}),A.jsxs("button",{onClick:()=>{G("/notifications"),a(!1)},className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[A.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[A.jsx(PO,{className:"text-xl"}),"Notifications"]}),A.jsx(xf,{className:"text-gray-400 ml-auto"})]}),A.jsxs("button",{onClick:()=>{G("/market/bookmark"),a(!1)},className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[A.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[A.jsx(HM,{className:"text-xl"}),"Bookmarks"]}),A.jsx(xf,{className:"text-gray-400 ml-auto"})]}),!re&&!fe&&A.jsxs(A.Fragment,{children:[A.jsxs("button",{onClick:()=>{G("/product-review"),a(!1)},className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[A.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[A.jsx(Ty,{className:"text-xl"}),"Product Reviews"]}),A.jsx(xf,{className:"text-gray-400 ml-auto"})]}),A.jsxs("div",{className:"flex flex-col",children:[A.jsxs("button",{onClick:()=>y(be=>!be),className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[A.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[A.jsx(IO,{className:"text-xl"}),"Switch to business account"]}),A.jsx(xf,{className:`text-gray-400 ml-auto transition-transform duration-200 ${f?"rotate-90":""}`})]}),f&&A.jsxs("div",{className:"ml-4 flex flex-col gap-1 mt-1",children:[A.jsxs("button",{onClick:()=>{G("/organizer/registration"),a(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[A.jsx(Cm,{className:"text-xl"}),"Organizer"]}),A.jsxs("button",{onClick:()=>{G("/vendor/registration"),a(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[A.jsx(cx,{className:"text-xl"}),"Vendor"]})]})]})]})]}),xe&&A.jsxs("div",{children:[A.jsx("h2",{className:"text-sm uppercase tracking-wide text-gray-400 mb-3",children:"Business"}),D?A.jsxs("div",{className:"flex flex-col gap-2",children:[re&&A.jsxs("div",{className:"flex flex-col",children:[A.jsx("button",{onClick:()=>{G("/business/product"),a(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:A.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[A.jsx(cx,{className:"text-xl"}),"Product"]})}),A.jsxs("button",{onClick:()=>i(be=>!be),className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[A.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[A.jsx(Cm,{className:"text-xl"}),"Market Space"]}),A.jsx(xf,{className:`text-gray-400 ml-auto transition-transform duration-200 ${w?"rotate-90":""}`})]}),w&&A.jsxs("div",{className:"ml-4 flex flex-col gap-1 mt-1",children:[A.jsxs("button",{onClick:()=>{G("/business/marketspace"),a(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[A.jsx(vy,{className:"text-xl"}),"Manage"]}),A.jsxs("button",{onClick:()=>{G("/business/marketspace/available"),a(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[A.jsx(ux,{className:"text-xl"}),"Available"]}),A.jsxs("button",{onClick:()=>{G("/business/marketspace/application"),a(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[A.jsx(ZO,{className:"text-xl"}),"My Application"]})]}),A.jsx("button",{onClick:()=>{G(`/business/vendor/${X?.user?.id}/statistic`),a(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:A.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[A.jsx(RO,{className:"text-xl"}),"Statistic"]})})]}),fe&&A.jsxs("div",{className:"flex flex-col",children:[A.jsxs("button",{onClick:()=>u(be=>!be),className:"flex justify-between items-center w-full py-2.5 text-gray-800 hover:text-[#FF8225] transition-colors",children:[A.jsxs("div",{className:"flex items-center gap-3 font-medium",children:[A.jsx(Cm,{className:"text-xl"}),"Market"]}),A.jsx(xf,{className:`text-gray-400 ml-auto transition-transform duration-200 ${l?"rotate-90":""}`})]}),l&&A.jsxs("div",{className:"ml-4 flex flex-col gap-1 mt-1",children:[A.jsxs("button",{onClick:()=>{G("/business/market/"),a(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[A.jsx(vy,{className:"text-xl"}),"Manage"]}),A.jsxs("button",{onClick:()=>{G("/business/market/apply"),a(!1)},className:"flex items-center gap-3 text-gray-800 hover:text-[#FF8225] py-2 text-left text-base font-normal",children:[A.jsx(ux,{className:"text-xl"}),"Apply"]})]})]})]}):A.jsx("div",{className:"flex flex-col gap-2",children:A.jsxs("div",{className:"flex items-center gap-3 text-gray-800 py-2 text-left text-base font-medium",children:[A.jsx(VO,{className:"text-xl"}),"Application in Progress"]})})]})]}),A.jsxs("div",{className:"flex items-center gap-2 p-6 text-red-600 hover:text-red-700 cursor-pointer border-t border-gray-100",onClick:le,children:[A.jsx(HO,{className:"text-xl"}),A.jsx("span",{className:"text-sm font-medium",children:"Sign Out"})]})]})]})},a4=({visitorId:s})=>{const[a,l]=pe.useState([]),[u,f]=pe.useState(!0),y="/v1";return pe.useEffect(()=>{(async()=>{try{const C=await(await fetch(`${y}/visitor/${s}/market-history`)).json();l(C||[])}catch(i){console.error("Error fetching visited markets:",i)}finally{f(!1)}})()},[s]),u?A.jsx("p",{className:"text-center text-gray-500",children:"Loading markets..."}):a.length===0?A.jsx("p",{className:"text-center text-gray-500",children:"No visited markets found."}):A.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.map(w=>A.jsx("div",{className:"w-full aspect-square overflow-hidden shadow-sm hover:shadow-md transition cursor-pointer",children:A.jsx("img",{src:w.market_image,alt:w.market_name,className:"w-full h-full object-cover"})},w.market_id))})},XP=({market:s,isVendor:a=!1,onView:l,isOwnProfile:u=!0})=>{const[f,y]=pe.useState(!1);return A.jsxs("div",{className:"relative rounded-xl overflow-hidden shadow-md hover:shadow-lg transition cursor-pointer h-[208px]",children:[A.jsx("img",{src:s.image||s.market_image||"/default-market.png",alt:s.name||s.market_name,className:"w-full h-full object-cover"}),A.jsx("div",{className:"absolute inset-0 bg-black/40"}),!a&&u&&s.application_status==1&&A.jsxs("div",{className:"absolute bottom-2 left-2 right-2 flex justify-between z-10",children:[A.jsxs("div",{className:"flex gap-2",children:[A.jsx($s,{to:`/business/market/${s.id}/space`,onClick:w=>w.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Manage Space",children:A.jsx(vy,{size:20})}),A.jsx($s,{to:`/business/market/${s.id}/review`,onClick:w=>w.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Reviews",children:A.jsx(Ty,{size:20})}),A.jsx($s,{to:`/business/market/${s.id}/statistic`,onClick:w=>w.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Statistics",children:A.jsx(LO,{size:20})})]}),A.jsx($s,{to:`/business/market/${s.id}/edit`,onClick:w=>w.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Edit Market",children:A.jsx(NO,{size:20})})]}),a&&u&&A.jsxs(A.Fragment,{children:[A.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-2 z-10",children:[A.jsxs("div",{className:"flex items-center gap-1 bg-black/60 p-1 rounded-full text-white cursor-default",children:[A.jsx(vy,{size:20}),A.jsx("span",{className:"text-xs font-medium",children:s.available_space})]}),s.schedules?.length>0&&A.jsxs("button",{onClick:w=>{w.stopPropagation(),y(!f)},className:"flex items-center gap-1 bg-black/60 p-1 rounded-full text-white hover:bg-black/80 transition text-xs font-medium",title:"View Schedule",children:[A.jsx(ZM,{size:20}),A.jsx("span",{children:s.schedules.length})]})]}),f&&A.jsxs("div",{className:"absolute bottom-12 left-2 bg-black/80 text-white text-xs rounded p-2 z-20 max-h-40 overflow-y-auto",children:[s.schedules.length>0&&A.jsx("div",{className:"mb-1",children:A.jsx("span",{className:"font-semibold",children:s.schedules[0].recurrence_type})}),s.schedules.map(w=>{const i={1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday",7:"Sunday"},C=D=>{const[$,G,X]=D.split(":").map(Number),te=$>=12?"PM":"AM";return`${$%12===0?12:$%12}:${G.toString().padStart(2,"0")} ${te}`};let P="";return w.daily_day?P=`Every Day ${i[w.daily_day]||""}`:w.weekly_day?P=`${i[w.weekly_day]||""}`:w.monthly_day?P=`Day ${w.monthly_day} of every month`:w.annually_day&&w.annually_month?P=`On ${w.annually_day}/${w.annually_month}`:w.once_date&&(P=w.once_date),A.jsxs("div",{className:"mb-1",children:[A.jsx("div",{children:P}),A.jsxs("div",{children:[C(w.open_time)," - ",C(w.close_time)]})]},w.schedule_id)})]}),A.jsx($s,{to:`/business/market/${s.market_id||s.id}/space`,onClick:w=>w.stopPropagation(),className:"absolute bottom-2 right-2 bg-orange-500 text-white px-3 py-1 rounded-lg font-medium hover:bg-orange-600 transition z-10",title:"View Market",children:"View"})]}),s.application_status!==1&&A.jsxs("div",{className:"absolute bottom-2 left-2 z-10 bg-black/70 text-white text-xs px-3 py-1 rounded-full",children:[s.application_status===2&&"Pending approval",s.application_status===3&&"Rejected"]}),A.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:A.jsx("h3",{className:"text-white font-semibold text-lg drop-shadow text-center px-4 line-clamp-2",children:s.name||s.market_name})})]})},Yp=({loading:s,size:a=10})=>s?A.jsx("div",{className:"w-screen h-screen flex items-center justify-center",children:A.jsx("div",{style:{animationDuration:"1000ms"},className:`w-${a} h-${a} border-4 border-gray-300 border-t-orange-500 rounded-full animate-spin`})}):null,r4="/v1",YP=({organizerId:s,isOwnProfile:a=!1})=>{const[l,u]=pe.useState([]),[f,y]=pe.useState(!0);return Ma(),pe.useEffect(()=>{if(!s)return;(async()=>{try{const i=await fetch(`${r4}/organizer/${s}/market`);if(!i.ok)throw new Error("Failed to fetch markets");const C=await i.json();u(C||[])}catch(i){console.error(i)}finally{y(!1)}})()},[s]),f?A.jsx(Yp,{loading:!0}):A.jsx("div",{className:"flex flex-col gap-3 pb-12",children:l.filter(w=>a||w.application_status!==null).map(w=>A.jsx($s,{to:`/market/${w.id}`,className:"block",children:A.jsx(XP,{market:w,isOwnProfile:a})},w.id))})},s4=()=>{const s=Lr(!0);Ma();const a="/v1",[l,u]=pe.useState([]),[f,y]=pe.useState("main"),[w,i]=pe.useState([]),[C,P]=pe.useState(!0),D=s?.user?.id;pe.useEffect(()=>{if(!D)return;(async()=>{P(!0);try{const te=await fetch(`${a}/visitor/${D}/post`);if(!te.ok)throw new Error("Failed to fetch visitor posts");const le=await te.json();i(le)}catch(te){console.error("[Visitor Posts] Error:",te),i([])}finally{P(!1)}})()},[a,D]),pe.useEffect(()=>{(async()=>{if(!(!s||!s.user))try{const te=await fetch(`${a}/user/${s.user.id}/roles`),le=await te.json();te.ok&&le.roles&&u(le.roles)}catch(te){console.error("Error fetching roles:",te),u([])}})()},[s,a]);const $=!0,G=Array.isArray(w)?w.filter(X=>X.type===1):[];return A.jsxs("div",{className:"relative flex flex-col items-center min-h-screen bg-[#FFFDFA] font-inter",children:[A.jsxs("div",{className:"absolute top-4 w-full px-4 md:px-8 flex justify-between items-center",children:[A.jsx("div",{}),A.jsx(ZP,{})]}),A.jsxs("div",{className:"w-full max-w-5xl mt-16 px-4 md:px-8 pb-10",children:[A.jsx(WP,{userId:D,isOwnProfile:$}),A.jsx("hr",{className:"mt-6 border-gray-200"}),!$,f==="main"&&G.length>0&&A.jsx("div",{className:"mt-6 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 md:gap-4",children:G.map(X=>A.jsx("div",{className:"w-full aspect-square overflow-hidden shadow-sm hover:shadow-md transition cursor-pointer rounded-lg bg-white",onClick:()=>{console.log("Clicked post:",X.id)},children:A.jsx("img",{src:X.image,alt:X.caption||"Visitor post",className:"w-full h-full object-cover"})},X.id))})]})]})},MA=s=>{const a=new Date,l=new Date(s),u=a-l,f=Math.floor(u/(1e3*60)),y=Math.floor(u/(1e3*60*60)),w=Math.floor(u/(1e3*60*60*24)),i=Math.floor(w/7);return f<60?`${f}m ago`:y<24?`${y}h ago`:w<7?`${w}d ago`:`${i}w ago`},o4=({comment:s,onReply:a})=>A.jsxs("div",{className:"w-full py-3",children:[A.jsxs("div",{className:"flex items-start gap-3",children:[A.jsx("img",{src:s.visitor?.image,alt:s.visitor?.username,className:"w-8 h-8 rounded-full object-cover"}),A.jsxs("div",{className:"flex flex-col leading-tight min-w-0",children:[A.jsxs("div",{className:"flex items-end gap-1 text-sm text-gray-800 -mt-1",children:[A.jsx("span",{className:"font-semibold",children:s.visitor?.username}),A.jsx("span",{className:"text-gray-400",children:""}),A.jsx("span",{className:"text-gray-400 text-xs",children:MA(s.created_at)})]}),A.jsx("p",{className:"text-gray-800 text-sm break-words whitespace-normal",children:s.comment}),A.jsx("button",{className:"text-left text-xs text-gray-500 mt-1 hover:underline",onClick:()=>{a&&a(s.id,s.visitor?.username)},children:"Reply"})]})]}),s.replies&&s.replies.length>0&&A.jsx("div",{className:"mt-2 ml-8 border-l border-gray-200 pl-3 flex flex-col gap-3",children:s.replies.map(l=>A.jsxs("div",{className:"py-1",children:[A.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[A.jsx("img",{src:l.visitor?.image,alt:l.visitor?.username,className:"w-6 h-6 rounded-full object-cover"}),A.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-800",children:[A.jsx("span",{className:"font-medium",children:l.visitor?.username}),A.jsx("span",{className:"text-gray-400",children:""}),A.jsx("span",{className:"text-gray-400",children:MA(l.created_at)})]})]}),A.jsx("p",{className:"text-gray-800 text-sm",children:l.reply})]},l.id))})]}),KP=({contentId:s,onClose:a})=>{const l=Ma(),[u,f]=pe.useState(""),[y,w]=pe.useState(""),[i,C]=pe.useState([]),[P,D]=pe.useState(""),G=Lr()?.user?.id,X=async()=>{try{const re=await(await fetch(`/v1/content/${s}/comment`)).json();C(re)}catch(le){console.error("Error fetching comments:",le)}};pe.useEffect(()=>(document.body.style.overflow="hidden",X(),()=>{document.body.style.overflow=""}),[s]);const te=async()=>{if(!G){l("/auth");return}if(P.trim())try{y?await fetch("/v1/content/reply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment_id:y,visitor_id:G,reply:P.trim()})}):await fetch(`/v1/content/${s}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content_id:s,visitor_id:G,comment:P.trim()})}),D(""),w(""),f(""),X()}catch(le){console.error("Error submitting comment or reply:",le)}};return A.jsx("div",{className:"fixed inset-0 z-[9999] flex justify-center items-end bg-black/40",children:A.jsxs("div",{className:"bg-white w-full max-w-lg h-[75vh] rounded-t-2xl flex flex-col overflow-hidden",children:[A.jsxs("div",{className:"p-4 relative border-b border-gray-200",children:[A.jsx("h3",{className:"font-medium text-lg",children:"Comments"}),A.jsx("button",{onClick:a,className:"absolute top-4 right-4 text-gray-600 text-xl",children:""})]}),A.jsx("div",{className:"flex-1 overflow-y-auto px-4",children:i.length===0?A.jsx("p",{className:"text-gray-500 text-sm",children:"No comments yet."}):i.map(le=>A.jsx(o4,{comment:le,onReply:(re,fe)=>{f(fe),w(re)}},le.id))}),A.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-2",children:[A.jsx("input",{type:"text",placeholder:u?`Replying to ${u}`:"Write a comment...",value:P,onChange:le=>D(le.target.value),className:"flex-1 border rounded-full px-4 py-2 text-sm focus:outline-none focus:ring focus:border-orange-500"}),A.jsx("button",{onClick:te,className:"bg-orange-500 text-white px-4 py-2 rounded-full text-sm hover:bg-orange-600 transition",children:"Send"})]})]})})},JP=(s,a="/v1")=>{const[l,u]=pe.useState([]),[f,y]=pe.useState(!0),[w,i]=pe.useState(null);return pe.useEffect(()=>{(async()=>{if(!s?.user){u([]),y(!1);return}try{y(!0),i(null);const P=await fetch(`${a}/user/${s.user.id}/roles`);if(!P.ok)throw new Error("Failed to fetch user roles");const D=await P.json();u(D.roles||[])}catch(P){console.error("Error fetching roles:",P),i(P.message),u([])}finally{y(!1)}})()},[s,a]),{roles:l,loading:f,error:w,isVendor:l.includes("Vendor"),isOrganizer:l.includes("Organizer"),isAdmin:l.includes("Admin")}},l4=s=>{const a=new Date(s),u=new Date-a,f=Math.floor(u/(1e3*60*60*24));if(f===0){const y=Math.floor(u/36e5);if(y===0){const w=Math.floor(u/6e4);return w<=1?"just now":`${w} minutes ago`}return`${y} hours ago`}else return f===1?"Yesterday":a.toLocaleDateString()},c4=({content:s,type:a})=>{const l=Ma(),[u,f]=pe.useState(!1),w=Lr()?.user?.id,[i,C]=pe.useState(!1),[P,D]=pe.useState(!1),[$,G]=pe.useState({total_likes:0,total_comments:0});pe.useEffect(()=>{(async()=>{try{const fe=await fetch(`/v1/content/${s.content_id}/engagement`);if(fe.ok){const xe=await fe.json();G({total_likes:xe.total_likes||0,total_comments:xe.total_comments||0})}}catch(fe){console.error("Error fetching engagement:",fe)}})()},[s.content_id]);const X=async()=>{if(!w){l("/auth");return}try{i?(await fetch(`/v1/user/follow?follower_id=${w}&following_id=${s.visitor_id}`,{method:"DELETE"}),C(!1)):(await fetch("/v1/user/follow",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({follower_id:w,following_id:s.visitor_id})}),C(!0))}catch(re){console.error("Error following/unfollowing:",re)}},te=async()=>{if(!w){l("/auth");return}try{P?(await fetch(`/v1/content/like?visitor_id=${w}&content_id=${s.content_id}`,{method:"DELETE"}),D(!1)):(await fetch("/v1/content/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:w,content_id:s.content_id})}),D(!0))}catch(re){console.error("Error liking/unliking content:",re)}},le=pe.useCallback(async()=>{const re=typeof window<"u"?`${window.location.origin}/community/${s.content_id}`:"",fe=s.market_name||"Check this out",xe=s.caption||"Have a look at this post";try{navigator.share?await navigator.share({title:fe,text:xe,url:re}):await navigator.clipboard.writeText(re)}catch(be){console.error("Error sharing content:",be)}},[s.caption,s.content_id,s.market_name]);return pe.useEffect(()=>{if(!w)return;(async()=>{try{const xe=await(await fetch(`/v1/user/follow?follower_id=${w}&following_id=${s.visitor_id}`)).json();C(xe.length>0)}catch(fe){console.error("Error checking follow status:",fe)}})()},[w,s.visitor_id]),pe.useEffect(()=>{if(!w)return;(async()=>{try{const xe=await(await fetch(`/v1/content/like?visitor_id=${w}&content_id=${s.content_id}`)).json();D(xe.length>0)}catch(fe){console.error("Error checking like status:",fe)}})()},[w,s.content_id]),A.jsxs("div",{className:"bg-[var(--white)] shadow-sm hover:shadow-md transition",children:[A.jsxs("div",{className:"flex items-center justify-between px-4 py-3 gap-3",children:[A.jsx("div",{className:"flex items-center gap-3",children:A.jsxs($s,{to:`/visitor/${s.visitor_id}`,className:"flex items-center gap-3",children:[A.jsx("img",{src:s.visitor_image,alt:s.visitor_username,className:"w-10 h-10 rounded-full object-cover"}),A.jsxs("div",{className:"flex flex-col",children:[A.jsx("span",{className:"font-semibold text-[var(--black)] hover:underline",children:s.visitor_username}),A.jsx("span",{className:"text-xs text-[var(--gray)]",children:l4(s.created_at)})]})]})}),A.jsx("button",{onClick:X,className:`w-30 text-center px-3 py-1 text-sm font-medium rounded-full border transition ${i?"border-[var(--orange)] text-[var(--white)] bg-[var(--orange)] hover:bg-[var(--white)] hover:text-[var(--orange)]":"border-[var(--orange)] text-[var(--orange)] hover:bg-[var(--orange)] hover:text-[var(--white)]"}`,children:i?"Following":"Follow"})]}),a==="Post"&&s.image&&A.jsx("img",{src:s.image,alt:s.title,className:"w-full aspect-square object-cover"}),A.jsxs("div",{className:"px-4 py-3",children:[A.jsx("div",{className:"mb-2 text-sm",children:A.jsx($s,{to:`/market/${s.market_id}`,className:"font-medium text-[var(--orange)] hover:underline",children:s.market_name})}),A.jsx("p",{className:"text-[var(--black)] text-sm mt-1",children:s.caption}),A.jsxs("div",{className:"mt-2 text-xs text-[var(--gray)] flex gap-4",children:[A.jsxs("span",{children:[$.total_likes," Likes"]}),A.jsxs("span",{children:[$.total_comments," Comments"]})]})]}),A.jsxs("div",{className:"px-4 py-2 border-t border-gray-200 flex justify-around text-[var(--black)] text-sm",children:[A.jsxs("button",{onClick:te,className:"flex items-center gap-1  hover:text-[var(--orange)] transition",children:[P?A.jsx($M,{className:"text-lg text-red-500"}):A.jsx(KM,{className:"text-lg text-gray-600 hover:text-orange-500"}),"Like"]}),A.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[A.jsx(GS,{className:"text-lg"})," Comment"]}),A.jsxs("button",{onClick:le,className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[A.jsx(tP,{className:"text-lg"})," Share"]})]}),u&&A.jsx(KP,{contentId:s.content_id,onClose:()=>f(!1)})]})},u4=s=>{if(!s)return"";const a=new Date(s),u=new Date-a,f=Math.floor(u/(1e3*60*60*24));if(f===0){const y=Math.floor(u/36e5);if(y===0){const w=Math.floor(u/6e4);return w<=1?"just now":`${w} minutes ago`}return`${y} hours ago`}else return f===1?"Yesterday":a.toLocaleDateString()},d4=({content:s})=>{const l=Lr()?.user?.id,[u,f]=pe.useState(!1),[y,w]=pe.useState(!1),[i,C]=pe.useState({total_likes:0,total_comments:0}),P=s?.content_id||s?.id;pe.useEffect(()=>{if(!P)return;(async()=>{try{const xe=await fetch(`/v1/content/${P}/engagement`);if(xe.ok){const be=await xe.json();C({total_likes:be.total_likes||0,total_comments:be.total_comments||0})}}catch(xe){console.error("Error fetching engagement:",xe)}})()},[P]),pe.useEffect(()=>{if(!l||!P)return;(async()=>{try{const be=await(await fetch(`/v1/content/like?visitor_id=${l}&content_id=${P}`)).json();w(Array.isArray(be)?be.length>0:!1)}catch(xe){console.error("Error checking like status:",xe)}})()},[l,P]);const D=async()=>{if(!(!l||!P))try{y?(await fetch(`/v1/content/like?visitor_id=${l}&content_id=${P}`,{method:"DELETE"}),w(!1),C(fe=>({...fe,total_likes:Math.max(0,fe.total_likes-1)}))):(await fetch("/v1/content/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:l,content_id:P})}),w(!0),C(fe=>({...fe,total_likes:fe.total_likes+1})))}catch(fe){console.error("Error liking/unliking content:",fe)}},$=pe.useCallback(async()=>{const fe=typeof window<"u"?`${window.location.origin}/community/${P}`:"",xe=s?.title||"Check this forum",be=s?.caption||"Have a look at this forum";try{navigator.share?await navigator.share({title:xe,text:be,url:fe}):(await navigator.clipboard.writeText(fe),alert("Link copied to clipboard"))}catch(Ne){console.error("Error sharing content:",Ne)}},[s?.caption,s?.title,P]),G=s?.market_name,X=s?.title||"Forum",te=s?.caption||"",le=u4(s?.created_at),re=s?.visitor_username||s?.visitor_name||"";return A.jsxs("div",{className:"bg-[var(--white)] shadow-sm hover:shadow-md transition rounded-lg border border-gray-100",children:[A.jsxs("div",{className:"px-4 py-3 flex items-start justify-between gap-3",children:[A.jsxs("div",{className:"flex flex-col gap-1",children:[G&&A.jsx($s,{to:`/market/${s?.market_id??""}`,className:"text-xs font-semibold text-[var(--orange)] uppercase tracking-wide hover:underline",children:G}),A.jsx("h3",{className:"text-base font-semibold text-[var(--black)]",children:X})]}),re&&A.jsxs("div",{className:"text-xs text-[var(--gray)] whitespace-nowrap",children:["Posted by @",re]})]}),te&&A.jsx("div",{className:"px-4 pb-3 text-sm text-[var(--black)]",children:A.jsx("p",{children:te})}),A.jsxs("div",{className:"px-4 pb-2 text-xs text-[var(--gray)] flex items-center justify-between",children:[A.jsxs("div",{className:"flex gap-4",children:[A.jsxs("span",{children:[i.total_likes," Likes"]}),A.jsxs("span",{children:[i.total_comments," Comments"]})]}),le&&A.jsx("div",{className:"whitespace-nowrap",children:le})]}),A.jsxs("div",{className:"px-4 py-2 border-t border-gray-200 flex justify-around text-sm text-[var(--gray)]",children:[A.jsxs("button",{onClick:D,className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[y?A.jsx($M,{className:"text-lg text-red-500"}):A.jsx(KM,{className:"text-lg"}),"Like"]}),A.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[A.jsx(GS,{className:"text-lg"}),"Comment"]}),A.jsxs("button",{onClick:$,className:"flex items-center gap-1 hover:text-[var(--orange)] transition",children:[A.jsx(tP,{className:"text-lg"}),"Share"]})]}),u&&A.jsx(KP,{contentId:P,onClose:()=>f(!1)})]})},h4=()=>A.jsxs("div",{className:"bg-[var(--white)] shadow-sm hover:shadow-md transition animate-pulse mb-2",children:[A.jsxs("div",{className:"flex items-center justify-between px-4 py-3 gap-3",children:[A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200"}),A.jsxs("div",{className:"flex flex-col gap-1",children:[A.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded"}),A.jsx("div",{className:"w-16 h-3 bg-gray-200 rounded"})]})]}),A.jsx("div",{className:"w-20 h-6 bg-gray-200 rounded-full"})]}),A.jsx("div",{className:"w-full h-48 bg-gray-200"}),A.jsxs("div",{className:"px-4 py-3 space-y-2",children:[A.jsx("div",{className:"w-32 h-3 bg-gray-200 rounded"}),A.jsx("div",{className:"w-full h-3 bg-gray-200 rounded"}),A.jsx("div",{className:"w-3/4 h-3 bg-gray-200 rounded"}),A.jsxs("div",{className:"mt-2 flex gap-4",children:[A.jsx("div",{className:"w-12 h-3 bg-gray-200 rounded"}),A.jsx("div",{className:"w-16 h-3 bg-gray-200 rounded"})]})]}),A.jsxs("div",{className:"px-4 py-2 border-t border-gray-200 flex justify-around text-gray-600 text-sm",children:[A.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"}),A.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"}),A.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]})]}),f4=()=>{const[s,a]=pe.useState("Explore"),[l,u]=pe.useState("Latest"),[f,y]=pe.useState([]),[w,i]=pe.useState(!0),C=["Explore","Following","Forum"],P=["Latest","Popular"],D=Ma(),G=Lr(!1)?.user?.id,X="/v1",te=()=>{G||D("/auth"),s==="Forum"&&G?D("/community/add?type=forum"):s!=="Forum"&&G&&D("/community/add?type=post")};pe.useEffect(()=>{if(!s)return;(async()=>{i(!0);try{let fe="";if(s==="Explore")fe=`${X}/content/post/`;else if(s==="Following"){if(!G){y([]),i(!1);return}fe=`${X}/content/post?visitor_id=${G}`}else if(s==="Forum")fe=`${X}/content/forum/`;else{y([]),i(!1);return}const xe=await fetch(fe);if(!xe.ok)throw new Error("Failed to fetch content");const be=await xe.json();y(be)}catch(fe){console.error(fe),y([])}finally{i(!1)}})()},[s,G,X]);const le=pe.useMemo(()=>{if(!f)return[];const re=[...f];return l==="Latest"?re.sort((fe,xe)=>new Date(xe.created_at)-new Date(fe.created_at)):l==="Popular"&&re.sort((fe,xe)=>(xe.total_likes||0)-(fe.total_likes||0)),re},[f,l]);return A.jsxs("div",{className:"min-h-screen",children:[A.jsx("nav",{className:"bg-[var(--white)] px-6 py-3 flex justify-center space-x-8 sticky top-0 z-50",children:C.map(re=>A.jsxs("button",{onClick:()=>a(re),className:"relative text-[var(--black)] font-medium text-sm transition-colors hover:text-[var(--orange)]",children:[re,A.jsx("span",{className:`absolute left-0 -bottom-1 h-0.5 w-full bg-[var(--orange)] transition-all ${s===re?"scale-x-100":"scale-x-0"}`,style:{transformOrigin:"left"}})]},re))}),A.jsxs("div",{className:"bg-[var(--white)] shadow-sm px-6 py-3 flex justify-between items-center",children:[A.jsx("div",{className:"flex items-center gap-2 text-[var(--black)] relative",children:A.jsxs("div",{className:"flex items-center border border-[var(--black)] rounded-md px-2 py-1.5 bg-[var(--white)]",children:[A.jsx(VS,{className:"text-lg mr-1"}),A.jsx("select",{value:l,onChange:re=>u(re.target.value),className:"appearance-none bg-transparent outline-none text-sm text-[var(--black)] cursor-pointer",children:P.map(re=>A.jsx("option",{value:re,children:re},re))})]})}),A.jsxs("button",{onClick:te,className:"flex items-center gap-1 bg-[var(--orange)] hover:bg-[var(--orange)] text-[var(--white)] text-sm font-medium px-3 py-1.5 rounded-full shadow-sm transition",children:[A.jsx(ux,{className:"text-lg"}),s==="Forum"?"New Forum":"New Post"]})]}),A.jsx("div",{className:"space-y-4 pb-20 mt-2 flex flex-col items-center",children:w?Array.from({length:5}).map((re,fe)=>A.jsx("div",{className:"w-full max-w-xl",children:A.jsx(h4,{})},fe)):f.length===0?A.jsx("div",{className:"p-4 text-[var(--gray)] w-full text-center max-w-xl",children:"No content available."}):le.map(re=>A.jsx("div",{className:"w-full max-w-xl",children:s==="Forum"?A.jsx(d4,{content:re}):A.jsx(c4,{content:re,type:s==="Forum"?"Forum":"Post"})},re.id))})]})},m4=({onChange:s,role:a})=>{const[l,u]=pe.useState({userType:a,fullName:"",nric:"",businessName:"",businessLicense:""}),f=y=>{const w={...l,[y.target.name]:y.target.value};u(w),s&&s(w)};return A.jsx("div",{className:"flex flex-col items-center font-inter w-full",children:A.jsxs("div",{className:"flex flex-col gap-3 w-[300px]",children:[A.jsxs("div",{className:"w-full",children:[A.jsx("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name (as per NRIC)"}),A.jsx("input",{id:"fullName",type:"text",name:"fullName",value:l.fullName,onChange:f,placeholder:"Enter your full name",className:"w-full h-[40px] border border-gray-300 rounded-xl px-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]",required:!0})]}),A.jsxs("div",{className:"w-full",children:[A.jsx("label",{htmlFor:"nric",className:"block text-sm font-medium text-gray-700 mb-1",children:"National ID (NRIC)"}),A.jsx("input",{id:"nric",type:"text",name:"nric",value:l.nric,onChange:f,placeholder:"e.g. 980101-14-5678",className:"w-full h-[40px] border border-gray-300 rounded-xl px-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]",required:!0})]}),A.jsxs("div",{className:"w-full",children:[A.jsx("label",{htmlFor:"businessName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name"}),A.jsx("input",{id:"businessName",type:"text",name:"businessName",value:l.businessName,onChange:f,placeholder:"Enter your business name",className:"w-full h-[40px] border border-gray-300 rounded-xl px-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]",required:!0})]}),A.jsxs("div",{className:"w-full",children:[A.jsx("label",{htmlFor:"businessLicense",className:"block text-sm font-medium text-gray-700 mb-1",children:"Business License"}),A.jsx("input",{id:"businessLicense",type:"text",name:"businessLicense",value:l.businessLicense,onChange:f,placeholder:"Enter your license number",className:"w-full h-[40px] border border-gray-300 rounded-xl px-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF8225]",required:!0})]})]})})},p4=({onChange:s})=>{const[a,l]=pe.useState({icFront:null,icBack:null,businessLicenseFile:null}),u=w=>{const{name:i,files:C}=w.target,P={...a,[i]:C[0]};l(P),s&&s(P)},f=w=>{const i={...a,[w]:null};l(i),s&&s(i)},y=(w,i,C,P,D)=>A.jsxs("div",{className:`w-full border rounded-xl p-4 flex justify-between items-center transition-all duration-300 ${a[C]?"border-[#FF8225]":"border-gray-200"}`,children:[A.jsxs("div",{className:"flex flex-col text-left",children:[A.jsx("label",{htmlFor:w,className:"text-sm font-medium text-gray-700 mb-1",children:i}),A.jsx("span",{className:"text-xs text-gray-400",children:D})]}),A.jsx("div",{className:"flex items-center justify-center",children:a[C]?A.jsx("button",{onClick:()=>f(C),className:"w-[100px] h-[36px] rounded-lg bg-red-500 text-white text-sm font-medium hover:bg-red-600 transition-all",children:"Remove"}):A.jsxs(A.Fragment,{children:[A.jsx("input",{type:"file",id:w,name:C,accept:P,onChange:u,className:"hidden"}),A.jsx("label",{htmlFor:w,className:"w-[100px] h-[36px] flex items-center justify-center rounded-lg bg-[#FF8225] text-white text-sm font-medium hover:bg-[#e9711c] cursor-pointer transition-all",children:"Add"})]})})]});return A.jsx("div",{className:"flex flex-col items-center font-inter w-full",children:A.jsxs("div",{className:"flex flex-col gap-4 w-[300px]",children:[y("icFront","Upload NRIC (Front)","icFront","image/*","Image only (PNG, JPG)"),y("icBack","Upload NRIC (Back)","icBack","image/*","Image only (PNG, JPG)"),y("businessLicenseFile","Upload Business License","businessLicenseFile",".pdf,image/*","PDF or Image (max 5MB)")]})})},g4=({onChange:s,user_id:a})=>{const[l,u]=pe.useState(null),[f,y]=pe.useState({profilePicture:null,username:"",password:""}),w=P=>{const{files:D}=P.target,$={...f,profilePicture:D[0]};y($),s&&s($)},i=()=>{const P={...f,profilePicture:null};y(P),s&&s(P)},C=P=>{const{value:D}=P.target,$={...f,username:D};y($),s&&s($)};return pe.useEffect(()=>{if(!a)return;(async()=>{try{const $=await(await fetch(`/v1/visitor/${a}`)).json();u($);const G={profilePicture:$.image||null,username:$.username||""};y(G),s&&s(G)}catch(D){console.error(" Failed to fetch visitor:",D)}})()},[a]),A.jsx("div",{className:"flex flex-col items-center font-inter w-full",children:A.jsxs("div",{className:"flex flex-col gap-4 w-[300px]",children:[A.jsxs("div",{className:"w-full flex flex-col items-center",children:[A.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-100 mb-6 flex items-center justify-center overflow-hidden",children:f.profilePicture?A.jsx("img",{src:l.image,alt:"Profile",className:"w-full h-full object-cover"}):A.jsx("span",{className:"text-gray-400 text-xs",children:"Preview"})}),A.jsxs("div",{className:`w-full border rounded-xl p-4 flex justify-between items-center transition-all duration-300 ${f.profilePicture?"border-[#FF8225]":"border-gray-200"}`,children:[A.jsxs("div",{className:"flex flex-col text-left",children:[A.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Profile Picture"}),A.jsx("span",{className:"text-xs text-gray-400",children:"Image only (PNG, JPG)"})]}),A.jsx("div",{className:"flex items-center justify-center",children:f.profilePicture?A.jsx("button",{onClick:i,className:"w-[100px] h-[36px] rounded-lg bg-red-500 text-white text-sm font-medium hover:bg-red-600 transition-all",children:"Remove"}):A.jsxs(A.Fragment,{children:[A.jsx("input",{type:"file",accept:"image/*",onChange:w,className:"hidden",id:"profilePicture"}),A.jsx("label",{htmlFor:"profilePicture",className:"w-[100px] h-[36px] flex items-center justify-center rounded-lg bg-[#FF8225] text-white text-sm font-medium hover:bg-[#e9711c] cursor-pointer transition-all",children:"Add"})]})})]})]}),A.jsxs("div",{className:"w-full flex flex-col",children:[A.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Username"}),A.jsx("input",{type:"text",placeholder:"Enter your username",value:f.username,onChange:C,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-[#FF8225]"})]})]})})},PA="/v1",_4=()=>{const{role:s}=ul(),a=Lr(!1),l=Ma(),[u,f]=pe.useState(1),[y,w]=pe.useState({}),[i,C]=pe.useState({}),[P,D]=pe.useState({}),[$,G]=pe.useState(!1),X=y.fullName?.trim()&&y.nric?.trim()&&y.businessName?.trim()&&y.businessLicense?.trim(),te=i.icFront&&i.icBack&&i.businessLicenseFile,le=P.username?.trim(),re=()=>f(Ne=>Math.min(Ne+1,3)),fe=()=>f(Ne=>Math.max(Ne-1,1)),xe=async()=>{if(!a){alert("You must be logged in to register a business.");return}try{G(!0);const Ne={id:a.user.id,name:y.businessName,license:y.businessLicense},Be=y.userType?.toLowerCase()==="vendor"?"vendor":"organizer",Ee=`${PA}/${Be}`,et=await fetch(Ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ne)});if(!et.ok){const pt=await et.json().catch(()=>({}));throw new Error(pt.message||"Registration failed")}const at=await et.json();alert(`${Be.charAt(0).toUpperCase()+Be.slice(1)} registration complete!`);const He={...y,...i,...P},lt={...He,user_id:a.user.id,email:a.user.email};if(i.icFront||i.icBack||i.businessLicenseFile){const pt=[{key:"nricFront",file:i.icFront},{key:"nricBack",file:i.icBack},{key:"license",file:i.businessLicenseFile}];for(const Zt of pt){if(!Zt.file)continue;const jt=`${Be}s/${a.user.id}/${Zt.key}.jpg`,{error:Di}=await Vs.storage.from("tamulokal-private").upload(jt,Zt.file,{cacheControl:"3600",upsert:!0,contentType:Zt.file.type});if(Di)throw Di}}if(P.profilePicture){const pt=at.id||at[Be]?.id||a.user.id,Zt=He.profilePicture,jt=`visitors/${pt}/${pt}}.jpg`,{data:Di,error:Pi}=await Vs.storage.from("tamulokal").upload(jt,Zt,{cacheControl:"3600",upsert:!0,contentType:Zt.type});if(!Pi){const{data:qe}=Vs.storage.from("tamulokal").getPublicUrl(jt),wt=qe.publicUrl;await fetch(`${PA}/${Be}/${pt}/image`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:wt})})}}l("/profile")}catch(Ne){alert("Registration failed: "+Ne.message)}finally{G(!1)}},be=[{number:1,title:"Identification"},{number:2,title:"Verification"},{number:3,title:"Finish"}];return A.jsxs("div",{className:"flex flex-col items-center w-full min-h-screen font-inter  md:bg-gray-50",children:[A.jsxs("div",{className:"fixed top-0 w-full flex flex-col items-center pb-2 pt-5 z-20",children:[A.jsxs("h1",{className:"text-base font-semibold text-[var(--black)] mb-4",children:[s=="vendor"?"Vendor ":"Organizer "," Registration"]}),A.jsx("div",{className:"relative flex items-center justify-center w-full max-w-[300px] md:max-w-lg",children:be.map((Ne,Be)=>A.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center relative",children:[Be<be.length-1&&A.jsx("div",{className:`absolute top-1/3 left-1/2 right-[-50%] h-[2px] 
                              ${u>Ne.number?"bg-[#FF8225]":"bg-gray-300"} 
                              -translate-y-1/2 transition-all duration-500 z-0`}),A.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center text-xs font-medium transition-all duration-300 z-10
                  ${u===Ne.number?"border-[#FF8225] text-[#FF8225] bg-[var(--white)]":u>Ne.number?"border-[#FF8225] bg-[#FF8225] text-white":"border-gray-300 text-gray-400 bg-[var(--white)]"}`,children:Ne.number}),A.jsx("span",{className:`text-[10px] mt-1 ${u===Ne.number?"text-[#FF8225] font-medium":"text-gray-400"}`,children:Ne.title})]},Ne.number))})]}),A.jsx("div",{className:`\r
          mt-[140px] w-full px-0 flex justify-center\r
        `,children:A.jsxs("div",{className:`\r
          w-full max-w-[340px] md:max-w-xl\r
          md:rounded-2xl md:shadow-sm\r
          md:p-8 md:mt-8 md:mb-4\r
          flex flex-col\r
        `,children:[u===1&&A.jsx(m4,{onChange:w,role:s}),u===2&&A.jsx(p4,{onChange:C}),u===3&&A.jsx(g4,{onChange:D,user_id:a?.user?.id})]})}),A.jsx("div",{className:"fixed bottom-0 w-full flex flex-col items-center pb-5 pt-3 z-20 bg-white md:hidden",children:A.jsx("div",{className:"flex flex-col w-[300px] gap-2",children:u<3?A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:re,disabled:u===1&&!X||u===2&&!te,className:`h-[40px] rounded-xl font-medium text-sm w-full transition-colors
                  ${u===1&&!X||u===2&&!te?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#FF8225] text-white hover:bg-[#e6731f]"}`,children:"Next"}),u===1&&A.jsx("button",{onClick:()=>l("/profile"),className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                    font-medium text-sm hover:bg-gray-50 transition-colors w-full`,children:"Cancel"}),u===2&&A.jsx("button",{onClick:fe,className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                    font-medium text-sm hover:bg-gray-50 transition-colors w-full`,children:"Back"})]}):A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:xe,disabled:$||!le,className:`h-[40px] rounded-xl font-medium text-sm w-full ${$||!le?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-[#FF8225] text-white hover:bg-[#e6731f] transition-colors"}`,children:$?"Submitting...":"Finish"}),A.jsx("button",{onClick:fe,className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                  font-medium text-sm hover:bg-gray-50 transition-colors w-full`,children:"Back"})]})})}),A.jsx("div",{className:"hidden md:flex w-full justify-center mt-0 mb-10",children:A.jsx("div",{className:"flex flex-row w-full max-w-xl gap-2",children:u<3?A.jsxs(A.Fragment,{children:[u===1&&A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:()=>l("/profile"),className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                      font-medium text-sm hover:bg-gray-50 transition-colors w-full max-w-[180px]`,children:"Cancel"}),A.jsx("div",{className:"flex-1"}),A.jsx("button",{onClick:re,disabled:!X,className:`h-[40px] rounded-xl font-medium text-sm w-full max-w-[180px] transition-colors
                      ${X?"bg-[#FF8225] text-white hover:bg-[#e6731f]":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"})]}),u===2&&A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:fe,className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                      font-medium text-sm hover:bg-gray-50 transition-colors w-full max-w-[180px]`,children:"Back"}),A.jsx("div",{className:"flex-1"}),A.jsx("button",{onClick:re,disabled:!te,className:`h-[40px] rounded-xl font-medium text-sm w-full max-w-[180px] transition-colors
                      ${te?"bg-[#FF8225] text-white hover:bg-[#e6731f]":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"})]})]}):A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:fe,className:`h-[40px] rounded-xl border border-gray-300 text-gray-700\r
                  font-medium text-sm hover:bg-gray-50 transition-colors w-full max-w-[180px]`,children:"Back"}),A.jsx("div",{className:"flex-1"}),A.jsx("button",{onClick:xe,disabled:$||!le,className:`h-[40px] rounded-xl font-medium text-sm w-full max-w-[180px] ${$||!le?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-[#FF8225] text-white hover:bg-[#e6731f] transition-colors"}`,children:$?"Submitting...":"Finish"})]})})})]})},y4=()=>{const s=Ma(),a=Lr(!0),{id:l}=ul();if(!a)return null;const u=l||a.user.id;return A.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[A.jsx("div",{className:"px-4 py-4",children:A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("button",{onClick:()=>s("/profile"),className:"text-gray-700 hover:text-orange-500 transition",children:A.jsx(Mm,{className:"text-2xl"})}),A.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Manage Products"})]})}),A.jsx("main",{className:"p-4",children:A.jsx(KS,{vendorId:u,isOwnProfile:!0})})]})},jA=({label:s,value:a,onChange:l,disabled:u})=>A.jsxs("div",{children:[A.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:s}),A.jsx("input",{type:"time",value:a||"08:00",onChange:l,className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded",disabled:u})]}),Dv=({sameOperatingHours:s,onToggle:a})=>A.jsxs("div",{className:"flex items-center",children:[A.jsx("span",{className:"text-sm text-gray-600 mr-2",children:"Same hours"}),A.jsx("button",{type:"button",onClick:a,className:`relative inline-flex h-6 w-11 items-center rounded-full ${s?"bg-orange-500":"bg-gray-300"}`,children:A.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full  transition ${s?"translate-x-6":"translate-x-1"}`})})]}),V0=({onClick:s})=>A.jsx("button",{type:"button",onClick:s,className:"text-red-500 text-sm",children:"Remove"}),L1=({onClick:s,label:a})=>A.jsxs("button",{type:"button",onClick:s,className:"text-sm text-orange-600 hover:text-orange-700",children:["+ ",a]}),Ov=({title:s,children:a})=>A.jsxs("div",{className:"flex justify-between items-center",children:[A.jsx("h3",{className:"text-sm font-medium text-gray-700",children:s}),a]}),v4=({market:s=null,organizerId:a,onClose:l,setLoading:u})=>{const f=Ma(),y=Ay(),w=!!s,[i,C]=pe.useState(!1),[P,D]=pe.useState(!1),[$,G]=pe.useState(null),[X,te]=pe.useState(null),[le,re]=pe.useState(""),[fe,xe]=pe.useState(""),[be,Ne]=pe.useState(""),[Be,Ee]=pe.useState(1),[et,at]=pe.useState([]),[He,lt]=pe.useState(),pt=pe.useRef(null),Zt=pe.useRef(null),jt="/v1",Di=[{id:1,title:"Daily"},{id:2,title:"Weekly"},{id:3,title:"Monthly"},{id:4,title:"Annually"},{id:5,title:"Once"}],Pi=[{id:7,name:"Sunday"},{id:1,name:"Monday"},{id:2,name:"Tuesday"},{id:3,name:"Wednesday"},{id:4,name:"Thursday"},{id:5,name:"Friday"},{id:6,name:"Saturday"}],qe=[{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}],wt=(Ui,Ii)=>Be===1?et.find(nn=>nn.daily_day===Ii)||{}:et[Ui]||{},Ct=Ui=>Pi.find(Ii=>Ii.id===Ui)?.name||"Day",Vi=Ui=>{const Ii={open_time:et.length>0&&P?et[0].open_time:"08:00",close_time:et.length>0&&P?et[0].close_time:"17:00"};switch(Ui){case"monthly":return{...Ii,monthly_day:et.length+1};case"annually":return{...Ii,annually_month:1,annually_day:1};case"once":return{...Ii,once_date:new Date().toISOString().split("T")[0]};default:return Ii}},Qe=()=>{if(y&&y.length>0&&y[0]){const Ui={lat:y[0],lng:y[1]};lt(Ui),pt.current&&(pt.current.setView([Ui.lat,Ui.lng],13),Zt.current&&Zt.current.setLatLng([Ui.lat,Ui.lng]))}};pe.useEffect(()=>{s&&(re(s.name||""),xe(s.description||""),Ne(s.address||""),Ee(s.recurrence_type||s.frequency||1),te(s.image||null),lt({lat:s.latitude||5.975,lng:s.longitude||116.072}),s.id&&St(s.id))},[s]);const St=async Ui=>{try{const Ii=await fetch(`${jt}/market/${Ui}/schedule`);if(Ii.ok){const nn=await Ii.json();if(at(nn),nn.length>0){const mn=nn[0],cn=nn.every(Tn=>Tn.open_time===mn.open_time&&Tn.close_time===mn.close_time);D(cn)}}}catch(Ii){console.error("Failed to load schedules:",Ii)}};pe.useEffect(()=>{!He&&!w&&y&&y.length>0&&y[0]&&lt({lat:y[0],lng:y[1]})},[y,He,w]),pe.useEffect(()=>{if(!He||!document.getElementById("map-picker"))return;pt.current&&(pt.current.remove(),pt.current=null,Zt.current=null);const Ii=xu.map("map-picker").setView([He.lat,He.lng],13);return pt.current=Ii,xu.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(Ii),Zt.current=xu.marker([He.lat,He.lng]).addTo(Ii),Ii.on("click",nn=>{const{lat:mn,lng:cn}=nn.latlng;lt({lat:mn,lng:cn}),Zt.current&&Zt.current.setLatLng([mn,cn])}),()=>{pt.current&&(pt.current.remove(),pt.current=null)}},[He]),pe.useEffect(()=>{pt.current&&setTimeout(()=>{pt.current.invalidateSize(),pt.current.setView([He.lat,He.lng],13),Zt.current&&Zt.current.setLatLng([He.lat,He.lng])},100)},[He]),pe.useEffect(()=>()=>{pt.current&&(pt.current.remove(),pt.current=null)},[]),pe.useEffect(()=>{et.length===0&&!w&&Ht()},[Be]);const Ht=()=>{let Ui=[];switch(Be){case 1:Ui=Pi.map(mn=>({daily_day:mn.id,open_time:"08:00",close_time:"17:00"}));break;case 2:Ui=Pi.map(mn=>({weekly_day:mn.id,open_time:"08:00",close_time:"17:00",is_active:!0}));break;case 3:Ui=[{monthly_day:1,open_time:"08:00",close_time:"17:00"}];break;case 4:Ui=[{annually_month:1,annually_day:1,open_time:"08:00",close_time:"17:00"}];break;case 5:Ui=[{once_date:new Date().toISOString().split("T")[0],open_time:"08:00",close_time:"17:00"}];break}at(Ui)},Ft=Ui=>{const Ii=Ui.target.files[0];Ii&&(G(Ii),te(URL.createObjectURL(Ii)))},_i=(Ui,Ii,nn)=>{const mn=[...et];mn[Ui]={...mn[Ui],[Ii]:nn},P&&(Ii==="open_time"||Ii==="close_time")&&mn.forEach((cn,Tn)=>{Tn!==Ui&&(mn[Tn]={...cn,[Ii]:nn})}),at(mn)},At=Ui=>{at([...et,Vi(Ui)])},Xt=Ui=>{if(et.length<=1)return;const Ii=[...et];Ii.splice(Ui,1),at(Ii)},yn=Ui=>{const Ii=et.findIndex(nn=>nn.weekly_day===Ui);if(Ii>=0){const nn=[...et];nn.splice(Ii,1),at(nn)}else{const nn={weekly_day:Ui,open_time:et.length>0&&P?et[0].open_time:"08:00",close_time:et.length>0&&P?et[0].close_time:"17:00"};at([...et,nn])}},fn=()=>{const Ui=!P;if(D(Ui),Ui&&et.length>0){const Ii=et[0],nn=et.map(mn=>({...mn,open_time:Ii.open_time||"08:00",close_time:Ii.close_time||"17:00"}));at(nn)}},pn=async Ui=>{Ui.preventDefault();try{u(!0);let Ii,nn=null;if(et.length>0){const cn=[];et.forEach(Tn=>{if(Be===5&&Tn.once_date)cn.push(new Date(Tn.once_date));else if(Be===4&&Tn.annually_month&&Tn.annually_day){const Da=new Date;cn.push(new Date(Da.getFullYear(),Tn.annually_month-1,Tn.annually_day))}else if(Be===3&&Tn.monthly_day){const Da=new Date;cn.push(new Date(Da.getFullYear(),Da.getMonth(),Tn.monthly_day))}}),cn.length>0?nn=new Date(Math.min(...cn.map(Da=>Da.getTime()))).toISOString().split("T")[0]:nn=new Date().toISOString().split("T")[0]}const mn={organizer_id:a,name:le,description:fe,address:be,recurrence_type:parseInt(Be,10),latitude:He.lat,longitude:He.lng,image:null,start_date:nn};if(w){const cn=await fetch(`${jt}/market/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(mn)});if(!cn.ok)throw new Error("Failed to update market");Ii=(await cn.json()).id}else{const cn=await fetch(`${jt}/market`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(mn)});if(!cn.ok)throw new Error("Failed to add market");Ii=(await cn.json()).id}if($){const cn=await createImageBitmap($),Tn=document.createElement("canvas");Tn.width=cn.width,Tn.height=cn.height,Tn.getContext("2d").drawImage(cn,0,0);const Hc=await new Promise(Hr=>Tn.toBlob(Hr,"image/jpeg",.9)),Xo=`organizers/${a||s.organizer_id}/${Ii}.jpg`,{error:Hs}=await Vs.storage.from("tamulokal").upload(Xo,Hc,{contentType:"image/jpeg",upsert:!0});if(Hs)throw Hs;const{data:{publicUrl:ws}}=Vs.storage.from("tamulokal").getPublicUrl(Xo);if(!(await fetch(`${jt}/market/${Ii}/image`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:ws})})).ok)throw new Error("Failed to update market image")}await sn(Ii),w?l():f(`/business/market/${Ii}/plan`)}catch(Ii){console.error(Ii),alert(w?"Failed to update market":"Failed to add market")}finally{u(!1)}},sn=async Ui=>{try{const Ii=et.map(cn=>{const Tn={market_id:Ui,open_time:cn.open_time,close_time:cn.close_time};return Be===1&&(Tn.daily_day=cn.daily_day),Be===2&&(Tn.weekly_day=cn.weekly_day),Be===3&&(Tn.monthly_day=cn.monthly_day),Be===4&&(Tn.annually_month=cn.annually_month,Tn.annually_day=cn.annually_day),Be===5&&(Tn.once_date=cn.once_date),Tn});w&&await fetch(`${jt}/market/${Ui}/schedule`,{method:"DELETE"});const nn=await fetch(`${jt}/market/${Ui}/schedule`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schedules:Ii})});if(!nn.ok)throw new Error("Failed to save schedules");const mn=await nn.json()}catch(Ii){throw console.error("Error saving schedules:",Ii),Ii}},Un=()=>{const Ui=(nn,mn)=>A.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[A.jsx(jA,{label:"Open Time",value:nn.open_time,onChange:cn=>_i(mn,"open_time",cn.target.value),disabled:P&&mn>0}),A.jsx(jA,{label:"Close Time",value:nn.close_time,onChange:cn=>_i(mn,"close_time",cn.target.value),disabled:P&&mn>0})]}),Ii=nn=>P&&nn===0&&A.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Changes here apply to all"});switch(Be){case 1:return A.jsxs("div",{className:"space-y-4",children:[A.jsx(Ov,{title:"Daily Schedule",children:A.jsx(Dv,{sameOperatingHours:P,onToggle:fn})}),Pi.map((nn,mn)=>{const cn=wt(mn,nn.id);return A.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[A.jsx("div",{className:"flex justify-between items-center mb-2",children:A.jsx("span",{className:"font-medium text-sm",children:nn.name})}),Ui(cn,mn),Ii(mn)]},nn.id)})]});case 2:return A.jsxs("div",{className:"space-y-4",children:[A.jsx(Ov,{title:"Weekly Schedule",children:A.jsx(Dv,{sameOperatingHours:P,onToggle:fn})}),A.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:Pi.map(nn=>{const mn=et.some(cn=>cn.weekly_day===nn.id);return A.jsx("button",{type:"button",onClick:()=>yn(nn.id),className:`px-3 py-1 rounded-full text-sm border ${mn?"bg-orange-100 border-orange-400 text-orange-700":"bg-gray-100 border-gray-300 text-gray-600"}`,children:nn.name.substring(0,3)},nn.id)})}),et.sort((nn,mn)=>(nn.weekly_day||0)-(mn.weekly_day||0)).map((nn,mn)=>{const cn=et.findIndex(Tn=>Tn.weekly_day===nn.weekly_day);return A.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[A.jsxs("div",{className:"flex justify-between items-center mb-2",children:[A.jsx("span",{className:"font-medium text-sm",children:Ct(nn.weekly_day)}),A.jsx(V0,{onClick:()=>Xt(cn)})]}),Ui(nn,cn),Ii(cn)]},nn.weekly_day||mn)})]});case 3:return A.jsxs("div",{className:"space-y-4",children:[A.jsx(Ov,{title:"Monthly Schedule",children:A.jsx(Dv,{sameOperatingHours:P,onToggle:fn})}),et.map((nn,mn)=>A.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 space-y-3",children:[A.jsxs("div",{className:"flex justify-between items-center",children:[A.jsxs("span",{className:"font-medium text-sm",children:["Day ",mn+1]}),et.length>1&&A.jsx(V0,{onClick:()=>Xt(mn)})]}),A.jsxs("div",{children:[A.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Day of Month (1-31)"}),A.jsx("input",{type:"number",min:"1",max:"31",value:nn.monthly_day||1,onChange:cn=>_i(mn,"monthly_day",parseInt(cn.target.value)),className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded"})]}),Ui(nn,mn),Ii(mn)]},mn)),A.jsx(L1,{onClick:()=>At("monthly"),label:"Add Another Day"})]});case 4:return A.jsxs("div",{className:"space-y-4",children:[A.jsx(Ov,{title:"Annually Schedule",children:A.jsx(Dv,{sameOperatingHours:P,onToggle:fn})}),et.map((nn,mn)=>A.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 space-y-3",children:[A.jsxs("div",{className:"flex justify-between items-center",children:[A.jsxs("span",{className:"font-medium text-sm",children:["Date ",mn+1]}),et.length>1&&A.jsx(V0,{onClick:()=>Xt(mn)})]}),A.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[A.jsxs("div",{children:[A.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Month"}),A.jsx("select",{value:nn.annually_month||1,onChange:cn=>_i(mn,"annually_month",parseInt(cn.target.value)),className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded ",children:qe.map(cn=>A.jsx("option",{value:cn.id,children:cn.name},cn.id))})]}),A.jsxs("div",{children:[A.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Day"}),A.jsx("input",{type:"number",min:"1",max:"31",value:nn.annually_day||1,onChange:cn=>_i(mn,"annually_day",parseInt(cn.target.value)),className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded"})]})]}),Ui(nn,mn),Ii(mn)]},mn)),A.jsx(L1,{onClick:()=>At("annually"),label:"Add Another Date"})]});case 5:return A.jsxs("div",{className:"space-y-4",children:[A.jsx(Ov,{title:"One-time Market",children:A.jsx(Dv,{sameOperatingHours:P,onToggle:fn})}),et.map((nn,mn)=>A.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 space-y-3",children:[A.jsxs("div",{className:"flex justify-between items-center",children:[A.jsxs("span",{className:"font-medium text-sm",children:["Date ",mn+1]}),et.length>1&&A.jsx(V0,{onClick:()=>Xt(mn)})]}),A.jsxs("div",{children:[A.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Date"}),A.jsx("input",{type:"date",value:nn.once_date||new Date().toISOString().split("T")[0],onChange:cn=>_i(mn,"once_date",cn.target.value),className:"w-full h-[36px] border border-gray-300 px-2 text-sm rounded"})]}),Ui(nn,mn),Ii(mn)]},mn)),A.jsx(L1,{onClick:()=>At("once"),label:"Add Another Date"})]});default:return null}};return A.jsx("div",{className:"py-8 px-2 flex justify-center min-h-screen",children:A.jsxs("form",{onSubmit:pn,className:"w-full max-w-2xl  rounded-2xl p-8 md:shadow-lg md:border md:border-gray-200 space-y-8",style:{minWidth:0},children:[A.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[A.jsx("div",{children:A.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl  w-full aspect-square min-h-[210px] flex flex-col items-center justify-center cursor-pointer hover:border-orange-400 transition",onClick:()=>document.getElementById("marketImage").click(),children:[X?A.jsx("img",{src:X,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}):A.jsx("span",{className:"text-gray-400 text-sm",children:"Click to upload market image"}),A.jsx("input",{type:"file",accept:"image/*",id:"marketImage",className:"hidden",onChange:Ft})]})}),A.jsxs("div",{className:"flex flex-col gap-3 justify-between",children:[A.jsxs("div",{children:[A.jsx("label",{className:"block text-sm text-gray-600 mb-1 font-medium",children:"Market Name"}),A.jsx("input",{type:"text",value:le,onChange:Ui=>re(Ui.target.value),placeholder:"Market Name",className:"w-full h-[40px] border border-gray-300 px-3 text-sm  focus:outline-none focus:ring-2 focus:ring-orange-400 rounded mb-2",required:!0})]}),A.jsxs("div",{children:[A.jsx("label",{className:"block text-sm text-gray-600 mb-1 font-medium",children:"Description"}),A.jsx("textarea",{rows:3,value:fe,onChange:Ui=>xe(Ui.target.value),placeholder:"Description",className:"w-full border border-gray-300 rounded-xl px-3 py-2 text-sm  focus:outline-none focus:ring-2 focus:ring-orange-400",required:!0})]}),A.jsxs("div",{children:[A.jsx("label",{className:"block text-sm text-gray-600 mb-1 font-medium",children:"Address"}),A.jsx("input",{type:"text",value:be,onChange:Ui=>Ne(Ui.target.value),placeholder:"Address",className:"w-full h-[40px] border border-gray-300 px-3 text-sm  focus:outline-none focus:ring-2 focus:ring-orange-400 rounded",required:!0})]})]})]}),A.jsxs("div",{children:[A.jsxs("div",{className:"mb-4",children:[A.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frequency"}),A.jsxs("div",{className:"relative w-full",children:[A.jsxs("button",{type:"button",onClick:()=>C(Ui=>!Ui),className:"w-full h-[42px] border border-gray-300 rounded-xl px-3  text-left text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 flex justify-between items-center shadow-sm",children:[A.jsx("span",{children:Di[Be-1]?.title||"Select frequency"}),A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&A.jsx("ul",{className:"relative z-20 mt-1 w-full  border border-gray-200 rounded-xl shadow-xl max-h-56 overflow-auto",children:Di.map((Ui,Ii)=>A.jsx("li",{onClick:()=>{Ee(Ui.id),C(!1),at([]),D(!1)},className:"px-4 py-2 text-sm hover:bg-orange-50 cursor-pointer",children:Ui.title},Ui.id||Ii))})]})]}),Un()]}),A.jsxs("div",{children:[A.jsxs("div",{className:"flex items-center justify-between mb-1",children:[A.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Select Market Location:"}),A.jsx("button",{type:"button",className:"px-2 py-1 bg-orange-500 text-white text-xs rounded hover:bg-orange-600 transition ml-2",onClick:Qe,children:"My Location"})]}),A.jsx("div",{id:"map-picker",className:"w-full h-64 rounded-xl border border-gray-300"}),A.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Selected: ",He?.lat?.toFixed(5)||"...",",",He?.lng?.toFixed(5)||"..."]})]}),A.jsx("div",{className:"flex gap-2 mt-6",children:A.jsx("button",{type:"submit",className:"flex-1 py-3 bg-[#FF8225] text-white rounded-md font-medium hover:bg-[#e6731f] transition",children:w?"Save":"Register"})})]})})},I1=()=>{Ma();const{id:s}=ul(),a=Lr(!0),[l,u]=pe.useState(null),f="/v1",[y,w]=pe.useState(!1);return pe.useEffect(()=>{if(!s)return;(async()=>{try{w(!0);const C=await fetch(`${f}/market/${s}`);if(!C.ok)throw new Error("Failed to fetch market");const P=await C.json();u(P)}catch(C){console.error(C)}finally{w(!1)}})()},[s]),a?y?A.jsx(Yp,{loading:!0}):A.jsxs("div",{className:"relative w-full h-screen",children:[A.jsx(hc,{title:s?"Edit Market":"Register Market"}),A.jsx("main",{children:A.jsx(v4,{organizerId:a.user.id,market:s?l:null,onClose:()=>window.history.back(),setLoading:w})})]}):null},RA=250,x4=({setSubmitting:s})=>{const a=Lr(),l=Ma(),{markets:u}=ky(),[f,y]=pe.useState(null),[w,i]=pe.useState(""),[C,P]=pe.useState(""),[D,$]=pe.useState(""),[G,X]=pe.useState(!1),[te,le]=pe.useState(""),re=Ne=>{const Be=Ne.target.files[0];Be&&y(URL.createObjectURL(Be))},fe=async Ne=>{if(Ne.preventDefault(),!a?.user?.id){alert("User not logged in"),s(!1);return}const Be={caption:w,market_id:C,visitor_id:a.user.id,type:1};try{const Ee=await fetch("/v1/content?type=post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Be)});if(!Ee.ok)throw new Error("Failed to create content");const et=await Ee.json(),at=et?.data?.id||et?.id;if(!at)throw new Error("No content ID returned");s(!0);const lt=document.getElementById("photoUpload").files[0];if(lt){const pt=lt.name.split(".").pop(),Zt=`contents/${at}.${pt}`,{error:jt}=await Vs.storage.from("tamulokal").upload(Zt,lt,{upsert:!0});if(jt)throw jt;const{data:Di}=Vs.storage.from("tamulokal").getPublicUrl(Zt),Pi=Di.publicUrl;if(!(await fetch(`/v1/content/${at}/image`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:Pi})})).ok)throw new Error("Failed to update image")}l("/community");return}catch(Ee){console.error(Ee),alert("Something went wrong")}finally{s(!1)}},xe=u.filter(Ne=>Ne.name.toLowerCase().includes(te.toLowerCase())),be=Ne=>{P(Ne.id),$(Ne.name),X(!1)};return A.jsxs("div",{className:"w-full flex flex-col relative",children:[A.jsxs("form",{id:"community-post-form",onSubmit:fe,className:"px-6 py-4 space-y-6",children:[A.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[A.jsxs("div",{className:"md:w-1/2",children:[A.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photo (preview only)"}),A.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center bg-white w-full aspect-square cursor-pointer hover:border-orange-400 transition",onClick:()=>document.getElementById("photoUpload").click(),children:[f?A.jsx("img",{src:f,alt:"Preview",className:"w-full h-full object-cover rounded-md"}):A.jsxs("div",{className:"flex flex-col items-center text-gray-400",children:[A.jsx(QM,{className:"text-4xl mb-2"}),A.jsx("span",{className:"text-sm",children:"Click to preview image"})]}),A.jsx("input",{id:"photoUpload",type:"file",accept:"image/*",className:"hidden",onChange:re})]})]}),A.jsxs("div",{className:"md:w-1/2 flex flex-col justify-between",children:[A.jsxs("div",{children:[A.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Caption"}),A.jsx("textarea",{value:w,onChange:Ne=>i(Ne.target.value),placeholder:"Write something...",rows:"6",className:"w-full border border-gray-300 rounded-md p-3 text-sm bg-white focus:ring-2 focus:ring-orange-400 focus:outline-none"}),A.jsxs("div",{className:`text-right text-xs mt-1 ${w.length>RA?"text-red-500":"text-gray-500"}`,children:[w.length," / ",RA]})]}),A.jsxs("div",{children:[A.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tag a Market"}),A.jsxs("div",{className:"border border-gray-300 rounded-md p-3 text-sm bg-white cursor-pointer hover:border-orange-400 transition flex justify-between items-center",onClick:()=>X(!0),children:[A.jsx("span",{className:D?"text-gray-900":"text-gray-400",children:D||"Select a market..."}),A.jsx(xy,{className:"text-gray-500"})]})]})]})]}),A.jsx("div",{className:"flex justify-end md:hidden",children:A.jsx("button",{type:"submit",className:"px-6 py-3 bg-orange-500 text-white rounded-md font-medium hover:bg-orange-600 transition w-full",children:"Share"})})]}),G&&A.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end",children:[A.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:()=>X(!1)}),A.jsxs("div",{className:"relative bg-white rounded-t-2xl shadow-lg p-5 w-full h-[70vh] animate-slide-up z-10 flex flex-col",style:{animation:"slideUp 0.3s ease-out"},children:[A.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full mx-auto mb-4"}),A.jsxs("div",{className:"flex justify-between items-center mb-4",children:[A.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Select a Market"}),A.jsx("button",{onClick:()=>X(!1),className:"text-gray-500 hover:text-gray-700",children:A.jsx(Fd,{className:"text-xl"})})]}),A.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md px-2 mb-3",children:[A.jsx(xy,{className:"text-gray-500 text-lg"}),A.jsx("input",{type:"text",value:te,onChange:Ne=>le(Ne.target.value),placeholder:"Search markets...",className:"flex-1 p-2 outline-none text-sm"})]}),A.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-gray-100",children:xe.length>0?xe.map(Ne=>A.jsx("div",{onClick:()=>be(Ne),className:"p-3 text-sm hover:bg-orange-50 cursor-pointer transition",children:Ne.name},Ne.id)):A.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"No markets found"})})]})]})]})},b4=({setSubmitting:s=()=>{}})=>{const{markets:a}=ky(),l=Lr(),u=Ma(),[f,y]=pe.useState(""),[w,i]=pe.useState(""),[C,P]=pe.useState(""),[D,$]=pe.useState(""),[G,X]=pe.useState(!1),[te,le]=pe.useState(""),re=async be=>{if(be.preventDefault(),s(!0),!l?.user?.id){alert("User not logged in"),s(!1);return}const Ne={title:f,caption:w,market_id:C,visitor_id:l.user.id,type:2};try{if(!(await fetch("/v1/content?type=forum",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ne)})).ok)throw new Error("Failed to create forum");u("/community")}catch(Be){console.error(Be),alert("Something went wrong")}finally{s(!1)}},fe=a.filter(be=>be.name.toLowerCase().includes(te.toLowerCase())),xe=be=>{P(be.id),$(be.name),X(!1)};return A.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col relative",children:[A.jsxs("form",{onSubmit:re,className:"flex-1 px-6 py-4 space-y-6 pb-28",children:[A.jsxs("div",{children:[A.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),A.jsx("input",{type:"text",value:f,onChange:be=>y(be.target.value),placeholder:"Enter forum title...",className:"w-full border border-gray-300 rounded-md p-3 text-sm bg-white focus:ring-2 focus:ring-orange-400 focus:outline-none"})]}),A.jsxs("div",{children:[A.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),A.jsx("textarea",{value:w,onChange:be=>i(be.target.value),placeholder:"Write something...",rows:"4",className:"w-full border border-gray-300 rounded-md p-3 text-sm bg-white focus:ring-2 focus:ring-orange-400 focus:outline-none"})]}),A.jsxs("div",{children:[A.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tag a Market"}),A.jsxs("div",{className:"border border-gray-300 rounded-md p-3 text-sm bg-white cursor-pointer hover:border-orange-400 transition flex justify-between items-center",onClick:()=>X(!0),children:[A.jsx("span",{className:D?"text-gray-900":"text-gray-400",children:D||"Select a market..."}),A.jsx(xy,{className:"text-gray-500"})]})]})]}),A.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 px-6 py-4",children:A.jsx("button",{type:"submit",onClick:re,className:"w-full py-3 bg-orange-500 text-white rounded-md font-medium hover:bg-orange-600 transition",children:"Share"})}),G&&A.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end",children:[A.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:()=>X(!1)}),A.jsxs("div",{className:"relative bg-white rounded-t-2xl shadow-lg p-5 w-full h-[70vh] animate-slide-up z-10 flex flex-col",style:{animation:"slideUp 0.3s ease-out"},children:[A.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full mx-auto mb-4"}),A.jsxs("div",{className:"flex justify-between items-center mb-4",children:[A.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Select a Market"}),A.jsx("button",{onClick:()=>X(!1),className:"text-gray-500 hover:text-gray-700",children:A.jsx(Fd,{className:"text-xl"})})]}),A.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md px-2 mb-3",children:[A.jsx(xy,{className:"text-gray-500 text-lg"}),A.jsx("input",{type:"text",value:te,onChange:be=>le(be.target.value),placeholder:"Search markets...",className:"flex-1 p-2 outline-none text-sm"})]}),A.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-gray-100",children:fe.length>0?fe.map(be=>A.jsx("div",{onClick:()=>xe(be),className:"p-3 text-sm hover:bg-orange-50 cursor-pointer transition",children:be.name},be.id)):A.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"No markets found"})})]})]})]})},w4=()=>{const[s,a]=pe.useState(!1),l=$c(),f=new URLSearchParams(l.search).get("type")||"post",y=f!=="forum";return s?A.jsx(Yp,{loading:!0}):A.jsxs("div",{className:"min-h-screen w-full bg-gray-50 flex flex-col",children:[A.jsx(hc,{title:f==="forum"?"New Forum":"New Post",backPath:"/community"}),A.jsx("main",{className:"flex-1 flex justify-center px-4 py-6",children:A.jsxs("div",{className:"w-full max-w-3xl",children:[A.jsx("div",{className:"p-0 sm:p-6 md:p-8 md:bg-white md:shadow-sm md:rounded-xl md:border md:border-gray-100",children:f==="forum"?A.jsx(b4,{}):A.jsx(x4,{setSubmitting:a})}),y&&A.jsx("div",{className:"hidden md:flex justify-end mt-4",children:A.jsx("button",{type:"submit",form:"community-post-form",className:"px-6 py-3 bg-orange-500 text-white rounded-md font-medium hover:bg-orange-600 transition",children:"Share"})})]})})]})},S4=["Food","Fresh Produce","Handicraft","Fashion","Local Snack"],T4=()=>{const{markets:s,loading:a}=ky(),l=Ay(),[u,f]=pe.useState(!1),[y,w]=pe.useState({distance:null,rating:null,openNow:!1,tags:[]}),i=D=>{const $=new Date().getHours(),G=new Date(D.open_time).getHours(),X=new Date(D.close_time).getHours();return G<=X?$>=G&&$<=X:$>=G||$<=X},C=s.filter(D=>!(y.openNow&&!i(D)||y.rating&&D.average_rating<y.rating||y.distance&&D.distance>y.distance||y.tags.length>0&&!y.tags.some($=>D.tags?.includes($)))),P=D=>{w($=>({...$,tags:$.tags.includes(D)?$.tags.filter(G=>G!==D):[...$.tags,D]}))};return a?A.jsx(Yp,{loading:a}):A.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[A.jsx(hc,{title:"Explore Tamu",backPath:"/"}),A.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[A.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-1 px-4 py-2 rounded-xl bg-white shadow-sm hover:shadow-md transition",children:[A.jsx(VS,{size:20,className:"text-gray-700"}),A.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filter"})]}),A.jsx("div",{className:`
                    px-4 py-2 rounded-full text-sm font-medium shadow-sm
                    ${l?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}
                    transition
                `,children:l?"Location enabled":"Location disabled"})]}),A.jsx("div",{className:"px-4",children:A.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[C.map(D=>A.jsx("div",{className:"w-full h-[350px]",children:A.jsx(DP,{market:D,height:350})},D.id)),!a&&C.length===0&&A.jsx("p",{className:"text-gray-600 text-center col-span-full",children:"No markets found with selected filters."})]})}),u&&A.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end justify-center z-50",children:A.jsxs("div",{className:"bg-white w-full max-w-xl rounded-t-2xl p-6 shadow-lg ",children:[A.jsxs("div",{className:"flex justify-between items-center mb-4",children:[A.jsx("button",{onClick:()=>w({distance:null,rating:null,openNow:!1,tags:[]}),className:"text-sm text-gray-500 font-medium",children:"Reset"}),A.jsx("h3",{className:"text-lg font-semibold",children:"Filter"}),A.jsx("button",{onClick:()=>f(!1),className:"text-sm text-[var(--orange)] font-medium",children:"Apply"})]}),A.jsxs("div",{className:"mb-5",children:[A.jsxs("p",{className:"font-medium mb-2",children:["Distance ",y.distance?`( ${y.distance} km )`:"Any"]}),A.jsx("input",{type:"range",min:5,max:20,step:5,value:y.distance||20,onChange:D=>w({...y,distance:Number(D.target.value)}),className:"w-full accent-orange-500"})]}),A.jsxs("div",{className:"mb-5",children:[A.jsxs("p",{className:"font-medium mb-2 flex items-center gap-1",children:["Rating",y.rating?A.jsxs("span",{className:"flex items-center gap-0.5",children:["( ",y.rating," ",A.jsx(Zo,{className:"text-yellow-400"})," )"]}):" Any"]}),A.jsx("input",{type:"range",min:1,max:5,step:1,value:y.rating||1,onChange:D=>w({...y,rating:Number(D.target.value)}),className:"w-full accent-orange-500"})]}),A.jsxs("div",{className:"mb-5 flex items-center justify-between",children:[A.jsx("p",{className:"font-medium mb-0",children:"Open Only"}),A.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[A.jsx("input",{type:"checkbox",checked:y.openNow,onChange:()=>w({...y,openNow:!y.openNow}),className:"sr-only peer"}),A.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-orange-300 rounded-full peer peer-checked:bg-orange-500 transition-colors"}),A.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-md peer-checked:translate-x-5 transition-transform"})]})]}),A.jsxs("div",{className:"mb-5",children:[A.jsx("p",{className:"font-medium mb-2",children:"Tags"}),A.jsx("div",{className:"flex flex-wrap gap-2",children:S4.map(D=>A.jsx("button",{onClick:()=>P(D),className:`px-3 py-1 rounded-full text-xs border ${y.tags.includes(D)?"bg-orange-500 text-white border-orange-500":"bg-white text-gray-700 border-gray-300"}`,children:D},D))})]})]})})]})},k4=({vendor:s})=>{const[a,l]=pe.useState(0),u=(s.product_images||[]).slice(0,3);return pe.useEffect(()=>{if(u.length<=1)return;const f=setInterval(()=>{l(y=>(y+1)%u.length)},3e3);return()=>clearInterval(f)},[u.length]),u.length===0?null:A.jsxs("div",{className:"relative w-full max-w-md aspect-square rounded-xl overflow-hidden shadow-lg border border-gray-200",children:[A.jsx("img",{src:u[a],alt:s.vendor_name,className:"w-full h-full object-cover"}),A.jsxs("div",{className:"absolute bottom-0 left-0 w-full p-3 bg-gradient-to-t from-black/70 via-black/30 to-transparent text-white flex items-center justify-between",children:[A.jsxs("div",{className:"flex items-center gap-2",children:[A.jsx("img",{src:s.vendor_image||"/placeholder.jpg",alt:s.vendor_name,className:"w-10 h-10 rounded-full object-cover border border-gray-200"}),A.jsxs("div",{className:"flex flex-col",children:[A.jsx("h3",{className:"font-semibold text-sm line-clamp-1",children:s.vendor_name}),A.jsxs("div",{className:"flex items-center text-xs gap-1",children:[A.jsx(Zo,{className:"text-yellow-400 text-xs"}),s.avg_rating?.toFixed(1)??"0.0"," (",s.total_reviews,")"]})]})]}),A.jsx($s,{to:`/vendor/${s.vendor_id}`,className:"text-gray-800 bg-white p-2 rounded-full hover:bg-orange-100 transition",children:A.jsx(VM,{className:"text-base"})})]})]})},E4=[{id:1,name:"Fresh Produce",emoji:""},{id:2,name:"Street Food",emoji:""},{id:3,name:"Snacks & Drinks",emoji:""},{id:4,name:"Clothing",emoji:""},{id:5,name:"Handicrafts",emoji:""},{id:6,name:"Fruits",emoji:""},{id:7,name:"Seafood",emoji:""},{id:8,name:"Performance",emoji:""}],A4=()=>{const{id:s}=ul(),[a,l]=pe.useState([]),[u,f]=pe.useState(!0),y=E4.find(i=>i.id===Number(s)),w="/v1";return pe.useEffect(()=>{if(!s)return;(async()=>{try{f(!0);const C=await fetch(`${w}/category/${s}`);if(!C.ok)throw new Error(`HTTP error: ${C.status}`);const P=await C.json();l(P)}catch(C){console.error("Error fetching vendors:",C)}finally{f(!1)}})()},[s,w]),u?A.jsx(Yp,{loading:u}):A.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[A.jsx(hc,{title:y?`${y.name}`:"Category",backPath:"/"}),a.length===0&&A.jsx("p",{className:"text-center mt-4 text-[var(--gray)]",children:"No vendors found"}),a.length>0&&A.jsx("div",{className:"w-full p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:a.map(i=>A.jsx(k4,{vendor:i},i.vendor_id))})]})},C4="/v1",M4=({space:s})=>{const[a,l]=pe.useState(s.state!=2),u=async f=>{f.stopPropagation();const y=!a;l(y);try{const w=await fetch(`${C4}/marketspace/${s.id}/state`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:y?1:2})});if(!w.ok)throw new Error(`Failed to update space: ${w.status}`);const i=await w.json()}catch(w){console.error("Error updating space state:",w),l(a),alert("Failed to update space state")}};return A.jsxs("div",{className:"relative rounded-xl overflow-hidden shadow-md hover:shadow-lg transition cursor-pointer h-[208px]",children:[A.jsx("img",{src:s.market_image||"/default-market.png",alt:s.market_name,className:"w-full h-full object-cover"}),A.jsx("div",{className:"absolute inset-0 bg-black/40"}),A.jsx("div",{className:"absolute bottom-2 right-2 flex z-10",children:A.jsx($s,{to:`/business/marketspace/${s.id}`,onClick:f=>f.stopPropagation(),className:"p-1.5 rounded-lg bg-black/60 text-white backdrop-blur cursor-pointer",title:"Edit Market",children:A.jsx(cx,{size:20})})}),A.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-2 z-10",children:[A.jsx("button",{onClick:u,className:`relative inline-flex items-center h-8 w-16 rounded-full transition-colors duration-300 focus:outline-none ${a?"bg-green-500":"bg-red-500"}`,children:A.jsx("span",{className:`absolute w-6 h-6 bg-white rounded-full shadow-md transition-transform duration-300 ${a?"translate-x-0 right-1":"translate-x-0 left-1"}`})}),A.jsx("span",{className:"text-white text-sm font-medium select-none",children:a?"Open":"Closed"})]}),A.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:A.jsxs("h3",{className:"text-white font-semibold text-lg drop-shadow text-center px-4 line-clamp-2",children:[s.market_name,A.jsx("br",{}),"( Lot ",s.lot," )"]})})]})},P4="/v1",j4=({vendorId:s})=>{Ma();const[a,l]=pe.useState([]),[u,f]=pe.useState(!0);return pe.useEffect(()=>{(async()=>{if(s){f(!0);try{const i=await(await fetch(`${P4}/marketspace?vendor_id=${s}`)).json();l(i)}catch(w){console.error("Error fetching marketspaces:",w),l([])}finally{f(!1)}}})()},[s]),u?A.jsx("div",{className:"flex justify-center py-10 text-gray-500",children:"Loading market spaces..."}):A.jsx("div",{className:"flex flex-col gap-3 pb-12",children:a.map(y=>A.jsx(M4,{space:y},y.id))})},LA=()=>{const s=Lr(!0);Ma();const[a,l]=pe.useState(null),[u,f]=pe.useState(!0);return pe.useEffect(()=>{const y=async()=>{try{const w=s.user.id,i=await fetch(`/v1/user/${w}/roles`),C=await i.json();i.ok&&C.roles?C.roles.includes("Vendor")?l("Vendor"):C.roles.includes("Organizer")?l("Organizer"):l("None"):l("None")}catch(w){console.error(w),l("None")}finally{f(!1)}};s?.user&&y()},[s]),!s||!s.user?null:u?A.jsx("div",{className:"text-gray-600 text-center mt-10",children:"Loading..."}):A.jsxs("div",{className:"relative w-full h-screen ",children:[A.jsx(hc,{title:a==="Vendor"?"Market Space":a==="Organizer"?"Market Property":"Business Page"}),A.jsxs("main",{className:"overflow-hidden flex flex-col items-center md:items-start font-inter p-4 max-w-7xl md:mx-auto",children:[a==="Vendor"&&A.jsx(j4,{vendorId:s.user.id}),a==="Organizer"&&A.jsx(YP,{organizerId:s.user.id,isOwnProfile:!0})]})]})},R4=()=>{const a=Lr(!0),{isAdmin:l}=JP(a,"/v1"),[u,f]=pe.useState("market"),[y,w]=pe.useState(null),[i,C]=pe.useState(null),[P,D]=pe.useState({vendors:[],organizers:[]}),[$,G]=pe.useState([]),[X,te]=pe.useState(""),[le,re]=pe.useState(!1),[fe,xe]=pe.useState(null),[be,Ne]=pe.useState(null),Be=async(at,He)=>{if(!He)return null;const lt=["nricFront.jpg","nricBack.jpg","license.jpg"],pt={};for(const Zt of lt){const jt=`${at}/${He}/${Zt}`,{data:Di,error:Pi}=await Vs.storage.from("tamulokal-private").download(jt);Pi?pt[Zt]=null:pt[Zt]=URL.createObjectURL(Di)}return pt};pe.useEffect(()=>{if(!fe)return;(async()=>{const He=fe.type==="Vendor"?"vendors":"organizers",lt=await Be(He,fe.id);Ne(lt)})()},[fe]),pe.useEffect(()=>{if(u!=="business")return;(async()=>{try{const[He,lt]=await Promise.all([fetch("/v1/vendor/"),fetch("/v1/organizer/")]),pt=await He.json(),Zt=await lt.json();D({vendors:pt,organizers:Zt})}catch{}})()},[u]),pe.useEffect(()=>{if(u!=="market")return;(async()=>{try{const lt=await(await fetch("/v1/market/admin")).json();G(lt)}catch{}})()},[u]);const Ee=$.filter(at=>at.name.toLowerCase().includes(X.toLowerCase())),et=[...P.vendors.map(at=>({...at,type:"Vendor"})),...P.organizers.map(at=>({...at,type:"Organizer"}))].filter(at=>at.name.toLowerCase().includes(X.toLowerCase()));return l?A.jsxs("div",{className:"min-h-screen flex bg-gray-100",children:[A.jsxs("aside",{className:"hidden lg:flex flex-col w-64 bg-white shadow-md p-4",children:[A.jsx("h1",{className:"text-xl font-semibold mb-6",children:"Admin Dashboard"}),A.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Manage users and markets"}),A.jsxs("button",{onClick:()=>{f("market"),te("")},className:`flex items-center gap-2 py-3 px-4 rounded-lg text-sm font-medium transition ${u==="market"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,children:[A.jsx(Cm,{}),"Markets"]}),A.jsxs("button",{onClick:()=>{f("business"),te("")},className:`flex items-center gap-2 py-3 px-4 mt-2 rounded-lg text-sm font-medium transition ${u==="business"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,children:[A.jsx(fb,{}),"Accounts"]})]}),A.jsxs("div",{className:"flex-1 flex flex-col",children:[A.jsxs("header",{className:"lg:hidden flex items-center justify-between p-4 bg-white shadow-md",children:[A.jsx("h1",{className:"text-lg font-semibold",children:"Admin Dashboard"}),A.jsx("button",{onClick:()=>re(!le),className:"p-2 rounded-md hover:bg-gray-100 transition",children:A.jsx(WO,{size:24})})]}),le&&A.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex lg:hidden",children:A.jsxs("aside",{className:"bg-white w-64 p-4",children:[A.jsx("button",{onClick:()=>re(!1),className:"mb-4 px-2 py-1 text-sm text-gray-500",children:"Close"}),A.jsxs("button",{onClick:()=>{f("market"),te(""),re(!1)},className:`flex items-center gap-2 py-3 px-4 rounded-lg text-sm font-medium transition ${u==="market"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,children:[A.jsx(Cm,{}),"Markets"]}),A.jsxs("button",{onClick:()=>{f("business"),te(""),re(!1)},className:`flex items-center gap-2 py-3 px-4 mt-2 rounded-lg text-sm font-medium transition ${u==="business"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100"}`,children:[A.jsx(fb,{}),"Accounts"]})]})}),A.jsx("div",{className:"p-4",children:A.jsx("input",{type:"text",placeholder:u==="market"?"Search market":"Search account",value:X,onChange:at=>te(at.target.value),className:"w-full px-3 py-2 rounded-xl shadow bg-white text-sm outline-none"})}),A.jsxs("main",{className:"px-4 mb-10 pb-6 flex-1 overflow-y-auto",children:[u==="market"&&A.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-10",children:[Ee.map((at,He)=>{let lt={text:"Approved",bg:"bg-green-100",textColor:"text-green-700"};if(at.applications&&at.applications.length>0){const pt=at.applications[0].status;pt===1?lt={text:"Approved",bg:"bg-green-100",textColor:"text-green-700"}:pt===2?lt={text:"Pending",bg:"bg-yellow-100",textColor:"text-yellow-700"}:pt===3&&(lt={text:"Rejected",bg:"bg-red-100",textColor:"text-red-700"})}return A.jsxs("div",{onClick:()=>C(at),className:"p-4 bg-white rounded-xl shadow flex justify-between items-center cursor-pointer hover:shadow-lg transition",children:[A.jsxs("div",{className:"flex items-center gap-3",children:[at.image?A.jsx("img",{src:at.image,alt:at.name,className:"w-12 h-12 object-cover rounded-full border-2 border-gray-200"}):A.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-green-100 text-green-600 rounded-full border-2 border-gray-200",children:A.jsx(Cm,{size:20})}),A.jsxs("div",{className:"flex flex-col",children:[A.jsx("p",{className:"font-semibold text-sm",children:at.name}),A.jsx("div",{className:"flex gap-2 mt-1",children:A.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${lt.bg} ${lt.textColor}`,children:lt.text})})]})]}),A.jsx(xf,{size:22,className:"text-gray-400"})]},He)}),A.jsx("div",{className:"fixed bottom-4 left-0 w-full flex justify-center lg:static z-20",children:A.jsx($s,{to:"/admin/market/add",className:"w-[90%] lg:w-full flex items-center justify-center gap-2 p-4 bg-orange-600 text-white rounded-xl font-medium shadow active:scale-[0.98] transition text-center",children:"Add New Market"})})]}),u==="business"&&A.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:et.map((at,He)=>A.jsxs("div",{onClick:()=>xe(at),className:"p-4 bg-white rounded-xl shadow flex justify-between items-center cursor-pointer hover:shadow-lg transition",children:[A.jsxs("div",{className:"flex items-center gap-3",children:[at.image?A.jsx("img",{src:at.image,alt:at.name,className:"w-12 h-12 object-cover rounded-full border-2 border-gray-200"}):A.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full border-2 border-gray-200",children:A.jsx(fb,{size:20})}),A.jsxs("div",{className:"flex flex-col",children:[A.jsx("p",{className:"font-semibold text-sm",children:at.name}),A.jsxs("div",{className:"flex gap-2 mt-1",children:[A.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${at.verified?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:at.verified?"Verified":"Unverified"}),A.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${at.type==="Vendor"?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"}`,children:at.type})]})]})]}),A.jsx(xf,{size:22,className:"text-gray-400"})]},He))})]}),i&&A.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-4xl relative overflow-y-auto max-h-[90vh]",children:[A.jsx("button",{onClick:()=>C(null),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-800 transition",children:A.jsx(Fd,{size:24})}),A.jsxs("div",{className:"flex flex-col lg:flex-row p-4 gap-4",children:[i.image?A.jsx("div",{className:"lg:w-1/3 flex-shrink-0 mx-auto",children:A.jsx("img",{src:i.image,alt:i.name,className:"w-full h-full max-w-[200px] mx-auto object-cover rounded-lg"})}):A.jsx("div",{className:"lg:w-1/3 flex-shrink-0 flex items-center justify-center bg-green-100 text-green-600 rounded-lg border-2 border-gray-200",children:A.jsx(Cm,{size:48})}),A.jsxs("div",{className:"lg:w-2/3 flex flex-col gap-2",children:[A.jsx("p",{className:"text-lg font-semibold",children:i.name}),A.jsx("p",{className:"text-sm text-gray-600",children:i.description}),A.jsxs("p",{className:"text-sm text-gray-600",children:["Address: ",i.address]}),i.applications&&i.applications.length>0&&A.jsx("div",{className:"mt-2",children:(()=>{const at=i.applications[0].status;let He="Approved",lt="bg-green-100",pt="text-green-700";return at===2&&(He="Pending",lt="bg-yellow-100",pt="text-yellow-700"),at===3&&(He="Rejected",lt="bg-red-100",pt="text-red-700"),A.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${lt} ${pt}`,children:He})})()}),A.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Created on ",new Date(i.created_at).toLocaleDateString()]}),A.jsx("div",{className:"flex gap-2 mt-3",children:i.applications?.[0]?.status===2?A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/market/${i.market_id}/verify?status=1`,{method:"PUT"})).ok)throw new Error("Failed to approve market");C(lt=>({...lt,applications:[{...lt.applications[0],status:1}]})),G(lt=>lt.map(pt=>pt.market_id===i.market_id?{...pt,applications:[{...pt.applications[0],status:1}]}:pt))}catch{}},className:"flex-1 p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:"Approve"}),A.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/market/${i.market_id}/verify?status=3`,{method:"PUT"})).ok)throw new Error("Failed to reject market");C(lt=>({...lt,applications:[{...lt.applications[0],status:3}]})),G(lt=>lt.map(pt=>pt.market_id===i.market_id?{...pt,applications:[{...pt.applications[0],status:3}]}:pt))}catch{}},className:"flex-1 p-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Reject"})]}):A.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/market/${i.market_id}`,{method:"DELETE"})).ok)throw new Error("Failed to remove market");G(lt=>lt.filter(pt=>pt.market_id!==i.market_id)),C(null)}catch{}},className:"flex-1 p-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition",children:"Remove"})})]})]})]})}),fe&&A.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-4xl relative overflow-y-auto max-h-[90vh]",children:[A.jsx("button",{onClick:()=>{xe(null),Ne(null)},className:"absolute top-3 right-3 text-gray-500 hover:text-gray-800 transition",children:A.jsx(Fd,{size:24})}),A.jsxs("div",{className:"flex flex-col lg:flex-row p-4",children:[fe.image&&A.jsx("div",{className:"lg:w-1/3 flex-shrink-0 mx-auto",children:A.jsx("img",{src:fe.image,alt:fe.name,className:"w-full h-full max-w-[200px] mx-auto object-cover rounded-lg"})}),A.jsxs("div",{className:"lg:w-2/3 flex flex-col gap-2",children:[A.jsx("p",{className:"text-lg font-semibold",children:fe.name}),A.jsxs("p",{className:"text-sm text-gray-600",children:["License: ",fe.license]}),be?A.jsxs("div",{className:"flex",children:[be["nricFront.jpg"]&&A.jsx("img",{src:be["nricFront.jpg"],alt:"NRIC Front",className:"w-1/3 object-cover aspect-square cursor-pointer",onClick:()=>w(be["nricFront.jpg"])}),be["nricBack.jpg"]&&A.jsx("img",{src:be["nricBack.jpg"],alt:"NRIC Back",className:"w-1/3 object-cover aspect-square cursor-pointer",onClick:()=>w(be["nricBack.jpg"])}),be["license.jpg"]&&A.jsx("img",{src:be["license.jpg"],alt:"License",className:"w-1/3 object-cover aspect-square cursor-pointer",onClick:()=>w(be["license.jpg"])})]}):A.jsx("p",{className:"text-gray-400 text-sm",children:"Loading private images..."}),A.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Joined on ",new Date(fe.created_at).toLocaleDateString()]}),A.jsxs("div",{className:"flex gap-2 mt-3",children:[!fe.verified&&A.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/${fe.type.toLowerCase()}/${fe.id}/verify?verified=true`,{method:"PUT"})).ok)throw new Error("Failed to verify account");xe(He=>({...He,verified:!0})),D(He=>{const lt=He.vendors.map(pt=>pt.id===fe.id?{...pt,verified:!0}:pt);return{...He,vendors:lt}})}catch{}},className:"flex-1 p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:"Approve"}),fe.verified&&A.jsx("button",{onClick:async()=>{try{if(!(await fetch(`/v1/${fe.type.toLowerCase()}/${fe.id}`,{method:"DELETE"})).ok)throw new Error("Failed to remove account");D(He=>({vendors:He.vendors.filter(lt=>lt.id!==fe.id),organizers:He.organizers.filter(lt=>lt.id!==fe.id)})),xe(null),Ne(null)}catch{}},className:"flex-1 p-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Remove"})]})]})]})]})}),y&&A.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",onClick:()=>w(null),children:A.jsx("img",{src:y,alt:"Selected",className:"max-h-[90vh] max-w-full object-contain rounded shadow-lg"})})]})]}):A.jsx("div",{children:"You do not have access to this page"})},H0=43200,IA=1440,zA=Symbol.for("constructDateFrom");function JS(s,a){return typeof s=="function"?s(a):s&&typeof s=="object"&&zA in s?s[zA](a):s instanceof Date?new s.constructor(a):new Date(a)}function qp(s,a){return JS(s,s)}let L4={};function I4(){return L4}function DA(s){const a=qp(s),l=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return l.setUTCFullYear(a.getFullYear()),+s-+l}function QS(s,...a){const l=JS.bind(null,s||a.find(u=>typeof u=="object"));return a.map(l)}function mb(s,a){const l=+qp(s)-+qp(a);return l<0?-1:l>0?1:l}function z4(s){return JS(s,Date.now())}function D4(s,a,l){const[u,f]=QS(l?.in,s,a),y=u.getFullYear()-f.getFullYear(),w=u.getMonth()-f.getMonth();return y*12+w}function O4(s){return a=>{const u=(s?Math[s]:Math.trunc)(a);return u===0?0:u}}function N4(s,a){return+qp(s)-+qp(a)}function F4(s,a){const l=qp(s);return l.setHours(23,59,59,999),l}function B4(s,a){const l=qp(s),u=l.getMonth();return l.setFullYear(l.getFullYear(),u+1,0),l.setHours(23,59,59,999),l}function U4(s,a){const l=qp(s);return+F4(l)==+B4(l)}function $4(s,a,l){const[u,f,y]=QS(l?.in,s,s,a),w=mb(f,y),i=Math.abs(D4(f,y));if(i<1)return 0;f.getMonth()===1&&f.getDate()>27&&f.setDate(30),f.setMonth(f.getMonth()-w*i);let C=mb(f,y)===-w;U4(u)&&i===1&&mb(u,y)===1&&(C=!1);const P=w*(i-+C);return P===0?0:P}function V4(s,a,l){const u=N4(s,a)/1e3;return O4(l?.roundingMethod)(u)}const H4={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},G4=(s,a,l)=>{let u;const f=H4[s];return typeof f=="string"?u=f:a===1?u=f.one:u=f.other.replace("{{count}}",a.toString()),l?.addSuffix?l.comparison&&l.comparison>0?"in "+u:u+" ago":u};function z1(s){return(a={})=>{const l=a.width?String(a.width):s.defaultWidth;return s.formats[l]||s.formats[s.defaultWidth]}}const q4={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},W4={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Z4={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},X4={date:z1({formats:q4,defaultWidth:"full"}),time:z1({formats:W4,defaultWidth:"full"}),dateTime:z1({formats:Z4,defaultWidth:"full"})},Y4={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},K4=(s,a,l,u)=>Y4[s];function Nv(s){return(a,l)=>{const u=l?.context?String(l.context):"standalone";let f;if(u==="formatting"&&s.formattingValues){const w=s.defaultFormattingWidth||s.defaultWidth,i=l?.width?String(l.width):w;f=s.formattingValues[i]||s.formattingValues[w]}else{const w=s.defaultWidth,i=l?.width?String(l.width):s.defaultWidth;f=s.values[i]||s.values[w]}const y=s.argumentCallback?s.argumentCallback(a):a;return f[y]}}const J4={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Q4={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},e5={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},t5={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},i5={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},n5={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},a5=(s,a)=>{const l=Number(s),u=l%100;if(u>20||u<10)switch(u%10){case 1:return l+"st";case 2:return l+"nd";case 3:return l+"rd"}return l+"th"},r5={ordinalNumber:a5,era:Nv({values:J4,defaultWidth:"wide"}),quarter:Nv({values:Q4,defaultWidth:"wide",argumentCallback:s=>s-1}),month:Nv({values:e5,defaultWidth:"wide"}),day:Nv({values:t5,defaultWidth:"wide"}),dayPeriod:Nv({values:i5,defaultWidth:"wide",formattingValues:n5,defaultFormattingWidth:"wide"})};function Fv(s){return(a,l={})=>{const u=l.width,f=u&&s.matchPatterns[u]||s.matchPatterns[s.defaultMatchWidth],y=a.match(f);if(!y)return null;const w=y[0],i=u&&s.parsePatterns[u]||s.parsePatterns[s.defaultParseWidth],C=Array.isArray(i)?o5(i,$=>$.test(w)):s5(i,$=>$.test(w));let P;P=s.valueCallback?s.valueCallback(C):C,P=l.valueCallback?l.valueCallback(P):P;const D=a.slice(w.length);return{value:P,rest:D}}}function s5(s,a){for(const l in s)if(Object.prototype.hasOwnProperty.call(s,l)&&a(s[l]))return l}function o5(s,a){for(let l=0;l<s.length;l++)if(a(s[l]))return l}function l5(s){return(a,l={})=>{const u=a.match(s.matchPattern);if(!u)return null;const f=u[0],y=a.match(s.parsePattern);if(!y)return null;let w=s.valueCallback?s.valueCallback(y[0]):y[0];w=l.valueCallback?l.valueCallback(w):w;const i=a.slice(f.length);return{value:w,rest:i}}}const c5=/^(\d+)(th|st|nd|rd)?/i,u5=/\d+/i,d5={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},h5={any:[/^b/i,/^(a|c)/i]},f5={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},m5={any:[/1/i,/2/i,/3/i,/4/i]},p5={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},g5={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},_5={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},y5={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},v5={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},x5={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},b5={ordinalNumber:l5({matchPattern:c5,parsePattern:u5,valueCallback:s=>parseInt(s,10)}),era:Fv({matchPatterns:d5,defaultMatchWidth:"wide",parsePatterns:h5,defaultParseWidth:"any"}),quarter:Fv({matchPatterns:f5,defaultMatchWidth:"wide",parsePatterns:m5,defaultParseWidth:"any",valueCallback:s=>s+1}),month:Fv({matchPatterns:p5,defaultMatchWidth:"wide",parsePatterns:g5,defaultParseWidth:"any"}),day:Fv({matchPatterns:_5,defaultMatchWidth:"wide",parsePatterns:y5,defaultParseWidth:"any"}),dayPeriod:Fv({matchPatterns:v5,defaultMatchWidth:"any",parsePatterns:x5,defaultParseWidth:"any"})},w5={code:"en-US",formatDistance:G4,formatLong:X4,formatRelative:K4,localize:r5,match:b5,options:{weekStartsOn:0,firstWeekContainsDate:1}};function S5(s,a,l){const u=I4(),f=l?.locale??u.locale??w5,y=2520,w=mb(s,a);if(isNaN(w))throw new RangeError("Invalid time value");const i=Object.assign({},l,{addSuffix:l?.addSuffix,comparison:w}),[C,P]=QS(l?.in,...w>0?[a,s]:[s,a]),D=V4(P,C),$=(DA(P)-DA(C))/1e3,G=Math.round((D-$)/60);let X;if(G<2)return l?.includeSeconds?D<5?f.formatDistance("lessThanXSeconds",5,i):D<10?f.formatDistance("lessThanXSeconds",10,i):D<20?f.formatDistance("lessThanXSeconds",20,i):D<40?f.formatDistance("halfAMinute",0,i):D<60?f.formatDistance("lessThanXMinutes",1,i):f.formatDistance("xMinutes",1,i):G===0?f.formatDistance("lessThanXMinutes",1,i):f.formatDistance("xMinutes",G,i);if(G<45)return f.formatDistance("xMinutes",G,i);if(G<90)return f.formatDistance("aboutXHours",1,i);if(G<IA){const te=Math.round(G/60);return f.formatDistance("aboutXHours",te,i)}else{if(G<y)return f.formatDistance("xDays",1,i);if(G<H0){const te=Math.round(G/IA);return f.formatDistance("xDays",te,i)}else if(G<H0*2)return X=Math.round(G/H0),f.formatDistance("aboutXMonths",X,i)}if(X=$4(P,C),X<12){const te=Math.round(G/H0);return f.formatDistance("xMonths",te,i)}else{const te=X%12,le=Math.trunc(X/12);return te<3?f.formatDistance("aboutXYears",le,i):te<9?f.formatDistance("overXYears",le,i):f.formatDistance("almostXYears",le+1,i)}}function T5(s,a){return S5(s,z4(s),a)}const D1=({notif:s})=>{const a=Ma(),l=new Date(s.created_at+"Z"),u=async()=>{if(!s.is_read)try{await fetch(`/v1/notification/${s.id}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_read:!0})}),s.is_read=!0}catch(f){console.error("Failed to mark notification as read:",f)}s.market_id&&a(`/market/${s.market_id}`),s.event_id==1&&a("/market/history")};return A.jsxs("div",{className:`w-full py-3 min-h-[60px] flex flex-col justify-center border-b border-gray-200 ${s.market_id?"cursor-pointer hover:bg-gray-50 transition":""} ${s.is_read?"opacity-60":"bg-[var(--white)]"}`,onClick:u,children:[A.jsxs("div",{className:"flex justify-between items-center",children:[A.jsx("p",{className:"font-medium text-gray-800",children:s.message}),!s.is_read&&A.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full flex-shrink-0"})]}),A.jsx("p",{className:"text-xs text-gray-500 mt-1",children:T5(l,{addSuffix:!0})})]})},k5=()=>{const a=Lr()?.user,l=Ma(),[u,f]=pe.useState([]),[y,w]=pe.useState(!0);pe.useEffect(()=>{if(!a?.id)return;(async()=>{try{const D=await(await fetch(`/v1/notification?user_id=${a.id}`)).json();f(D)}catch(P){console.error("Failed to fetch notifications:",P)}finally{w(!1)}})()},[a]);const i=pe.useMemo(()=>{const C=[],P=[],D=[],$=new Date,G=$.toDateString(),X=new Date($);X.setDate($.getDate()-1);const te=X.toDateString();return u.forEach(le=>{const re=new Date(le.created_at+"Z").toDateString();re===G?C.push(le):re===te?P.push(le):D.push(le)}),{today:C,yesterday:P,older:D}},[u]);return A.jsxs("div",{className:"relative h-screen overflow-hidden bg-[#FFFDFA] flex flex-col items-center font-inter p-4",children:[A.jsx("div",{className:"max-w-xl w-full",children:A.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[A.jsx("button",{onClick:()=>l("/profile"),className:"text-gray-700 hover:text-orange-500 transition",children:A.jsx(Mm,{className:"text-2xl"})}),A.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Notifications"})]})}),A.jsx("div",{className:"max-w-xl w-full space-y-6 overflow-y-auto pb-10",children:y?A.jsx("p",{className:"text-gray-500",children:"Loading notifications..."}):u.length===0?A.jsx("p",{className:"text-gray-500",children:"No notifications yet."}):A.jsxs(A.Fragment,{children:[i.today.length>0&&A.jsxs("div",{children:[A.jsx("h2",{className:"text-[var(--black)] font-semibold mb-2",children:"Today"}),i.today.map(C=>A.jsx(D1,{notif:C},C.id))]}),i.yesterday.length>0&&A.jsxs("div",{children:[A.jsx("h2",{className:"text-[var(--black)] font-semibold mb-2",children:"Yesterday"}),i.yesterday.map(C=>A.jsx(D1,{notif:C},C.id))]}),i.older.length>0&&A.jsxs("div",{children:[A.jsx("h2",{className:"text-[var(--black)] font-semibold mb-2",children:"Older"}),i.older.map(C=>A.jsx(D1,{notif:C},C.id))]})]})})]})},ym=40,OA=.3,NA=2.5;function E5({edit:s=!1,existingStalls:a=[],marketId:l,onSave:u}){const f=pe.useRef(null),y=pe.useRef(null),[w,i]=pe.useState("add"),[C,P]=pe.useState([]),[D,$]=pe.useState({x:0,y:0,zoom:1}),[G,X]=pe.useState(!1),[te,le]=pe.useState(null),[re,fe]=pe.useState(null),[xe,be]=pe.useState(!1),[Ne,Be]=pe.useState("");pe.useEffect(()=>{if(s&&a.length>0&&(P(a),f.current&&a.length>0)){const At=f.current.getContext("2d");lt(At,a)}},[s,a]);const Ee=At=>Math.floor(At/ym)*ym,et=(At,Xt)=>{const yn=f.current.getBoundingClientRect();return{x:(At-yn.left)/D.zoom+D.x,y:(Xt-yn.top)/D.zoom+D.y}},at=At=>{const Xt=f.current.getBoundingClientRect();return{x:(At.clientX-Xt.left)/D.zoom+D.x,y:(At.clientY-Xt.top)/D.zoom+D.y}},He=(At,Xt)=>`${At},${Xt}`,lt=(At,Xt)=>{if(!Xt||Xt.length===0)return;let yn=Math.min(...Xt.map(Ii=>Ii.x)),fn=Math.min(...Xt.map(Ii=>Ii.y)),pn=Math.max(...Xt.map(Ii=>Ii.x))+ym,sn=Math.max(...Xt.map(Ii=>Ii.y))+ym;const Un=2*ym,Ui={x:yn-(At.canvas.width-(pn-yn+Un*2))/2/D.zoom,y:fn-(At.canvas.height-(sn-fn+Un*2))/2/D.zoom,zoom:1};$(Ui)};pe.useEffect(()=>{const At=f.current;if(!At)return;const Xt=At.getContext("2d"),yn=()=>{At.width=At.clientWidth,At.height=At.clientHeight,Di(Xt)};return yn(),window.addEventListener("resize",yn),()=>window.removeEventListener("resize",yn)},[D,C,re]);const pt=At=>{const{width:Xt,height:yn}=At.canvas,fn=ym*D.zoom;At.strokeStyle="#e5e7eb",At.lineWidth=1;const pn=-D.x*D.zoom%fn,sn=-D.y*D.zoom%fn;for(let Un=pn;Un<Xt;Un+=fn)At.beginPath(),At.moveTo(Un,0),At.lineTo(Un,yn),At.stroke();for(let Un=sn;Un<yn;Un+=fn)At.beginPath(),At.moveTo(0,Un),At.lineTo(Xt,Un),At.stroke()},Zt=At=>{C.forEach((Xt,yn)=>{const fn=(Xt.x-D.x)*D.zoom,pn=(Xt.y-D.y)*D.zoom,sn=ym*D.zoom;let Un="#4ade80";s&&Xt.id&&(Un="#60a5fa"),At.fillStyle=Un,At.strokeStyle=s&&Xt.id?"#1d4ed8":"#166534",At.lineWidth=s&&Xt.id?2:1,At.fillRect(fn,pn,sn,sn),At.strokeRect(fn,pn,sn,sn),At.fillStyle="#064e3b",At.font=`${12*D.zoom}px sans-serif`,At.textAlign="center",At.textBaseline="middle";const Ui=Xt.lot||String(yn+1).padStart(String(C.length).length,"0");At.fillText(Ui,fn+sn/2,pn+sn/2)})},jt=At=>{!re||w==="free"||(At.fillStyle=w==="add"?"rgba(59,130,246,0.4)":"rgba(239,68,68,0.4)",At.fillRect((re.x-D.x)*D.zoom,(re.y-D.y)*D.zoom,ym*D.zoom,ym*D.zoom))},Di=At=>{At.clearRect(0,0,At.canvas.width,At.canvas.height),pt(At),Zt(At),jt(At)},Pi=(At,Xt)=>{if(w==="free")return;const yn=Ee(At),fn=Ee(Xt),pn=He(yn,fn);w==="add"&&P(sn=>sn.find(Ui=>He(Ui.x,Ui.y)===pn)?sn:[...sn,{x:yn,y:fn,...a.find(Ui=>He(Ui.x,Ui.y)===pn)||{}}]),w==="delete"&&P(sn=>sn.filter(Un=>He(Un.x,Un.y)!==pn)),fe({x:yn,y:fn})},qe=At=>{if(At.button===1||w==="free"){X(!0),le({x:At.clientX,y:At.clientY,cam:{...D}});return}const{x:Xt,y:yn}=et(At.clientX,At.clientY);Pi(Xt,yn)},wt=At=>{if(G&&te){const fn=(At.clientX-te.x)/D.zoom,pn=(At.clientY-te.y)/D.zoom;$({...D,x:te.cam.x-fn,y:te.cam.y-pn});return}if(!re||w==="free")return;const{x:Xt,y:yn}=et(At.clientX,At.clientY);Pi(Xt,yn)},Ct=()=>{fe(null),X(!1)},Vi=At=>{At.preventDefault();const Xt=At.deltaY<0?1.1:.9;$(yn=>({...yn,zoom:Math.min(NA,Math.max(OA,yn.zoom*Xt))}))},Qe=At=>{if(At.preventDefault(),At.touches.length===1&&w!=="free"){const{x:Xt,y:yn}=at(At.touches[0]);Pi(Xt,yn)}if(At.touches.length===2||w==="free"){const Xt=At.touches[0].clientX-At.touches[1].clientX,yn=At.touches[0].clientY-At.touches[1].clientY;y.current=Math.hypot(Xt,yn),le({x:(At.touches[0].clientX+At.touches[1].clientX)/2,y:(At.touches[0].clientY+At.touches[1].clientY)/2,cam:{...D}}),X(!0)}},St=At=>{if(At.preventDefault(),At.touches.length===1&&re&&w!=="free"){const{x:Xt,y:yn}=at(At.touches[0]);Pi(Xt,yn)}if((At.touches.length===2||w==="free")&&te){const Xt=(At.touches[0].clientX+At.touches[1].clientX)/2,yn=(At.touches[0].clientY+At.touches[1].clientY)/2,fn=(Xt-te.x)/D.zoom,pn=(yn-te.y)/D.zoom,sn=At.touches[0].clientX-At.touches[1].clientX,Un=At.touches[0].clientY-At.touches[1].clientY,Ui=Math.hypot(sn,Un);let Ii=D.zoom;y.current&&(Ii=Math.min(NA,Math.max(OA,Ii*(Ui/y.current)))),y.current=Ui,$({x:te.cam.x-fn,y:te.cam.y-pn,zoom:Ii})}},Ht=()=>{fe(null),X(!1),y.current=null},Ft=()=>{if(C.length===0){alert("No stalls to save!");return}be(!0)},_i=()=>{if(!s&&(!Ne||Ne.trim()==="")){alert("Fee is required for new stalls!");return}const At=parseFloat(Ne)||0,Xt=C.map(yn=>({...yn,fee:At}));u&&u(Xt,At),be(!1),Be("")};return A.jsx("div",{className:"w-full h-full relative bg-gray-100 flex",children:A.jsxs("div",{className:"flex-1 relative",children:[A.jsx("canvas",{ref:f,className:"w-full h-full cursor-crosshair touch-none",onMouseDown:qe,onMouseMove:wt,onMouseUp:Ct,onWheel:Vi,onTouchStart:Qe,onTouchMove:St,onTouchEnd:Ht}),A.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-white shadow-lg rounded-full px-4 py-2 flex items-center gap-4 z-50",children:[A.jsx("button",{onClick:()=>i("add"),className:`w-12 h-12 rounded-full flex items-center justify-center text-xl
              ${w==="add"?"bg-green-400 text-white":"bg-gray-100"}`,title:"Add Stalls",children:A.jsx(ux,{})}),A.jsx("button",{onClick:()=>i("free"),className:`w-12 h-12 rounded-full flex items-center justify-center text-xl
              ${w==="free"?"bg-blue-400 text-white":"bg-gray-100"}`,title:"Free Move (Pan/Zoom)",children:A.jsx(BO,{})}),A.jsx("button",{onClick:()=>i("delete"),className:`w-12 h-12 rounded-full flex items-center justify-center text-xl
              ${w==="delete"?"bg-red-400 text-white":"bg-gray-100"}`,title:"Delete Stalls",children:A.jsx(JO,{})}),A.jsx("button",{onClick:Ft,className:"w-12 h-12 rounded-full flex items-center justify-center text-xl bg-orange-500 text-white hover:bg-orange-600",title:"Save Floor Plan",children:A.jsx(OO,{})})]}),A.jsxs("div",{className:"absolute top-3 left-3 bg-white shadow rounded px-3 py-2 text-sm",children:[A.jsx("div",{children:s&&a.length>0?A.jsxs(A.Fragment,{children:[A.jsxs("span",{className:"text-blue-600",children:[" Existing: ",a.length]}),A.jsx("br",{}),A.jsxs("span",{className:"text-green-600",children:[" New: ",C.length-a.length]})]}):A.jsxs("span",{className:"text-green-600",children:[" Stalls: ",C.length]})}),A.jsxs("div",{children:["Mode:"," ",A.jsx("span",{className:`font-medium ${w==="add"?"text-green-600":w==="delete"?"text-red-600":"text-blue-600"}`,children:w==="add"?"Add":w==="delete"?"Delete":"Free Move"})]})]}),xe&&A.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:A.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4 p-6",children:[A.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Set Stall Fee"}),A.jsx("p",{className:"text-sm text-gray-600 mb-4",children:s?"Enter the fee for each stall (RM). Leave empty to keep existing fees.":"Enter the fee for each stall (RM)."}),A.jsxs("div",{className:"mb-4",children:[A.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fee per Stall (RM)"}),A.jsx("input",{type:"number",min:"0",step:"0.01",value:Ne,onChange:At=>Be(At.target.value),placeholder:s?"e.g., 50.00 (leave empty to keep existing)":"e.g., 50.00",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),A.jsxs("div",{className:"flex justify-end gap-3",children:[A.jsx("button",{onClick:()=>{be(!1),Be("")},className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"Cancel"}),A.jsx("button",{onClick:_i,className:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 font-medium",children:s?"Update & Save":"Save Floor Plan"})]})]})})]})})}const FA=({edit:s=!1})=>{const{id:a}=ul(),l=Ma();Lr(!0);const[u,f]=pe.useState([]),[y,w]=pe.useState(!0),[i,C]=pe.useState(null),P="/v1";pe.useEffect(()=>{(async()=>{if(!s||!a){w(!1);return}try{w(!0),C(null);const G=await fetch(`${P}/market/${a}/space`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!G.ok)throw new Error(`Failed to fetch stalls: ${G.status}`);const te=(await G.json()).map(le=>({x:le.x_floor_plan||0,y:le.y_floor_plan||0,id:le.id,lot:le.lot,fee:le.fee}));f(te)}catch(G){C(G.message||"Failed to load stall data"),f([])}finally{w(!1)}})()},[a,s,P]);const D=async($,G)=>{try{const X=[],te=[];if($.forEach((le,re)=>{const fe={lot:le.lot||String(re+1).padStart(String($.length).length,"0"),fee:le.fee||G||0,x_floor_plan:le.x,y_floor_plan:le.y,market_id:a};le.id||te.push(fe)}),s){const le=$.filter(re=>re.id).map(re=>re.id);u.forEach(re=>{le.includes(re.id)||X.push(re.id)})}if(te.length>0){const le=await fetch(`${P}/market/${a}/space`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)});if(!le.ok){const re=await le.text();throw new Error(`Failed to create stalls: ${re}`)}}if(console.log(te),X.length>0){const le=await fetch(`${P}/market/${a}/space`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:X})});if(!le.ok){const re=await le.text();throw new Error(`Failed to delete stalls: ${re}`)}}l(`/business/market/${a}/space`)}catch(X){console.error("Error saving:",X),alert(`Failed to save: ${X.message}`)}};return y?A.jsx(Yp,{loading:y}):i?A.jsxs("div",{children:["Error: ",i]}):A.jsxs("div",{className:"w-screen h-screen flex flex-col",children:[A.jsx("div",{className:"px-4 py-4",children:A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("button",{onClick:()=>l(-1),className:"text-gray-700 hover:text-orange-500 transition",children:A.jsx(Mm,{className:"text-2xl"})}),A.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:s?"Edit Market Floor Plan":"Create Market Floor Plan"})]})}),A.jsx("main",{className:"flex-1 overflow-hidden",children:A.jsx(E5,{edit:s,existingStalls:u,marketId:a,onSave:D})})]})};function A5({marketId:s,stalls:a,isVendor:l=!1,session:u,onSelectStall:f}){const y=pe.useRef({x:0,y:0,zoom:1}),w=pe.useRef(null),i=pe.useRef({x:0,y:0}),C=pe.useRef(!1),P=pe.useRef(null),[D,$]=pe.useState(null),G=40,X=1,[te,le]=pe.useState({x:0,y:0,zoom:1}),[re,fe]=pe.useState({left:!1,right:!1,top:!1,bottom:!1}),[xe,be]=pe.useState({width:0,height:0}),Ne=qe=>{if(!a||!a.length)return;let wt=Math.min(...a.map(Ft=>Ft.x)),Ct=Math.min(...a.map(Ft=>Ft.y)),Vi=Math.max(...a.map(Ft=>Ft.x))+G,Qe=Math.max(...a.map(Ft=>Ft.y))+G;const St=X*G,Ht={x:wt-(qe.canvas.width-(Vi-wt+St*2))/2,y:Ct-(qe.canvas.height-(Qe-Ct+St*2))/2,zoom:1};le(Ht),y.current=Ht},Be=(qe,wt)=>{le(Ct=>({...Ct,x:Ct.x-qe/Ct.zoom,y:Ct.y-wt/Ct.zoom}))},Ee=(qe,wt,Ct)=>{if(!w.current)return;const Vi=w.current.getBoundingClientRect(),Qe=wt-Vi.left,St=Ct-Vi.top,Ht=Qe/te.zoom+te.x,Ft=St/te.zoom+te.y,_i=Math.max(.5,Math.min(3,te.zoom*qe)),At=Ht-Qe/_i,Xt=Ft-St/_i;le({x:At,y:Xt,zoom:_i})},et=qe=>{qe.preventDefault();const wt=qe.deltaY<0?1.1:.9;Ee(wt,qe.clientX,qe.clientY)},at=qe=>{qe.button===0&&(i.current={x:qe.clientX,y:qe.clientY},C.current=!0,qe.preventDefault())},He=qe=>{if(C.current){const wt=qe.clientX-i.current.x,Ct=qe.clientY-i.current.y;Be(wt,Ct),i.current={x:qe.clientX,y:qe.clientY}}},lt=()=>{C.current=!1},pt=qe=>{if(qe.touches.length===1){const wt=qe.touches[0];i.current={x:wt.clientX,y:wt.clientY},C.current=!0,P.current=null}else if(qe.touches.length===2){const wt=qe.touches[0],Ct=qe.touches[1],Vi=wt.clientX-Ct.clientX,Qe=wt.clientY-Ct.clientY;P.current=Math.sqrt(Vi*Vi+Qe*Qe),i.current={x:(wt.clientX+Ct.clientX)/2,y:(wt.clientY+Ct.clientY)/2},C.current=!1}},Zt=qe=>{if(qe.touches.length===1&&C.current){const wt=qe.touches[0],Ct=wt.clientX-i.current.x,Vi=wt.clientY-i.current.y;Be(Ct,Vi),i.current={x:wt.clientX,y:wt.clientY}}else if(qe.touches.length===2&&P.current){const wt=qe.touches[0],Ct=qe.touches[1],Vi=wt.clientX-Ct.clientX,Qe=wt.clientY-Ct.clientY,St=Math.sqrt(Vi*Vi+Qe*Qe),Ht=St/P.current,Ft=(wt.clientX+Ct.clientX)/2,_i=(wt.clientY+Ct.clientY)/2;Ee(Ht,Ft,_i),P.current=St,i.current={x:Ft,y:_i}}},jt=()=>{C.current=!1,P.current=null},Di=qe=>{if(C.current||!w.current||!a||!a.length){C.current=!1;return}const wt=w.current.getBoundingClientRect(),Ct=qe.clientX-wt.left,Vi=qe.clientY-wt.top,Qe=Ct/te.zoom+te.x,St=Vi/te.zoom+te.y,Ht=a.find(Ft=>Qe>=Ft.x&&Qe<=Ft.x+G&&St>=Ft.y&&St<=Ft.y+G);$(Ht||null)},Pi=qe=>{if(qe.clearRect(0,0,qe.canvas.width,qe.canvas.height),!a||!a.length)return;let wt=Math.min(...a.map(Ht=>Ht.x)),Ct=Math.min(...a.map(Ht=>Ht.y)),Vi=Math.max(...a.map(Ht=>Ht.x))+G,Qe=Math.max(...a.map(Ht=>Ht.y))+G;const St=X*G;qe.strokeStyle="#FFFDFA",qe.lineWidth=1;for(let Ht=wt-St;Ht<=Vi+St;Ht+=G)qe.beginPath(),qe.moveTo((Ht-te.x)*te.zoom,(Ct-St-te.y)*te.zoom),qe.lineTo((Ht-te.x)*te.zoom,(Qe+St-te.y)*te.zoom),qe.stroke();for(let Ht=Ct-St;Ht<=Qe+St;Ht+=G)qe.beginPath(),qe.moveTo((wt-St-te.x)*te.zoom,(Ht-te.y)*te.zoom),qe.lineTo((Vi+St-te.x)*te.zoom,(Ht-te.y)*te.zoom),qe.stroke();a.forEach(Ht=>{const Ft=(Ht.x-te.x)*te.zoom,_i=(Ht.y-te.y)*te.zoom,At=G*te.zoom;let Xt="#4ade80";const yn=l&&Ht.pending_applications?.some(pn=>pn.vendor_id===u?.user?.id);let fn="#026700";D&&D.id===Ht.id&&Ht.pending_applications==0?Xt="#22c55e":Ht.status==="Occupied"?Xt="#FF8225":(Ht.pending_applications.length>0||yn)&&(Xt="#60a5fa"),qe.fillStyle=Xt,qe.strokeStyle=fn,qe.lineWidth=D&&D.id===Ht.id?3:1,qe.fillRect(Ft,_i,At,At),qe.strokeRect(Ft,_i,At,At),qe.fillStyle="#171A1D",qe.font=`${Math.max(8,12*te.zoom)}px sans-serif`,qe.textAlign="center",qe.textBaseline="middle",qe.fillText(Ht.lot,Ft+At/2,_i+At/2)})};return pe.useEffect(()=>{const qe=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=qe}},[]),pe.useEffect(()=>{const qe=w.current;if(!qe)return;const wt=qe.getContext("2d"),Ct=qe.parentElement;if(!Ct)return;const Vi=()=>{const{clientWidth:St,clientHeight:Ht}=Ct;(qe.width!==St||qe.height!==Ht)&&(qe.width=St,qe.height=Ht,be({width:St,height:Ht}),a&&a.length&&Ne(wt))},Qe=new ResizeObserver(Vi);return Qe.observe(Ct),Vi(),()=>Qe.disconnect()},[a]),pe.useEffect(()=>{if(!w.current||!a||!a.length)return;const qe=w.current.getContext("2d");Pi(qe);const wt=w.current,Ct=te.x,Vi=te.x+wt.width/te.zoom,Qe=te.y,St=te.y+wt.height/te.zoom,Ht=Math.min(...a.map(Xt=>Xt.x))-X*G,Ft=Math.min(...a.map(Xt=>Xt.y))-X*G,_i=Math.max(...a.map(Xt=>Xt.x+G))+X*G,At=Math.max(...a.map(Xt=>Xt.y+G))+X*G;fe({left:Ht<Ct-G/2,right:_i>Vi+G/2,top:Ft<Qe-G/2,bottom:At>St+G/2})},[te,a,xe,D]),pe.useEffect(()=>{const qe=w.current;if(qe)return qe.addEventListener("mousedown",at),window.addEventListener("mousemove",He),window.addEventListener("mouseup",lt),qe.addEventListener("wheel",et,{passive:!1}),qe.addEventListener("touchstart",pt,{passive:!1}),qe.addEventListener("touchmove",Zt,{passive:!1}),qe.addEventListener("touchend",jt),qe.addEventListener("click",Di),()=>{qe.removeEventListener("mousedown",at),window.removeEventListener("mousemove",He),window.removeEventListener("mouseup",lt),qe.removeEventListener("wheel",et),qe.removeEventListener("touchstart",pt),qe.removeEventListener("touchmove",Zt),qe.removeEventListener("touchend",jt),qe.removeEventListener("click",Di)}},[te,a,D]),!a||!a.length?A.jsx("div",{children:"No stalls found"}):A.jsxs("div",{className:"relative w-full h-full flex",children:[A.jsx("canvas",{ref:w,className:"w-full h-full cursor-move rounded-lg",style:{touchAction:"none"}}),re.left&&A.jsx(SO,{className:"absolute left-6 top-1/2 transform -translate-y-1/2 text-gray-500 text-3xl z-10"}),re.right&&A.jsx(TO,{className:"absolute right-6 top-1/2 transform -translate-y-1/2 text-gray-500 text-3xl z-10"}),re.top&&A.jsx(kO,{className:"absolute top-6 left-1/2 transform -translate-x-1/2 text-gray-500 text-3xl z-10"}),re.bottom&&A.jsx(wO,{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 text-gray-500 text-3xl z-10"}),D&&A.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30 z-0",onClick:()=>$(null)}),D&&A.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10",children:A.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 w-80 overflow-hidden",children:[A.jsxs("div",{className:"px-5 py-4 border-b border-gray-100 flex justify-between items-center",children:[A.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Lot ",D.lot]}),A.jsx("button",{onClick:()=>$(null),className:"text-gray-400 hover:text-gray-600 text-xl",children:""})]}),A.jsxs("div",{className:"px-5 py-4 space-y-4",children:[A.jsxs("div",{className:"flex items-center justify-between",children:[A.jsx("span",{className:"text-sm text-gray-500",children:"Status"}),A.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium
                    ${D.status==="Available"&&"bg-green-100 text-green-700"}
                    ${D.status==="Occupied"&&"bg-yellow-100 text-yellow-700"}
                    ${D.status==="Reserved"&&"bg-blue-100 text-blue-700"}
                    ${D.status==="Maintenance"&&"bg-red-100 text-red-700"}
                  `,children:D.status})]}),A.jsx("div",{className:"flex items-center justify-between",children:D.status==="Occupied"?A.jsx(A.Fragment,{children:A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden flex items-center justify-center",children:D.vendor_image?A.jsx("img",{src:D.vendor_image,alt:D.vendor_name,className:"w-full h-full object-cover"}):A.jsx("span",{className:"text-sm text-gray-400",children:"N/A"})}),A.jsxs("div",{children:[A.jsx("p",{className:"text-sm text-gray-500",children:"Vendor"}),A.jsx("p",{className:"text-sm font-medium text-gray-800",children:D.vendor_name||"Unknown Vendor"})]})]})}):l?A.jsxs(A.Fragment,{children:[A.jsxs("div",{children:[A.jsx("p",{className:"text-sm text-gray-500",children:"Rent"}),A.jsxs("p",{className:"text-sm font-medium text-gray-800",children:["RM ",D.fee]})]}),D.pending_applications?.some(qe=>qe.vendor_id===u?.user?.id)?A.jsx("span",{className:"text-gray-400 font-medium text-sm",children:"Applied"}):A.jsx($s,{to:`/business/marketspace/${D.id}/apply`,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",onClick:qe=>qe.stopPropagation(),children:"Apply"})]}):A.jsxs(A.Fragment,{children:[A.jsxs("div",{children:[A.jsx("p",{className:"text-sm text-gray-500",children:"Application"}),A.jsx("p",{className:"text-sm font-medium text-gray-800",children:D.pending_applications?.length>0?D.pending_applications.length:"None"})]}),A.jsx("button",{className:"text-blue-600 hover:text-blue-700 font-medium text-sm",onClick:()=>{$(D),f&&f(D)},children:"View"})]})})]})]})}),A.jsxs("div",{className:"fixed bottom-4 left-4 flex items-center space-x-3 bg-white rounded bg-opacity-80 px-3 py-2 z-20",children:[A.jsx("button",{onClick:()=>le(y.current),className:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600",children:"Reset"}),A.jsxs("span",{className:"text-gray-700 font-medium",children:[Math.round(te.zoom*100),"%"]})]})]})}const C5=({application:s})=>{const[a,l]=pe.useState(null),[u,f]=pe.useState(!0),y="/v1";return pe.useEffect(()=>{if(!s?.vendor_id)return;(async()=>{try{f(!0);const i=await fetch(`${y}/vendor/${s.vendor_id}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error("Failed to fetch vendor");const C=await i.json();l(C)}catch(i){console.error(i),l(null)}finally{f(!1)}})()},[s?.vendor_id]),A.jsxs("div",{className:"border rounded p-3 flex justify-between items-center",children:[A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden flex items-center justify-center",children:a?.image?A.jsx("img",{src:a.image,alt:a?.fullname,className:"w-full h-full object-cover"}):A.jsx("span",{className:"text-xs text-gray-400",children:"N/A"})}),A.jsx("div",{children:u?A.jsx("p",{className:"text-sm text-gray-400",children:"Loading vendor..."}):A.jsxs(A.Fragment,{children:[A.jsx("p",{className:"text-sm font-medium",children:a?.fullname||"Unknown Vendor"}),A.jsxs("p",{className:"text-xs text-gray-500",children:["Applied on"," ",s?.submitted_at?new Date(s.submitted_at).toLocaleDateString():"-"]})]})})]}),A.jsxs("div",{className:"flex items-center gap-2",children:[A.jsx("button",{className:"p-2 rounded bg-red-100 text-red-700 hover:bg-red-200 transition",title:"Reject",children:A.jsx(Fd,{className:"text-lg"})}),A.jsx("button",{className:"p-2 rounded bg-green-100 text-green-700 hover:bg-green-200 transition",title:"Accept",children:A.jsx(GM,{className:"text-lg"})})]})]})},M5=()=>{const s=Lr(!0),[a,l]=pe.useState(!1),[u,f]=pe.useState(null),[y,w]=pe.useState("grid"),[i,C]=pe.useState("lot"),[P,D]=pe.useState(""),{id:$}=ul(),G=Ma(),[X,te]=pe.useState(!1),[le,re]=pe.useState([]),[fe,xe]=pe.useState(!0),[be,Ne]=pe.useState(null),Be="/v1",{isVendor:Ee}=JP(s,Be),et=async()=>{if(!$){Ne("Market ID is required"),xe(!1);return}try{xe(!0),Ne(null);const He=await fetch(`${Be}/market/${$}/space`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!He.ok)throw new Error(`Failed to fetch stalls: ${He.status} ${He.statusText}`);const pt=(await He.json()).map((Zt,jt)=>({x:Zt.x_floor_plan||0,y:Zt.y_floor_plan||0,lot:Zt.lot,id:Zt.id||Zt.stall_id||jt+1,name:Zt.name||Zt.stall_name||`Stall ${jt+1}`,status:Zt.vendor_id==null?"Available":"Occupied",...Zt}));re(pt)}catch(He){Ne(He.message||"Failed to load stall data"),re([])}finally{xe(!1)}};if(pe.useEffect(()=>{et()},[$]),fe)return A.jsx(Yp,{loading:fe});if(be)return A.jsxs("div",{children:["Error: ",be]});console.log(le);const at=le.filter(He=>{const lt=P.toLowerCase();return He.vendor_name?.toLowerCase().includes(lt)||String(He.lot).includes(lt)}).sort((He,lt)=>i==="lot"?He.lot-lt.lot:i==="status"?He.status===lt.status?0:He.status==="Occupied"?-1:1:0);return console.log(u),A.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[A.jsx(hc,{title:"Market Space"}),X&&A.jsx("div",{className:"fixed top-4 right-4 z-20",children:A.jsx("button",{onClick:()=>G(`/business/market/${$}/edit-plan`),className:"border text-black px-2 py-2 rounded-full shadow hover:bg-blue-600 transition",children:A.jsx(JM,{})})}),A.jsx("main",{className:`flex-1 flex ${X?"overflow-hidden":"overflow-auto"}`,children:X?A.jsx(A5,{marketId:$,stalls:le,isVendor:Ee,session:s,onSelectStall:He=>{f(He),l(!0)}}):A.jsxs("div",{className:"w-full h-full p-4 overflow-auto",children:[A.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3 mb-4 w-full",children:[A.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[A.jsxs("div",{className:"flex items-center gap-2",children:[A.jsx("button",{onClick:()=>w("grid"),className:`p-2 rounded ${y==="grid"?"bg-orange-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:A.jsx(vy,{className:"text-lg"})}),A.jsx("button",{onClick:()=>w("list"),className:`p-2 rounded ${y==="list"?"bg-orange-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:A.jsx(ME,{className:"text-lg"})})]}),A.jsx("div",{className:"flex items-center gap-2 ml-auto md:ml-0",children:A.jsxs("select",{value:i,onChange:He=>C(He.target.value),className:"border rounded px-3 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-orange-500",children:[A.jsx("option",{value:"lot",children:"Lot Number"}),A.jsx("option",{value:"status",children:"Occupied First"})]})})]}),A.jsx("input",{type:"text",value:P,onChange:He=>D(He.target.value),placeholder:"Search vendor or lot...",className:"w-full md:w-64 md:ml-auto border rounded px-3 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-orange-500"})]}),A.jsx("div",{className:y==="grid"?"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-4 items-stretch":"flex flex-col gap-4",children:at.map(He=>{const lt=He.pending_applications?.some(pt=>pt.vendor_id===s?.user?.id);return A.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border h-full min-h-[100px] flex flex-col",children:[A.jsxs("div",{className:"flex justify-between items-center",children:[A.jsxs("h3",{className:"font-medium",children:["Lot ",He.lot]}),A.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${He.status==="Available"?"bg-green-100 text-green-700":He.status==="Occupied"?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"}`,children:He.status})]}),A.jsx("div",{className:"mt-2 flex-1 flex flex-col justify-between",children:He.status==="Occupied"?A.jsx("div",{className:"flex items-center justify-between",children:A.jsx("div",{className:"flex items-center space-x-3",children:A.jsxs($s,{to:`/vendor/${He.vendor_id}`,onClick:pt=>pt.stopPropagation(),className:"flex items-center space-x-3 hover:opacity-80 transition",children:[A.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden flex items-center justify-center",children:He.vendor_image?A.jsx("img",{src:He.vendor_image,alt:He.vendor_name,className:"w-full h-full object-cover"}):A.jsx("span",{className:"text-sm text-gray-400",children:"N/A"})}),A.jsx("p",{className:"text-sm font-medium text-gray-800",children:He.vendor_name||"Unknown Vendor"})]})})}):A.jsx("div",{className:"flex items-center justify-between",children:Ee?A.jsxs(A.Fragment,{children:[A.jsxs("div",{children:[A.jsx("p",{className:"text-sm text-gray-500",children:"Rent"}),A.jsxs("p",{className:"text-sm font-medium text-gray-800",children:["RM ",He.fee]})]}),lt?A.jsx("span",{className:"text-gray-400 font-medium text-sm cursor-not-allowed",children:"Applied"}):A.jsx($s,{to:`/business/marketspace/${He.id}/apply`,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",onClick:pt=>pt.stopPropagation(),children:"Apply"})]}):A.jsxs(A.Fragment,{children:[A.jsxs("div",{children:[A.jsx("p",{className:"text-sm text-gray-500",children:"Application"}),A.jsx("p",{className:"text-sm font-medium text-gray-800",children:He.pending_applications.length>0?`${He.pending_applications.length}`:"None"})]}),A.jsx($s,{to:`/market/${$}/space/${He.id}/applications`,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",onClick:pt=>{pt.preventDefault(),pt.stopPropagation(),f(He),l(!0)},children:"View"})]})})})]},He.id)})})]})}),A.jsx("div",{className:"fixed bottom-4 right-4 flex items-center space-x-3 bg-orange-500 bg-opacity-80 px-3 py-2 rounded-full z-20",children:A.jsxs("button",{onClick:()=>te(He=>!He),className:"flex items-center gap-2 bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600 transition",children:[X?A.jsx(ME,{className:"text-lg"}):A.jsx(vy,{className:"text-lg"}),A.jsx("span",{children:X?"List":"Plan View"})]})}),a&&A.jsx("div",{className:"fixed inset-0 z-50 px-4 flex items-center justify-center bg-black/40",onClick:()=>l(!1),children:A.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg h-[70vh] p-5 shadow-lg flex flex-col",onClick:He=>He.stopPropagation(),children:[A.jsxs("div",{className:"flex justify-between items-center mb-4",children:[A.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Applications  Lot ",u?.lot]}),A.jsx("button",{onClick:()=>l(!1),className:"text-gray-500 hover:text-gray-700",children:""})]}),u?.pending_applications?.length>0?A.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:u.pending_applications.map(He=>A.jsx(C5,{application:He},He.id))}):A.jsx("p",{className:"text-sm text-gray-500",children:"No applications found."})]})})]})},P5=[{id:1,name:"Fresh Produce",emoji:""},{id:2,name:"Street Food",emoji:""},{id:3,name:"Snacks & Drinks",emoji:""},{id:4,name:"Clothing",emoji:""},{id:5,name:"Handicrafts",emoji:""},{id:6,name:"Fruits",emoji:""},{id:7,name:"Seafood",emoji:""},{id:8,name:"Performance",emoji:""}],G0=[{id:1,title:"pcs"},{id:2,title:"kg"},{id:3,title:"g"},{id:4,title:"unit"},{id:5,title:"bag"}],j5=({product:s=null,category:a=null,vendorId:l,onClose:u})=>{const f=!!s,[y,w]=pe.useState(null),[i,C]=pe.useState(null),[P,D]=pe.useState(""),[$,G]=pe.useState(""),[X,te]=pe.useState(""),[le]=pe.useState(G0),[re,fe]=pe.useState(null),[xe,be]=pe.useState([]),Ne="/v1";pe.useEffect(()=>{s&&a&&(D(s.name||""),G(s.price||""),te(s.quantity||""),C(s.image||null),Array.isArray(a)&&be(a.map(He=>He.category_id)),s.categories&&be(s.categories))},[s,a]),pe.useEffect(()=>{if(s){const He=G0.find(lt=>lt.id===s.quantity_type);fe(He||G0[0])}else fe(G0[0])},[s]);const Be=He=>{const lt=He.target.files[0];lt&&(w(lt),C(URL.createObjectURL(lt)))},Ee=He=>{xe.includes(He)?be(xe.filter(lt=>lt!==He)):xe.length<3&&be([...xe,He])},et=async()=>{if(!(!f||!s?.id)&&window.confirm("Are you sure you want to delete this product?"))try{if(!(await fetch(`${Ne}/product/${s.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete product");if(s.image)try{const lt=s.image,pt="tamulokal/",Zt=lt.indexOf(pt);if(Zt!==-1){const jt=lt.substring(Zt+pt.length),{error:Di}=await Vs.storage.from("tamulokal").remove([jt]);Di&&console.warn("Failed to delete image from storage:",Di)}else console.warn("Could not extract file path from image URL:",lt)}catch(lt){console.warn("Error deleting image from storage:",lt)}alert("Product deleted!"),u()}catch(He){console.error(He),alert("Failed to delete product")}},at=async He=>{if(He.preventDefault(),!re){alert("Please select a quantity type");return}if(xe.length===0){alert("Please select at least 1 category");return}try{let lt;if(f){const pt=await fetch(`${Ne}/product/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:P,price:parseFloat($),quantity:parseFloat(X),quantity_type:re.id,categories:xe})});if(!pt.ok)throw new Error("Failed to update product");lt=(await pt.json()).id}else{const pt=await fetch(`${Ne}/product`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vendor_id:l,name:P,price:parseFloat($),quantity:parseFloat(X),quantity_type:re.id,categories:xe})});if(!pt.ok)throw new Error("Failed to add product");lt=(await pt.json()).id}if(y){const pt=y.name.split(".").pop(),Zt=`vendors/${l}/${lt}.${pt}`,{error:jt}=await Vs.storage.from("tamulokal").upload(Zt,y,{upsert:!0});if(jt)throw jt;const{data:{publicUrl:Di}}=Vs.storage.from("tamulokal").getPublicUrl(Zt);if(!(await fetch(`${Ne}/product/${lt}/image`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:Di})})).ok)throw new Error("Failed to update product image")}alert(f?"Product updated!":"Product added!"),u()}catch(lt){console.error(lt),alert(f?"Failed to update product":"Failed to add product")}};return A.jsx("div",{className:"min-h-screen w-full flex flex-col font-inter",children:A.jsx("form",{onSubmit:at,className:"flex-1 w-full px-4 md:px-8 py-6",children:A.jsxs("div",{className:"w-full max-w-5xl mx-auto space-y-6",children:[A.jsxs("div",{className:"flex flex-col md:flex-row md:gap-8 md:items-stretch",children:[A.jsx("div",{className:"w-full md:w-1/4 md:flex md:flex-col",children:A.jsxs("div",{className:"relative border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center bg-white w-full aspect-square cursor-pointer hover:border-orange-400 transition",onClick:()=>document.getElementById("productImage").click(),children:[i?A.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover rounded-md"}):A.jsx("div",{className:"flex flex-col items-center text-gray-400",children:A.jsx(QM,{className:"text-4xl mb-2"})}),A.jsx("input",{id:"productImage",type:"file",accept:"image/*",className:"hidden",onChange:Be})]})}),A.jsx("div",{className:"w-full md:w-3/4 mt-6 md:mt-0 md:flex md:flex-col md:self-stretch",children:A.jsxs("div",{className:"flex flex-col gap-2 p-0 md:p-6 md:bg-white md:border md:border-gray-200 md:rounded-lg md:shadow-sm md:h-full",children:[A.jsx("label",{htmlFor:"productName",className:"text-sm font-medium text-gray-700",children:"Product Name"}),A.jsx("input",{type:"text",value:P,onChange:He=>D(He.target.value),placeholder:"Product Name",className:"w-full h-[42px] border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 bg-white rounded-md",required:!0}),A.jsx("label",{htmlFor:"productPrice",className:"text-sm font-medium text-gray-700",children:"Price"}),A.jsx("input",{type:"number",value:$,onChange:He=>G(He.target.value),placeholder:"Price",className:"w-full h-[42px] border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 bg-white rounded-md",required:!0}),A.jsx("label",{htmlFor:"productQuantity",className:"text-sm font-medium text-gray-700",children:"Quantity"}),A.jsxs("div",{className:"flex gap-2",children:[A.jsx("input",{type:"number",value:X,onChange:He=>te(He.target.value),placeholder:"Quantity",className:"flex-1 h-[42px] border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 bg-white rounded-md",required:!0}),A.jsx("select",{value:re?.id||"",onChange:He=>{const lt=le.find(pt=>pt.id===parseInt(He.target.value));fe(lt)},className:"w-[120px] h-[42px] border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 bg-white rounded-md",required:!0,children:le.map(He=>A.jsx("option",{value:He.id,children:He.title},He.id))})]}),A.jsx("label",{className:"text-sm font-medium text-gray-700 mt-4 mb-1",children:"Category (pick up to 3)"}),A.jsx("div",{className:"flex flex-wrap gap-2",children:P5.map(He=>A.jsxs("button",{type:"button",className:"px-3 py-1.5 rounded-full text-sm border flex items-center gap-1 transition "+(xe.includes(He.id)?"bg-orange-100 border-orange-500 text-orange-700 font-semibold":"bg-white border-gray-200 text-gray-800 hover:border-orange-400"),style:{opacity:!xe.includes(He.id)&&xe.length>=3?.6:1,pointerEvents:!xe.includes(He.id)&&xe.length>=3?"none":"auto"},onClick:()=>Ee(He.id),children:[A.jsx("span",{children:He.emoji}),He.name]},He.id))}),xe.length===0&&A.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Pick at least 1 category."})]})})]}),A.jsxs("div",{className:"flex flex-col md:flex-row md:justify-end gap-3",children:[f&&A.jsx("button",{type:"button",onClick:et,className:"w-full md:w-auto px-5 py-2.5 text-sm font-medium text-red-600 border border-red-200 rounded-md hover:bg-red-50 transition",children:"Delete"}),A.jsx("button",{type:"submit",className:"w-full md:w-auto px-6 py-2.5 bg-[#FF8225] text-white rounded-md font-medium hover:bg-[#e6731f] transition",children:f?"Save":"Create"})]})]})})})},BA=()=>{Ma();const{id:s}=ul(),a=Lr(!0),[l,u]=pe.useState(null),[f,y]=pe.useState(null),w="/v1";return pe.useEffect(()=>{if(!s)return;(async()=>{try{const C=await fetch(`${w}/product/${s}`);if(!C.ok)throw new Error("Failed to fetch product");const P=await C.json();u(P.product),y(P.categories)}catch(C){console.error(C)}})()},[s]),console.log(l),a?A.jsxs("div",{className:"w-screen h-screen",children:[A.jsx(hc,{title:s?"Edit Product":"Add Product",backPath:"/business/product"}),A.jsx("main",{className:"overflow-hidden flex flex-col items-center font-inter p-4",children:A.jsx(j5,{vendorId:a.user.id,product:s?l:null,category:s?f:null,onClose:()=>window.history.back()})})]}):null},R5=()=>{Ma();const s=Lr(!0),{id:a}=ul();if(!s)return null;const l=s.user.id;return A.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[A.jsx(hc,{title:"Manage Product"}),A.jsx("main",{className:"p-4 md:mx-auto",children:A.jsx(KS,{vendorId:l,isOwnProfile:!1,showAvailabilityToggle:!0})})]})},L5="/v1",I5=({isVendor:s=!0})=>{Ma();const[a,l]=pe.useState([]);return pe.useEffect(()=>{(async()=>{try{const f=await fetch(`${L5}/marketspace/available`);if(!f.ok)throw new Error("Failed to fetch available marketspace");const y=await f.json();l(y),console.log("Available marketspace:",y)}catch(f){console.error("Error fetching available marketspace:",f)}})()},[]),A.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[A.jsx(hc,{title:"Market Space"}),A.jsx("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 md:mx-auto",children:a.map(u=>A.jsx(XP,{market:u,isVendor:s},u.market_id))})]})},z5=({vendor:s,space:a})=>{const l=Ma();if(!s||!a)return null;const u=async()=>{try{const y=await fetch(`/v1/marketspace/${a.id}/apply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vendor_id:s.id})});l("/business/marketspace/application")}catch(f){console.error(f)}};return A.jsxs("div",{className:"p-4 space-y-6",children:[A.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[A.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Vendor Information"}),A.jsxs("p",{className:"text-sm text-gray-600",children:[A.jsx("span",{className:"font-medium",children:"Name:"})," ",s.name||s.username]}),A.jsxs("p",{className:"text-sm text-gray-600",children:[A.jsx("span",{className:"font-medium",children:"Business License:"})," ",s.license||"-"]})]}),A.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[A.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Space Information"}),A.jsxs("p",{className:"text-sm text-gray-600",children:[A.jsx("span",{className:"font-medium",children:"Lot:"})," ",a.lot]}),A.jsxs("p",{className:"text-sm text-gray-600",children:[A.jsx("span",{className:"font-medium",children:"Rent:"})," RM",a.fee]})]}),A.jsx("div",{className:"absolute bottom-0 left-0 px-4 w-full py-4",children:A.jsx("button",{type:"submit",onClick:u,className:"w-full py-3 bg-[#FF8225] text-white rounded-md font-medium hover:bg-[#e6731f] transition",children:"Submit"})})]})},UA="/v1",D5=()=>{const s=Ma(),{id:a}=ul(),u=Lr(!0)?.user?.id,[f,y]=pe.useState(null),[w,i]=pe.useState(null),[C,P]=pe.useState(!0),[D,$]=pe.useState(null);return pe.useEffect(()=>{(async()=>{try{P(!0),$(null);const[X,te]=await Promise.all([fetch(`${UA}/vendor/${u}/all`),fetch(`${UA}/marketspace/${a}`)]);if(!X.ok)throw new Error("Failed to fetch vendor");if(!te.ok)throw new Error("Failed to fetch market space");const le=await X.json(),re=await te.json();console.log(le),y(le),i(re)}catch(X){$(X.message||"Failed to load data")}finally{P(!1)}})()},[u,a]),A.jsxs("div",{className:"w-screen h-screen flex flex-col relative",children:[A.jsx("div",{className:"px-4 py-4 bg-white",children:A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("button",{onClick:()=>s(-1),className:"text-gray-700 hover:text-orange-500 transition",children:A.jsx(Mm,{className:"text-2xl"})}),A.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Space Application"})]})}),A.jsxs("div",{className:"flex-1 overflow-auto bg-gray-50",children:[C&&A.jsx("div",{className:"flex justify-center items-center h-40",children:A.jsx("div",{className:"animate-spin h-8 w-8 border-b-2 border-orange-500"})}),D&&A.jsxs("div",{className:"p-4 text-red-600 text-sm",children:["Error: ",D]}),!C&&!D&&A.jsx(z5,{vendor:f,space:w})]})]})},$A="/v1",O5=()=>{const[s,a]=pe.useState("all"),l=Ma(),u=Lr(!0),[f,y]=pe.useState([]),[w,i]=pe.useState(!0),[C,P]=pe.useState({}),D=u?.user?.id;pe.useEffect(()=>{if(!D)return;(async()=>{try{const le=await(await fetch(`${$A}/vendor/${D}/marketspace/application`)).json();y(le||[])}catch(te){console.error("Failed to fetch applications",te)}finally{i(!1)}})()},[D]);const $=f.filter(X=>s==="all"?!0:s==="pending"?X.application_status===2:s==="approved"?X.application_status===1:s==="rejected"?X.application_status!==1&&X.application_status!==2:!0),G=async(X,te)=>{if(!C[te]){P(le=>({...le,[te]:!0}));try{await fetch(`${$A}/vendor/${X}/marketspace/application?id=${te}`,{method:"DELETE"}),y(le=>le.filter(re=>re.application_id!==te))}catch{alert("Failed to withdraw application")}finally{P(le=>({...le,[te]:!1}))}}};return A.jsxs("div",{className:"w-screen h-screen flex flex-col relative bg-gray-50",children:[A.jsx("div",{className:"px-4 py-4",children:A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("button",{onClick:()=>l("/profile"),className:"text-gray-700 hover:text-orange-500 transition",children:A.jsx(Mm,{className:"text-2xl"})}),A.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"My application"})]})}),A.jsx("div",{className:"px-4 pb-6 flex-1 overflow-y-auto",children:w?A.jsx("p",{className:"text-sm text-gray-500",children:"Loading..."}):f.length>0?A.jsxs(A.Fragment,{children:[A.jsxs("div",{className:"flex gap-2 mb-4",children:[A.jsx("button",{onClick:()=>a("all"),className:`px-3 py-1 text-xs rounded-full font-medium ${s==="all"?"bg-gray-800 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All"}),A.jsx("button",{onClick:()=>a("approved"),className:`px-3 py-1 text-xs rounded-full font-medium ${s==="approved"?"bg-green-600 text-white":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:"Accepted"}),A.jsx("button",{onClick:()=>a("pending"),className:`px-3 py-1 text-xs rounded-full font-medium ${s==="pending"?"bg-yellow-500 text-white":"bg-yellow-100 text-yellow-700 hover:bg-yellow-200"}`,children:"Pending"}),A.jsx("button",{onClick:()=>a("rejected"),className:`px-3 py-1 text-xs rounded-full font-medium ${s==="rejected"?"bg-red-600 text-white":"bg-red-100 text-red-700 hover:bg-red-200"}`,children:"Rejected"})]}),A.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:$.map(X=>A.jsxs("div",{className:"bg-white border rounded-xl shadow-sm overflow-hidden flex flex-col md:items-stretch transition",children:[A.jsx("div",{className:"w-full h-36 md:h-40 flex-shrink-0 bg-gray-100",children:X.market_image?A.jsx("img",{src:X.market_image,alt:X.market_name,className:"w-full h-full object-cover"}):A.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-400",children:"No Image"})}),A.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-between",children:[A.jsxs("div",{children:[A.jsx("p",{className:"text-sm font-semibold text-gray-800",children:X.market_name}),A.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Lot ",X.lot]}),A.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Applied on"," ",new Date(X.submitted_at).toLocaleDateString()]})]}),A.jsxs("div",{className:"flex items-center justify-between mt-3",children:[A.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${X.application_status===2?"bg-yellow-100 text-yellow-700":X.application_status===1?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:X.application_status===2?"Pending":X.application_status===1?"Approved":"Rejected"}),X.application_status===2&&A.jsxs("button",{className:"flex items-center gap-1 text-xs text-red-600 hover:text-red-700 font-medium disabled:opacity-50",onClick:()=>G(D,X.application_id),type:"button",disabled:C[X.application_id],children:[A.jsx(XO,{className:"text-sm"}),C[X.application_id]?"Withdrawing...":"Withdraw"]}),X.application_status===1&&A.jsxs("button",{className:"flex items-center gap-1 text-xs text-green-600 hover:text-green-700 font-medium",onClick:()=>l(`/business/marketspace/${X.space_id}`),children:[A.jsx(YO,{className:"text-sm"}),"Manage Product"]})]})]})]},X.application_id))})]}):A.jsx("p",{className:"text-sm text-gray-500",children:"You have not applied for any marketspace yet."})})]})},N5="/v1",F5=()=>{const s=Lr(!0),a=Ma(),[l,u]=pe.useState([]),[f,y]=pe.useState(!0),w=s?.user?.id;pe.useEffect(()=>{if(!w)return;(async()=>{try{const D=await(await fetch(`${N5}/visitor/${w}/market-history`)).json();u(D)}catch(P){console.error("Failed to fetch market history",P)}finally{y(!1)}})()},[w]);const i=C=>{const P=new Date(C),D=new Date,$=P.toDateString()===D.toDateString(),G=new Date(D);G.setDate(D.getDate()-1);const X=P.toDateString()===G.toDateString(),te=P.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0});let le;return $?le="Today":X?le="Yesterday":P.getFullYear()===D.getFullYear()?le=P.toLocaleDateString(void 0,{month:"short",day:"numeric"}):le=P.toLocaleDateString("en-GB"),{displayDate:le,time:te}};return A.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[A.jsx("div",{className:"px-4 py-4",children:A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("button",{onClick:()=>a("/profile"),className:"text-gray-700 hover:text-orange-500 transition",children:A.jsx(Mm,{className:"text-2xl"})}),A.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Market History"})]})}),A.jsx("div",{className:"flex-1 px-4 overflow-y-auto",children:f?A.jsx("p",{className:"text-gray-500 text-sm",children:"Loading history..."}):l.length===0?A.jsx("p",{className:"text-gray-500 text-sm",children:"No market history found"}):A.jsx("div",{className:"flex flex-col md:flex-row md:flex-wrap md:gap-4 gap-4 justify-center mb-4",children:l.map(C=>A.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition overflow-hidden flex flex-col md:flex-row max-h-92 md:h-60 md:w-[48%]",children:[A.jsx("div",{className:"relative w-full md:w-1/2 h-32 md:h-full bg-gray-100 flex-shrink-0",children:C.market_image?A.jsx("img",{src:C.market_image,alt:C.market_name,className:"w-full h-full object-cover"}):A.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-sm",children:"No Image"})}),A.jsxs("div",{className:"px-4 py-3 w-full md:w-1/2 flex flex-col",children:[A.jsx("h2",{className:"text-base font-semibold text-gray-800 text-center mb-2",children:C.market_name}),A.jsxs("div",{className:"flex-1 flex flex-col",children:[A.jsxs("p",{className:"text-xs font-medium text-gray-500 mb-2",children:["Visit History (",C.visits.length,")"]}),A.jsx("div",{className:"max-h-28 overflow-y-auto space-y-2 pr-1 flex-1 no-scrollbar",children:C.visits.sort((P,D)=>new Date(D.visited_at)-new Date(P.visited_at)).map(P=>A.jsxs("div",{className:"flex items-center justify-between text-sm bg-gray-50 rounded-lg px-3 py-2",children:[A.jsx("span",{className:"text-gray-700",children:i(P.visited_at).displayDate}),A.jsx("span",{className:"text-gray-500 text-xs",children:i(P.visited_at).time})]},P.history_id))})]}),A.jsx("div",{className:"pt-3",children:A.jsx($s,{to:C.review_id!=null?`/market-review/${C.review_id}`:`/market/${C.market_id}/review`,className:`block w-full py-2 text-sm font-medium rounded-lg text-center transition
                ${C.review_id!=null?"bg-orange-500 text-white hover:bg-orange-600":"border border-orange-400 text-orange-500 hover:bg-orange-500 hover:text-white"}
                `,children:C.review_id!=null?"Edit review":"Leave a review"})})]})]},C.market_id))})})]})},B5="/v1",U5=()=>{const s=Lr(!0);Ma();const[a,l]=pe.useState([]),[u,f]=pe.useState(!0),y=s?.user?.id;return pe.useEffect(()=>{if(!y)return;(async()=>{try{const C=await(await fetch(`${B5}/visitor/${y}/market-bookmark`)).json();l(C)}catch(i){console.error("Failed to fetch market bookmarks",i)}finally{f(!1)}})()},[y]),A.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[A.jsx(hc,{title:"Market Bookmark",backPath:"/profile"}),A.jsx("div",{className:"flex-1 px-4 py-2 grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 overflow-y-auto",children:u?A.jsx("p",{className:"text-gray-500 text-sm",children:"Loading bookmarks..."}):a.length===0?A.jsx("p",{className:"text-gray-500 text-sm",children:"No bookmarks found"}):a.map(w=>A.jsxs($s,{to:`/market/${w.market_id}`,className:"relative w-full h-40 rounded-xl overflow-hidden shadow-md hover:shadow-lg transition cursor-pointer",children:[A.jsx("img",{src:w.market_image||"https://via.placeholder.com/300x200",alt:w.market_name,className:"w-full h-full object-cover"}),A.jsx("div",{className:"absolute inset-0 bg-black/25 flex flex-col justify-between",children:A.jsx("div",{className:"flex-1 flex items-center justify-center",children:A.jsx("h2",{className:"text-white text-lg font-semibold text-center px-2",children:w.market_name})})})]},w.market_id))})]})},VA=()=>{Ma();const{review_id:s,market_id:a}=ul();return A.jsxs("div",{className:"w-screen min-h-screen flex flex-col",children:[A.jsx(hc,{title:"Market Review"}),A.jsx("div",{className:"flex-1 w-full px-4 md:px-8 pb-10",children:A.jsx("div",{className:"max-w-3xl mx-auto overflow-hidden",children:A.jsx(GP,{market_id:a,review_id:s})})})]})},HA="/v1",$5=()=>{Ma();const{market_id:s}=ul(),[a,l]=pe.useState([]),[u,f]=pe.useState(!0);pe.useEffect(()=>{if(!s)return;(async()=>{try{const i=await fetch(`${HA}/market/${s}/review`);if(!i.ok)throw new Error("Failed to fetch reviews");const C=await i.json();l(C)}catch(i){console.error(i)}finally{f(!1)}})()},[s]);const y=async(w,i)=>{try{await fetch(`${HA}/market/${s}/review?id=${w}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({hide:i})}),l(C=>C.map(P=>P.id===w?{...P,hide:i}:P))}catch(C){console.error("Failed to update review visibility",C),alert("Failed to update review visibility")}};return A.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[A.jsx(hc,{title:"Market Reviews"}),A.jsx("div",{className:"flex-1 px-4 py-4 overflow-y-auto space-y-4",children:u?A.jsx("p",{className:"text-gray-500 text-sm",children:"Loading reviews..."}):a.length===0?A.jsx("p",{className:"text-gray-500 text-sm",children:"No reviews found"}):a.map(w=>A.jsx(HP,{review:w,onToggleHide:y,isOwnProfile:!0},w.id))})]})},q0=({title:s,data:a,trendText:l,filter:u,filterByTime:f})=>{const y=f(a),w=s==="Rating",i=w?y.length>0?(y.reduce((te,le)=>te+(le.rating||0),0)/y.length).toFixed(1):"0.0":y.length,C=w?a.length>0?a.length:0:a.length,D=(()=>{if(!a)return 0;const te=new Date,le=a.filter(re=>{const fe=new Date(re.created_at);switch(u){case"today":{const xe=new Date(te);return xe.setDate(te.getDate()-1),fe.toDateString()===xe.toDateString()}case"week":{const xe=new Date(te);xe.setDate(te.getDate()-te.getDay()-7);const be=new Date(xe);return be.setDate(xe.getDate()+6),fe>=xe&&fe<=be}case"month":{const xe=te.getMonth()-1,be=xe<0?te.getFullYear()-1:te.getFullYear(),Ne=xe<0?11:xe;return fe.getMonth()===Ne&&fe.getFullYear()===be}case"year":{const xe=te.getFullYear()-1;return fe.getFullYear()===xe}case"all":default:return!1}});return w?le.length>0?le.reduce((re,fe)=>re+(fe.rating||0),0)/le.length:0:le.length})();let $,G;const X=w?parseFloat(i):Number(i);return $=X>=D,X===0&&D===0?G=0:D===0?G=100:G=Math.floor((X-D)/D*100),A.jsxs("div",{className:"bg-white rounded-xl shadow p-4 flex flex-col gap-2",children:[A.jsx("p",{className:"text-sm font-medium text-gray-500",children:s}),A.jsxs("div",{className:"flex items-end justify-start",children:[A.jsx("p",{className:"text-4xl font-semibold text-gray-800",children:i}),u!=="all"&&A.jsxs("div",{className:"flex items-end",children:[$?A.jsx(UM,{className:"text-green-500 -mb-2.5 -mx-1.5",size:40}):A.jsx(BM,{className:"text-red-500 -mb-1.5 -mx-1.5",size:40}),A.jsxs("span",{className:`text-xl ${$?"text-green-500":"text-red-500"}`,children:[G,"%"]})]})]}),A.jsx("p",{className:"text-xs text-gray-500",children:l.replace("xx",C)})]})},O1="/v1",V5=()=>{const s=Ma(),{market_id:a}=ul(),[l,u]=pe.useState("today"),[f,y]=pe.useState(null),[w,i]=pe.useState([]),C=()=>{a&&(window.location.href=`${O1}/market/${a}/statistic-download`)};pe.useEffect(()=>{if(!a)return;const $=async()=>{try{const X=await fetch(`${O1}/market/${a}/statistic`);if(!X.ok)throw new Error("Failed to fetch statistic");const te=await X.json();y(te)}catch(X){console.error(X)}},G=async()=>{try{const X=await fetch(`${O1}/market/${a}/vendor`);if(!X.ok)throw new Error("Failed to fetch vendors");const te=await X.json();i(te)}catch(X){console.error(X)}};$(),G()},[a]);const P=$=>{if(!$)return[];const G=new Date;return $.filter(X=>{const te=new Date(X.created_at);switch(l){case"Today":return te.toDateString()===G.toDateString();case"This Week":const le=new Date(G);return le.setDate(G.getDate()-G.getDay()),te>=le;case"This Month":return te.getMonth()===G.getMonth()&&te.getFullYear()===G.getFullYear();case"This Year":return te.getFullYear()===G.getFullYear();case"All Time":default:return!0}})},D=[...w].sort(($,G)=>G.avg_rating-$.avg_rating).slice(0,3);return A.jsxs("div",{className:"w-screen h-full flex flex-col relative",children:[A.jsx("div",{className:"px-4 py-4",children:A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("button",{onClick:()=>s(-1),className:"text-gray-700 hover:text-orange-500 transition",children:A.jsx(Mm,{className:"text-2xl"})}),A.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Market Statistic"})]})}),A.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[A.jsxs("select",{className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-orange-400",value:l,onChange:$=>u($.target.value),children:[A.jsx("option",{value:"today",children:"Today"}),A.jsx("option",{value:"week",children:"This Week"}),A.jsx("option",{value:"month",children:"This Month"}),A.jsx("option",{value:"year",children:"This Year"}),A.jsx("option",{value:"all",children:"All Time"})]}),A.jsxs("button",{onClick:C,className:"flex items-center gap-1 px-3 py-1 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition",children:[A.jsx(YM,{className:"text-lg"}),"Full Report"]})]}),A.jsx("div",{className:"px-4 py-2 grid grid-cols-2 gap-4",children:f&&A.jsxs(A.Fragment,{children:[A.jsx(q0,{title:"People Visit",data:f.market_history,trendText:"xx people have visited your market",filter:l,filterByTime:P}),A.jsx(q0,{title:"Rating",data:f.market_review,trendText:"xx people have reviewed your market",filter:l,filterByTime:P}),A.jsx(q0,{title:"Mentions",data:f.market_content,trendText:"Your market has been mentioned xx times",filter:l,filterByTime:P}),A.jsx(q0,{title:"Market Click",data:f.market_click,trendText:"xx people have clicked on your market",filter:l,filterByTime:P})]})}),D.length>0&&A.jsxs("div",{className:"px-4 py-4",children:[A.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Top Vendors"}),A.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:D.map(($,G)=>A.jsxs("div",{className:`px-4 py-2 rounded-xl shadow flex items-center border-2 gap-4 ${G===0?"border-yellow-300":G===1?"border-gray-300":"border-orange-200"}`,children:[A.jsx("p",{className:"font-bold text-xl w-6 text-center",children:G+1}),A.jsx("img",{src:$.image,alt:$.name,className:"w-16 h-16 object-cover rounded-full"}),A.jsxs("div",{className:"flex justify-between w-full items-center gap-2",children:[A.jsx("p",{className:"font-semibold text-gray-800",children:$.name}),A.jsxs("div",{className:"flex items-center text-yellow-400",children:[A.jsx(Zo,{className:"inline-block"}),A.jsx("span",{className:"ml-1",children:$.avg_rating})]})]})]},$.vendor_id))})]})]})},GA="/v1",N1=({title:s,count:a,prevCount:l,totalCount:u,trendText:f,filter:y})=>{const w=a>=l;let i;return a===0&&l===0?i=0:l===0?i=100:i=Math.floor((a-l)/l*100),A.jsxs("div",{className:"bg-white rounded-xl shadow p-4 flex flex-col gap-2",children:[A.jsx("p",{className:"text-sm font-medium text-gray-500",children:s}),A.jsxs("div",{className:"flex items-end justify-start gap-2",children:[A.jsx("p",{className:"text-4xl font-semibold text-gray-800",children:a}),y!=="all"&&A.jsxs("div",{className:"flex items-end",children:[w?A.jsx(UM,{className:"text-green-500 -mb-2.5 -mx-1.5",size:40}):A.jsx(BM,{className:"text-red-500 -mb-1.5 -mx-1.5",size:40}),A.jsxs("span",{className:`text-xl ${w?"text-green-500":"text-red-500"}`,children:[i,"%"]})]})]}),A.jsx("p",{className:"text-xs text-gray-500",children:f.replace("xx",u)})]})},H5=({idx:s,product:a})=>A.jsxs("div",{className:`p-4 rounded-xl border-2 flex items-center gap-4 bg-white shadow mb-3 ${s===0?"border-yellow-300":s===1?"border-gray-300":"border-orange-200"}`,style:{minHeight:90},children:[A.jsx("div",{className:"font-bold text-2xl w-8 text-center flex-shrink-0",children:s+1}),a.image?A.jsx("img",{src:a.image,alt:a.name,className:"w-16 h-16 object-cover rounded-lg border border-gray-100",style:{background:"#f3f3f3"}}):A.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400",children:A.jsx(Zo,{className:"text-2xl"})}),A.jsxs("div",{className:"flex flex-col justify-center flex-1 min-w-0",children:[A.jsx("div",{className:"truncate font-semibold text-gray-900",children:a.name}),A.jsxs("div",{className:"flex items-center mt-1 text-yellow-500 font-medium text-base",children:[A.jsx(Zo,{className:"mr-1"}),a.avg_rating.toFixed(1)]})]})]}),G5=()=>{const a=Lr(!0)?.user?.id;Ma();const[l,u]=pe.useState(null),[f,y]=pe.useState("today");pe.useEffect(()=>{if(!a)return;(async()=>{try{const fe=await fetch(`${GA}/vendor/${a}/statistic`);if(!fe.ok)throw new Error("Failed to fetch vendor statistic");const xe=await fe.json();u(xe)}catch(fe){console.error(fe)}})()},[a]);const w=re=>{if(!re)return[];const fe=new Date;return re.filter(xe=>{const be=new Date(xe.created_at);switch(f){case"today":return be.toDateString()===fe.toDateString();case"week":const Ne=new Date(fe);return Ne.setDate(fe.getDate()-fe.getDay()),be>=Ne;case"month":return be.getMonth()===fe.getMonth()&&be.getFullYear()===fe.getFullYear();case"year":return be.getFullYear()===fe.getFullYear();case"all":default:return!0}})},i=re=>{if(!re)return 0;const fe=new Date;return re.filter(xe=>{const be=new Date(xe.created_at);switch(f){case"today":{const Ne=new Date(fe);return Ne.setDate(fe.getDate()-1),be.toDateString()===Ne.toDateString()}case"week":{const Ne=new Date(fe);Ne.setDate(fe.getDate()-fe.getDay()-7);const Be=new Date(Ne);return Be.setDate(Ne.getDate()+6),be>=Ne&&be<=Be}case"month":{const Ne=fe.getMonth()-1,Be=Ne<0?fe.getFullYear()-1:fe.getFullYear(),Ee=Ne<0?11:Ne;return be.getMonth()===Ee&&be.getFullYear()===Be}case"year":{const Ne=fe.getFullYear()-1;return be.getFullYear()===Ne}case"all":default:return!1}}).length},C=w(l?.profile_click)?.length||0,P=i(l?.profile_click_prev),D=w(l?.account_follow)?.length||0,$=i(l?.account_follow_prev);let G=0,X=0;if(l?.products?.length>0){const re=l.products.map(xe=>!xe.reviews||xe.reviews.length===0?null:xe.reviews.reduce((be,Ne)=>be+Ne.rating,0)/xe.reviews.length).filter(Boolean);re.length>0&&(G=re.reduce((xe,be)=>xe+be,0)/re.length);const fe=l.products.map(xe=>!xe.reviews_prev||xe.reviews_prev.length===0?null:xe.reviews_prev.reduce((be,Ne)=>be+Ne.rating,0)/xe.reviews_prev.length).filter(Boolean);fe.length>0&&(X=fe.reduce((xe,be)=>xe+be,0)/fe.length)}const te=pe.useMemo(()=>l?.products?.map(re=>{if(!re.reviews||re.reviews.length===0)return null;const fe=re.reviews.reduce((xe,be)=>xe+be.rating,0)/re.reviews.length;return{...re.product,avg_rating:fe,image:re.product?.image}}).filter(Boolean).sort((re,fe)=>fe.avg_rating-re.avg_rating).slice(0,3)||[],[l]),le=()=>{a&&(window.location.href=`${GA}/vendor/${a}/statistic-download`)};return A.jsxs("div",{className:"relative w-full h-screen",children:[A.jsx(hc,{title:"Vendor Statistic"}),A.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4 flex justify-between items-center mb-4",children:[A.jsxs("select",{className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-orange-400",value:f,onChange:re=>y(re.target.value),children:[A.jsx("option",{value:"today",children:"Today"}),A.jsx("option",{value:"week",children:"This Week"}),A.jsx("option",{value:"month",children:"This Month"}),A.jsx("option",{value:"year",children:"This Year"}),A.jsx("option",{value:"all",children:"All Time"})]}),A.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-orange-500 text-white hover:bg-orange-600 text-sm font-medium transition",onClick:le,children:[A.jsx(YM,{className:"text-lg"}),"Full Report"]})]}),l&&A.jsxs("div",{className:`w-full max-w-2xl mx-auto px-4 mb-8 \r
                  grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6`,children:[A.jsx(N1,{title:"Profile Clicks",count:C,prevCount:P,totalCount:l?.profile_click?.length||0,trendText:"Total click counts on your profile",filter:f}),A.jsx(N1,{title:"Followers",count:D,prevCount:$,totalCount:l?.account_follow?.length||0,trendText:"Current number of followers",filter:f}),A.jsx(N1,{title:"Review Score",count:parseFloat(G.toFixed(1)),prevCount:parseFloat(X.toFixed(1)),totalCount:l?.products?.length||0,trendText:"Overall average rating of your products",filter:f})]}),te.length>0&&A.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4",children:[A.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4 mt-8",children:"Top 3 Products"}),te.map((re,fe)=>A.jsx(H5,{idx:fe,product:re},re.id))]})]})},F1=[{label:"Markets",value:128,icon:A.jsx(Cm,{size:60})},{label:"Vendors",value:920,icon:A.jsx(fb,{size:60})},{label:"Products",value:5400,icon:A.jsx(cx,{size:60})}],q5=()=>{const{t:s,i18n:a}=VP(),l=$=>a.changeLanguage($),u=Ma();localStorage.setItem("isHello","true");const[f,y]=pe.useState(F1.map(()=>0)),[w,i]=pe.useState(!1),C=pe.useRef(null),P=pe.useRef(null),D=()=>{P.current?.scrollIntoView({behavior:"smooth",block:"start"})};return pe.useEffect(()=>{if(!C.current)return;const $=()=>{const te=performance.now(),le=re=>{const fe=Math.min((re-te)/1200,1);y(F1.map(xe=>Math.round(xe.value*fe))),fe<1&&requestAnimationFrame(le)};requestAnimationFrame(le)},G=new IntersectionObserver(X=>{X.some(te=>te.isIntersecting)&&!w&&(i(!0),$())},{threshold:.35});return G.observe(C.current),()=>G.disconnect()},[w]),A.jsxs("div",{className:"font-inter text-[var(--black)] snap-y snap-mandatory",style:{background:"linear-gradient(to bottom, color-mix(in srgb, var(--orange) 10%, transparent) 0%, var(--white) 25%, var(--white) 100%)"},children:[A.jsx("header",{className:"fixed top-0 left-0 w-full z-30",children:A.jsxs("div",{className:"w-full px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between gap-3 backdrop-blur-lg bg-[color-mix(in srgb,var(--white) 30%,transparent)]",children:[A.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[A.jsx("img",{src:"/tamulokal.png",alt:"Tamukinabalu logo",className:"h-8 w-8 sm:h-10 sm:w-10 object-contain"}),A.jsx("span",{className:"text-base sm:text-xl font-semibold text-[var(--black)]",children:"Tamukinabalu"})]}),A.jsx("div",{className:"flex items-center gap-2 sm:gap-3 shrink-0",children:A.jsxs("button",{onClick:()=>l(a.language==="en"?"ms":"en"),className:"inline-flex items-center gap-1.5 px-3 py-2 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm font-semibold transition shadow-sm hover:shadow-md border border-[var(--gray)] bg-[color-mix(in srgb,var(--white) 70%,transparent)] text-[var(--black)]",children:[A.jsx(iP,{className:"text-base sm:text-lg"}),a.language==="en"?"EN":"MS"]})})]})}),A.jsxs("section",{className:"min-h-screen snap-start flex flex-col justify-center items-center px-6 text-center relative overflow-hidden pt-28 pb-16 sm:pt-24",children:[A.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`
              radial-gradient(circle at top left, color-mix(in srgb,var(--orange) 15%, transparent) 0%, transparent 35%),
              radial-gradient(circle at bottom right, color-mix(in srgb,var(--orange) 15%, transparent) 0%, transparent 35%)
            `}}),A.jsxs("div",{className:"max-w-4xl mx-auto relative",children:[A.jsxs("h1",{className:"text-4xl md:text-5xl lg:text-6xl font-extrabold leading-tight text-[var(--black)]",children:[s("Your Tamu Adventure"),A.jsxs("span",{className:"text-[var(--orange)]",children:[" ",s("Starts Here")]})]}),A.jsx("p",{className:"mt-4 md:mt-6 max-w-2xl mx-auto text-base md:text-lg text-[var(--black)]",children:s("Discover street markets near you in Kota Kinabalucheck whats happening today, navigate easily, and plan your visit before you arrive.")}),A.jsxs("div",{className:"mt-8 flex justify-center gap-3",children:[A.jsx("button",{onClick:D,className:"px-7 py-3 rounded-full text-sm font-semibold transition shadow-sm hover:shadow-md inline-flex items-center justify-center gap-2 border border-[var(--orange)] text-[var(--orange)] bg-[color-mix(in srgb,var(--white) 80%,transparent)]",children:s("Learn More")}),A.jsx("button",{onClick:()=>u("/"),className:"px-7 py-3 rounded-full text-sm font-semibold transition shadow-md hover:shadow-lg inline-flex items-center justify-center gap-2 bg-[var(--orange)] text-[var(--white)]",children:s("Explore Now")})]})]})]}),A.jsx("section",{ref:P,className:"min-h-screen snap-start flex items-center px-6 bg-[var(--white)] pt-24 pb-16",children:A.jsxs("div",{className:"max-w-6xl mx-auto w-full",children:[A.jsxs("div",{className:"text-center mb-10",children:[A.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:s("Features")}),A.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-[var(--black)] mt-2",children:s("Designed for visitors exploring Kota Kinabalu")}),A.jsx("p",{className:"mt-3 text-[var(--gray)] max-w-3xl mx-auto",children:s("Find the best Tamu nearby, see whats live right now, and plan your route before you head out.")})]}),A.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[A.jsx(B1,{icon:A.jsx(HS,{size:32}),title:s("Find nearby markets"),desc:s("See Tamu around you with distance and open/close times at a glance.")}),A.jsx(B1,{icon:A.jsx(zO,{size:32}),title:s("Navigate easily"),desc:s("One-tap directions to markets, optimized for walking or driving.")}),A.jsx(B1,{icon:A.jsx(GS,{size:32}),title:s("Engage with others"),desc:s("Share your posts, tips, and join forum discussions with other market-goers.")})]})]})}),A.jsx("section",{ref:C,className:"min-h-screen snap-start flex items-center px-6 bg-[var(--white)] relative overflow-hidden pt-24 pb-16",children:A.jsxs("div",{className:"max-w-5xl mx-auto w-full",children:[A.jsxs("div",{className:"text-center mb-12",children:[A.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:s("By the Numbers")}),A.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-[var(--black)] mt-2",children:s("A thriving community of markets, vendors, and products")}),A.jsx("p",{className:"mt-3 text-[var(--gray)] max-w-2xl mx-auto",children:s("Real-time snapshots of Tamukinabalus ecosystemgrowing every day to help visitors discover, vendors thrive, and organizers succeed.")})]}),A.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:F1.map(($,G)=>A.jsxs("div",{className:"rounded-2xl shadow-lg p-4 border bg-[var(--white)] border-[color-mix(in srgb,var(--orange) 20%, transparent)] flex flex-col items-center text-center gap-4",children:[A.jsx("div",{className:"w-16 h-16 flex items-center justify-center rounded-full text-3xl bg-[color-mix(in srgb,var(--orange) 18%, transparent)] text-[var(--gray)]",children:$.icon}),A.jsx("div",{className:"text-lg font-semibold text-[var(--black)]",children:s($.label)}),A.jsx("div",{className:"text-4xl md:text-5xl font-extrabold text-[var(--black)]",children:f[G].toLocaleString()})]},$.label))})]})}),A.jsx("section",{className:"min-h-screen snap-start flex items-center px-6 bg-[color-mix(in srgb,var(--black) 5%, transparent)] pt-24 pb-16",children:A.jsxs("div",{className:"max-w-5xl mx-auto w-full text-center",children:[A.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-[var(--orange)]",children:s("Partner with Tamukinabalu")}),A.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-[var(--black)] mt-2",children:s("Grow your presence as a Vendor or Organizer")}),s("Showcase products, manage applications, and run smoother events with our tools built for local markets."),A.jsxs("div",{className:"mt-10 grid grid-cols-1 md:grid-cols-2 gap-6",children:[A.jsx(qA,{title:s("Vendors"),bullets:[s("Apply to markets and secure spots"),s("Showcase products and offers"),s("Engage with visitors directly")],ctaText:s("Join as Vendor"),onClick:()=>{localStorage.setItem("signupRole","vendor"),u("/auth")}}),A.jsx(qA,{title:s("Organizers"),bullets:[s("Create and manage market events"),s("Approve vendors and assign slots"),s("Track performance and attendance")],ctaText:s("Start as Organizer"),onClick:()=>{localStorage.setItem("signupRole","organizer"),u("/auth")}})]})]})}),A.jsxs("section",{className:"min-h-screen snap-start flex items-center px-6 text-center bg-[var(--orange)] text-[var(--white)] pt-24 pb-16 relative overflow-hidden",children:[A.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`
              radial-gradient(circle at 20% 20%, rgba(255,255,255,0.18) 0%, transparent 35%),
              radial-gradient(circle at 80% 30%, rgba(255,255,255,0.12) 0%, transparent 32%),
              radial-gradient(circle at 40% 80%, rgba(255,255,255,0.14) 0%, transparent 32%)
            `}}),A.jsxs("div",{className:"max-w-4xl mx-auto relative",children:[A.jsx("p",{className:"text-sm font-semibold tracking-[0.12em] uppercase opacity-90",children:" Lets Go"}),A.jsx("h2",{className:"text-3xl md:text-4xl font-extrabold mt-2",children:s("Ready to Explore?")}),A.jsx("p",{className:"mt-3 text-base md:text-lg opacity-90",children:s("Jump into Kota Kinabalus street markets and start your adventure today.")}),A.jsx("div",{className:"mt-7 flex flex-wrap justify-center gap-3",children:A.jsx("button",{onClick:()=>u("/"),className:"px-7 py-3 rounded-full text-sm font-semibold transition shadow-md hover:shadow-lg inline-flex items-center justify-center gap-2 bg-[var(--white)] text-[var(--orange)]",children:s("Explore Now")})})]})]}),A.jsxs("footer",{className:"text-sm py-8 px-6 text-center bg-[var(--black)] text-[var(--white)]",children:[" ",new Date().getFullYear()," Tamukinabalu. ",s("All rights reserved.")]})]})},B1=({icon:s,title:a,desc:l})=>A.jsxs("div",{className:"rounded-xl shadow-sm border p-6 text-left bg-[var(--white)] border-[color-mix(in srgb,var(--black) 10%, transparent)]",children:[A.jsx("div",{className:"w-12 h-12 flex items-center justify-center rounded-full text-xl mb-4 bg-[color-mix(in srgb,var(--orange) 15%, transparent)] text-[var(--orange)]",children:s}),A.jsx("h3",{className:"font-semibold mb-2 text-lg text-[var(--black)]",children:a}),A.jsx("p",{className:"text-sm leading-relaxed text-[var(--gray)]",children:l})]}),qA=({title:s,bullets:a,ctaText:l,onClick:u})=>A.jsxs("div",{className:"rounded-xl shadow-sm border p-6 text-left bg-[var(--white)] border-[color-mix(in srgb,var(--black) 12%, transparent)] flex flex-col h-full",children:[A.jsx("h3",{className:"text-xl font-semibold text-[var(--black)] mb-3",children:s}),A.jsx("ul",{className:"space-y-2 text-[var(--gray)] text-sm flex-1",children:a.map((f,y)=>A.jsxs("li",{className:"flex gap-2 items-start",children:[A.jsx(GM,{className:"text-[var(--green)] mt-[2px]"}),A.jsx("span",{children:f})]},y))}),A.jsx("button",{onClick:u,className:"mt-6 inline-flex items-center justify-center px-5 py-3 rounded-full text-sm font-semibold bg-[var(--orange)] text-[var(--white)] shadow-sm hover:shadow-md transition",children:l})]});var pb={exports:{}},W5=pb.exports,WA;function Z5(){return WA||(WA=1,(function(s,a){(function(l,u){s.exports=u()})(W5,(function(){var l,u,f;function y(i,C){if(!l)l=C;else if(!u)u=C;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",D={};l(D),f=C(D),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}y(["exports"],(function(i){var C=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function D(r,e){var n=e[0],c=e[1],d=e[2],g=e[3],_=n*g-d*c;return _?(r[0]=g*(_=1/_),r[1]=-c*_,r[2]=-d*_,r[3]=n*_,r):null}function $(){var r=new P(9);return P!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function G(r,e){var n=e[0],c=e[1],d=e[2],g=e[3],_=e[4],S=e[5],M=e[6],R=e[7],N=e[8];return r[0]=_*N-S*R,r[1]=d*R-c*N,r[2]=c*S-d*_,r[3]=S*M-g*N,r[4]=n*N-d*M,r[5]=d*g-n*S,r[6]=g*R-_*M,r[7]=c*M-n*R,r[8]=n*_-c*g,r}function X(r,e,n){var c=e[0],d=e[1],g=e[2],_=e[3],S=e[4],M=e[5],R=e[6],N=e[7],F=e[8],U=n[0],W=n[1],Z=n[2],ee=n[3],ce=n[4],oe=n[5],me=n[6],ve=n[7],Se=n[8];return r[0]=U*c+W*_+Z*R,r[1]=U*d+W*S+Z*N,r[2]=U*g+W*M+Z*F,r[3]=ee*c+ce*_+oe*R,r[4]=ee*d+ce*S+oe*N,r[5]=ee*g+ce*M+oe*F,r[6]=me*c+ve*_+Se*R,r[7]=me*d+ve*S+Se*N,r[8]=me*g+ve*M+Se*F,r}function te(){var r=new P(16);return P!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function le(r){var e=new P(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function re(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function fe(r,e){var n=e[0],c=e[1],d=e[2],g=e[3],_=e[4],S=e[5],M=e[6],R=e[7],N=e[8],F=e[9],U=e[10],W=e[11],Z=e[12],ee=e[13],ce=e[14],oe=e[15],me=n*S-c*_,ve=n*M-d*_,Se=n*R-g*_,De=c*M-d*S,Re=c*R-g*S,$e=d*R-g*M,We=N*ee-F*Z,tt=N*ce-U*Z,_t=N*oe-W*Z,nt=F*ce-U*ee,xt=F*oe-W*ee,Mt=U*oe-W*ce,Pt=me*Mt-ve*xt+Se*nt+De*_t-Re*tt+$e*We;return Pt?(r[0]=(S*Mt-M*xt+R*nt)*(Pt=1/Pt),r[1]=(d*xt-c*Mt-g*nt)*Pt,r[2]=(ee*$e-ce*Re+oe*De)*Pt,r[3]=(U*Re-F*$e-W*De)*Pt,r[4]=(M*_t-_*Mt-R*tt)*Pt,r[5]=(n*Mt-d*_t+g*tt)*Pt,r[6]=(ce*Se-Z*$e-oe*ve)*Pt,r[7]=(N*$e-U*Se+W*ve)*Pt,r[8]=(_*xt-S*_t+R*We)*Pt,r[9]=(c*_t-n*xt-g*We)*Pt,r[10]=(Z*Re-ee*Se+oe*me)*Pt,r[11]=(F*Se-N*Re-W*me)*Pt,r[12]=(S*tt-_*nt-M*We)*Pt,r[13]=(n*nt-c*tt+d*We)*Pt,r[14]=(ee*ve-Z*De-ce*me)*Pt,r[15]=(N*De-F*ve+U*me)*Pt,r):null}function xe(r,e,n){var c=e[0],d=e[1],g=e[2],_=e[3],S=e[4],M=e[5],R=e[6],N=e[7],F=e[8],U=e[9],W=e[10],Z=e[11],ee=e[12],ce=e[13],oe=e[14],me=e[15],ve=n[0],Se=n[1],De=n[2],Re=n[3];return r[0]=ve*c+Se*S+De*F+Re*ee,r[1]=ve*d+Se*M+De*U+Re*ce,r[2]=ve*g+Se*R+De*W+Re*oe,r[3]=ve*_+Se*N+De*Z+Re*me,r[4]=(ve=n[4])*c+(Se=n[5])*S+(De=n[6])*F+(Re=n[7])*ee,r[5]=ve*d+Se*M+De*U+Re*ce,r[6]=ve*g+Se*R+De*W+Re*oe,r[7]=ve*_+Se*N+De*Z+Re*me,r[8]=(ve=n[8])*c+(Se=n[9])*S+(De=n[10])*F+(Re=n[11])*ee,r[9]=ve*d+Se*M+De*U+Re*ce,r[10]=ve*g+Se*R+De*W+Re*oe,r[11]=ve*_+Se*N+De*Z+Re*me,r[12]=(ve=n[12])*c+(Se=n[13])*S+(De=n[14])*F+(Re=n[15])*ee,r[13]=ve*d+Se*M+De*U+Re*ce,r[14]=ve*g+Se*R+De*W+Re*oe,r[15]=ve*_+Se*N+De*Z+Re*me,r}function be(r,e,n){var c,d,g,_,S,M,R,N,F,U,W,Z,ee=n[0],ce=n[1],oe=n[2];return e===r?(r[12]=e[0]*ee+e[4]*ce+e[8]*oe+e[12],r[13]=e[1]*ee+e[5]*ce+e[9]*oe+e[13],r[14]=e[2]*ee+e[6]*ce+e[10]*oe+e[14],r[15]=e[3]*ee+e[7]*ce+e[11]*oe+e[15]):(d=e[1],g=e[2],_=e[3],S=e[4],M=e[5],R=e[6],N=e[7],F=e[8],U=e[9],W=e[10],Z=e[11],r[0]=c=e[0],r[1]=d,r[2]=g,r[3]=_,r[4]=S,r[5]=M,r[6]=R,r[7]=N,r[8]=F,r[9]=U,r[10]=W,r[11]=Z,r[12]=c*ee+S*ce+F*oe+e[12],r[13]=d*ee+M*ce+U*oe+e[13],r[14]=g*ee+R*ce+W*oe+e[14],r[15]=_*ee+N*ce+Z*oe+e[15]),r}function Ne(r,e,n){var c=n[0],d=n[1],g=n[2];return r[0]=e[0]*c,r[1]=e[1]*c,r[2]=e[2]*c,r[3]=e[3]*c,r[4]=e[4]*d,r[5]=e[5]*d,r[6]=e[6]*d,r[7]=e[7]*d,r[8]=e[8]*g,r[9]=e[9]*g,r[10]=e[10]*g,r[11]=e[11]*g,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Be(r,e,n){var c=Math.sin(n),d=Math.cos(n),g=e[4],_=e[5],S=e[6],M=e[7],R=e[8],N=e[9],F=e[10],U=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=g*d+R*c,r[5]=_*d+N*c,r[6]=S*d+F*c,r[7]=M*d+U*c,r[8]=R*d-g*c,r[9]=N*d-_*c,r[10]=F*d-S*c,r[11]=U*d-M*c,r}function Ee(r,e,n){var c=Math.sin(n),d=Math.cos(n),g=e[0],_=e[1],S=e[2],M=e[3],R=e[8],N=e[9],F=e[10],U=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=g*d-R*c,r[1]=_*d-N*c,r[2]=S*d-F*c,r[3]=M*d-U*c,r[8]=g*c+R*d,r[9]=_*c+N*d,r[10]=S*c+F*d,r[11]=M*c+U*d,r}function et(r,e,n){var c=Math.sin(n),d=Math.cos(n),g=e[0],_=e[1],S=e[2],M=e[3],R=e[4],N=e[5],F=e[6],U=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=g*d+R*c,r[1]=_*d+N*c,r[2]=S*d+F*c,r[3]=M*d+U*c,r[4]=R*d-g*c,r[5]=N*d-_*c,r[6]=F*d-S*c,r[7]=U*d-M*c,r}function at(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function He(r,e,n){var c,d,g,_=n[0],S=n[1],M=n[2],R=Math.sqrt(_*_+S*S+M*M);return R<C?null:(_*=R=1/R,S*=R,M*=R,c=Math.sin(e),d=Math.cos(e),r[0]=_*_*(g=1-d)+d,r[1]=S*_*g+M*c,r[2]=M*_*g-S*c,r[3]=0,r[4]=_*S*g-M*c,r[5]=S*S*g+d,r[6]=M*S*g+_*c,r[7]=0,r[8]=_*M*g+S*c,r[9]=S*M*g-_*c,r[10]=M*M*g+d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function lt(r,e){var n=e[0],c=e[1],d=e[2],g=e[4],_=e[5],S=e[6],M=e[8],R=e[9],N=e[10];return r[0]=Math.sqrt(n*n+c*c+d*d),r[1]=Math.sqrt(g*g+_*_+S*S),r[2]=Math.sqrt(M*M+R*R+N*N),r}function pt(r,e){var n=e[0],c=e[1],d=e[2],g=e[3],_=n+n,S=c+c,M=d+d,R=n*_,N=c*_,F=c*S,U=d*_,W=d*S,Z=d*M,ee=g*_,ce=g*S,oe=g*M;return r[0]=1-F-Z,r[1]=N+oe,r[2]=U-ce,r[3]=0,r[4]=N-oe,r[5]=1-R-Z,r[6]=W+ee,r[7]=0,r[8]=U+ce,r[9]=W-ee,r[10]=1-R-F,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var Zt=xe;function jt(){var r=new P(3);return P!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Di(r){var e=new P(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Pi(r){var e=r[0],n=r[1],c=r[2];return Math.sqrt(e*e+n*n+c*c)}function qe(r,e,n){var c=new P(3);return c[0]=r,c[1]=e,c[2]=n,c}function wt(r,e,n,c){return r[0]=e,r[1]=n,r[2]=c,r}function Ct(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r}function Vi(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r}function Qe(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r}function St(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r}function Ht(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r}function Ft(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r}function _i(r,e,n,c){return r[0]=e[0]+n[0]*c,r[1]=e[1]+n[1]*c,r[2]=e[2]+n[2]*c,r}function At(r,e){var n=e[0]-r[0],c=e[1]-r[1],d=e[2]-r[2];return Math.sqrt(n*n+c*c+d*d)}function Xt(r,e){var n=e[0]-r[0],c=e[1]-r[1],d=e[2]-r[2];return n*n+c*c+d*d}function yn(r){var e=r[0],n=r[1],c=r[2];return e*e+n*n+c*c}function fn(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function pn(r,e){var n=e[0],c=e[1],d=e[2],g=n*n+c*c+d*d;return g>0&&(g=1/Math.sqrt(g)),r[0]=e[0]*g,r[1]=e[1]*g,r[2]=e[2]*g,r}function sn(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Un(r,e,n){var c=e[0],d=e[1],g=e[2],_=n[0],S=n[1],M=n[2];return r[0]=d*M-g*S,r[1]=g*_-c*M,r[2]=c*S-d*_,r}function Ui(r,e,n,c){var d=e[0],g=e[1],_=e[2];return r[0]=d+c*(n[0]-d),r[1]=g+c*(n[1]-g),r[2]=_+c*(n[2]-_),r}function Ii(r,e,n){var c=e[0],d=e[1],g=e[2],_=n[3]*c+n[7]*d+n[11]*g+n[15];return r[0]=(n[0]*c+n[4]*d+n[8]*g+n[12])/(_=_||1),r[1]=(n[1]*c+n[5]*d+n[9]*g+n[13])/_,r[2]=(n[2]*c+n[6]*d+n[10]*g+n[14])/_,r}function nn(r,e,n){var c=e[0],d=e[1],g=e[2];return r[0]=c*n[0]+d*n[3]+g*n[6],r[1]=c*n[1]+d*n[4]+g*n[7],r[2]=c*n[2]+d*n[5]+g*n[8],r}function mn(r,e,n){var c=n[0],d=n[1],g=n[2],_=n[3],S=e[0],M=e[1],R=e[2],N=d*R-g*M,F=g*S-c*R,U=c*M-d*S;return r[0]=S+_*(N+=N)+d*(U+=U)-g*(F+=F),r[1]=M+_*F+g*N-c*U,r[2]=R+_*U+c*F-d*N,r}function cn(r){return r[0]=0,r[1]=0,r[2]=0,r}function Tn(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var Da=Vi,Hc=Qe,Xo=Pi;function Hs(){var r=new P(4);return P!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function ws(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r}function Gs(r,e){var n=e[0],c=e[1],d=e[2],g=e[3],_=n*n+c*c+d*d+g*g;return _>0&&(_=1/Math.sqrt(_)),r[0]=n*_,r[1]=c*_,r[2]=d*_,r[3]=g*_,r}function Hr(r,e,n){var c=e[0],d=e[1],g=e[2],_=e[3];return r[0]=n[0]*c+n[4]*d+n[8]*g+n[12]*_,r[1]=n[1]*c+n[5]*d+n[9]*g+n[13]*_,r[2]=n[2]*c+n[6]*d+n[10]*g+n[14]*_,r[3]=n[3]*c+n[7]*d+n[11]*g+n[15]*_,r}function Yo(){var r=new P(4);return P!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Jr(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function er(r,e,n){n*=.5;var c=e[0],d=e[1],g=e[2],_=e[3],S=Math.sin(n),M=Math.cos(n);return r[0]=c*M+_*S,r[1]=d*M+g*S,r[2]=g*M-d*S,r[3]=_*M-c*S,r}function ds(r,e,n){n*=.5;var c=e[0],d=e[1],g=e[2],_=e[3],S=Math.sin(n),M=Math.cos(n);return r[0]=c*M-g*S,r[1]=d*M+_*S,r[2]=g*M+c*S,r[3]=_*M-d*S,r}jt(),Hs();var pr,dl,Ql,qs=Gs,Ko=(pr=jt(),dl=qe(1,0,0),Ql=qe(0,1,0),function(r,e,n){var c=sn(e,n);return c<-.999999?(Un(pr,dl,e),Xo(pr)<1e-6&&Un(pr,Ql,e),pn(pr,pr),(function(d,g,_){_*=.5;var S=Math.sin(_);d[0]=S*g[0],d[1]=S*g[1],d[2]=S*g[2],d[3]=Math.cos(_)})(r,pr,Math.PI),r):c>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Un(pr,e,n),r[0]=pr[0],r[1]=pr[1],r[2]=pr[2],r[3]=1+c,qs(r,r))});function vr(){var r=new P(2);return P!=Float32Array&&(r[0]=0,r[1]=0),r}function Ir(r,e){var n=new P(2);return n[0]=r,n[1]=e,n}function ec(r,e,n){return r[0]=e,r[1]=n,r}function Ss(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r}function po(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r}function Jo(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r}function Ws(r){var e=r[0],n=r[1];return Math.sqrt(e*e+n*n)}function tc(r,e){var n=e[0],c=e[1],d=n*n+c*c;return d>0&&(d=1/Math.sqrt(d)),r[0]=e[0]*d,r[1]=e[1]*d,r}function go(r,e){return r[0]*e[0]+r[1]*e[1]}Yo(),Yo(),$();var Za,Ur,ic=po;function Ro(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}vr();var _o=(function(){if(Ur)return Za;function r(e,n,c,d){this.cx=3*e,this.bx=3*(c-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=c,this.p2y=d}return Ur=1,Za=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,d=0;d<8;d++){var g=this.sampleCurveX(c)-e;if(Math.abs(g)<n)return c;var _=this.sampleCurveDerivativeX(c);if(Math.abs(_)<1e-6)break;c-=g/_}var S=0,M=1;for(c=e,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-e)<n));d++)e>g?S=c:M=c,c=.5*(M-S)+S;return c},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Za})(),ku=Ro(_o);function Me(r,e){this.x=r,this.y=e}function Rt(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!Rt(r[n],e[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const n in r)if(!Rt(r[n],e[n]))return!1;return!0}return r===e}Me.prototype={clone(){return new Me(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),n=Math.sin(r),c=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=c,this},_rotateAround(r,e){const n=Math.cos(r),c=Math.sin(r),d=e.y+c*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-c*(this.y-e.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Me},Me.convert=function(r){if(r instanceof Me)return r;if(Array.isArray(r))return new Me(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new Me(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const ii=Math.PI/180,Ai=180/Math.PI;function ui(r){return r*ii}function Wi(r){return r*Ai}const Ti=[[0,0],[1,0],[1,1],[0,1]];function vn(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,n=e*r;return 4*(r<.5?n:3*(r-e)+n-.75)}function Mn(r,e,n,c){const d=new ku(r,e,n,c);return function(g){return d.solve(g)}}const Xe=Mn(.25,.1,.25,1);function ne(r,e,n){return Math.min(n,Math.max(e,r))}function ue(r,e,n){return(n=ne((n-r)/(e-r),0,1))*n*(3-2*n)}function ke(r,e,n){const c=n-e,d=((r-e)%c+c)%c+e;return d===e?n:d}function Fe(r,e,n){if(!r.length)return n(null,[]);let c=r.length;const d=new Array(r.length);let g=null;r.forEach(((_,S)=>{e(_,((M,R)=>{M&&(g=M),d[S]=R,--c==0&&n(g,d)}))}))}let Ue=1;function Ze(){return Ue++}function st(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function Je(r,e){r.forEach((n=>{e[n]&&(e[n]=e[n].bind(e))}))}function ct(r,e,n){const c={};for(const d in r)c[d]=e.call(this,r[d],d,r);return c}function It(r,e,n){const c={};for(const d in r)e.call(this,r[d],d,r)&&(c[d]=r[d]);return c}function Tt(r){return Array.isArray(r)?r.map(Tt):typeof r=="object"&&r?ct(r,Tt):r}function ci(r,e){for(let n=0;n<r.length;n++)if(e.indexOf(r[n])>=0)return!0;return!1}const Fi={};function mi(r){Fi[r]||(typeof console<"u"&&console.warn(r),Fi[r]=!0)}function tn(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function rn(r){let e=0;for(let n,c,d=0,g=r.length,_=g-1;d<g;_=d++)n=r[d],c=r[_],e+=(c.x-n.x)*(n.y+c.y);return e}function Xi([r,e,n]){const c=ui(e+90),d=ui(n);return{x:r*Math.cos(c)*Math.sin(d),y:r*Math.sin(c)*Math.sin(d),z:r*Math.cos(d),azimuthal:e,polar:n}}function Hi(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function Gn(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,c,d,g)=>{const _=d||g;return e[c]=!_||_.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Oa=null;function Ea(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Jn(r,e,n,c){for(;e<n;){const d=e+n>>1;r[d]<c?e=d+1:n=d}return e}function gn(r,e,n,c){for(;e<n;){const d=e+n>>1;r[d]<=c?e=d+1:n=d}return e}function an(r){return r>0?1/(1.001-r):1+r}function ia(r){return r>0?1-1/(1.001-r):-r}function oa(r,e,n){return(r-e.min)*(n.max-n.min)/(e.max-e.min)+n.min}const An={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!An.API_URL)return null;try{const r=new URL(An.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Xa(r){return An.API_URL_REGEX.test(r)}function Dn(r){return An.API_SPRITE_REGEX.test(r)}let Aa,Zs,ss,tr,Lo,Qr;function os(){return Aa==null&&(Aa=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Aa}const Sa={now:()=>tr!==void 0?tr:performance.now(),setNow(r){tr=r},restoreNow(){tr=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:n,height:c}=r;Lo||(Lo=document.createElement("canvas"));const d=Lo.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(n>Lo.width||c>Lo.height)&&(Lo.width=n,Lo.height=c),d.clearRect(-e,-e,n+2*e,c+2*e),d.drawImage(r,0,0,n,c),d.getImageData(-e,-e,n+2*e,c+2*e)},resolveURL:r=>(Zs||(Zs=document.createElement("a")),Zs.href=r,Zs.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ss==null&&(ss=window.matchMedia("(prefers-reduced-motion: reduce)")),ss.matches)},hasCanvasFingerprintNoise(){if(Qr!==void 0)return Qr;if(!os())return Qr=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let n=0;for(let d=0;d<r.width;++d)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(d,0,1,1);const c=e.getImageData(0,0,r.width,r.height);n=0;for(let d=0;d<c.data.length;++d)if(d%4!=3&&n++!==c.data[d])return Qr=!0,!0;return Qr=!1,!1}};function Io(r,e){const n=r.indexOf("?");if(n<0)return`${r}?${new URLSearchParams(e).toString()}`;const c=new URLSearchParams(r.slice(n));for(const d in e)c.set(d,e[d]);return`${r.slice(0,n)}?${c.toString()}`}function yo(r,e={persistentParams:[]}){const n=r.indexOf("?");if(n<0)return r;const c=new URLSearchParams,d=new URLSearchParams(r.slice(n));for(const _ of e.persistentParams){const S=d.get(_);S&&c.set(_,S)}const g=c.toString();return`${r.slice(0,n)}${g.length>0?`?${g}`:""}`}const Gc="mapbox-tiles";let Eu=500,fc=50;const mc=["language","worldview","jobid"];let hl,Ps;function ao(){try{return caches}catch{}}function vo(){const r=ao();r&&hl==null&&(hl=r.open(Gc))}let Xs=1/0;const ro={supported:!1,testSupport:function(r){!la&&qc&&(Ys?Dl(r):xo=r)}};let xo,qc,la=!1,Ys=!1;const rr=typeof self<"u"?self:{};function Dl(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,qc),r.isContextLost())return;ro.supported=!0}catch{}r.deleteTexture(e),la=!0}rr.document&&(qc=rr.document.createElement("img"),qc.onload=function(){xo&&Dl(xo),xo=null,Ys=!0},qc.onerror=function(){la=!0,xo=null},qc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const pc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(pc);class hs extends Error{constructor(e,n,c){n===401&&Xa(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Qo=Hi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,bo=function(r,e){if(!(/^file:/.test(n=r.url)||/^file:/.test(Qo())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(c,d){const g=new AbortController,_=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Qo(),referrerPolicy:c.referrerPolicy,signal:g.signal});let S=!1,M=!1;const R=(N=_.url).indexOf("sku=")>0&&Xa(N);var N;c.type==="json"&&_.headers.set("Accept","application/json");const F=(W,Z,ee)=>{if(M)return;if(W&&W.message!=="SecurityError"&&mi(W.toString()),Z&&ee)return U(Z);const ce=Date.now();fetch(_).then((oe=>{if(oe.ok){const me=R?oe.clone():null;return U(oe,me,ce)}return d(new hs(oe.statusText,oe.status,c.url))})).catch((oe=>{oe.name!=="AbortError"&&d(new Error(`${oe.message} ${c.url}`))}))},U=(W,Z,ee)=>{(c.type==="arrayBuffer"?W.arrayBuffer():c.type==="json"?W.json():W.text()).then((ce=>{M||(Z&&ee&&(function(oe,me,ve){if(vo(),hl==null)return;const Se=Gn(me.headers.get("Cache-Control")||"");if(Se["no-store"])return;const De={status:me.status,statusText:me.statusText,headers:new Headers};me.headers.forEach(((We,tt)=>De.headers.set(tt,We))),Se["max-age"]&&De.headers.set("Expires",new Date(ve+1e3*Se["max-age"]).toUTCString());const Re=De.headers.get("Expires");if(!Re||new Date(Re).getTime()-ve<42e4)return;let $e=yo(oe.url,{persistentParams:mc});if(me.status===206){const We=oe.headers.get("Range");if(!We)return;De.status=200,$e=Io($e,{range:We})}(function(We,tt){if(Ps===void 0)try{new Response(new ReadableStream),Ps=!0}catch{Ps=!1}Ps?tt(We.body):We.blob().then(tt).catch((_t=>mi(_t.message)))})(me,(We=>{const tt=new Response((_t=me.status)!==200&&_t!==404&&[101,103,204,205,304].includes(_t)?null:We,De);var _t;vo(),hl?.then((nt=>nt.put($e,tt))).catch((nt=>mi(nt.message)))}))})(_,Z,ee),S=!0,d(null,ce,W.headers))})).catch((ce=>{M||d(new Error(ce.message))}))};return R?(function(W,Z){if(vo(),hl==null)return Z(null);hl.then((ee=>{let ce=yo(W.url,{persistentParams:mc});const oe=W.headers.get("Range");oe&&(ce=Io(ce,{range:oe})),ee.match(ce).then((me=>{const ve=(function(Se){if(!Se)return!1;const De=new Date(Se.headers.get("Expires")||0),Re=Gn(Se.headers.get("Cache-Control")||"");return Number(De)>Date.now()&&!Re["no-cache"]})(me);ee.delete(ce).catch(Z),ve&&ee.put(ce,me.clone()).catch(Z),Z(null,me,ve)})).catch(Z)})).catch(Z)})(_,F):F(null,null),{cancel:()=>{M=!0,S||g.abort()}}})(r,e);if(Hi(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var n;return(function(c,d){const g=new XMLHttpRequest;g.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const _ in c.headers)g.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=c.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let _=g.response;if(c.type==="json")try{_=JSON.parse(g.response)}catch(M){return d(M)}const S=new Headers;g.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((M=>{const R=M.split(": "),N=R.shift(),F=R.join(": ");S.append(N,F)})),d(null,_,S)}else d(new hs(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}})(r,e)},zo=function(r,e){return bo(Object.assign(r,{type:"arrayBuffer"}),e)};function Ku(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const ls="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Do,qn;Do=[],qn=0;const js=function(r,e){if(ro.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),qn>=An.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Do.push(g),g}qn++;let n=!1;const c=()=>{if(!n)for(n=!0,qn--;Do.length&&qn<An.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Do.shift(),{requestParameters:_,callback:S,cancelled:M}=g;M||(g.cancel=js(_,S).cancel)}},d=zo(r,((g,_,S)=>{c(),g?e(g):_&&(self.createImageBitmap?(function(M,R){const N=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(N).then((F=>{R(null,F)})).catch((F=>{R(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(_,((M,R)=>e(M,R,S))):(function(M,R){const N=new Image;N.onload=()=>{R(null,N),URL.revokeObjectURL(N.src),N.onload=null,requestAnimationFrame((()=>{N.src=ls}))},N.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Blob([new Uint8Array(M)],{type:"image/png"});N.src=M.byteLength?URL.createObjectURL(F):ls})(_,((M,R)=>e(M,R,S))))}));return{cancel:()=>{d.cancel(),c()}}};var gc,Ju,Wc,Zc={exports:{}},Xc={exports:{}},Pa={exports:{}},Au=(function(){if(Wc)return Zc.exports;Wc=1;var r=(gc||(gc=1,Xc.exports=function(n,c){var d,g,_,S,M,R,N,F;for(g=n.length-(d=3&n.length),_=c,M=3432918353,R=461845907,F=0;F<g;)N=255&n.charCodeAt(F)|(255&n.charCodeAt(++F))<<8|(255&n.charCodeAt(++F))<<16|(255&n.charCodeAt(++F))<<24,++F,_=27492+(65535&(S=5*(65535&(_=(_^=N=(65535&(N=(N=(65535&N)*M+(((N>>>16)*M&65535)<<16)&4294967295)<<15|N>>>17))*R+(((N>>>16)*R&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(N=0,d){case 3:N^=(255&n.charCodeAt(F+2))<<16;case 2:N^=(255&n.charCodeAt(F+1))<<8;case 1:_^=N=(65535&(N=(N=(65535&(N^=255&n.charCodeAt(F)))*M+(((N>>>16)*M&65535)<<16)&4294967295)<<15|N>>>17))*R+(((N>>>16)*R&65535)<<16)&4294967295}return _^=n.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Xc.exports),e=(Ju||(Ju=1,Pa.exports=function(n,c){for(var d,g=n.length,_=c^g,S=0;g>=4;)d=1540483477*(65535&(d=255&n.charCodeAt(S)|(255&n.charCodeAt(++S))<<8|(255&n.charCodeAt(++S))<<16|(255&n.charCodeAt(++S))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++S;switch(g){case 3:_^=(255&n.charCodeAt(S+2))<<16;case 2:_^=(255&n.charCodeAt(S+1))<<8;case 1:_=1540483477*(65535&(_^=255&n.charCodeAt(S)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Pa.exports);return Zc.exports=r,Zc.exports.murmur3=r,Zc.exports.murmur2=e,Zc.exports})(),Ks=Ro(Au);class wo{constructor(e,...n){Object.assign(this,n[0]||{}),this.type=e}}class Qu extends wo{constructor(e,n={}){super("error",Object.assign({error:e},n))}}function Tf(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function nc(r,e,n){if(n&&n[r]){const c=n[r].indexOf(e);c!==-1&&n[r].splice(c,1)}}class _c{on(e,n){return this._listeners=this._listeners||{},Tf(e,n,this._listeners),this}off(e,n){return nc(e,n,this._listeners),nc(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Tf(e,n,this._oneTimeListeners),this):new Promise((c=>{this.once(e,c)}))}fire(e,n){const c=typeof e=="string"?new wo(e,n):e,d=c.type;if(this.listens(d)){c.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const M of g)M.call(this,c);const _=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const M of _)nc(d,M,this._oneTimeListeners),M.call(this,c);const S=this._eventedParent;if(S){const M=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(c,M),S.fire(c)}}else c instanceof Qu&&console.error(c.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}class Rs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Rs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[n,c]=e.split("");return new Rs({name:n,iconsetId:c})}static isEqual(e,n){return e.name===n.name&&e.iconsetId===n.iconsetId}toString(){return Rs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ah,Ud={},Oo=(function(){if(Ah)return Ud;Ah=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(g){return(g=Math.round(g))<0?0:g>255?255:g}function n(g){return e(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function c(g){return(_=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:_>1?1:_;var _}function d(g,_,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?g+(_-g)*S*6:2*S<1?_:3*S<2?g+(_-g)*(2/3-S)*6:g}try{Ud.parseCSSColor=function(g){var _,S=g.replace(/ /g,"").toLowerCase();if(S in r)return r[S].slice();if(S[0]==="#")return S.length===4?(_=parseInt(S.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:S.length===7&&(_=parseInt(S.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var M=S.indexOf("("),R=S.indexOf(")");if(M!==-1&&R+1===S.length){var N=S.substr(0,M),F=S.substr(M+1,R-(M+1)).split(","),U=1;switch(N){case"rgba":if(F.length!==4)return null;U=c(F.pop());case"rgb":return F.length!==3?null:[n(F[0]),n(F[1]),n(F[2]),U];case"hsla":if(F.length!==4)return null;U=c(F.pop());case"hsl":if(F.length!==3)return null;var W=(parseFloat(F[0])%360+360)%360/360,Z=c(F[1]),ee=c(F[2]),ce=ee<=.5?ee*(Z+1):ee+Z-ee*Z,oe=2*ee-ce;return[e(255*d(oe,ce,W+1/3)),e(255*d(oe,ce,W)),e(255*d(oe,ce,W-1/3)),U];default:return null}}return null}}catch{}return Ud})();class ma{constructor(e,n,c,d=1){this.r=e,this.g=n,this.b=c,this.a=d}static parse(e){if(!e)return;if(e instanceof ma)return e;if(typeof e!="string")return;const n=Oo.parseCSSColor(e);return n?new ma(n[0]/255,n[1]/255,n[2]/255,n[3]):void 0}toString(){const[e,n,c,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*c)},${d})`}toNonPremultipliedRenderColor(e){const{r:n,g:c,b:d,a:g}=this;return new Pm(e,n,c,d,g)}toPremultipliedRenderColor(e){const{r:n,g:c,b:d,a:g}=this;return new kf(e,n*g,c*g,d*g,g)}clone(){return new ma(this.r,this.g,this.b,this.a)}}class fl{constructor(e,n,c,d,g,_=!1){if(this.premultiplied=!1,this.premultiplied=_,e){const S=e.image.height,M=S*S;this.premultiplied?(n=g===0?0:n/g*(S-1),c=g===0?0:c/g*(S-1),d=g===0?0:d/g*(S-1)):(n*=S-1,c*=S-1,d*=S-1);const R=Math.floor(n),N=Math.floor(c),F=Math.floor(d),U=Math.ceil(n),W=Math.ceil(c),Z=Math.ceil(d),ee=n-R,ce=c-N,oe=d-F,me=e.image.data,ve=4*(R+N*M+F*S),Se=4*(R+N*M+Z*S),De=4*(R+W*M+F*S),Re=4*(R+W*M+Z*S),$e=4*(U+N*M+F*S),We=4*(U+N*M+Z*S),tt=4*(U+W*M+F*S),_t=4*(U+W*M+Z*S);if(ve<0||_t>=me.length)throw new Error("out of range");this.r=Gi(Gi(Gi(me[ve],me[Se],oe),Gi(me[De],me[Re],oe),ce),Gi(Gi(me[$e],me[We],oe),Gi(me[tt],me[_t],oe),ce),ee)/255*(this.premultiplied?g:1),this.g=Gi(Gi(Gi(me[ve+1],me[Se+1],oe),Gi(me[De+1],me[Re+1],oe),ce),Gi(Gi(me[$e+1],me[We+1],oe),Gi(me[tt+1],me[_t+1],oe),ce),ee)/255*(this.premultiplied?g:1),this.b=Gi(Gi(Gi(me[ve+2],me[Se+2],oe),Gi(me[De+2],me[Re+2],oe),ce),Gi(Gi(me[$e+2],me[We+2],oe),Gi(me[tt+2],me[_t+2],oe),ce),ee)/255*(this.premultiplied?g:1),this.a=g}else this.r=n,this.g=c,this.b=d,this.a=g}toArray(){const{r:e,g:n,b:c,a:d}=this;return[255*e,255*n,255*c,d]}toHslaArray(){let{r:e,g:n,b:c,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const Z=1/d;e*=Z,n*=Z,c*=Z}const g=Math.min(Math.max(e,0),1),_=Math.min(Math.max(n,0),1),S=Math.min(Math.max(c,0),1),M=Math.min(g,_,S),R=Math.max(g,_,S),N=R-M,F=.5*(M+R);if(N===0)return[0,0,100*F,d];const U=F>.5?N/(2-R-M):N/(R+M);let W;switch(R){case g:W=60*((_-S)/N+(_<S?6:0));break;case _:W=60*((S-g)/N+2);break;default:W=60*((g-_)/N+4)}return[W,100*U,100*F,d]}toArray01(){const{r:e,g:n,b:c,a:d}=this;return[e,n,c,d]}toArray01Scaled(e){const{r:n,g:c,b:d}=this;return[n*e,c*e,d*e]}toArray01Linear(){const{r:e,g:n,b:c,a:d}=this;return[Math.pow(e,2.2),Math.pow(n,2.2),Math.pow(c,2.2),d]}}class Pm extends fl{constructor(e,n,c,d,g){super(e,n,c,d,g,!1)}}class kf extends fl{constructor(e,n,c,d,g){super(e,n,c,d,g,!0)}}function Gi(r,e,n){return r*(1-n)+e*n}function Ch(r,e,n){return r.map(((c,d)=>Gi(c,e[d],n)))}ma.black=new ma(0,0,0,1),ma.white=new ma(1,1,1,1),ma.transparent=new ma(0,0,0,0),ma.red=new ma(1,0,0,1),ma.blue=new ma(0,0,1,1);var Yc=Object.freeze({__proto__:null,array:Ch,color:function(r,e,n){return new ma(Gi(r.r,e.r,n),Gi(r.g,e.g,n),Gi(r.b,e.b,n),Gi(r.a,e.a,n))},number:Gi});class No extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class ed{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[c,d]of n)this.bindings[c]=d}concat(e){return new ed(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ml={kind:"null"},zi={kind:"number"},$n={kind:"string"},_a={kind:"boolean"},Js={kind:"color"},ac={kind:"object"},ra={kind:"value"},$d={kind:"collator"},Kc={kind:"formatted"},Ol={kind:"resolvedImage"};function Ls(r,e){return{kind:"array",itemType:r,N:e}}function lr(r){if(r.kind==="array"){const e=lr(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const so=[ml,zi,$n,_a,Js,Kc,ac,Ls(ra),Ol];function yc(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!yc(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const n of so)if(!yc(n,e))return null}}return`Expected ${lr(r)} but found ${lr(e)} instead.`}function Vd(r,e){return e.some((n=>n.kind===r.kind))}function td(r,e){return e.some((n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r))}function Cu(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&Cu(r.itemType,e.itemType):r.kind===e.kind}class id{constructor(e,n,c){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hd{constructor(e,n,c,d,g){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=c,this.fontStack=d,this.textColor=g}}class cs{constructor(e){this.sections=e}static fromString(e){return new cs([new Hd(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof cs?e:cs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){const d=n.image.getPrimary().id.toString();e.push(["image",d]);continue}e.push(n.text);const c={};n.fontStack&&(c["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(c["font-scale"]=n.scale),n.textColor&&(c["text-color"]=["rgba"].concat(n.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(c)}return e}}class rc{constructor(e,n={}){this.id=Rs.from(e),this.params=n.params,this.sx=n.sx||1,this.sy=n.sy||1}toString(){return JSON.stringify(this)}static parse(e){let n,c,d,g;try{({id:n,params:c,sx:d,sy:g}=JSON.parse(e)||{})}catch{return null}return n?new rc(n,{params:c,sx:d,sy:g}):null}scaleSelf(e,n=e){return this.sx*=e,this.sy*=n,this}}class oo{constructor(e,n,c,d,g=!1){this.primaryId=Rs.from(e),this.primaryOptions=n,c&&(this.secondaryId=Rs.from(c)),this.secondaryOptions=d,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new rc(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new rc(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?oo.build({name:e}):e}static build(e,n,c,d){return!e||typeof e=="object"&&!("name"in e)?null:new oo(e,c,n,d)}}function Qs(r,e,n,c){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[r,e,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[r,e,n,c]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function pl(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof ma||r instanceof id||r instanceof cs||r instanceof oo)return!0;if(Array.isArray(r)){for(const e of r)if(!pl(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!pl(r[e]))return!1;return!0}return!1}function Gr(r){if(r===null)return ml;if(typeof r=="string")return $n;if(typeof r=="boolean")return _a;if(typeof r=="number")return zi;if(r instanceof ma)return Js;if(r instanceof id)return $d;if(r instanceof cs)return Kc;if(r instanceof oo)return Ol;if(Array.isArray(r)){const e=r.length;let n;for(const c of r){const d=Gr(c);if(n){if(n===d)continue;n=ra;break}n=d}return Ls(n||ra,e)}return ac}function $r(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof cs||r instanceof oo||r instanceof ma?r.toString():JSON.stringify(r)}class el{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!pl(e[1]))return n.error("invalid value");const c=e[1];let d=Gr(c);const g=n.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new el(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ma?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof cs?this.value.serialize():this.value}}class Sr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const nd={string:$n,number:zi,boolean:_a,object:ac};class lo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let c,d=1;const g=e[0];if(g==="array"){let S,M;if(e.length>2){const R=e[1];if(typeof R!="string"||!(R in nd)||R==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);S=nd[R],d++}else S=ra;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);M=e[2],d++}c=Ls(S,M)}else c=nd[g];const _=[];for(;d<e.length;d++){const S=n.parse(e[d],d,ra);if(!S)return null;_.push(S)}return new lo(c,_)}evaluate(e){for(let n=0;n<this.args.length;n++){const c=this.args[n].evaluate(e);if(!yc(this.type,Gr(c)))return c;if(n===this.args.length-1)throw new Sr(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${lr(Gr(c))} but was expected to be of type ${lr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){n.push(c.kind);const d=e.N;(typeof d=="number"||this.args.length>1)&&n.push(d)}}return n.concat(this.args.map((c=>c.serialize())))}}class gl{constructor(e){this.type=Kc,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");const d=[];let g=!1;for(let _=1;_<=e.length-1;++_){const S=e[_];if(g&&typeof S=="object"&&!Array.isArray(S)){g=!1;let M=null;if(S["font-scale"]&&(M=n.parseObjectValue(S["font-scale"],_,"font-scale",zi),!M))return null;let R=null;if(S["text-font"]&&(R=n.parseObjectValue(S["text-font"],_,"text-font",Ls($n)),!R))return null;let N=null;if(S["text-color"]&&(N=n.parseObjectValue(S["text-color"],_,"text-color",Js),!N))return null;const F=d[d.length-1];F.scale=M,F.font=R,F.textColor=N}else{const M=n.parse(e[_],_,ra);if(!M)return null;const R=M.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:M,scale:null,font:null,textColor:null})}}return new gl(d)}evaluate(e){return new cs(this.sections.map((n=>{const c=n.content.evaluate(e);return Cu(Gr(c),Ol)?new Hd("",c,null,null,null):new Hd($r(c),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const c={};n.scale&&(c["font-scale"]=n.scale.serialize()),n.font&&(c["text-font"]=n.font.serialize()),n.textColor&&(c["text-color"]=n.textColor.serialize()),e.push(c)}return e}}class on{constructor(e,n,c,d){this._imageWarnHistory={},this.type=Ol,this.namePrimary=e,this.nameSecondary=n,c&&(this.paramsPrimary=c.params,this.iconsetIdPrimary=c.iconset?c.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let c=1;const d=[];function g(){if(c<e.length){const S=n.parse(e[c],c++,$n);return S?(d.push({image:S,options:{}}),!0):(n.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(c<e.length){const M=e[c];if((S=M)===null||typeof S!="object"||Array.isArray(S))return!0;const R=M.params,N=M.iconset,F=n.concat(c);if(!R&&!N)return c++,!0;if(R){if(typeof R!="object"||R.constructor!==Object)return F.error('Image options "params" should be an object'),!1;const U={},W=F.concat(void 0,"params");for(const Z in R){if(!Z)return W.error("Image parameter name should be non-empty"),!1;const ee=W.concat(void 0,Z).parse(R[Z],void 0,Js,void 0,{typeAnnotation:"coerce"});if(!ee)return!1;U[Z]=ee}d[d.length-1].options.params=U}if(N){if(typeof N!="object"||N.constructor!==Object)return F.error('Image options "iconset" should be an object'),!1;if(!N.id)return F.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=N}return c++,!0}var S;return!0}for(let S=0;S<2;S++)if(!g()||!_())return;return new on(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(e,n){const c={};if(n){for(const d in n)if(n[d])try{c[d]=n[d].evaluate(e)}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(e){const n={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},c=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,d=oo.build(n,c,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(d&&e.availableImages){const g=d.getPrimary().id;if(d.available=e.availableImages.some((_=>Rs.isEqual(_,g))),d.available){const _=d.getSecondary()?d.getSecondary().id:null;_&&(d.available=e.availableImages.some((S=>Rs.isEqual(S,_))))}}return d}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const n in this.paramsPrimary)this.paramsPrimary[n]&&e(this.paramsPrimary[n]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const n in this.paramsSecondary)this.paramsSecondary[n]&&e(this.paramsSecondary[n])}outputDefined(){return!1}serializeOptions(e,n){const c={};if(n&&(c.iconset={id:n}),e){c.params={};for(const d in e)e[d]&&(c.params[d]=e[d].serialize())}return Object.keys(c).length>0?c:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const n=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);n&&e.push(n)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const n=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);n&&e.push(n)}return e}}function ji(r){return Ji(r)?"string":Mu(r)?"number":ad(r)?"boolean":Array.isArray(r)?"array":r===null?"null":_l(r)?"object":typeof r}function _l(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function Ji(r){return typeof r=="string"||r instanceof String}function Mu(r){return typeof r=="number"||r instanceof Number}function ad(r){return typeof r=="boolean"||r instanceof Boolean}const en={"to-boolean":_a,"to-color":Js,"to-number":zi,"to-string":$n};class Is{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[0],d=[];let g=ml;if(c==="to-array"){if(!Array.isArray(e[1]))return null;const _=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);g=Ls(n.expectedType.itemType,_)}else{if(!(_>0&&pl(e[1][0])))return null;g=Ls(Gr(e[1][0]),_)}for(let S=0;S<_;S++){const M=e[1][S];let R;if(Array.isArray(M))R=n.parse(M,void 0,g.itemType);else{const N=ji(M);if(N!==g.itemType.kind)return n.error(`Expected ${g.itemType.kind} but found ${N}.`);R=n.registry.literal.parse(["literal",M===void 0?null:M],n)}if(!R)return null;d.push(R)}}else{if((c==="to-boolean"||c==="to-string")&&e.length!==2)return n.error("Expected one argument.");g=en[c];for(let _=1;_<e.length;_++){const S=n.parse(e[_],_,ra);if(!S)return null;d.push(S)}}return new Is(g,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,c;for(const d of this.args){if(n=d.evaluate(e),c=null,n instanceof ma)return n;if(typeof n=="string"){const g=e.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Qs(n[0],n[1],n[2],n[3]),!c))return new ma(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Sr(c||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const c of this.args){if(n=c.evaluate(e),n===null)return 0;const d=Number(n);if(!isNaN(d))return d}throw new Sr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?cs.fromString($r(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?oo.build($r(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((n=>n.evaluate(e))):$r(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new gl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new on(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((n=>{e.push(n.serialize())})),e}}const Ef=["Unknown","Point","LineString","Polygon"];class vc{constructor(e,n,c){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n,this.iconImageUseTheme=c}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ef[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:c,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*n-e[0])+this.featureDistanceData.bearing[1]*(d*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=ma.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Tr{constructor(e,n,c,d,g){this.name=e,this.type=n,this._evaluate=c,this.args=d,this._overloadIndex=g}evaluate(e){if(!this._evaluate){const n=Tr.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,n){const c=e[0],d=Tr.definitions[c];if(!d)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,S=[];let M=null,R=-1;for(const[N,F]of _){if(Array.isArray(N)&&N.length!==e.length-1)continue;S.push(N),R++,M=new Sc(n.registry,n.path,null,n.scope,void 0,n._scope,n.options,n.iconImageUseTheme);const U=[];let W=!1;for(let Z=1;Z<e.length;Z++){const ee=e[Z],ce=Array.isArray(N)?N[Z-1]:N.type,oe=M.parse(ee,1+U.length,ce);if(!oe){W=!0;break}U.push(oe)}if(!W)if(Array.isArray(N)&&N.length!==U.length)M.error(`Expected ${N.length} arguments, but found ${U.length} instead.`);else{for(let Z=0;Z<U.length;Z++){const ee=Array.isArray(N)?N[Z]:N.type,ce=U[Z];M.concat(Z+1).checkSubtype(ee,ce.type)}if(M.errors.length===0)return new Tr(c,g,F,U,R)}}if(S.length===1)n.errors.push(...M.errors);else{const N=(S.length?S:_.map((([U])=>U))).map(co).join(" | "),F=[];for(let U=1;U<e.length;U++){const W=n.parse(e[U],1+F.length);if(!W)return null;F.push(lr(W.type))}n.error(`Expected arguments of type ${N}, but found (${F.join(", ")}) instead.`)}return null}static register(e,n){Tr.definitions=n;for(const c in n)e[c]=Tr}}function co(r){return Array.isArray(r)?`(${r.map(lr).join(", ")})`:`(${lr(r.type)}...)`}class zr{constructor(e,n,c){this.type=$d,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");const d=c["case-sensitive"]===void 0?n.parse(!1,1,_a):n.parseObjectValue(c["case-sensitive"],1,"case-sensitive",_a);if(!d)return null;const g=c["diacritic-sensitive"]===void 0?n.parse(!1,1,_a):n.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",_a);if(!g)return null;let _=null;return c.locale&&(_=n.parseObjectValue(c.locale,1,"locale",$n),!_)?null:new zr(d,g,_)}evaluate(e){return new id(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function rd(r,e,n=0,c=r.length-1,d=Pu){for(;c>n;){if(c-n>600){const M=c-n+1,R=e-n+1,N=Math.log(M),F=.5*Math.exp(2*N/3),U=.5*Math.sqrt(N*F*(M-F)/M)*(R-M/2<0?-1:1);rd(r,e,Math.max(n,Math.floor(e-R*F/M+U)),Math.min(c,Math.floor(e+(M-R)*F/M+U)),d)}const g=r[e];let _=n,S=c;for(Fo(r,n,e),d(r[c],g)>0&&Fo(r,n,c);_<S;){for(Fo(r,_,S),_++,S--;d(r[_],g)<0;)_++;for(;d(r[S],g)>0;)S--}d(r[n],g)===0?Fo(r,n,S):(S++,Fo(r,S,c)),S<=e&&(n=S+1),e<=S&&(c=S-1)}}function Fo(r,e,n){const c=r[e];r[e]=r[n],r[n]=c}function Pu(r,e){return r<e?-1:r>e?1:0}function yl(r){let e=0;for(let n,c,d=0,g=r.length,_=g-1;d<g;_=d++)n=r[d],c=r[_],e+=(c.x-n.x)*(n.y+c.y);return e}function So(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function To(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function sd(r,e,n){const c=r[0]-e[0],d=r[1]-e[1],g=r[0]-n[0],_=r[1]-n[1];return c*_-g*d==0&&c*g<=0&&d*_<=0}function vl(r,e,n=!1){let c=!1;for(let S=0,M=e.length;S<M;S++){const R=e[S];for(let N=0,F=R.length,U=F-1;N<F;U=N++){const W=R[U],Z=R[N];if(sd(r,W,Z))return n;(g=W)[1]>(d=r)[1]!=(_=Z)[1]>d[1]&&d[0]<(_[0]-g[0])*(d[1]-g[1])/(_[1]-g[1])+g[0]&&(c=!c)}}var d,g,_;return c}function Jc(r,e,n,c){const d=c[0]-n[0],g=c[1]-n[1],_=(r[0]-n[0])*g-d*(r[1]-n[1]),S=(e[0]-n[0])*g-d*(e[1]-n[1]);return _>0&&S<0||_<0&&S>0}function od(r,e,n,c){return(d=[c[0]-n[0],c[1]-n[1]])[0]*(g=[e[0]-r[0],e[1]-r[1]])[1]-d[1]*g[0]!=0&&!(!Jc(r,e,n,c)||!Jc(n,c,r,e));var d,g}function zs(r){const e=new Me(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new Me(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of r[0])e.x>c.x&&(e.x=c.x),e.y>c.y&&(e.y=c.y),n.x<c.x&&(n.x=c.x),n.y<c.y&&(n.y=c.y);return{min:e,max:n}}const tl=8192;function Mh(r,e){const n=(180+r[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(n*d*tl),Math.round(c*d*tl)]}function Ph(r,e){for(let n=0;n<e.length;n++)if(vl(r,e[n]))return!0;return!1}function Qc(r,e,n){for(const c of n)for(let d=0,g=c.length,_=g-1;d<g;_=d++)if(od(r,e,c[_],c[d]))return!0;return!1}function Af(r,e){for(let n=0;n<r.length;++n)if(!vl(r[n],e))return!1;for(let n=0;n<r.length-1;++n)if(Qc(r[n],r[n+1],e))return!1;return!0}function xl(r,e){for(let n=0;n<e.length;n++)if(Af(r,e[n]))return!0;return!1}function ju(r,e,n){const c=[];for(let d=0;d<r.length;d++){const g=[];for(let _=0;_<r[d].length;_++){const S=Mh(r[d][_],n);So(e,S),g.push(S)}c.push(g)}return c}function eu(r,e,n){const c=[];for(let d=0;d<r.length;d++){const g=ju(r[d],e,n);c.push(g)}return c}function Gd(r,e,n,c){if(r[0]<n[0]||r[0]>n[2]){const d=.5*c;let g=r[0]-n[0]>d?-c:n[0]-r[0]>d?c:0;g===0&&(g=r[0]-n[2]>d?-c:n[2]-r[0]>d?c:0),r[0]+=g}So(e,r)}function jm(r,e,n,c){const d=Math.pow(2,c.z)*tl,g=[c.x*tl,c.y*tl],_=[];if(!r)return _;for(const S of r)for(const M of S){const R=[M.x+g[0],M.y+g[1]];Gd(R,e,n,d),_.push(R)}return _}function ld(r,e,n,c){const d=Math.pow(2,c.z)*tl,g=[c.x*tl,c.y*tl],_=[];if(!r)return _;for(const M of r){const R=[];for(const N of M){const F=[N.x+g[0],N.y+g[1]];So(e,F),R.push(F)}_.push(R)}if(e[2]-e[0]<=d/2){(S=e)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const M of _)for(const R of M)Gd(R,e,n,d)}var S;return _}class xc{constructor(e,n){this.type=_a,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(pl(e[1])){const c=e[1];if(c.type==="FeatureCollection")for(let d=0;d<c.features.length;++d){const g=c.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new xc(c,c.features[d].geometry)}else if(c.type==="Feature"){const d=c.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new xc(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new xc(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,c){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const S=ju(c.coordinates,g,_),M=jm(n.geometry(),d,g,_);if(!To(d,g))return!1;for(const R of M)if(!vl(R,S))return!1}if(c.type==="MultiPolygon"){const S=eu(c.coordinates,g,_),M=jm(n.geometry(),d,g,_);if(!To(d,g))return!1;for(const R of M)if(!Ph(R,S))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,c){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const S=ju(c.coordinates,g,_),M=ld(n.geometry(),d,g,_);if(!To(d,g))return!1;for(const R of M)if(!Af(R,S))return!1}if(c.type==="MultiPolygon"){const S=eu(c.coordinates,g,_),M=ld(n.geometry(),d,g,_);if(!To(d,g))return!1;for(const R of M)if(!xl(R,S))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Nl={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},es=1/298.257223563,tu=es*(2-es),Ds=Math.PI/180;class Os{static fromTile(e,n,c){const d=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),g=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Ds;return new Os(g,c)}static get units(){return Nl}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Nl[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Nl).join(", ")}`);const c=6378.137*Ds*(n?Nl[n]:1),d=Math.cos(e*Ds),g=1/(1-tu*(1-d*d)),_=Math.sqrt(g);this.kx=c*_*d,this.ky=c*_*g*(1-tu)}distance(e,n){const c=eo(e[0]-n[0])*this.kx,d=(e[1]-n[1])*this.ky;return Math.sqrt(c*c+d*d)}bearing(e,n){const c=eo(n[0]-e[0])*this.kx;return Math.atan2(c,(n[1]-e[1])*this.ky)/Ds}destination(e,n,c){const d=c*Ds;return this.offset(e,Math.sin(d)*n,Math.cos(d)*n)}offset(e,n,c){return[e[0]+n/this.kx,e[1]+c/this.ky]}lineDistance(e){let n=0;for(let c=0;c<e.length-1;c++)n+=this.distance(e[c],e[c+1]);return n}area(e){let n=0;for(let c=0;c<e.length;c++){const d=e[c];for(let g=0,_=d.length,S=_-1;g<_;S=g++)n+=eo(d[g][0]-d[S][0])*(d[g][1]+d[S][1])*(c?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let c=0;if(n<=0)return e[0];for(let d=0;d<e.length-1;d++){const g=e[d],_=e[d+1],S=this.distance(g,_);if(c+=S,c>n)return Bo(g,_,(n-(c-S))/S)}return e[e.length-1]}pointToSegmentDistance(e,n,c){let[d,g]=n,_=eo(c[0]-d)*this.kx,S=(c[1]-g)*this.ky;if(_!==0||S!==0){const M=(eo(e[0]-d)*this.kx*_+(e[1]-g)*this.ky*S)/(_*_+S*S);M>1?(d=c[0],g=c[1]):M>0&&(d+=_/this.kx*M,g+=S/this.ky*M)}return _=eo(e[0]-d)*this.kx,S=(e[1]-g)*this.ky,Math.sqrt(_*_+S*S)}pointOnLine(e,n){let c=1/0,d=e[0][0],g=e[0][1],_=0,S=0;for(let M=0;M<e.length-1;M++){let R=e[M][0],N=e[M][1],F=eo(e[M+1][0]-R)*this.kx,U=(e[M+1][1]-N)*this.ky,W=0;F===0&&U===0||(W=(eo(n[0]-R)*this.kx*F+(n[1]-N)*this.ky*U)/(F*F+U*U),W>1?(R=e[M+1][0],N=e[M+1][1]):W>0&&(R+=F/this.kx*W,N+=U/this.ky*W)),F=eo(n[0]-R)*this.kx,U=(n[1]-N)*this.ky;const Z=F*F+U*U;Z<c&&(c=Z,d=R,g=N,_=M,S=W)}return{point:[d,g],index:_,t:Math.max(0,Math.min(1,S))}}lineSlice(e,n,c){let d=this.pointOnLine(c,e),g=this.pointOnLine(c,n);if(d.index>g.index||d.index===g.index&&d.t>g.t){const R=d;d=g,g=R}const _=[d.point],S=d.index+1,M=g.index;!iu(c[S],_[0])&&S<=M&&_.push(c[S]);for(let R=S+1;R<=M;R++)_.push(c[R]);return iu(c[M],g.point)||_.push(g.point),_}lineSliceAlong(e,n,c){let d=0;const g=[];for(let _=0;_<c.length-1;_++){const S=c[_],M=c[_+1],R=this.distance(S,M);if(d+=R,d>e&&g.length===0&&g.push(Bo(S,M,(e-(d-R))/R)),d>=n)return g.push(Bo(S,M,(n-(d-R))/R)),g;d>e&&g.push(M)}return g}bufferPoint(e,n){const c=n/this.ky,d=n/this.kx;return[e[0]-d,e[1]-c,e[0]+d,e[1]+c]}bufferBBox(e,n){const c=n/this.ky,d=n/this.kx;return[e[0]-d,e[1]-c,e[2]+d,e[3]+c]}insideBBox(e,n){return eo(e[0]-n[0])>=0&&eo(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function iu(r,e){return r[0]===e[0]&&r[1]===e[1]}function Bo(r,e,n){const c=eo(e[0]-r[0]);return[r[0]+c*n,r[1]+(e[1]-r[1])*n]}function eo(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class nu{constructor(e=[],n=((c,d)=>c<d?-1:c>d?1:0)){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:c}=this,d=n[e];for(;e>0;){const g=e-1>>1,_=n[g];if(c(d,_)>=0)break;n[e]=_,e=g}n[e]=d}_down(e){const{data:n,compare:c}=this,d=this.length>>1,g=n[e];for(;e<d;){let _=1+(e<<1);const S=_+1;if(S<this.length&&c(n[S],n[_])<0&&(_=S),c(n[_],g)>=0)break;n[e]=n[_],e=_}n[e]=g}}var Jt=8192;function au(r,e){return e.dist-r.dist}const ru=100,Fl=50;function bc(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==r[n])return!1;return!0}function cd(r){return r[1]-r[0]+1}function ts(r,e){const n=r[1]>=r[0]&&r[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function ud(r,e){if(r[0]>r[1])return[null,null];const n=cd(r);if(e){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}{if(n===1)return[r,null];const c=Math.floor(n/2)-1;return[[r[0],r[0]+c],[r[0]+c+1,r[1]]]}}function uo(r,e){const n=[1/0,1/0,-1/0,-1/0];if(!ts(e,r.length))return n;for(let c=e[0];c<=e[1];++c)So(n,r[c]);return n}function wc(r){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<r.length;++n)for(let c=0;c<r[n].length;++c)So(e,r[n][c]);return e}function bl(r,e,n){if(bc(r)||bc(e))return NaN;let c=0,d=0;return r[2]<e[0]&&(c=e[0]-r[2]),r[0]>e[2]&&(c=r[0]-e[2]),r[1]>e[3]&&(d=r[1]-e[3]),r[3]<e[1]&&(d=e[1]-r[3]),n.distance([0,0],[c,d])}function Bl(r){return 360*r-180}function jh(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Ru(r,e){const n=Math.pow(2,e.z),c=(r.y/Jt+e.y)/n;return[Bl((r.x/Jt+e.x)/n),jh(c)]}function Lu(r,e){const n=[];for(let c=0;c<r.length;++c)n.push(Ru(r[c],e));return n}function Iu(r,e,n){const c=n.pointOnLine(e,r).point;return n.distance(r,c)}function b(r,e,n,c,d){const g=n.slice(c[0],c[1]+1);let _=1/0;for(let S=e[0];S<=e[1];++S)if((_=Math.min(_,Iu(r[S],g,d)))===0)return 0;return _}function I(r,e,n,c,d){const g=Math.min(d.pointToSegmentDistance(r,n,c),d.pointToSegmentDistance(e,n,c)),_=Math.min(d.pointToSegmentDistance(n,r,e),d.pointToSegmentDistance(c,r,e));return Math.min(g,_)}function V(r,e,n,c,d){if(!ts(e,r.length)||!ts(c,n.length))return NaN;let g=1/0;for(let _=e[0];_<e[1];++_)for(let S=c[0];S<c[1];++S){if(od(r[_],r[_+1],n[S],n[S+1]))return 0;g=Math.min(g,I(r[_],r[_+1],n[S],n[S+1],d))}return g}function ie(r,e,n,c,d){if(!ts(e,r.length)||!ts(c,n.length))return NaN;let g=1/0;for(let _=e[0];_<=e[1];++_)for(let S=c[0];S<=c[1];++S)if((g=Math.min(g,d.distance(r[_],n[S])))===0)return g;return g}function ge(r,e,n){if(vl(r,e,!0))return 0;let c=1/0;for(const d of e){const g=d.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[g-1]&&(c=Math.min(c,n.pointToSegmentDistance(r,d[g-1],d[0])))===0||(c=Math.min(c,Iu(r,d,n)))===0)return c}return c}function ze(r,e,n,c){if(!ts(e,r.length))return NaN;for(let g=e[0];g<=e[1];++g)if(vl(r[g],n,!0))return 0;let d=1/0;for(let g=e[0];g<e[1];++g)for(const _ of n)for(let S=0,M=_.length,R=M-1;S<M;R=S++){if(od(r[g],r[g+1],_[R],_[S]))return 0;d=Math.min(d,I(r[g],r[g+1],_[R],_[S],c))}return d}function dt(r,e){for(const n of r)for(let c=0;c<=n.length-1;++c)if(vl(n[c],e,!0))return!0;return!1}function Bt(r,e,n,c=1/0){const d=wc(r),g=wc(e);if(c!==1/0&&bl(d,g,n)>=c)return c;if(To(d,g)){if(dt(r,e))return 0}else if(dt(e,r))return 0;let _=c;for(const S of r)for(let M=0,R=S.length,N=R-1;M<R;N=M++)for(const F of e)for(let U=0,W=F.length,Z=W-1;U<W;Z=U++){if(od(S[N],S[M],F[Z],F[U]))return 0;_=Math.min(_,I(S[N],S[M],F[Z],F[U],n))}return _}function Lt(r,e,n,c,d,g,_){if(g===null||_===null)return;const S=bl(uo(c,g),uo(d,_),n);S<e&&r.push({dist:S,range1:g,range2:_})}function Ri(r,e,n,c,d=1/0){let g=Math.min(c.distance(r[0],n[0][0]),d);if(g===0)return g;const _=new nu([{dist:0,range1:[0,r.length-1],range2:[0,0]}],au),S=e?Fl:ru,M=wc(n);for(;_.length;){const R=_.pop();if(R.dist>=g)continue;const N=R.range1;if(cd(N)<=S){if(!ts(N,r.length))return NaN;if(e){const F=ze(r,N,n,c);if((g=Math.min(g,F))===0)return g}else for(let F=N[0];F<=N[1];++F){const U=ge(r[F],n,c);if((g=Math.min(g,U))===0)return g}}else{const F=ud(N,e);if(F[0]!==null){const U=bl(uo(r,F[0]),M,c);U<g&&_.push({dist:U,range1:F[0],range2:[0,0]})}if(F[1]!==null){const U=bl(uo(r,F[1]),M,c);U<g&&_.push({dist:U,range1:F[1],range2:[0,0]})}}}return g}function un(r,e,n,c,d,g=1/0){let _=Math.min(g,d.distance(r[0],n[0]));if(_===0)return _;const S=new nu([{dist:0,range1:[0,r.length-1],range2:[0,n.length-1]}],au),M=e?Fl:ru,R=c?Fl:ru;for(;S.length;){const N=S.pop();if(N.dist>=_)continue;const F=N.range1,U=N.range2;if(cd(F)<=M&&cd(U)<=R){if(!ts(F,r.length)||!ts(U,n.length))return NaN;if(e&&c?_=Math.min(_,V(r,F,n,U,d)):e||c?e&&!c?_=Math.min(_,b(n,U,r,F,d)):!e&&c&&(_=Math.min(_,b(r,F,n,U,d))):_=Math.min(_,ie(r,F,n,U,d)),_===0)return _}else{const W=ud(F,e),Z=ud(U,c);Lt(S,_,d,r,n,W[0],Z[0]),Lt(S,_,d,r,n,W[0],Z[1]),Lt(S,_,d,r,n,W[1],Z[0]),Lt(S,_,d,r,n,W[1],Z[1])}}return _}function Sn(r,e,n,c,d=1/0){let g=d;const _=uo(r,[0,r.length-1]);for(const S of n)if(!(g!==1/0&&bl(_,uo(S,[0,S.length-1]),c)>=g)&&(g=Math.min(g,un(r,e,S,!0,c,g)),g===0))return g;return g}function Pn(r,e,n,c,d=1/0){let g=d;const _=uo(r,[0,r.length-1]);for(const S of n){if(g!==1/0&&bl(_,wc(S),c)>=g)continue;const M=Ri(r,e,S,c,g);if(isNaN(M))return M;if((g=Math.min(g,M))===0)return g}return g}function ca(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class gr{constructor(e,n){this.type=zi,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(pl(e[1])){const c=e[1];if(c.type==="FeatureCollection"){for(let d=0;d<c.features.length;++d)if(ca(c.features[d].geometry.type))return new gr(c,c.features[d].geometry)}else if(c.type==="Feature"){if(ca(c.geometry.type))return new gr(c,c.geometry)}else if(ca(c.type))return new gr(c,c)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),c=e.canonicalID();if(n!=null&&c!=null){if(e.geometryType()==="Point")return(function(d,g,_){const S=[];for(const R of d)for(const N of R)S.push(Ru(N,g));const M=new Os(S[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?un(S,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",M):_.type==="MultiLineString"?Sn(S,!1,_.coordinates,M):_.type==="Polygon"||_.type==="MultiPolygon"?Pn(S,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,M):null})(n,c,this.geometries);if(e.geometryType()==="LineString")return(function(d,g,_){const S=[];for(const R of d){const N=[];for(const F of R)N.push(Ru(F,g));S.push(N)}const M=new Os(S[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Sn(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,M);if(_.type==="MultiLineString"){let R=1/0;for(let N=0;N<_.coordinates.length;N++){const F=Sn(_.coordinates[N],!0,S,M,R);if(isNaN(F))return F;if((R=Math.min(R,F))===0)return R}return R}if(_.type==="Polygon"||_.type==="MultiPolygon"){let R=1/0;for(let N=0;N<S.length;N++){const F=Pn(S[N],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,M,R);if(isNaN(F))return F;if((R=Math.min(R,F))===0)return R}return R}return null})(n,c,this.geometries);if(e.geometryType()==="Polygon")return(function(d,g,_){const S=[];for(const R of(function(N,F){const U=N.length;if(U<=1)return[N];const W=[];let Z,ee;for(let ce=0;ce<U;ce++){const oe=yl(N[ce]);oe!==0&&(N[ce].area=Math.abs(oe),ee===void 0&&(ee=oe<0),ee===oe<0?(Z&&W.push(Z),Z=[N[ce]]):Z.push(N[ce]))}return Z&&W.push(Z),W})(d)){const N=[];for(let F=0;F<R.length;++F)N.push(Lu(R[F],g));S.push(N)}const M=new Os(S[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Pn(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,M);if(_.type==="MultiLineString"){let R=1/0;for(let N=0;N<_.coordinates.length;N++){const F=Pn(_.coordinates[N],!0,S,M,R);if(isNaN(F))return F;if((R=Math.min(R,F))===0)return R}return R}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(R,N,F){let U=1/0;for(const W of R)for(const Z of N){const ee=Bt(W,Z,F,U);if(isNaN(ee))return ee;if((U=Math.min(U,ee))===0)return U}return U})(_.type==="Polygon"?[_.coordinates]:_.coordinates,S,M):null})(n,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Cr(r){if(r instanceof Tr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof xc||r instanceof gr)return!1;if(r instanceof Ul)return r.featureConstant;let e=!0;return r.eachChild((n=>{e&&!Cr(n)&&(e=!1)})),e}function fs(r){if(r instanceof Tr&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((n=>{e&&!fs(n)&&(e=!1)})),e}function to(r,e){if(r instanceof Tr&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild((c=>{n&&!to(c,e)&&(n=!1)})),n}function Cf(r,e,n){return[r,e,n].filter(Boolean).join("")}function Rh(r,e){switch(r){case"string":return $r(e);case"number":return+e;case"boolean":return!!e;case"color":return ma.parse(e);case"formatted":return cs.fromString($r(e));case"resolvedImage":return oo.build($r(e))}return e}function dd(r,e,n,c){return c!==void 0&&(r=c*Math.round(r/c)),e!==void 0&&r<e&&(r=e),n!==void 0&&r>n&&(r=n),r}class Ul{constructor(e,n,c,d=!1){this.type=e,this.key=n,this.scope=c,this.featureConstant=d}static parse(e,n){let c=n.expectedType;if(c==null&&(c=ra),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const d=n.parse(e[1],1);if(!(d instanceof el))return n.error("Key name of 'config' expression must be a string literal.");let g,_=!0;const S=$r(d.value);if(e.length>=3){const M=n.parse(e[2],2);if(!(M instanceof el))return n.error("Scope of 'config' expression must be a string literal.");g=$r(M.value)}if(n.options){const M=Cf(S,g,n._scope),R=n.options.get(M);R&&(_=Cr(R.value||R.default))}return new Ul(c,S,g,_)}evaluate(e){const n=Cf(this.key,this.scope,e.scope),c=e.getConfig(n);if(!c)return null;const{type:d,value:g,values:_,minValue:S,maxValue:M,stepValue:R}=c,N=c.default.evaluate(e);let F=N;if(g){const U=e.scope;e.scope=(U||"").split("").slice(1).join(""),F=g.evaluate(e),e.scope=U}return d&&(F=Rh(d,F)),F===void 0||S===void 0&&M===void 0&&R===void 0||(typeof F=="number"?F=dd(F,S,M,R):Array.isArray(F)&&(F=F.map((U=>typeof U=="number"?dd(U,S,M,R):U)))),g!==void 0&&F!==void 0&&_&&!_.includes(F)&&(F=N,d&&(F=Rh(d,F))),(d&&d!==this.type||F!==void 0&&!Cu(Gr(F),this.type))&&(F=Rh(this.type.kind,F)),F}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class qd{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const c=e[1];return n.scope.has(c)?new qd(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Sc{constructor(e,n=[],c,d=new ed,g=[],_,S,M){this.registry=e,this.path=n,this.key=n.map((R=>typeof R=="string"?`['${R}']`:`[${R}]`)).join(""),this.scope=d,this.errors=g,this.expectedType=c,this._scope=_,this.options=S,this.iconImageUseTheme=M}parse(e,n,c,d,g={}){return n||c?this.concat(n,null,c,d)._parse(e,g):this._parse(e,g)}parseObjectValue(e,n,c,d,g,_={}){return this.concat(n,c,d,g)._parse(e,_)}_parse(e,n){function c(d,g,_){return _==="assert"?new lo(g,[d]):_==="coerce"?new Is(g,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(d){let g=d.parse(e,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,S=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||S.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(_,S))return null}else g=c(g,_,n.typeAnnotation||"coerce");else g=c(g,_,n.typeAnnotation||"assert")}if(!(g instanceof el)&&g.type.kind!=="resolvedImage"&&Vr(g)){const _=new vc(this._scope,this.options,this.iconImageUseTheme);try{g=new el(g.type,g.evaluate(_))}catch(S){return this.error(S.message),null}}return g}return Is.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,c,d){let g=typeof e=="number"?this.path.concat(e):this.path;g=typeof n=="string"?g.concat(n):g;const _=d?this.scope.concat(d):this.scope;return new Sc(this.registry,g,c||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...n){const c=`${this.key}${n.map((d=>`[${d}]`)).join("")}`;this.errors.push(new No(c,e))}checkSubtype(e,n){const c=yc(e,n);return c&&this.error(c),c}}function Vr(r){if(r instanceof qd)return Vr(r.boundExpression);if(r instanceof Tr&&r.name==="error"||r instanceof zr||r instanceof xc||r instanceof gr||r instanceof Ul)return!1;const e=r instanceof Is||r instanceof lo;let n=!0;return r.eachChild((c=>{n=e?n&&Vr(c):n&&c instanceof el})),!!n&&Cr(r)&&to(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function il(r,e){const n=r.length-1;let c,d,g=0,_=n,S=0;for(;g<=_;)if(S=Math.floor((g+_)/2),c=r[S],d=r[S+1],c<=e){if(S===n||e<d)return S;g=S+1}else{if(!(c>e))throw new Sr("Input is not a number.");_=S-1}return 0}class nl{constructor(e,n,c){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[d,g]of c)this.labels.push(d),this.outputs.push(g)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const c=n.parse(e[1],1,zi);if(!c)return null;const d=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let _=1;_<e.length;_+=2){const S=_===1?-1/0:e[_],M=e[_+1],R=_,N=_+1;if(typeof S!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(d.length&&d[d.length-1][0]>=S)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const F=n.parse(M,N,g);if(!F)return null;g=g||F.type,d.push([S,F])}return new nl(g,c,d)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const d=this.input.evaluate(e);if(d<=n[0])return c[0].evaluate(e);const g=n.length;return d>=n[g-1]?c[g-1].evaluate(e):c[il(n,d)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const Tc=.95047,sc=1.08883,hd=4/29,kc=6/29,fd=3*kc*kc,Rm=kc*kc*kc,Wd=Math.PI/180,Uo=180/Math.PI;function Lh(r){return r>Rm?Math.pow(r,1/3):r/fd+hd}function Lm(r){return r>kc?r*r*r:fd*(r-hd)}function Kp(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Jp(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function a_(r){const e=Jp(r.r),n=Jp(r.g),c=Jp(r.b),d=Lh((.4124564*e+.3575761*n+.1804375*c)/Tc),g=Lh((.2126729*e+.7151522*n+.072175*c)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-Lh((.0193339*e+.119192*n+.9503041*c)/sc)),alpha:r.a}}function ms(r){let e=(r.l+16)/116,n=isNaN(r.a)?e:e+r.a/500,c=isNaN(r.b)?e:e-r.b/200;return e=1*Lm(e),n=Tc*Lm(n),c=sc*Lm(c),new ma(Kp(3.2404542*n-1.5371385*e-.4985314*c),Kp(-.969266*n+1.8760108*e+.041556*c),Kp(.0556434*n-.2040259*e+1.0572252*c),r.alpha)}function Ih(r,e,n){const c=e-r;return r+n*(c>180||c<-180?c-360*Math.round(c/360):c)}const su={forward:a_,reverse:ms,interpolate:function(r,e,n){return{l:Gi(r.l,e.l,n),a:Gi(r.a,e.a,n),b:Gi(r.b,e.b,n),alpha:Gi(r.alpha,e.alpha,n)}}},zu={forward:function(r){const{l:e,a:n,b:c}=a_(r),d=Math.atan2(c,n)*Uo;return{h:d<0?d+360:d,c:Math.sqrt(n*n+c*c),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Wd,n=r.c;return ms({l:r.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:r.alpha})},interpolate:function(r,e,n){return{h:Ih(r.h,e.h,n),c:Gi(r.c,e.c,n),l:Gi(r.l,e.l,n),alpha:Gi(r.alpha,e.alpha,n)}}};var Im=Object.freeze({__proto__:null,hcl:zu,lab:su});class ho{constructor(e,n,c,d,g){this.type=e,this.operator=n,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[_,S]of g)this.labels.push(_),this.outputs.push(S)}static interpolationFactor(e,n,c,d){let g=0;if(e.name==="exponential")g=Du(n,e.base,c,d);else if(e.name==="linear")g=Du(n,1,c,d);else if(e.name==="cubic-bezier"){const _=e.controlPoints;g=new ku(_[0],_[1],_[2],_[3]).solve(Du(n,1,c,d))}return g}static parse(e,n){let[c,d,g,..._]=e;if(!Array.isArray(d)||d.length===0)return n.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const R=d[1];if(typeof R!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:R}}else{if(d[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const R=d.slice(1);if(R.length!==4||R.some((N=>typeof N!="number"||N<0||N>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:R}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,zi),!g)return null;const S=[];let M=null;c==="interpolate-hcl"||c==="interpolate-lab"?M=Js:n.expectedType&&n.expectedType.kind!=="value"&&(M=n.expectedType);for(let R=0;R<_.length;R+=2){const N=_[R],F=_[R+1],U=R+3,W=R+4;if(typeof N!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(S.length&&S[S.length-1][0]>=N)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const Z=n.parse(F,W,M);if(!Z)return null;M=M||Z.type,S.push([N,Z])}return M.kind==="number"||M.kind==="color"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new ho(M,c,d,g,S):n.error(`Type ${lr(M)} is not interpolatable.`)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const d=this.input.evaluate(e);if(d<=n[0])return c[0].evaluate(e);const g=n.length;if(d>=n[g-1])return c[g-1].evaluate(e);const _=il(n,d),S=ho.interpolationFactor(this.interpolation,d,n[_],n[_+1]),M=c[_].evaluate(e),R=c[_+1].evaluate(e);return this.operator==="interpolate"?Yc[this.type.kind.toLowerCase()](M,R,S):this.operator==="interpolate-hcl"?zu.reverse(zu.interpolate(zu.forward(M),zu.forward(R),S)):su.reverse(su.interpolate(su.forward(M),su.forward(R),S))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const n=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)n.push(this.labels[c],this.outputs[c].serialize());return n}}function Du(r,e,n,c){const d=c-n,g=r-n;return d===0?0:e===1?g/d:(Math.pow(e,g)-1)/(Math.pow(e,d)-1)}class Mf{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let c=null;const d=n.expectedType;d&&d.kind!=="value"&&(c=d);const g=[];for(const S of e.slice(1)){const M=n.parse(S,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!M)return null;c=c||M.type,g.push(M)}const _=d&&g.some((S=>yc(d,S.type)));return new Mf(_?ra:c,g)}evaluate(e){let n,c=null,d=0;for(const g of this.args){if(d++,c=g.evaluate(e),c&&c instanceof oo&&!c.available&&(n||(n=c),c=null,d===this.args.length))return n;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((n=>{e.push(n.serialize())})),e}}class ou{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const S=n.parse(e[g+1],g+1);if(!S)return null;c.push([_,S])}const d=n.parse(e[e.length-1],e.length-1,n.expectedType,c);return d?new ou(c,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,c]of this.bindings)e.push(n,c.serialize());return e.push(this.result.serialize()),e}}class zm{constructor(e,n,c){this.type=e,this.index=n,this.input=c}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,zi),d=n.parse(e[2],2,Ls(n.expectedType||ra));return c&&d?new zm(d.type.itemType,c,d):null}evaluate(e){const n=this.index.evaluate(e),c=this.input.evaluate(e);if(n<0)throw new Sr("Array index out of bounds: negative index");if(n>=c.length)throw new Sr("Array index out of bounds: index exceeds array size");if(n!==Math.floor(n))throw new Sr("Array index must be an integer. Use at-interpolated for fractional indices");return c[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Pf{constructor(e,n,c){this.type=e,this.index=n,this.input=c}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,zi),d=n.parse(e[2],2,Ls(n.expectedType||ra));return c&&d?new Pf(d.type.itemType,c,d):null}evaluate(e){const n=this.index.evaluate(e),c=this.input.evaluate(e);if(n<0)throw new Sr(`Array index out of bounds: ${n} < 0.`);if(n>c.length-1)throw new Sr(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n===Math.floor(n))return c[n];const d=Math.floor(n),g=Math.ceil(n),_=c[d],S=c[g];if(typeof _!="number"||typeof S!="number")throw new Sr(`Cannot interpolate between non-number values at index ${n}.`);const M=n-d;return _*(1-M)+S*M}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Ou{constructor(e,n){this.type=_a,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,ra),d=n.parse(e[2],2,ra);return c&&d?Vd(c.type,[_a,$n,zi,ml,ra])?new Ou(c,d):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${lr(c.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!td(n,["boolean","string","number","null"]))throw new Sr(`Expected first argument to be of type boolean, string, number or null, but found ${lr(Gr(n))} instead.`);if(!td(c,["string","array"]))throw new Sr(`Expected second argument to be of type array or string, but found ${lr(Gr(c))} instead.`);return c.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class md{constructor(e,n,c){this.type=zi,this.needle=e,this.haystack=n,this.fromIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,ra),d=n.parse(e[2],2,ra);if(!c||!d)return null;if(!Vd(c.type,[_a,$n,zi,ml,ra]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${lr(c.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,zi);return g?new md(c,d,g):null}return new md(c,d)}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!td(n,["boolean","string","number","null"]))throw new Sr(`Expected first argument to be of type boolean, string, number or null, but found ${lr(Gr(n))} instead.`);if(!td(c,["string","array"]))throw new Sr(`Expected second argument to be of type array or string, but found ${lr(Gr(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return c.indexOf(n,d)}return c.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class pd{constructor(e,n,c,d,g,_){this.inputType=e,this.type=n,this.input=c,this.cases=d,this.outputs=g,this.otherwise=_}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let c,d;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);const g={},_=[];for(let R=2;R<e.length-1;R+=2){let N=e[R];const F=e[R+1];Array.isArray(N)||(N=[N]);const U=n.concat(R);if(N.length===0)return U.error("Expected at least one branch label.");for(const Z of N){if(typeof Z!="number"&&typeof Z!="string")return U.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return U.error("Numeric branch labels must be integer values.");if(c){if(U.checkSubtype(c,Gr(Z)))return null}else c=Gr(Z);if(g[String(Z)]!==void 0)return U.error("Branch labels must be unique.");g[String(Z)]=_.length}const W=n.parse(F,R,d);if(!W)return null;d=d||W.type,_.push(W)}const S=n.parse(e[1],1,ra);if(!S)return null;const M=n.parse(e[e.length-1],e.length-1,d);return M?S.type.kind!=="value"&&n.concat(1).checkSubtype(c,S.type)?null:new pd(c,d,S,g,_,M):null}evaluate(e){const n=this.input.evaluate(e);return(Cu(Gr(n),this.inputType)&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),c=[],d={};for(const _ of n){const S=d[this.cases[_]];S===void 0?(d[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[S][1].push(_)}const g=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,S]of c)e.push(S.length===1?g(S[0]):S.map(g)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class zh{constructor(e,n,c){this.type=e,this.branches=n,this.otherwise=c}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const d=[];for(let _=1;_<e.length-1;_+=2){const S=n.parse(e[_],_,_a);if(!S)return null;const M=n.parse(e[_+1],_+1,c);if(!M)return null;d.push([S,M]),c=c||M.type}const g=n.parse(e[e.length-1],e.length-1,c);return g?new zh(c,d,g):null}evaluate(e){for(const[n,c]of this.branches)if(n.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,c]of this.branches)e(n),e(c);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((n=>{e.push(n.serialize())})),e}}class gd{constructor(e,n,c,d){this.type=e,this.input=n,this.beginIndex=c,this.endIndex=d}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,ra),d=n.parse(e[2],2,zi);if(!c||!d)return null;if(!Vd(c.type,[Ls(ra),$n,ra]))return n.error(`Expected first argument to be of type array or string, but found ${lr(c.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,zi);return g?new gd(c.type,c,d,g):null}return new gd(c.type,c,d)}evaluate(e){const n=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!td(n,["string","array"]))throw new Sr(`Expected first argument to be of type array or string, but found ${lr(Gr(n))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return n.slice(c,d)}return n.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Dm{constructor(e,n){this.type=Ls($n),this.str=e,this.delimiter=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,$n),d=n.parse(e[2],2,$n);return c&&d?new Dm(c,d):void 0}evaluate(e){const n=this.str.evaluate(e),c=this.delimiter.evaluate(e);return n.split(c)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Dh(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function jf(r,e,n,c){return c.compare(e,n)===0}function Zd(r,e,n){const c=r!=="=="&&r!=="!=";return class QP{constructor(g,_,S){this.type=_a,this.lhs=g,this.rhs=_,this.collator=S,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const S=g[0];let M=_.parse(g[1],1,ra);if(!M)return null;if(!Dh(S,M.type))return _.concat(1).error(`"${S}" comparisons are not supported for type '${lr(M.type)}'.`);let R=_.parse(g[2],2,ra);if(!R)return null;if(!Dh(S,R.type))return _.concat(2).error(`"${S}" comparisons are not supported for type '${lr(R.type)}'.`);if(M.type.kind!==R.type.kind&&M.type.kind!=="value"&&R.type.kind!=="value")return _.error(`Cannot compare types '${lr(M.type)}' and '${lr(R.type)}'.`);c&&(M.type.kind==="value"&&R.type.kind!=="value"?M=new lo(R.type,[M]):M.type.kind!=="value"&&R.type.kind==="value"&&(R=new lo(M.type,[R])));let N=null;if(g.length===4){if(M.type.kind!=="string"&&R.type.kind!=="string"&&M.type.kind!=="value"&&R.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(N=_.parse(g[3],3,$d),!N)return null}return new QP(M,R,N)}evaluate(g){const _=this.lhs.evaluate(g),S=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const M=Gr(_),R=Gr(S);if(M.kind!==R.kind||M.kind!=="string"&&M.kind!=="number")throw new Sr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${M.kind}, ${R.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const M=Gr(_),R=Gr(S);if(M.kind!=="string"||R.kind!=="string")return e(g,_,S)}return this.collator?n(g,_,S,this.collator.evaluate(g)):e(g,_,S)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[r];return this.eachChild((_=>{g.push(_.serialize())})),g}}}const Om=Zd("==",(function(r,e,n){return e===n}),jf),r_=Zd("!=",(function(r,e,n){return e!==n}),(function(r,e,n,c){return!jf(0,e,n,c)})),Oh=Zd("<",(function(r,e,n){return e<n}),(function(r,e,n,c){return c.compare(e,n)<0})),Qp=Zd(">",(function(r,e,n){return e>n}),(function(r,e,n,c){return c.compare(e,n)>0})),Rf=Zd("<=",(function(r,e,n){return e<=n}),(function(r,e,n,c){return c.compare(e,n)<=0})),_d=Zd(">=",(function(r,e,n){return e>=n}),(function(r,e,n,c){return c.compare(e,n)>=0}));class Nh{constructor(e,n,c,d,g,_){this.type=$n,this.number=e,this.locale=n,this.currency=c,this.unit=d,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const c=n.parse(e[1],1,zi);if(!c)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return n.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=n.parseObjectValue(d.locale,2,"locale",$n),!g))return null;let _=null;if(d.currency&&(_=n.parseObjectValue(d.currency,2,"currency",$n),!_))return null;let S=null;if(d.unit&&(S=n.parseObjectValue(d.unit,2,"unit",$n),!S))return null;let M=null;if(d["min-fraction-digits"]&&(M=n.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",zi),!M))return null;let R=null;return d["max-fraction-digits"]&&(R=n.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",zi),!R)?null:new Nh(c,g,_,S,M,R)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Lf{constructor(e){this.type=zi,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=n.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${lr(c.type)} instead.`):new Lf(c):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Sr(`Expected value to be of type string or array, but found ${lr(Gr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((n=>{e.push(n.serialize())})),e}}function Nu(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const $l={"==":Om,"!=":r_,">":Qp,"<":Oh,">=":_d,"<=":Rf,array:lo,at:zm,"at-interpolated":Pf,boolean:lo,case:zh,coalesce:Mf,collator:zr,format:gl,image:on,in:Ou,"index-of":md,interpolate:ho,"interpolate-hcl":ho,"interpolate-lab":ho,length:Lf,let:ou,literal:el,match:pd,number:lo,"number-format":Nh,object:lo,slice:gd,step:nl,string:lo,"to-boolean":Is,"to-color":Is,"to-number":Is,"to-string":Is,var:qd,within:xc,distance:gr,config:Ul,split:Dm};function Xd(r,[e,n,c,d]){e=e.evaluate(r),n=n.evaluate(r),c=c.evaluate(r);const g=d?d.evaluate(r):1,_=Qs(e,n,c,g);if(_)throw new Sr(_);return new ma(e/255,n/255,c/255,g)}function If(r,[e,n,c,d]){e=e.evaluate(r),n=n.evaluate(r),c=c.evaluate(r);const g=d?d.evaluate(r):1,_=(function(R,N,F,U){return typeof R=="number"&&R>=0&&R<=360?typeof N=="number"&&N>=0&&N<=100&&typeof F=="number"&&F>=0&&F<=100?U===void 0||typeof U=="number"&&U>=0&&U<=1?null:`Invalid hsla value [${[R,N,F,U].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof U=="number"?[R,N,F,U]:[R,N,F]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof U=="number"?[R,N,F,U]:[R,N,F]).join(", ")}]: 'h' must be between 0 and 360.`})(e,n,c,g);if(_)throw new Sr(_);const S=`hsla(${e}, ${n}%, ${c}%, ${g})`,M=ma.parse(S);if(!M)throw new Sr(`Failed to parse HSLA color: ${S}`);return M}function Nm(r,e){return r in e}function Yd(r,e){const n=e[r];return n===void 0?null:n}function oc(r){return{type:r}}function yd(r){if(r instanceof Ul)return new Set([r.key]);let e=new Set;return r.eachChild((n=>{e=new Set([...e,...yd(n)])})),e}function zf(r){if(r instanceof Tr&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild((n=>{!e&&zf(n)&&(e=!0)})),e}function Kd(r){return{result:"success",value:r}}function Ec(r){return{result:"error",value:r}}function Fm(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Jd(r){return r["property-type"]==="data-driven"}function Bm(r){return Fm(r.expression,"measure-light")}function Fu(r){return Fm(r.expression,"zoom")}function ja(r){return!!r.expression&&r.expression.interpolated}function xr(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Ts(r){return r}function Df(r,e){const n=e.type==="color",c=r.stops&&typeof r.stops[0][0]=="object",d=c||!(c||r.property!==void 0),g=r.type||(ja(e)?"exponential":"interval");if(n&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map((R=>[R[0],ma.parse(R[1])]))),r.default=ma.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Im[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,S,M;if(g==="exponential")_=Fh;else if(g==="interval")_=Um;else if(g==="categorical"){_=Qd,S=Object.create(null);for(const R of r.stops)S[R[0]]=R[1];M=typeof r.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=eh}if(c){const R={},N=[];for(let W=0;W<r.stops.length;W++){const Z=r.stops[W],ee=Z[0].zoom;R[ee]===void 0&&(R[ee]={zoom:ee,type:r.type,property:r.property,default:r.default,stops:[]},N.push(ee)),R[ee].stops.push([Z[0].value,Z[1]])}const F=[];for(const W of N)F.push([R[W].zoom,Df(R[W],e)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:ho.interpolationFactor.bind(void 0,U),zoomStops:F.map((W=>W[0])),evaluate:({zoom:W},Z)=>Fh({stops:F,base:r.base},e,W).evaluate(W,Z)}}if(d){const R=g==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:ho.interpolationFactor.bind(void 0,R),zoomStops:r.stops.map((N=>N[0])),evaluate:({zoom:N})=>_(r,e,N,S,M)}}return{kind:"source",evaluate(R,N){const F=N&&N.properties?N.properties[r.property]:void 0;return F===void 0?al(r.default,e.default):_(r,e,F,S,M)}}}function al(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function Qd(r,e,n,c,d){return al(typeof n===d?c[n]:void 0,r.default,e.default)}function Um(r,e,n){if(!Mu(n))return al(r.default,e.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const d=il(r.stops.map((g=>g[0])),n);return r.stops[d][1]}function Fh(r,e,n){const c=r.base!==void 0?r.base:1;if(!Mu(n))return al(r.default,e.default);const d=r.stops.length;if(d===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[d-1][0])return r.stops[d-1][1];const g=il(r.stops.map((N=>N[0])),n),_=(function(N,F,U,W){const Z=W-U,ee=N-U;return Z===0?0:F===1?ee/Z:(Math.pow(F,ee)-1)/(Math.pow(F,Z)-1)})(n,c,r.stops[g][0],r.stops[g+1][0]),S=r.stops[g][1],M=r.stops[g+1][1];let R=Yc[e.type]||Ts;if(r.colorSpace&&r.colorSpace!=="rgb"){const N=Im[r.colorSpace];R=(F,U)=>N.reverse(N.interpolate(N.forward(F),N.forward(U),_))}return typeof S.evaluate=="function"?{evaluate(...N){const F=S.evaluate.apply(void 0,N),U=M.evaluate.apply(void 0,N);if(F!==void 0&&U!==void 0)return R(F,U,_)}}:R(S,M,_)}function eh(r,e,n){return e.type==="color"?n=ma.parse(n):e.type==="formatted"?n=cs.fromString(n.toString()):e.type==="resolvedImage"?n=oo.build(n.toString()):ji(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),al(n,r.default,e.default)}Tr.register($l,{error:[{kind:"error"},[$n],(r,[e])=>{throw new Sr(e.evaluate(r))}],typeof:[$n,[ra],(r,[e])=>lr(Gr(e.evaluate(r)))],"to-rgba":[Ls(zi,4),[Js],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ls(zi,4),[Js],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Js,[zi,zi,zi],Xd],rgba:[Js,[zi,zi,zi,zi],Xd],hsl:[Js,[zi,zi,zi],If],hsla:[Js,[zi,zi,zi,zi],If],has:{type:_a,overloads:[[[$n],(r,[e])=>Nm(e.evaluate(r),r.properties())],[[$n,ac],(r,[e,n])=>Nm(e.evaluate(r),n.evaluate(r))]]},get:{type:ra,overloads:[[[$n],(r,[e])=>Yd(e.evaluate(r),r.properties())],[[$n,ac],(r,[e,n])=>Yd(e.evaluate(r),n.evaluate(r))]]},"feature-state":[ra,[$n],(r,[e])=>Yd(e.evaluate(r),r.featureState||{})],properties:[ac,[],r=>r.properties()],"geometry-type":[$n,[],r=>r.geometryType()],worldview:[$n,[],r=>r.globals.worldview||""],"is-active-floor":[_a,oc($n),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;const n=r.globals.activeFloors;return e.some((c=>{const d=c.evaluate(r);return n.has(d)}))}],id:[ra,[],r=>r.id()],zoom:[zi,[],r=>r.globals.zoom],pitch:[zi,[],r=>r.globals.pitch||0],"distance-from-center":[zi,[],r=>r.distanceFromCenter()],"measure-light":[zi,[$n],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[zi,[],r=>r.globals.heatmapDensity||0],"line-progress":[zi,[],r=>r.globals.lineProgress||0],"raster-value":[zi,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[zi,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[zi,[],r=>r.globals.skyRadialProgress||0],accumulated:[ra,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[zi,oc(zi),(r,e)=>{let n=0;for(const c of e)n+=c.evaluate(r);return n}],"*":[zi,oc(zi),(r,e)=>{let n=1;for(const c of e)n*=c.evaluate(r);return n}],"-":{type:zi,overloads:[[[zi,zi],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[zi],(r,[e])=>-e.evaluate(r)]]},"/":[zi,[zi,zi],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[zi,[zi,zi],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[zi,[],()=>Math.LN2],pi:[zi,[],()=>Math.PI],e:[zi,[],()=>Math.E],"^":[zi,[zi,zi],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[zi,[zi],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[zi,[zi],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[zi,[zi],(r,[e])=>Math.log(e.evaluate(r))],log2:[zi,[zi],(r,[e])=>Math.log2(e.evaluate(r))],sin:[zi,[zi],(r,[e])=>Math.sin(e.evaluate(r))],cos:[zi,[zi],(r,[e])=>Math.cos(e.evaluate(r))],tan:[zi,[zi],(r,[e])=>Math.tan(e.evaluate(r))],asin:[zi,[zi],(r,[e])=>Math.asin(e.evaluate(r))],acos:[zi,[zi],(r,[e])=>Math.acos(e.evaluate(r))],atan:[zi,[zi],(r,[e])=>Math.atan(e.evaluate(r))],min:[zi,oc(zi),(r,e)=>Math.min(...e.map((n=>n.evaluate(r))))],max:[zi,oc(zi),(r,e)=>Math.max(...e.map((n=>n.evaluate(r))))],abs:[zi,[zi],(r,[e])=>Math.abs(e.evaluate(r))],round:[zi,[zi],(r,[e])=>{const n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[zi,[zi],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[zi,[zi],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[_a,[$n,ra],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[_a,[ra],(r,[e])=>r.id()===e.value],"filter-type-==":[_a,[$n],(r,[e])=>r.geometryType()===e.value],"filter-<":[_a,[$n,ra],(r,[e,n])=>{const c=r.properties()[e.value],d=n.value;return typeof c==typeof d&&c<d}],"filter-id-<":[_a,[ra],(r,[e])=>{const n=r.id(),c=e.value;return typeof n==typeof c&&n<c}],"filter->":[_a,[$n,ra],(r,[e,n])=>{const c=r.properties()[e.value],d=n.value;return typeof c==typeof d&&c>d}],"filter-id->":[_a,[ra],(r,[e])=>{const n=r.id(),c=e.value;return typeof n==typeof c&&n>c}],"filter-<=":[_a,[$n,ra],(r,[e,n])=>{const c=r.properties()[e.value],d=n.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[_a,[ra],(r,[e])=>{const n=r.id(),c=e.value;return typeof n==typeof c&&n<=c}],"filter->=":[_a,[$n,ra],(r,[e,n])=>{const c=r.properties()[e.value],d=n.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[_a,[ra],(r,[e])=>{const n=r.id(),c=e.value;return typeof n==typeof c&&n>=c}],"filter-has":[_a,[ra],(r,[e])=>e.value in r.properties()],"filter-has-id":[_a,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[_a,[Ls($n)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[_a,[Ls(ra)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[_a,[$n,Ls(ra)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[_a,[$n,Ls(ra)],(r,[e,n])=>(function(c,d,g,_){for(;g<=_;){const S=g+_>>1;if(d[S]===c)return!0;d[S]>c?_=S-1:g=S+1}return!1})(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:_a,overloads:[[[_a,_a],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[oc(_a),(r,e)=>{for(const n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:_a,overloads:[[[_a,_a],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[oc(_a),(r,e)=>{for(const n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[_a,[_a],(r,[e])=>!e.evaluate(r)],"is-supported-script":[_a,[$n],(r,[e])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[$n,[$n],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[$n,[$n],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[$n,oc(ra),(r,e)=>e.map((n=>$r(n.evaluate(r)))).join("")],"resolved-locale":[$n,[$d],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[zi,[zi,zi,ra],(r,e)=>{const[n,c,d]=e.map((_=>_.evaluate(r)));if(n>c||n===c)return n;let g;if(typeof d=="string")g=(function(_){let S=0;if(_.length===0)return S;for(let M=0;M<_.length;M++)S=(S<<5)-S+_.charCodeAt(M),S|=0;return S})(d);else{if(typeof d!="number")throw new Sr(`Invalid seed input: ${d}`);g=d}return n+Nu(g)()*(c-n)}]});class $m{constructor(e,n,c,d,g){this.expression=e,this._warningHistory={},this._scope=c,this._options=d,this._iconImageUseTheme=g,this._evaluator=new vc(c,d,g),this._defaultValue=n?(function(_){return _.type==="color"&&(xr(_.default)||Array.isArray(_.default))?new ma(0,0,0,0):_.type==="color"?ma.parse(_.default)||null:_.default===void 0?null:_.default})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=yd(e),this.isIndoorDependent=zf(e)}evaluateWithoutErrorHandling(e,n,c,d,g,_,S,M){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=M||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,c,d,g,_,S,M,R){this._evaluator||(this._evaluator=new vc(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=M||null,this._evaluator.iconImageUseTheme=R||null;try{const N=this.expression.evaluate(this._evaluator);if(N==null||typeof N=="number"&&N!=N)return this._defaultValue;if(this._enumValues&&!(N in this._enumValues))throw new Sr(`Expected value to be one of ${Object.keys(this._enumValues).map((F=>JSON.stringify(F))).join(", ")}, but found ${JSON.stringify(N)} instead.`);return N}catch(N){const F=N;return this._warningHistory[F.message]||(this._warningHistory[F.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${F.message}`)),this._defaultValue}}}function qr(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in $l}function lu(r,e,n,c,d){const g=new Sc($l,[],e?(function(S){const M={color:Js,string:$n,number:zi,enum:$n,boolean:_a,formatted:Kc,resolvedImage:Ol};return S.type==="array"?Ls(M[S.value]||ra,S.length):M[S.type]})(e):void 0,void 0,void 0,n,c,d),_=g.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Kd(new $m(_,e,n,c,d)):Ec(g.errors)}class vd{constructor(e,n,c,d){this.kind=e,this._styleExpression=n,this.isLightConstant=c,this.isLineProgressConstant=d,this.isStateDependent=e!=="constant"&&!fs(n.expression),this.configDependencies=yd(n.expression),this.isIndoorDependent=zf(n.expression)}evaluateWithoutErrorHandling(e,n,c,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,d,g,_)}evaluate(e,n,c,d,g,_,S){return this._styleExpression.evaluate(e,n,c,d,g,_,void 0,void 0,S)}}class xd{constructor(e,n,c,d,g,_){this.kind=e,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!fs(n.expression),this.isIndoorDependent=zf(n.expression),this.isLightConstant=g,this.isLineProgressConstant=_,this.configDependencies=yd(n.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,n,c,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,d,g,_)}evaluate(e,n,c,d,g,_){return this._styleExpression.evaluate(e,n,c,d,g,_)}interpolationFactor(e,n,c){return this.interpolationType?ho.interpolationFactor(this.interpolationType,e,n,c):0}}function Vm(r,e,n,c,d){if((r=lu(r,e,n,c,d)).result==="error")return r;const g=r.value.expression,_=Cr(g);if(!_&&!Jd(e))return Ec([new No("","data expressions not supported")]);const S=to(g,["zoom","pitch","distance-from-center"]);if(!S&&!Fu(e))return Ec([new No("","zoom expressions not supported")]);const M=to(g,["measure-light"]);if(!M&&!Bm(e))return Ec([new No("","measure-light expression not supported")]);const R=to(g,["line-progress"]);if(!R&&!(function(U){return Fm(U.expression,"line-progress")})(e))return Ec([new No("","line-progress expression not supported")]);const N=e.expression&&e.expression.relaxZoomRestriction,F=Vl(g);return F||S||N?F instanceof No?Ec([F]):F instanceof ho&&!ja(e)?Ec([new No("",'"interpolate" expressions cannot be used with this property')]):Kd(F?new xd(_&&R?"camera":"composite",r.value,F.labels,F instanceof ho?F.interpolation:void 0,M,R):new vd(_&&R?"constant":"source",r.value,M,R)):Ec([new No("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Hm{constructor(e,n){this._parameters=e,this._specification=n,Object.assign(this,Df(this._parameters,this._specification))}static deserialize(e){return new Hm(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Vl(r){let e=null;if(r instanceof ou)e=Vl(r.result);else if(r instanceof Mf){for(const n of r.args)if(e=Vl(n),e)break}else(r instanceof nl||r instanceof ho)&&r.input instanceof Tr&&r.input.name==="zoom"&&(e=r);return e instanceof No||r.eachChild((n=>{const c=Vl(n);c instanceof No?e=c:e&&c&&e!==c&&(e=new No("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Of,Gm,rl=(function(){if(Gm)return Of;Gm=1,Of=e;var r=3;function e(n,c,d){var g=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var _=new Int32Array(this.arrayBuffer);n=_[0],this.d=(c=_[1])+2*(d=_[2]);for(var S=0;S<this.d*this.d;S++){var M=_[r+S],R=_[r+S+1];g.push(M===R?null:_.subarray(M,R))}var N=_[r+g.length+1];this.keys=_.subarray(_[r+g.length],N),this.bboxes=_.subarray(N),this.insert=this._insertReadonly}else{this.d=c+2*d;for(var F=0;F<this.d*this.d;F++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=d,this.scale=c/n,this.uid=0;var U=d/c*n;this.min=-U,this.max=n+U}return e.prototype.insert=function(n,c,d,g,_){this._forEachCell(c,d,g,_,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(_)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,c,d,g,_,S){this.cells[_].push(S)},e.prototype.query=function(n,c,d,g,_){var S=this.min,M=this.max;if(n<=S&&c<=S&&M<=d&&M<=g&&!_)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(n,c,d,g,this._queryCell,R,{},_),R},e.prototype._queryCell=function(n,c,d,g,_,S,M,R){var N=this.cells[_];if(N!==null)for(var F=this.keys,U=this.bboxes,W=0;W<N.length;W++){var Z=N[W];if(M[Z]===void 0){var ee=4*Z;(R?R(U[ee+0],U[ee+1],U[ee+2],U[ee+3]):n<=U[ee+2]&&c<=U[ee+3]&&d>=U[ee+0]&&g>=U[ee+1])?(M[Z]=!0,S.push(F[Z])):M[Z]=!1}}},e.prototype._forEachCell=function(n,c,d,g,_,S,M,R){for(var N=this._convertToCellCoord(n),F=this._convertToCellCoord(c),U=this._convertToCellCoord(d),W=this._convertToCellCoord(g),Z=N;Z<=U;Z++)for(var ee=F;ee<=W;ee++){var ce=this.d*ee+Z;if((!R||R(this._convertFromCellCoord(Z),this._convertFromCellCoord(ee),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(ee+1)))&&_.call(this,n,c,d,g,ce,S,M,R))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,c=r+this.cells.length+1+1,d=0,g=0;g<this.cells.length;g++)d+=this.cells[g].length;var _=new Int32Array(c+d+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var S=c,M=0;M<n.length;M++){var R=n[M];_[r+M]=S,_.set(R,S),S+=R.length}return _[r+n.length]=S,_.set(this.keys,S),_[r+n.length+1]=S+=this.keys.length,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer},Of})(),Wr=Ro(rl);const Bu={};function vi(r,e,n={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),Bu[e]={klass:r,omit:n.omit||[]}}vi(Object,"Object"),Wr.serialize=function(r,e){const n=r.toArrayBuffer();return e&&e.add(n),{buffer:n}},Wr.deserialize=function(r){return new Wr(r.buffer)},Object.defineProperty(Wr,"name",{value:"Grid"}),vi(Wr,"Grid"),delete Me.prototype.constructor,vi(ma,"Color"),vi(Error,"Error"),vi(cs,"Formatted"),vi(Hd,"FormattedSection"),vi(hs,"AJAXError"),vi(oo,"ResolvedImage"),vi(Hm,"StylePropertyFunction"),vi($m,"StyleExpression",{omit:["_evaluator"]}),vi(Rs,"ImageId"),vi(rc,"ImageVariant"),vi(xd,"ZoomDependentExpression"),vi(vd,"ZoomConstantExpression"),vi(Tr,"CompoundExpression",{omit:["_evaluate"]});for(const r in $l)Bu[$l[r]._classRegistryKey]||vi($l[r],`Expression${r}`);function bd(r){return r&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Ac(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(bd(r)||r instanceof ImageBitmap)return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const n=[];for(const c of r)n.push(Ac(c,e));return n}if(r instanceof Map){const n={$name:"Map",entries:[]};for(const[c,d]of r.entries())n.entries.push(Ac(c),Ac(d,e));return n}if(r instanceof Set){const n={$name:"Set"};let c=0;for(const d of r.values())n[++c]=Ac(d);return n}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const n=r.constructor,c=n._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const d=n.serialize?n.serialize(r,e):{};if(!n.serialize){for(const g in r)r.hasOwnProperty(g)&&(Bu[c].omit.indexOf(g)>=0||(d[g]=Ac(r[g],e)));r instanceof Error&&(d.message=r.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof r)}function $o(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||bd(r)||r instanceof ImageBitmap||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map($o);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const d=r.entries||[],g=new Map;for(let _=0;_<d.length;_+=2)g.set($o(d[_]),$o(d[_+1]));return g}if(e==="Set"){const d=new Set;for(const g of Object.keys(r))g!=="$name"&&d.add($o(r[g]));return d}if(e==="BigInt")return BigInt(r.value);const{klass:n}=Bu[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(r);const c=Object.create(n.prototype);for(const d of Object.keys(r))d!=="$name"&&(c[d]=$o(r[d]));return c}throw new Error("can't deserialize object of type "+typeof r)}const qi={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function th(r){for(const e of r)if(Ff(e.charCodeAt(0)))return!0;return!1}function Nf(r){for(const e of r)if(!eg(e.charCodeAt(0)))return!1;return!0}function eg(r){return!(qi.Arabic(r)||qi["Arabic Supplement"](r)||qi["Arabic Extended-A"](r)||qi["Arabic Presentation Forms-A"](r)||qi["Arabic Presentation Forms-B"](r))}function Ff(r){return!(r!==746&&r!==747&&(r<4352||!(qi["Bopomofo Extended"](r)||qi.Bopomofo(r)||qi["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||qi["CJK Compatibility Ideographs"](r)||qi["CJK Compatibility"](r)||qi["CJK Radicals Supplement"](r)||qi["CJK Strokes"](r)||!(!qi["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||qi["CJK Unified Ideographs Extension A"](r)||qi["CJK Unified Ideographs"](r)||qi["Enclosed CJK Letters and Months"](r)||qi["Hangul Compatibility Jamo"](r)||qi["Hangul Jamo Extended-A"](r)||qi["Hangul Jamo Extended-B"](r)||qi["Hangul Jamo"](r)||qi["Hangul Syllables"](r)||qi.Hiragana(r)||qi["Ideographic Description Characters"](r)||qi.Kanbun(r)||qi["Kangxi Radicals"](r)||qi["Katakana Phonetic Extensions"](r)||qi.Katakana(r)&&r!==12540||!(!qi["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!qi["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||qi["Unified Canadian Aboriginal Syllabics"](r)||qi["Unified Canadian Aboriginal Syllabics Extended"](r)||qi["Vertical Forms"](r)||qi["Yijing Hexagram Symbols"](r)||qi["Yi Syllables"](r)||qi["Yi Radicals"](r))))}function Bf(r){return!(Ff(r)||(function(e){return!!(qi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||qi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||qi["Letterlike Symbols"](e)||qi["Number Forms"](e)||qi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||qi["Control Pictures"](e)&&e!==9251||qi["Optical Character Recognition"](e)||qi["Enclosed Alphanumerics"](e)||qi["Geometric Shapes"](e)||qi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||qi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||qi["CJK Symbols and Punctuation"](e)||qi.Katakana(e)||qi["Private Use Area"](e)||qi["CJK Compatibility Forms"](e)||qi["Small Form Variants"](e)||qi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(r))}function Uf(r){return qi.Arabic(r)||qi["Arabic Supplement"](r)||qi["Arabic Extended-A"](r)||qi["Arabic Presentation Forms-A"](r)||qi["Arabic Presentation Forms-B"](r)}function qm(r){return r>=1424&&r<=2303||qi["Arabic Presentation Forms-A"](r)||qi["Arabic Presentation Forms-B"](r)}function cu(r,e){return!(!e&&qm(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||qi.Khmer(r))}function tg(r){for(const e of r)if(qm(e.charCodeAt(0)))return!0;return!1}const sl={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let ig=null,ko=sl.unavailable,uu=null;const Bh=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(ko=sl.error),ig&&ig(r)};function Uh(){$f.fire(new wo("pluginStateChange",{pluginStatus:ko,pluginURL:uu}))}const $f=new _c,$h=function(){return ko},ng=function(){if(ko!==sl.deferred||!uu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ko=sl.loading,Uh(),uu&&zo({url:uu},(r=>{r?Bh(r):(ko=sl.loaded,Uh())}))},du={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ko===sl.loaded||du.applyArabicShaping!=null,isLoading:()=>ko===sl.loading,setState(r){ko=r.pluginStatus,uu=r.pluginURL},isParsing:()=>ko===sl.parsing,isParsed:()=>ko===sl.parsed,getPluginURL:()=>uu};class Fa{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness,this.worldview=n.worldview,this.activeFloors=n.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(n,c){for(const d of n)if(!cu(d.charCodeAt(0),c))return!1;return!0})(e,du.isLoaded())}}class Wm{constructor(e,n,c,d,g){this.property=e,this.value=n,this.expression=(function(_,S,M,R,N){if(xr(_))return new Hm(_,S);if(qr(_)||Array.isArray(_)&&_.length>0){const F=Vm(_,S,M,R,N);if(F.result==="error")throw new Error(F.value.map((U=>`${U.key}: ${U.message}`)).join(", "));return F.value}{let F=_;return typeof _=="string"&&S.type==="color"&&(F=ma.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>F}}})(n===void 0?e.specification.default:n,e.specification,c,d,g)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,c,d){return this.property.possiblyEvaluate(this,e,n,c,d)}}class Zm{constructor(e,n,c,d){this.property=e,this.value=new Wm(e,void 0,n,c,d)}transitioned(e,n){return new Vf(this.property,this.value,n,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Vf(this.property,this.value,null,{},0)}}class ih{constructor(e,n,c,d){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=c,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Tt(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Zm(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Wm(this._values[e].property,n===null?void 0:Tt(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,n){n&&(this._options=n);const c=this._properties.properties;if(e)for(const d in e){const g=e[d];if(d.endsWith("-transition")){const _=d.slice(0,-11);c[_]&&this.setTransition(_,g)}else c.hasOwnProperty(d)&&this.setValue(d,g)}}getTransition(e){return Tt(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Zm(this._values[e].property)),this._values[e].transition=Tt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c);const d=this.getTransition(n);d!==void 0&&(e[`${n}-transition`]=d)}return e}transitioned(e,n){const c=new ag(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(e,n._values[d]);return c}untransitioned(){const e=new ag(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Vf{constructor(e,n,c,d,g){const _=d.delay||0,S=d.duration||0;g=g||0,this.property=e,this.value=n,this.begin=g+_,this.end=this.begin+S,e.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(e,n,c){const d=e.now||0,g=this.value.possiblyEvaluate(e,n,c),_=this.prior;if(_){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return _.possiblyEvaluate(e,n,c);{const S=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,n,c),g,vn(S))}}return g}}class ag{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,c){const d=new wd(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(e,n,c);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Hf{constructor(e,n,c,d){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=c,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Tt(this._values[e].value)}setValue(e,n){this._values[e]=new Wm(this._values[e].property,n===null?void 0:Tt(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c)}return e}possiblyEvaluate(e,n,c,d){const g=new wd(this._properties);for(const _ of Object.keys(this._values))g._values[_]=this._values[_].possiblyEvaluate(e,n,c,d);return g}isIndoorDependent(){return this._isIndoorDependent}}class Cc{constructor(e,n,c,d){this.property=e,this.value=n,this.parameters=c,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,c,d){return this.property.evaluate(this.value,this.parameters,e,n,c,d,this.iconImageUseTheme)}}class wd{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ei{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,c){const d=Yc[this.specification.type];return d?d(e,n,c):e}}class li{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,c,d,g){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Cc(this,{kind:"constant",value:e.expression.evaluate(n,null,{},c,d,void 0,g)},n):new Cc(this,e.expression,n,g)}interpolate(e,n,c){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Cc(this,{kind:"constant",value:void 0},e.parameters);const d=Yc[this.specification.type];return d?new Cc(this,{kind:"constant",value:d(e.value.value,n.value.value,c)},e.parameters):e}evaluate(e,n,c,d,g,_,S){return e.kind==="constant"?e.value:e.evaluate(n,c,d,g,_,void 0,S)}}class Sd{constructor(e){this.specification=e}possiblyEvaluate(e,n,c,d){return!!e.expression.evaluate(n,null,{},c,d)}interpolate(){return!1}}class dr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Fa(0,{});for(const c in e){const d=e[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new Wm(d,void 0),_=this.defaultTransitionablePropertyValues[c]=new Zm(d);this.defaultTransitioningPropertyValues[c]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(n)}}}vi(li,"DataDrivenProperty"),vi(ei,"DataConstantProperty"),vi(Sd,"ColorRampProperty");var rt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Xm(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Gf(r){if(Array.isArray(r))return r.map(Gf);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const n in r)e[n]=Gf(r[n]);return e}return Xm(r)}function Mc(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Mc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Vh(r,e="",n=null,c="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Mc(r)||(r=Gh(r));const d=r;let g=!0;try{g=(function(N){if(!Hh(N))return N;let F=Gf(N);return rg(F),F=Td(F),F})(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let _=null,S=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){S=rt[`filter_${c}`];const N=lu(g,S,e,n);if(N.result==="error")throw new Error(N.value.map((F=>`${F.key}: ${F.message}`)).join(", "));_=(F,U,W)=>N.value.evaluate(F,U,{},W)}let M=null,R=null;if(g!==d){const N=lu(d,S,e,n);if(N.result==="error")throw new Error(N.value.map((F=>`${F.key}: ${F.message}`)).join(", "));M=(F,U,W,Z,ee)=>N.value.evaluate(F,U,{},W,void 0,void 0,Z,ee),R=!Cr(N.value.expression)}return{filter:_,dynamicFilter:M||void 0,needGeometry:og(g),needFeature:!!R}}function Td(r){if(!Array.isArray(r))return r;const e=(function(n){if(sg.has(n[0])){for(let c=1;c<n.length;c++)if(Hh(n[c]))return!0}return n})(r);return e===!0?e:e.map((n=>Td(n)))}function rg(r){let e=!1;const n=[];if(r[0]==="case"){for(let c=1;c<r.length-1;c+=2)e=e||Hh(r[c]),n.push(r[c+1]);n.push(r[r.length-1])}else if(r[0]==="match"){e=e||Hh(r[1]);for(let c=2;c<r.length-1;c+=2)n.push(r[c+1]);n.push(r[r.length-1])}else if(r[0]==="step"){e=e||Hh(r[1]);for(let c=1;c<r.length-1;c+=2)n.push(r[c+1])}e&&(r.length=0,r.push("any",...n));for(let c=1;c<r.length;c++)rg(r[c])}function Hh(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<r.length;n++)if(Hh(r[n]))return!0;return!1}const sg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function s_(r,e){return r<e?-1:r>e?1:0}function og(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(og(r[e]))return!0;return!1}function Gh(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?qf(r[1],r[2],"=="):e==="!="?Zf(qf(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?qf(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(Gh))):e==="all"?["all"].concat(r.slice(1).map(Gh)):e==="none"?["all"].concat(r.slice(1).map(Gh).map(Zf)):e==="in"?Wf(r[1],r.slice(2)):e==="!in"?Zf(Wf(r[1],r.slice(2))):e==="has"?Ym(r[1]):e!=="!has"||Zf(Ym(r[1]));var n}function qf(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function Wf(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(s_)]]:["filter-in-small",r,["literal",e]]}}function Ym(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Zf(r){return["!",r]}const kd="";function ol(r,e){return e?`${r}${kd}${e}`:r}let Km;const Xf=()=>Km||(Km=new dr({"icon-size":new li(rt.layout_symbol["icon-size"]),"icon-image":new li(rt.layout_symbol["icon-image"]),"icon-rotate":new li(rt.layout_symbol["icon-rotate"]),"icon-offset":new li(rt.layout_symbol["icon-offset"]),"text-size":new li(rt.layout_symbol["text-size"]),"text-rotate":new li(rt.layout_symbol["text-rotate"]),"text-offset":new li(rt.layout_symbol["text-offset"])}));class lg{constructor(e,n,c,d,g,_){const S=lu(e,rt.appearance.condition);if(S.result==="success"&&(this.condition=S.value),this.name=n,c){this.properties=new wd(Xf()),this.unevaluatedLayout=new Hf(Xf(),d,g,_);for(const M in c)this.unevaluatedLayout.setValue(M,c[M])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,n,c){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,n,c))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),n=this.hasProperty("icon-size"),c=this.hasProperty("icon-offset"),d=this.hasProperty("icon-rotate");return e||n||c||d}hasTextProperties(){const e=this.hasProperty("text-size"),n=this.hasProperty("text-offset"),c=this.hasProperty("text-rotate");return e||n||c}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const cg="-transition",Hl=new Set(["fill","line","background","hillshade","raster"]);class Eo extends _c{constructor(e,n,c,d,g,_){if(super(),this.id=e.id,this.fqid=ol(this.id,c),this.type=e.type,this.scope=c,this.lut=d,this.options=g,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const S=lu(this.filter,rt[`filter_${e.type}`]);S.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...S.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||S.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),n.layout&&(this._unevaluatedLayout=new Hf(n.layout,this.scope,g,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),n.paint){this._transitionablePaint=new ih(n.paint,this.scope,g);for(const S in e.paint)this.setPaintProperty(S,e.paint[S]);for(const S in e.layout)this.setLayoutProperty(S,e.layout[S]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wd(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Hl.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...c.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||c.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((n=>{this.appearances.push(new lg(n.condition,n.name,n.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(cg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,n){const c=this._transitionablePaint,d=c._properties.properties;if(e.endsWith(cg)){const F=e.slice(0,-11);return d[F]&&c.setTransition(F,n||void 0),!1}if(!d[e])return!1;const g=c._values[e],_=g.value.isDataDriven(),S=g.value;c.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...c.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||c.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const M=c._values[e].value,R=M.isDataDriven(),N=e.endsWith("pattern")||e==="line-dasharray";return R||_||N||this._handleOverridablePaintPropertyUpdate(e,S,M)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,c){return null}_handleOverridablePaintPropertyUpdate(e,n,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((n=>n.serialize()))),It(e,((n,c)=>!(n===void 0||c==="layout"&&!Object.keys(n).length||c==="paint"&&!Object.keys(n).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Cc&&Jd(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}for(const e of this.appearances)if(!fs(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Vh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,n,c){return{}}queryRadius(e){}queryIntersectsFeature(e,n,c,d,g,_,S,M,R){}}const ug={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Yf{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const qh=new ArrayBuffer(0);class Ba{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,n){return e._trim(),n&&e.arrayBuffer&&n.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,e.arrayBuffer?n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement:(n.capacity=0,n.arrayBuffer=qh),n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ln(r,e=1){let n=0,c=0;return{members:r.map((d=>{const g=ug[d.type].BYTES_PER_ELEMENT,_=n=Wh(n,Math.max(e,g)),S=d.components||1;return c=Math.max(c,g),n+=g*S,{name:d.name,type:d.type,components:S,offset:_}})),size:Wh(n,Math.max(c,e)),alignment:e}}function Wh(r,e){return Math.ceil(r/e)*e}class Pc extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const d=2*e;return this.int16[d+0]=n,this.int16[d+1]=c,e}}Pc.prototype.bytesPerElement=4,vi(Pc,"StructArrayLayout2i4");class nh extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,c)}emplace(e,n,c,d){const g=3*e;return this.int16[g+0]=n,this.int16[g+1]=c,this.int16[g+2]=d,e}}nh.prototype.bytesPerElement=6,vi(nh,"StructArrayLayout3i6");class ah extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,c,d)}emplace(e,n,c,d,g){const _=4*e;return this.int16[_+0]=n,this.int16[_+1]=c,this.int16[_+2]=d,this.int16[_+3]=g,e}}ah.prototype.bytesPerElement=8,vi(ah,"StructArrayLayout4i8");class wl extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}wl.prototype.bytesPerElement=4,vi(wl,"StructArrayLayout1f4");class Jm extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,c)}emplace(e,n,c,d){const g=4*e,_=2*e;return this.int16[g+0]=n,this.int16[g+1]=c,this.float32[_+1]=d,e}}Jm.prototype.bytesPerElement=8,vi(Jm,"StructArrayLayout2i1f8");class Sl extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,c)}emplace(e,n,c,d){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=c,this.int16[g+2]=d,e}}Sl.prototype.bytesPerElement=8,vi(Sl,"StructArrayLayout3i8");class lc extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,c,d,g)}emplace(e,n,c,d,g,_){const S=5*e;return this.int16[S+0]=n,this.int16[S+1]=c,this.int16[S+2]=d,this.int16[S+3]=g,this.int16[S+4]=_,e}}lc.prototype.bytesPerElement=10,vi(lc,"StructArrayLayout5i10");class jc extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,c,d,g,_,S)}emplace(e,n,c,d,g,_,S,M){const R=6*e,N=12*e,F=3*e;return this.int16[R+0]=n,this.int16[R+1]=c,this.uint8[N+4]=d,this.uint8[N+5]=g,this.uint8[N+6]=_,this.uint8[N+7]=S,this.float32[F+2]=M,e}}jc.prototype.bytesPerElement=12,vi(jc,"StructArrayLayout2i4ub1f12");class Tl extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,c)}emplace(e,n,c,d){const g=3*e;return this.float32[g+0]=n,this.float32[g+1]=c,this.float32[g+2]=d,e}}Tl.prototype.bytesPerElement=12,vi(Tl,"StructArrayLayout3f12");class ps extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,c,d,g)}emplace(e,n,c,d,g,_){const S=6*e,M=3*e;return this.uint16[S+0]=n,this.uint16[S+1]=c,this.uint16[S+2]=d,this.uint16[S+3]=g,this.float32[M+2]=_,e}}ps.prototype.bytesPerElement=12,vi(ps,"StructArrayLayout4ui1f12");class ll extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,c,d)}emplace(e,n,c,d,g){const _=4*e;return this.uint16[_+0]=n,this.uint16[_+1]=c,this.uint16[_+2]=d,this.uint16[_+3]=g,e}}ll.prototype.bytesPerElement=8,vi(ll,"StructArrayLayout4ui8");class gs extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,c,d,g,_)}emplace(e,n,c,d,g,_,S){const M=6*e;return this.int16[M+0]=n,this.int16[M+1]=c,this.int16[M+2]=d,this.int16[M+3]=g,this.int16[M+4]=_,this.int16[M+5]=S,e}}gs.prototype.bytesPerElement=12,vi(gs,"StructArrayLayout6i12");class Zh extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S,M,R,N,F,U){const W=this.length;return this.resize(W+1),this.emplace(W,e,n,c,d,g,_,S,M,R,N,F,U)}emplace(e,n,c,d,g,_,S,M,R,N,F,U,W){const Z=12*e;return this.int16[Z+0]=n,this.int16[Z+1]=c,this.int16[Z+2]=d,this.int16[Z+3]=g,this.uint16[Z+4]=_,this.uint16[Z+5]=S,this.uint16[Z+6]=M,this.uint16[Z+7]=R,this.int16[Z+8]=N,this.int16[Z+9]=F,this.int16[Z+10]=U,this.int16[Z+11]=W,e}}Zh.prototype.bytesPerElement=24,vi(Zh,"StructArrayLayout4i4ui4i24");class Kf extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,c,d,g,_)}emplace(e,n,c,d,g,_,S){const M=10*e,R=5*e;return this.int16[M+0]=n,this.int16[M+1]=c,this.int16[M+2]=d,this.float32[R+2]=g,this.float32[R+3]=_,this.float32[R+4]=S,e}}Kf.prototype.bytesPerElement=20,vi(Kf,"StructArrayLayout3i3f20");class hu extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,c,d)}emplace(e,n,c,d,g){const _=4*e;return this.float32[_+0]=n,this.float32[_+1]=c,this.float32[_+2]=d,this.float32[_+3]=g,e}}hu.prototype.bytesPerElement=16,vi(hu,"StructArrayLayout4f16");class Jf extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Jf.prototype.bytesPerElement=4,vi(Jf,"StructArrayLayout1ul4");class kl extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const d=2*e;return this.uint16[d+0]=n,this.uint16[d+1]=c,e}}kl.prototype.bytesPerElement=4,vi(kl,"StructArrayLayout2ui4");class fu extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S,M,R,N,F,U,W){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,n,c,d,g,_,S,M,R,N,F,U,W)}emplace(e,n,c,d,g,_,S,M,R,N,F,U,W,Z){const ee=20*e,ce=10*e;return this.int16[ee+0]=n,this.int16[ee+1]=c,this.int16[ee+2]=d,this.int16[ee+3]=g,this.int16[ee+4]=_,this.float32[ce+3]=S,this.float32[ce+4]=M,this.float32[ce+5]=R,this.float32[ce+6]=N,this.int16[ee+14]=F,this.uint32[ce+8]=U,this.uint16[ee+18]=W,this.uint16[ee+19]=Z,e}}fu.prototype.bytesPerElement=40,vi(fu,"StructArrayLayout5i4f1i1ul2ui40");class rh extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,c,d,g,_,S)}emplace(e,n,c,d,g,_,S,M){const R=8*e;return this.int16[R+0]=n,this.int16[R+1]=c,this.int16[R+2]=d,this.int16[R+4]=g,this.int16[R+5]=_,this.int16[R+6]=S,this.int16[R+7]=M,e}}rh.prototype.bytesPerElement=16,vi(rh,"StructArrayLayout3i2i2i16");class Qf extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,c,d,g)}emplace(e,n,c,d,g,_){const S=4*e,M=8*e;return this.float32[S+0]=n,this.float32[S+1]=c,this.float32[S+2]=d,this.int16[M+6]=g,this.int16[M+7]=_,e}}Qf.prototype.bytesPerElement=16,vi(Qf,"StructArrayLayout2f1f2i16");class Qm extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,c,d,g,_)}emplace(e,n,c,d,g,_,S){const M=20*e,R=5*e;return this.uint8[M+0]=n,this.uint8[M+1]=c,this.float32[R+1]=d,this.float32[R+2]=g,this.float32[R+3]=_,this.float32[R+4]=S,e}}Qm.prototype.bytesPerElement=20,vi(Qm,"StructArrayLayout2ub4f20");class Zr extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,c)}emplace(e,n,c,d){const g=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=c,this.uint16[g+2]=d,e}}Zr.prototype.bytesPerElement=6,vi(Zr,"StructArrayLayout3ui6");class Uu extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe,me,ve,Se,De){const Re=this.length;return this.resize(Re+1),this.emplace(Re,e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe,me,ve,Se,De)}emplace(e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe,me,ve,Se,De,Re){const $e=30*e,We=15*e,tt=60*e;return this.int16[$e+0]=n,this.int16[$e+1]=c,this.int16[$e+2]=d,this.float32[We+2]=g,this.float32[We+3]=_,this.uint16[$e+8]=S,this.uint16[$e+9]=M,this.uint32[We+5]=R,this.uint32[We+6]=N,this.uint32[We+7]=F,this.uint16[$e+16]=U,this.uint16[$e+17]=W,this.uint16[$e+18]=Z,this.float32[We+10]=ee,this.float32[We+11]=ce,this.uint8[tt+48]=oe,this.uint8[tt+49]=me,this.uint8[tt+50]=ve,this.uint32[We+13]=Se,this.int16[$e+28]=De,this.uint8[tt+58]=Re,e}}Uu.prototype.bytesPerElement=60,vi(Uu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ep extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe,me,ve,Se,De,Re,$e,We,tt,_t,nt,xt,Mt,Pt,Gt,Wt,Ut){const $t=this.length;return this.resize($t+1),this.emplace($t,e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe,me,ve,Se,De,Re,$e,We,tt,_t,nt,xt,Mt,Pt,Gt,Wt,Ut)}emplace(e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe,me,ve,Se,De,Re,$e,We,tt,_t,nt,xt,Mt,Pt,Gt,Wt,Ut,$t){const vt=20*e,yt=40*e,Vt=80*e;return this.float32[vt+0]=n,this.float32[vt+1]=c,this.int16[yt+4]=d,this.int16[yt+5]=g,this.int16[yt+6]=_,this.int16[yt+7]=S,this.int16[yt+8]=M,this.int16[yt+9]=R,this.int16[yt+10]=N,this.int16[yt+11]=F,this.int16[yt+12]=U,this.uint16[yt+13]=W,this.uint16[yt+14]=Z,this.uint16[yt+15]=ee,this.uint16[yt+16]=ce,this.uint16[yt+17]=oe,this.uint16[yt+18]=me,this.uint16[yt+19]=ve,this.uint16[yt+20]=Se,this.uint16[yt+21]=De,this.uint16[yt+22]=Re,this.uint16[yt+23]=$e,this.uint16[yt+24]=We,this.uint16[yt+25]=tt,this.uint16[yt+26]=_t,this.uint16[yt+27]=nt,this.uint32[vt+14]=xt,this.float32[vt+15]=Mt,this.float32[vt+16]=Pt,this.float32[vt+17]=Gt,this.float32[vt+18]=Wt,this.uint8[Vt+76]=Ut,this.uint16[yt+39]=$t,e}}ep.prototype.bytesPerElement=80,vi(ep,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class em extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,c,d,g,_)}emplace(e,n,c,d,g,_,S){const M=6*e;return this.float32[M+0]=n,this.float32[M+1]=c,this.float32[M+2]=d,this.float32[M+3]=g,this.float32[M+4]=_,this.float32[M+5]=S,e}}em.prototype.bytesPerElement=24,vi(em,"StructArrayLayout6f24");class Ed extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,c,d,g)}emplace(e,n,c,d,g,_){const S=5*e;return this.float32[S+0]=n,this.float32[S+1]=c,this.float32[S+2]=d,this.float32[S+3]=g,this.float32[S+4]=_,e}}Ed.prototype.bytesPerElement=20,vi(Ed,"StructArrayLayout5f20");class tp extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,c,d,g,_,S)}emplace(e,n,c,d,g,_,S,M){const R=7*e;return this.float32[R+0]=n,this.float32[R+1]=c,this.float32[R+2]=d,this.float32[R+3]=g,this.float32[R+4]=_,this.float32[R+5]=S,this.float32[R+6]=M,e}}tp.prototype.bytesPerElement=28,vi(tp,"StructArrayLayout7f28");class dg extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S,M,R,N,F){const U=this.length;return this.resize(U+1),this.emplace(U,e,n,c,d,g,_,S,M,R,N,F)}emplace(e,n,c,d,g,_,S,M,R,N,F,U){const W=11*e;return this.float32[W+0]=n,this.float32[W+1]=c,this.float32[W+2]=d,this.float32[W+3]=g,this.float32[W+4]=_,this.float32[W+5]=S,this.float32[W+6]=M,this.float32[W+7]=R,this.float32[W+8]=N,this.float32[W+9]=F,this.float32[W+10]=U,e}}dg.prototype.bytesPerElement=44,vi(dg,"StructArrayLayout11f44");class sh extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S,M,R){const N=this.length;return this.resize(N+1),this.emplace(N,e,n,c,d,g,_,S,M,R)}emplace(e,n,c,d,g,_,S,M,R,N){const F=9*e;return this.float32[F+0]=n,this.float32[F+1]=c,this.float32[F+2]=d,this.float32[F+3]=g,this.float32[F+4]=_,this.float32[F+5]=S,this.float32[F+6]=M,this.float32[F+7]=R,this.float32[F+8]=N,e}}sh.prototype.bytesPerElement=36,vi(sh,"StructArrayLayout9f36");class Dr extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const d=2*e;return this.float32[d+0]=n,this.float32[d+1]=c,e}}Dr.prototype.bytesPerElement=8,vi(Dr,"StructArrayLayout2f8");class br extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,c,d)}emplace(e,n,c,d,g){const _=6*e;return this.uint32[3*e+0]=n,this.uint16[_+2]=c,this.uint16[_+3]=d,this.uint16[_+4]=g,e}}br.prototype.bytesPerElement=12,vi(br,"StructArrayLayout1ul3ui12");class $u extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}$u.prototype.bytesPerElement=2,vi($u,"StructArrayLayout1ui2");class ip extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce)}emplace(e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe){const me=16*e;return this.float32[me+0]=n,this.float32[me+1]=c,this.float32[me+2]=d,this.float32[me+3]=g,this.float32[me+4]=_,this.float32[me+5]=S,this.float32[me+6]=M,this.float32[me+7]=R,this.float32[me+8]=N,this.float32[me+9]=F,this.float32[me+10]=U,this.float32[me+11]=W,this.float32[me+12]=Z,this.float32[me+13]=ee,this.float32[me+14]=ce,this.float32[me+15]=oe,e}}ip.prototype.bytesPerElement=64,vi(ip,"StructArrayLayout16f64");class tm extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,d,g,_,S){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,c,d,g,_,S)}emplace(e,n,c,d,g,_,S,M){const R=10*e,N=5*e;return this.uint16[R+0]=n,this.uint16[R+1]=c,this.uint16[R+2]=d,this.uint16[R+3]=g,this.float32[N+2]=_,this.float32[N+3]=S,this.float32[N+4]=M,e}}tm.prototype.bytesPerElement=20,vi(tm,"StructArrayLayout4ui3f20");class np extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}np.prototype.bytesPerElement=2,vi(np,"StructArrayLayout1i2");class im extends Ba{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}im.prototype.bytesPerElement=1,vi(im,"StructArrayLayout1ub1");class oh extends Yf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}oh.prototype.size=40;class ap extends fu{get(e){return new oh(this,e)}}vi(ap,"CollisionBoxArray");class nm extends Yf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}nm.prototype.size=60;class hg extends Uu{get(e){return new nm(this,e)}}vi(hg,"PlacedSymbolArray");class fg extends Yf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}fg.prototype.size=80;class am extends ep{get(e){return new fg(this,e)}}vi(am,"SymbolInstanceArray");class Xh extends wl{getoffsetX(e){return this.float32[1*e+0]}}vi(Xh,"GlyphOffsetArray");class rp extends Pc{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}vi(rp,"SymbolLineVertexArray");class sp extends Yf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sp.prototype.size=12;class rm extends br{get(e){return new sp(this,e)}}vi(rm,"FeatureIndexArray");class sm extends kl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}vi(sm,"FillExtrusionCentroidArray");class Yh extends Yf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Yh.prototype.size=6;class Kh extends nh{get(e){return new Yh(this,e)}}vi(Kh,"FillExtrusionWallArray");const op=Ln([{name:"a_pos",components:2,type:"Int16"}],4),o_=Ln([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),mu=Ln([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ir{constructor(e=[]){this.segments=e}_prepareSegment(e,n,c,d){let g=this.segments[this.segments.length-1];return e>ir.MAX_VERTEX_ARRAY_LENGTH&&mi(`Max vertices per segment is ${ir.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>ir.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:n,primitiveOffset:c,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}prepareSegment(e,n,c,d){return this._prepareSegment(e,n.length,c.length,d)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,c,d){return new ir([{vertexOffset:e,primitiveOffset:n,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}function lp(r,e){return 256*(r=ne(Math.floor(r),0,255))+ne(Math.floor(e),0,255)}ir.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vi(ir,"SegmentVector");const l_=Ln([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Vu=Ln([{name:"a_pattern_b",components:4,type:"Uint16"}]),c_=Ln([{name:"a_dash",components:4,type:"Uint16"}]);class Ad{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,c,d){this.ids.push(lh(e)),this.positions.push(n,c,d)}eachPosition(e,n){const c=lh(e);let d=0,g=this.ids.length-1;for(;d<g;){const _=d+g>>1;this.ids[_]>=c?g=_:d=_+1}for(;this.ids[d]===c;)n(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(e,n){const c=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Xr(c,d,0,c.length-1),n&&(n.add(c.buffer),n.add(d.buffer)),{ids:c,positions:d}}static deserialize(e){const n=new Ad;let c;n.ids=e.ids,n.positions=e.positions;for(const d of n.ids)d!==c&&n.uniqueIds.push(d),c=d;return n.indexed=!0,n}}function lh(r){const e=+r;return Number.isSafeInteger(e)?e:Ks(String(r))}function Xr(r,e,n,c){for(;n<c;){const d=r[n+c>>1];let g=n-1,_=c+1;for(;;){do g++;while(r[g]<d);do _--;while(r[_]>d);if(g>=_)break;cp(r,g,_),cp(e,3*g,3*_),cp(e,3*g+1,3*_+1),cp(e,3*g+2,3*_+2)}_-n<c-_?(Xr(r,e,n,_),n=_+1):(Xr(r,e,_+1,c),c=_)}}function cp(r,e,n){const c=r[e];r[e]=r[n],r[n]=c}vi(Ad,"FeaturePositionMap");class Hu{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class om extends Hu{constructor(e){super(e),this.current=0}set(e,n,c){this.fetchUniformLocation(e,n)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class Mr extends Hu{constructor(e){super(e),this.current=0}set(e,n,c){this.fetchUniformLocation(e,n)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Ao extends Hu{constructor(e){super(e),this.current=[0,0]}set(e,n,c){this.fetchUniformLocation(e,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class Jh extends Hu{constructor(e){super(e),this.current=[0,0,0]}set(e,n,c){this.fetchUniformLocation(e,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class lm extends Hu{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,c){this.fetchUniformLocation(e,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Gu extends Hu{constructor(e){super(e),this.current=ma.transparent.toPremultipliedRenderColor(null)}set(e,n,c){this.fetchUniformLocation(e,n)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const pu=new Float32Array(16);class Qh extends Hu{constructor(e){super(e),this.current=pu}set(e,n,c){if(this.fetchUniformLocation(e,n)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let d=1;d<16;d++)if(c[d]!==this.current[d]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const ef=new Float32Array(9),u_=new Float32Array(4);class tf extends Hu{constructor(e){super(e),this.current=u_}set(e,n,c){if(this.fetchUniformLocation(e,n)){for(let d=0;d<4;d++)if(c[d]!==this.current[d]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function cm(r){return[lp(255*r.r,255*r.g),lp(255*r.b,255*r.a)]}function Cd(r,e,n,c,d,g,_,S){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new Fa(0,{brightness:g,worldview:S}),e,n,d,c,_)==="none":r.value==="none")}class nf{constructor(e,n,c,d){this.value=e,this.uniformNames=n.map((g=>`u_${g}`)),this.type=c,this.context=d}setUniform(e,n,c,d,g){const _=d.constantOr(this.value);n.set(e,g,_ instanceof ma?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(e,n){return this.type==="color"?new Gu(e):new Mr(e)}}class El{constructor(e,n){this.uniformNames=n.map((c=>`u_${c}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,n){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=n?n.tl.concat(n.br):this.pattern}setUniform(e,n,c,d,g){let _=null;g!=="u_pattern"&&g!=="u_dash"||(_=this.pattern),g==="u_pattern_b"&&(_=this.patternTransition),g==="u_pixel_ratio"&&(_=this.pixelRatio),_&&n.set(e,g,_)}getBinding(e,n){return n==="u_pattern"||n==="u_pattern_b"||n==="u_dash"?new lm(e):new Mr(e)}}class Er{constructor(e,n,c,d){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map((g=>({name:`a_${g}`,type:"Float32",components:c==="color"?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(e,n,c,d,g,_,S,M){const R=this.paintVertexArray.length,N=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Fa(0,{brightness:_,worldview:M}),n,{},g,d,S):this.expression.kind==="constant"&&this.expression.value,F=Cd(this.lutExpression,n,{},d,g,_,S,M);this.paintVertexArray.resize(e),this._setPaintValue(R,e,N,F?null:this.context.lut)}updatePaintArray(e,n,c,d,g,_,S,M){const R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:S,worldview:M},c,d,void 0,g):this.expression.kind==="constant"&&this.expression.value,N=Cd(this.lutExpression,c,d,g,void 0,S,void 0,M);this._setPaintValue(e,n,R,N?null:this.context.lut)}_setPaintValue(e,n,c,d){if(this.type==="color"){const g=cm(c.toPremultipliedRenderColor(d));for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,g[0],g[1])}else{for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rc{constructor(e,n,c,d,g,_){this.expression=e,this.uniformNames=n.map((S=>`u_${S}_t`)),this.type=c,this.useIntegerZoom=d,this.context=g,this.maxValue=0,this.paintVertexAttributes=n.map((S=>({name:`a_${S}`,type:"Float32",components:c==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(e,n,c,d,g,_,S,M){const R=this.expression.evaluate(new Fa(this.context.zoom,{brightness:_,worldview:M}),n,{},g,d,S),N=this.expression.evaluate(new Fa(this.context.zoom+1,{brightness:_,worldview:M}),n,{},g,d,S),F=Cd(this.lutExpression,n,{},d,g,_,S,M),U=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(U,e,R,N,F?null:this.context.lut)}updatePaintArray(e,n,c,d,g,_,S,M){const R=this.expression.evaluate({zoom:this.context.zoom,brightness:S,worldview:M},c,d,void 0,g),N=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S,worldview:M},c,d,void 0,g),F=Cd(this.lutExpression,c,d,g,void 0,S,void 0,M);this._setPaintValue(e,n,R,N,F?null:this.context.lut)}_setPaintValue(e,n,c,d,g){if(this.type==="color"){const _=cm(c.toPremultipliedRenderColor(g)),S=cm(c.toPremultipliedRenderColor(g));for(let M=e;M<n;M++)this.paintVertexArray.emplace(M,_[0],_[1],S[0],S[1])}else{for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,c,d,g){const _=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,S=ne(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);n.set(e,g,S)}getBinding(e,n){return new Mr(e)}}class gu{constructor(e,n,c,d,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=(c==="array"?c_:l_).members;for(let _=0;_<n.length;++_);this.paintVertexArray=new d,this.paintTransitionVertexArray=new ll}populatePaintArray(e,n,c,d){const g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(g,e,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(e,n,c,d,g,_,S){this._setPaintValues(e,n,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(e,n,c,d){if(!d||!c)return;const g=d[c[0]],_=d[c[1]];if(g){if(g){const{tl:S,br:M,pixelRatio:R}=g;for(let N=e;N<n;N++)this.paintVertexArray.emplace(N,S[0],S[1],M[0],M[1],R)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:S,br:M}=_;for(let R=e;R<n;R++)this.paintTransitionVertexArray.emplace(R,S[0],S[1],M[0],M[1])}}}upload(e){const n=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,n)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Vu.members,n))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Yr{constructor(e,n,c=(()=>!0)){this.binders={},this._buffers=[],this.context=n;const d=[];for(const g in e.paint._values){const _=e.paint.get(g);if(g.endsWith("-use-theme")||!c(g)||!(_ instanceof Cc&&Jd(_.property.specification)))continue;const S=h_(g,e.type),M=_.value,R=_.property.specification.type,N=!!_.property.useIntegerZoom,F=g==="line-dasharray"||g.endsWith("pattern"),U=e.paint.get(`${g}-use-theme`),W=g==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||U&&U.value.kind!=="constant";if(M.kind!=="constant"||W)if(M.kind==="source"||W||F){const Z=Ic(g,R,"source");this.binders[g]=F?new gu(M,S,R,Z,e.id):new Er(M,S,R,Z),d.push(`/a_${g}`)}else{const Z=Ic(g,R,"composite");this.binders[g]=new Rc(M,S,R,N,n,Z),d.push(`/z_${g}`)}else this.binders[g]=F?new El(M.value,S):new nf(M.value,S,R,n),d.push(`/u_${g}`);U&&(this.binders[g].lutExpression=U.value)}this.cacheKey=d.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Er||n instanceof Rc?n.maxValue:0}populatePaintArrays(e,n,c,d,g,_,S,M){for(const R in this.binders){const N=this.binders[R];N.context=this.context,(N instanceof Er||N instanceof Rc||N instanceof gu)&&N.populatePaintArray(e,n,c,d,g,_,S,M)}}setConstantPatternPositions(e,n){for(const c in this.binders){const d=this.binders[c];d instanceof El&&d.setConstantPatternPositions(e,n)}}getPatternTransitionVertexBuffer(e){const n=this.binders[e];return n instanceof gu?n.paintTransitionVertexBuffer:null}updatePaintArrays(e,n,c,d,g,_,S,M,R,N){let F=!1;const U=Object.keys(e),W=U.length!==0&&!M,Z=W?U:n.uniqueIds;this.context.lut=g.lut;for(const ee in this.binders){const ce=this.binders[ee];if(ce.context=this.context,(ce instanceof Er||ce instanceof Rc||ce instanceof gu)&&ce.expression&&ce.expression.kind&&ce.expression.kind!=="constant"&&(ce.expression.isStateDependent===!0||ce.expression.isLightConstant===!1)){const oe=g.paint.get(ee);ce.expression=oe.value;for(const me of Z){const ve=e[me.toString()];n.eachPosition(me,((Se,De,Re)=>{const $e=d.feature(Se);ce.updatePaintArray(De,Re,$e,ve,_,S,R,N)}))}if(!W)for(const me of c.uniqueIds){const ve=e[me.toString()];c.eachPosition(me,((Se,De,Re)=>{const $e=d.feature(Se);ce.updatePaintArray(De,Re,$e,ve,_,S,R,N)}))}F=!0}}return F}defines(){const e=[];for(const n in this.binders){const c=this.binders[n];(c instanceof nf||c instanceof El)&&e.push(...c.uniformNames.map((d=>`#define HAS_UNIFORM_${d}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof nf||d instanceof El||d instanceof Rc)for(const g of d.uniformNames)n.push({name:g,property:c,binding:d.getBinding(e,g)})}return n}setUniforms(e,n,c,d,g){for(const{name:_,property:S,binding:M}of c)this.binders[S].setUniform(e,M,g,d.get(S),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Er||n instanceof Rc||n instanceof gu)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer),n instanceof gu&&n.paintTransitionVertexBuffer&&this._buffers.push(n.paintTransitionVertexBuffer)}}upload(e){for(const n in this.binders){const c=this.binders[n];(c instanceof Er||c instanceof Rc||c instanceof gu)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Er||n instanceof Rc||n instanceof gu)&&n.destroy()}}}class Lc{constructor(e,n,c=(()=>!0)){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new Yr(d,n,c);this.needsUpload=!1,this._featureMap=new Ad,this._featureMapWithoutIds=new Ad,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,c,d,g,_,S,M,R){for(const N in this.programConfigurations)this.programConfigurations[N].populatePaintArrays(e,n,d,g,_,S,M,R);n.id!==void 0?this._featureMap.add(n.id,c,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,c,d,g,_,S,M){for(const R of c)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,R,d,g,_,S||0,M)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const d_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function h_(r,e){return d_[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const is={"line-pattern":{source:ps,composite:ps},"fill-pattern":{source:ps,composite:ps},"fill-extrusion-pattern":{source:ps,composite:ps},"line-dasharray":{source:ll,composite:ll}},Al={color:{source:Dr,composite:hu},number:{source:wl,composite:Dr}};function Ic(r,e,n){const c=is[r];return c&&c[n]||Al[e][n]}vi(nf,"ConstantBinder"),vi(El,"PatternConstantBinder"),vi(Er,"SourceExpressionBinder"),vi(gu,"PatternCompositeBinder"),vi(Rc,"CompositeExpressionBinder"),vi(Yr,"ProgramConfiguration",{omit:["_buffers"]}),vi(Lc,"ProgramConfigurationSet");const io=Jt/Math.PI/2,Gl=5,up=6,mg=16383,fo=64,ql=[fo,32,16],Wl=-io,ns=io;function Md(r,e,n,c=io){return n=ui(n),[r*Math.sin(n)*c,-e*c,r*Math.cos(n)*c]}function Zl(r,e,n){return Md(Math.cos(ui(r)),Math.sin(ui(r)),e,n)}const m=63710088e-1,t=2*Math.PI*m;class o{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new o(ke(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,c=this.lat*n,d=e.lat*n,g=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((e.lng-this.lng)*n);return m*Math.acos(Math.min(g,1))}toBounds(e=0){const n=360*e/40075017,c=n/Math.cos(Math.PI/180*this.lat);return new p({lng:this.lng-c,lat:this.lat-n},{lng:this.lng+c,lat:this.lat+n})}toEcef(e){return Zl(this.lat,this.lng,io+e*io/m)}static convert(e){if(e instanceof o)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new o(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new o(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class p{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof o?new o(e.lng,e.lat):o.convert(e),this}setSouthWest(e){return this._sw=e instanceof o?new o(e.lng,e.lat):o.convert(e),this}extend(e){const n=this._sw,c=this._ne;let d,g;if(e instanceof o)d=e,g=e;else{if(!(e instanceof p))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(p.convert(e)):this.extend(o.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(o.convert(e)):this;if(d=e._sw,g=e._ne,!d||!g)return this}return n||c?(n.lng=Math.min(d.lng,n.lng),n.lat=Math.min(d.lat,n.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new o(d.lng,d.lat),this._ne=new o(g.lng,g.lat)),this}getCenter(){return new o((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o(this.getWest(),this.getNorth())}getSouthEast(){return new o(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:c}=o.convert(e);let d=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(e){if(e)return e instanceof p?e:new p(e)}}const x=0,T=25.5;function E(r){return t*Math.cos(r*Math.PI/180)}function j(r){return(180+r)/360}function O(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function B(r,e){return r/E(e)}function H(r){return 360*r-180}function K(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Y(r,e){return r*E(K(e))}const J=85.051129;function se(r){return Math.cos(ui(ne(r,-J,J)))}function ae(r,e){const n=ne(e,x,T),c=Math.pow(2,n);return se(r)*t/(512*c)}function he(r){return 1/Math.cos(r*Math.PI/180)}function de(r,e=0){const n=Math.exp(Math.PI*(1-(r.y+e/Jt)/(1<<r.z)*2));return 80150034*n/(n*n+1)/Jt/(1<<r.z)}class _e{constructor(e,n,c=0){this.x=+e,this.y=+n,this.z=+c}static fromLngLat(e,n=0){const c=o.convert(e);return new _e(j(c.lng),O(c.lat),B(n,c.lat))}toLngLat(){return new o(H(this.x),K(this.y))}toAltitude(){return Y(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/t*he(K(this.y))}}function we(r,e,n,c,d,g,_,S,M){const R=(e+c)/2,N=(n+d)/2,F=new Me(R,N);S(F),(function(U,W,Z,ee,ce,oe){const me=Z-ce,ve=ee-oe;return Math.abs((ee-W)*me-(Z-U)*ve)/Math.hypot(me,ve)})(F.x,F.y,g.x,g.y,_.x,_.y)>=M?(we(r,e,n,R,N,g,F,S,M),we(r,R,N,c,d,F,_,S,M)):r.push(_)}function ye(r,e,n){let c=r[0],d=c.x,g=c.y;e(c);const _=[c];for(let S=1;S<r.length;S++){const M=r[S],{x:R,y:N}=M;e(M),we(_,d,g,R,N,c,M,e,n),d=R,g=N,c=M}return _}function Pe(r,e,n,c){if(c(e,n)){const d=e.add(n)._mult(.5);Pe(r,e,d,c),Pe(r,d,n,c)}else r.push(n)}function Ae(r,e){let n=r[0];const c=[n];for(let d=1;d<r.length;d++){const g=r[d];Pe(c,n,g,e),n=g}return c}const Ie=Math.pow(2,14)-1,je=-Ie-1;function Ce(r,e){const n=Math.round(r.x*e),c=Math.round(r.y*e);return r.x=ne(n,je,Ie),r.y=ne(c,je,Ie),(n<r.x||n>r.x+1||c<r.y||c>r.y+1)&&mi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Ge(r,e,n){const c=r.loadGeometry(),d=r.extent,g=Jt/d;if(e&&n&&n.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:S,x:M,y:R,projection:N}=n,F=U=>{const W=H((e.x+U.x/d)/_),Z=K((e.y+U.y/d)/_),ee=N.project(W,Z);U.x=(ee.x*S-M)*d,U.y=(ee.y*S-R)*d};for(let U=0;U<c.length;U++)if(r.type!==1)c[U]=ye(c[U],F,1);else{const W=[];for(const Z of c[U])Z.x<0||Z.x>=d||Z.y<0||Z.y>=d||(F(Z),W.push(Z));c[U]=W}}for(const _ of c)for(const S of _)Ce(S,g);return c}function it(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Ge(r):[]}}class Ke{constructor(e,n,c,d,g){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=g,e.readFields(ht,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,c=[];let d,g=1,_=0,S=0,M=0;for(;e.pos<n;){if(_<=0){const R=e.readVarint();g=7&R,_=R>>3}if(_--,g===1||g===2)S+=e.readSVarint(),M+=e.readSVarint(),g===1&&(d&&c.push(d),d=[]),d&&d.push(new Me(S,M));else{if(g!==7)throw new Error(`unknown command ${g}`);d&&d.push(d[0].clone())}}return d&&c.push(d),c}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let c=1,d=0,g=0,_=0,S=1/0,M=-1/0,R=1/0,N=-1/0;for(;e.pos<n;){if(d<=0){const F=e.readVarint();c=7&F,d=F>>3}if(d--,c===1||c===2)g+=e.readSVarint(),_+=e.readSVarint(),g<S&&(S=g),g>M&&(M=g),_<R&&(R=_),_>N&&(N=_);else if(c!==7)throw new Error(`unknown command ${c}`)}return[S,R,M,N]}toGeoJSON(e,n,c){const d=this.extent*Math.pow(2,c),g=this.extent*e,_=this.extent*n,S=this.loadGeometry();function M(U){return[360*(U.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(U.y+_)/d)*Math.PI))-90]}function R(U){return U.map(M)}let N;if(this.type===1){const U=[];for(const Z of S)U.push(Z[0]);const W=R(U);N=U.length===1?{type:"Point",coordinates:W[0]}:{type:"MultiPoint",coordinates:W}}else if(this.type===2){const U=S.map(R);N=U.length===1?{type:"LineString",coordinates:U[0]}:{type:"MultiLineString",coordinates:U}}else{if(this.type!==3)throw new Error("unknown feature type");{const U=(function(Z){const ee=Z.length;if(ee<=1)return[Z];const ce=[];let oe,me;for(let ve=0;ve<ee;ve++){const Se=mt(Z[ve]);Se!==0&&(me===void 0&&(me=Se<0),me===Se<0?(oe&&ce.push(oe),oe=[Z[ve]]):oe&&oe.push(Z[ve]))}return oe&&ce.push(oe),ce})(S),W=[];for(const Z of U)W.push(Z.map(R));N=W.length===1?{type:"Polygon",coordinates:W[0]}:{type:"MultiPolygon",coordinates:W}}}const F={type:"Feature",geometry:N,properties:this.properties};return this.id!=null&&(F.id=this.id),F}}function ht(r,e,n){r===1?e.id=n.readVarint():r===2?(function(c,d){const g=c.readVarint()+c.pos;for(;c.pos<g;){const _=d._keys[c.readVarint()],S=d._values[c.readVarint()];d.properties[_]=S}})(n,e):r===3?e.type=n.readVarint():r===4&&(e._geometry=n.pos)}function mt(r){let e=0;for(let n,c,d=0,g=r.length,_=g-1;d<g;_=d++)n=r[d],c=r[_],e+=(c.x-n.x)*(n.y+c.y);return e}Ke.types=["Unknown","Point","LineString","Polygon"];class kt{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Ot,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Ke(this._pbf,n,this.extent,this._keys,this._values)}}function Ot(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push((function(c){let d=null;const g=c.readVarint()+c.pos;for(;c.pos<g;){const _=c.readVarint()>>3;d=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(n))}class ot{constructor(e,n){this.layers=e.readFields(Ye,{},n)}}function Ye(r,e,n){if(r===3){const c=new kt(n,n.readVarint()+n.pos);c.length&&(e[c.name]=c)}}const gt="3d_elevation_id",ft="level";class Nt{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,n){return this._valid&&e(n(this._geometry)),this}require(e,n,c){return this.get(e,!0,n,c)}optional(e,n,c){return this.get(e,!1,n,c)}success(){return this._valid}get(e,n,c,d){const g=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?c(d?d(g):g):n&&(this._valid=!1),this}}class ai{constructor(e,n){this.featureFunc=e,this.vertexFunc=n}parseFeature(e,n,c){return this.featureFunc(e,n,c)}parseVertex(e,n,c){return this.vertexFunc(e,n,c)}}const gi=new ai(((r,e,n)=>r.reset(e).require(gt,(c=>{n.id=c})).optional("fixed_height_relative",(c=>{n.constantHeight=c}),zt.decodeRelativeHeight).geometry((c=>{n.bounds=c}),zs).success()),((r,e,n)=>r.reset(e).require(gt,(c=>{n.id=c})).require("elevation_idx",(c=>{n.idx=c})).require("extent",(c=>{n.extent=c})).require("height_relative",(c=>{n.height=c}),zt.decodeRelativeHeight).geometry((c=>{n.position=c}),zt.getPoint).success())),Yt=new ai(((r,e,n)=>r.reset(e).require(gt,(c=>{n.id=c})).optional("fixed_height",(c=>{n.constantHeight=c}),zt.decodeMetricHeight).geometry((c=>{n.bounds=c}),zs).success()),((r,e,n)=>r.reset(e).require(gt,(c=>{n.id=c})).require("elevation_idx",(c=>{n.idx=c})).require("extent",(c=>{n.extent=c})).require("height",(c=>{n.height=c}),zt.decodeMetricHeight).geometry((c=>{n.position=c}),zt.getPoint).success()));class zt{static getPoint(e){return Ir(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Yt:void 0:gi}static parse(e){const n=[],c=[],d=e.length,g=new Nt;for(let _=0;_<d;_++){const S=e.feature(_),M=S.properties.version,R=zt.getVersionSchema(M);if(R===void 0){mi(`Unknown elevation feature version number ${M||"(unknown)"}`);continue}const N=S.properties.type;if(!N)continue;const F=Ke.types[S.type];if(F==="Point"&&N==="curve_point"){const U={};R.parseVertex(g,S,U)&&n.push(U)}else if(F==="Polygon"&&N==="curve_meta"){const U={};R.parseFeature(g,S,U)&&c.push(U)}}return{vertices:n,features:c}}}class ki{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,c){const d=go(n,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1])/d;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,!0}}class wi{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,c){const d=sn(n,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/d;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,n,c){if((function(W,Z){var ee=W[0],ce=W[1],oe=W[2],me=Z[0],ve=Z[1],Se=Z[2];return Math.abs(ee-me)<=C*Math.max(1,Math.abs(ee),Math.abs(me))&&Math.abs(ce-ve)<=C*Math.max(1,Math.abs(ce),Math.abs(ve))&&Math.abs(oe-Se)<=C*Math.max(1,Math.abs(oe),Math.abs(Se))})(this.pos,e)||n===0)return c[0]=c[1]=c[2]=0,!1;const[d,g,_]=this.dir,S=this.pos[0]-e[0],M=this.pos[1]-e[1],R=this.pos[2]-e[2],N=d*d+g*g+_*_,F=2*(S*d+M*g+R*_),U=F*F-4*N*(S*S+M*M+R*R-n*n);if(U<0){const W=Math.max(-F/2,0),Z=S+d*W,ee=M+g*W,ce=R+_*W,oe=Math.hypot(Z,ee,ce);return c[0]=Z*n/oe,c[1]=ee*n/oe,c[2]=ce*n/oe,!1}{const W=(-F-Math.sqrt(U))/(2*N);if(W<0){const Z=Math.hypot(S,M,R);return c[0]=S*n/Z,c[1]=M*n/Z,c[2]=R*n/Z,!1}return c[0]=S+d*W,c[1]=M+g*W,c[2]=R+_*W,!0}}}class di{constructor(e,n,c,d,g){this.TL=e,this.TR=n,this.BR=c,this.BL=d,this.horizon=g}static fromInvProjectionMatrix(e,n,c){const d=[-1,1,1],g=[1,1,1],_=[1,-1,1],S=[-1,-1,1],M=Ii(d,d,e),R=Ii(g,g,e),N=Ii(_,_,e),F=Ii(S,S,e);return new di(M,R,N,F,n/c)}}function yi(r,e,n){let c=1/0,d=-1/0;const g=[];for(const _ of r){Da(g,_,e);const S=sn(g,n);c=Math.min(c,S),d=Math.max(d,S)}return[c,d]}function $i(r,e){let n=!0;for(let c=0;c<r.planes.length;c++){const d=r.planes[c];let g=0;for(let _=0;_<e.length;_++)g+=+(sn(d,e[_])+d[3]>=0);if(g===0)return 0;g!==e.length&&(n=!1)}return n?2:1}function hn(r,e){for(const n of r.projections){const c=yi(e,r.points[0],n.axis);if(n.projection[1]<c[0]||n.projection[0]>c[1])return 0}return 1}function In(r,e){let n=0;const c=[0,0,0,0];for(let _=0;_<r.length;_++)c[0]=r[_][0],c[1]=r[_][1],c[2]=r[_][2],c[3]=1,(d=c)[0]*(g=e)[0]+d[1]*g[1]+d[2]*g[2]+d[3]*g[3]>=0&&n++;var d,g;return n}class ea{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Si.fromPoints(this.points),this.projections=[],this.frustumEdges=[Da([],this.points[2],this.points[3]),Da([],this.points[0],this.points[3]),Da([],this.points[4],this.points[0]),Da([],this.points[5],this.points[1]),Da([],this.points[6],this.points[2]),Da([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const d=[0,-c[2],c[1]],g=[c[2],0,-c[0]];this.projections.push({axis:d,projection:yi(this.points,this.points[0],d)}),this.projections.push({axis:g,projection:yi(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(e,n,c,d){const g=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((R=>{const N=Hr([],R,e),F=1/N[3]/n*g;return(U=N)[0]=(W=N)[0]*(Z=[F,F,d?1/N[3]:F,F])[0],U[1]=W[1]*Z[1],U[2]=W[2]*Z[2],U[3]=W[3]*Z[3],U;var U,W,Z})),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((R=>{const N=pn([],Un([],Da([],_[R[0]],_[R[1]]),Da([],_[R[2]],_[R[1]]))),F=-sn(N,_[R[1]]);return N.concat(F)})),M=[];for(let R=0;R<_.length;R++)M.push([_[R][0],_[R][1],_[R][2]]);return new ea(M,S)}intersectsPrecise(e,n,c){for(let d=0;d<n.length;d++)if(!In(e,n[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!In(e,this.planes[d]))return 0;for(const d of c)for(const g of this.frustumEdges){const _=Un([],d,g),S=Pi(_);if(S===0)continue;Ft(_,_,1/S);const M=yi(this.points,this.points[0],_),R=yi(e,this.points[0],_);if(M[0]>R[1]||R[0]>M[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const c=n[3];if(sn([n[0],n[1],n[2]],e)+c<0)return!1}return!0}}class Si{static fromPoints(e){const n=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const d of e)St(n,n,d),Ht(c,c,d);return new Si(n,c)}static fromTileIdAndHeight(e,n,c){const d=1<<e.canonical.z,g=e.canonical.x,_=e.canonical.y;return new Si([g/d,_/d,n],[(g+1)/d,(_+1)/d,c])}static applyTransform(e,n){const c=e.getCorners();for(let d=0;d<c.length;++d)Ii(c[d],c[d],n);return Si.fromPoints(c)}static applyTransformFast(e,n){const c=[n[12],n[13],n[14]],d=[...c];for(let g=0;g<3;g++)for(let _=0;_<3;_++){const S=n[4*_+g],M=S*e.min[_],R=S*e.max[_];c[g]+=Math.min(M,R),d[g]+=Math.max(M,R)}return new Si(c,d)}static projectAabbCorners(e,n){const c=e.getCorners();for(let d=0;d<c.length;++d)Ii(c[d],c[d],n);return c}constructor(e,n){this.min=e,this.max=n,this.center=Ft([],Ct([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],c=Di(this.min),d=Di(this.max);for(let g=0;g<n.length;g++)c[g]=n[g]?this.min[g]:this.center[g],d[g]=n[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new Si(c,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?$i(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?$i(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?hn(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?hn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}vi(Si,"Aabb");class ta{constructor(e,n){this.feature=e,this.metersToTile=n,this.index=0}get(){const e=this.feature.vertices[this.index],n=this.feature.vertexProps[this.index].dir,c=n[1],d=-n[0],g=(e.extent+1)*this.metersToTile;return[new Me(Math.trunc(e.position[0]+c*g),Math.trunc(e.position[1]+d*g)),new Me(Math.trunc(e.position[0]-c*g),Math.trunc(e.position[1]-d*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Zi{constructor(e,n,c,d,g,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[vr(),vr(),vr(),vr(),vr(),vr(),vr()],this.id=e,this.heightRange={min:c,max:c},this.safeArea=n,this.constantHeight=c,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=g,this.edges=this.edges.filter((S=>{return S.a<this.vertices.length&&S.b<this.vertices.length&&!((M=this.vertices[S.a].position)[0]===(R=this.vertices[S.b].position)[0]&&M[1]===R[1]);var M,R})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const S of this.vertices)this.vertexProps.push({dir:Ir(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,S.height),this.heightRange.max=Math.max(this.heightRange.max,S.height);for(const S of this.edges){const M=this.vertices[S.a].position,R=this.vertices[S.b].position,N=po(vr(),R,M),F=Ws(N),U=Jo(vr(),N,1/F);this.edgeProps.push({vec:N,dir:U,len:F});const W=this.vertexProps[S.a].dir,Z=this.vertexProps[S.b].dir;Ss(W,W,U),Ss(Z,Z,U)}for(const S of this.vertexProps)S.dir[0]===0&&S.dir[1]===0||tc(S.dir,S.dir);this.tessellate(_)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const n=this.getClosestEdge(e);if(n==null)return 0;const[c,d]=n;return Gi(this.vertices[this.edges[c].a].height,this.vertices[this.edges[c].b].height,d)}computeSlopeNormal(e,n){const c=this.getClosestEdge(e);if(!c)return qe(0,0,1);const d=c[0],g=this.edges[d],_=this.edgeProps[d].vec,S=qe(_[0],_[1],(this.vertices[g.b].height-this.vertices[g.a].height)*n),M=qe(S[1],-S[0],0);Un(M,M,S);const R=Pi(M);return R>0?Ft(M,M,1/R):wt(M,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let n=0,c=Number.POSITIVE_INFINITY,d=0;const[g,_,S,M,R,N,F]=this._tmpVec2;ec(F,e.x,e.y);const U=new ki(F,null);for(let W=0;W<this.edges.length;W++){const Z=this.edges[W],ee=this.edgeProps[W].dir;U.dir=ee;const ce=this.vertices[Z.a].position,oe=this.vertices[Z.b].position,me=U.intersectsPlane(ce,this.vertexProps[Z.a].dir,g),ve=U.intersectsPlane(oe,this.vertexProps[Z.b].dir,_);if(!me||!ve)continue;po(S,_,g),po(M,F,g);const Se=go(S,S),De=Se>0?go(M,S)/Se:0,Re=ne(De,0,1),$e=Math.abs((De-Re)*this.edgeProps[W].len);po(R,F,ce),ec(N,ee[1],-ee[0]);const We=$e+Math.abs(go(R,N));We<c&&(n=W,c=We,d=Re)}return[n,d]}tessellate(e){const n=jt(),c=jt(),d=jt(),g=jt();for(let _=this.edges.length-1;_>=0;--_){const S=this.edges[_].a,M=this.edges[_].b,{position:R,height:N,extent:F}=this.vertices[S],{position:U,height:W,extent:Z}=this.vertices[M],ee=this.vertexProps[S].dir,ce=this.vertexProps[M].dir;if(wt(n,R[0]/e,R[1]/e,N),wt(c,U[0]/e,U[1]/e,W),wt(d,ee[1],-ee[0],0),Ft(d,d,F),wt(g,ce[1],-ce[0],0),Ft(g,g,Z),this.distSqLines(qe(n[0]+.5*d[0],n[1]+.5*d[1],n[2]+.5*d[2]),qe(c[0]-.5*g[0],c[1]-.5*g[1],c[2]-.5*g[2]),qe(n[0]-.5*d[0],n[1]-.5*d[1],n[2]-.5*d[2]),qe(c[0]+.5*g[0],c[1]+.5*g[1],c[2]+.5*g[2]))<=.0025000000000000005)continue;const oe=this.vertices.length,me=Ss(vr(),R,U);this.vertices.push({position:Jo(me,me,.5),height:.5*(N+W),extent:.5*(F+Z)});const ve=Ss(vr(),ee,ce);this.vertexProps.push({dir:tc(ve,ve)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:S,b:oe}),this.edges.push({a:oe,b:M});const Se=po(vr(),this.vertices[oe].position,R),De=Ws(Se),Re={vec:Se,dir:Jo(vr(),Se,1/De),len:De};this.edgeProps.push(Re),this.edgeProps.push(Re)}}distSqLines(e,n,c,d){const g=Vi(jt(),n,e),_=Vi(jt(),d,c),S=Vi(jt(),e,c),M=sn(g,g),R=sn(g,_),N=sn(g,S),F=sn(_,_),U=sn(_,S),W=M*F-R*R;if(W===0)return Xt(Ui(g,c,d,sn(S,_)/sn(_,_)),e);const Z=(M*U-R*N)/W;return Xt(Ui(g,e,n,(R*U-N*F)/W),Ui(_,c,d,Z))}}class ua{static parseFrom(e,n){const c=zt.parse(e);if(!c)return[];let{vertices:d,features:g}=c;const _=1/de(n);g.sort(((N,F)=>N.id-F.id)),d.sort(((N,F)=>N.id-F.id||N.idx-F.idx)),d=d.filter(((N,F,U)=>F===U.findIndex((W=>W.id===N.id&&W.idx===N.idx))));const S=new Array;let M=0;const R=d.length;for(const N of g){if(N.constantHeight){S.push(new Zi(N.id,N.bounds,N.constantHeight));continue}for(;M!==R&&d[M].id<N.id;)M++;if(M===R||d[M].id!==N.id)continue;const F=new Array,U=new Array,W=M;for(;M!==R&&d[M].id===N.id;){const Z=d[M];if(F.push({position:Z.position,height:Z.height,extent:Z.extent}),M!==W&&d[M-1].idx===Z.idx-1){const ee=M-W;U.push({a:ee-1,b:ee})}M++}S.push(new Zi(N.id,N.bounds,void 0,F,U,_))}return S}static getElevationFeature(e,n){if(!n)return;const c=+e.properties[gt];return Number.isNaN(c)?void 0:n.find((d=>d.id===c))}}class va{constructor(e,n){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(n)||(this.zScale=Math.pow(2,n.z-e.z),this.xOffset=(e.x*this.zScale-n.x)*Jt,this.yOffset=(e.y*this.zScale-n.y)*Jt)}constantElevation(e,n){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,n)}pointElevation(e,n,c){const d=this.constantElevation(n,c);return d??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(n.pointElevation(e),c))}computeBiasedHeight(e,n){return n<=0?e:e+n*ue(0,n,e>=0?e:Math.abs(.5*e))}}vi(Zi,"ElevationFeature");class xa{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Pc,this.indexArray=new Zr,this.segments=new ir,this.programConfigurations=new Lc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new wl),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,d){}populate(e,n,c,d){const g=this.layers[0],_=[];let S=null;g.type==="circle"&&(S=g.layout.get("circle-sort-key"));for(const{feature:R,id:N,index:F,sourceLayerIndex:U}of e){const W=this.layers[0]._featureFilter.needGeometry,Z=it(R,W);if(!this.layers[0]._featureFilter.filter(new Fa(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),Z,c))continue;const ee=S?S.evaluate(Z,{},c):void 0,ce={id:N,properties:R.properties,type:R.type,sourceLayerIndex:U,index:F,geometry:W?Z.geometry:Ge(R,c,d),patterns:{},sortKey:ee};_.push(ce)}S&&_.sort(((R,N)=>R.sortKey-N.sortKey));let M=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new gs,M=d.projection);for(const R of _){const{geometry:N,index:F,sourceLayerIndex:U}=R,W=e[F].feature;this.addFeature(R,N,F,n.availableImages,c,M,n.brightness,n.elevationFeatures),n.featureIndex.insert(W,N,F,U,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,n,c,d,g,_,S){this.programConfigurations.updatePaintArrays(e,n,g,c,d,_,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,op.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,mu.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,o_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,n,c,d,g,_,S,M){let R;this.elevationMode!=="none"&&(R=ua.getElevationFeature(e,M));for(const N of n)for(const F of N){const U=F.x,W=F.y;if(U<0||U>=Jt||W<0||W>=Jt)continue;if(_){const ce=_.projectTilePoint(U,W,g),oe=_.upVector(g,U,W);this.addGlobeExtVertex(ce,oe),this.addGlobeExtVertex(ce,oe),this.addGlobeExtVertex(ce,oe),this.addGlobeExtVertex(ce,oe)}const Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ee=Z.vertexLength;if(this.addCircleVertex(U,W,-1,-1),this.addCircleVertex(U,W,1,-1),this.addCircleVertex(U,W,1,1),this.addCircleVertex(U,W,-1,1),this.elevationMode!=="none"){const ce=R?R.pointElevation(new Me(U,W)):0;this.hasElevation=this.hasElevation||ce!==0;for(let oe=0;oe<4;oe++)this.elevatedLayoutVertexArray.emplaceBack(ce)}this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+2,ee+3),Z.vertexLength+=4,Z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},d,g,S,void 0,this.worldview)}addCircleVertex(e,n,c,d){this.layoutVertexArray.emplaceBack(2*e+(c+1)/2,2*n+(d+1)/2)}addGlobeExtVertex(e,n){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}}function Nn(r,e){for(let n=0;n<r.length;n++)if(Ra(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Ra(r,e[n]))return!0;return!!Ya(r,e)}function _n(r,e,n){return!!Ra(r,e)||!!Ua(e,r,n)}function na(r,e){if(r.length===1)return cr(e,r[0]);for(let n=0;n<e.length;n++){const c=e[n];for(let d=0;d<c.length;d++)if(Ra(r,c[d]))return!0}for(let n=0;n<r.length;n++)if(cr(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Ya(r,e[n]))return!0;return!1}function Ga(r,e,n){if(r.length>1){if(Ya(r,e))return!0;for(let c=0;c<e.length;c++)if(Ua(e[c],r,n))return!0}for(let c=0;c<r.length;c++)if(Ua(r[c],e,n))return!0;return!1}function Ya(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){const c=r[n],d=r[n+1];for(let g=0;g<e.length-1;g++)if(da(c,d,e[g],e[g+1]))return!0}return!1}function da(r,e,n,c){return tn(r,n,c)!==tn(e,n,c)&&tn(r,e,n)!==tn(r,e,c)}function Xn(r,e,n){return(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x)}function xn(r,e,n,c){const d=Xn(r,e,c),g=Xn(r,e,n);if(Math.sign(d)===Math.sign(g))return;const _=Xn(n,c,r),S=_+g-d;return Math.sign(_)!==Math.sign(S)?[_/(_-S),g/(g-d)]:void 0}function Ua(r,e,n){const c=n*n;if(e.length===1)return r.distSqr(e[0])<c;for(let d=1;d<e.length;d++)if(kr(r,e[d-1],e[d])<c)return!0;return!1}function kr(r,e,n){const c=e.distSqr(n);if(c===0)return r.distSqr(e);const d=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/c;return r.distSqr(d<0?e:d>1?n:n.sub(e)._mult(d)._add(e))}function cr(r,e){let n,c,d,g=!1;for(let _=0;_<r.length;_++){n=r[_];for(let S=0,M=n.length-1;S<n.length;M=S++)c=n[S],d=n[M],c.y>e.y!=d.y>e.y&&e.x<(d.x-c.x)*(e.y-c.y)/(d.y-c.y)+c.x&&(g=!g)}return g}function Ra(r,e){let n=!1;for(let c=0,d=r.length-1;c<r.length;d=c++){const g=r[c],_=r[d];g.y>e.y!=_.y>e.y&&e.x<(_.x-g.x)*(e.y-g.y)/(_.y-g.y)+g.x&&(n=!n)}return n}function Co(r,e,n,c,d){for(const _ of r)if(e<=_.x&&n<=_.y&&c>=_.x&&d>=_.y)return!0;const g=[new Me(e,n),new Me(e,d),new Me(c,d),new Me(c,n)];if(r.length>2){for(const _ of g)if(Ra(r,_))return!0}for(let _=0;_<r.length-1;_++)if(Ns(r[_],r[_+1],g))return!0;return!1}function Ns(r,e,n){const c=n[0],d=n[2];if(r.x<c.x&&e.x<c.x||r.x>d.x&&e.x>d.x||r.y<c.y&&e.y<c.y||r.y>d.y&&e.y>d.y)return!1;const g=tn(r,e,n[0]);return g!==tn(r,e,n[1])||g!==tn(r,e,n[2])||g!==tn(r,e,n[3])}function Ar(r,e,n,c,d,g){let _=e.y-r.y,S=r.x-e.x;if(g=g||0){const M=_*_+S*S;if(M===0)return!0;const R=Math.sqrt(M);_/=R,S/=R}return!((n.x-r.x)*_+(n.y-r.y)*S-g<0||(c.x-r.x)*_+(c.y-r.y)*S-g<0||(d.x-r.x)*_+(d.y-r.y)*S-g<0)}function ks(r,e,n,c,d,g,_){return!(Ar(r,e,c,d,g,_)||Ar(e,n,c,d,g,_)||Ar(n,r,c,d,g,_)||Ar(c,d,r,e,n,_)||Ar(d,g,r,e,n,_)||Ar(g,c,r,e,n,_))}function no(r,e,n){const c=e.paint.get(r).value;return c.kind==="constant"?c.value:n.programConfigurations.get(e.id).getMaxValue(r)}function Es(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Cl(r,e,n,c,d){if(!e[0]&&!e[1])return r;const g=Me.convert(e)._mult(d);n==="viewport"&&g._rotate(-c);const _=[];for(let S=0;S<r.length;S++)_.push(r[S].sub(g));return _}function Xl(r,e,n,c){const d=Me.convert(r)._mult(c);return e==="viewport"&&d._rotate(-n),d}let Vo,hr;function _r(r,e,n){var c=2*Math.PI*6378137/256/Math.pow(2,n);return[r*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}vi(xa,"CircleBucket",{omit:["layers"]});class Ca{constructor(e,n,c){this.z=e,this.x=n,this.y=c,this.key=nr(0,e,e,n,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const n=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>n&&e.y===this.y>>n}url(e,n){const c=(function(g,_,S){var M=_r(256*g,256*(_=Math.pow(2,S)-_-1),S),R=_r(256*(g+1),256*(_+1),S);return M[0]+","+M[1]+","+R[0]+","+R[1]})(this.x,this.y,this.z),d=(function(g,_,S){let M,R="";for(let N=g;N>0;N--)M=1<<N-1,R+=(_&M?1:0)+(S&M?2:0);return R})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pr{constructor(e,n){this.wrap=e,this.canonical=n,this.key=nr(e,n.z,n.z,n.x,n.y)}}class Fn{constructor(e,n,c,d,g){this.overscaledZ=e,this.wrap=n,this.canonical=new Ca(c,+d,+g),this.key=n===0&&e===c?this.canonical.key:nr(n,e,c,d,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Fn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return nr(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-e;return nr(this.wrap*+n,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Fn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new Fn(n,this.wrap,n,c,d),new Fn(n,this.wrap,n,c+1,d),new Fn(n,this.wrap,n,c,d+1),new Fn(n,this.wrap,n,c+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Fn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Fn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function nr(r,e,n,c,d){const g=1<<Math.min(n,22);let _=g*(d%g)+c%g;return r&&n<22&&(_+=g*g*((r<0?-2*r-1:2*r)%(1<<2*(22-n)))),16*(32*_+n)+(e-n)}const cc=[r=>{let e=r.canonical.x-1,n=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,n--),new Fn(r.overscaledZ,n,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,n=r.wrap;return e===1<<r.canonical.z&&(e=0,n++),new Fn(r.overscaledZ,n,r.canonical.z,e,r.canonical.y)},r=>new Fn(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new Fn(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];vi(Ca,"CanonicalTileID"),vi(Fn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const af=Ln([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:zc}=af,um=Ln([{name:"a_pos_3",components:3,type:"Int16"}]);var rf=Ln([{name:"a_pos",type:"Int16",components:2}]);function Yl(r){return r*io/m}const Ml=[new Si([Wl,Wl,Wl],[ns,ns,ns]),new Si([Wl,Wl,Wl],[0,0,ns]),new Si([0,Wl,Wl],[ns,0,ns]),new Si([Wl,0,Wl],[0,ns,ns]),new Si([0,0,Wl],[ns,ns,ns])];function Pd(r,e,n,c=!0){const d=Ft([],r._camera.position,r.worldSize),g=[e,n,1,1];Hr(g,g,r.pixelMatrixInverse),ws(g,g,1/g[3]);const _=pn([],Da([],g,d)),S=r.globeMatrix,M=[S[12],S[13],S[14]],R=Da([],M,d),N=Pi(R),F=pn([],R),U=r.worldSize/(2*Math.PI),W=sn(F,_),Z=Math.asin(U/N);if(Z<Math.acos(W)){if(!c)return null;const _t=[],nt=[];Ft(_t,_,N/W),pn(nt,Da(nt,_t,R)),pn(_,Ct(_,R,Ft(_,nt,Math.tan(Z)*N)))}const ee=[];new wi(d,_).closestPointOnSphere(M,U,ee);const ce=pn([],Ea(S,0)),oe=pn([],Ea(S,1)),me=pn([],Ea(S,2)),ve=sn(ce,ee),Se=sn(oe,ee),De=sn(me,ee),Re=Wi(Math.asin(-Se/U));let $e=Wi(Math.atan2(ve,De));$e=r.center.lng+(function(_t,nt){const xt=(nt-_t+180)%360-180;return xt<-180?xt+360:xt})(r.center.lng,$e);const We=j($e),tt=ne(O(Re),0,1);return new _e(We,tt)}class Dc{constructor(e,n,c){this.a=Da([],e,c),this.b=Da([],n,c),this.center=c;const d=pn([],this.a),g=pn([],this.b);this.angle=Math.acos(sn(d,g))}}function Oc(r,e){if(r.angle===0)return null;let n;return n=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),n<0||n>1?null:(function(c,d,g,_){const S=Math.sin(g);return c*(Math.sin((1-_)*g)/S)+d*(Math.sin(_*g)/S)})(r.a[e],r.b[e],r.angle,ne(n,0,1))+r.center[e]}function Mo(r){if(r.z<=1)return Ml[r.z+2*r.y+r.x];const e=f_(pg(r));return Si.fromPoints(e)}function mo(r,e,n){return Ft(r,r,1-n),_i(r,r,e,n)}function dp(r,e,n){for(const c of r)Ii(c,c,e),Ft(c,c,n)}function Cx(r,e,n,c){const d=e/r.worldSize,g=r.globeMatrix;if(n.z<=1){const tt=Mo(n).getCorners();return dp(tt,g,d),Si.fromPoints(tt)}const _=pg(n,c),S=f_(_,io+Yl(r._tileCoverLift));dp(S,g,d);const M=Number.MAX_VALUE,R=[-M,-M,-M],N=[M,M,M];if(_.contains(r.center)){for(const nt of S)St(N,N,nt),Ht(R,R,nt);R[2]=0;const tt=r.point,_t=[tt.x*d,tt.y*d,0];return St(N,N,_t),Ht(R,R,_t),new Si(N,R)}if(r._tileCoverLift>0){for(const tt of S)St(N,N,tt),Ht(R,R,tt);return new Si(N,R)}const F=[g[12]*d,g[13]*d,g[14]*d],U=_.getCenter(),W=ne(r.center.lat,-J,J),Z=ne(U.lat,-J,J),ee=j(r.center.lng),ce=O(W);let oe=ee-j(U.lng);const me=ce-O(Z);oe>.5?oe-=1:oe<-.5&&(oe+=1);let ve=0;Math.abs(oe)>Math.abs(me)?ve=oe>=0?1:3:(ve=me>=0?0:2,_i(F,F,[g[4]*d,g[5]*d,g[6]*d],-Math.sin(ui(me>=0?_.getSouth():_.getNorth()))*io));const Se=S[ve],De=S[(ve+1)%4],Re=new Dc(Se,De,F),$e=[Oc(Re,0)||Se[0],Oc(Re,1)||Se[1],Oc(Re,2)||Se[2]],We=jd(r.zoom);if(We>0){const tt=(function({x:nt,y:xt,z:Mt},Pt,Gt,Wt,Ut){const $t=1/(1<<Mt);let vt=nt*$t,yt=vt+$t,Vt=xt*$t,si=Vt+$t,Qt=0;const Oi=(vt+yt)/2-Wt;return Oi>.5?Qt=-1:Oi<-.5&&(Qt=1),vt=((vt+Qt)*Pt-(Wt*=Pt))*Gt+Wt,yt=((yt+Qt)*Pt-Wt)*Gt+Wt,Vt=(Vt*Pt-(Ut*=Pt))*Gt+Ut,si=(si*Pt-Ut)*Gt+Ut,[[vt,si,0],[yt,si,0],[yt,Vt,0],[vt,Vt,0]]})(n,e,r._pixelsPerMercatorPixel,ee,ce);for(let nt=0;nt<S.length;nt++)mo(S[nt],tt[nt],We);const _t=Ct([],tt[ve],tt[(ve+1)%4]);Ft(_t,_t,.5),mo($e,_t,We)}for(const tt of S)St(N,N,tt),Ht(R,R,tt);return N[2]=Math.min(Se[2],De[2]),St(N,N,$e),Ht(R,R,$e),new Si(N,R)}function pg({x:r,y:e,z:n},c=!1){const d=1/(1<<n),g=new o(H(r*d),e===(1<<n)-1&&c?-90:K((e+1)*d)),_=new o(H((r+1)*d),e===0&&c?90:K(e*d));return new p(g,_)}function f_(r,e=io){const n=ui(r.getNorth()),c=ui(r.getSouth()),d=Math.cos(n),g=Math.cos(c),_=Math.sin(n),S=Math.sin(c),M=r.getWest(),R=r.getEast();return[Md(g,S,M,e),Md(g,S,R,e),Md(d,_,R,e),Md(d,_,M,e)]}function hp(r,e,n,c){const d=1<<n.z,g=(r/Jt+n.x)/d;return Zl(K((e/Jt+n.y)/d),H(g),c)}function gg({min:r,max:e}){return mg/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const Mx=new Float64Array(16);function fp(r){const e=gg(r),n=at(Mx,[e,e,e]);return be(n,n,fn([],r.min))}function m_(r){const e=(c=r.min,(n=Mx)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=c[0],n[13]=c[1],n[14]=c[2],n[15]=1,n);var n,c;const d=1/gg(r);return Ne(e,e,[d,d,d])}function p_(r){const e=Jt/(2*Math.PI);return r/(2*Math.PI)/e}function Px(r,e){return Jt/(512*Math.pow(2,r))*gg(Mo(e))}function g_(r,e,n,c,d){const g=p_(n),_=[r,e,-n/(2*Math.PI)],S=re(new Float64Array(16));return be(S,S,_),Ne(S,S,[g,g,g]),Be(S,S,ui(-d)),Ee(S,S,ui(-c)),S}function jd(r){return ue(Gl,up,r)}function jx(r,e){const n=Zl(e.lat,e.lng),c=(function(Z){const ee=Zl(Z._center.lat,Z._center.lng);let ce=Un([],qe(0,1,0),ee);const oe=He([],-Z.angle,ee);ce=Ii(ce,ce,oe),He(oe,-Z._pitch,ce);const me=pn([],ee);return Ft(me,me,Yl(Z.cameraToCenterDistance/Z.pixelsPerMeter)),Ii(me,me,oe),Ct([],ee,me)})(r);return _=(d=Vi([],c,n))[0],S=d[1],M=d[2],R=(g=n)[0],N=g[1],F=g[2],W=(U=Math.sqrt((_*_+S*S+M*M)*(R*R+N*N+F*F)))&&sn(d,g)/U,Math.acos(Math.min(Math.max(W,-1),1));var d,g,_,S,M,R,N,F,U,W}function Py(r,e){return jx(r,e)>Math.PI/2*1.01}const mp=ui(85),Yb=Math.cos(mp),Rx=Math.sin(mp),sr=te(),__=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function _g(r,e,n,c,d,g,_,S,M){if(g&&r.queryGeometry.isAboveHorizon)return!1;g&&(M*=r.pixelToTileUnitsFactor);const R=r.tileID.canonical,N=n.projection.upVectorScale(R,n.center.lat,n.worldSize).metersToTile;for(const F of e)for(const U of F){const W=U.add(S),Z=d&&n.elevation?n.elevation.exaggeration()*d.getElevationAt(W.x,W.y,!0):0,ee=n.projection.projectTilePoint(W.x,W.y,R);if(Z>0){const ve=n.projection.upVector(R,W.x,W.y);ee.x+=ve[0]*N*Z,ee.y+=ve[1]*N*Z,ee.z+=ve[2]*N*Z}const ce=g?W:jy(ee.x,ee.y,ee.z,c),oe=g?r.tilespaceRays.map((ve=>yg(ve,Z))):r.queryGeometry.screenGeometry,me=Hr([],[ee.x,ee.y,ee.z,1],c);if(!_&&g?M*=me[3]/n.cameraToCenterDistance:_&&!g&&(M*=n.cameraToCenterDistance/me[3]),g){const ve=K((U.y/Jt+R.y)/(1<<R.z));M/=n.projection.pixelsPerMeter(ve,1)/B(1,ve)}if(_n(oe,ce,M))return!0}return!1}function jy(r,e,n,c){const d=Hr([],[r,e,n,1],c);return new Me(d[0]/d[3],d[1]/d[3])}const Ry=qe(0,0,0),Ly=qe(0,0,1);function yg(r,e){const n=jt();return Ry[2]=e,r.intersectsPlane(Ry,Ly,n),new Me(n[0],n[1])}class vg extends xa{}let dm,Iy,Lx,Ix;function zy(r,{width:e,height:n},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*n*c)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*n*c);return r.width=e,r.height=n,r.data=d,r}function Dy(r,e,n){const{width:c,height:d}=e;c===r.width&&d===r.height||(pp(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,c),height:Math.min(r.height,d)},n,null),r.width=c,r.height=d,r.data=e.data)}function pp(r,e,n,c,d,g,_,S){if(d.width===0||d.height===0)return e;if(d.width>r.width||d.height>r.height||n.x>r.width-d.width||n.y>r.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||c.x>e.width-d.width||c.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const M=r.data,R=e.data,N=g===4&&S;for(let F=0;F<d.height;F++){const U=((n.y+F)*r.width+n.x)*g,W=((c.y+F)*e.width+c.x)*g;if(N)for(let Z=0;Z<d.width;Z++){const ee=U+Z*g+3,ce=W+Z*g;R[ce+0]=255,R[ce+1]=255,R[ce+2]=255,R[ce+3]=M[ee]}else if(_)for(let Z=0;Z<d.width;Z++){const ee=U+Z*g,ce=W+Z*g,oe=new ma(M[ee+0]/255,M[ee+1]/255,M[ee+2]/255,M[ee+3]).toNonPremultipliedRenderColor(_).toArray();R[ce+0]=oe[0],R[ce+1]=oe[1],R[ce+2]=oe[2],R[ce+3]=oe[3]}else for(let Z=0;Z<d.width*g;Z++)R[W+Z]=M[U+Z]}return e}vi(vg,"HeatmapBucket",{omit:["layers"]});class fr{constructor(e,n){zy(this,e,1,n)}resize(e){Dy(this,new fr(e),1)}clone(){return new fr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,d,g){pp(e,n,c,d,g,1,null)}}class Fs{constructor(e,n){zy(this,e,4,n)}resize(e){Dy(this,new Fs(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,d,g,_,S){pp(e,n,c,d,g,4,_,S)}}class Ho{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function xg(r){const e={},n=r.resolution||256,c=r.clips?r.clips.length:1,d=r.image||new Fs({width:n,height:c}),g=(_,S,M)=>{e[r.evaluationKey]=M;const R=r.expression.evaluate(e),N=R?R.toNonPremultipliedRenderColor(null):null;N&&(d.data[_+S+0]=Math.floor(255*N.r),d.data[_+S+1]=Math.floor(255*N.g),d.data[_+S+2]=Math.floor(255*N.b),d.data[_+S+3]=Math.floor(255*N.a))};if(r.clips)for(let _=0,S=0;_<c;++_,S+=4*n)for(let M=0,R=0;M<n;M++,R+=4){const N=M/(n-1),{start:F,end:U}=r.clips[_];g(S,R,F*(1-N)+U*N)}else for(let _=0,S=0;_<n;_++,S+=4)g(0,S,_/(n-1));return d}vi(fr,"AlphaImage"),vi(Fs,"RGBAImage");const Oy=Ln([{name:"a_pos",components:2,type:"Int16"}],4),Ny=Ln([{name:"a_road_z_offset",components:1,type:"Float32"}],4),y_=Ln([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),zx=Ln([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function hm(r,e,n=2){const c=e&&e.length,d=c?e[0]*n:r.length;let g=v_(r,0,d,n,!0);const _=[];if(!g||g.next===g.prev)return _;let S,M,R;if(c&&(g=(function(N,F,U,W){const Z=[];for(let ee=0,ce=F.length;ee<ce;ee++){const oe=v_(N,F[ee]*W,ee<ce-1?F[ee+1]*W:N.length,W,!1);oe===oe.next&&(oe.steiner=!0),Z.push(ew(oe))}Z.sort(Qb);for(let ee=0;ee<Z.length;ee++)U=sf(Z[ee],U);return U})(r,e,g,n)),r.length>80*n){S=r[0],M=r[1];let N=S,F=M;for(let U=n;U<d;U+=n){const W=r[U],Z=r[U+1];W<S&&(S=W),Z<M&&(M=Z),W>N&&(N=W),Z>F&&(F=Z)}R=Math.max(N-S,F-M),R=R!==0?32767/R:0}return bg(g,_,n,S,M,R,0),_}function v_(r,e,n,c,d){let g;if(d===(function(_,S,M,R){let N=0;for(let F=S,U=M-R;F<M;F+=R)N+=(_[U]-_[F])*(_[F+1]+_[U+1]),U=F;return N})(r,e,n,c)>0)for(let _=e;_<n;_+=c)g=Tg(_/c|0,r[_],r[_+1],g);else for(let _=n-c;_>=e;_-=c)g=Tg(_/c|0,r[_],r[_+1],g);return g&&of(g,g.next)&&(Nc(g),g=g.next),g}function ch(r,e){if(!r)return r;e||(e=r);let n,c=r;do if(n=!1,c.steiner||!of(c,c.next)&&wr(c.prev,c,c.next)!==0)c=c.next;else{if(Nc(c),c=e=c.prev,c===c.next)break;n=!0}while(n||c!==e);return e}function bg(r,e,n,c,d,g,_){if(!r)return;!_&&g&&(function(M,R,N,F){let U=M;do U.z===0&&(U.z=wg(U.x,U.y,R,N,F)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==M);U.prevZ.nextZ=null,U.prevZ=null,(function(W){let Z,ee=1;do{let ce,oe=W;W=null;let me=null;for(Z=0;oe;){Z++;let ve=oe,Se=0;for(let Re=0;Re<ee&&(Se++,ve=ve.nextZ,ve);Re++);let De=ee;for(;Se>0||De>0&&ve;)Se!==0&&(De===0||!ve||oe.z<=ve.z)?(ce=oe,oe=oe.nextZ,Se--):(ce=ve,ve=ve.nextZ,De--),me?me.nextZ=ce:W=ce,ce.prevZ=me,me=ce;oe=ve}me.nextZ=null,ee*=2}while(Z>1)})(U)})(r,c,d,g);let S=r;for(;r.prev!==r.next;){const M=r.prev,R=r.next;if(g?Kb(r,c,d,g):Dx(r))e.push(M.i,r.i,R.i),Nc(r),r=R.next,S=R.next;else if((r=R)===S){_?_===1?bg(r=Ox(ch(r),e),e,n,c,d,g,2):_===2&&Jb(r,e,n,c,d,g):bg(ch(r),e,n,c,d,g,1);break}}}function Dx(r){const e=r.prev,n=r,c=r.next;if(wr(e,n,c)>=0)return!1;const d=e.x,g=n.x,_=c.x,S=e.y,M=n.y,R=c.y,N=Math.min(d,g,_),F=Math.min(S,M,R),U=Math.max(d,g,_),W=Math.max(S,M,R);let Z=c.next;for(;Z!==e;){if(Z.x>=N&&Z.x<=U&&Z.y>=F&&Z.y<=W&&fm(d,S,g,M,_,R,Z.x,Z.y)&&wr(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function Kb(r,e,n,c){const d=r.prev,g=r,_=r.next;if(wr(d,g,_)>=0)return!1;const S=d.x,M=g.x,R=_.x,N=d.y,F=g.y,U=_.y,W=Math.min(S,M,R),Z=Math.min(N,F,U),ee=Math.max(S,M,R),ce=Math.max(N,F,U),oe=wg(W,Z,e,n,c),me=wg(ee,ce,e,n,c);let ve=r.prevZ,Se=r.nextZ;for(;ve&&ve.z>=oe&&Se&&Se.z<=me;){if(ve.x>=W&&ve.x<=ee&&ve.y>=Z&&ve.y<=ce&&ve!==d&&ve!==_&&fm(S,N,M,F,R,U,ve.x,ve.y)&&wr(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,Se.x>=W&&Se.x<=ee&&Se.y>=Z&&Se.y<=ce&&Se!==d&&Se!==_&&fm(S,N,M,F,R,U,Se.x,Se.y)&&wr(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;ve&&ve.z>=oe;){if(ve.x>=W&&ve.x<=ee&&ve.y>=Z&&ve.y<=ce&&ve!==d&&ve!==_&&fm(S,N,M,F,R,U,ve.x,ve.y)&&wr(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;Se&&Se.z<=me;){if(Se.x>=W&&Se.x<=ee&&Se.y>=Z&&Se.y<=ce&&Se!==d&&Se!==_&&fm(S,N,M,F,R,U,Se.x,Se.y)&&wr(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function Ox(r,e){let n=r;do{const c=n.prev,d=n.next.next;!of(c,d)&&Fy(c,n,n.next,d)&&Pl(c,d)&&Pl(d,c)&&(e.push(c.i,n.i,d.i),Nc(n),Nc(n.next),n=r=d),n=n.next}while(n!==r);return ch(n)}function Jb(r,e,n,c,d,g){let _=r;do{let S=_.next.next;for(;S!==_.prev;){if(_.i!==S.i&&tw(_,S)){let M=By(_,S);return _=ch(_,_.next),M=ch(M,M.next),bg(_,e,n,c,d,g,0),void bg(M,e,n,c,d,g,0)}S=S.next}_=_.next}while(_!==r)}function Qb(r,e){let n=r.x-e.x;return n===0&&(n=r.y-e.y,n===0)&&(n=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function sf(r,e){const n=(function(d,g){let _=g;const S=d.x,M=d.y;let R,N=-1/0;if(of(d,_))return _;do{if(of(d,_.next))return _.next;if(M<=_.y&&M>=_.next.y&&_.next.y!==_.y){const ee=_.x+(M-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(ee<=S&&ee>N&&(N=ee,R=_.x<_.next.x?_:_.next,ee===S))return R}_=_.next}while(_!==g);if(!R)return null;const F=R,U=R.x,W=R.y;let Z=1/0;_=R;do{if(S>=_.x&&_.x>=U&&S!==_.x&&Fx(M<W?S:N,M,U,W,M<W?N:S,M,_.x,_.y)){const ee=Math.abs(M-_.y)/(S-_.x);Pl(_,d)&&(ee<Z||ee===Z&&(_.x>R.x||_.x===R.x&&Nx(R,_)))&&(R=_,Z=ee)}_=_.next}while(_!==F);return R})(r,e);if(!n)return e;const c=By(n,r);return ch(c,c.next),ch(n,n.next)}function Nx(r,e){return wr(r.prev,r,e.prev)<0&&wr(e.next,r,r.next)<0}function wg(r,e,n,c,d){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ew(r){let e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function Fx(r,e,n,c,d,g,_,S){return(d-_)*(e-S)>=(r-_)*(g-S)&&(r-_)*(c-S)>=(n-_)*(e-S)&&(n-_)*(g-S)>=(d-_)*(c-S)}function fm(r,e,n,c,d,g,_,S){return!(r===_&&e===S)&&Fx(r,e,n,c,d,g,_,S)}function tw(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(n,c){let d=n;do{if(d.i!==n.i&&d.next.i!==n.i&&d.i!==c.i&&d.next.i!==c.i&&Fy(d,d.next,n,c))return!0;d=d.next}while(d!==n);return!1})(r,e)&&(Pl(r,e)&&Pl(e,r)&&(function(n,c){let d=n,g=!1;const _=(n.x+c.x)/2,S=(n.y+c.y)/2;do d.y>S!=d.next.y>S&&d.next.y!==d.y&&_<(d.next.x-d.x)*(S-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==n);return g})(r,e)&&(wr(r.prev,r,e.prev)||wr(r,e.prev,e))||of(r,e)&&wr(r.prev,r,r.next)>0&&wr(e.prev,e,e.next)>0)}function wr(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function of(r,e){return r.x===e.x&&r.y===e.y}function Fy(r,e,n,c){const d=lf(wr(r,e,n)),g=lf(wr(r,e,c)),_=lf(wr(n,c,r)),S=lf(wr(n,c,e));return d!==g&&_!==S||!(d!==0||!Sg(r,n,e))||!(g!==0||!Sg(r,c,e))||!(_!==0||!Sg(n,r,c))||!(S!==0||!Sg(n,e,c))}function Sg(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function lf(r){return r>0?1:r<0?-1:0}function Pl(r,e){return wr(r.prev,r,r.next)<0?wr(r,e,r.next)>=0&&wr(r,r.prev,e)>=0:wr(r,e,r.prev)<0||wr(r,r.next,e)<0}function By(r,e){const n=Uy(r.i,r.x,r.y),c=Uy(e.i,e.x,e.y),d=r.next,g=e.prev;return r.next=e,e.prev=r,n.next=d,d.prev=n,c.next=n,n.prev=c,g.next=c,c.prev=g,c}function Tg(r,e,n,c){const d=Uy(r,e,n);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function Nc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Uy(r,e,n){return{i:r,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function kg(r,e){const n=r.length;if(n<=1)return[r];const c=[];let d,g;for(let _=0;_<n;_++){const S=rn(r[_]);S!==0&&(r[_].area=Math.abs(S),g===void 0&&(g=S<0),g===S<0?(d&&c.push(d),d=[r[_]]):d.push(r[_]))}if(d&&c.push(d),e>1)for(let _=0;_<c.length;_++)c[_].length<=e||(rd(c[_],e,1,c[_].length-1,gp),c[_]=c[_].slice(0,e));return c}function gp(r,e){return e.area-r.area}function $y(r,e,n=1){if(!r)return null;const c=typeof r=="string"?oo.from(r).getPrimary():r.getPrimary(),d=typeof r=="string"?null:r.getSecondary();for(const g of[c,d]){if(!g)continue;const _=g.id.toString();e.has(_)||e.set(_,[]),g.scaleSelf(n),e.get(_).push(g)}return{primary:c.toString(),secondary:d?d.toString():null}}function Vy(r,e,n,c){const d=c.patternDependencies;let g=!1;for(const _ of e){const S=_.paint.get(`${r}-pattern`);S.isConstant()||(g=!0),$y(S.constantOr(null),d,n)&&(g=!0)}return g}function Hy(r,e,n,c,d,g){const _=g.patternDependencies;for(const S of e){const M=S.paint.get(`${r}-pattern`).value;if(M.kind!=="constant"){let R=M.evaluate({zoom:c},n,{},g.availableImages);R=R&&R.name?R.name:R;const N=$y(R,_,d);if(!N)continue;const{primary:F,secondary:U}=N;F&&(n.patterns[S.id]=[F,U].filter(Boolean))}}return n}class Bx{constructor(){this.polygons=new Map}add(e,...n){const c=this.polygons.get(e);c?c.push(...n):this.polygons.set(e,n)}merge(e){for(const[n,c]of e.polygons)this.add(n,...c)}}class uh{constructor(){this.portals=[]}static isOnBorder(e,n){return e<=0&&n<=0||e>=Jt&&n>=Jt}static evaluate(e){if(e.length===0)return new uh;let n=[];for(const M of e)n.push(...M.portals);if(n.length===0)return new uh;for(const M of n){const R=M.va,N=M.vb;(uh.isOnBorder(R.x,N.x)||uh.isOnBorder(R.y,N.y))&&(M.type="border")}const c=n.filter((M=>M.type!=="unevaluated")),d=n.filter((M=>M.type==="unevaluated"));if(d.length===0)return new uh;d.sort(((M,R)=>M.hash===R.hash?M.isTunnel===R.isTunnel?0:M.isTunnel?-1:1:M.hash<R.hash?1:-1)),n=c.concat(d);let g=c.length,_=g,S=g;do if(_++,_===n.length||n[g].hash!==n[_].hash){if(_-g==2){S<g&&(n[S]=n[g],n[g]=null);const M=n[S],R=n[_-1];M.type=M.isTunnel!==R.isTunnel?"tunnel":"polygon",M.connection={a:M.connection.a,b:R.connection.a},S++}g=_}while(g!==n.length);return n.splice(S),n.sort(((M,R)=>M.hash<R.hash?1:-1)),{portals:n}}}vi(uh,"ElevationPortalGraph"),vi(Bx,"ElevationPolygons");class iw{constructor(e,n,c){this.outPositions=e,this.outNormals=n,this.outIndices=c,this.vertexLookup=new Map}addVertex(e,n,c){let d=e[2];c!=null&&(d*=c);const g=`${e[0]},${e[1]},${e[2]},${n[0]},${n[1]},${n[2]}`,_=this.vertexLookup.get(g);if(_!=null)return _;const S=this.outPositions.length;this.vertexLookup.set(g,S);const M=Math.trunc(16384*n[0]),R=Math.trunc(16384*n[1]),N=Math.trunc(16384*n[2]);return this.outPositions.emplaceBack(e[0],e[1],d),this.outNormals.emplaceBack(M,R,N),S}addTriangle(e,n,c){this.outIndices.emplaceBack(e,n,c)}addTriangles(e,n,c){if(e.length===0)return;const d=c.length===1,g=jt(),_=jt();for(let S=0;S<e.length;S+=3){const M=n[e[S+0]],R=n[e[S+1]],N=n[e[S+2]],F=d?c[0]:c[e[S+1]],U=d?c[0]:c[e[S+2]];wt(g,M.x,M.y,d?c[0]:c[e[S+0]]);const W=this.addVertex(g,_);wt(g,R.x,R.y,F);const Z=this.addVertex(g,_);wt(g,N.x,N.y,U);const ee=this.addVertex(g,_);this.outIndices.emplaceBack(W,Z,ee)}}addQuad(e,n,c,d,g,_){const S=this.addVertex(e,g,_),M=this.addVertex(n,g,_),R=this.addVertex(c,g,_),N=this.addVertex(d,g,_);this.addTriangle(S,M,R),this.addTriangle(R,N,S)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Kl{constructor(e,n,c,d){this.unevaluatedPortals=new uh,this.portalPolygons=new Bx,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Jm,this.vertexNormals=new Sl,this.indexArray=new Zr,this.tileToMeters=de(e),this.bridgeProgramConfigurations=new Lc(n,{zoom:c,lut:d},(g=>g!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new Lc(n,{zoom:c,lut:d},(g=>g!=="fill-bridge-guard-rail-color"))}addVertices(e,n){const c=this.unevalVertices.length;for(let d=0;d<e.length;d++)this.unevalVertices.push(e[d]),this.unevalHeights.push(n[d]);return c}addTriangles(e,n,c){const d=c?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of e)d.push(g+n)}addRenderableRing(e,n,c,d,g,_){const S=[new Me(g.min.x,g.min.y),new Me(g.max.x,g.min.y),new Me(g.max.x,g.max.y),new Me(g.min.x,g.max.y)];for(let M=0;M<c-1;M++){const R=n+M,N=R+1,F=this.unevalVertices[R],U=this.unevalVertices[N];if(!(F.x>=g.min.x&&F.x<=g.max.x&&F.y>=g.min.y&&F.y<=g.max.y||U.x>=g.min.x&&U.x<=g.max.x&&U.y>=g.min.y&&U.y<=g.max.y||Ns(F,U,S))||this.isOnBorder(F.x,U.x)||this.isOnBorder(F.y,U.y))continue;const W=Kl.computeEdgeHash(this.unevalVertices[R],this.unevalVertices[N]);let Z,ee=this.vertexHashLookup.get(Kl.computePosHash(F));ee!=null?Z=ee.next:(ee=this.vertexHashLookup.get(Kl.computePosHash(U)),Z=ee!=null?ee.prev:W),this.unevalEdges.push({polygonIdx:e,a:R,b:N,hash:W,portalHash:Z,isTunnel:d,type:"unevaluated",featureInfo:_})}}addPortalCandidates(e,n,c,d,g){if(n.length===0)return;this.portalPolygons.add(e,{geometry:n,zLevel:g});const _=n[0];this.vertexHashLookup.clear();let S=Kl.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let M=0;M<_.length-1;M++){const R=_[M+0],N=_[M+1],F=Ir(N.x-R.x,N.y-R.y),U=Ws(F);if(U===0)continue;let W="unevaluated";const Z=d.pointElevation(R),ee=d.pointElevation(N);Math.abs(Z)<.01&&Math.abs(ee)<.01?W="entrance":(this.isOnBorder(R.x,N.x)||this.isOnBorder(R.y,N.y))&&(W="border");const ce=Kl.computeEdgeHash(R,N);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:R,vb:N,vab:F,length:U,hash:ce,isTunnel:c,type:W});const oe=Kl.computePosHash(R);this.vertexHashLookup.set(oe,{prev:S,next:ce}),S=ce}}construct(e){if(this.unevalVertices.length===0)return;const n=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),c=U=>{U.primitiveLength=this.indexArray.length-U.primitiveOffset},d=new iw(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const g=n(),_=n(),S=n(),M=(U,W)=>{U.sort(((ee,ce)=>ee.type===W&&ce.type!==W?-1:ee.type!==W&&ce.type===W?1:0));const Z=U.findIndex((ee=>ee.type!==W));return Z>=0?Z:U.length};let R=0;this.unevalEdges.length>0&&(R=M(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},this.tileToMeters)),c(S);const N=n(),F=n();if(this.unevalEdges.length>0){const U=this.unevalEdges.splice(R),W=M(U,"tunnel")+R;this.unevalEdges.push(...U),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},{min:R,max:W})}c(N),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),c(F),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),c(_),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),c(g),this.maskSegments=ir.simpleSegment(0,F.primitiveOffset,0,F.primitiveLength),this.depthSegments=ir.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=ir.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.renderableTunnelSegments=ir.simpleSegment(0,N.primitiveOffset,0,N.primitiveLength),this.shadowCasterSegments=ir.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(e,n,c,d,g,_,S,M){this.bridgeProgramConfigurations.updatePaintArrays(e,n,g,c,d,_,S,M),this.tunnelProgramConfigurations.updatePaintArrays(e,n,g,c,d,_,S,M)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,y_.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,zx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,n,c,d,g){const _=(S,M)=>{for(let R=0;R<M.length-1;R++){const N=M[R].featureIndex,F=M[R+1].vertexStart,U=e.feature(N);S.populatePaintArrays(F,U,N,{},c,n,d,void 0,g)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,n,c,d,g){const _=new Map;for(let S=d;S<g;S++){const M=c[S],R=M.a,N=M.b,F=Kl.computePosHash(e[R]),U=Kl.computePosHash(e[N]);let W=_.get(F);W||(W={},_.set(F,W));let Z=_.get(U);Z||(Z={},_.set(U,Z)),n[R]<=0&&n[N]<=0||(W.to=N,Z.from=R)}return _}isTerminalVertex(e,n){const c=Kl.computePosHash(this.unevalVertices[e]),d=n.get(c);return!d||!d.from||!d.to}constructBridgeStructures(e,n,c,d,g,_){e.clearVertexLookup();const S=this.computeVertexConnections(n,c,d,g.min,g.max),M=1/_,R=.5*M,N=(Gt,Wt)=>wt(Gt,n[Wt].x,n[Wt].y,c[Wt]*M),F=jt(),U=jt(),W=jt(),Z=jt(),ee=jt(),ce=(Gt,Wt)=>{const Ut=S.get(Kl.computePosHash(n[Wt])),$t=Ut.from,vt=Ut.to;if(!$t||!vt)return;N(F,$t),N(U,Wt),N(W,vt),cn(Z),Tn(F,U)||(Da(ee,U,F),pn(Z,ee)),Tn(W,U)||(Da(ee,W,U),Ct(Z,Z,pn(ee,ee)));const yt=Xo(Z);return yt>0?Ft(Gt,Z,1/yt):void 0};let oe=Number.POSITIVE_INFINITY;this.sortSubarray(d,g.min,g.max,((Gt,Wt)=>Gt.featureInfo.featureIndex-Wt.featureInfo.featureIndex));const me=jt(),ve=jt(),Se=jt(),De=jt(),Re=jt(),$e=jt(),We=jt(),tt=jt(),_t=jt(),nt=[jt(),jt(),jt(),jt()],xt=[jt(),jt(),jt(),jt()],Mt=[{coord:new Me(0,0),height:0},{coord:new Me(0,0),height:0}],Pt=(Gt,Wt)=>Gt>Wt;for(let Gt=g.min;Gt<g.max;Gt++){const Wt=d[Gt];if(!Wt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Mt,n,c,Wt,Pt))continue;const[Ut,$t]=Mt;if(wt(me,Ut.coord.x,Ut.coord.y,M*Ut.height),wt(ve,$t.coord.x,$t.coord.y,M*$t.height),Tn(me,ve))continue;Da(Se,ve,me),pn(Se,Se);const vt=ce(tt,Wt.a)||Se,yt=ce(_t,Wt.b)||Se;wt(De,vt[1],-vt[0],0),pn(De,De),wt(Re,yt[1],-yt[0],0),pn(Re,Re),Un(tt,De,vt),pn($e,tt),Un(tt,Re,yt),pn(We,tt),Ct(nt[0],me,Ft(tt,Da(tt,De,$e),R)),Ct(nt[1],me,Ft(tt,Ct(tt,De,$e),R)),Ct(nt[2],me,Ft(tt,$e,R)),nt[3]=me,Ct(xt[0],ve,Ft(tt,Da(tt,Re,We),R)),Ct(xt[1],ve,Ft(tt,Ct(tt,Re,We),R)),Ct(xt[2],ve,Ft(tt,We,R)),xt[3]=ve,oe=this.addFeatureSection(Wt.featureInfo.featureIndex,oe,this.bridgeFeatureSections,e);const Vt=e.addVertex(nt[0],De,_),si=e.addVertex(nt[1],De,_),Qt=e.addVertex(xt[0],Re,_),Oi=e.addVertex(xt[1],Re,_);e.addTriangle(Vt,si,Qt),e.addTriangle(si,Oi,Qt);const pi=e.addVertex(nt[1],$e,_),bi=e.addVertex(nt[2],$e,_),Mi=e.addVertex(xt[1],We,_),jn=e.addVertex(xt[2],We,_);e.addTriangle(pi,bi,Mi),e.addTriangle(bi,jn,Mi),fn(De,De),fn(Re,Re);const ni=e.addVertex(nt[2],De,_),Li=e.addVertex(nt[3],De,_),dn=e.addVertex(xt[2],Re,_),Wn=e.addVertex(xt[3],Re,_);e.addTriangle(ni,Li,dn),e.addTriangle(Li,Wn,dn);const Kn=this.isTerminalVertex(Wt.a,S),wn=this.isTerminalVertex(Wt.b,S);Ut.height<.01&&Kn&&e.addQuad(nt[3],nt[2],nt[1],nt[0],fn(vt,vt),_),$t.height<.01&&wn&&e.addQuad(xt[0],xt[1],xt[2],xt[3],yt,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,n,c,d,g,_){e.clearVertexLookup();let S=Number.POSITIVE_INFINITY;const M=(oe,me)=>oe.featureInfo.featureIndex-me.featureInfo.featureIndex;this.sortSubarray(d,g.min,g.max,M),this.sortSubarray(d,_.min,_.max,M);const R=oe=>pn(oe,oe),N=[{coord:new Me(0,0),height:0},{coord:new Me(0,0),height:0}],F=(oe,me)=>oe<me,U=jt(),W=jt(),Z=jt(),ee=jt(),ce=jt();for(let oe=g.min;oe<g.max;oe++){if(!this.prepareEdgePoints(N,n,c,d[oe],F))continue;const[me,ve]=N,Se=R(wt(ce,-(ve.coord.y-me.coord.y),ve.coord.x-me.coord.x,0));S=this.addFeatureSection(d[oe].featureInfo.featureIndex,S,this.tunnelFeatureSections,e),e.addQuad(wt(U,me.coord.x,me.coord.y,me.height),wt(W,ve.coord.x,ve.coord.y,ve.height),wt(Z,ve.coord.x,ve.coord.y,d[oe].isTunnel?-.1:0),wt(ee,me.coord.x,me.coord.y,d[oe].isTunnel?-.1:0),Se)}for(let oe=_.min;oe<_.max;oe++){const me=d[oe];me.isTunnel&&([me.a,me.b]=[me.b,me.a]);const ve=n[me.a],Se=n[me.b],De=R(wt(ce,-(Se.y-ve.y),Se.x-ve.x,0));S=this.addFeatureSection(me.featureInfo.featureIndex,S,this.tunnelFeatureSections,e),e.addQuad(wt(U,Se.x,Se.y,0),wt(W,ve.x,ve.y,0),wt(Z,ve.x,ve.y,c[me.a]+4),wt(ee,Se.x,Se.y,c[me.b]+4),De),e.addQuad(wt(U,ve.x,ve.y,0),wt(W,Se.x,Se.y,0),wt(Z,Se.x,Se.y,c[me.b]+4),wt(ee,ve.x,ve.y,c[me.a]+4),De)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,n,c,d){e.coord.x=n,e.coord.y=c,e.height=d}prepareEdgePoints(e,n,c,d,g){let _=n[d.a].x,S=n[d.a].y,M=n[d.b].x,R=n[d.b].y,N=c[d.a],F=c[d.b];const U=g(N,0),W=g(F,0);if(U&&W)return this.setElevatedPoint(e[0],_,S,N),this.setElevatedPoint(e[1],M,R,F),!0;if(!U&&!W)return!1;if(U){if(!W){const Z=F/(F-N);M=Gi(M,_,Z),R=Gi(R,S,Z),F=Gi(F,N,Z)}}else{const Z=N/(N-F);_=Gi(_,M,Z),S=Gi(S,R,Z),N=Gi(N,F,Z)}return this.setElevatedPoint(e[0],_,S,N),this.setElevatedPoint(e[1],M,R,F),!0}prepareEdges(e,n){if(n.length===0)return;n.sort(((S,M)=>S.hash===M.hash?M.polygonIdx-S.polygonIdx:M.hash>S.hash?1:-1));let c=0,d=0,g=0,_=n[c].polygonIdx;do d++,(d===n.length||n[c].hash!==n[d].hash)&&((d-c==1||n[d-1].polygonIdx!==_)&&(g<c&&(n[g]=n[c],n[c]=null),n[g].type="none",g++),c=d,c!==n.length&&(_=n[c].polygonIdx));while(c!==n.length);if(n.splice(g),n.length!==0&&e.length!==0){n.sort(((R,N)=>R.portalHash<N.portalHash?1:-1));let S=0,M=0;for(;S!==n.length&&M!==e.length;){const R=n[S],N=e[M];R.portalHash>N.hash?S++:N.hash>R.portalHash?M++:(R.type=N.type,S++)}}}isOnBorder(e,n){return e<=0&&n<=0||e>=Jt&&n>=Jt}addFeatureSection(e,n,c,d){return e!==n&&(n=e,c.push({featureIndex:e,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),n}sortSubarray(e,n,c,d){const g=e.slice(n,c);g.sort(d),e.splice(n,g.length,...g)}static computeEdgeHash(e,n){return(e.y===n.y&&e.x>n.x||e.y>n.y)&&([e,n]=[n,e]),BigInt(Kl.computePosHash(e))<<32n|BigInt(Kl.computePosHash(n))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Ux,Gy={exports:{}},mm=(Ux||(Ux=1,(function(r){function e(Le,Oe){return Le>Oe?1:Le<Oe?-1:0}var n=function(Le,Oe){Le===void 0&&(Le=e),Oe===void 0&&(Oe=!1),this._compare=Le,this._root=null,this._size=0,this._noDuplicates=!!Oe},c={size:{configurable:!0}};function d(Le,Oe,bt,qt,hi){var fi=hi-qt;if(fi>0){var Ni=qt+Math.floor(fi/2),Bi={key:Oe[Ni],data:bt[Ni],parent:Le};return Bi.left=d(Bi,Oe,bt,qt,Ni),Bi.right=d(Bi,Oe,bt,Ni+1,hi),Bi}return null}function g(Le,Oe,bt,qt,hi){if(!(bt>=qt)){for(var fi=Le[bt+qt>>1],Ni=bt-1,Bi=qt+1;;){do Ni++;while(hi(Le[Ni],fi)<0);do Bi--;while(hi(Le[Bi],fi)>0);if(Ni>=Bi)break;var bn=Le[Ni];Le[Ni]=Le[Bi],Le[Bi]=bn,bn=Oe[Ni],Oe[Ni]=Oe[Bi],Oe[Bi]=bn}g(Le,Oe,bt,Bi,hi),g(Le,Oe,Bi+1,qt,hi)}}n.prototype.rotateLeft=function(Le){var Oe=Le.right;Oe&&(Le.right=Oe.left,Oe.left&&(Oe.left.parent=Le),Oe.parent=Le.parent),Le.parent?Le===Le.parent.left?Le.parent.left=Oe:Le.parent.right=Oe:this._root=Oe,Oe&&(Oe.left=Le),Le.parent=Oe},n.prototype.rotateRight=function(Le){var Oe=Le.left;Oe&&(Le.left=Oe.right,Oe.right&&(Oe.right.parent=Le),Oe.parent=Le.parent),Le.parent?Le===Le.parent.left?Le.parent.left=Oe:Le.parent.right=Oe:this._root=Oe,Oe&&(Oe.right=Le),Le.parent=Oe},n.prototype._splay=function(Le){for(;Le.parent;){var Oe=Le.parent;Oe.parent?Oe.left===Le&&Oe.parent.left===Oe?(this.rotateRight(Oe.parent),this.rotateRight(Oe)):Oe.right===Le&&Oe.parent.right===Oe?(this.rotateLeft(Oe.parent),this.rotateLeft(Oe)):Oe.left===Le&&Oe.parent.right===Oe?(this.rotateRight(Oe),this.rotateLeft(Oe)):(this.rotateLeft(Oe),this.rotateRight(Oe)):Oe.left===Le?this.rotateRight(Oe):this.rotateLeft(Oe)}},n.prototype.splay=function(Le){for(var Oe,bt,qt,hi,fi;Le.parent;)(bt=(Oe=Le.parent).parent)&&bt.parent?((qt=bt.parent).left===bt?qt.left=Le:qt.right=Le,Le.parent=qt):(Le.parent=null,this._root=Le),hi=Le.left,fi=Le.right,Le===Oe.left?(bt&&(bt.left===Oe?(Oe.right?(bt.left=Oe.right,bt.left.parent=bt):bt.left=null,Oe.right=bt,bt.parent=Oe):(hi?(bt.right=hi,hi.parent=bt):bt.right=null,Le.left=bt,bt.parent=Le)),fi?(Oe.left=fi,fi.parent=Oe):Oe.left=null,Le.right=Oe,Oe.parent=Le):(bt&&(bt.right===Oe?(Oe.left?(bt.right=Oe.left,bt.right.parent=bt):bt.right=null,Oe.left=bt,bt.parent=Oe):(fi?(bt.left=fi,fi.parent=bt):bt.left=null,Le.right=bt,bt.parent=Le)),hi?(Oe.right=hi,hi.parent=Oe):Oe.right=null,Le.left=Oe,Oe.parent=Le)},n.prototype.replace=function(Le,Oe){Le.parent?Le===Le.parent.left?Le.parent.left=Oe:Le.parent.right=Oe:this._root=Oe,Oe&&(Oe.parent=Le.parent)},n.prototype.minNode=function(Le){if(Le===void 0&&(Le=this._root),Le)for(;Le.left;)Le=Le.left;return Le},n.prototype.maxNode=function(Le){if(Le===void 0&&(Le=this._root),Le)for(;Le.right;)Le=Le.right;return Le},n.prototype.insert=function(Le,Oe){var bt=this._root,qt=null,hi=this._compare;if(this._noDuplicates)for(;bt;){if(qt=bt,hi(bt.key,Le)===0)return;bt=hi(bt.key,Le)<0?bt.right:bt.left}else for(;bt;)qt=bt,bt=hi(bt.key,Le)<0?bt.right:bt.left;return bt={key:Le,data:Oe,left:null,right:null,parent:qt},qt?hi(qt.key,bt.key)<0?qt.right=bt:qt.left=bt:this._root=bt,this.splay(bt),this._size++,bt},n.prototype.find=function(Le){for(var Oe=this._root,bt=this._compare;Oe;){var qt=bt(Oe.key,Le);if(qt<0)Oe=Oe.right;else{if(!(qt>0))return Oe;Oe=Oe.left}}return null},n.prototype.contains=function(Le){for(var Oe=this._root,bt=this._compare;Oe;){var qt=bt(Le,Oe.key);if(qt===0)return!0;Oe=qt<0?Oe.left:Oe.right}return!1},n.prototype.remove=function(Le){var Oe=this.find(Le);if(!Oe)return!1;if(this.splay(Oe),Oe.left)if(Oe.right){var bt=this.minNode(Oe.right);bt.parent!==Oe&&(this.replace(bt,bt.right),bt.right=Oe.right,bt.right.parent=bt),this.replace(Oe,bt),bt.left=Oe.left,bt.left.parent=bt}else this.replace(Oe,Oe.left);else this.replace(Oe,Oe.right);return this._size--,!0},n.prototype.removeNode=function(Le){if(!Le)return!1;if(this.splay(Le),Le.left)if(Le.right){var Oe=this.minNode(Le.right);Oe.parent!==Le&&(this.replace(Oe,Oe.right),Oe.right=Le.right,Oe.right.parent=Oe),this.replace(Le,Oe),Oe.left=Le.left,Oe.left.parent=Oe}else this.replace(Le,Le.left);else this.replace(Le,Le.right);return this._size--,!0},n.prototype.erase=function(Le){var Oe=this.find(Le);if(Oe){this.splay(Oe);var bt=Oe.left,qt=Oe.right,hi=null;bt&&(bt.parent=null,hi=this.maxNode(bt),this.splay(hi),this._root=hi),qt&&(bt?hi.right=qt:this._root=qt,qt.parent=hi),this._size--}},n.prototype.pop=function(){var Le=this._root,Oe=null;if(Le){for(;Le.left;)Le=Le.left;Oe={key:Le.key,data:Le.data},this.remove(Le.key)}return Oe},n.prototype.next=function(Le){var Oe=Le;if(Oe)if(Oe.right)for(Oe=Oe.right;Oe&&Oe.left;)Oe=Oe.left;else for(Oe=Le.parent;Oe&&Oe.right===Le;)Le=Oe,Oe=Oe.parent;return Oe},n.prototype.prev=function(Le){var Oe=Le;if(Oe)if(Oe.left)for(Oe=Oe.left;Oe&&Oe.right;)Oe=Oe.right;else for(Oe=Le.parent;Oe&&Oe.left===Le;)Le=Oe,Oe=Oe.parent;return Oe},n.prototype.forEach=function(Le){for(var Oe=this._root,bt=[],qt=!1,hi=0;!qt;)Oe?(bt.push(Oe),Oe=Oe.left):bt.length>0?(Le(Oe=bt.pop(),hi++),Oe=Oe.right):qt=!0;return this},n.prototype.range=function(Le,Oe,bt,qt){for(var hi=[],fi=this._compare,Ni=this._root;hi.length!==0||Ni;)if(Ni)hi.push(Ni),Ni=Ni.left;else{if(fi((Ni=hi.pop()).key,Oe)>0)break;if(fi(Ni.key,Le)>=0&&bt.call(qt,Ni))return this;Ni=Ni.right}return this},n.prototype.keys=function(){for(var Le=this._root,Oe=[],bt=[],qt=!1;!qt;)Le?(Oe.push(Le),Le=Le.left):Oe.length>0?(Le=Oe.pop(),bt.push(Le.key),Le=Le.right):qt=!0;return bt},n.prototype.values=function(){for(var Le=this._root,Oe=[],bt=[],qt=!1;!qt;)Le?(Oe.push(Le),Le=Le.left):Oe.length>0?(Le=Oe.pop(),bt.push(Le.data),Le=Le.right):qt=!0;return bt},n.prototype.at=function(Le){for(var Oe=this._root,bt=[],qt=!1,hi=0;!qt;)if(Oe)bt.push(Oe),Oe=Oe.left;else if(bt.length>0){if(Oe=bt.pop(),hi===Le)return Oe;hi++,Oe=Oe.right}else qt=!0;return null},n.prototype.load=function(Le,Oe,bt){if(Le===void 0&&(Le=[]),Oe===void 0&&(Oe=[]),bt===void 0&&(bt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var qt=Le.length;return bt&&g(Le,Oe,0,qt-1,this._compare),this._root=d(null,Le,Oe,0,qt),this._size=qt,this},n.prototype.min=function(){var Le=this.minNode(this._root);return Le?Le.key:null},n.prototype.max=function(){var Le=this.maxNode(this._root);return Le?Le.key:null},n.prototype.isEmpty=function(){return this._root===null},c.size.get=function(){return this._size},n.createTree=function(Le,Oe,bt,qt,hi){return new n(bt,hi).load(Le,Oe,qt)},Object.defineProperties(n.prototype,c);var _=0,S=1,M=2,R=3,N=0,F=1,U=2,W=3;function Z(Le,Oe,bt){Oe===null?(Le.inOut=!1,Le.otherInOut=!0):(Le.isSubject===Oe.isSubject?(Le.inOut=!Oe.inOut,Le.otherInOut=Oe.otherInOut):(Le.inOut=!Oe.otherInOut,Le.otherInOut=Oe.isVertical()?!Oe.inOut:Oe.inOut),Oe&&(Le.prevInResult=!ee(Oe,bt)||Oe.isVertical()?Oe.prevInResult:Oe));var qt=ee(Le,bt);Le.resultTransition=qt?(function(hi,fi){var Ni,Bi=!hi.inOut,bn=!hi.otherInOut;switch(fi){case N:Ni=Bi&&bn;break;case F:Ni=Bi||bn;break;case W:Ni=Bi^bn;break;case U:Ni=hi.isSubject?Bi&&!bn:bn&&!Bi}return Ni?1:-1})(Le,bt):0}function ee(Le,Oe){switch(Le.type){case _:switch(Oe){case N:return!Le.otherInOut;case F:return Le.otherInOut;case U:return Le.isSubject&&Le.otherInOut||!Le.isSubject&&!Le.otherInOut;case W:return!0}break;case M:return Oe===N||Oe===F;case R:return Oe===U;case S:return!1}return!1}var ce=function(Le,Oe,bt,qt,hi){this.left=Oe,this.point=Le,this.otherEvent=bt,this.isSubject=qt,this.type=hi||_,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},oe={inResult:{configurable:!0}};function me(Le,Oe){return Le[0]===Oe[0]&&Le[1]===Oe[1]}ce.prototype.isBelow=function(Le){var Oe=this.point,bt=this.otherEvent.point;return this.left?(Oe[0]-Le[0])*(bt[1]-Le[1])-(bt[0]-Le[0])*(Oe[1]-Le[1])>0:(bt[0]-Le[0])*(Oe[1]-Le[1])-(Oe[0]-Le[0])*(bt[1]-Le[1])>0},ce.prototype.isAbove=function(Le){return!this.isBelow(Le)},ce.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},oe.inResult.get=function(){return this.resultTransition!==0},ce.prototype.clone=function(){var Le=new ce(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Le.contourId=this.contourId,Le.resultTransition=this.resultTransition,Le.prevInResult=this.prevInResult,Le.isExteriorRing=this.isExteriorRing,Le.inOut=this.inOut,Le.otherInOut=this.otherInOut,Le},Object.defineProperties(ce.prototype,oe);var ve=11102230246251565e-32,Se=134217729,De=(3+8*ve)*ve;function Re(Le,Oe,bt,qt,hi){var fi,Ni,Bi,bn,kn=Oe[0],Cn=qt[0],Vn=0,Qi=0;Cn>kn==Cn>-kn?(fi=kn,kn=Oe[++Vn]):(fi=Cn,Cn=qt[++Qi]);var ln=0;if(Vn<Le&&Qi<bt)for(Cn>kn==Cn>-kn?(Bi=fi-((Ni=kn+fi)-kn),kn=Oe[++Vn]):(Bi=fi-((Ni=Cn+fi)-Cn),Cn=qt[++Qi]),fi=Ni,Bi!==0&&(hi[ln++]=Bi);Vn<Le&&Qi<bt;)Cn>kn==Cn>-kn?(Bi=fi-((Ni=fi+kn)-(bn=Ni-fi))+(kn-bn),kn=Oe[++Vn]):(Bi=fi-((Ni=fi+Cn)-(bn=Ni-fi))+(Cn-bn),Cn=qt[++Qi]),fi=Ni,Bi!==0&&(hi[ln++]=Bi);for(;Vn<Le;)Bi=fi-((Ni=fi+kn)-(bn=Ni-fi))+(kn-bn),kn=Oe[++Vn],fi=Ni,Bi!==0&&(hi[ln++]=Bi);for(;Qi<bt;)Bi=fi-((Ni=fi+Cn)-(bn=Ni-fi))+(Cn-bn),Cn=qt[++Qi],fi=Ni,Bi!==0&&(hi[ln++]=Bi);return fi===0&&ln!==0||(hi[ln++]=fi),ln}function $e(Le){return new Float64Array(Le)}var We=33306690738754716e-32,tt=22204460492503146e-32,_t=11093356479670487e-47,nt=$e(4),xt=$e(8),Mt=$e(12),Pt=$e(16),Gt=$e(4);function Wt(Le,Oe,bt){var qt=(function(hi,fi,Ni,Bi,bn,kn){var Cn=(fi-kn)*(Ni-bn),Vn=(hi-bn)*(Bi-kn),Qi=Cn-Vn;if(Cn===0||Vn===0||Cn>0!=Vn>0)return Qi;var ln=Math.abs(Cn+Vn);return Math.abs(Qi)>=We*ln?Qi:-(function(aa,ha,fa,Ta,$a,Ia,pa){var ba,En,Yn,mr,Yi,Hn,Na,Ha,Ja,Nr,qa,Ki,yr,ka,ur,ys,Us,as,rs=aa-$a,Cs=fa-$a,Jl=ha-Ia,Wa=Ta-Ia;nt[0]=(ur=(Ha=rs-(Na=(Hn=Se*rs)-(Hn-rs)))*(Nr=Wa-(Ja=(Hn=Se*Wa)-(Hn-Wa)))-((ka=rs*Wa)-Na*Ja-Ha*Ja-Na*Nr))-((qa=ur-(Us=(Ha=Jl-(Na=(Hn=Se*Jl)-(Hn-Jl)))*(Nr=Cs-(Ja=(Hn=Se*Cs)-(Hn-Cs)))-((ys=Jl*Cs)-Na*Ja-Ha*Ja-Na*Nr)))+(Yi=ur-qa))+(Yi-Us),nt[1]=(yr=ka-((Ki=ka+qa)-(Yi=Ki-ka))+(qa-Yi))-((qa=yr-ys)+(Yi=yr-qa))+(Yi-ys),nt[2]=Ki-((as=Ki+qa)-(Yi=as-Ki))+(qa-Yi),nt[3]=as;var jr=(function(pf,Po){for(var jl=Po[0],Uc=1;Uc<4;Uc++)jl+=Po[Uc];return jl})(0,nt),Fr=tt*pa;if(jr>=Fr||-jr>=Fr||(ba=aa-(rs+(Yi=aa-rs))+(Yi-$a),Yn=fa-(Cs+(Yi=fa-Cs))+(Yi-$a),En=ha-(Jl+(Yi=ha-Jl))+(Yi-Ia),mr=Ta-(Wa+(Yi=Ta-Wa))+(Yi-Ia),ba===0&&En===0&&Yn===0&&mr===0)||(Fr=_t*pa+De*Math.abs(jr),(jr+=rs*mr+Wa*ba-(Jl*Yn+Cs*En))>=Fr||-jr>=Fr))return jr;Gt[0]=(ur=(Ha=ba-(Na=(Hn=Se*ba)-(Hn-ba)))*(Nr=Wa-(Ja=(Hn=Se*Wa)-(Hn-Wa)))-((ka=ba*Wa)-Na*Ja-Ha*Ja-Na*Nr))-((qa=ur-(Us=(Ha=En-(Na=(Hn=Se*En)-(Hn-En)))*(Nr=Cs-(Ja=(Hn=Se*Cs)-(Hn-Cs)))-((ys=En*Cs)-Na*Ja-Ha*Ja-Na*Nr)))+(Yi=ur-qa))+(Yi-Us),Gt[1]=(yr=ka-((Ki=ka+qa)-(Yi=Ki-ka))+(qa-Yi))-((qa=yr-ys)+(Yi=yr-qa))+(Yi-ys),Gt[2]=Ki-((as=Ki+qa)-(Yi=as-Ki))+(qa-Yi),Gt[3]=as;var uc=Re(4,nt,4,Gt,xt);Gt[0]=(ur=(Ha=rs-(Na=(Hn=Se*rs)-(Hn-rs)))*(Nr=mr-(Ja=(Hn=Se*mr)-(Hn-mr)))-((ka=rs*mr)-Na*Ja-Ha*Ja-Na*Nr))-((qa=ur-(Us=(Ha=Jl-(Na=(Hn=Se*Jl)-(Hn-Jl)))*(Nr=Yn-(Ja=(Hn=Se*Yn)-(Hn-Yn)))-((ys=Jl*Yn)-Na*Ja-Ha*Ja-Na*Nr)))+(Yi=ur-qa))+(Yi-Us),Gt[1]=(yr=ka-((Ki=ka+qa)-(Yi=Ki-ka))+(qa-Yi))-((qa=yr-ys)+(Yi=yr-qa))+(Yi-ys),Gt[2]=Ki-((as=Ki+qa)-(Yi=as-Ki))+(qa-Yi),Gt[3]=as;var vs=Re(uc,xt,4,Gt,Mt);Gt[0]=(ur=(Ha=ba-(Na=(Hn=Se*ba)-(Hn-ba)))*(Nr=mr-(Ja=(Hn=Se*mr)-(Hn-mr)))-((ka=ba*mr)-Na*Ja-Ha*Ja-Na*Nr))-((qa=ur-(Us=(Ha=En-(Na=(Hn=Se*En)-(Hn-En)))*(Nr=Yn-(Ja=(Hn=Se*Yn)-(Hn-Yn)))-((ys=En*Yn)-Na*Ja-Ha*Ja-Na*Nr)))+(Yi=ur-qa))+(Yi-Us),Gt[1]=(yr=ka-((Ki=ka+qa)-(Yi=Ki-ka))+(qa-Yi))-((qa=yr-ys)+(Yi=yr-qa))+(Yi-ys),Gt[2]=Ki-((as=Ki+qa)-(Yi=as-Ki))+(qa-Yi),Gt[3]=as;var Id=Re(vs,Mt,4,Gt,Pt);return Pt[Id-1]})(hi,fi,Ni,Bi,bn,kn,ln)})(Le[0],Le[1],Oe[0],Oe[1],bt[0],bt[1]);return qt>0?-1:qt<0?1:0}function Ut(Le,Oe){var bt=Le.point,qt=Oe.point;return bt[0]>qt[0]?1:bt[0]<qt[0]?-1:bt[1]!==qt[1]?bt[1]>qt[1]?1:-1:(function(hi,fi,Ni,Bi){return hi.left!==fi.left?hi.left?1:-1:Wt(Ni,hi.otherEvent.point,fi.otherEvent.point)!==0?hi.isBelow(fi.otherEvent.point)?-1:1:!hi.isSubject&&fi.isSubject?1:-1})(Le,Oe,bt)}function $t(Le,Oe,bt){var qt=new ce(Oe,!1,Le,Le.isSubject),hi=new ce(Oe,!0,Le.otherEvent,Le.isSubject);return me(Le.point,Le.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Le),qt.contourId=hi.contourId=Le.contourId,Ut(hi,Le.otherEvent)>0&&(Le.otherEvent.left=!0,hi.left=!1),Le.otherEvent.otherEvent=hi,Le.otherEvent=qt,bt.push(hi),bt.push(qt),bt}function vt(Le,Oe){return Le[0]*Oe[1]-Le[1]*Oe[0]}function yt(Le,Oe){return Le[0]*Oe[0]+Le[1]*Oe[1]}function Vt(Le,Oe,bt){var qt=(function(bn,kn,Cn,Vn,Qi){var ln=[kn[0]-bn[0],kn[1]-bn[1]],aa=[Vn[0]-Cn[0],Vn[1]-Cn[1]];function ha(Hn,Na,Ha){return[Hn[0]+Na*Ha[0],Hn[1]+Na*Ha[1]]}var fa=[Cn[0]-bn[0],Cn[1]-bn[1]],Ta=vt(ln,aa),$a=Ta*Ta,Ia=yt(ln,ln);if($a>0){var pa=vt(fa,aa)/Ta;if(pa<0||pa>1)return null;var ba=vt(fa,ln)/Ta;return ba<0||ba>1?null:pa===0||pa===1?[ha(bn,pa,ln)]:ba===0||ba===1?[ha(Cn,ba,aa)]:[ha(bn,pa,ln)]}if(($a=(Ta=vt(fa,ln))*Ta)>0)return null;var En=yt(ln,fa)/Ia,Yn=En+yt(ln,aa)/Ia,mr=Math.min(En,Yn),Yi=Math.max(En,Yn);return mr<=1&&Yi>=0?mr===1?[ha(bn,mr>0?mr:0,ln)]:Yi===0?[ha(bn,Yi<1?Yi:1,ln)]:[ha(bn,mr>0?mr:0,ln),ha(bn,Yi<1?Yi:1,ln)]:null})(Le.point,Le.otherEvent.point,Oe.point,Oe.otherEvent.point),hi=qt?qt.length:0;if(hi===0||hi===1&&(me(Le.point,Oe.point)||me(Le.otherEvent.point,Oe.otherEvent.point))||hi===2&&Le.isSubject===Oe.isSubject)return 0;if(hi===1)return me(Le.point,qt[0])||me(Le.otherEvent.point,qt[0])||$t(Le,qt[0],bt),me(Oe.point,qt[0])||me(Oe.otherEvent.point,qt[0])||$t(Oe,qt[0],bt),1;var fi=[],Ni=!1,Bi=!1;return me(Le.point,Oe.point)?Ni=!0:Ut(Le,Oe)===1?fi.push(Oe,Le):fi.push(Le,Oe),me(Le.otherEvent.point,Oe.otherEvent.point)?Bi=!0:Ut(Le.otherEvent,Oe.otherEvent)===1?fi.push(Oe.otherEvent,Le.otherEvent):fi.push(Le.otherEvent,Oe.otherEvent),Ni&&Bi||Ni?(Oe.type=S,Le.type=Oe.inOut===Le.inOut?M:R,Ni&&!Bi&&$t(fi[1].otherEvent,fi[0].point,bt),2):Bi?($t(fi[0],fi[1].point,bt),3):fi[0]!==fi[3].otherEvent?($t(fi[0],fi[1].point,bt),$t(fi[1],fi[2].point,bt),3):($t(fi[0],fi[1].point,bt),$t(fi[3].otherEvent,fi[2].point,bt),3)}function si(Le,Oe){if(Le===Oe)return 0;if(Wt(Le.point,Le.otherEvent.point,Oe.point)!==0||Wt(Le.point,Le.otherEvent.point,Oe.otherEvent.point)!==0)return me(Le.point,Oe.point)?Le.isBelow(Oe.otherEvent.point)?-1:1:Le.point[0]===Oe.point[0]?Le.point[1]<Oe.point[1]?-1:1:Ut(Le,Oe)===1?Oe.isAbove(Le.point)?-1:1:Le.isBelow(Oe.point)?-1:1;if(Le.isSubject!==Oe.isSubject)return Le.isSubject?-1:1;var bt=Le.point,qt=Oe.point;return bt[0]===qt[0]&&bt[1]===qt[1]?(bt=Le.otherEvent.point)[0]===(qt=Oe.otherEvent.point)[0]&&bt[1]===qt[1]?0:Le.contourId>Oe.contourId?1:-1:Ut(Le,Oe)===1?1:-1}var Qt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Oi(Le,Oe,bt,qt){var hi,fi=Le+1,Ni=Oe[Le].point,Bi=Oe.length;for(fi<Bi&&(hi=Oe[fi].point);fi<Bi&&hi[0]===Ni[0]&&hi[1]===Ni[1];){if(!bt[fi])return fi;++fi<Bi&&(hi=Oe[fi].point)}for(fi=Le-1;bt[fi]&&fi>qt;)fi--;return fi}Qt.prototype.isExterior=function(){return this.holeOf==null};var pi=Mi,bi=Mi;function Mi(Le,Oe){if(!(this instanceof Mi))return new Mi(Le,Oe);if(this.data=Le||[],this.length=this.data.length,this.compare=Oe||jn,this.length>0)for(var bt=(this.length>>1)-1;bt>=0;bt--)this._down(bt)}function jn(Le,Oe){return Le<Oe?-1:Le>Oe?1:0}Mi.prototype={push:function(Le){this.data.push(Le),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Le=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Le}},peek:function(){return this.data[0]},_up:function(Le){for(var Oe=this.data,bt=this.compare,qt=Oe[Le];Le>0;){var hi=Le-1>>1,fi=Oe[hi];if(bt(qt,fi)>=0)break;Oe[Le]=fi,Le=hi}Oe[Le]=qt},_down:function(Le){for(var Oe=this.data,bt=this.compare,qt=this.length>>1,hi=Oe[Le];Le<qt;){var fi=1+(Le<<1),Ni=fi+1,Bi=Oe[fi];if(Ni<this.length&&bt(Oe[Ni],Bi)<0&&(fi=Ni,Bi=Oe[Ni]),bt(Bi,hi)>=0)break;Oe[Le]=Bi,Le=fi}Oe[Le]=hi}},pi.default=bi;var ni=Math.max,Li=Math.min,dn=0;function Wn(Le,Oe,bt,qt,hi,fi){var Ni,Bi,bn,kn,Cn,Vn;for(Ni=0,Bi=Le.length-1;Ni<Bi;Ni++)if(kn=Le[Ni+1],Cn=new ce(bn=Le[Ni],!1,void 0,Oe),Vn=new ce(kn,!1,Cn,Oe),Cn.otherEvent=Vn,bn[0]!==kn[0]||bn[1]!==kn[1]){Cn.contourId=Vn.contourId=bt,fi||(Cn.isExteriorRing=!1,Vn.isExteriorRing=!1),Ut(Cn,Vn)>0?Vn.left=!0:Cn.left=!0;var Qi=bn[0],ln=bn[1];hi[0]=Li(hi[0],Qi),hi[1]=Li(hi[1],ln),hi[2]=ni(hi[2],Qi),hi[3]=ni(hi[3],ln),qt.push(Cn),qt.push(Vn)}}var Kn=[];function wn(Le,Oe,bt){typeof Le[0][0][0]=="number"&&(Le=[Le]),typeof Oe[0][0][0]=="number"&&(Oe=[Oe]);var qt=(function(ln,aa,ha){var fa=null;return ln.length*aa.length==0&&(ha===N?fa=Kn:ha===U?fa=ln:ha!==F&&ha!==W||(fa=ln.length===0?aa:ln)),fa})(Le,Oe,bt);if(qt)return qt===Kn?null:qt;var hi=[1/0,1/0,-1/0,-1/0],fi=[1/0,1/0,-1/0,-1/0],Ni=(function(ln,aa,ha,fa,Ta){var $a,Ia,pa,ba,En,Yn,mr=new pi(null,Ut);for(pa=0,ba=ln.length;pa<ba;pa++)for(En=0,Yn=($a=ln[pa]).length;En<Yn;En++)(Ia=En===0)&&dn++,Wn($a[En],!0,dn,mr,ha,Ia);for(pa=0,ba=aa.length;pa<ba;pa++)for(En=0,Yn=($a=aa[pa]).length;En<Yn;En++)Ia=En===0,Ta===U&&(Ia=!1),Ia&&dn++,Wn($a[En],!1,dn,mr,fa,Ia);return mr})(Le,Oe,hi,fi,bt);if(qt=(function(ln,aa,ha,fa,Ta){var $a=null;return(ha[0]>fa[2]||fa[0]>ha[2]||ha[1]>fa[3]||fa[1]>ha[3])&&(Ta===N?$a=Kn:Ta===U?$a=ln:Ta!==F&&Ta!==W||($a=ln.concat(aa))),$a})(Le,Oe,hi,fi,bt))return qt===Kn?null:qt;for(var Bi=(function(ln){var aa,ha,fa=(function(pa){var ba,En,Yn,mr,Yi=[];for(En=0,Yn=pa.length;En<Yn;En++)((ba=pa[En]).left&&ba.inResult||!ba.left&&ba.otherEvent.inResult)&&Yi.push(ba);for(var Hn=!1;!Hn;)for(Hn=!0,En=0,Yn=Yi.length;En<Yn;En++)En+1<Yn&&Ut(Yi[En],Yi[En+1])===1&&(mr=Yi[En],Yi[En]=Yi[En+1],Yi[En+1]=mr,Hn=!1);for(En=0,Yn=Yi.length;En<Yn;En++)(ba=Yi[En]).otherPos=En;for(En=0,Yn=Yi.length;En<Yn;En++)(ba=Yi[En]).left||(mr=ba.otherPos,ba.otherPos=ba.otherEvent.otherPos,ba.otherEvent.otherPos=mr);return Yi})(ln),Ta={},$a=[],Ia=function(){if(!Ta[aa]){var pa=$a.length,ba=(function(Yi,Hn,Na){var Ha=new Qt;if(Yi.prevInResult!=null){var Ja=Yi.prevInResult,Nr=Ja.outputContourId;if(Ja.resultTransition>0){var qa=Hn[Nr];if(qa.holeOf!=null){var Ki=qa.holeOf;Hn[Ki].holeIds.push(Na),Ha.holeOf=Ki,Ha.depth=Hn[Nr].depth}else Hn[Nr].holeIds.push(Na),Ha.holeOf=Nr,Ha.depth=Hn[Nr].depth+1}else Ha.holeOf=null,Ha.depth=Hn[Nr].depth}else Ha.holeOf=null,Ha.depth=0;return Ha})(fa[aa],$a,pa),En=function(Yi){Ta[Yi]=!0,Yi<fa.length&&fa[Yi]&&(fa[Yi].outputContourId=pa)},Yn=aa,mr=aa;for(ba.points.push(fa[aa].point);En(Yn),En(Yn=fa[Yn].otherPos),ba.points.push(fa[Yn].point),!((Yn=Oi(Yn,fa,Ta,mr))==mr||Yn>=fa.length)&&fa[Yn];);$a.push(ba)}};for(aa=0,ha=fa.length;aa<ha;aa++)Ia();return $a})((function(ln,aa,ha,fa,Ta,$a){for(var Ia,pa,ba,En=new n(si),Yn=[],mr=Math.min(fa[2],Ta[2]);ln.length!==0;){var Yi=ln.pop();if(Yn.push(Yi),$a===N&&Yi.point[0]>mr||$a===U&&Yi.point[0]>fa[2])break;if(Yi.left){pa=Ia=En.insert(Yi),Ia=Ia!==(ba=En.minNode())?En.prev(Ia):null,pa=En.next(pa);var Hn=Ia?Ia.key:null;if(Z(Yi,Hn,$a),pa&&Vt(Yi,pa.key,ln)===2&&(Z(Yi,Hn,$a),Z(pa.key,Yi,$a)),Ia&&Vt(Ia.key,Yi,ln)===2){var Na=Ia;Z(Hn,(Na=Na!==ba?En.prev(Na):null)?Na.key:null,$a),Z(Yi,Hn,$a)}}else pa=Ia=En.find(Yi=Yi.otherEvent),Ia&&pa&&(Ia=Ia!==ba?En.prev(Ia):null,pa=En.next(pa),En.remove(Yi),pa&&Ia&&Vt(Ia.key,pa.key,ln))}return Yn})(Ni,0,0,hi,fi,bt)),bn=[],kn=0;kn<Bi.length;kn++){var Cn=Bi[kn];if(Cn.isExterior()){for(var Vn=[Cn.points],Qi=0;Qi<Cn.holeIds.length;Qi++)Vn.push(Bi[Cn.holeIds[Qi]].points);bn.push(Vn)}}return bn}var La={UNION:F,DIFFERENCE:U,INTERSECTION:N,XOR:W};r.diff=function(Le,Oe){return wn(Le,Oe,U)},r.intersection=function(Le,Oe){return wn(Le,Oe,N)},r.operations=La,r.union=function(Le,Oe){return wn(Le,Oe,F)},r.xor=function(Le,Oe){return wn(Le,Oe,W)},Object.defineProperty(r,"__esModule",{value:!0})})(Gy.exports)),Gy.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function cf(r,e,n,c){const d=[],g=c===0?(_,S,M,R,N,F)=>{_.push(new Me(F,M+(F-S)/(R-S)*(N-M)))}:(_,S,M,R,N,F)=>{_.push(new Me(S+(F-M)/(N-M)*(R-S),F))};for(const _ of r){const S=[];for(const M of _){if(M.length<=2)continue;const R=[];for(let U=0;U<M.length-1;U++){const W=M[U].x,Z=M[U].y,ee=M[U+1].x,ce=M[U+1].y,oe=c===0?W:Z,me=c===0?ee:ce;oe<e?me>e&&g(R,W,Z,ee,ce,e):oe>n?me<n&&g(R,W,Z,ee,ce,n):R.push(M[U]),me<e&&oe>=e&&g(R,W,Z,ee,ce,e),me>n&&oe<=n&&g(R,W,Z,ee,ce,n)}let N=M[M.length-1];const F=c===0?N.x:N.y;F>=e&&F<=n&&R.push(N),R.length&&(N=R[R.length-1],R[0].x===N.x&&R[0].y===N.y||R.push(R[0]),S.push(R))}S.length&&d.push(S)}return d}function $x(r,e){const n=uf(r),c=uf([e]),d=mm.intersection(n,c);return d==null?[]:_p(d)}function nw(r,e){let c=uf(r,65536);const d=[];for(;e.valid();e.next()){const[g,_]=e.get(),S=g.x*65536,M=g.y*65536,R=_.x*65536,N=_.y*65536,F=R-S,U=N-M,W=Math.hypot(F,U);if(W===0)continue;const Z=Math.trunc(U/W*3),ee=-Math.trunc(F/W*3);d.push([[[S,M],[R,N],[R+Z,N+ee],[S+Z,M+ee],[S,M]]])}return d.length>0&&(c=mm.diff(c,d)),_p(c,1/65536)}function uf(r,e=1){return[r.map((n=>n.map((c=>[c.x*e,c.y*e]))))]}function _p(r,e=1){return r.map((n=>n.map(((c,d)=>{const g=c.map((_=>new Me(_[0]*e,_[1]*e).round()));return d>0&&g.reverse(),g}))))}class x_{constructor(e,n){this.layoutVertexArray=new Pc,this.indexArray=new Zr,this.lineIndexArray=new kl,this.triangleSegments=new ir,this.lineSegments=new ir,this.programConfigurations=new Lc(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,n&&(this.elevatedLayoutVertexArray=new wl)}update(e,n,c,d,g,_,S,M){this.programConfigurations.updatePaintArrays(e,n,g,c,d,_,S,M)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Oy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Ny.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,n,c,d,g,_,S){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,d,g,_,void 0,S)}}class yp{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new x_(e,!1),this.elevationBufferData=new x_(e,!0),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,d){}populate(e,n,c,d){this.hasPattern=Vy("fill",this.layers,this.pixelRatio,n);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:S,id:M,index:R,sourceLayerIndex:N}of e){const F=this.layers[0]._featureFilter.needGeometry,U=it(S,F);if(!this.layers[0]._featureFilter.filter(new Fa(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),U,c))continue;const W=g?g.evaluate(U,{},c,n.availableImages):void 0,Z={id:M,properties:S.properties,type:S.type,sourceLayerIndex:N,index:R,geometry:F?U.geometry:Ge(S,c,d),patterns:{},sortKey:W};_.push(Z)}g&&_.sort(((S,M)=>S.sortKey-M.sortKey));for(const S of _){const{geometry:M,index:R,sourceLayerIndex:N}=S;if(this.hasPattern){const F=Hy("fill",this.layers,S,this.zoom,this.pixelRatio,n);this.patternFeatures.push(F)}else this.addFeature(S,M,R,c,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(e[R].feature,M,R,N,this.index)}}update(e,n,c,d,g,_,S){this.bufferData.update(e,n,c,d,g,_,S,this.worldview),this.elevationBufferData.update(e,n,c,d,g,_,S,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,n,c,d,g,_,S,this.worldview)}addFeatures(e,n,c,d,g,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,n,c,d,_,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,n,c,d,g,_=[],S,M){const R=kg(n,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,R,d,c,M):this.addGeometry(R,this.bufferData),this.bufferData.populatePaintArrays(e,c,g,_,d,S,this.worldview),this.elevationBufferData.populatePaintArrays(e,c,g,_,d,S,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,n,c,d,g){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(n,c,d,g,this.worldview))}addElevatedRoadFeature(e,n,c,d,g){const _=new Array,S=ua.getElevationFeature(e,g);if(!S)return void this.addGeometry(n,this.bufferData);{const R=this.clipPolygonsToTile(n,1);R.length>0&&_.push({polygons:R,elevationFeature:S,elevationTileID:c})}const M={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},c),featureIndex:d};for(const R of _)if(R.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Kl(R.elevationTileID,this.layers,this.zoom,this.lut));const F=R.elevationFeature.isTunnel();let U=0;e.properties.hasOwnProperty(ft)&&(U=+e.properties[ft]);for(const W of R.polygons)this.elevatedStructures.addPortalCandidates(R.elevationFeature.id,W,F,R.elevationFeature,U)}R.elevationFeature.constantHeight==null&&(R.polygons=this.prepareElevatedPolygons(R.polygons,R.elevationFeature,R.elevationTileID));const N=new va(c,R.elevationTileID);this.addElevatedGeometry(R.polygons,N,R.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,M)}}addElevatedGeometry(e,n,c,d,g,_){const S={elevation:c,elevationSampler:n,bias:d,index:g,featureInfo:_},[M,R]=this.addGeometry(e,this.elevationBufferData,S);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:M,max:R}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,M),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,R))}addGeometry(e,n,c){let d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,_=null;c&&(_=c.elevationSampler.constantElevation(c.elevation,c.bias),_!=null&&(d=_,g=_));const S=(M,R,N)=>{if(c!=null)if(R.push(M),_!=null)n.elevatedLayoutVertexArray.emplaceBack(_),N.push(_);else{const F=c.elevationSampler.pointElevation(M,c.elevation,c.bias);n.elevatedLayoutVertexArray.emplaceBack(F),N.push(F),d=Math.min(d,F),g=Math.max(g,F)}};for(const M of e){let R=0;for(const ve of M)R+=ve.length;const N=n.triangleSegments.prepareSegment(R,n.layoutVertexArray,n.indexArray),F=N.vertexLength,U=[],W=[],Z=[],ee=[],ce=[],oe=n.layoutVertexArray.length;for(const ve of M){if(ve.length===0)continue;ve!==M[0]&&W.push(U.length/2);const Se=n.lineSegments.prepareSegment(ve.length,n.layoutVertexArray,n.lineIndexArray),De=Se.vertexLength;c&&ce.push(n.layoutVertexArray.length-oe),S(ve[0],Z,ee),n.layoutVertexArray.emplaceBack(ve[0].x,ve[0].y),n.lineIndexArray.emplaceBack(De+ve.length-1,De),U.push(ve[0].x),U.push(ve[0].y);for(let Re=1;Re<ve.length;Re++)S(ve[Re],Z,ee),n.layoutVertexArray.emplaceBack(ve[Re].x,ve[Re].y),n.lineIndexArray.emplaceBack(De+Re-1,De+Re),U.push(ve[Re].x),U.push(ve[Re].y);Se.vertexLength+=ve.length,Se.primitiveLength+=ve.length}const me=hm(U,W);for(let ve=0;ve<me.length;ve+=3)n.indexArray.emplaceBack(F+me[ve],F+me[ve+1],F+me[ve+2]);if(me.length>0&&c&&this.elevationMode==="hd-road-base"){const ve=c.elevation.isTunnel(),Se=c.elevation.safeArea,De=this.elevatedStructures.addVertices(Z,ee);this.elevatedStructures.addTriangles(me,De,ve);const Re=ce.length;if(Re>0){for(let $e=0;$e<Re-1;$e++)this.elevatedStructures.addRenderableRing(c.index,ce[$e]+De,ce[$e+1]-ce[$e],ve,Se,c.featureInfo);this.elevatedStructures.addRenderableRing(c.index,ce[Re-1]+De,Z.length-ce[Re-1],ve,Se,c.featureInfo)}}N.vertexLength+=R,N.primitiveLength+=me.length/3}return[d,g]}prepareElevatedPolygons(e,n,c){const d=1/de(c),g=[];for(const _ of e){const S=nw(_,new ta(n,d));g.push(...S)}return g}clipPolygonsToTile(e,n){const c=-n,d=-n,g=Jt+n,_=Jt+n;let S=0;const M=[],R=[];for(;S<e.length;S++){const U=e[S],W=zs(U);(W.min.x>=c&&W.max.x<=g&&W.min.y>=d&&W.max.y<=_?M:R).push(U)}if(M.length===e.length)return e;const N=[new Me(c,d),new Me(g,d),new Me(g,_),new Me(c,_),new Me(c,d)],F=M;for(const U of R)F.push(...$x(U,N));return F}}let b_,w_,Eg,qy;vi(yp,"FillBucket",{omit:["layers","patternFeatures"]}),vi(x_,"FillBufferData"),vi(Kl,"ElevatedStructures");class Ag{constructor(e,n,c,d){if(this.triangleCount=n.length/3,this.min=new Me(0,0),this.max=new Me(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[g,_]=[e[0].clone(),e[0].clone()];for(let F=1;F<e.length;++F){const U=e[F];g.x=Math.min(g.x,U.x),g.y=Math.min(g.y,U.y),_.x=Math.max(_.x,U.x),_.y=Math.max(_.y,U.y)}if(d){const F=Math.ceil(Math.max(_.x-g.x,_.y-g.y)/d);c=Math.max(c,F)}if(c===0)return;this.min=g,this.max=_;const S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);const M=Math.max(S.x,S.y)/c;this.cellsX=Math.max(1,Math.ceil(S.x/M)),this.cellsY=Math.max(1,Math.ceil(S.y/M)),this.xScale=1/M,this.yScale=1/M;const R=[];for(let F=0;F<this.triangleCount;F++){const U=e[n[3*F+0]].sub(this.min),W=e[n[3*F+1]].sub(this.min),Z=e[n[3*F+2]].sub(this.min),ee=Rd(Math.floor(Math.min(U.x,W.x,Z.x)),this.xScale,this.cellsX),ce=Rd(Math.floor(Math.max(U.x,W.x,Z.x)),this.xScale,this.cellsX),oe=Rd(Math.floor(Math.min(U.y,W.y,Z.y)),this.yScale,this.cellsY),me=Rd(Math.floor(Math.max(U.y,W.y,Z.y)),this.yScale,this.cellsY),ve=new Me(0,0),Se=new Me(0,0),De=new Me(0,0),Re=new Me(0,0);for(let $e=oe;$e<=me;++$e){ve.y=Se.y=$e*M,De.y=Re.y=($e+1)*M;for(let We=ee;We<=ce;++We)ve.x=De.x=We*M,Se.x=Re.x=(We+1)*M,(ks(U,W,Z,ve,Se,Re)||ks(U,W,Z,ve,Re,De))&&R.push({cellIdx:$e*this.cellsX+We,triIdx:F})}}if(R.length===0)return;R.sort(((F,U)=>F.cellIdx-U.cellIdx||F.triIdx-U.triIdx));let N=0;for(;N<R.length;){const F=R[N].cellIdx,U={start:this.payload.length,len:0};for(;N<R.length&&R[N].cellIdx===F;)++U.len,this.payload.push(R[N++].triIdx);this.cells[F]=U}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const c=Rd(e.x-this.min.x,this.xScale,this.cellsX),d=Rd(e.y-this.min.y,this.yScale,this.cellsY),g=this.cells[d*this.cellsX+c];if(g){this._lazyInitLookup();for(let _=0;_<g.len;_++){const S=this.payload[g.start+_],M=Math.floor(S/8),R=1<<S%8;if(!(this.lookup[M]&R)&&(this.lookup[M]|=R,n.push(S),n.length===this.triangleCount))return}}}query(e,n,c){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const d=Rd(e.x-this.min.x,this.xScale,this.cellsX),g=Rd(n.x-this.min.x,this.xScale,this.cellsX),_=Rd(e.y-this.min.y,this.yScale,this.cellsY),S=Rd(n.y-this.min.y,this.yScale,this.cellsY);for(let M=_;M<=S;M++)for(let R=d;R<=g;R++){const N=this.cells[M*this.cellsX+R];if(N)for(let F=0;F<N.len;F++){const U=this.payload[N.start+F],W=Math.floor(U/8),Z=1<<U%8;if(!(this.lookup[W]&Z)&&(this.lookup[W]|=Z,c.push(U),c.length===this.triangleCount))return}}}}function Rd(r,e,n){return Math.max(0,Math.min(n-1,Math.floor(r*e)))}vi(Ag,"TriangleGridIndex");class Wy{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){for(const c of this.footprints)n.push({footprint:c,id:e})}updateAppearances(e,n,c,d){}populate(e,n,c,d){const g=[];for(const{feature:_,id:S,index:M,sourceLayerIndex:R}of e){const N=this.layers[0]._featureFilter.needGeometry,F=it(_,N);if(!this.layers[0]._featureFilter.filter(new Fa(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),F,c))continue;const U={id:S,properties:_.properties,type:_.type,sourceLayerIndex:R,index:M,geometry:N?F.geometry:Ge(_,c,d),patterns:{}};g.push(U)}for(const _ of g){const{geometry:S,index:M,sourceLayerIndex:R}=_;this.addFeature(_,S,M,c,{},n.availableImages,n.brightness),n.featureIndex.insert(e[M].feature,S,M,R,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,c,d,g,_,S){}destroy(){}addFeature(e,n,c,d,g,_=[],S){for(const M of kg(n,2)){const R=[],N=[],F=[],U=new Me(1/0,1/0),W=new Me(-1/0,-1/0);for(const ce of M)if(ce.length!==0){ce!==M[0]&&F.push(N.length/2);for(let oe=0;oe<ce.length;oe++)N.push(ce[oe].x),N.push(ce[oe].y),R.push(ce[oe]),U.x=Math.min(U.x,ce[oe].x),U.y=Math.min(U.y,ce[oe].y),W.x=Math.max(W.x,ce[oe].x),W.y=Math.max(W.y,ce[oe].y)}const Z=hm(N,F),ee=new Ag(R,Z,8,256);this.footprints.push({vertices:R,indices:Z,grid:ee,min:U,max:W})}}}vi(Wy,"ClipBucket",{omit:["layers"]});const Cg=Ln([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),aw=Ln([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),rw=Ln([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),sw=Ln([{name:"a_centroid_pos",components:2,type:"Uint16"}]),S_=Ln([{name:"a_join_normal_inside",components:3,type:"Int16"}]),T_=Ln([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Zy=Ln([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ow}=Cg,dh=Number.MAX_SAFE_INTEGER,Vx=dh-1;function Xy(r,e,n,c){return r.order<e||r.order===dh||!(r.clipMask&n)||(function(d,g){return g.length!==0&&g.find((_=>_===d))===void 0})(c,r.clipScope)}function Mg(r,e){return r.x-e.x||r.y-e.y}function Yy(r,e){return Mg(r.min,e.min)===0&&Mg(r.max,e.max)===0}function k_(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function vp(r,e){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(r[n].sourceId!==e[n].sourceId||!Yy(r[n],e[n])||r[n].order!==e[n].order||r[n].clipMask!==e[n].clipMask||!Rt(r[n].clipScope,e[n].clipScope))return!1;return!0}function Ky(r,e,n){const c=1/Jt,d=1/(1<<n.canonical.z),g=(e.x*c+n.canonical.x)*d+n.wrap,_=(e.y*c+n.canonical.y)*d;return{min:new Me((r.x*c+n.canonical.x)*d+n.wrap,(r.y*c+n.canonical.y)*d),max:new Me(g,_)}}function E_(r,e,n){const c=1<<n.canonical.z,d=((e.x-n.wrap)*c-n.canonical.x)*Jt,g=(e.y*c-n.canonical.y)*Jt;return{min:new Me(((r.x-n.wrap)*c-n.canonical.x)*Jt,(r.y*c-n.canonical.y)*Jt),max:new Me(d,g)}}function Jy(r,e,n,c,d,g,_){const S=r.indices,M=r.vertices,R=[];for(let N=c;N<c+d;N+=3){const F=e[n[N+0]+g],U=e[n[N+1]+g],W=e[n[N+2]+g],Z=Math.min(F.x,U.x,W.x),ee=Math.max(F.x,U.x,W.x),ce=Math.min(F.y,U.y,W.y),oe=Math.max(F.y,U.y,W.y);R.length=0,r.grid.query(new Me(Z,ce),new Me(ee,oe),R);for(let me=0;me<R.length;me++){const ve=R[me];if(ks(M[S[3*ve+0]],M[S[3*ve+1]],M[S[3*ve+2]],F,U,W,_))return!0}}return!1}function Hx(r,e,n,c){if(!r||!n)return!1;let d=r.vertices;if(!e.canonical.equals(c.canonical)||e.wrap!==c.wrap){if(n.vertices.length<r.vertices.length)return Hx(n,c,r,e);const g=e.canonical,_=c.canonical,S=Math.pow(2,_.z-g.z);d=r.vertices.map((M=>new Me((M.x+g.x*Jt)*S-_.x*Jt,(M.y+g.y*Jt)*S-_.y*Jt)))}return Jy(n,d,r.indices,0,r.indices.length,0,0)}function A_(r,e,n,c){const d=Math.pow(2,c.z-n.z);return new Me((r+n.x*Jt)*d-c.x*Jt,(e+n.y*Jt)*d-c.y*Jt)}function C_(r,e){const n=[];e.grid.queryPoint(r,n);const c=e.indices,d=e.vertices;for(let g=0;g<n.length;g++){const _=n[g];if(Ra([d[c[3*_+0]],d[c[3*_+1]],d[c[3*_+2]]],r))return!0}return!1}const xp=[new Me(0,0),new Me(Jt,0),new Me(Jt,Jt),new Me(0,Jt)];function M_(r,e){const n=[];let c=[];if(!e||r.length<2)return[r];if(r.length===2)return Ns(r[0],r[1],xp)?[r]:[];for(let d=0;d<r.length+2;d++){const g=r[d%r.length],_=r[(d+1)%r.length],S=Ns(d===0?r[r.length-1]:r[(d-1)%r.length],g,xp),M=Ns(g,_,xp),R=S||M;R&&c.push(g),R&&M||c.length>0&&(c.length>1&&n.push(c),c=[])}return c.length>1&&n.push(c),n}const P_=Ke.types,Qy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],df=["fill-extrusion-flood-light-ground-radius"],hf=Math.pow(2,13),ff=Math.pow(2,15)-1,bp=new Me(0,1),Fc=2147483648,hh=7,Gx=450;function wp(r,e,n,c,d,g,_,S){r.emplaceBack((e<<1)+_,(n<<1)+g,(Math.floor(c*hf)<<1)+d,Math.round(S))}function fh(r,e,n){r.emplaceBack(e.x*Jt,e.y*Jt,n?1:0)}function j_(r,e,n,c,d,g){r.emplaceBack(e.x,e.y,(n.x<<1)+c,(n.y<<1)+d,g)}function Sp(r,e,n){r.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Pg{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ev{constructor(){this.centroidXY=new Me(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Me(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Me(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Me(this.max.x-this.min.x,this.max.y-this.min.y)}}class qx{constructor(){this.acc=new Me(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,c){this.accCount++,this.acc._add(n);let d=!!this.borders;n.x<e.min.x?(e.min.x=n.x,d=!0):n.x>e.max.x&&(e.max.x=n.x,d=!0),n.y<e.min.y?(e.min.y=n.y,d=!0):n.y>e.max.y&&(e.max.y=n.y,d=!0),((n.x===0||n.x===Jt)&&n.x===c.x)!=((n.y===0||n.y===Jt)&&n.y===c.y)&&this.processBorderOverlap(n,c),d&&this.checkBorderIntersection(n,c)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Gi(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Jt!=e.x>Jt&&this.addBorderIntersection(1,Gi(n.y,e.y,(Jt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Gi(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Jt!=e.y>Jt&&this.addBorderIntersection(3,Gi(n.x,e.x,(Jt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[e];n<c[0]&&(c[0]=n),n>c[1]&&(c[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const c=e.x===0?0:1;this.addBorderIntersection(c,n.y),this.addBorderIntersection(c,e.y)}else{const c=e.y===0?2:3;this.addBorderIntersection(c,n.x),this.addBorderIntersection(c,e.x)}}centroid(){return this.accCount===0?new Me(0,0):new Me(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,n)=>e+ +(n[0]!==Number.MAX_VALUE)),0):0}}function jg(r,e){const n=r.add(e)._unit(),c=ne(r.x*n.x+r.y*n.y,-1,1);var d,g,_;return d=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(d)))/4*ff*((g=r).x*(_=e).y-g.y*_.x<0?-1:1)}const R_=[r=>r.x<0,r=>r.x>Jt,r=>r.y<0,r=>r.y>Jt];function Wx(r,e,n,c){const d=[4];if(c===0)return d;n._mult(c);const g=r.sub(n),_=e.sub(n),S=[r,e,g,_];for(let M=0;M<4;M++)for(const R of S)if(R_[M](R)){d.push(M);break}return d}class pm{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new lc,this.indexArray=new Zr,this.programConfigurations=new Lc(e.layers,{zoom:e.zoom,lut:e.lut},(n=>df.includes(n))),this._segments=new ir,this.hiddenByLandmarkVertexArray=new im,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ir}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,c,d=!1){const g=e.length;if(g>2){let _=Math.max(0,this._segments.get().length-1);const S=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let M;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const R=e[0],N=e[1];M=jg(R.sub(e[g-1])._perp()._unit(),N.sub(R)._perp()._unit())}for(let R=0;R<g;R++){const N=R===g-1?0:R+1,F=e[R],U=e[N],W=e[N===g-1?0:N+1],Z=U.sub(F)._perp()._unit(),ee=jg(Z,W.sub(U)._perp()._unit()),ce=M,oe=ee;if(kp(F,U,n)||d&&h(F,n)&&h(U,n)){M=ee;continue}const me=S.vertexLength;j_(this.vertexArray,F,U,1,1,ce),j_(this.vertexArray,F,U,1,0,ce),j_(this.vertexArray,F,U,0,1,oe),j_(this.vertexArray,F,U,0,0,oe),S.vertexLength+=4;const ve=Wx(F,U,Z,c);for(const Se of ve)this._segmentToGroundQuads[_].push({id:me,region:Se}),this._segmentToRegionTriCounts[_][Se]+=2,S.primitiveLength+=2;M=ee}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let c=0;c<n;c++)this._segmentToGroundQuads[c].sort(((d,g)=>d.region-g.region));for(let c=0;c<n;c++){const d=this._segmentToGroundQuads[c],g=e[c],_=this._segmentToRegionTriCounts[c];_.reduce(((M,R)=>M+R),0);let S=0;for(let M=0;M<=4;M++){const R=_[M];if(R!==0){let N=this.regionSegments[M];N||(N=this.regionSegments[M]=new ir);const F={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+S,vertexLength:g.vertexLength,primitiveLength:R};N.get().push(F)}S+=R}for(let M=0;M<d.length;M++){const R=d[M].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,c,d,g,_,S){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,c,d,g,_,void 0,S)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,aw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,rw.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,c,d,g,_,S,M){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,c,d,g,_,S,M)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Fc))}updateHiddenByLandmarkRange(e,n,c){if(!this.hasData())return;const d=n+e;if(n!==0){for(let g=e;g<d;++g)this.hiddenByLandmarkVertexArray.emplace(g,c?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,T_.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class Tp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Zr,this.footprintVertices=new Pc,this.footprintSegments=[],this.layoutVertexArray=new ah,this.centroidVertexArray=new sm,this.wallVertexArray=new Kh,this.indexArray=new Zr,this.programConfigurations=new Lc(e.layers,{zoom:e.zoom,lut:e.lut},(n=>Qy.includes(n))),this.segments=new ir,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.groundEffect=new pm(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,d){}populate(e,n,c,d){this.features=[],this.hasPattern=Vy("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=de(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:_,index:S,sourceLayerIndex:M}of e){const R=this.layers[0]._featureFilter.needGeometry,N=it(g,R);if(!this.layers[0]._featureFilter.filter(new Fa(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),N,c))continue;const F={id:_,sourceLayerIndex:M,index:S,geometry:R?N.geometry:Ge(g,c,d),properties:g.properties,type:g.type,patterns:{}},U=this.layoutVertexArray.length,W=P_[F.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:Hy("fill-extrusion",this.layers,F,this.zoom,this.pixelRatio,n)});else if(this.wallMode)for(const Z of F.geometry)for(const ee of M_(Z,W))this.addFeature(g.id,F,[ee],S,c,{},n.availableImages,d,n.brightness);else this.addFeature(g.id,F,F.geometry,S,c,{},n.availableImages,d,n.brightness);n.featureIndex.insert(g,F.geometry,S,M,this.index,U)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,c,d,g,_){for(const{featureId:S,feature:M}of this.features){const R=P_[M.type]==="Polygon",{geometry:N}=M;if(this.wallMode)for(const F of N)for(const U of M_(F,R))this.addFeature(S,M,[U],M.index,n,c,d,g,_);else this.addFeature(S,M,N,M.index,n,c,d,g,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,c,d,g,_,S){this.programConfigurations.updatePaintArrays(e,n,g,c,d,_,S,this.worldview),this.groundEffect.update(e,n,g,c,d,_,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ow),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,S_.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Zy.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,sw.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,c,d,g,_,S,M,R){const N=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,F=[new Me(0,0),new Me(Jt,Jt)],U=M.projection,W=U.name==="globe",Z=this.wallMode||P_[n.type]==="Polygon",ee=new qx;ee.centroidDataIndex=this.centroidData.length;const ce=new ev;ce.buildingId=e,n.properties&&n.properties.hasOwnProperty("building_id")&&(ce.buildingId=n.properties.building_id);const oe=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},g)<=0,me=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},g);let ve;if(ce.height=me,ce.vertexArrayOffset=this.layoutVertexArray.length,ce.groundVertexArrayOffset=this.groundEffect.vertexArray.length,W&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gs),this.wallMode){if(W)return void mi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(c.length!==1)return;ve=(function(nt){const xt=nt[0].x===nt[nt.length-1].x&&nt[0].y===nt[nt.length-1].y;(function(bi){let Mi=0;const jn=bi.length;for(let ni=0;ni<jn;ni++)Mi+=(bi[(ni+1)%jn].x-bi[ni].x)*(bi[(ni+1)%jn].y+bi[ni].y);return Mi>=0})(nt)||(nt=nt.reverse());const Pt={geometry:[],joinNormals:[],indices:[]},Gt=[],Wt=[],Ut=[];let $t=nt.length;for(;$t>=2&&nt[$t-1].equals(nt[$t-2]);)$t--;if($t<(xt?3:2))return Pt;let vt,yt,Vt,si,Qt,Oi=0;for(;Oi<$t-1&&nt[Oi].equals(nt[Oi+1]);)Oi++;xt&&(vt=nt[$t-2],Qt=nt[Oi].sub(vt)._unit()._perp());for(let bi=Oi;bi<$t;bi++){if(Vt=bi===$t-1?xt?nt[Oi+1]:void 0:nt[bi+1],Vt&&nt[bi].equals(Vt))continue;Qt&&(si=Qt),vt&&(yt=vt),vt=nt[bi],Qt=Vt?Vt.sub(vt)._unit()._perp():si,si=si||Qt;let Mi=si.add(Qt);Mi.x===0&&Mi.y===0||Mi._unit();const jn=Mi.x*Qt.x+Mi.y*Qt.y,ni=jn!==0?1/jn:1/0,Li=si.x*Qt.y-si.y*Qt.x>0;let dn="miter";const Wn=2;dn==="miter"&&ni>Wn&&(dn="bevel"),dn==="bevel"&&(ni>100&&(dn="flipbevel"),ni<Wn&&(dn="miter"));const Kn=(wn,La,Le,Oe)=>{const bt=new Me(wn.x,wn.y),qt=new Me(wn.x,wn.y);bt.x+=La.x*Oe,bt.y+=La.y*Oe,qt.x-=La.x*Math.max(Le,1),qt.y-=La.y*Math.max(Le,1),Ut.push(La),Gt.push(bt),Wt.push(qt)};if(dn==="miter")Mi._mult(ni),Kn(vt,Mi,0,0);else if(dn==="flipbevel")Mi=Qt.mult(-1),Kn(vt,Mi,0,0),Kn(vt,Mi.mult(-1),0,0);else{const wn=-Math.sqrt(ni*ni-1),La=Li?wn:0,Le=Li?0:wn;yt&&Kn(vt,si,La,Le),Vt&&Kn(vt,Qt,La,Le)}}Pt.geometry=[...Gt,...Wt.reverse(),Gt[0]],Pt.joinNormals=[...Ut,...Ut.reverse(),Ut[Ut.length-1]];const pi=Pt.geometry.length-1;for(let bi=0;bi<pi/2;bi++)if(bi+1<pi/2){let Mi=bi,jn=bi+1,ni=pi-1-bi,Li=pi-2-bi;Mi=Mi===0?pi-1:Mi-1,jn=jn===0?pi-1:jn-1,ni=ni===0?pi-1:ni-1,Li=Li===0?pi-1:Li-1,Pt.indices.push(ni),Pt.indices.push(jn),Pt.indices.push(Mi),Pt.indices.push(ni),Pt.indices.push(Li),Pt.indices.push(jn)}return Pt})(c[0]),c=[ve.geometry]}const Se=(nt,xt)=>nt<(xt.length-1)/2||nt===xt.length-1,De=this.wallMode?[c]:kg(c,500);for(let nt=De.length-1;nt>=0;nt--){const xt=De[nt];(xt.length===0||(Re=xt[0]).every((Mt=>Mt.x<=0))||Re.every((Mt=>Mt.x>=Jt))||Re.every((Mt=>Mt.y<=0))||Re.every((Mt=>Mt.y>=Jt)))&&De.splice(nt,1)}var Re;let $e;if(W)$e=q(De,F,g);else{$e=[];for(const nt of De)$e.push({polygon:nt,bounds:F})}const We=Z?this.edgeRadius:0,tt=We>0&&this.zoom<17,_t=(nt,xt)=>{if(nt.length===0)return!1;const Mt=nt[nt.length-1];return xt.x===Mt.x&&xt.y===Mt.y};for(const{polygon:nt,bounds:xt}of $e){let Mt=0,Pt=0;for(const $t of nt)Z&&!$t[0].equals($t[$t.length-1])&&$t.push($t[0]),Pt+=Z?$t.length-1:$t.length;const Gt=this.segments.prepareSegment((Z?5:4)*Pt,this.layoutVertexArray,this.indexArray);ce.footprintSegIdx<0&&(ce.footprintSegIdx=this.footprintSegments.length),ce.polygonSegIdx<0&&(ce.polygonSegIdx=this.polygonSegments.length);const Wt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ut=new Pg;if(Ut.vertexOffset=this.footprintVertices.length,Ut.indexOffset=3*this.footprintIndices.length,Ut.ringIndices=[],Z){const $t=[],vt=[];Mt=Gt.vertexLength;for(let Vt=0;Vt<nt.length;Vt++){const si=nt[Vt];si.length&&Vt!==0&&vt.push($t.length/2);const Qt=[];let Oi,pi;Oi=si[1].sub(si[0])._perp()._unit(),Ut.ringIndices.push(si.length-1);for(let bi=1;bi<si.length;bi++){const Mi=si[bi],jn=si[bi===si.length-1?1:bi+1],ni=Mi.clone();if(We){pi=jn.sub(Mi)._perp()._unit();const Li=Oi.add(pi)._unit(),dn=We*Math.min(4,1/(Oi.x*Li.x+Oi.y*Li.y));ni.x+=dn*Li.x,ni.y+=dn*Li.y,ni.x=Math.round(ni.x),ni.y=Math.round(ni.y),Oi=pi}if(!oe||We!==0&&!tt||_t(Qt,ni)||Qt.push(ni),wp(this.layoutVertexArray,ni.x,ni.y,0,0,1,1,0),this.wallMode){const Li=Se(bi,si);fh(this.wallVertexArray,ve.joinNormals[bi],!Li)}Gt.vertexLength++,this.footprintVertices.emplaceBack(Mi.x,Mi.y),$t.push(Mi.x,Mi.y),W&&Sp(this.layoutVertexExtArray,U.projectTilePoint(ni.x,ni.y,g),U.upVector(g,ni.x,ni.y))}oe&&(We===0||tt)&&(Qt.length!==0&&_t(Qt,Qt[0])&&Qt.pop(),this.groundEffect.addData(Qt,xt,N))}const yt=this.wallMode?ve.indices:hm($t,vt);for(let Vt=0;Vt<yt.length;Vt+=3)this.footprintIndices.emplaceBack(Ut.vertexOffset+yt[Vt+0],Ut.vertexOffset+yt[Vt+1],Ut.vertexOffset+yt[Vt+2]),this.indexArray.emplaceBack(Mt+yt[Vt],Mt+yt[Vt+2],Mt+yt[Vt+1]),Gt.primitiveLength++;Ut.indexCount+=yt.length,Ut.vertexCount+=this.footprintVertices.length-Ut.vertexOffset}for(let $t=0;$t<nt.length;$t++){const vt=nt[$t];ee.startRing(ce,vt[0]);let yt=vt.length>4&&v(vt[vt.length-2],vt[0],vt[1]),Vt=We?Zx(vt[vt.length-2],vt[0],vt[1],We):0;const si=[];let Qt,Oi,pi;Oi=vt[1].sub(vt[0])._perp()._unit();let bi=!0;for(let Mi=1,jn=0;Mi<vt.length;Mi++){let ni=vt[Mi-1],Li=vt[Mi];const dn=vt[Mi===vt.length-1?1:Mi+1];if(ee.appendEdge(ce,Li,ni),kp(Li,ni,xt)){We&&(Oi=dn.sub(Li)._perp()._unit(),bi=!bi);continue}const Wn=Li.sub(ni)._perp(),Kn=Wn.x/(Math.abs(Wn.x)+Math.abs(Wn.y)),wn=Wn.y>0?1:0,La=ni.dist(Li);if(jn+La>32768&&(jn=0),We){pi=dn.sub(Li)._perp()._unit();let qt=Xx(ni,Li,dn,Rg(Oi,pi),We);isNaN(qt)&&(qt=0);const hi=Li.sub(ni)._unit();ni=ni.add(hi.mult(Vt))._round(),Li=Li.add(hi.mult(-qt))._round(),Vt=qt,Oi=pi,oe&&this.zoom>=17&&(_t(si,ni)||si.push(ni),_t(si,Li)||si.push(Li))}const Le=Gt.vertexLength,Oe=vt.length>4&&v(ni,Li,dn);let bt=k(jn,yt,bi);if(wp(this.layoutVertexArray,ni.x,ni.y,Kn,wn,0,0,bt),wp(this.layoutVertexArray,ni.x,ni.y,Kn,wn,0,1,bt),this.wallMode){const qt=Se(Mi-1,vt),hi=ve.joinNormals[Mi-1];fh(this.wallVertexArray,hi,qt),fh(this.wallVertexArray,hi,qt)}if(jn+=La,bt=k(jn,Oe,!bi),yt=Oe,wp(this.layoutVertexArray,Li.x,Li.y,Kn,wn,0,0,bt),wp(this.layoutVertexArray,Li.x,Li.y,Kn,wn,0,1,bt),this.wallMode){const qt=Se(Mi,vt),hi=ve.joinNormals[Mi];fh(this.wallVertexArray,hi,qt),fh(this.wallVertexArray,hi,qt)}if(Gt.vertexLength+=4,this.indexArray.emplaceBack(Le+0,Le+1,Le+2),this.indexArray.emplaceBack(Le+1,Le+3,Le+2),Gt.primitiveLength+=2,We){const qt=Mt+(Mi===1?vt.length-2:Mi-2),hi=Mi===1?Mt:qt+1;if(this.indexArray.emplaceBack(Le+1,qt,Le+3),this.indexArray.emplaceBack(qt,hi,Le+3),Gt.primitiveLength+=2,Qt===void 0&&(Qt=Le),!kp(dn,vt[Mi],xt)){const fi=Mi===vt.length-1?Qt:Gt.vertexLength;this.indexArray.emplaceBack(Le+2,Le+3,fi),this.indexArray.emplaceBack(Le+3,fi+1,fi),this.indexArray.emplaceBack(Le+3,hi,fi+1),Gt.primitiveLength+=3}bi=!bi}if(W){const qt=this.layoutVertexExtArray,hi=U.projectTilePoint(ni.x,ni.y,g),fi=U.projectTilePoint(Li.x,Li.y,g),Ni=U.upVector(g,ni.x,ni.y),Bi=U.upVector(g,Li.x,Li.y);Sp(qt,hi,Ni),Sp(qt,hi,Ni),Sp(qt,fi,Bi),Sp(qt,fi,Bi)}}Z&&(Mt+=vt.length-1),oe&&We&&this.zoom>=17&&(si.length!==0&&_t(si,si[0])&&si.pop(),this.groundEffect.addData(si,xt,N,We>0))}this.footprintSegments.push(Ut),Wt.triangleCount=this.indexArray.length-Wt.triangleArrayOffset,this.polygonSegments.push(Wt),++ce.footprintSegLen,++ce.polygonSegLen}if(ce.vertexCount=this.layoutVertexArray.length-ce.vertexArrayOffset,ce.groundVertexCount=this.groundEffect.vertexArray.length-ce.groundVertexArrayOffset,ce.vertexCount!==0){if(ce.centroidXY=ee.borders?bp:this.encodeCentroid(ee,ce),this.centroidData.push(ce),ee.borders){this.featuresOnBorder.push(ee);const nt=this.featuresOnBorder.length-1;for(let xt=0;xt<ee.borders.length;xt++)ee.borders[xt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[xt].push(nt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,_,S,g,R,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(n,d,_,S,g,R,this.worldview),this.maxHeight=Math.max(this.maxHeight,me)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((n,c)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[c].borders[e][0]))}splitToSubtiles(){const e=[];for(let S=0;S<this.centroidData.length;S++){const M=this.centroidData[S],R=+(M.min.y+M.max.y>Jt),N=2*R+(+(M.min.x+M.max.x>Jt)^R);for(let F=0;F<M.polygonSegLen;F++){const U=M.polygonSegIdx+F;e.push({centroidIdx:S,subtile:N,polygonSegmentIdx:U,triangleSegmentIdx:this.polygonSegments[U].triangleSegIdx})}}const n=new Zr;e.sort(((S,M)=>S.triangleSegmentIdx===M.triangleSegmentIdx?S.subtile-M.subtile:S.triangleSegmentIdx-M.triangleSegmentIdx));let c=0,d=0,g=0;for(const S of e){if(S.triangleSegmentIdx!==c)break;g++}const _=e.length;for(;d!==e.length;){c=e[d].triangleSegmentIdx;let S=0,M=d,R=d;for(let N=M;N<g&&e[N].subtile===S;N++)R++;for(;M!==g;){const N=e[M];S=N.subtile;const F=this.centroidData[N.centroidIdx].min.clone(),U=this.centroidData[N.centroidIdx].max.clone(),W={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Z=M;Z<R;Z++){const ee=e[Z],ce=this.polygonSegments[ee.polygonSegmentIdx],oe=this.centroidData[ee.centroidIdx].min,me=this.centroidData[ee.centroidIdx].max,ve=this.indexArray.uint16;for(let Se=ce.triangleArrayOffset;Se<ce.triangleArrayOffset+ce.triangleCount;Se++)n.emplaceBack(ve[3*Se],ve[3*Se+1],ve[3*Se+2]);W.primitiveLength+=ce.triangleCount,F.x=Math.min(F.x,oe.x),F.y=Math.min(F.y,oe.y),U.x=Math.max(U.x,me.x),U.y=Math.max(U.y,me.y)}W.primitiveLength>0&&this.triangleSubSegments.push({segment:W,min:F,max:U}),M=R;for(let Z=M;Z<g&&e[Z].subtile===e[M].subtile;Z++)R++}d=g;for(let N=d;N<_&&e[N].triangleSegmentIdx===e[d].triangleSegmentIdx;N++)g++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,c){const d=new ir;if(this.wallMode){for(const ee of this.triangleSubSegments)d.segments.push(ee.segment);return d}let g=0,_=0;const S=1<<e.canonical.z;if(n){const ee=n.getMinMaxForTile(e);ee&&(g=ee.min,_=ee.max)}_+=this.maxHeight;const M=e.toUnwrapped();let R;const N=[M.canonical.x/S+M.wrap,M.canonical.y/S],F=[(M.canonical.x+1)/S+M.wrap,(M.canonical.y+1)/S],U=(ee,ce,oe)=>[ee[0]*(1-oe[0])+ce[0]*oe[0],ee[1]*(1-oe[1])+ce[1]*oe[1]],W=[],Z=[];for(const ee of this.triangleSubSegments){W[0]=ee.min.x/Jt,W[1]=ee.min.y/Jt,Z[0]=ee.max.x/Jt,Z[1]=ee.max.y/Jt;const ce=U(N,F,W),oe=U(N,F,Z);if(new Si([ce[0],ce[1],g],[oe[0],oe[1],_]).intersectsPrecise(c)===0){R&&(d.segments.push(R),R=void 0);continue}const me=ee.segment;R&&R.vertexOffset!==me.vertexOffset&&(d.segments.push(R),R=void 0),R?(R.vertexLength+=me.vertexLength,R.primitiveLength+=me.primitiveLength):R={vertexOffset:me.vertexOffset,primitiveLength:me.primitiveLength,vertexLength:me.vertexLength,primitiveOffset:me.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&d.segments.push(R),d}encodeCentroid(e,n){const c=e.centroid(),d=n.span(),g=Math.min(7,Math.round(d.x*this.tileToMeter/10)),_=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Me(ne(c.x,1,Jt-1)<<3|g,ne(c.y,1,Jt-1)<<3|_)}encodeBorderCentroid(e){if(!e.borders)return new Me(0,0);const n=e.borders,c=Number.MAX_VALUE;if(n[0][0]!==c||n[1][0]!==c){const d=n[0][0]!==c?0:1;return new Me(6|(n[0][0]!==c?0:65528),(n[d][0]+n[d][1])/2<<3|6)}{const d=n[2][0]!==c?2:3;return new Me((n[d][0]+n[d][1])/2<<3|6,6|(n[2][0]!==c?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=2147483647,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,c=e.vertexCount+e.vertexArrayOffset,d=e.flags&Fc?bp:e.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==d.y||g!==d.x){for(let _=n;_<c;++_)this.centroidVertexArray.emplace(_,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,c){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const d=n.getReplacementRegionsForTile(e.toUnwrapped());if(vp(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const g=[];for(const _ of this.activeReplacements){if(_.order<c)continue;const S=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));if(_.footprint.buildingIds)for(const M of this.centroidData)M.flags&Fc||_.min.x>M.max.x||M.min.x>_.max.x||_.min.y>M.max.y||M.min.y>_.max.y||_.footprint.buildingIds.has(M.buildingId)&&(M.flags|=Fc);else for(const M of this.centroidData)if(!(M.flags&Fc||_.min.x>M.max.x||M.min.x>_.max.x||_.min.y>M.max.y||M.min.y>_.max.y))for(let R=0;R<M.footprintSegLen;R++){const N=this.footprintSegments[M.footprintSegIdx+R];if(g.length=0,Q(this.footprintVertices,N.vertexOffset,N.vertexCount,_.footprintTileId.canonical,e.canonical,g),Jy(_.footprint,g,this.footprintIndices.uint16,N.indexOffset,N.indexCount,-N.vertexOffset,-S)){M.flags|=Fc;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,c){let d=!1;for(let g=0;g<c.footprintSegLen;g++){const _=this.footprintSegments[c.footprintSegIdx+g];let S=0;for(const M of _.ringIndices){for(let R=S,N=M+S-1;R<M+S;N=R++){const F=this.footprintVertices.int16[2*(R+_.vertexOffset)+0],U=this.footprintVertices.int16[2*(R+_.vertexOffset)+1],W=this.footprintVertices.int16[2*(N+_.vertexOffset)+1];U>n!=W>n&&e<(this.footprintVertices.int16[2*(N+_.vertexOffset)+0]-F)*(n-U)/(W-U)+F&&(d=!d)}S=M}}return d}getHeightAtTileCoord(e,n){let c=Number.NEGATIVE_INFINITY,d=!0;const g=4*(e+Jt)*Jt+(n+Jt);if(this.partLookup.hasOwnProperty(g)){const _=this.partLookup[g];return _?{height:_.height,hidden:!!(_.flags&Fc)}:void 0}for(const _ of this.centroidData)e>_.max.x||_.min.x>e||n>_.max.y||_.min.y>n||_.height<=c||this.footprintContainsPoint(e,n,_)&&(c=_.height,this.partLookup[g]=_,d=!!(_.flags&Fc));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:d};this.partLookup[g]=void 0}}function Rg(r,e){const n=r.add(e)._unit();return r.x*n.x+r.y*n.y}function Zx(r,e,n,c){const d=e.sub(r)._perp()._unit(),g=n.sub(e)._perp()._unit();return Xx(r,e,n,Rg(d,g),c)}function Xx(r,e,n,c,d){const g=Math.sqrt(1-c*c);return Math.min(r.dist(e)/3,e.dist(n)/3,d*g/c)}function kp(r,e,n){return r.x<n[0].x&&e.x<n[0].x||r.x>n[1].x&&e.x>n[1].x||r.y<n[0].y&&e.y<n[0].y||r.y>n[1].y&&e.y>n[1].y}function h(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function v(r,e,n){if(r.x<0||r.x>=Jt||e.x<0||e.x>=Jt||n.x<0||n.x>=Jt)return!1;const c=n.sub(e),d=c.perp(),g=r.sub(e);return(c.x*g.x+c.y*g.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(g.x*g.x+g.y*g.y))>-.866&&d.x*g.x+d.y*g.y<0}function k(r,e,n){const c=e?2|r:-3&r;return n?1|c:-2&c}function z(){const r=Math.PI/32,e=Math.tan(r),n=m;return n*Math.sqrt(1+2*e*e)-n}function q(r,e,n){const c=1<<n.z,d=H(n.x/c),g=H((n.x+1)/c),_=K(n.y/c),S=K((n.y+1)/c);return(function(M,R,N,F,U=0,W){const Z=[];if(!M.length||!N||!F)return Z;const ee=(Re,$e)=>{for(const We of Re)Z.push({polygon:We,bounds:$e})},ce=Math.ceil(Math.log2(N)),oe=Math.ceil(Math.log2(F)),me=ce-oe,ve=[];for(let Re=0;Re<Math.abs(me);Re++)ve.push(me>0?0:1);for(let Re=0;Re<Math.min(ce,oe);Re++)ve.push(0),ve.push(1);let Se=M;if(Se=cf(Se,R[0].y-U,R[1].y+U,1),Se=cf(Se,R[0].x-U,R[1].x+U,0),!Se.length)return Z;const De=[];for(ve.length?De.push({polygons:Se,bounds:R,depth:0}):ee(Se,R);De.length;){const Re=De.pop(),$e=Re.depth,We=ve[$e],tt=Re.bounds[0],_t=Re.bounds[1],nt=We===0?tt.x:tt.y,xt=We===0?_t.x:_t.y,Mt=W?W(We,nt,xt):.5*(nt+xt),Pt=cf(Re.polygons,nt-U,Mt+U,We),Gt=cf(Re.polygons,Mt-U,xt+U,We);if(Pt.length){const Wt=[tt,new Me(We===0?Mt:_t.x,We===1?Mt:_t.y)];ve.length>$e+1?De.push({polygons:Pt,bounds:Wt,depth:$e+1}):ee(Pt,Wt)}if(Gt.length){const Wt=[new Me(We===0?Mt:tt.x,We===1?Mt:tt.y),_t];ve.length>$e+1?De.push({polygons:Gt,bounds:Wt,depth:$e+1}):ee(Gt,Wt)}}return Z})(r,e,Math.ceil((g-d)/11.25),Math.ceil((_-S)/11.25),1,((M,R,N)=>{if(M===0)return .5*(R+N);{const F=K((n.y+R/Jt)/c);return(O(.5*(K((n.y+N/Jt)/c)+F))*c-n.y)*Jt}}))}function Q(r,e,n,c,d,g){const _=Math.pow(2,c.z-d.z);for(let S=0;S<n;S++){let M=r.int16[2*(S+e)+0],R=r.int16[2*(S+e)+1];M=(M+d.x*Jt)*_-c.x*Jt,R=(R+d.y*Jt)*_-c.y*Jt,g.push(new Me(M,R))}}let Te,Ve;vi(Tp,"FillExtrusionBucket",{omit:["layers","features"]}),vi(ev,"PartData"),vi(Pg,"FootprintSegment"),vi(qx,"BorderCentroidData"),vi(pm,"GroundEffect");class ut extends Me{constructor(e,n,c){super(e,n),this.z=c}}class ti extends ut{constructor(e,n,c,d){super(e,n,c),this.w=d}}function xi(r,e,n,c){const d=n==="x"?"y":"x",g=(c-r[n])/(e[n]-r[n]);r[d]=Math.round(r[d]+(e[d]-r[d])*g),r[n]=c,r.hasOwnProperty("z")&&(r.z=Gi(r.z,e.z,g)),r.hasOwnProperty("w")&&(r.w=Gi(r.w,e.w,g))}function Ci(r,e,n,c){const d=n,g=c;for(const _ of["x","y"]){let S=r,M=e;S[_]>=M[_]&&(S=e,M=r),S[_]<d&&M[_]>d&&xi(S,M,_,d),S[_]<g&&M[_]>g&&xi(M,S,_,g)}}function ri(r,e,n,c,d,g){const _=[];for(let S=0;S<r.length;S++){const M=r[S];let R;const N=_.length;let F=0;for(let U=0;U<M.length-1;U++){let W=M[U],Z=M[U+1],ee=0;const ce=F;let oe,me;g&&(ee=Math.hypot(Z.x-W.x,Z.y-W.y),F+=ee,oe=W,me=Z),W.x<e&&Z.x<e||(W.x<e?W=new Me(e,W.y+(e-W.x)/(Z.x-W.x)*(Z.y-W.y))._round():Z.x<e&&(Z=new Me(e,W.y+(e-W.x)/(Z.x-W.x)*(Z.y-W.y))._round()),W.y<n&&Z.y<n||(W.y<n?W=new Me(W.x+(n-W.y)/(Z.y-W.y)*(Z.x-W.x),n)._round():Z.y<n&&(Z=new Me(W.x+(n-W.y)/(Z.y-W.y)*(Z.x-W.x),n)._round()),W.x>=c&&Z.x>=c||(W.x>=c?W=new Me(c,W.y+(c-W.x)/(Z.x-W.x)*(Z.y-W.y))._round():Z.x>=c&&(Z=new Me(c,W.y+(c-W.x)/(Z.x-W.x)*(Z.y-W.y))._round()),W.y>=d&&Z.y>=d||(W.y>=d?W=new Me(W.x+(d-W.y)/(Z.y-W.y)*(Z.x-W.x),d)._round():Z.y>=d&&(Z=new Me(W.x+(d-W.y)/(Z.y-W.y)*(Z.x-W.x),d)._round()),R&&W.equals(R[R.length-1])||(R=[W],_.push(R),g&&g.push({progress:{min:ce+ya(oe,me,W)*ee,max:1},parentIndex:S,prevPoint:oe,nextPoint:me})),R.push(Z),g&&(g[g.length-1].progress.max=ce+ya(oe,me,Z)*ee,g[g.length-1].nextPoint=me)))))}if(g&&F>0)for(let U=N;U<_.length;U++)g[U].progress.min/=F,g[U].progress.max/=F}return _}function oi(r,e,n,c,d){if(r.length<2)return void c.push(r);const g=[];for(;e.valid();){const[R,N]=e.get();for(let F=0;F<r.length-1;F++){const U=r[F],W=r[F+1],Z=xn(U,W,R,N);if(Z){const[ee]=Z,ce=new Me(Gi(U.x,W.x,ee),Gi(U.y,W.y,ee));g.push({t:F+ee,distance:0,point:ce})}}e.next()}if(g.length===0)return void c.push(r);g.sort(((R,N)=>R.t-N.t));let _=0,S=0,M=[];for(c.push(M);_!==r.length;){if(S===g.length){for(;_!==r.length;)M.length!==0&&M[M.length-1].equals(r[_])||M.push(r[_]),_++;break}g[S].t<=_?(M.length!==0&&M[M.length-1].equals(g[S].point)||M.push(g[S].point),Math.trunc(g[S].t),S++):(M.length!==0&&M[M.length-1].equals(r[_])||M.push(r[_]),_++)}}function ya(r,e,n){return r.x!==e.x?(n.x-r.x)/(e.x-r.x):r.y!==e.y?(n.y-r.y)/(e.y-r.y):0}function Qn(r,e){return r.x*e.x+r.y*e.y}function Or(r,e){if(r.length===1){let n=0;const c=e[n++];let d;for(;!d||c.equals(d);)if(d=e[n++],!d)return 1/0;for(;n<e.length;n++){const g=e[n],_=r[0],S=d.sub(c),M=g.sub(c),R=_.sub(c),N=Qn(S,S),F=Qn(S,M),U=Qn(M,M),W=Qn(R,S),Z=Qn(R,M),ee=N*U-F*F,ce=(U*W-F*Z)/ee,oe=(N*Z-F*W)/ee,me=c.z*(1-ce-oe)+d.z*ce+g.z*oe;if(isFinite(me))return me}return 1/0}{let n=1/0;for(const c of e)n=Math.min(n,c.z);return n}}function Dt(r,e,n){let c=1/0;na(n,e)&&(c=Or(n,e[0]));for(let d=0;d<e.length;d++){const g=e[d],_=r[d];for(let S=0;S<g.length-1;S++){const M=g[S],R=[M,g[S+1],_[S+1],_[S],M];Nn(n,R)&&(c=Math.min(c,Or(n,R)))}}return c!==1/0&&c}function Et(r,e,n,c,d,g,_,S,M,R,N){return r.projection.name==="globe"?(function(F,U,W,Z,ee,ce,oe,me,ve,Se,De){const Re=[],$e=[],We=F.projection.upVectorScale(De,F.center.lat,F.worldSize).metersToTile,tt=[0,0,0,1],_t=[0,0,0,1],nt=(Mt,Pt,Gt,Wt)=>{Mt[0]=Pt,Mt[1]=Gt,Mt[2]=Wt,Mt[3]=1},xt=z();W>0&&(W+=xt),Z+=xt;for(const Mt of U){const Pt=[],Gt=[];for(const Wt of Mt){const Ut=Wt.x+ee.x,$t=Wt.y+ee.y,vt=F.projection.projectTilePoint(Ut,$t,De),yt=F.projection.upVector(De,Wt.x,Wt.y);let Vt=W,si=Z;if(oe){const Qt=Kt(Ut,$t,W,Z,oe,me,ve,Se);Vt+=Qt.base,si+=Qt.top}W!==0?nt(tt,vt.x+yt[0]*We*Vt,vt.y+yt[1]*We*Vt,vt.z+yt[2]*We*Vt):nt(tt,vt.x,vt.y,vt.z),nt(_t,vt.x+yt[0]*We*si,vt.y+yt[1]*We*si,vt.z+yt[2]*We*si),Ii(tt,tt,ce),Ii(_t,_t,ce),Pt.push(new ut(tt[0],tt[1],tt[2])),Gt.push(new ut(_t[0],_t[1],_t[2]))}Re.push(Pt),$e.push(Gt)}return[Re,$e]})(r,e,n,c,d,g,_,S,M,R,N):_?(function(F,U,W,Z,ee,ce,oe,me,ve){const Se=[],De=[],Re=[0,0,0,1];for(const $e of F){const We=[],tt=[];for(const _t of $e){const nt=_t.x+Z.x,xt=_t.y+Z.y,Mt=Kt(nt,xt,U,W,ce,oe,me,ve);Re[0]=nt,Re[1]=xt,Re[2]=Mt.base,Re[3]=1,Hr(Re,Re,ee),Re[3]=Math.max(Re[3],1e-5);const Pt=new ut(Re[0]/Re[3],Re[1]/Re[3],Re[2]/Re[3]);Re[0]=nt,Re[1]=xt,Re[2]=Mt.top,Re[3]=1,Hr(Re,Re,ee),Re[3]=Math.max(Re[3],1e-5);const Gt=new ut(Re[0]/Re[3],Re[1]/Re[3],Re[2]/Re[3]);We.push(Pt),tt.push(Gt)}Se.push(We),De.push(tt)}return[Se,De]})(e,n,c,d,g,_,S,M,R):(function(F,U,W,Z,ee){const ce=[],oe=[],me=ee[8]*U,ve=ee[9]*U,Se=ee[10]*U,De=ee[11]*U,Re=ee[8]*W,$e=ee[9]*W,We=ee[10]*W,tt=ee[11]*W;for(const _t of F){const nt=[],xt=[];for(const Mt of _t){const Pt=Mt.x+Z.x,Gt=Mt.y+Z.y,Wt=ee[0]*Pt+ee[4]*Gt+ee[12],Ut=ee[1]*Pt+ee[5]*Gt+ee[13],$t=ee[2]*Pt+ee[6]*Gt+ee[14],vt=ee[3]*Pt+ee[7]*Gt+ee[15],yt=Wt+me,Vt=Ut+ve,si=$t+Se,Qt=Math.max(vt+De,1e-5),Oi=Wt+Re,pi=Ut+$e,bi=$t+We,Mi=Math.max(vt+tt,1e-5);nt.push(new ut(yt/Qt,Vt/Qt,si/Qt)),xt.push(new ut(Oi/Mi,pi/Mi,bi/Mi))}ce.push(nt),oe.push(xt)}return[ce,oe]})(e,n,c,d,g)}function Kt(r,e,n,c,d,g,_,S){const M=_*d.getElevationAt(r,e,!0,!0),R=g[0]!==0,N=R?g[1]===0?_*(g[0]/hh-Gx):_*(function(F,U,W){const Z=Math.floor(U[0]/8),ee=Math.floor(U[1]/8),ce=10*(U[0]-8*Z),oe=10*(U[1]-8*ee),me=F.getElevationAt(Z,ee,!0,!0),ve=F.getMeterToDEM(W),Se=Math.floor(.5*(ce*ve-1)),De=Math.floor(.5*(oe*ve-1)),Re=F.tileCoordToPixel(Z,ee),$e=2*Se+1,We=2*De+1,tt=(function(Gt,Wt,Ut,$t,vt){return[Gt.getElevationAtPixel(Wt,Ut,!0),Gt.getElevationAtPixel(Wt+vt,Ut,!0),Gt.getElevationAtPixel(Wt,Ut+vt,!0),Gt.getElevationAtPixel(Wt+$t,Ut+vt,!0)]})(F,Re.x-Se,Re.y-De,$e,We),_t=Math.abs(tt[0]-tt[1]),nt=Math.abs(tt[2]-tt[3]),xt=Math.abs(tt[0]-tt[2])+Math.abs(tt[1]-tt[3]),Mt=Math.min(.25,.5*ve*(_t+nt)/$e),Pt=Math.min(.25,.5*ve*xt/We);return me+Math.max(Mt*ce,Pt*oe)})(d,g,S):M;return{base:M+(n===0?-1:n),top:R?Math.max(N+c,M+n+2):M+c}}class Ei{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class zn{constructor(){this.tasks={},this.taskQueue=[],Je(["process"],this),this.invoker=new Ei(this.process),this.nextId=0}add(e,n){const c=this.nextId++,d=(function({type:g,isSymbolTile:_,zoom:S}){return S=S||0,g==="message"?0:g!=="maybePrepare"||_?g!=="parseTile"||_?g==="parseTile"&&_?300-S:g==="maybePrepare"&&_?400-S:500:200-S:100-S})(n);if(d===0){try{e()}finally{}return null}return this.tasks[c]={fn:e,metadata:n,priority:d,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((c=>!!this.tasks[c])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<n&&(n=g.priority,e=d)}if(e===null)return null;const c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class Ka{constructor(e,n,c){this.target=e,this.parent=n,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Je(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new zn}send(e,n,c,d,g=!1,_){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=_,this.callbacks[S]=c);const M=new Set;return this.target.postMessage({id:S,type:e,hasCallback:!!c,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:Ac(n,M)},M),{cancel:()=>{c&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(e){const n=e.data;if(!n)return;const c=n.id;if(c&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const d=this.cancelCallbacks[c];delete this.cancelCallbacks[c],d&&d.cancel()}else if(n.mustQueue||Hi(self)){const d=this.callbacks[c],g=this.scheduler.add((()=>this.processTask(c,n)),d&&d.metadata||{type:"message"});g&&(this.cancelCallbacks[c]=g)}else this.processTask(c,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const c=this.callbacks[e];delete this.callbacks[e],c&&(n.error?c($o(n.error)):c(null,$o(n.data)))}else{const c=new Set,d=n.hasCallback?(_,S)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:_?Ac(_):null,data:Ac(S,c)},c)}:()=>{},g=$o(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,g,d);else if(this.parent.getWorkerSource){const _=n.type.split("."),{source:S,scope:M}=g;this.parent.getWorkerSource(n.sourceMapId,_[0],S,M)[_[1]](g,d)}else d(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Bn={workerUrl:"",workerClass:null,workerParams:void 0};const sa="mapboxgl_preloaded_worker_pool";class _s{constructor(e){this.active={},this.name=e}acquire(e,n=_s.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;){const d=(c=`${this.name||""}WorkerPool: ${e}-${this.workers.length}`,Bn.workerClass!=null?new Bn.workerClass:new self.Worker(Bn.workerUrl,Object.assign({name:c},Bn.workerParams)));this.workers.push(d)}var c;return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((n=>{n.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[sa]}numActive(){return Object.keys(this.active).length}}_s.workerCount=2;class or{constructor(e,n,c="Worker",d=_s.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ze();const g=this.workerPool.acquire(this.id,d);for(let _=0;_<g.length;_++){const S=new or.Actor(g[_],n,this.id);S.name=`${c} ${_}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,n,c){Fe(this.actors,((d,g)=>{d.send(e,n,g)}),c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let _u,tv;function Yx(){return _u||(_u=new _s),_u}or.Actor=Ka;const lw=4096;class Kj{constructor(e){this.module=e,this.memoryStack=this.module.malloc(lw),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>lw?-1:(new Int32Array(this.module.heap32.buffer,n,e.length).set(e),n)}createFloatArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>lw?-1:(new Float32Array(this.module.heapF32.buffer,n,e.length).set(e),n)}readStringBuffer(e){let n="";for(;this.module.heapU8[e]!==0;)n+=String.fromCharCode(this.module.heapU8[e]),++e;return n}setStyle(e){const n=e.normalScale;this.module.setStyle(n[0],n[1],n[2],e.tileToMeters)}setAOOptions(e,n){this.module.setAOOptions(e?1:0,n)}setMetricOptions(e,n){this.module.setMetricOptions(e?1:0,n)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,n){this.module.setFacadeOptions(e,n?1:0)}setFauxFacadeOptions(e,n,c){this.module.setFauxFacadeOptions(e?1:0,n?1:0,c)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,n){this.memoryStackNextFree=this.memoryStack;for(const S of e){const M=this.createIntArray(S.ringIndices),R=this.createFloatArray(S.coordinates);if(M===-1||R===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(S.id,S.sourceId,S.minHeight,S.height,S.roofType,R,M,S.ringIndices.length-1)}for(const S of n){let M;M=S.entrances?JSON.parse(S.entrances):[];const R=this.createFloatArray(M),N=this.createFloatArray(S.coordinates);if(R===-1||N===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(S.sourceId,S.crossPerc,S.distanceToRoad,R,M.length,N,S.coordinates.length)}if(!this.module.generateMesh()){const S=this.module.getLastError();return this.readStringBuffer(S)}const c=this.module.getMeshCount(),d=new Array(c);for(let S=0;S<c;S++){const M=this.module.getPositionsPtr(S),R=this.module.getPositionsLength(S),N=new Float32Array(this.module.heapF32.buffer,M,R),F=this.module.getNormalsPtr(S),U=this.module.getNormalsLength(S),W=new Float32Array(this.module.heapF32.buffer,F,U),Z=this.module.getAOPtr(S),ee=this.module.getAOLength(S),ce=new Float32Array(this.module.heapF32.buffer,Z,ee),oe=this.module.getUVPtr(S),me=this.module.getUVLength(S),ve=new Float32Array(this.module.heapF32.buffer,oe,me),Se=this.module.getFauxFacadePtr(S),De=this.module.getFauxFacadeLength(S),Re=new Uint8Array(this.module.heapU8.buffer,Se,De),$e=this.module.getIndicesPtr(S),We=this.module.getIndicesLength(S),tt=new Int16Array(this.module.heap16.buffer,$e,We),_t=this.module.getBuildingPart(S);d[S]={positions:N,normals:W,ao:ce,uv:ve,isFauxFacade:Re,indices:tt,buildingPart:_t}}const g=this.module.getRingCount(),_=[];for(let S=0;S<g;S++){const M=this.module.getRingPtr(S),R=this.module.getRingLength(S),N=new Float32Array(this.module.heapF32.buffer,M,R);_.push(N)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let iv,cw,mh,L_,uw,I_=null,z_=null,f2=null,Kx=null;function m2(){return Hi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:cw||An.DRACO_URL}function p2(){if(Hi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(L_)return L_;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return L_=WebAssembly.validate(r)?An.MESHOPT_SIMD_URL:An.MESHOPT_URL,L_}function Jj(){return Kx}const Jx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qj={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},nv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function g2(r,e,n){const c=n.json.bufferViews.length,d=n.buffers.length;e.bufferView=c,n.json.bufferViews[c]={buffer:d,byteLength:r.byteLength},n.buffers[d]=r}const dw="KHR_draco_mesh_compression";function eR(r,e){const n=r.extensions&&r.extensions[dw];if(!n)return;const c=new mh.Decoder,d=x2(e,n.bufferView),g=new mh.Mesh;if(!c.DecodeArrayToMesh(d,d.byteLength,g))throw new Error("Failed to decode Draco mesh");const _=e.json.accessors[r.indices],S=Jx[_.componentType],M=_.count*S.BYTES_PER_ELEMENT,R=mh._malloc(M);S===Uint16Array?c.GetTrianglesUInt16Array(g,M,R):c.GetTrianglesUInt32Array(g,M,R),g2(mh.memory.buffer.slice(R,R+M),_,e),mh._free(R);for(const N of Object.keys(n.attributes)){const F=c.GetAttributeByUniqueId(g,n.attributes[N]),U=e.json.accessors[r.attributes[N]],W=Qj[U.componentType],Z=U.count*nv[U.type]*Jx[U.componentType].BYTES_PER_ELEMENT,ee=mh._malloc(Z);c.GetAttributeDataArrayForAllPoints(g,F,mh[W],Z,ee),g2(mh.memory.buffer.slice(ee,ee+Z),U,e),mh._free(ee)}c.destroy(),g.destroy(),delete r.extensions[dw]}const Qx="EXT_meshopt_compression";function tR(r,e){if(!r.extensions||!r.extensions[Qx])return;const n=r.extensions[Qx],c=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),d=new Uint8Array(n.count*n.byteStride);uw.decodeGltfBuffer(d,n.count,n.byteStride,c,n.mode,n.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=d.buffer,delete r.extensions[Qx]}const _2=1179937895,y2=new TextDecoder("utf8");function v2(r,e){return new URL(r,e).href}function iR(r,e,n,c){return fetch(v2(r.uri,c)).then((d=>d.arrayBuffer())).then((d=>{e.buffers[n]=d}))}function x2(r,e){const n=r.json.bufferViews[e];return new Uint8Array(r.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function nR(r,e,n,c){if(r.uri){const d=v2(r.uri,c);return fetch(d).then((g=>g.blob())).then((g=>createImageBitmap(g))).then((g=>{e.images[n]=g}))}if(r.bufferView!==void 0){const d=x2(e,r.bufferView),g=new Blob([d],{type:r.mimeType});return createImageBitmap(g).then((_=>{e.images[n]=_}))}}function b2(r,e=0,n){const c={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===_2){const N=new Uint32Array(r,e);let F=2;const U=(N[F++]>>2)-3,W=N[F++]>>2;if(F++,c.json=JSON.parse(y2.decode(N.subarray(F,F+W))),F+=W,F<U){const Z=N[F++];F++;const ee=e+(F<<2);c.buffers[0]=r.slice(ee,ee+Z)}}else c.json=JSON.parse(y2.decode(new Uint8Array(r,e)));const{buffers:d,images:g,meshes:_,extensionsUsed:S,bufferViews:M}=c.json;let R=Promise.resolve();if(d){const N=[];for(let F=0;F<d.length;F++){const U=d[F];U.uri?N.push(iR(U,c,F,n)):c.buffers[F]||(c.buffers[F]=null)}R=Promise.all(N)}return R.then((()=>{const N=[],F=S&&S.includes(dw),U=S&&S.includes(Qx);if(F&&N.push((function(){if(!mh)return iv??(iv=(function(W){let Z,ee=null;function ce(){Z=new Uint8Array(ee.buffer)}function oe(){throw new Error("Unexpected Draco error.")}const me={a:{a:oe,d:function(ve,Se,De){return Z.copyWithin(ve,Se,Se+De)},c:function(ve){const Se=Z.length,De=Math.max(ve>>>0,Math.ceil(1.2*Se)),Re=Math.ceil((De-Se)/65536);try{return ee.grow(Re),ce(),!0}catch{return!1}},b:oe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(W,me):W.then((ve=>ve.arrayBuffer())).then((ve=>WebAssembly.instantiate(ve,me)))).then((ve=>{const{Rb:Se,Qb:De,P:Re,T:$e,X:We,Ja:tt,La:_t,Qa:nt,Va:xt,Wa:Mt,eb:Pt,jb:Gt,f:Wt,e:Ut,yb:$t,zb:vt,Ab:yt,Bb:Vt,Db:si,Gb:Qt}=ve.instance.exports;ee=Ut;const Oi=(()=>{let pi=0,bi=0,Mi=0,jn=0;return ni=>{Mi&&(Se(jn),Se(pi),bi+=Mi,Mi=pi=0),pi||(bi+=128,pi=De(bi));const Li=ni.length+7&-8;let dn=pi;Li>=bi&&(Mi=Li,dn=jn=De(Li));for(let Wn=0;Wn<ni.length;Wn++)Z[dn+Wn]=ni[Wn];return dn}})();return ce(),Wt(),{memory:Ut,_free:Se,_malloc:De,Mesh:class{constructor(){this.ptr=Re()}destroy(){$e(this.ptr)}},Decoder:class{constructor(){this.ptr=tt()}destroy(){Gt(this.ptr)}DecodeArrayToMesh(pi,bi,Mi){const jn=Oi(pi),ni=_t(this.ptr,jn,bi,Mi.ptr);return!!We(ni)}GetAttributeByUniqueId(pi,bi){return{ptr:nt(this.ptr,pi.ptr,bi)}}GetTrianglesUInt16Array(pi,bi,Mi){xt(this.ptr,pi.ptr,bi,Mi)}GetTrianglesUInt32Array(pi,bi,Mi){Mt(this.ptr,pi.ptr,bi,Mi)}GetAttributeDataArrayForAllPoints(pi,bi,Mi,jn,ni){Pt(this.ptr,pi.ptr,bi.ptr,Mi,jn,ni)}},DT_INT8:$t(),DT_UINT8:vt(),DT_INT16:yt(),DT_UINT16:Vt(),DT_UINT32:si(),DT_FLOAT32:Qt()}}))})(fetch(m2())),iv.then((W=>{mh=W,iv=void 0})))})()),U&&N.push((function(){if(uw)return;const W=(function(Z){let ee;const ce=WebAssembly.instantiateStreaming(Z,{}).then((ve=>{ee=ve.instance,ee.exports.__wasm_call_ctors()})),oe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},me={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ce,supported:!0,decodeGltfBuffer(ve,Se,De,Re,$e,We){(function(tt,_t,nt,xt,Mt,Pt,Gt){const Wt=tt.exports.sbrk,Ut=xt+3&-4,$t=Wt(Ut*Mt),vt=Wt(Pt.length),yt=new Uint8Array(tt.exports.memory.buffer);yt.set(Pt,vt);const Vt=_t($t,xt,Mt,vt,Pt.length);if(Vt===0&&Gt&&Gt($t,Ut,Mt),nt.set(yt.subarray($t,$t+xt*Mt)),Wt($t-Wt(0)),Vt!==0)throw new Error(`Malformed buffer data: ${Vt}`)})(ee,ee.exports[me[$e]],ve,Se,De,Re,ee.exports[oe[We]])}}})(fetch(p2()));return W.ready.then((()=>{uw=W}))})()),g)for(let W=0;W<g.length;W++)N.push(nR(g[W],c,W,n));return(N.length?Promise.all(N):Promise.resolve()).then((()=>{if(F&&_)for(const{primitives:W}of _)for(const Z of W)eR(Z,c);if(U&&_&&M)for(const W of M)tR(W,c);return c}))}))}function w2(r){return fetch(r).then((e=>e.arrayBuffer())).then((e=>b2(e,0,r)))}function hw(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function fw(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class mw{constructor(e,n,c,d){this.context=e,this.format=c,this.useMipmap=d&&d.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:d&&d.premultiply})}update(e,n){const c=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,d=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:g}=this,{gl:_}=g,{x:S,y:M}=n&&n.position?n.position:{x:0,y:0},R=S+c,N=M+d;!this.size||this.size[0]===R&&this.size[1]===N||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!n||n.premultiply!==!1));const F=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&R>0&&N>0){const U=this.useMipmap?Math.floor(Math.log2(Math.max(R,N)))+1:1;_.texStorage2D(_.TEXTURE_2D,U,this.format,R,N),this.size=[R,N]}this.size&&(F?_.texSubImage2D(_.TEXTURE_2D,0,S,M,hw(this.format),fw(this.format),e):"data"in e&&e.data&&_.texSubImage2D(_.TEXTURE_2D,0,S,M,c,d,hw(this.format),fw(this.format),e.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n,c=!1){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!c?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,c,d,g){const{context:_}=this,{gl:S}=_;S.bindTexture(S.TEXTURE_2D,this.texture),n!==this.magFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,this.useMipmap?e===S.NEAREST?S.NEAREST_MIPMAP_NEAREST:S.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),c!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,c),this.wrapS=c),d!==this.wrapT&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,d),this.wrapT=d),g!==this.compareMode&&(g?(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_FUNC,g)):S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.NONE),this.compareMode=g)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class av{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}}const aR=Ln([{name:"a_pos_3f",components:3,type:"Float32"}]),rR=Ln([{name:"a_color_3f",components:3,type:"Float32"}]),sR=Ln([{name:"a_color_4f",components:4,type:"Float32"}]),oR=Ln([{name:"a_uv_2f",components:2,type:"Float32"}]),lR=Ln([{name:"a_normal_3f",components:3,type:"Float32"}]),cR=Ln([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),uR=Ln([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function S2(r,e){const n=e0(r.projection,r.zoom,r.width,r.height),c=(function(g,_,S,M,R){const N=new o(S.lng-180*Ep,S.lat),F=new o(S.lng+180*Ep,S.lat),U=g.project(N.lng,N.lat),W=g.project(F.lng,F.lat),Z=-Math.atan2(W.y-U.y,W.x-U.x),ee=_e.fromLngLat(S);ee.y=ne(ee.y,-1+Ep,1-Ep);const ce=ee.toLngLat(),oe=g.project(ce.lng,ce.lat),me=_e.fromLngLat(ce);me.x+=Ep;const ve=me.toLngLat(),Se=g.project(ve.lng,ve.lat),De=k2(Se.x-oe.x,Se.y-oe.y,Z),Re=_e.fromLngLat(ce);Re.y+=Ep;const $e=Re.toLngLat(),We=g.project($e.lng,$e.lat),tt=k2(We.x-oe.x,We.y-oe.y,Z),_t=Math.abs(De.x)/Math.abs(tt.y),nt=re([]);et(nt,nt,-Z*(1-(R?0:M)));const xt=re([]);return Ne(xt,xt,[1,1-(1-_t)*M,1]),xt[4]=-tt.x/tt.y*M,et(xt,xt,Z),xe(xt,nt,xt),xt})(r.projection,0,r.center,n,e),d=T2(r);return Ne(c,c,[d,d,1]),c}function T2(r){const e=r.projection,n=e0(r.projection,r.zoom,r.width,r.height),c=pw(e,r.center),d=pw(e,o.convert(e.center));return Math.pow(2,c*n+(1-n)*d)}function e0(r,e,n,c,d=1/0){const g=r.range;if(!g)return 0;const _=Math.min(d,Math.max(n,c)),S=Math.log2(_/1024);return ue(g[0]+S,g[1]+S,e)}const Ep=1/4e4;function pw(r,e){const n=ne(e.lat,-J,J),c=new o(e.lng-180*Ep,n),d=new o(e.lng+180*Ep,n),g=r.project(c.lng,n),_=r.project(d.lng,n),S=_e.fromLngLat(c),M=_e.fromLngLat(d),R=_.x-g.x,N=_.y-g.y,F=M.x-S.x,U=M.y-S.y,W=Math.sqrt((F*F+U*U)/(R*R+N*N));return Math.log2(W)}function k2(r,e,n){const c=Math.cos(n),d=Math.sin(n);return{x:r*c-e*d,y:r*d+e*c}}function E2(r,e,n){re(r),et(r,r,ui(e[2])),Be(r,r,ui(e[0])),Ee(r,r,ui(e[1])),Ne(r,r,n),xe(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function t0(r,e,n,c,d,g,_,S){const M=[n[0]-e[0],n[1]-e[1],0],R=[c[0]-e[0],c[1]-e[1],0];if(Pi(M)<1e-12||Pi(R)<1e-12)return Jr(r);const N=Un([],M,R);pn(N,N),Vi(R,c,e),M[2]=(g-d)*S,R[2]=(_-d)*S;const F=M;return Un(F,M,R),pn(F,F),Ko(r,N,F)}function i0(r,e,n=!1){const c=jd(e.zoom),d=(function(g,_,S){const M=_.worldSize,R=[g[12],g[13],g[14]],N=K(R[1]/M),F=H(R[0]/M),U=re([]),W=B(1,N)*M,Z=B(1,0)*M*ae(N,_.zoom),ee=1/p_(M);let ce=Z*ee;if(S){const Se=e0(_.projection,_.zoom,_.width,_.height,1024);ce=ee*_.projection.pixelSpaceConversion(_.center.lat,M,Se)}const oe=Zl(N,F);Ct(oe,oe,Ft([],pn([],oe),W*ce*R[2]));const me=(function(Se){const De=[Se[0],Se[1],Se[2]];let Re=[0,1,0];const $e=Un([],Re,De);return Un(Re,De,$e),yn(Re)===0&&(Re=[0,1,0],Un($e,De,Re)),pn($e,$e),pn(Re,Re),pn(De,De),[$e[0],$e[1],$e[2],0,Re[0],Re[1],Re[2],0,De[0],De[1],De[2],0,Se[0],Se[1],Se[2],1]})(oe);Ne(U,U,[ce,ce,ce*W]),be(U,U,[-R[0],-R[1],-R[2]]);const ve=xe([],_.globeMatrix,me);return xe(ve,ve,U),xe(ve,ve,g),ve})(r,e,n);if(c>0){const g=(function(_,S){const M=S.worldSize,R=B(1,0)*M*ae(S.center.lat,S.zoom)/p_(M),N=B(1,S.center.lat)*M,F=re([]);Ee(F,F,ui(S.center.lng)),Be(F,F,ui(S.center.lat)),be(F,F,[0,0,io]),Ne(F,F,[R,R,R*N]);const U=S.point;return be(F,F,[-U.x,-U.y,0]),xe(F,F,_),xe(F,S.globeMatrix,F)})(r,e);return(function(_,S,M){const R=(Z,ee,ce)=>{const oe=Pi(Z),me=Pi(ee),ve=mo(Z,ee,ce);return Ft(ve,ve,1/Pi(ve)*Gi(oe,me,ce))},N=R([_[0],_[1],_[2]],[S[0],S[1],S[2]],M),F=R([_[4],_[5],_[6]],[S[4],S[5],S[6]],M),U=R([_[8],_[9],_[10]],[S[8],S[9],S[10]],M),W=mo([_[12],_[13],_[14]],[S[12],S[13],S[14]],M);return[N[0],N[1],N[2],0,F[0],F[1],F[2],0,U[0],U[1],U[2],0,W[0],W[1],W[2],1]})(d,g,c)}return d}function gw(r,e,n,c){const d=Si.projectAabbCorners(c,n);let g=Number.MAX_VALUE;for(let S=0;S<d.length;++S){const M=d[S];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<g&&(g=M[2])}const _=(function(S){const M=[];let R=0;for(let W=1;W<S.length;W++)(S[W][0]<S[R][0]||S[W][0]===S[R][0]&&S[W][1]<S[R][1])&&(R=W);let N,F=R;const U=new Uint8Array(S.length);do{if(U[F])break;M.push(new Me(S[F][0],S[F][1])),U[F]=1,N=(F+1)%S.length;for(let W=0;W<S.length;W++){if(S[W][0]===S[N][0]&&S[W][1]===S[N][1]||S[W][0]===S[F][0]&&S[W][1]===S[F][1])continue;const Z=[S[W][0]-S[F][0],S[W][1]-S[F][1]],ee=[S[N][0]-S[F][0],S[N][1]-S[F][1]],ce=Z[0]*ee[1]-Z[1]*ee[0];(ce>0||ce===0&&Z[0]*ee[0]+Z[1]*ee[1]>=0&&Z[0]*Z[0]+Z[1]*Z[1]>ee[0]*ee[0]+ee[1]*ee[1])&&(N=W)}F=N}while(F!==R);return M.length>0&&M.push(M[0]),M})(d);if(Nn(r,_))return g}const Lg=64,D_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function n0(r,e,n,c,d,g,_,S,M,R=!1){const N=n.zoom,F=n.project(c),U=ae(c.lat,N),W=1/U;re(r),be(r,r,[F.x+_[0]*W,F.y+_[1]*W,_[2]]);let Z=1,ee=1;const ce=n.worldSize;if(R){if(n.projection.name==="mercator"){let Se=0;n.elevation&&(Se=n.elevation.getAtPointOrZero(new _e(F.x/ce,F.y/ce),0));const De=Hr([],[F.x,F.y,Se,1],n.projMatrix)[3]/n.cameraToCenterDistance;Z=De,ee=De*ae(n.center.lat,N)}else if(n.projection.name==="globe"){const Se=i0(r,n),De=[0,0,0,1];Hr(De,De,xe([],n.projMatrix,Se));const Re=De[3]/n.cameraToCenterDistance,$e=jd(N),We=n.projection.pixelsPerMeter(c.lat,ce)*ae(c.lat,N),tt=n.projection.pixelsPerMeter(n.center.lat,ce)*ae(n.center.lat,N);Z=Re/Gi(We,se(n.center.lat),$e),ee=Re*U/We,Z*=tt,ee*=tt}}else Z=W;Ne(r,r,[Z,Z,ee]);const oe=[...r],me=e.orientation,ve=[];if(E2(ve,[me[0]+(d?d[0]:0),me[1]+(d?d[1]:0),me[2]+(d?d[2]:0)],g),xe(r,oe,ve),S&&n.elevation){let Se=0;const De=[];if(M&&n.elevation){Se=(function($e,We,tt,_t,nt){const xt=We.elevation;if(!xt)return 0;const Mt=Si.projectAabbCorners(tt,_t),Pt=B(1,nt.lat)*We.worldSize,Gt=(function(bi,Mi){const jn=[0,0,1],ni=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Li of ni){const dn=bi[Li.corners[0]],Wn=bi[Li.corners[1]],Kn=bi[Li.corners[2]],wn=[Wn[0]-dn[0],Wn[1]-dn[1],Mi*(Wn[2]-dn[2])],La=Un(wn,wn,[Kn[0]-dn[0],Kn[1]-dn[1],Mi*(Kn[2]-dn[2])]);pn(La,La),Li.dotProductWithUp=sn(La,jn)}return ni.sort(((Li,dn)=>Li.dotProductWithUp-dn.dotProductWithUp)),ni[0].corners})(Mt,Pt),Wt=Mt[Gt[0]],Ut=Mt[Gt[1]],$t=Mt[Gt[2]],vt=Mt[Gt[3]],yt=xt.getAtPointOrZero(new _e(Wt[0]/We.worldSize,Wt[1]/We.worldSize),0),Vt=xt.getAtPointOrZero(new _e(Ut[0]/We.worldSize,Ut[1]/We.worldSize),0),si=xt.getAtPointOrZero(new _e($t[0]/We.worldSize,$t[1]/We.worldSize),0),Qt=xt.getAtPointOrZero(new _e(vt[0]/We.worldSize,vt[1]/We.worldSize),0),Oi=(yt+Qt)/2,pi=(Vt+si)/2;return Oi>pi?Vt<si?t0($e,Ut,vt,Wt,Vt,Qt,yt,Pt):t0($e,$t,Wt,vt,si,yt,Qt,Pt):yt<Qt?t0($e,Wt,Ut,$t,yt,Vt,si,Pt):t0($e,vt,$t,Ut,Qt,si,Vt,Pt),Math.max(Oi,pi)})(De,n,e.aabb,r,c);const Re=xe([],pt([],De),ve);xe(r,oe,Re)}else Se=n.elevation.getAtPointOrZero(new _e(F.x/ce,F.y/ce),0);Se!==0&&(r[14]+=Se)}}class A2{constructor(e,n,c,d,g){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=n,this.position=c!=null?new o(c[0],c[1]):new o(0,0),this.orientation=d??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){xe(e.globalMatrix,n,e.localMatrix);const c=this.nodeOverrides.get(e.name);if(c!==void 0){const _=[];g=c.orientation,re(d=_),Ee(d,d,ui(g[1])),et(d,d,ui(g[2])),Be(d,d,ui(g[0])),xe(e.globalMatrix,e.globalMatrix,_)}var d,g;if(e.meshes)for(const _ of e.meshes){const S=Si.applyTransformFast(_.aabb,e.globalMatrix);this.aabb.encapsulate(S)}if(e.children)for(const _ of e.children)this._applyTransformations(_,e.globalMatrix)}computeBoundsAndApplyParent(){const e=re([]);this.aabb=new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.nodes)this._applyTransformations(n,e)}computeModelMatrix(e,n,c,d,g,_,S=!1){n0(this.matrix,this,e.transform,this.position,n,c,d,g,_,S)}upload(e){if(!this.uploaded){for(const n of this.nodes)_w(n,e);for(const n of this.nodes)a0(n);this.uploaded=!0}}destroy(){for(const e of this.nodes)yw(e)}}function rv(r,e,n=!1){r.uploaded||(r.gfxTexture=new mw(e,r.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function dR(r,e,n){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,aR.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,lR.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,oR.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?rR:sR).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,uR.members,!0)),r.segments=ir.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const c=r.material;c.pbrMetallicRoughness.baseColorTexture&&rv(c.pbrMetallicRoughness.baseColorTexture,e),c.pbrMetallicRoughness.metallicRoughnessTexture&&rv(c.pbrMetallicRoughness.metallicRoughnessTexture,e),c.normalTexture&&rv(c.normalTexture,e),c.occlusionTexture&&rv(c.occlusionTexture,e,n),c.emissionTexture&&rv(c.emissionTexture,e)}function _w(r,e,n){if(r.meshes)for(const c of r.meshes)dR(c,e,n);if(r.children)for(const c of r.children)_w(c,e,n)}function a0(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)a0(e)}function yw(r){if(r.meshes)for(const n of r.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const n of r.children)yw(n)}function Ig(r,e){const n=r.json.bufferViews[e.bufferView],c=Jx[e.componentType];return new c(r.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==nv[e.type]*c.BYTES_PER_ELEMENT?n.byteStride/c.BYTES_PER_ELEMENT:nv[e.type]))}function vw(r,e,n,c){const d=Jx[e.componentType],g=(function(N){switch(N){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(d),_=r.json.bufferViews[e.bufferView],S=_.byteStride?_.byteStride/d.BYTES_PER_ELEMENT:nv[e.type],M=n.float32,R=M.length/n.capacity;for(let N=0,F=0;N<e.count*S;N+=S,F+=R)for(let U=0;U<R;U++)M[F+U]=c[N+U]*g;n._trim()}function hR(r,e,n){const c=r.indices,d=r.attributes,g={};g.indexArray=new Zr;const _=e.json.accessors[c],S=_.count/3;g.indexArray.reserve(S);const M=Ig(e,_);for(let U=0;U<S;U++)g.indexArray.emplaceBack(M[3*U],M[3*U+1],M[3*U+2]);g.indexArray._trim(),g.vertexArray=new Tl;const R=e.json.accessors[d.POSITION];g.vertexArray.reserve(R.count);const N=Ig(e,R);for(let U=0;U<R.count;U++)g.vertexArray.emplaceBack(N[3*U],N[3*U+1],N[3*U+2]);if(g.vertexArray._trim(),g.aabb=new Si(R.min,R.max),g.centroid=(function(U,W){const Z=[0,0,0],ee=U.length;if(ee>0){for(let ce=0;ce<ee;ce++){const oe=3*U[ce];Z[0]+=W[oe],Z[1]+=W[oe+1],Z[2]+=W[oe+2]}Z[0]/=ee,Z[1]/=ee,Z[2]/=ee}return Z})(M,N),d.COLOR_0!==void 0){const U=e.json.accessors[d.COLOR_0],W=nv[U.type],Z=Ig(e,U);g.colorArray=W===3?new Tl:new hu,g.colorArray.resize(U.count),vw(e,U,g.colorArray,Z)}if(d.NORMAL!==void 0){g.normalArray=new Tl;const U=e.json.accessors[d.NORMAL];g.normalArray.resize(U.count);const W=Ig(e,U);vw(e,U,g.normalArray,W)}if(d.TEXCOORD_0!==void 0&&n.length>0){g.texcoordArray=new Dr;const U=e.json.accessors[d.TEXCOORD_0];g.texcoordArray.resize(U.count);const W=Ig(e,U);vw(e,U,g.texcoordArray,W)}if(d._FEATURE_ID_RGBA4444!==void 0){const U=e.json.accessors[d._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Ig(e,U))}d._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Ig(e,e.json.accessors[d._FEATURE_RGBA4444]).buffer));const F=r.material;return g.material=(function(U,W){const{emissiveFactor:Z=[0,0,0],alphaMode:ee="OPAQUE",alphaCutoff:ce=.5,normalTexture:oe,occlusionTexture:me,emissiveTexture:ve,doubleSided:Se,name:De}=U,{baseColorFactor:Re=[1,1,1,1],metallicFactor:$e=1,roughnessFactor:We=1,baseColorTexture:tt,metallicRoughnessTexture:_t}=U.pbrMetallicRoughness||{},nt=me?W[me.index]:void 0;if(me&&me.extensions&&me.extensions.KHR_texture_transform&&nt){const xt=me.extensions.KHR_texture_transform;nt.offsetScale=[xt.offset[0],xt.offset[1],xt.scale[0],xt.scale[1]]}return{name:De,pbrMetallicRoughness:{baseColorFactor:new ma(...Re),metallicFactor:$e,roughnessFactor:We,baseColorTexture:tt?W[tt.index]:void 0,metallicRoughnessTexture:_t?W[_t.index]:void 0},doubleSided:Se,emissiveFactor:new ma(...Z),alphaMode:ee,alphaCutoff:ce,normalTexture:oe?W[oe.index]:void 0,occlusionTexture:nt,emissionTexture:ve?W[ve.index]:void 0,defined:U.defined===void 0}})(F!==void 0?e.json.materials[F]:{defined:!1},n),g}function C2(r,e,n){const{matrix:c,rotation:d,translation:g,scale:_,mesh:S,extras:M,children:R,name:N}=r,F={};if(F.name=N,F.localMatrix=c||(function(U,W,Z,ee){var ce=W[0],oe=W[1],me=W[2],ve=W[3],Se=ce+ce,De=oe+oe,Re=me+me,$e=ce*Se,We=ce*De,tt=ce*Re,_t=oe*De,nt=oe*Re,xt=me*Re,Mt=ve*Se,Pt=ve*De,Gt=ve*Re,Wt=ee[0],Ut=ee[1],$t=ee[2];return U[0]=(1-(_t+xt))*Wt,U[1]=(We+Gt)*Wt,U[2]=(tt-Pt)*Wt,U[3]=0,U[4]=(We-Gt)*Ut,U[5]=(1-($e+xt))*Ut,U[6]=(nt+Mt)*Ut,U[7]=0,U[8]=(tt+Pt)*$t,U[9]=(nt-Mt)*$t,U[10]=(1-($e+_t))*$t,U[11]=0,U[12]=Z[0],U[13]=Z[1],U[14]=Z[2],U[15]=1,U})([],d||[0,0,0,1],g||[0,0,0],_||[1,1,1]),F.globalMatrix=le(F.localMatrix),S!==void 0){F.meshes=n[S];const U=F.anchor=[0,0];for(const W of F.meshes){const{min:Z,max:ee}=W.aabb;U[0]+=Z[0]+ee[0],U[1]+=Z[1]+ee[1]}U[0]=Math.floor(U[0]/F.meshes.length/2),U[1]=Math.floor(U[1]/F.meshes.length/2)}if(M&&(M.id&&(F.id=M.id),M.lights&&(F.lights=(function(U){if(!U.length)return[];const W=(function(me){const ve=atob(me),Se=new Uint8Array(ve.length);for(let De=0;De<ve.length;De++)Se[De]=ve.codePointAt(De);return Se})(U),Z=[],ee=W.length/24,ce=new Uint16Array(W.buffer),oe=new Float32Array(W.buffer);for(let me=0;me<ee;me++){const ve=ce[2*me*6]/30,Se=ce[2*me*6+1]/30,De=ce[2*me*6+10]/100,Re=oe[6*me+1],$e=oe[6*me+2],We=oe[6*me+3],tt=oe[6*me+4],_t=We-Re,nt=tt-$e,xt=Math.hypot(_t,nt);Z.push({pos:[Re+.5*_t,$e+.5*nt,Se],normal:[nt/xt,-_t/xt,0],width:xt,height:ve,depth:De,points:[Re,$e,We,tt]})}return Z})(M.lights)),M.MAPBOX_geometry_bloom&&(F.isGeometryBloom=M.MAPBOX_geometry_bloom)),R){const U=[];for(const W of R)U.push(C2(e.json.nodes[W],e,n));F.children=U}return F}function fR(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Ag(r.vertices,r.indices,8,256),[n,c]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:n,max:c}}function mR(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const c=[];for(const _ of n){if(!Array.isArray(_)||_.length!==2)continue;const S=_[0],M=_[1];typeof S=="number"&&typeof M=="number"&&c.push(new Me(S,M))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let d=0;for(let _=0;_<c.length;_++){const S=c[_],M=c[(_+1)%c.length],R=c[(_+2)%c.length];d+=(S.x-M.x)*(R.y-M.y)-(R.x-M.x)*(S.y-M.y)}d>0&&c.reverse();const g=hm(c.flatMap((_=>[_.x,_.y])),[]);return g.length===0?null:{vertices:c,indices:g}}function pR(r,e){const n=[],c=[];let d=0;const g=[];for(const _ of r){d=n.length;const S=_.vertexArray.float32,M=_.indexArray.uint16;for(let R=0;R<_.vertexArray.length;R++)g[0]=S[3*R+0],g[1]=S[3*R+1],g[2]=S[3*R+2],Ii(g,g,e),n.push(new Me(g[0],g[1]));for(let R=0;R<3*_.indexArray.length;R++)c.push(M[R]+d)}if(c.length%3!=0)return null;for(let _=0;_<c.length;_+=3){const S=n[c[_+0]],M=n[c[_+1]],R=n[c[_+2]];(S.x-M.x)*(R.y-M.y)-(R.x-M.x)*(S.y-M.y)>0&&([c[_+1],c[_+2]]=[c[_+2],c[_+1]])}return{vertices:n,indices:c}}function xw(r){const e=(function(M,R){const N=[],F=WebGL2RenderingContext;if(M.json.textures)for(const U of M.json.textures){const W={magFilter:F.LINEAR,minFilter:F.NEAREST,wrapS:F.REPEAT,wrapT:F.REPEAT};U.sampler!==void 0&&Object.assign(W,M.json.samplers[U.sampler]),N.push({image:R[U.source],sampler:W,uploaded:!1})}return N})(r,r.images),n=(function(M,R){const N=[];for(const F of M.json.meshes){const U=[];for(const W of F.primitives)U.push(hR(W,M,R));N.push(U)}return N})(r,e),{scenes:c,scene:d,nodes:g}=r.json,_=c?c[d||0].nodes:[...g.keys()],S=[];for(const M of _)S.push(C2(g[M],r,n));return(function(M,R,N){const F={},U=new Set;for(let W=0;W<M.length;W++){const Z=N[R[W]];if(!Z.extras)continue;const ee=Z.extras["mapbox:footprint:version"],ce=Z.extras["mapbox:footprint:id"];(ee||ce)&&U.add(W),ee==="1.0.0"&&ce&&(F[ce]=W)}for(let W=0;W<M.length;W++){if(U.has(W))continue;const Z=M[W],ee=N[R[W]];if(!ee.extras)continue;let ce=null;Z.id in F&&(ce=pR(M[F[Z.id]].meshes,Z.localMatrix)),ce||(ce=mR(ee)),ce&&(Z.footprint=fR(ce))}if(U.size>0){const W=Array.from(U.values()).sort(((Z,ee)=>Z-ee));for(let Z=W.length-1;Z>=0;Z--)M.splice(W[Z],1)}})(S,_,r.json.nodes),S}function gR(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,n=r.aabb.min[0]-1,c=r.aabb.min[1]-1,d=Lg/(r.aabb.max[0]-n+2),g=Lg/(r.aabb.max[1]-c+2);for(let _=0;_<e.length;_+=3){const S=e[_+2],M=(e[_+0]-n)*d|0,R=(e[_+1]-c)*g|0;S>r.heightmap[R*Lg+M]&&(r.heightmap[R*Lg+M]=S)}}function M2(r,e,n,c,d){n.reserve(n.length+4*r.length),c.reserve(c.length+10*r.length),d.reserve(d.length+10*r.length);let g=c.length;for(const _ of r){const S=Math.min(10,Math.max(4,1.3*_.height))*e,M=[-_.normal[1],_.normal[0],0],R=Math.min(.29,.1*_.width/_.depth),N=_.width-2*_.depth*e*(R+.01),F=_i([],_.pos,M,N/2),U=_i([],_.pos,M,-N/2),W=[F[0],F[1],F[2]+_.height],Z=[U[0],U[1],U[2]+_.height],ee=_i([],_.normal,M,R);Ft(ee,ee,S);const ce=_i([],_.normal,M,-R);Ft(ce,ce,S),Ct(ee,F,ee),Ct(ce,U,ce),F[2]+=.1,U[2]+=.1,c.emplaceBack(ee[0],ee[1],ee[2]),c.emplaceBack(ce[0],ce[1],ce[2]),c.emplaceBack(F[0],F[1],F[2]),c.emplaceBack(U[0],U[1],U[2]),c.emplaceBack(W[0],W[1],W[2]),c.emplaceBack(Z[0],Z[1],Z[2]),c.emplaceBack(F[0],F[1],F[2]),c.emplaceBack(U[0],U[1],U[2]),c.emplaceBack(ee[0],ee[1],ee[2]),c.emplaceBack(ce[0],ce[1],ce[2]);const oe=N/S/2;d.emplaceBack(-oe-R,-1,oe,.8),d.emplaceBack(oe+R,-1,oe,.8),d.emplaceBack(-oe,0,oe,1.3),d.emplaceBack(oe,0,oe,1.3),d.emplaceBack(oe+R,-.8,oe,.7),d.emplaceBack(oe+R,-.8,oe,.7),d.emplaceBack(0,0,oe,1.3),d.emplaceBack(0,0,oe,1.3),d.emplaceBack(oe+R,-1.2,oe,.8),d.emplaceBack(oe+R,-1.2,oe,.8),n.emplaceBack(6+g,4+g,8+g),n.emplaceBack(7+g,9+g,5+g),n.emplaceBack(0+g,1+g,2+g),n.emplaceBack(1+g,3+g,2+g),g+=10}}function _R(r,e){const n={};n.indexArray=new Zr,n.vertexArray=new Tl,n.colorArray=new hu,M2(r,e,n.indexArray,n.vertexArray,n.colorArray);const c={defined:!0};c.emissiveFactor=ma.black;const d={};return d.baseColorFactor=ma.white,c.pbrMetallicRoughness=d,n.material=c,n.aabb=new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const P2=Ln([{name:"a_pos_3f",components:3,type:"Float32"}]),yR=Ln([{name:"a_normal_3",components:3,type:"Int16"}]),vR=Ln([{name:"a_centroid_3",components:3,type:"Int16"}]),j2=Ln([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),xR=Ln([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),bR=Ln([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),wR=Ln([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),SR=Ln([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),TR=Ln([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),R2=Ke.types,r0=32767;function kR(r,e){const n=Jt+e;for(const c of r)for(const d of c)if(d.x<-e||d.x>n||d.y<-e||d.y>n)return!1;return!0}function ER(r){switch(r){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${r}`)}}class bw{constructor(){this.layoutVertexArray=new Tl,this.layoutAttenuationArray=new hu,this.layoutColorArray=new kl,this.indexArray=new Zr,this.indexArrayForConflation=new Zr,this.segmentsBucket=new ir}}class ww{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new ir,this.entranceBloom=new bw;const n=66560;this.layoutVertexArray=new Tl,this.layoutVertexArray.reserve(n),this.layoutNormalArray=new nh,this.layoutNormalArray.reserve(n),this.layoutCentroidArray=new nh,this.layoutCentroidArray.reserve(n),this.layoutColorArray=new kl,this.layoutColorArray.reserve(n),this.layoutFloodLightDataArray=new $u,this.layoutFloodLightDataArray.reserve(n),this.layoutAOArray=new im,this.layoutAOArray.reserve(n),this.indexArray=new Zr,this.indexArray.reserve(66560),this.indexArrayForConflation=new Zr,this.segmentsBucket=new ir,this.entranceBloom=new bw,e&&(this.layoutFacadePaintArray=new kl,this.layoutFacadeDataArray=new ll,this.layoutFacadeVerticalRangeArray=new kl)}reserve(e,n,c){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(n),c&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class L2{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Dr,this.footprintsIndices=new $u,this.footprintsMin=new Me(1/0,1/0),this.footprintsMax=new Me(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new ww(!1),this.buildingWithFacade=new ww(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new Lc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.projection=e.projection,this.groundEffect=new pm(e),this.groundEffect.groundRadiusArray=new wl,this.hasAppearances=null}updateFootprints(e,n){const c=new Ag([],[],1),d={vertices:[],indices:new Uint32Array(0),grid:c,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};n.push({footprint:d,id:e})}updateAppearances(e,n,c,d){}prepare(){return(function(){if(Kx!=null||f2!=null)return null;if(z_!=null)return z_;const e=fetch(An.BUILDING_GEN_URL);return z_=(function(n){let c,d,g,_,S;function M(){c=new Uint8Array(S.buffer),d=new Int16Array(S.buffer),g=new Int32Array(S.buffer),_=new Float32Array(S.buffer)}function R(){throw new Error("Unexpected BuildingGen error.")}const N=()=>{},F={a:{a:R,f:function(U){const W=c.length,Z=Math.max(U>>>0,Math.ceil(1.2*W)),ee=Math.ceil((Z-W)/65536);try{return S.grow(ee),M(),!0}catch{return!1}},g:R,b:N,c:N,d:N,e:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,F):n.then((U=>U.arrayBuffer())).then((U=>WebAssembly.instantiate(U,F)))).then((U=>{const W=U.instance.exports;return(0,W.g)(),S=W.f,M(),new Kj({setStyle:W.h,setAOOptions:W.i,setMetricOptions:W.j,setStructuralOptions:W.k,setFacadeOptions:W.l,setFauxFacadeOptions:W.m,setFacadeClassifierOptions:W.n,addFeature:W.o,addFacade:W.p,generateMesh:W.q,getLastError:W.r,getOuterRingLength:W.s,getMeshCount:W.t,getPositionsPtr:W.u,getPositionsLength:W.v,getNormalsPtr:W.w,getNormalsLength:W.x,getAOPtr:W.y,getAOLength:W.z,getUVPtr:W.A,getUVLength:W.B,getFauxFacadePtr:W.C,getFauxFacadeLength:W.D,getIndicesPtr:W.E,getIndicesLength:W.F,getBuildingPart:W.G,getRingCount:W.H,getRingPtr:W.I,getRingLength:W.J,malloc:W.K,free:W.L,heapU8:c,heap16:d,heap32:g,heapF32:_})}))})(e).then((n=>(z_=null,Kx=n,Kx))).catch((n=>{mi("Could not load building-gen"),z_=null,f2=n})),z_})()}populate(e,n,c,d){const g=Jj();if(!g)return;const _=de(c);this.tileToMeter=_,this.brightness=n.brightness,g.setStyle({normalScale:[1,-1,_],tileToMeters:_}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const S=new Map,M=new Map;let R=0;for(const{feature:oe}of e){if(R2[oe.type]!=="LineString"){S.set(oe.id,oe.properties.source_id);continue}const me=this.layers[0]._featureFilter.needGeometry;if(me&&!this.layers[0]._featureFilter.filter(new Fa(this.zoom),oe,c))continue;const ve=it(oe,me);if(!me&&!this.layers[0]._featureFilter.filter(new Fa(this.zoom),ve,c))continue;const Se=me?ve.geometry:Ge(oe,c,d),De=[];for(const tt of Se)for(const _t of tt)De.push(_t.x),De.push(_t.y);const Re={coordinates:De,crossPerc:oe.properties.cross_perc,distanceToRoad:oe.properties.distance_to_road,entrances:oe.properties.entrances,sourceId:0},$e=oe.properties.source_id;let We=M.get($e);We||(We=[],M.set($e,We)),We.push(Re),++R}this.maxHeight=0;const N=new Array,F=new Set,U=oe=>{oe!=null&&F.add(oe)},W=(oe,me)=>{oe!=null&&N.push({buildingId:oe,footprintIndex:me})},Z=64*(e.length-R),ee=Z/2;this.buildingWithFacade.reserve(Z,ee,!0),this.buildingWithoutFacade.reserve(2*Z,2*ee,!1),this.footprintsIndices.reserve(16*(e.length-R)),this.footprintsVertices.reserve(8*(e.length-R));for(const{feature:oe,id:me,index:ve,sourceLayerIndex:Se}of e){if(R2[oe.type]==="LineString")continue;const De=this.layers[0]._featureFilter.needGeometry;if(De&&!this.layers[0]._featureFilter.filter(new Fa(this.zoom),oe,c))continue;let Re=null;if(oe.properties&&oe.properties.hasOwnProperty("building_id")&&(Re=oe.properties.building_id,F.has(Re)))continue;const $e=it(oe,De);if(!De&&!this.layers[0]._featureFilter.filter(new Fa(this.zoom),$e,c))continue;const We=De?$e.geometry:Ge(oe,c,d),tt=kg(We,500);let _t=!1;for(const Ki of tt)if(Ki.length!==1){_t=!0;break}if(_t){U(Re);continue}if(!kR(We,163)){U(Re);continue}const nt=this.layers[0],xt=ER(nt.layout.get("building-roof-shape").evaluate(oe,{},c)),Mt=nt.layout.get("building-base").evaluate(oe,{},c),Pt=nt.layout.get("building-height").evaluate(oe,{},c),Gt=nt.layout.get("building-flood-light-ground-radius").evaluate(oe,{},c),Wt=nt.paint.get("building-ambient-occlusion-intensity"),Ut=Gt/this.tileToMeter;oe.properties["building-part"]="roof";const $t=nt.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),vt=nt.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);oe.properties["building-part"]="wall";const yt=nt.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),Vt=nt.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);oe.properties["building-part"]="window";const si=nt.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),Qt=nt.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);oe.properties["building-part"]="door";const Oi=nt.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),pi=nt.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);let bi=nt.layout.get("building-flood-light-wall-radius").evaluate(oe,{},c);bi=ne(bi,0,2048);const Mi=bi/2048*r0,jn=S.get(me),ni=M.get(jn)||[],Li=ni.length!==0&&nt.layout.get("building-facade").evaluate(oe,{},c);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(Li,!1,1);let dn=0,Wn=0,Kn=0,wn=0,La=0,Le=0,Oe=0,bt=0,qt=0,hi=0,fi=0;if(Li){let Ki=Math.round(nt.layout.get("building-facade-floors").evaluate(oe,{},c));if(Mt===0){Ki=Math.max(1,Ki-(ni.length>0?1:0));let ka=4;if(Pt>100){const ur=[10,13,15];ka=ur[oe.id?oe.id%ur.length:0]}else Pt<=10&&(ka=3);g.setFacadeOptions(ka,!0),La=(Pt<15?1.3:1.61803)*ka/_}else La=Mt/_;Le=Pt/_,La=Math.min(La,Le),Kn=nt.layout.get("building-facade-unit-width").evaluate(oe,{},c)/_,wn=(Le-La)/Ki,g.setFauxFacadeOptions(!0,!0,Kn);const yr=nt.layout.get("building-facade-window").evaluate(oe,{},c);dn=yr[0],Wn=yr[1],Oe=Math.floor(65535*Math.min(1,La/Jt)),bt=Math.floor(65535*Math.min(1,Le/Jt)),qt=Math.floor(255*dn)<<8|Math.floor(255*Wn),hi=Math.floor(65535*Math.min(1,Kn/Jt)),fi=Math.floor(65535*Math.min(1,wn/Jt))}const Ni=Array(tt.length),Bi={x:1/0,y:1/0},bn={x:-1/0,y:-1/0},kn={x:0,y:0};let Cn=0;for(let Ki=0;Ki<tt.length;Ki++){const yr=tt[Ki];if(yr.length>0){const ka=[],ur=Array(yr.length+1);ur[0]=0;for(let ys=0;ys<yr.length;ys++){const Us=yr[ys];for(let as=0;as<Us.length;as++){const rs=Us[Us.length-as-1];Bi.x=Math.min(Bi.x,rs.x),Bi.y=Math.min(Bi.y,rs.y),bn.x=Math.max(bn.x,rs.x),bn.y=Math.max(bn.y,rs.y),kn.x+=rs.x,kn.y+=rs.y,Cn++,ka.push(rs.x),ka.push(rs.y)}ur[ys+1]=ka.length}Ni[Ki]={id:oe.id?oe.id:0,height:Pt,minHeight:Mt,sourceId:0,roofType:xt,coordinates:ka,ringIndices:ur}}}kn.x/=Cn||1,kn.y/=Cn||1;const Vn=g.generateMesh(Ni,ni);if(typeof Vn=="string"){mi(`Unable to generate building ${oe.id}: ${Vn}`),U(Re);continue}if(Vn.meshes.length===0||Vn.modifiedPolygonRings.length===0){U(Re);continue}const Qi=Li?this.buildingWithFacade:this.buildingWithoutFacade;let ln=0;for(const Ki of Vn.meshes)ln+=Ki.positions.length/3;const aa=Qi.segmentsBucket.prepareSegment(ln,Qi.layoutVertexArray,Qi.indexArray),ha=[];let fa=null,Ta=0,$a=-1;const Ia=Qi.layoutVertexArray.length,pa=Ia+ln;Qi.layoutVertexArray.resize(pa),Qi.layoutCentroidArray.resize(pa),Qi.layoutNormalArray.resize(pa),Qi.layoutAOArray.resize(pa),Qi.layoutColorArray.resize(pa),Qi.layoutFloodLightDataArray.resize(pa),Li&&(Qi.layoutFacadePaintArray.resize(pa),Qi.layoutFacadeDataArray.resize(pa),Qi.layoutFacadeVerticalRangeArray.resize(pa));const ba=Qi.indexArray.length;let En=0,Yn=Ia;for(const Ki of Vn.meshes){let yr,ka;if(Ki.buildingPart===1)yr=$t,ka=vt;else if(Ki.buildingPart===0)yr=yt,ka=Vt;else if(Ki.buildingPart===2)yr=si,ka=Qt;else{if(Ki.buildingPart!==3)continue;yr=Oi,ka=pi}if(ka=ne(ka,0,1),Ki.buildingPart===3){const Wa=new Array;for(let vs=0;vs<Ki.positions.length;vs+=12){const Id=Ki.positions[vs+0],pf=Ki.positions[vs+1],Po=Ki.positions[vs+3],jl=Ki.positions[vs+4],Uc=Ki.positions[vs+2],Pp=Ki.positions[vs+8]-Uc,X_=1,vh=Po-Id,xh=jl-pf,Mv=Math.hypot(vh,xh);Wa.push({pos:[Id+.5*vh,pf+.5*xh,Uc],normal:[xh/Mv,-vh/Mv,0],width:Mv,height:Pp,depth:X_,points:[Id,pf,Po,jl]})}const jr=Qi.entranceBloom.segmentsBucket.prepareSegment(10*Wa.length,Qi.entranceBloom.layoutVertexArray,Qi.entranceBloom.indexArray),Fr=Qi.entranceBloom.layoutVertexArray.length;Ta=Qi.entranceBloom.indexArray.length,M2(Wa,.5/this.tileToMeter,Qi.entranceBloom.indexArray,Qi.entranceBloom.layoutVertexArray,Qi.entranceBloom.layoutAttenuationArray);const uc=Qi.entranceBloom.layoutVertexArray.length-Fr;$a=Qi.entranceBloom.indexArray.length-Ta;for(let vs=0;vs<uc;vs++)Qi.entranceBloom.layoutColorArray.emplaceBack(255*Oi.r<<8|255*Oi.g,255*Oi.b<<8|51*pi);jr.vertexLength+=uc,jr.primitiveLength+=$a,fa={part:Ki.buildingPart,vertexOffset:Fr,vertexLength:uc}}Qi.layoutVertexArray.float32.set(Ki.positions,3*Yn);const ur=Ki.positions.length/3;for(let Wa=0;Wa<ur;++Wa){const jr=3*Wa;En=Math.max(En,Ki.positions[jr+2]);const Fr=Ki.normals[jr+1]*r0,uc=Ki.normals[jr+2]*r0,vs=3*(Yn+Wa);Qi.layoutNormalArray.int16[vs]=Ki.normals[jr]*r0,Qi.layoutNormalArray.int16[vs+1]=Fr,Qi.layoutNormalArray.int16[vs+2]=uc;const Id=Ki.ao[Wa];Qi.layoutAOArray.uint8[Yn+Wa]=255*Id;const pf=1+(Id-1)*Wt,Po=255*yr.b*pf<<8|255*ka;Qi.layoutColorArray.uint16[2*(Yn+Wa)]=255*yr.r*pf<<8|255*yr.g*pf,Qi.layoutColorArray.uint16[2*(Yn+Wa)+1]=Po}const ys=Math.floor(kn.x),Us=Math.floor(kn.y),as=Math.floor(Pt);for(let Wa=0;Wa<ur;++Wa){const jr=3*(Yn+Wa);Qi.layoutCentroidArray.int16[jr]=ys,Qi.layoutCentroidArray.int16[jr+1]=Us,Qi.layoutCentroidArray.int16[jr+2]=as}if(Qi.layoutFloodLightDataArray.uint16.fill(Ki.buildingPart===0?Mi:0,Yn,Yn+ur),Li){const Wa=255*si.r<<8|255*si.g,jr=255*si.b<<8|255*Qt;for(let Fr=0;Fr<ur;++Fr){const uc=2*(Yn+Fr);Qi.layoutFacadePaintArray.uint16[uc]=Wa,Qi.layoutFacadePaintArray.uint16[uc+1]=jr}for(let Fr=0;Fr<ur;++Fr)if(Ki.isFauxFacade[Fr]){const uc=Math.min(65535,Math.floor(Ki.uv[2*Fr]*Vn.outerRingLength));Qi.layoutFacadeDataArray.emplace(Yn+Fr,1|uc,qt,hi,fi),Qi.layoutFacadeVerticalRangeArray.emplace(Yn+Fr,Oe,bt)}else Qi.layoutFacadeDataArray.emplace(Yn+Fr,0,0,0,0),Qi.layoutFacadeVerticalRangeArray.emplace(Yn+Fr,0,0)}const rs=aa.vertexLength,Cs=Ki.indices.length/3,Jl=Qi.indexArray.length;Qi.indexArray.resize(Jl+Cs);for(let Wa=0;Wa<Cs;++Wa){const jr=3*Wa,Fr=3*Jl+jr;Qi.indexArray.uint16[Fr]=rs+Ki.indices[jr],Qi.indexArray.uint16[Fr+1]=rs+Ki.indices[jr+1],Qi.indexArray.uint16[Fr+2]=rs+Ki.indices[jr+2]}Ki.buildingPart!==1&&Ki.buildingPart!==0&&Ki.buildingPart!==2&&Ki.buildingPart!==3||ha.push({part:Ki.buildingPart,vertexOffset:Yn,vertexLength:Ki.positions.length/3}),Yn+=ur,aa.vertexLength+=ur,aa.primitiveLength+=Ki.indices.length/3}this.maxHeight=Math.max(this.maxHeight,En);const mr=Qi.indexArray.length-ba,Yi=this.footprintsIndices.length,Hn=this.footprintsVertices.length,Na=[],Ha=new Me(1/0,1/0),Ja=new Me(-1/0,-1/0),Nr=this.groundEffect.vertexArray.length;for(const Ki of Vn.modifiedPolygonRings){const yr=[],ka=new Me(1/0,1/0),ur=new Me(-1/0,-1/0);for(let ys=0;ys<Ki.length;ys+=2){const Us=Ki.length-ys-2;ka.x=Math.min(ka.x,Ki[Us]),ka.y=Math.min(ka.y,Ki[Us+1]),ur.x=Math.max(ur.x,Ki[Us]),ur.y=Math.max(ur.y,Ki[Us+1]);const as=new Me(Ki[Us],Ki[Us+1]);yr.push(as),Na.push(as.x,as.y),this.footprintsVertices.emplaceBack(as.x,as.y)}Ha.x=Math.min(Ha.x,ka.x),Ha.y=Math.min(Ha.y,ka.y),Ja.x=Math.max(Ja.x,ur.x),Ja.y=Math.max(Ja.y,ur.y),this.groundEffect.addData(yr,[ka,ur],Ut)}const qa=this.groundEffect.vertexArray.length-Nr;this.groundEffect.groundRadiusArray.reserveForAdditional(qa);for(let Ki=0;Ki<qa;Ki++)this.groundEffect.groundRadiusArray.emplaceBack(Gt);(Bi.x<0||bn.x>Jt||Bi.y<0||bn.y>Jt)&&this.featuresOnBorder.push({featureId:oe.id,footprintIndex:this.footprints.length});{const Ki=hm(Na,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Ki.length),this.footprintsIndices.uint16.set(Ki,Yi),this.buildingIds.add(Re??oe.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Ha.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Ha.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Ja.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Ja.y);const yr={footprintVertexOffset:Hn,footprintVertexLength:this.footprintsVertices.length-Hn,footprintIndexOffset:Yi,footprintIndexLength:this.footprintsIndices.length-Yi,min:Ha,max:Ja,hiddenFlags:0,indicesOffset:ba,indicesLength:mr,bloomIndicesOffset:Ta,bloomIndicesLength:$a,groundEffectVertexOffset:Nr,groundEffectVertexLength:qa,hasFauxFacade:Li,height:En,promoteId:me,feature:$e,parts:ha,buildingBloom:fa},ka=this.footprints.length;oe.id!==void 0&&this.featureFootprintLookup.set(oe.id,ka),W(Re,ka),this.footprints.push(yr)}this.programConfigurations.populatePaintArrays(Qi.layoutVertexArray.length,oe,ve,{},n.availableImages,c,n.brightness),this.groundEffect.addPaintPropertiesData(oe,ve,{},n.availableImages,c,n.brightness),n.featureIndex.insert(oe,We,ve,Se,this.index,Ia)}N.forEach((({buildingId:oe,footprintIndex:me})=>{F.has(oe)&&(this.footprints[me].hiddenFlags|=4)}));const ce=new Set;this.buildingIds.forEach(((oe,me,ve)=>{F.has(oe)||ce.add(oe)})),this.buildingIds=ce,this.groundEffect.prepareBorderSegments()}update(e,n,c,d,g,_,S){this.programConfigurations.updatePaintArrays(e,n,g,c,d,_,S),this.groundEffect.update(e,n,g,c,d,_,S),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const n=c=>{c.layoutVertexBuffer=e.createVertexBuffer(c.layoutVertexArray,P2.members),c.layoutNormalBuffer=e.createVertexBuffer(c.layoutNormalArray,yR.members),c.layoutCentroidBuffer=e.createVertexBuffer(c.layoutCentroidArray,vR.members),c.layoutFloodLightDataBuffer=e.createVertexBuffer(c.layoutFloodLightDataArray,TR.members),c.layoutFacadeDataArray&&c.layoutFacadeDataArray.length&&(c.layoutFacadeDataBuffer=e.createVertexBuffer(c.layoutFacadeDataArray,bR.members)),c.layoutFacadeVerticalRangeArray&&c.layoutFacadeVerticalRangeArray.length&&(c.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(c.layoutFacadeVerticalRangeArray,wR.members)),c.entranceBloom.layoutVertexArray.length&&(c.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(c.entranceBloom.layoutVertexArray,P2.members),c.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(c.entranceBloom.layoutAttenuationArray,SR.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=n=>{n.layoutVertexBuffer&&(n.layoutVertexBuffer.destroy(),n.layoutNormalBuffer.destroy(),n.layoutColorBuffer.destroy(),n.segmentsBucket.destroy(),n.indexBuffer&&n.indexBuffer.destroy(),n.entranceBloom.layoutVertexBuffer&&(n.entranceBloom.layoutVertexBuffer.destroy(),n.entranceBloom.layoutColorBuffer.destroy(),n.entranceBloom.layoutAttenuationBuffer.destroy(),n.entranceBloom.indexBuffer.destroy(),n.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,n,c=!0){let d=!1;const g=c?n:0,_=0|(c?-1:~n);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const S of e){const M=this.footprints[S],R=M.hiddenFlags&_|g;M.hiddenFlags!==R&&(M.hiddenFlags=R,d=!0,this.groundEffect.updateHiddenByLandmarkRange(M.groundEffectVertexOffset,M.groundEffectVertexLength,M.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const n=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};n(this.buildingWithoutFacade),n(this.buildingWithFacade);for(const d of this.footprints){const g=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let M=d.indicesOffset;M<_;M++)g.indexArrayForConflation.uint16[3*M+0]=0,g.indexArrayForConflation.uint16[3*M+1]=0,g.indexArrayForConflation.uint16[3*M+2]=0;const S=d.bloomIndicesOffset+d.bloomIndicesLength;for(let M=d.bloomIndicesOffset;M<S;M++)g.entranceBloom.indexArrayForConflation.uint16[3*M+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*M+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*M+2]=0}}const c=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=e.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=e.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const n=c=>{c.layoutColorBuffer?c.layoutColorBuffer.updateData(c.layoutColorArray):c.layoutColorBuffer=e.createVertexBuffer(c.layoutColorArray,j2.members,!0),c.layoutFacadePaintArray&&(c.layoutFacadePaintBuffer?c.layoutFacadePaintBuffer.updateData(c.layoutFacadePaintArray):c.layoutFacadePaintBuffer=e.createVertexBuffer(c.layoutFacadePaintArray,xR.members,!0)),c.entranceBloom.layoutColorBuffer?c.entranceBloom.layoutColorBuffer.updateData(c.entranceBloom.layoutColorArray):c.entranceBloom.layoutColorBuffer=e.createVertexBuffer(c.entranceBloom.layoutColorArray,j2.members,!0)};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,n){const c=e.paint.get("building-ambient-occlusion-intensity");for(const d of this.footprints){if(4&d.hiddenFlags)continue;const g=n[d.promoteId],_=d.feature;_.properties["building-part"]="roof";const S=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),M=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="wall";const R=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),N=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="window";const F=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),U=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="door";const W=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),Z=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical),ee=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const oe of d.parts){let me,ve=S;oe.part===1?(ve=S,me=M):oe.part===0?(ve=R,me=N):oe.part===2?(ve=F,me=U):oe.part===3&&(ve=W,me=Z),me=ne(me,0,1);for(let Se=0;Se<oe.vertexLength;Se++){const De=oe.vertexOffset+Se,Re=1+(ee.layoutAOArray.uint8[De]/255-1)*c;ee.layoutColorArray.emplace(De,ve.r*Re*255<<8|ve.g*Re*255,ve.b*Re*255<<8|255*me),d.hasFauxFacade&&ee.layoutFacadePaintArray.emplace(De,255*F.r<<8|255*F.g,255*F.b<<8|255*U)}}const ce=d.buildingBloom;if(ce)for(let oe=0;oe<ce.vertexLength;oe++)ee.entranceBloom.layoutColorArray.emplace(ce.vertexOffset+oe,255*W.r<<8|255*W.g,255*W.b<<8|51*Z)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,n,c){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const d=n.getReplacementRegionsForTile(e.toUnwrapped());if(vp(this.activeReplacements,d))return;this.activeReplacements=d;for(const _ of this.footprints)_.hiddenFlags&=-2;const g=[];for(const _ of this.activeReplacements){if(_.order<=Vx)continue;const S=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));for(const M of this.footprints)M.min.x>_.max.x||M.max.x<_.min.x||M.min.y>_.max.y||M.max.y<_.min.y||(g.length=0,CR(this.footprintsVertices,M.footprintVertexOffset,M.footprintVertexLength,_.footprintTileId.canonical,e.canonical,g),Jy(_.footprint,g,this.footprintsIndices.uint16,M.footprintIndexOffset,M.footprintIndexLength,0,-S)&&(M.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const n=this.featureFootprintLookup.get(e.id);return this.footprints[n]}return null}getHeightAtTileCoord(e,n){let c=Number.NEGATIVE_INFINITY,d=!0;const g=4*(e+Jt)*Jt+(n+Jt);if(this.footprintLookup.hasOwnProperty(g)){const S=this.footprintLookup[g];return S?{height:S.height,hidden:S.hiddenFlags!==0}:void 0}const _=new Me(e,n);for(const S of this.footprints)e>S.max.x||S.min.x>e||n>S.max.y||S.min.y>n||S.height<=c||AR(_,this.footprintsVertices.float32.subarray(2*S.footprintVertexOffset,2*(S.footprintVertexOffset+S.footprintVertexLength)),this.footprintsIndices.uint16.subarray(S.footprintIndexOffset,S.footprintIndexOffset+S.footprintIndexLength))&&(c=S.height,this.footprintLookup[g]=S,d=S.hiddenFlags!==0);if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:d};this.footprintLookup[g]=void 0}}function AR(r,e,n){for(let c=0;c<n.length;c+=3){const d=n[c],g=n[c+1],_=n[c+2],S=e[2*d+0],M=e[2*d+1],R=e[2*g+0],N=e[2*g+1],F=e[2*_+0],U=e[2*_+1],W=(S-F)*(r.y-U)-(M-U)*(r.x-F),Z=(R-S)*(r.y-M)-(N-M)*(r.x-S);if(W<0!=Z<0&&W!==0&&Z!==0)continue;const ee=(F-R)*(r.y-N)-(U-N)*(r.x-R);if(ee===0||ee<0==W+Z<=0)return!0}return!1}function CR(r,e,n,c,d,g){const _=Math.pow(2,c.z-d.z);for(let S=0;S<n;S++){let M=r.float32[2*(S+e)+0],R=r.float32[2*(S+e)+1];M=(M+d.x*Jt)*_-c.x*Jt,R=(R+d.y*Jt)*_-c.y*Jt,g.push(new Me(M,R))}}let I2,z2;vi(L2,"BuildingBucket",{omit:["layers"]}),vi(ww,"BuildingGeometry"),vi(bw,"BuildingBloomGeometry");const MR=Ln([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),PR=Ln([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:jR}=MR,RR=Ln([{name:"a_packed",components:3,type:"Float32"}]),{members:LR}=RR,IR=Ln([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:zR}=IR;class D2{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new fr({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const c=this.getKey(e,n);return this.positions[c]}trim(){const e=this.width,n=this.height=st(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,c){const d=[];let g=e.length%2==1?-e[e.length-1]*c:0,_=e[0]*c,S=!0;d.push({left:g,right:_,isDash:S,zeroLength:e[0]===0});let M=e[0];for(let R=1;R<e.length;R++){S=!S;const N=e[R];g=M*c,M+=N,_=M*c,d.push({left:g,right:_,isDash:S,zeroLength:N===0})}return d}addRoundDash(e,n,c){const d=n/2;for(let g=-c;g<=c;g++){const _=this.width*(this.nextRow+c+g);let S=0,M=e[S];for(let R=0;R<this.width;R++){R/M.right>1&&(M=e[++S]);const N=Math.abs(R-M.left),F=Math.abs(R-M.right),U=Math.min(N,F);let W;const Z=g/c*(d+1);if(M.isDash){const ee=d-Math.abs(Z);W=Math.sqrt(U*U+ee*ee)}else W=d-Math.sqrt(U*U+Z*Z);this.image.data[_+R]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(e,n){for(let M=e.length-1;M>=0;--M){const R=e[M],N=e[M+1];R.zeroLength?e.splice(M,1):N&&N.isDash===R.isDash&&(N.left=R.left,e.splice(M,1))}const c=e[0],d=e[e.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const g=this.width*this.nextRow;let _=0,S=e[_];for(let M=0;M<this.width;M++){M/S.right>1&&(S=e[++_]);const R=Math.abs(M-S.left),N=Math.abs(M-S.right),F=Math.min(R,N);this.image.data[g+M]=Math.max(0,Math.min(255,(S.isDash?F:-F)+n+128))}}addDash(e,n){const c=this.getKey(e,n);if(this.positions[c])return this.positions[c];const d=n==="round",g=d?7:0,_=2*g+1;if(this.nextRow+_>this.height)return mi("LineAtlas out of space"),null;e.length===0&&e.push(1);let S=0;for(let N=0;N<e.length;N++)e[N]<0&&(mi("Negative value is found in line dasharray, replacing values with 0"),e[N]=0),S+=e[N];if(S!==0){const N=this.width/S,F=this.getDashRanges(e,this.width,N);d?this.addRoundDash(F,N,g):this.addRegularDash(F,n==="square"?.5*N:0)}const M=this.nextRow+g;this.nextRow+=_;const R={tl:[M,g],br:[S,0]};return this.positions[c]=R,R}}vi(D2,"LineAtlas");const DR=Ke.types,OR=Math.cos(Math.PI/180*37.5),NR=Math.cos(Math.PI/180*5);class Sw{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new jc,this.layoutVertexArray2=new Tl,this.patternVertexArray=new Tl,this.indexArray=new Zr,this.programConfigurations=new Lc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new ir,this.maxLineLength=0,this.zOffsetVertexArray=new Tl,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:Jt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,d){}populate(e,n,c,d){this.hasPattern=Vy("line",this.layers,this.pixelRatio,n);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=de(c);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const U=this.layers[0].layout.get("line-z-offset"),W=U.isConstant()&&!U.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&W?"none":"offset",this.elevationType==="offset"&&_==="none"&&mi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&S!==void 0;const M=[];for(const{feature:U,id:W,index:Z,sourceLayerIndex:ee}of e){const ce=this.layers[0]._featureFilter.needGeometry,oe=it(U,ce);if(!this.layers[0]._featureFilter.filter(new Fa(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),oe,c))continue;const me=g?g.evaluate(oe,{},c):void 0,ve={id:W,properties:U.properties,type:U.type,sourceLayerIndex:ee,index:Z,geometry:ce?oe.geometry:Ge(U,c,d),patterns:{},sortKey:me};M.push(ve)}g&&M.sort(((U,W)=>U.sortKey-W.sortKey));const{lineAtlas:R,featureIndex:N}=n,F=this.addConstantDashes(R);for(const U of M){const{geometry:W,index:Z,sourceLayerIndex:ee}=U;if(F&&this.addFeatureDashes(U,R),this.hasPattern){const ce=Hy("line",this.layers,U,this.zoom,this.pixelRatio,n);this.patternFeatures.push(ce)}else this.addFeature(U,W,Z,c,R.positions,n.availableImages,n.brightness,n.elevationFeatures);N.insert(e[Z].feature,W,Z,ee,this.index)}}addConstantDashes(e){let n=!1;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(d.kind!=="constant"||g.kind!=="constant")n=!0;else{const _=g.value,S=d.value;if(!S)continue;e.addDash(S,_)}}return n}addFeatureDashes(e,n){const c=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if(g.kind==="constant"&&_.kind==="constant")continue;let S,M;if(g.kind==="constant"){if(S=g.value,!S)continue}else S=g.evaluate({zoom:c},e);M=_.kind==="constant"?_.value:_.evaluate({zoom:c},e),n.addDash(S,M),e.patterns[d.id]=[n.getKey(S,M)]}}update(e,n,c,d,g,_,S,M){this.programConfigurations.updatePaintArrays(e,n,g,c,d,_,S,M)}addFeatures(e,n,c,d,g,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,n,c,d,_,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,LR)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,zR)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,PR.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jR),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,n){let c,d;if(n&&n>0?(c=`mapbox_clip_start_${n}`,d=`mapbox_clip_end_${n}`):(c="mapbox_clip_start",d="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(c)&&e.properties.hasOwnProperty(d))return{start:+e.properties[c],end:+e.properties[d]}}addFeature(e,n,c,d,g,_,S,M){const R=this.layers[0].layout,N=R.get("line-join").evaluate(e,{}),F=R.get("line-cap").evaluate(e,{}),U=R.get("line-miter-limit"),W=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const Z=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=R.get("line-z-offset").value;const ee=this.layers[0].paint.get("line-width").value;if(ee.kind!=="constant"&&ee.isLineProgressConstant===!1&&(this.variableWidthValue=ee),this.elevationType==="road"){const ce=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,n,d,M,N,F,U,W)){const[oe,me]=this.clipRuntimeLinesToTile(n,1);for(let ve=0;ve<oe.length;ve++){const Se=oe[ve],De=me[ve],Re={progress:{min:De.progress.min,max:De.progress.max},nextDir:this.computeSegNextDir(De,Se),prevDir:this.computeSegPrevDir(De,Se)};this.addLine(Se,e,d,N,F,U,W,Re,Z&&De.parentIndex>0?De.parentIndex:null)}this.fillNonElevatedRoadSegment(ce)}}else for(let ce=0;ce<n.length;ce++)this.addLine(n[ce],e,d,N,F,U,W,void 0,Z&&ce>0?ce:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,g,_,d,S,void 0,this.worldview)}computeSegNextDir(e,n){return e.nextPoint.sub(n.at(-2)).unit()}computeSegPrevDir(e,n){return n[1].sub(e.prevPoint).unit()}clipLinesToTile(e,n){return ri(e,-n,-n,Jt+n,Jt+n)}clipRuntimeLinesToTile(e,n){const c=[];return[ri(e,-n,-n,Jt+n,Jt+n,c),c]}addElevatedRoadFeature(e,n,c,d,g,_,S,M){const R=[],N=ua.getElevationFeature(e,d);if(N){const F=this.clipLinesToTile(n,1),U=this.prepareElevatedLines(F,N,c);for(const W of U)R.push({geometry:W,elevation:N,elevationTileID:c,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(R.length===0)return!1;for(const F of R){const U=this.layoutVertexArray.length;this.addLine(F.geometry,e,c,g,_,S,M);const W=new va(c,F.elevationTileID);if(F.elevation)for(let Z=U;Z<this.layoutVertexArray.length;Z++){const ee=new Me(this.layoutVertexArray.int16[6*Z]>>1,this.layoutVertexArray.int16[6*Z+1]>>1),ce=W.pointElevation(ee,F.elevation,.05);this.updateHeightRange(ce),this.zOffsetVertexArray.emplaceBack(ce,0,0)}else this.fillNonElevatedRoadSegment(U)}return!0}prepareElevatedLines(e,n,c){if(n.constantHeight!=null)return e;const d=[],g=1/de(c);for(const _ of e)oi(_,new ta(n,g),0,d);return d}fillNonElevatedRoadSegment(e){for(let n=e;n<this.layoutVertexArray.length;n++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,n,c,d,g,_,S,M,R){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=R?this.lineFeatureClips(n,R):this.lineClips;const N=d==="none";this.patternJoinNone=this.hasPattern&&N,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const F=M&&M.progress.min>0,U=M&&M.progress.max<1;if(this.lineClips){let tt={min:this.lineClips.start,max:this.lineClips.end},_t=1;if(M){const Mt=this.lineClips.end-this.lineClips.start;tt=(function(Pt,Gt,Wt){return{min:oa(Pt.min,Gt,Wt),max:oa(Pt.max,Gt,Wt)}})(M.progress,{min:0,max:1},tt),Mt>0&&(_t=(tt.max-tt.min)/Mt)}const nt=+n.properties.mapbox_clip_feature_len,xt=+n.properties.mapbox_clip_seg_len;if(Number.isNaN(nt)||Number.isNaN(xt)){for(let Pt=0;Pt<e.length-1;Pt++)this.totalDistance+=e[Pt].dist(e[Pt+1]);const Mt=this.totalDistance/(tt.max-tt.min);this.totalFeatureLength=Number.isFinite(Mt)?Mt:0,this.lineClips.start=tt.min,this.lineClips.end=tt.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=nt,this.distance=xt*_t,this.lineClips.start=tt.min,this.lineClips.end=tt.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const W=DR[n.type]==="Polygon";let Z=e.length;for(;Z>=2&&e[Z-1].equals(e[Z-2]);)Z--;let ee=0;for(;ee<Z-1&&e[ee].equals(e[ee+1]);)ee++;if(Z<(W?3:2))return;d==="bevel"&&(_=1.05);const ce=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray);let oe,me,ve,Se,De,Re,$e,We;M&&M.prevDir&&(Re=M.prevDir.perp()),M&&M.nextDir&&($e=M.nextDir.perp()),this.e1=this.e2=-1,W&&(oe=e[Z-2],De=e[ee].sub(oe)._unit()._perp());for(let tt=ee;tt<Z;tt++){if(ve=tt===Z-1?W?e[ee+1]:void 0:e[tt+1],ve&&e[tt].equals(ve))continue;De&&(Se=De),oe&&(me=oe),oe=e[tt],We=this.evaluateLineProgressFeatures(me?me.dist(oe):0),De=ve?ve.sub(oe)._unit()._perp():Se,Se=Se||De;const _t=me&&ve;let nt=_t?d:W||N?"butt":g;const xt=Se.x*De.x+Se.y*De.y;if(N){const yt=function(Vt){if(Vt.patternJoinNone){const si=Vt.segmentPoints.length/2,Qt=Vt.lineSoFar-Vt.segmentStart;for(let Oi=0;Oi<si;++Oi){const pi=Vt.segmentPoints[2*Oi+1],bi=Math.round(Vt.segmentPoints[2*Oi])+.5+.25*pi;Vt.patternVertexArray.emplaceBack(bi,Qt,Vt.segmentStart),Vt.patternVertexArray.emplaceBack(bi,Qt,Vt.segmentStart)}Vt.segmentPoints.length=0}Vt.e1=Vt.e2=-1};if(_t&&xt<NR){this.updateDistance(me,oe),this.addCurrentVertex(oe,Se,1,1,ce,We),yt(this),this.addCurrentVertex(oe,De,-1,-1,ce,We);continue}if(me){if(!ve){this.updateDistance(me,oe),this.addCurrentVertex(oe,Se,1,1,ce,We),yt(this);continue}nt="miter"}}let Mt=Se.add(De);Mt.x===0&&Mt.y===0||Mt._unit();const Pt=Mt.x*De.x+Mt.y*De.y,Gt=Pt!==0?1/Pt:1/0,Wt=2*Math.sqrt(2-2*Pt),Ut=Pt<OR&&me&&ve,$t=Se.x*De.y-Se.y*De.x>0,vt=this.overscaling<=16?15*Jt/(512*this.overscaling):0;if(_t&&nt==="round"){if(Gt<S)nt="miter";else if(Gt<=2){const yt=Tw(oe,-10,Jt+10);nt=this.elevationType==="offset"&&(yt||this.hasCrossSlope)?"miter":"fakeround"}}if(nt==="miter"&&Gt>_&&(nt="bevel"),nt==="bevel"&&(Gt>2&&(nt="flipbevel"),Gt<_&&(nt="miter")),me&&!(nt==="miter"&&Ut)&&this.updateDistance(me,oe),nt==="miter")if(Ut){const yt=oe.dist(me);if(yt>2*vt){const si=oe.sub(oe.sub(me)._mult(vt/yt)._round());this.updateDistance(me,si),this.addCurrentVertex(si,Se,0,0,ce,We),me=si}this.updateDistance(me,oe),Mt._mult(Gt),this.addCurrentVertex(oe,Mt,0,0,ce,We);const Vt=oe.dist(ve);if(Vt>2*vt){const si=oe.add(ve.sub(oe)._mult(vt/Vt)._round());this.updateDistance(oe,si),this.addCurrentVertex(si,De,0,0,ce,We),oe=si}}else Mt._mult(Gt),this.addCurrentVertex(oe,Mt,0,0,ce,We);else if(nt==="flipbevel"){if(Gt>100)Mt=De.mult(-1);else{const yt=Gt*Se.add(De).mag()/Se.sub(De).mag();Mt._perp()._mult(yt*($t?-1:1))}this.addCurrentVertex(oe,Mt,0,0,ce,We),this.addCurrentVertex(oe,Mt.mult(-1),0,0,ce,We)}else if(nt==="bevel"||nt==="fakeround"){We!=null&&me&&this.addCurrentVertex(oe,$e||Se,-1,-1,ce,We);const yt=oe.dist(me)<=2*vt&&nt!=="bevel",Vt=Mt.mult($t?1:-1);Vt._mult(Gt);const si=De.mult($t?-1:1),Qt=Se.mult($t?-1:1),Oi=this.evaluateLineProgressFeatures(this.distance);if(We==null&&(this.addHalfVertex(oe,Vt.x,Vt.y,!1,!$t,0,ce,Oi),yt||this.addHalfVertex(oe,Vt.x+2*Qt.x,Vt.y+2*Qt.y,!1,$t,0,ce,Oi)),nt==="fakeround"){const pi=Math.round(180*Wt/Math.PI/20);this.addHalfVertex(oe,Qt.x,Qt.y,!1,$t,0,ce,Oi);for(let bi=0;bi<pi;bi++){let Mi=bi/pi;if(Mi!==.5){const ni=Mi-.5;Mi+=Mi*ni*(Mi-1)*((1.0904+xt*(xt*(3.55645-1.43519*xt)-3.2452))*ni*ni+(.848013+xt*(.215638*xt-1.06021)))}const jn=si.sub(Qt)._mult(Mi)._add(Qt)._unit();this.addHalfVertex(oe,jn.x,jn.y,!1,$t,0,ce,Oi)}this.addHalfVertex(oe,si.x,si.y,!1,$t,0,ce,Oi)}yt||We!=null||this.addHalfVertex(oe,Vt.x+2*si.x,Vt.y+2*si.y,!1,$t,0,ce,Oi),We!=null&&ve&&this.addCurrentVertex(oe,Re||De,1,1,ce,We)}else if(nt==="butt")this.addCurrentVertex(oe,Mt,0,0,ce,We);else if(nt==="square"){if(!me){const yt=F?0:-1;this.addCurrentVertex(oe,Mt,yt,yt,ce,We)}if(this.addCurrentVertex(oe,Mt,0,0,ce,We),me){const yt=U?0:1;this.addCurrentVertex(oe,Mt,yt,yt,ce,We)}}else if(nt==="round"){if(me){const yt=!_t&&$e?$e:Se;this.addCurrentVertex(oe,yt,0,0,ce,We),!_t&&U||this.addCurrentVertex(oe,yt,1,1,ce,We,!0)}if(ve){const yt=!_t&&Re?Re:De;!_t&&F||this.addCurrentVertex(oe,yt,-1,-1,ce,We,!0),this.addCurrentVertex(oe,yt,0,0,ce,We)}}}}addVerticesTo(e,n,c,d,g,_,S,M,R,N){const F=(n.w-e.w)/this.tessellationStep|0;let U=0;const W=this.scaledDistance;if(F>1){this.lineSoFar=e.w;const ee=(n.x-e.x)/F,ce=(n.y-e.y)/F,oe=(n.z-e.z)/F,me=(n.w-e.w)/F;for(let ve=1;ve<F;++ve){e.x+=ee,e.y+=ce,e.z+=oe,this.lineSoFar+=me,U+=me;const Se=this.evaluateLineProgressFeatures(this.prevDistance+U);this.scaledDistance=(this.prevDistance+U)/this.totalDistance,this.addHalfVertex(e,c,d,N,!1,S,R,Se),this.addHalfVertex(e,g,_,N,!0,-M,R,Se)}}this.lineSoFar=n.w,this.scaledDistance=W;const Z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,c,d,N,!1,S,R,Z),this.addHalfVertex(n,g,_,N,!0,-M,R,Z)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):mi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:n}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}}addCurrentVertex(e,n,c,d,g,_,S=!1){const M=n.x+n.y*c,R=n.y-n.x*c,N=n.y*d-n.x,F=-n.y-n.x*d;if(_!=null){const U=this.elevationType==="offset",W=-10,Z=Jt+10,ee=_.zOffset,ce=new ti(e.x,e.y,ee,this.lineSoFar),oe=!!U&&Tw(e,W,Z),me=this.lineSoFar,ve=this.distance;if(this.currentVertex)if(oe){const Se=this.currentVertexIsOutside,De=this.currentVertex,Re=new ti(e.x,e.y,ee,this.lineSoFar);if(Ci(De,Re,W,Z),!Tw(Re,W,Z)){if(Se){this.e1=this.e2=-1,this.distance-=De.dist(ce),this.lineSoFar=De.w;const $e=this.evaluateLineProgressFeatures(De.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(De,M,R,S,!1,c,g,$e),this.addHalfVertex(De,N,F,S,!0,-d,g,$e),this.prevDistance=this.distance}this.distance=this.prevDistance+De.dist(Re),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(De,Re,M,R,N,F,c,d,g,S),this.distance=ve,this.scaledDistance=this.distance/this.totalDistance}}else{const Se=this.currentVertex;if(this.currentVertexIsOutside){Ci(Se,ce,W,Z),this.e1=this.e2=-1,this.distance-=Se.dist(ce),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Se.w;const De=this.evaluateLineProgressFeatures(Se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Se,M,R,S,!1,c,g,De),this.addHalfVertex(Se,N,F,S,!0,-d,g,De),this.prevDistance=this.distance,this.distance=ve,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Se,ce,M,R,N,F,c,d,g,S)}else oe||(this.addHalfVertex(e,M,R,S,!1,c,g,_),this.addHalfVertex(e,N,F,S,!0,-d,g,_));this.currentVertex=ce,this.currentVertexIsOutside=oe,this.lineSoFar=me}else this.addHalfVertex(e,M,R,S,!1,c,g,_),this.addHalfVertex(e,N,F,S,!0,-d,g,_)}addHalfVertex({x:e,y:n},c,d,g,_,S,M,R){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(n<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const F=Gi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,F)}const N=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),M.primitiveLength++),_?this.e2=N:this.e1=N,R!=null&&this.zOffsetVertexArray.emplaceBack(R.zOffset,R.variableWidth,R.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function Tw(r,e,n){return r.x<e||r.x>n||r.y<e||r.y>n}let O2,N2;function F2(r,e,n){return e*(Jt/(r.tileSize*Math.pow(2,n-r.tileID.overscaledZ)))}vi(Sw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const B2=(r,e,n)=>(1-n)*r+n*e;function U2(r,e){return 1/F2(r,1,e.tileZoom)}function $2(r,e,n,c){return r.translatePosMatrix(c||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const V2=r=>{const e=[];H2(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=r.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const c=r.layout.get("line-join").constantOr("miter")==="none",d=!!r.paint.get("line-pattern").constantOr(1);return c&&d&&e.push("LINE_JOIN_NONE"),e};function H2(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let kw;const G2=()=>kw||(kw={layout:O2||(O2=new dr({"line-cap":new li(rt.layout_line["line-cap"]),"line-join":new li(rt.layout_line["line-join"]),"line-miter-limit":new ei(rt.layout_line["line-miter-limit"]),"line-round-limit":new ei(rt.layout_line["line-round-limit"]),"line-sort-key":new li(rt.layout_line["line-sort-key"]),"line-z-offset":new li(rt.layout_line["line-z-offset"]),"line-elevation-reference":new ei(rt.layout_line["line-elevation-reference"]),"line-cross-slope":new ei(rt.layout_line["line-cross-slope"]),visibility:new ei(rt.layout_line.visibility),"line-width-unit":new ei(rt.layout_line["line-width-unit"])})),paint:N2||(N2=new dr({"line-opacity":new li(rt.paint_line["line-opacity"]),"line-color":new li(rt.paint_line["line-color"]),"line-translate":new ei(rt.paint_line["line-translate"]),"line-translate-anchor":new ei(rt.paint_line["line-translate-anchor"]),"line-width":new li(rt.paint_line["line-width"]),"line-gap-width":new li(rt.paint_line["line-gap-width"]),"line-offset":new li(rt.paint_line["line-offset"]),"line-blur":new li(rt.paint_line["line-blur"]),"line-dasharray":new li(rt.paint_line["line-dasharray"]),"line-pattern":new li(rt.paint_line["line-pattern"]),"line-pattern-cross-fade":new ei(rt.paint_line["line-pattern-cross-fade"]),"line-gradient":new Sd(rt.paint_line["line-gradient"]),"line-trim-offset":new ei(rt.paint_line["line-trim-offset"]),"line-trim-fade-range":new ei(rt.paint_line["line-trim-fade-range"]),"line-trim-color":new ei(rt.paint_line["line-trim-color"]),"line-emissive-strength":new li(rt.paint_line["line-emissive-strength"]),"line-border-width":new li(rt.paint_line["line-border-width"]),"line-border-color":new li(rt.paint_line["line-border-color"]),"line-occlusion-opacity":new ei(rt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},kw);class FR extends li{possiblyEvaluate(e,n){return n=new Fa(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition,worldview:n.worldview}),super.possiblyEvaluate(e,n)}evaluate(e,n,c,d){return n=Object.assign({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,c,d)}}let sv;function q2(r,e){return e>0?e+2*r:r}const BR=Ln([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),UR=Ln([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),$R=Ln([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ln([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const VR=Ln([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),HR=Ln([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),GR=Ln([{name:"a_texb",components:2,type:"Uint16"}]),qR=Ln([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),WR=Ln([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ln([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const W2=Ln([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ZR=Ln([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ln([{name:"triangle",components:3,type:"Uint16"}]),Ln([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ln([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Ln([{type:"Float32",name:"offsetX"}]),Ln([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Bs=24;function XR(r,e,n){return r.sections.forEach((c=>{c.text=(function(d,g,_){const S=g.layout.get("text-transform").evaluate(_,{});return S==="uppercase"?d=d.toLocaleUpperCase():S==="lowercase"&&(d=d.toLocaleLowerCase()),du.applyArabicShaping&&(d=du.applyArabicShaping(d)),d})(c.text,e,n)})),r}const ov={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function YR(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function KR(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const Ew=4294967296,Z2=1/Ew,X2=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let s0=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,n=this.length){for(;this.pos<n;){const c=this.readVarint(),d=c>>3,g=this.pos;this.type=7&c,r(d,e,this),this.pos===g&&this.skip(c)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Ew;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Ew;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let n,c;return c=e[this.pos++],n=127&c,c<128?n:(c=e[this.pos++],n|=(127&c)<<7,c<128?n:(c=e[this.pos++],n|=(127&c)<<14,c<128?n:(c=e[this.pos++],n|=(127&c)<<21,c<128?n:(c=e[this.pos],n|=(15&c)<<28,(function(d,g,_){const S=_.buf;let M,R;if(R=S[_.pos++],M=(112&R)>>4,R<128||(R=S[_.pos++],M|=(127&R)<<3,R<128)||(R=S[_.pos++],M|=(127&R)<<10,R<128)||(R=S[_.pos++],M|=(127&R)<<17,R<128)||(R=S[_.pos++],M|=(127&R)<<24,R<128)||(R=S[_.pos++],M|=(1&R)<<31,R<128))return O_(d,M,g);throw new Error("Expected varint not more than 10 bytes")})(n,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&X2?X2.decode(this.buf.subarray(e,r)):(function(n,c,d){let g="",_=c;for(;_<d;){const S=n[_];let M,R,N,F=null,U=S>239?4:S>223?3:S>191?2:1;if(_+U>d)break;U===1?S<128&&(F=S):U===2?(M=n[_+1],(192&M)==128&&(F=(31&S)<<6|63&M,F<=127&&(F=null))):U===3?(M=n[_+1],R=n[_+2],(192&M)==128&&(192&R)==128&&(F=(15&S)<<12|(63&M)<<6|63&R,(F<=2047||F>=55296&&F<=57343)&&(F=null))):U===4&&(M=n[_+1],R=n[_+2],N=n[_+3],(192&M)==128&&(192&R)==128&&(192&N)==128&&(F=(15&S)<<18|(63&M)<<12|(63&R)<<6|63&N,(F<=65535||F>=1114112)&&(F=null))),F===null?(F=65533,U=1):F>65535&&(F-=65536,g+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),g+=String.fromCharCode(F),_+=U}return g})(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const n=this.readPackedEnd();for(;this.pos<n;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Z2),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Z2),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(e,n){let c,d;if(e>=0?(c=e%4294967296|0,d=e/4294967296|0):(c=~(-e%4294967296),d=~(-e/4294967296),4294967295^c?c=c+1|0:(c=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),(function(g,_,S){S.buf[S.pos++]=127&g|128,g>>>=7,S.buf[S.pos++]=127&g|128,g>>>=7,S.buf[S.pos++]=127&g|128,g>>>=7,S.buf[S.pos++]=127&g|128,S.buf[S.pos]=127&(g>>>=7)})(c,0,n),(function(g,_){const S=(7&g)<<4;_.buf[_.pos++]|=S|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))})(d,n)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=(function(c,d,g){for(let _,S,M=0;M<d.length;M++){if(_=d.charCodeAt(M),_>55295&&_<57344){if(!S){_>56319||M+1===d.length?(c[g++]=239,c[g++]=191,c[g++]=189):S=_;continue}if(_<56320){c[g++]=239,c[g++]=191,c[g++]=189,S=_;continue}_=S-55296<<10|_-56320|65536,S=null}else S&&(c[g++]=239,c[g++]=191,c[g++]=189,S=null);_<128?c[g++]=_:(_<2048?c[g++]=_>>6|192:(_<65536?c[g++]=_>>12|224:(c[g++]=_>>18|240,c[g++]=_>>12&63|128),c[g++]=_>>6&63|128),c[g++]=63&_|128)}return g})(this.buf,r,this.pos);const n=this.pos-e;n>=128&&Y2(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=r[n]}writeRawMessage(r,e){this.pos++;const n=this.pos;r(e,this);const c=this.pos-n;c>=128&&Y2(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c}writeMessage(r,e,n){this.writeTag(r,2),this.writeRawMessage(e,n)}writePackedVarint(r,e){e.length&&this.writeMessage(r,JR,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,QR,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,iL,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,eL,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,tL,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,nL,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,aL,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,rL,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,sL,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function O_(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Y2(r,e,n){const c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(c);for(let d=n.pos-1;d>=r;d--)n.buf[d+c]=n.buf[d]}function JR(r,e){for(let n=0;n<r.length;n++)e.writeVarint(r[n])}function QR(r,e){for(let n=0;n<r.length;n++)e.writeSVarint(r[n])}function eL(r,e){for(let n=0;n<r.length;n++)e.writeFloat(r[n])}function tL(r,e){for(let n=0;n<r.length;n++)e.writeDouble(r[n])}function iL(r,e){for(let n=0;n<r.length;n++)e.writeBoolean(r[n])}function nL(r,e){for(let n=0;n<r.length;n++)e.writeFixed32(r[n])}function aL(r,e){for(let n=0;n<r.length;n++)e.writeSFixed32(r[n])}function rL(r,e){for(let n=0;n<r.length;n++)e.writeFixed64(r[n])}function sL(r,e){for(let n=0;n<r.length;n++)e.writeSFixed64(r[n])}const Aw=3;function oL(r,e,n){e.glyphs=[],r===1&&n.readMessage(lL,e)}function lL(r,e,n){if(r===3){const{id:c,bitmap:d,width:g,height:_,left:S,top:M,advance:R}=n.readMessage(cL,{});e.glyphs.push({id:c,bitmap:new fr({width:g+2*Aw,height:_+2*Aw},d),metrics:{width:g,height:_,left:S,top:M,advance:R}})}else r===4?e.ascender=n.readSVarint():r===5&&(e.descender=n.readSVarint())}function cL(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}const K2=Aw,Bc={horizontal:1,vertical:2,horizontalOnly:3};class lv{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const c=new lv;return c.scale=e||1,c.fontStack=n,c}static forImage(e){const n=new lv;return n.image=e,n}}class N_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n,c){const d=new N_;for(let g=0;g<e.sections.length;g++){const _=e.sections[g];_.image?d.addImageSection(_,c):d.addTextSection(_,n)}return d}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(n,c){let d="";for(let g=0;g<n.length;g++){const _=n.charCodeAt(g+1)||null,S=n.charCodeAt(g-1)||null;d+=!c&&(_&&Bf(_)&&!ov[n[g+1]]||S&&Bf(S)&&!ov[n[g-1]])||!ov[n[g]]?n[g]:ov[n[g]]}return d})(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&o0[this.text.charCodeAt(c)];c++)e++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&o0[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const c=new N_;return c.text=this.text.substring(e,n),c.sectionIndex=this.sectionIndex.slice(e,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(lv.forText(e.scale,e.fontStack||n));const c=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(c)}addImageSection(e,n){const c=e.image?e.image.getPrimary():null;if(!c)return void mi("Can't add FormattedSection with an empty image.");c.scaleSelf(n);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(lv.forImage(c)),this.sectionIndex.push(this.sections.length-1)):mi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Cw(r,e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee=1){const ce=N_.fromFeature(r,d,ee);F===Bc.vertical&&ce.verticalizePunctuation(U);let oe=[];const me=(function($e,We,tt,_t,nt,xt){if(!$e)return[];const Mt=[],Pt=(function($t,vt,yt,Vt,si,Qt){let Oi=0;for(let pi=0;pi<$t.length();pi++){const bi=$t.getSection(pi);Oi+=J2($t.getCodePoint(pi),bi,Vt,si,vt,Qt)}return Oi/Math.max(1,Math.ceil(Oi/yt))})($e,We,tt,_t,nt,xt),Gt=$e.text.indexOf("")>=0;let Wt=0;for(let $t=0;$t<$e.length();$t++){const vt=$e.getSection($t),yt=$e.getCodePoint($t);if(o0[yt]||(Wt+=J2(yt,vt,_t,nt,We,xt)),$t<$e.length()-1){const Vt=!((Ut=yt)<11904||!(qi["Bopomofo Extended"](Ut)||qi.Bopomofo(Ut)||qi["CJK Compatibility Forms"](Ut)||qi["CJK Compatibility Ideographs"](Ut)||qi["CJK Compatibility"](Ut)||qi["CJK Radicals Supplement"](Ut)||qi["CJK Strokes"](Ut)||qi["CJK Symbols and Punctuation"](Ut)||qi["CJK Unified Ideographs Extension A"](Ut)||qi["CJK Unified Ideographs"](Ut)||qi["Enclosed CJK Letters and Months"](Ut)||qi["Halfwidth and Fullwidth Forms"](Ut)||qi.Hiragana(Ut)||qi["Ideographic Description Characters"](Ut)||qi["Kangxi Radicals"](Ut)||qi["Katakana Phonetic Extensions"](Ut)||qi.Katakana(Ut)||qi["Vertical Forms"](Ut)||qi["Yi Radicals"](Ut)||qi["Yi Syllables"](Ut)));(uL[yt]||Vt||vt.image)&&Mt.push(eT($t+1,Wt,Pt,Mt,dL(yt,$e.getCodePoint($t+1),Vt&&Gt),!1))}}var Ut;return tT(eT($e.length(),Wt,Pt,Mt,0,!0))})(ce,R,g,e,c,W),{processBidirectionalText:ve,processStyledBidirectionalText:Se}=du;if(ve&&ce.sections.length===1){const $e=ve(ce.toString(),me);for(const We of $e){const tt=new N_;tt.text=We,tt.sections=ce.sections;for(let _t=0;_t<We.length;_t++)tt.sectionIndex.push(0);oe.push(tt)}}else if(Se){const $e=Se(ce.text,ce.sectionIndex,me);for(const We of $e){const tt=new N_;tt.text=We[0],tt.sectionIndex=We[1],tt.sections=ce.sections,oe.push(tt)}}else oe=(function($e,We){const tt=[],_t=$e.text;let nt=0;for(const xt of We)tt.push($e.substring(nt,xt)),nt=xt;return nt<_t.length&&tt.push($e.substring(nt,_t.length)),tt})(ce,me);const De=[],Re={positionedLines:De,text:ce.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function($e,We,tt,_t,nt,xt,Mt,Pt,Gt,Wt,Ut,$t){let vt=0,yt=0,Vt=0;const si=Pt==="right"?1:Pt==="left"?0:.5;let Qt=!1;for(const ni of nt){const Li=ni.getSections();for(const dn of Li){if(dn.image)continue;const Wn=We[dn.fontStack];if(Wn&&(Qt=Wn.ascender!==void 0&&Wn.descender!==void 0,!Qt))break}if(!Qt)break}let Oi=0;for(const ni of nt){ni.trim();const Li=ni.getMaxScale(),dn=(Li-1)*Bs,Wn={positionedGlyphs:[],lineOffset:0};$e.positionedLines[Oi]=Wn;const Kn=Wn.positionedGlyphs;let wn=0;if(!ni.length()){yt+=xt,++Oi;continue}let La=0,Le=0;for(let bt=0;bt<ni.length();bt++){const qt=ni.getSection(bt),hi=ni.getSectionIndex(bt),fi=ni.getCodePoint(bt);let Ni=qt.scale,Bi=null,bn=null,kn=null,Cn=Bs,Vn=0,Qi=Gt;Qi===Bc.vertical&&((pi=fi)===12312||pi===12313||pi===12316||pi===12540||pi===12448)&&(Qi=Bc.horizontal);const ln=!(Qi===Bc.horizontal||!Ut&&!Ff(fi)||Ut&&(o0[fi]||Uf(fi)));if(qt.image){const aa=_t.get(qt.image.toString());if(!aa)continue;kn=qt.image,$e.iconsInText=$e.iconsInText||!0,bn=aa.paddedRect;const ha=aa.displaySize;Ni=Ni*Bs/$t,Bi={width:ha[0],height:ha[1],left:0,top:-K2,advance:ln?ha[1]:ha[0],localGlyph:!1},Vn=Qt?-Bi.height*Ni:Li*Bs-17-ha[1]*Ni,Cn=Bi.advance;const fa=(ln?ha[0]:ha[1])*Ni-Bs*Li;fa>0&&fa>wn&&(wn=fa)}else{const aa=tt[qt.fontStack];if(!aa)continue;aa[fi]&&(bn=aa[fi]);const ha=We[qt.fontStack];if(!ha)continue;const fa=ha.glyphs[fi];if(!fa)continue;if(Bi=fa.metrics,Cn=fi!==8203?Bs:0,Qt){const Ta=ha.ascender!==void 0?Math.abs(ha.ascender):0,$a=ha.descender!==void 0?Math.abs(ha.descender):0,Ia=(Ta+$a)*Ni;La<Ia&&(La=Ia,Le=(Ta-$a)/2*Ni),Vn=-Ta*Ni}else Vn=(Li-Ni)*Bs-17}ln?($e.verticalizable=!0,Kn.push({glyph:fi,image:kn,x:vt,y:yt+Vn,vertical:ln,scale:Ni,localGlyph:Bi.localGlyph,fontStack:qt.fontStack,sectionIndex:hi,metrics:Bi,rect:bn}),vt+=Cn*Ni+Wt):(Kn.push({glyph:fi,image:kn,x:vt,y:yt+Vn,vertical:ln,scale:Ni,localGlyph:Bi.localGlyph,fontStack:qt.fontStack,sectionIndex:hi,metrics:Bi,rect:bn}),vt+=Bi.advance*Ni+Wt)}Kn.length!==0&&(Vt=Math.max(vt-Wt,Vt),Qt?iT(Kn,si,wn,Le,xt*Li/2):iT(Kn,si,wn,0,xt/2)),vt=0;const Oe=xt*Li+wn;Wn.lineOffset=Math.max(wn,dn),yt+=Oe,++Oi}var pi;const bi=yt,{horizontalAlign:Mi,verticalAlign:jn}=Mw(Mt);(function(ni,Li,dn,Wn,Kn,wn){const La=(Li-dn)*Kn,Le=-wn*Wn;for(const Oe of ni)for(const bt of Oe.positionedGlyphs)bt.x+=La,bt.y+=Le})($e.positionedLines,si,Mi,jn,Vt,bi),$e.top+=-jn*bi,$e.bottom=$e.top+bi,$e.left+=-Mi*Vt,$e.right=$e.left+Vt,$e.hasBaseline=Qt})(Re,e,n,c,oe,_,S,M,F,R,U,Z),!(function($e){for(const We of $e)if(We.positionedGlyphs.length!==0)return!1;return!0})(De))return Re}const o0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function J2(r,e,n,c,d,g){if(e.image){const _=c.get(e.image.toString());return _?_.displaySize[0]*e.scale*Bs/g+d:0}{const _=n[e.fontStack],S=_&&_.glyphs[r];return S?S.metrics.advance*e.scale+d:0}}function Q2(r,e,n,c){const d=Math.pow(r-e,2);return c?r<e?d/2:2*d:d+Math.abs(n)*n}function dL(r,e,n){let c=0;return r===10&&(c-=1e4),n&&(c+=150),r!==40&&r!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function eT(r,e,n,c,d,g){let _=null,S=Q2(e,n,d,g);for(const M of c){const R=Q2(e-M.x,n,d,g)+M.badness;R<=S&&(_=M,S=R)}return{index:r,x:e,priorBreak:_,badness:S}}function tT(r){return r?tT(r.priorBreak).concat(r.index):[]}function Mw(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function iT(r,e,n,c,d){if(!(e||n||c||d))return;const g=r.length-1,_=r[g],S=(_.x+_.metrics.advance*_.scale)*e;for(let M=0;M<=g;M++)r[M].x-=S,r[M].y+=n+c+d}function Pw(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function l0(r,e,n,c){const{horizontalAlign:d,verticalAlign:g}=Mw(c),_=n[0]-r.displaySize[0]*d,S=n[1]-r.displaySize[1]*g;return{imagePrimary:r,imageSecondary:e,top:S,bottom:S+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function jw(r,e,n,c,d,g){const _=r.imagePrimary;let S;if(_.content){const ce=_.content,oe=_.pixelRatio||1;S=[ce[0]/oe,ce[1]/oe,_.displaySize[0]-ce[2]/oe,_.displaySize[1]-ce[3]/oe]}const M=e.left*g,R=e.right*g;let N,F,U,W;n==="width"||n==="both"?(W=d[0]+M-c[3],F=d[0]+R+c[1]):(W=d[0]+(M+R-_.displaySize[0])/2,F=W+_.displaySize[0]);const Z=e.top*g,ee=e.bottom*g;return n==="height"||n==="both"?(N=d[1]+Z-c[0],U=d[1]+ee+c[2]):(N=d[1]+(Z+ee-_.displaySize[1])/2,U=N+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:N,right:F,bottom:U,left:W,collisionPadding:S}}function nT(r){return!r.imagePrimary.stretchX}function aT(r){return!r.imagePrimary.stretchY}function rT(r){return{width:r.right-r.left,height:r.bottom-r.top}}const ph=128;function F_(r,e,n){const{expression:c}=e;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Fa(r+1,{worldview:n}))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=c;let _=0;for(;_<d.length&&d[_]<=r;)_++;_=Math.max(0,_-1);let S=_;for(;S<d.length&&d[S]<r+1;)S++;S=Math.min(d.length-1,S);const M=d[_],R=d[S];return c.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:R,interpolationType:g}:{kind:"camera",minZoom:M,maxZoom:R,minSize:c.evaluate(new Fa(M,{worldview:n})),maxSize:c.evaluate(new Fa(R,{worldview:n})),interpolationType:g}}}function Rw(r,{uSize:e,uSizeT:n},{lowerSize:c,upperSize:d}){return r.kind==="source"?c/ph:r.kind==="composite"?Gi(c/ph,d/ph,n):e}function B_(r,e,n=1){let c=0,d=0;if(r.kind==="constant")d=r.layoutSize*n;else if(r.kind!=="source"){const{interpolationType:g,minZoom:_,maxZoom:S}=r,M=g?ne(ho.interpolationFactor(g,e,_,S),0,1):0;r.kind==="camera"?d=Gi(r.minSize,r.maxSize,M)*n:c=M*n}return{uSizeT:c,uSize:d}}class gm extends Me{constructor(e,n,c,d,g){super(e,n),this.angle=d,this.z=c,g!==void 0&&(this.segment=g)}clone(){return new gm(this.x,this.y,this.z,this.angle,this.segment)}}function sT(r,e,n,c,d){if(e.segment===void 0)return!0;let g=e,_=e.segment+1,S=0;for(;S>-n/2;){if(_--,_<0)return!1;S-=r[_].dist(g),g=r[_]}S+=r[_].dist(r[_+1]),_++;const M=[];let R=0;for(;S<n/2;){const N=r[_],F=r[_+1];if(!F)return!1;let U=r[_-1].angleTo(N)-N.angleTo(F);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:S,angleDelta:U}),R+=U;S-M[0].distance>c;)R-=M.shift().angleDelta;if(R>d)return!1;_++,S+=N.dist(F)}return!0}function oT(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function lT(r,e,n){return r?.6*e*n:0}function cT(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function hL(r,e,n,c,d,g){const _=lT(n,d,g),S=cT(n,c)*g;let M=0;const R=oT(r)/2;for(let N=0;N<r.length-1;N++){const F=r[N],U=r[N+1],W=F.dist(U);if(M+W>R){const Z=(R-M)/W,ee=Gi(F.x,U.x,Z),ce=Gi(F.y,U.y,Z),oe=new gm(ee,ce,0,U.angleTo(F),N);return!_||sT(r,oe,S,_,e)?oe:void 0}M+=W}}function fL(r,e,n,c,d,g,_,S,M){const R=lT(c,g,_),N=cT(c,d),F=N*_,U=r[0].x===0||r[0].x===M||r[0].y===0||r[0].y===M;return e-F<e/4&&(e=F+e/4),uT(r,U?e/2*S%e:(N/2+2*g)*_*S%e,e,R,n,F,U,!1,M)}function uT(r,e,n,c,d,g,_,S,M){const R=g/2,N=oT(r);let F=0,U=e-n,W=[];for(let Z=0;Z<r.length-1;Z++){const ee=r[Z],ce=r[Z+1],oe=ee.dist(ce),me=ce.angleTo(ee);for(;U+n<F+oe;){U+=n;const ve=(U-F)/oe,Se=Gi(ee.x,ce.x,ve),De=Gi(ee.y,ce.y,ve);if(Se>=0&&Se<M&&De>=0&&De<M&&U-R>=0&&U+R<=N){const Re=new gm(Se,De,0,me,Z);c&&!sT(r,Re,g,c,d)||W.push(Re)}}F+=oe}return S||W.length||_||(W=uT(r,F/2,n,c,d,g,_,!0,M)),W}function dT(r){let e=0,n=0;for(const _ of r)e+=_.w*_.h,n=Math.max(n,_.w);r.sort(((_,S)=>S.h-_.h));const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let d=0,g=0;for(const _ of r)for(let S=c.length-1;S>=0;S--){const M=c[S];if(!(_.w>M.w||_.h>M.h)){if(_.x=M.x,_.y=M.y,g=Math.max(g,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===M.w&&_.h===M.h){const R=c.pop();R&&S<c.length&&(c[S]=R)}else _.h===M.h?(M.x+=_.w,M.w-=_.w):_.w===M.w?(M.y+=_.h,M.h-=_.h):(c.push({x:M.x+_.w,y:M.y,w:M.w-_.w,h:_.h}),M.y+=_.h,M.h-=_.h);break}}return{w:d,h:g,fill:e/(d*g)||0}}vi(gm,"Anchor");const zg=1;class cv{static getImagePositionScale(e,n,c){if(n&&e){const{sx:d,sy:g}=e;return{x:d,y:g}}return{x:c,y:c}}constructor(e,n,c,d){this.paddedRect=e;const{pixelRatio:g,version:_,stretchX:S,stretchY:M,content:R,sdf:N,usvg:F}=n;this.pixelRatio=g,this.stretchX=S,this.stretchY=M,this.content=R,this.version=_,this.padding=c,this.sdf=N,this.usvg=F,this.scale=cv.getImagePositionScale(d,F,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Lw(r,e,n){const c=rc.parse(r),d=(function(g,_,S=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*S[0])+2*_,h:(g.data?g.data.height:g.height*S[1])+2*_}})(e,n,[c.sx,c.sy]);return{bin:d,imagePosition:new cv(d,e,n,c),imageVariant:c}}class hT{constructor(e,n,c){const d=new Map,g=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(e,d,zg,_),this.addImages(n,g,2,_);const{w:S,h:M}=dT(_),R=new Fs({width:S||1,height:M||1});for(const[N,F]of e.entries()){const U=d.get(N).paddedRect;Fs.copy(F.data,R,{x:0,y:0},{x:U.x+zg,y:U.y+zg},F.data,null,F.sdf)}for(const[N,F]of n.entries()){const U=g.get(N),W=U.paddedRect;let Z=U.padding;const ee=W.x+Z,ce=W.y+Z,oe=F.data.width,me=F.data.height;Z=Z>1?Z-1:Z,Fs.copy(F.data,R,{x:0,y:0},{x:ee,y:ce},F.data,c),Fs.copy(F.data,R,{x:0,y:me-Z},{x:ee,y:ce-Z},{width:oe,height:Z},c),Fs.copy(F.data,R,{x:0,y:0},{x:ee,y:ce+me},{width:oe,height:Z},c),Fs.copy(F.data,R,{x:oe-Z,y:0},{x:ee-Z,y:ce},{width:Z,height:me},c),Fs.copy(F.data,R,{x:0,y:0},{x:ee+oe,y:ce},{width:Z,height:me},c),Fs.copy(F.data,R,{x:oe-Z,y:me-Z},{x:ee-Z,y:ce-Z},{width:Z,height:Z},c),Fs.copy(F.data,R,{x:0,y:me-Z},{x:ee+oe,y:ce-Z},{width:Z,height:Z},c),Fs.copy(F.data,R,{x:0,y:0},{x:ee+oe,y:ce+me},{width:Z,height:Z},c),Fs.copy(F.data,R,{x:oe-Z,y:0},{x:ee-Z,y:ce+me},{width:Z,height:Z},c)}this.lut=c,this.image=R,this.iconPositions=d,this.patternPositions=g}addImages(e,n,c,d){for(const[g,_]of e.entries()){const{bin:S,imagePosition:M,imageVariant:R}=Lw(g,_,c);n.set(g,M),d.push(S),_.hasRenderCallback&&this.haveRenderCallbacks.push(R.id)}}patchUpdatedImages(e,n,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((d=>e.hasImage(d,c))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const d of e.getUpdatedImages(c)){for(const g of this.iconPositions.keys()){const _=rc.parse(g);if(Rs.isEqual(_.id,d)){const S=e.getImage(d,c);this.patchUpdatedImage(this.iconPositions.get(g),S,n,null)}}for(const g of this.patternPositions.keys()){const _=rc.parse(g);if(Rs.isEqual(_.id,d)){const S=e.getImage(d,c);this.patchUpdatedImage(this.patternPositions.get(g),S,n,this.lut)}}}}patchUpdatedImage(e,n,c,d=null){if(!e||!n||e.version===n.version)return;e.version=n.version;const[g,_]=e.tl,S=e.sdf;if(this.lut||S){const M={width:n.data.width,height:n.data.height},R=new Fs(M);Fs.copy(n.data,R,{x:0,y:0},{x:0,y:0},M,d,S),c.update(R,{position:{x:g,y:_}})}else c.update(n.data,{position:{x:g,y:_}})}}vi(cv,"ImagePosition"),vi(hT,"ImageAtlas");const uv=1e20;function fT(r,e,n,c,d,g,_,S,M){for(let R=e;R<e+c;R++)mT(r,n*g+R,g,d,_,S,M);for(let R=n;R<n+d;R++)mT(r,R*g+e,1,c,_,S,M)}function mT(r,e,n,c,d,g,_){g[0]=0,_[0]=-uv,_[1]=uv,d[0]=r[e];for(let S=1,M=0,R=0;S<c;S++){d[S]=r[e+S*n];const N=S*S;do{const F=g[M];R=(d[S]-d[F]+N-F*F)/(S-F)/2}while(R<=_[M]&&--M>-1);M++,g[M]=S,_[M]=R,_[M+1]=uv}for(let S=0,M=0;S<c;S++){for(;_[M+1]<S;)M++;const R=g[M],N=S-R;r[e+S*n]=d[R]+N*N}}const gh=2,Iw={none:0,ideographs:1,all:2};class U_{constructor(e,n,c){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=c,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const c=[],d=this.url||An.GLYPHS_URL;for(const g in e)for(const _ of e[g])c.push({stack:g,id:_});Fe(c,(({stack:g,id:_},S)=>{let M=this.entries[g];M||(M=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=M.glyphs[_];if(R!==void 0)return void S(null,{stack:g,id:_,glyph:R});if(R=this._tinySDF(M,g,_),R)return M.glyphs[_]=R,void S(null,{stack:g,id:_,glyph:R});const N=Math.floor(_/256);if(256*N>65535)return mi("glyphs > 65535 not supported"),void S(null,{stack:g,id:_,glyph:R});if(M.ranges[N])return void S(null,{stack:g,id:_,glyph:R});let F=M.requests[N];F||(F=M.requests[N]=[],U_.loadGlyphRange(g,N,d,this.requestManager,((U,W)=>{if(W){M.ascender=W.ascender,M.descender=W.descender;for(const Z in W.glyphs)this._doesCharSupportLocalGlyph(+Z)||(M.glyphs[+Z]=W.glyphs[+Z]);M.ranges[N]=!0}for(const Z of F)Z(U,W);delete M.requests[N]}))),F.push(((U,W)=>{U?S(U):W&&S(null,{stack:g,id:_,glyph:W.glyphs[_]||null})}))}),((g,_)=>{if(g)n(g);else if(_){const S={};for(const{stack:M,id:R,glyph:N}of _)S[M]===void 0&&(S[M]={}),S[M].glyphs===void 0&&(S[M].glyphs={}),S[M].glyphs[R]=N&&{id:N.id,bitmap:N.bitmap.clone(),metrics:N.metrics},S[M].ascender=this.entries[M].ascender,S[M].descender=this.entries[M].descender;n(null,S)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Iw.none&&(this.localGlyphMode===Iw.all?!!this.localFontFamily:!!this.localFontFamily&&(qi["CJK Unified Ideographs"](e)||qi["Hangul Syllables"](e)||qi.Hiragana(e)||qi.Katakana(e)||qi["CJK Symbols and Punctuation"](e)||qi["CJK Unified Ideographs Extension A"](e)||qi["CJK Unified Ideographs Extension B"](e)||qi.Osage(e)))}_tinySDF(e,n,c){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let g=e.tinySDF;if(!g){let ee="400";/bold/i.test(n)?ee="900":/medium/i.test(n)?ee="500":/light/i.test(n)&&(ee="200"),g=e.tinySDF=new U_.TinySDF({fontFamily:d,fontWeight:ee,fontSize:24*gh,buffer:3*gh,radius:8*gh}),g.fontWeight=ee}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const _=String.fromCodePoint(c),{data:S,width:M,height:R,glyphWidth:N,glyphHeight:F,glyphLeft:U,glyphTop:W,glyphAdvance:Z}=g.draw(_);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new fr({width:M,height:R},S),metrics:{width:N/gh,height:F/gh,left:U/gh,top:W/gh-27,advance:Z/gh,localGlyph:!0}}}}U_.loadGlyphRange=function(r,e,n,c,d){const g=256*e,_=g+255,S=c.transformRequest(c.normalizeGlyphsURL(n).replace("{fontstack}",r).replace("{range}",`${g}-${_}`),pc.Glyphs);zo(S,((M,R)=>{if(M)d(M);else if(R){const N={},F=(function(U){return new s0(U).readFields(oL,{})})(R);for(const U of F.glyphs)N[U.id]=U;d(null,{glyphs:N,ascender:F.ascender,descender:F.descender})}}))},U_.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:n=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:_="normal",lang:S=null}={}){this.buffer=e,this.cutoff=c,this.radius=n,this.lang=S;const M=this.size=r+4*e,R=this._createCanvas(M),N=this.ctx=R.getContext("2d",{willReadFrequently:!0});N.font=`${_} ${g} ${r}px ${d}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(r),_=Math.ceil(n),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),M=Math.min(this.size-this.buffer,_+Math.ceil(c)),R=S+2*this.buffer,N=M+2*this.buffer,F=Math.max(R*N,0),U=new Uint8ClampedArray(F),W={data:U,width:R,height:N,glyphWidth:S,glyphHeight:M,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(S===0||M===0)return W;const{ctx:Z,buffer:ee,gridInner:ce,gridOuter:oe}=this;this.lang&&(Z.lang=this.lang),Z.clearRect(ee,ee,S,M),Z.fillText(r,ee,ee+_);const me=Z.getImageData(ee,ee,S,M);oe.fill(uv,0,F),ce.fill(0,0,F);for(let ve=0;ve<M;ve++)for(let Se=0;Se<S;Se++){const De=me.data[4*(ve*S+Se)+3]/255;if(De===0)continue;const Re=(ve+ee)*R+Se+ee;if(De===1)oe[Re]=0,ce[Re]=uv;else{const $e=.5-De;oe[Re]=$e>0?$e*$e:0,ce[Re]=$e<0?$e*$e:0}}fT(oe,0,0,R,N,R,this.f,this.v,this.z),fT(ce,ee,ee,S,M,R,this.f,this.v,this.z);for(let ve=0;ve<F;ve++){const Se=Math.sqrt(oe[ve])-Math.sqrt(ce[ve]);U[ve]=Math.round(255-255*(Se/this.radius+this.cutoff))}return W}};const mf=zg;function pT(r,e){return r+e[1]-e[0]}function zw(r,e,n,c,d=1){const g=[],_=r.imagePrimary,S=_.pixelRatio,M=_.paddedRect.w-2*mf,R=_.paddedRect.h-2*mf,N=(r.right-r.left)*d,F=(r.bottom-r.top)*d,U=_.stretchX||[[0,M]],W=_.stretchY||[[0,R]],Z=U.reduce(pT,0),ee=W.reduce(pT,0),ce=M-Z,oe=R-ee;let me=0,ve=Z,Se=0,De=ee,Re=0,$e=ce,We=0,tt=oe;if(_.content&&c){const nt=_.content;me=c0(U,0,nt[0]),Se=c0(W,0,nt[1]),ve=c0(U,nt[0],nt[2]),De=c0(W,nt[1],nt[3]),Re=nt[0]-me,We=nt[1]-Se,$e=nt[2]-nt[0]-ve,tt=nt[3]-nt[1]-De}const _t=(nt,xt,Mt,Pt)=>{const Gt=u0(nt.stretch-me,ve,N,r.left*d),Wt=d0(nt.fixed-Re,$e,nt.stretch,Z),Ut=u0(xt.stretch-Se,De,F,r.top*d),$t=d0(xt.fixed-We,tt,xt.stretch,ee),vt=u0(Mt.stretch-me,ve,N,r.left*d),yt=d0(Mt.fixed-Re,$e,Mt.stretch,Z),Vt=u0(Pt.stretch-Se,De,F,r.top*d),si=d0(Pt.fixed-We,tt,Pt.stretch,ee),Qt=new Me(Gt,Ut),Oi=new Me(vt,Ut),pi=new Me(vt,Vt),bi=new Me(Gt,Vt),Mi=new Me(Wt/S,$t/S),jn=new Me(yt/S,si/S),ni=e*Math.PI/180;if(ni){const La=Math.sin(ni),Le=Math.cos(ni),Oe=[Le,-La,La,Le];Qt._matMult(Oe),Oi._matMult(Oe),bi._matMult(Oe),pi._matMult(Oe)}const Li=nt.stretch+nt.fixed,dn=Mt.stretch+Mt.fixed,Wn=xt.stretch+xt.fixed,Kn=Pt.stretch+Pt.fixed,wn=r.imageSecondary;return{tl:Qt,tr:Oi,bl:bi,br:pi,texPrimary:{x:_.paddedRect.x+mf+Li,y:_.paddedRect.y+mf+Wn,w:dn-Li,h:Kn-Wn},texSecondary:wn?{x:wn.paddedRect.x+mf+Li,y:wn.paddedRect.y+mf+Wn,w:dn-Li,h:Kn-Wn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mi,pixelOffsetBR:jn,minFontScaleX:$e/S/N,minFontScaleY:tt/S/F,isSDF:n}};if(c&&(_.stretchX||_.stretchY)){const nt=gT(U,ce,Z),xt=gT(W,oe,ee);for(let Mt=0;Mt<nt.length-1;Mt++){const Pt=nt[Mt],Gt=nt[Mt+1];for(let Wt=0;Wt<xt.length-1;Wt++)g.push(_t(Pt,xt[Wt],Gt,xt[Wt+1]))}}else g.push(_t({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:R+1}));return g}function mL(r,e){const n=r.stretchY||[[0,r.paddedRect.h-2*mf]];return e&&(r.stretchX||r.stretchY)?_T(r.stretchX||[[0,r.paddedRect.w-2*mf]])*_T(n):1}function c0(r,e,n){let c=0;for(const d of r)c+=Math.max(e,Math.min(n,d[1]))-Math.max(e,Math.min(n,d[0]));return c}function gT(r,e,n){const c=[{fixed:-mf,stretch:0}];for(const[d,g]of r){const _=c[c.length-1];c.push({fixed:d-_.stretch,stretch:_.stretch}),c.push({fixed:d-_.stretch,stretch:_.stretch+(g-d)})}return c.push({fixed:e+mf,stretch:n}),c}function _T(r){return 2*r.length+1}function u0(r,e,n,c){return r/e*n+c}function d0(r,e,n,c){return r-e*n/c}function pL(r,e,n,c){const d=e+r.positionedLines[c].lineOffset;return c===0?n+d/2:n+(d+(e+r.positionedLines[c-1].lineOffset))/2}function gL(r,e=1,n=!1){let c=1/0,d=1/0,g=-1/0,_=-1/0;const S=r[0];for(let W=0;W<S.length;W++){const Z=S[W];(!W||Z.x<c)&&(c=Z.x),(!W||Z.y<d)&&(d=Z.y),(!W||Z.x>g)&&(g=Z.x),(!W||Z.y>_)&&(_=Z.y)}const M=Math.min(g-c,_-d);let R=M/2;const N=new nu([],_L);if(M===0)return new Me(c,d);for(let W=c;W<g;W+=M)for(let Z=d;Z<_;Z+=M)N.push(new $_(W+R,Z+R,R,r));let F=(function(W){let Z=0,ee=0,ce=0;const oe=W[0];for(let me=0,ve=oe.length,Se=ve-1;me<ve;Se=me++){const De=oe[me],Re=oe[Se],$e=De.x*Re.y-Re.x*De.y;ee+=(De.x+Re.x)*$e,ce+=(De.y+Re.y)*$e,Z+=3*$e}return new $_(ee/Z,ce/Z,0,W)})(r),U=N.length;for(;N.length;){const W=N.pop();(W.d>F.d||!F.d)&&(F=W,n&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,U)),W.max-F.d<=e||(R=W.h/2,N.push(new $_(W.p.x-R,W.p.y-R,R,r)),N.push(new $_(W.p.x+R,W.p.y-R,R,r)),N.push(new $_(W.p.x-R,W.p.y+R,R,r)),N.push(new $_(W.p.x+R,W.p.y+R,R,r)),U+=4)}return n&&(console.log(`num probes: ${U}`),console.log(`best distance: ${F.d}`)),F.p}function _L(r,e){return e.max-r.max}class $_{constructor(e,n,c,d){this.p=new Me(e,n),this.h=c,this.d=(function(g,_){let S=!1,M=1/0;for(let R=0;R<_.length;R++){const N=_[R];for(let F=0,U=N.length,W=U-1;F<U;W=F++){const Z=N[F],ee=N[W];Z.y>g.y!=ee.y>g.y&&g.x<(ee.x-Z.x)*(g.y-Z.y)/(ee.y-Z.y)+Z.x&&(S=!S),M=Math.min(M,kr(g,Z,ee))}}return(S?1:-1)*Math.sqrt(M)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const yL=Object.keys,Dw=Number.POSITIVE_INFINITY,vL=Math.sqrt(2);function Ap(r,e,n,c,d){const g=Pw(r)&&r.collisionPadding?r.collisionPadding:[0,0,0,0],_={top:r.top-g[1],bottom:r.bottom+g[3],left:r.left-g[0],right:r.right+g[2],scaled:!1};return c!==void 0&&(function(S,M){S.top*=M,S.bottom*=M,S.left*=M,S.right*=M,S.scaled=!0})(_,c),n&&(function(S,M){if(!M)return;const R=ui(M),N=new Me(S.left,S.top),F=new Me(S.right,S.top),U=new Me(S.left,S.bottom),W=new Me(S.right,S.bottom),Z=new Me(0,0);N._rotateAround(R,Z),F._rotateAround(R,Z),U._rotateAround(R,Z),W._rotateAround(R,Z),S.left=Math.min(N.x,F.x,U.x,W.x),S.right=Math.max(N.x,F.x,U.x,W.x),S.top=Math.min(N.y,F.y,U.y,W.y),S.bottom=Math.max(N.y,F.y,U.y,W.y)})(_,n),d&&(_.left+=d[0],_.right+=d[0],_.top+=d[1],_.bottom+=d[1]),e?{top:Math.min(e.top,_.top),bottom:Math.max(e.bottom,_.bottom),left:Math.min(e.left,_.left),right:Math.max(e.right,_.right),scaled:e.scaled||_.scaled}:_}function yT(r,[e,n]){let c=0,d=0;if(n===Dw){e<0&&(e=0);const g=e/vL;switch(r){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-e;break;case"top":d=e-7}switch(r){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),r){case"top-right":case"top-left":case"top":d=n-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-n}switch(r){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,d]}function xL(r,e,n,c,d,g,_,S,M,R,N,F,U,W){const Z=r.layers[0],ee=Z.appearances;if(ee.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const ce={iconBBox:null,iconVerticalBBox:null},oe={textBBox:null,textVerticalBBox:null},{baseIconRotate:me,baseTextRotate:ve,iconScaleFactor:Se}=(function(Re,$e,We){const tt=Re.get("icon-rotate").evaluate($e,{},We),_t=Re.get("text-rotate").evaluate($e,{},We),[nt,xt]=Re.get("icon-size-scale-range");return{baseIconRotate:tt,baseTextRotate:_t,iconScaleFactor:ne(1,nt,xt)}})(c,d,g);e&&(ce.iconBBox=Ap(e,ce.iconBBox,me,_),n)&&(ce.iconVerticalBBox=Ap(n,ce.iconVerticalBBox,me+90,_));const De=f0(F.horizontal);De&&(oe.textBBox=Ap(De,oe.textBBox,ve,1,W)),F.vertical&&(oe.textVerticalBBox=Ap(F.vertical,oe.textVerticalBBox,ve+90,1,W));for(const Re of ee)Re.hasIconProperties()&&bL(ce,r,Z,Re,d,g,S,me,_,M,e,R,Se,N),Re.hasTextProperties()&&wL(oe,Z,Re,d,g,W,ve,U,De,F.vertical);return{iconBBox:ce.iconBBox,iconVerticalBBox:ce.iconVerticalBBox,textBBox:oe.textBBox,textVerticalBBox:oe.textVerticalBBox}}function bL(r,e,n,c,d,g,_,S,M,R,N,F,U,W){const{appearanceIconOffset:Z,appearanceIconRotate:ee,appearanceIconSize:ce}=(function(Se,De,Re,$e,We,tt,_t,nt){const xt=Se.hasProperty("icon-offset")?De.getAppearanceValueAndResolveTokens(Se,"icon-offset",Re,$e,[]):null,Mt=xt&&Array.isArray(xt)?xt:We,Pt=Se.hasProperty("icon-rotate")?De.getAppearanceValueAndResolveTokens(Se,"icon-rotate",Re,$e,[]):null,Gt=typeof Pt=="number"?Pt:tt,Wt=Se.hasProperty("icon-size")?De.getAppearanceValueAndResolveTokens(Se,"icon-size",Re,$e,[]):null;return{appearanceIconOffset:Mt,appearanceIconRotate:Gt,appearanceIconSize:typeof Wt=="number"?Wt*nt.iconScaleFactor:_t}})(c,n,d,g,_,S,M,R);let oe=null,me=null,ve=null;c.hasProperty("icon-image")?ve=(function(Se,De,Re,$e,We,tt,_t){let nt=null;const xt=De.getAppearanceValueAndResolveTokens(Re,"icon-image",$e,We,[]);if(xt){const Mt=Se.getResolvedImageFromTokens(xt),Pt=Re.getUnevaluatedProperty("icon-size"),Gt=dv(Mt,F_(Se.zoom,Pt,Se.worldview),Pt,We,Se.zoom,$e,Se.pixelRatio,_t,Se.worldview);nt=tt.get(Gt.iconPrimary.toString())}return nt})(e,n,c,d,g,F,U):N&&(ve=N.imagePrimary),ve&&(oe=l0(ve,null,Z,W),e.allowVerticalPlacement&&(me=l0(ve,null,Z,W))),oe&&(r.iconBBox=Ap(oe,r.iconBBox,ee,ce)),me&&(r.iconVerticalBBox=Ap(me,r.iconVerticalBBox,ee+90,ce))}function wL(r,e,n,c,d,g,_,S,M,R){const{appearanceTextOffset:N,appearanceTextRotate:F,appearanceTextSize:U}=(function(Z,ee,ce,oe,me,ve,Se){const De=Z.hasProperty("text-offset")?ee.getAppearanceValueAndResolveTokens(Z,"text-offset",ce,oe,[]):null,Re=De&&Array.isArray(De)?[De[0]*Bs,De[1]*Bs]:me,$e=Z.hasProperty("text-rotate")?ee.getAppearanceValueAndResolveTokens(Z,"text-rotate",ce,oe,[]):null,We=typeof $e=="number"?$e:ve,tt=Z.hasProperty("text-size")?ee.getAppearanceValueAndResolveTokens(Z,"text-size",ce,oe,[]):null;return{appearanceTextOffset:Re,appearanceTextRotate:We,appearanceTextSize:typeof tt=="number"?tt:Se}})(n,e,c,d,g,_,S),W=U/S;M&&(r.textBBox=Ap(M,r.textBBox,F,W,N)),R&&(r.textVerticalBBox=Ap(R,r.textVerticalBBox,F+90,W,N))}function h0(r,e,n,c,d,g,_,S,M){if(!e||!e.usvg)return;const R=rT(c),N=rT(d),F=g!=="both"&&g!=="width"||!nT(c)?1:N.width/R.width,U=g!=="both"&&g!=="height"||!aT(c)?1:N.height/R.height;n.scaleSelf(F,U);const W=n.toString();_.set(W,n),S.set(W,e);const{imagePosition:Z}=Lw(W,e,zg);M.set(W,Z)}function vT(r,e,n,c,d,g,_,S,M){if(!r)return;const R=(function(N,F,U,W,Z,ee){if(N.kind==="camera")return N.maxSize;if(N.kind==="composite"){const ce=F.possiblyEvaluate(new Fa(N.maxZoom,{worldview:ee}),U).evaluate(Z,{},U),oe=F.possiblyEvaluate(new Fa(N.minZoom,{worldview:ee}),U).evaluate(Z,{},U);return Math.max(ce,oe)}return F.possiblyEvaluate(new Fa(W,{worldview:ee})).evaluate(Z,{},U)})(e,n,c,d,g,M);return r.scaleSelf(R*S*_)}function dv(r,e,n,c,d,g,_,S,M){return{iconPrimary:vT(r.getPrimary(),e,n,c,d,g,_,S,M),iconSecondary:vT(r.getSecondary(),e,n,c,d,g,_,S,M)}}function SL(r,e,n){if(!e)return;const c=n.get(r.toString()),d=n.get(e.toString());c&&d&&(c.paddedRect.w===d.paddedRect.w&&c.paddedRect.h===d.paddedRect.h||mi(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),c.usvg!==d.usvg&&mi(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function xT(r,e,n,c){if(!r)return;const d=e.get(n.toString());if(r.imagePrimary=d,c){const g=e.get(c.toString());r.imageSecondary=g}}function TL(r,e){for(const n in r.horizontal)bT(r.horizontal[n],e);bT(r.vertical,e)}function bT(r,e){if(r){for(const n of r.positionedLines)for(const c of n.positionedGlyphs)if(c.image!==null){const d=c.image.toString();c.rect=e.get(d).paddedRect}}}function Ow(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kL(r,e,n,c,d,g,_,S,M){const R=f0(g.horizontal)||g.vertical,N=n.get("icon-text-fit-padding").evaluate(c,{},d);let F,U=e;return e&&M!=="none"&&(r.allowVerticalPlacement&&g.vertical&&(F=jw(e,g.vertical,M,N,S,_)),R&&(U=jw(e,R,M,N,S,_))),{defaultShapedIcon:U,verticallyShapedIcon:F}}function EL(r,e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe,me,ve,Se,De,Re,$e){let We=_.textMaxSize.evaluate(e,{},U);We===void 0?We=S*_.textScaleFactor:We*=_.textScaleFactor;const tt=r.layers[0].layout,_t=Bs,nt=S*_.textScaleFactor/_t,xt=f0(n.horizontal)||n.vertical;if(ce!=="none"&&r.appearanceFeatureData&&e.index<r.appearanceFeatureData.length){const pi=r.appearanceFeatureData[e.index];pi&&(pi.textShaping=xt,pi.iconTextFitPadding=tt.get("icon-text-fit-padding").evaluate(e,{},U),pi.fontScale=nt)}const Mt=W.name==="globe",Pt=r.tilePixelRatio*We/_t,Gt=(Vt=r.overscaling,r.zoom>18&&Vt>2&&(Vt>>=1),Math.max(Jt/(512*Vt),1)*tt.get("symbol-spacing")),Wt=tt.get("text-padding")*r.tilePixelRatio,Ut=tt.get("icon-padding")*r.tilePixelRatio,$t=ui(tt.get("text-max-angle")),vt=tt.get("icon-rotation-alignment")==="map"&&ve!=="point",yt=Gt/2;var Vt;r.hasAnyIconTextFit===!1&&ce!=="none"&&(r.hasAnyIconTextFit=!0);const si=e.properties?+e.properties[gt]:null,Qt=si&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(si):65535,Oi=(pi,bi,Mi)=>{if(bi.x<0||bi.x>=Jt||bi.y<0||bi.y>=Jt)return;let jn=null;if(Mt){const{x:ni,y:Li,z:dn}=W.projectTilePoint(bi.x,bi.y,Mi);jn={anchor:new gm(ni,Li,dn,0,void 0),up:W.upVector(Mi,bi.x,bi.y)}}(function(ni,Li,dn,Wn,Kn,wn,La,Le,Oe,bt,qt,hi,fi,Ni,Bi,bn,kn,Cn,Vn,Qi,ln,aa,ha,fa,Ta,$a,Ia,pa,ba,En,Yn,mr,Yi){const Hn=ni.addToLineVertexArray(Li,Wn);let Na,Ha,Ja,Nr,qa,Ki,yr,ka=0,ur=0,ys=0,Us=0,as=-1,rs=-1;const Cs={};let Jl=Ks("");const Wa=dn?dn.anchor:Li,jr=pa!=="none";let Fr=0,uc=0;if(Oe._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Po=Oe.layout.get("text-offset").evaluate(ln,{},Ta);Fr=Po[0]*Bs,uc=Po[1]*Bs}else Fr=Oe.layout.get("text-radial-offset").evaluate(ln,{},Ta)*Bs,uc=Dw;if(ni.allowVerticalPlacement&&Kn.vertical){const Po=Kn.vertical;if(Bi)Ki=Nw(Po),Le&&(yr=Nw(Le));else{const jl=Oe.layout.get("text-rotate").evaluate(ln,{},Ta)+90;Ja=m0(bt,Wa,Li,qt,hi,fi,Po,Ni,jl,bn,mr),Le&&(Nr=m0(bt,Wa,Li,qt,hi,fi,Le,Cn,jl,null,Yn))}}if(wn){const Po=ni.iconSizeData,jl=Oe.layout.get("icon-rotate").evaluate(ln,{},Ta),Uc=zw(wn,jl,ha,jr,aa.iconScaleFactor),Pp=Le?zw(Le,jl,ha,jr,aa.iconScaleFactor):void 0;Ha=m0(bt,Wa,Li,qt,hi,fi,wn,Cn,jl,null,En);const X_=(function(xh,Mv,Bk,NI,Uk,$k,FI,BI){const Vk=xh.layers[0],Hk=Vk.appearances;let Y_=Mv.length;if(Bk&&(Y_=Math.max(Y_,Bk.length)),Hk.length===0)return Y_;const[UI,$I]=NI.get("icon-size-scale-range"),VI=ne(1,UI,$I);for(const Gk of Hk){const qk=Gk.getUnevaluatedProperties();if(qk._values["icon-image"].value!==void 0){const Wk=Vk.getAppearanceValueAndResolveTokens(Gk,"icon-image",Uk,$k,[]);if(Wk){const Zk=xh.getResolvedImageFromTokens(Wk);if(Zk){const Xk=qk._values["icon-size"],HI=dv(Zk,F_(xh.zoom,Xk,xh.worldview),Xk,$k,xh.zoom,Uk,xh.pixelRatio,VI,xh.worldview),GI=FI.get(HI.iconPrimary.toString());Y_=Math.max(Y_,mL(GI,BI))}}}}return Y_})(ni,Uc,Pp,Oe.layout,ln,Ta,ni.iconAtlasPositions,jr);ka=4*X_;let vh=null;Po.kind==="source"?(vh=[ph*Oe.layout.get("icon-size").evaluate(ln,{},Ta)*aa.iconScaleFactor],vh[0]>_m&&mi(`${ni.layerIds[0]}: Value for "icon-size" is >= ${hv}. Reduce your "icon-size".`)):Po.kind==="composite"&&(vh=[ph*aa.compositeIconSizes[0].evaluate(ln,{},Ta)*aa.iconScaleFactor,ph*aa.compositeIconSizes[1].evaluate(ln,{},Ta)*aa.iconScaleFactor],(vh[0]>_m||vh[1]>_m)&&mi(`${ni.layerIds[0]}: Value for "icon-size" is >= ${hv}. Reduce your "icon-size".`)),ni.addSymbols(ni.icon,Uc,vh,Qi,Vn,ln,void 0,dn,Li,Hn.lineStartIndex,Hn.lineLength,-1,fa,Ta,$a,Ia,ni.symbolInstances.length,X_),as=ni.icon.placedSymbolArray.length-1,Pp&&(ur=4*X_,ni.addSymbols(ni.icon,Pp,vh,Qi,Vn,ln,Bc.vertical,dn,Li,Hn.lineStartIndex,Hn.lineLength,-1,fa,Ta,$a,Ia,ni.symbolInstances.length,X_),rs=ni.icon.placedSymbolArray.length-1)}for(const Po in Kn.horizontal){const jl=Po,Uc=Kn.horizontal[jl];Na||(Jl=Ks(Uc.text),Bi?qa=Nw(Uc):Na=m0(bt,Wa,Li,qt,hi,fi,Uc,Ni,Oe.layout.get("text-rotate").evaluate(ln,{},Ta),bn,mr));const Pp=Uc.positionedLines.length===1;if(ys+=wT(ni,dn,Li,Uc,La,Oe,Bi,ln,bn,Hn,Kn.vertical?Bc.horizontal:Bc.horizontalOnly,Pp?yL(Kn.horizontal):[jl],Cs,as,aa,fa,Ta,ni.symbolInstances.length,$a),Pp)break}Kn.vertical&&(Us+=wT(ni,dn,Li,Kn.vertical,La,Oe,Bi,ln,bn,Hn,Bc.vertical,["vertical"],Cs,rs,aa,fa,Ta,ni.symbolInstances.length,$a));let vs=-1;const Id=(Po,jl)=>Po?Math.max(Po,jl):jl;vs=Id(qa,vs),vs=Id(Ki,vs),vs=Id(yr,vs);const pf=vs>-1?1:0;ni.glyphOffsetArray.length>=65535&&mi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ln.sortKey!==void 0&&ni.addToSortKeyRanges(ni.symbolInstances.length,ln.sortKey),ni.symbolInstances.emplaceBack(Li.x,Li.y,Wa.x,Wa.y,Wa.z,Cs.right>=0?Cs.right:-1,Cs.center>=0?Cs.center:-1,Cs.left>=0?Cs.left:-1,Cs.vertical>=0?Cs.vertical:-1,as,rs,Jl,Na!==void 0?Na:ni.collisionBoxArray.length,Na!==void 0?Na+1:ni.collisionBoxArray.length,Ja!==void 0?Ja:ni.collisionBoxArray.length,Ja!==void 0?Ja+1:ni.collisionBoxArray.length,Ha!==void 0?Ha:ni.collisionBoxArray.length,Ha!==void 0?Ha+1:ni.collisionBoxArray.length,Nr||ni.collisionBoxArray.length,Nr?Nr+1:ni.collisionBoxArray.length,qt,ys,Us,ka,ur,pf,0,Fr,uc,vs,0,jr?1:0,ba)})(r,bi,jn,pi,n,c,g,d,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Wt,me,R,0,Ut,vt,oe,e,_,N,F,U,Z,ee,ce,Qt,Se,De,Re)};if(ve==="line")for(const pi of ri(e.geometry,0,0,Jt,Jt)){const bi=fL(pi,Gt,$t,n.vertical||xt,c,_t,Pt,r.overscaling,Jt);for(const Mi of bi)xt&&AL(r,xt.text,yt,Mi)||Oi(pi,Mi,U)}else if(ve==="line-center"){for(const pi of e.geometry)if(pi.length>1){const bi=hL(pi,$t,n.vertical||xt,c,_t,Pt);bi&&Oi(pi,bi,U)}}else if(e.type==="Polygon")for(const pi of kg(e.geometry,0)){const bi=gL(pi,16);Oi(pi[0],new gm(bi.x,bi.y,0,0,void 0),U)}else if(e.type==="LineString")for(const pi of e.geometry)Oi(pi,new gm(pi[0].x,pi[0].y,0,0,void 0),U);else if(e.type==="Point")for(const pi of e.geometry)for(const bi of pi)Oi([bi],new gm(bi.x,bi.y,0,0,void 0),U)}const hv=255,_m=hv*ph;function wT(r,e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe,me){const ve=(function(Re,$e,We,tt,_t,nt,xt,Mt){const Pt=[];if($e.positionedLines.length===0)return Pt;const Gt=tt.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,Wt=(function(Vt){const si=Vt[0],Qt=Vt[1],Oi=si*Qt;return Oi>0?[si,-Qt]:Oi<0?[-si,Qt]:si===0?[Qt,si]:[Qt,-si]})(We);let Ut=Math.abs($e.top-$e.bottom);for(const Vt of $e.positionedLines)Ut-=Vt.lineOffset;const $t=$e.positionedLines.length,vt=Ut/$t;let yt=$e.top-We[1];for(let Vt=0;Vt<$t;++Vt){const si=$e.positionedLines[Vt];yt=pL($e,vt,yt,Vt);for(const Qt of si.positionedGlyphs){if(!Qt.rect)continue;const Oi=Qt.rect||{};let pi=K2+1,bi=!0,Mi=1,jn=0;if(Qt.image){const kn=xt.get(Qt.image.toString());if(!kn)continue;if(kn.sdf){mi("SDF images are not supported in formatted text and will be ignored.");continue}bi=!1,Mi=kn.pixelRatio,pi=zg/Mi}const ni=(_t||Mt)&&Qt.vertical,Li=Qt.metrics.advance*Qt.scale/2,dn=Qt.metrics,Wn=Qt.rect;if(Wn===null)continue;Mt&&$e.verticalizable&&(jn=Qt.image?Li-Qt.metrics.width*Qt.scale/2:0);const Kn=_t?[Qt.x+Li,Qt.y]:[0,0];let wn=[0,0],La=[0,0],Le=!1;_t||(ni?(La=[Qt.x+Li+Wt[0],Qt.y+Wt[1]-jn],Le=!0):wn=[Qt.x+Li+We[0],Qt.y+We[1]-jn]);const Oe=Wn.w*Qt.scale/(Mi*(Qt.localGlyph?gh:1)),bt=Wn.h*Qt.scale/(Mi*(Qt.localGlyph?gh:1));let qt,hi,fi,Ni;if(ni){const kn=Qt.y-yt,Cn=new Me(-Li,Li-kn),Vn=-Math.PI/2,Qi=new Me(...La);qt=new Me(-Li+wn[0],wn[1]),qt._rotateAround(Vn,Cn)._add(Qi),qt.x+=-kn+Li,qt.y-=(dn.left-pi)*Qt.scale;const ln=Qt.image?dn.advance*Qt.scale:Bs*Qt.scale,aa=String.fromCodePoint(Qt.glyph);YR(aa)?qt.x+=(1-pi)*Qt.scale:KR(aa)?qt.x+=ln-dn.height*Qt.scale+(-pi-1)*Qt.scale:qt.x+=Qt.image||dn.width+2*pi===Wn.w&&dn.height+2*pi===Wn.h?(ln-bt)/2:(ln-(dn.height+2*pi)*Qt.scale)/2,hi=new Me(qt.x,qt.y-Oe),fi=new Me(qt.x+bt,qt.y),Ni=new Me(qt.x+bt,qt.y-Oe)}else{const kn=(dn.left-pi)*Qt.scale-Li+wn[0],Cn=(-dn.top-pi)*Qt.scale+wn[1],Vn=kn+Oe,Qi=Cn+bt;qt=new Me(kn,Cn),hi=new Me(Vn,Cn),fi=new Me(kn,Qi),Ni=new Me(Vn,Qi)}if(Gt){let kn;kn=_t?new Me(0,0):Le?new Me(Wt[0],Wt[1]):new Me(We[0],We[1]),qt._rotateAround(Gt,kn),hi._rotateAround(Gt,kn),fi._rotateAround(Gt,kn),Ni._rotateAround(Gt,kn)}const Bi=new Me(0,0),bn=new Me(0,0);Pt.push({tl:qt,tr:hi,bl:fi,br:Ni,texPrimary:Oi,texSecondary:void 0,writingMode:$e.writingMode,glyphOffset:Kn,sectionIndex:Qt.sectionIndex,isSDF:bi,pixelOffsetTL:Bi,pixelOffsetBR:bn,minFontScaleX:0,minFontScaleY:0})}}return Pt})(0,c,M,g,_,S,d,r.allowVerticalPlacement),Se=r.textSizeData;let De=null;Se.kind==="source"?(De=[ph*g.layout.get("text-size").evaluate(S,{},ce)*Z.textScaleFactor],De[0]>_m&&mi(`${r.layerIds[0]}: Value for "text-size" is >= ${hv}. Reduce your "text-size".`)):Se.kind==="composite"&&(De=[ph*Z.compositeTextSizes[0].evaluate(S,{},ce)*Z.textScaleFactor,ph*Z.compositeTextSizes[1].evaluate(S,{},ce)*Z.textScaleFactor],(De[0]>_m||De[1]>_m)&&mi(`${r.layerIds[0]}: Value for "text-size" is >= ${hv}. Reduce your "text-size".`)),r.addSymbols(r.text,ve,De,M,_,S,N,e,n,R.lineStartIndex,R.lineLength,W,ee,ce,me,!1,oe,ve.length);for(const Re of F)U[Re]=r.text.placedSymbolArray.length-1;return 4*ve.length}function f0(r){for(const e in r)return r[e];return null}function m0(r,e,n,c,d,g,_,S,M,R,N){let F,U,W,Z;if(F=N?N.top:_.top,U=N?N.bottom:_.bottom,W=N?N.left:_.left,Z=N?N.right:_.right,Pw(_)&&_.collisionPadding){const ee=_.collisionPadding;W-=ee[0],F-=ee[1],Z+=ee[2],U+=ee[3]}if(M){const ee=new Me(W,F),ce=new Me(Z,F),oe=new Me(W,U),me=new Me(Z,U),ve=ui(M);let Se=new Me(0,0);R&&(Se=new Me(R[0],R[1])),ee._rotateAround(ve,Se),ce._rotateAround(ve,Se),oe._rotateAround(ve,Se),me._rotateAround(ve,Se),W=Math.min(ee.x,ce.x,oe.x,me.x),Z=Math.max(ee.x,ce.x,oe.x,me.x),F=Math.min(ee.y,ce.y,oe.y,me.y),U=Math.max(ee.y,ce.y,oe.y,me.y)}return r.emplaceBack(e.x,e.y,e.z,n.x,n.y,W,F,Z,U,S,c,d,g),r.length-1}function Nw(r){Pw(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function AL(r,e,n,c){const d=r.compareText;if(e in d){const g=d[e];for(let _=g.length-1;_>=0;_--)if(c.dist(g[_])<n)return!0}else d[e]=[];return d[e].push(c),!1}function ST(r,e){const n=r.fovAboveCenter,c=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,d=(r._camera.position[2]*r.worldSize-c)/Math.cos(r._pitch),g=Math.sin(n)*d/Math.sin(Math.max(Math.PI/2-r._pitch-n,.01));let _=Math.sin(r._pitch)*g+d;const S=d*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let M=Math.max(r.zoom-17,0);r.isOrthographic&&(M/=10),_*=1+M}return Math.min(1.01*_,S)}function fv(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const n=Math.pow(2,-r.z),c=r.x*n,d=(r.x+1)*n,g=r.y*n,_=(r.y+1)*n,S=H(c),M=H(d),R=K(g),N=K(_),F=e.project(S,R),U=e.project(M,R),W=e.project(M,N),Z=e.project(S,N);let ee=Math.min(F.x,U.x,W.x,Z.x),ce=Math.min(F.y,U.y,W.y,Z.y),oe=Math.max(F.x,U.x,W.x,Z.x),me=Math.max(F.y,U.y,W.y,Z.y);const ve=n/16;function Se(Re,$e,We,tt,_t,nt){const xt=(We+_t)/2,Mt=(tt+nt)/2,Pt=e.project(H(xt),K(Mt)),Gt=Math.max(0,ee-Pt.x,ce-Pt.y,Pt.x-oe,Pt.y-me);ee=Math.min(ee,Pt.x),oe=Math.max(oe,Pt.x),ce=Math.min(ce,Pt.y),me=Math.max(me,Pt.y),Gt>ve&&(Se(Re,Pt,We,tt,xt,Mt),Se(Pt,$e,xt,Mt,_t,nt))}Se(F,U,c,g,d,g),Se(U,W,d,g,d,_),Se(W,Z,d,_,c,_),Se(Z,F,c,_,c,g),ee-=ve,ce-=ve,oe+=ve,me+=ve;const De=1/Math.max(oe-ee,me-ce);return{scale:De,x:ee*De,y:ce*De,x2:oe*De,y2:me*De,projection:e}}function TT(r,{x:e,y:n},c=0){return new Me(((e-c)*r.scale-r.x)*Jt,(n*r.scale-r.y)*Jt)}const CL=re(new Float32Array(16));class Cp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new o(0,0)}projectTilePoint(e,n,c){return{x:e,y:n,z:0}}locationPoint(e,n,c,d=!0){return e._coordinatePoint(e.locationCoordinate(n,c),d)}pixelsPerMeter(e,n){return B(1,e)*n}pixelSpaceConversion(e,n,c){return 1}farthestPixelDistance(e){return ST(e,e.pixelsPerMeter)}pointCoordinate(e,n,c,d){const g=e.horizonLineFromTop(!1),_=new Me(n,Math.max(g,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,d))}pointCoordinate3D(e,n,c){const d=new Me(n,c);if(e.elevation)return e.elevation.pointCoordinate(d);{const g=this.pointCoordinate(e,d.x,d.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const c=e.horizonLineFromTop();return n.y<c}createInversionMatrix(e,n){return CL}createTileMatrix(e,n,c){let d,g,_;const S=c.canonical,M=re(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=fv(S,this);d=1,g=R.x+c.wrap*R.scale,_=R.y,Ne(M,M,[d/R.scale,d/R.scale,e.pixelsPerMeter/n])}else d=n/e.zoomScale(S.z),g=(S.x+Math.pow(2,S.z)*c.wrap)*d,_=S.y*d;return be(M,M,[g,_,0]),Ne(M,M,[d/Jt,d/Jt,1]),M}upVector(e,n,c){return[0,0,1]}upVectorScale(e,n,c){return{metersToTile:1}}}class ML extends Cp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,c]=this.parallels=e.parallels||[29.5,45.5],d=Math.sin(ui(n));this.n=(d+Math.sin(ui(c)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:c,c:d,r0:g}=this,_=ui(e-this.center[0]),S=ui(n),M=Math.sqrt(d-2*c*Math.sin(S))/c;return{x:M*Math.sin(_*c),y:M*Math.cos(_*c)-g,z:0}}unproject(e,n){const{n:c,c:d,r0:g}=this,_=g+n;let S=Math.atan2(e,Math.abs(_))*Math.sign(_);_*c<0&&(S-=Math.PI*Math.sign(e)*Math.sign(_));const M=ui(this.center[0])*c;S=ke(S,-Math.PI-M,Math.PI-M);const R=ne(Wi(S/c)+this.center[0],-180,180),N=Math.asin(ne((d-(e*e+_*_)*c*c)/(2*c),-1,1)),F=ne(Wi(N),-J,J);return new o(R,F)}}const mv=1.340264,pv=-.081106,gv=893e-6,_v=.003796,p0=Math.sqrt(3)/2;class PL extends Cp{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const c=Math.asin(p0*Math.sin(n)),d=c*c,g=d*d*d;return{x:.5*(e*Math.cos(c)/(p0*(mv+3*pv*d+g*(7*gv+9*_v*d)))/Math.PI+.5),y:1-.5*(c*(mv+pv*d+g*(gv+_v*d))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,d=c*c,g=d*d*d;for(let N,F,U,W=0;W<12&&(F=c*(mv+pv*d+g*(gv+_v*d))-n,U=mv+3*pv*d+g*(7*gv+9*_v*d),N=F/U,c=ne(c-N,-Math.PI/3,Math.PI/3),d=c*c,g=d*d*d,!(Math.abs(N)<1e-12));++W);const _=p0*e*(mv+3*pv*d+g*(7*gv+9*_v*d))/Math.cos(c),S=Math.asin(Math.sin(c)/p0),M=ne(180*_/Math.PI,-180,180),R=ne(180*S/Math.PI,-J,J);return new o(M,R)}}class jL extends Cp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const c=360*(e-.5),d=ne(360*(.5-n),-J,J);return new o(c,d)}}const V_=Math.PI/2;function g0(r){return Math.tan((V_+r)/2)}class RL extends Cp{constructor(e){super(e),this.center=e.center||[0,30];const[n,c]=this.parallels=e.parallels||[30,30];let d=ui(n),g=ui(c);this.southernCenter=d+g<0,this.southernCenter&&(d=-d,g=-g);const _=Math.cos(d),S=g0(d);this.n=d===g?Math.sin(d):Math.log(_/Math.cos(g))/Math.log(g0(g)/S),this.f=_*Math.pow(g0(d),this.n)/this.n}project(e,n){n=ui(n),this.southernCenter&&(n=-n),e=ui(e-this.center[0]);const c=1e-6,{n:d,f:g}=this;g>0?n<-V_+c&&(n=-V_+c):n>V_-c&&(n=V_-c);const _=g/Math.pow(g0(n),d);let S=_*Math.sin(d*e),M=g-_*Math.cos(d*e);return S=.5*(S/Math.PI+.5),M=.5*(M/Math.PI+.5),{x:S,y:this.southernCenter?M:1-M,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:c,f:d}=this,g=d-n,_=Math.sign(g),S=Math.sign(c)*Math.sqrt(e*e+g*g);let M=Math.atan2(e,Math.abs(g))*_;g*c<0&&(M-=Math.PI*Math.sign(e)*_);const R=ne(Wi(M/c)+this.center[0],-180,180),N=ne(Wi(2*Math.atan(Math.pow(d/S,1/c))-V_),-J,J);return new o(R,this.southernCenter?-N:N)}}class kT extends Cp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:j(e),y:O(n),z:0}}unproject(e,n){const c=H(e),d=K(n);return new o(c,d)}}const ET=ui(J);class LL extends Cp{project(e,n){const c=(n=ui(n))*n,d=c*c;return{x:.5*((e=ui(e))*(.8707-.131979*c+d*(d*(.003971*c-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+c*(.015085+d*(.028874*c-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,d=25,g=0,_=c*c;do{_=c*c;const R=_*_;g=(c*(1.007226+_*(.015085+R*(.028874*_-.044475-.005916*R)))-n)/(1.007226+_*(.045255+R*(.259866*_-.311325-.005916*11*R))),c=ne(c-g,-ET,ET)}while(Math.abs(g)>1e-6&&--d>0);_=c*c;const S=ne(Wi(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),M=Wi(c);return new o(S,M)}}const AT=ui(J);class IL extends Cp{project(e,n){n=ui(n),e=ui(e);const c=Math.cos(n),d=2/Math.PI,g=Math.acos(c*Math.cos(e/2)),_=Math.sin(g)/g,S=.5*(e*d+2*c*Math.sin(e/2)/_)||0,M=.5*(n+Math.sin(n)/_)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(M/Math.PI+1),z:0}}unproject(e,n){let c=e=(2*e-.5)*Math.PI,d=n=(2*(1-n)-1)*Math.PI,g=25;const _=1e-6;let S=0,M=0;do{const R=Math.cos(d),N=Math.sin(d),F=2*N*R,U=N*N,W=R*R,Z=Math.cos(c/2),ee=Math.sin(c/2),ce=2*Z*ee,oe=ee*ee,me=1-W*Z*Z,ve=me?1/me:0,Se=me?Math.acos(R*Z)*Math.sqrt(1/me):0,De=.5*(2*Se*R*ee+2*c/Math.PI)-e,Re=.5*(Se*N+d)-n,$e=.5*ve*(W*oe+Se*R*Z*U)+1/Math.PI,We=ve*(ce*F/4-Se*N*ee),tt=.125*ve*(F*ee-Se*N*W*ce),_t=.5*ve*(U*Z+Se*oe*R)+.5,nt=We*tt-_t*$e;S=(Re*We-De*_t)/nt,M=(De*tt-Re*$e)/nt,c=ne(c-S,-Math.PI,Math.PI),d=ne(d-M,-AT,AT)}while((Math.abs(S)>_||Math.abs(M)>_)&&--g>0);return new o(Wi(c),Wi(d))}}class CT extends Cp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ui(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:c,cosPhi:d}=this;return{x:ui(e)*d*c+.5,y:-Math.sin(ui(n))/d*c+.5,z:0}}unproject(e,n){const{scale:c,cosPhi:d}=this,g=-(n-.5)/c,_=ne(Wi((e-.5)/c)/d,-180,180),S=Math.asin(ne(g*d,-1,1)),M=ne(Wi(S),-J,J);return new o(_,M)}}class zL extends kT{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,c){const d=hp(e,n,c);return Ii(d,d,fp(Mo(c))),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,n,c){const d=Zl(n.lat,n.lng),g=pn([],d),_=c?e._centerAltitude+c:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;_i(d,d,g,B(1,0)*Jt*_);const S=re(new Float64Array(16));return xe(S,e.pixelMatrix,e.globeMatrix),Ii(d,d,S),new Me(d[0],d[1])}pixelsPerMeter(e,n){return B(1,0)*n}pixelSpaceConversion(e,n,c){const d=B(1,e)*n,g=Gi(B(1,45)*n,d,c);return this.pixelsPerMeter(e,n)/g}createTileMatrix(e,n,c){const d=m_(Mo(c.canonical));return xe(new Float64Array(16),e.globeMatrix,d)}createInversionMatrix(e,n){const{center:c}=e,d=fp(Mo(n));return Ee(d,d,ui(c.lng)),Be(d,d,ui(c.lat)),Ne(d,d,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(e,n,c,d){return Pd(e,n,c,!0)||new _e(0,0)}pointCoordinate3D(e,n,c){const d=this.pointCoordinate(e,n,c,0);return[d.x,d.y,d.z]}isPointAboveHorizon(e,n){return!Pd(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=(function(d,g){const _=d.cameraToCenterDistance,S=d._centerAltitude*g,M=d._camera,R=d._camera.forward(),N=Ct([],Ft([],R,-_),[0,0,S]),F=d.worldSize/(2*Math.PI),U=[0,0,-F],W=d.width/d.height,Z=Math.tan(d.fovAboveCenter),ee=Ft([],M.up(),Z),ce=Ft([],M.right(),Z*W),oe=pn([],Ct([],Ct([],R,ee),ce)),me=[];let ve;if(new wi(N,oe).closestPointOnSphere(U,F,me)){const Se=Ct([],me,U),De=Da([],Se,N);ve=Math.cos(d.fovAboveCenter)*Pi(De)}else{const Se=Da([],N,U),De=Da([],U,N);pn(De,De);const Re=Pi(Se)-F;ve=Math.sqrt(Re*(Re+2*F));const $e=Math.acos(ve/(F+Re))-Math.acos(sn(R,De));ve*=Math.cos($e)}return 1.01*ve})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=jd(e.zoom);if(c>0){const d=ST(e,B(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Gi(n,d+g*(1-Math.cos(_)),Math.pow(c,10))}return n}upVector(e,n,c){return hp(n,c,e,1)}upVectorScale(e){return{metersToTile:Yl(gg(Mo(e)))}}}function MT(r){const e=r.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new kT(r);case"equirectangular":return new jL(r);case"naturalEarth":return new LL(r);case"equalEarth":return new PL(r);case"winkelTripel":return new IL(r);case"albers":return n?new CT(r):new ML(r);case"lambertConformalConic":return n?new CT(r):new RL(r);case"globe":return new zL(r)}throw new Error(`Invalid projection name: ${r.name}`)}const DL=Ke.types,OL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yv(r,e,n,c,d,g,_,S,M,R,N,F,U){const W=S?Math.min(_m,Math.round(S[0])):0,Z=S?Math.min(_m,Math.round(S[1])):0;r.emplaceBack(e,n,Math.round(32*c),Math.round(32*d),g,_,(W<<1)+(M?1:0),0+(Z<<1),16*R,16*N,256*F,256*U)}function vv(r,e,n){r.emplaceBack(e,n)}function xv(r,e,n,c,d,g,_){r.emplaceBack(e,n,c,d,g,_)}const _0=(r,e,n,c)=>{for(let d=0;d<e;d++)r.emplaceBack(n[0],n[1],n[2],c[0],c[1],c[2])};function H_(r,e,n,c,d){r.emplaceBack(e,n,c,d),r.emplaceBack(e,n,c,d),r.emplaceBack(e,n,c,d),r.emplaceBack(e,n,c,d)}function NL(r){for(const e of r.sections)if(tg(e.text))return!0;return!1}class Fw{constructor(e){this.layoutVertexArray=new Zh,this.indexArray=new Zr,this.programConfigurations=e,this.segments=new ir,this.dynamicLayoutVertexArray=new hu,this.opacityVertexArray=new Jf,this.placedSymbolArray=new hg,this.iconTransitioningVertexArray=new kl,this.globeExtVertexArray=new Kf,this.zOffsetVertexArray=new wl,this.orientationVertexArray=new em,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,n){const c=[],d=this.layoutVertexArray.uint16;for(let g=0;g<n;++g){const _=12*(e+g);c.push(...d.slice(_,_+12))}return c}updateIconVertexData(e,n,c,d,g,_,S,M,R,N,F,U,W){const Z=this.layoutVertexArray.uint16,ee=12*e;Z[ee]=n,Z[ee+1]=c,Z[ee+2]=d,Z[ee+3]=g,Z[ee+4]=_,Z[ee+5]=S,Z[ee+6]=M,Z[ee+7]=R,Z[ee+8]=N,Z[ee+9]=F,Z[ee+10]=U,Z[ee+11]=W}upload(e,n,c,d,g,_){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,BR.members,!!_),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,$R.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,OL,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,GR.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,UR.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,VR.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,HR.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}vi(Fw,"SymbolBuffers");class Bw{constructor(e,n,c){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new c,this.segments=new ir,this.collisionVertexArray=new Qm,this.collisionVertexArrayExt=new hu}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,qR.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,WR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}vi(Bw,"CollisionBuffers");class y0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((_=>_.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=re([]),this.placementViewportMatrix=re([]);const n=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=F_(this.zoom,n["text-size"],this.worldview),this.iconSizeData=F_(this.zoom,n["icon-size"],this.worldview);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.lut=e.lut,this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map((_=>Bc[_])),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const n=this.layers[0].getAppearances();return!(!n||n.length===0)&&n.some((c=>c.getProperty(e)!=null))}createArrays(){this.text=new Fw(new Lc(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new Fw(new Lc(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new Xh,this.lineVertexArray=new rp,this.symbolInstances=new am}calculateGlyphDependencies(e,n,c,d,g){for(const _ of e){const S=_.codePointAt(0);if(S===void 0)break;if(n[S]=!0,d&&g&&S<=65535){const M=ov[_];M&&(n[M.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,n,c,d,g,_){let S=1;const M=e.getUnevaluatedProperties()._values["icon-size"],R=F_(this.zoom,M,this.worldview),N=B_(R,n);if(R.kind!=="constant"&&R.kind!=="camera"||(S=N.uSize),R.kind==="composite"){const{minZoom:F,maxZoom:U}=R,W=M.possiblyEvaluate(new Fa(F,{worldview:this.worldview}),d),Z=M.possiblyEvaluate(new Fa(U,{worldview:this.worldview}),d),ee=W.evaluate(c,{},d,g);S=ee+(Z.evaluate(c,{},d,g)-ee)*N.uSizeT}return R.kind==="source"&&(S=M.possiblyEvaluate(new Fa(this.zoom,{worldview:this.worldview}),d).evaluate(c,{},d,g)),S*_}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!vp(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?oo.build(e):e}populate(e,n,c,d){const g=this.layers[0],_=g.layout,S=this.projection.name==="globe",M=_.get("text-font"),R=_.get("text-field"),N=_.get("icon-image"),[F,U]=_.get("icon-size-scale-range"),W=ne(n.scaleFactor||1,F,U),Z=(R.value.kind!=="constant"||R.value.value instanceof cs&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),ee=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,ce=this.hasAnyAppearanceProperty("icon-image"),oe=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!Z&&!ee&&!ce)return;const me=n.iconDependencies,ve=n.glyphDependencies,Se=n.availableImages,De=new Fa(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),Re=$e=>{const We=$e.id.toString();me.has(We)?me.get(We).push($e):me.set(We,[$e])};for(const $e of e){const{feature:We,id:tt,index:_t,sourceLayerIndex:nt}=$e,xt=g._featureFilter.needGeometry,Mt=it(We,xt);if(!g._featureFilter.filter(De,Mt,c))continue;if(xt||(Mt.geometry=Ge(We,c,d)),S&&We.type!==1&&c.z<=5){const Vt=Mt.geometry,si=.98078528056,Qt=(Oi,pi)=>sn(hp(Oi.x,Oi.y,c,1),hp(pi.x,pi.y,c,1))<si;for(let Oi=0;Oi<Vt.length;Oi++)Vt[Oi]=Ae(Vt[Oi],Qt)}let Pt,Gt;if(Z){const Vt=g.getValueAndResolveTokens("text-field",Mt,c,Se),si=cs.factory(Vt);NL(si)&&(this.hasRTLText=!0),(!this.hasRTLText||$h()==="unavailable"||this.hasRTLText&&du.isParsed())&&(Pt=XR(si,g,Mt))}if(ee){const Vt=g.getValueAndResolveTokens("icon-image",Mt,c,Se);Gt=this.getResolvedImageFromTokens(Vt)}const Wt=this.layers[0];let Ut=!1;if(!Gt&&ce){const Vt=Wt.getAppearances();for(const si of Vt)if(si.getProperty("icon-image")){const Qt=Wt.getAppearanceValueAndResolveTokens(si,"icon-image",Mt,c,Se);if(Qt){Gt=this.getResolvedImageFromTokens(Qt),Ut=!0;break}}}if(!Pt&&!Gt)continue;const $t=this.sortFeaturesByKey?oe.evaluate(Mt,{},c):void 0,vt={id:tt,text:Pt,icon:Gt,index:_t,sourceLayerIndex:nt,geometry:Mt.geometry,properties:We.properties,type:DL[We.type],sortKey:$t};if(this.features.push(vt),this.featureToAppearanceIndex[_t]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:tt,properties:We.properties,usesAppearanceIconAsPlaceholder:Ut,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Gt){const Vt=Wt._unevaluatedLayout._values,{iconPrimary:si,iconSecondary:Qt}=dv(Gt,this.iconSizeData,Vt["icon-size"],c,this.zoom,vt,this.pixelRatio,W,this.worldview);Re(si),Qt&&(this.hasAnySecondaryIcon=!0,Re(Qt))}const yt=Wt.getAppearances();if(yt.length!==0&&yt.forEach((Vt=>{if(!Vt.getProperty("icon-image"))return;const si=this.getCombinedIconPrimary(Vt,Wt,Mt,c,Se,vt,W);si&&Re(si)})),Pt){const Vt=M.evaluate(Mt,{},c).join(","),si=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Bc.vertical)>=0;for(const Qt of Pt.sections)if(Qt.image){const Oi=Qt.image.getPrimary().scaleSelf(this.pixelRatio),pi=Oi.id.toString(),bi=me.get(pi)||[];bi.push(Oi),me.set(pi,bi)}else{const Oi=th(Pt.toString()),pi=Qt.fontStack||Vt,bi=ve[pi]=ve[pi]||{};this.calculateGlyphDependencies(Qt.text,bi,si,this.allowVerticalPlacement,Oi)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function($e){const We={},tt={},_t=[];let nt=0;function xt(Wt){_t.push($e[Wt]),nt++}function Mt(Wt,Ut,$t){const vt=tt[Wt];return delete tt[Wt],tt[Ut]=vt,_t[vt].geometry[0].pop(),_t[vt].geometry[0]=_t[vt].geometry[0].concat($t[0]),vt}function Pt(Wt,Ut,$t){const vt=We[Ut];return delete We[Ut],We[Wt]=vt,_t[vt].geometry[0].shift(),_t[vt].geometry[0]=$t[0].concat(_t[vt].geometry[0]),vt}function Gt(Wt,Ut,$t){const vt=$t?Ut[0][Ut[0].length-1]:Ut[0][0];return`${Wt}:${vt.x}:${vt.y}`}for(let Wt=0;Wt<$e.length;Wt++){const Ut=$e[Wt],$t=Ut.geometry,vt=Ut.text?Ut.text.toString():null;if(!vt){xt(Wt);continue}const yt=Gt(vt,$t),Vt=Gt(vt,$t,!0);if(yt in tt&&Vt in We&&tt[yt]!==We[Vt]){const si=Pt(yt,Vt,$t),Qt=Mt(yt,Vt,_t[si].geometry);delete We[yt],delete tt[Vt],tt[Gt(vt,_t[Qt].geometry,!0)]=Qt,_t[si].geometry=null}else yt in tt?Mt(yt,Vt,$t):Vt in We?Pt(yt,Vt,$t):(xt(Wt),We[yt]=nt-1,tt[Vt]=nt-1)}return _t.filter((Wt=>Wt.geometry))})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",n.elevationFeatures){!this.elevationFeatures&&n.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const $e of n.elevationFeatures)this.elevationFeatureIdToIndex.set($e.id,this.elevationFeatures.length),this.elevationFeatures.push($e)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((($e,We)=>$e.sortKey-We.sortKey))}getCombinedIconPrimary(e,n,c,d,g,_,S){let M,R;const N=e.getUnevaluatedProperties();if(N._values["icon-image"].value!==void 0){const F=n.getAppearanceValueAndResolveTokens(e,"icon-image",c,d,g);M=this.getResolvedImageFromTokens(F)}else{const F=n.getValueAndResolveTokens("icon-image",c,d,g);M=this.getResolvedImageFromTokens(F)}if(M){const F=N._values["icon-size"]||n._unevaluatedLayout._values["icon-size"];R=dv(M,F_(this.zoom,F,this.worldview),F,d,this.zoom,_,this.pixelRatio,S,this.worldview).iconPrimary}return R}updateAppearanceBasedIconTextures(e,n,c,d){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const g=this.layers[0];let _=!1,S=0;const M=g.layout,[R,N]=M.get("icon-size-scale-range"),F=ne(1,R,N);for(let U=0;U<this.symbolInstances.length;U++){const W=this.symbolInstances.get(U),Z=this.featureToAppearanceIndex[W.featureIndex],ee=Z!==void 0?this.appearanceFeatureData[Z]:void 0;if(ee&&W.placedIconSymbolIndex>=0){const ce=ee.id,oe=n&&ce!==void 0?n[String(ce)]:void 0,me={type:"Point",id:ee.id,properties:ee.properties,geometry:[]},ve=this.layers[0].appearances&&this.layers[0].appearances.find((Se=>Se.isActive({globals:d,feature:me,canonical:e,featureState:oe})));if(ee.activeAppearance===ve){S+=W.numIconVertices;continue}if(ve){ee.activeAppearance=ve;const Se=this.getCombinedIconPrimary(ve,g,me,e,c,{sortKey:void 0,text:void 0,icon:null,index:W.featureIndex,sourceLayerIndex:W.featureIndex,geometry:[],properties:ee.properties,type:"Point",id:ee.id},F);if(!Se)continue;const De=Se.toString(),Re=this.iconAtlasPositions&&this.iconAtlasPositions.get(De);if(Re){const $e=g.getAppearanceValueAndResolveTokens(ve,"icon-offset",me,e,c),We=$e&&Array.isArray($e)?$e:[0,0];let tt=l0(Re,void 0,We,g.layout.get("icon-anchor").evaluate(me,{},e));const _t=g.getAppearanceValueAndResolveTokens(ve,"icon-rotate",me,e,c),nt=typeof _t=="number"?_t:0,xt=Re.sdf,Mt=g.layout.get("icon-text-fit").constantOr("none");Mt!=="none"&&ee.textShaping&&ee.iconTextFitPadding&&ee.fontScale&&(tt=jw(tt,ee.textShaping,Mt,ee.iconTextFitPadding,We,ee.fontScale));const Pt=this.calculateEffectiveAppearanceIconSize(ve,d.zoom,me,e,c,F),Gt=0,Wt=1+(Math.min(_m,Math.round(Pt*ph))<<1),Ut=zw(tt,nt,xt,Mt!=="none",F);ee.isUsingAppearanceVertexData||(ee.isUsingAppearanceVertexData=!0,ee.layoutBasedVertexData=this.icon.getIconVertexData(S,W.numIconVertices));for(let vt=0;vt<Ut.length;++vt){const yt=Ut[vt],Vt=ee.layoutBasedVertexData[0]||W.tileAnchorX,si=ee.layoutBasedVertexData[1]||W.tileAnchorY,Qt=16*yt.pixelOffsetTL.x,Oi=16*yt.pixelOffsetTL.y,pi=16*yt.pixelOffsetBR.x,bi=16*yt.pixelOffsetBR.y,Mi=16*yt.minFontScaleX,jn=16*yt.minFontScaleY;this.icon.updateIconVertexData(S,Vt,si,Math.round(32*yt.tl.x),Math.round(32*yt.tl.y),yt.texPrimary.x,yt.texPrimary.y,Gt,Wt,Qt,Oi,Mi,jn),this.icon.updateIconVertexData(S+1,Vt,si,Math.round(32*yt.tr.x),Math.round(32*yt.tr.y),yt.texPrimary.x+yt.texPrimary.w,yt.texPrimary.y,Gt,Wt,pi,Oi,Mi,jn),this.icon.updateIconVertexData(S+2,Vt,si,Math.round(32*yt.bl.x),Math.round(32*yt.bl.y),yt.texPrimary.x,yt.texPrimary.y+yt.texPrimary.h,Gt,Wt,Qt,bi,Mi,jn),this.icon.updateIconVertexData(S+3,Vt,si,Math.round(32*yt.br.x),Math.round(32*yt.br.y),yt.texPrimary.x+yt.texPrimary.w,yt.texPrimary.y+yt.texPrimary.h,Gt,Wt,pi,bi,Mi,jn),S+=4}const $t=W.numIconVertices-4*Ut.length;for(let vt=0;vt<$t;++vt)this.icon.updateIconVertexData(S+vt,0,0,0,0,0,0,0,0,0,0,0,0);_=!0}else S+=W.numIconVertices}else if(ee.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(S,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(S+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(S+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(S+3,0,0,0,0,0,0,0,0,0,0,0,0),_=!0),S+=W.numIconVertices,ee.activeAppearance=null;else if(ee.isUsingAppearanceVertexData){const De=ee.layoutBasedVertexData.length/12;for(let Re=0;Re<De;++Re){const $e=Re*12;this.icon.updateIconVertexData(S+Re,ee.layoutBasedVertexData[$e+0],ee.layoutBasedVertexData[$e+1],ee.layoutBasedVertexData[$e+2],ee.layoutBasedVertexData[$e+3],ee.layoutBasedVertexData[$e+4],ee.layoutBasedVertexData[$e+5],ee.layoutBasedVertexData[$e+6],ee.layoutBasedVertexData[$e+7],ee.layoutBasedVertexData[$e+8],ee.layoutBasedVertexData[$e+9],ee.layoutBasedVertexData[$e+10],ee.layoutBasedVertexData[$e+11])}S+=De,ee.isUsingAppearanceVertexData=!1,ee.activeAppearance=null,_=!0}else S+=W.numIconVertices,ee.activeAppearance=null}}return _}update(e,n,c,d,g,_,S){this.text.programConfigurations.updatePaintArrays(e,n,g,c,d,_,S,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,n,g,c,d,_,S,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let n=!1;const c=de(e),d=1/c;let g=!1,_=!1;for(let S=0;S<this.symbolInstances.length;S++){const M=this.symbolInstances.get(S),R=qe(1,0,0),N=qe(0,1,0),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:U,numIconVertices:W,numVerticalIconVertices:Z}=M,ee=F>0||U>0,ce=W>0,oe=this.elevationFeatures[M.elevationFeatureIndex];if(oe){const me=new Me(M.tileAnchorX,M.tileAnchorY),ve=.075+oe.pointElevation(me);M.zOffset!==ve&&(n=!0,M.zOffset=ve),ve!==0&&(this.hasAnyZOffset=!0);const Se=oe.computeSlopeNormal(me,d),De=Ko(Yo(),qe(0,0,1),Se);mn(R,R,De),mn(N,N,De),R[2]*=c,N[2]*=c,R[0]===1&&R[1]===0&&R[2]===0&&N[0]===0&&N[1]===1&&N[2]===0||(g=g||ee,_=_||ce)}if(ee&&(_0(this.text.orientationVertexArray,F,R,N),_0(this.text.orientationVertexArray,U,R,N)),ce){const{placedIconSymbolIndex:me,verticalPlacedIconSymbolIndex:ve}=M;me>=0&&_0(this.icon.orientationVertexArray,W,R,N),ve>=0&&_0(this.icon.orientationVertexArray,Z,R,N)}}g||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),n&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(g,_,S)=>{c+=_,c>g.length&&g.resize(c);for(let M=-_;M<0;M++)g.emplace(M+c,S)},n=(g,_,S)=>{d+=_,d>g.length&&g.resize(d);for(let M=-_;M<0;M++)g.emplace(M+d,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,d=0;for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:M,numIconVertices:R}=_,N=_.zOffset,F=R>0;if((S>0||M>0)&&(e(this.text.zOffsetVertexArray,S,N),e(this.text.zOffsetVertexArray,M,N)),F){const{placedIconSymbolIndex:U,verticalPlacedIconSymbolIndex:W}=_;U>=0&&n(this.icon.zOffsetVertexArray,R,N),W>=0&&n(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,N)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,n,c,d,g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((_=>_.appearances&&_.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,n,c,d){return!!(e&&n&&c)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,n,c,d)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=MT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const c=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:d,y:g}of n)this.lineVertexArray.emplaceBack(d,g);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee,ce,oe,me){const ve=e.indexArray,Se=e.layoutVertexArray,De=e.globeExtVertexArray,Re=e.segments.prepareSegment(4*me,Se,ve,this.canOverlap?_.sortKey:void 0),$e=this.glyphOffsetArray.length,We=Re.vertexLength,tt=this.allowVerticalPlacement&&S===Bc.vertical?Math.PI/2:0,_t=_.text&&_.text.sections;for(let Mt=0;Mt<n.length;Mt++){const{tl:Pt,tr:Gt,bl:Wt,br:Ut,texPrimary:$t,texSecondary:vt,pixelOffsetTL:yt,pixelOffsetBR:Vt,minFontScaleX:si,minFontScaleY:Qt,glyphOffset:Oi,isSDF:pi,sectionIndex:bi}=n[Mt],Mi=Re.vertexLength,jn=Oi[1];if(yv(Se,R.x,R.y,Pt.x,jn+Pt.y,$t.x,$t.y,c,pi,yt.x,yt.y,si,Qt),yv(Se,R.x,R.y,Gt.x,jn+Gt.y,$t.x+$t.w,$t.y,c,pi,Vt.x,yt.y,si,Qt),yv(Se,R.x,R.y,Wt.x,jn+Wt.y,$t.x,$t.y+$t.h,c,pi,yt.x,Vt.y,si,Qt),yv(Se,R.x,R.y,Ut.x,jn+Ut.y,$t.x+$t.w,$t.y+$t.h,c,pi,Vt.x,Vt.y,si,Qt),M){const{x:ni,y:Li,z:dn}=M.anchor,[Wn,Kn,wn]=M.up;xv(De,ni,Li,dn,Wn,Kn,wn),xv(De,ni,Li,dn,Wn,Kn,wn),xv(De,ni,Li,dn,Wn,Kn,wn),xv(De,ni,Li,dn,Wn,Kn,wn),H_(e.dynamicLayoutVertexArray,ni,Li,dn,tt)}else H_(e.dynamicLayoutVertexArray,R.x,R.y,R.z,tt);if(ce){const ni=vt||$t;vv(e.iconTransitioningVertexArray,ni.x,ni.y),vv(e.iconTransitioningVertexArray,ni.x+ni.w,ni.y),vv(e.iconTransitioningVertexArray,ni.x,ni.y+ni.h),vv(e.iconTransitioningVertexArray,ni.x+ni.w,ni.y+ni.h)}ve.emplaceBack(Mi,Mi+1,Mi+2),ve.emplaceBack(Mi+1,Mi+2,Mi+3),Re.vertexLength+=4,Re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Oi[0]),Mt!==n.length-1&&bi===n[Mt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Se.length,_,_.index,{},W,Z,ee,_t&&_t[bi],this.worldview)}const nt=me-n.length;nt!==0&&this._addNullVertices(nt,Se,c,M,De,e,ce,Re,ve);const xt=M?M.anchor:R;e.placedSymbolArray.emplaceBack(xt.x,xt.y,xt.z,R.x,R.y,$e,this.glyphOffsetArray.length-$e,We,N,F,R.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],S,0,0,0,U,0),e.symbolInstanceIndices.push(oe)}_addNullVertices(e,n,c,d,g,_,S,M,R){for(let N=0;N<e;N++){for(let U=0;U<4;U++)yv(n,0,0,0,0,0,0,c,!1,0,0,0,0),d&&xv(g,0,0,0,0,0,0),H_(_.dynamicLayoutVertexArray,0,0,0,0),S&&vv(_.iconTransitioningVertexArray,0,0);const F=M.vertexLength;R.emplaceBack(F,F+1,F+2),R.emplaceBack(F+1,F+2,F+3),M.vertexLength+=4,M.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,n,c,d,g,_,S){e.emplaceBack(n,c,d,g,_,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(e,n,c,d,g,_,S){const M=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),R=M.vertexLength,N=S.tileAnchorX,F=S.tileAnchorY;for(let W=0;W<4;W++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,n,e.padding,S.zOffset),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,N,F,new Me(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,N,F,new Me(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,N,F,new Me(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,N,F,new Me(e.x1,e.y2)),M.vertexLength+=4;const U=c.indexArray;U.emplaceBack(R,R+1),U.emplaceBack(R+1,R+2),U.emplaceBack(R+2,R+3),U.emplaceBack(R+3,R),M.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,c,d,g,_){for(let S=d;S<g;S++){const M=c.get(S),R=this.getSymbolInstanceTextSize(e,_,n,S);this._addCollisionDebugVertices(M,R,this.textCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,n,c,d,g,_){for(let S=d;S<g;S++){const M=c.get(S),R=this.getSymbolInstanceIconSize(e,n,_.placedIconSymbolIndex);this._addCollisionDebugVertices(M,R,this.iconCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,n,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bw(rh,W2.members,kl),this.iconCollisionBox=new Bw(rh,W2.members,kl);const d=B_(this.iconSizeData,e),g=B_(this.textSizeData,e,c);for(let _=0;_<this.symbolInstances.length;_++){const S=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(g,e,n,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(g,e,n,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(d,e,n,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(d,e,n,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(e,n,c,d){const g=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:d),_=Rw(this.textSizeData,e,g)/Bs;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,n,c){const d=this.icon.placedSymbolArray.get(c),g=Rw(this.iconSizeData,e,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,n,c,d){e.emplaceBack(n,-c,-c,d),e.emplaceBack(n,c,-c,d),e.emplaceBack(n,c,c,d),e.emplaceBack(n,-c,c,d)}_updateTextDebugCollisionBoxes(e,n,c,d,g,_,S){for(let M=d;M<g;M++){const R=c.get(M),N=this.getSymbolInstanceTextSize(e,_,n,M);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,N,R.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(e,n,c,d,g,_,S){for(let M=d;M<g;M++){const R=c.get(M),N=this.getSymbolInstanceIconSize(e,n,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,N,R.padding,_.zOffset)}}updateCollisionDebugBuffers(e,n,c,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=B_(this.iconSizeData,e,d),_=B_(this.textSizeData,e,c);for(let S=0;S<this.symbolInstances.length;S++){const M=this.symbolInstances.get(S);this._updateTextDebugCollisionBoxes(_,e,n,M.textBoxStartIndex,M.textBoxEndIndex,M,c),this._updateTextDebugCollisionBoxes(_,e,n,M.verticalTextBoxStartIndex,M.verticalTextBoxEndIndex,M,c),this._updateIconDebugCollisionBoxes(g,e,n,M.iconBoxStartIndex,M.iconBoxEndIndex,M,d),this._updateIconDebugCollisionBoxes(g,e,n,M.verticalIconBoxStartIndex,M.verticalIconBoxEndIndex,M,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,c,d,g,_,S,M,R){const N={};if(n<c){const{x1:F,y1:U,x2:W,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:oe,projectedAnchorZ:me,tileAnchorX:ve,tileAnchorY:Se,featureIndex:De}=e.get(n);N.textBox={x1:F,y1:U,x2:W,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:oe,projectedAnchorZ:me,tileAnchorX:ve,tileAnchorY:Se},N.textFeatureIndex=De}if(d<g){const{x1:F,y1:U,x2:W,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:oe,projectedAnchorZ:me,tileAnchorX:ve,tileAnchorY:Se,featureIndex:De}=e.get(d);N.verticalTextBox={x1:F,y1:U,x2:W,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:oe,projectedAnchorZ:me,tileAnchorX:ve,tileAnchorY:Se},N.verticalTextFeatureIndex=De}if(_<S){const{x1:F,y1:U,x2:W,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:oe,projectedAnchorZ:me,tileAnchorX:ve,tileAnchorY:Se,featureIndex:De}=e.get(_);N.iconBox={x1:F,y1:U,x2:W,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:oe,projectedAnchorZ:me,tileAnchorX:ve,tileAnchorY:Se},N.iconFeatureIndex=De}if(M<R){const{x1:F,y1:U,x2:W,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:oe,projectedAnchorZ:me,tileAnchorX:ve,tileAnchorY:Se,featureIndex:De}=e.get(M);N.verticalIconBox={x1:F,y1:U,x2:W,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:oe,projectedAnchorZ:me,tileAnchorX:ve,tileAnchorY:Se},N.verticalIconFeatureIndex=De}return N}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const c=e.placedSymbolArray.get(n),d=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<d;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),c=Math.cos(e),d=[],g=[],_=[];for(let S=0;S<this.symbolInstances.length;++S){_.push(S);const M=this.symbolInstances.get(S);d.push(0|Math.round(n*M.tileAnchorX+c*M.tileAnchorY)),g.push(M.featureIndex)}return _.sort(((S,M)=>d[S]-d[M]||g[M]-g[S])),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,n){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:R}=c;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),_>=0&&_!==g&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const n=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let c;return this.elevationFeatures&&n<this.elevationFeatures.length&&(c=this.elevationFeatures[n]),c}}function PT(r,e){return e.replace(/{([^{}]+)}/g,((n,c)=>c in r?String(r[c]):""))}let jT,RT,Uw;vi(y0,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),y0.addDynamicAttributes=H_;class LT{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ml,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}vi(LT,"FormatSectionOverride",{omit:["defaultValue"]});const $w=()=>Uw||(Uw={layout:jT||(jT=new dr({"symbol-placement":new ei(rt.layout_symbol["symbol-placement"]),"symbol-spacing":new ei(rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ei(rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new li(rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ei(rt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ei(rt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ei(rt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ei(rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ei(rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ei(rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ei(rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new li(rt.layout_symbol["icon-size"]),"icon-size-scale-range":new ei(rt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new li(rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new li(rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new li(rt.layout_symbol["icon-image"]),"icon-image-use-theme":new ei({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new li(rt.layout_symbol["icon-rotate"]),"icon-padding":new ei(rt.layout_symbol["icon-padding"]),"icon-keep-upright":new ei(rt.layout_symbol["icon-keep-upright"]),"icon-offset":new li(rt.layout_symbol["icon-offset"]),"icon-anchor":new li(rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ei(rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ei(rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ei(rt.layout_symbol["text-rotation-alignment"]),"text-field":new li(rt.layout_symbol["text-field"]),"text-font":new li(rt.layout_symbol["text-font"]),"text-size":new li(rt.layout_symbol["text-size"]),"text-size-scale-range":new ei(rt.layout_symbol["text-size-scale-range"]),"text-max-width":new li(rt.layout_symbol["text-max-width"]),"text-line-height":new li(rt.layout_symbol["text-line-height"]),"text-letter-spacing":new li(rt.layout_symbol["text-letter-spacing"]),"text-justify":new li(rt.layout_symbol["text-justify"]),"text-radial-offset":new li(rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ei(rt.layout_symbol["text-variable-anchor"]),"text-anchor":new li(rt.layout_symbol["text-anchor"]),"text-max-angle":new ei(rt.layout_symbol["text-max-angle"]),"text-writing-mode":new ei(rt.layout_symbol["text-writing-mode"]),"text-rotate":new li(rt.layout_symbol["text-rotate"]),"text-padding":new ei(rt.layout_symbol["text-padding"]),"text-keep-upright":new ei(rt.layout_symbol["text-keep-upright"]),"text-transform":new li(rt.layout_symbol["text-transform"]),"text-offset":new li(rt.layout_symbol["text-offset"]),"text-allow-overlap":new ei(rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ei(rt.layout_symbol["text-ignore-placement"]),"text-optional":new ei(rt.layout_symbol["text-optional"]),visibility:new ei(rt.layout_symbol.visibility)})),paint:RT||(RT=new dr({"icon-opacity":new li(rt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new li(rt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new li(rt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new li(rt.paint_symbol["text-emissive-strength"]),"icon-color":new li(rt.paint_symbol["icon-color"]),"icon-halo-color":new li(rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new li(rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new li(rt.paint_symbol["icon-halo-blur"]),"icon-translate":new ei(rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ei(rt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ei(rt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new li(rt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new li(rt.paint_symbol["text-occlusion-opacity"]),"text-color":new li(rt.paint_symbol["text-color"],{runtimeType:Js,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new li(rt.paint_symbol["text-halo-color"]),"text-halo-width":new li(rt.paint_symbol["text-halo-width"]),"text-halo-blur":new li(rt.paint_symbol["text-halo-blur"]),"text-translate":new ei(rt.paint_symbol["text-translate"]),"text-translate-anchor":new ei(rt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ei(rt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ei(rt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ei(rt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ei(rt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new li(rt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},Uw);class v0 extends Eo{constructor(e,n,c,d){super(e,$w(),n,c,d,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=re([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,n){super.recalculate(e,n),this.appearances&&this.appearances.forEach((d=>{d.recalculate(e,n,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const g of c)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,c,d){return this._saturation===e&&this._contrast===n&&this._brightnessMin===c&&this._brightnessMax===d||(this._colorAdjustmentMatrix=(function(g,_,S,M){g=ia(g),_=an(_);const R=te(),N=g/3,F=1-2*N,U=[F,N,N,0,N,F,N,0,N,N,F,0,0,0,0,1],W=.5-.5*_,Z=M-S;return xe(R,[Z,0,0,0,0,Z,0,0,0,0,Z,0,S,S,S,1],[_,0,0,0,0,_,0,0,0,0,_,0,W,W,W,1]),xe(R,R,U),R})(e,n,c,d),this._saturation=e,this._contrast=n,this._brightnessMin=c,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,c,d){const g=this.layout.get(e).evaluate(n,{},c,d),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||qr(_.value)||!g?g:PT(n.properties,g)}getAppearanceValueAndResolveTokens(e,n,c,d,g){const _=e.getProperty(n);if(!_)return;const S=_.evaluate(c,{},d,g),M=e.getUnevaluatedProperties()._values[n];return M.isDataDriven()||qr(M.value)||!S||typeof S!="string"?S:PT(c.properties,S)}createBucket(e){return new y0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of $w().paint.overridableProperties){if(!v0.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),c=new LT(n),d=new $m(c,n.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new vd("source",d):new xd("composite",d,n.value.zoomStops,n.value.interpolationType),this.paint._values[e]=new Cc(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&v0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const c=e.get("text-field"),d=$w().paint.properties[n];let g=!1;const _=S=>{for(const M of S)if(d.overrides&&d.overrides.hasOverride(M))return void(g=!0)};if(c.value.kind==="constant"&&c.value.value instanceof cs)_(c.value.value.sections);else if(c.value.kind==="source"){const S=R=>{g||(R instanceof el&&Gr(R.value)===Kc?_(R.value.sections):R instanceof gl?_(R.sections):R.eachChild(S))},M=c.value;M._styleExpression&&S(M._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,c){return{config:new Yr(this,{zoom:n,lut:c}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let IT,zT,DT,OT;var Vw=Ln([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function x0(r,e,n,c,d,g,_,S){const M=[r,e,1,n,c,1,d,g,1],R=[_,S,1],N=G([],M),[F,U,W]=nn(R,R,N);return X(M,M,[F,0,0,0,U,0,0,0,W])}function NT(r,e,n,c,d,g,_,S){const M=(function(R,N,F,U,W,Z,ee,ce){const oe=x0(0,0,1,0,1,1,0,1),me=x0(R,N,F,U,W,Z,ee,ce);return X(me,me,G([],oe))})(r,e,n,c,d,g,_,S);return[M[2]/M[8]/Jt,M[5]/M[8]/Jt]}function b0(r){return[r[0],Math.min(Math.max(r[1],-J),J)]}class FT extends _c{constructor(e,n,c,d){super(),this.id=e,this.dispatcher=c,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new wo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=js(this.map._requestManager.transformRequest(this.url,pc.Image),((c,d)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Qu(c)):d&&(this.image=d instanceof HTMLImageElement?Sa.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new av(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new wo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof av||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],c=e[0][1];for(const g of e)g[1]>c&&(c=g[1]),g[1]<n&&(n=g[1]);const d=(c+n)/2;if(d>J?this.onNorthPole=!0:d<-J&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=e.map(_e.fromLngLat);this.tileID=(function(_){let S=1/0,M=1/0,R=-1/0,N=-1/0;for(const ee of _)S=Math.min(S,ee.x),M=Math.min(M,ee.y),R=Math.max(R,ee.x),N=Math.max(N,ee.y);const F=Math.max(R-S,N-M),U=Math.max(0,Math.floor(-Math.log2(F))),W=Math.pow(2,U);let Z=Math.floor((S+R)/2*W);return Z>1&&(Z-=1),new Ca(U,Z,Math.floor((M+N)/2*W))})(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new wo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof av||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const oe in this.tiles){const me=this.tiles[oe];me.state!=="loaded"&&(me.state="loaded",me.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=fv(new Ca(0,0,0),this.map.transform.projection),c=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(oe){const me=oe[1].x-oe[0].x,ve=oe[1].y-oe[0].y,Se=oe[2].x-oe[1].x,De=oe[2].y-oe[1].y,Re=oe[3].x-oe[2].x,$e=oe[3].y-oe[2].y,We=oe[0].x-oe[3].x,tt=oe[0].y-oe[3].y,_t=me*De-Se*ve,nt=Se*$e-Re*De,xt=Re*tt-We*$e,Mt=We*ve-me*tt;return _t>0&&nt>0&&xt>0&&Mt>0||_t<0&&nt<0&&xt<0&&Mt<0})(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=fv(this.tileID,this.map.transform.projection),[g,_,S,M]=this.coordinates.map((oe=>{const me=d.projection.project(oe[0],oe[1]);return TT(d,me)._round()}));this.perspectiveTransform=NT(g.x,g.y,_.x,_.y,S.x,S.y,M.x,M.y);const R=this._boundsArray=new ah;R.emplaceBack(g.x,g.y,0,0),R.emplaceBack(_.x,_.y,Jt,0),R.emplaceBack(M.x,M.y,0,Jt),R.emplaceBack(S.x,S.y,Jt,Jt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(R,Vw.members),this.boundsSegments=ir.simpleSegment(0,0,4,2);const N=[],F=[b0((U=this.coordinates)[0]),b0(U[1]),b0(U[2]),b0(U[3])];var U;const[W,Z,ee,ce]=(function(oe){let me=oe[0][0],ve=me,Se=oe[0][1],De=Se;for(let Re=1;Re<oe.length;Re++)oe[Re][0]<me?me=oe[Re][0]:oe[Re][0]>ve&&(ve=oe[Re][0]),oe[Re][1]<Se?Se=oe[Re][1]:oe[Re][1]>De&&(De=oe[Re][1]);return[me,Se,ve-me,De-Se]})(F);{const oe=new ah,[me,ve,Se,De]=(function(Ut){let $t=Ut[0].x,vt=$t,yt=Ut[0].y,Vt=yt;for(let si=1;si<Ut.length;si++)Ut[si].x<$t?$t=Ut[si].x:Ut[si].x>vt&&(vt=Ut[si].x),Ut[si].y<yt?yt=Ut[si].y:Ut[si].y>Vt&&(Vt=Ut[si].y);return[$t,yt,vt-$t,Vt-yt]})(c),Re=Ut=>[(Ut.x-me)/Se,(Ut.y-ve)/De],[$e,We,tt,_t]=c.map(Re),nt=(function(Ut,$t,vt,yt,Vt,si,Qt,Oi){const pi=x0(0,0,1,0,1,1,0,1);return X(pi,pi,G([],x0(Ut,$t,vt,yt,Vt,si,Qt,Oi)))})($e[0],$e[1],We[0],We[1],tt[0],tt[1],_t[0],_t[1]);this.elevatedGlobePerspectiveTransform=NT($e[0],$e[1],We[0],We[1],tt[0],tt[1],_t[0],_t[1]);const xt=(Ut,$t)=>{N.push(Ut.lng);const vt=Math.round((Ut.lng-W)/ee*Jt),yt=Math.round((Ut.lat-Z)/ce*Jt),Vt=Re($t),si=nn([],[Vt[0],Vt[1],1],nt),Qt=Math.round(si[0]/si[2]*Jt),Oi=Math.round(si[1]/si[2]*Jt);oe.emplaceBack(vt,yt,Qt,Oi)},Mt=c[3].x-c[0].x,Pt=c[3].y-c[0].y,Gt=c[2].x-c[1].x,Wt=c[2].y-c[1].y;for(let Ut=0;Ut<65;Ut++){const $t=Ut/64,vt=[c[0].x+$t*Mt,c[0].y+$t*Pt],yt=[c[1].x+$t*Gt,c[1].y+$t*Wt],Vt=yt[0]-vt[0],si=yt[1]-vt[1];for(let Qt=0;Qt<65;Qt++){const Oi=Qt/64,pi={x:vt[0]+Vt*Oi,y:vt[1]+si*Oi};xt(n.projection.unproject(pi.x,pi.y),pi)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(oe,Vw.members)}{this.maxLongitudeTriangleSize=0;let oe=[],me=new Zr;const ve=(Se,De,Re)=>{me.emplaceBack(Se,De,Re);const $e=N[Se],We=N[De],tt=N[Re],_t=Math.min(Math.min($e,We),tt),nt=Math.max(Math.max($e,We),tt)-_t;nt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=nt),oe.push(_t+nt/2)};for(let Se=0;Se<64;Se++)for(let De=0;De<64;De++){const Re=65*Se+De,$e=Re+1,We=Re+65,tt=We+1;ve(Re,We,$e),ve($e,We,tt)}[oe,me]=(function(Se,De){const Re=Array.from({length:Se.length},((tt,_t)=>_t));Re.sort(((tt,_t)=>Se[tt]-Se[_t]));const $e=[],We=new Zr;for(let tt=0;tt<Re.length;tt++){const _t=Re[tt];$e.push(Se[_t]);const nt=3*_t,xt=nt+1;We.emplaceBack(De.uint16[nt],De.uint16[xt],De.uint16[xt+1])}return[$e,We]})(oe,me),this.elevatedGlobeTrianglesCenterLongitudes=oe,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(me)}this.elevatedGlobeSegments=ir.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ee/Jt,0,ce/Jt,0,0,Z,W,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,c=n.gl;!this._dirty||this.texture instanceof av||(this.texture?this.texture.update(this.image):(this.texture=new mw(n,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let d=(g=e+180)+360*Math.round((c[0]-g)/360);var g;const _=new ir,S=(F,U)=>{_.segments.push({vertexOffset:0,primitiveOffset:F,vertexLength:n.segments[0].vertexLength,primitiveLength:U,sortKey:void 0,vaos:{}})},M=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-d)<=M){const F=gn(c,0,c.length,d+M);return F===c.length||S(F,Jn(c,F+1,c.length,d+360-M)-F),_}d<c[0]&&(d+=360);const R=Jn(c,0,c.length,d-M);if(R===c.length)return S(0,c.length),_;S(0,R-0);const N=gn(c,R+1,c.length,d+M);return N!==c.length&&S(N,c.length-N),_}}const FL=(Math.pow(256,2)-1)/16907520;class BT extends Eo{constructor(e,n,c,d){super(e,{layout:DT||(DT=new dr({visibility:new ei(rt.layout_raster.visibility)})),paint:OT||(OT=new dr({"raster-opacity":new ei(rt.paint_raster["raster-opacity"]),"raster-color":new Sd(rt.paint_raster["raster-color"]),"raster-color-mix":new ei(rt.paint_raster["raster-color-mix"]),"raster-color-range":new ei(rt.paint_raster["raster-color-range"]),"raster-hue-rotate":new ei(rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ei(rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ei(rt.paint_raster["raster-brightness-max"]),"raster-saturation":new ei(rt.paint_raster["raster-saturation"]),"raster-contrast":new ei(rt.paint_raster["raster-contrast"]),"raster-resampling":new ei(rt.paint_raster["raster-resampling"]),"raster-fade-duration":new ei(rt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ei(rt.paint_raster["raster-emissive-strength"]),"raster-array-band":new ei(rt.paint_raster["raster-array-band"]),"raster-elevation":new ei(rt.paint_raster["raster-elevation"]),"raster-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},n,c,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof FT&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[c,d]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(d)||c===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=xg({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,d])}}let UT,$T,VT,HT,GT;class qT extends Eo{constructor(e,n,c,d){super(e,{layout:UT||(UT=new dr({visibility:new ei(rt["layout_raster-particle"].visibility)})),paint:$T||($T=new dr({"raster-particle-array-band":new ei(rt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ei(rt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Sd(rt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ei(rt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ei(rt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ei(rt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ei(rt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ei(rt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},n,c,d),this._updateColorRamp(),this.lastInvalidatedAt=Sa.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=xg({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Sa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class BL extends Eo{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Hw(r,e,n){const c=[0,0,1],d=Jr([]);return ds(d,d,n?-ui(r)+Math.PI:ui(r)),er(d,d,-ui(e)),mn(c,c,d),pn(c,c)}const WT={None:0,Model:1,Symbol:2,FillExtrusion:4};class w0{constructor(e,n,c,d){this.message=(e?`${e}: `:"")+c,d&&(this.identifier=d),n!=null&&n.__line__&&(this.line=n.__line__)}}function Gw(r,e){const n=r.indexOf("://")===-1;try{return new URL(r,n&&e?"http://example.com":void 0),!0}catch{return!1}}class ZT{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class XT{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new ip,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const n=16*e,c=this.instancedDataArray.float32;let d=Math.floor(c[n+2]);const g=1.05*(c[n+2]-d);return d/=100,[c[n]%1*1.05,c[n+1]%1*1.05,g,d]}tileCoordinatesForInstance(e){const n=16*e,c=this.instancedDataArray.float32;let d=c[n+0];return d=d>Jt?d-Jt:d,new Me(Math.trunc(d),Math.trunc(c[n+1]))}translationForInstance(e){const n=16*e,c=this.instancedDataArray.float32;return[c[n+4],c[n+5],c[n+6]]}rotationScaleForInstance(e){const n=16*e,c=this.instancedDataArray.float32;return[c[n+7],c[n+8],c[n+9],c[n+10],c[n+11],c[n+12],c[n+13],c[n+14],c[n+15]]}transformForInstance(e){const n=16*e,c=this.instancedDataArray.float32;return[c[n+7],c[n+8],c[n+9],c[n+4],c[n+10],c[n+11],c[n+12],c[n+5],c[n+13],c[n+14],c[n+15],c[n+6],0,0,0,1]}}class qw{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,d){}populate(e,n,c,d){this.tileToMeter=de(c);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:S,index:M,sourceLayerIndex:R}of e){const N=S??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),F=it(_,g);if(!this.layers[0]._featureFilter.filter(new Fa(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),F,c))continue;const U={id:N,sourceLayerIndex:R,index:M,geometry:g?F.geometry:Ge(_,c,d),properties:_.properties,type:_.type,patterns:{}},W=this.addFeature(U,U.geometry,F);W&&n.featureIndex.insert(_,U.geometry,M,R,this.index,this.instancesPerModel[W].instancedDataArray.length,Jt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,n=this.layers[0].scope;let c=0;for(const d of this.modelUris){const g=e.getModel(d,n);if(!g)continue;const _=this.instancesPerModel[d];if(_){const S=.5*At(g.aabb.max,g.aabb.min)*_.maxScale+_.maxXYTranslationDistance,M=Math.min(Jt,Math.max(S/this.tileToMeter,Jt/32));c=Math.max(M,c)}}return c}update(e,n,c,d){for(const g in this.instancesPerModel){const _=this.instancesPerModel[g];for(const S in e)_.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(_.features[_.idToFeaturesIndex[S]],e[S],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];for(const d of c.features){const g=this.layers[0],_=d.feature,S=this.canonical,M=g.paint.get("model-rotation").evaluate(_,{},S),R=g.paint.get("model-scale").evaluate(_,{},S),N=g.paint.get("model-translation").evaluate(_,{},S);Tn(d.rotation,M)&&Tn(d.scale,R)&&Tn(d.translation,N)||(this.evaluate(d,d.featureStates,c,!0),e=!0)}}return e}updateReplacement(e,n,c,d){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const g=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(vp(this.activeReplacements,g))return!1;this.activeReplacements=g;let _=!1;for(const S in this.instancesPerModel){const M=this.instancesPerModel[S],R=M.instancedDataArray;for(const N of M.features){const F=N.instancedDataOffset,U=N.instancedDataCount;for(let W=0;W<U;W++){const Z=16*(W+F);let ee=R.float32[Z+0];const ce=ee>Jt;ee=ce?ee-Jt:ee;const oe=Math.floor(ee),me=Math.floor(R.float32[Z+1]);let ve=!1;for(const Se of this.activeReplacements)if(!Xy(Se,c,WT.Model,d)&&!(Se.min.x>oe||oe>Se.max.x||Se.min.y>me||me>Se.max.y)&&(ve=C_(A_(oe,me,e.canonical,Se.footprintTileId.canonical),Se.footprint),ve))break;R.float32[Z]=ve?ee+Jt:ee,_=_||ve!==ce}}}return _}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=e.createVertexBuffer(c.instancedDataArray,cR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(e&&n&&this.modelUris&&this.modelsRequested)for(const c of this.modelUris)n.removeModel(c,"",!0)}addFeature(e,n,c){const d=this.layers[0],g=d.layout.get("model-id").evaluate(c,{},this.canonical);if(!g)return mi(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),g;(Gw(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new XT);const _=this.instancesPerModel[g],S=_.instancedDataArray,M=new ZT(c,S.length);for(const R of n)for(const N of R){if(N.x<0||N.x>=Jt||N.y<0||N.y>=Jt)continue;if(this.lookupDim!==0){const U=(this.lookupDim-1)/Jt,W=this.lookupDim*(N.y*U|0)+N.x*U|0;if(this.lookup){if(this.lookup[W]!==0)continue;this.lookup[W]=1}}this.instanceCount++;const F=S.length;S.resize(F+1),_.instancesEvaluatedElevation.push(0),S.float32[16*F]=N.x,S.float32[16*F+1]=N.y}return M.instancedDataCount=_.instancedDataArray.length-M.instancedDataOffset,M.instancedDataCount>0&&(e.id&&(_.idToFeaturesIndex[e.id]=_.features.length),_.features.push(M),this.evaluate(M,{},_,!1)),g}getModelUris(){return this.modelUris}evaluate(e,n,c,d){const g=this.layers[0],_=e.feature,S=this.canonical,M=e.rotation=g.paint.get("model-rotation").evaluate(_,n,S),R=e.scale=g.paint.get("model-scale").evaluate(_,n,S),N=e.translation=g.paint.get("model-translation").evaluate(_,n,S),F=Object.assign({},g.paint.get("model-color").evaluate(_,n,S));F.a=g.paint.get("model-color-mix-intensity").evaluate(_,n,S);const U=[];this.maxVerticalOffset<N[2]&&(this.maxVerticalOffset=N[2]);const W=N[0]*N[0]+N[1]*N[1],Z=W>0?Math.sqrt(W):0;c.maxScale=Math.max(Math.max(c.maxScale,R[0]),Math.max(R[1],R[2])),c.maxXYTranslationDistance=Math.max(c.maxXYTranslationDistance,Z),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),E2(U,M,R);const ee=Math.round(100*F.a)+F.b/1.05;for(let ce=0;ce<e.instancedDataCount;++ce){const oe=e.instancedDataOffset+ce,me=16*oe,ve=c.instancedDataArray.float32;let Se=0;d&&(Se=ve[me+6]-c.instancesEvaluatedElevation[oe]);const De=0|ve[me+1];ve[me]=(0|ve[me])+F.r/1.05,ve[me+1]=De+F.g/1.05,ve[me+2]=ee,ve[me+3]=1/(S.z>10?this.tileToMeter:de(S,De)),ve[me+4]=N[0],ve[me+5]=N[1],ve[me+6]=N[2]+Se,ve[me+7]=U[0],ve[me+8]=U[1],ve[me+9]=U[2],ve[me+10]=U[4],ve[me+11]=U[5],ve[me+12]=U[6],ve[me+13]=U[8],ve[me+14]=U[9],ve[me+15]=U[10],c.instancesEvaluatedElevation[oe]=N[2]}}}let YT,KT;vi(qw,"ModelBucket",{omit:["layers"]}),vi(XT,"PerModelAttributes"),vi(ZT,"ModelFeature");class G_{constructor(e,n,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=c}static create(e,n,c){const d=c||e.findDEMTileFor(n);if(!d||!d.dem)return;const g=d.dem,_=d.tileID,S=1<<n.canonical.z-_.canonical.z;return new G_(d,g.dim/Jt/S,[(n.canonical.x/S-_.canonical.x)*g.dim,(n.canonical.y/S-_.canonical.y)*g.dim])}tileCoordToPixel(e,n){const c=n*this._scale+this._offset[1];return new Me(Math.floor(e*this._scale+this._offset[0]),Math.floor(c))}getElevationAt(e,n,c,d){const g=e*this._scale+this._offset[0],_=n*this._scale+this._offset[1],S=Math.floor(g),M=Math.floor(_),R=this._dem;return d=!!d,c?Gi(Gi(R.get(S,M,d),R.get(S,M+1,d),_-M),Gi(R.get(S+1,M,d),R.get(S+1,M+1,d),_-M),g-S):R.get(S,M,d)}getElevationAtPixel(e,n,c){return this._dem.get(e,n,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*B(1,e)*this._dem.stride}}const Ww=new Float32Array(262144),Dg=new Uint8Array(262144);function JT(r){let e=0;if(r.meshes)for(const n of r.meshes)e=Math.max(e,n.aabb.max[2]);if(r.children)for(const n of r.children)e=Math.max(e,JT(n));return e}function QT(r,e,n){if(r.meshes)for(const c of r.meshes){if(c.aabb.min[0]===1/0)continue;const d=Si.applyTransform(c.aabb,r.globalMatrix);n.insert(e,d.min[0],d.min[1],d.max[0],d.max[1])}if(r.children)for(const c of r.children)QT(c,e,n)}const ek=["","wall","door","roof","window","lamp","logo"];class tk{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:JT(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==e&&(c.transformedAabb=Si.applyTransformFast(c.aabb,this.node.globalMatrix),n.encapsulate(c.transformedAabb)),e++;this.aabb=n}return this.aabb}}class S0{constructor(e,n,c,d,g,_,S,M){this.id=c,this.layers=e,this.layerIds=this.layers.map((R=>R.fqid)),this.stateDependentLayerIds=this.layers.filter((R=>R.isStateDependent())).map((R=>R.id)),this.modelTraits|=D_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=D_.HasMapboxMeshFeatures),g&&(this.modelTraits|=D_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=M,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const R of n)this.nodesInfo.push(new tk(R)),QT(R,S.featureIndexArray.length,S.grid),S.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,S.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,n){for(const c of this.getNodesInfo()){const d=c.node;d.footprint&&n.push({footprint:d.footprint,id:e})}}updateAppearances(e,n,c,d){}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const c=n?this.stateDependentLayers:this.layers;if(!Rt(e,this.states))for(const d of c)this.evaluate(d,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const c of n){const d=c.node;this.uploaded?this.updatePbrBuffer(d):_w(d,e,!0)}for(const c of n)a0(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const c of e.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),n=!0);return n}needsReEvaluation(e,n,c){const d=e.transform.projectionOptions,g=e.style.getBrightness(),_=this.brightness!==g;if(!this.uploaded||this.dirty||d.name!==this.projection.name||bv(c.paint.get("model-color").value,_)||bv(c.paint.get("model-color-mix-intensity").value,_)||bv(c.paint.get("model-roughness").value,_)||bv(c.paint.get("model-emissive-strength").value,_)||bv(c.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=d,this.brightness=g;const S=this.getNodesInfo();for(const M of S)M.state=null;return!0}return!1}evaluateTransform(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const c=this.getNodesInfo(),d=this.id.canonical;for(const g of c){const _=g.feature;g.evaluatedTranslation=n.paint.get("model-translation").evaluate(_,{},d),g.evaluatedScale=n.paint.get("model-scale").evaluate(_,{},d)}}evaluate(e,n){const c=this.getNodesInfo();for(const d of c){if(!d.node.meshes)continue;const g=d.feature,_=n&&n[g.id];if(Rt(_,d.state))continue;d.state=structuredClone(_);const S=d.node.meshes&&d.node.meshes[0].featureData,M=d.evaluatedColor[2],R=d.evaluatedRMEA[2],N=this.id.canonical;if(d.hasTranslucentParts=!1,S){for(let F=0;F<ek.length;F++){const U=ek[F];U.length&&(g.properties.part=U);const W=e.paint.get("model-color").evaluate(g,_,N).toPremultipliedRenderColor(null),Z=e.paint.get("model-color-mix-intensity").evaluate(g,_,N);d.evaluatedColor[F]=[W.r,W.g,W.b,Z],d.evaluatedRMEA[F][0]=e.paint.get("model-roughness").evaluate(g,_,N),d.evaluatedRMEA[F][2]=e.paint.get("model-emissive-strength").evaluate(g,_,N),d.evaluatedRMEA[F][3]=W.a,d.emissionHeightBasedParams[F]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,_,N),!d.hasTranslucentParts&&W.a<1&&(d.hasTranslucentParts=!0)}delete g.properties.part,$L(d,M!==d.evaluatedColor[2]||R!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(g,_,N);d.evaluatedTranslation=e.paint.get("model-translation").evaluate(g,_,N),d.evaluatedScale=e.paint.get("model-scale").evaluate(g,_,N),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,c,d){const g=e.findDEMTileFor(c);if(g&&(g.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const _=G_.create(e,c,g);if(!_)return;this.modelTraits&D_.HasMapboxMeshFeatures&&this.updateDEM(e,_,c,d);for(const S of this.getNodesInfo()){const M=S.node;if(!M.footprint||!M.footprint.vertices||!M.footprint.vertices.length)continue;const R=M.footprint.vertices;let N=_.getElevationAt(R[0].x,R[0].y,!0,!0);for(let F=1;F<R.length;F++)N=Math.min(N,_.getElevationAt(R[F].x,R[F].y,!0,!0));M.elevation=N}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,c,d){let g=n._dem._modifiedForSources[d];if(g===void 0&&(n._dem._modifiedForSources[d]=[],g=n._dem._modifiedForSources[d]),g.includes(c.canonical))return;const _=n._dem.dim;g.push(c.canonical);let S=!1;for(const M of this.getNodesInfo()){const R=M.node;if(!R.footprint||!R.footprint.grid)continue;const N=R.footprint.grid,F=n.tileCoordToPixel(N.min.x,N.min.y),U=n.tileCoordToPixel(N.max.x,N.max.y),W=Math.min(Math.min(_-U.y,F.x),Math.min(F.y,_-U.x));if(W<0)continue;const Z=ne(W,2,5);let ee=Math.max(0,F.x-Z),ce=Math.max(0,F.y-Z),oe=Math.min(U.x+Z,_-1),me=Math.min(U.y+Z,_-1);for(let Re=ce;Re<=me;++Re)for(let $e=ee;$e<=oe;++$e)Dg[Re*_+$e]=255;let ve=0,Se=0;for(let Re=0;Re<N.cellsY;++Re)for(let $e=0;$e<N.cellsX;++$e){if(!N.cells[Re*N.cellsX+$e])continue;const We=n.tileCoordToPixel(N.min.x+$e/N.xScale,N.min.y+Re/N.yScale),tt=n.tileCoordToPixel(N.min.x+($e+1)/N.xScale,N.min.y+(Re+1)/N.yScale);for(let _t=We.y;_t<=Math.min(tt.y+1,_-1);++_t)for(let nt=We.x;nt<=Math.min(tt.x+1,_-1);++nt)Dg[_t*_+nt]===255&&(Dg[_t*_+nt]=0,ve+=n.getElevationAtPixel(nt,_t),Se++)}const De=ve/Se;ee=Math.max(1,F.x-Z),ce=Math.max(1,F.y-Z),oe=Math.min(U.x+Z,_-2),me=Math.min(U.y+Z,_-2),S=!0;for(let Re=ce;Re<=me;++Re)for(let $e=ee;$e<=oe;++$e)Dg[Re*_+$e]===0&&(Ww[Re*_+$e]=n._dem.set($e,Re,De));for(let Re=1;Re<Z;++Re){ee=Math.max(1,F.x-Re),ce=Math.max(1,F.y-Re),oe=Math.min(U.x+Re,_-2),me=Math.min(U.y+Re,_-2);for(let $e=ce;$e<=me;++$e)for(let We=ee;We<=oe;++We){const tt=$e*_+We;if(Dg[tt]===255){let _t=0,nt=0,xt=-1,Mt=-1;for(let Pt=-1;Pt<=1;++Pt)for(let Gt=-1;Gt<=1;++Gt){const Wt=($e+Pt)*_+We+Gt;if(Dg[Wt]>=Re)continue;const Ut=Ww[Wt],$t=Math.abs(Ut);$t>nt&&(_t=Ut,nt=$t,xt=Gt,Mt=Pt)}if(nt>.1){const Pt=1-(Re+.5*Math.abs(xt*Mt))/Z;let Gt=n._dem.get(We,$e)+_t*Pt;const Wt=n._dem.get(We+xt,$e+Mt),Ut=n._dem.get(We-xt,$e-Mt,!0);(Gt-Wt)*(Gt-Ut)>0&&(Gt=(Wt+Ut)/2),Ww[tt]=n._dem.set(We,$e,Gt),Dg[tt]=Re}}}}}S&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Sa.now())}setFilter(e){this.filter=e?Vh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Fa(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)a0(n.node),yw(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped());for(const d of this.getNodesInfo()){const g=d.node.footprint;d.hiddenByReplacement=!!g&&!c.find((_=>_.footprint===g))}}getHeightAtTileCoord(e,n){const c=[],d=[0,0,0],g=re([]);for(const _ of this.getNodesInfo()){const S=_.node.meshes[0],M=S.transformedAabb;if(e<M.min[0]||n<M.min[1]||e>M.max[0]||n>M.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};fe(g,_.node.globalMatrix),d[0]=e,d[1]=n,Ii(d,d,g);const R=(d[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*Lg|0,N=Math.min(63,(d[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*Lg|0)*Lg+Math.min(63,R),F=S.heightmap[N];if(!(F<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:F,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Me(e,n),new Me(e,n),c),c.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function bv(r,e){return r instanceof vd&&!r.isLightConstant&&e}function UL(r,e,n,c,d,g,_,S){let M=(61440&e|(61440&e)>>4)>>8,R=(3840&e|(3840&e)>>4)>>4,N=240&e|(240&e)>>4;n[3]>0&&(M=Gi(M,255*n[0],n[3]),R=Gi(R,255*n[1],n[3]),N=Gi(N,255*n[2],n[3]));const F=M<<8|R,U=N<<8|Math.floor(255*c[3]),W=(function(Re){const $e=ne(Re,0,2);return Math.min(Math.round(.5*$e*255),255)})(c[2])<<8|15*c[0]<<4|15*c[1],Z=ne(d[0],0,1),ee=ne(d[1],0,1),ce=ne(d[2],0,1),oe=ne(d[3],0,1);let me,ve,Se,De;if(Z!==ee&&_!==g&&ee!==Z){const Re=_-g;ve=1/(Re*(ee-Z)),Se=-(g+Re*Z)/(Re*(ee-Z));const $e=ne(d[4],-1,1);De=Math.pow(10,$e),me=255*ce<<8|255*oe}else me=65535,ve=0,Se=1,De=1;if(r.emplaceBack(F,U,W,me,ve,Se,De),S){const Re=S.length;S.clear();for(let $e=0;$e<Re;$e++)S.emplaceBack(F,U,W,me,ve,Se,De)}}function $L(r,e,n){const c=r.node;let d=0;const g=n&D_.HasMeshoptCompression;for(const _ of c.meshes){if(c.lights&&c.lightMeshIndex===d||!_.featureData)continue;_.featureArray=new tm,_.featureArray.reserve(_.featureData.length);let S=e;for(const M of _.featureData){const R=g?65535&M:M>>16&65535,N=g?M>>16&65535:65535&M,F=(15&N)<8?15&N:0,U=r.evaluatedRMEA[F],W=r.evaluatedColor[F],Z=r.emissionHeightBasedParams[F];let ee;if(S&&F===2&&c.lights&&(ee=new tm,ee.resize(10*c.lights.length)),UL(_.featureArray,R,W,U,Z,_.aabb.min[2],_.aabb.max[2],ee),ee&&S){S=!1;const ce=c.meshes[c.lightMeshIndex];ce.featureArray=ee,ce.featureArray._trim()}}_.featureArray._trim(),d++}}vi(S0,"Tiled3dModelBucket",{omit:["layers"]}),vi(tk,"Tiled3dModelFeature");const VL=["id","tile","layer","source","sourceLayer","state"];class Og{constructor(e,n,c,d,g){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=c,this._y=d,this.properties=e?e.properties:{},this.id=g}clone(){const e=new Og(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of VL)this[n]!==void 0&&(e[n]=this[n]);return e}}class Ng extends _c{constructor(e,n,c,d){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=n,this._modelsInfo=new Map}load(){const e=[];for(const n in this._options.models){const c=this._options.models[n],d=this._modelsInfo.get(n);if(d){const g=d.model;g.position=c.position!=null?new o(c.position[0],c.position[1]):new o(0,0),g.orientation=c.orientation!=null?c.orientation:[0,0,0],d.modelSpec=c,Ng.applyModelSpecification(g,c),g.computeBoundsAndApplyParent(),this.models.push(g)}else{const g=w2(this.map._requestManager.transformRequest(c.uri,pc.Model).url).then((_=>{if(!_)return;const S=xw(_),M=new A2(n,c.uri,c.position,c.orientation,S);Ng.applyModelSpecification(M,c),M.computeBoundsAndApplyParent(),this.models.push(M),this._modelsInfo.set(n,{modelSpec:c,model:M})})).catch((_=>{this.fire(new Qu(new Error(`Could not load model ${n} from ${c.uri}: ${_.message}`)))}));e.push(g)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new wo("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((n=>{this._loaded=!0,this.fire(new Qu(new Error(`Could not load models: ${n.message}`)))}))}static applyModelSpecification(e,n){n.nodeOverrides&&Ng.convertNodeOverrides(e,n.nodeOverrides),n.materialOverrides&&Ng.convertMaterialOverrides(e,n.materialOverrides),n.nodeOverrideNames&&(e.nodeOverrideNames=[...n.nodeOverrideNames]),n.materialOverrideNames&&(e.materialOverrideNames=[...n.materialOverrideNames]),n.featureProperties&&(e.featureProperties=n.featureProperties)}static convertNodeOverrides(e,n){if(Array.isArray(n)&&n.every((c=>typeof c=="string"))){e.nodeOverrideNames=[];for(const c of n)e.nodeOverrideNames.push(c)}else Object.entries(n).forEach((([c,d])=>{const g={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){const _=d.orientation;_&&(g.orientation=_)}e.nodeOverrides.set(c,g)}))}static convertMaterialOverrides(e,n){if(Array.isArray(n)&&n.every((c=>typeof c=="string"))){e.materialOverrideNames=[];for(const c of n)e.materialOverrideNames.push(c)}else Object.entries(n).forEach((([c,d])=>{const g={color:new ma(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=d["model-color"];_!==void 0&&(g.color.r=_[0],g.color.g=_[1],g.color.b=_[2]);const S=d["model-color-mix-intensity"];S!==void 0&&(g.colorMix=S);const M=d["model-emissive-strength"];M!==void 0&&(g.emissionStrength=M);const R=d["model-opacity"];R!==void 0&&(g.opacity=R),e.materialOverrides.set(c,g)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,n){}serialize(){return this._options}setProperty(e,n){return!1}reload(){const e=ol(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const n=new Map;for(const c in e){const d=e[c];if(this._modelsInfo.has(c)){const g=this._modelsInfo.get(c);g&&g.modelSpec.uri===d.uri&&n.set(c,g)}}this._modelsInfo=n,this._options.models=e,this._loaded=!1,this.load()}}function Zw(r,e,n,c){const d=1<<r.z;e.lat=K((c/Jt+r.y)/d),e.lng=H((n/Jt+r.x)/d)}function HL(r,e,n,c){const d=r.getNodesInfo()[e];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let g=Number.MAX_VALUE;const _=d.node,S=n.tile,M=c.calculatePosMatrix(S.tileID.toUnwrapped(),c.worldSize),R=d.evaluatedScale;let N=0;c.elevation&&_.elevation&&(N=_.elevation*c.elevation.exaggeration()),be(M,M,[(_.anchor?_.anchor[0]:0)*(R[0]-1),(_.anchor?_.anchor[1]:0)*(R[1]-1),N]),Ne(M,M,R);const F=n.queryGeometry,U=F.isPointQuery()?F.screenBounds:F.screenGeometry,W=function(ee){const ce=xe([],M,ee.globalMatrix);xe(ce,c.expandedFarZProjMatrix,ce);for(let oe=0;oe<ee.meshes.length;++oe){const me=ee.meshes[oe];if(oe===ee.lightMeshIndex)continue;const ve=gw(U,c,ce,me.aabb);ve!=null&&(g=Math.min(ve,g))}if(ee.children)for(const oe of ee.children)W(oe)};if(W(_),g===Number.MAX_VALUE)return;const Z=new o(0,0);return Zw(S.tileID.canonical,Z,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:g,position:Z,feature:d.feature}}const GL={circle:class extends Eo{constructor(r,e,n,c){super(r,{layout:Vo||(Vo=new dr({"circle-sort-key":new li(rt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ei(rt.layout_circle["circle-elevation-reference"]),visibility:new ei(rt.layout_circle.visibility)})),paint:hr||(hr=new dr({"circle-radius":new li(rt.paint_circle["circle-radius"]),"circle-color":new li(rt.paint_circle["circle-color"]),"circle-blur":new li(rt.paint_circle["circle-blur"]),"circle-opacity":new li(rt.paint_circle["circle-opacity"]),"circle-translate":new ei(rt.paint_circle["circle-translate"]),"circle-translate-anchor":new ei(rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ei(rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ei(rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new li(rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new li(rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new li(rt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ei(rt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}createBucket(r){return new xa(r)}queryRadius(r){const e=r;return no("circle-radius",this,e)+no("circle-stroke-width",this,e)+Es(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,n,c,d,g,_,S){const M=Xl(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,r.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return _g(r,c,g,_,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",M,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,n){const c=__(this);return{config:new Yr(this,{zoom:e,lut:n}),defines:c,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Eo{createBucket(r){return new vg(r)}constructor(r,e,n,c){super(r,{layout:dm||(dm=new dr({visibility:new ei(rt.layout_heatmap.visibility)})),paint:Iy||(Iy=new dr({"heatmap-radius":new li(rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new li(rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ei(rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Sd(rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ei(rt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return no("heatmap-radius",this,r)}queryIntersectsFeature(r,e,n,c,d,g,_,S){const M=this.paint.get("heatmap-radius").evaluate(e,n);return _g(r,c,g,_,S,!0,!0,new Me(0,0),M)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,n){return r==="heatmap"?{config:new Yr(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Eo{constructor(r,e,n,c){super(r,{layout:Lx||(Lx=new dr({visibility:new ei(rt.layout_hillshade.visibility)})),paint:Ix||(Ix=new dr({"hillshade-illumination-direction":new ei(rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ei(rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ei(rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ei(rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ei(rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ei(rt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ei(rt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,n){return{overrideFog:!1}}},fill:class extends Eo{constructor(r,e,n,c){super(r,{layout:b_||(b_=new dr({"fill-sort-key":new li(rt.layout_fill["fill-sort-key"]),visibility:new ei(rt.layout_fill.visibility),"fill-elevation-reference":new ei(rt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new li(rt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:w_||(w_=new dr({"fill-antialias":new ei(rt.paint_fill["fill-antialias"]),"fill-opacity":new li(rt.paint_fill["fill-opacity"]),"fill-color":new li(rt.paint_fill["fill-color"]),"fill-outline-color":new li(rt.paint_fill["fill-outline-color"]),"fill-translate":new ei(rt.paint_fill["fill-translate"]),"fill-translate-anchor":new ei(rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new li(rt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ei(rt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ei(rt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new li(rt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new li(rt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new li(rt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(r,e,n){return{config:new Yr(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new yp(r)}queryRadius(){return Es(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,n,c,d,g){return!r.queryGeometry.isAboveHorizon&&na(Cl(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,r.pixelToTileUnitsFactor),c)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Eo{constructor(r,e,n,c){super(r,{layout:Te||(Te=new dr({visibility:new ei(rt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ei(rt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Ve||(Ve=new dr({"fill-extrusion-opacity":new ei(rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new li(rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ei(rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ei(rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new li(rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ei(rt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new li(rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new li(rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ei(rt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ei(rt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ei(rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ei(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ei(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ei(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ei(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ei(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ei(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ei(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new li(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new li(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ei(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ei(rt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ei(rt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ei(rt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new li(rt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new li(rt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ei(rt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Tp(r)}queryRadius(){return Es(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,n,c,d,g,_,S,M){const R=Xl(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,r.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(e,n),F=this.paint.get("fill-extrusion-base").evaluate(e,n),U=[0,0],W=S&&g.elevation,Z=g.elevation?g.elevation.exaggeration():1,ee=r.tile.getBucket(this);if(W&&ee instanceof Tp){const Se=ee.centroidVertexArray,De=M+1;De<Se.length&&(U[0]=Se.geta_centroid_pos0(De),U[1]=Se.geta_centroid_pos1(De))}if(U[0]===0&&U[1]===1)return!1;g.projection.name==="globe"&&(c=q([c],[new Me(0,0),new Me(Jt,Jt)],r.tileID.canonical).map((Se=>Se.polygon)).flat());const ce=W?S:null,[oe,me]=Et(g,c,F,N,R,_,ce,U,Z,g.center.lat,r.tileID.canonical),ve=r.queryGeometry;return Dt(oe,me,ve.isPointQuery()?ve.screenBounds:ve.screenGeometry)}},building:class extends Eo{constructor(r,e,n,c){super(r,{layout:I2||(I2=new dr({visibility:new ei(rt.layout_building.visibility),"building-facade":new li(rt.layout_building["building-facade"]),"building-facade-floors":new li(rt.layout_building["building-facade-floors"]),"building-facade-unit-width":new li(rt.layout_building["building-facade-unit-width"]),"building-facade-window":new li(rt.layout_building["building-facade-window"]),"building-roof-shape":new li(rt.layout_building["building-roof-shape"]),"building-height":new li(rt.layout_building["building-height"]),"building-base":new li(rt.layout_building["building-base"]),"building-flood-light-wall-radius":new li(rt.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new li(rt.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new li(rt.layout_building["building-flip-roof-orientation"])})),paint:z2||(z2=new dr({"building-opacity":new ei(rt.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new ei(rt.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new ei(rt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ei(rt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ei(rt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ei(rt.paint_building["building-vertical-scale"]),"building-cast-shadows":new ei(rt.paint_building["building-cast-shadows"]),"building-color":new li(rt.paint_building["building-color"]),"building-emissive-strength":new li(rt.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new ei(rt.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new ei(rt.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new ei(rt.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new ei(rt.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new ei(rt.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new L2(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,n,c,d,g,_,S,M){let R=this.layout.get("building-height").evaluate(e,n);const N=this.layout.get("building-base").evaluate(e,n),F=r.tile.getBucket(this).getFootprint(e);if(F){if(F.hiddenFlags!==0)return!1;R=F.height}const[U,W]=Et(g,c,N,R,new Me(0,0),_,null,[0,0],1,g.center.lat,r.tileID.canonical),Z=r.queryGeometry;return Dt(U,W,Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends Eo{constructor(r,e,n,c){const d=G2();super(r,d,e,n,c),d.layout&&(this.layout=new wd(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof nl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(sv)return sv;const n=G2();return sv=new FR(n.paint.properties["line-width"].specification),sv.useIntegerZoom=!0,sv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Sw(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,n){const c=V2(this);return{config:new Yr(this,{zoom:e,lut:n}),defines:c,overrideFog:!1}}queryRadius(r){const e=r,n=q2(no("line-width",this,e),no("line-gap-width",this,e)),c=no("line-offset",this,e);return n/2+Math.abs(c)+Es(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,n,c,d,g){if(r.queryGeometry.isAboveHorizon)return!1;const _=Cl(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,r.pixelToTileUnitsFactor),S=r.pixelToTileUnitsFactor/2*q2(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),M=this.paint.get("line-offset").evaluate(e,n);return M&&(c=(function(R,N){const F=[],U=new Me(0,0);for(let W=0;W<R.length;W++){const Z=R[W],ee=[];for(let ce=0;ce<Z.length;ce++){const oe=Z[ce],me=Z[ce+1],ve=ce===0?U:oe.sub(Z[ce-1])._unit()._perp(),Se=ce===Z.length-1?U:me.sub(oe)._unit()._perp(),De=ve._add(Se)._unit();De._mult(1/(De.x*Se.x+De.y*Se.y)),ee.push(De._mult(N)._add(oe))}F.push(ee)}return F})(c,M*r.pixelToTileUnitsFactor)),(function(R,N,F){for(let U=0;U<N.length;U++){const W=N[U];if(R.length>=3){for(let Z=0;Z<W.length;Z++)if(Ra(R,W[Z]))return!0}if(Ga(R,W,F))return!0}return!1})(_,c,S)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:v0,background:class extends Eo{constructor(r,e,n,c){super(r,{layout:IT||(IT=new dr({visibility:new ei(rt.layout_background.visibility)})),paint:zT||(zT=new dr({"background-pitch-alignment":new ei(rt.paint_background["background-pitch-alignment"]),"background-color":new ei(rt.paint_background["background-color"]),"background-pattern":new ei(rt.paint_background["background-pattern"]),"background-opacity":new ei(rt.paint_background["background-opacity"]),"background-emissive-strength":new ei(rt.paint_background["background-emissive-strength"]),"background-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,n){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:BT,"raster-particle":qT,sky:class extends Eo{constructor(r,e,n,c){super(r,{layout:VT||(VT=new dr({visibility:new ei(rt.layout_sky.visibility)})),paint:HT||(HT=new dr({"sky-type":new ei(rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new ei(rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ei(rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ei(rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ei(rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Sd(rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ei(rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ei(rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ei(rt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=xg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),d=!c,g=r.style.light,_=g.properties.get("position");return d&&g.properties.get("anchor")==="viewport"&&mi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?Hw(_.azimuthal,90-_.polar,e):Hw(c[0],90-c[1],e)}const n=this.paint.get("sky-gradient-center");return Hw(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Eo{constructor(r,e,n,c){super(r,{paint:GT||(GT=new dr({}))},e,null)}},model:class extends Eo{constructor(r,e,n,c){super(r,{layout:YT||(YT=new dr({visibility:new ei(rt.layout_model.visibility),"model-id":new li(rt.layout_model["model-id"])})),paint:KT||(KT=new dr({"model-opacity":new li(rt.paint_model["model-opacity"]),"model-rotation":new li(rt.paint_model["model-rotation"]),"model-scale":new li(rt.paint_model["model-scale"]),"model-translation":new li(rt.paint_model["model-translation"]),"model-color":new li(rt.paint_model["model-color"]),"model-color-mix-intensity":new li(rt.paint_model["model-color-mix-intensity"]),"model-type":new ei(rt.paint_model["model-type"]),"model-cast-shadows":new ei(rt.paint_model["model-cast-shadows"]),"model-receive-shadows":new ei(rt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ei(rt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new li(rt.paint_model["model-emissive-strength"]),"model-roughness":new li(rt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new li(rt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ei(rt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ei(rt.paint_model["model-front-cutoff"]),"model-elevation-reference":new ei(rt.paint_model["model-elevation-reference"]),"model-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new qw(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof S0?Jt-1:0}queryRenderedFeatures(r,e,n){const c=e.getSource();if(!(c&&c instanceof Ng))return{};const d=c,g={};g[this.id]=[];const _=g[this.id];let S=0;for(const M of d.models){const R=e.getFeatureState(this.sourceLayer,M.id),N={type:"Unknown",id:M.id,properties:M.featureProperties},F=this.paint.get("model-rotation").evaluate(N,R),U=this.paint.get("model-scale").evaluate(N,R),W=this.paint.get("model-translation").evaluate(N,R),Z=this.paint.get("model-elevation-reference");let ee=[];n0(ee,M,n,M.position,F,U,W,Z==="ground",Z==="ground",!1),n.projection.name==="globe"&&(ee=i0(ee,n));const ce=xe([],n.projMatrix,ee),oe=gw(r.isPointQuery()?r.screenBounds:r.screenGeometry,n,ce,M.aabb);if(oe!=null){const me=new Og(void 0,0,0,0,M.id);me.layer=this.layer,me.properties=structuredClone(M.featureProperties),me.properties.layer=this.id,me.properties.uri=M.uri,me.properties.orientation=M.orientation,me.sourceLayer=this.sourceLayer,me.geometry={type:"Point",coordinates:[M.position.lng,M.position.lat]},me.state=R,me.source=this.source,_.push({featureIndex:S,feature:me,intersectionZ:oe})}++S}return g}queryIntersectsFeature(r,e,n,c,d,g){if(!this.modelManager)return!1;const _=this.modelManager,S=r.tile.getBucket(this);if(!(S&&S instanceof qw))return!1;for(const M in S.instancesPerModel){const R=S.instancesPerModel[M],N=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty(N)){const F=R.features[R.idToFeaturesIndex[N]],U=_.getModel(M,this.scope);if(!U)return!1;let W=[];const Z=new o(0,0),ee=S.canonical;let ce=Number.MAX_VALUE;for(let oe=0;oe<F.instancedDataCount;++oe){const me=16*(F.instancedDataOffset+oe),ve=R.instancedDataArray.float32,Se=[ve[me+4],ve[me+5],ve[me+6]];Zw(ee,Z,Math.floor(ve[me]),Math.floor(ve[me+1])),n0(W,U,g,Z,F.rotation,F.scale,Se,!1,!1,!1),g.projection.name==="globe"&&(W=i0(W,g));const De=xe([],g.projMatrix,W),Re=r.queryGeometry,$e=gw(Re.isPointQuery()?Re.screenBounds:Re.screenGeometry,g,De,U.aabb);$e!=null&&(ce=Math.min($e,ce))}return ce!==Number.MAX_VALUE&&ce}}return!1}_handleOverridablePaintPropertyUpdate(r,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof xd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Eo{constructor(r,e,n,c){super(r,{layout:Eg||(Eg=new dr({"clip-layer-types":new ei(rt.layout_clip["clip-layer-types"]),"clip-layer-scope":new ei(rt.layout_clip["clip-layer-scope"])})),paint:qy||(qy=new dr({}))},e,n,c)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new Wy(r)}is3D(r){return!0}}},Xw=new ma(0,0,0),Yw={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Kw={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},T0={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},qL={PAINT_ORDER_FILL_AND_STROKE:1},wv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},ik={MASK_TYPE_LUMINANCE:1};function WL(r,e,n){r===1&&e.icons.push((function(c,d){return(function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:_}=g;if(_.content_area){const{content_area:S}=_;S.left==null&&(S.left=0),S.top==null&&(S.top=S.left),S.width==null&&(S.width=g.usvg_tree.width),S.height==null&&(S.height=S.width)}if(_.text_placeholder){const{text_placeholder:S}=_;S.top==null&&(S.top=S.left),S.height==null&&(S.height=S.width)}return _.stretch_x&&_.stretch_x.length&&nk(_,"x"),_.stretch_y&&_.stretch_y.length&&nk(_,"y"),g})(c.readFields(ZL,{name:void 0},d))})(n,n.readVarint()+n.pos))}function nk(r,e){const n=[],c=r[`stretch_${e}`];let d=null;for(let g=0;g<c.length;g++)d===null?d=n.length===0?c[0]:n[n.length-1][1]+c[g]:(n.push([d,d+c[g]]),d=null);r[`stretch_${e}_areas`]=n}function ZL(r,e,n){r===1?e.name=n.readString():r===2?e.metadata=(function(c,d){return c.readFields(XL,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)})(n,n.readVarint()+n.pos):r===3&&(e.usvg_tree=(function(c,d){return c.readFields(JL,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)})(n,n.readVarint()+n.pos),e.data="usvg_tree")}function XL(r,e,n){r===1?e.stretch_x=n.readPackedVarint():r===2?e.stretch_y=n.readPackedVarint():r===3?e.content_area=ak(n,n.readVarint()+n.pos):r===4?e.variables.push((function(c,d){return c.readFields(KL,{name:void 0},d)})(n,n.readVarint()+n.pos)):r===5&&(e.text_placeholder=ak(n,n.readVarint()+n.pos))}function ak(r,e){return r.readFields(YL,{},e)}function YL(r,e,n){r===1?e.left=n.readVarint():r===2?e.width=n.readVarint():r===3?e.top=n.readVarint():r===4&&(e.height=n.readVarint())}function KL(r,e,n){r===1?e.name=n.readString():r===2&&(e.rgb_color=A0(n.readVarint()),e.value="rgb_color")}function JL(r,e,n){r===1?e.width=e.height=n.readVarint():r===2?e.height=n.readVarint():r===3?e.children.push(k0(n,n.readVarint()+n.pos)):r===4?e.linear_gradients.push((function(c,d){return c.readFields(rI,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)})(n,n.readVarint()+n.pos)):r===5?e.radial_gradients.push((function(c,d){return c.readFields(oI,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)})(n,n.readVarint()+n.pos)):r===7?e.clip_paths.push((function(c,d){return c.readFields(lI,{children:[]},d)})(n,n.readVarint()+n.pos)):r===8&&e.masks.push((function(c,d){const g=c.readFields(cI,{left:0,width:20,mask_type:ik.MASK_TYPE_LUMINANCE,children:[]},d);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g})(n,n.readVarint()+n.pos))}function k0(r,e){return r.readFields(QL,{},e)}function QL(r,e,n){r===1?(e.group=(function(c,d){return c.readFields(eI,{opacity:255,children:[]},d)})(n,n.readVarint()+n.pos),e.node="group"):r===2&&(e.path=(function(c,d){return c.readFields(iI,{paint_order:1,commands:[],step:1,diffs:[],rule:Yw.PATH_RULE_NON_ZERO},d)})(n,n.readVarint()+n.pos),e.node="path")}function eI(r,e,n){r===1?e.transform=E0(n,n.readVarint()+n.pos):r===2?e.opacity=n.readVarint():r===5?e.clip_path_idx=n.readVarint():r===6?e.mask_idx=n.readVarint():r===7&&e.children.push(k0(n,n.readVarint()+n.pos))}function E0(r,e){return r.readFields(tI,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function tI(r,e,n){r===1?e.sx=n.readFloat():r===2?e.ky=n.readFloat():r===3?e.kx=n.readFloat():r===4?e.sy=n.readFloat():r===5?e.tx=n.readFloat():r===6&&(e.ty=n.readFloat())}function iI(r,e,n){r===1?e.fill=(function(c,d){return c.readFields(nI,{rgb_color:Xw,paint:"rgb_color",opacity:255},d)})(n,n.readVarint()+n.pos):r===2?e.stroke=(function(c,d){return c.readFields(aI,{rgb_color:Xw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)})(n,n.readVarint()+n.pos):r===3?e.paint_order=n.readVarint():r===5?n.readPackedVarint(e.commands):r===6?e.step=n.readFloat():r===7?n.readPackedSVarint(e.diffs):r===8&&(e.rule=n.readVarint())}function nI(r,e,n){r===1?(e.rgb_color=A0(n.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=n.readVarint())}function A0(r){return new ma((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function aI(r,e,n){r===1?(e.rgb_color=A0(n.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):r===5?n.readPackedFloat(e.dasharray):r===6?e.dashoffset=n.readFloat():r===7?e.miterlimit=n.readFloat():r===8?e.opacity=n.readVarint():r===9?e.width=n.readFloat():r===10?e.linecap=n.readVarint():r===11&&(e.linejoin=n.readVarint())}function rI(r,e,n){r===1?e.transform=E0(n,n.readVarint()+n.pos):r===2?e.spread_method=n.readVarint():r===3?e.stops.push(rk(n,n.readVarint()+n.pos)):r===4?e.x1=n.readFloat():r===5?e.y1=n.readFloat():r===6?e.x2=n.readFloat():r===7&&(e.y2=n.readFloat())}function rk(r,e){return r.readFields(sI,{offset:0,opacity:255,rgb_color:Xw},e)}function sI(r,e,n){r===1?e.offset=n.readFloat():r===2?e.opacity=n.readVarint():r===3&&(e.rgb_color=A0(n.readVarint()))}function oI(r,e,n){r===1?e.transform=E0(n,n.readVarint()+n.pos):r===2?e.spread_method=n.readVarint():r===3?e.stops.push(rk(n,n.readVarint()+n.pos)):r===4?e.cx=n.readFloat():r===5?e.cy=n.readFloat():r===6?e.r=n.readFloat():r===7?e.fx=n.readFloat():r===8?e.fy=n.readFloat():r===9&&(e.fr=n.readFloat())}function lI(r,e,n){r===1?e.transform=E0(n,n.readVarint()+n.pos):r===2?e.clip_path_idx=n.readVarint():r===3&&e.children.push(k0(n,n.readVarint()+n.pos))}function cI(r,e,n){r===1?e.left=e.top=n.readFloat():r===2?e.width=e.height=n.readFloat():r===3?e.top=n.readFloat():r===4?e.height=n.readFloat():r===5?e.mask_type=n.readVarint():r===6?e.mask_idx=n.readVarint():r===7&&e.children.push(k0(n,n.readVarint()+n.pos))}class uI{static calculate(e={},n=[]){const c=new Map,d=new Map;if(Object.keys(e).length===0)return c;n.forEach((g=>{d.set(g.name,g.rgb_color||new ma(0,0,0))}));for(const[g,_]of Object.entries(e))d.has(g)?c.set(d.get(g).toString(),_):console.warn(`Ignoring unknown image variable "${g}"`);return c}}function q_(r,e=255,n){const c=e/255,d=r.toString(),g=n.has(d)?n.get(d).clone():r.clone();return g.a*=c,g.toString()}function Sv(r,e){if(!os()){const n=document.createElement("canvas");return n.width=r,n.height=e,n}return new OffscreenCanvas(r,e)}let Jw,Tv=null;function Qw(r,e,n,c,d){for(const g of c.children)sk(r,e,n,g,d)}function sk(r,e,n,c,d){c.group?(r.save(),(function(g,_,S,M,R){const N=M.mask_idx!=null?S.masks[M.mask_idx]:null,F=M.clip_path_idx!=null?S.clip_paths[M.clip_path_idx]:null;if(M.transform&&(_=W_(M.transform).preMultiplySelf(_)),!(function(Z,ee,ce){return Z.opacity!==255||ee||ce})(M,F!=null,N!=null))return void Qw(g,_,S,M,R);const U=Sv(g.canvas.width,g.canvas.height),W=U.getContext("2d");Qw(W,_,S,M,R),F&&fk(W,_,S,F),N&&mk(W,_,S,N,R),g.globalAlpha=M.opacity/255,g.drawImage(U,0,0)})(r,e,n,c.group,d),r.restore()):c.path&&(r.save(),(function(g,_,S,M,R){g.setTransform(_),M.paint_order===qL.PAINT_ORDER_FILL_AND_STROKE?(ok(g,S,M,R),ck(g,S,M,R)):(ck(g,S,M,R),ok(g,S,M,R))})(r,e,n,c.path,d),r.restore())}function ok(r,e,n,c){const d=n.fill;if(!d)return;const g=d.opacity/255;switch(r.save(),r.beginPath(),pk(n,r),d.paint){case"rgb_color":r.fillStyle=q_(d.rgb_color,d.opacity,c);break;case"linear_gradient_idx":{const _=e.linear_gradients[d.linear_gradient_idx];_.transform&&r.setTransform(W_(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=uk(r,_,g,c);break}case"radial_gradient_idx":{const _=e.radial_gradients[d.radial_gradient_idx];_.transform&&r.setTransform(W_(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=dk(r,_,g,c)}}r.fill(lk(n)),r.restore()}function lk(r){return r.rule===Yw.PATH_RULE_NON_ZERO?"nonzero":r.rule===Yw.PATH_RULE_EVEN_ODD?"evenodd":void 0}function ck(r,e,n,c){const d=n.stroke;if(!d)return;const g=gk(n);r.lineWidth=d.width,r.miterLimit=d.miterlimit,r.setLineDash(d.dasharray),r.lineDashOffset=d.dashoffset;const _=d.opacity/255;switch(d.paint){case"rgb_color":r.strokeStyle=q_(d.rgb_color,d.opacity,c);break;case"linear_gradient_idx":r.strokeStyle=uk(r,e.linear_gradients[d.linear_gradient_idx],_,c,!0);break;case"radial_gradient_idx":r.strokeStyle=dk(r,e.radial_gradients[d.radial_gradient_idx],_,c,!0)}switch(d.linejoin){case T0.LINE_JOIN_MITER_CLIP:case T0.LINE_JOIN_MITER:r.lineJoin="miter";break;case T0.LINE_JOIN_ROUND:r.lineJoin="round";break;case T0.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(d.linecap){case Kw.LINE_CAP_BUTT:r.lineCap="butt";break;case Kw.LINE_CAP_ROUND:r.lineCap="round";break;case Kw.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(g)}function uk(r,e,n,c,d=!1){if(e.stops.length===1){const U=e.stops[0];return q_(U.rgb_color,U.opacity*n,c)}const{x1:g,y1:_,x2:S,y2:M}=e;let R=new DOMPoint(g,_),N=new DOMPoint(S,M);if(d){const U=W_(e.transform);R=U.transformPoint(R),N=U.transformPoint(N)}const F=r.createLinearGradient(R.x,R.y,N.x,N.y);for(const U of e.stops)F.addColorStop(U.offset,q_(U.rgb_color,U.opacity*n,c));return F}function dk(r,e,n,c,d=!1){if(e.stops.length===1){const oe=e.stops[0];return q_(oe.rgb_color,oe.opacity*n,c)}const g=W_(e.transform),{fx:_,fy:S,fr:M,cx:R,cy:N,r:F}=e;let U=new DOMPoint(_,S),W=new DOMPoint(R,N),Z=M,ee=F;if(d){U=g.transformPoint(U),W=g.transformPoint(W);const oe=(g.a+g.d)/2;Z=M*oe,ee=e.r*oe}const ce=r.createRadialGradient(U.x,U.y,Z,W.x,W.y,ee);for(const oe of e.stops)ce.addColorStop(oe.offset,q_(oe.rgb_color,oe.opacity*n,c));return ce}function hk(r,e,n,c){const d=c.transform?W_(c.transform).preMultiplySelf(e):e,g=Sv(r.canvas.width,r.canvas.height),_=g.getContext("2d");for(const M of c.children)if(M.group)hk(_,d,n,M.group);else if(M.path){const R=M.path,N=new Path2D;N.addPath(gk(R),d),_.fill(N,lk(R))}const S=c.clip_path_idx!=null?n.clip_paths[c.clip_path_idx]:null;S&&fk(_,d,n,S),r.globalCompositeOperation="source-over",r.drawImage(g,0,0)}function fk(r,e,n,c){const d=Sv(r.canvas.width,r.canvas.height);hk(d.getContext("2d"),e,n,c),r.globalCompositeOperation="destination-in",r.drawImage(d,0,0)}function mk(r,e,n,c,d){if(c.children.length===0)return;const g=c.mask_idx!=null?n.masks[c.mask_idx]:null;g&&mk(r,e,n,g,d);const _=r.canvas.width,S=r.canvas.height,M=Sv(_,S),R=M.getContext("2d"),N=c.width,F=c.height,U=c.left,W=c.top,Z=new Path2D,ee=new Path2D;ee.rect(U,W,N,F),Z.addPath(ee,e),R.clip(Z);for(const me of c.children)sk(R,e,n,me,d);const ce=R.getImageData(0,0,_,S),oe=ce.data;if(c.mask_type===ik.MASK_TYPE_LUMINANCE)for(let me=0;me<oe.length;me+=4)oe[me+3]=oe[me+3]/255*(.2126*oe[me]+.7152*oe[me+1]+.0722*oe[me+2]);R.putImageData(ce,0,0),r.globalCompositeOperation="destination-in",r.drawImage(M,0,0)}function W_(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function pk(r,e){const n=r.step;let c=r.diffs[0]*n,d=r.diffs[1]*n;e.moveTo(c,d);for(let g=0,_=2;g<r.commands.length;g++)switch(r.commands[g]){case wv.PATH_COMMAND_MOVE:c+=r.diffs[_++]*n,d+=r.diffs[_++]*n,e.moveTo(c,d);break;case wv.PATH_COMMAND_LINE:c+=r.diffs[_++]*n,d+=r.diffs[_++]*n,e.lineTo(c,d);break;case wv.PATH_COMMAND_QUAD:{const S=c+r.diffs[_++]*n,M=d+r.diffs[_++]*n;c=S+r.diffs[_++]*n,d=M+r.diffs[_++]*n,e.quadraticCurveTo(S,M,c,d);break}case wv.PATH_COMMAND_CUBIC:{const S=c+r.diffs[_++]*n,M=d+r.diffs[_++]*n,R=S+r.diffs[_++]*n,N=M+r.diffs[_++]*n;c=R+r.diffs[_++]*n,d=N+r.diffs[_++]*n,e.bezierCurveTo(S,M,R,N,c,d);break}case wv.PATH_COMMAND_CLOSE:e.closePath()}return e}function gk(r){return pk(r,new Path2D)}class C0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}vi(C0,"LRUCache");class e1{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Fs(e,e.data)}getFromCache(e,n,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new C0(150)),this.cacheMap.get(c).get(ol(e.toString(),n))}setInCache(e,n,c,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new C0(150));const g=this.cacheDependenciesMap.get(d),_=ol(e.id.toString(),c);g.get(_)||g.set(_,new Set);const S=this.cacheMap.get(d),M=e.toString();g.get(_).add(M),S.put(ol(e.toString(),c),n)}removeImagesFromCacheByIds(e,n,c=0){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const d=this.cacheMap.get(c),g=this.cacheDependenciesMap.get(c);for(const _ of e){const S=ol(_.toString(),n);if(g.has(S)){for(const M of g.get(S))d.delete(M);g.delete(S)}}}rasterize(e,n,c,d){const g=this.getFromCache(e,c,d);if(g)return g.clone();const _=(function(M,R){const N=uI.calculate(R.params,M.metadata?M.metadata.variables:[]),F=M.usvg_tree,U=F.width,W=F.height,Z=Math.max(1,Math.round(U*R.sx)),ee=Math.max(1,Math.round(W*R.sy)),ce=new DOMMatrix([Z/U,0,0,ee/W,0,0]);return Tv===null&&(Tv=Sv(10,10),Jw=Tv.getContext("2d",{willReadFrequently:!0})),Tv.width=Z,Tv.height=ee,Qw(Jw,ce,F,F,N),Jw.getImageData(0,0,Z,ee)})(n.icon,e),S=e1._getImage(_);return this.setInCache(e,S,c,d),S.clone()}}class _k{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const c=this.toIdx(e,n);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function yk(r,e,n,c){let d=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(n[_]<r[_]||n[_]>e[_])return null}else{const S=1/c[_];let M=(r[_]-n[_])*S,R=(e[_]-n[_])*S;if(M>R){const N=M;M=R,R=N}if(M>d&&(d=M),R<g&&(g=R),d>g)return null}return d}function vk(r,e,n,c,d,g,_,S,M,R,N){const F=c-r,U=d-e,W=g-n,Z=_-r,ee=S-e,ce=M-n,oe=N[1]*ce-N[2]*ee,me=N[2]*Z-N[0]*ce,ve=N[0]*ee-N[1]*Z,Se=F*oe+U*me+W*ve;if(Math.abs(Se)<1e-15)return null;const De=1/Se,Re=R[0]-r,$e=R[1]-e,We=R[2]-n,tt=(Re*oe+$e*me+We*ve)*De;if(tt<0||tt>1)return null;const _t=$e*W-We*U,nt=We*F-Re*W,xt=Re*U-$e*F,Mt=(N[0]*_t+N[1]*nt+N[2]*xt)*De;return Mt<0||tt+Mt>1?null:(Z*_t+ee*nt+ce*xt)*De}function xk(r,e,n){return(r-e)/(n-e)}function bk(r,e,n,c,d,g,_,S,M){const R=1<<n,N=g-c,F=_-d,U=(r+1)/R*N+c,W=(e+0)/R*F+d,Z=(e+1)/R*F+d;S[0]=(r+0)/R*N+c,S[1]=W,M[0]=U,M[1]=Z}class wk{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=(function(g){const _=Math.ceil(Math.log2(g.dim/8)),S=[];let M=Math.ceil(Math.pow(2,_));const R=1/M,N=(W,Z,ee,ce,oe)=>{const me=ce?1:0,ve=(W+1)*ee-me,Se=Z*ee,De=(Z+1)*ee-me;oe[0]=W*ee,oe[1]=Se,oe[2]=ve,oe[3]=De};let F=new _k(M);const U=[];for(let W=0;W<M*M;W++){N(W%M,Math.floor(W/M),R,!1,U);const Z=Mp(U[0],U[1],g),ee=Mp(U[2],U[1],g),ce=Mp(U[2],U[3],g),oe=Mp(U[0],U[3],g);F.minimums.push(Math.min(Z,ee,ce,oe)),F.maximums.push(Math.max(Z,ee,ce,oe)),F.leaves.push(1)}for(S.push(F),M/=2;M>=1;M/=2){const W=S[S.length-1];F=new _k(M);for(let Z=0;Z<M*M;Z++){N(Z%M,Math.floor(Z/M),2,!0,U);const ee=W.getElevation(U[0],U[1]),ce=W.getElevation(U[2],U[1]),oe=W.getElevation(U[2],U[3]),me=W.getElevation(U[0],U[3]),ve=W.isLeaf(U[0],U[1]),Se=W.isLeaf(U[2],U[1]),De=W.isLeaf(U[2],U[3]),Re=W.isLeaf(U[0],U[3]),$e=Math.min(ee.min,ce.min,oe.min,me.min),We=Math.max(ee.max,ce.max,oe.max,me.max),tt=ve&&Se&&De&&Re;F.maximums.push(We),F.minimums.push($e),F.leaves.push(We-$e<=5&&tt?1:0)}S.push(F)}return S})(this.dem),c=n.length-1,d=n[c];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(n,0,0,c,0)}raycastRoot(e,n,c,d,g,_,S=1){return yk([e,n,-100],[c,d,this.maximums[0]*S],g,_)}raycast(e,n,c,d,g,_,S=1){if(!this.nodeCount)return null;const M=this.raycastRoot(e,n,c,d,g,_,S);if(M==null)return null;const R=[],N=[],F=[],U=[],W=[{idx:0,t:M,nodex:0,nodey:0,depth:0}];for(;W.length>0;){const{idx:Z,t:ee,nodex:ce,nodey:oe,depth:me}=W.pop();if(this.leaves[Z]){bk(ce,oe,me,e,n,c,d,F,U);const Se=1<<me,De=(ce+0)/Se,Re=(ce+1)/Se,$e=(oe+0)/Se,We=(oe+1)/Se,tt=Mp(De,$e,this.dem)*S,_t=Mp(Re,$e,this.dem)*S,nt=Mp(Re,We,this.dem)*S,xt=Mp(De,We,this.dem)*S,Mt=vk(F[0],F[1],tt,U[0],F[1],_t,U[0],U[1],nt,g,_),Pt=vk(U[0],U[1],nt,F[0],U[1],xt,F[0],F[1],tt,g,_),Gt=Math.min(Mt!==null?Mt:Number.MAX_VALUE,Pt!==null?Pt:Number.MAX_VALUE);if(Gt!==Number.MAX_VALUE)return Gt;{const Wt=_i([],g,_,ee);if(Sk(tt,_t,xt,nt,xk(Wt[0],F[0],U[0]),xk(Wt[1],F[1],U[1]))>=Wt[2])return ee}continue}let ve=0;for(let Se=0;Se<this._siblingOffset.length;Se++){bk((ce<<1)+this._siblingOffset[Se][0],(oe<<1)+this._siblingOffset[Se][1],me+1,e,n,c,d,F,U),F[2]=-100,U[2]=this.maximums[this.childOffsets[Z]+Se]*S;const De=yk(F,U,g,_);if(De!=null){const Re=De;R[Se]=Re;let $e=!1;for(let We=0;We<ve&&!$e;We++)Re>=R[N[We]]&&(N.splice(We,0,Se),$e=!0);$e||(N[ve]=Se),ve++}}for(let Se=0;Se<ve;Se++){const De=N[Se];W.push({idx:this.childOffsets[Z]+De,t:R[De],nodex:(ce<<1)+this._siblingOffset[De][0],nodey:(oe<<1)+this._siblingOffset[De][1],depth:me+1})}}return null}_addNode(e,n,c){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,c,d,g){if(e[d].isLeaf(n,c)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=d-1,S=e[_];let M=0,R=0;for(let N=0;N<this._siblingOffset.length;N++){const F=2*n+this._siblingOffset[N][0],U=2*c+this._siblingOffset[N][1],W=S.getElevation(F,U),Z=S.isLeaf(F,U),ee=this._addNode(W.min,W.max,Z);Z&&(M|=1<<N),R||(R=ee)}for(let N=0;N<this._siblingOffset.length;N++)M&1<<N||this._construct(e,2*n+this._siblingOffset[N][0],2*c+this._siblingOffset[N][1],_,R+N)}}function Sk(r,e,n,c,d,g){return Gi(Gi(r,n,g),Gi(e,c,g),d)}function Mp(r,e,n){const c=n.dim,d=ne(r*c-.5,0,c-1),g=ne(e*c-.5,0,c-1),_=Math.floor(d),S=Math.floor(g),M=Math.min(_+1,c-1),R=Math.min(S+1,c-1);return Sk(n.get(_,S),n.get(M,S),n.get(_,R),n.get(M,R),d-_,g-S)}const dI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function hI(r,e,n){return(256*r*256+256*e+n)/10-1e4}function fI(r,e,n){return 256*r+e+n/256-32768}class M0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,c,d=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void mi(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const g=this.dim=n.height-2,_=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let M=0;M<g;M++)_[this._idx(-1,M)]=_[this._idx(0,M)],_[this._idx(g,M)]=_[this._idx(g-1,M)],_[this._idx(M,-1)]=_[this._idx(M,0)],_[this._idx(M,g)]=_[this._idx(M,g-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(g,-1)]=_[this._idx(g-1,0)],_[this._idx(-1,g)]=_[this._idx(0,g-1)],_[this._idx(g,g)]=_[this._idx(g-1,g-1)]}const S=c==="terrarium"?fI:hI;for(let M=0;M<_.length;++M){const R=4*M;this.floatView[M]=S(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=Sa.now()}_buildQuadTree(){this._tree=new wk(this)}get(e,n,c=!1){c&&(e=ne(e,-1,this.dim),n=ne(n,-1,this.dim));const d=this._idx(e,n);return this.floatView[d]}set(e,n,c){const d=this._idx(e,n),g=this.floatView[d];return this.floatView[d]=c,c-g}static getUnpackVector(e){return dI[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const c=[0,0,0,0],d=M0.getUnpackVector(n);let g=Math.floor((e+d[3])/d[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Ho({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=n*this.dim,g=n*this.dim+this.dim,_=c*this.dim,S=c*this.dim+this.dim;switch(n){case-1:d=g-1;break;case 1:g=d+1}switch(c){case-1:_=S-1;break;case 1:S=_+1}const M=-n*this.dim,R=-c*this.dim;for(let N=_;N<S;N++)for(let F=d;F<g;F++){const U=4*this._idx(F,N),W=4*this._idx(F+M,N+R);this.pixels[U+0]=e.pixels[W+0],this.pixels[U+1]=e.pixels[W+1],this.pixels[U+2]=e.pixels[W+2],this.pixels[U+3]=e.pixels[W+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function mI(r,e,n){r===1?e.headerLength=n.readFixed32():r===2?e.x=n.readVarint():r===3?e.y=n.readVarint():r===4?e.z=n.readVarint():r===5&&e.layers.push((function(c,d){return c.readFields(vI,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)})(n,n.readVarint()+n.pos))}function pI(r,e,n){r===1?(e.delta_filter=(function(c,d){return c.readFields(gI,{blockSize:0},d)})(n,n.readVarint()+n.pos),e.filter="delta_filter"):r===2?(n.readVarint(),e.filter="zigzag_filter"):r===3?(n.readVarint(),e.filter="bitshuffle_filter"):r===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function gI(r,e,n){r===1&&(e.blockSize=n.readVarint())}function _I(r,e,n){r===1?(n.readVarint(),e.codec="gzip_data"):r===2?(n.readVarint(),e.codec="jpeg_image"):r===3?(n.readVarint(),e.codec="webp_image"):r===4&&(n.readVarint(),e.codec="png_image")}function yI(r,e,n){let c=0,d=0;r===1?e.firstByte=n.readFixed64():r===2?e.lastByte=n.readFixed64():r===3?e.filters.push((function(g,_){return g.readFields(pI,{},_)})(n,n.readVarint()+n.pos)):r===4?e.codec=(function(g,_){return g.readFields(_I,{},_)})(n,n.readVarint()+n.pos):r===5?d=n.readFloat():r===6?c=n.readFloat():r===7?e.bands.push(n.readString()):r===8?e.offset=n.readDouble():r===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=d),e.scale===0&&(e.scale=c)}function vI(r,e,n){r===1?e.version=n.readVarint():r===2?e.name=n.readString():r===3?e.units=n.readString():r===4?e.tileSize=n.readVarint():r===5?e.buffer=n.readVarint():r===6?e.pixelFormat=n.readVarint():r===7&&e.dataIndex.push((function(c,d){return c.readFields(yI,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)})(n,n.readVarint()+n.pos))}function xI(r,e,n){if(r===2)(function(c,d,g){c.readFields(bI,g,d)})(n,n.readVarint()+n.pos,e);else if(r===3)throw new Error("Not implemented")}function bI(r,e,n){if(r===1){let c=0;const d=n.readVarint()+n.pos;for(;n.pos<d;)e[c++]=n.readVarint()}}function wI(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let c=2;c>=1;c--){const d=c===1?1:0,g=c===2?1:0;for(let _=0;_<e[0];_++){const S=e[1]*_;for(let M=d;M<e[1];M++){const R=e[2]*(M+S);for(let N=g;N<e[2];N++){const F=e[3]*(N+R);for(let U=0;U<e[3];U++){const W=F+U;r[W]+=r[W-n]}}}}n*=e[c]}return r}function SI(r){for(let e=0,n=r.length;e<n;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function TI(r,e){switch(e){case"uint32":return r;case"uint16":for(let n=0;n<r.length;n+=2){const c=r[n],d=r[n+1];r[n]=(240&c)>>4|(61440&c)>>8|(240&d)<<4|61440&d,r[n+1]=15&c|(3840&c)>>4|(15&d)<<8|(3840&d)<<4}return r;case"uint8":for(let n=0;n<r.length;n+=4){const c=r[n],d=r[n+1],g=r[n+2],_=r[n+3];r[n+0]=(192&c)>>6|(192&d)>>4|(192&g)>>2|192&_,r[n+1]=(48&c)>>4|(48&d)>>2|48&g|(48&_)<<2,r[n+2]=(12&c)>>2|12&d|(12&g)<<2|(12&_)<<4,r[n+3]=3&c|(3&d)<<2|(3&g)<<4|(3&_)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}vi(M0,"DEMData"),vi(wk,"DemMinMaxQuadTree",{omit:["dem"]});var qu=Uint8Array,kv=Uint16Array,kI=Int32Array,Tk=new qu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kk=new qu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),EI=new qu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ek=function(r,e){for(var n=new kv(31),c=0;c<31;++c)n[c]=e+=1<<r[c-1];var d=new kI(n[30]);for(c=1;c<30;++c)for(var g=n[c];g<n[c+1];++g)d[g]=g-n[c]<<5|c;return{b:n,r:d}},Ak=Ek(Tk,2),Ck=Ak.b,AI=Ak.r;Ck[28]=258,AI[258]=28;for(var CI=Ek(kk,0).b,Mk=new kv(32768),As=0;As<32768;++As){var Z_=(43690&As)>>1|(21845&As)<<1;Mk[As]=((65280&(Z_=(61680&(Z_=(52428&Z_)>>2|(13107&Z_)<<2))>>4|(3855&Z_)<<4))>>8|(255&Z_)<<8)>>1}var Ev=function(r,e,n){for(var c=r.length,d=0,g=new kv(e);d<c;++d)r[d]&&++g[r[d]-1];var _,S=new kv(e);for(d=1;d<e;++d)S[d]=S[d-1]+g[d-1]<<1;_=new kv(1<<e);var M=15-e;for(d=0;d<c;++d)if(r[d])for(var R=d<<4|r[d],N=e-r[d],F=S[r[d]-1]++<<N,U=F|(1<<N)-1;F<=U;++F)_[Mk[F]>>M]=R;return _},Av=new qu(288);for(As=0;As<144;++As)Av[As]=8;for(As=144;As<256;++As)Av[As]=9;for(As=256;As<280;++As)Av[As]=7;for(As=280;As<288;++As)Av[As]=8;var Pk=new qu(32);for(As=0;As<32;++As)Pk[As]=5;var MI=Ev(Av,9),PI=Ev(Pk,5),t1=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},_h=function(r,e,n){var c=e/8|0;return(r[c]|r[c+1]<<8)>>(7&e)&n},i1=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(7&e)},jI=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yh=function(r,e,n){var c=new Error(e||jI[r]);if(c.code=r,Error.captureStackTrace&&Error.captureStackTrace(c,yh),!n)throw c;return c},RI=new qu(0),LI=typeof TextDecoder<"u"&&new TextDecoder;try{LI.decode(RI,{stream:!0})}catch{}const II={gzip_data:"gzip"};class Ld extends Error{constructor(e){super(e),this.name="MRTError"}}const zI={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},jk={uint32:1,uint16:2,uint8:4},DI={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let n1;class P0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new Ld(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),c=new DataView(e);if(n[0]!==13)throw new Ld("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),c=this.getHeaderLength(e);if(n.length<c)throw new Ld(`Expected header with length >= ${c} but got buffer of length ${n.length}`);const d=new n1(n.subarray(0,c)).readFields(mI,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Ld(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const g of d.layers)this.layers[g.name]=new Rk(g,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],c=this.getLayer(e.layerName);for(let d of e.blockIndices){const g=c.dataIndex[d],_=g.firstByte-e.firstByte,S=g.lastByte-e.firstByte;if(c._blocksInProgress.has(d))continue;const M={layerName:c.name,firstByte:_,lastByte:S,pixelFormat:c.pixelFormat,blockIndex:d,blockShape:[g.bands.length].concat(c.bandShape),buffer:c.buffer,codec:g.codec.codec,filters:g.filters.map((R=>R.filter))};c._blocksInProgress.add(d),n.push(M)}return new Lk(n,(()=>{n.forEach((d=>c._blocksInProgress.delete(d.blockIndex)))}),((d,g)=>{if(n.forEach((_=>c._blocksInProgress.delete(_.blockIndex))),d)throw d;g.forEach((_=>{this.getLayer(_.layerName).processDecodedData(_)}))}))}}class Rk{constructor({version:e,name:n,units:c,tileSize:d,pixelFormat:g,buffer:_,dataIndex:S},M){if(this.version=e,this.version!==1)throw new Ld(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=c,this.tileSize=d,this.buffer=_,this.pixelFormat=zI[g],this.dataIndex=S,this.bandShape=[d+2*_,d+2*_,jk[this.pixelFormat]],this._decodedBlocks=new C0(M?M.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return jk[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[c,d]of this.dataIndex.entries()){for(const[g,_]of d.bands.entries())if(_===e)return{bandIndex:n+g,blockIndex:c,blockBandIndex:g};n+=d.bands.length}break;case"number":for(const[c,d]of this.dataIndex.entries()){if(e>=n&&e<n+d.bands.length)return{bandIndex:e,blockIndex:c,blockBandIndex:e-n};n+=d.bands.length}break;default:throw new Ld(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let n=1/0,c=-1/0;const d=[],g=new Set;for(const _ of e){const{blockIndex:S}=this.getBlockForBand(_);if(S<0)throw new Ld(`Invalid band: ${JSON.stringify(_)}`);const M=this.dataIndex[S];d.includes(S)||d.push(S),g.add(S),n=Math.min(n,M.firstByte),c=Math.max(c,M.lastByte)}if(g.size>this.cacheSize)throw new Ld(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:c,blockIndices:d}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:c}=this.getBlockForBand(e);if(n<0)throw new Ld(`Band not found: ${JSON.stringify(e)}`);const d=this._decodedBlocks.get(n.toString());if(!d)throw new Ld(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[n],_=this.bandShape.reduce(((R,N)=>R*N),1),S=c*_,M=d.subarray(S,S+_);return{data:M,bytes:new Uint8Array(M.buffer).subarray(M.byteOffset,M.byteOffset+M.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}P0.setPbf=function(r){n1=r};class Lk{constructor(e,n,c){this.tasks=e,this._onCancel=n,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}P0.performDecoding=function(r,e){const n=new Uint8Array(r);return Promise.all(e.tasks.map((c=>{const{layerName:d,firstByte:g,lastByte:_,pixelFormat:S,blockShape:M,blockIndex:R,filters:N,codec:F}=c,U=n.subarray(g,_+1),W=new Uint32Array(M[0]*M[1]*M[2]);let Z;if(F!=="gzip_data")throw new Ld(`Unhandled codec: ${F}`);return Z=(function(ee,ce){if(!globalThis.DecompressionStream&&ce==="gzip_data")return Promise.resolve(((Se=(function($e){$e[0]==31&&$e[1]==139&&$e[2]==8||yh(6,"invalid gzip data");var We=$e[3],tt=10;4&We&&(tt+=2+($e[10]|$e[11]<<8));for(var _t=(We>>3&1)+(We>>4&1);_t>0;_t-=!$e[tt++]);return tt+(2&We)})(ve=ee))+8>ve.length&&yh(6,"invalid gzip data"),(function($e,We,tt,_t){var nt=$e.length;if(!nt||We.f&&!We.l)return tt||new qu(0);var xt=!tt,Mt=xt||We.i!=2,Pt=We.i;xt&&(tt=new qu(3*nt));var Gt,Wt,Ut=function(Ia){var pa=tt.length;if(Ia>pa){var ba=new qu(Math.max(2*pa,Ia));ba.set(tt),tt=ba}},$t=We.f||0,vt=We.p||0,yt=We.b||0,Vt=We.l,si=We.d,Qt=We.m,Oi=We.n,pi=8*nt;do{if(!Vt){$t=_h($e,vt,1);var bi=_h($e,vt+1,3);if(vt+=3,!bi){var Mi=$e[(bt=4+((vt+7)/8|0))-4]|$e[bt-3]<<8,jn=bt+Mi;if(jn>nt){Pt&&yh(0);break}Mt&&Ut(yt+Mi),tt.set($e.subarray(bt,jn),yt),We.b=yt+=Mi,We.p=vt=8*jn,We.f=$t;continue}if(bi==1)Vt=MI,si=PI,Qt=9,Oi=5;else if(bi==2){var ni=_h($e,vt,31)+257,Li=_h($e,vt+10,15)+4,dn=ni+_h($e,vt+5,31)+1;vt+=14;for(var Wn=new qu(dn),Kn=new qu(19),wn=0;wn<Li;++wn)Kn[EI[wn]]=_h($e,vt+3*wn,7);vt+=3*Li;var La=t1(Kn),Le=(1<<La)-1,Oe=Ev(Kn,La);for(wn=0;wn<dn;){var bt,qt=Oe[_h($e,vt,Le)];if(vt+=15&qt,(bt=qt>>4)<16)Wn[wn++]=bt;else{var hi=0,fi=0;for(bt==16?(fi=3+_h($e,vt,3),vt+=2,hi=Wn[wn-1]):bt==17?(fi=3+_h($e,vt,7),vt+=3):bt==18&&(fi=11+_h($e,vt,127),vt+=7);fi--;)Wn[wn++]=hi}}var Ni=Wn.subarray(0,ni),Bi=Wn.subarray(ni);Qt=t1(Ni),Oi=t1(Bi),Vt=Ev(Ni,Qt),si=Ev(Bi,Oi)}else yh(1);if(vt>pi){Pt&&yh(0);break}}Mt&&Ut(yt+131072);for(var bn=(1<<Qt)-1,kn=(1<<Oi)-1,Cn=vt;;Cn=vt){var Vn=(hi=Vt[i1($e,vt)&bn])>>4;if((vt+=15&hi)>pi){Pt&&yh(0);break}if(hi||yh(2),Vn<256)tt[yt++]=Vn;else{if(Vn==256){Cn=vt,Vt=null;break}var Qi=Vn-254;Vn>264&&(Qi=_h($e,vt,(1<<(ha=Tk[wn=Vn-257]))-1)+Ck[wn],vt+=ha);var ln=si[i1($e,vt)&kn],aa=ln>>4;if(ln||yh(3),vt+=15&ln,Bi=CI[aa],aa>3){var ha=kk[aa];Bi+=i1($e,vt)&(1<<ha)-1,vt+=ha}if(vt>pi){Pt&&yh(0);break}Mt&&Ut(yt+131072);var fa=yt+Qi;if(yt<Bi){var Ta=0-Bi,$a=Math.min(Bi,fa);for(Ta+yt<0&&yh(3);yt<$a;++yt)tt[yt]=(void 0)[Ta+yt]}for(;yt<fa;++yt)tt[yt]=tt[yt-Bi]}}We.l=Vt,We.p=Cn,We.b=yt,We.f=$t,Vt&&($t=1,We.m=Qt,We.d=si,We.n=Oi)}while(!$t);return yt!=tt.length&&xt?(Gt=tt,((Wt=yt)==null||Wt>Gt.length)&&(Wt=Gt.length),new qu(Gt.subarray(0,Wt))):tt.subarray(0,yt)})(ve.subarray(Se,-8),{i:2},new qu(((oe=ve)[(me=oe.length)-4]|oe[me-3]<<8|oe[me-2]<<16|oe[me-1]<<24)>>>0))));var oe,me,ve,Se;const De=II[ce];if(!De)throw new Error(`Unhandled codec: ${ce}`);const Re=new globalThis.DecompressionStream(De);return new Response(new Blob([ee]).stream().pipeThrough(Re)).arrayBuffer().then(($e=>new Uint8Array($e)))})(U,F).then((ee=>((function(ce,oe){ce.readFields(xI,oe)})(new n1(ee),W),new DI[S](W.buffer)))),Z.then((ee=>{for(let ce=N.length-1;ce>=0;ce--)switch(N[ce]){case"delta_filter":wI(ee,M);break;case"zigzag_filter":SI(ee);break;case"bitshuffle_filter":TI(ee,S);break;default:throw new Ld(`Unhandled filter "${N[ce]}"`)}return{layerName:d,blockIndex:R,data:ee}})).catch((ee=>{throw ee}))})))},vi(Lk,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),vi(P0,"MapboxRasterTile"),vi(Rk,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Ik{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const c=e[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class zk{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Wr(Jt,16,0),this.featureIndexArray=new rm,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,c,d,g,_=0,S=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,g,_);const R=this.grid;for(let N=0;N<n.length;N++){const F=n[N],U=[1/0,1/0,-1/0,-1/0];for(let W=0;W<F.length;W++){const Z=F[W];U[0]=Math.min(U[0],Z.x),U[1]=Math.min(U[1],Z.y),U[2]=Math.max(U[2],Z.x),U[3]=Math.max(U[3],Z.y)}S!==0&&(U[0]-=S,U[1]-=S,U[2]+=S,U[3]+=S),U[0]<Jt&&U[1]<Jt&&U[2]>=0&&U[3]>=0&&R.insert(M,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ot(new s0(this.rawTileData)).layers,this.sourceLayerCoder=new Ik(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:c,transform:d,tileTransform:g,pixelPosMatrix:_,availableImages:S,worldview:M}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const R=n.queryRadius?n.queryRadius:0,N=c.bufferedTilespaceBounds,F=this.grid.query(N.min.x,N.min.y,N.max.x,N.max.y,((ee,ce,oe,me)=>Co(c.bufferedTilespaceGeometry,ee-R,ce-R,oe+R,me+R)));F.sort(OI);let U=null;d.elevation&&F.length>0&&(U=G_.create(d.elevation,this.tileID));const W={};let Z;for(let ee=0;ee<F.length;ee++){const ce=F[ee];if(ce===Z)continue;Z=ce;const oe=this.featureIndexArray.get(ce);let me=null;this.is3DTile?this.loadMatchingModelFeature(W,oe,e,c,d,M):this.loadMatchingFeature(W,oe,e,S,M,((ve,Se,De,Re=0)=>(me||(me=Ge(ve,this.tileID.canonical,g)),Se.queryIntersectsFeature(c,ve,De,me,this.z,d,_,U,Re))))}return W}loadMatchingFeature(e,n,c,d,g,_){const{featureIndex:S,bucketIndex:M,sourceLayerIndex:R,layoutVertexArrayOffset:N}=n,F=this.bucketLayerIDs[M],U=c.layers,W=Object.keys(U);if(W.length&&!ci(W,F))return;const Z=c.sourceCache,ee=this.sourceLayerCoder.decode(R),ce=this.vtLayers[ee].feature(S),oe=this.getId(ce,ee);for(let me=0;me<F.length;me++){const ve=F[me];if(!U[ve])continue;const{styleLayer:Se,targets:De}=U[ve];let Re={};oe!==void 0&&(Re=Z.getFeatureState(Se.sourceLayer,oe));const $e=!_||_(ce,Se,Re,N);if(!$e)continue;const We=new Og(ce,this.z,this.x,this.y,oe);We.tile=this.tileID.canonical,We.state=Re;let tt=this.serializedLayersCache.get(ve);tt||(tt=Se.serialize(),tt.id=ve,this.serializedLayersCache.set(ve,tt)),We.source=tt.source,We.sourceLayer=tt["source-layer"],We.layer=Object.assign({},tt),We.layer.paint=Dk(tt.paint,Se.paint,ce,Re,d),We.layer.layout=Dk(tt.layout,Se.layout,ce,Re,d);let _t=!1;for(const nt of De){this.updateFeatureProperties(We,nt);const{filter:xt}=nt;if(xt){if(ce.properties=We.properties,xt.needGeometry){const Mt=it(ce,!0);if(!xt.filter(new Fa(this.tileID.overscaledZ,{worldview:g}),Mt,this.tileID.canonical))continue}else if(!xt.filter(new Fa(this.tileID.overscaledZ,{worldview:g}),ce))continue}_t=!0,nt.targetId&&this.addFeatureVariant(We,nt)}_t&&this.appendToResult(e,ve,S,We,$e)}}loadMatchingModelFeature(e,n,c,d,g,_){const{featureIndex:S,bucketIndex:M}=n,R=this.bucketLayerIDs[M],N=c.layers,F=Object.keys(N);if(!F.length||ci(F,R))for(let U=0;U<R.length;U++){const W=R[U],{styleLayer:Z,targets:ee}=N[W];if(Z.type!=="model")continue;const ce=d.tile,oe=ce.getBucket(Z);if(!(oe&&oe instanceof S0))continue;const me=HL(oe,S,d,g);if(!me)continue;const{z:ve,x:Se,y:De}=ce.tileID.canonical,{feature:Re,intersectionZ:$e,position:We}=me;let tt={};Re.id!==void 0&&(tt=c.sourceCache.getFeatureState(Z.sourceLayer,Re.id));const _t=new Og({},ve,Se,De,Re.id);_t.tile=this.tileID.canonical,_t.state=tt,_t.properties=Re.properties,_t.geometry={type:"Point",coordinates:[We.lng,We.lat]};let nt=this.serializedLayersCache.get(W);nt||(nt=Z.serialize(),nt.id=W,this.serializedLayersCache.set(W,nt)),_t.source=nt.source,_t.sourceLayer=nt["source-layer"],_t.layer=Object.assign({},nt);let xt=!1;for(const Mt of ee){this.updateFeatureProperties(_t,Mt);const{filter:Pt}=Mt;if(Pt){if(Re.properties=_t.properties,Pt.needGeometry){if(!Pt.filter(new Fa(this.tileID.overscaledZ,{worldview:_}),Re,this.tileID.canonical))continue}else if(!Pt.filter(new Fa(this.tileID.overscaledZ,{worldview:_}),Re))continue}xt=!0,Mt.targetId&&this.addFeatureVariant(_t,Mt)}xt&&this.appendToResult(e,W,S,_t,$e)}}updateFeatureProperties(e,n,c){if(n.properties){const d={};for(const g in n.properties){const _=n.properties[g].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,c);_!=null&&(d[g]=_)}e.properties=d}}addFeatureVariant(e,n,c){const d={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(d.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(d)}appendToResult(e,n,c,d,g){let _=e[n];_===void 0&&(_=e[n]=[]),_.push({featureIndex:c,feature:d,intersectionZ:g})}lookupSymbolFeatures(e,n,c,d,g,_){const S={};this.loadVTLayers();for(const M of e)this.loadMatchingFeature(S,{bucketIndex:n,sourceLayerIndex:c,featureIndex:M,layoutVertexArrayOffset:0},d,g,_);return S}loadFeature(e){const{featureIndex:n,sourceLayerIndex:c}=e;this.loadVTLayers();const d=this.sourceLayerCoder.decode(c),g=this.vtFeatures[d];if(g[n])return g[n];const _=this.vtLayers[d].feature(n);return g[n]=_,_}hasLayer(e){for(const n of this.bucketLayerIDs)for(const c of n)if(e===c)return!0;return!1}getId(e,n){let c=e.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const g=lu(d);if(g.result!=="success"){const _=g.value.map((S=>`${S.key}: ${S.message}`)).join(", ");return void mi(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=g.value}c=this.promoteIdExpression.evaluate({zoom:0},e)}else c=e.properties[d];typeof c=="boolean"&&(c=Number(c))}return c}}function Dk(r,e,n,c,d){return ct(r,((g,_)=>{const S=e instanceof wd?e.get(_):null;return S&&S.evaluate?S.evaluate(n,c,void 0,d):S}))}function OI(r,e){return e-r}vi(zk,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Ok=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class a1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,c]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=c>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=Ok[15&c];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[S]=new Uint32Array(e,4,1);return new a1(S,_,g,e)}constructor(e,n=64,c=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=Ok.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,S=e*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-S%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${c}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+S+M,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+S+M),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+S+M,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=n,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return r1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:S}=this,M=[0,g.length-1,0],R=[];for(;M.length;){const N=M.pop()||0,F=M.pop()||0,U=M.pop()||0;if(F-U<=S){for(let ce=U;ce<=F;ce++){const oe=_[2*ce],me=_[2*ce+1];oe>=e&&oe<=c&&me>=n&&me<=d&&R.push(g[ce])}continue}const W=U+F>>1,Z=_[2*W],ee=_[2*W+1];Z>=e&&Z<=c&&ee>=n&&ee<=d&&R.push(g[W]),(N===0?e<=Z:n<=ee)&&(M.push(U),M.push(W-1),M.push(1-N)),(N===0?c>=Z:d>=ee)&&(M.push(W+1),M.push(F),M.push(1-N))}return R}within(e,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:_}=this,S=[0,d.length-1,0],M=[],R=c*c;for(;S.length;){const N=S.pop()||0,F=S.pop()||0,U=S.pop()||0;if(F-U<=_){for(let ce=U;ce<=F;ce++)Fk(g[2*ce],g[2*ce+1],e,n)<=R&&M.push(d[ce]);continue}const W=U+F>>1,Z=g[2*W],ee=g[2*W+1];Fk(Z,ee,e,n)<=R&&M.push(d[W]),(N===0?e-c<=Z:n-c<=ee)&&(S.push(U),S.push(W-1),S.push(1-N)),(N===0?e+c>=Z:n+c>=ee)&&(S.push(W+1),S.push(F),S.push(1-N))}return M}}function r1(r,e,n,c,d,g){if(d-c<=n)return;const _=c+d>>1;Nk(r,e,_,c,d,g),r1(r,e,n,c,_-1,1-g),r1(r,e,n,_+1,d,1-g)}function Nk(r,e,n,c,d,g){for(;d>c;){if(d-c>600){const R=d-c+1,N=n-c+1,F=Math.log(R),U=.5*Math.exp(2*F/3),W=.5*Math.sqrt(F*U*(R-U)/R)*(N-R/2<0?-1:1);Nk(r,e,n,Math.max(c,Math.floor(n-N*U/R+W)),Math.min(d,Math.floor(n+(R-N)*U/R+W)),g)}const _=e[2*n+g];let S=c,M=d;for(Cv(r,e,c,n),e[2*d+g]>_&&Cv(r,e,c,d);S<M;){for(Cv(r,e,S,M),S++,M--;e[2*S+g]<_;)S++;for(;e[2*M+g]>_;)M--}e[2*c+g]===_?Cv(r,e,c,M):(M++,Cv(r,e,M,d)),M<=n&&(c=M+1),n<=M&&(d=M-1)}}function Cv(r,e,n,c){s1(r,n,c),s1(e,2*n,2*c),s1(e,2*n+1,2*c+1)}function s1(r,e,n){const c=r[e];r[e]=r[n],r[n]=c}function Fk(r,e,n,c){const d=r-n,g=e-c;return d*d+g*g}i.$=ad,i.A=rc,i.B=ol,i.C=2,i.D=or,i.E=_c,i.F=cv,i.G=dT,i.H=_l,i.I=Rs,i.J=Xm,i.K=ji,i.L=Mu,i.M=ja,i.N=Jd,i.O=Fu,i.P=Me,i.Q=qr,i.R=pc,i.S=Gf,i.T=mw,i.U=lu,i.V=w0,i.W=Vm,i.X=to,i.Y=Cr,i.Z=fs,i._=Tr,i.a=function(r){return An.API_CDN_URL_REGEX.test(r)},i.a$=K,i.a0=Ji,i.a1=Oo,i.a2=Mc,i.a3=class extends w0{},i.a4=xr,i.a5=Bm,i.a6=rt,i.a7=function(r){const e=r.value;return e?Ji(e)?Gw(e,!0)?[]:[new w0(r.key,e,`invalid url "${e}"`)]:[new w0(r.key,e,`string expected, "${ji(e)}" found`)]:[]},i.a8=ih,i.a9=dr,i.aA=ne,i.aB=xe,i.aC=Hr,i.aD=io,i.aE=Ra,i.aF=j,i.aG=ye,i.aH=function(r,e){const n={};for(let c=0;c<e.length;c++){const d=e[c];d in r&&(n[d]=r[d])}return n},i.aI=p,i.aJ=O,i.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,n,c){const d=this.entries[r]=this.entries[r]||{callbacks:[]};if(d.result){const[g,_]=d.result;return this.scheduler?this.scheduler.add((()=>{c(g,_)}),e):c(g,_),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=n(((g,_)=>{d.result=[g,_];for(const S of d.callbacks)this.scheduler?this.scheduler.add((()=>{S(g,_)}),e):S(g,_);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{d.result||(d.callbacks=d.callbacks.filter((g=>g!==c)),d.callbacks.length||(d.cancel(),delete this.entries[r]))}}},i.aL=function(r,e,n){const c=JSON.stringify(r.request);return r.data&&(this.deduped.entries[c]={result:[null,r.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},(d=>{const g=zo(r.request,((_,S,M)=>{_?d(_):S&&d(null,{rawData:S,vectorTile:n?void 0:new ot(new s0(S)),responseHeaders:new Map(M.entries())})}));return()=>{g.cancel(),d()}}),e)},i.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=hs,i.aO=function(r){Xs++,Xs>fc&&(r.getActor().send("enforceCacheSizeLimit",Eu),Xs=0)},i.aP=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},i.aQ=Fn,i.aR=BT,i.aS=qT,i.aT=o,i.aU=FT,i.aV=function(r,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let c=0;c<r.length;c++){const d=document.createElement("source");Ku(r[c])||(n.crossOrigin="Anonymous"),d.src=r[c],n.appendChild(d)}return{cancel:()=>{}}},i.aW=av,i.aX=Ng,i.aY=Je,i.aZ=fv,i.a_=H,i.aa=ei,i.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Xi(r.expression.evaluate(e))}interpolate(r,e,n){return{x:Gi(r.x,e.x,n),y:Gi(r.y,e.y,n),z:Gi(r.z,e.z,n),azimuthal:Gi(r.azimuthal,e.azimuthal,n),polar:Gi(r.polar,e.polar,n)}}},i.ac=Fa,i.ad=xd,i.ae=_e,i.af=Ii,i.ag=Pi,i.ah=ue,i.ai=wd,i.aj=jd,i.ak=Gi,i.al=Jt,i.am=Ch,i.an=ui,i.ao=ma,i.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return(function([n,c]){const d=Xi([1,n,c]);return{x:d.x,y:d.y,z:d.z}})(r.expression.evaluate(e))}interpolate(r,e,n){return{x:Gi(r.x,e.x,n),y:Gi(r.y,e.y,n),z:Gi(r.z,e.z,n)}}},i.aq=function(r,e,n=0,c=!0){const d=new Me(n,n),g=r.sub(d),_=e.add(d),S=[g,new Me(_.x,g.y),_,new Me(g.x,_.y)];return c&&S.push(g.clone()),S},i.ar=function(r,e){const n=[];for(let c=0;c<r.length;c++){const d=ke(c-1,-1,r.length-1),g=ke(c+1,-1,r.length-1),_=r[c],S=r[g],M=r[d].sub(_).unit(),R=S.sub(_).unit(),N=R.angleWithSep(M.x,M.y),F=M.add(R).unit().mult(-1*e/Math.sin(N/2));n.push(_.add(F))}return n},i.as=TT,i.at=Co,i.au=function(r,e,n=0){return qe(((e.x-n)*r.scale-r.x)*Jt,(e.y*r.scale-r.y)*Jt,Y(e.z,e.y))},i.av=Da,i.aw=pn,i.ax=wi,i.ay=F2,i.az=function(r){let e=1/0,n=1/0,c=-1/0,d=-1/0;for(const g of r)e=Math.min(e,g.x),n=Math.min(n,g.y),c=Math.max(c,g.x),d=Math.max(d,g.y);return{min:new Me(e,n),max:new Me(c,d)}},i.b=function(r){return An.API_FONTS_REGEX.test(r)},i.b$=A_,i.b0=Zr,i.b1=ah,i.b2=Ze,i.b3=ap,i.b4=y0,i.b5=function(){du.isLoading()||du.isLoaded()||$h()!=="deferred"||ng()},i.b6=Vh,i.b7=it,i.b8=Og,i.b9=Gn,i.bA=re,i.bB=et,i.bC=te,i.bD=function(r,e){const{x:n,y:c}=r.point,d=g_(n,c,r.worldSize/r._pixelsPerMercatorPixel,0,0);return xe(d,d,m_(Mo(e)))},i.bE=D,i.bF=cn,i.bG=At,i.bH=_i,i.bI=Un,i.bJ=sn,i.bK=B_,i.bL=Bc,i.bM=Rw,i.bN=function(r,e,n,c,d){const g=5*e+2;r.float32[g+0]=n,r.float32[g+1]=c,r.float32[g+2]=d},i.bO=H_,i.bP=Ir,i.bQ=Jo,i.bR=Ss,i.bS=ic,i.bT=ke,i.bU=function(r,e,n,c){var d=new P(4);return d[0]=r,d[1]=e,d[2]=n,d[3]=c,d},i.bV=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const n=e.getSource().maxzoom,c=1<<n,d=Math.floor(r.x),g=Math.floor((r.x-d)*c),_=Math.floor(r.y*c),S=this.findDEMTileFor(new Fn(n,d,n,g,_));return!(!S||!S.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const c=this._source();if(!c||r.y<0||r.y>1)return e;const d=c.getSource().maxzoom,g=1<<d,_=Math.floor(r.x),S=r.x-_,M=new Fn(d,_,d,Math.floor(S*g),Math.floor(r.y*g)),R=this.findDEMTileFor(M);if(!R||!R.dem)return e;const N=R.dem,F=1<<R.tileID.canonical.z,U=(S*F-R.tileID.canonical.x)*N.dim,W=(r.y*F-R.tileID.canonical.y)*N.dim,Z=Math.floor(U),ee=Math.floor(W);return(n?this.exaggeration():1)*Gi(Gi(N.get(Z,ee),N.get(Z,ee+1),W-ee),Gi(N.get(Z+1,ee),N.get(Z+1,ee+1),W-ee),U-Z)}static getAtTileOffset(r,e,n,c){const d=1<<r.canonical.z;return c?c.pointElevation(e):n?n.getAtPointOrZero(new _e(r.wrap+(r.canonical.x+e.x/Jt)/d,(r.canonical.y+e.y/Jt)/d)):0}static getAtTileOffsetFunc(r,e,n,c){return(d,g,_)=>{const S=this.getAtTileOffset(r,d,g,_),M=c.upVector(r.canonical,d.x,d.y);return Ft(M,M,S*c.upVectorScale(r.canonical,e,n).metersToTile),M}}getForTilePoints(r,e,n,c){if(this.isUsingMockSource())return!1;const d=G_.create(this,r,c);return!!d&&(e.forEach((g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],n)})),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const n=e.dem.tree,c=e.tileID,d=1<<r.canonical.z-c.canonical.z;let g=r.canonical.x/d-c.canonical.x,_=r.canonical.y/d-c.canonical.y,S=0;for(let M=0;M<r.canonical.z-c.canonical.z&&!n.leaves[S];M++){g*=2,_*=2;const R=2*Math.floor(_)+Math.floor(g);S=n.childOffsets[S]+R,g%=1,_%=1}return{min:this.exaggeration()*n.minimums[S],max:this.exaggeration()*n.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,n=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const d of r){const g=this.getMinMaxForTile(d.tileID);g&&(n=Math.min(n,g.min),c=Math.max(c,g.max),e=!0)}return e?{min:n,max:c}:null}},i.bW=ri,i.bX=Nn,i.bY=Bs,i.bZ=Xy,i.b_=WT,i.ba=Sw,i.bb=yp,i.bc=Ge,i.bd=Pc,i.be=$u,i.bf=rf,i.bg=ir,i.bh=hm,i.bi=Vw,i.bj=function(r,e){const n=jd(e.zoom);if(n===0)return Mo(r);const c=pg(r),d=f_(c),g=j(c.getWest())*e.worldSize,_=j(c.getEast())*e.worldSize,S=O(c.getNorth())*e.worldSize,M=O(c.getSouth())*e.worldSize,R=[g,S,0],N=[_,S,0],F=[g,M,0],U=[_,M,0],W=fe([],e.globeMatrix);return Ii(R,R,W),Ii(N,N,W),Ii(F,F,W),Ii(U,U,W),d[0]=mo(d[0],F,n),d[1]=mo(d[1],U,n),d[2]=mo(d[2],N,n),d[3]=mo(d[3],R,n),Si.fromPoints(d)},i.bk=fp,i.bl=fe,i.bm=hp,i.bn=mo,i.bo=nh,i.bp=um,i.bq=at,i.br=be,i.bs=P0,i.bt=s0,i.bu=zo,i.bv=function(r,e){const n=[];for(const c in r)c in e||n.push(c);return n},i.bw=Fe,i.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.by=Rt,i.bz=le,i.c=Dn,i.c$=function(r,e,n){let c=0;for(let d=0;d<2;++d)r[d]>0&&(c+=(r[d]-0)*(r[d]-0)),e[d]<0&&(c+=(0-e[d])*(0-e[d]));return c},i.c0=C_,i.c1=Mw,i.c2=yT,i.c3=Ow,i.c4=a1,i.c5=Ft,i.c6=Xo,i.c7=Jr,i.c8=function(r,e,n){n*=.5;var c=e[0],d=e[1],g=e[2],_=e[3],S=Math.sin(n),M=Math.cos(n);return r[0]=c*M+d*S,r[1]=d*M-c*S,r[2]=g*M+_*S,r[3]=_*M-g*S,r},i.c9=er,i.cA=jt,i.cB=ea,i.cC=T2,i.cD=Ca,i.cE=Cx,i.cF=function(r,e,n,c,d,g,_,S,M){if(M.name==="globe")return Cx(r,e,new Ca(n,c,d),!1);const R=fv({z:n,x:c,y:d},M);return new Si([(g+R.x/R.scale)*e,e*(R.y/R.scale),_],[(g+R.x2/R.scale)*e,e*(R.y2/R.scale),S])},i.cG=function(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r[3]=Math.min(e[3],n[3]),r},i.cH=function(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r[3]=Math.max(e[3],n[3]),r},i.cI=function(r){const e=Math.round((r+45+360)%360/90)%4;return Ti[e]},i.cJ=J,i.cK=ws,i.cL=up,i.cM=function(r){const e=re(new Float64Array(16));xe(e,r.pixelMatrix,r.globeMatrix);const n=[0,Wl,0],c=[0,ns,0];return Ii(n,n,e),Ii(c,c,e),[n[0]>0&&n[0]<=r.width&&n[1]>0&&n[1]<=r.height&&!Py(r,new o(r.center.lat,90)),c[0]>0&&c[0]<=r.width&&c[1]>0&&c[1]<=r.height&&!Py(r,new o(r.center.lat,-90))]},i.cN=function(r,e){const{scale:n}=r.tileTransform,c=n*Jt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return(function(d,g,_){var S=g[1],M=g[2],R=g[3],N=_[0],F=_[1];return d[0]=g[0]*N,d[1]=S*N,d[2]=M*F,d[3]=R*F,d})(new Float32Array(4),e.inverseAdjustmentMatrix,[c,c])},i.cO=e0,i.cP=Zt,i.cQ=S2,i.cR=function(r){const e=S2(r,!0);return D([],[e[0],e[1],e[4],e[5]])},i.cS=Ne,i.cT=di,i.cU=Be,i.cV=function(r){const{x:e,y:n}=r.point,{lng:c,lat:d}=r._center;return g_(e,n,r.worldSize,c,d)},i.cW=Qe,i.cX=Wi,i.cY=nr,i.cZ=Ns,i.c_=Gl,i.ca=Ea,i.cb=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},i.cc=pt,i.cd=function(r,e,n,c,d){var g=1/Math.tan(e/2);if(r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,d!=null&&d!==1/0){var _=1/(c-d);r[10]=(d+c)*_,r[14]=2*d*c*_}else r[10]=-1,r[14]=-2*c;return r},i.ce=function(r,e,n,c,d,g,_){var S=1/(e-n),M=1/(c-d),R=1/(g-_);return r[0]=-2*S,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*M,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*R,r[11]=0,r[12]=(e+n)*S,r[13]=(d+c)*M,r[14]=(_+g)*R,r[15]=1,r},i.cf=B,i.cg=function(r,e,n){r[4*e+0]=n[0],r[4*e+1]=n[1],r[4*e+2]=n[2],r[4*e+3]=n[3]},i.ch=om,i.ci=Jh,i.cj=Mr,i.ck=Ao,i.cl=Qh,i.cm=MT,i.cn=function(){var r=new P(4);return P!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},i.co=function(r,e,n){var c=e[0],d=e[1],g=e[2],_=e[3],S=Math.sin(n),M=Math.cos(n);return r[0]=c*M+g*S,r[1]=d*M+_*S,r[2]=c*-S+g*M,r[3]=d*-S+_*M,r},i.cp=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},i.cq=Tn,i.cr=function(r){var e=r[0],n=r[1],c=r[2],d=r[3];return Math.sqrt(e*e+n*n+c*c+d*d)},i.cs=qs,i.ct=mn,i.cu=Pr,i.cv=3,i.cw=2,i.cx=7,i.cy=6,i.cz=Ui,i.d=function(r){return An.API_TILEJSON_REGEX.test(r)},i.d$=class{constructor(r,e,n,c){this.context=r,this.format=c,this.size=n,this.texture=r.gl.createTexture();const[d,g,_]=this.size,{gl:S}=r;S.bindTexture(S.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&S.texImage3D(S.TEXTURE_3D,0,this.format,d,g,_,0,hw(this.format),fw(this.format),e.data)}bind(r,e){const{context:n}=this,{gl:c}=n;c.bindTexture(c.TEXTURE_3D,this.texture),r!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,r),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,e),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},i.d0=function(r){return r*r*r*r*r},i.d1=E,i.d2=45,i.d3=lm,i.d4=function(r,e,n){const c=Math.sqrt(r*r+e*e+n*n),d=c>0?Math.acos(n/c)*Ai:0;let g=r!==0||e!==0?Math.atan2(-e,-r)*Ai+90:0;return g<0&&(g+=360),[c,g,d]},i.d5=qe,i.d6=Xi,i.d7=de,i.d8=Ct,i.d9=Si,i.dA=function(r){return r({pluginStatus:ko,pluginURL:uu}),$f.on("pluginStateChange",r),r},i.dB=Gu,i.dC=class extends Hu{constructor(r){super(r),this.current=ef}set(r,e,n){if(this.fetchUniformLocation(r,e)){for(let c=0;c<9;c++)if(n[c]!==this.current[c]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},i.dD=vn,i.dE=function(r,e,n){const c=jd(n.zoom),d=r.style.map._antialias,g=r.terrain&&r.terrain.exaggeration()>0;return c===0&&!d&&!g},i.dF=function(r){const e=r.pixelsPerMeter,n=e/B(1,r.center.lat),c=re(new Float64Array(16));return be(c,c,[r.point.x,r.point.y,0]),Ne(c,c,[n,n,e]),Float32Array.from(c)},i.dG=pg,i.dH=function(r){const e=J-5;r=ne(r,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(ui(r))),3);return Math.round(n*(ql.length-1))},i.dI=function(r,e,n,c){const d=e.getNorth(),g=e.getSouth(),_=e.getWest(),S=e.getEast(),M=1<<r.z,R=S-_,N=d-g,F=R/fo,U=-N/ql[n],W=[0,F,0,U,0,0,d,_,0];if(r.z>0){const Z=180/c;X(W,W,[Z/R+1,0,0,0,Z/N+1,0,-.5*Z/F,.5*Z/U,1])}return W[2]=M,W[5]=r.x,W[8]=r.y,W},i.dJ=Mo,i.dK=function(r,e,n){const c=re(new Float64Array(16)),d=(e/(1<<r)-.5)*Math.PI*2;return Ee(c,n.globeMatrix,d),Float32Array.from(c)},i.dL=Ho,i.dM=Yl,i.dN=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},i.dO=$,i.dP=function(r,e){var n=Math.sin(e),c=Math.cos(e);return r[0]=c,r[1]=n,r[2]=0,r[3]=-n,r[4]=c,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},i.dQ=nn,i.dR=Px,i.dS=an,i.dT=ia,i.dU=256,i.dV=function(r,e){const n=[0,0,0];return Ii(n,n,fp(Mo(e.canonical))),Ii(n,n,r),n},i.dW=r=>({u_matrix:new Qh(r),u_texsize:new Ao(r),u_pixels_to_tile_units:new tf(r),u_device_pixel_ratio:new Mr(r),u_width_scale:new Mr(r),u_floor_width_scale:new Mr(r),u_image:new om(r),u_units_to_pixels:new Ao(r),u_tile_units_to_pixels:new Mr(r),u_alpha_discard_threshold:new Mr(r),u_trim_offset:new Ao(r),u_trim_fade_range:new Ao(r),u_trim_color:new lm(r),u_zbias_factor:new Mr(r),u_tile_to_meter:new Mr(r),u_ground_shadow_factor:new Jh(r),u_pattern_transition:new Mr(r)}),i.dX=r=>({u_matrix:new Qh(r),u_pixels_to_tile_units:new tf(r),u_device_pixel_ratio:new Mr(r),u_width_scale:new Mr(r),u_floor_width_scale:new Mr(r),u_units_to_pixels:new Ao(r),u_dash_image:new om(r),u_gradient_image:new om(r),u_image_height:new Mr(r),u_texsize:new Ao(r),u_tile_units_to_pixels:new Mr(r),u_alpha_discard_threshold:new Mr(r),u_trim_offset:new Ao(r),u_trim_fade_range:new Ao(r),u_trim_color:new lm(r),u_zbias_factor:new Mr(r),u_tile_to_meter:new Mr(r),u_ground_shadow_factor:new Jh(r)}),i.dY=r=>({u_camera_to_center_distance:new Mr(r),u_extrude_scale:new tf(r),u_device_pixel_ratio:new Mr(r),u_matrix:new Qh(r),u_inv_rot_matrix:new Qh(r),u_merc_center:new Ao(r),u_tile_id:new Jh(r),u_zoom_transition:new Mr(r),u_up_dir:new Jh(r),u_emissive_strength:new Mr(r)}),i.dZ=Qf,i.d_=ZR,i.da=Vi,i.db=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},i.dc=w2,i.dd=xw,i.de=A2,i.df=Gw,i.dg=function(r,e){return r.readFields(WL,{icons:[]},e)},i.dh=Yx,i.di=U_,i.dj=Iw,i.dk=Qo,i.dl=Bh,i.dm=yo,i.dn=Ks,i.dp=Tt,i.dq=function(r){const e=r.indexOf(kd);return e>=0?r.slice(0,e):r},i.dr=function(r){return r.indexOf(kd)>=0},i.ds=function(r){const e=r.lastIndexOf(kd);return e>=0?r.slice(e+1):""},i.dt=function(r){const e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},i.du=function(r,e,n,c){return r.type==="custom"?new BL(r,e):new GL[r.type](r,e,n,c)},i.dv=It,i.dw=function(r){const e=r.indexOf(kd);return e>=0?r.slice(e+1):""},i.dx=class extends Og{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},i.dy=$f,i.dz=bo,i.e=An,i.e$=wt,i.e0=__,i.e1=(r,e,n,c,d,g)=>{const _=r.transform,S=_.projection.name==="globe";let M;if(g.paint.get("circle-pitch-alignment")==="map")if(S){const N=Px(_.zoom,e.canonical)*_._pixelsPerMercatorPixel;M=Float32Array.from([N,0,0,N])}else M=_.calculatePixelsToTileUnitsMatrix(n);else M=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(_.projection),u_matrix:r.translatePosMatrix(e.projMatrix,n,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Sa.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:sr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(S){R.u_inv_rot_matrix=c,R.u_merc_center=d,R.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],R.u_zoom_transition=jd(_.zoom);const N=d[0]*Jt,F=d[1]*Jt;R.u_up_dir=_.projection.upVector(new Ca(0,0,0),N,F)}return R},i.e2=V2,i.e3=oo,i.e4=(r,e,n,c,d,g,_,S,M,R)=>{const N=r.transform,F=N.pitch<15?B2(.07,.7,ne((14-N.zoom)/5,0,1)):.07,U=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:$2(r,e,n,c),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:N.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:U2(e,N),u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(U?null:n.lut).toArray01(),u_zbias_factor:F,u_tile_to_meter:de(e.tileID.canonical,0),u_ground_shadow_factor:M,u_pattern_transition:R}},i.e5=(r,e,n,c,d,g,_,S,M,R)=>{const N=r.transform,F=N.calculatePixelsToTileUnitsMatrix(e),U=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",W=N.pitch<15?B2(.07,.7,ne((14-N.zoom)/5,0,1)):.07;return{u_matrix:$2(r,e,n,c),u_pixels_to_tile_units:F,u_device_pixel_ratio:g,u_width_scale:_,u_floor_width_scale:S,u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:H2(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:U2(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:M,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(U?null:n.lut).toArray01(),u_zbias_factor:W,u_tile_to_meter:de(e.tileID.canonical,0),u_ground_shadow_factor:R}},i.e6=st,i.e7=xg,i.e8=Y,i.e9=cc,i.eA=function(r,e){var n=2*Math.acos(e[3]),c=Math.sin(n/2);return c>C?(r[0]=e[0]/c,r[1]=e[1]/c,r[2]=e[2]/c):(r[0]=1,r[1]=0,r[2]=0),n},i.eB=Zw,i.eC=n0,i.eD=i0,i.eE=[1,1,1],i.eF=G_,i.eG=Hs,i.eH=function(r,e,n,c){var d=e[0],g=e[1],_=e[2],S=e[3];return r[0]=d+c*(n[0]-d),r[1]=g+c*(n[1]-g),r[2]=_+c*(n[2]-_),r[3]=S+c*(n[3]-S),r},i.eI=D_,i.eJ=kl,i.eK=Dr,i.eL=function(r,e,n,c,d,g,_,S,M,R,N,F,U,W,Z,ee){var ce=new P(16);return ce[0]=r,ce[1]=e,ce[2]=n,ce[3]=c,ce[4]=d,ce[5]=g,ce[6]=_,ce[7]=S,ce[8]=M,ce[9]=R,ce[10]=N,ce[11]=F,ce[12]=U,ce[13]=W,ce[14]=Z,ce[15]=ee,ce},i.eM=m,i.eN=sh,i.eO=dg,i.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Me(1/0,1/0),max:new Me(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const n=Ky(new Me(0,0),new Me(Jt,Jt),r),c=[];if(e&&!k_(n,this._globalClipBounds))return c;for(const d of this._activeRegions){if(d.hiddenByOverlap||!k_(n,d))continue;const g=E_(d.min,d.max,r);c.push({min:g.min,max:g.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return c}setSources(r){this._setSources(r.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const c of e.cache.getVisibleCoordinates()){const d=e.cache.getTile(c).buckets[e.layer];d&&d.updateFootprints(c.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const n=r.getOrder(),c=r.getClipMask(),d=r.getClipScope();for(const g of e){if(!g.footprint)continue;const _=Ky(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:n,clipMask:c,clipScope:d})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,n)=>e.priority-n.priority||Mg(e.min,n.min)||Mg(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||(function(c,d){const g=(_,S)=>_+S;return c.length-d.length||c.reduce(g,"").localeCompare(d.reduce(g,""))})(e.clipScope,n.clipScope)));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const n=this._activeRegions[e],c=this._prevRegions[e];r=n.priority!==c.priority||!Yy(n,c)||n.order!==c.order||n.clipMask!==c.clipMask||!Rt(n.clipScope,c.clipScope),this._activeRegions[e].hiddenByOverlap=c.hiddenByOverlap,++e}}if(r){++this._updateTime;for(const n of this._activeRegions)n.order!==dh&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const c=this._activeRegions;if(n>=c.length)return n;const d=c[n].priority;for(;n<c.length&&c[n].priority===d;)++n;return n};if(this._sourceIds.length>1){let n=0,c=e(n);for(;n!==c;){let d=n;const g=n;for(;d!==c;){const _=this._activeRegions[d];_.hiddenByOverlap=!1;for(let S=0;S<g;S++){const M=this._activeRegions[S];if(!M.hiddenByOverlap&&_.order===dh&&k_(_,M)&&(_.hiddenByOverlap=Hx(_.footprint,_.tileId,M.footprint,M.tileId),_.hiddenByOverlap))break}++d}n=c,c=e(n)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},i.eQ=dh,i.eR=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const n=new Pc,c=new Zr,d=[],g=r+1+2,_=e[0]+1,S=e[0]+1+(1+e.length),M=(R,N,F)=>{let U=R===g-1?R-2:R===0?R:R-1;return U+=F?24575:0,[U,N]};for(let R=0;R<g;++R)n.emplaceBack(...M(R,0,!0));for(let R=0;R<_;++R)for(let N=0;N<g;++N)n.emplaceBack(...M(N,R,(N===0||N===g-1)&&!0));for(let R=0;R<e.length;++R){const N=e[R];for(let F=0;F<g;++F)n.emplaceBack(...M(F,N,!0))}for(let R=0;R<e.length;++R){const N=c.length,F=e[R]+1+2,U=new Zr;for(let ee=0;ee<F-1;ee++){const ce=ee===F-2,oe=ce?g*(S-e.length+R-ee):g;for(let me=0;me<g-1;me++){const ve=ee*g+me;ee===0||ce||me===0||me===g-2?(U.emplaceBack(ve+1,ve,ve+oe),U.emplaceBack(ve+oe,ve+oe+1,ve+1)):(c.emplaceBack(ve+1,ve,ve+oe),c.emplaceBack(ve+oe,ve+oe+1,ve+1))}}const W=ir.simpleSegment(0,N,n.length,c.length-N);for(let ee=0;ee<U.uint16.length;ee+=3)c.emplaceBack(U.uint16[ee],U.uint16[ee+1],U.uint16[ee+2]);const Z=ir.simpleSegment(0,N,n.length,c.length-N);d.push({withoutSkirts:W,withSkirts:Z})}return{vertices:n,indices:c,segments:d}}_createGrid(r){const e=this._fillGridMeshWithLods(fo,ql);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,rf.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new Zr;for(let _=0;_<=fo;_++)e.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const n=new Ed,c=new Ed,d=new Ed,g=new Ed;this._poleSegments=[];for(let _=0,S=0;_<Gl;_++){const M=360/(1<<_);n.emplaceBack(0,-io,0,.5,0),c.emplaceBack(0,-io,0,.5,1),d.emplaceBack(0,-io,0,.5,.5),g.emplaceBack(0,-io,0,.5,.5);for(let R=0;R<=fo;R++){let N=R/fo,F=0;const U=Gi(0,M,N),[W,Z,ee]=Md(Yb,Rx,U,io);n.emplaceBack(W,Z,ee,N,F),c.emplaceBack(W,Z,ee,N,1-F);const ce=ui(U);N=.5+.5*Math.sin(ce),F=.5+.5*Math.cos(ce),d.emplaceBack(W,Z,ee,N,F),g.emplaceBack(W,Z,ee,N,1-F)}this._poleSegments.push(ir.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(n,zc,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(c,zc,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(d,zc,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(g,zc,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},i.eS=Vx,i.eT=Mn,i.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eV=Xe,i.eW=he,i.eX=function(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r[2]=e[2]/n[2],r},i.eY=Hc,i.eZ=Zl,i.e_=yn,i.ea=Tp,i.eb=z,i.ec=Fc,i.ed=Gx,i.ee=hh,i.ef=ae,i.eg=function(r,e){if(r===e){var n=e[1],c=e[2],d=e[3],g=e[6],_=e[7],S=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=n,r[6]=e[9],r[7]=e[13],r[8]=c,r[9]=g,r[11]=e[14],r[12]=d,r[13]=_,r[14]=S}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},i.eh=FL,i.ei=Ln,i.ej=np,i.ek=256,i.el=m_,i.em=Tl,i.en=Ee,i.eo=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},i.ep=Ed,i.eq=Nu,i.er=tp,i.es=function(r,e,n,c,d){return ne((r-e)/(n-e)*(d-c)+c,c,d)},i.et=ds,i.eu=function(r,e){var n=e[0],c=e[1],d=e[2],g=e[3],_=e[4],S=e[5],M=e[6],R=e[7],N=e[8],F=N*_-S*R,U=-N*g+S*M,W=R*g-_*M,Z=n*F+c*U+d*W;return Z?(r[0]=F*(Z=1/Z),r[1]=(-N*c+d*R)*Z,r[2]=(S*c-d*_)*Z,r[3]=U*Z,r[4]=(N*n-d*M)*Z,r[5]=(-S*n+d*g)*Z,r[6]=W*Z,r[7]=(-R*n+c*M)*Z,r[8]=(_*n-c*g)*Z,r):null},i.ev=2,i.ew=fn,i.ex=Yo,i.ey=lt,i.ez=function(r,e){var n=new P(3);lt(n,e);var c=1/n[0],d=1/n[1],g=1/n[2],_=e[0]*c,S=e[1]*d,M=e[2]*g,R=e[4]*c,N=e[5]*d,F=e[6]*g,U=e[8]*c,W=e[9]*d,Z=e[10]*g,ee=_+N+Z,ce=0;return ee>0?(ce=2*Math.sqrt(ee+1),r[3]=.25*ce,r[0]=(F-W)/ce,r[1]=(U-M)/ce,r[2]=(S-R)/ce):_>N&&_>Z?(ce=2*Math.sqrt(1+_-N-Z),r[3]=(F-W)/ce,r[0]=.25*ce,r[1]=(S+R)/ce,r[2]=(U+M)/ce):N>Z?(ce=2*Math.sqrt(1+N-_-Z),r[3]=(U-M)/ce,r[0]=(S+R)/ce,r[1]=.25*ce,r[2]=(F+W)/ce):(ce=2*Math.sqrt(1+Z-_-N),r[3]=(S-R)/ce,r[0]=(U+M)/ce,r[1]=(F+W)/ce,r[2]=.25*ce),r},i.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,((e,n)=>String.fromCharCode(+("0x"+n)))))},i.f0=function([r,e,n]){const c=Math.hypot(r,e,n),d=Math.atan2(r,n),g=.5*Math.PI-Math.acos(-e/c);return new o(Wi(d),Wi(g))},i.f1=Gs,i.f2=pw,i.f3=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!(function(n){if(Oa==null){const c=n.navigator?n.navigator.userAgent:null;Oa=!!n.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Oa})(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f4=function(r,e){Eu=r,fc=e},i.f5=Py,i.f6=jx,i.f7=function(r){const e=[0,0,0],n=re(new Float64Array(16));return xe(n,r.pixelMatrix,r.globeMatrix),Ii(e,e,n),new Me(e[0],e[1])},i.f8=function(){const r=_u;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(sa),_u=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f9=function(){Yx().acquire(sa)},i.fA=M0,i.fB=Ke,i.fC=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==_2){const n=new Uint32Array(r,0,7),[,,c,d,g,_]=n;e=n.byteLength+d+g+_+g,(c!==r.byteLength||e>=r.byteLength)&&mi("Invalid b3dm header information.")}return b2(r,e)},i.fD=function(r,e){const n=xw(r);for(const c of n){for(const d of c.meshes)gR(d);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(_R(c.lights,e)))}return n},i.fE=S0,i.fF=Hi,i.fG=Ka,i.fH=du,i.fI=sl,i.fJ=function(r){vo(),hl?.then((e=>{e.keys().then((n=>{for(let c=0;c<n.length-r;c++)e.delete(n[c]).catch((d=>mi(d.message)))})).catch((n=>mi(n.message)))})).catch((e=>mi(e.message)))},i.fa=$h,i.fb=function(r,e,n=!1){if(ko===sl.deferred||ko===sl.loading||ko===sl.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");uu=Sa.resolveURL(r),ko=sl.deferred,ig=e,Uh(),n||ng()},i.fc=function(r){L_=Sa.resolveURL(r),I_||(I_=new or(Yx(),new _c)),I_.broadcast("setMeshoptUrl",L_)},i.fd=p2,i.fe=function(r){cw=Sa.resolveURL(r),I_||(I_=new or(Yx(),new _c)),I_.broadcast("setDracoUrl",cw)},i.ff=m2,i.fg=Bn,i.fh=function(r){const e=ao();if(!e)return;const n=e.delete(Gc);r&&n.then((()=>r())).catch(r)},i.fi=_s,i.fj=vi,i.fk=fr,i.fl=gh,i.fm=Ik,i.fn=zk,i.fo=D2,i.fp=gt,i.fq="hd_road_elevation",i.fr=ua,i.fs=ct,i.ft=uh,i.fu=Lw,i.fv=zg,i.fw=function(r,e,n,c,d,g,_,S=1,M,R,N){r.createArrays(),r.tilePixelRatio=Jt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const F=r.layers[0].layout,U=r.layers[0]._unevaluatedLayout._values,W={};W.scaleFactor=S,W.textSizeScaleRange=F.get("text-size-scale-range"),W.iconSizeScaleRange=F.get("icon-size-scale-range");const[Z,ee]=W.textSizeScaleRange,[ce,oe]=W.iconSizeScaleRange;W.textScaleFactor=ne(W.scaleFactor,Z,ee),W.iconScaleFactor=ne(W.scaleFactor,ce,oe);const me=U["text-size"],ve=U["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:tt,maxZoom:_t}=r.textSizeData;W.compositeTextSizes=[me.possiblyEvaluate(new Fa(tt,{worldview:N}),g),me.possiblyEvaluate(new Fa(_t,{worldview:N}),g)]}if(r.iconSizeData.kind==="composite"){const{minZoom:tt,maxZoom:_t}=r.iconSizeData;W.compositeIconSizes=[ve.possiblyEvaluate(new Fa(tt,{worldview:N}),g),ve.possiblyEvaluate(new Fa(_t,{worldview:N}),g)]}W.layoutTextSize=me.possiblyEvaluate(new Fa(_+1,{worldview:N}),g),W.layoutIconSize=ve.possiblyEvaluate(new Fa(_+1,{worldview:N}),g),W.textMaxSize=me.possiblyEvaluate(new Fa(18,{worldview:N}),g);const Se=F.get("symbol-placement"),De=F.get("text-rotation-alignment")==="map"&&Se!=="point",Re=F.get("text-size");let $e=!1;const We=[];for(const tt of r.features){const _t=F.get("text-font").evaluate(tt,{},g).join(","),nt=Re.evaluate(tt,{},g)*W.textScaleFactor,xt=W.layoutTextSize.evaluate(tt,{},g)*W.textScaleFactor,Mt=W.layoutIconSize.evaluate(tt,{},g)*W.iconScaleFactor,Pt={horizontal:{},vertical:void 0},Gt=tt.text;let Wt,Ut=[0,0];if(Gt){const wn=Gt.toString(),La=F.get("text-letter-spacing").evaluate(tt,{},g)*Bs,Le=F.get("text-line-height").evaluate(tt,{},g)*Bs,Oe=Nf(wn)?La:0,bt=F.get("text-anchor").evaluate(tt,{},g),qt=F.get("text-variable-anchor");if(!qt){const bn=F.get("text-radial-offset").evaluate(tt,{},g);if(bn)Ut=yT(bt,[bn*Bs,Dw]);else{const kn=F.get("text-offset").evaluate(tt,{},g);Ut=[kn[0]*Bs,kn[1]*Bs]}}let hi=De?"center":F.get("text-justify").evaluate(tt,{},g);const fi=Se==="point",Ni=fi?F.get("text-max-width").evaluate(tt,{},g)*Bs:1/0,Bi=bn=>{r.allowVerticalPlacement&&th(wn)&&(Pt.vertical=Cw(Gt,e,n,d,_t,Ni,Le,bt,bn,Oe,Ut,Bc.vertical,!0,xt,nt,M))};if(!De&&qt){const bn=hi==="auto"?qt.map((Cn=>Ow(Cn))):[hi];let kn=!1;for(let Cn=0;Cn<bn.length;Cn++){const Vn=bn[Cn];if(!Pt.horizontal[Vn])if(kn)Pt.horizontal[Vn]=Pt.horizontal[0];else{const Qi=Cw(Gt,e,n,d,_t,Ni,Le,"center",Vn,Oe,Ut,Bc.horizontal,!1,xt,nt,M);Qi&&(Pt.horizontal[Vn]=Qi,kn=Qi.positionedLines.length===1)}}Bi("left")}else{if(hi==="auto"&&(hi=Ow(bt)),fi||F.get("text-writing-mode").indexOf("horizontal")>=0||!th(wn)){const bn=Cw(Gt,e,n,d,_t,Ni,Le,bt,hi,Oe,Ut,Bc.horizontal,!1,xt,nt,M);bn&&(Pt.horizontal[hi]=bn)}Bi(fi?"left":hi)}}let $t,vt,yt,Vt,si,Qt,Oi=!1;const pi=F.get("icon-text-fit").evaluate(tt,{},g);if(tt.icon&&tt.icon.hasPrimary()){const wn=dv(tt.icon,r.iconSizeData,U["icon-size"],g,r.zoom,tt,M,W.iconScaleFactor,N);$t=wn.iconPrimary,yt=wn.iconSecondary;const La=$t.toString();if(vt=c.get(La),vt&&(si=F.get("icon-offset").evaluate(tt,{},g),Qt=F.get("icon-anchor").evaluate(tt,{},g),Wt=l0(d.get(La),yt?d.get(yt.toString()):void 0,si,Qt),Oi=vt.sdf,r.sdfIcons===void 0?r.sdfIcons=vt.sdf:r.sdfIcons!==vt.sdf&&mi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(vt.pixelRatio!==r.pixelRatio||F.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),yt){const Le=yt.toString();Vt=c.get(Le)}}$e=$e||!(!tt.icon||!tt.icon.hasSecondary());const bi=f0(Pt.horizontal)||Pt.vertical;r.iconsInText||(r.iconsInText=!!bi&&bi.iconsInText);const Mi=xt*W.textScaleFactor/Bs,{defaultShapedIcon:jn,verticallyShapedIcon:ni}=kL(r,Wt,F,tt,g,Pt,Mi,si,pi);pi!=="none"&&Wt&&(nT(Wt)||aT(Wt))&&(h0(0,vt,$t,Wt,jn,pi,R,c,d),h0(0,Vt,yt,Wt,jn,pi,R,c,d),ni&&(h0(0,vt,$t,Wt,ni,pi,R,c,d),h0(0,Vt,yt,Wt,ni,pi,R,c,d))),Wt=jn;const{iconBBox:Li,iconVerticalBBox:dn,textBBox:Wn,textVerticalBBox:Kn}=xL(r,Wt,ni,F,tt,g,Mt,si,W,d,Qt,Pt,xt,Ut);We.push({feature:tt,shapedTextOrientations:Pt,shapedText:bi,shapedIcon:Wt,iconPrimary:$t,iconSecondary:yt,iconOffset:si,iconAnchor:Qt,verticallyShapedIcon:ni,layoutTextSize:xt,layoutIconSize:Mt,textOffset:Ut,isSDFIcon:Oi,iconTextFit:pi,iconCollisionBounds:Li,iconVerticalCollisionBounds:dn,textCollisionBounds:Wn,textVerticalCollisionBounds:Kn})}return{featureData:We,sizes:W,hasAnySecondaryIcon:$e,textAlongLine:De,symbolPlacement:Se}},i.fx=hT,i.fy=function(r,e,n,c,d,g,_,S,M,R){r.iconAtlasPositions=R.iconPositions;const{featureData:N,hasAnySecondaryIcon:F,sizes:U,textAlongLine:W,symbolPlacement:Z}=e;for(const ee of N){const{shapedIcon:ce,verticallyShapedIcon:oe,feature:me,shapedTextOrientations:ve,shapedText:Se,layoutTextSize:De,textOffset:Re,isSDFIcon:$e,iconPrimary:We,iconSecondary:tt,iconTextFit:_t,iconOffset:nt,iconCollisionBounds:xt,iconVerticalCollisionBounds:Mt,textCollisionBounds:Pt}=ee;xT(ce,R.iconPositions,We,tt),xT(oe,R.iconPositions,We,tt),TL(ve,R.iconPositions),SL(We,tt,R.iconPositions),(Se||ce)&&EL(r,me,ve,ce,oe,M,U,De,0,Re,$e,c,d,_,S,F,_t,nt,W,Z,xt,Mt,Pt)}n&&r.generateCollisionDebugBuffers(g,r.collisionBoxArray,U.textScaleFactor)},i.fz=ot,i.g=function(r,e){return bo(Object.assign(r,{method:"GET"}),e)},i.h=function(r){return r.indexOf("mapbox:")===0},i.i=function(r){return An.API_STYLE_REGEX.test(r)&&!Dn(r)},i.j=Xa,i.k=ro,i.l=function(r){return decodeURIComponent(atob(r).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},i.m=function(r,e){return bo(Object.assign(r,{type:"json"}),e)},i.n=js,i.o=Sa,i.p=function(r,e){return bo(Object.assign(r,{method:"POST"}),e)},i.q=Fs,i.r=os,i.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return tv||(tv=new _s("ImageRasterizer")),tv},i.u=function(){return(function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)})()},i.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},i.w=mi,i.x=e1,i.y=Qu,i.z=wo})),y(["./shared"],(function(i){function C(Xe){const ne=Xe?Xe.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function P(Xe){if(typeof Xe=="number"||typeof Xe=="boolean"||typeof Xe=="string"||Xe==null)return JSON.stringify(Xe);if(Array.isArray(Xe)){let ue="[";for(const ke of Xe)ue+=`${P(ke)},`;return`${ue}]`}let ne="{";for(const ue of Object.keys(Xe).sort())ne+=`${ue}:${P(Xe[ue])},`;return`${ne}}`}function D(Xe){let ne="";for(const ue of i.bx)ne+=`/${P(Xe[ue])}`;return ne}class ${constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,ue){this._layerConfigs={},this._layers={},this.update(ne,[],ue)}update(ne,ue,ke){this._options=ke;for(const Ue of ne)this._layerConfigs[Ue.id]=Ue,(this._layers[Ue.id]=i.du(Ue,this.scope,null,this._options)).compileFilter(ke),this.keyCache[Ue.id]&&delete this.keyCache[Ue.id];for(const Ue of ue)delete this.keyCache[Ue],delete this._layerConfigs[Ue],delete this._layers[Ue];this.familiesBySource={};const Fe=(function(Ue,Ze){const st={};for(let ct=0;ct<Ue.length;ct++){const It=Ue[ct];let Tt=Ze&&Ze[It.id];Tt||(It.type==="symbol"?Tt=It.id:(Tt=D(It),It.type==="line"&&It.paint&&(function Fi(mi){return typeof mi=="string"&&mi==="line-progress"||(Array.isArray(mi)?mi.some(Fi):!(!mi||typeof mi!="object")&&Object.values(mi).some(Fi))})(It.paint["line-width"])&&(Tt+=`/${P(It.paint["line-width"])}`))),Ze&&(Ze[It.id]=Tt);let ci=st[Tt];ci||(ci=st[Tt]=[]),ci.push(It)}const Je=[];for(const ct in st)Je.push(st[ct]);return Je})(Object.values(this._layerConfigs),this.keyCache);for(const Ue of Fe){const Ze=Ue.map((ci=>this._layers[ci.id])),st=Ze[0];if(st.visibility==="none")continue;const Je=st.source||"";let ct=this.familiesBySource[Je];ct||(ct=this.familiesBySource[Je]={});const It=st.sourceLayer||"_geojsonTileLayer";let Tt=ct[It];Tt||(Tt=ct[It]=[]),Tt.push(Ze)}}}const G=1*i.fl;class X{constructor(ne){const ue={},ke=[];for(const st in ne){const Je=ne[st],ct=ue[st]={};for(const It in Je.glyphs){const Tt=Je.glyphs[+It];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const ci=Tt.metrics.localGlyph?G:1,Fi={x:0,y:0,w:Tt.bitmap.width+2*ci,h:Tt.bitmap.height+2*ci};ke.push(Fi),ct[It]=Fi}}const{w:Fe,h:Ue}=i.G(ke),Ze=new i.fk({width:Fe||1,height:Ue||1});for(const st in ne){const Je=ne[st];for(const ct in Je.glyphs){const It=Je.glyphs[+ct];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const Tt=ue[st][ct],ci=It.metrics.localGlyph?G:1;i.fk.copy(It.bitmap,Ze,{x:0,y:0},{x:Tt.x+ci,y:Tt.y+ci},It.bitmap)}}this.image=Ze,this.positions=ue}}function te(Xe,ne,ue){Xe[ne]?ue&&(Xe[ne].center=ue):Xe[ne]={floorIds:new Set,center:ue||[0,0],floors:{}}}function le(Xe,ne,ue,ke){for(const Fe of ne)te(Xe,Fe),Xe[Fe].floors[ue]=ke,Xe[Fe].floorIds.add(ue)}function re(Xe){return{id:Xe.properties.id.toString(),center:Xe.properties.center.toString().split(";").map(Number)}}function fe(Xe){return{id:Xe.properties.id.toString(),isDefault:!!Xe.properties.is_default&&Xe.properties.is_default,connections:Xe.properties.connected_floor_ids?new Set(Xe.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Xe.properties.conflicted_floor_ids?new Set(Xe.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Xe.properties.building_ids?new Set(Xe.properties.building_ids.toString().split(";")):new Set,name:Xe.properties.name.toString(),zIndex:Xe.properties.z_index}}function xe(Xe,ne){return ne.every((ue=>Xe.properties&&Xe.properties[ue]!=null))}function be(Xe){return xe(Xe,["type","id","name"])&&Xe.properties.type==="building"}function Ne(Xe){return xe(Xe,["type","id","name","z_index"])&&Xe.properties.type==="floor"}i.fj(X,"GlyphAtlas");class Be{constructor(ne){this.tileID=new i.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=i.aZ(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor,this.worldview=ne.worldview,this.indoor=ne.indoor}parse(ne,ue,ke,Fe,Ue,Ze){this.status="parsing",this.data=ne,this.collisionBoxArray=new i.b3;const st=new i.fm(Object.keys(ne.layers).sort()),Je=new i.fn(this.tileID,this.promoteId);Je.bucketLayerIDs=[];const ct={},It=new i.fo(256,256),Tt={featureIndex:Je,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:It,availableImages:ke,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const tn=this.indoor.indoorState.activeFloorsVisible,rn=(function(Xi,Hi,Gn){const Oa=(function(gn,an){if(!gn)return i.w("No source layers defined in indoor specification"),an;if(gn.size===0)return an;const ia=gn.difference(an);for(const oa of ia)i.w(`Missing source layer required in indoor specification: ${oa}`);return an.intersection(an)})(Hi.sourceLayers,new Set(Object.keys(Xi.layers))),Ea=Hi.indoorState,Jn=(function(gn,an,ia,oa){const An=new Set,Xa=new Set,Dn=new Set,Aa=new Map,Zs={},ss=tr=>{const Lo=Aa.get(tr)||new Set;for(const Qr of An)if((Aa.get(Qr)||new Set).has(tr)||Lo.has(Qr))return!0;return!1};for(const tr of an){const Lo=gn.layers[tr];if(Lo)for(let Qr=0;Qr<Lo.length;Qr++){const os=Lo.feature(Qr);if(be(os)){const{id:Sa,center:Io}=re(os);te(Zs,Sa,Io),An.add(Sa)}else if(Ne(os)){const{id:Sa,isDefault:Io,connections:yo,conflicts:Gc,buildings:Eu,name:fc,zIndex:mc}=fe(os);le(Zs,Eu,Sa,{name:fc,zIndex:mc}),Aa.set(Sa,Gc),(Sa===oa||yo.has(oa))&&An.add(Sa),Xa.add(Sa),Io&&Dn.add(Sa)}}else i.w(`indoor source layer not found: ${tr}`)}if(ia)for(const tr of ia)Xa.has(tr)&&(ss(tr)||An.add(tr));for(const tr of Dn)An.has(tr)||ss(tr)||An.add(tr);return{buildings:Zs,activeFloors:An}})(Xi,Oa,Ea.lastActiveFloors,Ea.selectedFloorId);return Gn.send("setIndoorData",Jn),Jn})(ne,this.indoor,Ue);Tt.activeFloors=tn?rn.activeFloors:void 0}const ci=[],Fi=ue.familiesBySource[this.source];for(const tn in Fi){const rn=ne.layers[tn];if(!rn)continue;let Xi=!1,Hi=!1,Gn=!1;for(const an of Fi[tn])an[0].type==="symbol"?Xi=!0:Hi=!0,an[0].is3D()&&an[0].type!=="model"&&(Gn=!0);if(this.extraShadowCaster&&!Gn||this.isSymbolTile===!0&&!Xi||this.isSymbolTile===!1&&!Hi)continue;rn.version===1&&i.w(`Vector tile source "${this.source}" layer "${tn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oa=st.encode(tn),Ea=[],Jn=this.localizableLayerIds&&this.localizableLayerIds.has(tn);let gn=!1;for(let an=0,ia=0;an<rn.length;an++){const oa=rn.feature(an),An=Je.getId(oa,tn),Xa=oa.properties?oa.properties.worldview:null;if(Jn&&this.worldview&&typeof Xa=="string")if(Xa==="all")oa.properties.$localized=!0;else{if(!Xa.split(",").includes(this.worldview))continue;oa.properties.$localized=!0,oa.properties.worldview=this.worldview}!gn&&oa.properties&&oa.properties.hasOwnProperty(i.fp)&&(gn=!0),Ea.push({feature:oa,id:An,index:ia,sourceLayerIndex:Oa}),ia++}gn&&!Tt.elevationFeatures&&ne.layers.hasOwnProperty(i.fq)&&(Tt.elevationFeatures=i.fr.parseFrom(ne.layers[i.fq],this.canonical));for(const an of Fi[tn]){const ia=an[0];if(this.extraShadowCaster&&(!ia.is3D()||ia.type==="model")||this.isSymbolTile!==void 0&&ia.type==="symbol"!==this.isSymbolTile||ia.minzoom&&this.zoom<Math.floor(ia.minzoom)||ia.maxzoom&&this.zoom>=ia.maxzoom||ia.visibility==="none")continue;Ee(an,this.zoom,Tt.brightness,ke,this.worldview);const oa=ct[ia.id]=ia.createBucket({index:Je.bucketLayerIDs.length,layers:an,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oa,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Fe,worldview:this.worldview,localizable:Jn});Je.bucketLayerIDs.push(an.map((Xa=>i.B(Xa.id,Xa.scope))));let An=oa.prepare?oa.prepare():null;An!=null?(An=An.then((()=>oa.populate(Ea,Tt,this.tileID.canonical,this.tileTransform))),ci.push(An)):oa.populate(Ea,Tt,this.tileID.canonical,this.tileTransform)}}const mi=()=>{let tn,rn,Xi,Hi,Gn,Oa;It.trim();const Ea={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Jn=()=>{if(tn)return this.status="done",Ze(tn);if(this.extraShadowCaster)this.status="done",Ze(null,{buckets:Object.values(ct).filter((an=>!an.isEmpty())),featureIndex:Je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Tt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(rn&&Xi&&Hi){const an=new X(rn),ia=new Map;for(const[Xa,Dn]of Xi.entries()){const{imagePosition:Aa}=i.fu(Xa,Dn,i.fv);ia.set(Xa,Aa)}const oa={};for(const Xa in ct){const Dn=ct[Xa];Dn instanceof i.b4&&(Ee(Dn.layers,this.zoom,Tt.brightness,ke,this.worldview),oa[Xa]=i.fw(Dn,rn,an.positions,Xi,ia,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Gn,this.worldview))}const An={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ue,Xi,Gn,(()=>{An.iconsPending=!1,gn(oa,an,An)})),this.rasterizeIfNeeded(Ue,Hi,Oa,(()=>{An.patternsPending=!1,gn(oa,an,An)}))}},gn=(an,ia,oa,An)=>{if(oa.iconsPending||oa.patternsPending)return;const Xa=new i.fx(Xi,Hi,this.lut);for(const Dn in ct){const Aa=ct[Dn];if(Dn in an)i.fy(Aa,an[Dn],this.showCollisionBoxes,ke,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Xi,Xa);else if(Aa.hasPattern&&(Aa instanceof i.ba||Aa instanceof i.bb||Aa instanceof i.ea)){Ee(Aa.layers,this.zoom,Tt.brightness,ke,this.worldview);const Zs=Object.fromEntries(Xa.patternPositions);Aa.addFeatures(Tt,this.tileID.canonical,Zs,ke,this.tileTransform,this.brightness)}}this.status="done",Ze(null,{buckets:Object.values(ct).filter((Dn=>!Dn.isEmpty())),featureIndex:Je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ia.image,lineAtlas:It,imageAtlas:Xa,brightness:Tt.brightness})};if(!this.extraShadowCaster){const an=i.fs(Tt.glyphDependencies,(An=>Object.keys(An).map(Number)));Object.keys(an).length?Ue.send("getGlyphs",{uid:this.uid,stacks:an},((An,Xa)=>{tn||(tn=An,rn=Xa,Jn())}),void 0,!1,Ea):rn={};const ia=Array.from(Tt.iconDependencies.keys()).map((An=>i.I.parse(An)));ia.length?Ue.send("getImages",{images:ia,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((An,Xa)=>{tn||(tn=An,Xi=new Map,Gn=this.updateImageMapAndGetImageTaskQueue(Xi,Xa,Tt.iconDependencies),Jn())}),void 0,!1,Ea):(Xi=new Map,Gn=new Map);const oa=Array.from(Tt.patternDependencies.keys()).map((An=>i.I.parse(An)));oa.length?Ue.send("getImages",{images:oa,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((An,Xa)=>{tn||(tn=An,Hi=new Map,Oa=this.updateImageMapAndGetImageTaskQueue(Hi,Xa,Tt.patternDependencies),Jn())}),void 0,!1,Ea):(Hi=new Map,Oa=new Map)}if(Tt.elevationFeatures&&Tt.elevationFeatures.length>0){const an=[];for(const oa of Object.values(ct))if(oa instanceof i.bb){const An=oa.getUnevaluatedPortalGraph();An&&an.push(An)}const ia=i.ft.evaluate(an);for(const oa of Object.values(ct))if(oa instanceof i.bb){const An=ne.layers[st.decode(oa.sourceLayerIndex)];oa.setEvaluatedPortalGraph(ia,An,this.tileID.canonical,Tt.availableImages,Tt.brightness)}}Jn()};ci.length>0?Promise.allSettled(ci).then(mi).catch(Ze):mi()}updateParameters(ne){this.scaleFactor=ne.scaleFactor,this.showCollisionBoxes=ne.showCollisionBoxes,this.projection=ne.projection,this.brightness=ne.brightness,this.tileTransform=i.aZ(ne.tileID.canonical,ne.projection),this.extraShadowCaster=ne.extraShadowCaster,this.lut=ne.lut,this.worldview=ne.worldview,this.indoor=ne.indoor}rasterizeIfNeeded(ne,ue,ke,Fe){Array.from(ue.values()).some((Ue=>Ue.usvg))?this.rasterize(ne,ue,ke,Fe):Fe()}updateImageMapAndGetImageTaskQueue(ne,ue,ke){const Fe=new Map;for(const Ue of ue.keys()){const Ze=ke.get(Ue)||[];for(const st of Ze){const Je=st.toString(),ct=ue.get(st.id.toString());ct.usvg?Fe.has(Je)||(Fe.set(Je,st),ne.set(Je,Object.assign({},ct))):ne.set(Je,ct)}}return Fe}rasterize(ne,ue,ke,Fe){this.rasterizeTask=ne.send("rasterizeImages",{scope:this.scope,tasks:ke},((Ue,Ze)=>{if(!Ue)for(const[st,Je]of Ze.entries()){const ct=Object.assign(ue.get(st),{data:Je});ue.set(st,ct)}Fe()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ee(Xe,ne,ue,ke,Fe){const Ue=new i.ac(ne,{brightness:ue,worldview:Fe});for(const Ze of Xe)Ze.recalculate(Ue,ke)}class et extends i.E{constructor(ne,ue,ke,Fe,Ue,Ze,st){super(),this.actor=ne,this.layerIndex=ue,this.availableImages=ke,this.availableModels=Fe,this.loadVectorData=Ze||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(ne.scheduler),this.isSpriteLoaded=Ue,this.scheduler=ne.scheduler,this.brightness=st}loadTile(ne,ue){const ke=ne.uid,Fe=ne&&ne.request,Ue=Fe&&Fe.collectResourceTiming,Ze=this.loading[ke]=new Be(ne);Ze.abort=this.loadVectorData(ne,((st,Je)=>{const ct=!this.loading[ke];if(delete this.loading[ke],Ze.cancelRasterize(),ct||st||!Je)return Ze.status="done",ct||(this.loaded[ke]=Ze),ue(st);const It=Je.rawData,Tt={},ci=i.aM(Je.responseHeaders);ci&&ci.expires&&(Tt.expires=ci.expires),ci&&ci.cacheControl&&(Tt.cacheControl=ci.cacheControl),Ze.vectorTile=Je.vectorTile||new i.fz(new i.bt(It));const Fi=()=>{Ze.parse(Ze.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((mi,tn)=>{if(mi||!tn)return ue(mi);const rn={};if(Ue){const Xi=C(Fe);Xi.length>0&&(rn.resourceTiming=JSON.parse(JSON.stringify(Xi)))}ue(null,Object.assign({rawTileData:It.slice(0),responseHeaders:Je.responseHeaders},tn,Tt,rn))}))};this.isSpriteLoaded?Fi():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(Fi,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):Fi()})),this.loaded=this.loaded||{},this.loaded[ke]=Ze}))}reloadTile(ne,ue){const ke=this.loaded,Fe=ne.uid;if(ke&&ke[Fe]){const Ue=ke[Fe];Ue.updateParameters(ne);const Ze=(st,Je)=>{const ct=Ue.reloadCallback;ct&&(delete Ue.reloadCallback,Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ct)),ue(st,Je)};Ue.status==="parsing"?Ue.reloadCallback=Ze:Ue.status==="done"&&(Ue.vectorTile?Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ze):Ze())}else ue(null,void 0)}abortTile(ne,ue){const ke=ne.uid,Fe=this.loading[ke];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[ke]),ue()}removeTile(ne,ue){const ke=this.loaded,Fe=ne.uid;ke&&ke[Fe]&&delete ke[Fe],ue()}}class at{loadTile(ne,ue){const{uid:ke,encoding:Fe,rawImageData:Ue,padding:Ze}=ne,st=ImageBitmap&&Ue instanceof ImageBitmap?this.getImageData(Ue,Ze):Ue;ue(null,new i.fA(ke,st,Fe,Ze<1))}reloadTile(ne,ue){ue(null,null)}abortTile(ne,ue){ue()}removeTile(ne,ue){ue()}getImageData(ne,ue){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const ke=this.offscreenCanvasContext.getImageData(-ue,-ue,ne.width+2*ue,ne.height+2*ue);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ke}}i.bs.setPbf(i.bt);class He{constructor(ne){this._mrt=new i.bs(ne.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ne.uid,this.tileID=ne.tileID,this.source=ne.source}parse(ne,ue){const ke=this._mrt;this.status="parsing",this._entireBuffer=ne;try{ke.parseHeader(ne),this._isHeaderLoaded=!0;const Fe=[];for(const Ue in ke.layers){const Ze=ke.getLayer(Ue),st=Ze.getDataRange(Ze.getBandList()),Je=ke.createDecodingTask(st),ct=ne.slice(st.firstByte,st.lastByte+1),It=i.bs.performDecoding(ct,Je).then((Tt=>Je.complete(null,Tt))).catch((Tt=>Je.complete(Tt,null)));Fe.push(It)}Promise.allSettled(Fe).then((()=>ue(null,ke))).catch((Ue=>ue(Ue)))}catch(Fe){ue(Fe)}}}class lt{constructor(ne){this.actor=ne,this.loading={},this.loaded={}}loadTile(ne,ue){const ke=ne.uid,Fe=ne.request,Ue=this.loading[ke]=new He(ne),{cancel:Ze}=i.bu(Fe,((st,Je,ct)=>{const It=!this.loading[ke];if(delete this.loading[ke],It||st||!Je)return Ue.status="done",It||(this.loaded[ke]=Ue),ue(st);Ue.parse(Je,((Tt,ci)=>{if(Tt||!ci)return ue(Tt);ue(null,ci,ct)})),this.loaded[ke]=Ue}));Ue.abort=Ze}reloadTile(ne,ue){ue(null,void 0)}abortTile(ne,ue){const ke=ne.uid,Fe=this.loading[ke];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[ke]),ue()}removeTile(ne,ue){const ke=ne.uid;this.loaded[ke]&&delete this.loaded[ke],ue()}decodeRasterArray(ne,ue){i.bs.performDecoding(ne.buffer,ne.task).then((ke=>ue(null,ke))).catch((ke=>ue(ke)))}}const pt=i.fB.prototype.toGeoJSON;class Zt{constructor(ne){this._feature=ne,this.extent=i.al,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ue of this._feature.geometry)ne.push([new i.P(ue[0],ue[1])]);return ne}{const ne=[];for(const ue of this._feature.geometry){const ke=[];for(const Fe of ue)ke.push(new i.P(Fe[0],Fe[1]));ne.push(ke)}return ne}}toGeoJSON(ne,ue,ke){return pt.call(this,ne,ue,ke)}}class jt{constructor(ne,ue){this.name=ne,this.extent=i.al,this.length=ue.length,this._jsonFeatures=ue}feature(ne){return new Zt(this._jsonFeatures[ne])}}class Di{constructor(ne){this.layers={},this.extent=i.al;for(const ue of Object.keys(ne))this.layers[ue]=new jt(ue,ne[ue])}}const Pi=64/4096,qe=128;class wt{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],ue){for(const ke of ne){const Fe=ke.id;if(Fe==null)continue;let Ue=this.features.get(Fe);Ue&&this.updateCache(Ue,ue),ke.geometry?(Ue=Vi(ke),this.updateCache(Ue,ue),this.features.set(Fe,Ue)):this.features.delete(Fe),this.updateCache(Ue,ue)}}updateCache(ne,ue){for(const{canonical:ke,uid:Fe}of Object.values(ue)){const{z:Ue,x:Ze,y:st}=ke;Ct(ne,Math.pow(2,Ue),Ze,st)&&delete ue[Fe]}}getTile(ne,ue,ke){const Fe=Math.pow(2,ne),Ue=[];for(const Ze of this.features.values())Ct(Ze,Fe,ue,ke)&&Ue.push(Ft(Ze,Fe,ue,ke));return{features:Ue}}getFeatures(){return[...this.features.values()]}}function Ct({minX:Xe,minY:ne,maxX:ue,maxY:ke},Fe,Ue,Ze){return Xe<(Ue+1+Pi)/Fe&&ne<(Ze+1+Pi)/Fe&&ue>(Ue-Pi)/Fe&&ke>(Ze-Pi)/Fe}function Vi(Xe){const{id:ne,geometry:ue,properties:ke}=Xe;if(!ue)return;if(ue.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Fe,coordinates:Ue}=ue,Ze={id:ne,type:1,geometry:[],tags:ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},st=Ze.geometry;if(Fe==="Point")Qe(Ue,st,Ze);else if(Fe==="MultiPoint")for(const Je of Ue)Qe(Je,st,Ze);else if(Fe==="LineString")Ze.type=2,St(Ue,st,Ze);else if(Fe==="MultiLineString")Ze.type=2,Ht(Ue,st,Ze);else if(Fe==="Polygon")Ze.type=3,Ht(Ue,st,Ze,!0);else{if(Fe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ze.type=3;for(const Je of Ue)Ht(Je,st,Ze,!0)}return Ze}function Qe([Xe,ne],ue,ke){const Fe=i.aF(Xe);let Ue=i.aJ(ne);Ue=Ue<0?0:Ue>1?1:Ue,ue.push(Fe,Ue),ke.minX=Math.min(ke.minX,Fe),ke.minY=Math.min(ke.minY,Ue),ke.maxX=Math.max(ke.maxX,Fe),ke.maxY=Math.max(ke.maxY,Ue)}function St(Xe,ne,ue,ke=!1,Fe=!1){const Ue=[];for(const Ze of Xe)Qe(Ze,Ue,ue);ne.push(Ue),ke&&(function(Ze,st){let Je=0;for(let ct=0,It=Ze.length,Tt=It-2;ct<It;Tt=ct,ct+=2)Je+=(Ze[ct]-Ze[Tt])*(Ze[ct+1]+Ze[Tt+1]);if(Je>0===st)for(let ct=0,It=Ze.length;ct<It/2;ct+=2){const Tt=Ze[ct],ci=Ze[ct+1];Ze[ct]=Ze[It-2-ct],Ze[ct+1]=Ze[It-1-ct],Ze[It-2-ct]=Tt,Ze[It-1-ct]=ci}})(Ue,Fe)}function Ht(Xe,ne,ue,ke=!1){for(let Fe=0;Fe<Xe.length;Fe++)St(Xe[Fe],ne,ue,ke,Fe===0)}function Ft(Xe,ne,ue,ke){const{id:Fe,type:Ue,geometry:Ze,tags:st}=Xe,Je=[];if(Ue===1)(function(ct,It,Tt,ci,Fi){for(let mi=0;mi<ct.length;mi+=2){const tn=Math.round(i.al*(ct[mi+0]*It-Tt)),rn=Math.round(i.al*(ct[mi+1]*It-ci));Fi.push([tn,rn])}})(Ze,ne,ue,ke,Je);else if(Ue===2)for(const ct of Ze)_i(ct,ne,ue,ke,Je);else if(Ue===3)for(const ct of Ze)At(ct,ne,ue,ke,Je);return{id:Fe,type:Ue,geometry:Je,tags:st}}function _i(Xe,ne,ue,ke,Fe){const Ue=-qe,Ze=i.al+qe;let st;for(let Je=0;Je<Xe.length-2;Je+=2){let ct=Math.round(i.al*(Xe[Je+0]*ne-ue)),It=Math.round(i.al*(Xe[Je+1]*ne-ke)),Tt=Math.round(i.al*(Xe[Je+2]*ne-ue)),ci=Math.round(i.al*(Xe[Je+3]*ne-ke));const Fi=Tt-ct,mi=ci-It;ct<Ue&&Tt<Ue||(ct<Ue?(It+=Math.round(mi*((Ue-ct)/Fi)),ct=Ue):Tt<Ue&&(ci=It+Math.round(mi*((Ue-ct)/Fi)),Tt=Ue),It<Ue&&ci<Ue||(It<Ue?(ct+=Math.round(Fi*((Ue-It)/mi)),It=Ue):ci<Ue&&(Tt=ct+Math.round(Fi*((Ue-It)/mi)),ci=Ue),ct>=Ze&&Tt>=Ze||(ct>=Ze?(It+=Math.round(mi*((Ze-ct)/Fi)),ct=Ze):Tt>=Ze&&(ci=It+Math.round(mi*((Ze-ct)/Fi)),Tt=Ze),It>=Ze&&ci>=Ze||(It>=Ze?(ct+=Math.round(Fi*((Ze-It)/mi)),It=Ze):ci>=Ze&&(Tt=ct+Math.round(Fi*((Ze-It)/mi)),ci=Ze),st&&ct===st[st.length-1][0]&&It===st[st.length-1][1]||(st=[[ct,It]],Fe.push(st)),st.push([Tt,ci])))))}}function At(Xe,ne,ue,ke,Fe){const Ue=(ue-Pi)/ne,Ze=(ke-Pi)/ne,st=(ue+1+Pi)/ne,Je=(ke+1+Pi)/ne;function ct(ci,Fi){let mi=0;return ci<Ue?mi|=1:ci>st&&(mi|=2),Fi<Ze?mi|=4:Fi>Je&&(mi|=8),mi}let It=[];for(let ci=1;ci<=8;ci*=2){let Fi=Xe[Xe.length-2],mi=Xe[Xe.length-1],tn=!(ct(Fi,mi)&ci);for(let rn=0;rn<Xe.length;rn+=2){const Xi=Xe[rn],Hi=Xe[rn+1],Gn=!(ct(Xi,Hi)&ci);Gn!==tn&&(8&ci?It.push(Fi+(Xi-Fi)*(Je-mi)/(Hi-mi),Je):4&ci?It.push(Fi+(Xi-Fi)*(Ze-mi)/(Hi-mi),Ze):2&ci?It.push(st,mi+(Hi-mi)*(st-Fi)/(Xi-Fi)):1&ci&&It.push(Ue,mi+(Hi-mi)*(Ue-Fi)/(Xi-Fi))),Gn&&It.push(Xi,Hi),Fi=Xi,mi=Hi,tn=Gn}if(!(Xe=It).length||ci===8)break;It=[]}const Tt=[];for(let ci=0;ci<It.length;ci+=2)Tt.push([Math.round(i.al*(It[ci]*ne-ue)),Math.round(i.al*(It[ci+1]*ne-ke))]);Fe.push(Tt)}function Xt({name:Xe,features:ne},ue){ue.writeStringField(1,Xe),ue.writeVarintField(5,i.al);const ke=new Map,Fe=new Map,Ue={keys:ke,values:Fe,feature:null};for(const Ze of ne)Ue.feature=Ze,ue.writeMessage(2,yn,Ue);for(const Ze of ke.keys())ue.writeStringField(3,Ze);for(const Ze of Fe.keys())ue.writeMessage(4,Ui,Ze)}function yn(Xe,ne){const ue=Xe.feature;ue.id!==void 0&&Number.isSafeInteger(+ue.id)&&ne.writeVarintField(1,+ue.id),ue.tags&&ne.writeMessage(2,fn,Xe),ne.writeVarintField(3,ue.type),ne.writeMessage(4,Un,ue)}function fn({keys:Xe,values:ne,feature:ue},ke){for(const Fe of Object.keys(ue.tags)){let Ue=ue.tags[Fe];if(Ue===null)continue;let Ze=Xe.get(Fe);Ze===void 0&&(Ze=Xe.size,Xe.set(Fe,Ze)),ke.writeVarint(Ze);const st=typeof Ue;st!=="string"&&st!=="boolean"&&st!=="number"&&(Ue=JSON.stringify(Ue));let Je=ne.get(Ue);Je===void 0&&(Je=ne.size,ne.set(Ue,Je)),ke.writeVarint(Je)}}function pn(Xe,ne){return(ne<<3)+(7&Xe)}function sn(Xe){return Xe<<1^Xe>>31}function Un(Xe,ne){const{geometry:ue,type:ke}=Xe;let Fe=0,Ue=0;if(ke===1){ne.writeVarint(pn(1,ue.length));for(const Ze of ue){const st=Ze[0]-Fe,Je=Ze[1]-Ue;ne.writeVarint(sn(st)),ne.writeVarint(sn(Je)),Fe+=st,Ue+=Je}}else for(const Ze of ue){ne.writeVarint(pn(1,1));const st=Ze.length-(ke===3?1:0);for(let Je=0;Je<st;Je++){Je===1&&ne.writeVarint(pn(2,st-1));const ct=Ze[Je][0]-Fe,It=Ze[Je][1]-Ue;ne.writeVarint(sn(ct)),ne.writeVarint(sn(It)),Fe+=ct,Ue+=It}ke===3&&ne.writeVarint(pn(7,1))}}function Ui(Xe,ne){const ue=typeof Xe;ue==="string"?ne.writeStringField(1,Xe):ue==="boolean"?ne.writeBooleanField(7,Xe):ue==="number"&&(Xe%1!=0?ne.writeDoubleField(3,Xe):Xe<0?ne.writeSVarintField(6,Xe):ne.writeVarintField(5,Xe))}const Ii={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xe=>Xe},nn=Math.fround||(mn=new Float32Array(1),Xe=>(mn[0]=+Xe,mn[0]));var mn;const cn=3,Tn=5,Da=6;class Hc{constructor(ne){this.options=Object.assign(Object.create(Ii),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ue,minZoom:ke,maxZoom:Fe}=this.options;ue&&console.time("total time");const Ue=`prepare ${ne.length} points`;ue&&console.time(Ue),this.points=ne;const Ze=[];for(let Je=0;Je<ne.length;Je++){const ct=ne[Je];if(!ct.geometry)continue;const[It,Tt]=ct.geometry.coordinates,ci=nn(ws(It)),Fi=nn(Gs(Tt));Ze.push(ci,Fi,1/0,Je,-1,1),this.options.reduce&&Ze.push(0)}let st=this.trees[Fe+1]=this._createTree(Ze);ue&&console.timeEnd(Ue);for(let Je=Fe;Je>=ke;Je--){const ct=+Date.now();st=this.trees[Je]=this._createTree(this._cluster(st,Je)),ue&&console.log("z%d: %d clusters in %dms",Je,st.numItems,+Date.now()-ct)}return ue&&console.timeEnd("total time"),this}getClusters(ne,ue){let ke=((ne[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,ne[1]));let Ue=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Ze=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ke=-180,Ue=180;else if(ke>Ue){const Tt=this.getClusters([ke,Fe,180,Ze],ue),ci=this.getClusters([-180,Fe,Ue,Ze],ue);return Tt.concat(ci)}const st=this.trees[this._limitZoom(ue)],Je=st.range(ws(ke),Gs(Ze),ws(Ue),Gs(Fe)),ct=st.data,It=[];for(const Tt of Je){const ci=this.stride*Tt;It.push(ct[ci+Tn]>1?Xo(ct,ci,this.clusterProps):this.points[ct[ci+cn]])}return It}getChildren(ne){const ue=this._getOriginId(ne),ke=this._getOriginZoom(ne),Fe="No cluster with the specified id.",Ue=this.trees[ke];if(!Ue)throw new Error(Fe);const Ze=Ue.data;if(ue*this.stride>=Ze.length)throw new Error(Fe);const st=this.options.radius/(this.options.extent*Math.pow(2,ke-1)),Je=Ue.within(Ze[ue*this.stride],Ze[ue*this.stride+1],st),ct=[];for(const It of Je){const Tt=It*this.stride;Ze[Tt+4]===ne&&ct.push(Ze[Tt+Tn]>1?Xo(Ze,Tt,this.clusterProps):this.points[Ze[Tt+cn]])}if(ct.length===0)throw new Error(Fe);return ct}getLeaves(ne,ue,ke){const Fe=[];return this._appendLeaves(Fe,ne,ue=ue||10,ke=ke||0,0),Fe}getTile(ne,ue,ke){const Fe=this.trees[this._limitZoom(ne)],Ue=Math.pow(2,ne),{extent:Ze,radius:st}=this.options,Je=st/Ze,ct=(ke-Je)/Ue,It=(ke+1+Je)/Ue,Tt={features:[]};return this._addTileFeatures(Fe.range((ue-Je)/Ue,ct,(ue+1+Je)/Ue,It),Fe.data,ue,ke,Ue,Tt),ue===0&&this._addTileFeatures(Fe.range(1-Je/Ue,ct,1,It),Fe.data,Ue,ke,Ue,Tt),ue===Ue-1&&this._addTileFeatures(Fe.range(0,ct,Je/Ue,It),Fe.data,-1,ke,Ue,Tt),Tt.features.length?Tt:null}getClusterExpansionZoom(ne){let ue=this._getOriginZoom(ne)-1;for(;ue<=this.options.maxZoom;){const ke=this.getChildren(ne);if(ue++,ke.length!==1)break;ne=ke[0].properties.cluster_id}return ue}_appendLeaves(ne,ue,ke,Fe,Ue){const Ze=this.getChildren(ue);for(const st of Ze){const Je=st.properties;if(Je&&Je.cluster?Ue+Je.point_count<=Fe?Ue+=Je.point_count:Ue=this._appendLeaves(ne,Je.cluster_id,ke,Fe,Ue):Ue<Fe?Ue++:ne.push(st),ne.length===ke)break}return Ue}_createTree(ne){const ue=new i.c4(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ke=0;ke<ne.length;ke+=this.stride)ue.add(ne[ke],ne[ke+1]);return ue.finish(),ue.data=ne,ue}_addTileFeatures(ne,ue,ke,Fe,Ue,Ze){for(const st of ne){const Je=st*this.stride,ct=ue[Je+Tn]>1;let It,Tt,ci;if(ct)It=Hs(ue,Je,this.clusterProps),Tt=ue[Je],ci=ue[Je+1];else{const tn=this.points[ue[Je+cn]];It=tn.properties;const[rn,Xi]=tn.geometry.coordinates;Tt=ws(rn),ci=Gs(Xi)}const Fi={type:1,geometry:[[Math.round(this.options.extent*(Tt*Ue-ke)),Math.round(this.options.extent*(ci*Ue-Fe))]],tags:It};let mi;mi=ct||this.options.generateId?ue[Je+cn]:this.points[ue[Je+cn]].id,mi!==void 0&&(Fi.id=mi),Ze.features.push(Fi)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ue){const{radius:ke,extent:Fe,reduce:Ue,minPoints:Ze}=this.options,st=ke/(Fe*Math.pow(2,ue)),Je=ne.data,ct=[],It=this.stride;for(let Tt=0;Tt<Je.length;Tt+=It){if(Je[Tt+2]<=ue)continue;Je[Tt+2]=ue;const ci=Je[Tt],Fi=Je[Tt+1],mi=ne.within(Je[Tt],Je[Tt+1],st),tn=Je[Tt+Tn];let rn=tn;for(const Xi of mi){const Hi=Xi*It;Je[Hi+2]>ue&&(rn+=Je[Hi+Tn])}if(rn>tn&&rn>=Ze){let Xi,Hi=ci*tn,Gn=Fi*tn,Oa=-1;const Ea=(Tt/It<<5)+(ue+1)+this.points.length;for(const Jn of mi){const gn=Jn*It;if(Je[gn+2]<=ue)continue;Je[gn+2]=ue;const an=Je[gn+Tn];Hi+=Je[gn]*an,Gn+=Je[gn+1]*an,Je[gn+4]=Ea,Ue&&(Xi||(Xi=this._map(Je,Tt,!0),Oa=this.clusterProps.length,this.clusterProps.push(Xi)),Ue(Xi,this._map(Je,gn)))}Je[Tt+4]=Ea,ct.push(Hi/rn,Gn/rn,1/0,Ea,-1,rn),Ue&&ct.push(Oa)}else{for(let Xi=0;Xi<It;Xi++)ct.push(Je[Tt+Xi]);if(rn>1)for(const Xi of mi){const Hi=Xi*It;if(!(Je[Hi+2]<=ue)){Je[Hi+2]=ue;for(let Gn=0;Gn<It;Gn++)ct.push(Je[Hi+Gn])}}}}return ct}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ue,ke){if(ne[ue+Tn]>1){const Ze=this.clusterProps[ne[ue+Da]];return ke?Object.assign({},Ze):Ze}const Fe=this.points[ne[ue+cn]].properties,Ue=this.options.map(Fe);return ke&&Ue===Fe?Object.assign({},Ue):Ue}}function Xo(Xe,ne,ue){return{type:"Feature",id:Xe[ne+cn],properties:Hs(Xe,ne,ue),geometry:{type:"Point",coordinates:[(ke=Xe[ne],360*(ke-.5)),Hr(Xe[ne+1])]}};var ke}function Hs(Xe,ne,ue){const ke=Xe[ne+Tn],Fe=ke>=1e4?`${Math.round(ke/1e3)}k`:ke>=1e3?Math.round(ke/100)/10+"k":ke,Ue=Xe[ne+Da],Ze=Ue===-1?{}:Object.assign({},ue[Ue]);return Object.assign(Ze,{cluster:!0,cluster_id:Xe[ne+cn],point_count:ke,point_count_abbreviated:Fe})}function ws(Xe){return Xe/360+.5}function Gs(Xe){const ne=Math.sin(Xe*Math.PI/180),ue=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ue<0?0:ue>1?1:ue}function Hr(Xe){const ne=(180-360*Xe)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function Yo(Xe,ne,ue,ke){let Fe=ke;const Ue=ne+(ue-ne>>1);let Ze,st=ue-ne;const Je=Xe[ne],ct=Xe[ne+1],It=Xe[ue],Tt=Xe[ue+1];for(let ci=ne+3;ci<ue;ci+=3){const Fi=Jr(Xe[ci],Xe[ci+1],Je,ct,It,Tt);if(Fi>Fe)Ze=ci,Fe=Fi;else if(Fi===Fe){const mi=Math.abs(ci-Ue);mi<st&&(Ze=ci,st=mi)}}Fe>ke&&(Ze-ne>3&&Yo(Xe,ne,Ze,ke),Xe[Ze+2]=Fe,ue-Ze>3&&Yo(Xe,Ze,ue,ke))}function Jr(Xe,ne,ue,ke,Fe,Ue){let Ze=Fe-ue,st=Ue-ke;if(Ze!==0||st!==0){const Je=((Xe-ue)*Ze+(ne-ke)*st)/(Ze*Ze+st*st);Je>1?(ue=Fe,ke=Ue):Je>0&&(ue+=Ze*Je,ke+=st*Je)}return Ze=Xe-ue,st=ne-ke,Ze*Ze+st*st}function er(Xe,ne,ue,ke){const Fe={id:Xe??null,type:ne,geometry:ue,tags:ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")ds(Fe,ue);else if(ne==="Polygon")ds(Fe,ue[0]);else if(ne==="MultiLineString")for(const Ue of ue)ds(Fe,Ue);else if(ne==="MultiPolygon")for(const Ue of ue)ds(Fe,Ue[0]);return Fe}function ds(Xe,ne){for(let ue=0;ue<ne.length;ue+=3)Xe.minX=Math.min(Xe.minX,ne[ue]),Xe.minY=Math.min(Xe.minY,ne[ue+1]),Xe.maxX=Math.max(Xe.maxX,ne[ue]),Xe.maxY=Math.max(Xe.maxY,ne[ue+1])}function pr(Xe,ne,ue,ke){if(!ne.geometry)return;const Fe=ne.geometry.coordinates;if(Fe&&Fe.length===0)return;const Ue=ne.geometry.type,Ze=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2);let st=[],Je=ne.id;if(ue.promoteId?Je=ne.properties[ue.promoteId]:ue.generateId&&(Je=ke||0),Ue==="Point")dl(Fe,st);else if(Ue==="MultiPoint")for(const ct of Fe)dl(ct,st);else if(Ue==="LineString")Ql(Fe,st,Ze,!1);else if(Ue==="MultiLineString"){if(ue.lineMetrics){for(const ct of Fe)st=[],Ql(ct,st,Ze,!1),Xe.push(er(Je,"LineString",st,ne.properties));return}qs(Fe,st,Ze,!1)}else if(Ue==="Polygon")qs(Fe,st,Ze,!0);else{if(Ue!=="MultiPolygon"){if(Ue==="GeometryCollection"){for(const ct of ne.geometry.geometries)pr(Xe,{id:Je,geometry:ct,properties:ne.properties},ue,ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ct of Fe){const It=[];qs(ct,It,Ze,!0),st.push(It)}}Xe.push(er(Je,Ue,st,ne.properties))}function dl(Xe,ne){ne.push(Ko(Xe[0]),vr(Xe[1]),0)}function Ql(Xe,ne,ue,ke){let Fe,Ue,Ze=0;for(let Je=0;Je<Xe.length;Je++){const ct=Ko(Xe[Je][0]),It=vr(Xe[Je][1]);ne.push(ct,It,0),Je>0&&(Ze+=ke?(Fe*It-ct*Ue)/2:Math.sqrt(Math.pow(ct-Fe,2)+Math.pow(It-Ue,2))),Fe=ct,Ue=It}const st=ne.length-3;ne[2]=1,Yo(ne,0,st,ue),ne[st+2]=1,ne.size=Math.abs(Ze),ne.start=0,ne.end=ne.size}function qs(Xe,ne,ue,ke){for(let Fe=0;Fe<Xe.length;Fe++){const Ue=[];Ql(Xe[Fe],Ue,ue,ke),ne.push(Ue)}}function Ko(Xe){return Xe/360+.5}function vr(Xe){const ne=Math.sin(Xe*Math.PI/180),ue=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ue<0?0:ue>1?1:ue}function Ir(Xe,ne,ue,ke,Fe,Ue,Ze,st){if(ke/=ne,Ue>=(ue/=ne)&&Ze<ke)return Xe;if(Ze<ue||Ue>=ke)return null;const Je=[];for(const ct of Xe){const It=ct.geometry;let Tt=ct.type;const ci=Fe===0?ct.minX:ct.minY,Fi=Fe===0?ct.maxX:ct.maxY;if(ci>=ue&&Fi<ke){Je.push(ct);continue}if(Fi<ue||ci>=ke)continue;let mi=[];if(Tt==="Point"||Tt==="MultiPoint")ec(It,mi,ue,ke,Fe);else if(Tt==="LineString")Ss(It,mi,ue,ke,Fe,!1,st.lineMetrics);else if(Tt==="MultiLineString")Jo(It,mi,ue,ke,Fe,!1);else if(Tt==="Polygon")Jo(It,mi,ue,ke,Fe,!0);else if(Tt==="MultiPolygon")for(const tn of It){const rn=[];Jo(tn,rn,ue,ke,Fe,!0),rn.length&&mi.push(rn)}if(mi.length){if(st.lineMetrics&&Tt==="LineString"){for(const tn of mi)Je.push(er(ct.id,Tt,tn,ct.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(mi.length===1?(Tt="LineString",mi=mi[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=mi.length===3?"Point":"MultiPoint"),Je.push(er(ct.id,Tt,mi,ct.tags))}}return Je.length?Je:null}function ec(Xe,ne,ue,ke,Fe){for(let Ue=0;Ue<Xe.length;Ue+=3){const Ze=Xe[Ue+Fe];Ze>=ue&&Ze<=ke&&Ws(ne,Xe[Ue],Xe[Ue+1],Xe[Ue+2])}}function Ss(Xe,ne,ue,ke,Fe,Ue,Ze){let st=po(Xe);const Je=Fe===0?tc:go;let ct,It,Tt=Xe.start;for(let rn=0;rn<Xe.length-3;rn+=3){const Xi=Xe[rn],Hi=Xe[rn+1],Gn=Xe[rn+2],Oa=Xe[rn+3],Ea=Xe[rn+4],Jn=Fe===0?Xi:Hi,gn=Fe===0?Oa:Ea;let an=!1;Ze&&(ct=Math.sqrt(Math.pow(Xi-Oa,2)+Math.pow(Hi-Ea,2))),Jn<ue?gn>ue&&(It=Je(st,Xi,Hi,Oa,Ea,ue),Ze&&(st.start=Tt+ct*It)):Jn>ke?gn<ke&&(It=Je(st,Xi,Hi,Oa,Ea,ke),Ze&&(st.start=Tt+ct*It)):Ws(st,Xi,Hi,Gn),gn<ue&&Jn>=ue&&(It=Je(st,Xi,Hi,Oa,Ea,ue),an=!0),gn>ke&&Jn<=ke&&(It=Je(st,Xi,Hi,Oa,Ea,ke),an=!0),!Ue&&an&&(Ze&&(st.end=Tt+ct*It),ne.push(st),st=po(Xe)),Ze&&(Tt+=ct)}let ci=Xe.length-3;const Fi=Xe[ci],mi=Xe[ci+1],tn=Fe===0?Fi:mi;tn>=ue&&tn<=ke&&Ws(st,Fi,mi,Xe[ci+2]),ci=st.length-3,Ue&&ci>=3&&(st[ci]!==st[0]||st[ci+1]!==st[1])&&Ws(st,st[0],st[1],st[2]),st.length&&ne.push(st)}function po(Xe){const ne=[];return ne.size=Xe.size,ne.start=Xe.start,ne.end=Xe.end,ne}function Jo(Xe,ne,ue,ke,Fe,Ue){for(const Ze of Xe)Ss(Ze,ne,ue,ke,Fe,Ue,!1)}function Ws(Xe,ne,ue,ke){Xe.push(ne,ue,ke)}function tc(Xe,ne,ue,ke,Fe,Ue){const Ze=(Ue-ne)/(ke-ne);return Ws(Xe,Ue,ue+(Fe-ue)*Ze,1),Ze}function go(Xe,ne,ue,ke,Fe,Ue){const Ze=(Ue-ue)/(Fe-ue);return Ws(Xe,ne+(ke-ne)*Ze,Ue,1),Ze}function Za(Xe,ne){const ue=[];for(let ke=0;ke<Xe.length;ke++){const Fe=Xe[ke],Ue=Fe.type;let Ze;if(Ue==="Point"||Ue==="MultiPoint"||Ue==="LineString")Ze=Ur(Fe.geometry,ne);else if(Ue==="MultiLineString"||Ue==="Polygon"){Ze=[];for(const st of Fe.geometry)Ze.push(Ur(st,ne))}else if(Ue==="MultiPolygon"){Ze=[];for(const st of Fe.geometry){const Je=[];for(const ct of st)Je.push(Ur(ct,ne));Ze.push(Je)}}ue.push(er(Fe.id,Ue,Ze,Fe.tags))}return ue}function Ur(Xe,ne){const ue=[];ue.size=Xe.size,Xe.start!==void 0&&(ue.start=Xe.start,ue.end=Xe.end);for(let ke=0;ke<Xe.length;ke+=3)ue.push(Xe[ke]+ne,Xe[ke+1],Xe[ke+2]);return ue}function ic(Xe,ne){if(Xe.transformed)return Xe;const ue=1<<Xe.z,ke=Xe.x,Fe=Xe.y;for(const Ue of Xe.features){const Ze=Ue.geometry,st=Ue.type;if(Ue.geometry=[],st===1)for(let Je=0;Je<Ze.length;Je+=2)Ue.geometry.push(Ro(Ze[Je],Ze[Je+1],ne,ue,ke,Fe));else for(let Je=0;Je<Ze.length;Je++){const ct=[];for(let It=0;It<Ze[Je].length;It+=2)ct.push(Ro(Ze[Je][It],Ze[Je][It+1],ne,ue,ke,Fe));Ue.geometry.push(ct)}}return Xe.transformed=!0,Xe}function Ro(Xe,ne,ue,ke,Fe,Ue){return[Math.round(ue*(Xe*ke-Fe)),Math.round(ue*(ne*ke-Ue))]}function _o(Xe,ne,ue,ke,Fe){const Ue=ne===Fe.maxZoom?0:Fe.tolerance/((1<<ne)*Fe.extent),Ze={features:[],numPoints:0,numSimplified:0,numFeatures:Xe.length,source:null,x:ue,y:ke,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const st of Xe)ku(Ze,st,Ue,Fe);return Ze}function ku(Xe,ne,ue,ke){const Fe=ne.geometry,Ue=ne.type,Ze=[];if(Xe.minX=Math.min(Xe.minX,ne.minX),Xe.minY=Math.min(Xe.minY,ne.minY),Xe.maxX=Math.max(Xe.maxX,ne.maxX),Xe.maxY=Math.max(Xe.maxY,ne.maxY),Ue==="Point"||Ue==="MultiPoint")for(let st=0;st<Fe.length;st+=3)Ze.push(Fe[st],Fe[st+1]),Xe.numPoints++,Xe.numSimplified++;else if(Ue==="LineString")Me(Ze,Fe,Xe,ue,!1,!1);else if(Ue==="MultiLineString"||Ue==="Polygon")for(let st=0;st<Fe.length;st++)Me(Ze,Fe[st],Xe,ue,Ue==="Polygon",st===0);else if(Ue==="MultiPolygon")for(let st=0;st<Fe.length;st++){const Je=Fe[st];for(let ct=0;ct<Je.length;ct++)Me(Ze,Je[ct],Xe,ue,!0,ct===0)}if(Ze.length){let st=ne.tags||null;if(Ue==="LineString"&&ke.lineMetrics){st={};for(const ct in ne.tags)st[ct]=ne.tags[ct];st.mapbox_clip_start=Fe.start/Fe.size,st.mapbox_clip_end=Fe.end/Fe.size}const Je={geometry:Ze,type:Ue==="Polygon"||Ue==="MultiPolygon"?3:Ue==="LineString"||Ue==="MultiLineString"?2:1,tags:st};ne.id!==null&&(Je.id=ne.id),Xe.features.push(Je)}}function Me(Xe,ne,ue,ke,Fe,Ue){const Ze=ke*ke;if(ke>0&&ne.size<(Fe?Ze:ke))return void(ue.numPoints+=ne.length/3);const st=[];for(let Je=0;Je<ne.length;Je+=3)(ke===0||ne[Je+2]>Ze)&&(ue.numSimplified++,st.push(ne[Je],ne[Je+1])),ue.numPoints++;Fe&&(function(Je,ct){let It=0;for(let Tt=0,ci=Je.length,Fi=ci-2;Tt<ci;Fi=Tt,Tt+=2)It+=(Je[Tt]-Je[Fi])*(Je[Tt+1]+Je[Fi+1]);if(It>0===ct)for(let Tt=0,ci=Je.length;Tt<ci/2;Tt+=2){const Fi=Je[Tt],mi=Je[Tt+1];Je[Tt]=Je[ci-2-Tt],Je[Tt+1]=Je[ci-1-Tt],Je[ci-2-Tt]=Fi,Je[ci-1-Tt]=mi}})(st,Ue),Xe.push(st)}const Rt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ii{constructor(ne,ue){const ke=(ue=this.options=(function(Ue,Ze){for(const st in Ze)Ue[st]=Ze[st];return Ue})(Object.create(Rt),ue)).debug;if(ke&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");let Fe=(function(Ue,Ze){const st=[];if(Ue.type==="FeatureCollection")for(let Je=0;Je<Ue.features.length;Je++)pr(st,Ue.features[Je],Ze,Je);else pr(st,Ue.type==="Feature"?Ue:{geometry:Ue},Ze);return st})(ne,ue);this.tiles={},this.tileCoords=[],ke&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Fe=(function(Ue,Ze){const st=Ze.buffer/Ze.extent;let Je=Ue;const ct=Ir(Ue,1,-1-st,st,0,-1,2,Ze),It=Ir(Ue,1,1-st,2+st,0,-1,2,Ze);return(ct||It)&&(Je=Ir(Ue,1,-st,1+st,0,-1,2,Ze)||[],ct&&(Je=Za(ct,1).concat(Je)),It&&(Je=Je.concat(Za(It,-1)))),Je})(Fe,ue),Fe.length&&this.splitTile(Fe,0,0,0),ke&&(Fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,ue,ke,Fe,Ue,Ze,st){const Je=[ne,ue,ke,Fe],ct=this.options,It=ct.debug;for(;Je.length;){Fe=Je.pop(),ke=Je.pop(),ue=Je.pop(),ne=Je.pop();const Tt=1<<ue,ci=Ai(ue,ke,Fe);let Fi=this.tiles[ci];if(!Fi&&(It>1&&console.time("creation"),Fi=this.tiles[ci]=_o(ne,ue,ke,Fe,ct),this.tileCoords.push({z:ue,x:ke,y:Fe}),It)){It>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,ke,Fe,Fi.numFeatures,Fi.numPoints,Fi.numSimplified),console.timeEnd("creation"));const an=`z${ue}`;this.stats[an]=(this.stats[an]||0)+1,this.total++}if(Fi.source=ne,Ue==null){if(ue===ct.indexMaxZoom||Fi.numPoints<=ct.indexMaxPoints)continue}else{if(ue===ct.maxZoom||ue===Ue)continue;if(Ue!=null){const an=Ue-ue;if(ke!==Ze>>an||Fe!==st>>an)continue}}if(Fi.source=null,ne.length===0)continue;It>1&&console.time("clipping");const mi=.5*ct.buffer/ct.extent,tn=.5-mi,rn=.5+mi,Xi=1+mi;let Hi=null,Gn=null,Oa=null,Ea=null,Jn=Ir(ne,Tt,ke-mi,ke+rn,0,Fi.minX,Fi.maxX,ct),gn=Ir(ne,Tt,ke+tn,ke+Xi,0,Fi.minX,Fi.maxX,ct);ne=null,Jn&&(Hi=Ir(Jn,Tt,Fe-mi,Fe+rn,1,Fi.minY,Fi.maxY,ct),Gn=Ir(Jn,Tt,Fe+tn,Fe+Xi,1,Fi.minY,Fi.maxY,ct),Jn=null),gn&&(Oa=Ir(gn,Tt,Fe-mi,Fe+rn,1,Fi.minY,Fi.maxY,ct),Ea=Ir(gn,Tt,Fe+tn,Fe+Xi,1,Fi.minY,Fi.maxY,ct),gn=null),It>1&&console.timeEnd("clipping"),Je.push(Hi||[],ue+1,2*ke,2*Fe),Je.push(Gn||[],ue+1,2*ke,2*Fe+1),Je.push(Oa||[],ue+1,2*ke+1,2*Fe),Je.push(Ea||[],ue+1,2*ke+1,2*Fe+1)}}getTile(ne,ue,ke){ne=+ne,ue=+ue,ke=+ke;const Fe=this.options,{extent:Ue,debug:Ze}=Fe;if(ne<0||ne>24)return null;const st=1<<ne,Je=Ai(ne,ue=ue+st&st-1,ke);if(this.tiles[Je])return ic(this.tiles[Je],Ue);Ze>1&&console.log("drilling down to z%d-%d-%d",ne,ue,ke);let ct,It=ne,Tt=ue,ci=ke;for(;!ct&&It>0;)It--,Tt>>=1,ci>>=1,ct=this.tiles[Ai(It,Tt,ci)];return ct&&ct.source?(Ze>1&&(console.log("found parent tile z%d-%d-%d",It,Tt,ci),console.time("drilling down")),this.splitTile(ct.source,It,Tt,ci,ne,ue,ke),Ze>1&&console.timeEnd("drilling down"),this.tiles[Je]?ic(this.tiles[Je],Ue):null):null}}function Ai(Xe,ne,ue){return 32*((1<<Xe)*ue+ne)+Xe}function ui(Xe,ne){const ue=Xe.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const ke=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!ke)return void ne(null,null);const Fe=ct=>ct.tags&&"3d_elevation_id"in ct.tags&&"source"in ct.tags&&ct.tags.source==="elevation",Ue=ke.features.filter((ct=>Fe(ct)));let Ze={_geojsonTileLayer:ke.features};Ue.length>0&&(Ze={_geojsonTileLayer:ke.features.filter((ct=>!Fe(ct))),hd_road_elevation:Ue});const st=new Di(Ze),Je=(function(ct){const It=new i.bt;for(const Tt of Object.keys(ct))It.writeMessage(3,Xt,{name:Tt,features:ct[Tt]});return It.finish()})(Ze).buffer;ne(null,{vectorTile:st,rawData:Je})}class Wi extends et{constructor(ne,ue,ke,Fe,Ue,Ze,st){super(ne,ue,ke,Fe,Ue,ui,st),Ze&&(this.loadGeoJSON=Ze),this._dynamicIndex=new wt}loadData(ne,ue){const ke=ne&&ne.request,Fe=ke&&ke.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ne,((Ue,Ze)=>{if(Ue||!Ze)return ue(Ue);if(typeof Ze!="object")return ue(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const Je=i.U(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Je.result==="error")throw new Error(Je.value.map((ct=>`${ct.key}: ${ct.message}`)).join(", "));Ze.features=Ze.features.filter((ct=>Je.value.evaluate({zoom:0},ct)))}ne.dynamic?(Ze.type==="Feature"&&(Ze={type:"FeatureCollection",features:[Ze]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ze.features,this.loaded),ne.cluster&&(Ze.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new Hc((function({superclusterOptions:Je,clusterProperties:ct}){if(!ct||!Je)return Je;const It={},Tt={},ci={accumulated:null,zoom:0},Fi={properties:null},mi=Object.keys(ct);for(const tn of mi){const[rn,Xi]=ct[tn],Hi=i.U(Xi),Gn=i.U(typeof rn=="string"?[rn,["accumulated"],["get",tn]]:rn);It[tn]=Hi.value,Tt[tn]=Gn.value}return Je.map=tn=>{Fi.properties=tn;const rn={};for(const Xi of mi)rn[Xi]=It[Xi].evaluate(ci,Fi);return rn},Je.reduce=(tn,rn)=>{Fi.properties=rn;for(const Xi of mi)ci.accumulated=tn[Xi],tn[Xi]=Tt[Xi].evaluate(ci,Fi)},Je})(ne)).load(Ze.features):ne.dynamic?this._dynamicIndex:(function(Je,ct){return new ii(Je,ct)})(Ze,ne.geojsonVtOptions)}catch(Je){return ue(Je)}const st={};if(Fe){const Je=C(ke);Je&&(st.resourceTiming={},st.resourceTiming[ne.source]=JSON.parse(JSON.stringify(Je)))}ue(null,st)}}))}reloadTile(ne,ue){const ke=this.loaded;return ke&&ke[ne.uid]?ne.partial?ue(null,void 0):super.reloadTile(ne,ue):this.loadTile(ne,ue)}loadGeoJSON(ne,ue){if(ne.request)i.m(ne.request,ue);else{if(typeof ne.data!="string")return ue(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return ue(null,JSON.parse(ne.data))}catch{return ue(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(ne,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(ke){ue(ke)}}getClusterChildren(ne,ue){try{ue(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(ke){ue(ke)}}getClusterLeaves(ne,ue){try{ue(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(ke){ue(ke)}}}class Ti{constructor(ne,ue,ke){this.tileID=new i.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=ue,this.worldview=ke}parse(ne,ue,ke,Fe){this.status="parsing";const Ue=new i.aQ(ke.tileID.overscaledZ,ke.tileID.wrap,ke.tileID.canonical.z,ke.tileID.canonical.x,ke.tileID.canonical.y),Ze=[],st=ue.familiesBySource[ke.source],Je=new i.fn(Ue,ke.promoteId);Je.bucketLayerIDs=[],Je.is3DTile=!0,i.fC(ne).then((ct=>{if(!ct)return Fe(new Error("Could not parse tile"));const It=ct.json.extensionsUsed&&ct.json.extensionsUsed.includes("MAPBOX_mesh_features")||ct.json.asset.extras&&ct.json.asset.extras.MAPBOX_mesh_features,Tt=ct.json.extensionsUsed&&ct.json.extensionsUsed.includes("EXT_meshopt_compression"),ci=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Fi in st)for(const mi of st[Fi]){const tn=mi[0];Je.bucketLayerIDs.push(mi.map((Hi=>i.B(Hi.id,Hi.scope)))),tn.recalculate(ci,[]);const rn=i.fD(ct,1/i.d7(ke.tileID.canonical)),Xi=new i.fE(mi,rn,Ue,It,Tt,this.brightness,Je,this.worldview);It||(Xi.needsUpload=!0),Ze.push(Xi),Xi.evaluate(tn)}this.status="done",Fe(null,{buckets:Ze,featureIndex:Je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((ct=>Fe(new Error(ct.message))))}}class vn{constructor(ne,ue,ke,Fe,Ue,Ze,st,Je){this.actor=ne,this.layerIndex=ue,this.availableImages=ke,this.availableModels=Fe,this.brightness=st,this.loading={},this.loaded={},this.worldview=Je}loadTile(ne,ue){const ke=ne.uid,Fe=this.loading[ke]=new Ti(ne,this.brightness,this.worldview);i.bu(ne.request,((Ue,Ze)=>{const st=!this.loading[ke];return delete this.loading[ke],st||Ue?(Fe.status="done",st||(this.loaded[ke]=Fe),ue(Ue)):Ze&&Ze.byteLength!==0?void Fe.parse(Ze,this.layerIndex,ne,((Je,ct)=>{Fe.status="done",this.loaded=this.loaded||{},this.loaded[ke]=Fe,Je||!ct?ue(Je):ue(null,ct)})):(Fe.status="done",this.loaded[ke]=Fe,ue())}))}reloadTile(ne,ue){const ke=this.loaded,Fe=ne.uid;if(ke&&ke[Fe]){const Ue=ke[Fe];Ue.projection=ne.projection,Ue.brightness=ne.brightness;const Ze=(st,Je)=>{Ue.reloadCallback&&(delete Ue.reloadCallback,this.loadTile(ne,ue)),ue(st,Je)};Ue.status==="parsing"?Ue.reloadCallback=Ze:Ue.status==="done"&&this.loadTile(ne,ue)}}abortTile(ne,ue){const ke=ne.uid;this.loading[ke]&&delete this.loading[ke],ue()}removeTile(ne,ue){const ke=this.loaded,Fe=ne.uid;ke&&ke[Fe]&&delete ke[Fe],ue()}}class Mn{constructor(ne){this.self=ne,this.actor=new i.fG(ne,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cm({name:"mercator"}),this.workerSourceTypes={vector:et,geojson:Wi,"raster-dem":at,"raster-array":lt,"batched-model":vn},this.workerSources={},this.self.registerWorkerSource=(ue,ke)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=ke},this.self.registerRTLTextPlugin=ue=>{if(i.fH.isParsed())throw new Error("RTL text plugin already registered.");i.fH.setState({pluginStatus:i.fI.parsed,pluginURL:i.fH.getPluginURL()}),i.fH.applyArabicShaping=ue.applyArabicShaping,i.fH.processBidirectionalText=ue.processBidirectionalText,i.fH.processStyledBidirectionalText=ue.processStyledBidirectionalText;for(const ke of this.rtlPluginParsingListeners)ke(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ne,ue,ke){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.availableModels[ne],delete this.workerSources[ne],ke()}checkIfReady(ne,ue,ke){ke()}setReferrer(ne,ue){this.referrer=ue}spriteLoaded(ne,ue){this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={});const{scope:ke,isLoaded:Fe}=ue;if(this.isSpriteLoaded[ne][ke]=Fe,this.workerSources[ne]&&this.workerSources[ne][ke])for(const Ue in this.workerSources[ne][ke]){const Ze=this.workerSources[ne][ke][Ue];for(const st in Ze){const Je=Ze[st];Je instanceof et&&(Je.isSpriteLoaded=Fe,Je.fire(new i.z("isSpriteLoaded")))}}}setImages(ne,ue,ke){this.availableImages[ne]||(this.availableImages[ne]={});const{scope:Fe,images:Ue}=ue;if(this.availableImages[ne][Fe]=Ue,this.workerSources[ne]&&this.workerSources[ne][Fe]){for(const Ze in this.workerSources[ne][Fe]){const st=this.workerSources[ne][Fe][Ze];for(const Je in st)st[Je].availableImages=Ue}ke()}else ke()}setModels(ne,{scope:ue,models:ke},Fe){if(this.availableModels[ne]||(this.availableModels[ne]={}),this.availableModels[ne][ue]=ke,this.workerSources[ne]&&this.workerSources[ne][ue]){for(const Ue in this.workerSources[ne][ue]){const Ze=this.workerSources[ne][ue][Ue];for(const st in Ze)Ze[st].availableModels=ke}Fe()}else Fe()}setProjection(ne,ue){this.projections[ne]=i.cm(ue)}setBrightness(ne,ue,ke){this.brightness=ue,ke()}setWorldview(ne,ue,ke){this.worldview=ue,ke()}setLayers(ne,ue,ke){this.getLayerIndex(ne,ue.scope).replace(ue.layers,ue.options),ke()}updateLayers(ne,ue,ke){this.getLayerIndex(ne,ue.scope).update(ue.layers,ue.removedIds,ue.options),ke()}loadTile(ne,ue,ke){ue.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ue.type,ue.source,ue.scope).loadTile(ue,ke)}decodeRasterArray(ne,ue,ke){this.getWorkerSource(ne,ue.type,ue.source,ue.scope).decodeRasterArray(ue,ke)}reloadTile(ne,ue,ke){ue.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ue.type,ue.source,ue.scope).reloadTile(ue,ke)}abortTile(ne,ue,ke){this.getWorkerSource(ne,ue.type,ue.source,ue.scope).abortTile(ue,ke)}removeTile(ne,ue,ke){this.getWorkerSource(ne,ue.type,ue.source,ue.scope).removeTile(ue,ke)}removeSource(ne,ue,ke){if(!(this.workerSources[ne]&&this.workerSources[ne][ue.scope]&&this.workerSources[ne][ue.scope][ue.type]&&this.workerSources[ne][ue.scope][ue.type][ue.source]))return;const Fe=this.workerSources[ne][ue.scope][ue.type][ue.source];delete this.workerSources[ne][ue.scope][ue.type][ue.source],Fe.removeSource!==void 0?Fe.removeSource(ue,ke):ke()}loadWorkerSource(ne,ue,ke){try{this.self.importScripts(ue.url),ke()}catch(Fe){ke(Fe)}}syncRTLPluginState(ne,ue,ke){if(i.fH.isParsed())ke(null,!0);else if(i.fH.isParsing())this.rtlPluginParsingListeners.push(ke);else try{i.fH.setState(ue);const Fe=i.fH.getPluginURL();!i.fH.isLoaded()||i.fH.isParsed()||i.fH.isParsing()||Fe==null||(i.fH.setState({pluginStatus:i.fI.parsing,pluginURL:i.fH.getPluginURL()}),this.self.importScripts(Fe),i.fH.isParsed()?ke(null,!0):this.rtlPluginParsingListeners.push(ke))}catch(Fe){ke(Fe)}}setDracoUrl(ne,ue){this.dracoUrl=ue}getAvailableImages(ne,ue){this.availableImages[ne]||(this.availableImages[ne]={});let ke=this.availableImages[ne][ue];return ke||(ke=[]),ke}getAvailableModels(ne,ue){this.availableModels[ne]||(this.availableModels[ne]={});let ke=this.availableModels[ne][ue];return ke||(ke={}),ke}getLayerIndex(ne,ue){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let ke=this.layerIndexes[ne][ue];return ke||(ke=this.layerIndexes[ne][ue]=new $,ke.scope=ue),ke}getWorkerSource(ne,ue,ke,Fe){const Ue=this.workerSources;return Ue[ne]||(Ue[ne]={}),Ue[ne][Fe]||(Ue[ne][Fe]={}),Ue[ne][Fe][ue]||(Ue[ne][Fe][ue]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),Ue[ne][Fe][ue][ke]||(Ue[ne][Fe][ue][ke]=new this.workerSourceTypes[ue]({send:(Ze,st,Je,ct,It,Tt)=>this.actor.send(Ze,st,Je,ne,It,Tt),scheduler:this.actor.scheduler},this.getLayerIndex(ne,Fe),this.getAvailableImages(ne,Fe),this.getAvailableModels(ne,Fe),this.isSpriteLoaded[ne][Fe],void 0,this.brightness,this.worldview)),Ue[ne][Fe][ue][ke]}rasterizeImagesWorker(ne,ue,ke){const Fe=new Map;for(const[Ue,{image:Ze,imageVariant:st}]of ue.tasks.entries()){const Je=this.imageRasterizer.rasterize(st,Ze,ue.scope,ne);Fe.set(Ue,Je)}ke(void 0,Fe)}removeRasterizedImages(ne,ue,ke){this.imageRasterizer.removeImagesFromCacheByIds(ue.imageIds,ue.scope,ne),ke()}enforceCacheSizeLimit(ne,ue){i.fJ(ue)}getWorkerPerformanceMetrics(ne,ue,ke){ke(void 0,void 0)}}return i.fF(self)&&(self.worker=new Mn(self)),Mn})),y(["./shared"],(function(i){var C="3.17.0";const P={create:"create",load:"load",fullLoad:"fullLoad"},D={mark(m){performance.mark(m)},measure(m,t,o){performance.measure(m,t,o)}};function $(m){const t=m.name.split("?")[0];return i.a(t)&&t.includes("mapbox-gl.js")?"javascript":i.a(t)&&t.includes("mapbox-gl.css")?"css":i.b(t)?"fontRange":i.c(t)?"sprite":i.i(t)?"style":i.d(t)?"tilejson":"other"}var G,X={},te=(function(){if(G)return X;function m(p){return!t(p)}function t(p){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,E,j=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(j);try{E=new Worker(O),T=!0}catch{T=!1}return E&&E.terminate(),URL.revokeObjectURL(O),T})()?(function(){var T=document.createElement("canvas");T.width=T.height=1;var E=T.getContext("2d");if(!E)return!1;var j=E.getImageData(0,0,1,1);return j&&j.width===T.width})()?(o[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(o[x]=(function(T){var E,j=(function(O){var B=document.createElement("canvas"),H=Object.create(m.webGLContextAttributes);return H.failIfMajorPerformanceCaveat=O,B.getContext("webgl2",H)})(T);if(!j)return!1;try{E=j.createShader(j.VERTEX_SHADER)}catch{return!1}return!(!E||j.isContextLost())&&(j.shaderSource(E,"void main() {}"),j.compileShader(E),j.getShaderParameter(E,j.COMPILE_STATUS)===!0)})(x)),o[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}G=1,X.supported=m,X.notSupportedReason=t;var o={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},X})();function le(m,t,o){const p=document.createElement(m);return t!=null&&(p.className=t),o&&o.appendChild(p),p}function re(m,t,o){const p=document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(t))p.setAttributeNS(null,x,String(t[x]));return o&&o.appendChild(p),p}const fe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,xe=fe&&fe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let be;function Ne(){fe&&xe&&(be=fe[xe],fe[xe]="none")}function Be(){fe&&xe&&(fe[xe]=be)}function Ee(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Ee,!0)}function et(){window.addEventListener("click",Ee,!0),window.setTimeout((()=>{window.removeEventListener("click",Ee,!0)}),0)}function at(m,t){const o=m.getBoundingClientRect();return pt(m,o,t)}function He(m,t){const o=m.getBoundingClientRect(),p=[];for(let x=0;x<t.length;x++)p.push(pt(m,o,t[x]));return p}function lt(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function pt(m,t,o){const p=m.offsetWidth===t.width?1:m.offsetWidth/t.width;return new i.P((o.clientX-t.left)*p,(o.clientY-t.top)*p)}const Zt="01",jt="NO_ACCESS_TOKEN";class Di{constructor(t,o,p){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const t=(function(){let o="";for(let p=0;p<10;p++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Zt,o].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!i.h(t))return t;const p=qe(t);return p.params.push(`sdk=js-${C}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!i.h(t))return t;const p=qe(t);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||o)}normalizeModelURL(t,o){if(!i.h(t))return t;const p=qe(t);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||o)}normalizeSourceURL(t,o,p,x){if(!i.h(t))return t;const T=qe(t);return T.path=`/v4/${T.authority}.json`,T.params.push("secure"),p&&T.params.push(`language=${p}`),x&&T.params.push(`worldview=${x}`),this._makeAPIURL(T,this._customAccessToken||o)}normalizeIconsetURL(t,o){const p=qe(t);return i.h(t)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||o)):wt(p)}normalizeSpriteURL(t,o,p,x){const T=qe(t);return i.h(t)?(T.path=`/styles/v1${T.path}/sprite${o}${p}`,this._makeAPIURL(T,this._customAccessToken||x)):(T.path+=`${o}${p}`,wt(T))}normalizeTileURL(t,o,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!i.h(t))return t;const x=qe(t);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||p&&x.authority!=="raster"&&p===512?"@2x":""}${i.k.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${i.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${i.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${i.e.TILE_URL_VERSION}${x.path}`);const T=this._customAccessToken||(function(E){for(const j of E){const O=j.match(/^access_token=(.*)$/);if(O)return O[1]}return null})(x.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&T&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,T)}canonicalizeTileURL(t,o){const p=qe(t);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return t;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let T=p.params;return o&&(T=T.filter((E=>!E.match(/^access_token=/)))),T.length&&(x+=`?${T.join("&")}`),x}canonicalizeTileset(t,o){const p=!!o&&i.h(o),x=[];for(const T of t.tiles||[])i.j(T)?x.push(this.canonicalizeTileURL(T,p)):x.push(T);return x}_makeAPIURL(t,o){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=qe(i.e.API_URL);if(t.protocol=x.protocol,t.authority=x.authority,t.protocol==="http"){const T=t.params.indexOf("secure");T>=0&&t.params.splice(T,1)}if(x.path!=="/"&&(t.path=`${x.path}${t.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return wt(t);if(o=o||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return t.params=t.params.filter((T=>T.indexOf("access_token")===-1)),t.params.push(`access_token=${o||""}`),wt(t)}}const Pi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qe(m){const t=m.match(Pi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function wt(m){const t=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${t}`}const Ct="mapbox.eventData";function Vi(m){if(!m)return null;const t=m.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(i.l(t[1]))}catch{return null}}class Qe{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const o=Vi(i.e.ACCESS_TOKEN);let p="";return p=o&&o.u?i.f(o.u):i.e.ACCESS_TOKEN||"",t?`${Ct}.${t}:${p}`:`${Ct}:${p}`}fetchEventData(){const t=i.s("localStorage"),o=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp");if(t)try{const T=localStorage.getItem(o);T&&(this.eventData=JSON.parse(T));const E=localStorage.getItem(p);E&&(this.anonId=E);const j=localStorage.getItem(x);j&&(this.anonIdTimestamp=Number(j));const O=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<O)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=i.s("localStorage"),o=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp"),T=this.anonId,E=this.anonIdTimestamp;if(t&&T)try{localStorage.setItem(p,T),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData)),E&&localStorage.setItem(x,E.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,p,x){if(!i.e.EVENTS_URL)return;const T=qe(i.e.EVENTS_URL);T.params.push(`access_token=${x||i.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(t).toISOString()},j=o?Object.assign(E,o):E,O={url:wt(T),headers:{"Content-Type":"text/plain"},body:JSON.stringify([j])};this.pendingRequest=i.p(O,(B=>{this.pendingRequest=null,p(B),this.saveEventData(),this.processRequests(x)}))}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}class St extends Qe{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!i.e.EVENTS_URL||!t&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const o=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:o},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:p}=this.queue.shift();this.postEvent(o,p,(()=>{}),t)}}const Ht=new class extends Qe{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,t){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some((o=>i.h(o)||i.j(o)))&&this.queueRequest(Date.now(),t)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Vi(i.e.ACCESS_TOKEN),o=t?t.u:i.e.ACCESS_TOKEN;let p=o!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const T=new Date(this.eventData.lastSuccess),E=new Date(x),j=(x-this.eventData.lastSuccess)/864e5;p=p||j>=1||j<-1||T.getDate()!==E.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Zt,"enabled.telemetry":!1,userId:this.anonId},(T=>{T||(this.eventData.lastSuccess=x,this.eventData.tokenU=o)}),m):this.processRequests()}},Ft=Ht.postTurnstileEvent.bind(Ht),_i=new class extends Qe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,t,o,p){this.skuToken=t,this.errorCb=p,i.e.EVENTS_URL&&(o||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},o):this.errorCb(new Error(jt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Zt,skuToken:this.skuToken,userId:this.anonId},(p=>{p?this.errorCb(p):t&&(this.success[t]=!0)}),m))}remove(){this.errorCb=null}},At=_i.postMapLoadEvent.bind(_i),Xt=new class extends Qe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let t=this.mapInstanceIdMap.get(m);return t||(t=i.u(),this.mapInstanceIdMap.set(m,t)),t}getEventId(m){const t=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,t+1),t}postStyleLoadEvent(m,t){const{map:o,style:p,importedStyles:x}=t;if(!i.e.EVENTS_URL||!m&&!i.e.ACCESS_TOKEN)return;const T=this.getMapInstanceId(o),E={mapInstanceId:T,eventId:this.getEventId(T),style:p};x.length&&(E.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:E},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,(()=>{}),m)}},yn=Xt.postStyleLoadEvent.bind(Xt),fn=new St({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),pn=fn.postMetricsEvent.bind(fn),sn=new St({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Un=sn.postMetricsEvent.bind(sn),Ui=new class extends Qe{constructor(){super("gljs.performance")}postPerformanceEvent(m,t){i.e.EVENTS_URL&&(m||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:o}=this.queue.shift(),p=(function(x){const T=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),j=(function(J){const se={};if(J){for(const ae in J)if(ae!=="other")for(const he of J[ae]){const de=`${ae}ResolveRangeMin`,_e=`${ae}ResolveRangeMax`,we=`${ae}RequestCount`,ye=`${ae}RequestCachedCount`;se[de]=Math.min(se[de]||1/0,he.startTime),se[_e]=Math.max(se[_e]||-1/0,he.responseEnd);const Pe=Ae=>{se[Ae]===void 0&&(se[Ae]=0),++se[Ae]};he.transferSize!==void 0&&he.transferSize===0&&Pe(ye),Pe(we)}}return se})((function(J,se){const ae={};if(J)for(const he of J){const de=se(he);ae[de]===void 0&&(ae[de]=[]),ae[de].push(he)}return ae})(T,$)),O=window.devicePixelRatio,B=navigator.connection||navigator.mozConnection||navigator.webkitConnection,H=B?B.effectiveType:void 0,K={counters:[],metadata:[],attributes:[]},Y=(J,se,ae)=>{ae!=null&&J.push({name:se,value:ae.toString()})};for(const J in j)Y(K.counters,J,j[J]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(Y(K.counters,"interactionRangeMin",x.interactionRange[0]),Y(K.counters,"interactionRangeMax",x.interactionRange[1])),E)for(const J of Object.values(P)){const se=E.find((ae=>ae.name===J));se&&Y(K.counters,J,se.startTime)}return Y(K.counters,"visibilityHidden",x.visibilityHidden),Y(K.attributes,"style",(function(J){if(J)for(const se of J){const ae=se.name.split("?")[0];if(i.i(ae)){const he=ae.split("/").slice(-2);if(he.length===2)return`mapbox://styles/${he[0]}/${he[1]}`}}})(T)),Y(K.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),Y(K.attributes,"fogEnabled",x.fogEnabled?"true":"false"),Y(K.attributes,"projection",x.projection),Y(K.attributes,"zoom",x.zoom),Y(K.metadata,"devicePixelRatio",O),Y(K.metadata,"connectionEffectiveType",H),Y(K.metadata,"navigatorUserAgent",navigator.userAgent),Y(K.metadata,"screenWidth",window.screen.width),Y(K.metadata,"screenHeight",window.screen.height),Y(K.metadata,"windowWidth",window.innerWidth),Y(K.metadata,"windowHeight",window.innerHeight),Y(K.metadata,"mapWidth",x.width/O),Y(K.metadata,"mapHeight",x.height/O),Y(K.metadata,"webglRenderer",x.renderer),Y(K.metadata,"webglVendor",x.vendor),Y(K.metadata,"sdkVersion",C),Y(K.metadata,"sdkIdentifier","mapbox-gl-js"),K})(o);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(t,p,(()=>{}),m)}},Ii=Ui.postPerformanceEvent.bind(Ui),nn=new class extends Qe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,t,o,p){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const x=qe(i.e.API_URL+i.e.SESSION_PATH);x.params.push(`sku=${t||""}`),x.params.push(`access_token=${p||i.e.ACCESS_TOKEN||""}`);const T={url:wt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(T,(E=>{this.pendingRequest=null,o(E),this.saveEventData(),this.processRequests(p)}))}getSessionAPI(m,t,o,p){this.skuToken=t,this.errorCb=p,i.e.SESSION_PATH&&i.e.API_URL&&(o||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},o):this.errorCb(new Error(jt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,(p=>{p?this.errorCb(p):t&&(this.success[t]=!0)}),m)}remove(){this.errorCb=null}},mn=nn.getSessionAPI.bind(nn),cn=new Set;function Tn(m,t){t?cn.add(m):cn.delete(m)}class Da{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){const o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,o){this._updatedImages[o]=this._updatedImages[o]||new Set,this._updatedImages[o].add(i.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Hc(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class Xo extends i.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new i.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const o=this.atlasTexture.get(t);o&&(o.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,o){this.imageProviders.has(o)||this.imageProviders.set(o,new Map),this.imageProviders.get(o).set(t.id,t)}removeImageProvider(t,o){this.imageProviders.has(o)&&this.imageProviders.get(o).delete(t)}getPendingImageProviders(){const t=[];for(const o of this.imageProviders.values())for(const p of o.values())p.hasPendingRequests()&&t.push(p);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,o){if(this.loaded.get(o)!==t&&(this.loaded.set(o,t),t)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,o,x);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images.get(o).get(t.toString())}addImage(t,o,p){this._validate(t,p)&&this.images.get(o).set(t.toString(),p)}_validate(t,o){let p=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new i.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new i.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(o.content,o)||(this.fire(new i.y(new Error(`Image "${t.name}" has invalid "content" value`))),p=!1),p}_validateStretch(t,o){if(!t)return!0;let p=0;for(const x of t){if(x[0]<p||x[1]<x[0]||o<x[1])return!1;p=x[1]}return!0}_validateContent(t,o){return t?t.length!==4||!o.usvg&&(t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,o,p){const x=this.images.get(o).get(t.toString());p.version=x.version+1,this.images.get(o).set(t.toString(),p),this.updatedImages.get(o).add(t),this.removeFromImageRasterizerCache(t,o)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,o){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([t],o))}removeImage(t,o){const p=this.images.get(o),x=p.get(t.toString());p.delete(t.toString()),this.patterns.get(o).delete(t.toString()),this.removeFromImageRasterizerCache(t,o),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((o=>i.I.from(o)))}getImages(t,o,p){const x=[],T=[],E=this.imageProviders.get(o);for(const H of t){if(!H.iconsetId){x.push(H);continue}const K=E.get(H.iconsetId);K&&(this.getImage(H,o)?T.push(H):K.addPendingRequest(H))}if(x.length===0)return void this._notify(T,o,p);let j=!0;const O=!!this.loaded.get(o),B=this.images.get(o);if(!O)for(const H of x)B.has(H.toString())||(j=!1);O||j?this._notify(x,o,p):this.requestors.push({ids:x,scope:o,callback:p})}rasterizeImages(t,o){const p=new Map,{tasks:x,scope:T}=t;for(const[E,j]of x.entries()){const O=this.getImage(j.id,T);O&&p.set(E,{image:O,imageVariant:j})}this._rasterizeImages(T,p,o)}_rasterizeImages(t,o,p){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:o,scope:t},p);else{const x=new Map;for(const[T,{image:E,imageVariant:j}]of o.entries())x.set(T,this.imageRasterizer.rasterize(j,E,t,0));p(void 0,x)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,o,p){const x=this.images.get(o),T=new Map;for(const E of t){if(!x.get(E.toString())){if(E.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:E.name}))}const j=x.get(E.toString());if(!j){i.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const O={data:j.usvg?null:j.data.clone(),pixelRatio:j.pixelRatio,sdf:j.sdf,usvg:j.usvg,version:j.version,stretchX:j.stretchX,stretchY:j.stretchY,content:j.content,hasRenderCallback:!!(j.userImage&&j.userImage.render)};j.usvg&&Object.assign(O,{width:j.icon.usvg_tree.width,height:j.icon.usvg_tree.height}),T.set(i.I.toString(E),O)}p(null,T)}getPixelSize(t){const{width:o,height:p}=this.atlasImage.get(t);return{width:o,height:p}}getPattern(t,o,p){const x=t.toString(),T=this.patterns.get(o),E=T.get(x),j=this.getImage(t,o);if(!j)return null;if(E){if(E.position.version===j.version)return E.position;E.position.version=j.version}else{if(j.usvg&&!j.data){const O=this.getPatternInFlightId(x,o);if(this.patternsInFlight.has(O))return null;this.patternsInFlight.add(O);const B=new i.A(t).scaleSelf(i.o.devicePixelRatio),H=new Map([[B.toString(),{image:j,imageVariant:B}]]);return this._rasterizeImages(o,H,((K,Y)=>this.storePatternImage(B,o,j,p,Y))),null}this.storePattern(t,o,j)}return this._updatePatternAtlas(o,p),T.get(x).position}getPatternInFlightId(t,o){return i.B(t,o)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,o,p,x,T){const E=t.toString(),j=T?T.get(E):void 0;j&&(p.data=j,this.storePattern(t.id,o,p),this._updatePatternAtlas(o,x),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),o)))}storePattern(t,o,p){const x={w:p.data.width+2*i.C,h:p.data.height+2*i.C,x:0,y:0},T=new i.F(x,p,i.C);this.patterns.get(o).set(t.toString(),{bin:x,position:T})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,o){const p=t.gl;let x=this.atlasTexture.get(o);x?this.dirty&&(x.update(this.atlasImage.get(o)),this.dirty=!1):(x=new i.T(t,this.atlasImage.get(o),p.RGBA8),this.atlasTexture.set(o,x)),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){const p=this.patterns.get(t),x=Array.from(p.values()).map((({bin:B})=>B)),{w:T,h:E}=i.G(x),j=this.atlasImage.get(t);j.resize({width:T||1,height:E||1});const O=this.images.get(t);for(const[B,{bin:H,position:K}]of p.entries()){let Y=K.padding;const J=H.x+Y,se=H.y+Y,ae=O.get(B).data,he=ae.width,de=ae.height;Y=Y>1?Y-1:Y,i.q.copy(ae,j,{x:0,y:0},{x:J,y:se},{width:he,height:de},o),i.q.copy(ae,j,{x:0,y:de-Y},{x:J,y:se-Y},{width:he,height:Y},o),i.q.copy(ae,j,{x:0,y:0},{x:J,y:se+de},{width:he,height:Y},o),i.q.copy(ae,j,{x:he-Y,y:0},{x:J-Y,y:se},{width:Y,height:de},o),i.q.copy(ae,j,{x:0,y:0},{x:J+he,y:se},{width:Y,height:de},o),i.q.copy(ae,j,{x:he-Y,y:de-Y},{x:J-Y,y:se-Y},{width:Y,height:Y},o),i.q.copy(ae,j,{x:0,y:de-Y},{x:J+he,y:se-Y},{width:Y,height:Y},o),i.q.copy(ae,j,{x:0,y:0},{x:J+he,y:se+de},{width:Y,height:Y},o),i.q.copy(ae,j,{x:he-Y,y:0},{x:J-Y,y:se+de},{width:Y,height:Y},o)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,o){const p=this.images.get(o);for(const x of t){if(this.callbackDispatchedThisFrame.get(o).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(o).add(x.toString());const T=p.get(x.toString());Hc(T)&&this.updateImage(x,o,T)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Hs(m){const t=m.value,o=m.valueSpec,p=m.style,x=m.styleSpec,T=m.key,E=m.arrayElementValidator||Za;if(!Array.isArray(t))return[new i.V(T,t,`array expected, ${i.K(t)} found`)];if(o.length&&t.length!==o.length)return[new i.V(T,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new i.V(T,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let j={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};x.$version<7&&(j.function=o.function),i.H(o.value)&&(j=o.value);let O=[];for(let B=0;B<t.length;B++)O=O.concat(E({array:t,arrayIndex:B,value:t[B],valueSpec:j,style:p,styleSpec:x,key:`${T}[${B}]`},!0));return O}function ws(m){const t=m.key,o=m.value,p=m.valueSpec;if(!i.L(o))return[new i.V(t,o,`number expected, ${i.K(o)} found`)];if(o!=o)return[new i.V(t,o,"number expected, NaN found")];if("minimum"in p){let x=p.minimum;if(Array.isArray(p.minimum)&&(x=p.minimum[m.arrayIndex]),o<x)return[new i.V(t,o,`${o} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(Array.isArray(p.maximum)&&(x=p.maximum[m.arrayIndex]),o>x)return[new i.V(t,o,`${o} is greater than the maximum value ${x}`)]}return[]}function Gs(m){const t=m.key,o=m.value;if(!i.H(o))return[new i.V(t,o,`object expected, ${i.K(o)} found`)];const p=m.valueSpec,x=i.J(o.type);let T,E,j,O={};const B=x!=="categorical"&&o.property===void 0,H=!B,K=(function(ae){const he=ae.stops;return Array.isArray(he)&&Array.isArray(he[0])&&i.H(he[0][0])})(o),Y=Ur({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(ae){if(x==="identity")return[new i.V(ae.key,ae.value,'identity function may not have a "stops" property')];let he=[];const de=ae.value;return he=he.concat(Hs({key:ae.key,value:de,valueSpec:ae.valueSpec,style:ae.style,styleSpec:ae.styleSpec,arrayElementValidator:J})),Array.isArray(de)&&de.length===0&&he.push(new i.V(ae.key,de,"array must have at least one stop")),he},default:function(ae){return Za({key:ae.key,value:ae.value,valueSpec:p,style:ae.style,styleSpec:ae.styleSpec})}}});return x==="identity"&&B&&Y.push(new i.V(m.key,m.value,'missing required property "property"')),x==="identity"||o.stops||Y.push(new i.V(m.key,m.value,'missing required property "stops"')),x==="exponential"&&p.expression&&!i.M(p)&&Y.push(new i.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(H&&!i.N(p)?Y.push(new i.V(m.key,m.value,"property functions not supported")):B&&!i.O(p)&&Y.push(new i.V(m.key,m.value,"zoom functions not supported"))),x!=="categorical"&&!K||o.property!==void 0||Y.push(new i.V(m.key,m.value,'"property" property is required')),Y;function J(ae){let he=[];const de=ae.value,_e=ae.key;if(!Array.isArray(de))return[new i.V(_e,de,`array expected, ${i.K(de)} found`)];if(de.length!==2)return[new i.V(_e,de,`array length 2 expected, length ${de.length} found`)];if(K){if(!i.H(de[0]))return[new i.V(_e,de,`object expected, ${i.K(de[0])} found`)];const we=de[0];if(we.zoom===void 0)return[new i.V(_e,de,"object stop key must have zoom")];if(we.value===void 0)return[new i.V(_e,de,"object stop key must have value")];const ye=i.J(we.zoom);if(typeof ye!="number")return[new i.V(_e,we.zoom,"stop zoom values must be numbers")];if(j&&j>ye)return[new i.V(_e,we.zoom,"stop zoom values must appear in ascending order")];ye!==j&&(j=ye,E=void 0,O={}),he=he.concat(Ur({key:`${_e}[0]`,value:de[0],valueSpec:{zoom:{}},style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{zoom:ws,value:se}}))}else he=he.concat(se({key:`${_e}[0]`,value:de[0],style:ae.style,styleSpec:ae.styleSpec},de));return i.Q(i.S(de[1]))?he.concat([new i.V(`${_e}[1]`,de[1],"expressions are not allowed in function stops.")]):he.concat(Za({key:`${_e}[1]`,value:de[1],valueSpec:p,style:ae.style,styleSpec:ae.styleSpec}))}function se(ae,he){const de=i.K(ae.value),_e=i.J(ae.value),we=ae.value!==null?ae.value:he;if(T){if(de!==T)return[new i.V(ae.key,we,`${de} stop domain type must match previous stop domain type ${T}`)]}else T=de;if(de!=="number"&&de!=="string"&&de!=="boolean"&&typeof _e!="number"&&typeof _e!="string"&&typeof _e!="boolean")return[new i.V(ae.key,we,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&x!=="categorical"){let ye=`number expected, ${de} found`;return i.N(p)&&x===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(ae.key,we,ye)]}return x!=="categorical"||de!=="number"||typeof _e=="number"&&isFinite(_e)&&Math.floor(_e)===_e?x!=="categorical"&&de==="number"&&typeof _e=="number"&&typeof E=="number"&&E!==void 0&&_e<E?[new i.V(ae.key,we,"stop domain values must appear in ascending order")]:(E=_e,x==="categorical"&&_e in O?[new i.V(ae.key,we,"stop domain values must be unique")]:(O[_e]=!0,[])):[new i.V(ae.key,we,`integer expected, found ${String(_e)}`)]}}function Hr(m){const t=(m.expressionContext==="property"?i.W:i.U)(i.S(m.value),m.valueSpec);if(t.result==="error")return t.value.map((p=>new i.V(`${m.key}${p.key}`,m.value,p.message)));const o=t.value.expression||t.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!o.outputDefined())return[new i.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!i.Z(o))return[new i.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return Yo(o,m);if(m.expressionContext==="appearance")return Jr(o,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!i.X(o,["zoom","feature-state"]))return[new i.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!i.Y(o))return[new i.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yo(m,t){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const x of t.valueSpec.expression.parameters)o.delete(x);if(o.size===0)return[];const p=[];return m instanceof i._&&o.has(m.name)?[new i.V(t.key,t.value,`["${m.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(m.eachChild((x=>{p.push(...Yo(x,t))})),p)}function Jr(m,t){const o=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const x of t.valueSpec.expression.parameters)o.add(x);if(o.size===0)return[];const p=[];return m instanceof i._&&!o.has(m.name)?[new i.V(t.key,t.value,`["${m.name}"] is not an allowed parameter`)]:(m.eachChild((x=>{p.push(...Jr(x,t))})),p)}function er(m){const t=m.key,o=m.value,p=m.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(i.J(o))===-1&&x.push(new i.V(t,o,`expected one of [${p.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(p.values).indexOf(i.J(o))===-1&&x.push(new i.V(t,o,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(o)} found`)),x}function ds(m){return i.a2(i.S(m.value))?Hr(Object.assign({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):pr(m)}function pr(m){const t=m.value,o=m.key;if(!Array.isArray(t))return[new i.V(o,t,`array expected, ${i.K(t)} found`)];if(t.length<1)return[new i.V(o,t,"filter array must have at least 1 element")];const p=m.styleSpec;let x=er({key:`${o}[0]`,value:t[0],valueSpec:p.filter_operator});const T=()=>{t.length>=2&&(i.a0(t[1])||x.push(new i.V(`${o}[1]`,t[1],`string expected, ${i.K(t[1])} found`)));for(let E=2;E<t.length;E++)i.J(t[1])==="$type"?x=x.concat(er({key:`${o}[${E}]`,value:t[E],valueSpec:p.geometry_type})):i.a0(t[E])||i.L(t[E])||i.$(t[E])||x.push(new i.V(`${o}[${E}]`,t[E],`string, number, or boolean expected, ${i.K(t[E])} found.`))};switch(i.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&i.J(t[1])==="$type"&&x.push(new i.V(o,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&x.push(new i.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`)),T();break;case"==":case"!=":t.length!==3&&x.push(new i.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`)),T();break;case"in":case"!in":T();break;case"any":case"all":case"none":for(let E=1;E<t.length;E++)x=x.concat(pr({key:`${o}[${E}]`,value:t[E],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":t.length!==2?x.push(new i.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):i.a0(t[1])||x.push(new i.V(`${o}[1]`,t[1],`string expected, ${i.K(t[1])} found`))}return x}function dl(m,t){const o=m.key,p=m.style,x=m.layer,T=m.styleSpec,E=m.value,j=m.objectKey,O=T[`${t}_${m.layerType}`];if(!O)return[];const B=j.match(/^(.*)-use-theme$/);if(B&&O[B[1]])return i.Q(i.S(E))?[].concat(Za({key:o,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:T,expressionContext:"property",propertyType:t,propertyKey:j})):Za({key:o,value:E,valueSpec:{type:"string"},style:p,styleSpec:T});const H=j.match(/^(.*)-transition$/);if(t==="paint"&&H&&O[H[1]]&&O[H[1]].transition)return Za({key:o,value:E,valueSpec:T.transition,style:p,styleSpec:T});const K=m.valueSpec||O[j];if(!K)return[new i.a3(o,E,`unknown property "${j}"`)];let Y;if(i.a0(E)&&i.N(K)&&!K.tokens&&(Y=/^{([^}]+)}$/.exec(E))){const se=`\`{ "type": "identity", "property": ${Y?JSON.stringify(Y[1]):'"_"'} }\``;return[new i.V(o,E,`"${j}" does not support interpolation syntax
Use an identity property function instead: ${se}.`)]}const J=[];if(m.layerType==="symbol")j!=="text-field"||!p||p.glyphs||p.imports||J.push(new i.V(o,E,'use of "text-field" requires a style "glyphs" property')),j==="text-font"&&i.a4(i.S(E))&&i.J(E.type)==="identity"&&J.push(new i.V(o,E,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&t==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&i.N(K)&&(i.a5(K)||i.O(K))){const se=i.W(i.S(E),K).value,ae="expression"in se&&se.expression||"_styleExpression"in se&&se._styleExpression&&se._styleExpression.expression;ae&&!i.X(ae,["measure-light"])&&(j==="model-emissive-strength"&&i.Y(ae)&&i.Z(ae)||J.push(new i.V(o,E,`${j} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return J.concat(Za({key:m.key,value:E,valueSpec:K,style:p,styleSpec:T,expressionContext:"property",propertyType:t,propertyKey:j}))}function Ql(m){return dl(m,"paint")}function qs(m){return dl(m,"layout")}function Ko(m){let t=[];const o=m.value,p=m.key,x=m.style,T=m.styleSpec;if(!i.H(o))return[new i.V(p,o,"object expected")];o.type||o.ref||t.push(new i.V(p,o,'either "type" or "ref" is required'));let E=i.J(o.type);const j=i.J(o.ref);if(o.id){const O=i.J(o.id);for(let B=0;B<m.arrayIndex;B++){const H=x.layers[B];i.J(H.id)===O&&t.push(new i.V(p,o.id,`duplicate layer id "${O}", previously used at line ${H.id.__line__}`))}}if("ref"in o){let O;["type","source","source-layer","filter","layout"].forEach((B=>{B in o&&t.push(new i.V(p,o[B],`"${B}" is prohibited for ref layers`))})),x.layers.forEach((B=>{i.J(B.id)===j&&(O=B)})),O?O.ref?t.push(new i.V(p,o.ref,"ref cannot reference another ref layer")):E=i.J(O.type):typeof j=="string"&&t.push(new i.V(p,o.ref,`ref layer "${j}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(o.source)if(i.a0(o.source)){const O=x.sources&&x.sources[o.source],B=O&&i.J(O.type);O?B==="vector"&&E==="raster"?t.push(new i.V(p,o.source,`layer "${o.id}" requires a raster source`)):B==="raster"&&E!=="raster"?t.push(new i.V(p,o.source,`layer "${o.id}" requires a vector source`)):B!=="vector"||o["source-layer"]?B==="raster-dem"&&E!=="hillshade"?t.push(new i.V(p,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):B!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&o.paint&&(o.paint["line-gradient"]||o.paint["line-trim-offset"])&&B==="geojson"&&!O.lineMetrics?t.push(new i.V(p,o,`layer "${o.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&B!=="raster-array"&&t.push(new i.V(p,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new i.V(p,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new i.V(p,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new i.V(p,o.source,`source "${o.source}" not found`))}else t.push(new i.V(`${p}.source`,o.source,'"source" must be a string'));else t.push(new i.V(p,o,'missing required property "source"'));return t=t.concat(Ur({key:p,value:o,valueSpec:T.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Za({key:`${p}.type`,value:o.type,valueSpec:T.layer.type,style:m.style,styleSpec:m.styleSpec,object:o,objectKey:"type"}),filter:O=>ds(Object.assign({layerType:E},O)),layout:O=>Ur({layer:o,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":B=>qs(Object.assign({layerType:E},B))}}),paint:O=>Ur({layer:o,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":B=>Ql(Object.assign({layerType:E,layer:o},B))}}),appearances(O){const B=Hs({key:O.key,value:O.value,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:Y=>(function(J){const{key:se,layer:ae,layerType:he}=J,de=i.J(J.value),_e=i.J(de.name),we=i.J(de.condition),ye=Ur({key:se,value:de,valueSpec:J.styleSpec.appearance,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{condition:Pe=>(function(Ae){const Ie=[];return Ie.push(...Hr({key:Ae.key,value:Ae.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Ie})(Object.assign({layer:ae,layerType:he},Pe)),properties:Pe=>(function(Ae){const Ie=[],{styleSpec:je,layer:Ce,layerType:Ge}=Ae,it=je[`paint_${Ge}`],Ke=je[`layout_${Ge}`],ht=Ae.object[Ae.objectKey];for(const mt in ht){const kt=mt in it?"paint":mt in Ke?"layout":void 0;if(!kt){Ie.push(new i.V(Ae.key,mt,`unknown property "${mt}" for layer type "${Ge}"`));continue}const Ot=Object.assign({},Ae,{key:`${Ae.key}.${mt}`,object:ht,objectKey:mt,layer:Ce,layerType:Ge,value:ht[mt],valueSpec:kt==="paint"?it[mt]:Ke[mt]});Ie.push(...dl(Ot,kt))}return Ie})(Object.assign({layer:ae,layerType:he},Pe))}});return _e!=="hidden"&&we===void 0&&ye.push(new i.V(J.key,"name",'Appearance with name different than "hidden" must have a condition')),ye})(Object.assign({layerType:E,layer:o},Y))}),H=Array.isArray(O.value)?O.value:[],K=new Set;return H.forEach(((Y,J)=>{const se=i.J(Y.name);if(se)if(K.has(se)){const ae=i.J(o.id);B.push(new i.V(O.key,se,`Duplicated appearance name "${se}" for layer "${ae}"`))}else K.add(se)})),B}}})),t}function vr({key:m,value:t}){return i.a0(t)?[]:[new i.V(m,t,`string expected, ${i.K(t)} found`)]}const Ir={promoteId:function m({key:t,value:o}){if(i.a0(o))return vr({key:t,value:o});if(Array.isArray(o)){const x=[],T=i.S(o),E=i.U(T);return E.result==="error"&&E.value.forEach((j=>{x.push(new i.V(`${t}${j.key}`,null,`${j.message}`))})),i.X(E.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||x.push(new i.V(`${t}`,null,"promoteId expression should be only feature dependent")),x}if(!i.H(o))return[new i.V(t,o,`string, expression or object expected, "${i.K(o)}" found`)];const p=[];for(const x in o)p.push(...m({key:`${t}.${x}`,value:o[x]}));return p}};function ec(m){const t=m.value,o=m.key,p=m.styleSpec,x=m.style;if(!i.H(t))return[new i.V(o,t,`object expected, ${i.K(t)} found`)];if(!("type"in t))return[new i.V(o,t,'"type" is required')];const T=i.J(t.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&("url"in t||"tiles"in t||E.push(new i.a3(o,t,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Ur({key:o,value:t,valueSpec:p[`source_${T.replace("-","_")}`],style:m.style,styleSpec:p,objectElementValidators:Ir})),E;case"geojson":if(E=Ur({key:o,value:t,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:Ir}),"cluster"in t&&"clusterProperties"in t){if(!i.H(t.clusterProperties))return[new i.V(`${o}.clusterProperties`,t,`object expected, ${i.K(t)} found`)];for(const j in t.clusterProperties){const O=t.clusterProperties[j];if(!Array.isArray(O))return[new i.V(`${o}.clusterProperties.${j}`,O,"array expected")];const[B,H]=O,K=typeof B=="string"?[B,["accumulated"],["get",j]]:B;E.push(...Hr({key:`${o}.${j}.map`,value:H,expressionContext:"cluster-map"})),E.push(...Hr({key:`${o}.${j}.reduce`,value:K,expressionContext:"cluster-reduce"}))}}return E;case"video":return Ur({key:o,value:t,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return Ur({key:o,value:t,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new i.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return er({key:`${o}.type`,value:t.type,valueSpec:{values:Ss(p)}})}}function Ss(m){return m.source.reduce(((t,o)=>{const p=m[o];return p.type.type==="enum"&&(t=t.concat(Object.keys(p.type.values||{}))),t}),[])}function po(m){const t=m.value,o=m.styleSpec,p=o.light,x=m.style;if(t===void 0)return[];if(!i.H(t))return[new i.V("light",t,`object expected, ${i.K(t)} found`)];let T=[];for(const E in t){const j=E.match(/^(.*)-transition$/),O=E.match(/^(.*)-use-theme$/);T=T.concat(O&&p[O[1]]?Za({key:E,value:t[E],valueSpec:{type:"string"},style:x,styleSpec:o}):j&&p[j[1]]&&p[j[1]].transition?Za({key:E,value:t[E],valueSpec:o.transition,style:x,styleSpec:o}):p[E]?Za({key:E,value:t[E],valueSpec:p[E],style:x,styleSpec:o}):[new i.V(E,t[E],`unknown property "${E}"`)])}return T}function Jo(m){const t=m.value;if(!t)return[];const o=m.key;if(!i.H(t))return[new i.V(o,t,`object expected, ${i.K(t)} found`)];let p=[];const x=m.styleSpec,T=x["light-3d"],E=m.style,j=m.style.lights;for(const H of["type","id"])if(!(H in t))return p=p.concat([new i.V(o,t,`missing property "${H}"`)]),p;if(!i.a0(t.type))return p=p.concat([new i.V(`${o}.type`,t.type,"string expected")]),p;if(j)for(let H=0;H<m.arrayIndex;H++){const K=i.J(t.type),Y=j[H];i.J(Y.type)===K&&p.push(new i.V(o,t.id,`duplicate light type "${t.type}", previously defined at line ${Y.id.__line__}`))}const O=`properties_light_${t.type}`;if(!(O in x))return p=p.concat([new i.V(`${o}.type`,t,`Invalid light type ${t.type}`)]),p;const B=x[O];for(const H in t)if(H==="properties"){const K=t[H];if(!i.H(K))return p=p.concat([new i.V("properties",K,`object expected, ${i.K(K)} found`)]),p;for(const Y in K){const J=Y.match(/^(.*)-transition$/),se=Y.match(/^(.*)-use-theme$/);p=p.concat(se&&B[se[1]]?Za({key:H,value:K[Y],valueSpec:{type:"string"},style:E,styleSpec:x}):J&&B[J[1]]&&B[J[1]].transition?Za({key:H,value:t[H],valueSpec:x.transition,style:E,styleSpec:x}):B[Y]?Za({key:Y,value:K[Y],valueSpec:B[Y],style:E,styleSpec:x}):[new i.a3(m.key,K[Y],`unknown property "${Y}"`)])}}else p=p.concat(T[H]?Za({key:H,value:t[H],valueSpec:T[H],style:E,styleSpec:x}):[new i.a3(H,t[H],`unknown property "${H}"`)]);return p}function Ws(m){const t=m.value,o=m.key,p=m.style,x=m.styleSpec,T=x.terrain;if(t==null)return[];if(!i.H(t))return[new i.V("terrain",t,`object expected, ${i.K(t)} found`)];let E=[];for(const j in t){const O=j.match(/^(.*)-transition$/),B=j.match(/^(.*)-use-theme$/);E=E.concat(B&&T[B[1]]?Za({key:j,value:t[j],valueSpec:{type:"string"},style:p,styleSpec:x}):O&&T[O[1]]&&T[O[1]].transition?Za({key:j,value:t[j],valueSpec:x.transition,style:p,styleSpec:x}):T[j]?Za({key:j,value:t[j],valueSpec:T[j],style:p,styleSpec:x}):[new i.a3(j,t[j],`unknown property "${j}"`)])}if(t.source)if(i.a0(t.source)){const j=p.sources&&p.sources[t.source],O=j&&i.J(j.type);j?O!=="raster-dem"&&E.push(new i.V(`${o}.source`,t.source,`terrain cannot be used with a source of type ${O}, it only be used with a "raster-dem" source type`)):E.push(new i.V(`${o}.source`,t.source,`source "${t.source}" not found`))}else E.push(new i.V(`${o}.source`,t.source,"source must be a string"));else E.push(new i.V(o,t,'terrain is missing required property "source"'));return E}function tc(m){const t=m.value,o=m.style,p=m.styleSpec,x=p.fog;if(t===void 0)return[];if(!i.H(t))return[new i.V("fog",t,`object expected, ${i.K(t)} found`)];let T=[];for(const E in t){const j=E.match(/^(.*)-transition$/),O=E.match(/^(.*)-use-theme$/);T=T.concat(O&&x[O[1]]?Za({key:E,value:t[E],valueSpec:{type:"string"},style:o,styleSpec:p}):j&&x[j[1]]&&x[j[1]].transition?Za({key:E,value:t[E],valueSpec:p.transition,style:o,styleSpec:p}):x[E]?Za({key:E,value:t[E],valueSpec:x[E],style:o,styleSpec:p}):[new i.a3(E,t[E],`unknown property "${E}"`)])}return T}const go={"*":()=>[],array:Hs,boolean:function(m){const t=m.value,o=m.key;return i.$(t)?[]:[new i.V(o,t,`boolean expected, ${i.K(t)} found`)]},number:ws,color:function({key:m,value:t}){return i.a0(t)?i.a1.parseCSSColor(t)===null?[new i.V(m,t,`color expected, "${t}" found`)]:[]:[new i.V(m,t,`color expected, ${i.K(t)} found`)]},enum:er,filter:ds,function:Gs,layer:Ko,object:Ur,source:ec,model:i.a7,light:po,"light-3d":Jo,terrain:Ws,fog:tc,string:vr,formatted:function(m){return vr(m).length===0?[]:Hr(m)},resolvedImage:function(m){return vr(m).length===0?[]:Hr(m)},projection:function(m){const t=m.value,o=m.styleSpec,p=o.projection,x=m.style;if(i.H(t)){let T=[];for(const E in t)T=T.concat(Za({key:E,value:t[E],valueSpec:p[E],style:x,styleSpec:o}));return T}return i.a0(t)?[]:[new i.V("projection",t,`object or string expected, ${i.K(t)} found`)]},import:function(m){const t=m.key,{value:o,styleSpec:p}=m;if(!i.H(o))return[new i.V(t,o,"import must be an object")];const{data:x,...T}=o;Object.defineProperty(T,"__line__",{value:o.__line__,enumerable:!1});let E=Ur(Object.assign({},m,{value:T,valueSpec:p.import}));return i.J(T.id)===""&&E.push(new i.V(`${m.key}.id`,T,"import id can't be an empty string")),x&&(E=E.concat(Ro(x,p,{key:`${m.key}.data`}))),E},iconset:function(m){const t=m.value,o=m.key,p=m.styleSpec,x=m.style;if(!i.H(t))return[new i.V(o,t,"object expected")];if(!t.type)return[new i.V(o,t,'"type" is required')];const T=i.J(t.type);let E=[];if(E=E.concat(Ur({key:o,value:t,valueSpec:p[`iconset_${T}`],style:x,styleSpec:p})),(function(j,O){return!(j!=="source"||!O.source)})(T,t)){const j=x.sources&&x.sources[t.source],O=j&&i.J(j.type);j?O!=="raster-array"&&E.push(new i.V(o,t.source,`iconset cannot be used with a source of type ${String(O)}, it only be used with a "raster-array" source type`)):E.push(new i.V(o,t.source,`source "${t.source}" not found`))}return E}};function Za(m,t=!1){const o=m.value,p=m.valueSpec,x=m.styleSpec;if(p.expression){if(i.a4(i.J(o)))return Gs(m);if(i.Q(i.S(o)))return Hr(m)}if(p.type&&go[p.type]){const T=go[p.type](m);return t===!0&&T.length>0&&Array.isArray(m.value)?Hr(m):T}return Ur(Object.assign({},m,{valueSpec:p.type?x[p.type]:p}))}function Ur(m){const t=m.key,o=m.value,p=m.valueSpec||{},x=m.objectElementValidators||{},T=m.style,E=m.styleSpec;if(!i.H(o))return[new i.V(t,o,`object expected, ${i.K(o)} found`)];let j=[];for(const O in o){const B=O.split(".")[0];let H;x[B]?H=x[B]:p[B]?H=Za:x["*"]?H=x["*"]:p["*"]&&(H=Za),H?j=j.concat(H({key:(t&&`${t}.`)+O,value:o[O],valueSpec:p[B]||p["*"],style:T,styleSpec:E,object:o,objectKey:O},o)):j.push(new i.a3(t,o[O],`unknown property "${O}"`))}for(const O in p){if(x[O])continue;const B=p[O];B.required&&B.default===void 0&&o[O]===void 0&&j.push(new i.V(t,o,`missing required property "${O}"`))}return j}function ic({key:m,value:t}){const o=vr({key:m,value:t});if(o.length)return o;const p=t;return p.indexOf("{fontstack}")===-1&&o.push(new i.V(m,t,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&o.push(new i.V(m,t,'"glyphs" url must include a "{range}" token')),o}function Ro(m,t=i.a6,o={}){return Ur({key:o.key||"",value:m,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:m,objectElementValidators:{glyphs:ic}})}function _o(m,t=i.a6){return ue(Ro(m,t))}const ku=m=>ue(ec(m)),Me=m=>ue(po(m)),Rt=m=>ue(Jo(m)),ii=m=>ue(Ws(m)),Ai=m=>ue(tc(m)),ui=m=>ue((function(t){const o=t.value,p=t.style,x=t.styleSpec,T=x.snow;if(o===void 0)return[];if(!i.H(o))return[new i.V("snow",o,`object expected, ${i.K(o)} found`)];let E=[];for(const j in o){const O=j.match(/^(.*)-transition$/);E=E.concat(O&&T[O[1]]&&T[O[1]].transition?Za({key:j,value:o[j],valueSpec:x.transition,style:p,styleSpec:x}):T[j]?Za({key:j,value:o[j],valueSpec:T[j],style:p,styleSpec:x}):[new i.a3(j,o[j],`unknown property "${j}"`)])}return E})(m)),Wi=m=>ue((function(t){const o=t.value,p=t.style,x=t.styleSpec,T=x.rain;if(o===void 0)return[];if(!i.H(o))return[new i.V("rain",o,`object expected, ${i.K(o)} found`)];let E=[];for(const j in o){const O=j.match(/^(.*)-transition$/);E=E.concat(O&&T[O[1]]&&T[O[1]].transition?Za({key:j,value:o[j],valueSpec:x.transition,style:p,styleSpec:x}):T[j]?Za({key:j,value:o[j],valueSpec:T[j],style:p,styleSpec:x}):[new i.a3(j,o[j],`unknown property "${j}"`)])}return E})(m)),Ti=m=>ue(Ko(m)),vn=m=>ue(ds(m)),Mn=m=>ue(Ql(m)),Xe=m=>ue(qs(m)),ne=m=>ue(i.a7(m));function ue(m){return m.slice().sort(((t,o)=>t.line&&o.line?t.line-o.line:0))}function ke(m,t){let o=!1;if(t&&t.length)for(const p of t)p instanceof i.a3?i.w(p.message):(m.fire(new i.y(new Error(p.message))),o=!0);return o}const Fe=i.a6.light;let Ue;class Ze extends i.E{constructor(t,o="flat"){super(),this._transitionable=new i.a8(Ue||(Ue=new i.a9({anchor:new i.aa(Fe.anchor),position:new i.ab(Fe.position),color:new i.aa(Fe.color),intensity:new i.aa(Fe.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,p={}){this._validate(Me,t,p)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,p){return(!p||p.validate!==!1)&&ke(this,t.call(_o,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const st=i.a6.terrain;let Je=class extends i.E{constructor(m,t,o,p,x){super(),this.scope=o,this._transitionable=new i.a8(new i.a9({source:new i.aa(st.source),exaggeration:new i.aa(st.exaggeration)}),o,p),this._transitionable.setTransitionOrValue(m,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=x}get(){return this._transitionable.serialize()}set(m,t){this._transitionable.setTransitionOrValue(m,t)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new i.ac(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const t=m.value.expression;if(!t)return null;let o=-1,p=-1,x=1;for(const T of t.zoomStops)x=t.evaluate(new i.ac(T,{worldview:this.worldview})),x>.01?(o=T,p=-1):p=T;return x<.01&&o>0&&p>o?[o,p]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof i.ad}};const ct=45,It=65,Tt=.05;function ci(m,t,o,p){const x=i.ah(ct,It,o),[T,E]=Fi(m,p);let j=1-Math.min(1,Math.exp((t-T)/(E-T)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*x*m.alpha}function Fi(m,t){const o=.5/Math.tan(.5*t);return[m.range[0]+o,m.range[1]+o]}function mi(m,t,o,p,x){const T=i.af([],[t,o,p],x.mercatorFogMatrix);return ci(m,i.ag(T),x.pitch,x._fov)}function tn(m,t,o,p,x,T,E){const j=[[o,p,0],[x,p,0],[x,T,0],[o,T,0]];let O=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(const H of j){const K=i.af([],H,t),Y=i.ag(K);O=Math.min(O,Y),B=Math.max(B,Y)}return[ci(m,O,E.pitch,E._fov),ci(m,B,E.pitch,E._fov)]}const rn=i.a6.fog;class Xi extends i.E{constructor(t,o,p,x){super();const T=new i.a9({range:new i.aa(rn.range),color:new i.aa(rn.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(rn["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(rn["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(rn["horizon-blend"]),"star-intensity":new i.aa(rn["star-intensity"]),"vertical-range":new i.aa(rn["vertical-range"])});this._transitionable=new i.a8(T,p,new Map(x)),this.set(t,x),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new i.ai(T),this.scope=p}get state(){const t=this._transform,o=t.projection.name==="globe",p=i.aj(t.zoom),x=this.properties.get("range"),T=[.5,3];return{range:o?[i.ak(T[0],x[0],p),i.ak(T[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,p={}){if(this._validate(Ai,t,p))return;const x=Object.assign({},t);for(const T of Object.keys(rn))x[T]===void 0&&(x[T]=rn[T].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(ct,It,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?(function(p,x,T){const E=i.ae.fromLngLat(x),j=T.elevation?T.elevation.getAtPointOrZero(E):0;return mi(p,E.x,E.y,j,T)})(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return tn(this.state,o,0,0,i.al,i.al,this._transform)}getOpacityForBounds(t,o,p,x,T){return this._transform.projection.supportsFog?tn(this.state,t,o,p,x,T,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Fi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const p of o){const x=t.points[p];let T;if(x[2]>=0)T=x;else{const E=t.points[p-4];T=i.am(E,x,E[2]/(E[2]-x[2]))}if(mi(this.state,T[0],T[1],0,this._transform)>=Tt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,p){return(!p||p.validate!==!1)&&ke(this,t.call(_o,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let Hi,Gn,Oa,Ea,Jn=class extends i.E{constructor(m,t,o,p){super();const x=Hi||(Hi=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(x,o,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(x),this.scope=o}get state(){const m=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),p=i.an(o[0]),x=-Math.max(i.an(o[1]),.01),T=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette"),j=this.properties.get("vignette-color");return j.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(t.r,t.g,t.b,t.a*m),direction:T,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:j}}get(){return this._transitionable.serialize()}set(m,t,o={}){if(this._validate(ui,m,o))return;const p=Object.assign({},m),x=i.a6.snow;for(const T of Object.keys(x))p[T]===void 0&&(p[T]=x[T].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,t,o){return(!o||o.validate!==!1)&&ke(this,m.call(_o,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},gn=class extends i.E{constructor(m,t,o,p){super();const x=Gn||(Gn=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(x,o,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(x),this.scope=o}get state(){const m=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),p=i.an(o[0]),x=-Math.max(i.an(o[1]),.01),T=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(t.r,t.g,t.b,t.a*m),direction:T,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(m,t,o={}){if(this._validate(Wi,m,o))return;const p=Object.assign({},m),x=i.a6.rain;for(const T of Object.keys(x))p[T]===void 0&&(p[T]=x[T].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,t,o){return(!o||o.validate!==!1)&&ke(this,m.call(_o,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class an extends i.E{constructor(t,o,p,x){super(),this.scope=p,this._options=t,this.properties=new i.ai(o),this._transitionable=new i.a8(o,p,new Map(x)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ia{constructor(t,o,p){this.screenBounds=t,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,o){let p,x;if(t instanceof i.P||typeof t[0]=="number"){const T=i.P.convert(t);p=[T],x=o.isPointAboveHorizon(T)}else{const T=i.P.convert(t[0]),E=i.P.convert(t[1]),j=T.add(E)._div(2);p=[T,E],x=i.aq(T,E).every((O=>o.isPointAboveHorizon(O)))&&o.isPointAboveHorizon(j)}return new ia(p,x,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.aq(o,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(x[3]=this.cameraPoint)),i.ar(x,t)}bufferedCameraGeometryGlobe(t){const o=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.aq(o,p,t),T=this.cameraPoint.clone();switch(3*((T.y>o.y)+(T.y>p.y))+((T.x>o.x)+(T.x>p.x))){case 0:x[0]=T,x[4]=T.clone();break;case 1:x.splice(1,0,T);break;case 2:x[1]=T;break;case 3:x.splice(4,0,T);break;case 5:x.splice(2,0,T);break;case 6:x[3]=T;break;case 7:x.splice(3,0,T);break;case 8:x[2]=T}return x}containsTile(t,o,p,x=0){const T=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/o._pixelsPerMercatorPixel+1,E=p?this._bufferedCameraMercator(T,o):this._bufferedScreenMercator(T,o);let j=t.tileID.wrap+(E.unwrapped?x:0);const O=E.polygon.map((he=>i.as(t.tileTransform,he,j)));if(!i.at(O,0,0,i.al,i.al))return;j=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const B=this.screenGeometryMercator.polygon.map((he=>i.au(t.tileTransform,he,j))),H=B.map((he=>new i.P(he[0],he[1]))),K=o.getFreeCameraOptions().position||new i.ae(0,0,0),Y=i.au(t.tileTransform,K,j),J=B.map((he=>{const de=i.av(he,he,Y);return i.aw(de,de),new i.ax(Y,de)})),se=i.ay(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:H,tilespaceRays:J,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(ae=i.az(O),ae.min.x=i.aA(ae.min.x,0,i.al),ae.min.y=i.aA(ae.min.y,0,i.al),ae.max.x=i.aA(ae.max.x,0,i.al),ae.max.y=i.aA(ae.max.y,0,i.al),ae),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:se};var ae}_bufferedScreenMercator(t,o){const p=Xa(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map((T=>o.pointCoordinate3D(T))),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(t,o){const p=Xa(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map((T=>o.pointCoordinate3D(T))),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(t,o){const p=(function(T,E){const j=i.aB([],E.pixelMatrix,E.globeMatrix),O=[0,-i.aD,0,1],B=[0,i.aD,0,1],H=[0,0,0,1];i.aC(O,O,j),i.aC(B,B,j),i.aC(H,H,j);const K=new i.P(O[0]/O[3],O[1]/O[3]),Y=new i.P(B[0]/B[3],B[1]/B[3]),J=i.aE(T,K)&&O[3]<H[3],se=i.aE(T,Y)&&B[3]<H[3];if(!J&&!se)return null;const ae=(function(Ie,je,Ce){for(let Ge=1;Ge<Ie.length;Ge++){const it=An(je.pointCoordinate3D(Ie[Ge-1]).x),Ke=An(je.pointCoordinate3D(Ie[Ge]).x);if(Ce<0){if(it<Ke)return{idx:Ge,t:-it/(Ke-1-it)}}else if(Ke<it)return{idx:Ge,t:(1-it)/(Ke+1-it)}}return null})(T,E,J?-1:1);if(!ae)return null;const{idx:he,t:de}=ae;let _e=he>1?oa(T.slice(0,he),E):[],we=he<T.length?oa(T.slice(he),E):[];_e=_e.map((Ie=>new i.P(An(Ie.x),Ie.y))),we=we.map((Ie=>new i.P(An(Ie.x),Ie.y)));const ye=[..._e];ye.length===0&&ye.push(we[we.length-1]);const Pe=i.ak(ye[ye.length-1].y,(we.length===0?_e[0]:we[0]).y,de);let Ae;return Ae=J?[new i.P(0,Pe),new i.P(0,0),new i.P(1,0),new i.P(1,Pe)]:[new i.P(1,Pe),new i.P(1,1),new i.P(0,1),new i.P(0,Pe)],ye.push(...Ae),we.length===0?ye.push(_e[0]):ye.push(...we),{polygon:ye.map((Ie=>new i.ae(Ie.x,Ie.y))),unwrapped:!1}})(t,o);if(p)return p;const x=(function(T,E){let j=!1,O=-1/0,B=0;for(let K=0;K<T.length-1;K++)T[K].x>O&&(O=T[K].x,B=K);for(let K=0;K<T.length-1;K++){const Y=(B+K)%(T.length-1),J=T[Y],se=T[Y+1];Math.abs(J.x-se.x)>.5&&(J.x<se.x?(J.x+=1,Y===0&&(T[T.length-1].x+=1)):(se.x+=1,Y+1===T.length-1&&(T[0].x+=1)),j=!0)}const H=i.aF(E.center.lng);return j&&H<Math.abs(H-1)&&T.forEach((K=>{K.x-=1})),{polygon:T,unwrapped:j}})(oa(t,o).map((T=>new i.P(An(T.x),T.y))),o);return{polygon:x.polygon.map((T=>new i.ae(T.x,T.y))),unwrapped:x.unwrapped}}}function oa(m,t){return i.aG(m,(o=>{const p=t.pointCoordinate3D(o);o.x=p.x,o.y=p.y}),1/256)}function An(m){return m<0?1+m%1:m%1}function Xa(m){return 100*m|0}function Dn(m,t,o,p,x){const T=function(j,O){if(j)return x(j);if(O){if(m.url&&O.tiles&&m.tiles&&delete m.tiles,O.variants){if(!Array.isArray(O.variants))return x(new Error("variants must be an array"));for(const H of O.variants){if(H==null||typeof H!="object"||H.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(H.capabilities))return x(new Error("capabilities must be an array"));if(H.capabilities.length===1&&H.capabilities[0]==="meshopt"){O=Object.assign(O,H);break}}}const B=i.aH(Object.assign({},O,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);B.tiles=t.canonicalizeTileset(B,m.url),x(null,B)}},E=(function(j,O,B){if(!j)return null;if(!O&&!B)return j;B=B||j.worldview_default;const H=Object.values(j.language||{});if(H.length===0)return null;const K=Object.values(j.worldview||{});if(K.length===0)return null;const Y=H.every((se=>se===O)),J=K.every((se=>se===B));return Y&&J?j:O in(j.language_options||{})||B in(j.worldview_options||{})?null:j.language_options&&j.worldview_options?j:null})(m.data,o,p);return E?i.o.frame((()=>T(null,E))):m.url?i.m(t.transformRequest(t.normalizeSourceURL(m.url,null,o,p),i.R.Source),T):i.o.frame((()=>{const{data:j,...O}=m;T(null,O)}))}function Aa(m,t){const o=Math.pow(2,t.z),p=Math.floor(i.aF(m.getWest())*o),x=Math.floor(i.aJ(m.getNorth())*o),T=Math.ceil(i.aF(m.getEast())*o),E=Math.ceil(i.aJ(m.getSouth())*o);return t.x>=p&&t.x<T&&t.y>=x&&t.y<E}class Zs{constructor(t,o,p){this.bounds=t?i.aI.convert(this.validateBounds(t)):null,this.minzoom=o||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const o of t)this.extraBounds.push(i.aI.convert(this.validateBounds(o)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Aa(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const o of this.extraBounds)if(Aa(o,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const o=new Zs(t.bounds,t.minzoom,t.maxzoom);return o.addExtraBounds(t.extra_bounds),o}}class ss extends i.E{constructor(t,o,p,x){if(super(),this.id=t,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(o,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new i.aK}load(t){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Dn(this._options,this.map._requestManager,o,p,((x,T)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new i.y(x));else if(T){if(Object.assign(this,T),this.hasWorldviews=!!T.worldview_options,T.worldview_default&&(this.worldviewDefault=T.worldview_default),T.vector_layers){this.vectorLayers=T.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of T.vector_layers)this.vectorLayerIds.push(E.id),T.worldview&&T.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=Zs.fromTileJSON(T),Ft(T.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(x)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,o){const p=t.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(p),T=this.map._requestManager.transformRequest(x,i.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,j=E?{image:E.image.clone()}:null,O={request:T,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:j,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(p)&&(O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",O,B.bind(this));else if(t.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",O,B.bind(this),void 0,!0);else{const H=i.aL.call({deduped:this._deduped},O,((K,Y)=>{if(K||!Y)B.call(this,K);else{const J=i.aM(Y.responseHeaders);O.data={rawData:Y.rawData.slice(0),expires:J.expires,cacheControl:J.cacheControl},t.actor&&t.actor.send("loadTile",O,B.bind(this),void 0,!0)}}),!0);t.request={cancel:H}}function B(H,K){return delete t.request,t.aborted?o(null):H&&H instanceof i.aN&&H.status!==404?o(H):(K&&K.resourceTiming&&(t.resourceTiming=K.resourceTiming),this.map._refreshExpiredTiles&&K&&t.setExpiryData(K),t.loadVectorData(K,this.map.painter),i.aO(this.dispatcher),o(null,K),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class tr extends i.E{constructor(t,o,p,x){super(),this.id=t,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},o),Object.assign(this,i.aH(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const o=this.map.getWorldview();this._tileJSONRequest=Dn(this._options,this.map._requestManager,null,o,((p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new i.y(p)):x&&(Object.assign(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map((T=>T.id))),this.tileBounds=Zs.fromTileJSON(x),Ft(x.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(p)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const p=i.o.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=i.n(this.map._requestManager.transformRequest(x,i.R.Tile),((T,E,j)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(T)return t.state="errored",o(T);if(!E)return o(null);const O=i.aM(j);this.map._refreshExpiredTiles&&t.setExpiryData(O),t.setTexture(E,this.map.painter),t.state="loaded",i.aO(this.dispatcher),o(null)}))}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof i.T?(t.destroy(!1),t.texture&&t.texture instanceof i.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Lo([m,t],o,p,{scaled:x=!0}={}){const{tileSize:T,buffer:E}=p,{x:j,y:O,z:B}=o;if(!isFinite(j)||!isFinite(O)||!isFinite(B))throw new Error("Invalid MRT header");const H=2**B,K=H*i.aF(m),Y=H*i.aJ(t);return(function([J,se],ae,{scaled:he=!0}={}){if(!ae)throw new Error("bandView is undefined");const{data:de,tileSize:_e,buffer:we,offset:ye,scale:Pe,dimension:Ae}=ae;if(J<-we||J>_e+we||se<-we||se>_e+we)throw new Error(`Point (${J}, ${se}) out of bounds for tileSize=${_e}, buffer=${we}`);const Ie=(se+we)*(_e+2*we)+(J+we);if(new Uint32Array(de.buffer)[Ie]===4294967295)return null;let je=[];je=he?[]:new ae.data.constructor(Ae);for(let Ce=0;Ce<Ae;Ce++)je[Ce]=Math.round(1e12*(de[Ae*Ie+Ce]*Pe+ye))/1e12;return je})([Math.min(Math.max(-E,Math.floor((K-j)*T)),T-1+E),Math.min(Math.max(-E,Math.floor((Y-O)*T)),T-1+E)],p,{scaled:x})}class Qr extends tr{constructor(t,o,p,x){super(t,o,p,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},o)}triggerRepaint(t){const o=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);o&&o.enabled&&p&&o._clearRenderCacheForTile(p.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){const p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,i.R.Tile),T={request:x,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=x,t.actor||(t.actor=this.dispatcher.getActor());const E=(j,O,B)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(j)return j.name==="AbortError"?void 0:(t.state="errored",o(j));if(this.map._refreshExpiredTiles&&O){const H=i.aM(B);t.setExpiryData(H)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!O)return o(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=O}o(null)};t.request=this.partial?t.fetchHeader(void 0,E.bind(this)):t.actor.send("loadTile",T,E.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){const p=t.texturePerLayer;if(t.flushAllQueues(),p.size){t.destroy(!1);for(const x of p.values())this.map.painter.saveTileTexture(x)}else t.destroy()}prepareTile(t,o,p,x){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(o,p,x,((T,E)=>{if(T)return t.state="errored",this.fire(new i.y(T)),void this.triggerRepaint(t);E&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(p,E,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find((({id:T})=>T===t)),p=o&&o.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(t,o,p){if(!t)return;const x=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let T=null;o instanceof i.aR?T=o.paint.get("raster-array-band"):o instanceof i.aS&&(T=o.paint.get("raster-particle-array-band"));const E=T||this.getInitialBand(x);if(E==null)return;if(!t.textureDescriptorPerLayer.get(o.id))return void this.prepareTile(t,x,o.id,E);if(t.updateNeeded(o.id,E)&&!p)return;const j=t.textureDescriptorPerLayer.get(o.id);return Object.assign({},j,{texture:t.texturePerLayer.get(o.id)})}getImages(t,o){const p=new Map;for(const x of t)for(const T of o){const[E,j]=T.split("/"),O=x.getLayer(E);if(!O||!O.hasBand(j)||!O.hasDataForBand(j))continue;const{bytes:B,tileSize:H,buffer:K}=O.getBandView(j),Y=H+2*K,J={data:new i.q({width:Y,height:Y},B),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(T,J)}return p}queryRasterArrayValueByBandId(t,o,p){const x=o._mrt;return new Promise((T=>{const E={},j=new Set;for(const[O,B]of Object.entries(x.layers)){if(p.layerName&&O!==p.layerName)continue;const H={};E[O]=H;for(const{bands:K}of B.dataIndex)for(const Y of K)p.bands&&!p.bands.includes(Y)||(j.add(i.B(O,Y)),o.fetchBand(O,null,Y,(J=>{i.o.frame((()=>{H[Y]=J?null:Lo([t.lng,t.lat],x,B.getBandView(Y)),j.delete(i.B(O,Y)),j.size===0&&T(E)}))}),!1))}j.size===0&&T(E)}))}_loadTileForQuery(t,o){if(this._loadTileLoaded[t.uid])return void o(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(o);this._loadTilePending[t.uid]=[o];const p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,i.R.Tile);t.actor.send("loadTile",{request:x,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((T,E,j)=>{if(T)return this._loadTilePending[t.uid].forEach((O=>O(T,null))),void delete this._loadTilePending[t.uid];if(!E)return this._loadTilePending[t.uid].forEach((O=>O(null,null))),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&E){const O=i.aM(j);t.setExpiryData(O)}t._mrt=E,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((O=>O(null,E))),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(t,o,p){return new Promise(((x,T)=>{this._loadTileForQuery(o,((E,j)=>{E?T(E):x(j?this.queryRasterArrayValueByBandId(t,o,p):null)}))}))}queryRasterArrayValue(t,o){const p=i.aT.convert(t),x=this.findLoadedParent(p);return x&&x._mrt?o.bands||!this.partial?this.queryRasterArrayValueByBandId(p,x,o):this.queryRasterArrayValueByAllBands(p,x,o):Promise.resolve(null)}findLoadedParent(t){const o=i.ae.fromLngLat(t,this.map.transform.tileSize),p=this.maxzoom+1,x=1<<p,T=Math.floor(o.x),E=Math.floor((o.x-T)*x),j=Math.floor(o.y*x),O=this.map.style.getSourceCache(this.id),B=new i.aQ(p,T,p,E,j);return O.findLoadedParent(B,this.minzoom)}}const os={vector:ss,raster:tr,"raster-dem":class extends tr{constructor(m,t,o,p){super(m,t,o,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(m,t){const o=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,T){x&&(m.state="errored",t(x)),T&&(m.dem=T,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",t(null))}m.request=i.n(this.map._requestManager.transformRequest(o,i.R.Tile),(function(x,T,E){if(delete m.request,m.aborted)m.state="unloaded",t(null);else if(x)m.state="errored",t(x);else if(T){const j=i.aM(E);this.map._refreshExpiredTiles&&m.setExpiryData(j);const O=ImageBitmap&&T instanceof ImageBitmap&&i.r(),B=1-(T.width-i.aP(T.width))/2;B<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const H=O?T:i.o.getImageData(T,B),K={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:H,encoding:this.encoding,padding:B};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",K,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const t=m.canonical,o=Math.pow(2,t.z),p=(t.x-1+o)%o,x=t.x===0?m.wrap-1:m.wrap,T=(t.x+1+o)%o,E=t.x+1===o?m.wrap+1:m.wrap,j={};return j[new i.aQ(m.overscaledZ,x,t.z,p,t.y).key]={backfilled:!1},j[new i.aQ(m.overscaledZ,E,t.z,T,t.y).key]={backfilled:!1},t.y>0&&(j[new i.aQ(m.overscaledZ,x,t.z,p,t.y-1).key]={backfilled:!1},j[new i.aQ(m.overscaledZ,m.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},j[new i.aQ(m.overscaledZ,E,t.z,T,t.y-1).key]={backfilled:!1}),t.y+1<o&&(j[new i.aQ(m.overscaledZ,x,t.z,p,t.y+1).key]={backfilled:!1},j[new i.aQ(m.overscaledZ,m.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},j[new i.aQ(m.overscaledZ,E,t.z,T,t.y+1).key]={backfilled:!1}),j}},"raster-array":Qr,geojson:class extends i.E{constructor(m,t,o,p){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(p),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const x=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*x,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*x,extent:i.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:i.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*x,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const o of this._data.features)t.set(o.id,o);for(const o of m.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},t),this}getClusterChildren(m,t){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},t),this}getClusterLeaves(m,t,o,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:t,offset:o},p),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:m},this.workerOptions);t.scope=this.scope;const o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(i.o.resolveURL(o),i.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new i.y(p));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(T.resourceTiming=x.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new i.z("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const m=i.B(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,t){const o=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=p?{image:p.image.clone()}:null,T=this._partialReload,E={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:T,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};m.request=this.actor.send(o,E,((j,O)=>T&&!O?(m.state="loaded",t(null)):(delete m.request,m.destroy(!1),m.aborted?t(null):j?t(j):(m.loadVectorData(O,this.map.painter,o==="reloadTile"),t(null)))),void 0,o==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,t){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aU{constructor(m,t,o,p){super(m,t,o,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const t of m.urls)this.urls.push(this.map._requestManager.transformRequest(t,i.R.Source).url);i.aV(this.urls,((t,o)=>{this._loaded=!0,t?this.fire(new i.y(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const t=this.video.seekable;m<t.start(0)||m>t.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,t=m.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(m,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aU,model:i.aX,"batched-model":class extends i.E{constructor(m,t,o,p){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(m)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Dn(this._options,this.map._requestManager,t,o,((p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new i.y(p))):x&&(Object.assign(this,x),x.bounds&&(this.tileBounds=new Zs(x.bounds,this.minzoom,this.maxzoom)),Ft(x.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),m&&m(p)}))}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,t){const o=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(o,i.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=t;else{if(m.buckets){const T=Object.values(m.buckets);for(const E of T)E.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",p,x.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(T,E){return m.aborted?t(null):T&&T.status!==404?t(T):(this.map._refreshExpiredTiles&&E&&m.setExpiryData(E),m.loadModelData(E,this.map.painter),m.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aU{constructor(m,t,o,p){super(m,t,o,p),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((x=>!Array.isArray(x)||x.length!==2||x.some((T=>typeof T!="number"))))||this.fire(new i.y(new i.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${m}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof i.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends i.E{constructor(m,t,o,p){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Zs(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:t,y:o,z:p}=m.canonical;return this._implementation.hasTile({x:t,y:o,z:p})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,t){const{x:o,y:p,z:x}=m.tileID.canonical,T=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:o,y:p,z:x},{signal:T.signal})).then((function(E){return delete m.request,m.aborted?(m.state="unloaded",t(null)):E===void 0?(m.state="errored",t(null)):E===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",t(null)):(function(j){return j instanceof ImageData||j instanceof HTMLCanvasElement||j instanceof ImageBitmap||j instanceof HTMLImageElement})(E)?(this.loadTileData(m,E),m.state="loaded",void t(null)):(m.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((E=>{E.name!=="AbortError"&&(m.state="errored",t(E))})),m.request.cancel=()=>T.abort()}loadTileData(m,t){m.setTexture(t,this.map.painter)}unloadTile(m,t){if(m.texture&&m.texture instanceof i.T?(m.destroy(!1),m.texture&&m.texture instanceof i.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:o,y:p,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:o,y:p,z:x})}t&&t()}abortTile(m,t){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z})))}_clearTiles(){const m=i.B(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},Sa=function(m,t,o,p){const x=new os[t.type](m,t,o,p);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return i.aY(["load","abort","unload","serialize","prepare"],x),x};function Io(m,t,o=""){return`${o}:${t.id||""}:${t.layer.id}:${(function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:x,importId:T}=p;return`featureset:${x}${T?`:import:${T}`:""}`}})(m.target)}`}function yo(m,t,o,p=""){if(m.uniqueFeatureID){const x=Io(m,t,p);if(o.has(x))return!0;o.add(x)}return!1}function Gc(m,t,o,p,x=!1){const T=t.sourceCache.transform,E=t.sourceCache.tilesIn(m,t.has3DLayers,x);E.sort(mc);const j=[];for(const O of E){const B=O.tile.queryRenderedFeatures(t,O,o,p,T,x);Object.keys(B).length&&j.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:B})}for(const O in t.layers){const B=t.layers[O];if(B.styleLayer){const H=B.styleLayer.queryRenderedFeatures(m,t.sourceCache,p);Object.keys(H).length&&j.push({wrappedTileID:0,queryResults:H})}}return j.length===0?{}:(function(O){const B={},H={};for(const K of O){const Y=K.queryResults,J=K.wrappedTileID,se=H[J]=H[J]||{};for(const ae in Y){const he=Y[ae],de=se[ae]=se[ae]||{},_e=B[ae]=B[ae]||[];for(const we of he)de[we.featureIndex]||(de[we.featureIndex]=!0,_e.push(we))}}return B})(j)}function Eu(m,t,o,p,x,T){const E={},j=p.queryRenderedSymbols(m),O=[];for(const B of Object.keys(j).map(Number))O.push(x[B]);O.sort(mc);for(const B of O){const H=B.featureIndex.lookupSymbolFeatures(j[B.bucketInstanceId],B.bucketIndex,B.sourceLayerIndex,t,o,T);for(const K in H){const Y=E[K]=E[K]||[],J=H[K];J.sort(((se,ae)=>{const he=B.featureSortOrder;if(he){const de=he.indexOf(se.featureIndex);return he.indexOf(ae.featureIndex)-de}return ae.featureIndex-se.featureIndex}));for(const se of J)Y.push(se)}}return E}function fc(m,t){const o=m.getRenderableIds().map((T=>m.getTileByID(T))),p=[],x={};for(let T=0;T<o.length;T++){const E=o[T],j=E.tileID.canonical.key;x[j]||(x[j]=!0,E.querySourceFeatures(p,t))}return p}function mc(m,t){const o=m.tileID,p=t.tileID;return o.overscaledZ-p.overscaledZ||o.canonical.y-p.canonical.y||o.wrap-p.wrap||o.canonical.x-p.canonical.x}function hl(m,t){const o={};if(!t)return o;for(const p of m){const x=p.layerIds.map((T=>t.getLayer(T))).filter(Boolean);if(x.length!==0){p.layers=x,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map((T=>x.filter((E=>E.id===T))[0])));for(const T of x)o[T.fqid]=p}}return o}const Ps=32,ao=33,vo=new Uint16Array(8184);for(let m=0;m<2046;m++){let t=m+2,o=0,p=0,x=0,T=0,E=0,j=0;for(1&t?x=T=E=Ps:o=p=j=Ps;(t>>=1)>1;){const B=o+x>>1,H=p+T>>1;1&t?(x=o,T=p,o=E,p=j):(o=x,p=T,x=E,T=j),E=B,j=H}const O=4*m;vo[O+0]=o,vo[O+1]=p,vo[O+2]=x,vo[O+3]=T}const Xs=new Uint16Array(2178),ro=new Uint8Array(1089),xo=new Uint16Array(1089);function qc(m){return m===0?-.03125:m===32?.03125:0}const la={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class Ys{constructor(t,o,p,x,T,E){this.tileID=t,this.uid=i.b2(),this.uses=0,this.tileSize=o,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=T,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=E,this._hasAppearances=null}registerFadeDuration(t){const o=t+this.timeAdded;o<i.o.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,p){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=hl(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const T=this.buckets[x];if(T instanceof i.b4){if(this.hasSymbolBuckets=!0,!p)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const T=this.buckets[x];if(T instanceof i.b4&&T.hasRTLText){this.hasRTLText=!0,i.b5();break}}this.queryPadding=0;for(const x in this.buckets){const T=this.buckets[x],E=o.style.getOwnLayer(x);if(!E)continue;const j=E.queryRadius(T);this.queryPadding=Math.max(this.queryPadding,j)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new i.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,p){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,hl(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,o){for(const T in this.buckets){const E=this.buckets[T];if(E.uploadPending()){let j={},O=[],B={zoom:0,pitch:0,brightness:0,worldview:""};if(o){if(o.style){O=o.style.listImages();const H=E.layers[0],K=H.sourceLayer||"_geojsonTileLayer",Y=o.style.getLayerSourceCache(H);Y&&(j=Y._state.getState(K,void 0))}B={zoom:o.transform.zoom||0,pitch:o.transform.pitch||0,brightness:o.style.getBrightness()||0,worldview:o.worldview||""}}E.upload(t,this.tileID.canonical,j,O,B)}}const p=t.gl,x=this.imageAtlas;x&&!x.uploaded&&(this.imageAtlasTexture=new i.T(t,x.image,p.RGBA8,{useMipmap:!!x.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(t,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(t,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,p),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=o.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(o)),(this._lastUpdatedBrightness||x||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const o in this.buckets){const p=this.buckets[o];p.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,p.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,o,p,x,T,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const j=this.evaluateQueryRenderedFeaturePadding(),O=(function(B,H){const K=i.bq([],[.5*B.width,.5*-B.height,1]);return i.br(K,K,[1,-1,0]),i.aB(K,K,B.calculateProjMatrix(H.toUnwrapped())),Float32Array.from(K)})(T,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:o,pixelPosMatrix:O,transform:x,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:j})}querySourceFeatures(t,o){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),T=o?o.sourceLayer:"",E=x._geojsonTileLayer||x[T];if(!E)return;const j=i.b6(o&&o.filter),{z:O,x:B,y:H}=this.tileID.canonical,K={z:O,x:B,y:H};for(let Y=0;Y<E.length;Y++){const J=E.feature(Y);if(j.needGeometry){const he=i.b7(J,!0);if(!j.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),he,this.tileID.canonical))continue}else if(!j.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),J))continue;const se=p.getId(J,T),ae=new i.b8(J,O,B,H,se);ae.tile=K,t.push(ae)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const p=i.b9(t.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(o)if(this.expirationTime<o)x=!0;else{const T=this.expirationTime-o;T?this.expirationTime=p+Math.max(T,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const o in this.buckets)if(t.style.hasLayer(o)&&this.buckets[o].layers.some((p=>p.appearances&&p.appearances.length>0)))return!0;return!1}updateBuckets(t,o){if(!this.latestFeatureIndex||!t.style)return;const p=t.style.listImages(),x=t.style.getBrightness();for(const T in this.buckets){if(!t.style.hasLayer(T))continue;const E=this.buckets[T],j=E.layers[0],O=j.sourceLayer||"_geojsonTileLayer",B=t.style.getLayerSourceCache(j);let H={};B&&(H=B._state.getState(O,void 0));const K=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Y=Object.keys(H).length>0&&!o;E.hasAppearances=E.layers.some((ae=>ae.appearances&&ae.appearances.length>0));const J=Y?E.stateDependentLayers:E.layers;if(Y&&E.stateDependentLayers.length!==0||o){const ae=this.latestFeatureIndex.loadVTLayers();E.update(H,ae[O],p,K,J,o,x)}if(Y&&E.stateDependentLayers.length!==0||o||E.hasAppearances){const ae={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};E.updateAppearances(this.tileID.canonical,H,p,ae)}(E instanceof i.ba||E instanceof i.bb)&&t._terrain&&t._terrain.enabled&&B&&E.uploadPending()&&t._terrain._clearRenderCacheForTile(B.id,this.tileID);const se=t&&t.style&&t.style.getOwnLayer(T);se&&(this.queryPadding=Math.max(this.queryPadding,se.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=i.o.now()+t}setTexture(t,o){const p=o.context,x=p.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t):(this.texture=new i.T(p,t,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(t,o){const p={};for(const x of o)p[x]=!0;this.dependencies[t]=p}hasDependency(t,o){for(const p of t){const x=this.dependencies[p];if(x){for(const T of o)if(x[T])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const p=i.bc(la,this.tileID.canonical,this.tileTransform)[0],x=new i.bd,T=new i.be;for(let E=0;E<p.length;E++){const{x:j,y:O}=p[E];x.emplaceBack(j,O),T.emplaceBack(E)}T.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(T),this._tileDebugBuffer=t.createVertexBuffer(x,i.bf.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,x.length,T.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const p=i.bc(la,this.tileID.canonical,this.tileTransform)[0];let x,T;if(this.isRaster){const E=(function(j,O){const B=i.aZ(j,O),H=Math.pow(2,j.z);for(let he=0;he<ao;he++)for(let de=0;de<ao;de++){const _e=i.a_((j.x+(de+qc(de))/Ps)/H),we=i.a$((j.y+(he+qc(he))/Ps)/H),ye=O.project(_e,we),Pe=he*ao+de;Xs[2*Pe+0]=Math.round((ye.x*B.scale-B.x)*i.al),Xs[2*Pe+1]=Math.round((ye.y*B.scale-B.y)*i.al)}ro.fill(0),xo.fill(0);for(let he=2045;he>=0;he--){const de=4*he,_e=vo[de+0],we=vo[de+1],ye=vo[de+2],Pe=vo[de+3],Ae=_e+ye>>1,Ie=we+Pe>>1,je=Ae+Ie-we,Ce=Ie+_e-Ae,Ge=we*ao+_e,it=Pe*ao+ye,Ke=Ie*ao+Ae,ht=Math.hypot((Xs[2*Ge+0]+Xs[2*it+0])/2-Xs[2*Ke+0],(Xs[2*Ge+1]+Xs[2*it+1])/2-Xs[2*Ke+1])>=16;ro[Ke]=ro[Ke]||(ht?1:0),he<1022&&(ro[Ke]=ro[Ke]||ro[(we+Ce>>1)*ao+(_e+je>>1)]||ro[(Pe+Ce>>1)*ao+(ye+je>>1)])}const K=new i.b1,Y=new i.b0;let J=0;function se(he,de){const _e=de*ao+he;return xo[_e]===0&&(K.emplaceBack(Xs[2*_e+0],Xs[2*_e+1],he*i.al/Ps,de*i.al/Ps),xo[_e]=++J),xo[_e]-1}function ae(he,de,_e,we,ye,Pe){const Ae=he+_e>>1,Ie=de+we>>1;if(Math.abs(he-ye)+Math.abs(de-Pe)>1&&ro[Ie*ao+Ae])ae(ye,Pe,he,de,Ae,Ie),ae(_e,we,ye,Pe,Ae,Ie);else{const je=se(he,de),Ce=se(_e,we),Ge=se(ye,Pe);Y.emplaceBack(je,Ce,Ge)}}return ae(0,0,Ps,Ps,Ps,0),ae(Ps,Ps,0,0,0,Ps),{vertices:K,indices:Y}})(this.tileID.canonical,o);x=E.vertices,T=E.indices}else{x=new i.b1,T=new i.b0;for(const{x:j,y:O}of p)x.emplaceBack(j,O,0,0);const E=i.bh(x.int16.subarray(0,4*x.length),void 0,4);for(let j=0;j<E.length;j+=3)T.emplaceBack(E[j],E[j+1],E[j+2])}this._tileBoundsBuffer=t.createVertexBuffer(x,i.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(T),this._tileBoundsSegments=i.bg.simpleSegment(0,0,x.length,T.length)}_makeGlobeTileDebugBuffers(t,o){const p=o.projection;if(!p||p.name!=="globe"||o.freezeTileCoverage)return;const x=this.tileID.canonical,T=i.bj(x,o),E=i.bk(T),j=i.aj(o.zoom);let O;j>0&&(O=i.bl(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,x,o,E,O,j),this._makeGlobeTileDebugTextBuffer(t,x,o,E,O,j)}_globePoint(t,o,p,x,T,E,j){let O=i.bm(t,o,p);if(E){const B=1<<p.z,H=i.aF(x.center.lng),K=i.aJ(x.center.lat),Y=(p.x+.5)/B-H;let J=0;Y>.5?J=-1:Y<-.5&&(J=1);let se=(t/i.al+p.x)/B+J,ae=(o/i.al+p.y)/B;se=(se-H)*x._pixelsPerMercatorPixel+H,ae=(ae-K)*x._pixelsPerMercatorPixel+K;const he=[se*x.worldSize,ae*x.worldSize,0];i.af(he,he,E),O=i.bn(O,he,j)}return i.af(O,O,T)}_makeGlobeTileDebugBorderBuffer(t,o,p,x,T,E){const j=new i.bd,O=new i.be,B=new i.bo,H=(Y,J,se,ae,he)=>{const de=(se-Y)/(he-1),_e=(ae-J)/(he-1),we=j.length;for(let ye=0;ye<he;ye++){const Pe=Y+ye*de,Ae=J+ye*_e;j.emplaceBack(Pe,Ae);const Ie=this._globePoint(Pe,Ae,o,p,x,T,E);B.emplaceBack(Ie[0],Ie[1],Ie[2]),O.emplaceBack(we+ye)}},K=i.al;H(0,0,K,0,16),H(K,0,K,K,16),H(K,K,0,K,16),H(0,K,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(O),this._tileDebugBuffer=t.createVertexBuffer(j,i.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(B,i.bp.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,j.length,O.length)}_makeGlobeTileDebugTextBuffer(t,o,p,x,T,E){const j=i.al/4,O=new i.bd,B=new i.b0,H=new i.bo,K=25;B.reserve(32),O.reserve(K),H.reserve(K);const Y=(J,se)=>K*J+se;for(let J=0;J<K;J++){const se=J*j;for(let ae=0;ae<K;ae++){const he=ae*j;O.emplaceBack(he,se);const de=this._globePoint(he,se,o,p,x,T,E);H.emplaceBack(de[0],de[1],de[2])}}for(let J=0;J<4;J++)for(let se=0;se<4;se++){const ae=Y(J,se),he=Y(J,se+1),de=Y(J+1,se),_e=Y(J+1,se+1);B.emplaceBack(ae,he,de),B.emplaceBack(de,he,_e)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(B),this._tileDebugTextBuffer=t.createVertexBuffer(O,i.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(H,i.bp.members),this._tileDebugTextSegments=i.bg.simpleSegment(0,0,K,32)}destroy(t=!0){for(const o in this.buckets)this.buckets[o].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof i.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bs.setPbf(i.bt);class rr extends Ys{constructor(t,o,p,x,T){super(t,o,p,x,T),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,o,p){const x=p.context,T=x.gl;let E=this.texturePerLayer.get(t)||p.getTileTexture(o.width);E&&E instanceof i.T?E.update(o,{premultiply:!1}):E=new i.T(x,o,T.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,E)}flushQueues(t){const o=this._workQueuePerLayer.get(t)||[],p=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const o=this._workQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const o=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}}fetchHeader(t=16384,o){const p=this._mrt=new i.bs(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=i.bu(x,((T,E,j)=>{if(T)o(T);else try{const O=p.getHeaderLength(E);if(O>t)return void(this.request=this.fetchHeader(O,o));p.parseHeader(E),this._isHeaderLoaded=!0;let B=0;for(const H of Object.values(p.layers))B=Math.max(B,H.dataIndex[H.dataIndex.length-1].lastByte);E.byteLength>=B&&(this.entireBuffer=E),o(null,this.entireBuffer||E,j)}catch(O){o(O)}})),this.request}fetchBandForRender(t,o,p,x){this.fetchBand(t,o,p,(T=>{if(T)return void x(T);this.updateTextureDescriptor(t,o,p);const E=this.textureDescriptorPerLayer.get(o);x(null,E?E.img:null)}))}fetchBand(t,o,p,x,T=!0){const E=this._mrt;if(!this._isHeaderLoaded||!E)return void x(new Error("Tile header is not ready"));const j=this.actor;if(!j)return void x(new Error("Can't fetch tile band without an actor"));let O;const B=i.B(String(p),i.B(this.tileID.key,t));let H=this._taskQueue.get(B);H?H.add(x):(H=new Set,H.add(x),this._taskQueue.set(B,H));const K=(ae,he)=>{O.complete(ae,he),ae?x(ae):(H.forEach((de=>de(null,he))),this._taskQueue.delete(B))},Y=(ae,he)=>{if(ae)return x(ae);const de=j.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:he,task:O},K,void 0,!0);if(o!==null){const _e=this._workQueuePerLayer.get(o)||[];_e.push((()=>{de&&de.cancel(),O.cancel()})),this._workQueuePerLayer.has(o)||this._workQueuePerLayer.set(o,_e)}};let J;try{J=E.getLayer(t)}catch(ae){if(this.state==="reloading")return;throw ae}if(!J)return void x(new Error(`Unknown sourceLayer "${t}"`));if(J.hasDataForBand(p))return H.forEach((ae=>ae(null,null))),void this._taskQueue.delete(B);const se=J.getDataRange([p]);if(O=E.createDecodingTask(se),!O||O.tasks.length)if(o!==null&&this.flushQueues(o),this.entireBuffer)Y(null,this.entireBuffer.slice(se.firstByte,se.lastByte+1));else{const ae=Object.assign({},this.requestParams,{headers:{Range:`bytes=${se.firstByte}-${se.lastByte}`}}),he=i.bu(ae,Y);if(o!==null){const de=this._fetchQueuePerLayer.get(o)||[];de.push((()=>{he.cancel(),O.cancel()})),this._fetchQueuePerLayer.has(o)||this._fetchQueuePerLayer.set(o,de)}}}updateNeeded(t,o){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==o||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,o,p){if(!this._mrt)return;const x=this._mrt.getLayer(t);if(!x||!x.hasBand(p)||!x.hasDataForBand(p))return;const{bytes:T,tileSize:E,buffer:j,offset:O,scale:B}=x.getBandView(p),H=E+2*j,K=new i.q({width:H,height:H},T),Y=this.texturePerLayer.get(o);Y&&Y instanceof i.T&&Y.update(K,{premultiply:!1}),this.textureDescriptorPerLayer.set(o,{layer:t,band:p,img:K,buffer:j,offset:O,tileSize:E,format:x.pixelFormat,mix:[B,256*B,65536*B,16777216*B]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const o of this.texturePerLayer.values())o&&o instanceof i.T&&o.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Dl{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,p){const x=t.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const T={value:o,timeout:void 0};if(p!==void 0&&(T.timeout=setTimeout((()=>{this.remove(t,T)}),p)),this.data[x].push(T),this.order.push(x),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const p=t.wrapped().key,x=o===void 0?0:this.data[p].indexOf(o),T=this.data[p][x];return this.data[p].splice(x,1),T.timeout&&clearTimeout(T.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(T.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const p in this.data)for(const x of this.data[p])t(x.value)||o.push(x);for(const p of o)this.remove(p.value.tileID,p)}}class pc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,p){const x=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][x]=this.stateChanges[t][x]||{},Object.assign(this.stateChanges[t][x],p),this.deletedStates[t]===null){this.deletedStates[t]={};for(const T in this.state[t])T!==x&&(this.deletedStates[t][T]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][x]===null){this.deletedStates[t][x]={};for(const T in this.state[t][x])p[T]||(this.deletedStates[t][x][T]=null)}else for(const T in p)this.deletedStates[t]&&this.deletedStates[t][x]&&this.deletedStates[t][x][T]===null&&delete this.deletedStates[t][x][T]}removeFeatureState(t,o,p){if(this.deletedStates[t]===null)return;const x=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},p&&o!==void 0)this.deletedStates[t][x]!==null&&(this.deletedStates[t][x]=this.deletedStates[t][x]||{},this.deletedStates[t][x][p]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][x])for(p in this.deletedStates[t][x]={},this.stateChanges[t][x])this.deletedStates[t][x][p]=null;else this.deletedStates[t][x]=null;else this.deletedStates[t]=null}getState(t,o){const p=this.state[t]||{},x=this.stateChanges[t]||{},T=this.deletedStates[t];if(T===null)return{};if(o!==void 0){const j=String(o),O=Object.assign({},p[j],x[j]);if(T){const B=T[o];if(B===null)return{};for(const H in B)delete O[H]}return O}const E=Object.assign({},p,x);if(T)for(const j in T)delete E[j];return E}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const T={};for(const E in this.stateChanges[x])this.state[x][E]||(this.state[x][E]={}),Object.assign(this.state[x][E],this.stateChanges[x][E]),T[E]=this.state[x][E];p[x]=T}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const T={};if(this.deletedStates[x]===null)for(const E in this.state[x])T[E]={},this.state[x][E]={};else for(const E in this.deletedStates[x]){if(this.deletedStates[x][E]===null)this.state[x][E]={};else if(this.state[x][E])for(const j of Object.keys(this.deletedStates[x][E]))delete this.state[x][E][j];T[E]=this.state[x][E]}p[x]=p[x]||{},Object.assign(p[x],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in t)t[x].refreshFeatureState(o)}}class hs extends i.E{constructor(t,o,p){super(),this.id=t,this._onlySymbols=p,o.on("data",(x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),o.on("error",(()=>{this._sourceErrored=!0})),this._source=o,this._tiles={},this._cache=new Dl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new pc,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const p=this._tiles[o];p.upload(t,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Qo).map((t=>t.key))}getRenderableIds(t,o){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,t,o)&&p.push(this._tiles[x]);return t?p.sort(((x,T)=>{const E=x.tileID,j=T.tileID,O=new i.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),B=new i.P(j.canonical.x,j.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-j.overscaledZ||B.y-O.y||B.x-O.x})).map((x=>x.tileID.key)):p.map((x=>x.tileID)).sort(Qo).map((x=>x.key))}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,p){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(p||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){const p=this._tiles[t];p&&(p.state!=="loading"&&(p.state=o),this._loadTile(p,this._tileLoaded.bind(this,p,t,o)))}_tileLoaded(t,o,p,x,T){if(x){if(t.state="errored",x.status!==404)this._source.fire(new i.y(x,{tile:t}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const j=this.map.painter.terrain;this.update(this.transform,j.getScaledDemTileSize(),!0),j.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=i.o.now(),p==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let E=new Map;T&&T.responseHeaders&&(E=T.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:E}))}_backfillDEM(t){const o=this.getRenderableIds();for(let x=0;x<o.length;x++){const T=o[x];if(t.neighboringTiles&&t.neighboringTiles[T]){const E=this.getTileByID(T);p(t,E),p(E,t)}}function p(x,T){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let E=T.tileID.canonical.x-x.tileID.canonical.x;const j=T.tileID.canonical.y-x.tileID.canonical.y,O=Math.pow(2,x.tileID.canonical.z),B=T.tileID.key;E===0&&j===0||Math.abs(j)>1||(Math.abs(E)>1&&(Math.abs(E+O)===1?E+=O:Math.abs(E-O)===1&&(E-=O)),T.dem&&x.dem&&(x.dem.backfillBorder(T.dem,E,j),x.neighboringTiles&&x.neighboringTiles[B]&&(x.neighboringTiles[B].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,p,x){for(const T in this._tiles){let E=this._tiles[T];if(x[T]||!E.hasData()||E.tileID.overscaledZ<=o||E.tileID.overscaledZ>p)continue;let j=E.tileID;for(;E&&E.tileID.overscaledZ>o+1;){const B=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[B.key],E&&E.hasData()&&(j=B)}let O=j;for(;O.overscaledZ>o;)if(O=O.scaledTo(O.overscaledZ-1),t[O.key]){x[j.key]=j;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const p=this._loadedParentTiles[t.key];return p&&p.tileID.overscaledZ>=o?p:null}for(let p=t.overscaledZ-1;p>=o;p--){const x=t.scaledTo(p),T=this._getLoadedTile(x);if(T)return T}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;const p=Math.ceil(t.width/o)+1,x=Math.ceil(t.height/o)+1,T=Math.floor(p*x*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,T):T,j=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(j)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const p={};for(const x in this._tiles){const T=this._tiles[x];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+o),p[T.tileID.key]=T}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(t,o,p,x,T){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let j,O=this._source.maxzoom;const B=this.map&&this.map.painter?this.map.painter._terrain:null;if(B&&B.sourceCache===this&&B.attenuationRange()){const Y=B.attenuationRange()[0],J=Math.floor(Y)-Math.log2(B.getDemUpscale());O>J&&(O=J)}if(this.used||this.usedForTerrain){if(this._source.tileID)j=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((Y=>new i.aQ(Y.canonical.z,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y)));else if(this.tileCoverLift!==0){const Y=t.clone();Y.tileCoverLift=this.tileCoverLift,j=Y.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&t.projection.name==="globe"&&(j.push(new i.aQ(1,0,1,0,0)),j.push(new i.aQ(1,0,1,1,0)),j.push(new i.aQ(1,0,1,0,1)),j.push(new i.aQ(1,0,1,1,1)))}else if(j=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const Y=this._source.hasTile.bind(this._source);j=j.filter((J=>Y(J)))}}else j=[];if(j.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!bo(this._source.type)){const Y=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),J=Math.min(Y,this._source.maxzoom);if(E){const se=t.extendTileCover(j,J);for(const ae of se)j.push(ae)}else if(T){const se=t.extendTileCoverToNearPlane(j,this.transform.getFrustum(J),J);for(const ae of se)j.push(ae)}else if(this.castsShadows&&x){const se=t.extendTileCover(j,J,x,16);for(const ae of se)this._shadowCasterTiles[ae.key]=!0,j.push(ae)}}const H=this._updateRetainedTiles(j);if(bo(this._source.type)&&j.length!==0){const Y={},J={},se=Object.keys(H);for(const he of se){const de=H[he],_e=this._tiles[he];if(!_e||_e.fadeEndTime&&_e.fadeEndTime<=i.o.now())continue;const we=this.findLoadedParent(de,Math.max(de.overscaledZ-hs.maxOverzooming,this._source.minzoom));we&&(this._addTile(we.tileID),Y[we.tileID.key]=we.tileID),J[he]=de}const ae=j[j.length-1].overscaledZ;for(const he in this._tiles){const de=this._tiles[he];if(H[he]||!de.hasData())continue;let _e=de.tileID;for(;_e.overscaledZ>ae;){_e=_e.scaledTo(_e.overscaledZ-1);const we=this._tiles[_e.key];if(we&&we.hasData()&&J[_e.key]){H[he]=de.tileID;break}}}for(const he in Y)H[he]||(this._coveredTiles[he]=!0,H[he]=Y[he])}for(const Y in H)this._tiles[Y].clearFadeHold();const K=i.bv(this._tiles,H);for(const Y of K){const J=this._tiles[Y];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile(+Y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const o={};if(t.length===0)return o;const p={},x=t.reduce(((B,H)=>Math.min(B,H.overscaledZ)),1/0),T=t[0].overscaledZ,E=Math.max(T-hs.maxOverzooming,this._source.minzoom),j=Math.max(T+hs.maxUnderzooming,this._source.minzoom),O={};for(const B of t){const H=this._addTile(B);o[B.key]=B,H.hasData()||x<this._source.maxzoom&&(O[B.key]=B)}this._retainLoadedChildren(O,x,j,o);for(const B of t){let H=this._tiles[B.key];if(H.hasData())continue;if(B.canonical.z>=this._source.maxzoom){const Y=B.children(this._source.maxzoom)[0],J=this.getTile(Y);if(J&&J.hasData()){o[Y.key]=Y;continue}}else{const Y=B.children(this._source.maxzoom);if(o[Y[0].key]&&o[Y[1].key]&&o[Y[2].key]&&o[Y[3].key])continue}let K=H.wasRequested();for(let Y=B.overscaledZ-1;Y>=E;--Y){const J=B.scaledTo(Y);if(p[J.key]||(p[J.key]=!0,H=this.getTile(J),!H&&K&&(H=this._addTile(J)),H&&(o[J.key]=J,K=H.wasRequested(),H.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let p,x=this._tiles[t].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}o.push(x.key);const T=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(T),p)break;x=T}for(const T of o)this._loadedParentTiles[T]=p}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const p=!!o;if(!p){const x=this.map?this.map.painter:null,T=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new rr(t,T,this.transform.tileZoom,x,this._isRaster):new Ys(t,T,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o.uses++,this._tiles[t.key]=o,p||this._source.fire(new i.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const p=o.getExpiryTimeout();p&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),p))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,p){const x=[],T=this.transform;if(!T)return x;const E=T.projection.name==="globe",j=i.aF(T.center.lng);for(const O in this._tiles){const B=this._tiles[O];if(p&&B.clearQueryDebugViz(),B.holdingForFade())continue;let H;if(E){const K=B.tileID.canonical;if(K.z===0){const Y=[Math.abs(i.aA(j,...zo(K,-1))-j),Math.abs(i.aA(j,...zo(K,1))-j)];H=[0,2*Y.indexOf(Math.min(...Y))-1]}else{const Y=[Math.abs(i.aA(j,...zo(K,-1))-j),Math.abs(i.aA(j,...zo(K,0))-j),Math.abs(i.aA(j,...zo(K,1))-j)];H=[Y.indexOf(Math.min(...Y))-1]}}else H=[0];for(const K of H){const Y=t.containsTile(B,T,o,K);Y&&x.push(Y)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){const p=this.getRenderableIds(t,o).map((T=>this._tiles[T].tileID)),x=this.transform.projection.name==="globe";for(const T of p)T.projMatrix=this.transform.calculateProjMatrix(T.toUnwrapped()),T.expandedProjMatrix=x?this.transform.calculateProjMatrix(T.toUnwrapped(),!1,!0):T.projMatrix;return p}sortCoordinatesByDistance(t){const o=t.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),T={};for(const E of o){const j=1/(1<<E.canonical.z);T[E.key]=((E.canonical.x+.5)*j+E.wrap-p[0])*x[0]+((E.canonical.y+.5)*j-p[1])*x[1]-p[2]*x[2]}return o.sort(((E,j)=>T[E.key]-T[j.key])),o}hasTransition(){if(this._source.hasTransition())return!0;if(bo(this._source.type))for(const t in this._tiles){const o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(t,o,p){this._state.updateState(t=t||"_geojsonTileLayer",o,p)}removeFeatureState(t,o,p){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,p)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,p){const x=this._tiles[t];x&&x.setDependencies(o,p)}reloadTilesForDependencies(t,o){for(const p in this._tiles)this._tiles[p].hasDependency(t,o)&&this._reloadTile(+p,"reloading");this._cache.filter((p=>!p.hasDependency(t,o)))}_preloadTiles(t,o){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(t,o))};return void this._source.on("data",O)}const p=new Map,x=Array.isArray(t)?t:[t],T=this.map.painter.terrain,E=this.usedForTerrain&&T?T.getScaledDemTileSize():this._source.tileSize;for(const O of x){const B=O.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const H of B)p.set(H.key,H);this.usedForTerrain&&O.updateElevation(!1)}const j=Array.from(p.values());i.bw(j,((O,B)=>{const H=new Ys(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(H,(K=>{this._source.type==="raster-dem"&&H.dem&&this._backfillDEM(H),B(K,H)}))}),o)}}function Qo(m,t){const o=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*t.wrap)-+(t.wrap<0);return m.overscaledZ-t.overscaledZ||p-o||t.canonical.y-m.canonical.y||t.canonical.x-m.canonical.x}function bo(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function zo(m,t){const o=1<<m.z;return[m.x/o+t,(m.x+1)/o+t]}hs.maxOverzooming=10,hs.maxUnderzooming=3;class Ku{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,o=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:t,visibilityChanged:o});else if(x.type==="model"){const T=this.style.getLayerSource(x);T&&T.type==="batched-model"&&this.layers.push({layer:x,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(const o of this.layers){const p=o.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(t)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?x=!p.isHidden(t)&&p.paint.get("building-opacity")>0:p.type==="model"&&(x=!p.isHidden(t)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&o.visible,o.visible=x}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(const x of this.layers){const T=x.layer,E=this.style.getLayerSourceCache(T);let j=1;T.type==="fill-extrusion"?j=x.visible?T.paint.get("fill-extrusion-vertical-scale"):0:T.type==="building"&&(j=x.visible?T.paint.get("building-vertical-scale"):0);let O=E?E.getTile(o):null;if(!O&&E)for(const B in E._tiles){const H=E._tiles[B];if(o.canonical.isChildOf(H.tileID.canonical)){O=H;break}}this.currentBuildingBuckets.push({bucket:O?O.getBucket(T):null,tileID:O?O.tileID:o,verticalScale:j})}t.hasAnyZOffset=!1;let p=!1;for(let x=0;x<t.symbolInstances.length;x++){const T=t.symbolInstances.get(x),E=T.zOffset,j=this._getHeightAtTileOffset(o,T.tileAnchorX,T.tileAnchorY);T.zOffset=j!==Number.NEGATIVE_INFINITY?j:E,p||E===T.zOffset||(p=!0),t.hasAnyZOffset||T.zOffset===0||(t.hasAnyZOffset=!0)}p&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,p,x){let T=o,E=p;if(t.canonical.z!==x.canonical.z){const j=x.canonical,O=1/(1<<t.canonical.z-j.z);T=(o+t.canonical.x*i.al)*O-j.x*i.al|0,E=(p+t.canonical.y*i.al)*O-j.y*i.al|0}return{tileX:T,tileY:E}}_getHeightAtTileOffset(t,o,p){let x,T;for(let E=0;E<this.layers.length;++E){const j=this.layers[E].layer;if(j.type!=="fill-extrusion"&&j.type!=="building")continue;const{bucket:O,tileID:B,verticalScale:H}=this.currentBuildingBuckets[E];if(!O)continue;const{tileX:K,tileY:Y}=this._mapCoordToOverlappingTile(t,o,p,B),J=O.getHeightAtTileCoord(K,Y);J&&J.height!==void 0&&(J.hidden?x=J.height:T=Math.max(J.height*H,T||0))}if(T!==void 0)return T;for(let E=0;E<this.layers.length;++E){const j=this.layers[E];if(j.layer.type!=="model"||!j.visible)continue;const{bucket:O,tileID:B}=this.currentBuildingBuckets[E];if(!O)continue;const{tileX:H,tileY:K}=this._mapCoordToOverlappingTile(t,o,p,B),Y=O.getHeightAtTileCoord(H,K);if(Y&&!Y.hidden)return Y.height===void 0&&x!==void 0?Math.min(Y.maxHeight,x)*Y.verticalScale:Y.height?Y.height*Y.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ls(m,t){const o={};for(const p in m)p!=="ref"&&(o[p]=m[p]);return i.bx.forEach((p=>{p in t&&(o[p]=t[p])})),o}function Do(m){m=m.slice();const t=Object.create(null);for(let o=0;o<m.length;o++)t[m[o].id]=m[o];for(let o=0;o<m.length;o++)"ref"in m[o]&&(m[o]=ls(m[o],t[m[o].ref]));return m}const qn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function js(m,t,o){o.push({command:qn.addSource,args:[m,t[m]]})}function gc(m,t,o){t.push({command:qn.removeSource,args:[m]}),o[m]=!0}function Ju(m,t,o,p){gc(m,o,p),js(m,t,o)}function Wc(m,t,o){let p;for(p in m[o])if(m[o].hasOwnProperty(p)&&p!=="data"&&!i.by(m[o][p],t[o][p]))return!1;for(p in t[o])if(t[o].hasOwnProperty(p)&&p!=="data"&&!i.by(m[o][p],t[o][p]))return!1;return!0}function Zc(m,t,o,p,x,T){let E;for(E in t=t||{},m=m||{})m.hasOwnProperty(E)&&(i.by(m[E],t[E])||o.push({command:T,args:[p,E,t[E],x]}));for(E in t)t.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(i.by(m[E],t[E])||o.push({command:T,args:[p,E,t[E],x]}))}function Xc(m){return m.id}function Pa(m,t){return m[t.id]=t,m}function Au(m,t,o){const p=t.createTileMatrix(m,m.worldSize,o.toUnwrapped());return i.aB(new Float32Array(16),m.projMatrix,p)}function Ks(m,t,o){if(t.projection.name===o.projection.name)return m.projMatrix;const p=o.clone();return p.setProjection(t.projection),Au(p,t.getProjection(),m)}function wo(m,t,o){return t.name===o.projection.name?m.projMatrix:Au(o,t,m)}class Qu{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=i.aA(t,0,1);let o=1,p=this._distances[o];const x=t*this.paddedLength+this.padding;for(;p<x&&o<this._distances.length;)p=this._distances[++o];const T=o-1,E=this._distances[T],j=p-E,O=j>0?(x-E)/j:0;return this.points[T].mult(1-O).add(this.points[o].mult(O))}}class Tf{constructor(t,o,p){const x=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(o/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,p,x,T){this._forEachCell(o,p,x,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(T)}insertCircle(t,o,p,x){this._forEachCell(o-x,p-x,o+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(p),this.circles.push(x)}_insertBoxCell(t,o,p,x,T,E){this.boxCells[T].push(E)}_insertCircleCell(t,o,p,x,T,E){this.circleCells[T].push(E)}_query(t,o,p,x,T,E){if(p<0||t>this.width||x<0||o>this.height)return!T&&[];const j=[];if(t<=0&&o<=0&&this.width<=p&&this.height<=x){if(T)return!0;for(let O=0;O<this.boxKeys.length;O++)j.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const B=this.circles[3*O],H=this.circles[3*O+1],K=this.circles[3*O+2];j.push({key:this.circleKeys[O],x1:B-K,y1:H-K,x2:B+K,y2:H+K})}return E?j.filter(E):j}return this._forEachCell(t,o,p,x,this._queryCell,j,{hitTest:T,seenUids:{box:{},circle:{}}},E),T?j.length>0:j}_queryCircle(t,o,p,x,T){const E=t-p,j=t+p,O=o-p,B=o+p;if(j<0||E>this.width||B<0||O>this.height)return!x&&[];const H=[];return this._forEachCell(E,O,j,B,this._queryCellCircle,H,{hitTest:x,circle:{x:t,y:o,radius:p},seenUids:{box:{},circle:{}}},T),x?H.length>0:H}query(t,o,p,x,T){return this._query(t,o,p,x,!1,T)}hitTest(t,o,p,x,T){return this._query(t,o,p,x,!0,T)}hitTestCircle(t,o,p,x){return this._queryCircle(t,o,p,!0,x)}_queryCell(t,o,p,x,T,E,j,O){const B=j.seenUids,H=this.boxCells[T];if(H!==null){const Y=this.bboxes;for(const J of H)if(!B.box[J]){B.box[J]=!0;const se=4*J;if(t<=Y[se+2]&&o<=Y[se+3]&&p>=Y[se+0]&&x>=Y[se+1]&&(!O||O(this.boxKeys[J]))){if(j.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[J],x1:Y[se],y1:Y[se+1],x2:Y[se+2],y2:Y[se+3]})}}}const K=this.circleCells[T];if(K!==null){const Y=this.circles;for(const J of K)if(!B.circle[J]){B.circle[J]=!0;const se=3*J;if(this._circleAndRectCollide(Y[se],Y[se+1],Y[se+2],t,o,p,x)&&(!O||O(this.circleKeys[J]))){if(j.hitTest)return E.push(!0),!0;{const ae=Y[se],he=Y[se+1],de=Y[se+2];E.push({key:this.circleKeys[J],x1:ae-de,y1:he-de,x2:ae+de,y2:he+de})}}}}}_queryCellCircle(t,o,p,x,T,E,j,O){const B=j.circle,H=j.seenUids,K=this.boxCells[T];if(K!==null){const J=this.bboxes;for(const se of K)if(!H.box[se]){H.box[se]=!0;const ae=4*se;if(this._circleAndRectCollide(B.x,B.y,B.radius,J[ae+0],J[ae+1],J[ae+2],J[ae+3])&&(!O||O(this.boxKeys[se])))return E.push(!0),!0}}const Y=this.circleCells[T];if(Y!==null){const J=this.circles;for(const se of Y)if(!H.circle[se]){H.circle[se]=!0;const ae=3*se;if(this._circlesCollide(J[ae],J[ae+1],J[ae+2],B.x,B.y,B.radius)&&(!O||O(this.circleKeys[se])))return E.push(!0),!0}}}_forEachCell(t,o,p,x,T,E,j,O){const B=this._convertToXCellCoord(t),H=this._convertToYCellCoord(o),K=this._convertToXCellCoord(p),Y=this._convertToYCellCoord(x);for(let J=B;J<=K;J++)for(let se=H;se<=Y;se++)if(T.call(this,t,o,p,x,this.xCellCount*se+J,E,j,O))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,p,x,T,E){const j=x-t,O=T-o,B=p+E;return B*B>j*j+O*O}_circleAndRectCollide(t,o,p,x,T,E,j){const O=(E-x)/2,B=Math.abs(t-(x+O));if(B>O+p)return!1;const H=(j-T)/2,K=Math.abs(o-(T+H));if(K>H+p)return!1;if(B<=O||K<=H)return!0;const Y=B-O,J=K-H;return Y*Y+J*J<=p*p}}const nc={unknown:0,flipRequired:1,flipNotRequired:2},_c=Math.tan(85*Math.PI/180);function Rs(m,t,o,p,x,T,E){const j=i.bC();if(o)if(T.name==="globe"){const O=i.bD(x,t);i.aB(j,j,O)}else{const O=i.bE([],E);j[0]=O[0],j[1]=O[1],j[4]=O[2],j[5]=O[3],p||i.bB(j,j,x.angle)}else i.aB(j,x.labelPlaneMatrix,m);return j}function Ah(m,t,o,p,x,T,E){const j=Rs(m,t,o,p,x,T,E);return T.name==="globe"&&o||(j[2]=j[6]=j[10]=j[14]=0),j}function Ud(m,t,o,p,x,T,E){if(o){if(T.name==="globe"){const j=Rs(m,t,o,p,x,T,E);return i.bl(j,j),i.aB(j,m,j),j}{const j=i.bz(m),O=i.bA([]);return O[0]=E[0],O[1]=E[1],O[4]=E[2],O[5]=E[3],i.aB(j,j,O),p||i.bB(j,j,-x.angle),j}}return x.glCoordMatrix}function Oo(m,t,o,p){const x=[m,t,o,1];o?i.aC(x,x,p):zi(x,x,p);const T=x[3];return x[0]/=T,x[1]/=T,x[2]/=T,x}function ma(m,t){return Math.min(.5+m/t*.5,1.5)}function fl(m,t){const o=m[0]/m[3],p=m[1]/m[3];return o>=-t[0]&&o<=t[0]&&p>=-t[1]&&p<=t[1]}function Pm(m,t,o,p,x,T,E,j,O,B,H=1){const K=o.transform,Y=p?m.textSizeData:m.iconSizeData,J=i.bK(Y,o.transform.zoom,H),se=K.projection.name==="globe",ae=[256/o.width*2+1,256/o.height*2+1],he=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;he.clear();let de=null;se&&(de=p?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const _e=m.lineVertexArray,we=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,ye=o.transform.width/o.transform.height;let Pe,Ae=!1;for(let Ie=0;Ie<we.length;Ie++){const je=we.get(Ie),{numGlyphs:Ce,writingMode:Ge}=je;if(Ge!==i.bL.vertical||Ae||Pe===i.bL.horizontal||(Ae=!0),Pe=Ge,(je.hidden||Ge===i.bL.vertical)&&!Ae){ml(Ce,he);continue}Ae=!1;const it=new i.P(je.tileAnchorX,je.tileAnchorY),Ke=m.elevationType==="road",ht=!!K.elevation||Ke;let{x:mt,y:kt,z:Ot}=K.projection.projectTilePoint(it.x,it.y,B.canonical),ot=null;if(ht){const yi=Ke?m.getElevationFeatureForText(Ie):null;ot={getElevation:O,elevation:K.elevation,elevationFeature:yi};const[$i,hn,In]=O(it,K.elevation,yi);mt+=$i,kt+=hn,Ot+=In}const Ye=[mt,kt,Ot,1];if(i.aC(Ye,Ye,t),!fl(Ye,ae)){ml(Ce,he);continue}const gt=Ye[3],ft=ma(o.transform.getCameraToCenterDistance(K.projection),gt),Nt=i.bM(Y,J,je),ai=E?Nt/ft:Nt*ft,gi=Oo(mt,kt,Ot,x);if(gi[3]<=0){ml(Ce,he);continue}let Yt={};const zt=i.an(m.layers[0].layout.get("text-max-angle")),ki=Math.cos(zt),wi=E?null:ot,di=Ch(je,ai,!1,j,t,x,T,m.glyphOffsetArray,_e,he,de,gi,it,Yt,ye,wi,K.projection,B,E,ki);Ae=di.useVertical,wi&&di.needsFlipping&&(Yt={}),(di.notEnoughRoom||Ae||di.needsFlipping&&Ch(je,ai,!0,j,t,x,T,m.glyphOffsetArray,_e,he,de,gi,it,Yt,ye,wi,K.projection,B,E,ki).notEnoughRoom)&&ml(Ce,he)}p?(m.text.dynamicLayoutVertexBuffer.updateData(he),de&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(de)):(m.icon.dynamicLayoutVertexBuffer.updateData(he),de&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(de))}function kf(m,t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he){const{lineStartIndex:de,glyphStartIndex:_e,segment:we}=j,ye=_e+j.numGlyphs,Pe=de+j.lineLength,Ae=t.getoffsetX(_e),Ie=t.getoffsetX(ye-1),je=ed(m*Ae,o,p,x,T,E,we,de,Pe,O,B,H,K,Y,!0,J,se,ae,he);if(!je)return null;const Ce=ed(m*Ie,o,p,x,T,E,we,de,Pe,O,B,H,K,Y,!0,J,se,ae,he);return Ce?{first:je,last:Ce}:null}function Gi(m,t,o,p){return m===i.bL.horizontal&&Math.abs(p)>Math.abs(o)?{useVertical:!0}:m===i.bL.vertical?p>0?{needsFlipping:!0}:null:t!==nc.unknown&&(function(x,T){return x===0||Math.abs(T/x)>_c})(o,p)?t===nc.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Ch(m,t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he,de,_e,we){const ye=t/24,Pe=m.lineOffsetX*ye,Ae=m.lineOffsetY*ye,{lineStartIndex:Ie,glyphStartIndex:je,numGlyphs:Ce,segment:Ge,writingMode:it,flipState:Ke}=m,ht=Ie+m.lineLength,mt=kt=>{if(H){const[gt,ft,Nt]=kt.up,ai=B.length;i.bN(H,ai+0,gt,ft,Nt),i.bN(H,ai+1,gt,ft,Nt),i.bN(H,ai+2,gt,ft,Nt),i.bN(H,ai+3,gt,ft,Nt)}const[Ot,ot,Ye]=kt.point;i.bO(B,Ot,ot,Ye,kt.angle)};if(Ce>1){const kt=kf(ye,j,Pe,Ae,o,K,Y,m,O,T,J,ae,!1,he,de,_e,we);if(!kt)return{notEnoughRoom:!0};if(p&&!o){let[Ot,ot,Ye]=kt.first.point,[gt,ft,Nt]=kt.last.point;[Ot,ot]=Oo(Ot,ot,Ye,E),[gt,ft]=Oo(gt,ft,Nt,E);const ai=Gi(it,Ke,(gt-Ot)*se,ft-ot);if(m.flipState=ai&&ai.needsFlipping?nc.flipRequired:nc.flipNotRequired,ai)return ai}mt(kt.first);for(let Ot=je+1;Ot<je+Ce-1;Ot++){const ot=ed(ye*j.getoffsetX(Ot),Pe,Ae,o,K,Y,Ge,Ie,ht,O,T,J,ae,!1,!1,he,de,_e,we);if(!ot)return B.length-=4*(Ot-je),{notEnoughRoom:!0};mt(ot)}mt(kt.last)}else{if(p&&!o){const Ot=Oo(Y.x,Y.y,0,x),ot=Ie+Ge+1,Ye=new i.P(O.getx(ot),O.gety(ot)),gt=Oo(Ye.x,Ye.y,0,x),ft=gt[3]>0?gt:No(Y,Ye,Ot,1,x,void 0,he,de.canonical),Nt=Gi(it,Ke,(ft[0]-Ot[0])*se,ft[1]-Ot[1]);if(m.flipState=Nt&&Nt.needsFlipping?nc.flipRequired:nc.flipNotRequired,Nt)return Nt}const kt=ed(ye*j.getoffsetX(je),Pe,Ae,o,K,Y,Ge,Ie,ht,O,T,J,ae,!1,!1,he,de,_e,we);if(!kt)return{notEnoughRoom:!0};mt(kt)}return{}}function Yc(m,t,o,p,x){const{x:T,y:E,z:j}=p.projectTilePoint(m.x,m.y,t);if(!x)return Oo(T,E,j,o);const[O,B,H]=x.getElevation(m,x.elevation,x.elevationFeature);return Oo(T+O,E+B,j+H,o)}function No(m,t,o,p,x,T,E,j){const O=Yc(m.sub(t)._unit()._add(m),j,x,E,T);return i.av(O,o,O),i.aw(O,O),i.bH(O,o,O,p)}function ed(m,t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he,de,_e){const we=p?m-t:m+t;let ye=we>0?1:-1,Pe=0;p&&(ye*=-1,Pe=Math.PI),ye<0&&(Pe+=Math.PI);let Ae=j+E+(ye>0?0:1)|0,Ie=x,je=x,Ce=0,Ge=0;const it=Math.abs(we),Ke=[],ht=[];let mt=T,kt=mt,Ot=i.bF([]);const ot=()=>No(kt,mt,je,it-Ce+1,H,Y,ae,he.canonical);for(;Ce+Ge<=it;){if(Ae+=ye,Ae<j||Ae>=O)return null;if(je=Ie,kt=mt,Ke.push(je),J&&ht.push(kt),mt=new i.P(B.getx(Ae),B.gety(Ae)),Ie=K[Ae],!Ie){const wi=Yc(mt,he.canonical,H,ae,Y);Ie=wi[3]>0?K[Ae]=wi:ot()}Ce+=Ge;const zt=i.av([],Ie,je),ki=i.bG(je,Ie);if(o&&ki>0&&Ge>0&&i.bJ(Ot,zt)/(Ge*ki)<_e)return null;Ge=ki,Ot=zt}se&&Y&&(K[Ae]&&(Ie=ot(),Ge=i.bG(je,Ie),Ot=i.av([],Ie,je)),K[Ae]=Ie);const Ye=(it-Ce)/Ge,gt=mt.sub(kt)._mult(Ye)._add(kt),ft=i.bH([],je,Ot,Ye);let Nt=[0,0,1],ai=Ot[0],gi=Ot[1];if(de&&(Nt=ae.upVector(he.canonical,gt.x,gt.y),Nt[0]!==0||Nt[1]!==0||Nt[2]!==1)){const zt=[Nt[2],0,-Nt[0]],ki=i.bI([],Nt,zt);i.aw(zt,zt),i.aw(ki,ki),ai=i.bJ(Ot,zt),gi=i.bJ(Ot,ki)}if(o){const zt=i.bI([],Nt,Ot);i.aw(zt,zt),i.bH(ft,ft,zt,o*ye)}const Yt=Pe+Math.atan2(gi,ai);return Ke.push(ft),J&&ht.push(gt),{point:ft,angle:Yt,path:Ke,tilePath:ht,up:Nt}}function ml(m,t){const o=t.length,p=o+4*m;t.resize(p),t.float32.fill(-1/0,4*o,4*p)}function zi(m,t,o){const p=t[0],x=t[1];return m[0]=o[0]*p+o[4]*x+o[12],m[1]=o[1]*p+o[5]*x+o[13],m[3]=o[3]*p+o[7]*x+o[15],m}const $n=100;class _a{constructor(t,o,p=new Tf(t.width+200,t.height+200,25),x=new Tf(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+$n,this.screenBottomBoundary=t.height+$n,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,p,x,T,E,j,O,B,H,K){let Y=p.projectedAnchorX,J=p.projectedAnchorY,se=p.projectedAnchorZ;const ae=p.tileAnchorX,he=p.tileAnchorY,de=p.elevation,_e=p.tileID,we=t.getProjection();if(de&&_e){const[ht,mt,kt]=we.upVector(_e.canonical,p.tileAnchorX,p.tileAnchorY),Ot=we.upVectorScale(_e.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Y+=ht*de*Ot,J+=mt*de*Ot,se+=kt*de*Ot}const ye=t.projection.name==="globe",Pe=t.projection.name==="globe"?i.aj(this.transform.zoom):0;if(_e&&ye&&Pe<1&&!E){const ht=1<<_e.canonical.z,mt=i.bP(ae,he);i.bQ(mt,mt,1/i.al),i.bR(mt,mt,i.bP(_e.canonical.x,_e.canonical.y)),i.bQ(mt,mt,1/ht),i.bS(mt,mt,i.bP(x[0],x[1])),mt[0]=i.bT(mt[0],-.5,.5),i.bQ(mt,mt,i.al);const kt=i.bU(mt[0],mt[1],i.al/(2*Math.PI),1);i.aC(kt,kt,T),Y=i.ak(Y,kt[0],Pe),J=i.ak(J,kt[1],Pe),se=i.ak(se,kt[2],Pe)}const Ae=this.projectAndGetPerspectiveRatio(H,Y,J,se,p.tileID,we.name==="globe"||!!de||this.transform.pitch>0,we),Ie=B*Ae.perspectiveRatio,je=(p.x1*o+j.x-p.padding)*Ie+Ae.point.x,Ce=(p.y1*o+j.y-p.padding)*Ie+Ae.point.y,Ge=(p.x2*o+j.x+p.padding)*Ie+Ae.point.x,it=(p.y2*o+j.y+p.padding)*Ie+Ae.point.y,Ke=Ae.perspectiveRatio<=.55||Ae.occluded;return!this.isInsideGrid(je,Ce,Ge,it)||!O&&this.grid.hitTest(je,Ce,Ge,it,K)||Ke?{box:[],offscreen:!1,occluded:Ae.occluded}:{box:[je,Ce,Ge,it],offscreen:this.isOffscreen(je,Ce,Ge,it),occluded:!1}}placeCollisionCircles(t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he){const de=[],_e=this.transform.elevation,we=t.getProjection(),ye=t.elevationType==="road",Pe=!!_e||ye,Ae=i.bV.getAtTileOffsetFunc(he,this.transform.center.lat,this.transform.worldSize,we),Ie=new i.P(p.tileAnchorX,p.tileAnchorY),je=new i.P(p.tileAnchorX,p.tileAnchorY);let{x:Ce,y:Ge,z:it}=we.projectTilePoint(je.x,je.y,he.canonical),Ke=null;if(Pe){const ki=ye?t.getElevationFeatureForText(x):null;Ke={getElevation:Ae,elevation:_e,elevationFeature:ki};const[wi,di,yi]=Ae(Ie,_e,ki);Ce+=wi,Ge+=di,it+=yi}const ht=we.name==="globe",mt=this.projectAndGetPerspectiveRatio(O,Ce,Ge,it,he,ht||!!_e||this.transform.pitch>0,we),{perspectiveRatio:kt}=mt,Ot=(Y?j/kt:j*kt)/i.bY,ot=Oo(Ce,Ge,it,B),Ye=p.lineOffsetX*Ot,gt=p.lineOffsetY*Ot,ft=i.an(t.layers[0].layout.get("text-max-angle")),Nt=Math.cos(ft),ai=mt.signedDistanceFromCamera>0?kf(Ot,E,Ye,gt,ye&&p.flipState===1,ot,je,p,T,B,{},Pe&&!Y?Ke:null,Y&&Pe,we,he,Y,Nt):null;let gi=!1,Yt=!1,zt=!0;if(ai&&!mt.occluded){const ki=.5*se*kt+ae,wi=new i.P(-100,-100),di=new i.P(this.screenRightBoundary,this.screenBottomBoundary),yi=new Qu,{first:$i,last:hn}=ai,In=$i.path.length;let ea=[];for(let Zi=In-1;Zi>=1;Zi--)ea.push($i.path[Zi]);for(let Zi=1;Zi<hn.path.length;Zi++)ea.push(hn.path[Zi]);const Si=2.5*ki;H&&(ea=ea.map((([Zi,ua,va],xa)=>(Pe&&!ht&&(va=Ae(xa<In-1?$i.tilePath[In-1-xa]:hn.tilePath[xa-In+2],_e,Ke.elevationFeature)[2]),Oo(Zi,ua,va,H)))),ea.some((Zi=>Zi[3]<=0))&&(ea=[]));let ta=[];if(ea.length>0){let Zi=1/0,ua=-1/0,va=1/0,xa=-1/0;for(const Nn of ea)Zi=Math.min(Zi,Nn[0]),va=Math.min(va,Nn[1]),ua=Math.max(ua,Nn[0]),xa=Math.max(xa,Nn[1]);ua>=wi.x&&Zi<=di.x&&xa>=wi.y&&va<=di.y&&(ta=[ea.map((Nn=>new i.P(Nn[0],Nn[1])))],(Zi<wi.x||ua>di.x||va<wi.y||xa>di.y)&&(ta=i.bW(ta,wi.x,wi.y,di.x,di.y)))}for(const Zi of ta){yi.reset(Zi,.25*ki);let ua=0;ua=yi.length<=.5*ki?1:Math.ceil(yi.paddedLength/Si)+1;for(let va=0;va<ua;va++){const xa=va/Math.max(ua-1,1),Nn=yi.lerp(xa),_n=Nn.x+$n,na=Nn.y+$n;de.push(_n,na,ki,0);const Ga=_n-ki,Ya=na-ki,da=_n+ki,Xn=na+ki;if(zt=zt&&this.isOffscreen(Ga,Ya,da,Xn),Yt=Yt||this.isInsideGrid(Ga,Ya,da,Xn),!o&&this.grid.hitTestCircle(_n,na,ki,J)&&(gi=!0,!K))return{circles:[],offscreen:!1,collisionDetected:gi,occluded:!1}}}}return{circles:!K&&gi||!Yt?[]:de,offscreen:zt,collisionDetected:gi,occluded:mt.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let p=1/0,x=1/0,T=-1/0,E=-1/0;for(const H of t){const K=new i.P(H.x+$n,H.y+$n);p=Math.min(p,K.x),x=Math.min(x,K.y),T=Math.max(T,K.x),E=Math.max(E,K.y),o.push(K)}const j=this.grid.query(p,x,T,E).concat(this.ignoredGrid.query(p,x,T,E)),O={},B={};for(const H of j){const K=H.key;if(O[K.bucketInstanceId]===void 0&&(O[K.bucketInstanceId]={}),O[K.bucketInstanceId][K.featureIndex])continue;const Y=[new i.P(H.x1,H.y1),new i.P(H.x2,H.y1),new i.P(H.x2,H.y2),new i.P(H.x1,H.y2)];i.bX(o,Y)&&(O[K.bucketInstanceId][K.featureIndex]=!0,B[K.bucketInstanceId]===void 0&&(B[K.bucketInstanceId]=[]),B[K.bucketInstanceId].push(K.featureIndex))}return B}insertCollisionBox(t,o,p,x,T){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:T},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,p,x,T){const E=o?this.ignoredGrid:this.grid,j={bucketInstanceId:p,featureIndex:x,collisionGroupID:T};for(let O=0;O<t.length;O+=4)E.insertCircle(j,t[O],t[O+1],t[O+2])}projectAndGetPerspectiveRatio(t,o,p,x,T,E,j){const O=[o,p,x,1];let B=!1;x||this.transform.pitch>0?(i.aC(O,O,t),this.fogState&&T&&j.name!=="globe"&&(B=(function(Y,J,se,ae,he,de){const _e=de.calculateFogTileMatrix(he),we=[J,se,ae];return i.af(we,we,_e),ci(Y,i.ag(we),de.pitch,de._fov)})(this.fogState,o,p,x,T.toUnwrapped(),this.transform)>.9)):zi(O,O,t);const H=O[3];return{point:new i.P((O[0]/H+1)/2*this.transform.width+$n,(-O[1]/H+1)/2*this.transform.height+$n),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(j)/H*.5,1.5),signedDistanceFromCamera:H,occluded:E&&O[2]>H||B}}isOffscreen(t,o,p,x){return p<$n||t>=this.screenRightBoundary||x<$n||o>this.screenBottomBoundary}isInsideGrid(t,o,p,x){return p>=0&&t<this.gridRightBoundary&&x>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=i.bA([]);return i.br(t,t,[-100,-100,0]),t}}class Js{constructor(t,o,p,x){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class ac{constructor(t,o,p,x,T,E=!1){this.text=new Js(t?t.text:null,o,p,T),this.icon=new Js(t?t.icon:null,o,x,T),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ra{constructor(t,o,p,x=!1){this.text=t,this.icon=o,this.skipFade=p,this.clipped=x}}class $d{constructor(){this.invProjMatrix=i.bC(),this.viewportMatrix=i.bC(),this.circles=[]}}class Kc{constructor(t,o,p,x,T){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=T}}class Ol{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:p=>p.collisionGroupID===o}}return this.collisionGroups[t]}}function Ls(m,t,o,p,x){const{horizontalAlign:T,verticalAlign:E}=i.c1(m),j=-(T-.5)*t,O=-(E-.5)*o,B=i.c2(m,p);return new i.P(j+B[0]*x,O+B[1]*x)}function lr(m,t,o,p,x){const T=new i.P(m,t);return o&&T._rotate(p?x:-x),T}class so{constructor(t,o,p,x,T,E){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new _a(this.transform,T),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Ol(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,o,p,x,T=1){const E=p.getBucket(o),j=p.latestFeatureIndex;if(!E||!j||o.fqid!==E.layerIds[0])return;const O=E.layers[0].layout,B=E.layers[0].paint,H=p.collisionBoxArray,K=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),Y=p.tileSize/i.al,J=p.tileID.toUnwrapped();this.transform.setProjection(E.projection);const se=(ae=p.tileID,he=E.getProjection(),de=this.transform,he.name===this.projection?de.calculateProjMatrix(ae.toUnwrapped()):Au(de,he,ae));var ae,he,de;const _e=O.get("text-pitch-alignment")==="map",we=O.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const ye=o.dynamicFilter(),Pe=o.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(p),Ie=Ah(se,p.tileID.canonical,_e,we,this.transform,E.getProjection(),Ae);let je=null;const Ce=E.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(_e){const Ye=Ud(se,p.tileID.canonical,_e,we,this.transform,E.getProjection(),Ae);je=i.aB([],this.transform.labelPlaneMatrix,Ye)}let Ge=null;ye&&p.latestFeatureIndex&&(Ge={unwrappedTileID:J,dynamicFilter:ye,dynamicFilterNeedsFeature:Pe}),this.retainedQueryData[E.bucketInstanceId]=new Kc(E.bucketInstanceId,j,E.sourceLayerIndex,E.index,p.tileID);const[it,Ke]=E.layers[0].layout.get("text-size-scale-range"),ht=i.aA(T,it,Ke),[mt,kt]=O.get("icon-size-scale-range"),Ot=i.aA(T,mt,kt),ot={bucket:E,layout:O,paint:B,posMatrix:se,invMatrix:Ce,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ie,labelToScreenMatrix:je,clippingData:Ge,scale:K,textPixelRatio:Y,holdingForFade:p.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:i.bK(E.textSizeData,this.transform.zoom,ht),partiallyEvaluatedIconSize:i.bK(E.iconSizeData,this.transform.zoom,Ot),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const Ye of E.sortKeyRanges){const{sortKey:gt,symbolInstanceStart:ft,symbolInstanceEnd:Nt}=Ye;t.push({sortKey:gt,symbolInstanceStart:ft,symbolInstanceEnd:Nt,parameters:ot})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:ot})}attemptAnchorPlacement(t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he,de,_e,we,ye,Pe){const{textOffset0:Ae,textOffset1:Ie,crossTileID:je}=ae,Ce=[Ae,Ie],Ge=Ls(t,E,j,Ce,O),it=this.collisionIndex.placeCollisionBox(de,O,o,p,x,T,lr(Ge.x,Ge.y,B,H,this.transform.angle),se,K,Y,J.predicate);if(we){const Ke=de.getSymbolInstanceIconSize(Pe,this.transform.zoom,ae.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(de,Ke,we,p,x,T,lr(Ge.x,Ge.y,B,H,this.transform.angle),se,K,Y,J.predicate).box.length===0)return}if(it.box.length>0){let Ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[je]&&this.prevPlacement.placements[je]&&this.prevPlacement.placements[je].text&&(Ke=this.prevPlacement.variableOffsets[je].anchor),this.variableOffsets[je]={textOffset:Ce,width:E,height:j,anchor:t,textScale:O,prevAnchor:Ke},this.markUsedJustification(de,t,ae,_e),de.allowVerticalPlacement&&(this.markUsedOrientation(de,_e,ae),this.placedOrientations[je]=_e),{shift:Ge,placedGlyphBoxes:it}}}placeLayerBucketPart(t,o,p,x,T=1){const{bucket:E,layout:j,paint:O,posMatrix:B,textLabelPlaneMatrix:H,labelToScreenMatrix:K,clippingData:Y,textPixelRatio:J,mercatorCenter:se,invMatrix:ae,holdingForFade:he,collisionBoxArray:de,partiallyEvaluatedTextSize:_e,partiallyEvaluatedIconSize:we,collisionGroup:ye,latestFeatureIndex:Pe}=t.parameters,Ae=j.get("text-optional"),Ie=j.get("icon-optional"),je=j.get("text-allow-overlap"),Ce=j.get("icon-allow-overlap"),Ge=j.get("text-rotation-alignment")==="map",it=j.get("icon-rotation-alignment")==="map",Ke=j.get("text-pitch-alignment")==="map",ht=O.get("symbol-z-offset"),mt=j.get("symbol-elevation-reference")==="sea",kt=j.get("symbol-placement"),[Ot,ot]=j.get("text-size-scale-range"),[Ye,gt]=j.get("icon-size-scale-range"),ft=i.aA(T,Ot,ot),Nt=i.aA(T,Ye,gt),ai=j.get("text-variable-anchor"),gi=Ge&&kt!=="point",Yt=it&&kt!=="point",zt=ai&&E.hasTextData(),ki=E.hasIconTextFit()&&zt&&E.hasIconData();this.transform.setProjection(E.projection);const wi=zt||gi,di=Yt||ki;let yi=je&&(Ce||!E.hasIconData()||Ie),$i=Ce&&(je||!E.hasTextData()||Ae);const hn=!ht.isConstant();!E.collisionArrays&&de&&E.deserializeCollisionBoxes(de),p&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,de,ft,Nt);const In=(Si,ta,Zi)=>{const{crossTileID:ua,numVerticalGlyphVertices:va}=Si;let xa=null;if(Y&&Y.dynamicFilterNeedsFeature||hn){const hr=this.retainedQueryData[E.bucketInstanceId];xa=Pe.loadFeature({featureIndex:Si.featureIndex,bucketIndex:hr.bucketIndex,sourceLayerIndex:hr.sourceLayerIndex,layoutVertexArrayOffset:0});const _r=xa.properties?xa.properties.worldview:null;if(E.localizable&&E.worldview&&typeof _r=="string")if(_r==="all")xa.properties.$localized=!0;else{if(!_r.split(",").includes(E.worldview))return;xa.properties.$localized=!0,xa.properties.worldview=E.worldview}}if(Y&&!(0,Y.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:E.worldview},xa,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new i.P(Si.tileAnchorX,Si.tileAnchorY),this.transform.calculateDistanceTileData(Y.unwrappedTileID)))return this.placements[ua]=new ra(!1,!1,!1,!0),void o.add(ua);const Nn=ht.evaluate(xa,{});if(o.has(ua))return;if(he)return void(this.placements[ua]=new ra(!1,!1,!1));let _n=!1,na=!1,Ga=!0,Ya=!1,da=!1,Xn=null,xn={box:null,offscreen:null,occluded:null},Ua={box:null},kr=null,cr=null,Ra=null,Co=0,Ns=0,Ar=0;Zi.textFeatureIndex?Co=Zi.textFeatureIndex:Si.useRuntimeCollisionCircles&&(Co=Si.featureIndex),Zi.verticalTextFeatureIndex&&(Ns=Zi.verticalTextFeatureIndex);const ks=E.elevationFeatures?E.elevationFeatures[Si.elevationFeatureIndex]:void 0,no=hr=>{hr.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const _r=this.transform.elevation;hr.elevation=mt?Nn:Nn+i.bV.getAtTileOffset(hr.tileID,new i.P(hr.tileAnchorX,hr.tileAnchorY),_r,ks),hr.elevation+=Si.zOffset},Es=Zi.textBox;if(Es){no(Es);const hr=Ca=>{let Pr=i.bL.horizontal;if(E.allowVerticalPlacement&&!Ca&&this.prevPlacement){const Fn=this.prevPlacement.placedOrientations[ua];Fn&&(this.placedOrientations[ua]=Fn,Pr=Fn,this.markUsedOrientation(E,Pr,Si))}return Pr},_r=(Ca,Pr)=>{if(E.allowVerticalPlacement&&va>0&&Zi.verticalTextBox){for(const Fn of E.writingModes)if(Fn===i.bL.vertical?(xn=Pr(),Ua=xn):xn=Ca(),xn&&xn.box&&xn.box.length)break}else xn=Ca()};if(ai){let Ca=ai;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ua]){const nr=this.prevPlacement.variableOffsets[ua];Ca.indexOf(nr.anchor)>0&&(Ca=Ca.filter((cc=>cc!==nr.anchor)),Ca.unshift(nr.anchor))}const Pr=(nr,cc,af)=>{const zc=E.getSymbolInstanceTextSize(_e,Si,this.transform.zoom,ta),um=(nr.x2-nr.x1)*zc+2*nr.padding,rf=(nr.y2-nr.y1)*zc+2*nr.padding,Yl=Si.hasIconTextFit&&!Ce?cc:null;Yl&&no(Yl);let Ml={box:[],offscreen:!1,occluded:!1};const Pd=je?2*Ca.length:Ca.length;for(let Dc=0;Dc<Pd;++Dc){const Oc=this.attemptAnchorPlacement(Ca[Dc%Ca.length],nr,se,ae,wi,um,rf,zc,Ge,Ke,J,B,ye,Dc>=Ca.length,Si,ta,E,af,Yl,_e,we);if(Oc&&(Ml=Oc.placedGlyphBoxes,Ml&&Ml.box&&Ml.box.length)){_n=!0,Xn=Oc.shift;break}}return Ml};_r((()=>Pr(Es,Zi.iconBox,i.bL.horizontal)),(()=>{const nr=Zi.verticalTextBox;return nr&&no(nr),E.allowVerticalPlacement&&!(xn&&xn.box&&xn.box.length)&&va>0&&nr?Pr(nr,Zi.verticalIconBox,i.bL.vertical):{box:null,offscreen:null,occluded:null}})),xn&&(_n=xn.box,Ga=xn.offscreen,Ya=xn.occluded);const Fn=hr(!(!xn||!xn.box));if(!_n&&this.prevPlacement){const nr=this.prevPlacement.variableOffsets[ua];nr&&(this.variableOffsets[ua]=nr,this.markUsedJustification(E,nr.anchor,Si,Fn))}}else{const Ca=(Pr,Fn)=>{const nr=E.getSymbolInstanceTextSize(_e,Si,this.transform.zoom,ta),cc=this.collisionIndex.placeCollisionBox(E,nr,Pr,se,ae,wi,new i.P(0,0),je,J,B,ye.predicate);return cc&&cc.box&&cc.box.length&&(this.markUsedOrientation(E,Fn,Si),this.placedOrientations[ua]=Fn),cc};_r((()=>Ca(Es,i.bL.horizontal)),(()=>{const Pr=Zi.verticalTextBox;return E.allowVerticalPlacement&&va>0&&Pr?(no(Pr),Ca(Pr,i.bL.vertical)):{box:null,offscreen:null,occluded:null}})),hr(!!(xn&&xn.box&&xn.box.length))}}if(kr=xn,_n=kr&&kr.box&&kr.box.length>0,Ga=kr&&kr.offscreen,Ya=kr&&kr.occluded,Si.useRuntimeCollisionCircles){const hr=Si.centerJustifiedTextSymbolIndex>=0?Si.centerJustifiedTextSymbolIndex:Si.verticalPlacedTextSymbolIndex,_r=E.text.placedSymbolArray.get(hr),Ca=i.bM(E.textSizeData,_e,_r),Pr=j.get("text-padding");cr=this.collisionIndex.placeCollisionCircles(E,je,_r,hr,E.lineVertexArray,E.glyphOffsetArray,Ca,B,H,K,p,Ke,ye.predicate,Si.collisionCircleDiameter*Ca/i.bY,Pr,this.retainedQueryData[E.bucketInstanceId].tileID),_n=je||cr.circles.length>0&&!cr.collisionDetected,Ga=Ga&&cr.offscreen,Ya=cr.occluded}if(Zi.iconFeatureIndex&&(Ar=Zi.iconFeatureIndex),Zi.iconBox){const hr=_r=>{no(_r);const Ca=Si.hasIconTextFit&&Xn?lr(Xn.x,Xn.y,Ge,Ke,this.transform.angle):new i.P(0,0),Pr=E.getSymbolInstanceIconSize(we,this.transform.zoom,Si.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Pr,_r,se,ae,di,Ca,Ce,J,B,ye.predicate)};Ua&&Ua.box&&Ua.box.length&&Zi.verticalIconBox?(Ra=hr(Zi.verticalIconBox),na=Ra.box.length>0):(Ra=hr(Zi.iconBox),na=Ra.box.length>0),Ga=Ga&&Ra.offscreen,da=Ra.occluded}const Cl=Ae||Si.numHorizontalGlyphVertices===0&&va===0,Xl=Ie||Si.numIconVertices===0;if(Cl||Xl?Xl?Cl||(na=na&&_n):_n=na&&_n:na=_n=na&&_n,_n&&kr&&kr.box&&this.collisionIndex.insertCollisionBox(kr.box,j.get("text-ignore-placement"),E.bucketInstanceId,Ua&&Ua.box&&Ns?Ns:Co,ye.ID),na&&Ra&&this.collisionIndex.insertCollisionBox(Ra.box,j.get("icon-ignore-placement"),E.bucketInstanceId,Ar,ye.ID),cr&&(_n&&this.collisionIndex.insertCollisionCircles(cr.circles,j.get("text-ignore-placement"),E.bucketInstanceId,Co,ye.ID),p)){const hr=E.bucketInstanceId;let _r=this.collisionCircleArrays[hr];_r===void 0&&(_r=this.collisionCircleArrays[hr]=new $d);for(let Ca=0;Ca<cr.circles.length;Ca+=4)_r.circles.push(cr.circles[Ca+0]),_r.circles.push(cr.circles[Ca+1]),_r.circles.push(cr.circles[Ca+2]),_r.circles.push(cr.collisionDetected?1:0)}const Vo=E.projection.name!=="globe";yi=yi&&(Vo||!Ya),$i=$i&&(Vo||!da),this.placements[ua]=new ra(_n||yi,na||$i,Ga||E.justReloaded),o.add(ua)},ea=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,ea),E.elevationType==="road"&&E.updateRoadElevation(ea.canonical),E.updateZOffset(),E.sortFeaturesByY){const Si=E.getSortedSymbolIndexes(this.transform.angle);for(let ta=Si.length-1;ta>=0;--ta){const Zi=Si[ta];In(E.symbolInstances.get(Zi),Zi,E.collisionArrays[Zi])}E.hasAnyZOffset&&i.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const Si=E.getSortedIndexesByZOffset();for(let ta=0;ta<Si.length;++ta){const Zi=Si[ta];In(E.symbolInstances.get(Zi),Zi,E.collisionArrays[Zi])}}else for(let Si=t.symbolInstanceStart;Si<t.symbolInstanceEnd;Si++)In(E.symbolInstances.get(Si),Si,E.collisionArrays[Si]);if(p&&E.bucketInstanceId in this.collisionCircleArrays){const Si=this.collisionCircleArrays[E.bucketInstanceId];i.bl(Si.invProjMatrix,B),Si.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(t,o,p,x){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:O,crossTileID:B}=p,H=i.c3(o),K=x===i.bL.vertical?O:H==="left"?T:H==="center"?E:H==="right"?j:-1;T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=K>=0&&T!==K?0:B),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=K>=0&&E!==K?0:B),j>=0&&(t.text.placedSymbolArray.get(j).crossTileID=K>=0&&j!==K?0:B),O>=0&&(t.text.placedSymbolArray.get(O).crossTileID=K>=0&&O!==K?0:B)}markUsedOrientation(t,o,p){const x=o===i.bL.horizontal||o===i.bL.horizontalOnly?o:0,T=o===i.bL.vertical?o:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:B}=p,H=t.text.placedSymbolArray;E>=0&&(H.get(E).placedOrientation=x),j>=0&&(H.get(j).placedOrientation=x),O>=0&&(H.get(O).placedOrientation=x),B>=0&&(H.get(B).placedOrientation=T)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let p=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const x=o?o.symbolFadeChange(t):1,T=o?o.opacities:{},E=o?o.variableOffsets:{},j=o?o.placedOrientations:{};for(const O in this.placements){const B=this.placements[O],H=T[O];H?(this.opacities[O]=new ac(H,x,B.text,B.icon,null,B.clipped),p=p||B.text!==H.text.placed||B.icon!==H.icon.placed):(this.opacities[O]=new ac(null,x,B.text,B.icon,B.skipFade,B.clipped),p=p||B.text||B.icon)}for(const O in T){const B=T[O];if(!this.opacities[O]){const H=new ac(B,x,!1,!1);H.isHidden()||(this.opacities[O]=H,p=p||B.text.placed||B.icon.placed)}}for(const O in E)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=E[O]);for(const O in j)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=j[O]);p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,p,x){x&&(this.lastReplacementSourceUpdateTime=x.updateTime);const T=new Set;for(const E of o){const j=E.getBucket(t);j&&E.latestFeatureIndex&&t.fqid===j.layerIds[0]&&(this.updateBucketOpacities(j,T,E,E.collisionBoxArray,p,x,E.tileID,t.scope),j.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(j,E.tileID),j.elevationType==="road"&&j.updateRoadElevation(E.tileID.canonical),j.updateZOffset())}}updateBucketOpacities(t,o,p,x,T,E,j,O){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const B=t.layers[0].layout,H=t.layers[0].paint,K=!!t.layers[0].dynamicFilter(),Y=new ac(null,0,!1,!1,!0),J=B.get("text-allow-overlap"),se=B.get("icon-allow-overlap"),ae=B.get("text-variable-anchor"),he=B.get("text-rotation-alignment")==="map",de=B.get("text-pitch-alignment")==="map",_e=H.get("symbol-z-offset"),we=B.get("symbol-elevation-reference")==="sea",ye=!_e.isConstant(),Pe=new ac(null,0,J&&(se||!t.hasIconData()||B.get("icon-optional")),se&&(J||!t.hasTextData()||B.get("text-optional")),!0);!t.collisionArrays&&x&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(x);const Ae=(je,Ce,Ge)=>{for(let it=0;it<Ce/4;it++)je.opacityVertexArray.emplaceBack(Ge)};let Ie=0;E&&t.updateReplacement(j,E);for(let je=0;je<t.symbolInstances.length;je++){const Ce=t.symbolInstances.get(je),{numHorizontalGlyphVertices:Ge,numVerticalGlyphVertices:it,crossTileID:Ke,numIconVertices:ht,tileAnchorX:mt,tileAnchorY:kt}=Ce;let Ot=null;const ot=this.retainedQueryData[t.bucketInstanceId];ye&&Ce&&ot&&(Ot=p.latestFeatureIndex.loadFeature({featureIndex:Ce.featureIndex,bucketIndex:ot.bucketIndex,sourceLayerIndex:ot.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ye=_e.evaluate(Ot,{}),gt=o.has(Ke);let ft=this.opacities[Ke];gt?ft=Y:ft||(ft=Pe,this.opacities[Ke]=ft),o.add(Ke);const Nt=Ge>0||it>0,ai=ht>0,gi=this.placedOrientations[Ke],Yt=gi===i.bL.vertical,zt=gi===i.bL.horizontal||gi===i.bL.horizontalOnly;!Nt&&!ai||ft.isHidden()||Ie++;let ki=!1;if((Nt||ai)&&E)for(const wi of t.activeReplacements){if(i.bZ(wi,T,i.b_.Symbol,O)||wi.min.x>mt||mt>wi.max.x||wi.min.y>kt||kt>wi.max.y)continue;const di=i.b$(mt,kt,j.canonical,wi.footprintTileId.canonical);if(ki=i.c0(di,wi.footprint),ki)break}if(Nt){const wi=ki?Qs:oo(ft.text);Ae(t.text,Ge,Yt?Qs:wi),Ae(t.text,it,zt?Qs:wi);const di=ft.text.isHidden(),{leftJustifiedTextSymbolIndex:yi,centerJustifiedTextSymbolIndex:$i,rightJustifiedTextSymbolIndex:hn,verticalPlacedTextSymbolIndex:In}=Ce,ea=t.text.placedSymbolArray,Si=di||Yt?1:0;yi>=0&&(ea.get(yi).hidden=Si),$i>=0&&(ea.get($i).hidden=Si),hn>=0&&(ea.get(hn).hidden=Si),In>=0&&(ea.get(In).hidden=di||zt?1:0);const ta=this.variableOffsets[Ke];ta&&this.markUsedJustification(t,ta.anchor,Ce,gi);const Zi=this.placedOrientations[Ke];Zi&&(this.markUsedJustification(t,"left",Ce,Zi),this.markUsedOrientation(t,Zi,Ce))}if(ai){const wi=ki?Qs:oo(ft.icon),{placedIconSymbolIndex:di,verticalPlacedIconSymbolIndex:yi}=Ce,$i=t.icon.placedSymbolArray,hn=ft.icon.isHidden()?1:0;di>=0&&(Ae(t.icon,ht,Yt?Qs:wi),$i.get(di).hidden=hn),yi>=0&&(Ae(t.icon,Ce.numVerticalIconVertices,zt?Qs:wi),$i.get(yi).hidden=hn)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const wi=t.collisionArrays[je];if(wi){let di=new i.P(0,0),yi=!0;if(wi.textBox||wi.verticalTextBox){if(ae){const hn=this.variableOffsets[Ke];hn?(di=Ls(hn.anchor,hn.width,hn.height,hn.textOffset,hn.textScale),he&&di._rotate(de?this.transform.angle:-this.transform.angle)):yi=!1}K&&(yi=!ft.clipped),wi.textBox&&yc(t.textCollisionBox.collisionVertexArray,ft.text.placed,!yi||Yt,Ye,we,di.x,di.y),wi.verticalTextBox&&yc(t.textCollisionBox.collisionVertexArray,ft.text.placed,!yi||zt,Ye,we,di.x,di.y)}const $i=yi&&!!(!zt&&wi.verticalIconBox);wi.iconBox&&yc(t.iconCollisionBox.collisionVertexArray,ft.icon.placed,$i,Ye,we,Ce.hasIconTextFit?di.x:0,Ce.hasIconTextFit?di.y:0),wi.verticalIconBox&&yc(t.iconCollisionBox.collisionVertexArray,ft.icon.placed,!$i,Ye,we,Ce.hasIconTextFit?di.x:0,Ce.hasIconTextFit?di.y:0)}}}if(t.fullyClipped=Ie===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=je.invProjMatrix,t.placementViewportMatrix=je.viewportMatrix,t.collisionCircleArray=je.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const p=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*p>t}isStale(){return this.stale}setStale(){this.stale=!0}}function yc(m,t,o,p,x,T,E){m.emplaceBack(t?1:0,o?1:0,T||0,E||0,p,x?1:0),m.emplaceBack(t?1:0,o?1:0,T||0,E||0,p,x?1:0),m.emplaceBack(t?1:0,o?1:0,T||0,E||0,p,x?1:0),m.emplaceBack(t?1:0,o?1:0,T||0,E||0,p,x?1:0)}const Vd=Math.pow(2,25),td=Math.pow(2,24),Cu=Math.pow(2,17),id=Math.pow(2,16),Hd=Math.pow(2,9),cs=Math.pow(2,8),rc=Math.pow(2,1);function oo(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,o=Math.floor(127*m.opacity);return o*Vd+t*td+o*Cu+t*id+o*Hd+t*cs+o*rc+t}const Qs=0;class pl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,p,x,T,E){const j=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(j,x,t[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort(((O,B)=>O.sortKey-B.sortKey)));this._currentPartIndex<j.length;){const O=j[this._currentPartIndex];if(o.placeLayerBucketPart(O,this._seenCrossTileIDs,p,O.symbolInstanceStart===0,E),this._currentPartIndex++,T())return!0}return!1}}class Gr{constructor(t,o,p,x,T,E,j,O,B){this.placement=new so(t,T,E,j,O,B),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(t,o,p,x,T){const E=i.o.now(),j=()=>{const O=i.o.now()-E;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=o[t[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&O.visibility!=="none"&&(!O.minzoom||O.minzoom<=B)&&(!O.maxzoom||O.maxzoom>B)){const H=O,K=H.layout.get("symbol-z-elevate"),Y=H.layout.get("symbol-sort-key").constantOr(1)!==void 0,J=H.layout.get("symbol-z-order"),se=J==="viewport-y"||J==="auto"&&!(J!=="viewport-y"&&Y),ae=H.layout.get("text-allow-overlap")||H.layout.get("icon-allow-overlap")||H.layout.get("text-ignore-placement")||H.layout.get("icon-ignore-placement"),he=se&&ae,de=this._inProgressLayer=this._inProgressLayer||new pl(H),_e=i.B(O.source,O.scope);if(de.continuePlacement(K||he?x[_e]:p[_e],this.placement,this._showCollisionBoxes,O,j,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const $r=512/i.al/2;class el{constructor(t,o,p){this.tileID=t,this.bucketInstanceId=p,this.index=new i.c4(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=t.canonical.x*i.al,T=t.canonical.y*i.al;for(let E=0;E<o.length;E++){const{key:j,crossTileID:O,tileAnchorX:B,tileAnchorY:H}=o.get(E),K=Math.floor((x+B)*$r),Y=Math.floor((T+H)*$r);this.index.add(K,Y),this.keys.push(j),this.crossTileIDs.push(O)}this.index.finish()}findMatches(t,o,p){const x=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),T=$r/Math.pow(2,o.canonical.z-this.tileID.canonical.z),E=o.canonical.x*i.al,j=o.canonical.y*i.al;for(let O=0;O<t.length;O++){const B=t.get(O);if(B.crossTileID)continue;const{key:H,tileAnchorX:K,tileAnchorY:Y}=B,J=Math.floor((E+K)*T),se=Math.floor((j+Y)*T),ae=this.index.range(J-x,se-x,J+x,se+x).sort(((he,de)=>he-de));for(const he of ae){const de=this.crossTileIDs[he];if(this.keys[he]===H&&!p.has(de)){p.add(de),B.crossTileID=de;break}}}}}class Sr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const p in this.indexes){const x=this.indexes[p],T={};for(const E in x){const j=x[E];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+o),T[j.tileID.key]=j}this.indexes[p]=T}this.lng=t}addBucket(t,o,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let T=0;T<o.symbolInstances.length;T++)o.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const x=this.usedCrossTileIDs[t.overscaledZ];for(const T in this.indexes){const E=this.indexes[T];if(Number(T)>t.overscaledZ)for(const j in E){const O=E[j];O.tileID.isChildOf(t)&&O.findMatches(o.symbolInstances,t,x)}else{const j=E[t.scaledTo(Number(T)).key];j&&j.findMatches(o.symbolInstances,t,x)}}for(let T=0;T<o.symbolInstances.length;T++){const E=o.symbolInstances.get(T);E.crossTileID||(E.crossTileID=p.generate(),x.add(E.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new el(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const p of o.crossTileIDs)this.usedCrossTileIDs[t].delete(p)}removeStaleBuckets(t){let o=!1;for(const p in this.indexes){const x=this.indexes[p];for(const T in x)t[x[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[T]),delete x[T],o=!0)}return o}}class lo{constructor(){this.layerIndexes={},this.crossTileIDs=new Sr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,p,x){let T=this.layerIndexes[t.fqid];T===void 0&&(T=this.layerIndexes[t.fqid]=new nd);let E=!1;const j={};x.name!=="globe"&&T.handleWrapJump(p);for(const O of o){const B=O.getBucket(t);B&&t.fqid===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(O.tileID,B,this.crossTileIDs)&&(E=!0),j[B.bucketInstanceId]=!0)}return T.removeStaleBuckets(j)&&(E=!0),E}pruneUnusedLayers(t){const o={};t.forEach((p=>{o[p]=!0}));for(const p in this.layerIndexes)o[p]||delete this.layerIndexes[p]}}const gl=771;class on{constructor(t,o,p,x){this.blendFunction=t,this.blendColor=o.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=x}}on.Replace=[1,0,1,0],on.disabled=new on(on.Replace,i.ao.transparent,[!1,!1,!1,!1]),on.unblended=new on(on.Replace,i.ao.transparent,[!0,!0,!0,!0]),on.alphaBlended=new on([1,gl,1,gl],i.ao.transparent,[!0,!0,!0,!0]),on.alphaBlendedNonPremultiplied=new on([770,gl,770,gl],i.ao.transparent,[!0,!0,!0,!0]),on.multiply=new on([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),on.additive=new on([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class ji{constructor(t,o,p){this.func=t,this.mask=o,this.range=p}}ji.ReadOnly=!1,ji.ReadWrite=!0,ji.disabled=new ji(519,ji.ReadOnly,[0,1]);const _l=7680;class Ji{constructor(t,o,p,x,T,E){this.test=t,this.ref=o,this.mask=p,this.fail=x,this.depthFail=T,this.pass=E}}Ji.disabled=new Ji({func:519,mask:0},0,0,_l,_l,_l);const Mu=1029,ad=2305;class en{constructor(t,o,p){this.enable=t,this.mode=o,this.frontFace=p}}function Is(m,t){const o=i.ca(m,3);i.cc(m,t),i.cg(m,3,o)}function Ef(m,t){const o=i.c7([]);return i.c8(o,o,-t),i.c9(o,o,-m),o}function vc(m,t){const o=[m[0],m[1],0],p=[t[0],t[1],0];if(i.ag(o)>=1e-15){const E=i.aw([],o);i.c5(p,E,i.bJ(p,E)),t[0]=p[0],t[1]=p[1]}const x=i.bI([],t,m);if(i.c6(x)<1e-15)return null;const T=Math.atan2(-x[1],x[0]);return Ef(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),T)}en.disabled=new en(!1,Mu,ad),en.backCCW=new en(!0,Mu,ad),en.backCW=new en(!0,Mu,2304),en.frontCW=new en(!0,1028,2304),en.frontCCW=new en(!0,1028,ad);class Tr{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){const o=t instanceof i.ae?t:new i.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=i.bT(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o,p){if(this.orientation=null,!this.position)return;const x=this.position,T=p||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(t)):0),E=i.ae.fromLngLat(t,T),j=[E.x-x.x,E.y-x.y,E.z-x.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=vc(j,o)}setPitchBearing(t,o){this.orientation=Ef(i.an(t),i.an(-o))}}class co{constructor(t,o){this._transform=i.bA([]),this.orientation=o,this.position=t}get mercatorPosition(){const t=this.position;return new i.ae(t[0],t[1],t[2])}get position(){const t=i.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&i.cg(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||i.c7([]),t&&Is(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=Ef(t,o),Is(this._transform,this._orientation)}forward(){const t=i.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=i.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=i.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const p=new Float64Array(16);return i.bl(p,this.getWorldToCamera(t,o)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,p){const x=this.position;i.c5(x,x,-t);const T=new Float64Array(16);return i.bq(T,[p,p,p]),i.br(T,T,x),T[10]*=o,T}getWorldToCamera(t,o){const p=new Float64Array(16),x=new Float64Array(4),T=this.position;return i.cb(x,this._orientation),i.c5(T,T,-t),i.cc(p,x),i.br(p,p,T),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=o,p[9]*=o,p[10]*=o,p[11]*=o,p}getCameraToClipPerspective(t,o,p,x){const T=new Float64Array(16);return i.cd(T,t,o,p,x),T}getCameraToClipOrthographic(t,o,p,x,T,E){const j=new Float64Array(16);return i.ce(j,t,o,p,x,T,E),j}getDistanceToElevation(t,o=!1){const p=t===0?0:i.cf(t,o?i.a$(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new co([...this.position],[...this.orientation])}}const zr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class rd{constructor(t=0,o=0,p=0,x=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=p,this.right=x}interpolate(t,o,p){return o.top!=null&&t.top!=null&&(this.top=i.ak(t.top,o.top,p)),o.bottom!=null&&t.bottom!=null&&(this.bottom=i.ak(t.bottom,o.bottom,p)),o.left!=null&&t.left!=null&&(this.left=i.ak(t.left,o.left,p)),o.right!=null&&t.right!=null&&(this.right=i.ak(t.right,o.right,p)),this}getCenter(t,o){const p=i.aA((this.left+t-this.right)/2,0,t),x=i.aA((this.top+o-this.bottom)/2,0,o);return new i.P(p,x)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new rd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Fo=15;class Pu{constructor(t,o,p,x,T,E,j){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(E),this.setMaxBounds(j),this.width=0,this.height=0,this._center=new i.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new rd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new co,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Pu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Fo}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(t||p)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=i.cm(this.projectionOptions);const p=this.getProjection(),x=!i.by(o,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cm({name:"mercator"});const o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=i.cn(),i.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=i.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=i.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,T=0;for(let E=0;E<o.length;E++){const j=new i.P(o[E][0]*this.width,p+o[E][1]*(this.height-p)),O=t.pointCoordinate(j);if(!O)continue;const B=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);x+=O[3]*B,T+=B}return T===0?NaN:x/T}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*o,x=this._mercatorZfromZoom(t),T=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-p,T);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const o=this.elevation,p=t.elevation,x=o!=null!=(p!=null)||o&&p&&o.exaggeration()!==p.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!x}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const x=i.ag(i.av([],this._camera.position,p));return i.aA(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!i.cp(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];i.cq(p,this._camera.position)||(this._setCameraPosition(p),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new Tr;return o.position=new i.ae(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!i.cr(t))return!1;i.cs(t,t);const o=i.ct([],[0,0,-1],t),p=i.ct([],[0,-1,0],t);if(p[2]<0)return!1;const x=vc(o,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;t[2]=i.aA(t[2],x/p,x/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,p){this._unmodified=!1,this._edgeInsets.interpolate(t,o,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new i.cu(0,t)];if(this.renderWorldCopies){const p=this.pointCoordinate(new i.P(0,0)),x=this.pointCoordinate(new i.P(this.width,0)),T=this.pointCoordinate(new i.P(this.width,this.height)),E=this.pointCoordinate(new i.P(0,this.height)),j=Math.floor(Math.min(p.x,x.x,T.x,E.x)),O=Math.floor(Math.max(p.x,x.x,T.x,E.x)),B=1;for(let H=j-B;H<=O+B;H++)H!==0&&o.push(new i.cu(H,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,p,x){let T=[];const E=p!=null,j=!E;if(j&&this.zoom<o||E&&p[0]===0&&p[1]===0)return T;const O=new Set,B=(K,Y,J,se,ae)=>{const he=i.cY(Y,K,J,se,ae);O.has(he)||(T.push(new i.aQ(K,Y,J,se,ae)),O.add(he))};for(let K=0;K<t.length;K++){const Y=t[K];if(j&&Y.canonical.z!==o||E&&x!==void 0&&x>Y.canonical.z)continue;const J=Y.canonical,se=Y.overscaledZ,ae=Y.wrap,he=1<<J.z,de=J.x+1<he,_e=J.x>0,we=J.y+1<he,ye=J.y>0,Pe=Y.wrap-(_e?0:1),Ae=Y.wrap+(de?0:1),Ie=_e?J.x-1:he-1,je=de?J.x+1:0;if(E)p[0]<0?(B(se,Ae,J.z,je,J.y),p[1]<0&&we&&(B(se,ae,J.z,J.x,J.y+1),B(se,Ae,J.z,je,J.y+1)),p[1]>0&&ye&&(B(se,ae,J.z,J.x,J.y-1),B(se,Ae,J.z,je,J.y-1))):p[0]>0?(B(se,Pe,J.z,Ie,J.y),p[1]<0&&we&&(B(se,ae,J.z,J.x,J.y+1),B(se,Pe,J.z,Ie,J.y+1)),p[1]>0&&ye&&(B(se,ae,J.z,J.x,J.y-1),B(se,Pe,J.z,Ie,J.y-1))):p[1]<0&&we?B(se,ae,J.z,J.x,J.y+1):ye&&B(se,ae,J.z,J.x,J.y-1);else{const Ce=Y.visibleQuadrants;1&Ce&&(B(se,Pe,J.z,Ie,J.y),ye&&(B(se,ae,J.z,J.x,J.y-1),B(se,Pe,J.z,Ie,J.y-1))),2&Ce&&(B(se,Ae,J.z,je,J.y),ye&&(B(se,ae,J.z,J.x,J.y-1),B(se,Ae,J.z,je,J.y-1))),4&Ce&&(B(se,Pe,J.z,Ie,J.y),we&&(B(se,ae,J.z,J.x,J.y+1),B(se,Pe,J.z,Ie,J.y+1))),8&Ce&&(B(se,Ae,J.z,je,J.y),we&&(B(se,ae,J.z,J.x,J.y+1),B(se,Ae,J.z,je,J.y+1)))}}const H=[];for(const K of T)T.some((Y=>K.isChildOf(Y)))||H.push(K);if(T=H.filter((K=>!t.some((Y=>!!(K.overscaledZ<o&&Y.isChildOf(K))||K.equals(Y)||K.isChildOf(Y))))),j){const K=1<<o,Y=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=[K*Y.x,K*Y.y],se=4,ae=se*se;T=T.filter((he=>{const de=he.canonical.x+.5-J[0],_e=he.canonical.y+.5-J[1];return de*de+_e*_e<ae}))}return T}extendTileCoverToNearPlane(t,o,p){const x=[],T=new Set;for(const _e of t)T.add(_e.key);const E=(_e,we,ye,Pe,Ae)=>{const Ie=i.cY(we,_e,ye,Pe,Ae);T.has(Ie)||(x.push(new i.aQ(_e,we,ye,Pe,Ae)),T.add(Ie))},j=t.reduce(((_e,we)=>Math.max(_e,we.overscaledZ)),p),O=1<<p,B=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],H=new i.P(0,0),K=new i.P(0,0),Y=(_e,we)=>{const ye=Math.floor(_e[0]),Pe=Math.floor(_e[1]),Ae=(_e[0]-ye)*i.al,Ie=(_e[1]-Pe)*i.al,je=Math.floor(we[0]),Ce=Math.floor(we[1]),Ge=(we[0]-je)*i.al,it=(we[1]-Ce)*i.al;for(let Ke=-1;Ke<=1;Ke++){const ht=ye+Ke;if(!(ht<0||ht>=O)){H.x=Ae-Ke*i.al,K.x=Ge-(ht-je)*i.al;for(let mt=-1;mt<=1;mt++){const kt=Pe+mt;H.y=Ie-mt*i.al,K.y=it-(kt-Ce)*i.al,i.cZ(H,K,B)&&E(j,0,p,ht,kt)}}}},J=o.points,se=J[i.cv],ae=J[i.cw],he=this._projectToGround(se,J[i.cx]),de=this._projectToGround(ae,J[i.cy]);return Y(se,he),Y(ae,de),x}_projectToGround(t,o){return i.cz(i.cA(),t,o,t[2]/(t[2]-o[2]))}coveringTiles(t){let o=this.coveringZoomLevel(t);const p=o,x=this.elevation&&this.elevation.exaggeration(),T=x&&!t.isTerrainDEM,E=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);const j=this.locationCoordinate(this.center),O=this.center.lat,B=1<<o,H=[B*j.x,B*j.y,0],K=this.projection.name==="globe",Y=!K,J=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,Y),se=K?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ae=B*i.cf(1,this.center.lat),he=this._camera.position[2]/i.cf(1,this.center.lat),de=[B*se.x,B*se.y,he*(Y?1:ae)],_e=K||x,we=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ye=this.isLODDisabled(!0)?o:0;let Pe;if(this._elevation&&t.isTerrainDEM)Pe=1e4*this._elevation.exaggeration();else if(this._elevation){const Ye=this._elevation.getMinMaxForVisibleTiles();Pe=Ye?Ye.max:this._centerAltitude}else Pe=this._centerAltitude;const Ae=t.isTerrainDEM?-Pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?i.cC(this):1,je=Ye=>{const ft=new i.ae(Ye.x+25e-6,Ye.y,Ye.z),Nt=new i.ae(Ye.x,Ye.y+25e-6,Ye.z),ai=Ye.toLngLat(),gi=ft.toLngLat(),Yt=Nt.toLngLat(),zt=this.locationCoordinate(ai),ki=this.locationCoordinate(gi),wi=this.locationCoordinate(Yt),di=Math.hypot(ki.x-zt.x,ki.y-zt.y),yi=Math.hypot(wi.x-zt.x,wi.y-zt.y);return Math.sqrt(di*yi)*Ie/25e-6},Ce=Ye=>{const gt=Pe,ft=Ae;return{aabb:i.cF(this,B,0,0,0,Ye,ft,gt,this.projection),zoom:0,x:0,y:0,minZ:ft,maxZ:gt,wrap:Ye,fullyVisible:!1}},Ge=[];let it=[];const Ke=o,ht=t.reparseOverscaled?p:o,mt=(he-this._centerAltitude)*ae,kt=Ye=>{if(!this._elevation||!Ye.tileID||!E)return;const gt=this._elevation.getMinMaxForTile(Ye.tileID),ft=Ye.aabb;gt?(ft.min[2]=gt.min,ft.max[2]=gt.max,ft.center[2]=(ft.min[2]+ft.max[2])/2):(Ye.shouldSplit=ot(Ye),Ye.shouldSplit||(ft.min[2]=ft.max[2]=ft.center[2]=this._centerAltitude))},Ot=(Ye,gt)=>{if(.707*gt<Ye)return 1;const ft=gt/Ye;return ft/(1.4144271570014144+(Math.pow(1.1,ft-1.4144271570014144+1)-1)/(1.1-1)-1)},ot=Ye=>{if(Ye.zoom<ye)return!0;if(Ye.zoom===Ke)return!1;if(Ye.shouldSplit!=null)return Ye.shouldSplit;const gt=Ye.aabb.distanceX(de),ft=Ye.aabb.distanceY(de);let Nt=mt,ai=1;if(K){Nt=Ye.aabb.distanceZ(de);const yi=Math.pow(2,Ye.zoom),$i=i.a$((Ye.y+1)/yi),hn=i.a$(Ye.y/yi),In=Math.min(Math.max(O,$i),hn),ea=i.d1(In)/i.d1(O);if(ai=In===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ea/this._mercatorScaleRatio),this.zoom<=i.c_&&Ye.zoom===Ke-1&&ea>=.9)return!0}else if(T&&(Nt=Ye.aabb.distanceZ(de)*ae),this.projection.isReprojectedInTileSpace&&p<=5){const yi=Math.pow(2,Ye.zoom),$i=je(new i.ae((Ye.x+.5)/yi,(Ye.y+.5)/yi));ai=$i>.85?1:$i}if(!E&&!K){const yi=Math.sqrt(gt*gt+ft*ft+Nt*Nt);let $i=(1<<Ke-Ye.zoom)*we*ai;return $i*=Ot(Math.max(Nt,mt),yi),yi<$i}let gi=Number.MAX_VALUE,Yt=0;const zt=Ye.aabb.getCorners(),ki=[];for(const yi of zt){i.av(ki,yi,de),K||(T?ki[2]*=ae:ki[2]=mt);const $i=i.bJ(ki,this._camera.forward());$i<gi&&(gi=$i,Yt=Math.abs(ki[2]))}let wi=(1<<Ke-Ye.zoom)*we*ai;if(wi*=Ot(Math.max(Yt,mt),gi),gi<wi)return!0;const di=Ye.aabb.closestPoint(H);return di[0]===H[0]&&di[1]===H[1]};if(this.renderWorldCopies)for(let Ye=1;Ye<=3;Ye++)Ge.push(Ce(-Ye)),Ge.push(Ce(Ye));for(Ge.push(Ce(0));Ge.length>0;){const Ye=Ge.pop(),gt=Ye.x,ft=Ye.y;let Nt=Ye.fullyVisible;const ai=()=>this.projection.name==="globe"&&(Ye.y===0||Ye.y===(1<<Ye.zoom)-1);if(!Nt){let gi=_e?Ye.aabb.intersects(J):Ye.aabb.intersectsFlat(J);if(gi===0&&ai()){const Yt=new i.cD(Ye.zoom,gt,ft);gi=i.cE(this,B,Yt,!0).intersects(J)}if(gi===0)continue;Nt=gi===2}if(Ye.zoom!==Ke&&ot(Ye))for(let gi=0;gi<4;gi++){const Yt=(gt<<1)+gi%2,zt=(ft<<1)+(gi>>1),ki={aabb:E?Ye.aabb.quadrant(gi):i.cF(this,B,Ye.zoom+1,Yt,zt,Ye.wrap,Ye.minZ,Ye.maxZ,this.projection),zoom:Ye.zoom+1,x:Yt,y:zt,wrap:Ye.wrap,fullyVisible:Nt,tileID:void 0,shouldSplit:void 0,minZ:Ye.minZ,maxZ:Ye.maxZ};T&&!K&&(ki.tileID=new i.aQ(Ye.zoom+1===Ke?ht:Ye.zoom+1,Ye.wrap,Ye.zoom+1,Yt,zt),kt(ki)),Ge.push(ki)}else{const gi=Ye.zoom===Ke?ht:Ye.zoom;if(t.minzoom&&t.minzoom>gi)continue;let Yt=0;if(!Nt){let di=_e?Ye.aabb.intersectsPrecise(J):Ye.aabb.intersectsPreciseFlat(J);if(di===0&&ai()){const yi=new i.cD(Ye.zoom,gt,ft);di=i.cE(this,B,yi,!0).intersectsPrecise(J)}if(di===0)continue;if(t.calculateQuadrantVisibility)if(J.containsPoint(Ye.aabb.center))Yt=15;else for(let yi=0;yi<4;yi++)Ye.aabb.quadrant(yi).intersects(J)!==0&&(Yt|=1<<yi)}const zt=H[0]-(.5+gt+(Ye.wrap<<Ye.zoom))*(1<<o-Ye.zoom),ki=H[1]-.5-ft,wi=Ye.tileID?Ye.tileID:new i.aQ(gi,Ye.wrap,Ye.zoom,gt,ft);t.calculateQuadrantVisibility&&(wi.visibleQuadrants=Yt),it.push({tileID:wi,distanceSq:zt*zt+ki*ki})}}if(this.fogCullDistSq){const Ye=this.fogCullDistSq,gt=this.horizonLineFromTop();it=it.filter((ft=>{const Nt=[0,0,0,1],ai=[i.al,i.al,0,1],gi=this.calculateFogTileMatrix(ft.tileID.toUnwrapped());i.aC(Nt,Nt,gi),i.aC(ai,ai,gi);const Yt=i.cG([],Nt,ai),zt=i.cH([],Nt,ai),ki=i.c$(Yt,zt);if(ki===0)return!0;let wi=!1;const di=this._elevation;if(di&&ki>Ye&&gt!==0){const yi=this.calculateProjMatrix(ft.tileID.toUnwrapped());let $i;t.isTerrainDEM||($i=di.getMinMaxForTile(ft.tileID)),$i||($i={min:Ae,max:Pe});const hn=i.cI(this.rotation),In=[hn[0]*i.al,hn[1]*i.al,$i.max];i.af(In,In,yi),wi=(1-In[1])*this.height*.5<gt}return ki<Ye||wi}))}return it.sort(((Ye,gt)=>Ye.distanceSq-gt.distanceSq)).map((Ye=>Ye.tileID))}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const o=i.aA(t.lat,-i.cJ,i.cJ),p=this.projection.project(t.lng,o);return new i.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let p,x;const T=this.centerPoint;if(this.projection.name==="globe"){const j=this.worldSize;p=(o.x-T.x)/j,x=(o.y-T.y)/j}else{const j=this.pointCoordinate(o),O=this.pointCoordinate(T);p=j.x-O.x,x=j.y-O.y}const E=this.locationCoordinate(t);this.setLocation(new i.ae(E.x-p,E.y-x))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,o){return this.projection.locationPoint(this,t,o)}locationPoint3D(t,o){return this.projection.locationPoint(this,t,o,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,o){return this.coordinateLocation(this.pointCoordinate3D(t,o))}locationCoordinate(t,o){const p=o?i.cf(o,t.lat):void 0,x=this.projection.project(t.lng,t.lat);return new i.ae(x.x,x.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){const p=o??this._centerAltitude,x=[t.x,t.y,0,1],T=[t.x,t.y,1,1];i.aC(x,x,this.pixelMatrixInverse),i.aC(T,T,this.pixelMatrixInverse);const E=T[3];i.cK(x,x,1/x[3]),i.cK(T,T,1/E);const j=x[2],O=T[2];return{p0:x,p1:T,t:j===O?0:(p-j)/(O-j)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return i.aC(o,o,this.pixelMatrixInverse),i.aC(p,p,this.pixelMatrixInverse),i.cK(o,o,1/o[3]),i.cK(p,p,1/p[3]),o[2]=i.cf(o[2],this._center.lat)*this.worldSize,p[2]=i.cf(p[2],this._center.lat)*this.worldSize,i.cK(o,o,1/this.worldSize),i.cK(p,p,1/this.worldSize),new i.ax([o[0],o[1],o[2]],i.aw([],i.av([],p,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:p,t:x}=t,T=i.cf(o[2],this._center.lat),E=i.cf(p[2],this._center.lat);return new i.ae(i.ak(o[0],p[0],x)/this.worldSize,i.ak(o[1],p[1],x)/this.worldSize,i.ak(T,E,x))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t,o){if(!this.elevation)return this.pointCoordinate(t,o);let p=this.projection.pointCoordinate3D(this,t.x,t.y);if(p)return new i.ae(p[0],p[1],p[2]);let x=0,T=this.horizonLineFromTop();if(t.y>T)return this.pointCoordinate(t,o);const E=.02*T,j=t.clone();for(let O=0;O<10&&T-x>E;O++){j.y=i.ak(x,T,.66);const B=this.projection.pointCoordinate3D(this,j.x,j.y);B?(T=j.y,p=B):x=j.y}return p?new i.ae(p[0],p[1],p[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=i.cL)return!this.isPointAboveHorizon(t);const o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){const p=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,x=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return i.aC(x,x,this.pixelMatrix),x[3]>0?new i.P(x[0]/x[3],x[1]/x[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:o}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,T=this.pointLocation3D(new i.P(o,t)),E=this.pointLocation3D(new i.P(x,t)),j=this.pointLocation3D(new i.P(x,p)),O=this.pointLocation3D(new i.P(o,p));let B=Math.min(T.lng,E.lng,j.lng,O.lng),H=Math.max(T.lng,E.lng,j.lng,O.lng),K=Math.min(T.lat,E.lat,j.lat,O.lat),Y=Math.max(T.lat,E.lat,j.lat,O.lat);const J=Math.pow(2,-this.zoom)/16*270,se=this.projection.name==="globe"?1:4,ae=(he,de,_e,we,ye)=>{const Pe=(he+_e)/2,Ae=(de+we)/2,Ie=new i.P(Pe,Ae),{lng:je,lat:Ce}=this.pointLocation3D(Ie),Ge=Math.max(0,B-je,K-Ce,je-H,Ce-Y);B=Math.min(B,je),H=Math.max(H,je),K=Math.min(K,Ce),Y=Math.max(Y,Ce),(ye<se||Ge>J)&&(ae(he,de,Pe,Ae,ye+1),ae(Pe,Ae,_e,we,ye+1))};if(ae(o,t,x,t,1),ae(x,t,x,p,1),ae(x,p,o,p,1),ae(o,p,o,t,1),this.projection.name==="globe"){const[he,de]=i.cM(this);he?(Y=90,H=180,B=-180):de&&(K=-90,H=180,B=-180)}return new i.aI(new i.aT(B,K),new i.aT(H,Y))}_getBoundsRectangular(t,o){const{top:p,left:x}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,j=new i.P(x,p),O=new i.P(E,p),B=new i.P(E,T),H=new i.P(x,T);let K=this.pointCoordinate(j,t),Y=this.pointCoordinate(O,t);const J=this.pointCoordinate(B,o),se=this.pointCoordinate(H,o),ae=(he,de)=>(de.y-he.y)/(de.x-he.x);return K.y>1&&Y.y>=0?K=new i.ae((1-se.y)/ae(se,K)+se.x,1):K.y<0&&Y.y<=1&&(K=new i.ae(-se.y/ae(se,K)+se.x,0)),Y.y>1&&K.y>=0?Y=new i.ae((1-J.y)/ae(J,Y)+J.x,1):Y.y<0&&K.y<=1&&(Y=new i.ae(-J.y/ae(J,Y)+J.x,0)),new i.aI().extend(this.coordinateLocation(K)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(J))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=t.visibleDemTiles.reduce(((p,x)=>{if(x.dem){const T=x.dem.tree;p.min=Math.min(p.min,T.minimums[0]),p.max=Math.max(p.max,T.maximums[0])}return p}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-i.cJ,this.maxLat=i.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){const o=t.key,p=this._distanceTileDataCache;if(p[o])return p[o];const x=t.canonical,T=1/this.height,E=this.cameraWorldSize,j=E/this.zoomScale(x.z),O=(x.x+Math.pow(2,x.z)*t.wrap)*j,B=x.y*j,H=this.point;H.x*=E/this.worldSize,H.y*=E/this.worldSize;const K=this.angle,Y=Math.sin(-K),J=-Math.cos(-K);return p[o]={bearing:[Y,J],center:[(H.x-O)*T,(H.y-B)*T],scale:j/i.al*T},p[o]}calculateFogTileMatrix(t){const o=t.key,p=this._fogTileMatrixCache;if(p[o])return p[o];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return i.aB(x,this.worldToFogMatrix,x),p[o]=new Float32Array(x),p[o]}calculateProjMatrix(t,o=!1,p=!1){const x=t.key;let T;if(T=p?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,T[x])return T[x];const E=this.calculatePosMatrix(t,this.worldSize);let j;return j=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,i.aB(E,j,E),T[x]=new Float32Array(E),T[x]}calculatePixelsToTileUnitsMatrix(t){const o=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[o])return p[o];const x=i.cN(t,this);return p[o]=x,p[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,o=i.bq([],[t,t,t]);return i.aB(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const o=i.cf(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(o),x=this._camera.forward(),T=i.cf(1,this._center.lat);p[2]/=T,x[2]/=T,i.aw(x,x);const E=t.raycast(p,x,t.exaggeration());if(E){const j=i.bH([],p,x,E),O=new i.ae(j[0],j[1],i.cf(j[2],i.a$(j[1]))),B=(O.z+i.ag([O.x-p[0],O.y-p[1],O.z-p[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const o=this._elevation,p=i.cf(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),T=o.getAtPointOrZero(new i.ae(...x)),E=this.pixelsPerMeter/this.worldSize*T,j=this._minimumHeightOverTerrain(),O=x[2]-E;if(O<=j)if(O<0||t){const B=this.locationCoordinate(this._center,this._centerAltitude),H=[x[0],x[1],B.z-x[2]],K=i.ag(H);H[2]-=(j-O)/this._pixelsPerMercatorPixel;const Y=i.ag(H);if(Y===0)return;i.c5(H,H,K/Y*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],B.z*this._pixelsPerMercatorPixel-H[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const Y=this.center;return Y.lat=i.aA(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(Y.lng=i.aA(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const o=this._unmodified,{x:p,y:x}=this.point;let T=0,E=p,j=x;const O=this.width/2,B=this.height/2,H=this.worldMinY*this.scale,K=this.worldMaxY*this.scale;if(x-B<H&&(j=H+B),x+B>K&&(j=K-B),K-H<this.height&&(T=Math.max(T,this.height/(K-H)),j=(K+H)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,se=this.worldSize/2-(Y+J)/2;E=(p+se+this.worldSize)%this.worldSize-se,E-O<Y&&(E=Y+O),E+O>J&&(E=J-O),J-Y<this.width&&(T=Math.max(T,this.width/(J-Y)),E=(J+Y)/2)}E===p&&j===x||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(E,j))),T&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.cf(1,this.center.lat)/i.cf(1,i.d2));const x=i.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?p:1,E=this._camera.getWorldToCamera(this.worldSize,T);let j;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-t.x/this.width,O[9]=2*t.y/this.height,this.isOrthographic){let Ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ge=Ce*this.aspect,it=-Ge,Ke=-Ce;Ge-=t.x,it-=t.x,Ce+=t.y,Ke+=t.y,j=this._camera.getCameraToClipOrthographic(it,Ge,Ke,Ce,this._nearZ,this._farZ),((ht,mt,kt,Ot)=>{for(let ot=0;ot<16;ot++)ht[ot]=i.ak(mt[ot],kt[ot],Ot)})(j,j,O,i.d0(this.pitch>=Fo?1:this.pitch/Fo))}else j=O;const B=i.cP([],O,E);let H=i.cP([],j,E);if(this.projection.isReprojectedInTileSpace){const Ce=this.locationCoordinate(this.center),Ge=i.bA([]);i.br(Ge,Ge,[Ce.x*this.worldSize,Ce.y*this.worldSize,0]),i.aB(Ge,Ge,i.cQ(this)),i.br(Ge,Ge,[-Ce.x*this.worldSize,-Ce.y*this.worldSize,0]),i.aB(H,H,Ge),i.aB(B,B,Ge),this.inverseAdjustmentMatrix=i.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cS([],H,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=H,this.invProjMatrix=i.bl(new Float64Array(16),this.projMatrix),o){const Ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ce[8]=2*-t.x/this.width,Ce[9]=2*t.y/this.height,this.expandedFarZProjMatrix=i.cP([],Ce,E)}else this.expandedFarZProjMatrix=this.projMatrix;const K=i.bl([],j);this.frustumCorners=i.cT.fromInvProjectionMatrix(K,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const Y=new Float32Array(16);i.bA(Y),i.cS(Y,Y,[1,-1,1]),i.cU(Y,Y,this._pitch),i.bB(Y,Y,this.angle);const J=i.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bz(J);const se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;J[8]=2*-t.x/this.width,J[9]=2*(t.y+se)/this.height,this.skyboxMatrix=i.aB(Y,J,Y);const ae=this.point,he=ae.x,de=ae.y,_e=this.width%2/2,we=this.height%2/2,ye=Math.cos(this.angle),Pe=Math.sin(this.angle),Ae=he-Math.round(he)+ye*_e+Pe*we,Ie=de-Math.round(de)+ye*we+Pe*_e,je=new Float64Array(H);if(i.br(je,je,[Ae>.5?Ae-1:Ae,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=je,H=i.bC(),i.cS(H,H,[this.width/2,-this.height/2,1]),i.br(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=i.bC(),i.cS(H,H,[1,-1,1]),i.br(H,H,[-1,-1,0]),i.cS(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,B),this._calcFogMatrices(),this._distanceTileDataCache={},H=i.bl(new Float64Array(16),this.pixelMatrix),!H)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=H,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cV(this);const Ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(Ce,Ce,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=H;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,T=[t,t,o];i.c5(T,T,x),i.c5(p,p,-1),i.cW(p,p,T);const E=i.bC();i.br(E,E,p),i.cS(E,E,T),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,x)}_computeCameraPosition(t){const o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*T,x.y/this.worldSize-p[1]*T,t/this.worldSize*this._centerAltitude-p[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=t[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(T=Math.min((o-p)/x,1)),this._camera.position=i.bH([],this._camera.position,t,T),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),T=i.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),j=Math.max((t[2]-T)/Math.cos(p),E),O=this._zoomFromMercatorZ(j);i.bH(t,t,o,j),this._pitch=i.aA(p,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bT(x,-Math.PI,Math.PI),this._setZoom(i.aA(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,p=i.cL,x=0,T=1/0;for(;p-o>1e-6&&p>o;){const E=o+.5*(p-o),j=this.tileSize*Math.pow(2,E),O=this.getCameraToCenterDistance(this.projection,E,j),B=this.scaleZoom(O/(Math.max(0,t)*this.tileSize)),H=Math.abs(E-B);H<T&&(T=H,x=E),E<B?o=E:p=E}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){const p=Math.min(t.x,o.x),x=Math.max(t.x,o.x),T=Math.min(t.y,o.y),E=Math.max(t.y,o.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const j=[new i.P(p,T),new i.P(x,E),new i.P(p,E),new i.P(x,T)],O=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const H of j){const K=this.pointRayIntersection(H);if(K.t<0)return!0;const Y=this.rayIntersectionCoordinate(K);if(Y.x<O||Y.y<0||Y.x>B||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(t,o){const p=i.ag(i.av([],this._camera.position,t)),x=this._zoomFromMercatorZ(p)+o;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([o,p,x],T){const E=[o,p,x,1];i.aC(E,E,T);const j=E[3]=Math.max(E[3],1e-6);return E[0]/=j,E[1]/=j,E[2]/=j,E})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,p=this.worldSize){const x=i.cO(t,o,this.width,this.height,1024),T=t.pixelSpaceConversion(this.center.lat,p,x);let E=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(E=i.ak(1,E,i.d0(this.pitch>=Fo?1:this.pitch/Fo))),E}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(t,t,this.globeMatrix),t}getFrustum(t){return i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const yl=(m,t)=>{if(t>0&&m.terrain&&i.w("Cutoff is currently disabled on terrain"),t<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=m.transform,p=Math.max(Math.abs(o._zoom-(m.minCutoffZoom-1)),1),x=o.isLODDisabled(!1)?i.ah(60,45,o.pitch):i.ah(30,15,o.pitch),T=o._farZ-o._nearZ,E=t*o.height,j=((1-(O=x))*o.cameraToCenterDistance+O*(o._farZ+E))*p;var O;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(j-o._nearZ)/T,(j-E-o._nearZ)/T]}}},So=2048;class To{constructor(t,o){this.aabb=t,this.lastCascade=o}}class sd{add(t,o){const p=this.receivers[t.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],o.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],o.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],o.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],o.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],o.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],o.max[2])):this.receivers[t.key]=new To(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,p){const x=i.d9.fromPoints(t.points);let T=0;for(const E in this.receivers){const j=this.receivers[E];if(!j||!x.intersectsAabb(j.aabb))continue;j.aabb.min=x.closestPoint(j.aabb.min),j.aabb.max=x.closestPoint(j.aabb.max);const O=j.aabb.getCorners();for(let B=0;B<p.length;B++){let H=!0;for(const K of O){const Y=[K[0]*o,K[1]*o,K[2]];if(i.af(Y,Y,p[B].matrix),Y[0]<-1||Y[0]>1||Y[1]<-1||Y[1]>1){H=!1;break}}if(j.lastCascade=B,T=Math.max(T,B),H)break}}return T+1}}class vl{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new sd,this._depthMode=new ji(t.context.gl.LEQUAL,ji.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const x=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||x<=0||(this._shadowLayerCount=p.style.order.reduce(((se,ae)=>{const he=p.style._mergedLayers[ae];return se+(he.hasShadowPass()&&!he.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=p.context,E=So,j=So;if(this._cascades.length===0||So!==this._cascades[0].texture.size[0]){this._cascades=[];for(let se=0;se<2;++se){const ae=p._shadowMapDebug,he=T.gl,de=T.createFramebuffer(E,j,ae?1:0,"texture"),_e=new i.T(T,{width:E,height:j,data:null},he.DEPTH_COMPONENT16);if(de.depthAttachment.set(_e.texture),ae){const we=new i.T(T,{width:E,height:j,data:null},he.RGBA8);de.colorAttachment0.set(we.texture)}this._cascades.push({framebuffer:de,texture:_e,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cB,scale:0})}}this.shadowDirection=od(o);let O=0;if(t.elevation){const se=t.elevation,ae=[1e4,-1e4];se.visibleDemTiles.filter((he=>he.dem)).forEach((he=>{const de=he.dem.tree;ae[0]=Math.min(ae[0],de.minimums[0]),ae[1]=Math.max(ae[1],de.maximums[0])})),ae[0]!==1e4&&(O=(ae[1]-ae[0])*se.exaggeration())}const B=1.5*t.cameraToCenterDistance,H=3*B,K=new Float64Array(16);for(let se=0;se<this._cascades.length;++se){const ae=this._cascades[se];let he=t.height/50,de=1;se===0?de=B:(he=B,de=H);const[_e,we]=tl(t,this.shadowDirection,he,de,So,O);ae.scale=t.scale,ae.matrix=_e,ae.boundingSphereRadius=we,i.bl(K,ae.matrix),ae.frustum=i.cB.fromInvProjectionMatrix(K,1,0,!0),ae.far=de}const Y=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Y].far,this._cascades[Y].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=So,this._uniformValues.u_shadowmap_0=zr.ShadowMap0,this._uniformValues.u_shadowmap_1=zr.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const J=p.transform.elevation;for(const se of this._groundShadowTiles){let ae={min:0,max:0};if(J){const he=J.getMinMaxForTile(se);he&&(ae=he)}this.addShadowReceiver(se.toUnwrapped(),ae.min,ae.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,So,So]);for(let T=0;T<this._numCascadesToRender;++T){p.currentShadowCascade=T,x.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),x.clear({color:i.ao.white,depth:1});for(const E of t.order){const j=t._mergedLayers[E];if(!j.hasShadowPass()||j.isHidden(p.transform.zoom))continue;const O=t.getLayerSourceCache(j),B=O?o[O.id]:void 0;(j.type==="model"||B&&B.length)&&p.renderLayer(p,O,j,B)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,o=t.style,p=t.context,x=p.gl,T=o.directionalLight,E=o.ambientLight;if(!T||!E)return;const j=[],O=yl(t,t.longestCutoffRange);O.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),j.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&j.push("NORMAL_OFFSET");const B=zs(o,T,E),H=new ji(x.LEQUAL,ji.ReadOnly,t.depthRangeFor3D),K=new Ji({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const Y of this._groundShadowTiles){const J=Y.toUnwrapped(),se=t.isTileAffectedByFog(Y),ae=t.getOrCreateProgram("groundShadow",{defines:j,overrideFog:se});this.setupShadows(J,ae),t.uploadCommonUniforms(p,ae,J,null,O);const he={u_matrix:t.transform.calculateProjMatrix(J),u_ground_shadow_factor:B};ae.draw(t,x.TRIANGLES,H,K,on.multiply,en.disabled,he,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?on.unblended:on.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const o=this.painter.transform,p=o.calculatePosMatrix(t,o.worldSize);return i.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(t){const o=i.bz(t);return i.aB(o,this._cascades[this.painter.currentShadowCascade].matrix,t),o}setupShadows(t,o,p){if(!this.enabled)return;const x=this.painter.transform,T=this.painter.context,E=T.gl,j=this._uniformValues,O=new Float64Array(16),B=x.calculatePosMatrix(t,x.worldSize);for(let H=0;H<this._cascades.length;H++)i.aB(O,this._cascades[H].matrix,B),j[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),T.activeTexture.set(E.TEXTURE0+zr.ShadowMap0+H),this._cascades[H].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const H=i.d7(t.canonical),K=2/x.tileSize*i.al/So,Y=K*this._cascades[0].boundingSphereRadius,J=K*this._cascades[this._cascades.length-1].boundingSphereRadius,se=(p==="vector-tile"?1:3)*(function(ae,he,de,_e,we){const ye=i.aA((ae-22)/-22,0,1);return .125*(1-ye)+4*ye})(x.zoom);j.u_shadow_normal_offset=[H,Y*se,J*se],j.u_shadow_bias=[1e-4,.0012,.012]}else j.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(T,j)}setupShadowsFromMatrix(t,o,p=!1){if(!this.enabled)return;const x=this.painter.context,T=x.gl,E=this._uniformValues,j=new Float64Array(16);for(let O=0;O<2;O++)i.aB(j,this._cascades[O].matrix,t),E[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(j),x.activeTexture.set(T.TEXTURE0+zr.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);this.useNormalOffset=p,p?(E.u_shadow_normal_offset=[1,3,3],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],o.setShadowUniformValues(x,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,p,x){if(x[2]>=0)return{};const T=(function(O,B,H){const K=H/(1<<O.canonical.z);return new i.d9([O.canonical.x*K+O.wrap*H,O.canonical.y*K+O.wrap*H,0],[(O.canonical.x+1)*K+O.wrap*H,(O.canonical.y+1)*K+O.wrap*H,B])})(t,o,p).getCorners(),E=o/-x[2];x[0]<0?(i.d8(T[0],T[0],[x[0]*E,0,0]),i.d8(T[3],T[3],[x[0]*E,0,0])):x[0]>0&&(i.d8(T[1],T[1],[x[0]*E,0,0]),i.d8(T[2],T[2],[x[0]*E,0,0])),x[1]<0?(i.d8(T[0],T[0],[0,x[1]*E,0]),i.d8(T[1],T[1],[0,x[1]*E,0])):x[1]>0&&(i.d8(T[2],T[2],[0,x[1]*E,0]),i.d8(T[3],T[3],[0,x[1]*E,0]));const j={};return j.vertices=T,j.planes=[Jc(T[1],T[0],T[4]),Jc(T[2],T[1],T[5]),Jc(T[3],T[2],T[6]),Jc(T[0],T[3],T[7])],j}addShadowReceiver(t,o,p){this._receivers.add(t,i.d9.fromTileIdAndHeight(t,o,p))}getMaxCascadeForTile(t){const o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function Jc(m,t,o){const p=i.av([],o,t),x=i.av([],m,t),T=i.bI([],p,x),E=i.ag(T);return E===0?[0,0,1,0]:(i.c5(T,T,1/E),[T[0],T[1],T[2],-i.bJ(T,t)])}function od(m){const t=m.properties.get("direction"),o=i.d4(t.x,t.y,t.z);o[2]=i.aA(o[2],0,75);const p=i.d6([o[0],o[1],o[2]]);return i.d5(p.x,p.y,p.z)}function zs(m,t,o){const p=t.properties.get("color-use-theme")==="none",x=t.properties.get("color"),T=t.properties.get("intensity"),E=t.properties.get("direction"),j=[E.x,E.y,E.z],O=o.properties.get("color-use-theme")==="none",B=o.properties.get("color"),H=o.properties.get("intensity"),K=Math.max(i.bJ([0,0,1],j),0),Y=[0,0,0];i.c5(Y,B.toPremultipliedRenderColor(O?null:m.getLut(t.scope)).toArray01Linear().slice(0,3),H);const J=[0,0,0];return i.c5(J,x.toPremultipliedRenderColor(p?null:m.getLut(o.scope)).toArray01Linear().slice(0,3),K*T),i.db([Y[0]>0?Y[0]/(Y[0]+J[0]):0,Y[1]>0?Y[1]/(Y[1]+J[1]):0,Y[2]>0?Y[2]/(Y[2]+J[2]):0])}function tl(m,t,o,p,x,T){const E=m.zoom,j=m.scale,O=m.worldSize,B=1/O,H=m.aspect,K=Math.sqrt(1+H*H)*Math.tan(.5*m.fovX),Y=K*K,J=p-o,se=p+o;let ae,he;Y>J/se?(ae=p,he=p*K):(ae=.5*se*(1+Y),he=.5*Math.sqrt(J*J+2*(p*p+o*o)*Y+se*se*Y*Y));const de=m.projection.pixelsPerMeter(m.center.lat,O),_e=m._camera.getCameraToWorldMercator(),we=[0,0,-ae*B];i.af(we,we,_e);let ye=he*B;const Pe=m._edgeInsets;if(!(Pe.left===0&&Pe.top===0&&Pe.right===0&&Pe.bottom===0||Pe.left===Pe.right&&Pe.top===Pe.bottom)){const Nt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?de:1),ai=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,o,p);ai[8]=2*-m.centerOffset.x/m.width,ai[9]=2*m.centerOffset.y/m.height;const gi=new Float64Array(16);i.cP(gi,ai,Nt);const Yt=new Float64Array(16);i.bl(Yt,gi);const zt=i.cB.fromInvProjectionMatrix(Yt,O,E,!0);for(const ki of zt.points){const wi=((Ae=ki)[0]/=j,Ae[1]/=j,Ae[2]=i.cf(Ae[2],m._center.lat),Ae);ye=Math.max(ye,i.c6(i.da([],we,wi)))}}var Ae;ye*=x/(x-1);const Ie=Math.acos(t[2]),je=Math.atan2(-t[0],-t[1]),Ce=new co;Ce.position=we,Ce.setPitchBearing(Ie,je);const Ge=Ce.getWorldToCamera(O,de),it=ye*O,Ke=Math.min(m._mercatorZfromZoom(17)*O*-2,-2*it),ht=Ce.getCameraToClipOrthographic(-it,it,-it,it,Ke,(it+T*de)/t[2]),mt=new Float64Array(16);i.aB(mt,ht,Ge);const kt=i.d5(Math.floor(1e6*we[0])/1e6*O,Math.floor(1e6*we[1])/1e6*O,0),Ot=.5*x,ot=[0,0,0];i.af(ot,kt,mt),i.c5(ot,ot,Ot);const Ye=[Math.floor(ot[0]),Math.floor(ot[1]),Math.floor(ot[2])],gt=[0,0,0];i.av(gt,ot,Ye),i.c5(gt,gt,-1/Ot);const ft=new Float64Array(16);return i.bA(ft),i.br(ft,ft,gt),i.aB(mt,ft,mt),[mt,it]}class Mh extends i.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,o){return i.dc(this.requestManager.transformRequest(o,i.R.Model).url).then((p=>{if(!p)return;const x=i.dd(p),T=new i.de(t,o,void 0,void 0,x);return T.computeBoundsAndApplyParent(),T})).catch((p=>{if(p&&p.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${t} from ${o}: ${p.message}`)))}))}load(t,o,p={forceReload:!1}){this.models[o]||(this.models[o]={});const x=Object.keys(t),T=[],E=[];for(const j of x){const O=t[j];this.hasURLBeenRequested(O)&&!p.forceReload||(this.modelByURL[O]={modelId:j,scope:o},T.push(this.loadModel(j,O)),E.push(j)),this.models[o][j]||(this.models[o][j]={model:null,numReferences:1})}this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+E.length,Promise.allSettled(T).then((j=>{for(let O=0;O<j.length;O++){const{status:B}=j[O];if(B==="rejected")continue;const{value:H}=j[O];this.models[o][E[O]]||(this.models[o][E[O]]={model:null,numReferences:1}),this.models[o][E[O]].model=H}this.numModelsLoading[o]-=E.length,this.fire(new i.z("data",{dataType:"style"}))})).catch((j=>{this.fire(new i.y(new Error(`Could not load models: ${j.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(t,o):this.getModelByURL(this.modelUris[o][t]))}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}getModelByURL(t){if(!t)return null;const o=this.modelByURL[t];return o?this.models[o.scope][o.modelId].model:null}hasModelBeenAdded(t,o){return this.models[o]&&this.models[o][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,o,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const x=this.requestManager.normalizeModelURL(o);if((this.hasModel(t,p,{exactIdMatch:!0})||this.hasModelBeenAdded(t,p))&&this.modelUris[p][t]===x)this.models[p][t].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:T,modelId:E}=this.modelByURL[x];this.models[T][E].numReferences++}else this.modelUris[p][t]=x,this.load({[t]:this.modelUris[p][t]},p)}addModelURLs(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const p=this.modelUris[o];for(const x in t)p[x]=this.requestManager.normalizeModelURL(t[x])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const p={};for(const x of t)this.hasModel(x,o,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[o][x].numReferences++:this.modelUris[o][x]&&!this.hasURLBeenRequested(x)?p[x]=this.modelUris[o][x]:!this.hasURLBeenRequested(x)&&i.df(x,!1)&&(this.modelUris[o][x]=this.requestManager.normalizeModelURL(x),p[x]=this.modelUris[o][x]);this.load(p,o)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,o,p=!1,x=!1){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0||x)){const T=this.modelUris[o][t];p||delete this.modelUris[o][t],delete this.modelByURL[T];const E=this.models[o][t].model;if(!E)return;delete this.models[o][t],E.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const o of Object.keys(this.models[t])){const p=this.models[t][o].model;delete this.models[t][o],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(const p in this.models[o])this.models[o][p].model&&this.models[o][p].model.upload(t.context)}}const Ph=i.a6.colorTheme,Qc=new i.a9({data:new i.aa(Ph.data)});function Af(m){if(!m.metadata||!m.metadata.content_area)return;const t=i.o.devicePixelRatio,{left:o,top:p,width:x,height:T}=m.metadata.content_area,E=o*t,j=p*t;return[E,j,E+x*t,j+T*t]}function xl(m){if(m)return m.map((([t,o])=>[t*i.o.devicePixelRatio,o*i.o.devicePixelRatio]))}class ju{constructor(t,o,p){this.id=t,this.scope=o,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const o=this.sourceCache.getVisibleCoordinates();if(o.length===0)return t;const p=this.sourceCache.getSource();if(!(p instanceof Qr))return t;const x=o.map((E=>this.sourceCache.getTile(E))),T=p.getImages(x,Array.from(this.pendingRequests));for(const[E,j]of T)t.set(i.I.from({name:E,iconsetId:this.id}),j),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),t}}const eu=(m,t)=>ke(m,t&&t.filter((o=>o.identifier!=="source.canvas"))),Gd=i.aH(qn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),jm=i.aH(qn,["setCenter","setZoom","setBearing","setPitch"]),ld=new Set(["background","sky","slot","custom"]),xc={version:8,layers:[],sources:{}},Nl={duration:300,delay:0};class es extends i.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=Object.assign({},Nl),this._buildingIndex=new Ku(this),this.crossTileSymbolIndex=new lo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=o.styleChanges||new Da,this._hasDataDrivenEmissive=!1,this.dispatcher=o.dispatcher?o.dispatcher:new i.D(i.dh(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new Xo(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new i.di(t._requestManager,o.localFontFamily?i.dj.all:o.localIdeographFontFamily?i.dj.ideographs:i.dj.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new Mh(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._indoorDependentLayers=o.indoorDependentLayers?o.indoorDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",i.dk());const p=this;this._rtlTextPluginCallback=es.registerForPluginStateChange((x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},((T,E)=>{if(i.dl(T),E&&E.every((j=>j)))for(const j in p._sourceCaches){const O=p._sourceCaches[j],B=O.getSource().type;B!=="vector"&&B!=="geojson"||O.reload()}}))})),this.on("data",(x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const T=this.getOwnSource(x.sourceId);if(T&&T.vectorLayerIds)for(const E in this._layers){const j=this._layers[E];j.source===T.id&&this._validateLayer(j)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(i.h(t))return t;const o=i.dm(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${i.dn(JSON.stringify(t))}`}_diffStyle(t,o,p){this.globalId=this._getGlobalId(t);const x=(T,E)=>{try{E(null,this.setState(T,p))}catch(j){E(j,!1)}};if(typeof t=="string"){const T=this.map._requestManager.normalizeStyleURL(t),E=this.map._requestManager.transformRequest(T,i.R.Style);i.m(E,((j,O)=>{j?this.fire(new i.y(j)):O&&x(O,o)}))}else typeof t=="object"&&x(t,o)}loadURL(t,o={}){this.fire(new i.z("dataloading",{dataType:"style"}));const p=typeof o.validate=="boolean"?o.validate:!i.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);const x=this.importsCache.get(t);if(x)return this._load(x,p);const T=this.map._requestManager.transformRequest(t,i.R.Style);this._request=i.m(T,((E,j)=>{if(this._request=null,E)this.fire(new i.y(E));else if(j)return this.importsCache.set(t,j),this._load(j,p)}))}loadJSON(t,o={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=i.o.frame((()=>{this._request=null,this._load(t,o.validate!==!1)}))}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(xc,!1)}_loadImports(t,o,p){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const T of t){const E=this._createFragmentStyle(T),j=new Promise((H=>{E.once("style.import.load",H),E.once("error",H)})).then((()=>this.mergeAll()));if(x.push(j),this.resolvedImports.has(T.url)){E.loadEmpty();continue}const O=T.data||this.importsCache.get(T.url);O?(E.loadJSON(O,{validate:o}),this._isInternalStyle(O)&&(E.globalId=null)):T.url?E.loadURL(T.url,{validate:o}):E.loadEmpty();const B={style:E,id:T.id,config:T.config};if(p){const H=this.fragments.findIndex((({id:K})=>K===p));this.fragments=this.fragments.slice(0,H).concat(B).concat(this.fragments.slice(H))}else this.fragments.push(B)}return Promise.allSettled(x)}getImportGlobalIds(t=this,o=new Set){for(const p of t.fragments)p.style.globalId&&o.add(p.style.globalId),this.getImportGlobalIds(p.style,o);return[...o.values()]}_createFragmentStyle(t){const o=this.scope?i.B(t.id,this.scope):t.id;let p;const x=this._initialConfig&&this._initialConfig[o];(t.config||x)&&(p=Object.assign({},t.config,x));const T=new es(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){if(this._isInternalStyle(t)){const T=Object.assign({},xc,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(T,o)}if(this.updateConfig(this._config,t.schema),o&&eu(this,_o(t)))return;this._loaded=!0,this.stylesheet=i.dp(t);const p=()=>{for(const O in t.sources)this.addSource(O,t.sources[O],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const O in t.iconsets)this.addIconset(O,t.iconsets[O]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const T=Do(this.stylesheet.layers);if(this._order=T.map((O=>O.id)),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const O=this.stylesheet.lights[0];this.light=new Ze(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ze(this.stylesheet.light)),this._layers={};for(const O of T){const B=i.du(O,this.scope,this._styleColorTheme.lut,this.options);B.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(B.fqid),this._hasAppearances=this._hasAppearances||B.getAppearances().length!==0,B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B;const H=this.getOwnLayerSourceCache(B),K=!!this.directionalLight&&this.directionalLight.shadowsEnabled();H&&B.canCastShadows()&&K&&(H.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const j=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then((()=>{this._reloadImports(),this.fire(new i.z(j?"style.load":"style.import.load"))})).catch((O=>{this.fire(new i.y(new Error("Failed to load imports",O))),this.fire(new i.z(j?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new i.z(j?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const T=this._evaluateColorThemeData(x);this._loadColorTheme(T).then((()=>{p()})).catch((E=>{i.w(`Couldn't load color theme from the stylesheet: ${E}`),p()}))}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some((t=>t.style.hasAppearances()))}mergeAll(){let t,o,p,x,T,E,j,O,B,H;const K={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((Y=>{if(Y.stylesheet){if(Y.light!=null&&(t=Y.light),Y.stylesheet.lights)for(const J of Y.stylesheet.lights)J.type==="ambient"&&Y.ambientLight!=null&&(o=Y.ambientLight),J.type==="directional"&&Y.directionalLight!=null&&(p=Y.directionalLight);x=this._prioritizeTerrain(x,Y.terrain,Y.stylesheet.terrain),Y.stylesheet.fog&&Y.fog!=null&&(T=Y.fog),Y.stylesheet.snow&&Y.snow!=null&&(E=Y.snow),Y.stylesheet.rain&&Y.rain!=null&&(j=Y.rain),Y.stylesheet.camera!=null&&(H=Y.stylesheet.camera),Y.stylesheet.projection!=null&&(O=Y.stylesheet.projection),Y.stylesheet.transition!=null&&(B=Y.stylesheet.transition),K[Y.scope]=Y._styleColorTheme}})),this.light=t,this.ambientLight=o,this.directionalLight=p,this.fog=T,this.snow=E,this.rain=j,this._styleColorThemeForScope=K,x===null?delete this.terrain:this.terrain=x,this.camera=H||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=Object.assign({},Nl,B),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const o=p=>{for(const x of p.fragments)o(x.style);t(p)};o(this)}_prioritizeTerrain(t,o,p){const x=t&&t.drapeRenderMode===0;return p===null?o&&o.drapeRenderMode===0?o:x?t:null:o!=null&&(!t||x||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},o={},p={};this.forEachFragmentStyle((x=>{for(const T in x._sourceCaches){const E=i.B(T,x.scope);t[E]=x._sourceCaches[T]}for(const T in x._otherSourceCaches){const E=i.B(T,x.scope);o[E]=x._otherSourceCaches[T]}for(const T in x._symbolSourceCaches){const E=i.B(T,x.scope);p[E]=x._symbolSourceCaches[T]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle((t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const o of Object.values(t.stylesheet.indoor)){const p=o,x=i.B(p.sourceId,t.scope);this._mergedIndoor[x]=new Set(p.sourceLayers||[])}}))}mergeLayers(){const t={},o=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((E=>{for(const j of E._order){const O=E._layers[j];if(O.type==="slot"){const B=i.dq(j);if(t[B])continue;t[B]=[]}O.slot&&t[O.slot]?t[O.slot].push(O):o.push(O)}})),this._mergedOrder=[];let x=-1;const T=(E=[])=>{for(const j of E)if(j.type==="slot"){const O=i.dq(j.id);t[O]&&T(t[O]),this._mergedSlots.push(O)}else{const O=i.B(j.id,j.scope);this._mergedOrder.push(O),p[O]=j,j.is3D(!!this.terrain)&&(this._has3DLayers=!0,x=this._mergedOrder.length-1),j.type==="circle"&&(this._hasCircleLayers=!0),j.type==="symbol"&&(this._hasSymbolLayers=!0),j.type==="clip"&&(this._clipLayerPresent=!0)}};if(T(o),this._has3DLayers){const E={};for(let j=0;j<this._mergedOrder.length;++j){const O=this._mergedOrder[j];E[O]=j===x?1:j<x?p[O].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((j,O)=>E[j]-E[O]))}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(o,p,x,T){const E=Object.assign({},p);for(const O of Object.keys(Ph))E[O]===void 0&&(E[O]=Ph[O].default);const j=new i.a8(Qc,o,new Map(x));return j.setTransitionOrValue(E,x),j.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((p,x)=>{const T="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let E=t;E.startsWith(T)||(E=T+E);const j=i.I.from("mapbox-reserved-lut"),O=new Image;O.src=E,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void p();this._styleColorTheme.lutLoading=!1;const{width:B,height:H,data:K}=i.o.getImageData(O);if(H>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(B!==H*H)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(j)&&this.removeImage(j),this.addImage(j,{data:new i.q({width:B,height:H},K),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Y=this.imageManager.getImage(j,this.scope);Y?(this._styleColorTheme.lut={image:Y.data,data:t},p()):x(new Error("Missing LUT image."))}}))}getLut(t){const o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(o,p,x){let T,E,j;const O=i.o.devicePixelRatio>1?"@2x":"";let B=i.m(p.transformRequest(p.normalizeSpriteURL(o,O,".json"),i.R.SpriteJSON),((Y,J)=>{B=null,j||(j=Y,T=J,K())})),H=i.n(p.transformRequest(p.normalizeSpriteURL(o,O,".png"),i.R.SpriteImage),((Y,J)=>{H=null,j||(j=Y,E=J,K())}));function K(){if(j)x(j);else if(T&&E){const Y=i.o.getImageData(E),J={};for(const se in T){const{width:ae,height:he,x:de,y:_e,sdf:we,pixelRatio:ye,stretchX:Pe,stretchY:Ae,content:Ie}=T[se],je=new i.q({width:ae,height:he});i.q.copy(Y,je,{x:de,y:_e},{x:0,y:0},{width:ae,height:he},null),J[se]={data:je,pixelRatio:ye!==void 0?ye:1,sdf:we!==void 0&&we,stretchX:Pe,stretchY:Ae,content:Ie,usvg:!1,version:0}}x(null,J)}}return{cancel(){B&&(B.cancel(),B=null),H&&(H.cancel(),H=null)}}})(t,this.map._requestManager,((o,p)=>{if(this._spriteRequest=null,o)this.fire(new i.y(o));else if(p){const x=new Map;for(const T in p)x.set(i.I.from(T),p[T]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))}))}addIconset(t,o){if(o.type==="sprite")return void this._loadSprite(o.url);const p=this.getOwnSourceCache(o.source);if(!p)return void this.fire(new i.y(new Error(`Source "${o.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const x=p.getSource();if(x.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${o.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const T=new ju(t,this.scope,p);this.imageManager.addImageProvider(T,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!i.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const o=this.map._spriteFormat==="auto";var p,x;this._spriteRequest=(x=(T,E)=>{if(this._spriteRequest=null,T)o?this._loadSprite(t):this.fire(new i.y(T));else if(E){const j=new Map;for(const O in E)j.set(i.I.from(O),E[O]);this.addImages(j)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(t),i.R.Iconset),((T,E)=>{if(T)return void x(T);const j={},O=i.dg(new i.bt(E));for(const B of O.icons){const H={version:1,pixelRatio:i.o.devicePixelRatio,content:Af(B),stretchX:B.metadata?xl(B.metadata.stretch_x_areas):void 0,stretchY:B.metadata?xl(B.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:B};j[B.name]=H}x(null,j)})))}_validateLayer(t){const o=this.getOwnSource(t.source);if(!o)return;const p=t.sourceLayer;p&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(p)===-1)&&this.fire(new i.y(new Error(`Source layer "${p}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,o)=>{const p=this.fragments[o];return p&&p.style&&(t.data=p.style.serialize()),t}))}_serializeSources(){const t={};for(const o in this._sourceCaches){const p=this._sourceCaches[o].getSource();t[p.id]||(t[p.id]=p.serialize())}return t}_serializeLayers(t){const o=[];for(const p of t){const x=this._layers[p];x&&x.type!=="custom"&&o.push(x.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const o=this._mergedLayers[t];if(o._transitionablePaint&&o._transitionablePaint._values){const p=o._transitionablePaint._values["line-emissive-strength"];if(p&&p.value&&p.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const o=this.getOwnLayer(t);if(o)return o;this.fire(new i.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const o=this.getOwnSource(t);if(o)return o;this.fire(new i.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){const p=this.map.painter;if(p)for(let x=t.minzoom||0;x<(t.maxzoom||25.5);x++){const T=t.getProgramIds();if(T)for(const E of T){const j=t.getDefaultProgramParams(E,o.zoom,this._styleColorTheme.lut);j&&(p.style=this,this.fog&&(p._fogVisible=!0,j.overrideFog=!0,p.getOrCreateProgram(E,j)),p._fogVisible=!1,j.overrideFog=!1,p.getOrCreateProgram(E,j),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(j.overrideRtt=!0,p.getOrCreateProgram(E,j)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const j=this._changes.getLayerUpdatesByScope();for(const O in j){const{updatedIds:B,removedIds:H}=j[O];(B||H)&&(this._updateWorkerLayers(O,B,H),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const T={};for(const j in this._mergedSourceCaches){const O=this._mergedSourceCaches[j];T[j]=O.used,O.used=!1,O.tileCoverLift=0}for(const j of this._mergedOrder){const O=this._mergedLayers[j];if(O.visibility!=="none"&&O.recalculate(t,this._availableImages),!O.isHidden(t.zoom)){const B=this.getLayerSourceCache(O);B&&(B.used=!0,B.tileCoverLift=Math.max(B.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(O,t)})):this.precompilePrograms(O,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const j of E)j.sourceCache.used=!0;for(const j in T){const O=this._mergedSourceCaches[j];T[j]!==O.used&&O.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const o of t){const p=o.resolvePendingRequests(),x=this.getFragmentStyle(o.scope);x&&x.addImages(p)}}_updateTilesForChangedImages(){const t={};for(const o in this._mergedSourceCaches){const p=this._mergedSourceCaches[o].getSource().scope;t[p]=t[p]||this._changes.getUpdatedImages(p),t[p].length!==0&&this._mergedSourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t[p])}for(const o in t)this._changes.resetUpdatedImages(o)}_updateWorkerLayers(t,o,p){const x=this.getFragmentStyle(t);x&&this.dispatcher.broadcast("updateLayers",{layers:o?x._serializeLayers(o):[],scope:t,removedIds:p||[],options:x.options})}setState(t,o){if(this._checkLoaded(),eu(this,_o(t)))return!1;(t=i.dp(t)).layers=Do(t.layers);const p=(function(E,j){if(!E)return[{command:qn.setStyle,args:[j]}];let O=[];try{if(!i.by(E.version,j.version))return[{command:qn.setStyle,args:[j]}];if(i.by(E.center,j.center)||O.push({command:qn.setCenter,args:[j.center]}),i.by(E.zoom,j.zoom)||O.push({command:qn.setZoom,args:[j.zoom]}),i.by(E.bearing,j.bearing)||O.push({command:qn.setBearing,args:[j.bearing]}),i.by(E.pitch,j.pitch)||O.push({command:qn.setPitch,args:[j.pitch]}),i.by(E.sprite,j.sprite)||O.push({command:qn.setSprite,args:[j.sprite]}),i.by(E.glyphs,j.glyphs)||O.push({command:qn.setGlyphs,args:[j.glyphs]}),i.by(E.imports,j.imports)||(function(J=[],se=[],ae){se=se||[];const he=(J=J||[]).map(Xc),de=se.map(Xc),_e=J.reduce(Pa,{}),we=se.reduce(Pa,{}),ye=he.slice();let Pe,Ae,Ie,je;for(Pe=0,Ae=0;Pe<he.length;Pe++)Ie=he[Pe],we.hasOwnProperty(Ie)?Ae++:(ae.push({command:qn.removeImport,args:[Ie]}),ye.splice(ye.indexOf(Ie,Ae),1));for(Pe=0,Ae=0;Pe<de.length;Pe++)Ie=de[de.length-1-Pe],ye[ye.length-1-Pe]!==Ie&&(_e.hasOwnProperty(Ie)?(ae.push({command:qn.removeImport,args:[Ie]}),ye.splice(ye.lastIndexOf(Ie,ye.length-Ae),1)):Ae++,je=ye[ye.length-Pe],ae.push({command:qn.addImport,args:[we[Ie],je]}),ye.splice(ye.length-Pe,0,Ie));for(const Ce of se){const Ge=_e[Ce.id];Ge&&(delete Ge.data,i.by(Ge,Ce)||ae.push({command:qn.updateImport,args:[Ce.id,Ce]}))}})(E.imports,j.imports,O),i.by(E.transition,j.transition)||O.push({command:qn.setTransition,args:[j.transition]}),i.by(E.light,j.light)||O.push({command:qn.setLight,args:[j.light]}),i.by(E.fog,j.fog)||O.push({command:qn.setFog,args:[j.fog]}),i.by(E.snow,j.snow)||O.push({command:qn.setSnow,args:[j.snow]}),i.by(E.rain,j.rain)||O.push({command:qn.setRain,args:[j.rain]}),i.by(E.projection,j.projection)||O.push({command:qn.setProjection,args:[j.projection]}),i.by(E.lights,j.lights)||O.push({command:qn.setLights,args:[j.lights]}),i.by(E.camera,j.camera)||O.push({command:qn.setCamera,args:[j.camera]}),i.by(E.iconsets,j.iconsets)||(function(J,se,ae){let he;for(he in se=se||{},J=J||{})J.hasOwnProperty(he)&&(se.hasOwnProperty(he)||ae.push({command:qn.removeIconset,args:[he]}));for(he in se){if(!se.hasOwnProperty(he))continue;const de=se[he];J.hasOwnProperty(he)?i.by(J[he],de)||(ae.push({command:qn.removeIconset,args:[he]}),ae.push({command:qn.addIconset,args:[he,de]})):ae.push({command:qn.addIconset,args:[he,de]})}})(E.iconsets,j.iconsets,O),!i.by(E["color-theme"],j["color-theme"]))return[{command:qn.setStyle,args:[j]}];const B={},H=[];(function(J,se,ae,he){let de;for(de in se=se||{},J=J||{})J.hasOwnProperty(de)&&(se.hasOwnProperty(de)||gc(de,ae,he));for(de in se){if(!se.hasOwnProperty(de))continue;const _e=se[de];J.hasOwnProperty(de)?i.by(J[de],_e)||(J[de].type==="geojson"&&_e.type==="geojson"&&Wc(J,se,de)?ae.push({command:qn.setGeoJSONSourceData,args:[de,_e.data]}):Ju(de,se,ae,he)):js(de,se,ae)}})(E.sources,j.sources,H,B);const K=[];E.layers&&E.layers.forEach((J=>{J.source&&B[J.source]?O.push({command:qn.removeLayer,args:[J.id]}):K.push(J)}));let Y=E.terrain;Y&&B[Y.source]&&(O.push({command:qn.setTerrain,args:[void 0]}),Y=void 0),O=O.concat(H),i.by(Y,j.terrain)||O.push({command:qn.setTerrain,args:[j.terrain]}),(function(J,se,ae){se=se||[];const he=(J=J||[]).map(Xc),de=se.map(Xc),_e=J.reduce(Pa,{}),we=se.reduce(Pa,{}),ye=he.slice(),Pe=Object.create(null);let Ae,Ie,je,Ce,Ge,it,Ke;for(Ae=0,Ie=0;Ae<he.length;Ae++)je=he[Ae],we.hasOwnProperty(je)?Ie++:(ae.push({command:qn.removeLayer,args:[je]}),ye.splice(ye.indexOf(je,Ie),1));for(Ae=0,Ie=0;Ae<de.length;Ae++)je=de[de.length-1-Ae],ye[ye.length-1-Ae]!==je&&(_e.hasOwnProperty(je)?(ae.push({command:qn.removeLayer,args:[je]}),ye.splice(ye.lastIndexOf(je,ye.length-Ie),1)):Ie++,it=ye[ye.length-Ae],ae.push({command:qn.addLayer,args:[we[je],it]}),ye.splice(ye.length-Ae,0,je),Pe[je]=!0);for(Ae=0;Ae<de.length;Ae++)if(je=de[Ae],Ce=_e[je],Ge=we[je],!Pe[je]&&!i.by(Ce,Ge))if(i.by(Ce.source,Ge.source)&&i.by(Ce["source-layer"],Ge["source-layer"])&&i.by(Ce.type,Ge.type)){for(Ke in Zc(Ce.layout,Ge.layout,ae,je,null,qn.setLayoutProperty),Zc(Ce.paint,Ge.paint,ae,je,null,qn.setPaintProperty),i.by(Ce.slot,Ge.slot)||ae.push({command:qn.setSlot,args:[je,Ge.slot]}),i.by(Ce.filter,Ge.filter)||ae.push({command:qn.setFilter,args:[je,Ge.filter]}),i.by(Ce.minzoom,Ge.minzoom)&&i.by(Ce.maxzoom,Ge.maxzoom)||ae.push({command:qn.setLayerZoomRange,args:[je,Ge.minzoom,Ge.maxzoom]}),Ce)Ce.hasOwnProperty(Ke)&&Ke!=="layout"&&Ke!=="paint"&&Ke!=="filter"&&Ke!=="metadata"&&Ke!=="minzoom"&&Ke!=="maxzoom"&&Ke!=="slot"&&(Ke.indexOf("paint.")===0?Zc(Ce[Ke],Ge[Ke],ae,je,Ke.slice(6),qn.setPaintProperty):i.by(Ce[Ke],Ge[Ke])||ae.push({command:qn.setLayerProperty,args:[je,Ke,Ge[Ke]]}));for(Ke in Ge)Ge.hasOwnProperty(Ke)&&!Ce.hasOwnProperty(Ke)&&Ke!=="layout"&&Ke!=="paint"&&Ke!=="filter"&&Ke!=="metadata"&&Ke!=="minzoom"&&Ke!=="maxzoom"&&Ke!=="slot"&&(Ke.indexOf("paint.")===0?Zc(Ce[Ke],Ge[Ke],ae,je,Ke.slice(6),qn.setPaintProperty):i.by(Ce[Ke],Ge[Ke])||ae.push({command:qn.setLayerProperty,args:[je,Ke,Ge[Ke]]}))}else ae.push({command:qn.removeLayer,args:[je]}),it=ye[ye.lastIndexOf(je)+1],ae.push({command:qn.addLayer,args:[Ge,it]})})(K,j.layers,O)}catch(B){console.warn("Unable to compute style diff:",B),O=[{command:qn.setStyle,args:[j]}]}return O})(this.serialize(),t).filter((E=>!(E.command in jm)));if(p.length===0)return!1;const x=p.filter((E=>!(E.command in Gd)));if(x.length>0)throw new Error(`Unimplemented: ${x.map((E=>E.command)).join(", ")}.`);const T=[];return p.forEach((E=>{T.push(this[E.command](...E.args))})),o&&Promise.all(T).then(o).catch(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[o,p]of t.entries()){if(this.getImage(o))return this.fire(new i.y(new Error(`An image with the name "${o.name}" already exists.`)));this.imageManager.addImage(o,this.scope,p),this._changes.updateImage(o,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(t,o){return this.getImage(t)?this.fire(new i.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,o),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(t,o,p=!1){this.imageManager.updateImage(t,this.scope,o),p&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(t,o,p={}){return this._checkLoaded(),this._validate(ne,`models.${t}`,o,null,p)||(this.modelManager.addModel(t,o,this.getActualScope()),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,o,p={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(ku,`sources.${t}`,o,null,p))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const x=Sa(t,o,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id})));const T=E=>{const j=(E?"symbol:":"other:")+x.id,O=i.B(j,this.scope),B=this._sourceCaches[j]=new hs(O,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=B,B.onAdd(this.map)};T(!1),o.type!=="vector"&&o.type!=="geojson"||T(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===t)return this.fire(new i.y(new Error(`Source "${t}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new i.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find((([T,E])=>E.type==="source"&&E.source===t));if(x)return this.fire(new i.y(new Error(`Source "${t}" cannot be removed while iconset "${x[0]}" is using it.`)))}const p=this.getOwnSourceCaches(t);for(const x of p){const T=i.dq(x.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(x.id),x.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){const o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){const t=[];for(const o in this._otherSourceCaches){const p=this.getOwnSourceCache(o);p&&t.push(p.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const o in t){const p=t[o]._tiles;for(const x in p){const T=p[x];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const T of t){if(this._validate(Rt,"lights",T))return;switch(T.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(T),E.updateTransitions(o)}else this.ambientLight=new an(T,Oa||(Oa=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(T),E.updateTransitions(o)}else this.directionalLight=new an(T,Ea||(Ea=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(o,{worldview:this.map.getWorldview()}),x=new i.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;const p=Y=>.2126*(Y[0]<=.03928?Y[0]/12.92:Math.pow((Y[0]+.055)/1.055,2.4))+.7152*(Y[1]<=.03928?Y[1]/12.92:Math.pow((Y[1]+.055)/1.055,2.4))+.0722*(Y[2]<=.03928?Y[2]/12.92:Math.pow((Y[2]+.055)/1.055,2.4)),x=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),T=t.properties.get("intensity"),E=t.properties.get("direction"),j=1-i.d4(E.x,E.y,E.z)[2]/90,O=p(x)*T*j,B=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),H=o.properties.get("intensity"),K=p(B)*H;return Number(((O+K)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(i.dr(t)){const o=i.ds(t),p=this.fragments.find((({id:T})=>T===o));if(!p)return;const x=i.dq(t);return p.style.getFragmentStyle(x)}{const o=this.fragments.find((({id:p})=>p===t));return o?o.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const o={},p=(x,T="")=>`${x}::${T}`;this._featuresetSelectors={};for(const x in t){const T=this._featuresetSelectors[x]=[];for(const E of t[x].selectors){if(E.featureNamespace){const O=this.getOwnLayer(E.layer);if(!O){i.w(`Layer is undefined for selector: ${E.layer}`);continue}const B=p(O.source,O.sourceLayer);if(B in o&&o[B]!==E.featureNamespace){i.w(`"featureNamespace ${E.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}o[B]=E.featureNamespace}let j;if(E.properties)for(const O in E.properties){const B=i.U(E.properties[O]);B.result==="success"&&(j=j||{},j[O]=B.value)}T.push({layerId:E.layer,namespace:E.featureNamespace,properties:j,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];const p=[];for(const x in o.stylesheet.featuresets)p.push({featuresetId:x,importId:o.scope?o.scope:void 0});return p}getFeaturesetLayers(t,o){const p=this.getFragmentStyle(o),x=p.stylesheet.featuresets;if(!x||!x[t])return this.fire(new i.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const T=[];for(const E of x[t].selectors){const j=p.getOwnLayer(E.layer);j&&T.push(j)}return T}getConfigProperty(t,o){const p=this.getFragmentStyle(t);if(!p)return null;const x=i.B(o,p.scope),T=p.options.get(x),E=T?T.value||T.default:null;return E?E.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,o){const p=i.B(t,o);return this._mergedIndoor[p]}setIndoorData(t,o){this.map.indoor.setIndoorData(o)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,o,p){const x=this.getFragmentStyle(t);if(!x)return;const T=x.stylesheet.schema;if(!T||!T[o])return;const E=i.U(p);if(E.result!=="success")return void eu(this,E.value);const j=E.value.expression,O=i.B(o,x.scope),B=x.options.get(O);if(!B)return;let H;const{minValue:K,maxValue:Y,stepValue:J,type:se,values:ae}=T[o],he=i.U(T[o].default);he.result==="success"&&(H=he.value.expression),H?(this.options.set(O,Object.assign({},B,{value:j,default:H,minValue:K,maxValue:Y,stepValue:J,type:se,values:ae})),this.updateConfigDependencies(o)):this.fire(new i.y(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){const o=this.getFragmentStyle(t);if(!o)return null;const p=o.stylesheet.schema;if(!p)return null;const x={};for(const T in p){const E=i.B(T,o.scope),j=o.options.get(E),O=j?j.value||j.default:null;x[T]=O?O.serialize():null}return x}setConfig(t,o){const p=this.getFragmentStyle(t);p&&(p.updateConfig(o,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){const p=this.getFragmentStyle(t);p&&(p.stylesheet.schema=o,p.updateConfig(p._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(const p in o){let x,T;const E=i.U(o[p].default);if(E.result==="success"&&(x=E.value.expression),t&&t[p]!==void 0){const Y=i.U(t[p]);Y.result==="success"&&(T=Y.value.expression)}const{minValue:j,maxValue:O,stepValue:B,type:H,values:K}=o[p];if(x){const Y=i.B(p,this.scope);this.options.set(Y,{default:x,value:T,minValue:j,maxValue:O,stepValue:B,type:H,values:K})}else this.fire(new i.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,o=(()=>!0)){for(const p of t){const x=this.getLayer(p);x&&o(x)&&(x.possiblyEvaluateVisibility(),this._updateLayer(x),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,(o=>!t||o.expressionDependencies.configDependencies.has(t))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((o=>{const p=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(p){const x=o._evaluateColorThemeData(p);(!o._styleColorTheme.lut&&x!==""||o._styleColorTheme.lut&&x!==o._styleColorTheme.lut.data)&&o.setColorTheme(p)}})),this._changes.setDirty()}addLayer(t,o,p={}){this._checkLoaded();const x=t.id;if(this._layers[x])return void this.fire(new i.y(new Error(`Layer with id "${x}" already exists on this map`)));let T;if(t.type==="custom"){if(eu(this,i.dt(t)))return;T=i.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(x,t.source),t=i.dp(t),t=Object.assign(t,{source:x})),this._validate(Ti,`layers.${x}`,t,{arrayIndex:-1},p))return;T=i.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:x}})}const E=i.B(T.source,T.scope);T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E);let j=this._order.length;if(o){const K=this._order.indexOf(o);if(K===-1)return void this.fire(new i.y(new Error(`Layer with id "${o}" does not exist on this map.`)));T.slot===this._layers[o].slot?j=K:i.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(j,0,x),this._layerOrderChanged=!0,this._layers[x]=T;const O=this.getOwnLayerSourceCache(T),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&T.canCastShadows()&&B&&(O.castsShadows=!0);const H=this._changes.getRemovedLayer(T);if(H&&T.source&&O&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const K=i.B(T.source,T.scope);H.type!==T.type?this._changes.updateSourceCache(K,"clear"):(this._changes.updateSourceCache(K,"reload"),O.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();const p=this._checkLayer(t);if(!p||t===o)return;const x=this._order.indexOf(t);this._order.splice(x,1);let T=this._order.length;if(o){const E=this._order.indexOf(o);if(E===-1)return void this.fire(new i.y(new Error(`Layer with id "${o}" does not exist on this map.`)));p.slot===this._layers[o].slot?T=E:i.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);const p=this._order.indexOf(t);this._order.splice(p,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._indoorDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const x=this.getOwnLayerSourceCache(o);if(x&&x.castsShadows){let T=!1;for(const E in this._layers)if(this._layers[E].source===o.source&&this._layers[E].canCastShadows()){T=!0;break}x.castsShadows=T}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,p){this._checkLoaded();const x=this._checkLayer(t);x&&(x.minzoom===o&&x.maxzoom===p||(o!=null&&(x.minzoom=o),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();const p=this._checkLayer(t);p&&p.slot!==o&&(p.slot=o,this._updateLayer(p))}setFilter(t,o,p={}){this._checkLoaded();const x=this._checkLayer(t);if(x&&!i.by(x.filter,o))return o==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(vn,`layers.${x.id}.filter`,o,{layerType:x.type},p)||(x.filter=i.dp(o),this._updateLayer(x)))}getFilter(t){const o=this._checkLayer(t);if(o)return i.dp(o.filter)}setLayoutProperty(t,o,p,x={}){this._checkLoaded();const T=this._checkLayer(t);if(T&&!i.by(T.getLayoutProperty(o),p)){if(p!=null&&(!x||x.validate!==!1)&&eu(T,Xe.call(_o,{key:`layers.${t}.layout.${o}`,layerType:T.type,objectKey:o,value:p,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(o,p),T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T.fqid),this._updateLayer(T)}}setLayerProperty(t,o,p,x={}){this._checkLoaded();const T=this._checkLayer(t);T&&(o==="appearances"?(T.setAppearances(p),this._changes.setDirty()):T.isPaintProperty(o)?this.setPaintProperty(t,o,p,x):this.setLayoutProperty(t,o,p,x))}getLayoutProperty(t,o){const p=this._checkLayer(t);if(p)return p.getLayoutProperty(o)}setPaintProperty(t,o,p,x={}){this._checkLoaded();const T=this._checkLayer(t);if(!T||i.by(T.getPaintProperty(o),p)||p!=null&&(!x||x.validate!==!1)&&eu(T,Mn.call(_o,{key:`layers.${t}.paint.${o}`,layerType:T.type,objectKey:o,value:p,styleSpec:i.a6})))return;const E=T.setPaintProperty(o,p);T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T.fqid),E&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(t,o){const p=this._checkLayer(t);if(p)return p.getPaintProperty(o)}setFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:O,importId:B}=t.target,H=this.getFragmentStyle(B),K=H.getFeaturesetLayers(O);for(const{source:Y,sourceLayer:J}of K)H.setFeatureState({id:t.id,source:Y,sourceLayer:J},o)}else if("layerId"in t.target){const{layerId:O}=t.target,B=this.getLayer(O);this.setFeatureState({id:t.id,source:B.source,sourceLayer:B.sourceLayer},o)}return}const p=t.source,x=t.sourceLayer,T=this._checkSource(p);if(!T)return;const E=T.type;if(E==="geojson"&&x)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const j=this.getOwnSourceCaches(p);for(const O of j)O.setFeatureState(x,t.id,o)}removeFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:O,importId:B}=t.target,H=this.getFragmentStyle(B),K=H.getFeaturesetLayers(O);for(const{source:Y,sourceLayer:J}of K)H.removeFeatureState({id:t.id,source:Y,sourceLayer:J},o)}else if("layerId"in t.target){const{layerId:O}=t.target,B=this.getLayer(O);this.removeFeatureState({id:t.id,source:B.source,sourceLayer:B.sourceLayer},o)}return}const p=t.source,x=this._checkSource(p);if(!x)return;const T=x.type,E=T==="vector"?t.sourceLayer:void 0;if(T==="vector"&&!E)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const j=this.getOwnSourceCaches(p);for(const O of j)O.removeFeatureState(E,t.id,o)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let T;if("featuresetId"in t.target){const{featuresetId:E,importId:j}=t.target,O=this.getFragmentStyle(j),B=O.getFeaturesetLayers(E);for(const{source:H,sourceLayer:K}of B){const Y=O.getFeatureState({id:t.id,source:H,sourceLayer:K});if(Y&&!T)T=Y;else if(!i.by(T,Y))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:E}=t.target,j=this.getLayer(E);T=this.getFeatureState({id:t.id,source:j.source,sourceLayer:j.sourceLayer})}return T}const o=t.source,p=t.sourceLayer,x=this._checkSource(o);if(x){if(x.type!=="vector"||p)return t.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(p,t.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return i.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(p=>p!==void 0))}_updateFilteredLayers(t){for(const o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);const o=this.getLayerSourceCache(t),p=i.B(t.source,t.scope),x=this._changes.getUpdatedSourceCaches();t.source&&!x[p]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const o=j=>this._mergedLayers[j].is3D(!!this.terrain),p=this.order,x={},T=[];for(let j=p.length-1;j>=0;j--){const O=p[j];if(o(O)){x[O]=j;for(const B of t){const H=B[O];if(H)for(const K of H)T.push(K)}}}T.sort(((j,O)=>O.intersectionZ-j.intersectionZ));const E=[];for(let j=p.length-1;j>=0;j--){const O=p[j];if(o(O))for(let B=T.length-1;B>=0;B--){const H=T[B].feature;if(H.layer&&x[H.layer.id]<j)break;E.push(H),T.pop()}else for(const B of t){const H=B[O];if(H)for(const K of H)E.push(K.feature)}}return E}queryRasterValue(t,o,p){const x=this.getOwnSource(t);return x?x.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):x.queryRasterArrayValue(o,p):(this.fire(new i.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,o,p){let x;o&&!Array.isArray(o)&&o.filter&&(this._validate(vn,"queryRenderedFeatures.filter",o.filter,null,o),x=i.b6(o.filter));const T={},E=H=>{if(ld.has(H.type))return;const K=this.getOwnLayerSourceCache(H),Y=T[K.id]=T[K.id]||{sourceCache:K,layers:{},has3DLayers:!1};H.is3D(!!this.terrain)&&(Y.has3DLayers=!0),Y.layers[H.fqid]=Y.layers[H.fqid]||{styleLayer:H,targets:[]},Y.layers[H.fqid].targets.push({filter:x})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const H of o.layers){const K=this._layers[H];if(!K)return this.fire(new i.y(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];E(K)}}else for(const H in this._layers)E(this._layers[H]);const j=this._queryRenderedFeatures(t,T,p),O=this._flattenAndSortRenderedFeatures(j),B=[];for(const H of O)i.dw(H.layer.id)===this.scope&&B.push(H);return B}queryRenderedFeatureset(t,o,p){let x;o&&!Array.isArray(o)&&o.filter&&(this._validate(vn,"queryRenderedFeatures.filter",o.filter,null,o),x=i.b6(o.filter));const T="mock",E=[];if(o&&o.target)E.push(Object.assign({},o,{targetId:T,filter:x}));else{const H=this.getFeaturesetDescriptors();for(const K of H)E.push({targetId:T,filter:x,target:K});for(const{style:K}of this.fragments){const Y=K.getFeaturesetDescriptors();for(const J of Y)E.push({targetId:T,filter:x,target:J})}}const j=this.queryRenderedTargets(t,E,p),O=[],B=new Set;for(const H of j)for(const K of H.variants[T])yo(K,H,B)||O.push(new i.dx(H,K));return O}queryRenderedTargets(t,o,p){const x={},T=(j,O,B,H)=>{const K=x[O.id]=x[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(K.layers[j.fqid]=K.layers[j.fqid]||{styleLayer:j,targets:[]},j.is3D(!!this.terrain)&&(K.has3DLayers=!0),!H)return B.uniqueFeatureID=!1,void K.layers[j.fqid].targets.push(B);K.layers[j.fqid].targets.push(Object.assign({},B,{namespace:H.namespace,properties:H.properties,uniqueFeatureID:H.uniqueFeatureID}))};for(const j of o)if("featuresetId"in j.target){const{featuresetId:O,importId:B}=j.target,H=this.getFragmentStyle(B);if(!H||!H._featuresetSelectors)continue;const K=H._featuresetSelectors[O];if(!K){this.fire(new i.y(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Y of K){const J=H.getOwnLayer(Y.layerId);J&&!ld.has(J.type)&&T(J,H.getOwnLayerSourceCache(J),j,Y)}}else if("layerId"in j.target){const{layerId:O}=j.target,B=this.getLayer(O);if(!B||ld.has(B.type))continue;T(B,this.getLayerSourceCache(B),j)}const E=this._queryRenderedFeatures(t,x,p);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(t,o,p){const x=[],T=!!this.map._showQueryGeometry,E=ia.createFromScreenPoints(t,p);for(const j in o){const O=Gc(E,o[j],this._availableImages,p,T);Object.keys(O).length&&x.push(O)}if(this.placement)for(const j in o){if(!o[j].sourceCache._onlySymbols)continue;const O=Eu(E.screenGeometry,o[j],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(O).length&&x.push(O)}return x}querySourceFeatures(t,o){const p=o&&o.filter;p&&this._validate(vn,"querySourceFeatures.filter",p,null,o);let x=[];const T=this.getOwnSourceCaches(t);for(const E of T)x=x.concat(fc(E,o));return x}addSourceType(t,o,p){return es.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(es.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,p={}){this._checkLoaded();const x=this.light.getLight();let T=!1;for(const j in t)if(!i.by(t[j],x[j])){T=!0;break}if(!T)return;const E=this._getTransitionParameters();this.light.setLight(t,o,p),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=t;const x=!("source"in t)||t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if("source"in p&&typeof p.source=="object"){const j="terrain-dem-src";this.addSource(j,p.source),p=i.dp(p),p=Object.assign(p,{source:j})}const T=Object.assign({},p),E={};if(this.terrain&&x){T.source=this.terrain.get().source;const j=this.terrain?this.getFragmentStyle(this.terrain.scope):null;j&&(E.style=j.serialize())}if(this._validate(ii,"terrain",T,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&o!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,o),this.fire(new i.z("data",{dataType:"style"}))}else{const T=this.terrain,E=T.get();for(const j of Object.keys(i.a6.terrain))!p.hasOwnProperty(j)&&i.a6.terrain[j].default&&(p[j]=i.a6.terrain[j].default);for(const j in t)if(!i.by(t[j],E[j])){T.set(t,this.options),this.stylesheet.terrain=t;const O=this._getTransitionParameters({duration:0});T.updateTransitions(O),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const o=this.fog=new Xi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}_createSnow(t){const o=this.snow=new Jn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}_createRain(t){const o=this.rain=new gn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!i.by(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!i.by(o.get(),t)){o.set(t,this.options),this.stylesheet.snow=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!i.by(o.get(),t)){o.set(t,this.options),this.stylesheet.rain=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void t();const p=this._evaluateColorThemeData(o);this._loadColorTheme(p).then((()=>{this.fire(new i.z("colorthemeset")),t()})).catch((x=>{i.w(`Couldn't set color theme: ${x}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,o){const p=this.getFragmentStyle(t);p&&(p._styleColorTheme.colorThemeOverride=o,p._reloadColorTheme())}_getTransitionParameters(t){return{now:i.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],o=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?t.push(p):o.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){const p=this.terrain=new Je(t,o,this.scope,this.options,this.map.getWorldview());o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,p,x,T={}){if(T&&T.validate===!1)return!1;const E=Object.assign({},this.serialize());return eu(this,t.call(_o,Object.assign({key:o,style:E,value:p,styleSpec:i.a6},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const o=this.getSourceCaches(t);for(const p of o)p.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const o=this._mergedLayers[t];o._clear&&o._clear()}}reloadSource(t){const o=this.getSourceCaches(t);for(const p of o)p.resume(),p.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let o;this.directionalLight&&(o=od(this.directionalLight));const p=new Set,x=new Set;for(const T in this._mergedLayers){const E=this._mergedLayers[T];E.type==="building"&&p.add(E.source),E.hasElevation()&&!x.has(E.source)&&x.add(E.source)}for(const T in this._mergedSourceCaches){const E=this._mergedSourceCaches[T],j=x.has(E._source.id);p.has(E._source.id)&&(E._source.reparseOverscaled=!1),E.update(t,void 0,void 0,o,j)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,p,x,T,E,j=!1){let O=!1,B=!1;const H={},K={};for(const ae of this._mergedOrder){const he=this._mergedLayers[ae];if(he.type!=="symbol")continue;const de=i.B(he.source,he.scope);let _e=H[de];if(!_e){const ye=this.getLayerSourceCache(he);if(!ye)continue;const Pe=ye.getRenderableIds(!0).map((Ae=>ye.getTileByID(Ae)));K[de]=Pe.slice(),_e=H[de]=Pe.sort(((Ae,Ie)=>Ie.tileID.overscaledZ-Ae.tileID.overscaledZ||(Ae.tileID.isLessThan(Ie.tileID)?-1:1)))}const we=this.crossTileSymbolIndex.addLayer(he,_e,o.center.lng,o.projection);O=O||we}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),j=j||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new i.z("neworder"));const Y=!!(this.placement&&!o.equals(this.placement.transform)),J=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!E||this.placement.lastReplacementSourceUpdateTime!==E.updateTime)),se=(Y||J||O||this.placement&&this.placement.isStale())&&x===0;if((j||!this.pauseablePlacement||se||x!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),o.zoom))&&(this.pauseablePlacement=new Gr(o,this._mergedOrder,j||x===0,p,x,T,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,H,K,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),B=!0),O&&this.pauseablePlacement.placement.setStale()),B||O){this._buildingIndex.onNewFrame(o.zoom);for(let ae=0;ae<this._mergedOrder.length;ae++){const he=this._mergedLayers[this._mergedOrder[ae]];if(he.type!=="symbol"||he.visibility==="none")continue;const de=this.isLayerClipped(he);this.placement.updateLayerOpacities(he,H[i.B(he.source,he.scope)],ae,de?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex((({id:T})=>T===t.id))!==-1)return void this.fire(new i.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return p.push(t),this._loadImports([t],!0);const x=p.findIndex((({id:T})=>T===o));return x===-1&&this.fire(new i.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(t).concat(p.slice(x)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(t);return x===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==p[x].url&&this.setImportUrl(t,o.url),i.by(o.config,p[x].config)||this.setImportConfig(t,o.config,o.data.schema),i.by(o.data,p[x].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(t);if(x===-1)return this;const T=this.getImportIndex(o);if(T===-1)return this;const E=p[x],j=this.fragments[x];return p=p.filter((({id:O})=>O!==t)),this.fragments=this.fragments.filter((({id:O})=>O!==t)),this.stylesheet.imports=p.slice(0,T).concat(E).concat(p.slice(T)),this.fragments=this.fragments.slice(0,T).concat(j).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(t);if(x===-1)return this;p[x].url=o;const T=this.fragments[x];return T.style=this._createFragmentStyle(p[x]),T.style.on("style.import.load",(()=>this.mergeAll())),T.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();const p=this.getImportIndex(t),x=this.stylesheet.imports||[];return p===-1?this:o?(this.fragments[p].style.setState(o),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(t,x[p].url))}setImportConfig(t,o,p){this._checkLoaded();const x=this.getImportIndex(t),T=this.stylesheet.imports||[];if(x===-1)return this;o?T[x].config=o:delete T[x].config;const E=this.fragments[x];p&&E.style.stylesheet&&(E.style.stylesheet.schema=p);const j=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=o,E.style.updateConfig(o,j),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const o=this.stylesheet.imports||[],p=this.getImportIndex(t);p!==-1&&(o.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(t){const o=(this.stylesheet.imports||[]).findIndex((p=>p.id===t));return o===-1&&this.fire(new i.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const o in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[o];p&&t.push(p.getSource())}return t}getSource(t,o){const p=this.getSourceCache(t,o);return p&&p.getSource()}getLayerSource(t){const o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){const p=i.B(t,o);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(t){const o=i.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const o in t){const p=t[o];p==="reload"?this.reloadSource(o):p==="clear"&&this.clearSource(o)}}updateLayers(t){const o=this._changes.getUpdatedPaintProperties();for(const p of o){const x=this.getLayer(p);x&&x.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,o,p){this.imageManager.getImages(o.images,o.scope,p),this._updateTilesForChangedImages();const x=E=>{if(E){const j=o.images.map((O=>i.I.toString(O)));E.setDependencies(o.tileID.key,o.type,j)}},T=i.B(o.source,o.scope);x(this._mergedOtherSourceCaches[T]),x(this._mergedSymbolSourceCaches[T]),o.images.some((E=>E.iconsetId))&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(t,o,p){this.imageManager.rasterizeImages(o,p)}getGlyphs(t,o,p){this.glyphManager.getGlyphs(o.stacks,p)}getResource(t,o,p){return i.dz(o,p)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){const o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${t}'`))),!1):o.every((p=>p.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const p=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),x=t.type==="building";if(t.is3D(!!this.terrain)){if(p||x||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}es.getSourceType=function(m){return os[m]},es.setSourceType=function(m,t){os[m]=t},es.registerForPluginStateChange=i.dA;class tu extends i.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[o,p]of Object.entries(t.buildings))if(this._buildings[o])for(const x of p.floorIds)this._buildings[o].floors[x]||(this._buildings[o].floors[x]=p.floors[x]);else this._buildings[o]=p;for(const o of t.activeFloors)this._activeFloors.add(o);this._updateIndoorSelector()}getIndoorTileOptions(t,o){const p=this._style.getIndoorSourceLayers(t,o);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_updateUI(t,o,p){const x=(function(T,E,j,O){let B=null,H=Number.MAX_SAFE_INTEGER;if(O<16)return null;for(const[K,Y]of Object.entries(T)){const J=Y.center;if(J){const se=E.distanceTo(i.aT.convert(J));se<H&&j.contains(J)&&(H=se,B=K)}}return B})(this._buildings,o,p,t);x!==this._closestBuildingId&&(this._closestBuildingId=x,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,o=this._closestBuildingId,p=o&&t?t[o]:void 0;if(!p)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let x=null;for(const E of p.floorIds)if(this._activeFloors&&this._activeFloors.has(E)){x=E;break}const T=Array.from(p.floorIds).map((E=>({id:E,name:p.floors[E].name,zIndex:p.floors[E].zIndex}))).sort(((E,j)=>j.zIndex-E.zIndex));this.fire(new i.z("selector-update",{selectedFloorId:x,activeFloorsVisible:this._activeFloorsVisible,floors:T}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Ds=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Os=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,iu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Bo="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",eo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,nu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Jt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,au=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ru=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Fl=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,bc=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const cd=/#include\s+"([^"]+)"/g,ts=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,ud=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,uo=new Set(["ifdef","ifndef","elif","if","defined"]),wc=new Set;I(Ds,wc),I(iu,wc),I(Os,wc);const bl={"_prelude_fog.vertex.glsl":nu,"_prelude_terrain.vertex.glsl":eo,"_prelude_shadow.vertex.glsl":Fl,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Jt,"_prelude_shadow.fragment.glsl":bc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":au,"_prelude_raster_particle.glsl":ru},Bl={};V("",eo),V(Jt,nu),V(bc,Fl),V(au,""),V(ru,"");const jh=V(Os,iu),Ru=Ds,Lu=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Ru,jh.fragmentSource].join(`
`),Iu=["precision highp float;",Ru,jh.vertexSource].join(`
`);var b={background:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:V(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:V(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:V("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:V(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:V(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:V("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:V("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:V("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:V(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:V(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:V(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:V(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:V(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:V(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:V("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:V("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:V(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:V(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:V("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:V(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Bo),skyboxGradient:V(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Bo),skyboxCapture:V(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:V(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:V(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:V(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:V(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:V("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:V("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:V("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:V("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function I(m,t){const o=m.split(`
`);for(let p of o){if(p=p.trimStart(),p[0]!=="#"||!p.includes("if")||p.startsWith("#endif"))continue;const x=p.match(ud);if(x)for(const T of x)uo.has(T)||t.add(T)}}function V(m,t){const o=new Set,p=[],x=[];m=m.replace(cd,((E,j)=>(x.push(j),""))),t=t.replace(cd,((E,j)=>(p.push(j),"")));let T=new Set(wc);I(m,T),I(t,T);for(const E of[...p,...x])Bl[E]||(Bl[E]=new Set,I(bl[E],Bl[E])),T=new Set([...T,...Bl[E]]);return{fragmentSource:m=m.replace(ts,((E,j,O,B,H)=>(o.add(H),j==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${O} ${B} ${H};
#else
uniform ${O} ${B} u_${H};
#endif
`:j==="initialize"?`
#ifdef HAS_UNIFORM_u_${H}
    ${O} ${B} ${H} = u_${H};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${O} ${B} ${H};
#endif
`:j==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(ts,((E,j,O,B,H)=>{const K=`MATERIAL_ATTRIBUTE_OFFSET_${H}`,Y=B==="float"?"vec2":B,J=`GET_ATTRIBUTE_${Y}(a_${H}, materialInfo, ${K})`,se=H.match(/color/)?"color":Y;return j==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${H}
in ${O} ${B} a_${H};
#endif
`:o.has(H)?j==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
    #if !defined(${K})
        in ${O} ${Y} a_${H};
    #endif
out ${O} ${B} ${H};
#else
uniform ${O} ${B} u_${H};
#endif
`:j==="initialize"?se==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${O} ${B} ${H} = u_${H};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${H})
    #ifdef ${K}
        ${H} = unpack_mix_${se}(${J}, u_${H}_t);
    #else
        ${H} = unpack_mix_${se}(a_${H}, u_${H}_t);
    #endif
#else
    ${O} ${B} ${H} = u_${H};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${O} ${B} a_${H};
    out ${O} ${B} ${H};
#endif
`:j==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${H} = a_${H};
#endif
`:void 0:j==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
    #if !defined(${K})
        in ${O} ${Y} a_${H};
    #endif
#else
uniform ${O} ${B} u_${H};
#endif
`:j==="define-instanced"?se==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${H}0;
in vec4 a_${H}1;
in vec4 a_${H}2;
in vec4 a_${H}3;
#else
uniform ${O} ${B} u_${H};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${Y} a_${H};
#else
uniform ${O} ${B} u_${H};
#endif
`:j==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${O} ${B} ${H} = a_${H};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    #ifdef ${K}
        ${O} ${B} ${H} = ${J};
    #else
        ${O} ${B} ${H} = a_${H};
    #endif
#else
    ${O} ${B} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    #ifdef ${K}
        ${O} ${B} ${H} = unpack_mix_${se}(${J}, u_${H}_t);
    #else
        ${O} ${B} ${H} = unpack_mix_${se}(a_${H}, u_${H}_t);
    #endif
#else
    ${O} ${B} ${H} = u_${H};
#endif
`})),usedDefines:T,vertexIncludes:p,fragmentIncludes:x}}class ie{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,p,x,T,E,j,O){this.context=t;let B=this.boundPaintVertexBuffers.length!==x.length;for(let K=0;!B&&K<x.length;K++)this.boundPaintVertexBuffers[K]!==x[K]&&(B=!0);let H=this.boundDynamicVertexBuffers.length!==j.length;for(let K=0;!H&&K<j.length;K++)this.boundDynamicVertexBuffers[K]!==j[K]&&(H=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==p||B||H||this.boundIndexBuffer!==T||this.boundVertexOffset!==E)this.freshBind(o,p,x,T,E,j,O);else{t.bindVertexArrayOES.set(this.vao);for(const K of j)K&&(K.bind(),O&&K.instanceCount&&K.setVertexAttribDivisor(t.gl,o,O));T&&T.dynamicDraw&&T.bind()}}freshBind(t,o,p,x,T,E,j){const O=this.context,B=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=E,o.enableAttributes(B,t),o.bind(),o.setVertexAttribPointers(B,t,T);for(const H of p)H.enableAttributes(B,t),H.bind(),H.setVertexAttribPointers(B,t,T);for(const H of E)H&&(H.enableAttributes(B,t),H.bind(),H.setVertexAttribPointers(B,t,T),j&&H.instanceCount&&H.setVertexAttribDivisor(B,t,j));x&&x.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ge(m,t){const o=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new i.ae(0,p/o).toLngLat().lat,new i.ae(0,(p+1)/o).toLngLat().lat]}function ze(m,t,o,p,x,T,E){const j=m.context,O=j.gl,B=o.hillshadeFBO;if(!B)return;m.prepareDrawTile();const H=m.isTileAffectedByFog(t),K=[];m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&K.push("USE_MRT1");const Y=m.getOrCreateProgram("hillshade",{overrideFog:H,defines:K});j.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,B.colorAttachment0.get());const J=((de,_e,we,ye)=>{const Pe=we.paint.get("hillshade-shadow-color"),Ae=we.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ie=we.paint.get("hillshade-highlight-color"),je=we.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ce=we.paint.get("hillshade-accent-color"),Ge=we.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",it=we.paint.get("hillshade-emissive-strength");let Ke=i.an(we.paint.get("hillshade-illumination-direction"));if(we.paint.get("hillshade-illumination-anchor")==="viewport")Ke-=de.transform.angle;else if(de.style&&de.style.enable3dLights()&&de.style.directionalLight){const mt=de.style.directionalLight.properties.get("direction"),kt=i.d4(mt.x,mt.y,mt.z);Ke=i.an(kt[1])}const ht=!de.options.moving;return{u_matrix:ye||de.transform.calculateProjMatrix(_e.tileID.toUnwrapped(),ht),u_image:0,u_latrange:ge(0,_e.tileID),u_light:[we.paint.get("hillshade-exaggeration"),Ke],u_shadow:Pe.toPremultipliedRenderColor(Ae?null:we.lut),u_highlight:Ie.toPremultipliedRenderColor(je?null:we.lut),u_emissive_strength:it,u_accent:Ce.toPremultipliedRenderColor(Ge?null:we.lut)}})(m,o,p,m.terrain?t.projMatrix:null);m.uploadCommonUniforms(j,Y,t.toUnwrapped());const{tileBoundsBuffer:se,tileBoundsIndexBuffer:ae,tileBoundsSegments:he}=m.getTileBoundsBuffers(o);Y.draw(m,O.TRIANGLES,x,T,E,en.disabled,J,p.id,se,ae,he)}function dt(m,t,o){if(!t.needsDEMTextureUpload)return;const p=m.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||m.getTileTexture(o.stride);const T=o.getPixels();t.demTexture?t.demTexture.update(T,{premultiply:!1}):t.demTexture=new i.T(p,T,x.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Bt(m,t,o){const p=m.context,x=p.gl;if(!t.dem)return;const T=t.dem;if(p.activeTexture.set(x.TEXTURE1),dt(m,t,T),!t.demTexture)return;t.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const E=T.dim;p.activeTexture.set(x.TEXTURE0);let j=t.hillshadeFBO;if(!j){const Y=new i.T(p,{width:E,height:E,data:null},x.RGBA8);Y.bind(x.LINEAR,x.CLAMP_TO_EDGE),j=t.hillshadeFBO=p.createFramebuffer(E,E,1,"renderbuffer"),j.colorAttachment0.set(Y.texture)}p.bindFramebuffer.set(j.framebuffer),p.viewport.set([0,0,E,E]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:B,tileBoundsSegments:H}=m.getMercatorTileBoundsBuffers(),K=[];m.linearFloatFilteringSupported()&&K.push("TERRAIN_DEM_FLOAT_FORMAT"),m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&K.push("USE_MRT1"),m.getOrCreateProgram("hillshadePrepare",{defines:K}).draw(m,x.TRIANGLES,ji.disabled,Ji.disabled,on.unblended,en.disabled,((Y,J)=>{const se=J.stride,ae=i.bC();return i.ce(ae,0,i.al,-i.al,0,0,1),i.br(ae,ae,[0,-i.al,0]),{u_matrix:ae,u_image:1,u_dimension:[se,se],u_zoom:Y.overscaledZ}})(t.tileID,T),o.id,O,B,H),t.needsHillshadePrepare=!1}class Lt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ri extends Lt{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class un extends Lt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Sn extends Lt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Pn extends Lt{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ca extends Lt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class gr extends Lt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Cr extends Lt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class fs extends Lt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class to extends Lt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Cf extends Lt{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Rh extends Lt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class dd extends Lt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ul extends Lt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class qd extends Lt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Sc extends Lt{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vr extends Lt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class il extends Lt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class nl extends Lt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Tc extends Lt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let sc=class extends Lt{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class hd extends Lt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class kc extends Lt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fd extends Lt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Rm extends Lt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Wd extends Lt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Uo extends Lt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Lh extends Lt{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Lm extends Lt{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Kp extends Lt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Jp extends Lt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class a_ extends Lt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ms extends Lt{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Ih extends ms{constructor(t,o,p=0){super(t,o),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+p}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachmentPoint,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class su extends ms{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zu extends ms{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Im extends su{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ho=(m,t,o,p)=>({u_matrix:m,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:o,u_emissive_texture_available:p}),Du=(m,t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:o,u_zoom_transition:x,u_merc_center:T,u_image0:0,u_image1:1,u_frustum_tl:E,u_frustum_tr:j,u_frustum_br:O,u_frustum_bl:B,u_globe_pos:H,u_globe_radius:K,u_viewport:Y,u_grid_matrix:he?Float32Array.from(he):new Float32Array(9),u_skirt_height:J,u_far_z_cutoff:se,u_emissive_texture_available:ae});function Mf(m,t){return m!=null&&t!=null&&!(!m.hasData()||!t.hasData())&&m.demTexture!=null&&t.demTexture!=null&&m.tileID.key!==t.tileID.key}const ou=new class{constructor(){this.operations={}}newMorphing(m,t,o,p,x){if(m in this.operations){const T=this.operations[m];T.to.tileID.key!==o.tileID.key&&(T.queued=o)}else this.operations[m]={startTime:p,phase:0,duration:x,from:t,to:o,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const t=this.operations[m];return{from:t.from,to:t.to,phase:t.phase}}update(m){for(const t in this.operations){const o=this.operations[t];for(o.phase=(m-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,m)){delete this.operations[t];break}}}_nextOp(m,t){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=t,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},zm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Pf(m,t,o){if(t===0)return 0;const p=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-m)*Math.max(t,1)*p}function Ou(m,t){const o=1<<m.z;return!t&&(m.x===0||m.x===o-1)||m.y===0||m.y===o-1}function md(m,t){if(!m.style||!m.style.enable3dLights())return;const o=m.context,p=o.gl;o.activeTexture.set(p.TEXTURE1),t?t.bind(p.LINEAR,p.CLAMP_TO_EDGE):m.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}const pd=m=>({u_matrix:m});function zh(m,t,o,p,x){if(x>0){const T=i.o.now(),E=(T-m.timeAdded)/x,j=t?(T-t.timeAdded)/x:-1,O=o.getSource(),B=p.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),H=!t||Math.abs(t.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),K=H&&m.refreshedUponExpiration?1:i.aA(H?E:1-j,0,1);return t?{opacity:1,mix:1-K,isFading:E<1}:{opacity:K,mix:0,isFading:E<1}}return{opacity:1,mix:0,isFading:!1}}class gd extends hs{constructor(t){const o=Sa("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",o,!1),o.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class Dm extends hs{constructor(t){const o=Sa("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,p){if(t.freezeTileCoverage)return;this.transform=t;const x=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((T,E)=>{if(T[E.key]="",!this._tiles[E.key]){const j=new Ys(E,this._source.tileSize*E.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);j.state="loaded",this._tiles[E.key]=j}return T}),{});for(const T in this._tiles)T in x||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(t){const o=this.proxyCachedFBO[t];if(o!==void 0){const p=Object.values(o);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Dh extends i.aQ{constructor(t,o,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=p}}class jf extends i.bV{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,T]=(function(O){const B=new i.bd,H=new i.b0,K=131;B.reserve(17161),H.reserve(33800);const Y=i.al/128,J=i.al+Y/2,se=J+Y;for(let he=-Y;he<se;he+=Y)for(let de=-Y;de<se;de+=Y){const _e=de<0||de>J||he<0||he>J?24575:0,we=i.aA(Math.round(de),0,i.al),ye=i.aA(Math.round(he),0,i.al);B.emplaceBack(we+_e,ye)}const ae=(he,de)=>{const _e=de*K+he;H.emplaceBack(_e+1,_e,_e+K),H.emplaceBack(_e+K,_e+K+1,_e+1)};for(let he=1;he<129;he++)for(let de=1;de<129;de++)ae(de,he);return[0,129].forEach((he=>{for(let de=0;de<130;de++)ae(de,he),ae(he,de)})),[B,H,32768]})(),E=t.context;this.gridBuffer=E.createVertexBuffer(p,i.bf.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=i.bg.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=i.bg.simpleSegment(0,0,p.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Dm(o.map),this.orthoMatrix=i.bC(),i.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const j=E.gl;this._overlapStencilMode=new Ji({func:j.GEQUAL,mask:255},0,255,j.KEEP,j.KEEP,j.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gd(o.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,o,p){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const x=t.terrain.properties,T=t.terrain.drapeRenderMode===0,E=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const j=t.terrain&&t.terrain.scope,O=x.get("source"),B=T?this._mockSourceCache:t.getSourceCache(O,j);if(!B)return void i.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=B,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(o):x.get("exaggeration"),!o.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const H=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const K=this.getScaledDemTileSize();this.sourceCache.update(o,K,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,H(),this._initializing=!0),H(),o.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const o=this._previousCameraAltitude,p=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=p;const x=o!=null?p-o:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const T=t.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(T);let j=T-this._previousZoom;const O=this._previousUpdateTimestamp;let B=T;this._evaluationZoom!=null&&(B=this._evaluationZoom,Math.abs(T-B)>.5&&(j=.5*(T-B+j)),j*x<0&&(B+=j)),this._evaluationZoom=B;const H=E.getExaggeration(B),K=H===E.getExaggeration(Math.max(0,B-.1));if(K&&Math.abs(H-this._exaggeration)<.01)return H;let Y=Math.min(.1,.00375*(this._updateTimestamp-O));return(K||H<.1||Math.abs(j)<1e-4)&&(Y=Math.min(.2,4*Y)),i.ak(this._exaggeration,H,Y)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=o.getIds().map((O=>{const B=o.getTileByID(O).tileID;return B.projMatrix=p.calculateProjMatrix(B.toUnwrapped()),B}));(function(O,B){const H=B.transform.pointCoordinate(B.transform.getCameraPoint()),K=new i.P(H.x,H.y);O.sort(((Y,J)=>{if(J.overscaledZ-Y.overscaledZ)return J.overscaledZ-Y.overscaledZ;const se=new i.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ae=new i.P(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),he=K.mult(1<<Y.canonical.z);return he.x-=.5,he.y-=.5,he.distSqr(se)-he.distSqr(ae)}))})(x,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},x.forEach((O=>{this.proxyToSource[O.key]={}})),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const O in E){const B=E[O];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,t[O],T),B.usedForTerrain))continue;const H=t[O];B.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[o.id]=x.map((O=>new Dh(O,O.key,this.orthoMatrix))),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const j={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const B=this.terrainTileForTile[O.key];if(!B)continue;const H=B.tileID.key;H in j||(this._visibleDemTiles.push(B),j[H]=H)}}_assignTerrainTiles(t){this._initializing||t.forEach((o=>{if(this.terrainTileForTile[o.key])return;const p=this._findTileCoveringTileID(o,this.sourceCache);p&&(this.terrainTileForTile[o.key]=p)}))}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],T=x.dem;!T||x.demTexture&&!x.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),dt(this.painter,x,T))}}_prepareDemTileUniforms(t,o,p,x){if(!o||o.demTexture==null)return!1;const T=t.tileID.canonical,E=Math.pow(2,o.tileID.canonical.z-T.z),j=x||"";return p[`u_dem_tl${j}`]=[T.x*E%1,T.y*E%1],p[`u_dem_scale${j}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const o=this._visibleDemTiles.reduce(((p,x)=>{if(!x.dem)return p;const T=x.dem.tree.minimums[0];return T>0&&t++,p+T}),0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new i.dL({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(x,{premultiply:!1}):T=this._emptyDEMTexture=new i.T(t,x,o.R32F,{premultiply:!1}),T}setupElevationDraw(t,o,p){const x=this.painter.context,T=x.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let j=null,O=null,B=1;if(p&&p.morphing&&this._useVertexMorphing){const J=p.morphing.srcDemTile,se=p.morphing.dstDemTile;B=p.morphing.phase,J&&se&&(this._prepareDemTileUniforms(t,J,E,"_prev")&&(O=J),this._prepareDemTileUniforms(t,se,E)&&(j=se))}const H=J=>J&&J.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let K=null;var Y;if(this.enabled?O&&j?(K=j.demTexture,x.activeTexture.set(T.TEXTURE4),O.demTexture.bind(H(O),T.CLAMP_TO_EDGE),E.u_dem_lerp=B):(j=this.terrainTileForTile[t.tileID.key],K=this._prepareDemTileUniforms(t,j,E)?j.demTexture:this.emptyDEMTexture):K=this.emptyDEMTexture,x.activeTexture.set(T.TEXTURE2),K&&(E.u_dem_size=(Y=K).size[0]===1?1:Y.size[0]-2,K.bind(H(j),T.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,o,E),p&&p.useMeterToDem&&j){const J=(1<<j.tileID.canonical.z)*i.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=J}if(p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),o.setTerrainUniformValues(x,E),this.painter.transform.projection.name==="globe"){const J=this.globeUniformValues(this.painter.transform,t.tileID.canonical,p&&p.useDenormalizedUpVectorScale);o.setGlobeUniformValues(x,J)}}globeUniformValues(t,o,p){const x=t.projection;return{u_tile_tl_up:x.upVector(o,0,0),u_tile_tr_up:x.upVector(o,i.al,0),u_tile_br_up:x.upVector(o,i.al,i.al),u_tile_bl_up:x.upVector(o,0,i.al),u_tile_up_scale:p?i.dM(1):x.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const o=this.painter,p=this.painter.context;t.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(x,T,E,j,O){if(x.transform.projection.name==="globe")(function(B,H,K,Y,J){const se=B.context,ae=se.gl;let he,de;const _e=B.transform,we=i.dE(B,se,_e),ye=(ht,mt)=>{if(de===mt)return;const kt=[zm[mt],"PROJECTION_GLOBE_VIEW"];we&&kt.push("CUSTOM_ANTIALIASING");const Ot=B.isTileAffectedByFog(ht);he=B.getOrCreateProgram("globeRaster",{defines:kt,overrideFog:Ot}),de=mt},Pe=B.colorModeForRenderPass(),Ae=new ji(ae.LEQUAL,ji.ReadWrite,B.depthRangeFor3D);ou.update(J);const Ie=i.dF(_e),je=[i.aF(_e.center.lng),i.aJ(_e.center.lat)],Ce=B.globeSharedBuffers,Ge=[_e.width*i.o.devicePixelRatio,_e.height*i.o.devicePixelRatio],it=Float32Array.from(_e.globeMatrix),Ke={useDenormalizedUpVectorScale:!0};{const ht=B.transform,mt=Pf(ht.zoom,H.exaggeration(),H.sourceCache._source.tileSize);de=-1;const kt=ae.TRIANGLES;for(const Ot of Y){const ot=K.getTile(Ot),Ye=Ji.disabled,gt=H.prevTerrainTileForTile[Ot.key],ft=H.terrainTileForTile[Ot.key];Mf(gt,ft)&&ou.newMorphing(Ot.key,gt,ft,J,250),md(B,ot.emissiveTexture),se.activeTexture.set(ae.TEXTURE0),ot.texture&&ot.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const Nt=ou.getMorphValuesForProxy(Ot.key),ai=Nt?1:0;Nt&&Object.assign(Ke,{morphing:{srcDemTile:Nt.from,dstDemTile:Nt.to,phase:i.dD(Nt.phase)}});const gi=i.dG(Ot.canonical),Yt=i.dH(gi.getCenter().lat),zt=i.dI(Ot.canonical,gi,Yt,ht.worldSize/ht._pixelsPerMercatorPixel),ki=i.bk(i.dJ(Ot.canonical)),wi=B.emissiveMode==="mrt-fallback"?1:0,di=Du(ht.expandedFarZProjMatrix,it,Ie,ki,i.aj(ht.zoom),je,ht.frustumCorners.TL,ht.frustumCorners.TR,ht.frustumCorners.BR,ht.frustumCorners.BL,ht.globeCenterInViewSpace,ht.globeRadius,Ge,mt,ht._farZ,wi,zt);if(ye(Ot,ai),he&&(H.setupElevationDraw(ot,he,Ke),B.uploadCommonUniforms(se,he,Ot.toUnwrapped()),Ce)){const[yi,$i,hn]=Ce.getGridBuffers(Yt,mt!==0);he.draw(B,kt,Ae,Ye,Pe,en.backCCW,di,"globe_raster",yi,$i,hn)}}}if(Ce&&(B.renderDefaultNorthPole||B.renderDefaultSouthPole)){const ht=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];we&&ht.push("CUSTOM_ANTIALIASING"),he=B.getOrCreateProgram("globeRaster",{defines:ht});for(const mt of Y){const{x:kt,y:Ot,z:ot}=mt.canonical,Ye=Ot===0,gt=Ot===(1<<ot)-1,[ft,Nt,ai,gi]=Ce.getPoleBuffers(ot,!1);if(gi&&(Ye||gt)){const Yt=K.getTile(mt);md(B,Yt.emissiveTexture),se.activeTexture.set(ae.TEXTURE0),Yt.texture&&Yt.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);let zt=i.dK(ot,kt,_e);const ki=i.bk(i.dJ(mt.canonical)),wi=B.emissiveMode==="mrt-fallback"?1:0,di=(yi,$i)=>yi.draw(B,ae.TRIANGLES,Ae,Ji.disabled,Pe,en.disabled,Du(_e.expandedFarZProjMatrix,zt,zt,ki,0,je,_e.frustumCorners.TL,_e.frustumCorners.TR,_e.frustumCorners.BR,_e.frustumCorners.BL,_e.globeCenterInViewSpace,_e.globeRadius,Ge,0,_e._farZ,wi),"globe_pole_raster",$i,ai,gi);H.setupElevationDraw(Yt,he,Ke),B.uploadCommonUniforms(se,he,mt.toUnwrapped()),Ye&&B.renderDefaultNorthPole&&di(he,ft),gt&&B.renderDefaultSouthPole&&(zt=i.cS(i.bC(),zt,[1,-1,1]),di(he,Nt))}}}})(x,T,E,j,O);else{const B=x.context,H=B.gl;let K,Y;const J=x.shadowRenderer,se=yl(x,x.longestCutoffRange),ae=Pe=>{if(Y===Pe)return;const Ae=[];Ae.push(zm[Pe]),se.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),J&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),J.useNormalOffset&&Ae.push("NORMAL_OFFSET")),K=x.getOrCreateProgram("terrainRaster",{defines:Ae}),Y=Pe},he=x.colorModeForRenderPass(),de=new ji(H.LEQUAL,ji.ReadWrite,x.depthRangeFor3D);ou.update(O);const _e=x.transform,we=Pf(_e.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let ye=[0,0,0];if(J){const Pe=x.style.directionalLight,Ae=x.style.ambientLight;Pe&&Ae&&(ye=zs(x.style,Pe,Ae))}{Y=-1;const Pe=H.TRIANGLES,[Ae,Ie]=[T.gridIndexBuffer,T.gridSegments];for(const je of j){const Ce=E.getTile(je),Ge=Ji.disabled,it=T.prevTerrainTileForTile[je.key],Ke=T.terrainTileForTile[je.key];Mf(it,Ke)&&ou.newMorphing(je.key,it,Ke,O,250),md(x,Ce.emissiveTexture),B.activeTexture.set(H.TEXTURE0),Ce.texture&&Ce.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const ht=ou.getMorphValuesForProxy(je.key),mt=ht?1:0;let kt;ht&&(kt={morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:i.dD(ht.phase)}});const Ot=x.emissiveMode==="mrt-fallback"?1:0,ot=ho(je.projMatrix,Ou(je.canonical,_e.renderWorldCopies)?we/10:we,ye,Ot);if(ae(mt),!K)continue;T.setupElevationDraw(Ce,K,kt);const Ye=je.toUnwrapped();J&&J.setupShadows(Ye,K),x.uploadCommonUniforms(B,K,Ye,null,se),K.draw(x,Pe,de,Ge,he,en.backCCW,ot,"terrain_raster",T.gridBuffer,Ae,Ie)}}}})(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const o=this.painter,p=this.painter.context,x=this.proxySourceCache,T=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),j=o.style.order,O=[];this._updateFBOs(o.emissiveMode==="mrt-fallback");let B=0;for(const H of T){const K=x.getTileByID(H.proxyTileKey),Y=x.proxyCachedFBO[H.key]?x.proxyCachedFBO[H.key][t]:void 0,J=Y!==void 0?x.renderCache[Y]:this.pool[B++],se=Y!==void 0;if(K.texture=J.tex,K.emissiveTexture=J.emissiveTex,se&&!J.dirty){O.push(K.tileID);continue}p.bindFramebuffer.set(J.fb.framebuffer);const ae=p.gl;let he;ae.drawBuffers(o.emissiveMode==="mrt-fallback"?[ae.COLOR_ATTACHMENT0,ae.COLOR_ATTACHMENT1]:[ae.COLOR_ATTACHMENT0]),this.renderedToTile=!1,J.dirty&&(p.clear({color:i.ao.transparent,stencil:0}),J.dirty=!1);for(let de=E.start;de<=E.end;++de){const _e=o.style._mergedLayers[j[de]];if(_e.isHidden(o.transform.zoom))continue;const we=o.style.getLayerSourceCache(_e),ye=we?this.proxyToSource[H.key][we.id]:[H];if(!ye)continue;const Pe=ye;p.viewport.set([0,0,J.fb.width,J.fb.height]),he!==(we?we.id:null)&&(this._setupStencil(J,ye,_e,we),he=we?we.id:null),o.renderLayer(o,we,_e,Pe)}if(ae.drawBuffers([ae.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const de of this._pendingGroundEffectLayers){const _e=o.style._mergedLayers[j[de]];if(_e.isHidden(o.transform.zoom))continue;const we=o.style.getLayerSourceCache(_e),ye=we?this.proxyToSource[H.key][we.id]:[H];if(!ye)continue;const Pe=ye;p.viewport.set([0,0,J.fb.width,J.fb.height]),he!==(we?we.id:null)&&(this._setupStencil(J,ye,_e,we),he=we?we.id:null),o.renderLayer(o,we,_e,Pe)}this.renderedToTile?(J.dirty=!0,O.push(K.tileID)):se||--B,B===5&&(B=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,o.width,o.height]),E.end+1}postRender(){}isLayerOrderingCorrect(t){const o=t.order.length;let p=-1,x=o;for(let T=0;T<o;++T)this._style.isLayerDraped(t._mergedLayers[t.order[T]])?p=Math.max(p,T):x=Math.min(x,T);return x>p}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((o=>o.dem)).forEach((o=>{t=Math.min(t,o.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,o,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter((T=>T.dem)).map((T=>{const E=T.tileID,j=1<<E.overscaledZ,{x:O,y:B}=E.canonical,H=O/j,K=(O+1)/j,Y=B/j,J=(B+1)/j;return{minx:H,miny:Y,maxx:K,maxy:J,t:T.dem.tree.raycastRoot(H,Y,K,J,t,o,p),tile:T}}));x.sort(((T,E)=>(T.t!==null?T.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE)));for(const T of x){if(T.t==null)return null;const E=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,t,o,p);if(E!=null)return E}return null}_createFBO(){const t=this.painter.context,o=t.gl,p=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const x=new i.T(t,{width:p[0],height:p[1],data:null},o.RGBA8);x.bind(o.LINEAR,o.CLAMP_TO_EDGE);const T=t.createFramebuffer(p[0],p[1],1,null);let E;return T.colorAttachment0.set(x.texture),this._emissiveTexture&&(E=new i.T(t,{width:p[0],height:p[1],data:null},o.R8),E.bind(o.LINEAR,o.CLAMP_TO_EDGE),T.createColorAttachment(t,1),T.colorAttachment1.set(E.texture)),T.depthAttachment=new Im(t,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:T,tex:x,emissiveTex:E,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const o of this.pool)this._updateFBO(o,t);for(const o of this.proxySourceCache.renderCache)this._updateFBO(o,t);this._emissiveTexture=t}}_updateFBO(t,o){const p=t.fb,x=this.painter.context,T=x.gl,E=this.drapeBufferSize;if(o){const j=new i.T(x,{width:E[0],height:E[1],data:null},T.R8);j.bind(T.LINEAR,T.CLAMP_TO_EDGE),t.emissiveTex=j,p.createColorAttachment(x,1),p.colorAttachment1.set(j.texture)}else t.emissiveTex=void 0,p.removeColorAttachment(x,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const o=this._style._mergedLayers[t],p=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!p&&o.shouldRedrape():!p&&o.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const p of this._style.getSources())if(p instanceof ss){t=!0;break}if(!t)return;const o={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],T=this._style.getLayerSourceCache(x);if(!T||o[T.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="line")continue;const E=x.widthExpression(),j=x.emissiveStrengthExpression();if(E instanceof i.ad||j instanceof i.ad){o[T.id]=!0;for(const O of this.proxyCoords){const B=this.proxyToSource[O.key][T.id];if(B)for(const H of B)this._clearRenderCacheForTile(T.id,H)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof tr){t=!0;break}if(!t)return;const o={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],T=this._style.getLayerSourceCache(x);if(!T||o[T.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const E=x.paint.get("raster-fade-duration");for(const j of this.proxyCoords){const O=this.proxyToSource[j.key][T.id];if(O)for(const B of O){const H=zh(T.getTile(B),T.findLoadedParent(B,0),T,this.painter.transform,E);(H.opacity!==1||H.mix!==0)&&this._clearRenderCacheForTile(T.id,B)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,o=t.length;if(o===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,T=0,E=this._style._mergedLayers[t[T]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++T<o;)E=this._style._mergedLayers[t[T]];for(;T<o;++T){const j=this._style._mergedLayers[t[T]];j.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(j)?x===void 0&&(x=T):(j.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),x!==void 0&&(p.push({start:x,end:T-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:T-1}),p.length!==0){const j=p[p.length-1];this._pendingGroundEffectLayers.every((O=>O>j.end))||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const E=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let j=0;j<E.length;++j){const O=Object.values(E[j]);o.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const j=p[E];if(o.getTileByID(j.key),o.proxyCachedFBO[j.key]!==void 0){const O=t[j.key],B=this.proxyToSource[j.key];let H=0;for(const K in B){const Y=B[K],J=O[K];if(!J||J.length!==Y.length||Y.some(((se,ae)=>se!==J[ae]||x[K]&&x[K].hasOwnProperty(se.key)))){H=-1;break}++H}for(const K in o.proxyCachedFBO[j.key])o.renderCache[o.proxyCachedFBO[j.key][K]].dirty=H<0||H!==Object.values(O).length}}const T=[...this._drapedRenderBatches];T.sort(((E,j)=>j.end-j.start-(E.end-E.start)));for(const E of T)for(const j of p){if(o.proxyCachedFBO[j.key])continue;let O=o.renderCachePool.pop();O===void 0&&o.renderCache.length<50&&(O=o.renderCache.length,o.renderCache.push(this._createFBO())),O!==void 0&&(o.proxyCachedFBO[j.key]={},o.proxyCachedFBO[j.key][E.start]=O,o.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,E=T.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let j;if(p.isTileClipped())j=o.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);j=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+j>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=j,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ji.disabled}_renderTileClippingMasks(t,o){const p=this.painter,x=this.painter.context,T=x.gl;p._tileClippingMaskIDs={},x.setColorMode(on.disabled),x.setDepthMode(ji.disabled);const E=p.getOrCreateProgram("clippingMask");for(const j of t){const O=p._tileClippingMaskIDs[j.key]=--o;E.draw(p,T.TRIANGLES,ji.disabled,new Ji({func:T.ALWAYS,mask:0},O,255,T.KEEP,T.KEEP,T.REPLACE),on.disabled,en.disabled,pd(j.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const p=[t.x,t.y,1,1];i.aC(p,p,o.pixelMatrixInverse),i.cK(p,p,1/p[3]),p[0]/=o.worldSize,p[1]/=o.worldSize;const x=o._camera.position,T=i.cf(1,o.center.lat),E=[x[0],x[1],x[2]/T,0],j=i.da([],p.slice(0,3),E);i.aw(j,j);const O=this.raycast(E,j,this._exaggeration);return O!==null&&O?(i.bH(E,E,j,O),E[3]=E[2],E[2]*=T,E):null}_setupProxiedCoordsForOrtho(t,o,p){if(t.getSource()instanceof i.aU)return this._setupProxiedCoordsForImageSource(t,o,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const x=this.proxiedCoords[t.id]=[],T=this.proxyCoords;for(let O=0;O<T.length;O++){const B=T[O],H=this._findTileCoveringTileID(B,t);if(H){const K=this._createProxiedId(B,H,p[B.key]&&p[B.key][t.id]);x.push(K),this.proxyToSource[B.key][t.id]=[K]}}let E=!1;const j=new Set;for(let O=0;O<o.length;O++){const B=t.getTile(o[O]);if(!B||!B.hasData())continue;const H=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==B.tileID.canonical.z){const K=this.proxyToSource[H.tileID.key][t.id],Y=this._createProxiedId(H.tileID,B,p[H.tileID.key]&&p[H.tileID.key][t.id]);K?K.splice(K.length-1,0,Y):this.proxyToSource[H.tileID.key][t.id]=[Y];const J=this.proxyToSource[H.tileID.key][t.id];j.has(J)||j.add(J),x.push(Y),E=!0}}if(this._sourceTilesOverlap[t.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const O of j)O.sort(((B,H)=>H.overscaledZ-B.overscaledZ))}_setupProxiedCoordsForImageSource(t,o,p){if(!t.getSource().loaded())return;const x=this.proxiedCoords[t.id]=[],T=this.proxyCoords,E=t.getSource(),j=E.tileID;if(!j)return;const O=new i.P(j.x,j.y)._div(1<<j.z),B=E.coordinates.map(i.ae.fromLngLat).reduce(((K,Y)=>(K.min.x=Math.min(K.min.x,Y.x-O.x),K.min.y=Math.min(K.min.y,Y.y-O.y),K.max.x=Math.max(K.max.x,Y.x-O.x),K.max.y=Math.max(K.max.y,Y.y-O.y),K)),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(K,Y)=>{const J=K.wrap+K.canonical.x/(1<<K.canonical.z),se=K.canonical.y/(1<<K.canonical.z),ae=i.al/(1<<K.canonical.z),he=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),de=Y.canonical.y/(1<<Y.canonical.z);return J+ae<he+B.min.x||J>he+B.max.x||se+ae<de+B.min.y||se>de+B.max.y};for(let K=0;K<T.length;K++){const Y=T[K];for(let J=0;J<o.length;J++){const se=t.getTile(o[J]);if(!se||!se.hasData()||H(Y,se.tileID))continue;const ae=this._createProxiedId(Y,se,p[Y.key]&&p[Y.key][t.id]),he=this.proxyToSource[Y.key][t.id];he?he.push(ae):this.proxyToSource[Y.key][t.id]=[ae],x.push(ae)}}}_createProxiedId(t,o,p){let x=this.orthoMatrix;if(p){const T=p.find((E=>E.key===o.tileID.key));if(T)return T}if(o.tileID.key!==t.key){const T=t.canonical.z-o.tileID.canonical.z;let E,j,O;x=i.bC();const B=o.tileID.wrap-t.wrap<<t.overscaledZ;T>0?(E=i.al>>T,j=E*((o.tileID.canonical.x<<T)-t.canonical.x+B),O=E*((o.tileID.canonical.y<<T)-t.canonical.y)):(E=i.al<<-T,j=i.al*(o.tileID.canonical.x-(t.canonical.x+B<<-T)),O=i.al*(o.tileID.canonical.y-(t.canonical.y<<-T))),i.ce(x,0,E,0,E,0,1),i.br(x,x,[j,O,0])}return new Dh(o.tileID,t.key,x)}_findTileCoveringTileID(t,o){let p=o.getTile(t);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[o.id],T=x[t.key];if(p=T?o.getTileByID(T):null,p&&p.hasData()||T===null)return p;let E=p?p.tileID:t,j=E.overscaledZ;const O=o.getSource().minzoom,B=[];if(!T){const K=o.getSource().maxzoom;if(t.canonical.z>=K){const Y=t.canonical.z-K;o.getSource().reparseOverscaled?(j=Math.max(t.canonical.z+2,o.transform.tileZoom),E=new i.aQ(j,t.wrap,K,t.canonical.x>>Y,t.canonical.y>>Y)):Y!==0&&(j=K,E=new i.aQ(j,t.wrap,K,t.canonical.x>>Y,t.canonical.y>>Y))}E.key!==t.key&&(B.push(E.key),p=o.getTile(E))}const H=K=>{B.forEach((Y=>{x[Y]=K})),B.length=0};for(j-=1;j>=O&&(!p||!p.hasData());j--){p&&H(p.tileID.key);const K=E.calculateScaledKey(j);if(p=o.getTileByID(K),p&&p.hasData())break;const Y=x[K];if(Y===null)break;Y===void 0?B.push(K):p=o.getTileByID(Y)}return H(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[o.key]=!0}}function Zd(m,t,o){const p=(function(j,O,B){const H=i.bJ(O,j),K=i.bJ(B,[.2126,.7152,.0722]),Y=(se,ae,he)=>(1-he)*se+he*ae,J=Y(1-.3*Math.min(K,1),1,Math.min(H+1,1));return Y(.92,1,Math.asin(i.aA(O[2],-1,1))/Math.PI+.5)*J})(m,[0,0,1],t),x=[0,0,0];i.c5(x,o.slice(0,3),p);const T=[0,0,0];i.c5(T,t.slice(0,3),m[2]);const E=[0,0,0];return i.d8(E,x,T),i.db(E)}const Om=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],r_=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Oh{static cacheKey(t,o,p,x){const T=[o];x&&T.push(x.cacheKey);for(const E of p)t.usedDefines.has(E)&&T.push(E);return T.join("/")}constructor(t,o,p,x,T,E){const j=t.gl;this.program=j.createProgram(),this.configuration=x,this.name=o,this.fixedDefines=[...E];const O=`#version 300 es
${(x?x.defines():[]).concat(E.map((ae=>`#define ${ae}`))).join(`
`)}`,B=[O,Lu];for(const ae of p.fragmentIncludes)B.push(bl[ae]);B.push(p.fragmentSource);const H=B.join(`
`),K=[O,Iu];for(const ae of p.vertexIncludes)K.push(bl[ae]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&p.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&K.push("uniform int u_instanceID;"),K.push(p.vertexSource);let Y=K.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(Y=Y.replaceAll("gl_InstanceID","u_instanceID"));const J=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);j.shaderSource(J,H),j.compileShader(J),j.attachShader(this.program,J);const se=j.createShader(j.VERTEX_SHADER);j.isContextLost()?this.failedToCreate=!0:(j.shaderSource(se,Y),j.compileShader(se),j.attachShader(this.program,se),this.attributes={},j.linkProgram(this.program),j.deleteShader(se),j.deleteShader(J),this.fixedUniforms=T(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=x?x.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ae=>({u_instanceID:new i.ch(ae)}))(t)),(E.includes("TERRAIN")||o.includes("symbol")||o.includes("circle"))&&(this.terrainUniforms=(ae=>({u_dem:new i.ch(ae),u_dem_prev:new i.ch(ae),u_dem_tl:new i.ck(ae),u_dem_scale:new i.cj(ae),u_dem_tl_prev:new i.ck(ae),u_dem_scale_prev:new i.cj(ae),u_dem_size:new i.cj(ae),u_dem_lerp:new i.cj(ae),u_exaggeration:new i.cj(ae),u_depth:new i.ch(ae),u_depth_size_inv:new i.ck(ae),u_depth_range_unpack:new i.ck(ae),u_occluder_half_size:new i.cj(ae),u_occlusion_depth_offset:new i.cj(ae),u_meter_to_dem:new i.cj(ae),u_label_plane_matrix_inv:new i.cl(ae)}))(t)),E.includes("GLOBE")&&(this.globeUniforms=(ae=>({u_tile_tl_up:new i.ci(ae),u_tile_tr_up:new i.ci(ae),u_tile_br_up:new i.ci(ae),u_tile_bl_up:new i.ci(ae),u_tile_up_scale:new i.cj(ae)}))(t)),E.includes("FOG")&&(this.fogUniforms=(ae=>({u_fog_matrix:new i.cl(ae),u_fog_range:new i.ck(ae),u_fog_color:new i.d3(ae),u_fog_horizon_blend:new i.cj(ae),u_fog_vertical_limit:new i.ck(ae),u_fog_temporal_offset:new i.cj(ae),u_frustum_tl:new i.ci(ae),u_frustum_tr:new i.ci(ae),u_frustum_br:new i.ci(ae),u_frustum_bl:new i.ci(ae),u_globe_pos:new i.ci(ae),u_globe_radius:new i.cj(ae),u_globe_transition:new i.cj(ae),u_is_globe:new i.ch(ae),u_viewport:new i.ck(ae)}))(t)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ae=>({u_cutoff_params:new i.d3(ae)}))(t)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ae=>({u_lighting_ambient_color:new i.ci(ae),u_lighting_directional_dir:new i.ci(ae),u_lighting_directional_color:new i.ci(ae),u_ground_radiance:new i.ci(ae)}))(t)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ae=>({u_light_matrix_0:new i.cl(ae),u_light_matrix_1:new i.cl(ae),u_fade_range:new i.ck(ae),u_shadow_normal_offset:new i.ci(ae),u_shadow_intensity:new i.cj(ae),u_shadow_texel_size:new i.cj(ae),u_shadow_map_resolution:new i.cj(ae),u_shadow_direction:new i.ci(ae),u_shadow_bias:new i.ci(ae),u_shadowmap_0:new i.ch(ae),u_shadowmap_1:new i.ch(ae)}))(t)))}getAttributeLocation(t,o){let p=this.attributes[o];return p===void 0&&(p=this.attributes[o]=t.getAttribLocation(this.program,o)),p}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in o)p[x]&&p[x].set(this.program,x,o[x])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in o)p[x]&&p[x].set(this.program,x,o[x])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in o)p[x].set(this.program,x,o[x])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in o)p[x].set(this.program,x,o[x])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in o)p[x].set(this.program,x,o[x])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;t.program.set(this.program);for(const x in o)p[x].set(this.program,x,o[x])}_drawDebugWireframe(t,o,p,x,T,E,j,O,B,H){const K=t.options.wireframe;if(K.terrain===!1&&K.layers2D===!1&&K.layers3D===!1)return;const Y=t.context;if(!(!(!K.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!K.layers2D||t._terrain&&t._terrain.renderingToTexture||!Om.includes(this.name))||!(!K.layers3D||!r_.includes(this.name))))return;const J=Y.gl,se=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,T,Y);if(!se)return;const ae=[...this.fixedDefines,"DEBUG_WIREFRAME"],he=t.getOrCreateProgram(this.name,{config:this.configuration,defines:ae});Y.program.set(he.program);const de=(ye,Pe,Ae)=>{if(Pe[ye]&&Ae[ye])for(const Ie in Pe[ye])Ae[ye][Ie]&&Ae[ye][Ie].set(Ae.program,Ie,Pe[ye][Ie].current)};B&&B.setUniforms(he.program,Y,he.binderUniforms,j,{zoom:O}),de("fixedUniforms",this,he),de("terrainUniforms",this,he),de("globeUniforms",this,he),de("fogUniforms",this,he),de("lightsUniforms",this,he),de("shadowUniforms",this,he),se.bind(),Y.setColorMode(new on([J.ONE,J.ONE_MINUS_SRC_ALPHA,J.ZERO,J.ONE],i.ao.transparent,[!0,!0,!0,!1])),Y.setDepthMode(new ji(o.func===J.LESS?J.LEQUAL:o.func,ji.ReadOnly,o.range)),Y.setStencilMode(Ji.disabled);const _e=3*E.primitiveLength*2,we=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ye=H||1;for(let Pe=0;Pe<ye;++Pe)he.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Pe),J.drawElements(J.LINES,_e,J.UNSIGNED_SHORT,we)}else H&&H>1?J.drawElementsInstanced(J.LINES,_e,J.UNSIGNED_SHORT,we,H):J.drawElements(J.LINES,_e,J.UNSIGNED_SHORT,we);T.bind(),Y.program.set(this.program),Y.setDepthMode(o),Y.setStencilMode(p),Y.setColorMode(x)}checkUniforms(t,o,p){if(this.fixedDefines.includes(o)){for(const x of Object.keys(p))if(!p[x].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${x} not set but required by ${o} being defined`)}}draw(t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he){const de=t.context,_e=de.gl;if(this.failedToCreate)return;de.program.set(this.program),de.setDepthMode(p),de.setStencilMode(x),de.setColorMode(T),de.setCullFace(E);for(const[je,Ce]of this.fixedUniformsEntries)Ce.set(this.program,je,j[je]);se&&se.setUniforms(this.program,de,this.binderUniforms,Y,{zoom:J});const we={[_e.POINTS]:1,[_e.LINES]:2,[_e.TRIANGLES]:3,[_e.LINE_STRIP]:1}[o];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const ye=ae||[],Pe=se?se.getPaintVertexBuffers():[],Ae=o===_e.TRIANGLES&&H,Ie=he&&he>0?1:void 0;for(const je of K.get()){const Ce=je.vaos||(je.vaos={});if((Ce[O]||(Ce[O]=new ie)).bind(de,this,B,Pe,H,je.vertexOffset,ye,Ie),this.forceManualRenderingForInstanceIDShaders){const Ge=he||1;for(let it=0;it<Ge;++it)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",it),H?_e.drawElements(o,je.primitiveLength*we,_e.UNSIGNED_SHORT,je.primitiveOffset*we*2):_e.drawArrays(o,je.vertexOffset,je.vertexLength)}else he&&he>1?_e.drawElementsInstanced(o,je.primitiveLength*we,_e.UNSIGNED_SHORT,je.primitiveOffset*we*2,he):H?_e.drawElements(o,je.primitiveLength*we,_e.UNSIGNED_SHORT,je.primitiveOffset*we*2):_e.drawArrays(o,je.vertexOffset,je.vertexLength);Ae&&this._drawDebugWireframe(t,p,x,T,H,je,Y,J,se,he)}}}function Qp(m,t,o=0){const p=Math.pow(2,t.tileID.overscaledZ),x=t.tileSize*Math.pow(2,m.transform.tileZoom)/p,T=x*(t.tileID.canonical.x+t.tileID.wrap*p),E=x*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(t,1,m.transform.tileZoom),u_pixel_coord_upper:[T>>16,E>>16],u_pixel_coord_lower:[65535&T,65535&E],u_pattern_transition:o}}const Rf={terrain:0,flat:1},_d=i.bC(),Nh=(m,t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he,de)=>{const _e=t.style.light,we=_e.properties.get("position"),ye=[we.x,we.y,we.z],Pe=i.dO();_e.properties.get("anchor")==="viewport"&&(i.dP(Pe,-t.transform.angle),i.dQ(ye,ye,Pe));const Ae=_e.properties.get("color").toPremultipliedRenderColor(null),Ie=t.transform,je={u_matrix:m,u_lightpos:ye,u_lightintensity:_e.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+o,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_d,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Rf[B],u_base_type:Rf[H],u_ao:x,u_edge_radius:T,u_width_scale:E,u_flood_light_color:se,u_vertical_scale:ae,u_flood_light_intensity:he,u_ground_shadow_factor:de};return Ie.projection.name==="globe"&&(je.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],je.u_zoom_transition=K,je.u_inv_rot_matrix=J,je.u_merc_center=Y,je.u_up_dir=Ie.projection.upVector(new i.cD(0,0,0),Y[0]*i.al,Y[1]*i.al),je.u_height_lift=O),je},Lf=(m,t,o,p,x,T)=>({u_matrix:m,u_edge_radius:t,u_width_scale:o,u_vertical_scale:p,u_height_type:Rf[x],u_base_type:Rf[T]}),Nu=(m,t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he,de)=>{const _e=Nh(m,t,o,p,x,T,E,j,B,H,K,Y,J,se,ae,he,1,[0,0,0]),we={u_height_factor:-Math.pow(2,j.overscaledZ)/O.tileSize/8};return Object.assign(_e,Qp(t,O,de),we)},$l=(m,t,o,p,x,T,E,j,O,B,H)=>({u_matrix:t,u_opacity:o,u_ao_pass:p?1:0,u_meter_to_tile:x,u_ao:T,u_flood_light_intensity:E,u_flood_light_color:j,u_attenuation:O,u_edge_radius:B,u_fb:0,u_fb_size:H,u_dynamic_offset:1}),Xd=(m,t,o)=>({u_matrix:m,u_emissive_strength:t,u_ground_shadow_factor:o}),If=(m,t,o,p,x,T=0)=>Object.assign(Xd(m,t,x),Qp(o,p,T)),Nm=(m,t,o,p)=>({u_matrix:m,u_world:o,u_emissive_strength:t,u_ground_shadow_factor:p}),Yd=(m,t,o,p,x,T,E=0)=>Object.assign(If(m,t,o,p,T,E),{u_world:x}),oc=(m,t)=>({u_matrix:m,u_ground_shadow_factor:t}),yd=(m,t,o,p,x)=>({u_matrix:m,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:o,u_height_scale:p,u_reset_depth:x}),zf=(m,t,o,p,x,T,E,j,O)=>({u_matrix:m,u_normal_matrix:t,u_opacity:o,u_faux_facade_ao_intensity:p,u_camera_pos:x,u_tile_to_meter:T,u_facade_emissive_chance:E,u_flood_light_color:j,u_flood_light_intensity:O}),Kd=m=>({u_matrix:m}),Ec=m=>({u_matrix:m}),Fm=(m,t,o,p,x,T,E,j)=>{const O=i.al/T.tileSize;return{u_matrix:m,u_inv_rot_matrix:t,u_camera_to_center_distance:o.getCameraToCenterDistance(j),u_extrude_scale:[o.pixelsToGLUnits[0]/O,o.pixelsToGLUnits[1]/O],u_zoom_transition:p,u_tile_id:E,u_merc_center:x}},Jd=(m,t,o=1)=>({u_matrix:m,u_color:t,u_overlay:0,u_overlay_scale:o}),Bm=i.bC(),Fu=(m,t,o,p,x,T,E)=>{const j=m.transform,O=j.projection.name==="globe",B=O?i.dR(j.zoom,t.canonical)*j._pixelsPerMercatorPixel:i.ay(o,1,T),H={u_matrix:t.projMatrix,u_extrude_scale:B,u_intensity:E,u_inv_rot_matrix:Bm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){H.u_inv_rot_matrix=p,H.u_merc_center=x,H.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],H.u_zoom_transition=i.aj(j.zoom);const K=x[0]*i.al,Y=x[1]*i.al;H.u_up_dir=j.projection.upVector(new i.cD(0,0,0),K,Y)}return H};function ja(m,[t,o,p,x],[T,E]){if(T===E)return[0,0,0,0];const j=255*(m-1)/(m*(E-T));return[t*j,o*j,p*j,x*j]}function xr(m,t,[o,p]){return o===p?0:.5/m+(t-o)*(m-1)/(m*(p-o))}const Ts=(m,t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he,de,_e,we,ye)=>({u_matrix:m,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:T,u_scale_parent:B,u_fade_t:H.mix,u_opacity:H.opacity*K.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:K.paint.get("raster-brightness-min"),u_brightness_high:K.paint.get("raster-brightness-max"),u_saturation_factor:i.dT(K.paint.get("raster-saturation")),u_contrast_factor:i.dS(K.paint.get("raster-contrast")),u_spin_weights:Df(K.paint.get("raster-hue-rotate")),u_perspective_transform:Y,u_raster_elevation:J,u_zoom_transition:E,u_merc_center:j,u_cutoff_params:O,u_colorization_mix:ja(i.dU,ae,de),u_colorization_offset:xr(i.dU,he,de),u_color_ramp:se,u_texture_offset:[we/(_e+2*we),_e/(_e+2*we)],u_texture_res:[_e+2*we,_e+2*we],u_emissive_strength:ye});function Df(m){m*=Math.PI/180;const t=Math.sin(m),o=Math.cos(m);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const al=.05,Qd=(m,t,o,p,x,T,E,j,O,B,H,K)=>({u_matrix:m,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:T,u_scale_parent:B,u_fade_t:H.mix,u_opacity:H.opacity,u_image0:0,u_image1:1,u_raster_elevation:K,u_zoom_transition:E,u_merc_center:j,u_cutoff_params:O}),Um=(m,t,o,p,x,T,E,j,O,B)=>({u_particle_texture:m,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:p,u_color_ramp:T,u_velocity_res:x,u_max_speed:E,u_uv_offset:j,u_data_scale:[255*O[0],255*O[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[al,al]}),Fh=(m,t,o,p,x,T,E,j,O,B)=>({u_particle_texture:m,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:p,u_max_speed:x,u_speed_factor:T,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:j,u_data_scale:[255*O[0],255*O[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[al,al]}),eh=i.bC(),$m=(m,t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he,de,_e,we,ye,Pe,Ae,Ie)=>{const je=x.transform,Ce={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:je.getCameraToCenterDistance(_e),u_rotate_symbol:+o,u_aspect_ratio:je.width/je.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:E,u_coord_matrix:j,u_is_text:+B,u_elevation_from_sea:O?1:0,u_pitch_with_map:+p,u_texsize:H,u_texsize_icon:K,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:eh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:eh,u_up_vector:[0,-1,0],u_color_adj_mat:Pe,u_icon_transition:Ae||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(_e)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ie||1,u_ground_shadow_factor:we,u_inv_matrix:i.bl(i.bC(),E),u_normal_scale:ye,u_lutTexture:zr.LUT};return _e.name==="globe"&&(Ce.u_tile_id=[J.canonical.x,J.canonical.y,1<<J.canonical.z],Ce.u_zoom_transition=se,Ce.u_inv_rot_matrix=he,Ce.u_merc_center=ae,Ce.u_camera_forward=je._camera.forward(),Ce.u_ecef_origin=i.dV(je.globeMatrix,J.toUnwrapped()),Ce.u_tile_matrix=Float32Array.from(je.globeMatrix),Ce.u_up_vector=de),Ce},qr=(m,t,o,p)=>({u_matrix:m,u_emissive_strength:t,u_opacity:o,u_color:p}),lu=(m,t,o,p,x,T,E,j,O)=>Object.assign((function(B,H,K,Y,J,se){const{width:ae,height:he}=Y.imageManager.getPixelSize(H),de=Math.pow(2,se.tileID.overscaledZ),_e=se.tileSize*Math.pow(2,Y.transform.tileZoom)/de,we=_e*(se.tileID.canonical.x+se.tileID.wrap*de),ye=_e*se.tileID.canonical.y;return{u_image:0,u_pattern_tl:K.tl,u_pattern_br:K.br,u_texsize:[ae,he],u_pattern_size:K.displaySize,u_pattern_units_to_pixels:J?[Y.transform.width,-1*Y.transform.height]:[1/i.ay(se,1,Y.transform.tileZoom),1/i.ay(se,1,Y.transform.tileZoom)],u_pixel_coord_upper:[we>>16,ye>>16],u_pixel_coord_lower:[65535&we,65535&ye]}})(0,T,E,p,j,O),{u_matrix:m,u_emissive_strength:t,u_opacity:o}),vd=new Float32Array(i.bA([])),xd=(m,t,o,p,x,T,E,j,O,B,H,K,Y,J=[0,0,0],se,ae,he)=>{const de=x.style.light,_e=de.properties.get("position"),we=[-_e.x,-_e.y,_e.z],ye=i.dO();de.properties.get("anchor")==="viewport"&&(i.dP(ye,-x.transform.angle),i.dQ(we,we,ye));const Pe=H.alphaMode==="MASK",Ae=de.properties.get("color").toNonPremultipliedRenderColor(null),Ie=Y.paint.get("model-ambient-occlusion-intensity"),je=Y.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return je.a=Y.paint.get("model-color-mix-intensity").constantOr(0),he&&(je.r=he[0],je.g=he[1],je.b=he[2],je.a=he[3]),ae&&(je.r=ae.color.r,je.g=ae.color.g,je.b=ae.color.b,je.a=ae.colorMix,K=ae.emissionStrength,T*=ae.opacity),{u_matrix:m,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:p||vd,u_lightpos:we,u_lightintensity:de.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_camera_pos:J,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+Pe,u_alphaCutoff:H.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:j.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:O,u_roughnessFactor:B,u_baseColorTexture:zr.BaseColor,u_metallicRoughnessTexture:zr.MetallicRoughness,u_normalTexture:zr.Normal,u_occlusionTexture:zr.Occlusion,u_emissionTexture:zr.Emission,u_lutTexture:zr.LUT,u_color_mix:je.toArray01(),u_aoIntensity:Ie,u_emissive_strength:K,u_occlusionTextureTransform:se||[0,0,0,0]}},Vm=(m,t=vd,o=vd)=>({u_matrix:m,u_instance:t,u_node_matrix:o}),Hm={fillExtrusion:m=>({u_matrix:new i.cl(m),u_lightpos:new i.ci(m),u_lightintensity:new i.cj(m),u_lightcolor:new i.ci(m),u_vertical_gradient:new i.cj(m),u_opacity:new i.cj(m),u_edge_radius:new i.cj(m),u_width_scale:new i.cj(m),u_ao:new i.ck(m),u_height_type:new i.ch(m),u_base_type:new i.ch(m),u_tile_id:new i.ci(m),u_zoom_transition:new i.cj(m),u_inv_rot_matrix:new i.cl(m),u_merc_center:new i.ck(m),u_up_dir:new i.ci(m),u_height_lift:new i.cj(m),u_flood_light_color:new i.ci(m),u_vertical_scale:new i.cj(m),u_flood_light_intensity:new i.cj(m),u_ground_shadow_factor:new i.ci(m)}),fillExtrusionDepth:m=>({u_matrix:new i.cl(m),u_edge_radius:new i.cj(m),u_width_scale:new i.cj(m),u_vertical_scale:new i.cj(m),u_height_type:new i.ch(m),u_base_type:new i.ch(m)}),fillExtrusionPattern:m=>({u_matrix:new i.cl(m),u_lightpos:new i.ci(m),u_lightintensity:new i.cj(m),u_lightcolor:new i.ci(m),u_vertical_gradient:new i.cj(m),u_height_factor:new i.cj(m),u_edge_radius:new i.cj(m),u_width_scale:new i.cj(m),u_ao:new i.ck(m),u_height_type:new i.ch(m),u_base_type:new i.ch(m),u_tile_id:new i.ci(m),u_zoom_transition:new i.cj(m),u_inv_rot_matrix:new i.cl(m),u_merc_center:new i.ck(m),u_up_dir:new i.ci(m),u_height_lift:new i.cj(m),u_image:new i.ch(m),u_texsize:new i.ck(m),u_pixel_coord_upper:new i.ck(m),u_pixel_coord_lower:new i.ck(m),u_tile_units_to_pixels:new i.cj(m),u_opacity:new i.cj(m),u_pattern_transition:new i.cj(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new i.cl(m),u_opacity:new i.cj(m),u_ao_pass:new i.cj(m),u_meter_to_tile:new i.cj(m),u_ao:new i.ck(m),u_flood_light_intensity:new i.cj(m),u_flood_light_color:new i.ci(m),u_attenuation:new i.cj(m),u_edge_radius:new i.cj(m),u_fb:new i.ch(m),u_fb_size:new i.cj(m),u_dynamic_offset:new i.cj(m)}),fill:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_ground_shadow_factor:new i.ci(m)}),fillPattern:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_image:new i.ch(m),u_texsize:new i.ck(m),u_pixel_coord_upper:new i.ck(m),u_pixel_coord_lower:new i.ck(m),u_tile_units_to_pixels:new i.cj(m),u_ground_shadow_factor:new i.ci(m),u_pattern_transition:new i.cj(m)}),fillOutline:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_world:new i.ck(m),u_ground_shadow_factor:new i.ci(m)}),fillOutlinePattern:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_world:new i.ck(m),u_image:new i.ch(m),u_texsize:new i.ck(m),u_pixel_coord_upper:new i.ck(m),u_pixel_coord_lower:new i.ck(m),u_tile_units_to_pixels:new i.cj(m),u_ground_shadow_factor:new i.ci(m),u_pattern_transition:new i.cj(m)}),building:m=>({u_matrix:new i.cl(m),u_normal_matrix:new i.cl(m),u_opacity:new i.cj(m),u_faux_facade_ao_intensity:new i.cj(m),u_camera_pos:new i.ci(m),u_tile_to_meter:new i.cj(m),u_facade_emissive_chance:new i.cj(m),u_flood_light_color:new i.ci(m),u_flood_light_intensity:new i.cj(m)}),buildingBloom:m=>({u_matrix:new i.cl(m)}),buildingDepth:m=>({u_matrix:new i.cl(m)}),elevatedStructuresDepth:m=>({u_matrix:new i.cl(m),u_depth_bias:new i.cj(m)}),elevatedStructures:m=>({u_matrix:new i.cl(m),u_ground_shadow_factor:new i.ci(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new i.cl(m),u_camera_pos:new i.ci(m),u_depth_bias:new i.cj(m),u_height_scale:new i.cj(m),u_reset_depth:new i.cj(m)}),circle:i.dY,collisionBox:m=>({u_matrix:new i.cl(m),u_inv_rot_matrix:new i.cl(m),u_camera_to_center_distance:new i.cj(m),u_extrude_scale:new i.ck(m),u_zoom_transition:new i.cj(m),u_merc_center:new i.ck(m),u_tile_id:new i.ci(m)}),collisionCircle:m=>({u_matrix:new i.cl(m),u_inv_matrix:new i.cl(m),u_camera_to_center_distance:new i.cj(m),u_viewport_size:new i.ck(m)}),debug:m=>({u_color:new i.dB(m),u_matrix:new i.cl(m),u_overlay:new i.ch(m),u_overlay_scale:new i.cj(m)}),clippingMask:m=>({u_matrix:new i.cl(m)}),heatmap:m=>({u_extrude_scale:new i.cj(m),u_intensity:new i.cj(m),u_matrix:new i.cl(m),u_inv_rot_matrix:new i.cl(m),u_merc_center:new i.ck(m),u_tile_id:new i.ci(m),u_zoom_transition:new i.cj(m),u_up_dir:new i.ci(m)}),heatmapTexture:m=>({u_image:new i.ch(m),u_color_ramp:new i.ch(m),u_opacity:new i.cj(m)}),hillshade:m=>({u_matrix:new i.cl(m),u_image:new i.ch(m),u_latrange:new i.ck(m),u_light:new i.ck(m),u_shadow:new i.dB(m),u_highlight:new i.dB(m),u_emissive_strength:new i.cj(m),u_accent:new i.dB(m)}),hillshadePrepare:m=>({u_matrix:new i.cl(m),u_image:new i.ch(m),u_dimension:new i.ck(m),u_zoom:new i.cj(m)}),line:i.dX,linePattern:i.dW,raster:m=>({u_matrix:new i.cl(m),u_normalize_matrix:new i.cl(m),u_globe_matrix:new i.cl(m),u_merc_matrix:new i.cl(m),u_grid_matrix:new i.dC(m),u_tl_parent:new i.ck(m),u_scale_parent:new i.cj(m),u_fade_t:new i.cj(m),u_opacity:new i.cj(m),u_image0:new i.ch(m),u_image1:new i.ch(m),u_brightness_low:new i.cj(m),u_brightness_high:new i.cj(m),u_saturation_factor:new i.cj(m),u_contrast_factor:new i.cj(m),u_spin_weights:new i.ci(m),u_perspective_transform:new i.ck(m),u_raster_elevation:new i.cj(m),u_zoom_transition:new i.cj(m),u_merc_center:new i.ck(m),u_cutoff_params:new i.d3(m),u_colorization_mix:new i.d3(m),u_colorization_offset:new i.cj(m),u_color_ramp:new i.ch(m),u_texture_offset:new i.ck(m),u_texture_res:new i.ck(m),u_emissive_strength:new i.cj(m)}),rasterParticle:m=>({u_matrix:new i.cl(m),u_normalize_matrix:new i.cl(m),u_globe_matrix:new i.cl(m),u_merc_matrix:new i.cl(m),u_grid_matrix:new i.dC(m),u_tl_parent:new i.ck(m),u_scale_parent:new i.cj(m),u_fade_t:new i.cj(m),u_opacity:new i.cj(m),u_image0:new i.ch(m),u_image1:new i.ch(m),u_raster_elevation:new i.cj(m),u_zoom_transition:new i.cj(m),u_merc_center:new i.ck(m),u_cutoff_params:new i.d3(m)}),rasterParticleTexture:m=>({u_texture:new i.ch(m),u_opacity:new i.cj(m)}),rasterParticleDraw:m=>({u_particle_texture:new i.ch(m),u_particle_texture_side_len:new i.cj(m),u_tile_offset:new i.ck(m),u_velocity:new i.ch(m),u_color_ramp:new i.ch(m),u_velocity_res:new i.ck(m),u_max_speed:new i.cj(m),u_uv_offset:new i.ck(m),u_data_scale:new i.ck(m),u_data_offset:new i.cj(m),u_particle_pos_scale:new i.cj(m),u_particle_pos_offset:new i.ck(m)}),rasterParticleUpdate:m=>({u_particle_texture:new i.ch(m),u_particle_texture_side_len:new i.cj(m),u_velocity:new i.ch(m),u_velocity_res:new i.ck(m),u_max_speed:new i.cj(m),u_speed_factor:new i.cj(m),u_reset_rate:new i.cj(m),u_rand_seed:new i.cj(m),u_uv_offset:new i.ck(m),u_data_scale:new i.ck(m),u_data_offset:new i.cj(m),u_particle_pos_scale:new i.cj(m),u_particle_pos_offset:new i.ck(m)}),symbol:m=>({u_is_size_zoom_constant:new i.ch(m),u_is_size_feature_constant:new i.ch(m),u_size_t:new i.cj(m),u_size:new i.cj(m),u_camera_to_center_distance:new i.cj(m),u_rotate_symbol:new i.ch(m),u_aspect_ratio:new i.cj(m),u_fade_change:new i.cj(m),u_matrix:new i.cl(m),u_label_plane_matrix:new i.cl(m),u_coord_matrix:new i.cl(m),u_is_text:new i.ch(m),u_elevation_from_sea:new i.ch(m),u_pitch_with_map:new i.ch(m),u_texsize:new i.ck(m),u_texsize_icon:new i.ck(m),u_texture:new i.ch(m),u_texture_icon:new i.ch(m),u_gamma_scale:new i.cj(m),u_device_pixel_ratio:new i.cj(m),u_tile_id:new i.ci(m),u_zoom_transition:new i.cj(m),u_inv_rot_matrix:new i.cl(m),u_merc_center:new i.ck(m),u_camera_forward:new i.ci(m),u_tile_matrix:new i.cl(m),u_up_vector:new i.ci(m),u_ecef_origin:new i.ci(m),u_is_halo:new i.ch(m),u_icon_transition:new i.cj(m),u_color_adj_mat:new i.cl(m),u_scale_factor:new i.cj(m),u_ground_shadow_factor:new i.ci(m),u_inv_matrix:new i.cl(m),u_normal_scale:new i.cj(m),u_lutTexture:new i.ch(m)}),background:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_opacity:new i.cj(m),u_color:new i.dB(m)}),backgroundPattern:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_opacity:new i.cj(m),u_image:new i.ch(m),u_pattern_tl:new i.ck(m),u_pattern_br:new i.ck(m),u_texsize:new i.ck(m),u_pattern_size:new i.ck(m),u_pixel_coord_upper:new i.ck(m),u_pixel_coord_lower:new i.ck(m),u_pattern_units_to_pixels:new i.ck(m)}),terrainRaster:m=>({u_matrix:new i.cl(m),u_image0:new i.ch(m),u_image1:new i.ch(m),u_skirt_height:new i.cj(m),u_ground_shadow_factor:new i.ci(m),u_emissive_texture_available:new i.cj(m)}),skybox:m=>({u_matrix:new i.cl(m),u_sun_direction:new i.ci(m),u_cubemap:new i.ch(m),u_opacity:new i.cj(m),u_temporal_offset:new i.cj(m)}),skyboxGradient:m=>({u_matrix:new i.cl(m),u_color_ramp:new i.ch(m),u_center_direction:new i.ci(m),u_radius:new i.cj(m),u_opacity:new i.cj(m),u_temporal_offset:new i.cj(m)}),skyboxCapture:m=>({u_matrix_3f:new i.dC(m),u_sun_direction:new i.ci(m),u_sun_intensity:new i.cj(m),u_color_tint_r:new i.d3(m),u_color_tint_m:new i.d3(m),u_luminance:new i.cj(m)}),globeRaster:m=>({u_proj_matrix:new i.cl(m),u_globe_matrix:new i.cl(m),u_normalize_matrix:new i.cl(m),u_merc_matrix:new i.cl(m),u_zoom_transition:new i.cj(m),u_merc_center:new i.ck(m),u_image0:new i.ch(m),u_image1:new i.ch(m),u_grid_matrix:new i.dC(m),u_skirt_height:new i.cj(m),u_far_z_cutoff:new i.cj(m),u_frustum_tl:new i.ci(m),u_frustum_tr:new i.ci(m),u_frustum_br:new i.ci(m),u_frustum_bl:new i.ci(m),u_globe_pos:new i.ci(m),u_globe_radius:new i.cj(m),u_viewport:new i.ck(m),u_emissive_texture_available:new i.cj(m)}),globeAtmosphere:m=>({u_frustum_tl:new i.ci(m),u_frustum_tr:new i.ci(m),u_frustum_br:new i.ci(m),u_frustum_bl:new i.ci(m),u_horizon:new i.cj(m),u_transition:new i.cj(m),u_fadeout_range:new i.cj(m),u_atmosphere_fog_color:new i.d3(m),u_high_color:new i.d3(m),u_space_color:new i.d3(m),u_temporal_offset:new i.cj(m),u_horizon_angle:new i.cj(m)}),model:m=>({u_matrix:new i.cl(m),u_lighting_matrix:new i.cl(m),u_normal_matrix:new i.cl(m),u_node_matrix:new i.cl(m),u_lightpos:new i.ci(m),u_lightintensity:new i.cj(m),u_lightcolor:new i.ci(m),u_camera_pos:new i.ci(m),u_opacity:new i.cj(m),u_baseColorFactor:new i.d3(m),u_emissiveFactor:new i.d3(m),u_metallicFactor:new i.cj(m),u_roughnessFactor:new i.cj(m),u_baseTextureIsAlpha:new i.ch(m),u_alphaMask:new i.ch(m),u_alphaCutoff:new i.cj(m),u_baseColorTexture:new i.ch(m),u_metallicRoughnessTexture:new i.ch(m),u_normalTexture:new i.ch(m),u_occlusionTexture:new i.ch(m),u_emissionTexture:new i.ch(m),u_lutTexture:new i.ch(m),u_color_mix:new i.d3(m),u_aoIntensity:new i.cj(m),u_emissive_strength:new i.cj(m),u_occlusionTextureTransform:new i.d3(m)}),modelDepth:m=>({u_matrix:new i.cl(m),u_instance:new i.cl(m),u_node_matrix:new i.cl(m)}),groundShadow:m=>({u_matrix:new i.cl(m),u_ground_shadow_factor:new i.ci(m)}),stars:m=>({u_matrix:new i.cl(m),u_up:new i.ci(m),u_right:new i.ci(m),u_intensity_multiplier:new i.cj(m)}),snowParticle:m=>({u_modelview:new i.cl(m),u_projection:new i.cl(m),u_time:new i.cj(m),u_cam_pos:new i.ci(m),u_velocityConeAperture:new i.cj(m),u_velocity:new i.cj(m),u_horizontalOscillationRadius:new i.cj(m),u_horizontalOscillationRate:new i.cj(m),u_boxSize:new i.cj(m),u_billboardSize:new i.cj(m),u_simpleShapeParameters:new i.ck(m),u_screenSize:new i.ck(m),u_thinningCenterPos:new i.ck(m),u_thinningShape:new i.ci(m),u_thinningAffectedRatio:new i.cj(m),u_thinningParticleOffset:new i.cj(m),u_particleColor:new i.d3(m),u_direction:new i.ci(m)}),rainParticle:m=>({u_modelview:new i.cl(m),u_projection:new i.cl(m),u_time:new i.cj(m),u_cam_pos:new i.ci(m),u_texScreen:new i.ch(m),u_velocityConeAperture:new i.cj(m),u_velocity:new i.cj(m),u_boxSize:new i.cj(m),u_rainDropletSize:new i.ck(m),u_distortionStrength:new i.cj(m),u_rainDirection:new i.ci(m),u_color:new i.d3(m),u_screenSize:new i.ck(m),u_thinningCenterPos:new i.ck(m),u_thinningShape:new i.ci(m),u_thinningAffectedRatio:new i.cj(m),u_thinningParticleOffset:new i.cj(m),u_shapeDirectionalPower:new i.cj(m),u_shapeNormalPower:new i.cj(m),u_mode:new i.cj(m)}),vignette:m=>({u_vignetteShape:new i.ci(m),u_vignetteColor:new i.d3(m)}),occlusion:m=>({u_matrix:new i.cl(m),u_anchorPos:new i.ci(m),u_screenSizePx:new i.ck(m),u_occluderSizePx:new i.ck(m),u_color:new i.d3(m)})};class Vl{constructor(t,o,p,x){this.id=Vl.uniqueIdxCounter,Vl.uniqueIdxCounter++,this.context=t;const T=t.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||x||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Vl.uniqueIdxCounter,Vl.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Vl.uniqueIdxCounter=0;const Of={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gm{constructor(t,o,p,x,T,E){this.length=o.length,this.attributes=p,this.itemSize=o.bytesPerElement,this.dynamicDraw=x,this.instanceCount=E,this.context=t;const j=t.gl;this.buffer=j.createBuffer(),t.bindVertexBuffer.set(this.buffer),j.bufferData(j.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||T||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let p=0;p<this.attributes.length;p++){const x=o.getAttributeLocation(t,this.attributes[p].name);x!==-1&&t.enableVertexAttribArray(x)}}setVertexAttribPointers(t,o,p){for(let x=0;x<this.attributes.length;x++){const T=this.attributes[x],E=o.getAttributeLocation(t,T.name);E!==-1&&t.vertexAttribPointer(E,T.components,t[Of[T.type]],!1,this.itemSize,T.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(t,o,p){for(let x=0;x<this.attributes.length;x++){const T=o.getAttributeLocation(t,this.attributes[x].name);T!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(T,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class rl{constructor(t,o,p,x,T){this.context=t,this.width=o,this.height=p;const E=this.framebuffer=t.gl.createFramebuffer();x>0&&(this.colorAttachment0=new Ih(t,E,0)),x>1&&(this.colorAttachment1=new Ih(t,E,1)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new su(t,E):new zu(t,E))}createColorAttachment(t,o){o===0?this.colorAttachment0=new Ih(t,this.framebuffer,0):o===1&&(this.colorAttachment1=new Ih(t,this.framebuffer,1))}removeColorAttachment(t,o){const p=this.context.gl;let x;o===0?(x=this.colorAttachment0.get(),this.colorAttachment0=void 0):o===1&&(x=this.colorAttachment1.get(),this.colorAttachment1=void 0),x&&p.deleteTexture(x)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const o=this.colorAttachment0.get();o&&t.deleteTexture(o)}if(this.colorAttachment1){const o=this.colorAttachment1.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class Wr{constructor(t,o){this.gl=t,this.clearColor=new Ri(this),this.clearDepth=new un(this),this.clearStencil=new Sn(this),this.colorMask=new Pn(this),this.depthMask=new ca(this),this.stencilMask=new gr(this),this.stencilFunc=new Cr(this),this.stencilOp=new fs(this),this.stencilTest=new to(this),this.depthRange=new Cf(this),this.depthTest=new Rh(this),this.depthFunc=new dd(this),this.blend=new Ul(this),this.blendFunc=new qd(this),this.blendColor=new Sc(this),this.blendEquation=new Vr(this),this.cullFace=new il(this),this.cullFaceSide=new nl(this),this.frontFace=new Tc(this),this.program=new sc(this),this.activeTexture=new hd(this),this.viewport=new kc(this),this.bindFramebuffer=new fd(this),this.bindRenderbuffer=new Rm(this),this.bindTexture=new Wd(this),this.bindVertexBuffer=new Uo(this),this.bindElementBuffer=new Lh(this),this.bindVertexArrayOES=new Lm(this),this.pixelStoreUnpack=new Kp(this),this.pixelStoreUnpackPremultiplyAlpha=new Jp(this),this.pixelStoreUnpackFlipY=new a_(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,p){return new Vl(this,t,o,p)}createVertexBuffer(t,o,p,x,T){return new Gm(this,t,o,p,x,T)}createRenderbuffer(t,o,p){const x=this.gl,T=x.createRenderbuffer();return this.bindRenderbuffer.set(T),x.renderbufferStorage(x.RENDERBUFFER,t,o,p),this.bindRenderbuffer.set(null),T}createFramebuffer(t,o,p,x){return new rl(this,t,o,p,x)}clear({color:t,depth:o,stencil:p,colorMask:x}){const T=this.gl;let E=0;t&&(E|=T.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),o!==void 0&&(E|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),p!==void 0&&(E|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),T.clear(E)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){i.by(t.blendFunction,on.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Bu;function vi(m,t,o,p,x,T,E){const j=m.context,O=j.gl,B=m.transform,H=[i.aF(B.center.lng),i.aJ(B.center.lat)],K=o.layout.get("symbol-placement"),Y=o.layout.get("text-variable-anchor"),J=o.layout.get("icon-rotation-alignment")==="map",se=o.layout.get("text-rotation-alignment")==="map",ae=K!=="point",he=[];let de=0,_e=0;for(let Ce=0;Ce<p.length;Ce++){const Ge=p[Ce],it=t.getTile(Ge),Ke=it.getBucket(o);if(!Ke)continue;const ht=Ke.getProjection().createInversionMatrix(B,Ge.canonical),mt=[],kt=Ks(Ge,Ke,B),Ot=!E&&J&&ae,ot=E&&se&&ae,Ye=Y&&Ke.hasTextData(),gt=Ke.hasIconTextFit()&&Ye&&Ke.hasIconData(),ft=Ot||ot||E&&Ye||gt,Nt=Ke.projection.name==="globe",ai=Nt?i.aj(B.zoom):0;Nt&&(mt.push("PROJECTION_GLOBE_VIEW"),ft&&mt.push("PROJECTED_POS_ON_VIEWPORT"));const gi=m.getOrCreateProgram("collisionBox",{defines:mt});let Yt=kt;x[0]===0&&x[1]===0||(Yt=m.translatePosMatrix(kt,it,x,T));const zt=E?Ke.textCollisionBox:Ke.iconCollisionBox,ki=Ke.collisionCircleArray;if(ki.length>0){const di=i.bC(),yi=Yt;i.cP(di,Ke.placementInvProjMatrix,B.glCoordMatrix),i.cP(di,di,Ke.placementViewportMatrix),he.push({circleArray:ki,circleOffset:_e,transform:yi,invTransform:di,projection:Ke.getProjection()}),de+=ki.length/4,_e=de}if(!zt)continue;m.terrain&&m.terrain.setupElevationDraw(it,gi);const wi=Nt?[Ge.canonical.x,Ge.canonical.y,1<<Ge.canonical.z]:[0,0,0];gi.draw(m,O.LINES,ji.disabled,Ji.disabled,m.colorModeForRenderPass(),en.disabled,Fm(Yt,ht,B,ai,H,it,wi,Ke.getProjection()),o.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,null,B.zoom,null,[zt.collisionVertexBuffer,zt.collisionVertexBufferExt])}if(!E||!he.length)return;const we=m.getOrCreateProgram("collisionCircle"),ye=new i.dZ;ye.resize(4*de),ye._trim();let Pe=0;for(const Ce of he)for(let Ge=0;Ge<Ce.circleArray.length/4;Ge++){const it=4*Ge,Ke=Ce.circleArray[it+0],ht=Ce.circleArray[it+1],mt=Ce.circleArray[it+2],kt=Ce.circleArray[it+3];ye.emplace(Pe++,Ke,ht,mt,kt,0),ye.emplace(Pe++,Ke,ht,mt,kt,1),ye.emplace(Pe++,Ke,ht,mt,kt,2),ye.emplace(Pe++,Ke,ht,mt,kt,3)}(!Bu||Bu.length<2*de)&&(Bu=(function(Ce){const Ge=2*Ce,it=new i.b0;it.resize(Ge),it._trim();for(let Ke=0;Ke<Ge;Ke++){const ht=6*Ke;it.uint16[ht+0]=4*Ke+0,it.uint16[ht+1]=4*Ke+1,it.uint16[ht+2]=4*Ke+2,it.uint16[ht+3]=4*Ke+2,it.uint16[ht+4]=4*Ke+3,it.uint16[ht+5]=4*Ke+0}return it})(de));const Ae=j.createIndexBuffer(Bu,!0),Ie=j.createVertexBuffer(ye,i.d_.members,!0);for(const Ce of he){const Ge={u_matrix:Ce.transform,u_inv_matrix:Ce.invTransform,u_camera_to_center_distance:(je=B).getCameraToCenterDistance(Ce.projection),u_viewport_size:[je.width,je.height]};we.draw(m,O.TRIANGLES,ji.disabled,Ji.disabled,m.colorModeForRenderPass(),en.disabled,Ge,o.id,Ie,Ae,i.bg.simpleSegment(0,2*Ce.circleOffset,Ce.circleArray.length,Ce.circleArray.length/2),null,B.zoom)}var je;Ie.destroy(),Ae.destroy()}const bd=i.bC();function Ac(m){const t=m._camera.getWorldToCamera(m.worldSize,1),o=i.aB([],t,m.globeMatrix);i.bl(o,o);const p=[0,0,0],x=[0,1,0,0];return i.aC(x,x,o),p[0]=x[0],p[1]=x[1],p[2]=x[2],i.aw(p,p),p}function $o({width:m,height:t,anchor:o,textOffset:p,textScale:x},T){const{horizontalAlign:E,verticalAlign:j}=i.c1(o),O=-(E-.5)*m,B=-(j-.5)*t,H=i.c2(o,p);return new i.P((O/x+H[0])*T,(B/x+H[1])*T)}function qi(m,t,o,p,x,T,E,j,O,B){const H=m.text.placedSymbolArray,K=m.text.dynamicLayoutVertexArray,Y=m.icon.dynamicLayoutVertexArray,J={},se=m.getProjection(),ae=wo(E,se,x),he=x.elevation,de=se.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;K.clear();for(let _e=0;_e<H.length;_e++){const we=H.get(_e),{tileAnchorX:ye,tileAnchorY:Pe,numGlyphs:Ae}=we,Ie=we.hidden||!we.crossTileID||m.allowVerticalPlacement&&!we.placedOrientation?null:p[we.crossTileID];if(Ie){let je=0,Ce=0,Ge=0;const it=m.elevationType==="road";if(he||it){const ft=it?m.getElevationFeatureForText(_e):null,Nt=i.bV.getAtTileOffset(E,new i.P(ye,Pe),he,ft),[ai,gi,Yt]=se.upVector(E.canonical,ye,Pe);je=Nt*ai*de,Ce=Nt*gi*de,Ge=Nt*Yt*de}let[Ke,ht,mt,kt]=Oo(we.projectedAnchorX+je,we.projectedAnchorY+Ce,we.projectedAnchorZ+Ge,o?ae:T);const Ot=ma(x.getCameraToCenterDistance(se),kt);let ot=i.bM(m.textSizeData,O,we)*Ot/i.bY;o&&(ot*=m.tilePixelRatio/j);const Ye=$o(Ie,ot);o?({x:Ke,y:ht,z:mt}=se.projectTilePoint(ye+Ye.x,Pe+Ye.y,E.canonical),[Ke,ht,mt]=Oo(Ke+je,ht+Ce,mt+Ge,T)):(t&&Ye._rotate(-x.angle),Ke+=Ye.x,ht+=Ye.y,mt=0);const gt=m.allowVerticalPlacement&&we.placedOrientation===i.bL.vertical?Math.PI/2:0;for(let ft=0;ft<Ae;ft++)i.bO(K,Ke,ht,mt,gt);B&&we.associatedIconIndex>=0&&(J[we.associatedIconIndex]={x:Ke,y:ht,z:mt,angle:gt})}else ml(Ae,K)}if(B){Y.clear();const _e=m.icon.placedSymbolArray;for(let we=0;we<_e.length;we++){const ye=_e.get(we),{numGlyphs:Pe}=ye,Ae=J[we];if(ye.hidden||!Ae)ml(Pe,Y);else{const{x:Ie,y:je,z:Ce,angle:Ge}=Ae;for(let it=0;it<Pe;it++)i.bO(Y,Ie,je,Ce,Ge)}}m.icon.dynamicLayoutVertexBuffer.updateData(Y)}m.text.dynamicLayoutVertexBuffer.updateData(K)}function th(m,t,o,p,x,T,E={}){const j=o.paint.get("icon-translate"),O=o.paint.get("text-translate"),B=o.paint.get("icon-translate-anchor"),H=o.paint.get("text-translate-anchor"),K=o.layout.get("icon-rotation-alignment"),Y=o.layout.get("text-rotation-alignment"),J=o.layout.get("icon-pitch-alignment"),se=o.layout.get("text-pitch-alignment"),ae=o.layout.get("icon-keep-upright"),he=o.layout.get("text-keep-upright"),de=o.paint.get("icon-color-saturation"),_e=o.paint.get("icon-color-contrast"),we=o.paint.get("icon-color-brightness-min"),ye=o.paint.get("icon-color-brightness-max"),Pe=o.layout.get("symbol-elevation-reference")==="sea",Ae=o.layout.get("icon-image-use-theme")==="none",Ie=m.context,je=Ie.gl,Ce=m.transform,Ge=K==="map",it=Y==="map",Ke=J==="map",ht=se==="map",mt=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let kt=!1;const Ot=m.depthModeForSublayer(0,ji.ReadOnly),ot=new ji(m.context.gl.LEQUAL,ji.ReadOnly,m.depthRangeFor3D),Ye=[i.aF(Ce.center.lng),i.aJ(Ce.center.lat)],gt=o.layout.get("text-variable-anchor"),ft=Ce.projection.name==="globe",Nt=[],ai=[0,-1,0];for(const gi of p){const Yt=t.getTile(gi),zt=Yt.getBucket(o);if(!zt||zt.projection.name==="mercator"&&ft||zt.fullyClipped)continue;const ki=zt.projection.name==="globe",wi=ki?i.aj(Ce.zoom):0,di=wo(gi,zt.getProjection(),Ce),yi=Ce.calculatePixelsToTileUnitsMatrix(Yt),$i=gt&&zt.hasTextData(),hn=zt.hasIconTextFit()&&$i&&zt.hasIconData(),In=zt.getProjection().createInversionMatrix(Ce,gi.canonical),ea=(1<<Yt.tileID.canonical.z)*i.al/m.transform.worldSize,Si=da=>{let Xn=[0,0,0];if(da){const xn=m.style.directionalLight,Ua=m.style.ambientLight;xn&&Ua&&(Xn=zs(m.style,xn,Ua))}return Xn},ta=da=>{Ce.depthOcclusionForSymbolsAndCircles&&(o.hasOcclusionOpacityProperties||m.terrain)&&(da.push("DEPTH_D24"),da.push("DEPTH_OCCLUSION"))},Zi=da=>{o.lut&&!Ae&&(o.lut.texture||(o.lut.texture=new i.d$(m.context,o.lut.image,[o.lut.image.height,o.lut.image.height,o.lut.image.height],Ie.gl.RGBA8)),Ie.activeTexture.set(Ie.gl.TEXTURE0+zr.LUT),o.lut.texture&&o.lut.texture.bind(Ie.gl.LINEAR,Ie.gl.CLAMP_TO_EDGE),da.push("APPLY_LUT_ON_GPU"))},ua=()=>{const da=Ge&&o.layout.get("symbol-placement")!=="point",Xn=[];ta(Xn),Zi(Xn);const xn=da||hn,Ua=zt.elevationType==="road",kr=m.shadowRenderer,cr=Ua&&Ke&&!!kr&&kr.enabled,Ra=Si(cr),Co=Ua&&Ke&&!m.terrain?ot:Ot,Ns=o.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&Ke&&Xn.push("PITCH_WITH_MAP_TERRAIN"),ki&&(Xn.push("PROJECTION_GLOBE_VIEW"),xn&&Xn.push("PROJECTED_POS_ON_VIEWPORT")),Ns>0&&zt.hasAnySecondaryIcon&&Xn.push("ICON_TRANSITION"),!zt.icon.zOffsetVertexBuffer||Ua&&m.terrain||Xn.push("Z_OFFSET"),de===0&&_e===0&&we===0&&ye===1||Xn.push("COLOR_ADJUSTMENT"),zt.sdfIcons&&Xn.push("RENDER_SDF"),cr&&Xn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ua&&Ke&&!m.terrain&&zt.icon.orientationVertexBuffer&&Xn.push("ELEVATED_ROADS");const Ar=zt.icon.programConfigurations.get(o.id),ks=m.getOrCreateProgram("symbol",{config:Ar,defines:Xn}),no=Yt.imageAtlasTexture?Yt.imageAtlasTexture.size:[0,0],Es=zt.iconSizeData,Cl=i.bK(Es,Ce.zoom),Xl=Ke||!Ce.isOrthographic,Vo=Rs(di,Yt.tileID.canonical,Ke,Ge,Ce,zt.getProjection(),yi),hr=Ud(di,Yt.tileID.canonical,Ke,Ge,Ce,zt.getProjection(),yi),_r=m.translatePosMatrix(hr,Yt,j,B,!0),Ca=m.translatePosMatrix(di,Yt,j,B),Pr=xn?bd:Vo,Fn=Ge&&!Ke&&!da;let nr=ai;!ft&&!Ce.mercatorFromTransition||Ge||(nr=Ac(Ce));const cc=ki?nr:ai,af=o.getColorAdjustmentMatrix(de,_e,we,ye),zc=$m(Es.kind,Cl,Fn,Ke,m,Ca,Pr,_r,Pe,!1,no,[0,0],0,gi,wi,Ye,In,cc,zt.getProjection(),Ra,ea,af,Ns,null),um=Yt.imageAtlasTexture?Yt.imageAtlasTexture:null,rf=o.layout.get("icon-size").constantOr(0)!==1||zt.iconsNeedLinear,Yl=zt.sdfIcons||m.options.rotating||m.options.zooming||rf||Xl?je.LINEAR:je.NEAREST,Ml=zt.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Pd=m.terrain&&Ke&&da?i.bl(i.bC(),Vo):bd;if(da&&zt.icon){const Dc=i.bV.getAtTileOffsetFunc(gi,Ce.center.lat,Ce.worldSize,zt.getProjection()),Oc=Ah(di,Yt.tileID.canonical,Ke,Ge,Ce,zt.getProjection(),yi),Mo=o.layout.get("icon-size-scale-range"),mo=i.aA(m.scaleFactor,Mo[0],Mo[1]);Pm(zt,di,m,!1,Oc,hr,Ke,ae,Dc,gi,mo)}return{program:ks,buffers:zt.icon,uniformValues:zc,atlasTexture:um,atlasTextureIcon:null,atlasInterpolation:Yl,atlasInterpolationIcon:null,isSDF:zt.sdfIcons,hasHalo:Ml,depthMode:Co,tile:Yt,renderWithShadows:cr,labelPlaneMatrixInv:Pd}},va=()=>{const da=it&&o.layout.get("symbol-placement")!=="point",Xn=[],xn=da||gt||hn,Ua=zt.elevationType==="road",kr=m.shadowRenderer,cr=Ua&&ht&&!!kr&&kr.enabled,Ra=Si(cr),Co=Ua&&ht&&!m.terrain?ot:Ot;m.terrainRenderModeElevated()&&ht&&Xn.push("PITCH_WITH_MAP_TERRAIN"),ki&&(Xn.push("PROJECTION_GLOBE_VIEW"),xn&&Xn.push("PROJECTED_POS_ON_VIEWPORT")),!zt.text.zOffsetVertexBuffer||Ua&&m.terrain||Xn.push("Z_OFFSET"),zt.iconsInText&&Xn.push("RENDER_TEXT_AND_SYMBOL"),Xn.push("RENDER_SDF"),cr&&Xn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ua&&ht&&!m.terrain&&zt.text.orientationVertexBuffer&&Xn.push("ELEVATED_ROADS"),ta(Xn);const Ns=zt.text.programConfigurations.get(o.id),Ar=m.getOrCreateProgram("symbol",{config:Ns,defines:Xn});let ks,no=[0,0],Es=null;const Cl=zt.textSizeData;zt.iconsInText&&(no=Yt.imageAtlasTexture?Yt.imageAtlasTexture.size:[0,0],Es=Yt.imageAtlasTexture?Yt.imageAtlasTexture:null,ks=ht||!Ce.isOrthographic||m.options.rotating||m.options.zooming||Cl.kind==="composite"||Cl.kind==="camera"?je.LINEAR:je.NEAREST);const Xl=Yt.glyphAtlasTexture?Yt.glyphAtlasTexture.size:[0,0],Vo=o.layout.get("text-size-scale-range"),hr=i.aA(m.scaleFactor,Vo[0],Vo[1]),_r=i.bK(Cl,Ce.zoom,hr),Ca=Rs(di,Yt.tileID.canonical,ht,it,Ce,zt.getProjection(),yi),Pr=Ud(di,Yt.tileID.canonical,ht,it,Ce,zt.getProjection(),yi),Fn=m.translatePosMatrix(Pr,Yt,O,H,!0),nr=m.translatePosMatrix(di,Yt,O,H),cc=xn?bd:Ca,af=it&&!ht&&!da;let zc=ai;!ft&&!Ce.mercatorFromTransition||it||(zc=Ac(Ce));const um=$m(Cl.kind,_r,af,ht,m,nr,cc,Fn,Pe,!0,Xl,no,0,gi,wi,Ye,In,ki?zc:ai,zt.getProjection(),Ra,ea,null,null,hr),rf=Yt.glyphAtlasTexture?Yt.glyphAtlasTexture:null,Yl=je.LINEAR,Ml=o.paint.get("text-halo-width").constantOr(1)!==0,Pd=m.terrain&&ht&&da?i.bl(i.bC(),Ca):bd;if(da&&zt.text){const Dc=i.bV.getAtTileOffsetFunc(gi,Ce.center.lat,Ce.worldSize,zt.getProjection()),Oc=Ah(di,Yt.tileID.canonical,ht,it,Ce,zt.getProjection(),yi);Pm(zt,di,m,!0,Oc,Pr,ht,he,Dc,gi,hr)}return{program:Ar,buffers:zt.text,uniformValues:um,atlasTexture:rf,atlasTextureIcon:Es,atlasInterpolation:Yl,atlasInterpolationIcon:ks,isSDF:!0,hasHalo:Ml,depthMode:Co,tile:Yt,renderWithShadows:cr,labelPlaneMatrixInv:Pd}},xa=zt.icon.segments.get().length,Nn=zt.text.segments.get().length,_n=xa&&!E.onlyText?ua():null,na=Nn&&!E.onlyIcons?va():null,Ga=o.paint.get("icon-opacity").constantOr(1),Ya=o.paint.get("text-opacity").constantOr(1);if(mt&&zt.canOverlap){kt=!0;const da=Ga&&!E.onlyText?zt.icon.segments.get():[],Xn=Ya&&!E.onlyIcons?zt.text.segments.get():[];for(const xn of da)Nt.push({segments:new i.bg([xn]),sortKey:xn.sortKey,state:_n});for(const xn of Xn)Nt.push({segments:new i.bg([xn]),sortKey:xn.sortKey,state:na})}else E.onlyText||Nt.push({segments:Ga?zt.icon.segments:new i.bg([]),sortKey:0,state:_n}),E.onlyIcons||Nt.push({segments:Ya?zt.text.segments:new i.bg([]),sortKey:0,state:na})}kt&&Nt.sort(((gi,Yt)=>gi.sortKey-Yt.sortKey));for(const gi of Nt){const Yt=gi.state;if(Yt)if(m.terrain?m.terrain.setupElevationDraw(Yt.tile,Yt.program,{useDepthForOcclusion:Ce.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Yt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Ce.depthOcclusionForSymbolsAndCircles,Yt.program),Ie.activeTexture.set(je.TEXTURE0),Yt.atlasTexture&&Yt.atlasTexture.bind(Yt.atlasInterpolation,je.CLAMP_TO_EDGE,!0),Yt.atlasTextureIcon&&(Ie.activeTexture.set(je.TEXTURE1),Yt.atlasTextureIcon&&Yt.atlasTextureIcon.bind(Yt.atlasInterpolationIcon,je.CLAMP_TO_EDGE,!0)),Yt.renderWithShadows&&m.shadowRenderer.setupShadows(Yt.tile.tileID.toUnwrapped(),Yt.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,Yt.program),Yt.hasHalo){const zt=Yt.uniformValues;zt.u_is_halo=1,Nf(Yt.buffers,gi.segments,o,m,Yt.program,Yt.depthMode,x,T,zt,2),zt.u_is_halo=0}else{if(Yt.isSDF){const zt=Yt.uniformValues;Yt.hasHalo&&(zt.u_is_halo=1,Nf(Yt.buffers,gi.segments,o,m,Yt.program,Yt.depthMode,x,T,zt,1)),zt.u_is_halo=0}Nf(Yt.buffers,gi.segments,o,m,Yt.program,Yt.depthMode,x,T,Yt.uniformValues,1)}}}function Nf(m,t,o,p,x,T,E,j,O,B){const H=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,T,E,j,en.disabled,O,o.id,m.layoutVertexBuffer,m.indexBuffer,t,o.paint,p.transform.zoom,m.programConfigurations.get(o.id),H,B)}function eg(m,t){const o=1<<m.canonical.z,p=(t.x*o-m.canonical.x-m.wrap*o)*i.al,x=(t.y*o-m.canonical.y)*i.al,T=i.e8(t.z,t.y);return i.d5(p,x,T)}function Ff(m,t,o,p,x){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;const T=m.context.gl,E=new ji(m.context.gl.LEQUAL,ji.ReadWrite,m.depthRangeFor3D),j=new ji(m.context.gl.GREATER,ji.ReadWrite,m.depthRangeFor3D),O=(function(J){let se=.01;return J.isOrthographic&&(se=i.ak(1e-4,se,i.d0(J.pitch>=Fo?1:J.pitch/Fo))),2*se})(m.transform),B=m.transform.getFreeCameraOptions().position,H="elevatedStructuresDepthReconstruct",K=m.getOrCreateProgram(H,{defines:["DEPTH_RECONSTRUCTION"]}),Y=m.getOrCreateProgram(H);for(const J of p){const se=t.getTile(J),ae=se.getBucket(o);if(!ae)continue;const he=ae.elevatedStructures;if(!he)continue;const de=ae.elevationBufferData.heightRange,_e=eg(J.toUnwrapped(),B),we=m.translatePosMatrix(J.projMatrix,se,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));let ye,Pe,Ae,Ie;if(x==="initialize"){if(!de||de.min>=1||he.depthSegments.segments[0].primitiveLength===0)continue;ye=yd(we,_e,O,1,0),Pe=E,Ae=he.depthSegments,Ie=K}else if(x==="reset"){if(!de||de.min>=0||he.maskSegments.segments[0].primitiveLength===0)continue;ye=yd(we,_e,0,0,1),Pe=j,Ae=he.maskSegments,Ie=K}else if(x==="geometry"){if(he.depthSegments.segments[0].primitiveLength===0)continue;ye=yd(we,_e,O,1,0),Pe=E,Ae=he.depthSegments,Ie=Y}Ie.draw(m,T.TRIANGLES,Pe,Ji.disabled,on.disabled,en.disabled,ye,o.id,he.vertexBuffer,he.indexBuffer,Ae,o.paint,m.transform.zoom)}}function Bf(m,t,o,p){const{painter:x,sourceCache:T,layer:E,coords:j,colorMode:O,elevationType:B,terrainEnabled:H,pass:K}=m,Y=x.context.gl,J=E.paint.get("fill-pattern"),se=E.paint.get("fill-pattern-cross-fade"),ae=J.constantOr(null);let he=B;B!=="road"||t&&!H||(he="none");const de=he==="road",_e=m.painter.shadowRenderer,we=de&&!!_e&&_e.enabled,ye=new ji(x.context.gl.LEQUAL,ji.ReadOnly,x.depthRangeFor3D);let Pe=[0,0,0];if(we){const Ce=x.style.directionalLight,Ge=x.style.ambientLight;Ce&&Ge&&(Pe=zs(x.style,Ce,Ge))}const Ae=J&&J.constantOr(1),Ie=x.terrain&&x.terrain.renderingToTexture,je=(Ce,Ge)=>{let it,Ke,ht,mt,kt;Ge?(it=Ae&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ht=Y.LINES):(it=Ae?"fillPattern":"fill",ht=Y.TRIANGLES);for(const Ot of j){const ot=T.getTile(Ot);if(Ae&&!ot.patternsLoaded())continue;const Ye=ot.getBucket(E);if(!Ye)continue;const gt=t?Ye.elevationBufferData:Ye.bufferData;if(gt.isEmpty())continue;x.prepareDrawTile();const ft=gt.programConfigurations.get(E.id),Nt=x.isTileAffectedByFog(Ot),ai=[],gi=[];de&&(ai.push("ELEVATED_ROADS"),gi.push(gt.elevatedLayoutVertexBuffer)),we&&ai.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ie&&o&&ai.push("USE_MRT1"),Ae&&(x.context.activeTexture.set(Y.TEXTURE0),ot.imageAtlasTexture&&ot.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),ft.updatePaintBuffers());let Yt=!1;if(ae&&ot.imageAtlas){const yi=ot.imageAtlas,$i=i.e3.from(ae),hn=$i.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),In=$i.getSecondary(),ea=yi.patternPositions.get(hn),Si=In?yi.patternPositions.get(In.scaleSelf(i.o.devicePixelRatio).toString()):null;Yt=!!ea&&!!Si,ea&&ft.setConstantPatternPositions(ea,Si)}se>0&&(Yt||ft.getPatternTransitionVertexBuffer("fill-pattern"))&&ai.push("FILL_PATTERN_TRANSITION");const zt=x.getOrCreateProgram(it,{config:ft,overrideFog:Nt,defines:ai}),ki=x.translatePosMatrix(Ot.projMatrix,ot,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor"));we&&_e.setupShadows(ot.tileID.toUnwrapped(),zt,"vector-tile");const wi=E.paint.get("fill-emissive-strength");if(Ge){mt=gt.lineIndexBuffer,kt=gt.lineSegments;const yi=x.terrain&&x.terrain.renderingToTexture?x.terrain.drapeBufferSize:[Y.drawingBufferWidth,Y.drawingBufferHeight];Ke=it==="fillOutlinePattern"&&Ae?Yd(ki,wi,x,ot,yi,Pe,se):Nm(ki,wi,yi,Pe)}else mt=gt.indexBuffer,kt=gt.triangleSegments,Ke=Ae?If(ki,wi,x,ot,Pe,se):Xd(ki,wi,Pe);x.uploadCommonUniforms(x.context,zt,Ot.toUnwrapped());let di=Ce;(B==="road"&&!H||B==="offset")&&(di=ye),zt.draw(x,ht,di,p||x.stencilModeForClipping(Ot),O,en.disabled,Ke,E.id,gt.layoutVertexBuffer,mt,kt,E.paint,x.transform.zoom,ft,gi)}};x.renderPass===K&&je(x.depthModeForSublayer(1,x.renderPass==="opaque"?ji.ReadWrite:ji.ReadOnly),!1),he==="none"&&x.renderPass==="translucent"&&E.paint.get("fill-antialias")&&je(x.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,ji.ReadOnly),!0)}function Uf(m,t,o,p,x,T,E,j){o.resetLayerRenderingStats(m);const O=m.context,B=O.gl,H=m.transform,K=o.paint.get("fill-extrusion-pattern"),Y=o.paint.get("fill-extrusion-pattern-cross-fade"),J=K.constantOr(null),se=K.constantOr(1),ae=o.paint.get("fill-extrusion-opacity"),he=m.style.enable3dLights(),de=o.paint.get(he&&!se?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_e=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),de],we=o.layout.get("fill-extrusion-edge-radius"),ye=we>0&&!o.paint.get("fill-extrusion-rounded-roof"),Pe=ye?0:we,Ae=H.projection.name==="globe"?i.eb():0,Ie=H.projection.name==="globe",je=Ie?i.aj(H.zoom):0,Ce=[i.aF(H.center.lng),i.aJ(H.center.lat)],Ge=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",it=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ge?null:o.lut).toArray01().slice(0,3),Ke=o.paint.get("fill-extrusion-flood-light-intensity"),ht=o.paint.get("fill-extrusion-vertical-scale"),mt=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,kt=o.paint.get("fill-extrusion-height-alignment"),Ot=o.paint.get("fill-extrusion-base-alignment"),ot=yl(m,o.paint.get("fill-extrusion-cutoff-fade-range")),Ye=[];let gt;Ie&&Ye.push("PROJECTION_GLOBE_VIEW"),_e[0]>0&&Ye.push("FAUX_AO"),ye&&Ye.push("ZERO_ROOF_RADIUS"),j&&Ye.push("HAS_CENTROID"),Ke>0&&Ye.push("FLOOD_LIGHT"),ot.shouldRenderCutoff&&Ye.push("RENDER_CUTOFF"),mt&&Ye.push("RENDER_WALL_MODE");const ft=m.renderPass==="shadow",Nt=m.shadowRenderer,ai=ft&&!!Nt,gi=ft?en.disabled:en.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Yt=[0,0,0];if(Nt){const wi=m.style.directionalLight,di=m.style.ambientLight;wi&&di&&(Yt=zs(m.style,wi,di)),ft||(Ye.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Nt.useNormalOffset&&Ye.push("NORMAL_OFFSET")),gt=Ye.concat(["SHADOWS_SINGLE_CASCADE"])}const zt=ai?"fillExtrusionDepth":se?"fillExtrusionPattern":"fillExtrusion",ki=o.getLayerRenderingStats();for(const wi of p){const di=t.getTile(wi),yi=di.getBucket(o);if(!yi||yi.projection.name!==H.projection.name)continue;let $i=!1;Nt&&($i=Nt.getMaxCascadeForTile(wi.toUnwrapped())===0);const hn=m.isTileAffectedByFog(wi),In=yi.programConfigurations.get(o.id);let ea=!1;if(J&&di.imageAtlas){const Nn=di.imageAtlas,_n=i.e3.from(J),na=_n.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Ga=_n.getSecondary(),Ya=Nn.patternPositions.get(na),da=Ga?Nn.patternPositions.get(Ga.scaleSelf(i.o.devicePixelRatio).toString()):null;ea=!!Ya&&!!da,Ya&&In.setConstantPatternPositions(Ya,da)}Y>0&&(ea||In.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ye.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Si=m.getOrCreateProgram(zt,{config:In,defines:$i?gt:Ye,overrideFog:hn});if(m.terrain&&m.terrain.setupElevationDraw(di,Si,{useMeterToDem:!0}),!yi.centroidVertexBuffer){const Nn=Si.getAttributeLocation(B,"a_centroid_pos");Nn!==-1&&B.vertexAttrib2f(Nn,0,0)}!ft&&Nt&&Nt.setupShadows(di.tileID.toUnwrapped(),Si,"vector-tile"),se&&(m.context.activeTexture.set(B.TEXTURE0),di.imageAtlasTexture&&di.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),In.updatePaintBuffers());const ta=o.paint.get("fill-extrusion-vertical-gradient"),Zi=1/yi.tileToMeter;let ua;if(ft&&Nt){if(uu(di.tileID,yi.maxHeight,m))continue;const Nn=Nt.calculateShadowPassMatrixFromTile(di.tileID.toUnwrapped());ua=Lf(Nn,Pe,Zi,ht,kt,Ot)}else{const Nn=m.translatePosMatrix(wi.expandedProjMatrix,di,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),_n=H.projection.createInversionMatrix(H,wi.canonical);ua=se?Nu(Nn,m,ta,ae,_e,Pe,Zi,wi,di,Ae,kt,Ot,je,Ce,_n,it,ht,Y):Nh(Nn,m,ta,ae,_e,Pe,Zi,wi,Ae,kt,Ot,je,Ce,_n,it,ht,Ke,Yt)}m.uploadCommonUniforms(O,Si,wi.toUnwrapped(),null,ot);let va=yi.segments;if(H.projection.name==="mercator"&&!ft&&(va=yi.getVisibleSegments(di.tileID,m.terrain,m.transform.getFrustum(0)),!va.get().length))continue;if(ki)if(ft)for(const Nn of va.get())ki.numRenderedVerticesInShadowPass+=Nn.primitiveLength;else for(const Nn of va.get())ki.numRenderedVerticesInTransparentPass+=Nn.primitiveLength;const xa=[];(m.terrain||j)&&xa.push(yi.centroidVertexBuffer),Ie&&xa.push(yi.layoutVertexExtBuffer),mt&&xa.push(yi.wallVertexBuffer),Si.draw(m,O.gl.TRIANGLES,x,T,E,gi,ua,o.id,yi.layoutVertexBuffer,yi.indexBuffer,va,o.paint,m.transform.zoom,In,xa)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class qm{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function cu(m,t,o,p,x,T,E,j,O,B,H,K,Y,J,se,ae,he,de,_e,we){const ye=t.context,Pe=ye.gl,Ae=t.transform,Ie=t.transform.zoom,je=[],Ce=m.translate,Ge=m.translateAnchor,it=m.edgeRadius,Ke=yl(t,m.cutoffFadeRange);H==="clear"?(je.push("CLEAR_SUBPASS"),we&&(je.push("CLEAR_FROM_TEXTURE"),ye.activeTexture.set(Pe.TEXTURE0),we.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE))):H==="sdf"?je.push("SDF_SUBPASS"):H==="emissive"&&(je.push("USE_MRT1"),ye.activeTexture.set(Pe.TEXTURE0),we.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)),de&&je.push("HAS_CENTROID"),Ke.shouldRenderCutoff&&je.push("RENDER_CUTOFF");const ht=(mt,kt,Ot,ot,Ye)=>{let gt=je;kt.groundRadiusBuffer!=null&&(gt=je.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const ft=kt.programConfigurations.get(p.id),Nt=t.isTileAffectedByFog(mt),ai=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:ft,defines:gt,overrideFog:Nt}),gi=$l(t,ot,K,B,Ye,[Y,J*Ye],se,ae,he,Ie>=17?0:it*Ye,we?we.size[0]:0),Yt=[];de&&Yt.push(kt.hiddenByLandmarkVertexBuffer),kt.groundRadiusBuffer!=null&&Yt.push(kt.groundRadiusBuffer),t.uploadCommonUniforms(ye,ai,mt.toUnwrapped(),null,Ke),ai.draw(t,ye.gl.TRIANGLES,T,E,j,O,gi,p.id,kt.vertexBuffer,kt.indexBuffer,Ot,p.paint,Ie,ft,Yt)};for(const mt of x){const kt=o.getTile(mt),Ot=kt.getBucket(p);if(!Ot||Ot.projection.name!==Ae.projection.name||!Ot.groundEffect||Ot.groundEffect&&!Ot.groundEffect.hasData())continue;const ot=Ot.groundEffect,Ye=1/Ot.tileToMeter;{const gt=t.translatePosMatrix(mt.projMatrix,kt,Ce,Ge),ft=ot.getDefaultSegment();ht(mt,ot,ft,gt,Ye)}if(_e)for(let gt=0;gt<4;gt++){const ft=i.e9[gt](mt),Nt=o.getTile(ft);if(!Nt)continue;const ai=Nt.getBucket(p);if(!ai||ai.projection.name!==Ae.projection.name||!ai.groundEffect||ai.groundEffect&&!ai.groundEffect.hasData())continue;const gi=ai.groundEffect;let Yt,zt;gt===0?(Yt=[-i.al,0,0],zt=1):gt===1?(Yt=[i.al,0,0],zt=0):gt===2?(Yt=[0,-i.al,0],zt=3):(Yt=[0,i.al,0],zt=2);const ki=gi.regionSegments[zt];if(!ki)continue;const wi=new Float32Array(16);i.br(wi,mt.projMatrix,Yt),ht(mt,gi,ki,t.translatePosMatrix(wi,kt,Ce,Ge),Ye)}}}function tg(m,t,o,p,x,T,E){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const j=T?T.findDEMTileFor(o):null;if(!(j&&j.dem||E))return;T&&j&&j.dem&&p.selfDEMTileTimestamp!==j.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=j.dem._timestamp);const O=de=>new i.P(Math.ceil((de+i.ed)*i.ee),0),B=de=>{const _e=t.getSource().minzoom,we=Pe=>{const Ae=t.getTileByID(Pe);if(Ae&&Ae.hasData())return Ae.getBucket(x)},ye=[0,-1,1];for(const Pe of ye){if(de.overscaledZ+Pe<_e)continue;const Ae=we(de.calculateScaledKey(de.overscaledZ+Pe));if(Ae)return Ae}},H=[0,0,0],K=(de,_e)=>(H[0]=Math.min(de.min.y,_e.min.y),H[1]=Math.max(de.max.y,_e.max.y),H[2]=i.al-_e.min.x>de.max.x?_e.min.x-i.al:de.max.x,H),Y=(de,_e)=>(H[0]=Math.min(de.min.x,_e.min.x),H[1]=Math.max(de.max.x,_e.max.x),H[2]=i.al-_e.min.y>de.max.y?_e.min.y-i.al:de.max.y,H),J=[(de,_e)=>K(de,_e),(de,_e)=>K(_e,de),(de,_e)=>Y(de,_e),(de,_e)=>Y(_e,de)],se=(de,_e,we,ye,Pe,Ae,Ie)=>{if(!T)return 0;const je=[[Ae?we:de,Ae?de:we,0],[Ae?we:_e,Ae?_e:we,0]],Ce=Ie<0?i.al+Ie:Ie,Ge=[Ae?Ce:(de+_e)/2,Ae?(de+_e)/2:Ce,0];return we===0&&Ie<0||we!==0&&Ie>0?T.getForTilePoints(Pe,[Ge],!0,ye):je.push(Ge),T.getForTilePoints(o,je,!0,j),Math.max(je[0][2],je[1][2],Ge[2])/T.exaggeration()};for(let de=0;de<4;de++){const _e=p.borderFeatureIndices[de];if(_e.length===0)continue;const we=i.e9[de](o),ye=B(we);if(!(ye&&ye instanceof i.ea))continue;const Pe=T?T.findDEMTileFor(we):null;if(!(Pe&&Pe.dem||E)||(T&&Pe&&Pe.dem&&p.borderDEMTileTimestamp[de]!==Pe.dem._timestamp&&(p.borderDoneWithNeighborZ[de]=-1,p.borderDEMTileTimestamp[de]=Pe.dem._timestamp),p.borderDoneWithNeighborZ[de]===ye.canonical.z))continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const Ae=(de<2?1:5)-de,Ie=ye.borderDoneWithNeighborZ[Ae]!==p.canonical.z,je=ye.borderFeatureIndices[Ae];let Ce=0;if(p.canonical.z!==ye.canonical.z){for(const Ge of _e)p.showCentroid(p.featuresOnBorder[Ge]);if(Ie)for(const Ge of je)ye.showCentroid(ye.featuresOnBorder[Ge]);p.borderDoneWithNeighborZ[de]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ae]=p.canonical.z}for(const Ge of _e){const it=p.featuresOnBorder[Ge],Ke=p.centroidData[it.centroidDataIndex],ht=it.borders[de];let mt;for(;Ce<je.length;){mt=ye.featuresOnBorder[je[Ce]];const kt=mt.borders[Ae];if(kt[1]>ht[0]+3||kt[0]>ht[0]-3)break;ye.showCentroid(mt),Ce++}if(mt&&Ce<je.length){const kt=Ce;let Ot=0;for(;!(mt.borders[Ae][0]>ht[1]-3)&&(Ot++,++Ce!==je.length);)mt=ye.featuresOnBorder[je[Ce]];mt=ye.featuresOnBorder[je[kt]];let ot=!1;if(Ot>=1){const ft=mt.borders[Ae];Math.abs(ht[0]-ft[0])<3&&Math.abs(ht[1]-ft[1])<3&&(Ot=1,ot=!0,Ce=kt+1)}else if(Ot===0){p.showCentroid(it);continue}const Ye=ye.centroidData[mt.centroidDataIndex];E&&ot&&(((ae=Ke).flags|(he=Ye).flags)&i.ec?(ae.flags|=i.ec,he.flags|=i.ec):(ae.flags&=~i.ec,he.flags&=~i.ec));const gt=it.intersectsCount()>1||mt.intersectsCount()>1;if(Ot>1)Ce=kt,Ke.centroidXY=Ye.centroidXY=new i.P(0,0);else if(Pe&&Pe.dem&&!gt){const ft=J[de](Ke,Ye),Nt=de%2?i.al-1:0,ai=se(ft[0],Math.min(i.al-1,ft[1]),Nt,Pe,we,de<2,ft[2]);Ke.centroidXY=Ye.centroidXY=O(ai)}else gt?Ke.centroidXY=Ye.centroidXY=new i.P(0,0):(Ke.centroidXY=p.encodeBorderCentroid(it),Ye.centroidXY=ye.encodeBorderCentroid(mt));p.writeCentroidToBuffer(Ke),ye.writeCentroidToBuffer(Ye)}else p.showCentroid(it)}p.borderDoneWithNeighborZ[de]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ae]=p.canonical.z}var ae,he;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(m)}const sl=[1,0,0],ig=[0,1,0],ko=[0,0,1];function uu(m,t,o){const p=o.transform,x=o.shadowRenderer;if(!x)return!0;const T=m.toUnwrapped(),E=p.tileSize*x._cascades[o.currentShadowCascade].scale;let j=t;if(p.elevation){const ae=p.elevation.getMinMaxForTile(m);ae&&(j+=ae.max)}const O=[...x.shadowDirection];O[2]=-O[2];const B=x.computeSimplifiedTileShadowVolume(T,j,E,O);if(!B)return!1;const H=[sl,ig,ko,O,[O[0],0,O[2]],[0,O[1],O[2]]],K=p.projection.name==="globe",Y=p.scaleZoom(E),J=i.cB.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,Y,!K),se=x.getCurrentCascadeFrustum();return J.intersectsPrecise(B.vertices,B.planes,H)===0||se.intersectsPrecise(B.vertices,B.planes,H)===0}function Bh(m){const{painter:t,source:o,layer:p,coords:x}=m;let T=m.defines;const E=t.context,j=t.renderPass==="shadow",O=t.renderPass==="light-beam",B=t.shadowRenderer,H=i.ef(t.transform.center.lat,t.transform.zoom),K=yl(t,p.paint.get("building-cutoff-fade-range"));K.shouldRenderCutoff&&(T=T.concat("RENDER_CUTOFF")),m.floodLightIntensity>0&&(T=T.concat("FLOOD_LIGHT"));for(const Y of x){const J=o.getTile(Y),se=J.getBucket(p);if(!se)continue;B&&B.getMaxCascadeForTile(Y.toUnwrapped())===0&&(T=T.concat("SHADOWS_SINGLE_CASCADE"));const ae=se.programConfigurations.get(p.id);let he,de,_e,we=t.translatePosMatrix(Y.expandedProjMatrix,J,[0,0],"map");if(we=i.cS(i.bC(),we,[1,1,m.verticalScale]),j&&B){if(uu(J.tileID,se.maxHeight*H,t))continue;let Pe=B.calculateShadowPassMatrixFromTile(J.tileID.toUnwrapped());Pe=i.cS(i.bC(),Pe,[1,1,m.verticalScale]),_e=Ec(Pe),he=de=t.getOrCreateProgram("buildingDepth",{config:ae,defines:T,overrideFog:!1})}else if(O)he=de=t.getOrCreateProgram("buildingBloom",{config:ae,defines:T,overrideFog:!1}),_e=Kd(we);else{const Pe=t.transform.calculatePosMatrix(Y.toUnwrapped(),t.transform.worldSize);i.cS(Pe,Pe,[1,1,m.verticalScale]);const Ae=i.bC();i.cS(Ae,Pe,[1,-1,1/H]),i.bl(Ae,Ae),i.eg(Ae,Ae);const Ie=t.transform.getFreeCameraOptions().position,je=1<<Y.canonical.z;if(_e=zf(we,Ae,m.opacity,m.facadeAOIntensity,[((Ie.x-Y.wrap)*je-Y.canonical.x)*i.al,(Ie.y*je-Y.canonical.y)*i.al,Ie.z*je*i.al],se.tileToMeter,m.facadeEmissiveChance,m.floodLightColor,m.floodLightIntensity),de=t.getOrCreateProgram("building",{config:ae,defines:T,overrideFog:!1}),m.depthOnly===!0)he=de;else{const Ce=T.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);he=t.getOrCreateProgram("building",{config:ae,defines:Ce,overrideFog:!1})}B&&(B.setupShadowsFromMatrix(Pe,de,!0),he!==de&&B.setupShadowsFromMatrix(Pe,he,!0))}const ye=(Pe,Ae)=>{if(O){const Ie=Pe.entranceBloom;Ae.draw(t,E.gl.TRIANGLES,m.depthMode,Ji.disabled,m.blendMode,en.disabled,_e,p.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segmentsBucket,p.paint,t.transform.zoom,ae,[Ie.layoutAttenuationBuffer,Ie.layoutColorBuffer])}else{const Ie=Pe.segmentsBucket;let je=[Pe.layoutNormalBuffer,Pe.layoutCentroidBuffer,Pe.layoutColorBuffer,Pe.layoutFloodLightDataBuffer];Pe.layoutFacadePaintBuffer&&(je=je.concat([Pe.layoutFacadeDataBuffer,Pe.layoutFacadeVerticalRangeBuffer,Pe.layoutFacadePaintBuffer])),Ae.draw(t,E.gl.TRIANGLES,m.depthMode,Ji.disabled,m.blendMode,j?en.disabled:en.backCW,_e,p.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Ie,p.paint,t.transform.zoom,ae,je)}};t.uploadCommonUniforms(E,de,Y.toUnwrapped(),null,K),se.buildingWithoutFacade&&ye(se.buildingWithoutFacade,de),se.buildingWithFacade&&(he!==de&&t.uploadCommonUniforms(E,he,Y.toUnwrapped(),null,K),ye(se.buildingWithFacade,he))}}function Uh(m,t,o,p,x,T,E,j,O,B,H,K,Y){const J=m.context.gl,se=m.depthModeForSublayer(1,ji.ReadOnly,J.LEQUAL,!0),ae=.1*(1-(he=H))+3*he;var he;const de=m._showOverdrawInspector,_e=K,we=new qm;de||cu(we,m,t,o,p,se,new Ji({func:J.ALWAYS,mask:255},255,255,J.KEEP,J.KEEP,J.REPLACE),new on([J.ONE,J.ONE,J.ONE,J.ONE],i.ao.transparent,[!1,!1,!1,!0],J.MIN),en.disabled,x,"sdf",T,E,j,O,B,ae,_e,!1);{const ye=de?Ji.disabled:new Ji({func:J.EQUAL,mask:255},255,255,J.KEEP,J.DECR,J.DECR),Pe=de?m.colorModeForRenderPass():new on([J.ONE_MINUS_DST_ALPHA,J.DST_ALPHA,J.ONE,J.ONE],i.ao.transparent,[!0,!0,!0,!0]);cu(we,m,t,o,p,se,ye,Pe,en.disabled,x,"color",T,E,j,O,B,ae,_e,!1)}}function $f(m){return[m[0]*i.eh,m[1]*i.eh,m[2]*i.eh,0]}function $h(m,t,o,p,x,T,E,j,O){const B=p.getSource(),H=o.globeSharedBuffers;if(!H)return;let K,Y,J;if(t&&(K=p.getTile(t)),B instanceof i.aU?(Y=B.texture,J=i.dK(0,0,o.transform)):K&&t&&(Y=K.texture,J=i.dK(t.canonical.z,t.canonical.x,o.transform)),!Y||!J)return;m||(J=i.cS(i.bC(),J,[1,-1,1]));const se=o.context,ae=se.gl,he=x.paint.get("raster-resampling")==="nearest"?ae.NEAREST:ae.LINEAR,de=o.colorModeForDrapableLayerRenderPass(T),_e=E.defines;_e.push("GLOBE_POLES");const we=new ji(ae.LEQUAL,ji.ReadWrite,o.depthRangeFor3D),ye=Float32Array.from(o.transform.expandedFarZProjMatrix),Pe=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),se.activeTexture.set(ae.TEXTURE0),Y.bind(he,ae.CLAMP_TO_EDGE),se.activeTexture.set(ae.TEXTURE1),Y.bind(he,ae.CLAMP_TO_EDGE),"useMipmap"in Y&&se.extTextureFilterAnisotropic&&o.transform.pitch>20&&ae.texParameterf(ae.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const[Ae,Ie,je,Ce]=t?H.getPoleBuffers(t.canonical.z,!1):H.getPoleBuffers(0,!0),Ge=x.paint.get("raster-elevation");let it;m?(it=Ae,o.renderDefaultNorthPole=Ge!==0):(it=Ie,o.renderDefaultSouthPole=Ge!==0);const Ke=$f(E.mix),ht=((kt,Ot,ot,Ye,gt,ft,Nt,ai,gi,Yt,zt,ki,wi)=>Ts(kt,Ot,ot,new Float32Array(16),new Float32Array(9),[0,0],Ye,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ft,[0,0],ai,2,Yt,zt,ki,1,0,wi))(ye,Pe,J,i.aj(o.transform.zoom),0,x,0,Ge,0,Ke,E.offset,E.range,T),mt=o.getOrCreateProgram("raster",{defines:_e});o.uploadCommonUniforms(se,mt,null),mt.draw(o,ae.TRIANGLES,we,O,de,j,ht,x.id,it,je,Ce)}function ng(m){const t=m._nearZ,o=m.projection.farthestPixelDistance(m),p=o-t,x=.2*m.height,T=t+x;return[t,o,(T-x-t)/p,(T-t)/p]}function du(m,t,o,p){if(m)return t instanceof Qr&&m instanceof rr?t.getTextureDescriptor(m,o,!0):{texture:m.texture,mix:$f(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Fa=i.ei([{name:"a_index",type:"Int16",components:1}]);class Wm{constructor(t,o,p,x){const T={width:p[0],height:p[1],data:null},E=t.gl;this.targetColorTexture=new i.T(t,T,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(t,T,E.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,x),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=o.width*o.height;this.particleTexture0=new i.T(this.context,o,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,o,p.RGBA8,{premultiply:!1,useMipmap:!1});const T=new i.ej;T.reserve(x);for(let E=0;E<x;E++)T.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(T,Fa.members,!0),this.particleSegment=i.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Zm(m,t,o){if(!m)return null;const p=t.getTextureDescriptor(m,o,!0);if(!p)return null;let{texture:x,mix:T,offset:E,tileSize:j,buffer:O,format:B}=p;if(!x||!B)return null;let H=!1;return B==="uint32"&&(H=!0,T[3]=0,T=ja(i.ek,T,[0,o.paint.get("raster-particle-max-speed")]),E=xr(i.ek,E,[0,o.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[O/(j+2*O),j/(j+2*O)],tileSize:j,scalarData:H,scale:T,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[B]]}}function ih(m){const t=m._nearZ,o=m.projection.farthestPixelDistance(m),p=o-t,x=.2*m.height,T=t+x;return[t,o,(T-x-t)/p,(T-t)/p]}const Vf=new i.ao(1,0,0,1),ag=new i.ao(0,1,0,1),Hf=new i.ao(0,0,1,1),Cc=new i.ao(1,0,1,1),wd=new i.ao(0,1,1,1);function ei(m,t,o,p,x,T){for(let E=0;E<o.length;E++)if(x){const B=new i.ao(p.r*.8,p.g*.8,p.b*.8,1);li(m,t,o[E],p,-1,-1,T),li(m,t,o[E],p,-1,1,T),li(m,t,o[E],p,1,1,T),li(m,t,o[E],p,1,-1,T),li(m,t,o[E],B,0,0,T)}else li(m,t,o[E],p,0,0,T)}function li(m,t,o,p,x,T,E){const j=m.context,O=m.transform,B=j.gl,H=O.projection.name==="globe",K=H?["PROJECTION_GLOBE_VIEW"]:[];let Y=i.bz(o.projMatrix);if(H&&i.aj(O.zoom)>0){const Ke=i.bj(o.canonical,O),ht=i.el(Ke);Y=i.aB(new Float32Array(16),O.globeMatrix,ht),i.aB(Y,O.projMatrix,Y)}const J=i.bC();J[12]+=2*x/(i.o.devicePixelRatio*O.width),J[13]+=2*T/(i.o.devicePixelRatio*O.height),i.aB(Y,J,Y);const se=m.getOrCreateProgram("debug",{defines:K}),ae=t.getTileByID(o.key);m.terrain&&m.terrain.setupElevationDraw(ae,se);const he=ji.disabled,de=Ji.disabled,_e=m.colorModeForRenderPass(),we="$debug";j.activeTexture.set(B.TEXTURE0),m.emptyTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),H?ae._makeGlobeTileDebugBuffers(m.context,O):ae._makeDebugTileBoundsBuffers(m.context,O.projection);const ye=ae._tileDebugBuffer||m.debugBuffer,Pe=ae._tileDebugIndexBuffer||m.debugIndexBuffer,Ae=ae._tileDebugSegments||m.debugSegments;if(se.draw(m,B.LINE_STRIP,he,de,_e,en.disabled,Jd(Y,p.toPremultipliedRenderColor(null)),we,ye,Pe,Ae,null,null,null,[ae._globeTileDebugBorderBuffer]),E){const Ke=ae.latestRawTileData,ht=Math.floor((Ke&&Ke.byteLength||0)/1024);let mt=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(mt+=` => ${o.overscaledZ}`),mt+=` ${ae.state}`,mt+=` ${ht}kb`,(function(kt,Ot){kt.initDebugOverlayCanvas();const ot=kt.debugOverlayCanvas,Ye=kt.context.gl,gt=kt.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,ot.width,ot.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(Ot,5,5),gt.strokeText(Ot,5,5),kt.debugOverlayTexture.update(ot),kt.debugOverlayTexture.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE)})(m,mt)}const Ie=t.getTile(o).tileSize,je=512/Math.min(Ie,512)*(o.overscaledZ/O.zoom)*.5,Ce=ae._tileDebugTextBuffer||m.debugBuffer,Ge=ae._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,it=ae._tileDebugTextSegments||m.debugSegments;se.draw(m,B.TRIANGLES,he,de,on.alphaBlended,en.disabled,Jd(Y,i.ao.transparent.toPremultipliedRenderColor(null),je),we,Ce,Ge,it,null,null,null,[ae._globeTileDebugTextBuffer])}function Sd(m,t,o,p){rt(m,0,t+o/2,m.transform.width,o,p)}function dr(m,t,o,p){rt(m,t-o/2,0,o,m.transform.height,p)}function rt(m,t,o,p,x,T){const E=m.context,j=E.gl;j.enable(j.SCISSOR_TEST),j.scissor(t*i.o.devicePixelRatio,o*i.o.devicePixelRatio,p*i.o.devicePixelRatio,x*i.o.devicePixelRatio),E.clear({color:T}),j.disable(j.SCISSOR_TEST)}const Xm=i.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Gf}=Xm;function Mc(m,t,o,p){m.emplaceBack(t,o,p)}class Vh{constructor(t){this.vertexArray=new i.em,this.indices=new i.b0,Mc(this.vertexArray,-1,-1,1),Mc(this.vertexArray,1,-1,1),Mc(this.vertexArray,-1,1,1),Mc(this.vertexArray,1,1,1),Mc(this.vertexArray,-1,-1,-1),Mc(this.vertexArray,1,-1,-1),Mc(this.vertexArray,-1,1,-1),Mc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Gf),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=i.bg.simpleSegment(0,0,36,12)}}function Td(m,t,o,p,x,T){const E=m.context.gl,j=t.paint.get("sky-atmosphere-color"),O=t.paint.get("sky-atmosphere-halo-color"),B=t.paint.get("sky-atmosphere-sun-intensity"),H=((K,Y,J,se,ae)=>({u_matrix_3f:K,u_sun_direction:Y,u_sun_intensity:J,u_color_tint_r:[se.r,se.g,se.b,se.a],u_color_tint_m:[ae.r,ae.g,ae.b,ae.a],u_luminance:5e-5}))(i.eo(i.dO(),p),x,B,j.toPremultipliedRenderColor(null),O.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+T,t.skyboxTexture,0),o.draw(m,E.TRIANGLES,ji.disabled,Ji.disabled,on.unblended,en.frontCW,H,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const rg=i.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Hh{constructor(t){const o=new i.ep;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const p=new i.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,rg.members),this.indexBuffer=t.createIndexBuffer(p),this.segments=i.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const sg=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class s_{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class og{constructor(t){this.colorModeAlphaBlendedWriteRGB=new on([1,gl,1,gl],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new on([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new s_,this.updateNeeded=!0}update(t){const o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Hh(o);const p=this.params.sizeRange,x=this.params.intensityRange,T=(function(H){const K=i.eq(30),Y=[];for(let J=0;J<H;++J){const se=2*Math.PI*K(),ae=Math.acos(1-2*K())-.5*Math.PI;Y.push(i.d5(Math.cos(ae)*Math.cos(se),Math.cos(ae)*Math.sin(se),Math.sin(ae)))}return Y})(this.params.starsCount),E=i.eq(300),j=new i.er,O=new i.b0;let B=0;for(let H=0;H<T.length;++H){const K=i.c5([],T[H],200),Y=Math.max(0,1+.01*p*(1*E()-.5)),J=Math.max(0,1+.01*x*(1*E()-.5));j.emplaceBack(K[0],K[1],K[2],-1,-1,Y,J),j.emplaceBack(K[0],K[1],K[2],1,-1,Y,J),j.emplaceBack(K[0],K[1],K[2],1,1,Y,J),j.emplaceBack(K[0],K[1],K[2],-1,1,Y,J),O.emplaceBack(B+0,B+1,B+2),O.emplaceBack(B+0,B+2,B+3),B+=4}this.starsVx=o.createVertexBuffer(j,sg.members),this.starsIdx=o.createIndexBuffer(O),this.starsSegments=i.bg.simpleSegment(0,0,j.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){const p=t.context,x=p.gl,T=t.transform,E=new ji(x.LEQUAL,ji.ReadOnly,[0,1]),j=i.aj(T.zoom),O=t.style.getLut(o.scope),B=o.properties.get("color-use-theme")==="none",H=o.properties.get("color").toNonPremultipliedRenderColor(B?null:O),K=o.properties.get("high-color-use-theme")==="none",Y=o.properties.get("high-color").toNonPremultipliedRenderColor(K?null:O),J=o.properties.get("space-color-use-theme")==="none",se=o.properties.get("space-color").toNonPremultipliedRenderColor(J?null:O),ae=5e-4,he=i.es(o.properties.get("horizon-blend"),0,1,ae,.25),de=i.dE(t,p,T)&&he===ae?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,_e=t.frameCounter/1e3%1,we=i.ag(T.globeCenterInViewSpace),ye=Math.sqrt(Math.pow(we,2)-Math.pow(de,2)),Pe=Math.acos(ye/we),Ae=Ie=>{const je=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ie&&je.push("ALPHA_PASS");const Ce=t.getOrCreateProgram("globeAtmosphere",{defines:je}),Ge=((Ke,ht,mt,kt,Ot,ot,Ye,gt,ft,Nt,ai,gi)=>({u_frustum_tl:Ke,u_frustum_tr:ht,u_frustum_br:mt,u_frustum_bl:kt,u_horizon:Ot,u_transition:ot,u_fadeout_range:Ye,u_atmosphere_fog_color:gt.toArray01(),u_high_color:ft.toArray01(),u_space_color:Nt.toArray01(),u_temporal_offset:ai,u_horizon_angle:gi}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,j,he,H,Y,se,_e,Pe);t.uploadCommonUniforms(p,Ce);const it=this.atmosphereBuffer;it&&Ce.draw(t,x.TRIANGLES,E,Ji.disabled,Ie?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,en.backCW,Ge,Ie?"atmosphere_glow_alpha":"atmosphere_glow",it.vertexBuffer,it.indexBuffer,it.segments)};Ae(!1),Ae(!0)}drawStars(t,o){const p=i.aA(o.properties.get("star-intensity"),0,1);if(p===0)return;const x=t.context,T=x.gl,E=t.transform,j=t.getOrCreateProgram("stars"),O=i.c7([]);i.c9(O,O,-E._pitch),i.c8(O,O,-E.angle),i.c9(O,O,i.an(E._center.lat)),i.et(O,O,-i.an(E._center.lng));const B=i.cc(new Float32Array(16),O),H=i.aB([],E.starsProjMatrix,B),K=i.eo([],B),Y=i.eu([],K),J=[0,1,0];i.dQ(J,J,Y),i.c5(J,J,this.params.sizeMultiplier);const se=[1,0,0];i.dQ(se,se,Y),i.c5(se,se,this.params.sizeMultiplier);const ae=(he=J,de=se,_e=p,{u_matrix:Float32Array.from(H),u_up:he,u_right:de,u_intensity_multiplier:_e});var he,de,_e;t.uploadCommonUniforms(x,j),this.starsVx&&this.starsIdx&&j.draw(t,T.TRIANGLES,ji.disabled,Ji.disabled,this.colorModeAlphaBlendedWriteRGB,en.disabled,ae,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Gh{constructor(){this.visibleTiles=[]}updateBorders(t,o){const p=[],x=[],T=t._getRenderableCoordinates(!1,!0);for(const O of T){const B=t.getTile(O);if(!B.hasData())continue;const H=B.getBucket(o);H&&(H.isEmpty()||(p.push(O.key),x.push({bucket:H,tileID:O.canonical})))}let E=p.length!==this.visibleTiles.length;if(!E){p.sort();for(let O=0;O<p.length;O++)if(p[O]!==this.visibleTiles[O]){E=!0;break}}if(!E)return;const j=new Set;this.visibleTiles=p,x.sort(((O,B)=>O.tileID.z-B.tileID.z||O.tileID.x-B.tileID.x||O.tileID.y-B.tileID.y));for(const O of x){const B=new Array,H=new Array,K=O.bucket;for(const Y of K.featuresOnBorder)j.has(Y.featureId)?H.push(Y.footprintIndex):(j.add(Y.featureId),B.push(Y.footprintIndex));K.updateFootprintHiddenFlags(B,i.ev,!1),K.updateFootprintHiddenFlags(H,i.ev,!0)}}}function qf(m,t){const o=[...m],p=t.cameraWorldSizeForFog/t.worldSize,x=i.bA([]);return i.cS(x,x,[p,p,1]),i.aB(o,x,o),i.aB(o,t.worldToFogMatrix,o),o}function Wf(m,t,o,p,x){const T=o.material,E=p.context,{baseColorTexture:j,metallicRoughnessTexture:O}=T.pbrMetallicRoughness,{normalTexture:B,occlusionTexture:H,emissionTexture:K}=T;function Y(se,ae,he){if(se&&(m.push(ae),E.activeTexture.set(E.gl.TEXTURE0+he),se.gfxTexture)){const{minFilter:de,magFilter:_e,wrapS:we,wrapT:ye}=se.sampler;se.gfxTexture.bindExtraParam(de,_e,we,ye)}}Y(j,"HAS_TEXTURE_u_baseColorTexture",zr.BaseColor),Y(O,"HAS_TEXTURE_u_metallicRoughnessTexture",zr.MetallicRoughness),Y(B,"HAS_TEXTURE_u_normalTexture",zr.Normal),Y(H,"HAS_TEXTURE_u_occlusionTexture",zr.Occlusion),Y(K,"HAS_TEXTURE_u_emissionTexture",zr.Emission),x&&(x.texture||(x.texture=new i.d$(p.context,x.image,[x.image.height,x.image.height,x.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+zr.LUT),x.texture&&x.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(m.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||m.push("DIFFUSE_SHADED");const J=p.shadowRenderer;J&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),J.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Ym(m,t,o,p,x,T){const E=m.modelOpacity,j=t.context,O=new ji(t.context.gl.LEQUAL,m.isLightMesh?ji.ReadOnly:ji.ReadWrite,t.depthRangeFor3D),B=t.transform,H=m.mesh,K=H.material,Y=K.pbrMetallicRoughness,J=t.style.fog;let se;se=t.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:i.aB([],p.zScaleMatrix,m.nodeModelMatrix),i.aB(se,p.negCameraPosMatrix,se);const ae=i.bl([],se);i.eg(ae,ae);const he=o.paint.get("model-color-use-theme").constantOr("default")==="none",de=o.paint.get("model-emissive-strength").constantOr(0),_e=xd(new Float32Array(m.worldViewProjection),new Float32Array(se),new Float32Array(ae),null,t,E,Y.baseColorFactor,K.emissiveFactor,Y.metallicFactor,Y.roughnessFactor,K,de,o,void 0,void 0,m.materialOverride,m.modelColor),we={defines:[]},ye=[],Pe=t.shadowRenderer;Pe&&(Pe.useNormalOffset=!1),Wf(we.defines,ye,H,t,he?null:o.lut);let Ae=null;if(J){const Ce=qf(m.nodeModelMatrix,t.transform);if(Ae=new Float32Array(Ce),B.projection.name!=="globe"){const Ge=H.aabb.min,it=H.aabb.max,[Ke,ht]=J.getOpacityForBounds(Ce,Ge[0],Ge[1],it[0],it[1]);we.overrideFog=Ke>=Tt||ht>=Tt}}const Ie=yl(t,o.paint.get("model-cutoff-fade-range"));Ie.shouldRenderCutoff&&we.defines.push("RENDER_CUTOFF");const je=t.getOrCreateProgram("model",we);t.uploadCommonUniforms(j,je,null,Ae,Ie),t.renderPass!=="shadow"&&Pe&&Pe.setupShadowsFromMatrix(m.nodeModelMatrix,je),je.draw(t,j.gl.TRIANGLES,O,x,T,H.material.doubleSided?en.disabled:en.backCCW,_e,o.id,H.vertexBuffer,H.indexBuffer,H.segments,o.paint,t.transform.zoom,void 0,ye)}function Zf(m,t){return m.style._importedAsBasemap?"basemap":t.scope}function kd(m,t,o,p,x,T,E,j,O,B){const H=m.transform,K=!!t.isGeometryBloom&&t.isGeometryBloom;if(K&&m.renderPass==="shadow")return;const Y=H.projection.name==="globe"?i.eD(o,H):[...o];i.aB(Y,Y,t.globalMatrix);const J=i.aB([],p,Y);if(t.meshes)for(const se of t.meshes){const ae=j.get(se.material.name);if(ae&&ae.opacity<=0)continue;if(se.material.alphaMode!=="BLEND"){E.push({mesh:se,depth:0,modelIndex:x,worldViewProjection:J,nodeModelMatrix:Y,isLightMesh:K,materialOverride:ae,modelOpacity:O,modelColor:B});continue}const he=i.af([],se.centroid,J);!H.isOrthographic&&he[2]<=0||T.push({mesh:se,depth:he[2],modelIndex:x,worldViewProjection:J,nodeModelMatrix:Y,isLightMesh:K,materialOverride:ae,modelOpacity:O,modelColor:B})}if(t.children)for(const se of t.children)kd(m,se,o,p,x,T,E,j,O,B)}function ol(m,t,o,p){const x=o.shadowRenderer;if(!x)return;const T=x.getShadowPassDepthMode(),E=x.getShadowPassColorMode(),j=x.calculateShadowPassMatrixFromMatrix(t),O=Vm(j);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,T,Ji.disabled,E,en.disabled,O,p.id,m.vertexBuffer,m.indexBuffer,m.segments,p.paint,o.transform.zoom,void 0,void 0)}function Km(m,t,o,p,x,T){for(const E of x){const j=Object.assign({},p);j.part=E;const O={type:"Unknown",id:t,properties:j},B={orientation:m.paint.get("model-rotation").evaluate(O,o)};T.set(E,B)}}function Xf(m,t,o,p,x,T){for(const E of x){const j=Object.assign({},p);j.part=E;const O={type:"Unknown",id:t,properties:j},B={color:m.paint.get("model-color").evaluate(O,o),colorMix:m.paint.get("model-color-mix-intensity").evaluate(O,o),opacity:m.paint.get("model-opacity").evaluate(O,o),emissionStrength:m.paint.get("model-emissive-strength").evaluate(O,o)};T.set(E,B)}}function lg(m,t,o,p,x){let T=!1;for(const j of p)j.modelOpacity!==1&&(Ym(j,m,t,x[j.modelIndex],Ji.disabled,on.disabled),T=!0);for(const j of p)Ym(j,m,t,x[j.modelIndex],j.modelOpacity!==1?m.stencilModeFor3D():Ji.disabled,m.colorModeForRenderPass());T&&m.resetStencilClippingMasks();const E=on.additive;for(const j of o)Ym(j,m,t,x[j.modelIndex],Ji.disabled,j.isLightMesh?E:m.colorModeForRenderPass())}function cg(m,t,o){const p=t.updateZoomBasedPaintProperties(),x=(function(T,E,j){let O,B,H,K=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&K>0){const Y=T.terrain,J=Y.findDEMTileFor(j);J&&J.dem?O=i.eF.create(Y,j,J):K=0}if(K===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),K===E.validForExaggeration&&(K===0||O&&O._demTile&&O._demTile.tileID===E.validForDEMTile.id&&O._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const Y in E.instancesPerModel){const J=E.instancesPerModel[Y];for(let se=0;se<J.instancedDataArray.length;++se){const ae=(O?K*O.getElevationAt(0|J.instancedDataArray.float32[16*se],0|J.instancedDataArray.float32[16*se+1],!0,!0):0)+J.instancesEvaluatedElevation[se];J.instancedDataArray.float32[16*se+6]=ae,B=B?Math.min(E.terrainElevationMin,ae):ae,H=H?Math.max(E.terrainElevationMax,ae):ae}}return E.terrainElevationMin=B||0,E.terrainElevationMax=H||0,E.validForExaggeration=K,E.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0})(m,t,o);(p||x)&&(t.uploaded=!1,t.upload(m.context))}const Hl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d9([0,0,0],[i.al,i.al,0])};function Eo(m,t){const o=1<<m.canonical.z,p=t.getFreeCameraOptions().position,x=t.elevation,T=m.canonical.x/o,E=(m.canonical.x+1)/o,j=m.canonical.y/o,O=(m.canonical.y+1)/o;let B=t._centerAltitude;if(x){const J=x.getMinMaxForTile(m);J&&J.max>B&&(B=J.max)}const H=i.aA(p.x,T,E)-p.x,K=i.aA(p.y,j,O)-p.y,Y=i.cf(B,t.center.lat)-p.z;return t._zoomFromMercatorZ(Math.sqrt(H*H+K*K+Y*Y))}function ug(m,t,o,p,x,T,E){const j=m.context,O=m.renderPass==="shadow",B=m.shadowRenderer,H=O&&B?B.getShadowPassDepthMode():new ji(j.gl.LEQUAL,ji.ReadWrite,m.depthRangeFor3D),K=m.isTileAffectedByFog(T),Y=m.transform.projection.name==="globe";if(o.meshes)for(const J of o.meshes){const se=Y?[]:["MODEL_POSITION_ON_GPU"],ae=[];let he,de,_e;const we=!Y&&p.instancedDataArray.length>20;we&&se.push("INSTANCED_ARRAYS");const ye=yl(m,t.paint.get("model-cutoff-fade-range"));if(ye.shouldRenderCutoff&&se.push("RENDER_CUTOFF"),O&&B)he=m.getOrCreateProgram("modelDepth",{defines:se}),de=Vm(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(o.globalMatrix)),_e=B.getShadowPassColorMode();else{Wf(se,ae,J,m,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),he=m.getOrCreateProgram("model",{defines:se,overrideFog:K});const Ae=J.material,Ie=Ae.pbrMetallicRoughness,je=t.paint.get("model-opacity").constantOr(1),Ce=t.paint.get("model-emissive-strength").constantOr(0);de=xd(T.expandedProjMatrix,Float32Array.from(o.globalMatrix),new Float32Array(16),null,m,je,Ie.baseColorFactor,Ae.emissiveFactor,Ie.metallicFactor,Ie.roughnessFactor,Ae,Ce,t,x),B&&(E.shadowUniformsInitialized?he.setShadowUniformValues(j,B.getShadowUniformValues()):(B.setupShadows(T.toUnwrapped(),he,"model-tile"),E.shadowUniformsInitialized=!0)),_e=ye.shouldRenderCutoff||je<1||Ae.alphaMode!=="OPAQUE"?on.alphaBlended:on.unblended}m.uploadCommonUniforms(j,he,T.toUnwrapped(),null,ye);const Pe=J.material.doubleSided?en.disabled:en.backCCW;if(we)ae.push(p.instancedDataBuffer),he.draw(m,j.gl.TRIANGLES,H,Ji.disabled,_e,Pe,de,t.id,J.vertexBuffer,J.indexBuffer,J.segments,t.paint,m.transform.zoom,void 0,ae,p.instancedDataArray.length);else{const Ae=O?"u_instance":"u_normal_matrix";for(let Ie=0;Ie<p.instancedDataArray.length;++Ie)de[Ae]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Ie,16),he.draw(m,j.gl.TRIANGLES,H,Ji.disabled,_e,Pe,de,t.id,J.vertexBuffer,J.indexBuffer,J.segments,t.paint,m.transform.zoom,void 0,ae)}}if(o.children)for(const J of o.children)ug(m,t,J,p,x,T,E)}const Yf=[1,-1,1];function qh(m,t,o,p){if(!o.modelManager)return!0;const x=o.modelManager;if(!o.shadowRenderer)return!0;const T=o.shadowRenderer,E=t.aabb;let j=!0,O=m.maxHeight;if(O===0){let H=0;for(const K in m.instancesPerModel){const Y=x.getModel(K,p);Y?H=Math.max(H,Math.max(Math.max(Y.aabb.max[0],Y.aabb.max[1]),Y.aabb.max[2])):j=!1}O=m.maxScale*H*1.41+m.maxVerticalOffset,j&&(m.maxHeight=O)}E.max[2]=O,E.min[2]+=m.terrainElevationMin,E.max[2]+=m.terrainElevationMax,i.af(E.min,E.min,t.tileMatrix),i.af(E.max,E.max,t.tileMatrix);const B=E.intersects(T.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=B===2),B===0}function Ba(m,t){const o=m.uniformValues.u_cutoff_params[0],p=m.uniformValues.u_cutoff_params[1],x=m.uniformValues.u_cutoff_params[2],T=m.uniformValues.u_cutoff_params[3];return p===o||T===x?1:i.aA(((t-o)/(p-o)-x)/(T-x),0,1)}function Ln(m,t,o,p){if(t.pitch<20)return 1;const x=t.getWorldToCameraMatrix();i.aB(x,x,m);const T=i.bU(o.min[0],o.min[1],o.min[2],1);let E=i.aC(i.eG(),T,x),j=E,O=E;T[1]=o.max[1],E=i.aC(i.eG(),T,x),j=E[1]<j[1]?E:j,O=E[1]>O[1]?E:O,T[0]=o.max[0],E=i.aC(i.eG(),T,x),j=E[1]<j[1]?E:j,O=E[1]>O[1]?E:O,T[1]=o.min[1],E=i.aC(i.eG(),T,x),j=E[1]<j[1]?E:j,O=E[1]>O[1]?E:O;const B=i.aA(p[0],0,1),H=100*t.pixelsPerMeter*i.aA(p[1],0,1),K=i.aA(p[2],0,1),Y=i.eH(i.eG(),j,O,B),J=Math.tan(.5*t.fovX),se=-Y[2]*J;if(H===0)return Y[1]<-Math.abs(se)?K:1;const ae=(-Math.abs(se)-Y[1])/H,he=(_e,we,ye)=>(1-ye)*_e+ye*we,de=i.aA(he(1,K,ae),K,1);return he(1,de,i.aA((t.pitch-20)/20,0,1))}class Wh{}class Pc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,p){{const K=this._storage.get(o.id);if(K)return K.lastUsedFrameIdx=t,K.buf}const x=p.gl,T=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),E=new ArrayBuffer(T),j=new Int16Array(E);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const O=new i.eJ;for(let K=0;K<T/2;K+=3){const Y=j[K],J=j[K+1],se=j[K+2];O.emplaceBack(Y,J),O.emplaceBack(J,se),O.emplaceBack(se,Y)}const B=p.bindVertexArrayOES.current,H=new Wh;return H.buf=new Vl(p,O),H.lastUsedFrameIdx=t,this._storage.set(o.id,H),p.bindVertexArrayOES.set(B),H.buf}update(t){for(const[o,p]of this._storage)t-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(o))}destroy(){for(const[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class nh{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const ah=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class wl{constructor(t){this.revealStart=11,this.revealRange=2}}const Jm=i.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Sl{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,o){const p=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new i.eK,j=new i.b0;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),j.emplaceBack(0,1,2),j.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(E,Jm.members),this.vignetteIdx=t.context.createIndexBuffer(j)}const x=i.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,p);const E={u_vignetteShape:(T={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:T.vignetteColor};p.draw(t,t.context.gl.TRIANGLES,ji.disabled,Ji.disabled,on.alphaBlended,en.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,x)}var T}}class lc{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,o){const p=t.getFreeCameraOptions().position,x=p.toAltitude(),T=p.toLngLat(),E=i.an(T.lng),j=i.an(T.lat),O=t.pixelsPerMeter/o,B=E*i.eM,H=i.eM*Math.log(Math.tan(Math.PI/4+j/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const K=-this._offsetYPrev+H,Y=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+B)*O,this._accumulatedOffsetY+=K*O,this._accumulatedElevation+=Y*O,this._offsetXPrev=B,this._offsetYPrev=H,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function jc(m,t){return[-(m[0]-Math.floor(m[0]/t)*t),-(m[1]-Math.floor(m[1]/t)*t),-(m[2]-Math.floor(m[2]/t)*t)]}function Tl(m){const t=i.eq(1323123451230),o=[];for(let p=0;p<m;++p){const x=2*t()-1,T=2*t()-1,E=2*t()-1;o.push(i.d5(x,T,E))}return o}function ps(m,t,o,p,x){const T=i.aA((x-o)/(p-o),0,1);return(1-T)*m+T*t}class ll{constructor(t){this._movement=new lc,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Sl,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,o){const p=t.transform;this._movement.update(p,this._ppmScaleFactor);const x=p.starsProjMatrix,T=i.c7([]);i.c9(T,T,i.an(90)-p._pitch),i.c8(T,T,-p.angle);const E=i.cc(new Float32Array(16),T),j=i.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=i.eg([],j),B=i.aB([],O,E),H=Date.now()/1e3;return this._accumulatedTimeFromStart+=(H-this._prevTime)*o,this._prevTime=H,{projectionMatrix:x,modelviewMatrix:B}}}class gs extends ll{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new wl("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const p=Tl(this.particlesCount),x=new i.eN,T=new i.b0;let E=0;const j=i.eq(1323123451230);for(let O=0;O<p.length;++O){const B=p[O],H=[2*j()-1,j(),j(),j()];x.emplaceBack(B[0],B[1],B[2],-1,-1,...H),x.emplaceBack(B[0],B[1],B[2],1,-1,...H),x.emplaceBack(B[0],B[1],B[2],1,1,...H),x.emplaceBack(B[0],B[1],B[2],-1,1,...H),T.emplaceBack(E+0,E+1,E+2),T.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=o.createVertexBuffer(x,ah.members),this.particlesIdx=o.createIndexBuffer(T)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=t.transform.zoom;if(o.revealStart>p)return;const x=ps(0,1,o.revealStart,o.revealStart+o.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const T=structuredClone(this._params);let E=[-T.direction.x,T.direction.y,-100];i.aw(E,E);const j=structuredClone(this._vignetteParams);j.strength*=x,T.overrideStyleParameters||(T.intensity=t.style.rain.state.density,T.timeFactor=t.style.rain.state.intensity,T.color=structuredClone(t.style.rain.state.color),E=structuredClone(t.style.rain.state.direction),T.screenThinning.intensity=t.style.rain.state.centerThinning,T.dropletSizeX=t.style.rain.state.dropletSize[0],T.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],T.distortionStrength=100*t.style.rain.state.distortionStrength,j.strength=1,j.color=structuredClone(t.style.rain.state.vignetteColor));const O=this.updateOnRender(t,T.timeFactor),B=t.context,H=B.gl,K=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new i.T(B,{width:t.width,height:t.height,data:null},H.RGBA8)),T.distortionStrength>0&&(B.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),H.copyTexSubImage2D(H.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const Y=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(B,Y),B.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const J=[T.color.r,T.color.g,T.color.b,T.color.a],se=(ae,he)=>{const de=jc(this._movement.getPosition(),ae),_e=T.dropletSizeX,we=T.dropletSizeX*T.dropletSizeYScale,ye=t.width/2,Pe=t.height/2,Ae=ps(0,T.screenThinning.start,0,1,T.screenThinning.intensity),Ie=ps(.001,T.screenThinning.range,0,1,T.screenThinning.intensity),je=ps(0,T.screenThinning.particleOffset,0,1,T.screenThinning.intensity),Ce=(Ge={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:T.velocityConeAperture,velocity:T.velocity,boxSize:ae,rainDropletSize:[_e,we],distortionStrength:T.distortionStrength,rainDirection:E,color:J,screenSize:[K.width,K.height],thinningCenterPos:[ye,Pe],thinningShape:[Ae,Ie,Math.pow(10,T.screenThinning.fadePower)],thinningAffectedRatio:T.screenThinning.affectedRatio,thinningParticleOffset:je,shapeDirectionalPower:T.shapeDirPower,shapeNormalPower:T.shapeNormalPower,mode:he?0:1},{u_modelview:Float32Array.from(Ge.modelview),u_projection:Float32Array.from(Ge.projection),u_time:Ge.time,u_cam_pos:Ge.camPos,u_texScreen:0,u_velocityConeAperture:Ge.velocityConeAperture,u_velocity:Ge.velocity,u_boxSize:Ge.boxSize,u_rainDropletSize:Ge.rainDropletSize,u_distortionStrength:Ge.distortionStrength,u_rainDirection:Ge.rainDirection,u_color:Ge.color,u_screenSize:Ge.screenSize,u_thinningCenterPos:Ge.thinningCenterPos,u_thinningShape:Ge.thinningShape,u_thinningAffectedRatio:Ge.thinningAffectedRatio,u_thinningParticleOffset:Ge.thinningParticleOffset,u_shapeDirectionalPower:Ge.shapeDirectionalPower,u_shapeNormalPower:Ge.shapeNormalPower,u_mode:Ge.mode});var Ge;const it=Math.round(T.intensity*this.particlesCount),Ke=i.bg.simpleSegment(0,0,4*it,2*it);Y.draw(t,H.TRIANGLES,ji.disabled,Ji.disabled,on.alphaBlended,en.disabled,Ce,"rain_particles",this.particlesVx,this.particlesIdx,Ke)};T.distortionStrength>0&&se(T.boxSize,!0),se(T.boxSize,!1),this._vignette.draw(t,j)}}const Zh=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Kf extends ll{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new wl("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const p=Tl(this.particlesCount),x=new i.eO,T=new i.b0;let E=0;const j=i.eq(1323123451230);for(let O=0;O<p.length;++O){const B=p[O],H=j(),K=j(),Y=j(),J=[O/p.length,H,K,Y],se=[j(),j()];x.emplaceBack(B[0],B[1],B[2],-1,-1,...J,...se),x.emplaceBack(B[0],B[1],B[2],1,-1,...J,...se),x.emplaceBack(B[0],B[1],B[2],1,1,...J,...se),x.emplaceBack(B[0],B[1],B[2],-1,1,...J,...se),T.emplaceBack(E+0,E+1,E+2),T.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=o.createVertexBuffer(x,Zh.members),this.particlesIdx=o.createIndexBuffer(T)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const o=structuredClone(this._params);let p=[-o.direction.x,o.direction.y,-100];i.aw(p,p);const x=structuredClone(this._vignetteParams),T=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=t.transform.zoom;if(T.revealStart>E)return;const j=ps(0,1,T.revealStart,T.revealStart+T.revealRange,E);x.strength*=j,o.overrideStyleParameters||(o.intensity=t.style.snow.state.density,o.timeFactor=t.style.snow.state.intensity,o.color=structuredClone(t.style.snow.state.color),p=structuredClone(t.style.snow.state.direction),o.screenThinning.intensity=t.style.snow.state.centerThinning,o.billboardSize=2.79*t.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(t.style.snow.state.vignetteColor));const O=this.updateOnRender(t,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const B=t.context,H=B.gl,K=t.transform,Y=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(B,Y),((J,se,ae)=>{const he=jc(this._movement.getPosition(),J),de=K.width/2,_e=K.height/2,we=ps(0,ae.screenThinning.start,0,1,ae.screenThinning.intensity),ye=ps(.001,ae.screenThinning.range,0,1,ae.screenThinning.intensity),Pe=ps(0,ae.screenThinning.particleOffset,0,1,ae.screenThinning.intensity),Ae=(Ie={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:he,velocityConeAperture:ae.velocityConeAperture,velocity:ae.velocity,horizontalOscillationRadius:ae.horizontalOscillationRadius,horizontalOscillationRate:ae.horizontalOscillationRate,boxSize:J,billboardSize:1*ae.billboardSize,simpleShapeParameters:[ae.shapeFadeStart,ae.shapeFadePower],screenSize:[K.width,K.height],thinningCenterPos:[de,_e],thinningShape:[we,ye,Math.pow(10,ae.screenThinning.fadePower)],thinningAffectedRatio:ae.screenThinning.affectedRatio,thinningParticleOffset:Pe,color:[ae.color.r,ae.color.g,ae.color.b,ae.color.a],direction:p},{u_modelview:Float32Array.from(Ie.modelview),u_projection:Float32Array.from(Ie.projection),u_time:Ie.time,u_cam_pos:Ie.camPos,u_velocityConeAperture:Ie.velocityConeAperture,u_velocity:Ie.velocity,u_horizontalOscillationRadius:Ie.horizontalOscillationRadius,u_horizontalOscillationRate:Ie.horizontalOscillationRate,u_boxSize:Ie.boxSize,u_billboardSize:Ie.billboardSize,u_simpleShapeParameters:Ie.simpleShapeParameters,u_screenSize:Ie.screenSize,u_thinningCenterPos:Ie.thinningCenterPos,u_thinningShape:Ie.thinningShape,u_thinningAffectedRatio:Ie.thinningAffectedRatio,u_thinningParticleOffset:Ie.thinningParticleOffset,u_particleColor:Ie.color,u_direction:Ie.direction});var Ie;const je=Math.round(ae.intensity*this.particlesCount),Ce=i.bg.simpleSegment(0,0,4*je,2*je);this.particlesVx&&this.particlesIdx&&Y.draw(t,H.TRIANGLES,ji.disabled,Ji.disabled,on.alphaBlended,en.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,Ce)})(o.boxSize,0,o),this._vignette.draw(t,x)}}const hu={symbol:function(m,t,o,p,x){if(m.renderPass!=="translucent")return;const T=Ji.disabled,E=m.colorModeForRenderPass(),j=o.layout.get("text-variable-anchor"),O=o.layout.get("text-size-scale-range"),B=i.aA(m.scaleFactor,O[0],O[1]);j&&(function(Y,J,se,ae,he,de,_e,we){const ye=J.transform,Pe=he==="map",Ae=de==="map";for(const Ie of Y){const je=ae.getTile(Ie),Ce=je.getBucket(se);if(!Ce||!Ce.text||!Ce.text.segments.get().length)continue;const Ge=i.bK(Ce.textSizeData,ye.zoom,we),it=wo(Ie,Ce.getProjection(),ye),Ke=ye.calculatePixelsToTileUnitsMatrix(je),ht=Rs(it,je.tileID.canonical,Ae,Pe,ye,Ce.getProjection(),Ke),mt=Ce.hasIconTextFit()&&Ce.hasIconData();Ge&&qi(Ce,Pe,Ae,_e,ye,ht,Ie,Math.pow(2,ye.zoom-je.tileID.overscaledZ),Ge,mt)}})(p,m,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),x,B);const H=o.paint.get("icon-opacity").constantOr(1)!==0,K=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(H||K)?th(m,t,o,p,T,E):(H&&th(m,t,o,p,T,E,{onlyIcons:!0}),K&&th(m,t,o,p,T,E,{onlyText:!0})),t.map.showCollisionBoxes&&(vi(m,t,o,p,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),vi(m,t,o,p,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(m,t,o,p){if(m.renderPass!=="translucent")return;const x=o.paint.get("circle-opacity"),T=o.paint.get("circle-stroke-width"),E=o.paint.get("circle-stroke-opacity"),j=o.layout.get("circle-sort-key").constantOr(1)!==void 0,O=o.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(T.constantOr(1)===0||E.constantOr(1)===0))return;const B=m.context,H=B.gl,K=m.transform,Y=!(!m.terrain||!m.terrain.enabled),J=o.layout.get("circle-elevation-reference"),se=m.depthModeForSublayer(0,ji.ReadOnly),ae=new ji(m.context.gl.LEQUAL,ji.ReadOnly,m.depthRangeFor3D),he=J==="none"||Y?se:ae,de=Ji.disabled,_e=m.colorModeForDrapableLayerRenderPass(O),we=K.projection.name==="globe",ye=[i.aF(K.center.lng),i.aJ(K.center.lat)],Pe=[];for(let Ie=0;Ie<p.length;Ie++){const je=p[Ie],Ce=t.getTile(je),Ge=Ce.getBucket(o);if(!Ge||Ge.projection.name!==K.projection.name)continue;const it=Ge.programConfigurations.get(o.id),Ke=Ge.layoutVertexBuffer,ht=Ge.globeExtVertexBuffer,mt=Ge.indexBuffer,kt=i.e0(o),Ot=[ht],ot=m.isTileAffectedByFog(je);we&&kt.push("PROJECTION_GLOBE_VIEW"),kt.push("DEPTH_D24"),m.terrain&&K.depthOcclusionForSymbolsAndCircles&&kt.push("DEPTH_OCCLUSION"),Ge.hasElevation&&!m.terrain&&(kt.push("ELEVATED_ROADS"),Ot.push(Ge.elevatedLayoutVertexBuffer));const Ye=m.getOrCreateProgram("circle",{config:it,defines:kt,overrideFog:ot}),gt=K.projection.createInversionMatrix(K,je.canonical),ft={programConfiguration:it,program:Ye,layoutVertexBuffer:Ke,dynamicBuffers:Ot,indexBuffer:mt,uniformValues:i.e1(m,je,Ce,gt,ye,o),tile:Ce};if(j){const Nt=Ge.segments.get();for(const ai of Nt)Pe.push({segments:new i.bg([ai]),sortKey:ai.sortKey,state:ft})}else Pe.push({segments:Ge.segments,sortKey:0,state:ft})}j&&Pe.sort(((Ie,je)=>Ie.sortKey-je.sortKey));const Ae={useDepthForOcclusion:K.depthOcclusionForSymbolsAndCircles};for(const Ie of Pe){const{programConfiguration:je,program:Ce,layoutVertexBuffer:Ge,dynamicBuffers:it,indexBuffer:Ke,uniformValues:ht,tile:mt}=Ie.state,kt=Ie.segments;m.terrain&&m.terrain.setupElevationDraw(mt,Ce,Ae),m.uploadCommonUniforms(B,Ce,mt.tileID.toUnwrapped()),Ce.draw(m,H.TRIANGLES,he,de,_e,en.disabled,ht,o.id,Ge,Ke,kt,o.paint,K.zoom,je,it)}},heatmap:function(m,t,o,p){if(o.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,T=x.gl,E=Ji.disabled,j=new on([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(J,se,ae,he){const de=J.gl,_e=se.width*he,we=se.height*he;J.activeTexture.set(de.TEXTURE1),J.viewport.set([0,0,_e,we]);let ye=ae.heatmapFbo;if(!ye||ye&&(ye.width!==_e||ye.height!==we)){ye&&ye.destroy();const Pe=de.createTexture();de.bindTexture(de.TEXTURE_2D,Pe),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_S,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_T,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MIN_FILTER,de.LINEAR),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MAG_FILTER,de.LINEAR),ye=ae.heatmapFbo=J.createFramebuffer(_e,we,1,null),(function(Ae,Ie,je,Ce,Ge,it){const Ke=Ae.gl;Ke.texImage2D(Ke.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?Ke.RGBA16F:Ke.RGBA,Ge,it,0,Ke.RGBA,Ae.extRenderToTextureHalfFloat?Ke.HALF_FLOAT:Ke.UNSIGNED_BYTE,null),Ce.colorAttachment0.set(je)})(J,0,Pe,ye,_e,we)}else de.bindTexture(de.TEXTURE_2D,ye.colorAttachment0.get()),J.bindFramebuffer.set(ye.framebuffer)})(x,m,o,m.transform.projection.name==="globe"?.5:.25),x.clear({color:i.ao.transparent});const O=m.transform,B=O.projection.name==="globe",H=B?["PROJECTION_GLOBE_VIEW"]:[],K=B?en.frontCCW:en.disabled,Y=[i.aF(O.center.lng),i.aJ(O.center.lat)];for(let J=0;J<p.length;J++){const se=p[J];if(t.hasRenderableParent(se))continue;const ae=t.getTile(se),he=ae.getBucket(o);if(!he||he.projection.name!==O.projection.name)continue;const de=m.isTileAffectedByFog(se),_e=he.programConfigurations.get(o.id),we=m.getOrCreateProgram("heatmap",{config:_e,defines:H,overrideFog:de}),{zoom:ye}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ae,we),m.uploadCommonUniforms(x,we,se.toUnwrapped());const Pe=O.projection.createInversionMatrix(O,se.canonical);we.draw(m,T.TRIANGLES,ji.disabled,E,j,K,Fu(m,se,ae,Pe,Y,ye,o.paint.get("heatmap-intensity")),o.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,o.paint,m.transform.zoom,_e,B?[he.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),(function(x,T){const E=x.context,j=E.gl,O=T.heatmapFbo;if(!O)return;E.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,O.colorAttachment0.get()),E.activeTexture.set(j.TEXTURE1);let B=T.colorRampTexture;B||(B=T.colorRampTexture=new i.T(E,T.colorRamp,j.RGBA8)),B.bind(j.LINEAR,j.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,j.TRIANGLES,ji.disabled,Ji.disabled,x.colorModeForRenderPass(),en.disabled,((H,K,Y,J)=>({u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}))(0,T),T.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,T.paint,x.transform.zoom)})(m,o))},line:function(m,t,o,p){if(m.renderPass!=="translucent")return;const x=o.paint.get("line-opacity"),T=o.paint.get("line-width");if(x.constantOr(1)===0||T.constantOr(1)===0)return;const E=o.paint.get("line-emissive-strength").isConstant(),j=o.paint.get("line-emissive-strength").constantOr(0),O=o.paint.get("line-occlusion-opacity"),B=o.layout.get("line-elevation-reference"),H=o.layout.get("line-width-unit")==="meters",K=B==="sea",Y=!(!m.terrain||!m.terrain.enabled),J=m.context,se=J.gl;if(o.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const ae=o.layout.get("line-cross-slope"),he=ae!==void 0,de=ae<1,_e=m.colorModeForDrapableLayerRenderPass(E?j:null),we=m.terrain&&m.terrain.renderingToTexture,ye=we?1:i.o.devicePixelRatio,Pe=o.paint.get("line-dasharray"),Ae=Pe.constantOr(1),Ie=o.layout.get("line-cap"),je=Pe.constantOr(null),Ce=Ie.constantOr(null),Ge=o.paint.get("line-pattern"),it=Ge.constantOr(1),Ke=o.paint.get("line-pattern-cross-fade"),ht=Ge.constantOr(null),mt=o.paint.get("line-opacity").constantOr(1);let kt=!it&&mt!==1||m.depthOcclusion&&O>0&&O<1;const Ot=o.paint.get("line-gradient"),ot=it?"linePattern":"line",Ye=i.e2(o);let gt;if(we&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(kt=!1),O!==0&&m.depthOcclusion){const gi=o.paint._values["line-opacity"];gi&&gi.value&&gi.value.kind==="constant"?gt=gi.value:i.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}T.value.kind!=="constant"&&T.value.isLineProgressConstant===!1&&Ye.push("VARIABLE_LINE_WIDTH"),we&&(m.emissiveMode!=="dual-source-blending"||E?m.emissiveMode==="mrt-fallback"&&Ye.push("USE_MRT1"):Ye.push("DUAL_SOURCE_BLENDING"));const ft=(gi,Yt,zt,ki,wi,di)=>{for(const yi of gi){const $i=t.getTile(yi);if(it&&!$i.patternsLoaded())continue;const hn=$i.getBucket(o);if(!hn||hn.elevationType!=="none"&&!wi||hn.elevationType==="none"&&wi)continue;m.prepareDrawTile();const In=[...Yt],ea=m.shadowRenderer,Si=hn.elevationType==="road"&&!!ea&&ea.enabled;let ta=[0,0,0];if(Si){const xn=m.style.directionalLight,Ua=m.style.ambientLight;xn&&Ua&&(ta=zs(m.style,xn,Ua)),In.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Zi=hn.programConfigurations.get(o.id);let ua=!1;if(ht&&$i.imageAtlas){const xn=i.e3.from(ht),Ua=xn.getPrimary().scaleSelf(ye).toString(),kr=$i.imageAtlas.patternPositions.get(Ua),cr=xn.getSecondary(),Ra=cr?$i.imageAtlas.patternPositions.get(cr.scaleSelf(ye).toString()):null;ua=!!kr&&!!Ra,kr&&Zi.setConstantPatternPositions(kr,Ra)}Ke>0&&(ua||Zi.getPatternTransitionVertexBuffer("line-pattern"))&&In.push("LINE_PATTERN_TRANSITION");const va=m.isTileAffectedByFog(yi),xa=m.getOrCreateProgram(ot,{config:Zi,defines:In,overrideFog:va});if(!it&&je&&Ce&&$i.lineAtlas){const xn=$i.lineAtlas.getDash(je,Ce);xn&&Zi.setConstantPatternPositions(xn)}Si&&ea.setupShadows($i.tileID.toUnwrapped(),xa,"vector-tile");let[Nn,_n]=o.paint.get("line-trim-offset");(Ce==="round"||Ce==="square")&&Nn!==_n&&(Nn===0&&(Nn-=1),_n===1&&(_n+=1));const na=we?yi.projMatrix:null,Ga=H?1/hn.tileToMeter/i.ay($i,1,m.transform.zoom):1,Ya=H?1/hn.tileToMeter/i.ay($i,1,Math.floor(m.transform.zoom)):1,da=it?i.e4(m,$i,o,na,ye,Ga,Ya,[Nn,_n],ta,Ke):i.e5(m,$i,o,na,hn.lineClipsArray.length,ye,Ga,Ya,[Nn,_n],ta);if(Ot){const xn=hn.gradients[o.id];let Ua=xn.texture;if(o.gradientVersion!==xn.version){let kr=256;if(o.stepInterpolant){const cr=t.getSource().maxzoom,Ra=yi.canonical.z===cr?Math.ceil(1<<m.transform.maxZoom-yi.canonical.z):1;kr=i.aA(i.e6(hn.maxLineLength/i.al*1024*Ra),256,J.maxTextureSize)}xn.gradient=i.e7({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:kr,image:xn.gradient||void 0,clips:hn.lineClipsArray}),xn.texture?xn.texture.update(xn.gradient):xn.texture=new i.T(J,xn.gradient,se.RGBA8),xn.version=o.gradientVersion,Ua=xn.texture}J.activeTexture.set(se.TEXTURE1),Ua.bind(o.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}Ae&&(J.activeTexture.set(se.TEXTURE0),$i.lineAtlasTexture&&$i.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),Zi.updatePaintBuffers()),it&&(J.activeTexture.set(se.TEXTURE0),$i.imageAtlasTexture&&$i.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Zi.updatePaintBuffers()),wi&&!K&&m.terrain.setupElevationDraw($i,xa),m.uploadCommonUniforms(J,xa,yi.toUnwrapped());const Xn=xn=>{gt!=null&&(gt.value=mt*O),xa.draw(m,se.TRIANGLES,zt,xn,_e,en.disabled,da,o.id,hn.layoutVertexBuffer,hn.indexBuffer,hn.segments,o.paint,m.transform.zoom,Zi,[hn.layoutVertexBuffer2,hn.patternVertexBuffer,hn.zOffsetVertexBuffer]),gt!=null&&(gt.value=mt)};if(kt&&!wi){const xn=m.stencilModeForClipping(yi).ref;xn===0&&we&&J.clear({stencil:0});const Ua={func:se.EQUAL,mask:255};da.u_alpha_discard_threshold=.8,Xn(new Ji(Ua,xn,255,se.KEEP,se.KEEP,se.INVERT)),da.u_alpha_discard_threshold=0,Xn(new Ji(Ua,xn,255,se.KEEP,se.KEEP,se.KEEP))}else da.u_alpha_discard_threshold=kt&&wi&&di?.8:0,Xn(wi?ki:m.stencilModeForClipping(yi))}};let Nt=m.depthModeForSublayer(0,ji.ReadOnly);const ai=new ji(m.depthOcclusion?se.GREATER:se.LEQUAL,ji.ReadOnly,m.depthRangeFor3D);if(o.hasNonElevatedBuckets){const gi=!we&&m.terrain;O!==0&&gi?i.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):gi?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):ft(p,Ye,Nt,Ji.disabled,!1,!0)}if(o.hasElevatedBuckets){B==="hd-road-markup"?Y||(Nt=ai,Ye.push("ELEVATED_ROADS")):(Ye.push("ELEVATED"),Nt=ai,he&&Ye.push(de?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),K&&Ye.push("ELEVATION_REFERENCE_SEA"));const gi=kt?m.stencilModeFor3D():Ji.disabled;m.forceTerrainMode=!0,ft(p,Ye,Nt,gi,!0,!0),kt&&ft(p,Ye,Nt,gi,!0,!1),m.forceTerrainMode=!1}kt&&(m.resetStencilClippingMasks(),we&&J.clear({stencil:0})),O===0||m.depthOcclusion||we||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,t,o,p){const x=o.paint.get("fill-color"),T=o.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const E=o.paint.get("fill-emissive-strength"),j=m.colorModeForDrapableLayerRenderPass(E),O=o.paint.get("fill-pattern"),B=m.opaquePassEnabledForLayer()&&!O.constantOr(1)&&x.constantOr(i.ao.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";let H="none";o.layout.get("fill-elevation-reference")!=="none"?H="road":o.paint.get("fill-z-offset").constantOr(1)!==0&&(H="offset");const K=!(!m.terrain||!m.terrain.enabled),Y={painter:m,sourceCache:t,layer:o,coords:p,colorMode:j,elevationType:H,terrainEnabled:K,pass:B};if(m.renderPass==="shadow")return void(m.shadowRenderer&&H==="road"&&!K&&(function(se){const{painter:ae,sourceCache:he,layer:de,coords:_e}=se,we=ae.context.gl,ye=se.painter.shadowRenderer;for(const Pe of _e){const Ae=he.getTile(Pe),Ie=Ae.getBucket(de);if(!Ie)continue;const je=Ie.elevatedStructures;if(!je||!je.shadowCasterSegments||je.shadowCasterSegments.segments[0].primitiveLength===0)continue;ae.prepareDrawTile();const Ce=Ie.bufferData.programConfigurations.get(de.id),Ge=ae.isTileAffectedByFog(Pe),it=ae.getOrCreateProgram("elevatedStructuresDepth",{config:Ce,overrideFog:Ge}),Ke=ye.calculateShadowPassMatrixFromTile(Ae.tileID.toUnwrapped());ae.uploadCommonUniforms(ae.context,it,Pe.toUnwrapped());const ht={u_matrix:Ke,u_depth_bias:0};it.draw(ae,we.TRIANGLES,ye.getShadowPassDepthMode(),Ji.disabled,ye.getShadowPassColorMode(),en.disabled,ht,de.id,je.vertexBuffer,je.indexBuffer,je.shadowCasterSegments,de.paint,ae.transform.zoom,Ce)}})(Y));const J=m.emissiveMode==="mrt-fallback";if(H!=="offset"){if(Bf(Y,!1,J),H==="road"){const se=!K&&m.renderPass==="translucent";se&&Ff(m,t,o,p,"geometry"),Bf(Y,!0,J,Ji.disabled),se&&(function(ae){const{painter:he,sourceCache:de,layer:_e,coords:we,colorMode:ye}=ae,Pe=he.context.gl,Ae=ae.painter.shadowRenderer,Ie=!!Ae&&Ae.enabled,je=new ji(he.context.gl.LEQUAL,ji.ReadOnly,he.depthRangeFor3D);let Ce=[0,0,0];if(Ie){const it=he.style.directionalLight,Ke=he.style.ambientLight;it&&Ke&&(Ce=zs(he.style,it,Ke))}const Ge=it=>{for(const Ke of we){const ht=de.getTile(Ke),mt=ht.getBucket(_e);if(!mt)continue;const kt=mt.elevatedStructures;if(!kt)continue;let Ot,ot;if(it?(Ot=kt.renderableBridgeSegments,ot=kt.bridgeProgramConfigurations.get(_e.id)):(Ot=kt.renderableTunnelSegments,ot=kt.tunnelProgramConfigurations.get(_e.id)),!Ot||Ot.segments[0].primitiveLength===0)continue;ot.updatePaintBuffers(),he.prepareDrawTile();const Ye=he.isTileAffectedByFog(Ke),gt=[];Ie&&gt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ft=he.getOrCreateProgram("elevatedStructures",{config:ot,overrideFog:Ye,defines:gt}),Nt=he.translatePosMatrix(Ke.projMatrix,ht,_e.paint.get("fill-translate"),_e.paint.get("fill-translate-anchor"));Ie&&Ae.setupShadows(ht.tileID.toUnwrapped(),ft,"vector-tile");const ai=oc(Nt,Ce);he.uploadCommonUniforms(he.context,ft,Ke.toUnwrapped()),ft.draw(he,Pe.TRIANGLES,je,Ji.disabled,ye,en.backCCW,ai,_e.id,kt.vertexBuffer,kt.indexBuffer,Ot,_e.paint,he.transform.zoom,ot,[kt.vertexBufferNormal])}};Ge(!0),Ge(!1)})(Y)}}else Bf(Y,!1,J,m.stencilModeFor3D())},"fill-extrusion":function(m,t,o,p){const x=o.paint.get("fill-extrusion-opacity"),T=m.context,E=T.gl,j=m.terrain,O=j&&j.renderingToTexture;if(x===0)return;const B=m.emissiveMode==="mrt-fallback",H=m.conflationActive&&m.style.isLayerClipped(o,t.getSource()),K=m.style.order.indexOf(o.fqid);if(H&&(function(Y,J,se,ae,he){for(const de of ae){const _e=J.getTile(de).getBucket(se);_e&&(_e.updateReplacement(de,Y.replacementSource,he),_e.uploadCentroid(Y.context))}})(m,t,o,p,K),j||H)for(const Y of p){const J=t.getTile(Y).getBucket(o);J&&tg(m.context,t,Y,J,o,j,H)}if(m.renderPass==="shadow"&&m.shadowRenderer){const Y=m.shadowRenderer;if(j&&x<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const J=Y.getShadowPassDepthMode(),se=Y.getShadowPassColorMode();Uf(m,t,o,p,J,Ji.disabled,se,H)}else if(m.renderPass==="translucent"){const Y=!o.paint.get("fill-extrusion-pattern").constantOr(1),J=o.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!O&&J.a!==0){const se=new ji(m.context.gl.LEQUAL,ji.ReadWrite,m.depthRangeFor3D);x===1&&Y?Uf(m,t,o,p,se,Ji.disabled,on.unblended,H):(Uf(m,t,o,p,se,Ji.disabled,on.disabled,H),Uf(m,t,o,p,se,m.stencilModeFor3D(),m.colorModeForRenderPass(),H),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&Y&&(!j&&m.transform.projection.name!=="globe"||O)){const se=o.paint.get("fill-extrusion-opacity"),ae=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),he=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),de=o.paint.get("fill-extrusion-flood-light-intensity"),_e=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",we=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(_e?null:o.lut).toArray01().slice(0,3),ye=ae>0&&he>0,Pe=de>0,Ae=(Ce,Ge,it)=>(1-it)*Ce+it*Ge,Ie=new qm;Ie.translate=o.paint.get("fill-extrusion-translate"),Ie.translateAnchor=o.paint.get("fill-extrusion-translate-anchor"),Ie.edgeRadius=o.layout.get("fill-extrusion-edge-radius"),Ie.cutoffFadeRange=o.paint.get("fill-extrusion-cutoff-fade-range");const je=Ce=>{const Ge=m.depthModeForSublayer(1,ji.ReadOnly,E.LEQUAL,!0),it=o.paint.get(Ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ke=Ae(.1,3,it),ht=m._showOverdrawInspector;if(!ht){const mt=new Ji({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),kt=new on([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!1,!1,!1,!0],E.MIN);cu(Ie,m,t,o,p,Ge,mt,kt,en.disabled,Ce,"sdf",se,ae,he,de,we,Ke,H,!1)}{const mt=ht?Ji.disabled:new Ji({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),kt=ht?m.colorModeForRenderPass():new on([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],i.ao.transparent,[!0,!0,!0,!0]);cu(Ie,m,t,o,p,Ge,mt,kt,en.disabled,Ce,"color",se,ae,he,de,we,Ke,H,!1)}};if(O){const Ce=()=>{const it=j.drapeBufferSize[0],Ke=j.drapeBufferSize[1];let ht=j.framebufferCopyTexture;return ht&&(!ht||ht.size[0]===it&&ht.size[1]===Ke)||(ht&&ht.destroy(),ht=j.framebufferCopyTexture=new i.T(T,new i.q({width:it,height:Ke}),E.RGBA8)),ht.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,it,Ke),ht},Ge=(it,Ke,ht)=>{const mt=m.depthModeForSublayer(1,ji.ReadOnly,E.LEQUAL,!1),kt=o.paint.get(it?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ot=Ae(.1,3,kt);{const ot=new on([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!1,!1,!1,!0]);cu(Ie,m,t,o,p,mt,Ji.disabled,ot,en.disabled,it,"clear",se,ae,he,de,we,Ot,H,Ke)}{const ot=new Ji({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Ye=new on([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!1,!1,!1,!0],E.MIN);cu(Ie,m,t,o,p,mt,ot,Ye,en.disabled,it,"sdf",se,ae,he,de,we,Ot,H,Ke)}B&&!it&&(ht=Ce());{const ot=it?E.ZERO:E.ONE_MINUS_DST_ALPHA,Ye=new Ji({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),gt=new on([ot,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],i.ao.transparent,[!0,!0,!0,!0]);cu(Ie,m,t,o,p,mt,Ye,gt,en.disabled,it,"color",se,ae,he,de,we,Ot,H,Ke)}if(!B||it){const ot=new on([E.ONE,E.ONE,E.ONE,it?E.ZERO:E.ONE],i.ao.transparent,[!1,!1,!1,!0],it?E.FUNC_ADD:E.MAX);cu(Ie,m,t,o,p,mt,Ji.disabled,ot,en.disabled,it,"clear",se,ae,he,de,we,Ot,H,Ke,ht)}else{E.drawBuffers([E.NONE,E.COLOR_ATTACHMENT1]);const ot=new Ji({func:E.EQUAL,mask:255},254,255,E.KEEP,E.DECR,E.DECR),Ye=new on([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!0,!1,!1,!1],E.MAX);cu(Ie,m,t,o,p,mt,ot,Ye,en.disabled,it,"emissive",se,ae,he,de,we,Ot,H,Ke,ht),E.drawBuffers([E.COLOR_ATTACHMENT0])}};if(ye||Pe){let it;m.prepareDrawTile(),B&&!ye||(it=Ce()),ye&&Ge(!0,!1,it),Pe&&Ge(!1,!0,it)}}else ye&&je(!0),Pe&&je(!1),(ye||Pe)&&m.resetStencilClippingMasks()}}},building:function(m,t,o,p){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const x=o.paint.get("building-ambient-occlusion-ground-intensity"),T=o.paint.get("building-ambient-occlusion-ground-radius"),E=o.paint.get("building-ambient-occlusion-ground-attenuation"),j=o.paint.get("building-opacity");if(j<=0)return;let O=x>0&&T>0,B=!0;const H=o.paint.get("building-vertical-scale");if(H<=0)return;m.shadowRenderer||(B=!1);const K=m.conflationActive&&m.style.isLayerClipped(o,t.getSource()),Y=m.style.order.indexOf(o.fqid);if((function(J,se,ae,he,de,_e){for(const we of _e){const ye=se.getTile(we).getBucket(ae);ye&&(de&&ye.updateReplacement(we,J.replacementSource,he),ye.uploadUpdatedIndexBuffer(J.context))}})(m,t,o,Y,K,p),(function(J,se,ae,he){for(const de of he){const _e=se.getTile(de).getBucket(ae);_e&&_e.needsEvaluation()&&_e.uploadUpdatedColorBuffer(J.context)}})(m,t,o,p),o.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const J=m.shadowRenderer,se=[],ae=J.getShadowPassDepthMode();Bh({painter:m,source:t,layer:o,coords:p,defines:se,blendMode:J.getShadowPassColorMode(),depthMode:ae,opacity:j,verticalScale:H,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(m.renderPass==="translucent"){let J=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];B&&(J=J.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer&&m.shadowRenderer.useNormalOffset&&(J=J.concat("NORMAL_OFFSET"));const se=o.paint.get("building-facade-emissive-chance"),ae=o.paint.get("building-ambient-occlusion-intensity"),he=o.paint.get("building-flood-light-intensity"),de=o.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",_e=o.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(de?null:o.lut).toArray01().slice(0,3),we=o.paint.get("building-flood-light-ground-attenuation"),ye=he>0,Pe=new ji(m.context.gl.LEQUAL,ji.ReadWrite,m.depthRangeFor3D);j<1&&Bh({painter:m,source:t,layer:o,coords:p,defines:J,blendMode:on.disabled,depthMode:Pe,opacity:j,verticalScale:H,facadeEmissiveChance:se,facadeAOIntensity:ae,floodLightIntensity:he,floodLightColor:_e,depthOnly:!0});const Ae=m.colorModeForRenderPass();Bh({painter:m,source:t,layer:o,coords:p,defines:J,blendMode:Ae,depthMode:Pe,opacity:j,verticalScale:H,facadeEmissiveChance:se,facadeAOIntensity:ae,floodLightIntensity:he,floodLightColor:_e}),O&&Uh(m,t,o,p,!0,j,x,T,he,_e,E,K),ye&&Uh(m,t,o,p,!1,j,x,T,he,_e,we,K)}else if(m.renderPass==="light-beam"){const J=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],se=new ji(m.context.gl.LEQUAL,ji.ReadOnly,m.depthRangeFor3D);Bh({painter:m,source:t,layer:o,coords:p,defines:J,blendMode:on.alphaBlended,depthMode:se,opacity:j,verticalScale:H,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,t,o,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const x=m.context,T=m.terrain&&m.terrain.renderingToTexture,[E,j]=m.renderPass!=="translucent"||T?[{},p]:m.stencilConfigForOverlap(p);for(const O of j){const B=t.getTile(O);if(B.needsHillshadePrepare&&m.renderPass==="offscreen")Bt(m,B,o);else if(m.renderPass==="translucent"){const H=m.depthModeForSublayer(0,ji.ReadOnly),K=o.paint.get("hillshade-emissive-strength"),Y=m.colorModeForDrapableLayerRenderPass(K),J=T&&m.terrain?m.terrain.stencilModeForRTTOverlap(O):E[O.overscaledZ];ze(m,O,B,o,H,J,Y)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,t,o,p,x,T){if(m.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const E=m.transform.projection.name==="globe",j=o.paint.get("raster-elevation")!==0,O=j&&E;if(m.renderElevatedRasterBackface&&!O)return;const B=m.context,H=B.gl,K=t.getSource(),Y=(function(Ae,Ie,je,Ce,Ge){const it=Ie.paint.get("raster-color"),Ke=Ae.type==="raster-array",ht=[],mt=Ie.paint.get("raster-resampling"),kt=Ie.paint.get("raster-color-mix");let Ot=Ie.paint.get("raster-color-range");const ot=[kt[0],kt[1],kt[2],0],Ye=kt[3];let gt=mt==="nearest"?Ce.NEAREST:Ce.LINEAR;if(Ke&&(ht.push("RASTER_ARRAY"),it||ht.push("RASTER_COLOR"),mt==="linear"&&ht.push("RASTER_ARRAY_LINEAR"),gt=Ce.NEAREST,!Ot&&Ae.rasterLayers)){const ft=Ae.rasterLayers.find((({id:Nt})=>Nt===Ie.sourceLayer));ft&&ft.fields&&ft.fields.range&&(Ot=ft.fields.range)}if(Ot=Ot||[0,1],it){ht.push("RASTER_COLOR"),je.activeTexture.set(Ce.TEXTURE2),Ie.updateColorRamp(Ot);let ft=Ie.colorRampTexture;ft||(ft=Ie.colorRampTexture=new i.T(je,Ie.colorRamp,Ce.RGBA8)),ft.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}return Ge&&ht.push("USE_MRT1"),{mix:ot,range:Ot,offset:Ye,defines:ht,resampling:gt}})(K,o,B,H,m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback");if(K instanceof i.aU&&!p.length&&!E)return;const J=o.paint.get("raster-emissive-strength"),se=m.colorModeForDrapableLayerRenderPass(J),ae=m.terrain&&m.terrain.renderingToTexture,he=!m.options.moving,de=o.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;if(K instanceof i.aU&&!p.length&&(K.onNorthPole||K.onSouthPole)){const Ae=j?m.stencilModeFor3D():Ji.disabled;return void $h(!!K.onNorthPole,null,m,t,o,J,Y,en.disabled,Ae)}if(!p.length)return;const[_e,we]=K instanceof i.aU||ae?[{},p]:m.stencilConfigForOverlap(p),ye=we[we.length-1].overscaledZ;O&&Y.defines.push("PROJECTION_GLOBE_VIEW"),j&&Y.defines.push("RENDER_CUTOFF");const Pe=(Ae,Ie,je)=>{for(const Ce of Ae){const Ge=Ce.toUnwrapped(),it=t.getTile(Ce);if(ae&&(!it||!it.hasData()))continue;B.activeTexture.set(H.TEXTURE0);const Ke=du(it,K,o,Y);if(!Ke||!Ke.texture)continue;const{texture:ht,mix:mt,offset:kt,tileSize:Ot,buffer:ot}=Ke;let Ye,gt;ae?(Ye=ji.disabled,gt=Ce.projMatrix):j?(Ye=new ji(H.LEQUAL,ji.ReadWrite,m.depthRangeFor3D),gt=E?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Ge,he)):(Ye=m.depthModeForSublayer(Ce.overscaledZ-ye,o.paint.get("raster-opacity")===1?ji.ReadWrite:ji.ReadOnly,H.LESS),gt=m.transform.calculateProjMatrix(Ge,he));const ft=m.terrain&&ae?m.terrain.stencilModeForRTTOverlap(Ce):_e[Ce.overscaledZ],Nt=T?0:o.paint.get("raster-fade-duration");it.registerFadeDuration(Nt);const ai=t.findLoadedParent(Ce,0),gi=zh(it,ai,t,m.transform,Nt);let Yt,zt;!gi.isFading&&it.refreshedUponExpiration&&(it.refreshedUponExpiration=!1),m.terrain&&m.terrain.prepareDrawTile(),B.activeTexture.set(H.TEXTURE0),ht.bind(de,H.CLAMP_TO_EDGE),B.activeTexture.set(H.TEXTURE1),ai?(ai.texture&&ai.texture.bind(de,H.CLAMP_TO_EDGE),Yt=Math.pow(2,ai.tileID.overscaledZ-it.tileID.overscaledZ),zt=[it.tileID.canonical.x*Yt%1,it.tileID.canonical.y*Yt%1]):ht.bind(de,H.CLAMP_TO_EDGE),"useMipmap"in ht&&B.extTextureFilterAnisotropic&&m.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const ki=m.transform;let wi;const di=j?ng(ki):[0,0,0,0];let yi,$i,hn,In,ea,Si=0;if(O&&K instanceof i.aU&&K.coordinates.length>3)yi=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0)))),$i=Float32Array.from(ki.globeMatrix),hn=Float32Array.from(i.dF(ki)),In=[i.aF(ki.center.lng),i.aJ(ki.center.lat)],wi=K.elevatedGlobePerspectiveTransform,ea=K.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const va=i.dG(Ce.canonical);Si=i.dH(va.getCenter().lat),yi=Float32Array.from(i.bk(i.dJ(Ce.canonical))),$i=Float32Array.from(ki.globeMatrix),hn=Float32Array.from(i.dF(ki)),In=[i.aF(ki.center.lng),i.aJ(ki.center.lat)],wi=[0,0],ea=Float32Array.from(i.dI(Ce.canonical,va,Si,ki.worldSize/ki._pixelsPerMercatorPixel))}else wi=K instanceof i.aU?K.perspectiveTransform:[0,0],yi=new Float32Array(16),$i=new Float32Array(9),hn=new Float32Array(16),In=[0,0],ea=new Float32Array(9);const ta=Ts(gt,yi,$i,hn,ea,zt||[0,0],i.aj(m.transform.zoom),In,di,Yt||1,gi,o,wi,j?o.paint.get("raster-elevation"):0,2,mt,kt,Y.range,Ot,ot,J),Zi=m.isTileAffectedByFog(Ce),ua=m.getOrCreateProgram("raster",{defines:Y.defines,overrideFog:Zi});if(m.uploadCommonUniforms(B,ua,Ge),K instanceof i.aU){const va=K.elevatedGlobeVertexBuffer,xa=K.elevatedGlobeIndexBuffer;if(ae||!E)K.boundsBuffer&&K.boundsSegments&&ua.draw(m,H.TRIANGLES,Ye,Ji.disabled,se,en.disabled,ta,o.id,K.boundsBuffer,m.quadTriangleIndexBuffer,K.boundsSegments);else if(va&&xa){const Nn=ki.zoom<=i.c_?K.elevatedGlobeSegments:K.getSegmentsForLongitude(ki.center.lng);Nn&&ua.draw(m,H.TRIANGLES,Ye,Ji.disabled,se,Ie,ta,o.id,va,xa,Nn)}}else if(O){Ye=new ji(H.LEQUAL,ji.ReadOnly,m.depthRangeFor3D);const va=m.globeSharedBuffers;if(va){const[xa,Nn,_n]=va.getGridBuffers(Si,!1);ua.draw(m,H.TRIANGLES,Ye,je||ft,m.colorModeForRenderPass(),Ie,ta,o.id,xa,Nn,_n)}}else{const{tileBoundsBuffer:va,tileBoundsIndexBuffer:xa,tileBoundsSegments:Nn}=m.getTileBoundsBuffers(it);ua.draw(m,H.TRIANGLES,Ye,ft,se,en.disabled,ta,o.id,va,xa,Nn)}}if(!(K instanceof i.aU)&&O)for(const Ce of Ae){const Ge=Ce.canonical.y===(1<<Ce.canonical.z)-1;Ce.canonical.y===0&&$h(!0,Ce,m,t,o,J,Y,Ie,je||Ji.disabled),Ge&&$h(!1,Ce,m,t,o,J,Y,Ie===en.frontCW?en.backCW:en.frontCW,je||Ji.disabled)}};O?Pe(we,m.renderElevatedRasterBackface?en.backCW:en.frontCW,m.stencilModeFor3D()):Pe(we,en.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,t,o,p,x,T){m.renderPass==="offscreen"&&(function(E,j,O,B){if(!B.length)return;const H=E.context,K=H.gl,Y=j.getSource();if(!(Y instanceof Qr))return;const J=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let se=O.particlePositionRGBAImage;if(!se||se.width!==J){const we=(function(ye){const Pe=ye*ye,Ae=new Uint8Array(4*Pe),Ie=function(Ce){return Ce|=0,Ce=Math.imul(2747636419^Ce,2654435769),Ce=Math.imul(Ce^Ce>>>16,2654435769),((Ce=Math.imul(Ce^Ce>>>16,2654435769))>>>0)/4294967296},je=1/1.1;for(let Ce=0;Ce<Pe;Ce++){const Ge=je*(Ie(2*Ce+0)+al),it=je*(Ie(2*Ce+1)+al),Ke=255*Ge%1,ht=255*it%1,mt=Ke,kt=it-ht/255,Ot=ht;Ae[4*Ce+0]=255*(Ge-Ke/255),Ae[4*Ce+1]=255*mt,Ae[4*Ce+2]=255*kt,Ae[4*Ce+3]=255*Ot}return Ae})(J);se=O.particlePositionRGBAImage=new i.q({width:J,height:J},we)}let ae=O.particleFramebuffer;ae?ae.width!==J&&(ae.destroy(),ae=O.particleFramebuffer=H.createFramebuffer(J,J,1,null)):ae=O.particleFramebuffer=H.createFramebuffer(J,J,1,null);const he=[];for(const we of B){const ye=j.getTile(we);if(!(ye instanceof rr))continue;const Pe=Zm(ye,Y,O);if(!Pe)continue;const Ae=[ye.tileSize,ye.tileSize];let Ie=O.tileFramebuffer;Ie||(Ie=O.tileFramebuffer=H.createFramebuffer(Ae[0],Ae[1],1,null));let je=ye.rasterParticleState;je||(je=ye.rasterParticleState=new Wm(H,we,Ae,se));const Ce=je.update(O.lastInvalidatedAt);je.particleTextureDimension!==J&&je.updateParticleTexture(we,se);const Ge=je.targetColorTexture;je.targetColorTexture=je.backgroundColorTexture,je.backgroundColorTexture=Ge;const it=je.particleTexture0;je.particleTexture0=je.particleTexture1,je.particleTexture1=it,he.push([we,Pe,je,Ce])}if(he.length===0)return;const de=i.o.now(),_e=O.previousDrawTimestamp?.001*(de-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=de,O.hasColorMap()){H.activeTexture.set(K.TEXTURE0+2);let we=O.colorRampTexture;we||(we=O.colorRampTexture=new i.T(H,O.colorRamp,K.RGBA8)),we.bind(K.LINEAR,K.CLAMP_TO_EDGE)}H.bindFramebuffer.set(O.tileFramebuffer.framebuffer),(function(we,ye,Pe){const Ae=we.context,Ie=Ae.gl,je=ye.tileFramebuffer;Ae.activeTexture.set(Ie.TEXTURE0);const Ce={u_texture:0,u_opacity:1.05*(it=ye.paint.get("raster-particle-fade-opacity-factor"))/(it+.05)},Ge=we.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var it;for(const Ke of Pe){const[,,ht,mt]=Ke;je.colorAttachment0.set(ht.targetColorTexture.texture),Ae.viewport.set([0,0,je.width,je.height]),Ae.clear({color:i.ao.transparent}),mt&&(ht.backgroundColorTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE),Ge.draw(we,Ie.TRIANGLES,ji.disabled,Ji.disabled,on.alphaBlended,en.disabled,Ce,ye.id,we.viewportBuffer,we.quadTriangleIndexBuffer,we.viewportSegments))}})(E,O,he),(function(we,ye,Pe,Ae){const Ie=we.context,je=Ie.gl,Ce=Pe.tileFramebuffer,Ge=we.transform.projection.name==="globe",it=Pe.paint.get("raster-particle-max-speed");for(const Ke of Ae){const[ht,mt,kt]=Ke;Ie.activeTexture.set(je.TEXTURE0+0),mt.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE),Ce.colorAttachment0.set(kt.targetColorTexture.texture);const Ot=we.getOrCreateProgram("rasterParticleDraw",{defines:mt.defines,overrideFog:!1});Ie.activeTexture.set(je.TEXTURE0+1);const ot=mt.scalarData?[]:[0,1,2,3].map((ft=>i.e9[ft](ht)));ot.push(ht);const Ye=ht.canonical.x,gt=ht.canonical.y;for(const ft of ot){const Nt=ye.getTile(Ge?ft.wrapped():ft);if(!Nt)continue;const ai=Nt.rasterParticleState;if(!ai)continue;const gi=ft.canonical.x+(1<<ft.canonical.z)*(ft.wrap-ht.wrap),Yt=ft.canonical.y;ai.particleTexture0.bind(je.NEAREST,je.CLAMP_TO_EDGE);const zt=Um(1,ai.particleTexture0.size[0],[gi-Ye,Yt-gt],0,mt.texture.size,2,it,mt.textureOffset,mt.scale,mt.offset);Ot.draw(we,je.POINTS,ji.disabled,Ji.disabled,on.alphaBlended,en.disabled,zt,Pe.id,ai.particleIndexBuffer,void 0,ai.particleSegment)}}})(E,j,O,he),H.bindFramebuffer.set(O.particleFramebuffer.framebuffer),(function(we,ye,Pe,Ae){const Ie=we.context,je=Ie.gl,Ce=ye.paint.get("raster-particle-max-speed"),Ge=Ae*ye.paint.get("raster-particle-speed-factor")*.15,it=(function(ht){return Math.pow(ht,6)})(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),Ke=ye.particleFramebuffer;Ie.viewport.set([0,0,Ke.width,Ke.height]);for(const ht of Pe){const[,mt,kt]=ht;Ie.activeTexture.set(je.TEXTURE0+0),mt.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE),Ie.activeTexture.set(je.TEXTURE0+1);const Ot=kt.particleTexture0;Ot.bind(je.NEAREST,je.CLAMP_TO_EDGE);const ot=Fh(1,Ot.size[0],0,mt.texture.size,Ce,Ge,it,mt.textureOffset,mt.scale,mt.offset);Ke.colorAttachment0.set(kt.particleTexture1.texture),Ie.clear({color:i.ao.transparent}),we.getOrCreateProgram("rasterParticleUpdate",{defines:mt.defines}).draw(we,je.TRIANGLES,ji.disabled,Ji.disabled,on.unblended,en.disabled,ot,ye.id,we.viewportBuffer,we.quadTriangleIndexBuffer,we.viewportSegments)}})(E,O,he,_e)})(m,t,o,p),m.renderPass==="translucent"&&((function(E,j,O,B,H){const K=E.context,Y=K.gl,J=j.getSource().tileSize,se=5*(1-i.ah(i.cL,i.cL+1,E.transform.zoom))*J+O.paint.get("raster-particle-elevation"),ae=!E.options.moving,he=E.transform.projection.name==="globe";if(!B.length)return;const[de,_e]=E.stencilConfigForOverlap(B),we=[];he&&we.push("PROJECTION_GLOBE_VIEW");const ye=E.stencilModeFor3D();for(const Pe of _e){const Ae=Pe.toUnwrapped(),Ie=j.getTile(Pe);if(!Ie.rasterParticleState)continue;const je=Ie.rasterParticleState,Ce=100;Ie.registerFadeDuration(Ce);const Ge=j.findLoadedParent(Pe,0),it=zh(Ie,Ge,j,E.transform,Ce);let Ke,ht;E.terrain&&E.terrain.prepareDrawTile(),K.activeTexture.set(Y.TEXTURE0),je.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),K.activeTexture.set(Y.TEXTURE1),Ge&&Ge.rasterParticleState?(Ge.rasterParticleState.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Ke=Math.pow(2,Ge.tileID.overscaledZ-Ie.tileID.overscaledZ),ht=[Ie.tileID.canonical.x*Ke%1,Ie.tileID.canonical.y*Ke%1]):je.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const mt=he?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ae,ae),kt=E.transform,Ot=ih(kt),ot=i.dG(Pe.canonical),Ye=i.dH(ot.getCenter().lat);let gt,ft,Nt,ai,gi;he?(gt=Float32Array.from(i.bk(i.dJ(Pe.canonical))),ft=Float32Array.from(kt.globeMatrix),Nt=Float32Array.from(i.dF(kt)),ai=[i.aF(kt.center.lng),i.aJ(kt.center.lat)],gi=Float32Array.from(i.dI(Pe.canonical,ot,Ye,kt.worldSize/kt._pixelsPerMercatorPixel))):(gt=new Float32Array(16),ft=new Float32Array(9),Nt=new Float32Array(16),ai=[0,0],gi=new Float32Array(9));const Yt=Qd(mt,gt,ft,Nt,gi,ht||[0,0],i.aj(E.transform.zoom),ai,Ot,Ke||1,it,se),zt=E.isTileAffectedByFog(Pe),ki=E.getOrCreateProgram("rasterParticle",{defines:we,overrideFog:zt});if(E.uploadCommonUniforms(K,ki,Ae),he){const wi=new ji(Y.LEQUAL,ji.ReadOnly,E.depthRangeFor3D),di=0,yi=E.globeSharedBuffers;if(yi){const[$i,hn,In]=yi.getGridBuffers(Ye,di!==0);ki.draw(E,Y.TRIANGLES,wi,ye,on.alphaBlended,E.renderElevatedRasterBackface?en.frontCCW:en.backCCW,Yt,O.id,$i,hn,In)}}else{const wi=E.depthModeForSublayer(0,ji.ReadOnly),di=de[Pe.overscaledZ],{tileBoundsBuffer:yi,tileBoundsIndexBuffer:$i,tileBoundsSegments:hn}=E.getTileBoundsBuffers(Ie);ki.draw(E,Y.TRIANGLES,wi,di,on.alphaBlended,en.disabled,Yt,O.id,yi,$i,hn)}}E.resetStencilClippingMasks()})(m,t,o,p),m.style.map.triggerRepaint())},background:function(m,t,o,p){const x=o.paint.get("background-color"),T=o.paint.get("background-color-use-theme").constantOr("default")==="none",E=o.paint.get("background-opacity"),j=o.paint.get("background-emissive-strength"),O=o.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const B=m.context,H=B.gl,K=m.transform,Y=K.tileSize,J=o.paint.get("background-pattern");let se;if(J!==void 0&&(J===null||(se=m.imageManager.getPattern(i.I.from(J.toString()),o.scope,m.style.getLut(o.scope)),!se)))return;const ae=!J&&x.a===1&&E===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ae)return;const he=Ji.disabled,de=m.depthModeForSublayer(0,ae==="opaque"?ji.ReadWrite:ji.ReadOnly),_e=m.colorModeForDrapableLayerRenderPass(j),we=J?"backgroundPattern":"background";let ye,Pe=p;Pe||(ye=m.getBackgroundTiles(),Pe=Object.values(ye).map((Ie=>Ie.tileID))),J&&(B.activeTexture.set(H.TEXTURE0),m.imageManager.bind(m.context,o.scope));const Ae=[];if(m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&Ae.push("USE_MRT1"),O){const Ie=m.getOrCreateProgram(we,{overrideFog:!1,overrideRtt:!0,defines:Ae}),je=new Float32Array(i.bA([])),Ce=new i.aQ(0,0,0,0,0),Ge=J?lu(je,j,E,m,0,o.scope,se,O,{tileID:Ce,tileSize:Y}):qr(je,j,E,x.toPremultipliedRenderColor(T?null:o.lut));Ie.draw(m,H.TRIANGLES,de,he,_e,en.disabled,Ge,o.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Ie of Pe){const je=m.isTileAffectedByFog(Ie),Ce=m.getOrCreateProgram(we,{overrideFog:je,defines:Ae}),Ge=Ie.toUnwrapped(),it=p?Ie.projMatrix:m.transform.calculateProjMatrix(Ge);m.prepareDrawTile();const Ke=t?t.getTile(Ie):ye?ye[Ie.key]:new Ys(Ie,Y,K.zoom,m),ht=J?lu(it,j,E,m,0,o.scope,se,O,{tileID:Ie,tileSize:Y}):qr(it,j,E,x.toPremultipliedRenderColor(T?null:o.lut));m.uploadCommonUniforms(B,Ce,Ge);const{tileBoundsBuffer:mt,tileBoundsIndexBuffer:kt,tileBoundsSegments:Ot}=m.getTileBoundsBuffers(Ke);Ce.draw(m,H.TRIANGLES,de,he,_e,en.disabled,ht,o.id,mt,kt,Ot)}},sky:function(m,t,o){const p=m._atmosphere?i.aj(m.transform.zoom):1,x=o.paint.get("sky-opacity")*p;if(x===0)return;const T=m.context,E=o.paint.get("sky-type"),j=new ji(T.gl.LEQUAL,ji.ReadOnly,[0,1]),O=m.frameCounter/1e3%1;E==="atmosphere"?m.renderPass==="offscreen"?o.needsSkyboxCapture(m)&&((function(B,H,K,Y){const J=B.context,se=J.gl;let ae=H.skyboxFbo;if(!ae){ae=H.skyboxFbo=J.createFramebuffer(32,32,1,null),H.skyboxGeometry=new Vh(J),H.skyboxTexture=J.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,H.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let we=0;we<6;++we)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+we,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(ae.framebuffer),J.viewport.set([0,0,32,32]);const he=H.getCenter(B,!0),de=B.getOrCreateProgram("skyboxCapture"),_e=new Float64Array(16);i.bA(_e),i.en(_e,_e,.5*-Math.PI),Td(B,H,de,_e,he,0),i.bA(_e),i.en(_e,_e,.5*Math.PI),Td(B,H,de,_e,he,1),i.bA(_e),i.cU(_e,_e,.5*-Math.PI),Td(B,H,de,_e,he,2),i.bA(_e),i.cU(_e,_e,.5*Math.PI),Td(B,H,de,_e,he,3),i.bA(_e),Td(B,H,de,_e,he,4),i.bA(_e),i.en(_e,_e,Math.PI),Td(B,H,de,_e,he,5),J.viewport.set([0,0,B.width,B.height])})(m,o),o.markSkyboxValid(m)):m.renderPass==="sky"&&(function(B,H,K,Y,J){const se=B.context,ae=se.gl,he=B.transform,de=B.getOrCreateProgram("skybox");se.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_CUBE_MAP,H.skyboxTexture);const _e=((we,ye,Pe,Ae,Ie)=>({u_matrix:we,u_sun_direction:ye,u_cubemap:0,u_opacity:Ae,u_temporal_offset:Ie}))(he.skyboxMatrix,H.getCenter(B,!1),0,Y,J);B.uploadCommonUniforms(se,de),de.draw(B,ae.TRIANGLES,K,Ji.disabled,B.colorModeForRenderPass(),en.backCW,_e,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)})(m,o,j,x,O):E==="gradient"&&m.renderPass==="sky"&&(function(B,H,K,Y,J){const se=B.context,ae=se.gl,he=B.transform,de=B.getOrCreateProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new Vh(se)),se.activeTexture.set(ae.TEXTURE0);let _e=H.colorRampTexture;_e||(_e=H.colorRampTexture=new i.T(se,H.colorRamp,ae.RGBA8)),_e.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const we=((ye,Pe,Ae,Ie,je)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Pe,u_radius:i.an(Ae),u_opacity:Ie,u_temporal_offset:je}))(he.skyboxMatrix,H.getCenter(B,!1),H.paint.get("sky-gradient-radius"),Y,J);B.uploadCommonUniforms(se,de),de.draw(B,ae.TRIANGLES,K,Ji.disabled,B.colorModeForRenderPass(),en.backCW,we,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)})(m,o,j,x,O)},custom:function(m,t,o,p){const x=m.context,T=o.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&o.isDraped(t)){if(m.renderPass==="offscreen"){const E=T.prerender;if(E){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const j=m.transform.pointMerc;E.call(T,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.aj(m.transform.zoom),[j.x,j.y],m.transform.pixelsPerMeterRatio)}else E.call(T,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const j=T.renderToTile;if(j){const O=p[0].canonical,B={x:O.x+p[0].wrap*(T.wrapTileId?0:1<<O.z),y:O.y,z:O.z};x.setDepthMode(ji.disabled),x.setStencilMode(Ji.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),j.call(T,x.gl,B),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(Ji.disabled);const E=T.renderingMode==="3d"?new ji(m.context.gl.LEQUAL,ji.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,ji.ReadOnly);if(x.setDepthMode(E),m.transform.projection.name==="globe"){const j=m.transform.pointMerc;T.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.aj(m.transform.zoom),[j.x,j.y],m.transform.pixelsPerMeterRatio)}else T.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,t,o,p){if(m.renderPass==="opaque")return;const x=o.paint.get("model-opacity").constantOr(1),T=o.paint.get("model-elevation-reference"),E=T==="ground",j=T==="ground";if(x===0)return;const O=o.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!O||m.terrain&&x<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const B=m.shadowRenderer,H=o.paint.get("model-receive-shadows");B&&(B.useNormalOffset=!0,H||(B.enabled=!1));const K=()=>{B&&(B.useNormalOffset=!0,H||(B.enabled=!0))},Y=t.getSource();if(m.renderPass==="light-beam"&&Y.type!=="batched-model")return;if(Y.type==="vector"||Y.type==="geojson")return(function(ye,Pe,Ae,Ie,je){const Ce=ye.transform,Ge=Ce.projection.name==="globe",it=Ce.getFreeCameraOptions().position;if(!ye.modelManager)return;const Ke=ye.modelManager;Ae.modelManager=Ke;const ht=ye.shadowRenderer;if(!Ae._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const mt=Ae._unevaluatedLayout._values["model-id"],kt=Object.assign({},Ae.layout.get("model-id").parameters),Ot=ye.style.order.indexOf(Ae.fqid),ot=Ae.paint.get("model-opacity").constantOr(1);for(const Ye of Ie){const gt=Pe.getTile(Ye).getBucket(Ae);if(!gt||gt.projection.name!==Ce.projection.name)continue;const ft=gt.getModelUris();if(ft&&!gt.modelsRequested&&(Ke.addModelsFromBucket(ft,je),gt.modelsRequested=!0),Ge)kt.zoom=Ye.overscaledZ;else{const di=Eo(Ye,Ce);kt.zoom=di}const Nt=mt.possiblyEvaluate(kt);if(cg(ye,gt,Ye),Hl.shadowUniformsInitialized=!1,Hl.useSingleShadowCascade=!!ht&&ht.getMaxCascadeForTile(Ye.toUnwrapped())===0,ye.renderPass==="shadow"&&ht){if(ye.currentShadowCascade===1&&gt.isInsideFirstShadowMapFrustum)continue;const di=Ce.calculatePosMatrix(Ye.toUnwrapped(),Ce.worldSize);if(Hl.tileMatrix.set(di),Hl.shadowTileMatrix=Float32Array.from(ht.calculateShadowPassMatrixFromMatrix(di)),Hl.aabb.min=[0,0,0],Hl.aabb.max[0]=Hl.aabb.max[1]=i.al,Hl.aabb.max[2]=0,qh(gt,Hl,ye,Ae.scope))continue}const ai=1<<Ye.canonical.z,gi=[((it.x-Ye.wrap)*ai-Ye.canonical.x)*i.al,(it.y*ai-Ye.canonical.y)*i.al,it.z*ai*i.al];ye.conflationActive&&Object.keys(gt.instancesPerModel).length>0&&ye.style.isLayerClipped(Ae,Pe.getSource())&&gt.updateReplacement(Ye,ye.replacementSource,Ot,Ae.scope)&&(gt.uploaded=!1,gt.upload(ye.context));let Yt=0;const zt=new Array,ki=new Array,wi=new Array;for(let di in gt.instancesPerModel){const yi=gt.instancesPerModel[di];yi.features.length>0&&!Ge&&(di=Nt.evaluate(yi.features[0].feature,{}));const $i=Ke.getModel(di,je);if($i||Ke.hasURLBeenRequested(di)||gt.modelUris.includes(di)||(gt.modelUris.push(di),gt.modelsRequested=!1),$i&&$i.uploaded)if(Ge){const hn=i.c5([],[it.x,it.y,it.z],ye.transform.worldSize);i.ew(hn,hn);for(let In=0;In<yi.instancedDataArray.length;++In){const ea=[0,0,0],Si=[1,1,1],ta=i.ex(),Zi=yi.tileCoordinatesForInstance(In),ua=yi.transformForInstance(In);i.ey(Si,ua),i.ez(ta,ua),i.eA(ea,ta);const va=yi.translationForInstance(In),xa=new i.aT(0,0);i.eB(gt.canonical,xa,Zi.x,Zi.y);const Nn=i.bC();i.eC(Nn,$i,ye.transform,xa,ea,Si,va,!0,!1,!1);const _n=yi.colorForInstance(In),na=i.bA([]),Ga=i.ef(xa.lat,ye.transform.zoom),Ya=i.bq([],[1,1,1/Ga]);i.br(na,na,hn),wi.push({zScaleMatrix:Ya,negCameraPosMatrix:na});for(const da of $i.nodes)kd(ye,da,Nn,ye.transform.expandedFarZProjMatrix,Yt,zt,ki,$i.materialOverrides,ot,_n);++Yt}}else for(const hn of $i.nodes)ug(ye,Ae,hn,yi,gi,Ye,Hl)}if(Ge)if(ye.renderPass==="shadow"){for(const di of ki)ol(di.mesh,di.nodeModelMatrix,ye,Ae);for(const di of zt)ol(di.mesh,di.nodeModelMatrix,ye,Ae)}else lg(ye,Ae,zt,ki,wi)}})(m,t,o,p,Zf(m,o)),void K();if(!Y.loaded())return;if(Y.type==="batched-model")return(function(ye,Pe,Ae,Ie){Ae.resetLayerRenderingStats(ye);const je=ye.context,Ce=ye.transform,Ge=ye.style.fog,it=ye.shadowRenderer;if(Ce.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Ce.projection.name} projection is not yet implemented`);const Ke=ye.transform.getFreeCameraOptions().position,ht=i.c5([],[Ke.x,Ke.y,Ke.z],ye.transform.worldSize),mt=i.ew([],ht),kt=i.bA([]),Ot=i.ef(Ce.center.lat,Ce.zoom),ot=i.bq([],[1,1,1/Ot]);i.br(kt,kt,mt);const Ye=Ae.paint.get("model-opacity").constantOr(1),gt=new ji(je.gl.LEQUAL,ji.ReadWrite,ye.depthRangeFor3D),ft=new ji(je.gl.LEQUAL,ji.ReadOnly,ye.depthRangeFor3D),Nt=new i.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ai=ye.renderPass==="shadow",gi=ai&&it?it.getCurrentCascadeFrustum():Ce.getFrustum(Ce.scaleZoom(Ce.worldSize)),Yt=Ae.paint.get("model-front-cutoff"),zt=Yt[2]<1,ki=yl(ye,Ae.paint.get("model-cutoff-fade-range")),wi=Ae.getLayerRenderingStats();(function(di,yi,$i,hn){const In=di.terrain?di.terrain.exaggeration():0,ea=di.transform.zoom;for(const Si of hn){const ta=yi.getTile(Si).getBucket($i);ta&&(ta.setFilter($i.filter),di.conflationActive&&ta.updateReplacement(Si,di.replacementSource),ta.evaluateTransform(di,$i),di.terrain&&In>0&&ta.elevationUpdate(di.terrain,In,Si,$i.source),ta.needsReEvaluation(di,ea,$i)&&ta.evaluate($i))}})(ye,Pe,Ae,Ie),(function(){let di,yi,$i;zt?(di=Ie.length-1,yi=-1,$i=-1):(di=0,yi=Ie.length,$i=1);const hn=new Float64Array(16),In=i.cA(),ea=new i.P(0,0);for(let Si=di;Si!==yi;Si+=$i){const ta=Ie[Si],Zi=Pe.getTile(ta).getBucket(Ae);if(!Zi||!Zi.uploaded)continue;let ua=!1;it&&(ua=it.getMaxCascadeForTile(ta.toUnwrapped())===0);const va=Ce.calculatePosMatrix(ta.toUnwrapped(),Ce.worldSize),xa=Zi.modelTraits;!ai&&zt&&(i.bl(hn,va),i.af(In,ht,hn),ea.x=In[0],ea.y=In[1]);const Nn=[];Zi.setFilter(Ae.filter);for(const _n of Zi.getNodesInfo()){if(_n.hiddenByReplacement||!_n.node.meshes)continue;const na=_n.node;let Ga=0;ye.terrain&&na.elevation&&(Ga=na.elevation*ye.terrain.exaggeration());const Ya=(()=>{const ks=_n.aabb;return Nt.min=[...ks.min],Nt.max=[...ks.max],Nt.min[2]+=Ga,Nt.max[2]+=Ga,i.af(Nt.min,Nt.min,va),i.af(Nt.max,Nt.max,va),Nt})(),da=_n.evaluatedScale;if(da[0]<=1&&da[1]<=1&&da[2]<=1&&Ya.intersects(gi)===0)continue;if(!ai&&zt){const ks=.16666666666666666;_n.cameraCollisionOpacity=ht[0]>Ya.min[0]&&ht[0]<Ya.max[0]&&ht[1]>Ya.min[1]&&ht[1]<Ya.max[1]&&ht[2]*Ot<Ya.max[2]&&na.footprint&&i.c0(ea,na.footprint)?Math.max(_n.cameraCollisionOpacity-ks,0):Math.min(1,_n.cameraCollisionOpacity+ks)}const Xn=[...va],xn=1/i.d7(ta.canonical),Ua=na.anchor?na.anchor[0]:0,kr=na.anchor?na.anchor[1]:0;i.br(Xn,Xn,[Ua*(da[0]-1)+_n.evaluatedTranslation[0]*xn,kr*(da[1]-1)+_n.evaluatedTranslation[1]*xn,Ga+_n.evaluatedTranslation[2]]),i.cq(da,i.eE)||i.cS(Xn,Xn,da);const cr=i.aB([],Xn,na.globalMatrix),Ra=i.aB([],Ce.expandedFarZProjMatrix,cr),Co=i.aB([],Ce.expandedFarZProjMatrix,Xn),Ns=i.aC([],[Ua,kr,Ga,1],Ra)[2];na.hidden=!1;let Ar=Ye;ai||(zt&&(Ar*=_n.cameraCollisionOpacity,Ar*=Ln(Xn,Ce,_n.aabb,Yt)),Ar*=Ba(ki,Ns)),Ar!==0?Nn.push({nodeInfo:_n,depth:Ns,opacity:Ar,wvpForNode:Ra,wvpForTile:Co,nodeModelMatrix:cr,tileModelMatrix:Xn}):na.hidden=!0}ai||Nn.sort(((_n,na)=>!zt||_n.opacity===1&&na.opacity===1?_n.depth<na.depth?-1:1:_n.opacity===1?-1:na.opacity===1?1:_n.depth>na.depth?-1:1));for(const _n of Nn){const na=_n.nodeInfo,Ga=na.node;let Ya=i.aB([],ot,_n.tileModelMatrix);i.aB(Ya,kt,Ya);const da=i.bl([],Ya);i.eg(da,da),i.cS(da,da,Yf),Ya=i.aB(Ya,Ya,Ga.globalMatrix);const Xn=ye.renderPass==="light-beam",xn=Ae.paint.get("model-color-use-theme").constantOr("default")==="none",Ua=xa&i.eI.HasMapboxMeshFeatures,kr=Ua?0:na.evaluatedRMEA[0][2];for(let cr=0;cr<Ga.meshes.length;++cr){const Ra=Ga.meshes[cr],Co=cr===Ga.lightMeshIndex;let Ns=_n.wvpForNode;if(Co){if(!Xn&&!ye.terrain&&ye.shadowRenderer){ye.currentLayer<ye.firstLightBeamLayer&&(ye.firstLightBeamLayer=ye.currentLayer);continue}Ns=_n.wvpForTile}else if(Xn)continue;const Ar={defines:[]},ks=[];if(!ai&&it&&(it.useNormalOffset=!!Ra.normalBuffer),Wf(Ar.defines,ks,Ra,ye,xn?null:Ae.lut),Ua||Ar.defines.push("DIFFUSE_SHADED"),ua&&Ar.defines.push("SHADOWS_SINGLE_CASCADE"),wi&&(ai?wi.numRenderedVerticesInShadowPass+=Ra.vertexArray.length:wi.numRenderedVerticesInTransparentPass+=Ra.vertexArray.length),ai){ol(Ra,_n.nodeModelMatrix,ye,Ae);continue}let no=null;if(Ge){const _r=qf(_n.nodeModelMatrix,ye.transform);if(no=new Float32Array(_r),Ce.projection.name!=="globe"){const Ca=Ra.aabb.min,Pr=Ra.aabb.max,[Fn,nr]=Ge.getOpacityForBounds(_r,Ca[0],Ca[1],Pr[0],Pr[1]);Ar.overrideFog=Fn>=Tt||nr>=Tt}}const Es=Ra.material;let Cl;Es.occlusionTexture&&Es.occlusionTexture.offsetScale&&(Cl=Es.occlusionTexture.offsetScale,Ar.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Xl=ye.getOrCreateProgram("model",Ar);!ai&&it&&it.setupShadowsFromMatrix(_n.tileModelMatrix,Xl,it.useNormalOffset),ye.uploadCommonUniforms(je,Xl,null,no);const Vo=Es.pbrMetallicRoughness;Vo.metallicFactor=.9,Vo.roughnessFactor=.5;const hr=xd(new Float32Array(Ns),new Float32Array(Ya),new Float32Array(da),new Float32Array(Ga.globalMatrix),ye,_n.opacity,Vo.baseColorFactor,Es.emissiveFactor,Vo.metallicFactor,Vo.roughnessFactor,Es,kr,Ae,[0,0,0],Cl);!Co&&(na.hasTranslucentParts||_n.opacity<1)&&Xl.draw(ye,je.gl.TRIANGLES,gt,Ji.disabled,on.disabled,en.backCCW,hr,Ae.id,Ra.vertexBuffer,Ra.indexBuffer,Ra.segments,Ae.paint,ye.transform.zoom,void 0,ks),Xl.draw(ye,je.gl.TRIANGLES,Co?ft:gt,Ji.disabled,Co||_n.opacity<1||na.hasTranslucentParts?on.alphaBlended:on.unblended,en.backCCW,hr,Ae.id,Ra.vertexBuffer,Ra.indexBuffer,Ra.segments,Ae.paint,ye.transform.zoom,void 0,ks)}}}})()})(m,t,o,p),void K();if(Y.type!=="model")return;const J=Y.getModels(),se=[],ae=m.transform.getFreeCameraOptions().position,he=i.c5([],[ae.x,ae.y,ae.z],m.transform.worldSize);i.ew(he,he);const de=[],_e=[];let we=0;for(const ye of J){const Pe=t.getFeatureState("",ye.id),Ae={type:"Unknown",id:ye.id,properties:ye.featureProperties},Ie=o.paint.get("model-rotation").evaluate(Ae,Pe),je=o.paint.get("model-scale").evaluate(Ae,Pe),Ce=o.paint.get("model-translation").evaluate(Ae,Pe),Ge=o.paint.get("model-opacity").evaluate(Ae,Pe);Km(o,ye.id,Pe,ye.featureProperties,ye.nodeOverrideNames,ye.nodeOverrides),Xf(o,ye.id,Pe,ye.featureProperties,ye.materialOverrideNames,ye.materialOverrides),ye.nodeOverrides.size>0&&ye.computeBoundsAndApplyParent(),ye.computeModelMatrix(m,Ie,je,Ce,j,E,!1);const it=i.bA([]),Ke=i.ef(ye.position.lat,m.transform.zoom),ht=i.bq([],[1,1,1/Ke]);i.br(it,it,he),se.push({zScaleMatrix:ht,negCameraPosMatrix:it});for(const mt of ye.nodes)kd(m,mt,ye.matrix,m.transform.expandedFarZProjMatrix,we,de,_e,ye.materialOverrides,Ge);we++}if(de.sort(((ye,Pe)=>Pe.depth-ye.depth)),m.renderPass!=="shadow")lg(m,o,de,_e,se),K();else{for(const ye of _e)ol(ye.mesh,ye.nodeModelMatrix,m,o);for(const ye of de)ol(ye.mesh,ye.nodeModelMatrix,m,o);K()}}},Jf={line:function(m,t,o){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const p=t.getVisibleCoordinates();for(const x of p){const T=t.getTile(x).getBucket(m);if(T&&(T.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,t,o){const p=t.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,Zf(o,m)));if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const T of x)T.upload(o.context)},raster:function(m,t,o){const p=t.getSource();if(!(p instanceof Qr&&p.loaded()))return;const x=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const T=m.paint.get("raster-array-band")||p.getInitialBand(x);if(T==null)return;const E=t.getIds().map((j=>t.getTileByID(j)));for(const j of E)j.updateNeeded(m.id,T)&&p.prepareTile(j,x,m.id,T)},"raster-particle":function(m,t,o){const p=t.getSource();if(!(p instanceof Qr&&p.loaded()))return;const x=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const T=m.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(T==null)return;const E=t.getIds().map((j=>t.getTileByID(j)));for(const j of E)j.updateNeeded(m.id,T)&&p.prepareTile(j,x,m.id,T)}},kl={fill:Ff},fu={fill:function(m,t,o,p){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;const x=m.context.gl,T=new ji(x.LEQUAL,ji.ReadOnly,m.depthRangeFor3D),E=new Ji({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),j=m.transform.getFreeCameraOptions().position,O=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const B of p){const H=t.getTile(B),K=H.getBucket(o);if(!K)continue;const Y=K.elevatedStructures;if(!Y||Y.depthSegments.segments[0].primitiveLength===0)continue;const J=eg(B.toUnwrapped(),j),se=m.translatePosMatrix(B.projMatrix,H,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),ae=yd(se,J,0,1,0);O.draw(m,x.TRIANGLES,T,E,on.disabled,en.disabled,ae,o.id,Y.vertexBuffer,Y.indexBuffer,Y.depthSegments,o.paint,m.transform.zoom)}}};class rh{constructor(t,o,p,x,T){this.context=new Wr(t,o),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const O of E)this._debugParams.enabledLayers[O]=!0;for(const O of E);this.occlusionParams=new nh,this.setup(),this.numSublayers=hs.maxUnderzooming+hs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new vl(this),this._wireframeDebugCache=new Pc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const j=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,j,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=T,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,o){const p=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new jf(this,t));const x=this._terrain;this.transform.elevation=p?x:null,x.update(t,this.transform,o),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(t){const o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=o.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const T=p+.78*(x-p);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new jf(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*i.o.devicePixelRatio,this.height=o*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const t=this.context,o=new i.bd;o.emplaceBack(0,0),o.emplaceBack(i.al,0),o.emplaceBack(0,i.al),o.emplaceBack(i.al,i.al),this.tileExtentBuffer=t.createVertexBuffer(o,i.bf.members),this.tileExtentSegments=i.bg.simpleSegment(0,0,4,2);const p=new i.bd;p.emplaceBack(0,0),p.emplaceBack(i.al,0),p.emplaceBack(0,i.al),p.emplaceBack(i.al,i.al),this.debugBuffer=t.createVertexBuffer(p,i.bf.members),this.debugSegments=i.bg.simpleSegment(0,0,4,5);const x=new i.bd;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(x,i.bf.members),this.viewportSegments=i.bg.simpleSegment(0,0,4,2);const T=new i.b1;T.emplaceBack(0,0,0,0),T.emplaceBack(i.al,0,i.al,0),T.emplaceBack(0,i.al,0,i.al),T.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=t.createVertexBuffer(T,i.bi.members),this.mercatorBoundsSegments=i.bg.simpleSegment(0,0,4,2);const E=new i.b0;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const j=new i.be;for(const B of[0,1,3,2,0])j.emplaceBack(B);this.debugIndexBuffer=t.createIndexBuffer(j),this.emptyTexture=new i.T(t,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=i.bC();const O=this.context.gl;this.stencilClearMode=new Ji({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ji.disabled,this.stencilClearMode,on.disabled,en.disabled,pd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,p){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let j=!1;for(const O of p)if(this._tileClippingMaskIDs[O.key]===void 0){j=!0;break}if(!j)return}this.currentStencilSource=o.id;const x=this.context,T=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(on.disabled),x.setDepthMode(ji.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const j of p){const O=o.getTile(j),B=this._tileClippingMaskIDs[j.key]=this.nextStencilID++,{tileBoundsBuffer:H,tileBoundsIndexBuffer:K,tileBoundsSegments:Y}=this.getTileBoundsBuffers(O);E.draw(this,T.TRIANGLES,ji.disabled,new Ji({func:T.ALWAYS,mask:0},B,255,T.KEEP,T.KEEP,T.REPLACE),on.disabled,en.disabled,pd(j.projMatrix),"$clipping",H,K,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new Ji({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new Ji({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,p=t.sort(((E,j)=>j.overscaledZ-E.overscaledZ)),x=p[p.length-1].overscaledZ,T=p[0].overscaledZ-x+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const E={};for(let j=0;j<T;j++)E[j+x]=new Ji({func:o.GEQUAL,mask:255},j+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=T,[E,p]}return[{[x]:Ji.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new on([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?on.unblended:on.alphaBlended}colorModeForDrapableLayerRenderPass(t){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new on([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new on([o.ONE,o.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,o.ONE_MINUS_SRC_ALPHA],i.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,o,p,x=!1){if(this.depthOcclusion)return new ji(this.context.gl.GREATER,ji.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return ji.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ji(p||this.context.gl.LEQUAL,o,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,o=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),T=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&p!==0&&(this.depthFBO=new rl(this.context,o,p,0,"texture"),this.depthTexture=new i.T(this.context,{width:o,height:p,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),t.bindTexture(t.TEXTURE_2D,T),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,p,0,0,o,p,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,o)=>t+o/this._fpsHistory.length),0))}render(t,o){const p=i.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;const x=this.style._mergedLayers,T=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(T).filter((ot=>{const Ye=x[ot];return!(Ye.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ye.type]}));let j=E(),O=!1,B=!1,H=null,K=0,Y=!1;for(const ot of j){const Ye=x[ot];Ye.visibility!=="none"&&(Ye.type==="circle"?O=!0:Ye.type==="building"?(H=Ye,++K):Ye.type==="symbol"&&(Ye.hasOcclusionOpacityProperties?B=!0:O=!0))}this.updateEmissiveMode();let J=j.map((ot=>x[ot]));const se=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();for(const ot in se){const Ye=se[ot];Ye.used&&(Ye.prepare(this.context),Ye.getSource().usedInConflation&&++K)}let ae=!1;for(const ot of J)ot.isHidden(this.transform.zoom)||(ot.type==="clip"&&(ae=!0),this.prepareLayer(ot));const he={},de={},_e={},we={},ye={};for(const ot in se){const Ye=se[ot];he[ot]=Ye.getVisibleCoordinates(),de[ot]=he[ot].slice().reverse(),_e[ot]=Ye.getVisibleCoordinates(!0).reverse(),we[ot]=Ye.getShadowCasterCoordinates(),ye[ot]=Ye.sortCoordinatesByDistance(he[ot])}const Pe=ot=>{const Ye=this.style.getLayerSourceCache(ot);return Ye&&Ye.used?Ye.getSource():null};if(K||ae||this._clippingActiveLastFrame){const ot=[],Ye=[];let gt=0;for(const ft of J)this.isSourceForClippingOrConflation(ft,Pe(ft))&&(ot.push(ft),Ye.push(gt)),gt++;if(ot&&(ae||ot.length>1)||this._clippingActiveLastFrame){ae=!1;const ft=[];for(let Nt=0;Nt<ot.length;Nt++){const ai=ot[Nt],gi=Ye[Nt],Yt=this.style.getLayerSourceCache(ai);if(!Yt||!Yt.used||!Yt.getSource().usedInConflation&&ai.type!=="clip"&&ai.type!=="building")continue;let zt=i.eQ,ki=i.b_.None;const wi=[];let di=!0;if(ai.type==="building")zt=i.eS;else if(ai.type==="clip"){zt=gi;for(const yi of ai.layout.get("clip-layer-types"))ki|=yi==="model"?i.b_.Model:yi==="symbol"?i.b_.Symbol:i.b_.FillExtrusion;for(const yi of ai.layout.get("clip-layer-scope"))wi.push(yi);ai.isHidden(this.transform.zoom)?di=!1:ae=!0}di&&ft.push({layer:ai.fqid,cache:Yt,order:zt,clipMask:ki,clipScope:wi})}this.replacementSource.setSources(ft),Y=!0}}this._clippingActiveLastFrame=ae,Y||this.replacementSource.clear(),this.conflationActive=Y,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ot=0;ot<J.length;ot++){const Ye=J[ot];if(Ye.visibility==="none")continue;const gt=Ye.cutoffRange();if(this.longestCutoffRange=Math.max(gt,this.longestCutoffRange),gt>0){const ft=Pe(Ye);ft&&(this.minCutoffZoom=Math.max(ft.minzoom,this.minCutoffZoom)),Ye.minzoom&&(this.minCutoffZoom=Math.max(Ye.minzoom,this.minCutoffZoom))}Ye.is3D(T)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ot),this._lastOcclusionLayer=ot)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_e),this.opaquePassCutoff=0,j=E(),J=j.map((ot=>x[ot])));const Ie=this._shadowRenderer;if(Ie){Ie.updateShadowParameters(this.transform,this.style.directionalLight);for(const ot in se)for(const Ye of he[ot]){let gt={min:0,max:0};this.terrain&&(gt=this.terrain.getMinMaxForTile(Ye)||gt),Ie.addShadowReceiver(Ye.toUnwrapped(),gt.min,gt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new og(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const je=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ce=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(je&&!this._snow&&(this._snow=new Kf(this)),!je&&this._snow&&(this._snow.destroy(),delete this._snow),Ce&&!this._rain&&(this._rain=new gs(this)),!Ce&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),H){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Gh);const ot=this.style.getLayerSourceCache(H);this.buildingTileBorderManager.updateBorders(ot,H)}if(!cn.has(this.context.gl))return;this.renderPass="offscreen";for(const ot of J){const Ye=t.getLayerSourceCache(ot);if(!ot.hasOffscreenPass()||ot.isHidden(this.transform.zoom))continue;const gt=Ye?de[Ye.id]:void 0;(ot.type==="custom"||ot.type==="raster"||ot.type==="raster-particle"||ot.isSky()||gt&&gt.length)&&this.renderLayer(this,Ye,ot,gt)}this.depthRangeFor3D=[0,1-(J.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,we)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ge=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),it=(()=>{if(o.showOverdrawInspector)return i.ao.black;const ot=this.style.fog;if(ot&&this.transform.projection.supportsFog){const Ye=this.style.getLut(ot.scope);if(!Ge){const gt=ot.properties.get("color-use-theme")==="none",ft=ot.properties.get("color").toNonPremultipliedRenderColor(gt?null:Ye).toArray01();return new i.ao(...ft)}if(Ge){const gt=ot.properties.get("space-color-use-theme")==="none",ft=ot.properties.get("space-color").toNonPremultipliedRenderColor(gt?null:Ye).toArray01();return new i.ao(...ft)}}return i.ao.transparent})();if(this.context.clear({color:it,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ge&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=j.length-1;this.currentLayer>=0;this.currentLayer--){const ot=J[this.currentLayer],Ye=t.getLayerSourceCache(ot);if(ot.isSky())continue;const gt=Ye?(ot.is3D(T)?ye:de)[Ye.id]:void 0;this._renderTileClippingMasks(ot,Ye,gt),this.renderLayer(this,Ye,ot,gt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ge&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const ot=J[this.currentLayer],Ye=t.getLayerSourceCache(ot);ot.isSky()&&this.renderLayer(this,Ye,ot,Ye?de[Ye.id]:void 0)}function Ke(ot,Ye){let gt;return Ye&&(gt=(ot.type==="symbol"?_e:ot.is3D(T)?ye:de)[Ye.id]),gt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<j.length;){const ot=J[this.currentLayer];if(ot.type==="raster"||ot.type==="raster-particle"){const Ye=t.getLayerSourceCache(ot);this.renderLayer(this,Ye,ot,Ke(ot,Ye))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ht=0;Ie&&(ht=Ie.getShadowCastingLayerCount());let mt=!1,kt=-1;for(let ot=0;ot<j.length;++ot){const Ye=J[ot];Ye.isHidden(this.transform.zoom)||Ye.is3D(T)&&(kt=ot)}B&&kt===-1&&(O=!0);let Ot=!1;for(;this.currentLayer<j.length;){const ot=J[this.currentLayer],Ye=t.getLayerSourceCache(ot);if(ot.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ot)){if(ot.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ot&&ot.is3D(T)&&!T){const gt=this.currentLayer,ft=Nt=>{for(this.currentLayer=0;this.currentLayer<J.length;this.currentLayer++){const ai=J[this.currentLayer];if(kl[ai.type]){const gi=this.style.getLayerSourceCache(ai);kl[ai.type](this,gi,ai,Ke(ai,gi),Nt)}}};ft("initialize"),ft("reset"),this.currentLayer=gt,Ot=!0}if(O&&!mt&&this.terrain&&!this.transform.isOrthographic&&(mt=!0,this.blitDepth()),B&&kt!==-1&&this.currentLayer===kt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(ot,Ye,Ye?he[Ye.id]:void 0),this.renderLayer(this,Ye,ot,Ke(ot,Ye)),!this.terrain&&Ie&&ht>0&&ot.hasShadowPass()&&--ht==0){{this.clearStencil(),this.resetStencilClippingMasks();const gt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<J.length;this.currentLayer++){const ft=J[this.currentLayer];if(fu[ft.type]){const Nt=this.style.getLayerSourceCache(ft);fu[ft.type](this,Nt,ft,Ke(ft,Nt))}}this.currentLayer=gt}if(Ie.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const gt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=gt;this.currentLayer++){const ft=J[this.currentLayer];if(!ft.hasLightBeamPass())continue;const Nt=t.getLayerSourceCache(ft);this.renderLayer(this,Nt,ft,Nt?de[Nt.id]:void 0)}this.currentLayer=gt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const gt=this.currentLayer;this.depthOcclusion=!0;for(const ft of this.layersWithOcclusionOpacity){this.currentLayer=ft;const Nt=J[this.currentLayer],ai=t.getLayerSourceCache(Nt),gi=ai?de[ai.id]:void 0;this.terrain||this._renderTileClippingMasks(Nt,ai,ai?he[ai.id]:void 0),this.renderLayer(this,ai,Nt,gi)}this.depthOcclusion=!1,this.currentLayer=gt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ot=null;J.forEach((Ye=>{const gt=t.getLayerSourceCache(Ye);gt&&!Ye.isHidden(this.transform.zoom)&&gt.getVisibleCoordinates().length&&(!ot||ot.getSource().maxzoom<gt.getSource().maxzoom)&&(ot=gt)})),ot&&this.options.showTileBoundaries&&ei(this,ot,ot.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ei(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(ot){const Ye=ot.transform.padding;Sd(ot,ot.transform.height-(Ye.top||0),3,Vf),Sd(ot,Ye.bottom||0,3,ag),dr(ot,Ye.left||0,3,Hf),dr(ot,ot.transform.width-(Ye.right||0),3,Cc);const gt=ot.transform.centerPoint;(function(ft,Nt,ai,gi){rt(ft,Nt-1,ai-10,2,20,gi),rt(ft,Nt-10,ai-1,20,2,gi)})(ot,gt.x,ot.transform.height-gt.y,wd)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Y||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:o}=this.transform.projection,p=!o||!o.includes(t.type);if(Jf[t.type]&&(p||this.terrain&&t.type==="custom")){const x=this.style.getLayerSourceCache(t);Jf[t.type](t,x,this)}this.gpuTimingEnd()}renderLayer(t,o,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(p.type)&&(!t.terrain||p.type!=="custom")||p.type==="clip"||hu[p.type](t,o,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[t.id];x||(x=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(o.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,o=this.context.gl,p=o.createQuery();this.deferredRenderGpuTimeQueries.push(p),o.beginQuery(t.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const o={};for(const p in t){const x=t[p],T=this.context.extTimerQuery,E=T.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(x.query),o[p]=E}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let p=0;for(const x of t)p+=o.getQueryParameter(x,o.QUERY_RESULT)/1e6,o.deleteQuery(x);return p}translatePosMatrix(t,o,p,x,T){if(!p[0]&&!p[1])return t;const E=T?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const B=Math.sin(E),H=Math.cos(E);p=[p[0]*H-p[1]*B,p[0]*B+p[1]*H]}const j=[T?p[0]:i.ay(o,p[0],this.transform.zoom),T?p[1]:i.ay(o,p[1],this.transform.zoom),0],O=new Float32Array(16);return i.br(O,t,j),O}saveTileTexture(t){if(t.context!==this.context)return;const o=t.size[0],p=this._tileTextures[o];p?p.push(t):this._tileTextures[o]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,T=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||T.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||x||o!==void 0&&!o||T.push("FOG","FOG_DITHERING"),x&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(t,o){this.cache=this.cache||{};const p=o&&o.defines||[],x=o&&o.config,T=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(p),E=Oh.cacheKey(b[t],t,T,x);return this.cache[E]||(this.cache[E]=new Oh(this.context,t,b[t],x,Hm[t],T)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const T=((E,j,O)=>{const B=E.properties.get("direction"),H=E.properties.get("color-use-theme")==="none",K=E.properties.get("color").toNonPremultipliedRenderColor(H?null:O.getLut(E.scope)).toArray01(),Y=E.properties.get("intensity"),J=j.properties.get("color-use-theme")==="none",se=j.properties.get("color").toNonPremultipliedRenderColor(J?null:O.getLut(j.scope)).toArray01(),ae=j.properties.get("intensity"),he=[B.x,B.y,B.z],de=i.dN(se,ae),_e=i.dN(K,Y);return{u_lighting_ambient_color:de,u_lighting_directional_dir:he,u_lighting_directional_color:_e,u_ground_radiance:Zd(he,_e,de)}})(p,x,this.style);o.setLightsUniformValues(t,T)}}}uploadCommonUniforms(t,o,p,x,T){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const j=E.getOpacity(this.transform.pitch),O=((B,H,K,Y,J,se,ae,he,de,_e,we,ye)=>{const Pe=B.transform,Ae=H.properties.get("color-use-theme")==="none",Ie=H.properties.get("color").toNonPremultipliedRenderColor(Ae?null:B.style.getLut(H.scope)).toArray01();Ie[3]=Y;const je=B.frameCounter/1e3%1,[Ce,Ge]=H.properties.get("vertical-range");return{u_fog_matrix:K?Pe.calculateFogTileMatrix(K):ye||B.identityMat,u_fog_range:H.getFovAdjustedRange(Pe._fov),u_fog_color:Ie,u_fog_horizon_blend:H.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ce,Ge),Ge],u_fog_temporal_offset:je,u_frustum_tl:J,u_frustum_tr:se,u_frustum_br:ae,u_frustum_bl:he,u_globe_pos:de,u_globe_radius:_e,u_viewport:we,u_globe_transition:i.aj(Pe.zoom),u_is_globe:+(Pe.projection.name==="globe")}})(this,E,p,j,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],x);o.setFogUniformValues(t,O)}T&&o.setCutoffUniformValues(t,T.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,o=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)o[x.key]=t[x.key]||new Ys(x,512,this.transform.tileZoom,this,void 0,this.worldview);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=Tt||o[1]>=Tt}setupDepthForOcclusion(t,o,p){const x=this.context,T=x.gl,E=!!p;var j;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(T.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((j=this.depthRangeFor3D)[1]-j[0]),-1-2*j[0]/(j[1]-j[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),x.activeTexture.set(T.TEXTURE0),E||o.setTerrainUniformValues(x,p)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Qf(m,t){let o=!1,p=null;const x=()=>{p=null,o&&(m(),p=setTimeout(x,t),o=!1)};return()=>(o=!0,p||x(),p)}class Qm{constructor(t){this._hashName=t&&encodeURIComponent(t),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Qf(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const o=Zr(t);if(this._hashName){const p=this._hashName;let x=!1;const T=location.hash.slice(1).split("&").map((E=>{const j=E.split("=")[0];return j===p?(x=!0,`${j}=${o}`):E})).filter((E=>E));return x||T.push(`${p}=${o}`),`#${T.join("&")}`}return`#${o}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(o=p)})),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some((p=>isNaN(Number(p))))){const p=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:p,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Zr(m,t){const o=m.getCenter(),p=Math.round(100*m.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,x),E=Math.round(o.lng*T)/T,j=Math.round(o.lat*T)/T,O=m.getBearing(),B=m.getPitch();let H=t?`/${E}/${j}/${p}`:`${p}/${j}/${E}`;return(O||B)&&(H+="/"+Math.round(10*O)/10),B&&(H+=`/${Math.round(B)}`),H}const Uu={linearity:.3,easing:i.eT(0,0,.3,1)},ep=Object.assign({deceleration:2500,maxSpeed:1400},Uu),em=Object.assign({deceleration:20,maxSpeed:1400},Uu),Ed=Object.assign({deceleration:1e3,maxSpeed:360},Uu),tp=Object.assign({deceleration:1e3,maxSpeed:90},Uu);class dg{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=i.o.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)o.zoom+=T.zoomDelta||0,o.bearing+=T.bearingDelta||0,o.pitch+=T.pitchDelta||0,T.panDelta&&o.pan._add(T.panDelta),T.around&&(o.around=T.around),T.pinchAround&&(o.pinchAround=T.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(o.pan.mag()){const T=Dr(o.pan.mag(),p,Object.assign({},ep,t||{}));x.offset=o.pan.mult(T.amount/o.pan.mag()),x.center=this._map.transform.center,sh(x,T)}if(o.zoom){const T=Dr(o.zoom,p,em);x.zoom=this._map.transform.zoom+T.amount,sh(x,T)}if(o.bearing){const T=Dr(o.bearing,p,Ed);x.bearing=this._map.transform.bearing+i.aA(T.amount,-179,179),sh(x,T)}if(o.pitch){const T=Dr(o.pitch,p,tp);x.pitch=this._map.transform.pitch+T.amount,sh(x,T)}if(x.zoom||x.bearing){const T=o.pinchAround===void 0?o.around:o.pinchAround;x.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function sh(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Dr(m,t,o){const{maxSpeed:p,linearity:x,deceleration:T}=o,E=i.aA(m*x/(t/1e3),-p,p),j=Math.abs(E)/(T*x);return{easing:o.easing,duration:1e3*j,amount:E*(j/2)}}class br extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p,x={}){const T=at(o.getCanvasContainer(),p),E=o.unproject(T);super(t,Object.assign({point:T,lngLat:E,originalEvent:p},x)),this._defaultPrevented=!1,this.target=o}}class $u extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p){const x=t==="touchend"?p.changedTouches:p.touches,T=He(o.getCanvasContainer(),x),E=T.map((O=>o.unproject(O))),j=T.reduce(((O,B,H,K)=>O.add(B.div(K.length))),new i.P(0,0));super(t,{points:T,point:j,lngLats:E,lngLat:o.unproject(j),originalEvent:p}),this._defaultPrevented=!1}}class ip extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class tm{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new ip(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new br(t.type,this._map,t))}mouseup(t){this._map.fire(new br(t.type,this._map,t))}preclick(t){const o=new MouseEvent("preclick",t);this._map.fire(new br(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new br(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new br(t.type,this._map,t))}mouseover(t){this._map.fire(new br(t.type,this._map,t))}mouseout(t){this._map.fire(new br(t.type,this._map,t))}touchstart(t){return this._firePreventable(new $u(t.type,this._map,t))}touchmove(t){this._map.fire(new $u(t.type,this._map,t))}touchend(t){this._map.fire(new $u(t.type,this._map,t))}touchcancel(t){this._map.fire(new $u(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class np{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new br(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new br(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class im{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ne(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const p=o,x=this._startPos,T=this._lastPos;if(!x||!T||T.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=le("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const E=Math.min(x.x,p.x),j=Math.max(x.x,p.x),O=Math.min(x.y,p.y),B=Math.max(x.y,p.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${E}px,${O}px)`,this._box.style.width=j-E+"px",this._box.style.height=B-O+"px")}))}mouseupWindow(t,o){if(!this._active)return;const p=this._startPos,x=o;if(p&&t.button===0){if(this.reset(),et(),p.x!==x.x||p.y!==x.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:t})),{cameraAnimation:T=>T.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Be(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new i.z(t,{originalEvent:o}))}}function oh(m,t){const o={};for(let p=0;p<m.length;p++)o[m[p].identifier]=t[p];return o}class ap{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=(function(x){const T=new i.P(0,0);for(const E of x)T._add(E);return T.div(x.length)})(o),this.touches=oh(p,o)))}touchmove(t,o,p){if(this.aborted||!this.centroid)return;const x=oh(p,o);for(const T in this.touches){const E=x[T];(!E||E.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(t,o,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class nm{constructor(t){this.singleTap=new ap(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,p){this.singleTap.touchstart(t,o,p)}touchmove(t,o,p){this.singleTap.touchmove(t,o,p)}touchend(t,o,p){const x=this.singleTap.touchend(t,o,p);if(x){const T=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(T&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class hg{constructor(){this._zoomIn=new nm({numTouches:1,numTaps:2}),this._zoomOut=new nm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,p){this._zoomIn.touchstart(t,o,p),this._zoomOut.touchstart(t,o,p)}touchmove(t,o,p){this._zoomIn.touchmove(t,o,p),this._zoomOut.touchmove(t,o,p)}touchend(t,o,p){const x=this._zoomIn.touchend(t,o,p),T=this._zoomOut.touchend(t,o,p);return x?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:t})}):T?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(T)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fg={0:1,2:2},am={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Xh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const p=lt(t);this._correctButton(t,p)&&(this._lastPoint=o,this._eventButton=p)}mousemoveWindow(t,o){const p=this._lastPoint;if(p){if(t.preventDefault(),this._eventButton!=null&&(function(x,T){const E=fg[T];return x.buttons===void 0||(x.buttons&E)!==E})(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(p,o)}}mouseupWindow(t){this._lastPoint&&lt(t)===this._eventButton&&(this._moved&&et(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rp extends Xh{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class sp extends Xh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?am[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const p=.8*(o.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class rm extends Xh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?am[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const p=-.5*(o.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class sm{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(t,o,p){return this._calculateTransform(t,o,p)}touchmove(t,o,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!i.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,p)}}touchend(t,o,p){this._calculateTransform(t,o,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,p){p.length>0&&(this._active=!0);const x=oh(p,o),T=new i.P(0,0),E=new i.P(0,0);let j=0;for(const B in x){const H=x[B],K=this._touches[B];K&&(T._add(H),E._add(H.sub(K)),j++,x[B]=H)}if(this._touches=x,j<this._minTouches||!E.mag())return;const O=E.div(j);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(j),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=le("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Yh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,p){return{}}touchstart(t,o,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,p){const x=this._firstTwoTouches;if(!x)return;t.preventDefault();const[T,E]=x,j=Kh(p,o,T),O=Kh(p,o,E);if(!j||!O)return;const B=this._aroundCenter?null:j.add(O).div(2);return this._move([j,O],B,t)}touchend(t,o,p){if(!this._firstTwoTouches)return;const[x,T]=this._firstTwoTouches,E=Kh(p,o,x),j=Kh(p,o,T);E&&j||(this._active&&et(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Kh(m,t,o){for(let p=0;p<m.length;p++)if(m[p].identifier===o)return t[p]}function op(m,t){return Math.log2(m/t)}class o_ extends Yh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(op(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:op(this._distance,p),pinchAround:o}}}function mu(m,t){return 180*m.angleWith(t)/Math.PI}class ir extends Yh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const p=this._vector;if(this._vector=t[0].sub(t[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:mu(this._vector,p),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=mu(t,p);return Math.abs(x)<o}}function lp(m){return Math.abs(m.y)>Math.abs(m.x)}class l_ extends Yh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,lp(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,p){const x=this._lastPoints;if(!x)return;const T=t[0].sub(x[0]),E=t[1].sub(x[1]);return this._map._cooperativeGestures&&!i.eU()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(T,E,p.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(T.y+E.y)/2*-.5})}gestureBeginsVertically(t,o,p){if(this._valid!==void 0)return this._valid;const x=t.mag()>=2,T=o.mag()>=2;if(!x&&!T)return;if(!x||!T)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=t.y>0==o.y>0;return lp(t)&&lp(o)&&E}}const Vu={panStep:100,bearingStep:15,pitchStep:10};class c_{constructor(){const t=Vu;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,p=0,x=0,T=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),T=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),T=1);break;case 38:t.shiftKey?x=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?x=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:j=>{const O=j.getZoom();j.easeTo({duration:300,easeId:"keyboardHandler",easing:Ad,zoom:o?Math.round(O)+o*(t.shiftKey?2:1):O,bearing:j.getBearing()+p*this._bearingStep,pitch:j.getPitch()+x*this._pitchStep,offset:[-T*this._panStep,-E*this._panStep],center:j.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ad(m){return m*(2-m)}const lh=4.000244140625,Xr=1/450;class cp{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xr,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||i.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=i.o.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,o!==0&&o%lh==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(x*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=at(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>lh?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&H!==0&&(H=1/H);const K=o(),Y=Math.pow(2,K),J=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):Y;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(J*H))),this._type==="wheel"&&(this._startZoom=K,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:o(),x=this._startZoom,T=this._easing;let E,j=!1;if(this._type==="wheel"&&x&&T){const B=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),H=T(B);E=i.ak(x,p,H),B<1?this._frameId||(this._frameId=!0):j=!0}else E=p,j=!0;this._active=!0,j&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let O=E-o();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!j,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=i.eV;if(this._prevEase){const p=this._prevEase,x=(i.o.now()-p.start)/p.duration,T=p.easing(x+.01)-p.easing(x),E=.27/Math.sqrt(T*T+1e-4)*.01,j=Math.sqrt(.0729-E*E);o=i.eT(E,j,.25,1)}return this._prevEase={start:i.o.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=le("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Hu{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class om{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mr{constructor(){this._tap=new nm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=o[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,o,p))}touchmove(t,o,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=o[0],T=x.y-this._swipePoint.y;return this._swipePoint=x,t.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(t,o,p)}touchend(t,o,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(t,o,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ao{constructor(t,o,p){this._el=t,this._mousePan=o,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Jh{constructor(t,o,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class lm{constructor(t,o,p,x){this._el=t,this._touchZoom=o,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Gu=m=>m.zoom||m.drag||m.pitch||m.rotate;class pu extends i.z{}class Qh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const p=i.av([],o,t);this.radius=i.ag(p[2]<0?i.eX([],p,this.constants):[p[0],p[1],0])}projectRay(t){i.eX(t,t,this.constants),i.aw(t,t),i.eY(t,t,this.constants);const o=i.c5([],t,this.radius);if(o[2]>0){const p=i.c5([],[0,0,1],i.bJ(o,[0,0,1])),x=i.c5([],i.aw([],[o[0],o[1],0]),this.radius),T=i.d8([],o,i.c5([],i.av([],i.d8([],x,p),o),2));o[0]=T[0],o[1]=T[1]}return o}}function ef(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class u_{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dg(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Qh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),i.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,T,E]of this._listeners){const j=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(T,j,E)}}destroy(){for(const[t,o,p]of this._listeners){const x=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,x,p)}}_addDefaultHandlers(t){const o=this._map,p=o.getCanvasContainer();this._add("mapEvent",new tm(o,t));const x=o.boxZoom=new im(o,t);this._add("boxZoom",x);const T=new hg,E=new om;o.doubleClickZoom=new Hu(E,T),this._add("tapZoom",T),this._add("clickZoom",E);const j=new Mr;this._add("tapDragZoom",j);const O=o.touchPitch=new l_(o);this._add("touchPitch",O);const B=new sp(t),H=new rm(t);o.dragRotate=new Jh(t,B,H),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const K=new rp(t),Y=new sm(o,t);o.dragPan=new Ao(p,K,Y),this._add("mousePan",K),this._add("touchPan",Y,["touchZoom","touchRotate"]);const J=new ir,se=new o_;o.touchZoomRotate=new lm(p,se,J,j),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new np(o));const ae=o.scrollZoom=new cp(o,this);this._add("scrollZoom",ae,["mousePan"]);const he=o.keyboard=new c_;this._add("keyboard",he);for(const de of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[de]&&o[de].enable(t[de])}_add(t,o,p){this._handlers.push({handlerName:t,handler:o,allowed:p}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,p){for(const x in t)if(x!==p&&(!o||o.indexOf(x)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const p of t)this._el.contains(p.target)&&o.push(p);return o}handleEvent(t,o){this._updatingCamera=!0;const p=t.type==="renderFrame",x=p?void 0:t,T={needsRenderFrame:!1},E={},j={},O=t.touches?this._getMapTouches(t.touches):void 0,B=O?He(this._el,O):p?void 0:at(this._el,t);for(const{handlerName:Y,handler:J,allowed:se}of this._handlers){if(!J.isEnabled())continue;let ae;this._blockedByActive(j,se,Y)?J.reset():J[o||t.type]&&(ae=J[o||t.type](t,B,O),this.mergeHandlerResult(T,E,ae,Y,x),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||J.isActive())&&(j[Y]=J)}const H={};for(const Y in this._previousActiveHandlers)j[Y]||(H[Y]=x);this._previousActiveHandlers=j,(Object.keys(H).length||ef(T))&&(this._changes.push([T,E,H]),this._triggerRenderFrame()),(Object.keys(j).length||ef(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=T;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))}mergeHandlerResult(t,o,p,x,T){if(!p)return;Object.assign(t,p);const E={handlerName:x,originalEvent:p.originalEvent||T};p.zoomDelta!==void 0&&(o.zoom=E),p.panDelta!==void 0&&(o.drag=E),p.pitchDelta!==void 0&&(o.pitch=E),p.bearingDelta!==void 0&&(o.rotate=E)}_applyChanges(){const t={},o={},p={};for(const[x,T,E]of this._changes)x.panDelta&&(t.panDelta=(t.panDelta||new i.P(0,0))._add(x.panDelta)),x.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(t.around=x.around),x.aroundCoord!==void 0&&(t.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(t.pinchAround=x.pinchAround),x.noInertia&&(t.noInertia=x.noInertia),Object.assign(o,T),Object.assign(p,E);this._updateMapTransform(t,o,p),this._changes=[]}_updateMapTransform(t,o,p){const x=this._map,T=x.transform,E=_e=>[_e.x,_e.y,_e.z];if((_e=>{const we=this._eventsInProgress.drag;return we&&!this._handlersById[we.handlerName].isActive()})()&&!ef(t)){const _e=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),_e!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&x._stop(!0),!ef(t))return void this._fireEvents(o,p,!0);let{panDelta:j,zoomDelta:O,bearingDelta:B,pitchDelta:H,around:K,aroundCoord:Y,pinchAround:J}=t;T._isCameraConstrained&&(O>0&&(O=0),T._isCameraConstrained=!1),J!==void 0&&(K=J),(O||(_e=>o[_e]&&!this._eventsInProgress[_e])("drag"))&&K&&(this._dragOrigin=E(T.pointCoordinate3D(K)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",x._stop(!0),K=K||x.transform.centerPoint,B&&(T.bearing+=B),H&&(T.pitch+=H),T._updateCameraState();const se=[0,0,0];if(j)if(T.projection.name==="mercator"){const _e=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(K).dir),we=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(K.sub(j)).dir);se[0]=we[0]-_e[0],se[1]=we[1]-_e[1]}else{const _e=T.pointCoordinate(K);if(T.projection.name==="globe"){j=j.rotate(-T.angle);const we=T._pixelsPerMercatorPixel/T.worldSize;se[0]=-j.x*i.eW(i.a$(_e.y))*we,se[1]=-j.y*i.eW(T.center.lat)*we}else{const we=T.pointCoordinate(K.sub(j));_e&&we&&(se[0]=we.x-_e.x,se[1]=we.y-_e.y)}}const ae=T.zoom,he=[0,0,0];if(O){const _e=E(Y||T.pointCoordinate3D(K)),we={dir:i.aw([],i.av([],_e,T._camera.position))};if(we.dir[2]<0){const ye=T.zoomDeltaToMovement(_e,O);i.c5(he,we.dir,ye)}}const de=i.d8(se,se,he);T._translateCameraConstrained(de),O&&Math.abs(T.zoom-ae)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,p,!0)}_fireEvents(t,o,p){const x=Gu(this._eventsInProgress),T=Gu(t),E={};for(const H in t){const{originalEvent:K}=t[H];this._eventsInProgress[H]||(E[`${H}start`]=K),this._eventsInProgress[H]=t[H]}!x&&T&&this._fireEvent("movestart",T.originalEvent);for(const H in E)this._fireEvent(H,E[H]);T&&this._fireEvent("move",T.originalEvent);for(const H in t){const{originalEvent:K}=t[H];this._fireEvent(H,K)}const j={};let O;for(const H in this._eventsInProgress){const{handlerName:K,originalEvent:Y}=this._eventsInProgress[H];this._handlersById[K].isActive()||(delete this._eventsInProgress[H],O=o[K]||Y,j[`${H}end`]=O)}for(const H in j)this._fireEvent(H,j[H]);const B=Gu(this._eventsInProgress);if(p&&(x||T)&&!B){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),K=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;H?(K(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:O})):(this._map.fire(new i.z("moveend",{originalEvent:O})),K(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new i.z(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new pu("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const tf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class cm extends i.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,p){return t=i.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},o),p)}panTo(t,o,p){return this.easeTo(Object.assign({center:t},o),p)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,p){return this.easeTo(Object.assign({zoom:t},o),p)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,p){return this.easeTo(Object.assign({bearing:t},o),p)}resetNorth(t,o){return this.rotateTo(0,Object.assign({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=i.aI.convert(t);const p=o&&o.bearing||0,x=o&&o.pitch||0,T=t.getNorthWest(),E=t.getSouthEast();return this._cameraForBounds(this.transform,T,E,p,x,o)}_extendPadding(t){const o={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},o,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){const p=o.max[0]-o.min[0],x=o.max[1]-o.min[1];return p/x>t.aspect?p/(2*Math.tan(.5*t.fovX)*t.aspect):x/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,p,x,T,E){const j=t.clone(),O=this._extendCameraOptions(E);j.bearing=x,j.pitch=T;const B=i.aT.convert(o),H=i.aT.convert(p),K=.5*(B.lat+H.lat),Y=.5*(B.lng+H.lng),J=i.eZ(K,Y),se=i.aw([],J),ae=i.aw([],i.bI([],se,[0,1,0])),he=i.bI([],ae,se),de=[ae[0],ae[1],ae[2],0,he[0],he[1],he[2],0,se[0],se[1],se[2],0,0,0,0,1],_e=[J,i.eZ(B.lat,B.lng),i.eZ(H.lat,B.lng),i.eZ(H.lat,H.lng),i.eZ(B.lat,H.lng),i.eZ(K,B.lng),i.eZ(K,H.lng),i.eZ(B.lat,Y),i.eZ(H.lat,Y)];let we=i.d9.fromPoints(_e.map((ft=>[i.bJ(ae,ft),i.bJ(he,ft),i.bJ(se,ft)])));const ye=i.af([],we.center,de);i.e_(ye)===0&&i.e$(ye,0,0,1),i.aw(ye,ye),i.c5(ye,ye,i.aD),j.center=i.f0(ye);const Pe=j.getWorldToCameraMatrix(),Ae=i.bl(new Float64Array(16),Pe);we=i.d9.applyTransform(we,i.aB([],Pe,de));const Ie=this._extendAABB(we,j,O,x);if(!Ie)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");we=Ie,i.af(ye,ye,Pe);const je=.5*(we.max[2]-we.min[2]),Ce=this._minimumAABBFrustumDistance(j,we),Ge=i.c5([],[0,0,1],je),it=i.d8(Ge,ye,Ge),Ke=Ce+(j.pitch===0?0:i.bG(ye,it)),ht=j.globeCenterInViewSpace,mt=i.av([],ye,[ht[0],ht[1],ht[2]]);i.aw(mt,mt),i.c5(mt,mt,Ke);const kt=i.d8([],ye,mt);i.af(kt,kt,Ae);const Ot=i.eM/i.aD,ot=i.ag(kt),Ye=i.cf(Math.max(ot*Ot-i.eM,Number.EPSILON),0),gt=Math.min(j.zoomFromMercatorZAdjusted(Ye),O.maxZoom);return gt>.5*(i.c_+i.cL)?(j.setProjection({name:"mercator"}),j.zoom=gt,this._cameraForBounds(j,o,p,x,T,E)):{center:j.center,zoom:gt,bearing:x,pitch:T}}_extendAABB(t,o,p,x){const T=.5*((p.padding.left||0)+(p.padding.right||0)),E=.5*((p.padding.top||0)+(p.padding.bottom||0)),j=E,O=T,B=T,H=E,K=o.width-(O+B),Y=o.height-(j+H),J=i.av([],t.max,t.min),se=Math.min(K/J[0],Y/J[1]),ae=Math.min(o.scaleZoom(o.scale*se),p.maxZoom);if(isNaN(ae))return null;const he=o.scale/o.zoomScale(ae),de=new i.d9([t.min[0]-O*he,t.min[1]-H*he,t.min[2]],[t.max[0]+B*he,t.max[1]+j*he,t.max[2]]),_e=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new i.P(p.offset.x,p.offset.y):i.P.convert(p.offset)).rotate(-i.an(x));return de.center[0]-=_e.x*he,de.center[1]+=_e.y*he,de}queryTerrainElevation(t,o){const p=this.transform.elevation;return p?(o=Object.assign({},{exaggerated:!0},o),p.getAtPoint(i.ae.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,p,x,T,E){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,p,x,T,E);const j=t.clone(),O=this._extendCameraOptions(E);j.bearing=x,j.pitch=T;const B=i.aT.convert(o),H=i.aT.convert(p),K=new i.aT(B.lng,H.lat),Y=new i.aT(H.lng,B.lat),J=j.project(B),se=j.project(H),ae=this.queryTerrainElevation(B),he=this.queryTerrainElevation(H),de=this.queryTerrainElevation(K),_e=this.queryTerrainElevation(Y),we=[[J.x,J.y,Math.min(ae||0,he||0,de||0,_e||0)],[se.x,se.y,Math.max(ae||0,he||0,de||0,_e||0)]];let ye=i.d9.fromPoints(we);const Pe=j.getWorldToCameraMatrix(),Ae=i.bl(new Float64Array(16),Pe);ye=i.d9.applyTransform(ye,Pe);const Ie=this._extendAABB(ye,j,O,x);if(!Ie)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Ie;const je=.5*i.av([],ye.max,ye.min)[2],Ce=this._minimumAABBFrustumDistance(j,ye),Ge=[0,0,1,0];i.aC(Ge,Ge,Pe),i.f1(Ge,Ge);const it=i.c5([],Ge,Ce+je),Ke=i.d8([],ye.center,it);i.af(ye.center,ye.center,Ae),i.af(Ke,Ke,Ae);const ht=j.unproject(new i.P(ye.center[0],ye.center[1])),mt=i.f2(j.projection,ht),kt=Math.pow(2,mt),Ot=Math.min(j._zoomFromMercatorZ(Ke[2]*j.pixelsPerMeter*kt/j.worldSize),O.maxZoom);return j.mercatorFromTransition&&Ot<.5*(i.c_+i.cL)?(j.setProjection({name:"globe"}),j.zoom=Ot,this._cameraForBounds(j,o,p,x,T,E)):{center:ht,zoom:Ot,bearing:x,pitch:T}}fitBounds(t,o,p){const x=this.cameraForBounds(t,o);return this._fitInternal(x,o,p)}fitScreenCoordinates(t,o,p,x,T){const E=i.P.convert(t),j=i.P.convert(o),O=new i.P(Math.min(E.x,j.x),Math.min(E.y,j.y)),B=new i.P(Math.max(E.x,j.x),Math.max(E.y,j.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,j))return this;const H=this.transform.pointLocation3D(O),K=this.transform.pointLocation3D(B),Y=this.transform.pointLocation3D(new i.P(O.x,B.y)),J=this.transform.pointLocation3D(new i.P(B.x,O.y)),se=[Math.min(H.lng,K.lng,Y.lng,J.lng),Math.min(H.lat,K.lat,Y.lat,J.lat)],ae=[Math.max(H.lng,K.lng,Y.lng,J.lng),Math.max(H.lat,K.lat,Y.lat,J.lat)],he=x&&x.pitch?x.pitch:this.getPitch(),de=this._cameraForBounds(this.transform,se,ae,p,he,x);return this._fitInternal(de,x,T)}_fitInternal(t,o,p){return t?(o=Object.assign(t,o)).linear?this.easeTo(o,p):this.flyTo(o,p):this}jumpTo(t,o){this.stop();const p=t.preloadOnly?this.transform.clone():this.transform;let x=!1,T=!1,E=!1;"zoom"in t&&p.zoom!==+t.zoom&&(x=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=i.aT.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(T=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(E=!0,p.pitch=+t.pitch);const j=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!p.isPaddingEqual(j))if(t.retainPadding===!1){const O=p.clone();O.padding=j,p.setLocationAtPoint(p.center,O.centerPoint)}else p.padding=j;return t.preloadOnly?(this._preloadTiles(p),this):(this.fire(new i.z("movestart",o)).fire(new i.z("move",o)),x&&this.fire(new i.z("zoomstart",o)).fire(new i.z("zoom",o)).fire(new i.z("zoomend",o)),T&&this.fire(new i.z("rotatestart",o)).fire(new i.z("rotate",o)).fire(new i.z("rotateend",o)),E&&this.fire(new i.z("pitchstart",o)).fire(new i.z("pitch",o)).fire(new i.z("pitchend",o)),this.fire(new i.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(tf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){const p=this.transform;if(!p.projection.supportsFreeCamera)return i.w(tf),this;this.stop();const x=p.zoom,T=p.pitch,E=p.bearing;p.setFreeCameraOptions(t);const j=x!==p.zoom,O=T!==p.pitch,B=E!==p.bearing;return this.fire(new i.z("movestart",o)).fire(new i.z("move",o)),j&&this.fire(new i.z("zoomstart",o)).fire(new i.z("zoom",o)).fire(new i.z("zoomend",o)),B&&this.fire(new i.z("rotatestart",o)).fire(new i.z("rotate",o)).fire(new i.z("rotateend",o)),O&&this.fire(new i.z("pitchstart",o)).fire(new i.z("pitch",o)).fire(new i.z("pitchend",o)),this.fire(new i.z("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:i.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const p=this.transform,x=this.getZoom(),T=this.getBearing(),E=this.getPitch(),j=this.getPadding(),O="zoom"in t?+t.zoom:x,B="bearing"in t?this._normalizeBearing(t.bearing,T):T,H="pitch"in t?+t.pitch:E,K=this._extendPadding(t.padding),Y=i.P.convert(t.offset);let J,se,ae;if(p.projection.name==="globe"){const Ge=i.ae.fromLngLat(p.center),it=Y.rotate(-p.angle);Ge.x+=it.x/p.worldSize,Ge.y+=it.y/p.worldSize;const Ke=Ge.toLngLat(),ht=i.aT.convert(t.center||Ke);this._normalizeCenter(ht),J=p.centerPoint.add(it),se=new i.P(Ge.x,Ge.y).mult(p.worldSize),ae=new i.P(i.aF(ht.lng),i.aJ(ht.lat)).mult(p.worldSize).sub(se)}else{J=p.centerPoint.add(Y);const Ge=p.pointLocation(J),it=i.aT.convert(t.center||Ge);this._normalizeCenter(it),se=p.project(Ge),ae=p.project(it).sub(se)}const he=p.zoomScale(O-x);let de,_e;t.around&&(de=i.aT.convert(t.around),_e=p.locationPoint(de));const we=this._zooming||O!==x,ye=this._rotating||T!==B,Pe=this._pitching||H!==E,Ae=!p.isPaddingEqual(K),Ie=t.retainPadding===!1?p.clone():p,je=Ge=>it=>{if(we&&(Ge.zoom=i.ak(x,O,it)),ye&&(Ge.bearing=i.ak(T,B,it)),Pe&&(Ge.pitch=i.ak(E,H,it)),Ae&&(Ie.interpolatePadding(j,K,it),J=Ie.centerPoint.add(Y)),de)Ge.setLocationAtPoint(de,_e);else{const Ke=Ge.zoomScale(Ge.zoom-x),ht=O>x?Math.min(2,he):Math.max(.5,he),mt=Math.pow(ht,1-it),kt=Ge.unproject(se.add(ae.mult(it*mt)).mult(Ke));Ge.setLocationAtPoint(Ge.renderWorldCopies?kt.wrap():kt,J)}return t.preloadOnly||this._fireMoveEvents(o),Ge};if(t.preloadOnly){const Ge=this._emulate(je,t.duration,p);return this._preloadTiles(Ge),this}const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=we,this._rotating=ye,this._pitching=Pe,this._padding=Ae,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,Ce),this._ease(je(p),(Ge=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(o,Ge)}),t),this}_prepareEase(t,o,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||p.moving||this.fire(new i.z("movestart",t)),this._zooming&&!p.zooming&&this.fire(new i.z("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new i.z("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new i.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new i.z("move",t)),this._zooming&&this.fire(new i.z("zoom",t)),this._rotating&&this.fire(new i.z("rotate",t)),this._pitching&&this.fire(new i.z("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new i.z("zoomend",t)),x&&this.fire(new i.z("rotateend",t)),T&&this.fire(new i.z("pitchend",t)),this.fire(new i.z("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){const ft=i.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ft,o)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eV},t);const p=this.transform,x=this.getZoom(),T=this.getBearing(),E=this.getPitch(),j=this.getPadding(),O="zoom"in t?i.aA(+t.zoom,p.minZoom,p.maxZoom):x,B="bearing"in t?this._normalizeBearing(t.bearing,T):T,H="pitch"in t?+t.pitch:E,K=this._extendPadding(t.padding),Y=p.zoomScale(O-x),J=i.P.convert(t.offset);let se=p.centerPoint.add(J);const ae=p.pointLocation(se),he=i.aT.convert(t.center||ae);this._normalizeCenter(he);const de=p.project(ae),_e=p.project(he).sub(de);let we=t.curve;const ye=Math.max(p.width,p.height),Pe=ye/Y,Ae=_e.mag();if("minZoom"in t){const ft=i.aA(Math.min(t.minZoom,x,O),p.minZoom,p.maxZoom),Nt=ye/p.zoomScale(ft-x);we=Math.sqrt(Nt/Ae*2)}const Ie=we*we;function je(ft){const Nt=(Pe*Pe-ye*ye+(ft?-1:1)*Ie*Ie*Ae*Ae)/(2*(ft?Pe:ye)*Ie*Ae);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function Ce(ft){return(Math.exp(ft)-Math.exp(-ft))/2}function Ge(ft){return(Math.exp(ft)+Math.exp(-ft))/2}const it=je(0);let Ke=function(ft){return Ge(it)/Ge(it+we*ft)},ht=function(ft){return ye*((Ge(it)*(Ce(Nt=it+we*ft)/Ge(Nt))-Ce(it))/Ie)/Ae;var Nt},mt=(je(1)-it)/we;if(Math.abs(Ae)<1e-6||!isFinite(mt)){if(Math.abs(ye-Pe)<1e-6)return this.easeTo(t,o);const ft=Pe<ye?-1:1;mt=Math.abs(Math.log(Pe/ye))/we,ht=function(){return 0},Ke=function(Nt){return Math.exp(ft*we*Nt)}}t.duration="duration"in t?+t.duration:1e3*mt/("screenSpeed"in t?+t.screenSpeed/we:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const kt=T!==B,Ot=H!==E,ot=!p.isPaddingEqual(K),Ye=t.retainPadding===!1?p.clone():p,gt=ft=>Nt=>{const ai=Nt*mt,gi=1/Ke(ai);ft.zoom=Nt===1?O:x+ft.scaleZoom(gi),kt&&(ft.bearing=i.ak(T,B,Nt)),Ot&&(ft.pitch=i.ak(E,H,Nt)),ot&&(Ye.interpolatePadding(j,K,Nt),se=Ye.centerPoint.add(J));const Yt=Nt===1?he:ft.unproject(de.add(_e.mult(ht(ai))).mult(gi));return ft.setLocationAtPoint(ft.renderWorldCopies?Yt.wrap():Yt,se),ft._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),ft};if(t.preloadOnly){const ft=this._emulate(gt,t.duration,p);return this._preloadTiles(ft),this}return this._zooming=!0,this._rotating=kt,this._pitching=Ot,this._padding=ot,this._prepareEase(o,!1),this._ease(gt(p),(()=>this._afterEase(o)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,o)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,o,p){p.animate===!1||p.duration===0?(t(1),o()):(this._easeStart=i.o.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=i.bT(t,-180,180);const p=Math.abs(t-o);return Math.abs(t-360-o)<p&&(t-=360),Math.abs(t+360-o)<p&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const p=t.lng-o.center.lng;t.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,p){const x=Math.ceil(15*o/1e3),T=[],E=t(p.clone());for(let j=0;j<=x;j++){const O=E(j/x);T.push(O.clone())}return T}_preloadTiles(t,o){}}class Cd{constructor(t={}){this.options=t,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact,p=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=le("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=le("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=le("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=le("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(t){const p=o.reduce(((x,T,E)=>(T.value&&(x+=`${T.key}=${T.value}${E<o.length-1?"&":""}`),x)),"?");t.href=`${i.e.FEEDBACK_URL}/${p}#${Zr(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const o=this._map.style._mergedSourceCaches;for(const x in o){const T=o[x];if(T.used){const E=T.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t.sort(((x,T)=>x.length-T.length)),t=t.filter(((x,T)=>{for(let E=T+1;E<t.length;E++)if(t[E].indexOf(x)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const p=t.map((x=>(function(T){const E=new DOMParser().parseFromString(T,"text/html");return Array.from(E.body.querySelectorAll("*")).forEach((j=>{const O=j.textContent||"";if(j.tagName!=="A")return void j.replaceWith(E.createTextNode(O));const B=j.getAttribute("href");if(!B||!/^(https?:|mailto:)/i.test(B))return void j.replaceWith(E.createTextNode(O));const H=E.createElement("a");H.href=B,H.textContent=O,H.rel="noopener nofollow";const K=j.getAttribute("class");K&&(H.className=K),j.replaceWith(H)})),E.body.innerHTML})(x))).join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class nf{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=le("div","mapboxgl-ctrl");const o=le("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const o in t){const p=t[o].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class El{constructor(){i.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(o=>this._onIndoorUpdate(o))),this._container}_createButton(t,o){const p=le("button",t,this._container);return p.type="button",p.addEventListener("click",o),p}_createSeparator(){return le("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,o){this._map&&(t.setAttribute("aria-label",o),t.textContent=o)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const o=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",o&&Array.from(this._container.children).forEach((p=>p.remove())),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const o=this._map;this._model&&o&&o._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));le("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,o){for(let p=0;p<t.length;p++){const x=t[p],T=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(x.id)}));this._setButtonTitle(T,x.zIndex.toString()),this._model&&x.id===this._model.selectedFloorId&&o&&T.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(T),p<t.length-1&&this._createSeparator()}}}class Er{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,p=o?this._queue.concat(o):this._queue;for(const x of p)if(x.id===t)return void(x.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const p of o)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Rc{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=i.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,p){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+p}}const gu={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Yr extends i.z{constructor(t,o,p,x){const{point:T,lngLat:E,originalEvent:j,target:O}=t;super(t.type,{point:T,lngLat:E,originalEvent:j,target:O}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=p,this.feature=x}}class Lc{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const p=o.filter;let x=o.type;p&&this.filters.set(t,i.b6(p)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const T=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,o)):T.size===0&&this.map.on(x,this.handleType),T.size===0&&this.interactionsByType.set(x,T),T.set(t,o),this.typeById.set(t,x)}get(t){const o=this.typeById.get(t);if(!o)return;const p=this.interactionsByType.get(o);return p?p.get(t):void 0}remove(t){const o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);const p=this.interactionsByType.get(o);p&&(p.delete(t),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(o,this.handleType))}queryTargets(t,o){const p=[];for(const[x,T]of o)T.target&&p.push({targetId:x,target:T.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(t,p,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const o=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());o.length&&(t.type="mouseenter",this.handleType(t,o));const p=new Map;for(const[x,{feature:T}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||p.set(T.id,T);p.size&&(t.type="mouseleave",this.handleType(t,Array.from(p.values())))}handleOut(t){const o=Array.from(this.hoveredFeatures.values()).map((({feature:p})=>p));o.length&&(t.type="mouseleave",this.handleType(t,o)),this.hoveredFeatures.clear()}handleType(t,o){const p=t.type==="mouseenter";if(p&&!this.interactionsByType.has(t.type))return void i.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(t.type)).reverse(),T=!!o;o=o||this.queryTargets(t.point,x);let E=!1;const j=new Set;for(const O of o){for(const[B,H]of x){if(!H.target)continue;const K=O.variants?O.variants[B]:null;if(K){for(const Y of K){if(yo(Y,O,j,B))continue;const J=new i.dx(O,Y),se=Io(Y,O,B);T&&J.id!==void 0&&(J.state=this.map.getFeatureState(J));const ae=p?this.prevHoveredFeatures.get(se):null,he=new Yr(t,B,H,J),de=ae?ae.stop:H.handler(he);if(p&&this.hoveredFeatures.set(se,{feature:O,stop:de}),de!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[O,B]of x){const{handler:H,target:K}=B;if(!K&&H(new Yr(t,O,B,null))!==!1)break}}}function d_(m,t){if(Array.isArray(m)&&Array.isArray(t)){const o=new Set(m),p=new Set(t);return o.size===p.size&&m.every((x=>p.has(x)))}return i.by(m,t)}const h_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},is={showCompass:!0,showZoom:!0,visualizePitch:!1};class Al{constructor(t,o,p=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new sp({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new rm({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),Ne()}move(t,o){const p=this.map,x=this.mouseRotate.mousemoveWindow(t,o),T=x&&x.bearingDelta;if(T&&p.setBearing(p.getBearing()+T),this.mousePitch){const E=this.mousePitch.mousemoveWindow(t,o),j=E&&E.pitchDelta;j&&p.setPitch(p.getPitch()+j)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Be(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),at(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,at(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=He(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=He(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ic(m,t,o){if(m=new i.aT(m.lng,m.lat),t){const p=new i.aT(m.lng-360,m.lat),x=new i.aT(m.lng+360,m.lat),T=360*Math.ceil(Math.abs(m.lng-o.center.lng)/360),E=o.locationPoint3D(m).distSqr(t),j=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint3D(p).distSqr(t)<E&&(j||Math.abs(p.lng-o.center.lng)<T)?m=p:o.locationPoint3D(x).distSqr(t)<E&&(j||Math.abs(x.lng-o.center.lng)<T)&&(m=x)}for(;Math.abs(m.lng-o.center.lng)>180;){const p=o.locationPoint3D(m);if(p.x>=0&&p.y>=0&&p.x<=o.width&&p.y<=o.height)break;m.lng>o.center.lng?m.lng-=360:m.lng+=360}return m}const io={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Gl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class up extends i.E{constructor(t,o){super(),(t instanceof HTMLElement||o)&&(t=Object.assign({element:t},o)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:x="#3FB1CE",scale:T=1,draggable:E=!1,clickTolerance:j=0,rotation:O=Gl.rotation,rotationAlignment:B=Gl.rotationAlignment,pitchAlignment:H=Gl.pitchAlignment,occludedOpacity:K=Gl.occludedOpacity,altitude:Y=Gl.altitude}=t||{};this._anchor=p,this._color=x,this._scale=T,this._draggable=E,this._clickTolerance=j,this._rotation=O,this._rotationAlignment=B,this._pitchAlignment=H,this._occludedOpacity=K,this._altitude=Y,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=i.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(ae=>{ae.preventDefault()})),this._element.addEventListener("mousedown",(ae=>{ae.preventDefault()}));const J=this._element.classList;for(const ae in io)J.remove(`mapboxgl-marker-anchor-${ae}`);J.add(`mapboxgl-marker-anchor-${this._anchor}`);const se=t&&t.className?t.className.trim().split(/\s+/):[];J.add(...se),this._popup=null}_createDefaultMarker(){const t=le("div"),o=re("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const p=re("radialGradient",{id:"shadowGradient"},re("defs",{},o));re("stop",{offset:"10%","stop-opacity":.4},p),re("stop",{offset:"100%","stop-opacity":.05},p),re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o)}return re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=i.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Gl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const o=t.code,p=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,p=this._element;this._popup&&(o===p||p.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,o=this._pos;if(!t||!o)return!1;const p=t.unproject(o,this._altitude),x=t.getFreeCameraOptions();if(!x.position)return!1;const T=x.position.toLngLat();return T.distanceTo(p)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();const p=t.unproject(o,this._altitude);let x;t._showingGlobe()&&i.f5(t.transform,this._lngLat)?x=0:(x=1-t._queryFogOpacity(p),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${io[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const t=this._pos,o=this._map,p=this.getPitchAlignment();if(!o||!t||p!=="map")return"";if(!o._showingGlobe()){const O=o.getPitch();return O?`rotateX(${O}deg)`:""}const x=i.cX(i.f6(o.transform,this._lngLat)),T=t.sub(i.f7(o.transform)),E=Math.abs(T.x)+Math.abs(T.y);if(E===0)return"";const j=x/E;return`rotateX(${-T.y*j}deg) rotateY(${T.x*j}deg)`}_calculateZTransform(){const t=this._pos,o=this._map;if(!o||!t)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(o._showingGlobe()){const T=o.project(new i.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=o.project(new i.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(T);p=i.cX(Math.atan2(E.y,E.x))-90}else p=-o.getBearing();else if(x==="horizon"){const T=i.ah(4,6,o.getZoom()),E=i.f7(o.transform);E.y+=T*o.transform.height;const j=t.sub(E),O=i.cX(Math.atan2(j.y,j.x));p=(O>90?O-270:O+90)*(1-T)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Ic(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),o._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=i.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const o=this._map;if(!o)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const T=this._clickTolerance||o._clickTolerance;if(t.point.dist(p)<T)return;this._isDragging=!0}this._pos=t.point.sub(x),this._lngLat=o.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(t){const o=this._map,p=this._pos;o&&p&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(p),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Gl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Gl.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Gl.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Gl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const mg={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},fo={maxWidth:100,unit:"metric"},ql={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Wl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ns=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Md(m=new i.P(0,0),t="bottom"){if(typeof m=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(t){case"top":return new i.P(0,m);case"top-left":return new i.P(o,o);case"top-right":return new i.P(-o,o);case"bottom":return new i.P(0,-m);case"bottom-left":return new i.P(o,-o);case"bottom-right":return new i.P(-o,-o);case"left":return new i.P(m,0);case"right":return new i.P(-m,0)}return new i.P(0,0)}return m instanceof i.P||Array.isArray(m)?i.P.convert(m):i.P.convert(m[t]||[0,0])}return{version:C,supported:te.supported,setRTLTextPlugin:i.fb,getRTLTextPluginStatus:i.fa,Map:class extends cm{constructor(m){D.mark(P.create);const t=m;if((m=Object.assign({},h_,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&i.f3(window)&&(m.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Pu(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Er,this._domRenderTaskQueue=new Er,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b2(),this._locale=Object.assign({},gu,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Rc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Di(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const o=document.getElementById(m.container);if(!o)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=o}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new u_(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||i.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new Qm(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const o=m.bounds;o&&(this.resize(),this.fitBounds(o,Object.assign({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Cd({customAttribution:m.customAttribution})),this._logoControl=new nf,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(o=>{this._update(o.dataType==="style"),this.fire(new i.z(`${o.dataType}data`,o))})),this.on("dataloading",(o=>{this.fire(new i.z(`${o.dataType}dataloading`,o))})),this._interactions=new Lc(this)}_getMapId(){return this._mapId}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(o,p.firstChild):p.appendChild(o),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new i.z("movestart",m)).fire(new i.z("move",m)),this.fire(new i.z("resize",m)),t&&this.fire(new i.z("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(i.aI.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map((t=>t==="auto"?navigator.language:t)):m}setLanguage(m){const t=this._parseLanguage(m);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,t=m.projection.name;let o;t==="globe"&&m.zoom>=i.cL?(m.setMercatorFromTransition(),o=!0):t==="mercator"&&m.zoom<i.cL&&(m.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,t){return this._updateProjection(m||t||{name:"mercator"})}_updateProjection(m){let t;const o=this.transform.mercatorFromTransition;t=m.name==="globe"&&this.transform.zoom>=i.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&o!==this.transform.mercatorFromTransition;return(t||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,t){return this.transform.locationPoint3D(i.aT.convert(m),t)}unproject(m,t){return this.transform.pointLocation3D(i.P.convert(m),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,t,o){const p=x=>{let T=[];if(Array.isArray(t)){const E=t.filter((j=>this.getLayer(j)));T=E.length?this.queryRenderedFeatures(x,{layers:E}):[]}else T=this.queryRenderedFeatures(x,{target:t});return T};if(m==="mouseenter"||m==="mouseover"){let x=!1;return{listener:o,targets:t,delegates:{mousemove:E=>{const j=p(E.point);j.length?x||(x=!0,o.call(this,new br(m,this,E.originalEvent,{features:j}))):x=!1},mouseout:()=>{x=!1}}}}if(m==="mouseleave"||m==="mouseout"){let x=!1;return{listener:o,targets:t,delegates:{mousemove:j=>{p(j.point).length?x=!0:x&&(x=!1,o.call(this,new br(m,this,j.originalEvent)))},mouseout:j=>{x&&(x=!1,o.call(this,new br(m,this,j.originalEvent)))}}}}{const x=T=>{const E=p(T.point);E.length&&(T.features=E,o.call(this,T),delete T.features)};return{listener:o,targets:t,delegates:{[m]:x}}}}on(m,t,o){if(typeof t=="function"||o===void 0)return super.on(m,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._createDelegatedListener(m,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(m,t,o){if(typeof t=="function"||o===void 0)return super.once(m,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._createDelegatedListener(m,t,o);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(m,t,o){if(typeof t=="function"||o===void 0)return super.off(m,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._delegatedListeners?this._delegatedListeners[m]:void 0;return p&&(x=>{for(let T=0;T<x.length;T++){const E=x[T];if(E.listener===o&&d_(E.targets,t)){for(const j in E.delegates)this.off(j,E.delegates[j]);return x.splice(T,1),this}}})(p),this}queryRenderedFeatures(m,t){if(!this.style)return[];if(m===void 0||m instanceof i.P||Array.isArray(m)||t!==void 0||(t=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!t){const T=this.style.queryRenderedFeatures(m,void 0,this.transform),E=this.style.queryRenderedFeatureset(m,void 0,this.transform);return T.concat(E)}let o=!0;if(t.target&&(o=this._isTargetValid(t.target),o&&!t.layers))return this.style.queryRenderedFeatureset(m,t,this.transform);let p=!0;if(t.layers&&Array.isArray(t.layers)){for(const T of t.layers)if(!this._isValidId(T)){p=!1;break}if(p&&!t.target)return this.style.queryRenderedFeatures(m,t,this.transform)}let x=[];return p&&(x=x.concat(this.style.queryRenderedFeatures(m,t,this.transform))),o&&(x=x.concat(this.style.queryRenderedFeatureset(m,t,this.transform))),x}querySourceFeatures(m,t){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,t)}queryRasterValue(m,t,o){return this._isValidId(m)?this.style.queryRasterValue(m,t,o):Promise.resolve(null)}isPointOnSurface(m){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&i.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(m))}addInteraction(m,t){return this._interactions.add(m,t),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&m&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(m,((o,p)=>{if(o){const x=typeof o=="string"?o:o instanceof Error?o.message:o.error;i.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(m,t)}else p&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(m,t))}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const o=Object.assign({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new es(this,o).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new es(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dr(m)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const t of m)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(m)}addSource(m,t){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(m,t,o)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,t,{pixelRatio:o=1,sdf:p=!1,stretchX:x,stretchY:T,content:E}={}){this._lazyInitEmptyStyle();const j=i.I.from(m);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:O,height:B,data:H}=i.o.getImageData(t);this.style.addImage(j,{data:new i.q({width:O,height:B},H),pixelRatio:o,stretchX:x,stretchY:T,content:E,sdf:p,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:B}=t,H=t;this.style.addImage(j,{data:new i.q({width:O,height:B},new Uint8Array(H.data)),pixelRatio:o,stretchX:x,stretchY:T,content:E,sdf:p,usvg:!1,version:0,userImage:H}),H.onAdd&&H.onAdd(this,m)}}updateImage(m,t){this._lazyInitEmptyStyle();const o=i.I.from(m),p=this.style.getImage(o);if(!p)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?i.o.getImageData(t):t,{width:T,height:E,data:j}=x;if(T===void 0||E===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(T!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||E!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${T}, ${E})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const O=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let B=!1;p.usvg?(p.data=new i.q({width:T,height:E},new Uint8Array(j)),p.usvg=!1,p.icon=void 0,B=!0):p.data.replace(j,O),this.style.updateImage(o,p,B)}hasImage(m){return m?!!this.style&&!!this.style.getImage(i.I.from(m)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(i.I.from(m))}loadImage(m,t){i.n(this._requestManager.transformRequest(m,i.R.Image),((o,p)=>{t(o,p instanceof HTMLImageElement?i.o.getImageData(p):p)}))}listImages(){return this.style.listImages().map((m=>m.name))}addModel(m,t){this._lazyInitEmptyStyle(),this.style.addModel(m,t)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,t){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)):this}getSlot(m){const t=this.getLayer(m);return t&&t.slot||null}setSlot(m,t){return this.style.setSlot(m,t),this.style.mergeLayers(),this._update(!0)}addImport(m,t){return this.style.addImport(m,t).catch((o=>this.fire(new i.y(new Error("Failed to add import",o))))),this}updateImport(m,t){return typeof t!="string"&&t.id!==m?(this.removeImport(m),this.addImport(t)):(this.style.updateImport(m,t),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,t){return this.style.moveImport(m,t),this._update(!0)}moveLayer(m,t){return this._isValidId(m)?(this.style.moveLayer(m,t),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const t=this.style.getOwnLayer(m);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,t,o){return this._isValidId(m)?(this.style.setLayerZoomRange(m,t,o),this._update(!0)):this}setFilter(m,t,o={}){return this._isValidId(m)?(this.style.setFilter(m,t,o),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,t,o,p={}){return this._isValidId(m)?(this.style.setPaintProperty(m,t,o,p),this._update(!0)):this}getPaintProperty(m,t){return this._isValidId(m)?this.style.getPaintProperty(m,t):null}setLayoutProperty(m,t,o,p={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,t,o,p),this._update(!0)):this}getLayoutProperty(m,t){return this._isValidId(m)?this.style.getLayoutProperty(m,t):null}setLayerProperty(m,t,o,p={}){return this._isValidId(m)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(m,t,o,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,t){return this.style.setSchema(m,t),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,t){return this.style.setConfig(m,t),this._update(!0)}getConfigProperty(m,t){return this.style.getConfigProperty(m,t)}setConfigProperty(m,t,o){return this.style.setConfigProperty(m,t,o),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const t=m[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,t),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aT.convert(m),this.transform):0}setFeatureState(m,t){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,t),this._update())}removeFeatureState(m,t){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,t),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.indoor.selectFloor(m)}_setIndoorActiveFloorsVisibility(m){this.indoor.setActiveFloorsVisibility(m)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new El),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let o,p,x,T=this._container;for(;T&&(!p||!x);){const E=window.getComputedStyle(T).transform;E&&E!=="none"&&(o=E.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(p=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(x=o[3])),T=T.parentElement}this._containerWidth=p?Math.abs(m/p):m,this._containerHeight=x?Math.abs(t/x):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new tu(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=le("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=le("div","mapboxgl-canvas-container",m);this._canvas=le("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=le("div","mapboxgl-control-container",m),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((x=>{p[x]=le("div",`mapboxgl-ctrl-${x}`,o)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t){const o=i.o.devicePixelRatio||1;this._canvas.width=o*Math.ceil(m),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const t=this._markers.indexOf(m);t!==-1&&this._markers.splice(t,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const t=this._popups.indexOf(m);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const m=Object.assign({},te.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",m);t?(Tn(t,!0),this.painter=new rh(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",(o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),i.k.testSupport(t)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let t;this.fire(new i.z("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,p=i.o.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=x.createQuery(),x.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,H=this.transform.pitch,K=i.o.now(),Y=new i.ac(B,{now:K,fadeDuration:T,pitch:H,transition:this.style.transition,worldview:this._worldview});this.style.update(Y)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(p);const j=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),j&&(this._placementDirty=j.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,D.mark(P.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const B=i.o.now()-p;x.endQuery(o.TIME_ELAPSED_EXT),setTimeout((()=>{const H=x.getQueryParameter(t,x.QUERY_RESULT)/1e6;x.deleteQuery(t),this.fire(new i.z("gpu-timing-frame",{cpuTime:B,gpuTime:H}))}),50)}if(this.listens("gpu-timing-layer")){const B=this.painter.collectGpuTimers();setTimeout((()=>{const H=this.painter.queryGpuTimers(B);this.fire(new i.z("gpu-timing-layer",{layerTimes:H}))}),50)}if(this.listens("gpu-timing-deferred-render")){const B=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const H=this.painter.queryGpuTimeDeferredRender(B);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:H}))}),50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(O||this._repaint)this.triggerRepaint();else{const B=this.idle();if(B&&(E=this._updateAverageElevation(p,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),B&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,D.mark(P.fullLoad),this._performanceMetricsCollection&&Ii(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const t of this._markers)m&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!m||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(m,t=!1){const o=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(t||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const x=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=m;const E=Math.abs(x-T);if(E>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(T),o(T);this._averageElevation.easeTo(T,m,300)}else if(E>1e-4)return this._averageElevation.jumpTo(T),o(T)}return!!this._averageElevation.isEasing(m)&&o(this._averageElevation.getValue(m))}_authenticate(){mn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(m=>{if(m&&(m.message===jt||m.status===401)){const t=this.painter.context.gl;Tn(t,!1),this._logoControl instanceof nf&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),At(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&yn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&pn(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Un(this._requestManager._customAccessToken)}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,p=o.createFramebuffer();function x(T){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,T,0);const E=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,E),E}return o.bindFramebuffer(o.FRAMEBUFFER,p),this._canvasPixelComparison(x(m),t.canvasCopies.map(x),t.timeStamps)}_canvasPixelComparison(m,t,o){let p=o[1]-o[0];const x=m.length/4;for(let T=0;T<t.length;T++){const E=t[T];let j=0;for(let O=0;O<E.length;O+=4)E[O]===m[O]&&E[O+1]===m[O+1]&&E[O+2]===m[O+2]&&E[O+3]===m[O+3]&&(j+=1);p+=(o[T+2]-o[T+1])*(1-j/x)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),cn.delete(this.painter.context.gl),nn.remove(),_i.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=i.o.frame((t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)})))}_preloadTiles(m){const t=this.style?this.style.getSourceCaches():[];return i.bw(t,((o,p)=>o._preloadTiles(m,p)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this.style&&m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,t){i.f4(m,t)}get version(){return C}},NavigationControl:class{constructor(m={}){this.options=Object.assign({},is,m),this._container=le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),le("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),le("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))})),this._compassIcon=le("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const t=m.getZoom(),o=t===m.getMaxZoom(),p=t===m.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Al(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,t){const o=le("button",m,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(m,t){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${t}`);m.setAttribute("aria-label",o),m.firstElementChild&&m.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends i.E{constructor(m={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},mg,m),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Qf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,m(o)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((o=>t(o.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),o=m.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:m.coords,timestamp:m.timestamp},m.toJSON?{toJSON:m.toJSON.bind(m)}:{}))),this._finish()}}_updateCamera(m){const t=new i.aT(m.coords.longitude,m.coords.latitude),o=m.coords.accuracy,p=this._map.getBearing(),x=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),x,{geolocateSource:!0})}_updateMarker(m){if(m){const t=new i.aT(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,t=i.cf(1,m._center.lat)*m.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=le("button","mapboxgl-ctrl-geolocate",this._container),le("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=le("div","mapboxgl-user-location"),this._dotElement.appendChild(le("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(le("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new up({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=le("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new up({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))}))}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&m()})).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Cd,ScaleControl:class{constructor(m={}){this.options=Object.assign({},fo,m),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,p=t._containerWidth/2-m/2,x=t.unproject([p,o]),T=t.unproject([p+m,o]),E=x.distanceTo(T);if(this.options.unit==="imperial"){const j=3.2808*E;j>5280?this._setScale(m,j/5280,"mile"):this._setScale(m,j,"foot")}else this.options.unit==="nautical"?this._setScale(m,E/1852,"nautical-mile"):E>=1e3?this._setScale(m,E/1e3,"kilometer"):this._setScale(m,E,"meter")}_setScale(m,t,o){this._map._requestDomTask((()=>{const p=(function(T){const E=Math.pow(10,`${Math.floor(T)}`.length-1);let j=T/E;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:j>=1?1:(function(O){const B=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*B)/B})(j),E*j})(t),x=p/t;this._container.innerHTML=o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(p):`${p}&nbsp;${ql[o]}`,this._container.style.width=m*x+"px"}))}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=le("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=le("button","mapboxgl-ctrl-fullscreen",this._controlContainer);le("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:El,Popup:class extends i.E{constructor(m){super(),this.options=Object.assign(Object.create(Wl),m),this._altitude=this.options.altitude,i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=i.aT.convert(m),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),o=document.createElement("body");let p;for(o.innerHTML=m;p=o.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=le("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(m),this.options.closeButton){const o=this._closeButton=le("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let t;return this._classList.delete(m)?t=!1:(this._classList.add(m),t=!0),this._updateClassList(),t}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const t=this._map,o=this._container,p=this._pos;if(!t||!o||!p)return"bottom";const x=o.offsetWidth,T=o.offsetHeight,E=p.x<x/2,j=p.x>t.transform.width-x/2;if(p.y+m<T)return E?"top-left":j?"top-right":"top";if(p.y>t.transform.height-T){if(E)return"bottom-left";if(j)return"bottom-right"}return E?"left":j?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),m.className=t.join(" ")}_update(m){const t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let p=this._container;if(p||(p=this._container=le("div","mapboxgl-popup",t.getContainer()),this._tip=le("div","mapboxgl-popup-tip",p),p.appendChild(o)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ic(this._lngLat,this._pos,t.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m instanceof i.P?m:t.project(this._lngLat,this._altitude),T=Md(this.options.offset),E=this._anchor=this._getAnchor(T.y),j=Md(this.options.offset,E),O=x.add(j).round();t._requestDomTask((()=>{this._container&&E&&(this._container.style.transform=`${io[E]} translate(${O.x}px,${O.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const x=i.f5(t.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(ns);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:up,Style:es,LngLat:i.aT,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:Tr,Evented:i.E,config:i.e,prewarm:i.f9,clearPrewarmedResources:i.f8,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(m){i.e.ACCESS_TOKEN=m},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(m){i.e.API_URL=m},get workerCount(){return i.fi.workerCount},set workerCount(m){i.fi.workerCount=m},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){i.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){i.fh(m)},get workerUrl(){return i.fg.workerUrl},set workerUrl(m){i.fg.workerUrl=m},get workerClass(){return i.fg.workerClass},set workerClass(m){i.fg.workerClass=m},get workerParams(){return i.fg.workerParams},set workerParams(m){i.fg.workerParams=m},get dracoUrl(){return i.ff()},set dracoUrl(m){i.fe(m)},get meshoptUrl(){return i.fd()},set meshoptUrl(m){i.fc(m)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}}));var w=f;return w}))})(pb)),pb.exports}var X5=Z5();const Sm=Ub(X5),Y5="/tamulokal.png",K5="mapbox://styles/mapbox/streets-v12",U1=12,Bv=[0,0];Sm.accessToken="pk.eyJ1IjoiZmF1emFua2Fzc2ltIiwiYSI6ImNtazdyaWNwazE0cGgzZ29qb3A0b3RrNHoifQ.RAsBIKXQEpekRoQKUrM0Fg";const ZA=(s,a,l=64)=>{const[u,f]=s,y=a/1e3,w=[];for(let i=0;i<l;i++){const C=i/l*(2*Math.PI),P=y*Math.cos(C),$=y*Math.sin(C)/111.32,G=P/(111.32*Math.cos(f*Math.PI/180));w.push([u+G,f+$])}return w.push(w[0]),{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[w]}}},ej=pe.forwardRef(({location:s,markers:a=[],distance:l=1e4,routeTo:u=null,onMarkerClick:f,onRouteFound:y,onClose:w,onCancelRoute:i,mapHeight:C="100dvh"},P)=>{const D=pe.useRef(null),$=pe.useRef(null),G=pe.useRef([]),X=pe.useId().replace(/:/g,"_"),[te,le]=pe.useState(!1),re=pe.useRef(y),fe=(Ee,et)=>Math.abs(Ee-et)<1e-6;pe.useEffect(()=>{re.current=y},[y]);const xe=()=>typeof window>"u"?{padding:50,maxZoom:15}:window.innerWidth>window.innerHeight&&window.innerWidth>=1024?{padding:100,maxZoom:15}:{padding:50,maxZoom:15};pe.useImperativeHandle(P,()=>({flyTo:(Ee,et=15)=>{if(!D.current||!Ee)return;const[at,He]=Ee;D.current.flyTo({center:[He,at],zoom:et,speed:.8,curve:1.3})},setView:(Ee,et=U1)=>{if(!D.current||!Ee)return;const[at,He]=Ee;D.current.setCenter([He,at]),D.current.setZoom(et)},recenterMap:()=>{if(!D.current||!$.current)return;const Ee=new Sm.LngLatBounds;$.current.geometry.coordinates[0].forEach(He=>Ee.extend(He));const{padding:et,maxZoom:at}=xe();D.current.fitBounds(Ee,{padding:et,maxZoom:at})},getCenter:()=>D.current?.getCenter()??null,getZoom:()=>D.current?.getZoom()??null})),pe.useEffect(()=>{if(!Sm.accessToken){console.error("Mapbox token missing");return}if(!document.getElementById(X))return;const Ee=new Sm.Map({container:X,style:K5,center:s?[s[1],s[0]]:Bv,zoom:s?U1:2,pitch:0,bearing:0});return Ee.on("load",()=>{Ee.addSource("user",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Point",coordinates:s?[s[1],s[0]]:Bv}}}),Ee.addLayer({id:"user-dot",type:"circle",source:"user",paint:{"circle-radius":8,"circle-color":"#FF8225","circle-stroke-width":2,"circle-stroke-color":"#ffffff"}}),$.current=ZA(s?[s[1],s[0]]:Bv,l),Ee.addSource("radius",{type:"geojson",data:{type:"FeatureCollection",features:[$.current]}}),Ee.addLayer({id:"radius-fill",type:"fill",source:"radius",paint:{"fill-color":"#1E90FF","fill-opacity":.12}}),Ee.addLayer({id:"radius-outline",type:"line",source:"radius",paint:{"line-color":"#1E90FF","line-width":2,"line-opacity":.6}}),Ee.addSource("route",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ee.addLayer({id:"route-line",type:"line",source:"route",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2563eb","line-width":6,"line-opacity":.8}});const et=new Sm.LngLatBounds;$.current.geometry.coordinates[0].forEach(lt=>et.extend(lt));const{padding:at,maxZoom:He}=xe();Ee.fitBounds(et,{padding:at,maxZoom:He})}),D.current=Ee,()=>{D.current&&(D.current.remove(),D.current=null)}},[X]),pe.useEffect(()=>{const Ee=D.current;if(!Ee?.getSource("user"))return;const et=s?[s[1],s[0]]:Bv;Ee.getSource("user").setData({type:"Feature",properties:{},geometry:{type:"Point",coordinates:et}}),s&&Ee.flyTo({center:et,zoom:U1,speed:.8,curve:1.3})},[s]),pe.useEffect(()=>{const Ee=D.current;if(!Ee)return;G.current.forEach(at=>at.remove()),G.current=[],(u&&Array.isArray(u)?a.filter(at=>fe(at.lat,u[0])&&fe(at.lng,u[1])):a).forEach(at=>{const He=document.createElement("div");He.style.width="44px",He.style.height="44px",He.style.border="2px solid #FF8225",He.style.borderRadius="50%",He.style.background="#ffffff",He.style.display="flex",He.style.alignItems="center",He.style.justifyContent="center",He.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)",He.style.cursor="pointer";const lt=document.createElement("img");lt.src=Y5,lt.alt=at.name||"marker",lt.style.width="70%",lt.style.height="70%",lt.style.objectFit="contain",He.appendChild(lt),He.addEventListener("click",()=>{Ee.flyTo({center:[at.lng,at.lat],zoom:15,speed:.8,curve:1.3}),f&&f(at.id)});const pt=new Sm.Marker({element:He,anchor:"bottom"}).setLngLat([at.lng,at.lat]).addTo(Ee);G.current.push(pt)})},[a,f,u]),pe.useEffect(()=>{const Ee=D.current;if(!Ee?.getSource("radius"))return;const et=s?[s[1],s[0]]:Bv;$.current=ZA(et,l),Ee.getSource("radius").setData({type:"FeatureCollection",features:[$.current]});const at=new Sm.LngLatBounds;$.current.geometry.coordinates[0].forEach(pt=>at.extend(pt));const{padding:He,maxZoom:lt}=xe();Ee.fitBounds(at,{padding:He,maxZoom:lt}),le(!1)},[l,s]),pe.useEffect(()=>{const Ee=D.current;if(!Ee?.getSource("route"))return;const et=()=>{Ee.getSource("route").setData({type:"FeatureCollection",features:[]})};if(!u||!s){et();return}return(async()=>{try{const He=`https://api.mapbox.com/directions/v5/mapbox/driving/${s[1]},${s[0]};${u[1]},${u[0]}?geometries=geojson&overview=full&steps=true&access_token=${Sm.accessToken}`,pt=await(await fetch(He)).json(),Zt=pt?.routes?.[0]?.geometry;if(!Zt){et();return}Ee.getSource("route").setData({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:Zt}]});const jt=pt?.routes?.[0]?.legs?.[0]?.steps||[];re.current&&re.current(jt),Ee.flyTo({center:[s[1],s[0]],zoom:18,speed:.8,curve:1.3}),le(!0)}catch(He){console.error("Error fetching route:",He),et()}})(),()=>et()},[u,s]);const be=()=>{if(D.current&&$.current){const Ee=new Sm.LngLatBounds;$.current.geometry.coordinates[0].forEach(He=>Ee.extend(He));const{padding:et,maxZoom:at}=xe();D.current.fitBounds(Ee,{padding:et,maxZoom:at})}},Ne=()=>{w();const Ee=D.current;Ee&&(s&&!te?(Ee.flyTo({center:[s[1],s[0]],zoom:18,speed:.8,curve:1.3}),le(!0)):(be(),le(!1)))},Be=()=>{be(),le(!1),i&&i()};return A.jsxs("div",{className:"relative w-full",style:{height:C},children:[A.jsx("div",{id:X,className:"w-full h-full"}),u&&A.jsx("button",{onClick:Be,className:"absolute top-4 left-2 z-[1000] p-4 rounded-xl bg-[var(--white)] shadow-md hover:bg-gray-100 transition-colors flex items-center justify-center",title:"Cancel route",children:A.jsx(Fd,{className:"text-xl text-[var(--black)]"})}),A.jsx("button",{onClick:Ne,className:"absolute top-4 right-2 z-[1000] p-4 rounded-xl bg-[var(--white)] shadow-md hover:bg-gray-100 transition-colors flex items-center justify-center",title:"Recenter map",children:A.jsx(DO,{className:"text-xl text-[var(--black)]"})})]})});ej.displayName="MapboxMap";const J5=({market:s,userLocation:a,onGetDirection:l})=>{const{distance:u,loading:f}=YS(s.latitude,s.longitude),y=pe.useMemo(()=>{if(!s.open_time||!s.close_time)return!1;const w=new Date(s.open_time),i=new Date(s.close_time),C=new Date,P=w.getHours()*60+w.getMinutes(),D=i.getHours()*60+i.getMinutes(),$=C.getHours()*60+C.getMinutes();return D<P?$>=P||$<=D:$>=P&&$<=D},[s.open_time,s.close_time]);return A.jsxs("div",{className:"bg-white rounded-2xl shadow-[0_0_4px_rgba(0,0,0,0.25)] font-inter w-[300px] h-[180px] p-3 flex flex-col items-center",children:[A.jsx("img",{src:s.image,alt:s.name,className:"w-[280px] h-[70px] object-cover rounded-xl"}),A.jsxs("div",{className:"w-full flex justify-between items-start mt-3 px-1",children:[A.jsx("h3",{className:"w-1/2 text-sm font-semibold text-[#1E1E1E] leading-tight break-words",children:s.name}),A.jsxs("div",{className:"w-1/2 flex justify-end items-center text-xs gap-1 whitespace-nowrap",children:[A.jsx("span",{className:y?"text-[var(--green)]":"text-[var(--red)]",children:y?"Open":"Closed"}),A.jsxs("span",{children:["| ",f?"Loading...":`${u} km`]})]})]}),A.jsxs("div",{className:"flex justify-between w-full mt-3 px-1 gap-2",children:[A.jsx("button",{onClick:()=>l&&l(s),className:"w-1/2 h-[30px] rounded-xl border border-[#FF8225] text-[#FF8225] text-sm font-medium hover:bg-[#FF8225] hover:text-white transition-colors",children:"Get Direction"}),A.jsx($s,{to:`/market/${s.id}`,className:"w-1/2 h-[30px] rounded-xl bg-[#FF8225] text-white text-sm font-medium flex items-center justify-center hover:bg-[#e6731f] transition-colors",children:"Check"})]})]})},Q5=({markets:s=[],userLocation:a,selectedMarketId:l,onMarketFocus:u,onGetDirection:f})=>{const y=pe.useRef(null),[w,i]=pe.useState(!1);return pe.useEffect(()=>{if(!l||!y.current)return;const C=y.current.querySelector(`[data-id='${l}']`);C&&C.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})},[l]),pe.useEffect(()=>{const C=y.current;if(!C)return;let P;const D=()=>{i(!0),clearTimeout(P),P=setTimeout(()=>{i(!1);const $=C.getBoundingClientRect(),G=$.left+$.width/2;let X=null,te=1/0;if(C.querySelectorAll(".map-card").forEach(le=>{const re=le.getBoundingClientRect(),fe=re.left+re.width/2,xe=Math.abs(G-fe);xe<te&&(te=xe,X=le)}),X){const le=X.dataset.id,re=s.find(fe=>fe.id===le);re&&u&&u(re)}},150)};return C.addEventListener("scroll",D),()=>C.removeEventListener("scroll",D)},[s,u]),A.jsx("div",{className:"fixed bottom-[calc(var(--navbar-height)+20px)] left-0 right-0 z-[30] flex justify-center pointer-events-none",children:A.jsx("div",{ref:y,className:`flex gap-4 overflow-x-auto snap-x snap-mandatory scroll-smooth \r
          no-scrollbar px-[calc(50%-150px)] pb-2 pointer-events-auto`,children:s.map(C=>A.jsx("div",{"data-id":C.id,className:"map-card snap-center flex-shrink-0",children:A.jsx(J5,{market:C,userLocation:a,onGetDirection:f})},C.id))})})},eU=()=>{const s=Ay(),{markets:a,loading:l}=ky(null,s),[u,f]=pe.useState([]),[y,w]=pe.useState(null),[i,C]=pe.useState(!1),[P,D]=pe.useState(null),[$,G]=pe.useState([]),[X,te]=pe.useState(0),[le,re]=pe.useState(!1),fe=pe.useRef(null),[xe,be]=pe.useState(2e4);pe.useEffect(()=>{f(a||[])},[a]);const Ne=pe.useMemo(()=>s?(u||[]).map(jt=>({...jt,distance_meters:xS(s[0],s[1],jt.latitude,jt.longitude)})).filter(jt=>jt.distance_meters<=xe):[],[u,s,xe]),Be=pe.useMemo(()=>Ne.map(jt=>({id:jt.id,name:jt.name,lat:jt.latitude,lng:jt.longitude})),[Ne]),Ee=jt=>{w(jt),C(!0),D(null),G([]),te(0),re(!1)},et=jt=>{fe.current&&jt?.latitude&&jt?.longitude&&fe.current.flyTo([jt.latitude,jt.longitude],15)},at=()=>{C(!1),w(null),te(0),re(!1)},He=jt=>{D([jt.latitude,jt.longitude]),C(!1),w(null),G([]),te(0),re(!1)},lt=(jt=[])=>{G(jt),te(0),re(!1)},pt=()=>{D(null),G([]),te(0),re(!1)};pe.useEffect(()=>{if(!P||!$.length||!s||le||X>=$.length)return;const Di=$[X]?.maneuver?.location;if(!Di)return;const[Pi,qe]=Di,wt=xS(s[0],s[1],qe,Pi),Ct=X===$.length-1?20:30;wt<=Ct&&(X===$.length-1?re(!0):te(Vi=>Vi+1))},[s,P,$,X,le]);const Zt=le&&$.length?"Arrived at destination":$[X]?.maneuver?.instruction||$[X]?.name||null;return l?A.jsx(Yp,{loading:!0}):A.jsxs(A.Fragment,{children:[A.jsx("div",{className:"relative h-screen w-screen z-0",children:A.jsx(ej,{ref:fe,location:s,markers:Be,distance:xe,routeTo:P,onMarkerClick:Ee,onClose:at,onRouteFound:lt,onCancelRoute:pt})}),i&&A.jsx(Q5,{markets:Ne,userLocation:s,selectedMarketId:y,onMarketFocus:et,onGetDirection:He}),A.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[1000] bg-white px-4 py-2 rounded-xl shadow-md flex flex-col items-center justify-center",style:{width:"240px",minHeight:"52px"},children:P&&(Zt||le)?A.jsx("span",{className:"text-sm font-medium text-center break-words",children:Zt||"Loading directions..."}):A.jsxs(A.Fragment,{children:[A.jsxs("span",{className:"text-sm font-medium text-center",children:["Radius ( ",xe/1e3," km )"]}),A.jsx("input",{type:"range",min:5e3,max:2e4,step:5e3,value:xe,className:"w-48 mt-1 cursor-pointer accent-[#FF8225]",onChange:jt=>be(Number(jt.target.value))})]})})]})};/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function kx(s){return s+.5|0}const Op=(s,a,l)=>Math.max(Math.min(s,l),a);function Xv(s){return Op(kx(s*2.55),0,255)}function $p(s){return Op(kx(s*255),0,255)}function Am(s){return Op(kx(s/2.55)/100,0,1)}function XA(s){return Op(kx(s*100),0,100)}const zd={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},ES=[..."0123456789ABCDEF"],tU=s=>ES[s&15],iU=s=>ES[(s&240)>>4]+ES[s&15],W0=s=>(s&240)>>4===(s&15),nU=s=>W0(s.r)&&W0(s.g)&&W0(s.b)&&W0(s.a);function aU(s){var a=s.length,l;return s[0]==="#"&&(a===4||a===5?l={r:255&zd[s[1]]*17,g:255&zd[s[2]]*17,b:255&zd[s[3]]*17,a:a===5?zd[s[4]]*17:255}:(a===7||a===9)&&(l={r:zd[s[1]]<<4|zd[s[2]],g:zd[s[3]]<<4|zd[s[4]],b:zd[s[5]]<<4|zd[s[6]],a:a===9?zd[s[7]]<<4|zd[s[8]]:255})),l}const rU=(s,a)=>s<255?a(s):"";function sU(s){var a=nU(s)?tU:iU;return s?"#"+a(s.r)+a(s.g)+a(s.b)+rU(s.a,a):void 0}const oU=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function tj(s,a,l){const u=a*Math.min(l,1-l),f=(y,w=(y+s/30)%12)=>l-u*Math.max(Math.min(w-3,9-w,1),-1);return[f(0),f(8),f(4)]}function lU(s,a,l){const u=(f,y=(f+s/60)%6)=>l-l*a*Math.max(Math.min(y,4-y,1),0);return[u(5),u(3),u(1)]}function cU(s,a,l){const u=tj(s,1,.5);let f;for(a+l>1&&(f=1/(a+l),a*=f,l*=f),f=0;f<3;f++)u[f]*=1-a-l,u[f]+=a;return u}function uU(s,a,l,u,f){return s===f?(a-l)/u+(a<l?6:0):a===f?(l-s)/u+2:(s-a)/u+4}function e2(s){const l=s.r/255,u=s.g/255,f=s.b/255,y=Math.max(l,u,f),w=Math.min(l,u,f),i=(y+w)/2;let C,P,D;return y!==w&&(D=y-w,P=i>.5?D/(2-y-w):D/(y+w),C=uU(l,u,f,D,y),C=C*60+.5),[C|0,P||0,i]}function t2(s,a,l,u){return(Array.isArray(a)?s(a[0],a[1],a[2]):s(a,l,u)).map($p)}function i2(s,a,l){return t2(tj,s,a,l)}function dU(s,a,l){return t2(cU,s,a,l)}function hU(s,a,l){return t2(lU,s,a,l)}function ij(s){return(s%360+360)%360}function fU(s){const a=oU.exec(s);let l=255,u;if(!a)return;a[5]!==u&&(l=a[6]?Xv(+a[5]):$p(+a[5]));const f=ij(+a[2]),y=+a[3]/100,w=+a[4]/100;return a[1]==="hwb"?u=dU(f,y,w):a[1]==="hsv"?u=hU(f,y,w):u=i2(f,y,w),{r:u[0],g:u[1],b:u[2],a:l}}function mU(s,a){var l=e2(s);l[0]=ij(l[0]+a),l=i2(l),s.r=l[0],s.g=l[1],s.b=l[2]}function pU(s){if(!s)return;const a=e2(s),l=a[0],u=XA(a[1]),f=XA(a[2]);return s.a<255?`hsla(${l}, ${u}%, ${f}%, ${Am(s.a)})`:`hsl(${l}, ${u}%, ${f}%)`}const YA={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},KA={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function gU(){const s={},a=Object.keys(KA),l=Object.keys(YA);let u,f,y,w,i;for(u=0;u<a.length;u++){for(w=i=a[u],f=0;f<l.length;f++)y=l[f],i=i.replace(y,YA[y]);y=parseInt(KA[w],16),s[i]=[y>>16&255,y>>8&255,y&255]}return s}let Z0;function _U(s){Z0||(Z0=gU(),Z0.transparent=[0,0,0,0]);const a=Z0[s.toLowerCase()];return a&&{r:a[0],g:a[1],b:a[2],a:a.length===4?a[3]:255}}const yU=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function vU(s){const a=yU.exec(s);let l=255,u,f,y;if(a){if(a[7]!==u){const w=+a[7];l=a[8]?Xv(w):Op(w*255,0,255)}return u=+a[1],f=+a[3],y=+a[5],u=255&(a[2]?Xv(u):Op(u,0,255)),f=255&(a[4]?Xv(f):Op(f,0,255)),y=255&(a[6]?Xv(y):Op(y,0,255)),{r:u,g:f,b:y,a:l}}}function xU(s){return s&&(s.a<255?`rgba(${s.r}, ${s.g}, ${s.b}, ${Am(s.a)})`:`rgb(${s.r}, ${s.g}, ${s.b})`)}const $1=s=>s<=.0031308?s*12.92:Math.pow(s,1/2.4)*1.055-.055,cy=s=>s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4);function bU(s,a,l){const u=cy(Am(s.r)),f=cy(Am(s.g)),y=cy(Am(s.b));return{r:$p($1(u+l*(cy(Am(a.r))-u))),g:$p($1(f+l*(cy(Am(a.g))-f))),b:$p($1(y+l*(cy(Am(a.b))-y))),a:s.a+l*(a.a-s.a)}}function X0(s,a,l){if(s){let u=e2(s);u[a]=Math.max(0,Math.min(u[a]+u[a]*l,a===0?360:1)),u=i2(u),s.r=u[0],s.g=u[1],s.b=u[2]}}function nj(s,a){return s&&Object.assign(a||{},s)}function JA(s){var a={r:0,g:0,b:0,a:255};return Array.isArray(s)?s.length>=3&&(a={r:s[0],g:s[1],b:s[2],a:255},s.length>3&&(a.a=$p(s[3]))):(a=nj(s,{r:0,g:0,b:0,a:1}),a.a=$p(a.a)),a}function wU(s){return s.charAt(0)==="r"?vU(s):fU(s)}class px{constructor(a){if(a instanceof px)return a;const l=typeof a;let u;l==="object"?u=JA(a):l==="string"&&(u=aU(a)||_U(a)||wU(a)),this._rgb=u,this._valid=!!u}get valid(){return this._valid}get rgb(){var a=nj(this._rgb);return a&&(a.a=Am(a.a)),a}set rgb(a){this._rgb=JA(a)}rgbString(){return this._valid?xU(this._rgb):void 0}hexString(){return this._valid?sU(this._rgb):void 0}hslString(){return this._valid?pU(this._rgb):void 0}mix(a,l){if(a){const u=this.rgb,f=a.rgb;let y;const w=l===y?.5:l,i=2*w-1,C=u.a-f.a,P=((i*C===-1?i:(i+C)/(1+i*C))+1)/2;y=1-P,u.r=255&P*u.r+y*f.r+.5,u.g=255&P*u.g+y*f.g+.5,u.b=255&P*u.b+y*f.b+.5,u.a=w*u.a+(1-w)*f.a,this.rgb=u}return this}interpolate(a,l){return a&&(this._rgb=bU(this._rgb,a._rgb,l)),this}clone(){return new px(this.rgb)}alpha(a){return this._rgb.a=$p(a),this}clearer(a){const l=this._rgb;return l.a*=1-a,this}greyscale(){const a=this._rgb,l=kx(a.r*.3+a.g*.59+a.b*.11);return a.r=a.g=a.b=l,this}opaquer(a){const l=this._rgb;return l.a*=1+a,this}negate(){const a=this._rgb;return a.r=255-a.r,a.g=255-a.g,a.b=255-a.b,this}lighten(a){return X0(this._rgb,2,a),this}darken(a){return X0(this._rgb,2,-a),this}saturate(a){return X0(this._rgb,1,a),this}desaturate(a){return X0(this._rgb,1,-a),this}rotate(a){return mU(this._rgb,a),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function vm(){}const SU=(()=>{let s=0;return()=>s++})();function us(s){return s==null}function zl(s){if(Array.isArray&&Array.isArray(s))return!0;const a=Object.prototype.toString.call(s);return a.slice(0,7)==="[object"&&a.slice(-6)==="Array]"}function Rr(s){return s!==null&&Object.prototype.toString.call(s)==="[object Object]"}function Bd(s){return(typeof s=="number"||s instanceof Number)&&isFinite(+s)}function gf(s,a){return Bd(s)?s:a}function Br(s,a){return typeof s>"u"?a:s}const TU=(s,a)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100*a:+s;function Ms(s,a,l){if(s&&typeof s.call=="function")return s.apply(l,a)}function Kr(s,a,l,u){let f,y,w;if(zl(s))for(y=s.length,f=0;f<y;f++)a.call(l,s[f],f);else if(Rr(s))for(w=Object.keys(s),y=w.length,f=0;f<y;f++)a.call(l,s[w[f]],w[f])}function Lb(s,a){let l,u,f,y;if(!s||!a||s.length!==a.length)return!1;for(l=0,u=s.length;l<u;++l)if(f=s[l],y=a[l],f.datasetIndex!==y.datasetIndex||f.index!==y.index)return!1;return!0}function Ib(s){if(zl(s))return s.map(Ib);if(Rr(s)){const a=Object.create(null),l=Object.keys(s),u=l.length;let f=0;for(;f<u;++f)a[l[f]]=Ib(s[l[f]]);return a}return s}function aj(s){return["__proto__","prototype","constructor"].indexOf(s)===-1}function kU(s,a,l,u){if(!aj(s))return;const f=a[s],y=l[s];Rr(f)&&Rr(y)?gx(f,y,u):a[s]=Ib(y)}function gx(s,a,l){const u=zl(a)?a:[a],f=u.length;if(!Rr(s))return s;l=l||{};const y=l.merger||kU;let w;for(let i=0;i<f;++i){if(w=u[i],!Rr(w))continue;const C=Object.keys(w);for(let P=0,D=C.length;P<D;++P)y(C[P],s,w,l)}return s}function nx(s,a){return gx(s,a,{merger:EU})}function EU(s,a,l){if(!aj(s))return;const u=a[s],f=l[s];Rr(u)&&Rr(f)?nx(u,f):Object.prototype.hasOwnProperty.call(a,s)||(a[s]=Ib(f))}const QA={"":s=>s,x:s=>s.x,y:s=>s.y};function AU(s){const a=s.split("."),l=[];let u="";for(const f of a)u+=f,u.endsWith("\\")?u=u.slice(0,-1)+".":(l.push(u),u="");return l}function CU(s){const a=AU(s);return l=>{for(const u of a){if(u==="")break;l=l&&l[u]}return l}}function wy(s,a){return(QA[a]||(QA[a]=CU(a)))(s)}function n2(s){return s.charAt(0).toUpperCase()+s.slice(1)}const _x=s=>typeof s<"u",Wp=s=>typeof s=="function",eC=(s,a)=>{if(s.size!==a.size)return!1;for(const l of s)if(!a.has(l))return!1;return!0};function MU(s){return s.type==="mouseup"||s.type==="click"||s.type==="contextmenu"}const Tu=Math.PI,Vp=2*Tu,zb=Number.POSITIVE_INFINITY,PU=Tu/180,Sh=Tu/2,Ug=Tu/4,tC=Tu*2/3,rj=Math.log10,Hp=Math.sign;function gb(s,a,l){return Math.abs(s-a)<l}function iC(s){const a=Math.round(s);s=gb(s,a,s/1e3)?a:s;const l=Math.pow(10,Math.floor(rj(s))),u=s/l;return(u<=1?1:u<=2?2:u<=5?5:10)*l}function jU(s){const a=[],l=Math.sqrt(s);let u;for(u=1;u<l;u++)s%u===0&&(a.push(u),a.push(s/u));return l===(l|0)&&a.push(l),a.sort((f,y)=>f-y).pop(),a}function RU(s){return typeof s=="symbol"||typeof s=="object"&&s!==null&&!(Symbol.toPrimitive in s||"toString"in s||"valueOf"in s)}function Db(s){return!RU(s)&&!isNaN(parseFloat(s))&&isFinite(s)}function LU(s,a){const l=Math.round(s);return l-a<=s&&l+a>=s}function IU(s,a,l){let u,f,y;for(u=0,f=s.length;u<f;u++)y=s[u][l],isNaN(y)||(a.min=Math.min(a.min,y),a.max=Math.max(a.max,y))}function Kg(s){return s*(Tu/180)}function zU(s){return s*(180/Tu)}function nC(s){if(!Bd(s))return;let a=1,l=0;for(;Math.round(s*a)/a!==s;)a*=10,l++;return l}function DU(s,a){const l=a.x-s.x,u=a.y-s.y,f=Math.sqrt(l*l+u*u);let y=Math.atan2(u,l);return y<-.5*Tu&&(y+=Vp),{angle:y,distance:f}}function OU(s,a){return Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2))}function $g(s){return(s%Vp+Vp)%Vp}function NU(s,a,l,u){const f=$g(s),y=$g(a),w=$g(l),i=$g(y-f),C=$g(w-f),P=$g(f-y),D=$g(f-w);return f===y||f===w||u||i>C&&P<D}function Th(s,a,l){return Math.max(a,Math.min(l,s))}function FU(s){return Th(s,-32768,32767)}function my(s,a,l,u=1e-6){return s>=Math.min(a,l)-u&&s<=Math.max(a,l)+u}function a2(s,a,l){l=l||(w=>s[w]<a);let u=s.length-1,f=0,y;for(;u-f>1;)y=f+u>>1,l(y)?f=y:u=y;return{lo:f,hi:u}}const AS=(s,a,l,u)=>a2(s,l,u?f=>{const y=s[f][a];return y<l||y===l&&s[f+1][a]===l}:f=>s[f][a]<l),BU=(s,a,l)=>a2(s,l,u=>s[u][a]>=l);function UU(s,a,l){let u=0,f=s.length;for(;u<f&&s[u]<a;)u++;for(;f>u&&s[f-1]>l;)f--;return u>0||f<s.length?s.slice(u,f):s}const sj=["push","pop","shift","splice","unshift"];function $U(s,a){if(s._chartjs){s._chartjs.listeners.push(a);return}Object.defineProperty(s,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[a]}}),sj.forEach(l=>{const u="_onData"+n2(l),f=s[l];Object.defineProperty(s,l,{configurable:!0,enumerable:!1,value(...y){const w=f.apply(this,y);return s._chartjs.listeners.forEach(i=>{typeof i[u]=="function"&&i[u](...y)}),w}})})}function aC(s,a){const l=s._chartjs;if(!l)return;const u=l.listeners,f=u.indexOf(a);f!==-1&&u.splice(f,1),!(u.length>0)&&(sj.forEach(y=>{delete s[y]}),delete s._chartjs)}function oj(s){const a=new Set(s);return a.size===s.length?s:Array.from(a)}const lj=(function(){return typeof window>"u"?function(s){return s()}:window.requestAnimationFrame})();function cj(s,a){let l=[],u=!1;return function(...f){l=f,u||(u=!0,lj.call(window,()=>{u=!1,s.apply(a,l)}))}}function VU(s,a){let l;return function(...u){return a?(clearTimeout(l),l=setTimeout(s,a,u)):s.apply(this,u),a}}const uj=s=>s==="start"?"left":s==="end"?"right":"center",Zu=(s,a,l)=>s==="start"?a:s==="end"?l:(a+l)/2,HU=(s,a,l,u)=>s===(u?"left":"right")?l:s==="center"?(a+l)/2:a,Y0=s=>s===0||s===1,rC=(s,a,l)=>-(Math.pow(2,10*(s-=1))*Math.sin((s-a)*Vp/l)),sC=(s,a,l)=>Math.pow(2,-10*s)*Math.sin((s-a)*Vp/l)+1,ax={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>-s*(s-2),easeInOutQuad:s=>(s/=.5)<1?.5*s*s:-.5*(--s*(s-2)-1),easeInCubic:s=>s*s*s,easeOutCubic:s=>(s-=1)*s*s+1,easeInOutCubic:s=>(s/=.5)<1?.5*s*s*s:.5*((s-=2)*s*s+2),easeInQuart:s=>s*s*s*s,easeOutQuart:s=>-((s-=1)*s*s*s-1),easeInOutQuart:s=>(s/=.5)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2),easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>(s-=1)*s*s*s*s+1,easeInOutQuint:s=>(s/=.5)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2),easeInSine:s=>-Math.cos(s*Sh)+1,easeOutSine:s=>Math.sin(s*Sh),easeInOutSine:s=>-.5*(Math.cos(Tu*s)-1),easeInExpo:s=>s===0?0:Math.pow(2,10*(s-1)),easeOutExpo:s=>s===1?1:-Math.pow(2,-10*s)+1,easeInOutExpo:s=>Y0(s)?s:s<.5?.5*Math.pow(2,10*(s*2-1)):.5*(-Math.pow(2,-10*(s*2-1))+2),easeInCirc:s=>s>=1?s:-(Math.sqrt(1-s*s)-1),easeOutCirc:s=>Math.sqrt(1-(s-=1)*s),easeInOutCirc:s=>(s/=.5)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1),easeInElastic:s=>Y0(s)?s:rC(s,.075,.3),easeOutElastic:s=>Y0(s)?s:sC(s,.075,.3),easeInOutElastic(s){return Y0(s)?s:s<.5?.5*rC(s*2,.1125,.45):.5+.5*sC(s*2-1,.1125,.45)},easeInBack(s){return s*s*((1.70158+1)*s-1.70158)},easeOutBack(s){return(s-=1)*s*((1.70158+1)*s+1.70158)+1},easeInOutBack(s){let a=1.70158;return(s/=.5)<1?.5*(s*s*(((a*=1.525)+1)*s-a)):.5*((s-=2)*s*(((a*=1.525)+1)*s+a)+2)},easeInBounce:s=>1-ax.easeOutBounce(1-s),easeOutBounce(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},easeInOutBounce:s=>s<.5?ax.easeInBounce(s*2)*.5:ax.easeOutBounce(s*2-1)*.5+.5};function dj(s){if(s&&typeof s=="object"){const a=s.toString();return a==="[object CanvasPattern]"||a==="[object CanvasGradient]"}return!1}function oC(s){return dj(s)?s:new px(s)}function V1(s){return dj(s)?s:new px(s).saturate(.5).darken(.1).hexString()}const GU=["x","y","borderWidth","radius","tension"],qU=["color","borderColor","backgroundColor"];function WU(s){s.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),s.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:a=>a!=="onProgress"&&a!=="onComplete"&&a!=="fn"}),s.set("animations",{colors:{type:"color",properties:qU},numbers:{type:"number",properties:GU}}),s.describe("animations",{_fallback:"animation"}),s.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:a=>a|0}}}})}function ZU(s){s.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const lC=new Map;function XU(s,a){a=a||{};const l=s+JSON.stringify(a);let u=lC.get(l);return u||(u=new Intl.NumberFormat(s,a),lC.set(l,u)),u}function hj(s,a,l){return XU(a,l).format(s)}const YU={values(s){return zl(s)?s:""+s},numeric(s,a,l){if(s===0)return"0";const u=this.chart.options.locale;let f,y=s;if(l.length>1){const P=Math.max(Math.abs(l[0].value),Math.abs(l[l.length-1].value));(P<1e-4||P>1e15)&&(f="scientific"),y=KU(s,l)}const w=rj(Math.abs(y)),i=isNaN(w)?1:Math.max(Math.min(-1*Math.floor(w),20),0),C={notation:f,minimumFractionDigits:i,maximumFractionDigits:i};return Object.assign(C,this.options.ticks.format),hj(s,u,C)}};function KU(s,a){let l=a.length>3?a[2].value-a[1].value:a[1].value-a[0].value;return Math.abs(l)>=1&&s!==Math.floor(s)&&(l=s-Math.floor(s)),l}var fj={formatters:YU};function JU(s){s.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(a,l)=>l.lineWidth,tickColor:(a,l)=>l.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:fj.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),s.route("scale.ticks","color","","color"),s.route("scale.grid","color","","borderColor"),s.route("scale.border","color","","borderColor"),s.route("scale.title","color","","color"),s.describe("scale",{_fallback:!1,_scriptable:a=>!a.startsWith("before")&&!a.startsWith("after")&&a!=="callback"&&a!=="parser",_indexable:a=>a!=="borderDash"&&a!=="tickBorderDash"&&a!=="dash"}),s.describe("scales",{_fallback:"scale"}),s.describe("scale.ticks",{_scriptable:a=>a!=="backdropPadding"&&a!=="callback",_indexable:a=>a!=="backdropPadding"})}const t_=Object.create(null),CS=Object.create(null);function rx(s,a){if(!a)return s;const l=a.split(".");for(let u=0,f=l.length;u<f;++u){const y=l[u];s=s[y]||(s[y]=Object.create(null))}return s}function H1(s,a,l){return typeof a=="string"?gx(rx(s,a),l):gx(rx(s,""),a)}class QU{constructor(a,l){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=u=>u.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(u,f)=>V1(f.backgroundColor),this.hoverBorderColor=(u,f)=>V1(f.borderColor),this.hoverColor=(u,f)=>V1(f.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(a),this.apply(l)}set(a,l){return H1(this,a,l)}get(a){return rx(this,a)}describe(a,l){return H1(CS,a,l)}override(a,l){return H1(t_,a,l)}route(a,l,u,f){const y=rx(this,a),w=rx(this,u),i="_"+l;Object.defineProperties(y,{[i]:{value:y[l],writable:!0},[l]:{enumerable:!0,get(){const C=this[i],P=w[f];return Rr(C)?Object.assign({},P,C):Br(C,P)},set(C){this[i]=C}}})}apply(a){a.forEach(l=>l(this))}}var jo=new QU({_scriptable:s=>!s.startsWith("on"),_indexable:s=>s!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[WU,ZU,JU]);function e$(s){return!s||us(s.size)||us(s.family)?null:(s.style?s.style+" ":"")+(s.weight?s.weight+" ":"")+s.size+"px "+s.family}function cC(s,a,l,u,f){let y=a[f];return y||(y=a[f]=s.measureText(f).width,l.push(f)),y>u&&(u=y),u}function Vg(s,a,l){const u=s.currentDevicePixelRatio,f=l!==0?Math.max(l/2,.5):0;return Math.round((a-f)*u)/u+f}function uC(s,a){!a&&!s||(a=a||s.getContext("2d"),a.save(),a.resetTransform(),a.clearRect(0,0,s.width,s.height),a.restore())}function dC(s,a,l,u){mj(s,a,l,u,null)}function mj(s,a,l,u,f){let y,w,i,C,P,D,$,G;const X=a.pointStyle,te=a.rotation,le=a.radius;let re=(te||0)*PU;if(X&&typeof X=="object"&&(y=X.toString(),y==="[object HTMLImageElement]"||y==="[object HTMLCanvasElement]")){s.save(),s.translate(l,u),s.rotate(re),s.drawImage(X,-X.width/2,-X.height/2,X.width,X.height),s.restore();return}if(!(isNaN(le)||le<=0)){switch(s.beginPath(),X){default:f?s.ellipse(l,u,f/2,le,0,0,Vp):s.arc(l,u,le,0,Vp),s.closePath();break;case"triangle":D=f?f/2:le,s.moveTo(l+Math.sin(re)*D,u-Math.cos(re)*le),re+=tC,s.lineTo(l+Math.sin(re)*D,u-Math.cos(re)*le),re+=tC,s.lineTo(l+Math.sin(re)*D,u-Math.cos(re)*le),s.closePath();break;case"rectRounded":P=le*.516,C=le-P,w=Math.cos(re+Ug)*C,$=Math.cos(re+Ug)*(f?f/2-P:C),i=Math.sin(re+Ug)*C,G=Math.sin(re+Ug)*(f?f/2-P:C),s.arc(l-$,u-i,P,re-Tu,re-Sh),s.arc(l+G,u-w,P,re-Sh,re),s.arc(l+$,u+i,P,re,re+Sh),s.arc(l-G,u+w,P,re+Sh,re+Tu),s.closePath();break;case"rect":if(!te){C=Math.SQRT1_2*le,D=f?f/2:C,s.rect(l-D,u-C,2*D,2*C);break}re+=Ug;case"rectRot":$=Math.cos(re)*(f?f/2:le),w=Math.cos(re)*le,i=Math.sin(re)*le,G=Math.sin(re)*(f?f/2:le),s.moveTo(l-$,u-i),s.lineTo(l+G,u-w),s.lineTo(l+$,u+i),s.lineTo(l-G,u+w),s.closePath();break;case"crossRot":re+=Ug;case"cross":$=Math.cos(re)*(f?f/2:le),w=Math.cos(re)*le,i=Math.sin(re)*le,G=Math.sin(re)*(f?f/2:le),s.moveTo(l-$,u-i),s.lineTo(l+$,u+i),s.moveTo(l+G,u-w),s.lineTo(l-G,u+w);break;case"star":$=Math.cos(re)*(f?f/2:le),w=Math.cos(re)*le,i=Math.sin(re)*le,G=Math.sin(re)*(f?f/2:le),s.moveTo(l-$,u-i),s.lineTo(l+$,u+i),s.moveTo(l+G,u-w),s.lineTo(l-G,u+w),re+=Ug,$=Math.cos(re)*(f?f/2:le),w=Math.cos(re)*le,i=Math.sin(re)*le,G=Math.sin(re)*(f?f/2:le),s.moveTo(l-$,u-i),s.lineTo(l+$,u+i),s.moveTo(l+G,u-w),s.lineTo(l-G,u+w);break;case"line":w=f?f/2:Math.cos(re)*le,i=Math.sin(re)*le,s.moveTo(l-w,u-i),s.lineTo(l+w,u+i);break;case"dash":s.moveTo(l,u),s.lineTo(l+Math.cos(re)*(f?f/2:le),u+Math.sin(re)*le);break;case!1:s.closePath();break}s.fill(),a.borderWidth>0&&s.stroke()}}function pj(s,a,l){return l=l||.5,!a||s&&s.x>a.left-l&&s.x<a.right+l&&s.y>a.top-l&&s.y<a.bottom+l}function r2(s,a){s.save(),s.beginPath(),s.rect(a.left,a.top,a.right-a.left,a.bottom-a.top),s.clip()}function s2(s){s.restore()}function t$(s,a){a.translation&&s.translate(a.translation[0],a.translation[1]),us(a.rotation)||s.rotate(a.rotation),a.color&&(s.fillStyle=a.color),a.textAlign&&(s.textAlign=a.textAlign),a.textBaseline&&(s.textBaseline=a.textBaseline)}function i$(s,a,l,u,f){if(f.strikethrough||f.underline){const y=s.measureText(u),w=a-y.actualBoundingBoxLeft,i=a+y.actualBoundingBoxRight,C=l-y.actualBoundingBoxAscent,P=l+y.actualBoundingBoxDescent,D=f.strikethrough?(C+P)/2:P;s.strokeStyle=s.fillStyle,s.beginPath(),s.lineWidth=f.decorationWidth||2,s.moveTo(w,D),s.lineTo(i,D),s.stroke()}}function n$(s,a){const l=s.fillStyle;s.fillStyle=a.color,s.fillRect(a.left,a.top,a.width,a.height),s.fillStyle=l}function Ob(s,a,l,u,f,y={}){const w=zl(a)?a:[a],i=y.strokeWidth>0&&y.strokeColor!=="";let C,P;for(s.save(),s.font=f.string,t$(s,y),C=0;C<w.length;++C)P=w[C],y.backdrop&&n$(s,y.backdrop),i&&(y.strokeColor&&(s.strokeStyle=y.strokeColor),us(y.strokeWidth)||(s.lineWidth=y.strokeWidth),s.strokeText(P,l,u,y.maxWidth)),s.fillText(P,l,u,y.maxWidth),i$(s,l,u,P,y),u+=Number(f.lineHeight);s.restore()}function Nb(s,a){const{x:l,y:u,w:f,h:y,radius:w}=a;s.arc(l+w.topLeft,u+w.topLeft,w.topLeft,1.5*Tu,Tu,!0),s.lineTo(l,u+y-w.bottomLeft),s.arc(l+w.bottomLeft,u+y-w.bottomLeft,w.bottomLeft,Tu,Sh,!0),s.lineTo(l+f-w.bottomRight,u+y),s.arc(l+f-w.bottomRight,u+y-w.bottomRight,w.bottomRight,Sh,0,!0),s.lineTo(l+f,u+w.topRight),s.arc(l+f-w.topRight,u+w.topRight,w.topRight,0,-Sh,!0),s.lineTo(l+w.topLeft,u)}const a$=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,r$=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function s$(s,a){const l=(""+s).match(a$);if(!l||l[1]==="normal")return a*1.2;switch(s=+l[2],l[3]){case"px":return s;case"%":s/=100;break}return a*s}const o$=s=>+s||0;function gj(s,a){const l={},u=Rr(a),f=u?Object.keys(a):a,y=Rr(s)?u?w=>Br(s[w],s[a[w]]):w=>s[w]:()=>s;for(const w of f)l[w]=o$(y(w));return l}function _j(s){return gj(s,{top:"y",right:"x",bottom:"y",left:"x"})}function _y(s){return gj(s,["topLeft","topRight","bottomLeft","bottomRight"])}function kh(s){const a=_j(s);return a.width=a.left+a.right,a.height=a.top+a.bottom,a}function Su(s,a){s=s||{},a=a||jo.font;let l=Br(s.size,a.size);typeof l=="string"&&(l=parseInt(l,10));let u=Br(s.style,a.style);u&&!(""+u).match(r$)&&(console.warn('Invalid font style specified: "'+u+'"'),u=void 0);const f={family:Br(s.family,a.family),lineHeight:s$(Br(s.lineHeight,a.lineHeight),l),size:l,style:u,weight:Br(s.weight,a.weight),string:""};return f.string=e$(f),f}function K0(s,a,l,u){let f,y,w;for(f=0,y=s.length;f<y;++f)if(w=s[f],w!==void 0&&w!==void 0)return w}function l$(s,a,l){const{min:u,max:f}=s,y=TU(a,(f-u)/2),w=(i,C)=>l&&i===0?0:i+C;return{min:w(u,-Math.abs(y)),max:w(f,y)}}function Cy(s,a){return Object.assign(Object.create(s),a)}function o2(s,a=[""],l,u,f=()=>s[0]){const y=l||s;typeof u>"u"&&(u=bj("_fallback",s));const w={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:s,_rootScopes:y,_fallback:u,_getTarget:f,override:i=>o2([i,...s],a,y,u)};return new Proxy(w,{deleteProperty(i,C){return delete i[C],delete i._keys,delete s[0][C],!0},get(i,C){return vj(i,C,()=>g$(C,a,s,i))},getOwnPropertyDescriptor(i,C){return Reflect.getOwnPropertyDescriptor(i._scopes[0],C)},getPrototypeOf(){return Reflect.getPrototypeOf(s[0])},has(i,C){return fC(i).includes(C)},ownKeys(i){return fC(i)},set(i,C,P){const D=i._storage||(i._storage=f());return i[C]=D[C]=P,delete i._keys,!0}})}function Sy(s,a,l,u){const f={_cacheable:!1,_proxy:s,_context:a,_subProxy:l,_stack:new Set,_descriptors:yj(s,u),setContext:y=>Sy(s,y,l,u),override:y=>Sy(s.override(y),a,l,u)};return new Proxy(f,{deleteProperty(y,w){return delete y[w],delete s[w],!0},get(y,w,i){return vj(y,w,()=>u$(y,w,i))},getOwnPropertyDescriptor(y,w){return y._descriptors.allKeys?Reflect.has(s,w)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(s,w)},getPrototypeOf(){return Reflect.getPrototypeOf(s)},has(y,w){return Reflect.has(s,w)},ownKeys(){return Reflect.ownKeys(s)},set(y,w,i){return s[w]=i,delete y[w],!0}})}function yj(s,a={scriptable:!0,indexable:!0}){const{_scriptable:l=a.scriptable,_indexable:u=a.indexable,_allKeys:f=a.allKeys}=s;return{allKeys:f,scriptable:l,indexable:u,isScriptable:Wp(l)?l:()=>l,isIndexable:Wp(u)?u:()=>u}}const c$=(s,a)=>s?s+n2(a):a,l2=(s,a)=>Rr(a)&&s!=="adapters"&&(Object.getPrototypeOf(a)===null||a.constructor===Object);function vj(s,a,l){if(Object.prototype.hasOwnProperty.call(s,a)||a==="constructor")return s[a];const u=l();return s[a]=u,u}function u$(s,a,l){const{_proxy:u,_context:f,_subProxy:y,_descriptors:w}=s;let i=u[a];return Wp(i)&&w.isScriptable(a)&&(i=d$(a,i,s,l)),zl(i)&&i.length&&(i=h$(a,i,s,w.isIndexable)),l2(a,i)&&(i=Sy(i,f,y&&y[a],w)),i}function d$(s,a,l,u){const{_proxy:f,_context:y,_subProxy:w,_stack:i}=l;if(i.has(s))throw new Error("Recursion detected: "+Array.from(i).join("->")+"->"+s);i.add(s);let C=a(y,w||u);return i.delete(s),l2(s,C)&&(C=c2(f._scopes,f,s,C)),C}function h$(s,a,l,u){const{_proxy:f,_context:y,_subProxy:w,_descriptors:i}=l;if(typeof y.index<"u"&&u(s))return a[y.index%a.length];if(Rr(a[0])){const C=a,P=f._scopes.filter(D=>D!==C);a=[];for(const D of C){const $=c2(P,f,s,D);a.push(Sy($,y,w&&w[s],i))}}return a}function xj(s,a,l){return Wp(s)?s(a,l):s}const f$=(s,a)=>s===!0?a:typeof s=="string"?wy(a,s):void 0;function m$(s,a,l,u,f){for(const y of a){const w=f$(l,y);if(w){s.add(w);const i=xj(w._fallback,l,f);if(typeof i<"u"&&i!==l&&i!==u)return i}else if(w===!1&&typeof u<"u"&&l!==u)return null}return!1}function c2(s,a,l,u){const f=a._rootScopes,y=xj(a._fallback,l,u),w=[...s,...f],i=new Set;i.add(u);let C=hC(i,w,l,y||l,u);return C===null||typeof y<"u"&&y!==l&&(C=hC(i,w,y,C,u),C===null)?!1:o2(Array.from(i),[""],f,y,()=>p$(a,l,u))}function hC(s,a,l,u,f){for(;l;)l=m$(s,a,l,u,f);return l}function p$(s,a,l){const u=s._getTarget();a in u||(u[a]={});const f=u[a];return zl(f)&&Rr(l)?l:f||{}}function g$(s,a,l,u){let f;for(const y of a)if(f=bj(c$(y,s),l),typeof f<"u")return l2(s,f)?c2(l,u,s,f):f}function bj(s,a){for(const l of a){if(!l)continue;const u=l[s];if(typeof u<"u")return u}}function fC(s){let a=s._keys;return a||(a=s._keys=_$(s._scopes)),a}function _$(s){const a=new Set;for(const l of s)for(const u of Object.keys(l).filter(f=>!f.startsWith("_")))a.add(u);return Array.from(a)}function u2(){return typeof window<"u"&&typeof document<"u"}function d2(s){let a=s.parentNode;return a&&a.toString()==="[object ShadowRoot]"&&(a=a.host),a}function Fb(s,a,l){let u;return typeof s=="string"?(u=parseInt(s,10),s.indexOf("%")!==-1&&(u=u/100*a.parentNode[l])):u=s,u}const Wb=s=>s.ownerDocument.defaultView.getComputedStyle(s,null);function y$(s,a){return Wb(s).getPropertyValue(a)}const v$=["top","right","bottom","left"];function Qg(s,a,l){const u={};l=l?"-"+l:"";for(let f=0;f<4;f++){const y=v$[f];u[y]=parseFloat(s[a+"-"+y+l])||0}return u.width=u.left+u.right,u.height=u.top+u.bottom,u}const x$=(s,a,l)=>(s>0||a>0)&&(!l||!l.shadowRoot);function b$(s,a){const l=s.touches,u=l&&l.length?l[0]:s,{offsetX:f,offsetY:y}=u;let w=!1,i,C;if(x$(f,y,s.target))i=f,C=y;else{const P=a.getBoundingClientRect();i=u.clientX-P.left,C=u.clientY-P.top,w=!0}return{x:i,y:C,box:w}}function qg(s,a){if("native"in s)return s;const{canvas:l,currentDevicePixelRatio:u}=a,f=Wb(l),y=f.boxSizing==="border-box",w=Qg(f,"padding"),i=Qg(f,"border","width"),{x:C,y:P,box:D}=b$(s,l),$=w.left+(D&&i.left),G=w.top+(D&&i.top);let{width:X,height:te}=a;return y&&(X-=w.width+i.width,te-=w.height+i.height),{x:Math.round((C-$)/X*l.width/u),y:Math.round((P-G)/te*l.height/u)}}function w$(s,a,l){let u,f;if(a===void 0||l===void 0){const y=s&&d2(s);if(!y)a=s.clientWidth,l=s.clientHeight;else{const w=y.getBoundingClientRect(),i=Wb(y),C=Qg(i,"border","width"),P=Qg(i,"padding");a=w.width-P.width-C.width,l=w.height-P.height-C.height,u=Fb(i.maxWidth,y,"clientWidth"),f=Fb(i.maxHeight,y,"clientHeight")}}return{width:a,height:l,maxWidth:u||zb,maxHeight:f||zb}}const Np=s=>Math.round(s*10)/10;function S$(s,a,l,u){const f=Wb(s),y=Qg(f,"margin"),w=Fb(f.maxWidth,s,"clientWidth")||zb,i=Fb(f.maxHeight,s,"clientHeight")||zb,C=w$(s,a,l);let{width:P,height:D}=C;if(f.boxSizing==="content-box"){const G=Qg(f,"border","width"),X=Qg(f,"padding");P-=X.width+G.width,D-=X.height+G.height}return P=Math.max(0,P-y.width),D=Math.max(0,u?P/u:D-y.height),P=Np(Math.min(P,w,C.maxWidth)),D=Np(Math.min(D,i,C.maxHeight)),P&&!D&&(D=Np(P/2)),(a!==void 0||l!==void 0)&&u&&C.height&&D>C.height&&(D=C.height,P=Np(Math.floor(D*u))),{width:P,height:D}}function mC(s,a,l){const u=a||1,f=Np(s.height*u),y=Np(s.width*u);s.height=Np(s.height),s.width=Np(s.width);const w=s.canvas;return w.style&&(l||!w.style.height&&!w.style.width)&&(w.style.height=`${s.height}px`,w.style.width=`${s.width}px`),s.currentDevicePixelRatio!==u||w.height!==f||w.width!==y?(s.currentDevicePixelRatio=u,w.height=f,w.width=y,s.ctx.setTransform(u,0,0,u,0,0),!0):!1}const T$=(function(){let s=!1;try{const a={get passive(){return s=!0,!1}};u2()&&(window.addEventListener("test",null,a),window.removeEventListener("test",null,a))}catch{}return s})();function pC(s,a){const l=y$(s,a),u=l&&l.match(/^(\d+)(\.\d+)?px$/);return u?+u[1]:void 0}const k$=function(s,a){return{x(l){return s+s+a-l},setWidth(l){a=l},textAlign(l){return l==="center"?l:l==="right"?"left":"right"},xPlus(l,u){return l-u},leftForLtr(l,u){return l-u}}},E$=function(){return{x(s){return s},setWidth(s){},textAlign(s){return s},xPlus(s,a){return s+a},leftForLtr(s,a){return s}}};function yy(s,a,l){return s?k$(a,l):E$()}function wj(s,a){let l,u;(a==="ltr"||a==="rtl")&&(l=s.canvas.style,u=[l.getPropertyValue("direction"),l.getPropertyPriority("direction")],l.setProperty("direction",a,"important"),s.prevTextDirection=u)}function Sj(s,a){a!==void 0&&(delete s.prevTextDirection,s.canvas.style.setProperty("direction",a[0],a[1]))}function J0(s,a,l){return s.options.clip?s[l]:a[l]}function A$(s,a){const{xScale:l,yScale:u}=s;return l&&u?{left:J0(l,a,"left"),right:J0(l,a,"right"),top:J0(u,a,"top"),bottom:J0(u,a,"bottom")}:a}function C$(s,a){const l=a._clip;if(l.disabled)return!1;const u=A$(a,s.chartArea);return{left:l.left===!1?0:u.left-(l.left===!0?0:l.left),right:l.right===!1?s.width:u.right+(l.right===!0?0:l.right),top:l.top===!1?0:u.top-(l.top===!0?0:l.top),bottom:l.bottom===!1?s.height:u.bottom+(l.bottom===!0?0:l.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class M${constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(a,l,u,f){const y=l.listeners[f],w=l.duration;y.forEach(i=>i({chart:a,initial:l.initial,numSteps:w,currentStep:Math.min(u-l.start,w)}))}_refresh(){this._request||(this._running=!0,this._request=lj.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(a=Date.now()){let l=0;this._charts.forEach((u,f)=>{if(!u.running||!u.items.length)return;const y=u.items;let w=y.length-1,i=!1,C;for(;w>=0;--w)C=y[w],C._active?(C._total>u.duration&&(u.duration=C._total),C.tick(a),i=!0):(y[w]=y[y.length-1],y.pop());i&&(f.draw(),this._notify(f,u,a,"progress")),y.length||(u.running=!1,this._notify(f,u,a,"complete"),u.initial=!1),l+=y.length}),this._lastDate=a,l===0&&(this._running=!1)}_getAnims(a){const l=this._charts;let u=l.get(a);return u||(u={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},l.set(a,u)),u}listen(a,l,u){this._getAnims(a).listeners[l].push(u)}add(a,l){!l||!l.length||this._getAnims(a).items.push(...l)}has(a){return this._getAnims(a).items.length>0}start(a){const l=this._charts.get(a);l&&(l.running=!0,l.start=Date.now(),l.duration=l.items.reduce((u,f)=>Math.max(u,f._duration),0),this._refresh())}running(a){if(!this._running)return!1;const l=this._charts.get(a);return!(!l||!l.running||!l.items.length)}stop(a){const l=this._charts.get(a);if(!l||!l.items.length)return;const u=l.items;let f=u.length-1;for(;f>=0;--f)u[f].cancel();l.items=[],this._notify(a,l,Date.now(),"complete")}remove(a){return this._charts.delete(a)}}var Tm=new M$;const gC="transparent",P$={boolean(s,a,l){return l>.5?a:s},color(s,a,l){const u=oC(s||gC),f=u.valid&&oC(a||gC);return f&&f.valid?f.mix(u,l).hexString():a},number(s,a,l){return s+(a-s)*l}};class j${constructor(a,l,u,f){const y=l[u];f=K0([a.to,f,y,a.from]);const w=K0([a.from,y,f]);this._active=!0,this._fn=a.fn||P$[a.type||typeof w],this._easing=ax[a.easing]||ax.linear,this._start=Math.floor(Date.now()+(a.delay||0)),this._duration=this._total=Math.floor(a.duration),this._loop=!!a.loop,this._target=l,this._prop=u,this._from=w,this._to=f,this._promises=void 0}active(){return this._active}update(a,l,u){if(this._active){this._notify(!1);const f=this._target[this._prop],y=u-this._start,w=this._duration-y;this._start=u,this._duration=Math.floor(Math.max(w,a.duration)),this._total+=y,this._loop=!!a.loop,this._to=K0([a.to,l,f,a.from]),this._from=K0([a.from,f,l])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(a){const l=a-this._start,u=this._duration,f=this._prop,y=this._from,w=this._loop,i=this._to;let C;if(this._active=y!==i&&(w||l<u),!this._active){this._target[f]=i,this._notify(!0);return}if(l<0){this._target[f]=y;return}C=l/u%2,C=w&&C>1?2-C:C,C=this._easing(Math.min(1,Math.max(0,C))),this._target[f]=this._fn(y,i,C)}wait(){const a=this._promises||(this._promises=[]);return new Promise((l,u)=>{a.push({res:l,rej:u})})}_notify(a){const l=a?"res":"rej",u=this._promises||[];for(let f=0;f<u.length;f++)u[f][l]()}}class Tj{constructor(a,l){this._chart=a,this._properties=new Map,this.configure(l)}configure(a){if(!Rr(a))return;const l=Object.keys(jo.animation),u=this._properties;Object.getOwnPropertyNames(a).forEach(f=>{const y=a[f];if(!Rr(y))return;const w={};for(const i of l)w[i]=y[i];(zl(y.properties)&&y.properties||[f]).forEach(i=>{(i===f||!u.has(i))&&u.set(i,w)})})}_animateOptions(a,l){const u=l.options,f=L$(a,u);if(!f)return[];const y=this._createAnimations(f,u);return u.$shared&&R$(a.options.$animations,u).then(()=>{a.options=u},()=>{}),y}_createAnimations(a,l){const u=this._properties,f=[],y=a.$animations||(a.$animations={}),w=Object.keys(l),i=Date.now();let C;for(C=w.length-1;C>=0;--C){const P=w[C];if(P.charAt(0)==="$")continue;if(P==="options"){f.push(...this._animateOptions(a,l));continue}const D=l[P];let $=y[P];const G=u.get(P);if($)if(G&&$.active()){$.update(G,D,i);continue}else $.cancel();if(!G||!G.duration){a[P]=D;continue}y[P]=$=new j$(G,a,P,D),f.push($)}return f}update(a,l){if(this._properties.size===0){Object.assign(a,l);return}const u=this._createAnimations(a,l);if(u.length)return Tm.add(this._chart,u),!0}}function R$(s,a){const l=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const y=s[u[f]];y&&y.active()&&l.push(y.wait())}return Promise.all(l)}function L$(s,a){if(!a)return;let l=s.options;if(!l){s.options=a;return}return l.$shared&&(s.options=l=Object.assign({},l,{$shared:!1,$animations:{}})),l}function _C(s,a){const l=s&&s.options||{},u=l.reverse,f=l.min===void 0?a:0,y=l.max===void 0?a:0;return{start:u?y:f,end:u?f:y}}function I$(s,a,l){if(l===!1)return!1;const u=_C(s,l),f=_C(a,l);return{top:f.end,right:u.end,bottom:f.start,left:u.start}}function z$(s){let a,l,u,f;return Rr(s)?(a=s.top,l=s.right,u=s.bottom,f=s.left):a=l=u=f=s,{top:a,right:l,bottom:u,left:f,disabled:s===!1}}function kj(s,a){const l=[],u=s._getSortedDatasetMetas(a);let f,y;for(f=0,y=u.length;f<y;++f)l.push(u[f].index);return l}function yC(s,a,l,u={}){const f=s.keys,y=u.mode==="single";let w,i,C,P;if(a===null)return;let D=!1;for(w=0,i=f.length;w<i;++w){if(C=+f[w],C===l){if(D=!0,u.all)continue;break}P=s.values[C],Bd(P)&&(y||a===0||Hp(a)===Hp(P))&&(a+=P)}return!D&&!u.all?0:a}function D$(s,a){const{iScale:l,vScale:u}=a,f=l.axis==="x"?"x":"y",y=u.axis==="x"?"x":"y",w=Object.keys(s),i=new Array(w.length);let C,P,D;for(C=0,P=w.length;C<P;++C)D=w[C],i[C]={[f]:D,[y]:s[D]};return i}function G1(s,a){const l=s&&s.options.stacked;return l||l===void 0&&a.stack!==void 0}function O$(s,a,l){return`${s.id}.${a.id}.${l.stack||l.type}`}function N$(s){const{min:a,max:l,minDefined:u,maxDefined:f}=s.getUserBounds();return{min:u?a:Number.NEGATIVE_INFINITY,max:f?l:Number.POSITIVE_INFINITY}}function F$(s,a,l){const u=s[a]||(s[a]={});return u[l]||(u[l]={})}function vC(s,a,l,u){for(const f of a.getMatchingVisibleMetas(u).reverse()){const y=s[f.index];if(l&&y>0||!l&&y<0)return f.index}return null}function xC(s,a){const{chart:l,_cachedMeta:u}=s,f=l._stacks||(l._stacks={}),{iScale:y,vScale:w,index:i}=u,C=y.axis,P=w.axis,D=O$(y,w,u),$=a.length;let G;for(let X=0;X<$;++X){const te=a[X],{[C]:le,[P]:re}=te,fe=te._stacks||(te._stacks={});G=fe[P]=F$(f,D,le),G[i]=re,G._top=vC(G,w,!0,u.type),G._bottom=vC(G,w,!1,u.type);const xe=G._visualValues||(G._visualValues={});xe[i]=re}}function q1(s,a){const l=s.scales;return Object.keys(l).filter(u=>l[u].axis===a).shift()}function B$(s,a){return Cy(s,{active:!1,dataset:void 0,datasetIndex:a,index:a,mode:"default",type:"dataset"})}function U$(s,a,l){return Cy(s,{active:!1,dataIndex:a,parsed:void 0,raw:void 0,element:l,index:a,mode:"default",type:"data"})}function Uv(s,a){const l=s.controller.index,u=s.vScale&&s.vScale.axis;if(u){a=a||s._parsed;for(const f of a){const y=f._stacks;if(!y||y[u]===void 0||y[u][l]===void 0)return;delete y[u][l],y[u]._visualValues!==void 0&&y[u]._visualValues[l]!==void 0&&delete y[u]._visualValues[l]}}}const W1=s=>s==="reset"||s==="none",bC=(s,a)=>a?s:Object.assign({},s),$$=(s,a,l)=>s&&!a.hidden&&a._stacked&&{keys:kj(l,!0),values:null};class Ej{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(a,l){this.chart=a,this._ctx=a.ctx,this.index=l,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const a=this._cachedMeta;this.configure(),this.linkScales(),a._stacked=G1(a.vScale,a),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(a){this.index!==a&&Uv(this._cachedMeta),this.index=a}linkScales(){const a=this.chart,l=this._cachedMeta,u=this.getDataset(),f=($,G,X,te)=>$==="x"?G:$==="r"?te:X,y=l.xAxisID=Br(u.xAxisID,q1(a,"x")),w=l.yAxisID=Br(u.yAxisID,q1(a,"y")),i=l.rAxisID=Br(u.rAxisID,q1(a,"r")),C=l.indexAxis,P=l.iAxisID=f(C,y,w,i),D=l.vAxisID=f(C,w,y,i);l.xScale=this.getScaleForId(y),l.yScale=this.getScaleForId(w),l.rScale=this.getScaleForId(i),l.iScale=this.getScaleForId(P),l.vScale=this.getScaleForId(D)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(a){return this.chart.scales[a]}_getOtherScale(a){const l=this._cachedMeta;return a===l.iScale?l.vScale:l.iScale}reset(){this._update("reset")}_destroy(){const a=this._cachedMeta;this._data&&aC(this._data,this),a._stacked&&Uv(a)}_dataCheck(){const a=this.getDataset(),l=a.data||(a.data=[]),u=this._data;if(Rr(l)){const f=this._cachedMeta;this._data=D$(l,f)}else if(u!==l){if(u){aC(u,this);const f=this._cachedMeta;Uv(f),f._parsed=[]}l&&Object.isExtensible(l)&&$U(l,this),this._syncList=[],this._data=l}}addElements(){const a=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(a.dataset=new this.datasetElementType)}buildOrUpdateElements(a){const l=this._cachedMeta,u=this.getDataset();let f=!1;this._dataCheck();const y=l._stacked;l._stacked=G1(l.vScale,l),l.stack!==u.stack&&(f=!0,Uv(l),l.stack=u.stack),this._resyncElements(a),(f||y!==l._stacked)&&(xC(this,l._parsed),l._stacked=G1(l.vScale,l))}configure(){const a=this.chart.config,l=a.datasetScopeKeys(this._type),u=a.getOptionScopes(this.getDataset(),l,!0);this.options=a.createResolver(u,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(a,l){const{_cachedMeta:u,_data:f}=this,{iScale:y,_stacked:w}=u,i=y.axis;let C=a===0&&l===f.length?!0:u._sorted,P=a>0&&u._parsed[a-1],D,$,G;if(this._parsing===!1)u._parsed=f,u._sorted=!0,G=f;else{zl(f[a])?G=this.parseArrayData(u,f,a,l):Rr(f[a])?G=this.parseObjectData(u,f,a,l):G=this.parsePrimitiveData(u,f,a,l);const X=()=>$[i]===null||P&&$[i]<P[i];for(D=0;D<l;++D)u._parsed[D+a]=$=G[D],C&&(X()&&(C=!1),P=$);u._sorted=C}w&&xC(this,G)}parsePrimitiveData(a,l,u,f){const{iScale:y,vScale:w}=a,i=y.axis,C=w.axis,P=y.getLabels(),D=y===w,$=new Array(f);let G,X,te;for(G=0,X=f;G<X;++G)te=G+u,$[G]={[i]:D||y.parse(P[te],te),[C]:w.parse(l[te],te)};return $}parseArrayData(a,l,u,f){const{xScale:y,yScale:w}=a,i=new Array(f);let C,P,D,$;for(C=0,P=f;C<P;++C)D=C+u,$=l[D],i[C]={x:y.parse($[0],D),y:w.parse($[1],D)};return i}parseObjectData(a,l,u,f){const{xScale:y,yScale:w}=a,{xAxisKey:i="x",yAxisKey:C="y"}=this._parsing,P=new Array(f);let D,$,G,X;for(D=0,$=f;D<$;++D)G=D+u,X=l[G],P[D]={x:y.parse(wy(X,i),G),y:w.parse(wy(X,C),G)};return P}getParsed(a){return this._cachedMeta._parsed[a]}getDataElement(a){return this._cachedMeta.data[a]}applyStack(a,l,u){const f=this.chart,y=this._cachedMeta,w=l[a.axis],i={keys:kj(f,!0),values:l._stacks[a.axis]._visualValues};return yC(i,w,y.index,{mode:u})}updateRangeFromParsed(a,l,u,f){const y=u[l.axis];let w=y===null?NaN:y;const i=f&&u._stacks[l.axis];f&&i&&(f.values=i,w=yC(f,y,this._cachedMeta.index)),a.min=Math.min(a.min,w),a.max=Math.max(a.max,w)}getMinMax(a,l){const u=this._cachedMeta,f=u._parsed,y=u._sorted&&a===u.iScale,w=f.length,i=this._getOtherScale(a),C=$$(l,u,this.chart),P={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:D,max:$}=N$(i);let G,X;function te(){X=f[G];const le=X[i.axis];return!Bd(X[a.axis])||D>le||$<le}for(G=0;G<w&&!(!te()&&(this.updateRangeFromParsed(P,a,X,C),y));++G);if(y){for(G=w-1;G>=0;--G)if(!te()){this.updateRangeFromParsed(P,a,X,C);break}}return P}getAllParsedValues(a){const l=this._cachedMeta._parsed,u=[];let f,y,w;for(f=0,y=l.length;f<y;++f)w=l[f][a.axis],Bd(w)&&u.push(w);return u}getMaxOverflow(){return!1}getLabelAndValue(a){const l=this._cachedMeta,u=l.iScale,f=l.vScale,y=this.getParsed(a);return{label:u?""+u.getLabelForValue(y[u.axis]):"",value:f?""+f.getLabelForValue(y[f.axis]):""}}_update(a){const l=this._cachedMeta;this.update(a||"default"),l._clip=z$(Br(this.options.clip,I$(l.xScale,l.yScale,this.getMaxOverflow())))}update(a){}draw(){const a=this._ctx,l=this.chart,u=this._cachedMeta,f=u.data||[],y=l.chartArea,w=[],i=this._drawStart||0,C=this._drawCount||f.length-i,P=this.options.drawActiveElementsOnTop;let D;for(u.dataset&&u.dataset.draw(a,y,i,C),D=i;D<i+C;++D){const $=f[D];$.hidden||($.active&&P?w.push($):$.draw(a,y))}for(D=0;D<w.length;++D)w[D].draw(a,y)}getStyle(a,l){const u=l?"active":"default";return a===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(u):this.resolveDataElementOptions(a||0,u)}getContext(a,l,u){const f=this.getDataset();let y;if(a>=0&&a<this._cachedMeta.data.length){const w=this._cachedMeta.data[a];y=w.$context||(w.$context=U$(this.getContext(),a,w)),y.parsed=this.getParsed(a),y.raw=f.data[a],y.index=y.dataIndex=a}else y=this.$context||(this.$context=B$(this.chart.getContext(),this.index)),y.dataset=f,y.index=y.datasetIndex=this.index;return y.active=!!l,y.mode=u,y}resolveDatasetElementOptions(a){return this._resolveElementOptions(this.datasetElementType.id,a)}resolveDataElementOptions(a,l){return this._resolveElementOptions(this.dataElementType.id,l,a)}_resolveElementOptions(a,l="default",u){const f=l==="active",y=this._cachedDataOpts,w=a+"-"+l,i=y[w],C=this.enableOptionSharing&&_x(u);if(i)return bC(i,C);const P=this.chart.config,D=P.datasetElementScopeKeys(this._type,a),$=f?[`${a}Hover`,"hover",a,""]:[a,""],G=P.getOptionScopes(this.getDataset(),D),X=Object.keys(jo.elements[a]),te=()=>this.getContext(u,f,l),le=P.resolveNamedOptions(G,X,te,$);return le.$shared&&(le.$shared=C,y[w]=Object.freeze(bC(le,C))),le}_resolveAnimations(a,l,u){const f=this.chart,y=this._cachedDataOpts,w=`animation-${l}`,i=y[w];if(i)return i;let C;if(f.options.animation!==!1){const D=this.chart.config,$=D.datasetAnimationScopeKeys(this._type,l),G=D.getOptionScopes(this.getDataset(),$);C=D.createResolver(G,this.getContext(a,u,l))}const P=new Tj(f,C&&C.animations);return C&&C._cacheable&&(y[w]=Object.freeze(P)),P}getSharedOptions(a){if(a.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},a))}includeOptions(a,l){return!l||W1(a)||this.chart._animationsDisabled}_getSharedOptions(a,l){const u=this.resolveDataElementOptions(a,l),f=this._sharedOptions,y=this.getSharedOptions(u),w=this.includeOptions(l,y)||y!==f;return this.updateSharedOptions(y,l,u),{sharedOptions:y,includeOptions:w}}updateElement(a,l,u,f){W1(f)?Object.assign(a,u):this._resolveAnimations(l,f).update(a,u)}updateSharedOptions(a,l,u){a&&!W1(l)&&this._resolveAnimations(void 0,l).update(a,u)}_setStyle(a,l,u,f){a.active=f;const y=this.getStyle(l,f);this._resolveAnimations(l,u,f).update(a,{options:!f&&this.getSharedOptions(y)||y})}removeHoverStyle(a,l,u){this._setStyle(a,u,"active",!1)}setHoverStyle(a,l,u){this._setStyle(a,u,"active",!0)}_removeDatasetHoverStyle(){const a=this._cachedMeta.dataset;a&&this._setStyle(a,void 0,"active",!1)}_setDatasetHoverStyle(){const a=this._cachedMeta.dataset;a&&this._setStyle(a,void 0,"active",!0)}_resyncElements(a){const l=this._data,u=this._cachedMeta.data;for(const[i,C,P]of this._syncList)this[i](C,P);this._syncList=[];const f=u.length,y=l.length,w=Math.min(y,f);w&&this.parse(0,w),y>f?this._insertElements(f,y-f,a):y<f&&this._removeElements(y,f-y)}_insertElements(a,l,u=!0){const f=this._cachedMeta,y=f.data,w=a+l;let i;const C=P=>{for(P.length+=l,i=P.length-1;i>=w;i--)P[i]=P[i-l]};for(C(y),i=a;i<w;++i)y[i]=new this.dataElementType;this._parsing&&C(f._parsed),this.parse(a,l),u&&this.updateElements(y,a,l,"reset")}updateElements(a,l,u,f){}_removeElements(a,l){const u=this._cachedMeta;if(this._parsing){const f=u._parsed.splice(a,l);u._stacked&&Uv(u,f)}u.data.splice(a,l)}_sync(a){if(this._parsing)this._syncList.push(a);else{const[l,u,f]=a;this[l](u,f)}this.chart._dataChanges.push([this.index,...a])}_onDataPush(){const a=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-a,a])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(a,l){l&&this._sync(["_removeElements",a,l]);const u=arguments.length-2;u&&this._sync(["_insertElements",a,u])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function V$(s,a){if(!s._cache.$bar){const l=s.getMatchingVisibleMetas(a);let u=[];for(let f=0,y=l.length;f<y;f++)u=u.concat(l[f].controller.getAllParsedValues(s));s._cache.$bar=oj(u.sort((f,y)=>f-y))}return s._cache.$bar}function H$(s){const a=s.iScale,l=V$(a,s.type);let u=a._length,f,y,w,i;const C=()=>{w===32767||w===-32768||(_x(i)&&(u=Math.min(u,Math.abs(w-i)||u)),i=w)};for(f=0,y=l.length;f<y;++f)w=a.getPixelForValue(l[f]),C();for(i=void 0,f=0,y=a.ticks.length;f<y;++f)w=a.getPixelForTick(f),C();return u}function G$(s,a,l,u){const f=l.barThickness;let y,w;return us(f)?(y=a.min*l.categoryPercentage,w=l.barPercentage):(y=f*u,w=1),{chunk:y/u,ratio:w,start:a.pixels[s]-y/2}}function q$(s,a,l,u){const f=a.pixels,y=f[s];let w=s>0?f[s-1]:null,i=s<f.length-1?f[s+1]:null;const C=l.categoryPercentage;w===null&&(w=y-(i===null?a.end-a.start:i-y)),i===null&&(i=y+y-w);const P=y-(y-Math.min(w,i))/2*C;return{chunk:Math.abs(i-w)/2*C/u,ratio:l.barPercentage,start:P}}function W$(s,a,l,u){const f=l.parse(s[0],u),y=l.parse(s[1],u),w=Math.min(f,y),i=Math.max(f,y);let C=w,P=i;Math.abs(w)>Math.abs(i)&&(C=i,P=w),a[l.axis]=P,a._custom={barStart:C,barEnd:P,start:f,end:y,min:w,max:i}}function Aj(s,a,l,u){return zl(s)?W$(s,a,l,u):a[l.axis]=l.parse(s,u),a}function wC(s,a,l,u){const f=s.iScale,y=s.vScale,w=f.getLabels(),i=f===y,C=[];let P,D,$,G;for(P=l,D=l+u;P<D;++P)G=a[P],$={},$[f.axis]=i||f.parse(w[P],P),C.push(Aj(G,$,y,P));return C}function Z1(s){return s&&s.barStart!==void 0&&s.barEnd!==void 0}function Z$(s,a,l){return s!==0?Hp(s):(a.isHorizontal()?1:-1)*(a.min>=l?1:-1)}function X$(s){let a,l,u,f,y;return s.horizontal?(a=s.base>s.x,l="left",u="right"):(a=s.base<s.y,l="bottom",u="top"),a?(f="end",y="start"):(f="start",y="end"),{start:l,end:u,reverse:a,top:f,bottom:y}}function Y$(s,a,l,u){let f=a.borderSkipped;const y={};if(!f){s.borderSkipped=y;return}if(f===!0){s.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:w,end:i,reverse:C,top:P,bottom:D}=X$(s);f==="middle"&&l&&(s.enableBorderRadius=!0,(l._top||0)===u?f=P:(l._bottom||0)===u?f=D:(y[SC(D,w,i,C)]=!0,f=P)),y[SC(f,w,i,C)]=!0,s.borderSkipped=y}function SC(s,a,l,u){return u?(s=K$(s,a,l),s=TC(s,l,a)):s=TC(s,a,l),s}function K$(s,a,l){return s===a?l:s===l?a:s}function TC(s,a,l){return s==="start"?a:s==="end"?l:s}function J$(s,{inflateAmount:a},l){s.inflateAmount=a==="auto"?l===1?.33:0:a}class Q$ extends Ej{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(a,l,u,f){return wC(a,l,u,f)}parseArrayData(a,l,u,f){return wC(a,l,u,f)}parseObjectData(a,l,u,f){const{iScale:y,vScale:w}=a,{xAxisKey:i="x",yAxisKey:C="y"}=this._parsing,P=y.axis==="x"?i:C,D=w.axis==="x"?i:C,$=[];let G,X,te,le;for(G=u,X=u+f;G<X;++G)le=l[G],te={},te[y.axis]=y.parse(wy(le,P),G),$.push(Aj(wy(le,D),te,w,G));return $}updateRangeFromParsed(a,l,u,f){super.updateRangeFromParsed(a,l,u,f);const y=u._custom;y&&l===this._cachedMeta.vScale&&(a.min=Math.min(a.min,y.min),a.max=Math.max(a.max,y.max))}getMaxOverflow(){return 0}getLabelAndValue(a){const l=this._cachedMeta,{iScale:u,vScale:f}=l,y=this.getParsed(a),w=y._custom,i=Z1(w)?"["+w.start+", "+w.end+"]":""+f.getLabelForValue(y[f.axis]);return{label:""+u.getLabelForValue(y[u.axis]),value:i}}initialize(){this.enableOptionSharing=!0,super.initialize();const a=this._cachedMeta;a.stack=this.getDataset().stack}update(a){const l=this._cachedMeta;this.updateElements(l.data,0,l.data.length,a)}updateElements(a,l,u,f){const y=f==="reset",{index:w,_cachedMeta:{vScale:i}}=this,C=i.getBasePixel(),P=i.isHorizontal(),D=this._getRuler(),{sharedOptions:$,includeOptions:G}=this._getSharedOptions(l,f);for(let X=l;X<l+u;X++){const te=this.getParsed(X),le=y||us(te[i.axis])?{base:C,head:C}:this._calculateBarValuePixels(X),re=this._calculateBarIndexPixels(X,D),fe=(te._stacks||{})[i.axis],xe={horizontal:P,base:le.base,enableBorderRadius:!fe||Z1(te._custom)||w===fe._top||w===fe._bottom,x:P?le.head:re.center,y:P?re.center:le.head,height:P?re.size:Math.abs(le.size),width:P?Math.abs(le.size):re.size};G&&(xe.options=$||this.resolveDataElementOptions(X,a[X].active?"active":f));const be=xe.options||a[X].options;Y$(xe,be,fe,w),J$(xe,be,D.ratio),this.updateElement(a[X],X,xe,f)}}_getStacks(a,l){const{iScale:u}=this._cachedMeta,f=u.getMatchingVisibleMetas(this._type).filter(D=>D.controller.options.grouped),y=u.options.stacked,w=[],i=this._cachedMeta.controller.getParsed(l),C=i&&i[u.axis],P=D=>{const $=D._parsed.find(X=>X[u.axis]===C),G=$&&$[D.vScale.axis];if(us(G)||isNaN(G))return!0};for(const D of f)if(!(l!==void 0&&P(D))&&((y===!1||w.indexOf(D.stack)===-1||y===void 0&&D.stack===void 0)&&w.push(D.stack),D.index===a))break;return w.length||w.push(void 0),w}_getStackCount(a){return this._getStacks(void 0,a).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const a=this.chart.scales,l=this.chart.options.indexAxis;return Object.keys(a).filter(u=>a[u].axis===l).shift()}_getAxis(){const a={},l=this.getFirstScaleIdForIndexAxis();for(const u of this.chart.data.datasets)a[Br(this.chart.options.indexAxis==="x"?u.xAxisID:u.yAxisID,l)]=!0;return Object.keys(a)}_getStackIndex(a,l,u){const f=this._getStacks(a,u),y=l!==void 0?f.indexOf(l):-1;return y===-1?f.length-1:y}_getRuler(){const a=this.options,l=this._cachedMeta,u=l.iScale,f=[];let y,w;for(y=0,w=l.data.length;y<w;++y)f.push(u.getPixelForValue(this.getParsed(y)[u.axis],y));const i=a.barThickness;return{min:i||H$(l),pixels:f,start:u._startPixel,end:u._endPixel,stackCount:this._getStackCount(),scale:u,grouped:a.grouped,ratio:i?1:a.categoryPercentage*a.barPercentage}}_calculateBarValuePixels(a){const{_cachedMeta:{vScale:l,_stacked:u,index:f},options:{base:y,minBarLength:w}}=this,i=y||0,C=this.getParsed(a),P=C._custom,D=Z1(P);let $=C[l.axis],G=0,X=u?this.applyStack(l,C,u):$,te,le;X!==$&&(G=X-$,X=$),D&&($=P.barStart,X=P.barEnd-P.barStart,$!==0&&Hp($)!==Hp(P.barEnd)&&(G=0),G+=$);const re=!us(y)&&!D?y:G;let fe=l.getPixelForValue(re);if(this.chart.getDataVisibility(a)?te=l.getPixelForValue(G+X):te=fe,le=te-fe,Math.abs(le)<w){le=Z$(le,l,i)*w,$===i&&(fe-=le/2);const xe=l.getPixelForDecimal(0),be=l.getPixelForDecimal(1),Ne=Math.min(xe,be),Be=Math.max(xe,be);fe=Math.max(Math.min(fe,Be),Ne),te=fe+le,u&&!D&&(C._stacks[l.axis]._visualValues[f]=l.getValueForPixel(te)-l.getValueForPixel(fe))}if(fe===l.getPixelForValue(i)){const xe=Hp(le)*l.getLineWidthForValue(i)/2;fe+=xe,le-=xe}return{size:le,base:fe,head:te,center:te+le/2}}_calculateBarIndexPixels(a,l){const u=l.scale,f=this.options,y=f.skipNull,w=Br(f.maxBarThickness,1/0);let i,C;const P=this._getAxisCount();if(l.grouped){const D=y?this._getStackCount(a):l.stackCount,$=f.barThickness==="flex"?q$(a,l,f,D*P):G$(a,l,f,D*P),G=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,X=this._getAxis().indexOf(Br(G,this.getFirstScaleIdForIndexAxis())),te=this._getStackIndex(this.index,this._cachedMeta.stack,y?a:void 0)+X;i=$.start+$.chunk*te+$.chunk/2,C=Math.min(w,$.chunk*$.ratio)}else i=u.getPixelForValue(this.getParsed(a)[u.axis],a),C=Math.min(w,l.min*l.ratio);return{base:i-C/2,head:i+C/2,center:i,size:C}}draw(){const a=this._cachedMeta,l=a.vScale,u=a.data,f=u.length;let y=0;for(;y<f;++y)this.getParsed(y)[l.axis]!==null&&!u[y].hidden&&u[y].draw(this._ctx)}}function Hg(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class h2{static override(a){Object.assign(h2.prototype,a)}options;constructor(a){this.options=a||{}}init(){}formats(){return Hg()}parse(){return Hg()}format(){return Hg()}add(){return Hg()}diff(){return Hg()}startOf(){return Hg()}endOf(){return Hg()}}var eV={_date:h2};function tV(s,a,l,u){const{controller:f,data:y,_sorted:w}=s,i=f._cachedMeta.iScale,C=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null;if(i&&a===i.axis&&a!=="r"&&w&&y.length){const P=i._reversePixels?BU:AS;if(u){if(f._sharedOptions){const D=y[0],$=typeof D.getRange=="function"&&D.getRange(a);if($){const G=P(y,a,l-$),X=P(y,a,l+$);return{lo:G.lo,hi:X.hi}}}}else{const D=P(y,a,l);if(C){const{vScale:$}=f._cachedMeta,{_parsed:G}=s,X=G.slice(0,D.lo+1).reverse().findIndex(le=>!us(le[$.axis]));D.lo-=Math.max(0,X);const te=G.slice(D.hi).findIndex(le=>!us(le[$.axis]));D.hi+=Math.max(0,te)}return D}}return{lo:0,hi:y.length-1}}function Zb(s,a,l,u,f){const y=s.getSortedVisibleDatasetMetas(),w=l[a];for(let i=0,C=y.length;i<C;++i){const{index:P,data:D}=y[i],{lo:$,hi:G}=tV(y[i],a,w,f);for(let X=$;X<=G;++X){const te=D[X];te.skip||u(te,P,X)}}}function iV(s){const a=s.indexOf("x")!==-1,l=s.indexOf("y")!==-1;return function(u,f){const y=a?Math.abs(u.x-f.x):0,w=l?Math.abs(u.y-f.y):0;return Math.sqrt(Math.pow(y,2)+Math.pow(w,2))}}function X1(s,a,l,u,f){const y=[];return!f&&!s.isPointInArea(a)||Zb(s,l,a,function(i,C,P){!f&&!pj(i,s.chartArea,0)||i.inRange(a.x,a.y,u)&&y.push({element:i,datasetIndex:C,index:P})},!0),y}function nV(s,a,l,u){let f=[];function y(w,i,C){const{startAngle:P,endAngle:D}=w.getProps(["startAngle","endAngle"],u),{angle:$}=DU(w,{x:a.x,y:a.y});NU($,P,D)&&f.push({element:w,datasetIndex:i,index:C})}return Zb(s,l,a,y),f}function aV(s,a,l,u,f,y){let w=[];const i=iV(l);let C=Number.POSITIVE_INFINITY;function P(D,$,G){const X=D.inRange(a.x,a.y,f);if(u&&!X)return;const te=D.getCenterPoint(f);if(!(!!y||s.isPointInArea(te))&&!X)return;const re=i(a,te);re<C?(w=[{element:D,datasetIndex:$,index:G}],C=re):re===C&&w.push({element:D,datasetIndex:$,index:G})}return Zb(s,l,a,P),w}function Y1(s,a,l,u,f,y){return!y&&!s.isPointInArea(a)?[]:l==="r"&&!u?nV(s,a,l,f):aV(s,a,l,u,f,y)}function kC(s,a,l,u,f){const y=[],w=l==="x"?"inXRange":"inYRange";let i=!1;return Zb(s,l,a,(C,P,D)=>{C[w]&&C[w](a[l],f)&&(y.push({element:C,datasetIndex:P,index:D}),i=i||C.inRange(a.x,a.y,f))}),u&&!i?[]:y}var rV={modes:{index(s,a,l,u){const f=qg(a,s),y=l.axis||"x",w=l.includeInvisible||!1,i=l.intersect?X1(s,f,y,u,w):Y1(s,f,y,!1,u,w),C=[];return i.length?(s.getSortedVisibleDatasetMetas().forEach(P=>{const D=i[0].index,$=P.data[D];$&&!$.skip&&C.push({element:$,datasetIndex:P.index,index:D})}),C):[]},dataset(s,a,l,u){const f=qg(a,s),y=l.axis||"xy",w=l.includeInvisible||!1;let i=l.intersect?X1(s,f,y,u,w):Y1(s,f,y,!1,u,w);if(i.length>0){const C=i[0].datasetIndex,P=s.getDatasetMeta(C).data;i=[];for(let D=0;D<P.length;++D)i.push({element:P[D],datasetIndex:C,index:D})}return i},point(s,a,l,u){const f=qg(a,s),y=l.axis||"xy",w=l.includeInvisible||!1;return X1(s,f,y,u,w)},nearest(s,a,l,u){const f=qg(a,s),y=l.axis||"xy",w=l.includeInvisible||!1;return Y1(s,f,y,l.intersect,u,w)},x(s,a,l,u){const f=qg(a,s);return kC(s,f,"x",l.intersect,u)},y(s,a,l,u){const f=qg(a,s);return kC(s,f,"y",l.intersect,u)}}};const Cj=["left","top","right","bottom"];function $v(s,a){return s.filter(l=>l.pos===a)}function EC(s,a){return s.filter(l=>Cj.indexOf(l.pos)===-1&&l.box.axis===a)}function Vv(s,a){return s.sort((l,u)=>{const f=a?u:l,y=a?l:u;return f.weight===y.weight?f.index-y.index:f.weight-y.weight})}function sV(s){const a=[];let l,u,f,y,w,i;for(l=0,u=(s||[]).length;l<u;++l)f=s[l],{position:y,options:{stack:w,stackWeight:i=1}}=f,a.push({index:l,box:f,pos:y,horizontal:f.isHorizontal(),weight:f.weight,stack:w&&y+w,stackWeight:i});return a}function oV(s){const a={};for(const l of s){const{stack:u,pos:f,stackWeight:y}=l;if(!u||!Cj.includes(f))continue;const w=a[u]||(a[u]={count:0,placed:0,weight:0,size:0});w.count++,w.weight+=y}return a}function lV(s,a){const l=oV(s),{vBoxMaxWidth:u,hBoxMaxHeight:f}=a;let y,w,i;for(y=0,w=s.length;y<w;++y){i=s[y];const{fullSize:C}=i.box,P=l[i.stack],D=P&&i.stackWeight/P.weight;i.horizontal?(i.width=D?D*u:C&&a.availableWidth,i.height=f):(i.width=u,i.height=D?D*f:C&&a.availableHeight)}return l}function cV(s){const a=sV(s),l=Vv(a.filter(P=>P.box.fullSize),!0),u=Vv($v(a,"left"),!0),f=Vv($v(a,"right")),y=Vv($v(a,"top"),!0),w=Vv($v(a,"bottom")),i=EC(a,"x"),C=EC(a,"y");return{fullSize:l,leftAndTop:u.concat(y),rightAndBottom:f.concat(C).concat(w).concat(i),chartArea:$v(a,"chartArea"),vertical:u.concat(f).concat(C),horizontal:y.concat(w).concat(i)}}function AC(s,a,l,u){return Math.max(s[l],a[l])+Math.max(s[u],a[u])}function Mj(s,a){s.top=Math.max(s.top,a.top),s.left=Math.max(s.left,a.left),s.bottom=Math.max(s.bottom,a.bottom),s.right=Math.max(s.right,a.right)}function uV(s,a,l,u){const{pos:f,box:y}=l,w=s.maxPadding;if(!Rr(f)){l.size&&(s[f]-=l.size);const $=u[l.stack]||{size:0,count:1};$.size=Math.max($.size,l.horizontal?y.height:y.width),l.size=$.size/$.count,s[f]+=l.size}y.getPadding&&Mj(w,y.getPadding());const i=Math.max(0,a.outerWidth-AC(w,s,"left","right")),C=Math.max(0,a.outerHeight-AC(w,s,"top","bottom")),P=i!==s.w,D=C!==s.h;return s.w=i,s.h=C,l.horizontal?{same:P,other:D}:{same:D,other:P}}function dV(s){const a=s.maxPadding;function l(u){const f=Math.max(a[u]-s[u],0);return s[u]+=f,f}s.y+=l("top"),s.x+=l("left"),l("right"),l("bottom")}function hV(s,a){const l=a.maxPadding;function u(f){const y={left:0,top:0,right:0,bottom:0};return f.forEach(w=>{y[w]=Math.max(a[w],l[w])}),y}return u(s?["left","right"]:["top","bottom"])}function Yv(s,a,l,u){const f=[];let y,w,i,C,P,D;for(y=0,w=s.length,P=0;y<w;++y){i=s[y],C=i.box,C.update(i.width||a.w,i.height||a.h,hV(i.horizontal,a));const{same:$,other:G}=uV(a,l,i,u);P|=$&&f.length,D=D||G,C.fullSize||f.push(i)}return P&&Yv(f,a,l,u)||D}function Q0(s,a,l,u,f){s.top=l,s.left=a,s.right=a+u,s.bottom=l+f,s.width=u,s.height=f}function CC(s,a,l,u){const f=l.padding;let{x:y,y:w}=a;for(const i of s){const C=i.box,P=u[i.stack]||{placed:0,weight:1},D=i.stackWeight/P.weight||1;if(i.horizontal){const $=a.w*D,G=P.size||C.height;_x(P.start)&&(w=P.start),C.fullSize?Q0(C,f.left,w,l.outerWidth-f.right-f.left,G):Q0(C,a.left+P.placed,w,$,G),P.start=w,P.placed+=$,w=C.bottom}else{const $=a.h*D,G=P.size||C.width;_x(P.start)&&(y=P.start),C.fullSize?Q0(C,y,f.top,G,l.outerHeight-f.bottom-f.top):Q0(C,y,a.top+P.placed,G,$),P.start=y,P.placed+=$,y=C.right}}a.x=y,a.y=w}var Fp={addBox(s,a){s.boxes||(s.boxes=[]),a.fullSize=a.fullSize||!1,a.position=a.position||"top",a.weight=a.weight||0,a._layers=a._layers||function(){return[{z:0,draw(l){a.draw(l)}}]},s.boxes.push(a)},removeBox(s,a){const l=s.boxes?s.boxes.indexOf(a):-1;l!==-1&&s.boxes.splice(l,1)},configure(s,a,l){a.fullSize=l.fullSize,a.position=l.position,a.weight=l.weight},update(s,a,l,u){if(!s)return;const f=kh(s.options.layout.padding),y=Math.max(a-f.width,0),w=Math.max(l-f.height,0),i=cV(s.boxes),C=i.vertical,P=i.horizontal;Kr(s.boxes,le=>{typeof le.beforeLayout=="function"&&le.beforeLayout()});const D=C.reduce((le,re)=>re.box.options&&re.box.options.display===!1?le:le+1,0)||1,$=Object.freeze({outerWidth:a,outerHeight:l,padding:f,availableWidth:y,availableHeight:w,vBoxMaxWidth:y/2/D,hBoxMaxHeight:w/2}),G=Object.assign({},f);Mj(G,kh(u));const X=Object.assign({maxPadding:G,w:y,h:w,x:f.left,y:f.top},f),te=lV(C.concat(P),$);Yv(i.fullSize,X,$,te),Yv(C,X,$,te),Yv(P,X,$,te)&&Yv(C,X,$,te),dV(X),CC(i.leftAndTop,X,$,te),X.x+=X.w,X.y+=X.h,CC(i.rightAndBottom,X,$,te),s.chartArea={left:X.left,top:X.top,right:X.left+X.w,bottom:X.top+X.h,height:X.h,width:X.w},Kr(i.chartArea,le=>{const re=le.box;Object.assign(re,s.chartArea),re.update(X.w,X.h,{left:0,top:0,right:0,bottom:0})})}};class Pj{acquireContext(a,l){}releaseContext(a){return!1}addEventListener(a,l,u){}removeEventListener(a,l,u){}getDevicePixelRatio(){return 1}getMaximumSize(a,l,u,f){return l=Math.max(0,l||a.width),u=u||a.height,{width:l,height:Math.max(0,f?Math.floor(l/f):u)}}isAttached(a){return!0}updateConfig(a){}}class fV extends Pj{acquireContext(a){return a&&a.getContext&&a.getContext("2d")||null}updateConfig(a){a.options.animation=!1}}const _b="$chartjs",mV={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},MC=s=>s===null||s==="";function pV(s,a){const l=s.style,u=s.getAttribute("height"),f=s.getAttribute("width");if(s[_b]={initial:{height:u,width:f,style:{display:l.display,height:l.height,width:l.width}}},l.display=l.display||"block",l.boxSizing=l.boxSizing||"border-box",MC(f)){const y=pC(s,"width");y!==void 0&&(s.width=y)}if(MC(u))if(s.style.height==="")s.height=s.width/(a||2);else{const y=pC(s,"height");y!==void 0&&(s.height=y)}return s}const jj=T$?{passive:!0}:!1;function gV(s,a,l){s&&s.addEventListener(a,l,jj)}function _V(s,a,l){s&&s.canvas&&s.canvas.removeEventListener(a,l,jj)}function yV(s,a){const l=mV[s.type]||s.type,{x:u,y:f}=qg(s,a);return{type:l,chart:a,native:s,x:u!==void 0?u:null,y:f!==void 0?f:null}}function Bb(s,a){for(const l of s)if(l===a||l.contains(a))return!0}function vV(s,a,l){const u=s.canvas,f=new MutationObserver(y=>{let w=!1;for(const i of y)w=w||Bb(i.addedNodes,u),w=w&&!Bb(i.removedNodes,u);w&&l()});return f.observe(document,{childList:!0,subtree:!0}),f}function xV(s,a,l){const u=s.canvas,f=new MutationObserver(y=>{let w=!1;for(const i of y)w=w||Bb(i.removedNodes,u),w=w&&!Bb(i.addedNodes,u);w&&l()});return f.observe(document,{childList:!0,subtree:!0}),f}const yx=new Map;let PC=0;function Rj(){const s=window.devicePixelRatio;s!==PC&&(PC=s,yx.forEach((a,l)=>{l.currentDevicePixelRatio!==s&&a()}))}function bV(s,a){yx.size||window.addEventListener("resize",Rj),yx.set(s,a)}function wV(s){yx.delete(s),yx.size||window.removeEventListener("resize",Rj)}function SV(s,a,l){const u=s.canvas,f=u&&d2(u);if(!f)return;const y=cj((i,C)=>{const P=f.clientWidth;l(i,C),P<f.clientWidth&&l()},window),w=new ResizeObserver(i=>{const C=i[0],P=C.contentRect.width,D=C.contentRect.height;P===0&&D===0||y(P,D)});return w.observe(f),bV(s,y),w}function K1(s,a,l){l&&l.disconnect(),a==="resize"&&wV(s)}function TV(s,a,l){const u=s.canvas,f=cj(y=>{s.ctx!==null&&l(yV(y,s))},s);return gV(u,a,f),f}class kV extends Pj{acquireContext(a,l){const u=a&&a.getContext&&a.getContext("2d");return u&&u.canvas===a?(pV(a,l),u):null}releaseContext(a){const l=a.canvas;if(!l[_b])return!1;const u=l[_b].initial;["height","width"].forEach(y=>{const w=u[y];us(w)?l.removeAttribute(y):l.setAttribute(y,w)});const f=u.style||{};return Object.keys(f).forEach(y=>{l.style[y]=f[y]}),l.width=l.width,delete l[_b],!0}addEventListener(a,l,u){this.removeEventListener(a,l);const f=a.$proxies||(a.$proxies={}),w={attach:vV,detach:xV,resize:SV}[l]||TV;f[l]=w(a,l,u)}removeEventListener(a,l){const u=a.$proxies||(a.$proxies={}),f=u[l];if(!f)return;({attach:K1,detach:K1,resize:K1}[l]||_V)(a,l,f),u[l]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(a,l,u,f){return S$(a,l,u,f)}isAttached(a){const l=a&&d2(a);return!!(l&&l.isConnected)}}function EV(s){return!u2()||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?fV:kV}let Ex=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(a){const{x:l,y:u}=this.getProps(["x","y"],a);return{x:l,y:u}}hasValue(){return Db(this.x)&&Db(this.y)}getProps(a,l){const u=this.$animations;if(!l||!u)return this;const f={};return a.forEach(y=>{f[y]=u[y]&&u[y].active()?u[y]._to:this[y]}),f}};function AV(s,a){const l=s.options.ticks,u=CV(s),f=Math.min(l.maxTicksLimit||u,u),y=l.major.enabled?PV(a):[],w=y.length,i=y[0],C=y[w-1],P=[];if(w>f)return jV(a,P,y,w/f),P;const D=MV(y,a,f);if(w>0){let $,G;const X=w>1?Math.round((C-i)/(w-1)):null;for(eb(a,P,D,us(X)?0:i-X,i),$=0,G=w-1;$<G;$++)eb(a,P,D,y[$],y[$+1]);return eb(a,P,D,C,us(X)?a.length:C+X),P}return eb(a,P,D),P}function CV(s){const a=s.options.offset,l=s._tickSize(),u=s._length/l+(a?0:1),f=s._maxLength/l;return Math.floor(Math.min(u,f))}function MV(s,a,l){const u=RV(s),f=a.length/l;if(!u)return Math.max(f,1);const y=jU(u);for(let w=0,i=y.length-1;w<i;w++){const C=y[w];if(C>f)return C}return Math.max(f,1)}function PV(s){const a=[];let l,u;for(l=0,u=s.length;l<u;l++)s[l].major&&a.push(l);return a}function jV(s,a,l,u){let f=0,y=l[0],w;for(u=Math.ceil(u),w=0;w<s.length;w++)w===y&&(a.push(s[w]),f++,y=l[f*u])}function eb(s,a,l,u,f){const y=Br(u,0),w=Math.min(Br(f,s.length),s.length);let i=0,C,P,D;for(l=Math.ceil(l),f&&(C=f-u,l=C/Math.floor(C/l)),D=y;D<0;)i++,D=Math.round(y+i*l);for(P=Math.max(y,0);P<w;P++)P===D&&(a.push(s[P]),i++,D=Math.round(y+i*l))}function RV(s){const a=s.length;let l,u;if(a<2)return!1;for(u=s[0],l=1;l<a;++l)if(s[l]-s[l-1]!==u)return!1;return u}const LV=s=>s==="left"?"right":s==="right"?"left":s,jC=(s,a,l)=>a==="top"||a==="left"?s[a]+l:s[a]-l,RC=(s,a)=>Math.min(a||s,s);function LC(s,a){const l=[],u=s.length/a,f=s.length;let y=0;for(;y<f;y+=u)l.push(s[Math.floor(y)]);return l}function IV(s,a,l){const u=s.ticks.length,f=Math.min(a,u-1),y=s._startPixel,w=s._endPixel,i=1e-6;let C=s.getPixelForTick(f),P;if(!(l&&(u===1?P=Math.max(C-y,w-C):a===0?P=(s.getPixelForTick(1)-C)/2:P=(C-s.getPixelForTick(f-1))/2,C+=f<a?P:-P,C<y-i||C>w+i)))return C}function zV(s,a){Kr(s,l=>{const u=l.gc,f=u.length/2;let y;if(f>a){for(y=0;y<f;++y)delete l.data[u[y]];u.splice(0,f)}})}function Hv(s){return s.drawTicks?s.tickLength:0}function IC(s,a){if(!s.display)return 0;const l=Su(s.font,a),u=kh(s.padding);return(zl(s.text)?s.text.length:1)*l.lineHeight+u.height}function DV(s,a){return Cy(s,{scale:a,type:"scale"})}function OV(s,a,l){return Cy(s,{tick:l,index:a,type:"tick"})}function NV(s,a,l){let u=uj(s);return(l&&a!=="right"||!l&&a==="right")&&(u=LV(u)),u}function FV(s,a,l,u){const{top:f,left:y,bottom:w,right:i,chart:C}=s,{chartArea:P,scales:D}=C;let $=0,G,X,te;const le=w-f,re=i-y;if(s.isHorizontal()){if(X=Zu(u,y,i),Rr(l)){const fe=Object.keys(l)[0],xe=l[fe];te=D[fe].getPixelForValue(xe)+le-a}else l==="center"?te=(P.bottom+P.top)/2+le-a:te=jC(s,l,a);G=i-y}else{if(Rr(l)){const fe=Object.keys(l)[0],xe=l[fe];X=D[fe].getPixelForValue(xe)-re+a}else l==="center"?X=(P.left+P.right)/2-re+a:X=jC(s,l,a);te=Zu(u,w,f),$=l==="left"?-Sh:Sh}return{titleX:X,titleY:te,maxWidth:G,rotation:$}}class My extends Ex{constructor(a){super(),this.id=a.id,this.type=a.type,this.options=void 0,this.ctx=a.ctx,this.chart=a.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(a){this.options=a.setContext(this.getContext()),this.axis=a.axis,this._userMin=this.parse(a.min),this._userMax=this.parse(a.max),this._suggestedMin=this.parse(a.suggestedMin),this._suggestedMax=this.parse(a.suggestedMax)}parse(a,l){return a}getUserBounds(){let{_userMin:a,_userMax:l,_suggestedMin:u,_suggestedMax:f}=this;return a=gf(a,Number.POSITIVE_INFINITY),l=gf(l,Number.NEGATIVE_INFINITY),u=gf(u,Number.POSITIVE_INFINITY),f=gf(f,Number.NEGATIVE_INFINITY),{min:gf(a,u),max:gf(l,f),minDefined:Bd(a),maxDefined:Bd(l)}}getMinMax(a){let{min:l,max:u,minDefined:f,maxDefined:y}=this.getUserBounds(),w;if(f&&y)return{min:l,max:u};const i=this.getMatchingVisibleMetas();for(let C=0,P=i.length;C<P;++C)w=i[C].controller.getMinMax(this,a),f||(l=Math.min(l,w.min)),y||(u=Math.max(u,w.max));return l=y&&l>u?u:l,u=f&&l>u?l:u,{min:gf(l,gf(u,l)),max:gf(u,gf(l,u))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const a=this.chart.data;return this.options.labels||(this.isHorizontal()?a.xLabels:a.yLabels)||a.labels||[]}getLabelItems(a=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(a))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ms(this.options.beforeUpdate,[this])}update(a,l,u){const{beginAtZero:f,grace:y,ticks:w}=this.options,i=w.sampleSize;this.beforeUpdate(),this.maxWidth=a,this.maxHeight=l,this._margins=u=Object.assign({left:0,right:0,top:0,bottom:0},u),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+u.left+u.right:this.height+u.top+u.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=l$(this,y,f),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const C=i<this.ticks.length;this._convertTicksToLabels(C?LC(this.ticks,i):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),w.display&&(w.autoSkip||w.source==="auto")&&(this.ticks=AV(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),C&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let a=this.options.reverse,l,u;this.isHorizontal()?(l=this.left,u=this.right):(l=this.top,u=this.bottom,a=!a),this._startPixel=l,this._endPixel=u,this._reversePixels=a,this._length=u-l,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ms(this.options.afterUpdate,[this])}beforeSetDimensions(){Ms(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ms(this.options.afterSetDimensions,[this])}_callHooks(a){this.chart.notifyPlugins(a,this.getContext()),Ms(this.options[a],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ms(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(a){const l=this.options.ticks;let u,f,y;for(u=0,f=a.length;u<f;u++)y=a[u],y.label=Ms(l.callback,[y.value,u,a],this)}afterTickToLabelConversion(){Ms(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ms(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const a=this.options,l=a.ticks,u=RC(this.ticks.length,a.ticks.maxTicksLimit),f=l.minRotation||0,y=l.maxRotation;let w=f,i,C,P;if(!this._isVisible()||!l.display||f>=y||u<=1||!this.isHorizontal()){this.labelRotation=f;return}const D=this._getLabelSizes(),$=D.widest.width,G=D.highest.height,X=Th(this.chart.width-$,0,this.maxWidth);i=a.offset?this.maxWidth/u:X/(u-1),$+6>i&&(i=X/(u-(a.offset?.5:1)),C=this.maxHeight-Hv(a.grid)-l.padding-IC(a.title,this.chart.options.font),P=Math.sqrt($*$+G*G),w=zU(Math.min(Math.asin(Th((D.highest.height+6)/i,-1,1)),Math.asin(Th(C/P,-1,1))-Math.asin(Th(G/P,-1,1)))),w=Math.max(f,Math.min(y,w))),this.labelRotation=w}afterCalculateLabelRotation(){Ms(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ms(this.options.beforeFit,[this])}fit(){const a={width:0,height:0},{chart:l,options:{ticks:u,title:f,grid:y}}=this,w=this._isVisible(),i=this.isHorizontal();if(w){const C=IC(f,l.options.font);if(i?(a.width=this.maxWidth,a.height=Hv(y)+C):(a.height=this.maxHeight,a.width=Hv(y)+C),u.display&&this.ticks.length){const{first:P,last:D,widest:$,highest:G}=this._getLabelSizes(),X=u.padding*2,te=Kg(this.labelRotation),le=Math.cos(te),re=Math.sin(te);if(i){const fe=u.mirror?0:re*$.width+le*G.height;a.height=Math.min(this.maxHeight,a.height+fe+X)}else{const fe=u.mirror?0:le*$.width+re*G.height;a.width=Math.min(this.maxWidth,a.width+fe+X)}this._calculatePadding(P,D,re,le)}}this._handleMargins(),i?(this.width=this._length=l.width-this._margins.left-this._margins.right,this.height=a.height):(this.width=a.width,this.height=this._length=l.height-this._margins.top-this._margins.bottom)}_calculatePadding(a,l,u,f){const{ticks:{align:y,padding:w},position:i}=this.options,C=this.labelRotation!==0,P=i!=="top"&&this.axis==="x";if(this.isHorizontal()){const D=this.getPixelForTick(0)-this.left,$=this.right-this.getPixelForTick(this.ticks.length-1);let G=0,X=0;C?P?(G=f*a.width,X=u*l.height):(G=u*a.height,X=f*l.width):y==="start"?X=l.width:y==="end"?G=a.width:y!=="inner"&&(G=a.width/2,X=l.width/2),this.paddingLeft=Math.max((G-D+w)*this.width/(this.width-D),0),this.paddingRight=Math.max((X-$+w)*this.width/(this.width-$),0)}else{let D=l.height/2,$=a.height/2;y==="start"?(D=0,$=a.height):y==="end"&&(D=l.height,$=0),this.paddingTop=D+w,this.paddingBottom=$+w}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ms(this.options.afterFit,[this])}isHorizontal(){const{axis:a,position:l}=this.options;return l==="top"||l==="bottom"||a==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(a){this.beforeTickToLabelConversion(),this.generateTickLabels(a);let l,u;for(l=0,u=a.length;l<u;l++)us(a[l].label)&&(a.splice(l,1),u--,l--);this.afterTickToLabelConversion()}_getLabelSizes(){let a=this._labelSizes;if(!a){const l=this.options.ticks.sampleSize;let u=this.ticks;l<u.length&&(u=LC(u,l)),this._labelSizes=a=this._computeLabelSizes(u,u.length,this.options.ticks.maxTicksLimit)}return a}_computeLabelSizes(a,l,u){const{ctx:f,_longestTextCache:y}=this,w=[],i=[],C=Math.floor(l/RC(l,u));let P=0,D=0,$,G,X,te,le,re,fe,xe,be,Ne,Be;for($=0;$<l;$+=C){if(te=a[$].label,le=this._resolveTickFontOptions($),f.font=re=le.string,fe=y[re]=y[re]||{data:{},gc:[]},xe=le.lineHeight,be=Ne=0,!us(te)&&!zl(te))be=cC(f,fe.data,fe.gc,be,te),Ne=xe;else if(zl(te))for(G=0,X=te.length;G<X;++G)Be=te[G],!us(Be)&&!zl(Be)&&(be=cC(f,fe.data,fe.gc,be,Be),Ne+=xe);w.push(be),i.push(Ne),P=Math.max(be,P),D=Math.max(Ne,D)}zV(y,l);const Ee=w.indexOf(P),et=i.indexOf(D),at=He=>({width:w[He]||0,height:i[He]||0});return{first:at(0),last:at(l-1),widest:at(Ee),highest:at(et),widths:w,heights:i}}getLabelForValue(a){return a}getPixelForValue(a,l){return NaN}getValueForPixel(a){}getPixelForTick(a){const l=this.ticks;return a<0||a>l.length-1?null:this.getPixelForValue(l[a].value)}getPixelForDecimal(a){this._reversePixels&&(a=1-a);const l=this._startPixel+a*this._length;return FU(this._alignToPixels?Vg(this.chart,l,0):l)}getDecimalForPixel(a){const l=(a-this._startPixel)/this._length;return this._reversePixels?1-l:l}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:a,max:l}=this;return a<0&&l<0?l:a>0&&l>0?a:0}getContext(a){const l=this.ticks||[];if(a>=0&&a<l.length){const u=l[a];return u.$context||(u.$context=OV(this.getContext(),a,u))}return this.$context||(this.$context=DV(this.chart.getContext(),this))}_tickSize(){const a=this.options.ticks,l=Kg(this.labelRotation),u=Math.abs(Math.cos(l)),f=Math.abs(Math.sin(l)),y=this._getLabelSizes(),w=a.autoSkipPadding||0,i=y?y.widest.width+w:0,C=y?y.highest.height+w:0;return this.isHorizontal()?C*u>i*f?i/u:C/f:C*f<i*u?C/u:i/f}_isVisible(){const a=this.options.display;return a!=="auto"?!!a:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(a){const l=this.axis,u=this.chart,f=this.options,{grid:y,position:w,border:i}=f,C=y.offset,P=this.isHorizontal(),$=this.ticks.length+(C?1:0),G=Hv(y),X=[],te=i.setContext(this.getContext()),le=te.display?te.width:0,re=le/2,fe=function(qe){return Vg(u,qe,le)};let xe,be,Ne,Be,Ee,et,at,He,lt,pt,Zt,jt;if(w==="top")xe=fe(this.bottom),et=this.bottom-G,He=xe-re,pt=fe(a.top)+re,jt=a.bottom;else if(w==="bottom")xe=fe(this.top),pt=a.top,jt=fe(a.bottom)-re,et=xe+re,He=this.top+G;else if(w==="left")xe=fe(this.right),Ee=this.right-G,at=xe-re,lt=fe(a.left)+re,Zt=a.right;else if(w==="right")xe=fe(this.left),lt=a.left,Zt=fe(a.right)-re,Ee=xe+re,at=this.left+G;else if(l==="x"){if(w==="center")xe=fe((a.top+a.bottom)/2+.5);else if(Rr(w)){const qe=Object.keys(w)[0],wt=w[qe];xe=fe(this.chart.scales[qe].getPixelForValue(wt))}pt=a.top,jt=a.bottom,et=xe+re,He=et+G}else if(l==="y"){if(w==="center")xe=fe((a.left+a.right)/2);else if(Rr(w)){const qe=Object.keys(w)[0],wt=w[qe];xe=fe(this.chart.scales[qe].getPixelForValue(wt))}Ee=xe-re,at=Ee-G,lt=a.left,Zt=a.right}const Di=Br(f.ticks.maxTicksLimit,$),Pi=Math.max(1,Math.ceil($/Di));for(be=0;be<$;be+=Pi){const qe=this.getContext(be),wt=y.setContext(qe),Ct=i.setContext(qe),Vi=wt.lineWidth,Qe=wt.color,St=Ct.dash||[],Ht=Ct.dashOffset,Ft=wt.tickWidth,_i=wt.tickColor,At=wt.tickBorderDash||[],Xt=wt.tickBorderDashOffset;Ne=IV(this,be,C),Ne!==void 0&&(Be=Vg(u,Ne,Vi),P?Ee=at=lt=Zt=Be:et=He=pt=jt=Be,X.push({tx1:Ee,ty1:et,tx2:at,ty2:He,x1:lt,y1:pt,x2:Zt,y2:jt,width:Vi,color:Qe,borderDash:St,borderDashOffset:Ht,tickWidth:Ft,tickColor:_i,tickBorderDash:At,tickBorderDashOffset:Xt}))}return this._ticksLength=$,this._borderValue=xe,X}_computeLabelItems(a){const l=this.axis,u=this.options,{position:f,ticks:y}=u,w=this.isHorizontal(),i=this.ticks,{align:C,crossAlign:P,padding:D,mirror:$}=y,G=Hv(u.grid),X=G+D,te=$?-D:X,le=-Kg(this.labelRotation),re=[];let fe,xe,be,Ne,Be,Ee,et,at,He,lt,pt,Zt,jt="middle";if(f==="top")Ee=this.bottom-te,et=this._getXAxisLabelAlignment();else if(f==="bottom")Ee=this.top+te,et=this._getXAxisLabelAlignment();else if(f==="left"){const Pi=this._getYAxisLabelAlignment(G);et=Pi.textAlign,Be=Pi.x}else if(f==="right"){const Pi=this._getYAxisLabelAlignment(G);et=Pi.textAlign,Be=Pi.x}else if(l==="x"){if(f==="center")Ee=(a.top+a.bottom)/2+X;else if(Rr(f)){const Pi=Object.keys(f)[0],qe=f[Pi];Ee=this.chart.scales[Pi].getPixelForValue(qe)+X}et=this._getXAxisLabelAlignment()}else if(l==="y"){if(f==="center")Be=(a.left+a.right)/2-X;else if(Rr(f)){const Pi=Object.keys(f)[0],qe=f[Pi];Be=this.chart.scales[Pi].getPixelForValue(qe)}et=this._getYAxisLabelAlignment(G).textAlign}l==="y"&&(C==="start"?jt="top":C==="end"&&(jt="bottom"));const Di=this._getLabelSizes();for(fe=0,xe=i.length;fe<xe;++fe){be=i[fe],Ne=be.label;const Pi=y.setContext(this.getContext(fe));at=this.getPixelForTick(fe)+y.labelOffset,He=this._resolveTickFontOptions(fe),lt=He.lineHeight,pt=zl(Ne)?Ne.length:1;const qe=pt/2,wt=Pi.color,Ct=Pi.textStrokeColor,Vi=Pi.textStrokeWidth;let Qe=et;w?(Be=at,et==="inner"&&(fe===xe-1?Qe=this.options.reverse?"left":"right":fe===0?Qe=this.options.reverse?"right":"left":Qe="center"),f==="top"?P==="near"||le!==0?Zt=-pt*lt+lt/2:P==="center"?Zt=-Di.highest.height/2-qe*lt+lt:Zt=-Di.highest.height+lt/2:P==="near"||le!==0?Zt=lt/2:P==="center"?Zt=Di.highest.height/2-qe*lt:Zt=Di.highest.height-pt*lt,$&&(Zt*=-1),le!==0&&!Pi.showLabelBackdrop&&(Be+=lt/2*Math.sin(le))):(Ee=at,Zt=(1-pt)*lt/2);let St;if(Pi.showLabelBackdrop){const Ht=kh(Pi.backdropPadding),Ft=Di.heights[fe],_i=Di.widths[fe];let At=Zt-Ht.top,Xt=0-Ht.left;switch(jt){case"middle":At-=Ft/2;break;case"bottom":At-=Ft;break}switch(et){case"center":Xt-=_i/2;break;case"right":Xt-=_i;break;case"inner":fe===xe-1?Xt-=_i:fe>0&&(Xt-=_i/2);break}St={left:Xt,top:At,width:_i+Ht.width,height:Ft+Ht.height,color:Pi.backdropColor}}re.push({label:Ne,font:He,textOffset:Zt,options:{rotation:le,color:wt,strokeColor:Ct,strokeWidth:Vi,textAlign:Qe,textBaseline:jt,translation:[Be,Ee],backdrop:St}})}return re}_getXAxisLabelAlignment(){const{position:a,ticks:l}=this.options;if(-Kg(this.labelRotation))return a==="top"?"left":"right";let f="center";return l.align==="start"?f="left":l.align==="end"?f="right":l.align==="inner"&&(f="inner"),f}_getYAxisLabelAlignment(a){const{position:l,ticks:{crossAlign:u,mirror:f,padding:y}}=this.options,w=this._getLabelSizes(),i=a+y,C=w.widest.width;let P,D;return l==="left"?f?(D=this.right+y,u==="near"?P="left":u==="center"?(P="center",D+=C/2):(P="right",D+=C)):(D=this.right-i,u==="near"?P="right":u==="center"?(P="center",D-=C/2):(P="left",D=this.left)):l==="right"?f?(D=this.left+y,u==="near"?P="right":u==="center"?(P="center",D-=C/2):(P="left",D-=C)):(D=this.left+i,u==="near"?P="left":u==="center"?(P="center",D+=C/2):(P="right",D=this.right)):P="right",{textAlign:P,x:D}}_computeLabelArea(){if(this.options.ticks.mirror)return;const a=this.chart,l=this.options.position;if(l==="left"||l==="right")return{top:0,left:this.left,bottom:a.height,right:this.right};if(l==="top"||l==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:a.width}}drawBackground(){const{ctx:a,options:{backgroundColor:l},left:u,top:f,width:y,height:w}=this;l&&(a.save(),a.fillStyle=l,a.fillRect(u,f,y,w),a.restore())}getLineWidthForValue(a){const l=this.options.grid;if(!this._isVisible()||!l.display)return 0;const f=this.ticks.findIndex(y=>y.value===a);return f>=0?l.setContext(this.getContext(f)).lineWidth:0}drawGrid(a){const l=this.options.grid,u=this.ctx,f=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(a));let y,w;const i=(C,P,D)=>{!D.width||!D.color||(u.save(),u.lineWidth=D.width,u.strokeStyle=D.color,u.setLineDash(D.borderDash||[]),u.lineDashOffset=D.borderDashOffset,u.beginPath(),u.moveTo(C.x,C.y),u.lineTo(P.x,P.y),u.stroke(),u.restore())};if(l.display)for(y=0,w=f.length;y<w;++y){const C=f[y];l.drawOnChartArea&&i({x:C.x1,y:C.y1},{x:C.x2,y:C.y2},C),l.drawTicks&&i({x:C.tx1,y:C.ty1},{x:C.tx2,y:C.ty2},{color:C.tickColor,width:C.tickWidth,borderDash:C.tickBorderDash,borderDashOffset:C.tickBorderDashOffset})}}drawBorder(){const{chart:a,ctx:l,options:{border:u,grid:f}}=this,y=u.setContext(this.getContext()),w=u.display?y.width:0;if(!w)return;const i=f.setContext(this.getContext(0)).lineWidth,C=this._borderValue;let P,D,$,G;this.isHorizontal()?(P=Vg(a,this.left,w)-w/2,D=Vg(a,this.right,i)+i/2,$=G=C):($=Vg(a,this.top,w)-w/2,G=Vg(a,this.bottom,i)+i/2,P=D=C),l.save(),l.lineWidth=y.width,l.strokeStyle=y.color,l.beginPath(),l.moveTo(P,$),l.lineTo(D,G),l.stroke(),l.restore()}drawLabels(a){if(!this.options.ticks.display)return;const u=this.ctx,f=this._computeLabelArea();f&&r2(u,f);const y=this.getLabelItems(a);for(const w of y){const i=w.options,C=w.font,P=w.label,D=w.textOffset;Ob(u,P,0,D,C,i)}f&&s2(u)}drawTitle(){const{ctx:a,options:{position:l,title:u,reverse:f}}=this;if(!u.display)return;const y=Su(u.font),w=kh(u.padding),i=u.align;let C=y.lineHeight/2;l==="bottom"||l==="center"||Rr(l)?(C+=w.bottom,zl(u.text)&&(C+=y.lineHeight*(u.text.length-1))):C+=w.top;const{titleX:P,titleY:D,maxWidth:$,rotation:G}=FV(this,C,l,i);Ob(a,u.text,0,0,y,{color:u.color,maxWidth:$,rotation:G,textAlign:NV(i,l,f),textBaseline:"middle",translation:[P,D]})}draw(a){this._isVisible()&&(this.drawBackground(),this.drawGrid(a),this.drawBorder(),this.drawTitle(),this.drawLabels(a))}_layers(){const a=this.options,l=a.ticks&&a.ticks.z||0,u=Br(a.grid&&a.grid.z,-1),f=Br(a.border&&a.border.z,0);return!this._isVisible()||this.draw!==My.prototype.draw?[{z:l,draw:y=>{this.draw(y)}}]:[{z:u,draw:y=>{this.drawBackground(),this.drawGrid(y),this.drawTitle()}},{z:f,draw:()=>{this.drawBorder()}},{z:l,draw:y=>{this.drawLabels(y)}}]}getMatchingVisibleMetas(a){const l=this.chart.getSortedVisibleDatasetMetas(),u=this.axis+"AxisID",f=[];let y,w;for(y=0,w=l.length;y<w;++y){const i=l[y];i[u]===this.id&&(!a||i.type===a)&&f.push(i)}return f}_resolveTickFontOptions(a){const l=this.options.ticks.setContext(this.getContext(a));return Su(l.font)}_maxDigits(){const a=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/a}}class tb{constructor(a,l,u){this.type=a,this.scope=l,this.override=u,this.items=Object.create(null)}isForType(a){return Object.prototype.isPrototypeOf.call(this.type.prototype,a.prototype)}register(a){const l=Object.getPrototypeOf(a);let u;$V(l)&&(u=this.register(l));const f=this.items,y=a.id,w=this.scope+"."+y;if(!y)throw new Error("class does not have id: "+a);return y in f||(f[y]=a,BV(a,w,u),this.override&&jo.override(a.id,a.overrides)),w}get(a){return this.items[a]}unregister(a){const l=this.items,u=a.id,f=this.scope;u in l&&delete l[u],f&&u in jo[f]&&(delete jo[f][u],this.override&&delete t_[u])}}function BV(s,a,l){const u=gx(Object.create(null),[l?jo.get(l):{},jo.get(a),s.defaults]);jo.set(a,u),s.defaultRoutes&&UV(a,s.defaultRoutes),s.descriptors&&jo.describe(a,s.descriptors)}function UV(s,a){Object.keys(a).forEach(l=>{const u=l.split("."),f=u.pop(),y=[s].concat(u).join("."),w=a[l].split("."),i=w.pop(),C=w.join(".");jo.route(y,f,C,i)})}function $V(s){return"id"in s&&"defaults"in s}class VV{constructor(){this.controllers=new tb(Ej,"datasets",!0),this.elements=new tb(Ex,"elements"),this.plugins=new tb(Object,"plugins"),this.scales=new tb(My,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...a){this._each("register",a)}remove(...a){this._each("unregister",a)}addControllers(...a){this._each("register",a,this.controllers)}addElements(...a){this._each("register",a,this.elements)}addPlugins(...a){this._each("register",a,this.plugins)}addScales(...a){this._each("register",a,this.scales)}getController(a){return this._get(a,this.controllers,"controller")}getElement(a){return this._get(a,this.elements,"element")}getPlugin(a){return this._get(a,this.plugins,"plugin")}getScale(a){return this._get(a,this.scales,"scale")}removeControllers(...a){this._each("unregister",a,this.controllers)}removeElements(...a){this._each("unregister",a,this.elements)}removePlugins(...a){this._each("unregister",a,this.plugins)}removeScales(...a){this._each("unregister",a,this.scales)}_each(a,l,u){[...l].forEach(f=>{const y=u||this._getRegistryForType(f);u||y.isForType(f)||y===this.plugins&&f.id?this._exec(a,y,f):Kr(f,w=>{const i=u||this._getRegistryForType(w);this._exec(a,i,w)})})}_exec(a,l,u){const f=n2(a);Ms(u["before"+f],[],u),l[a](u),Ms(u["after"+f],[],u)}_getRegistryForType(a){for(let l=0;l<this._typedRegistries.length;l++){const u=this._typedRegistries[l];if(u.isForType(a))return u}return this.plugins}_get(a,l,u){const f=l.get(a);if(f===void 0)throw new Error('"'+a+'" is not a registered '+u+".");return f}}var vf=new VV;class HV{constructor(){this._init=void 0}notify(a,l,u,f){if(l==="beforeInit"&&(this._init=this._createDescriptors(a,!0),this._notify(this._init,a,"install")),this._init===void 0)return;const y=f?this._descriptors(a).filter(f):this._descriptors(a),w=this._notify(y,a,l,u);return l==="afterDestroy"&&(this._notify(y,a,"stop"),this._notify(this._init,a,"uninstall"),this._init=void 0),w}_notify(a,l,u,f){f=f||{};for(const y of a){const w=y.plugin,i=w[u],C=[l,f,y.options];if(Ms(i,C,w)===!1&&f.cancelable)return!1}return!0}invalidate(){us(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(a){if(this._cache)return this._cache;const l=this._cache=this._createDescriptors(a);return this._notifyStateChanges(a),l}_createDescriptors(a,l){const u=a&&a.config,f=Br(u.options&&u.options.plugins,{}),y=GV(u);return f===!1&&!l?[]:WV(a,y,f,l)}_notifyStateChanges(a){const l=this._oldCache||[],u=this._cache,f=(y,w)=>y.filter(i=>!w.some(C=>i.plugin.id===C.plugin.id));this._notify(f(l,u),a,"stop"),this._notify(f(u,l),a,"start")}}function GV(s){const a={},l=[],u=Object.keys(vf.plugins.items);for(let y=0;y<u.length;y++)l.push(vf.getPlugin(u[y]));const f=s.plugins||[];for(let y=0;y<f.length;y++){const w=f[y];l.indexOf(w)===-1&&(l.push(w),a[w.id]=!0)}return{plugins:l,localIds:a}}function qV(s,a){return!a&&s===!1?null:s===!0?{}:s}function WV(s,{plugins:a,localIds:l},u,f){const y=[],w=s.getContext();for(const i of a){const C=i.id,P=qV(u[C],f);P!==null&&y.push({plugin:i,options:ZV(s.config,{plugin:i,local:l[C]},P,w)})}return y}function ZV(s,{plugin:a,local:l},u,f){const y=s.pluginScopeKeys(a),w=s.getOptionScopes(u,y);return l&&a.defaults&&w.push(a.defaults),s.createResolver(w,f,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function MS(s,a){const l=jo.datasets[s]||{};return((a.datasets||{})[s]||{}).indexAxis||a.indexAxis||l.indexAxis||"x"}function XV(s,a){let l=s;return s==="_index_"?l=a:s==="_value_"&&(l=a==="x"?"y":"x"),l}function YV(s,a){return s===a?"_index_":"_value_"}function zC(s){if(s==="x"||s==="y"||s==="r")return s}function KV(s){if(s==="top"||s==="bottom")return"x";if(s==="left"||s==="right")return"y"}function PS(s,...a){if(zC(s))return s;for(const l of a){const u=l.axis||KV(l.position)||s.length>1&&zC(s[0].toLowerCase());if(u)return u}throw new Error(`Cannot determine type of '${s}' axis. Please provide 'axis' or 'position' option.`)}function DC(s,a,l){if(l[a+"AxisID"]===s)return{axis:a}}function JV(s,a){if(a.data&&a.data.datasets){const l=a.data.datasets.filter(u=>u.xAxisID===s||u.yAxisID===s);if(l.length)return DC(s,"x",l[0])||DC(s,"y",l[0])}return{}}function QV(s,a){const l=t_[s.type]||{scales:{}},u=a.scales||{},f=MS(s.type,a),y=Object.create(null);return Object.keys(u).forEach(w=>{const i=u[w];if(!Rr(i))return console.error(`Invalid scale configuration for scale: ${w}`);if(i._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${w}`);const C=PS(w,i,JV(w,s),jo.scales[i.type]),P=YV(C,f),D=l.scales||{};y[w]=nx(Object.create(null),[{axis:C},i,D[C],D[P]])}),s.data.datasets.forEach(w=>{const i=w.type||s.type,C=w.indexAxis||MS(i,a),D=(t_[i]||{}).scales||{};Object.keys(D).forEach($=>{const G=XV($,C),X=w[G+"AxisID"]||G;y[X]=y[X]||Object.create(null),nx(y[X],[{axis:G},u[X],D[$]])})}),Object.keys(y).forEach(w=>{const i=y[w];nx(i,[jo.scales[i.type],jo.scale])}),y}function Lj(s){const a=s.options||(s.options={});a.plugins=Br(a.plugins,{}),a.scales=QV(s,a)}function Ij(s){return s=s||{},s.datasets=s.datasets||[],s.labels=s.labels||[],s}function e6(s){return s=s||{},s.data=Ij(s.data),Lj(s),s}const OC=new Map,zj=new Set;function ib(s,a){let l=OC.get(s);return l||(l=a(),OC.set(s,l),zj.add(l)),l}const Gv=(s,a,l)=>{const u=wy(a,l);u!==void 0&&s.add(u)};class t6{constructor(a){this._config=e6(a),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(a){this._config.type=a}get data(){return this._config.data}set data(a){this._config.data=Ij(a)}get options(){return this._config.options}set options(a){this._config.options=a}get plugins(){return this._config.plugins}update(){const a=this._config;this.clearCache(),Lj(a)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(a){return ib(a,()=>[[`datasets.${a}`,""]])}datasetAnimationScopeKeys(a,l){return ib(`${a}.transition.${l}`,()=>[[`datasets.${a}.transitions.${l}`,`transitions.${l}`],[`datasets.${a}`,""]])}datasetElementScopeKeys(a,l){return ib(`${a}-${l}`,()=>[[`datasets.${a}.elements.${l}`,`datasets.${a}`,`elements.${l}`,""]])}pluginScopeKeys(a){const l=a.id,u=this.type;return ib(`${u}-plugin-${l}`,()=>[[`plugins.${l}`,...a.additionalOptionScopes||[]]])}_cachedScopes(a,l){const u=this._scopeCache;let f=u.get(a);return(!f||l)&&(f=new Map,u.set(a,f)),f}getOptionScopes(a,l,u){const{options:f,type:y}=this,w=this._cachedScopes(a,u),i=w.get(l);if(i)return i;const C=new Set;l.forEach(D=>{a&&(C.add(a),D.forEach($=>Gv(C,a,$))),D.forEach($=>Gv(C,f,$)),D.forEach($=>Gv(C,t_[y]||{},$)),D.forEach($=>Gv(C,jo,$)),D.forEach($=>Gv(C,CS,$))});const P=Array.from(C);return P.length===0&&P.push(Object.create(null)),zj.has(l)&&w.set(l,P),P}chartOptionScopes(){const{options:a,type:l}=this;return[a,t_[l]||{},jo.datasets[l]||{},{type:l},jo,CS]}resolveNamedOptions(a,l,u,f=[""]){const y={$shared:!0},{resolver:w,subPrefixes:i}=NC(this._resolverCache,a,f);let C=w;if(n6(w,l)){y.$shared=!1,u=Wp(u)?u():u;const P=this.createResolver(a,u,i);C=Sy(w,u,P)}for(const P of l)y[P]=C[P];return y}createResolver(a,l,u=[""],f){const{resolver:y}=NC(this._resolverCache,a,u);return Rr(l)?Sy(y,l,void 0,f):y}}function NC(s,a,l){let u=s.get(a);u||(u=new Map,s.set(a,u));const f=l.join();let y=u.get(f);return y||(y={resolver:o2(a,l),subPrefixes:l.filter(i=>!i.toLowerCase().includes("hover"))},u.set(f,y)),y}const i6=s=>Rr(s)&&Object.getOwnPropertyNames(s).some(a=>Wp(s[a]));function n6(s,a){const{isScriptable:l,isIndexable:u}=yj(s);for(const f of a){const y=l(f),w=u(f),i=(w||y)&&s[f];if(y&&(Wp(i)||i6(i))||w&&zl(i))return!0}return!1}var a6="4.5.1";const r6=["top","bottom","left","right","chartArea"];function FC(s,a){return s==="top"||s==="bottom"||r6.indexOf(s)===-1&&a==="x"}function BC(s,a){return function(l,u){return l[s]===u[s]?l[a]-u[a]:l[s]-u[s]}}function UC(s){const a=s.chart,l=a.options.animation;a.notifyPlugins("afterRender"),Ms(l&&l.onComplete,[s],a)}function s6(s){const a=s.chart,l=a.options.animation;Ms(l&&l.onProgress,[s],a)}function Dj(s){return u2()&&typeof s=="string"?s=document.getElementById(s):s&&s.length&&(s=s[0]),s&&s.canvas&&(s=s.canvas),s}const yb={},$C=s=>{const a=Dj(s);return Object.values(yb).filter(l=>l.canvas===a).pop()};function o6(s,a,l){const u=Object.keys(s);for(const f of u){const y=+f;if(y>=a){const w=s[f];delete s[f],(l>0||y>a)&&(s[y+l]=w)}}}function l6(s,a,l,u){return!l||s.type==="mouseout"?null:u?a:s}let Ax=class{static defaults=jo;static instances=yb;static overrides=t_;static registry=vf;static version=a6;static getChart=$C;static register(...a){vf.add(...a),VC()}static unregister(...a){vf.remove(...a),VC()}constructor(a,l){const u=this.config=new t6(l),f=Dj(a),y=$C(f);if(y)throw new Error("Canvas is already in use. Chart with ID '"+y.id+"' must be destroyed before the canvas with ID '"+y.canvas.id+"' can be reused.");const w=u.createResolver(u.chartOptionScopes(),this.getContext());this.platform=new(u.platform||EV(f)),this.platform.updateConfig(u);const i=this.platform.acquireContext(f,w.aspectRatio),C=i&&i.canvas,P=C&&C.height,D=C&&C.width;if(this.id=SU(),this.ctx=i,this.canvas=C,this.width=D,this.height=P,this._options=w,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new HV,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=VU($=>this.update($),w.resizeDelay||0),this._dataChanges=[],yb[this.id]=this,!i||!C){console.error("Failed to create chart: can't acquire context from the given item");return}Tm.listen(this,"complete",UC),Tm.listen(this,"progress",s6),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:a,maintainAspectRatio:l},width:u,height:f,_aspectRatio:y}=this;return us(a)?l&&y?y:f?u/f:null:a}get data(){return this.config.data}set data(a){this.config.data=a}get options(){return this._options}set options(a){this.config.options=a}get registry(){return vf}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():mC(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return uC(this.canvas,this.ctx),this}stop(){return Tm.stop(this),this}resize(a,l){Tm.running(this)?this._resizeBeforeDraw={width:a,height:l}:this._resize(a,l)}_resize(a,l){const u=this.options,f=this.canvas,y=u.maintainAspectRatio&&this.aspectRatio,w=this.platform.getMaximumSize(f,a,l,y),i=u.devicePixelRatio||this.platform.getDevicePixelRatio(),C=this.width?"resize":"attach";this.width=w.width,this.height=w.height,this._aspectRatio=this.aspectRatio,mC(this,i,!0)&&(this.notifyPlugins("resize",{size:w}),Ms(u.onResize,[this,w],this),this.attached&&this._doResize(C)&&this.render())}ensureScalesHaveIDs(){const l=this.options.scales||{};Kr(l,(u,f)=>{u.id=f})}buildOrUpdateScales(){const a=this.options,l=a.scales,u=this.scales,f=Object.keys(u).reduce((w,i)=>(w[i]=!1,w),{});let y=[];l&&(y=y.concat(Object.keys(l).map(w=>{const i=l[w],C=PS(w,i),P=C==="r",D=C==="x";return{options:i,dposition:P?"chartArea":D?"bottom":"left",dtype:P?"radialLinear":D?"category":"linear"}}))),Kr(y,w=>{const i=w.options,C=i.id,P=PS(C,i),D=Br(i.type,w.dtype);(i.position===void 0||FC(i.position,P)!==FC(w.dposition))&&(i.position=w.dposition),f[C]=!0;let $=null;if(C in u&&u[C].type===D)$=u[C];else{const G=vf.getScale(D);$=new G({id:C,type:D,ctx:this.ctx,chart:this}),u[$.id]=$}$.init(i,a)}),Kr(f,(w,i)=>{w||delete u[i]}),Kr(u,w=>{Fp.configure(this,w,w.options),Fp.addBox(this,w)})}_updateMetasets(){const a=this._metasets,l=this.data.datasets.length,u=a.length;if(a.sort((f,y)=>f.index-y.index),u>l){for(let f=l;f<u;++f)this._destroyDatasetMeta(f);a.splice(l,u-l)}this._sortedMetasets=a.slice(0).sort(BC("order","index"))}_removeUnreferencedMetasets(){const{_metasets:a,data:{datasets:l}}=this;a.length>l.length&&delete this._stacks,a.forEach((u,f)=>{l.filter(y=>y===u._dataset).length===0&&this._destroyDatasetMeta(f)})}buildOrUpdateControllers(){const a=[],l=this.data.datasets;let u,f;for(this._removeUnreferencedMetasets(),u=0,f=l.length;u<f;u++){const y=l[u];let w=this.getDatasetMeta(u);const i=y.type||this.config.type;if(w.type&&w.type!==i&&(this._destroyDatasetMeta(u),w=this.getDatasetMeta(u)),w.type=i,w.indexAxis=y.indexAxis||MS(i,this.options),w.order=y.order||0,w.index=u,w.label=""+y.label,w.visible=this.isDatasetVisible(u),w.controller)w.controller.updateIndex(u),w.controller.linkScales();else{const C=vf.getController(i),{datasetElementType:P,dataElementType:D}=jo.datasets[i];Object.assign(C,{dataElementType:vf.getElement(D),datasetElementType:P&&vf.getElement(P)}),w.controller=new C(this,u),a.push(w.controller)}}return this._updateMetasets(),a}_resetElements(){Kr(this.data.datasets,(a,l)=>{this.getDatasetMeta(l).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(a){const l=this.config;l.update();const u=this._options=l.createResolver(l.chartOptionScopes(),this.getContext()),f=this._animationsDisabled=!u.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:a,cancelable:!0})===!1)return;const y=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let w=0;for(let P=0,D=this.data.datasets.length;P<D;P++){const{controller:$}=this.getDatasetMeta(P),G=!f&&y.indexOf($)===-1;$.buildOrUpdateElements(G),w=Math.max(+$.getMaxOverflow(),w)}w=this._minPadding=u.layout.autoPadding?w:0,this._updateLayout(w),f||Kr(y,P=>{P.reset()}),this._updateDatasets(a),this.notifyPlugins("afterUpdate",{mode:a}),this._layers.sort(BC("z","_idx"));const{_active:i,_lastEvent:C}=this;C?this._eventHandler(C,!0):i.length&&this._updateHoverStyles(i,i,!0),this.render()}_updateScales(){Kr(this.scales,a=>{Fp.removeBox(this,a)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const a=this.options,l=new Set(Object.keys(this._listeners)),u=new Set(a.events);(!eC(l,u)||!!this._responsiveListeners!==a.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:a}=this,l=this._getUniformDataChanges()||[];for(const{method:u,start:f,count:y}of l){const w=u==="_removeElements"?-y:y;o6(a,f,w)}}_getUniformDataChanges(){const a=this._dataChanges;if(!a||!a.length)return;this._dataChanges=[];const l=this.data.datasets.length,u=y=>new Set(a.filter(w=>w[0]===y).map((w,i)=>i+","+w.splice(1).join(","))),f=u(0);for(let y=1;y<l;y++)if(!eC(f,u(y)))return;return Array.from(f).map(y=>y.split(",")).map(y=>({method:y[1],start:+y[2],count:+y[3]}))}_updateLayout(a){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Fp.update(this,this.width,this.height,a);const l=this.chartArea,u=l.width<=0||l.height<=0;this._layers=[],Kr(this.boxes,f=>{u&&f.position==="chartArea"||(f.configure&&f.configure(),this._layers.push(...f._layers()))},this),this._layers.forEach((f,y)=>{f._idx=y}),this.notifyPlugins("afterLayout")}_updateDatasets(a){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:a,cancelable:!0})!==!1){for(let l=0,u=this.data.datasets.length;l<u;++l)this.getDatasetMeta(l).controller.configure();for(let l=0,u=this.data.datasets.length;l<u;++l)this._updateDataset(l,Wp(a)?a({datasetIndex:l}):a);this.notifyPlugins("afterDatasetsUpdate",{mode:a})}}_updateDataset(a,l){const u=this.getDatasetMeta(a),f={meta:u,index:a,mode:l,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",f)!==!1&&(u.controller._update(l),f.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",f))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Tm.has(this)?this.attached&&!Tm.running(this)&&Tm.start(this):(this.draw(),UC({chart:this})))}draw(){let a;if(this._resizeBeforeDraw){const{width:u,height:f}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(u,f)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const l=this._layers;for(a=0;a<l.length&&l[a].z<=0;++a)l[a].draw(this.chartArea);for(this._drawDatasets();a<l.length;++a)l[a].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(a){const l=this._sortedMetasets,u=[];let f,y;for(f=0,y=l.length;f<y;++f){const w=l[f];(!a||w.visible)&&u.push(w)}return u}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const a=this.getSortedVisibleDatasetMetas();for(let l=a.length-1;l>=0;--l)this._drawDataset(a[l]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(a){const l=this.ctx,u={meta:a,index:a.index,cancelable:!0},f=C$(this,a);this.notifyPlugins("beforeDatasetDraw",u)!==!1&&(f&&r2(l,f),a.controller.draw(),f&&s2(l),u.cancelable=!1,this.notifyPlugins("afterDatasetDraw",u))}isPointInArea(a){return pj(a,this.chartArea,this._minPadding)}getElementsAtEventForMode(a,l,u,f){const y=rV.modes[l];return typeof y=="function"?y(this,a,u,f):[]}getDatasetMeta(a){const l=this.data.datasets[a],u=this._metasets;let f=u.filter(y=>y&&y._dataset===l).pop();return f||(f={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:l&&l.order||0,index:a,_dataset:l,_parsed:[],_sorted:!1},u.push(f)),f}getContext(){return this.$context||(this.$context=Cy(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(a){const l=this.data.datasets[a];if(!l)return!1;const u=this.getDatasetMeta(a);return typeof u.hidden=="boolean"?!u.hidden:!l.hidden}setDatasetVisibility(a,l){const u=this.getDatasetMeta(a);u.hidden=!l}toggleDataVisibility(a){this._hiddenIndices[a]=!this._hiddenIndices[a]}getDataVisibility(a){return!this._hiddenIndices[a]}_updateVisibility(a,l,u){const f=u?"show":"hide",y=this.getDatasetMeta(a),w=y.controller._resolveAnimations(void 0,f);_x(l)?(y.data[l].hidden=!u,this.update()):(this.setDatasetVisibility(a,u),w.update(y,{visible:u}),this.update(i=>i.datasetIndex===a?f:void 0))}hide(a,l){this._updateVisibility(a,l,!1)}show(a,l){this._updateVisibility(a,l,!0)}_destroyDatasetMeta(a){const l=this._metasets[a];l&&l.controller&&l.controller._destroy(),delete this._metasets[a]}_stop(){let a,l;for(this.stop(),Tm.remove(this),a=0,l=this.data.datasets.length;a<l;++a)this._destroyDatasetMeta(a)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:a,ctx:l}=this;this._stop(),this.config.clearCache(),a&&(this.unbindEvents(),uC(a,l),this.platform.releaseContext(l),this.canvas=null,this.ctx=null),delete yb[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...a){return this.canvas.toDataURL(...a)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const a=this._listeners,l=this.platform,u=(y,w)=>{l.addEventListener(this,y,w),a[y]=w},f=(y,w,i)=>{y.offsetX=w,y.offsetY=i,this._eventHandler(y)};Kr(this.options.events,y=>u(y,f))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const a=this._responsiveListeners,l=this.platform,u=(C,P)=>{l.addEventListener(this,C,P),a[C]=P},f=(C,P)=>{a[C]&&(l.removeEventListener(this,C,P),delete a[C])},y=(C,P)=>{this.canvas&&this.resize(C,P)};let w;const i=()=>{f("attach",i),this.attached=!0,this.resize(),u("resize",y),u("detach",w)};w=()=>{this.attached=!1,f("resize",y),this._stop(),this._resize(0,0),u("attach",i)},l.isAttached(this.canvas)?i():w()}unbindEvents(){Kr(this._listeners,(a,l)=>{this.platform.removeEventListener(this,l,a)}),this._listeners={},Kr(this._responsiveListeners,(a,l)=>{this.platform.removeEventListener(this,l,a)}),this._responsiveListeners=void 0}updateHoverStyle(a,l,u){const f=u?"set":"remove";let y,w,i,C;for(l==="dataset"&&(y=this.getDatasetMeta(a[0].datasetIndex),y.controller["_"+f+"DatasetHoverStyle"]()),i=0,C=a.length;i<C;++i){w=a[i];const P=w&&this.getDatasetMeta(w.datasetIndex).controller;P&&P[f+"HoverStyle"](w.element,w.datasetIndex,w.index)}}getActiveElements(){return this._active||[]}setActiveElements(a){const l=this._active||[],u=a.map(({datasetIndex:y,index:w})=>{const i=this.getDatasetMeta(y);if(!i)throw new Error("No dataset found at index "+y);return{datasetIndex:y,element:i.data[w],index:w}});!Lb(u,l)&&(this._active=u,this._lastEvent=null,this._updateHoverStyles(u,l))}notifyPlugins(a,l,u){return this._plugins.notify(this,a,l,u)}isPluginEnabled(a){return this._plugins._cache.filter(l=>l.plugin.id===a).length===1}_updateHoverStyles(a,l,u){const f=this.options.hover,y=(C,P)=>C.filter(D=>!P.some($=>D.datasetIndex===$.datasetIndex&&D.index===$.index)),w=y(l,a),i=u?a:y(a,l);w.length&&this.updateHoverStyle(w,f.mode,!1),i.length&&f.mode&&this.updateHoverStyle(i,f.mode,!0)}_eventHandler(a,l){const u={event:a,replay:l,cancelable:!0,inChartArea:this.isPointInArea(a)},f=w=>(w.options.events||this.options.events).includes(a.native.type);if(this.notifyPlugins("beforeEvent",u,f)===!1)return;const y=this._handleEvent(a,l,u.inChartArea);return u.cancelable=!1,this.notifyPlugins("afterEvent",u,f),(y||u.changed)&&this.render(),this}_handleEvent(a,l,u){const{_active:f=[],options:y}=this,w=l,i=this._getActiveElements(a,f,u,w),C=MU(a),P=l6(a,this._lastEvent,u,C);u&&(this._lastEvent=null,Ms(y.onHover,[a,i,this],this),C&&Ms(y.onClick,[a,i,this],this));const D=!Lb(i,f);return(D||l)&&(this._active=i,this._updateHoverStyles(i,f,l)),this._lastEvent=P,D}_getActiveElements(a,l,u,f){if(a.type==="mouseout")return[];if(!u)return l;const y=this.options.hover;return this.getElementsAtEventForMode(a,y.mode,y,f)}};function VC(){return Kr(Ax.instances,s=>s._plugins.invalidate())}function Oj(s,a){const{x:l,y:u,base:f,width:y,height:w}=s.getProps(["x","y","base","width","height"],a);let i,C,P,D,$;return s.horizontal?($=w/2,i=Math.min(l,f),C=Math.max(l,f),P=u-$,D=u+$):($=y/2,i=l-$,C=l+$,P=Math.min(u,f),D=Math.max(u,f)),{left:i,top:P,right:C,bottom:D}}function Bp(s,a,l,u){return s?0:Th(a,l,u)}function c6(s,a,l){const u=s.options.borderWidth,f=s.borderSkipped,y=_j(u);return{t:Bp(f.top,y.top,0,l),r:Bp(f.right,y.right,0,a),b:Bp(f.bottom,y.bottom,0,l),l:Bp(f.left,y.left,0,a)}}function u6(s,a,l){const{enableBorderRadius:u}=s.getProps(["enableBorderRadius"]),f=s.options.borderRadius,y=_y(f),w=Math.min(a,l),i=s.borderSkipped,C=u||Rr(f);return{topLeft:Bp(!C||i.top||i.left,y.topLeft,0,w),topRight:Bp(!C||i.top||i.right,y.topRight,0,w),bottomLeft:Bp(!C||i.bottom||i.left,y.bottomLeft,0,w),bottomRight:Bp(!C||i.bottom||i.right,y.bottomRight,0,w)}}function d6(s){const a=Oj(s),l=a.right-a.left,u=a.bottom-a.top,f=c6(s,l/2,u/2),y=u6(s,l/2,u/2);return{outer:{x:a.left,y:a.top,w:l,h:u,radius:y},inner:{x:a.left+f.l,y:a.top+f.t,w:l-f.l-f.r,h:u-f.t-f.b,radius:{topLeft:Math.max(0,y.topLeft-Math.max(f.t,f.l)),topRight:Math.max(0,y.topRight-Math.max(f.t,f.r)),bottomLeft:Math.max(0,y.bottomLeft-Math.max(f.b,f.l)),bottomRight:Math.max(0,y.bottomRight-Math.max(f.b,f.r))}}}}function J1(s,a,l,u){const f=a===null,y=l===null,i=s&&!(f&&y)&&Oj(s,u);return i&&(f||my(a,i.left,i.right))&&(y||my(l,i.top,i.bottom))}function h6(s){return s.topLeft||s.topRight||s.bottomLeft||s.bottomRight}function f6(s,a){s.rect(a.x,a.y,a.w,a.h)}function Q1(s,a,l={}){const u=s.x!==l.x?-a:0,f=s.y!==l.y?-a:0,y=(s.x+s.w!==l.x+l.w?a:0)-u,w=(s.y+s.h!==l.y+l.h?a:0)-f;return{x:s.x+u,y:s.y+f,w:s.w+y,h:s.h+w,radius:s.radius}}class Nj extends Ex{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(a){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,a&&Object.assign(this,a)}draw(a){const{inflateAmount:l,options:{borderColor:u,backgroundColor:f}}=this,{inner:y,outer:w}=d6(this),i=h6(w.radius)?Nb:f6;a.save(),(w.w!==y.w||w.h!==y.h)&&(a.beginPath(),i(a,Q1(w,l,y)),a.clip(),i(a,Q1(y,-l,w)),a.fillStyle=u,a.fill("evenodd")),a.beginPath(),i(a,Q1(y,l)),a.fillStyle=f,a.fill(),a.restore()}inRange(a,l,u){return J1(this,a,l,u)}inXRange(a,l){return J1(this,a,null,l)}inYRange(a,l){return J1(this,null,a,l)}getCenterPoint(a){const{x:l,y:u,base:f,horizontal:y}=this.getProps(["x","y","base","horizontal"],a);return{x:y?(l+f)/2:l,y:y?u:(u+f)/2}}getRange(a){return a==="x"?this.width/2:this.height/2}}const HC=(s,a)=>{let{boxHeight:l=a,boxWidth:u=a}=s;return s.usePointStyle&&(l=Math.min(l,a),u=s.pointStyleWidth||Math.min(u,a)),{boxWidth:u,boxHeight:l,itemHeight:Math.max(a,l)}},m6=(s,a)=>s!==null&&a!==null&&s.datasetIndex===a.datasetIndex&&s.index===a.index;class GC extends Ex{constructor(a){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=a.chart,this.options=a.options,this.ctx=a.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(a,l,u){this.maxWidth=a,this.maxHeight=l,this._margins=u,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const a=this.options.labels||{};let l=Ms(a.generateLabels,[this.chart],this)||[];a.filter&&(l=l.filter(u=>a.filter(u,this.chart.data))),a.sort&&(l=l.sort((u,f)=>a.sort(u,f,this.chart.data))),this.options.reverse&&l.reverse(),this.legendItems=l}fit(){const{options:a,ctx:l}=this;if(!a.display){this.width=this.height=0;return}const u=a.labels,f=Su(u.font),y=f.size,w=this._computeTitleHeight(),{boxWidth:i,itemHeight:C}=HC(u,y);let P,D;l.font=f.string,this.isHorizontal()?(P=this.maxWidth,D=this._fitRows(w,y,i,C)+10):(D=this.maxHeight,P=this._fitCols(w,f,i,C)+10),this.width=Math.min(P,a.maxWidth||this.maxWidth),this.height=Math.min(D,a.maxHeight||this.maxHeight)}_fitRows(a,l,u,f){const{ctx:y,maxWidth:w,options:{labels:{padding:i}}}=this,C=this.legendHitBoxes=[],P=this.lineWidths=[0],D=f+i;let $=a;y.textAlign="left",y.textBaseline="middle";let G=-1,X=-D;return this.legendItems.forEach((te,le)=>{const re=u+l/2+y.measureText(te.text).width;(le===0||P[P.length-1]+re+2*i>w)&&($+=D,P[P.length-(le>0?0:1)]=0,X+=D,G++),C[le]={left:0,top:X,row:G,width:re,height:f},P[P.length-1]+=re+i}),$}_fitCols(a,l,u,f){const{ctx:y,maxHeight:w,options:{labels:{padding:i}}}=this,C=this.legendHitBoxes=[],P=this.columnSizes=[],D=w-a;let $=i,G=0,X=0,te=0,le=0;return this.legendItems.forEach((re,fe)=>{const{itemWidth:xe,itemHeight:be}=p6(u,l,y,re,f);fe>0&&X+be+2*i>D&&($+=G+i,P.push({width:G,height:X}),te+=G+i,le++,G=X=0),C[fe]={left:te,top:X,col:le,width:xe,height:be},G=Math.max(G,xe),X+=be+i}),$+=G,P.push({width:G,height:X}),$}adjustHitBoxes(){if(!this.options.display)return;const a=this._computeTitleHeight(),{legendHitBoxes:l,options:{align:u,labels:{padding:f},rtl:y}}=this,w=yy(y,this.left,this.width);if(this.isHorizontal()){let i=0,C=Zu(u,this.left+f,this.right-this.lineWidths[i]);for(const P of l)i!==P.row&&(i=P.row,C=Zu(u,this.left+f,this.right-this.lineWidths[i])),P.top+=this.top+a+f,P.left=w.leftForLtr(w.x(C),P.width),C+=P.width+f}else{let i=0,C=Zu(u,this.top+a+f,this.bottom-this.columnSizes[i].height);for(const P of l)P.col!==i&&(i=P.col,C=Zu(u,this.top+a+f,this.bottom-this.columnSizes[i].height)),P.top=C,P.left+=this.left+f,P.left=w.leftForLtr(w.x(P.left),P.width),C+=P.height+f}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const a=this.ctx;r2(a,this),this._draw(),s2(a)}}_draw(){const{options:a,columnSizes:l,lineWidths:u,ctx:f}=this,{align:y,labels:w}=a,i=jo.color,C=yy(a.rtl,this.left,this.width),P=Su(w.font),{padding:D}=w,$=P.size,G=$/2;let X;this.drawTitle(),f.textAlign=C.textAlign("left"),f.textBaseline="middle",f.lineWidth=.5,f.font=P.string;const{boxWidth:te,boxHeight:le,itemHeight:re}=HC(w,$),fe=function(Ee,et,at){if(isNaN(te)||te<=0||isNaN(le)||le<0)return;f.save();const He=Br(at.lineWidth,1);if(f.fillStyle=Br(at.fillStyle,i),f.lineCap=Br(at.lineCap,"butt"),f.lineDashOffset=Br(at.lineDashOffset,0),f.lineJoin=Br(at.lineJoin,"miter"),f.lineWidth=He,f.strokeStyle=Br(at.strokeStyle,i),f.setLineDash(Br(at.lineDash,[])),w.usePointStyle){const lt={radius:le*Math.SQRT2/2,pointStyle:at.pointStyle,rotation:at.rotation,borderWidth:He},pt=C.xPlus(Ee,te/2),Zt=et+G;mj(f,lt,pt,Zt,w.pointStyleWidth&&te)}else{const lt=et+Math.max(($-le)/2,0),pt=C.leftForLtr(Ee,te),Zt=_y(at.borderRadius);f.beginPath(),Object.values(Zt).some(jt=>jt!==0)?Nb(f,{x:pt,y:lt,w:te,h:le,radius:Zt}):f.rect(pt,lt,te,le),f.fill(),He!==0&&f.stroke()}f.restore()},xe=function(Ee,et,at){Ob(f,at.text,Ee,et+re/2,P,{strikethrough:at.hidden,textAlign:C.textAlign(at.textAlign)})},be=this.isHorizontal(),Ne=this._computeTitleHeight();be?X={x:Zu(y,this.left+D,this.right-u[0]),y:this.top+D+Ne,line:0}:X={x:this.left+D,y:Zu(y,this.top+Ne+D,this.bottom-l[0].height),line:0},wj(this.ctx,a.textDirection);const Be=re+D;this.legendItems.forEach((Ee,et)=>{f.strokeStyle=Ee.fontColor,f.fillStyle=Ee.fontColor;const at=f.measureText(Ee.text).width,He=C.textAlign(Ee.textAlign||(Ee.textAlign=w.textAlign)),lt=te+G+at;let pt=X.x,Zt=X.y;C.setWidth(this.width),be?et>0&&pt+lt+D>this.right&&(Zt=X.y+=Be,X.line++,pt=X.x=Zu(y,this.left+D,this.right-u[X.line])):et>0&&Zt+Be>this.bottom&&(pt=X.x=pt+l[X.line].width+D,X.line++,Zt=X.y=Zu(y,this.top+Ne+D,this.bottom-l[X.line].height));const jt=C.x(pt);if(fe(jt,Zt,Ee),pt=HU(He,pt+te+G,be?pt+lt:this.right,a.rtl),xe(C.x(pt),Zt,Ee),be)X.x+=lt+D;else if(typeof Ee.text!="string"){const Di=P.lineHeight;X.y+=Fj(Ee,Di)+D}else X.y+=Be}),Sj(this.ctx,a.textDirection)}drawTitle(){const a=this.options,l=a.title,u=Su(l.font),f=kh(l.padding);if(!l.display)return;const y=yy(a.rtl,this.left,this.width),w=this.ctx,i=l.position,C=u.size/2,P=f.top+C;let D,$=this.left,G=this.width;if(this.isHorizontal())G=Math.max(...this.lineWidths),D=this.top+P,$=Zu(a.align,$,this.right-G);else{const te=this.columnSizes.reduce((le,re)=>Math.max(le,re.height),0);D=P+Zu(a.align,this.top,this.bottom-te-a.labels.padding-this._computeTitleHeight())}const X=Zu(i,$,$+G);w.textAlign=y.textAlign(uj(i)),w.textBaseline="middle",w.strokeStyle=l.color,w.fillStyle=l.color,w.font=u.string,Ob(w,l.text,X,D,u)}_computeTitleHeight(){const a=this.options.title,l=Su(a.font),u=kh(a.padding);return a.display?l.lineHeight+u.height:0}_getLegendItemAt(a,l){let u,f,y;if(my(a,this.left,this.right)&&my(l,this.top,this.bottom)){for(y=this.legendHitBoxes,u=0;u<y.length;++u)if(f=y[u],my(a,f.left,f.left+f.width)&&my(l,f.top,f.top+f.height))return this.legendItems[u]}return null}handleEvent(a){const l=this.options;if(!y6(a.type,l))return;const u=this._getLegendItemAt(a.x,a.y);if(a.type==="mousemove"||a.type==="mouseout"){const f=this._hoveredItem,y=m6(f,u);f&&!y&&Ms(l.onLeave,[a,f,this],this),this._hoveredItem=u,u&&!y&&Ms(l.onHover,[a,u,this],this)}else u&&Ms(l.onClick,[a,u,this],this)}}function p6(s,a,l,u,f){const y=g6(u,s,a,l),w=_6(f,u,a.lineHeight);return{itemWidth:y,itemHeight:w}}function g6(s,a,l,u){let f=s.text;return f&&typeof f!="string"&&(f=f.reduce((y,w)=>y.length>w.length?y:w)),a+l.size/2+u.measureText(f).width}function _6(s,a,l){let u=s;return typeof a.text!="string"&&(u=Fj(a,l)),u}function Fj(s,a){const l=s.text?s.text.length:0;return a*l}function y6(s,a){return!!((s==="mousemove"||s==="mouseout")&&(a.onHover||a.onLeave)||a.onClick&&(s==="click"||s==="mouseup"))}var Bj={id:"legend",_element:GC,start(s,a,l){const u=s.legend=new GC({ctx:s.ctx,options:l,chart:s});Fp.configure(s,u,l),Fp.addBox(s,u)},stop(s){Fp.removeBox(s,s.legend),delete s.legend},beforeUpdate(s,a,l){const u=s.legend;Fp.configure(s,u,l),u.options=l},afterUpdate(s){const a=s.legend;a.buildLabels(),a.adjustHitBoxes()},afterEvent(s,a){a.replay||s.legend.handleEvent(a.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(s,a,l){const u=a.datasetIndex,f=l.chart;f.isDatasetVisible(u)?(f.hide(u),a.hidden=!0):(f.show(u),a.hidden=!1)},onHover:null,onLeave:null,labels:{color:s=>s.chart.options.color,boxWidth:40,padding:10,generateLabels(s){const a=s.data.datasets,{labels:{usePointStyle:l,pointStyle:u,textAlign:f,color:y,useBorderRadius:w,borderRadius:i}}=s.legend.options;return s._getSortedDatasetMetas().map(C=>{const P=C.controller.getStyle(l?0:void 0),D=kh(P.borderWidth);return{text:a[C.index].label,fillStyle:P.backgroundColor,fontColor:y,hidden:!C.visible,lineCap:P.borderCapStyle,lineDash:P.borderDash,lineDashOffset:P.borderDashOffset,lineJoin:P.borderJoinStyle,lineWidth:(D.width+D.height)/4,strokeStyle:P.borderColor,pointStyle:u||P.pointStyle,rotation:P.rotation,textAlign:f||P.textAlign,borderRadius:w&&(i||P.borderRadius),datasetIndex:C.index}},this)}},title:{color:s=>s.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:s=>!s.startsWith("on"),labels:{_scriptable:s=>!["generateLabels","filter","sort"].includes(s)}}};const Kv={average(s){if(!s.length)return!1;let a,l,u=new Set,f=0,y=0;for(a=0,l=s.length;a<l;++a){const i=s[a].element;if(i&&i.hasValue()){const C=i.tooltipPosition();u.add(C.x),f+=C.y,++y}}return y===0||u.size===0?!1:{x:[...u].reduce((i,C)=>i+C)/u.size,y:f/y}},nearest(s,a){if(!s.length)return!1;let l=a.x,u=a.y,f=Number.POSITIVE_INFINITY,y,w,i;for(y=0,w=s.length;y<w;++y){const C=s[y].element;if(C&&C.hasValue()){const P=C.getCenterPoint(),D=OU(a,P);D<f&&(f=D,i=C)}}if(i){const C=i.tooltipPosition();l=C.x,u=C.y}return{x:l,y:u}}};function _f(s,a){return a&&(zl(a)?Array.prototype.push.apply(s,a):s.push(a)),s}function km(s){return(typeof s=="string"||s instanceof String)&&s.indexOf(`
`)>-1?s.split(`
`):s}function v6(s,a){const{element:l,datasetIndex:u,index:f}=a,y=s.getDatasetMeta(u).controller,{label:w,value:i}=y.getLabelAndValue(f);return{chart:s,label:w,parsed:y.getParsed(f),raw:s.data.datasets[u].data[f],formattedValue:i,dataset:y.getDataset(),dataIndex:f,datasetIndex:u,element:l}}function qC(s,a){const l=s.chart.ctx,{body:u,footer:f,title:y}=s,{boxWidth:w,boxHeight:i}=a,C=Su(a.bodyFont),P=Su(a.titleFont),D=Su(a.footerFont),$=y.length,G=f.length,X=u.length,te=kh(a.padding);let le=te.height,re=0,fe=u.reduce((Ne,Be)=>Ne+Be.before.length+Be.lines.length+Be.after.length,0);if(fe+=s.beforeBody.length+s.afterBody.length,$&&(le+=$*P.lineHeight+($-1)*a.titleSpacing+a.titleMarginBottom),fe){const Ne=a.displayColors?Math.max(i,C.lineHeight):C.lineHeight;le+=X*Ne+(fe-X)*C.lineHeight+(fe-1)*a.bodySpacing}G&&(le+=a.footerMarginTop+G*D.lineHeight+(G-1)*a.footerSpacing);let xe=0;const be=function(Ne){re=Math.max(re,l.measureText(Ne).width+xe)};return l.save(),l.font=P.string,Kr(s.title,be),l.font=C.string,Kr(s.beforeBody.concat(s.afterBody),be),xe=a.displayColors?w+2+a.boxPadding:0,Kr(u,Ne=>{Kr(Ne.before,be),Kr(Ne.lines,be),Kr(Ne.after,be)}),xe=0,l.font=D.string,Kr(s.footer,be),l.restore(),re+=te.width,{width:re,height:le}}function x6(s,a){const{y:l,height:u}=a;return l<u/2?"top":l>s.height-u/2?"bottom":"center"}function b6(s,a,l,u){const{x:f,width:y}=u,w=l.caretSize+l.caretPadding;if(s==="left"&&f+y+w>a.width||s==="right"&&f-y-w<0)return!0}function w6(s,a,l,u){const{x:f,width:y}=l,{width:w,chartArea:{left:i,right:C}}=s;let P="center";return u==="center"?P=f<=(i+C)/2?"left":"right":f<=y/2?P="left":f>=w-y/2&&(P="right"),b6(P,s,a,l)&&(P="center"),P}function WC(s,a,l){const u=l.yAlign||a.yAlign||x6(s,l);return{xAlign:l.xAlign||a.xAlign||w6(s,a,l,u),yAlign:u}}function S6(s,a){let{x:l,width:u}=s;return a==="right"?l-=u:a==="center"&&(l-=u/2),l}function T6(s,a,l){let{y:u,height:f}=s;return a==="top"?u+=l:a==="bottom"?u-=f+l:u-=f/2,u}function ZC(s,a,l,u){const{caretSize:f,caretPadding:y,cornerRadius:w}=s,{xAlign:i,yAlign:C}=l,P=f+y,{topLeft:D,topRight:$,bottomLeft:G,bottomRight:X}=_y(w);let te=S6(a,i);const le=T6(a,C,P);return C==="center"?i==="left"?te+=P:i==="right"&&(te-=P):i==="left"?te-=Math.max(D,G)+f:i==="right"&&(te+=Math.max($,X)+f),{x:Th(te,0,u.width-a.width),y:Th(le,0,u.height-a.height)}}function nb(s,a,l){const u=kh(l.padding);return a==="center"?s.x+s.width/2:a==="right"?s.x+s.width-u.right:s.x+u.left}function XC(s){return _f([],km(s))}function k6(s,a,l){return Cy(s,{tooltip:a,tooltipItems:l,type:"tooltip"})}function YC(s,a){const l=a&&a.dataset&&a.dataset.tooltip&&a.dataset.tooltip.callbacks;return l?s.override(l):s}const Uj={beforeTitle:vm,title(s){if(s.length>0){const a=s[0],l=a.chart.data.labels,u=l?l.length:0;if(this&&this.options&&this.options.mode==="dataset")return a.dataset.label||"";if(a.label)return a.label;if(u>0&&a.dataIndex<u)return l[a.dataIndex]}return""},afterTitle:vm,beforeBody:vm,beforeLabel:vm,label(s){if(this&&this.options&&this.options.mode==="dataset")return s.label+": "+s.formattedValue||s.formattedValue;let a=s.dataset.label||"";a&&(a+=": ");const l=s.formattedValue;return us(l)||(a+=l),a},labelColor(s){const l=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{borderColor:l.borderColor,backgroundColor:l.backgroundColor,borderWidth:l.borderWidth,borderDash:l.borderDash,borderDashOffset:l.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(s){const l=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{pointStyle:l.pointStyle,rotation:l.rotation}},afterLabel:vm,afterBody:vm,beforeFooter:vm,footer:vm,afterFooter:vm};function vu(s,a,l,u){const f=s[a].call(l,u);return typeof f>"u"?Uj[a].call(l,u):f}class KC extends Ex{static positioners=Kv;constructor(a){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=a.chart,this.options=a.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(a){this.options=a,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const a=this._cachedAnimations;if(a)return a;const l=this.chart,u=this.options.setContext(this.getContext()),f=u.enabled&&l.options.animation&&u.animations,y=new Tj(this.chart,f);return f._cacheable&&(this._cachedAnimations=Object.freeze(y)),y}getContext(){return this.$context||(this.$context=k6(this.chart.getContext(),this,this._tooltipItems))}getTitle(a,l){const{callbacks:u}=l,f=vu(u,"beforeTitle",this,a),y=vu(u,"title",this,a),w=vu(u,"afterTitle",this,a);let i=[];return i=_f(i,km(f)),i=_f(i,km(y)),i=_f(i,km(w)),i}getBeforeBody(a,l){return XC(vu(l.callbacks,"beforeBody",this,a))}getBody(a,l){const{callbacks:u}=l,f=[];return Kr(a,y=>{const w={before:[],lines:[],after:[]},i=YC(u,y);_f(w.before,km(vu(i,"beforeLabel",this,y))),_f(w.lines,vu(i,"label",this,y)),_f(w.after,km(vu(i,"afterLabel",this,y))),f.push(w)}),f}getAfterBody(a,l){return XC(vu(l.callbacks,"afterBody",this,a))}getFooter(a,l){const{callbacks:u}=l,f=vu(u,"beforeFooter",this,a),y=vu(u,"footer",this,a),w=vu(u,"afterFooter",this,a);let i=[];return i=_f(i,km(f)),i=_f(i,km(y)),i=_f(i,km(w)),i}_createItems(a){const l=this._active,u=this.chart.data,f=[],y=[],w=[];let i=[],C,P;for(C=0,P=l.length;C<P;++C)i.push(v6(this.chart,l[C]));return a.filter&&(i=i.filter((D,$,G)=>a.filter(D,$,G,u))),a.itemSort&&(i=i.sort((D,$)=>a.itemSort(D,$,u))),Kr(i,D=>{const $=YC(a.callbacks,D);f.push(vu($,"labelColor",this,D)),y.push(vu($,"labelPointStyle",this,D)),w.push(vu($,"labelTextColor",this,D))}),this.labelColors=f,this.labelPointStyles=y,this.labelTextColors=w,this.dataPoints=i,i}update(a,l){const u=this.options.setContext(this.getContext()),f=this._active;let y,w=[];if(!f.length)this.opacity!==0&&(y={opacity:0});else{const i=Kv[u.position].call(this,f,this._eventPosition);w=this._createItems(u),this.title=this.getTitle(w,u),this.beforeBody=this.getBeforeBody(w,u),this.body=this.getBody(w,u),this.afterBody=this.getAfterBody(w,u),this.footer=this.getFooter(w,u);const C=this._size=qC(this,u),P=Object.assign({},i,C),D=WC(this.chart,u,P),$=ZC(u,P,D,this.chart);this.xAlign=D.xAlign,this.yAlign=D.yAlign,y={opacity:1,x:$.x,y:$.y,width:C.width,height:C.height,caretX:i.x,caretY:i.y}}this._tooltipItems=w,this.$context=void 0,y&&this._resolveAnimations().update(this,y),a&&u.external&&u.external.call(this,{chart:this.chart,tooltip:this,replay:l})}drawCaret(a,l,u,f){const y=this.getCaretPosition(a,u,f);l.lineTo(y.x1,y.y1),l.lineTo(y.x2,y.y2),l.lineTo(y.x3,y.y3)}getCaretPosition(a,l,u){const{xAlign:f,yAlign:y}=this,{caretSize:w,cornerRadius:i}=u,{topLeft:C,topRight:P,bottomLeft:D,bottomRight:$}=_y(i),{x:G,y:X}=a,{width:te,height:le}=l;let re,fe,xe,be,Ne,Be;return y==="center"?(Ne=X+le/2,f==="left"?(re=G,fe=re-w,be=Ne+w,Be=Ne-w):(re=G+te,fe=re+w,be=Ne-w,Be=Ne+w),xe=re):(f==="left"?fe=G+Math.max(C,D)+w:f==="right"?fe=G+te-Math.max(P,$)-w:fe=this.caretX,y==="top"?(be=X,Ne=be-w,re=fe-w,xe=fe+w):(be=X+le,Ne=be+w,re=fe+w,xe=fe-w),Be=be),{x1:re,x2:fe,x3:xe,y1:be,y2:Ne,y3:Be}}drawTitle(a,l,u){const f=this.title,y=f.length;let w,i,C;if(y){const P=yy(u.rtl,this.x,this.width);for(a.x=nb(this,u.titleAlign,u),l.textAlign=P.textAlign(u.titleAlign),l.textBaseline="middle",w=Su(u.titleFont),i=u.titleSpacing,l.fillStyle=u.titleColor,l.font=w.string,C=0;C<y;++C)l.fillText(f[C],P.x(a.x),a.y+w.lineHeight/2),a.y+=w.lineHeight+i,C+1===y&&(a.y+=u.titleMarginBottom-i)}}_drawColorBox(a,l,u,f,y){const w=this.labelColors[u],i=this.labelPointStyles[u],{boxHeight:C,boxWidth:P}=y,D=Su(y.bodyFont),$=nb(this,"left",y),G=f.x($),X=C<D.lineHeight?(D.lineHeight-C)/2:0,te=l.y+X;if(y.usePointStyle){const le={radius:Math.min(P,C)/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:1},re=f.leftForLtr(G,P)+P/2,fe=te+C/2;a.strokeStyle=y.multiKeyBackground,a.fillStyle=y.multiKeyBackground,dC(a,le,re,fe),a.strokeStyle=w.borderColor,a.fillStyle=w.backgroundColor,dC(a,le,re,fe)}else{a.lineWidth=Rr(w.borderWidth)?Math.max(...Object.values(w.borderWidth)):w.borderWidth||1,a.strokeStyle=w.borderColor,a.setLineDash(w.borderDash||[]),a.lineDashOffset=w.borderDashOffset||0;const le=f.leftForLtr(G,P),re=f.leftForLtr(f.xPlus(G,1),P-2),fe=_y(w.borderRadius);Object.values(fe).some(xe=>xe!==0)?(a.beginPath(),a.fillStyle=y.multiKeyBackground,Nb(a,{x:le,y:te,w:P,h:C,radius:fe}),a.fill(),a.stroke(),a.fillStyle=w.backgroundColor,a.beginPath(),Nb(a,{x:re,y:te+1,w:P-2,h:C-2,radius:fe}),a.fill()):(a.fillStyle=y.multiKeyBackground,a.fillRect(le,te,P,C),a.strokeRect(le,te,P,C),a.fillStyle=w.backgroundColor,a.fillRect(re,te+1,P-2,C-2))}a.fillStyle=this.labelTextColors[u]}drawBody(a,l,u){const{body:f}=this,{bodySpacing:y,bodyAlign:w,displayColors:i,boxHeight:C,boxWidth:P,boxPadding:D}=u,$=Su(u.bodyFont);let G=$.lineHeight,X=0;const te=yy(u.rtl,this.x,this.width),le=function(at){l.fillText(at,te.x(a.x+X),a.y+G/2),a.y+=G+y},re=te.textAlign(w);let fe,xe,be,Ne,Be,Ee,et;for(l.textAlign=w,l.textBaseline="middle",l.font=$.string,a.x=nb(this,re,u),l.fillStyle=u.bodyColor,Kr(this.beforeBody,le),X=i&&re!=="right"?w==="center"?P/2+D:P+2+D:0,Ne=0,Ee=f.length;Ne<Ee;++Ne){for(fe=f[Ne],xe=this.labelTextColors[Ne],l.fillStyle=xe,Kr(fe.before,le),be=fe.lines,i&&be.length&&(this._drawColorBox(l,a,Ne,te,u),G=Math.max($.lineHeight,C)),Be=0,et=be.length;Be<et;++Be)le(be[Be]),G=$.lineHeight;Kr(fe.after,le)}X=0,G=$.lineHeight,Kr(this.afterBody,le),a.y-=y}drawFooter(a,l,u){const f=this.footer,y=f.length;let w,i;if(y){const C=yy(u.rtl,this.x,this.width);for(a.x=nb(this,u.footerAlign,u),a.y+=u.footerMarginTop,l.textAlign=C.textAlign(u.footerAlign),l.textBaseline="middle",w=Su(u.footerFont),l.fillStyle=u.footerColor,l.font=w.string,i=0;i<y;++i)l.fillText(f[i],C.x(a.x),a.y+w.lineHeight/2),a.y+=w.lineHeight+u.footerSpacing}}drawBackground(a,l,u,f){const{xAlign:y,yAlign:w}=this,{x:i,y:C}=a,{width:P,height:D}=u,{topLeft:$,topRight:G,bottomLeft:X,bottomRight:te}=_y(f.cornerRadius);l.fillStyle=f.backgroundColor,l.strokeStyle=f.borderColor,l.lineWidth=f.borderWidth,l.beginPath(),l.moveTo(i+$,C),w==="top"&&this.drawCaret(a,l,u,f),l.lineTo(i+P-G,C),l.quadraticCurveTo(i+P,C,i+P,C+G),w==="center"&&y==="right"&&this.drawCaret(a,l,u,f),l.lineTo(i+P,C+D-te),l.quadraticCurveTo(i+P,C+D,i+P-te,C+D),w==="bottom"&&this.drawCaret(a,l,u,f),l.lineTo(i+X,C+D),l.quadraticCurveTo(i,C+D,i,C+D-X),w==="center"&&y==="left"&&this.drawCaret(a,l,u,f),l.lineTo(i,C+$),l.quadraticCurveTo(i,C,i+$,C),l.closePath(),l.fill(),f.borderWidth>0&&l.stroke()}_updateAnimationTarget(a){const l=this.chart,u=this.$animations,f=u&&u.x,y=u&&u.y;if(f||y){const w=Kv[a.position].call(this,this._active,this._eventPosition);if(!w)return;const i=this._size=qC(this,a),C=Object.assign({},w,this._size),P=WC(l,a,C),D=ZC(a,C,P,l);(f._to!==D.x||y._to!==D.y)&&(this.xAlign=P.xAlign,this.yAlign=P.yAlign,this.width=i.width,this.height=i.height,this.caretX=w.x,this.caretY=w.y,this._resolveAnimations().update(this,D))}}_willRender(){return!!this.opacity}draw(a){const l=this.options.setContext(this.getContext());let u=this.opacity;if(!u)return;this._updateAnimationTarget(l);const f={width:this.width,height:this.height},y={x:this.x,y:this.y};u=Math.abs(u)<.001?0:u;const w=kh(l.padding),i=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;l.enabled&&i&&(a.save(),a.globalAlpha=u,this.drawBackground(y,a,f,l),wj(a,l.textDirection),y.y+=w.top,this.drawTitle(y,a,l),this.drawBody(y,a,l),this.drawFooter(y,a,l),Sj(a,l.textDirection),a.restore())}getActiveElements(){return this._active||[]}setActiveElements(a,l){const u=this._active,f=a.map(({datasetIndex:i,index:C})=>{const P=this.chart.getDatasetMeta(i);if(!P)throw new Error("Cannot find a dataset at index "+i);return{datasetIndex:i,element:P.data[C],index:C}}),y=!Lb(u,f),w=this._positionChanged(f,l);(y||w)&&(this._active=f,this._eventPosition=l,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(a,l,u=!0){if(l&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const f=this.options,y=this._active||[],w=this._getActiveElements(a,y,l,u),i=this._positionChanged(w,a),C=l||!Lb(w,y)||i;return C&&(this._active=w,(f.enabled||f.external)&&(this._eventPosition={x:a.x,y:a.y},this.update(!0,l))),C}_getActiveElements(a,l,u,f){const y=this.options;if(a.type==="mouseout")return[];if(!f)return l.filter(i=>this.chart.data.datasets[i.datasetIndex]&&this.chart.getDatasetMeta(i.datasetIndex).controller.getParsed(i.index)!==void 0);const w=this.chart.getElementsAtEventForMode(a,y.mode,y,u);return y.reverse&&w.reverse(),w}_positionChanged(a,l){const{caretX:u,caretY:f,options:y}=this,w=Kv[y.position].call(this,a,l);return w!==!1&&(u!==w.x||f!==w.y)}}var $j={id:"tooltip",_element:KC,positioners:Kv,afterInit(s,a,l){l&&(s.tooltip=new KC({chart:s,options:l}))},beforeUpdate(s,a,l){s.tooltip&&s.tooltip.initialize(l)},reset(s,a,l){s.tooltip&&s.tooltip.initialize(l)},afterDraw(s){const a=s.tooltip;if(a&&a._willRender()){const l={tooltip:a};if(s.notifyPlugins("beforeTooltipDraw",{...l,cancelable:!0})===!1)return;a.draw(s.ctx),s.notifyPlugins("afterTooltipDraw",l)}},afterEvent(s,a){if(s.tooltip){const l=a.replay;s.tooltip.handleEvent(a.event,l,a.inChartArea)&&(a.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(s,a)=>a.bodyFont.size,boxWidth:(s,a)=>a.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Uj},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:s=>s!=="filter"&&s!=="itemSort"&&s!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const E6=(s,a,l,u)=>(typeof a=="string"?(l=s.push(a)-1,u.unshift({index:l,label:a})):isNaN(a)&&(l=null),l);function A6(s,a,l,u){const f=s.indexOf(a);if(f===-1)return E6(s,a,l,u);const y=s.lastIndexOf(a);return f!==y?l:f}const C6=(s,a)=>s===null?null:Th(Math.round(s),0,a);function JC(s){const a=this.getLabels();return s>=0&&s<a.length?a[s]:s}class Vj extends My{static id="category";static defaults={ticks:{callback:JC}};constructor(a){super(a),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(a){const l=this._addedLabels;if(l.length){const u=this.getLabels();for(const{index:f,label:y}of l)u[f]===y&&u.splice(f,1);this._addedLabels=[]}super.init(a)}parse(a,l){if(us(a))return null;const u=this.getLabels();return l=isFinite(l)&&u[l]===a?l:A6(u,a,Br(l,a),this._addedLabels),C6(l,u.length-1)}determineDataLimits(){const{minDefined:a,maxDefined:l}=this.getUserBounds();let{min:u,max:f}=this.getMinMax(!0);this.options.bounds==="ticks"&&(a||(u=0),l||(f=this.getLabels().length-1)),this.min=u,this.max=f}buildTicks(){const a=this.min,l=this.max,u=this.options.offset,f=[];let y=this.getLabels();y=a===0&&l===y.length-1?y:y.slice(a,l+1),this._valueRange=Math.max(y.length-(u?0:1),1),this._startValue=this.min-(u?.5:0);for(let w=a;w<=l;w++)f.push({value:w});return f}getLabelForValue(a){return JC.call(this,a)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(a){return typeof a!="number"&&(a=this.parse(a)),a===null?NaN:this.getPixelForDecimal((a-this._startValue)/this._valueRange)}getPixelForTick(a){const l=this.ticks;return a<0||a>l.length-1?null:this.getPixelForValue(l[a].value)}getValueForPixel(a){return Math.round(this._startValue+this.getDecimalForPixel(a)*this._valueRange)}getBasePixel(){return this.bottom}}function M6(s,a){const l=[],{bounds:f,step:y,min:w,max:i,precision:C,count:P,maxTicks:D,maxDigits:$,includeBounds:G}=s,X=y||1,te=D-1,{min:le,max:re}=a,fe=!us(w),xe=!us(i),be=!us(P),Ne=(re-le)/($+1);let Be=iC((re-le)/te/X)*X,Ee,et,at,He;if(Be<1e-14&&!fe&&!xe)return[{value:le},{value:re}];He=Math.ceil(re/Be)-Math.floor(le/Be),He>te&&(Be=iC(He*Be/te/X)*X),us(C)||(Ee=Math.pow(10,C),Be=Math.ceil(Be*Ee)/Ee),f==="ticks"?(et=Math.floor(le/Be)*Be,at=Math.ceil(re/Be)*Be):(et=le,at=re),fe&&xe&&y&&LU((i-w)/y,Be/1e3)?(He=Math.round(Math.min((i-w)/Be,D)),Be=(i-w)/He,et=w,at=i):be?(et=fe?w:et,at=xe?i:at,He=P-1,Be=(at-et)/He):(He=(at-et)/Be,gb(He,Math.round(He),Be/1e3)?He=Math.round(He):He=Math.ceil(He));const lt=Math.max(nC(Be),nC(et));Ee=Math.pow(10,us(C)?lt:C),et=Math.round(et*Ee)/Ee,at=Math.round(at*Ee)/Ee;let pt=0;for(fe&&(G&&et!==w?(l.push({value:w}),et<w&&pt++,gb(Math.round((et+pt*Be)*Ee)/Ee,w,QC(w,Ne,s))&&pt++):et<w&&pt++);pt<He;++pt){const Zt=Math.round((et+pt*Be)*Ee)/Ee;if(xe&&Zt>i)break;l.push({value:Zt})}return xe&&G&&at!==i?l.length&&gb(l[l.length-1].value,i,QC(i,Ne,s))?l[l.length-1].value=i:l.push({value:i}):(!xe||at===i)&&l.push({value:at}),l}function QC(s,a,{horizontal:l,minRotation:u}){const f=Kg(u),y=(l?Math.sin(f):Math.cos(f))||.001,w=.75*a*(""+s).length;return Math.min(a/y,w)}class P6 extends My{constructor(a){super(a),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(a,l){return us(a)||(typeof a=="number"||a instanceof Number)&&!isFinite(+a)?null:+a}handleTickRangeOptions(){const{beginAtZero:a}=this.options,{minDefined:l,maxDefined:u}=this.getUserBounds();let{min:f,max:y}=this;const w=C=>f=l?f:C,i=C=>y=u?y:C;if(a){const C=Hp(f),P=Hp(y);C<0&&P<0?i(0):C>0&&P>0&&w(0)}if(f===y){let C=y===0?1:Math.abs(y*.05);i(y+C),a||w(f-C)}this.min=f,this.max=y}getTickLimit(){const a=this.options.ticks;let{maxTicksLimit:l,stepSize:u}=a,f;return u?(f=Math.ceil(this.max/u)-Math.floor(this.min/u)+1,f>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${u} would result generating up to ${f} ticks. Limiting to 1000.`),f=1e3)):(f=this.computeTickLimit(),l=l||11),l&&(f=Math.min(l,f)),f}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const a=this.options,l=a.ticks;let u=this.getTickLimit();u=Math.max(2,u);const f={maxTicks:u,bounds:a.bounds,min:a.min,max:a.max,precision:l.precision,step:l.stepSize,count:l.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:l.minRotation||0,includeBounds:l.includeBounds!==!1},y=this._range||this,w=M6(f,y);return a.bounds==="ticks"&&IU(w,this,"value"),a.reverse?(w.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),w}configure(){const a=this.ticks;let l=this.min,u=this.max;if(super.configure(),this.options.offset&&a.length){const f=(u-l)/Math.max(a.length-1,1)/2;l-=f,u+=f}this._startValue=l,this._endValue=u,this._valueRange=u-l}getLabelForValue(a){return hj(a,this.chart.options.locale,this.options.ticks.format)}}class Hj extends P6{static id="linear";static defaults={ticks:{callback:fj.formatters.numeric}};determineDataLimits(){const{min:a,max:l}=this.getMinMax(!0);this.min=Bd(a)?a:0,this.max=Bd(l)?l:1,this.handleTickRangeOptions()}computeTickLimit(){const a=this.isHorizontal(),l=a?this.width:this.height,u=Kg(this.options.ticks.minRotation),f=(a?Math.sin(u):Math.cos(u))||.001,y=this._resolveTickFontOptions(0);return Math.ceil(l/Math.min(40,y.lineHeight/f))}getPixelForValue(a){return a===null?NaN:this.getPixelForDecimal((a-this._startValue)/this._valueRange)}getValueForPixel(a){return this._startValue+this.getDecimalForPixel(a)*this._valueRange}}const Xb={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},wu=Object.keys(Xb);function eM(s,a){return s-a}function tM(s,a){if(us(a))return null;const l=s._adapter,{parser:u,round:f,isoWeekday:y}=s._parseOpts;let w=a;return typeof u=="function"&&(w=u(w)),Bd(w)||(w=typeof u=="string"?l.parse(w,u):l.parse(w)),w===null?null:(f&&(w=f==="week"&&(Db(y)||y===!0)?l.startOf(w,"isoWeek",y):l.startOf(w,f)),+w)}function iM(s,a,l,u){const f=wu.length;for(let y=wu.indexOf(s);y<f-1;++y){const w=Xb[wu[y]],i=w.steps?w.steps:Number.MAX_SAFE_INTEGER;if(w.common&&Math.ceil((l-a)/(i*w.size))<=u)return wu[y]}return wu[f-1]}function j6(s,a,l,u,f){for(let y=wu.length-1;y>=wu.indexOf(l);y--){const w=wu[y];if(Xb[w].common&&s._adapter.diff(f,u,w)>=a-1)return w}return wu[l?wu.indexOf(l):0]}function R6(s){for(let a=wu.indexOf(s)+1,l=wu.length;a<l;++a)if(Xb[wu[a]].common)return wu[a]}function nM(s,a,l){if(!l)s[a]=!0;else if(l.length){const{lo:u,hi:f}=a2(l,a),y=l[u]>=a?l[u]:l[f];s[y]=!0}}function L6(s,a,l,u){const f=s._adapter,y=+f.startOf(a[0].value,u),w=a[a.length-1].value;let i,C;for(i=y;i<=w;i=+f.add(i,1,u))C=l[i],C>=0&&(a[C].major=!0);return a}function aM(s,a,l){const u=[],f={},y=a.length;let w,i;for(w=0;w<y;++w)i=a[w],f[i]=w,u.push({value:i,major:!1});return y===0||!l?u:L6(s,u,f,l)}class rM extends My{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(a){super(a),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(a,l={}){const u=a.time||(a.time={}),f=this._adapter=new eV._date(a.adapters.date);f.init(l),nx(u.displayFormats,f.formats()),this._parseOpts={parser:u.parser,round:u.round,isoWeekday:u.isoWeekday},super.init(a),this._normalized=l.normalized}parse(a,l){return a===void 0?null:tM(this,a)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const a=this.options,l=this._adapter,u=a.time.unit||"day";let{min:f,max:y,minDefined:w,maxDefined:i}=this.getUserBounds();function C(P){!w&&!isNaN(P.min)&&(f=Math.min(f,P.min)),!i&&!isNaN(P.max)&&(y=Math.max(y,P.max))}(!w||!i)&&(C(this._getLabelBounds()),(a.bounds!=="ticks"||a.ticks.source!=="labels")&&C(this.getMinMax(!1))),f=Bd(f)&&!isNaN(f)?f:+l.startOf(Date.now(),u),y=Bd(y)&&!isNaN(y)?y:+l.endOf(Date.now(),u)+1,this.min=Math.min(f,y-1),this.max=Math.max(f+1,y)}_getLabelBounds(){const a=this.getLabelTimestamps();let l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;return a.length&&(l=a[0],u=a[a.length-1]),{min:l,max:u}}buildTicks(){const a=this.options,l=a.time,u=a.ticks,f=u.source==="labels"?this.getLabelTimestamps():this._generate();a.bounds==="ticks"&&f.length&&(this.min=this._userMin||f[0],this.max=this._userMax||f[f.length-1]);const y=this.min,w=this.max,i=UU(f,y,w);return this._unit=l.unit||(u.autoSkip?iM(l.minUnit,this.min,this.max,this._getLabelCapacity(y)):j6(this,i.length,l.minUnit,this.min,this.max)),this._majorUnit=!u.major.enabled||this._unit==="year"?void 0:R6(this._unit),this.initOffsets(f),a.reverse&&i.reverse(),aM(this,i,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(a=>+a.value))}initOffsets(a=[]){let l=0,u=0,f,y;this.options.offset&&a.length&&(f=this.getDecimalForValue(a[0]),a.length===1?l=1-f:l=(this.getDecimalForValue(a[1])-f)/2,y=this.getDecimalForValue(a[a.length-1]),a.length===1?u=y:u=(y-this.getDecimalForValue(a[a.length-2]))/2);const w=a.length<3?.5:.25;l=Th(l,0,w),u=Th(u,0,w),this._offsets={start:l,end:u,factor:1/(l+1+u)}}_generate(){const a=this._adapter,l=this.min,u=this.max,f=this.options,y=f.time,w=y.unit||iM(y.minUnit,l,u,this._getLabelCapacity(l)),i=Br(f.ticks.stepSize,1),C=w==="week"?y.isoWeekday:!1,P=Db(C)||C===!0,D={};let $=l,G,X;if(P&&($=+a.startOf($,"isoWeek",C)),$=+a.startOf($,P?"day":w),a.diff(u,l,w)>1e5*i)throw new Error(l+" and "+u+" are too far apart with stepSize of "+i+" "+w);const te=f.ticks.source==="data"&&this.getDataTimestamps();for(G=$,X=0;G<u;G=+a.add(G,i,w),X++)nM(D,G,te);return(G===u||f.bounds==="ticks"||X===1)&&nM(D,G,te),Object.keys(D).sort(eM).map(le=>+le)}getLabelForValue(a){const l=this._adapter,u=this.options.time;return u.tooltipFormat?l.format(a,u.tooltipFormat):l.format(a,u.displayFormats.datetime)}format(a,l){const f=this.options.time.displayFormats,y=this._unit,w=l||f[y];return this._adapter.format(a,w)}_tickFormatFunction(a,l,u,f){const y=this.options,w=y.ticks.callback;if(w)return Ms(w,[a,l,u],this);const i=y.time.displayFormats,C=this._unit,P=this._majorUnit,D=C&&i[C],$=P&&i[P],G=u[l],X=P&&$&&G&&G.major;return this._adapter.format(a,f||(X?$:D))}generateTickLabels(a){let l,u,f;for(l=0,u=a.length;l<u;++l)f=a[l],f.label=this._tickFormatFunction(f.value,l,a)}getDecimalForValue(a){return a===null?NaN:(a-this.min)/(this.max-this.min)}getPixelForValue(a){const l=this._offsets,u=this.getDecimalForValue(a);return this.getPixelForDecimal((l.start+u)*l.factor)}getValueForPixel(a){const l=this._offsets,u=this.getDecimalForPixel(a)/l.factor-l.end;return this.min+u*(this.max-this.min)}_getLabelSize(a){const l=this.options.ticks,u=this.ctx.measureText(a).width,f=Kg(this.isHorizontal()?l.maxRotation:l.minRotation),y=Math.cos(f),w=Math.sin(f),i=this._resolveTickFontOptions(0).size;return{w:u*y+i*w,h:u*w+i*y}}_getLabelCapacity(a){const l=this.options.time,u=l.displayFormats,f=u[l.unit]||u.millisecond,y=this._tickFormatFunction(a,0,aM(this,[a],this._majorUnit),f),w=this._getLabelSize(y),i=Math.floor(this.isHorizontal()?this.width/w.w:this.height/w.h)-1;return i>0?i:1}getDataTimestamps(){let a=this._cache.data||[],l,u;if(a.length)return a;const f=this.getMatchingVisibleMetas();if(this._normalized&&f.length)return this._cache.data=f[0].controller.getAllParsedValues(this);for(l=0,u=f.length;l<u;++l)a=a.concat(f[l].controller.getAllParsedValues(this));return this._cache.data=this.normalize(a)}getLabelTimestamps(){const a=this._cache.labels||[];let l,u;if(a.length)return a;const f=this.getLabels();for(l=0,u=f.length;l<u;++l)a.push(tM(this,f[l]));return this._cache.labels=this._normalized?a:this.normalize(a)}normalize(a){return oj(a.sort(eM))}}function ab(s,a,l){let u=0,f=s.length-1,y,w,i,C;l?(a>=s[u].pos&&a<=s[f].pos&&({lo:u,hi:f}=AS(s,"pos",a)),{pos:y,time:i}=s[u],{pos:w,time:C}=s[f]):(a>=s[u].time&&a<=s[f].time&&({lo:u,hi:f}=AS(s,"time",a)),{time:y,pos:i}=s[u],{time:w,pos:C}=s[f]);const P=w-y;return P?i+(C-i)*(a-y)/P:i}class c8 extends rM{static id="timeseries";static defaults=rM.defaults;constructor(a){super(a),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const a=this._getTimestampsForTable(),l=this._table=this.buildLookupTable(a);this._minPos=ab(l,this.min),this._tableRange=ab(l,this.max)-this._minPos,super.initOffsets(a)}buildLookupTable(a){const{min:l,max:u}=this,f=[],y=[];let w,i,C,P,D;for(w=0,i=a.length;w<i;++w)P=a[w],P>=l&&P<=u&&f.push(P);if(f.length<2)return[{time:l,pos:0},{time:u,pos:1}];for(w=0,i=f.length;w<i;++w)D=f[w+1],C=f[w-1],P=f[w],Math.round((D+C)/2)!==P&&y.push({time:P,pos:w/(i-1)});return y}_generate(){const a=this.min,l=this.max;let u=super.getDataTimestamps();return(!u.includes(a)||!u.length)&&u.splice(0,0,a),(!u.includes(l)||u.length===1)&&u.push(l),u.sort((f,y)=>f-y)}_getTimestampsForTable(){let a=this._cache.all||[];if(a.length)return a;const l=this.getDataTimestamps(),u=this.getLabelTimestamps();return l.length&&u.length?a=this.normalize(l.concat(u)):a=l.length?l:u,a=this._cache.all=a,a}getDecimalForValue(a){return(ab(this._table,a)-this._minPos)/this._tableRange}getValueForPixel(a){const l=this._offsets,u=this.getDecimalForPixel(a)/l.factor-l.end;return ab(this._table,u*this._tableRange+this._minPos,!0)}}const Gj="label";function sM(s,a){typeof s=="function"?s(a):s&&(s.current=a)}function I6(s,a){const l=s.options;l&&a&&Object.assign(l,a)}function qj(s,a){s.labels=a}function Wj(s,a,l=Gj){const u=[];s.datasets=a.map(f=>{const y=s.datasets.find(w=>w[l]===f[l]);return!y||!f.data||u.includes(y)?{...f}:(u.push(y),Object.assign(y,f),y)})}function z6(s,a=Gj){const l={labels:[],datasets:[]};return qj(l,s.labels),Wj(l,s.datasets,a),l}function D6(s,a){const{height:l=150,width:u=300,redraw:f=!1,datasetIdKey:y,type:w,data:i,options:C,plugins:P=[],fallbackContent:D,updateMode:$,...G}=s,X=pe.useRef(null),te=pe.useRef(null),le=()=>{X.current&&(te.current=new Ax(X.current,{type:w,data:z6(i,y),options:C&&{...C},plugins:P}),sM(a,te.current))},re=()=>{sM(a,null),te.current&&(te.current.destroy(),te.current=null)};return pe.useEffect(()=>{!f&&te.current&&C&&I6(te.current,C)},[f,C]),pe.useEffect(()=>{!f&&te.current&&qj(te.current.config.data,i.labels)},[f,i.labels]),pe.useEffect(()=>{!f&&te.current&&i.datasets&&Wj(te.current.config.data,i.datasets,y)},[f,i.datasets]),pe.useEffect(()=>{te.current&&(f?(re(),setTimeout(le)):te.current.update($))},[f,C,i.labels,i.datasets,$]),pe.useEffect(()=>{te.current&&(re(),setTimeout(le))},[w]),pe.useEffect(()=>(le(),()=>re()),[]),A.jsx("canvas",{ref:X,role:"img",height:l,width:u,...G,children:D})}const O6=pe.forwardRef(D6);function N6(s,a){return Ax.register(a),pe.forwardRef((l,u)=>A.jsx(O6,{...l,ref:u,type:s}))}const Zj=N6("bar",Q$);Ax.register(Vj,Hj,Nj,$j,Bj);const eS="/v1",F6=s=>{if(!s)return"-";const a=new Date(s);return`${a.getDate()}/${a.getMonth()+1}/${a.getFullYear()} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},B6=()=>{const s=new Date;return`${s.getDate()}/${s.getMonth()+1}/${s.getFullYear()} ${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}`},rb=s=>s||0;function Xj(s,a){const l={};return s.forEach(u=>{const f=a(u);l[f]=(l[f]||0)+1}),l}function Rp(s,a="hour"){return Xj(s,({created_at:l})=>{const u=new Date(l);return a==="hour"?u.getHours():a==="day"?u.getDay():a==="date"?u.toISOString().slice(0,10):a==="month"?u.getMonth()+1:a==="year"?u.getFullYear():"Unknown"})}const Dd={hour:Array.from({length:24},(s,a)=>`${a}:00`),day:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},Yj=({children:s,className:a})=>A.jsx("div",{className:`rounded-xl border border-gray-300 bg-white p-6 mb-8 shadow-none ${a}`,style:{pageBreakInside:"avoid"},children:s}),sb=({label:s,value:a,description:l})=>A.jsxs("div",{className:"flex flex-col items-center justify-center border border-gray-300 rounded-lg bg-white px-6 py-10",style:{height:"130px",minWidth:"170px",maxWidth:"220px"},children:[A.jsx("div",{className:"uppercase text-xs text-gray-500 font-medium mb-2 tracking-widest letter-spacing-wider",children:s}),A.jsx("div",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:a}),A.jsx("div",{className:"text-xs text-gray-500 font-normal text-center",children:l})]}),tS=({children:s})=>A.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-3 tracking-tight",style:{marginTop:"24px"},children:s}),uy=({labels:s,data:a,title:l,color:u})=>A.jsxs(Yj,{className:"p-4 mb-6",style:{width:"100%",maxWidth:"650px",margin:"0 auto",height:"220px",boxShadow:"none"},children:[A.jsx("h4",{className:"font-semibold text-md mb-3 text-gray-700",children:l}),A.jsx(Zj,{data:{labels:s,datasets:[{label:l,data:a,backgroundColor:u,borderRadius:8}]},options:{plugins:{legend:{display:!1}},responsive:!1,maintainAspectRatio:!1,layout:{padding:{top:10,bottom:10,left:0,right:0}},scales:{x:{ticks:{color:"#444",font:{size:12}},grid:{color:"#e5e5e5"}},y:{beginAtZero:!0,ticks:{stepSize:1,color:"#444",font:{size:12}}}}},width:650,height:145})]}),U6=()=>{const{market_id:s}=ul(),[a,l]=pe.useState(null),[u,f]=pe.useState([]),[y,w]=pe.useState(null);pe.useEffect(()=>{if(!s)return;const et=async()=>{try{const lt=await fetch(`${eS}/market/${s}/statistic`);if(!lt.ok)throw new Error("Failed to fetch statistic");const pt=await lt.json();l(pt)}catch(lt){console.error(lt)}},at=async()=>{try{const lt=await fetch(`${eS}/market/${s}/vendor`);if(!lt.ok)throw new Error("Failed to fetch vendors");const pt=await lt.json();f(pt)}catch(lt){console.error(lt)}};(async()=>{try{const lt=await fetch(`${eS}/market/${s}`);if(!lt.ok)throw new Error("Failed to fetch market detail");const pt=await lt.json();w(pt)}catch(lt){console.error(lt)}})(),et(),at()},[s]);const i=a?.market_history||[],C=a?.market_review||[],P=a?.market_click||[],D=pe.useMemo(()=>Rp(i,"hour"),[i]),$=pe.useMemo(()=>Rp(i,"day"),[i]),G=pe.useMemo(()=>Rp(i,"month"),[i]);pe.useMemo(()=>Rp(i,"year"),[i]);const X=pe.useMemo(()=>Rp(P,"hour"),[P]),te=pe.useMemo(()=>Rp(P,"day"),[P]),le=pe.useMemo(()=>Rp(P,"month"),[P]);pe.useMemo(()=>Rp(P,"year"),[P]);const re=C.length,fe=re>0?(C.reduce((et,at)=>et+Number(at.rating??0),0)/re).toFixed(2):"-",xe=pe.useMemo(()=>Xj(C,et=>et.rating??"-"),[C]);[...u].sort((et,at)=>at.avg_rating-et.avg_rating).slice(0,3);const be=a?.market_history?.length||0,Ne=a?.market_review?.length||0,Be=a?.market_content?.length||0,Ee=a?.market_click?.length||0;return A.jsxs("div",{className:"bg-white text-black",style:{fontFamily:"Inter, Arial, sans-serif",width:"210mm",minHeight:"297mm",margin:"0 auto",boxSizing:"border-box",padding:"36px 30px",background:"#fff"},children:[A.jsxs("div",{className:"mb-8 pb-2 border-b border-gray-200",children:[A.jsxs("div",{className:"flex flex-row items-end gap-2",children:[A.jsx("img",{src:"/tamulokal.png",className:"w-8"}),A.jsx("h1",{className:"text-xl font-bold font-inter",children:"TamuKinabalu"})]}),A.jsx("h1",{className:"text-4xl font-bold text-gray-900 pb-2",children:"Market Statistical Report"}),A.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1 leading-tight",children:y?.name||A.jsx("span",{className:"text-gray-400",children:"Market Name"})}),A.jsxs("div",{className:"flex flex-row justify-between items-center",children:[A.jsxs("div",{className:"text-sm text-gray-500",children:["Created at:"," ",y?.created_at?F6(y.created_at):"-"]}),A.jsxs("div",{className:"text-sm text-gray-500 text-right",children:["Generated on: ",B6()]})]})]}),A.jsxs("div",{className:"flex flex-row gap-6 mb-8",style:{pageBreakInside:"avoid",alignItems:"stretch",justifyContent:"center"},children:[A.jsx(sb,{label:"Total Visit",value:rb(be),description:"Unique individuals who visited this market."}),A.jsx(sb,{label:"Total Reviews",value:rb(Ne),description:"Total reviews submitted for this market."}),A.jsx(sb,{label:"Mentions",value:rb(Be),description:"Times the market was mentioned in platform posts."}),A.jsx(sb,{label:"Market Clicks",value:rb(Ee),description:"Users who clicked on the market profile."})]}),A.jsxs(Yj,{className:"mb-10",style:{maxWidth:"520px",margin:"0 auto"},children:[A.jsx(tS,{children:"Market Rating Summary"}),A.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[A.jsxs("div",{children:[A.jsxs("div",{className:"text-xl font-bold text-gray-800",children:[fe," ",A.jsx(Zo,{className:"inline mb-1 text-yellow-500"})]}),A.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:["Average Rating (",re," review",re===1?"":"s",")"]})]}),A.jsxs("div",{children:[A.jsx("div",{className:"flex gap-2",children:[5,4,3,2,1].map(et=>A.jsxs("div",{className:"flex flex-col items-center",children:[A.jsx("span",{className:"font-semibold text-gray-800",children:et}),A.jsx(Zo,{className:"text-yellow-500 mb-1"}),A.jsx("span",{className:"text-sm text-gray-500",children:xe[et]||0})]},et))}),A.jsx("div",{className:"text-xs text-gray-400 text-right mt-2",children:"Count per rating"})]})]})]}),A.jsxs(A.Fragment,{children:[A.jsx(tS,{children:"Market Visit Peak Times"}),A.jsx(uy,{labels:Dd.hour,data:Dd.hour.map((et,at)=>D[at]||0),title:"Visits by Hour",color:"#fb923c"}),A.jsx(uy,{labels:Dd.day,data:Dd.day.map((et,at)=>$[at]||0),title:"Visits by Day of Week",color:"#60a5fa"}),A.jsx(uy,{labels:Dd.month,data:Dd.month.map((et,at)=>G[at+1]||0),title:"Visits by Month",color:"#34d399"})]}),A.jsxs(A.Fragment,{children:[A.jsx(tS,{children:"Market Profile Click Peak Times"}),A.jsx(uy,{labels:Dd.hour,data:Dd.hour.map((et,at)=>X[at]||0),title:"Profile Clicks by Hour",color:"#fbbf24"}),A.jsx(uy,{labels:Dd.day,data:Dd.day.map((et,at)=>te[at]||0),title:"Profile Clicks by Day of Week",color:"#818cf8"}),A.jsx(uy,{labels:Dd.month,data:Dd.month.map((et,at)=>le[at+1]||0),title:"Profile Clicks by Month",color:"#67e8f9"})]})]})};Ax.register(Vj,Hj,Nj,$j,Bj);const oM="/v1",$6=s=>{if(!s)return"-";const a=new Date(s);return`${a.getDate()}/${a.getMonth()+1}/${a.getFullYear()} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},V6=()=>{const s=new Date;return`${s.getDate()}/${s.getMonth()+1}/${s.getFullYear()} ${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}`};function H6(s,a){const l={};return s.forEach(u=>{const f=a(u);l[f]=(l[f]||0)+1}),l}function xm(s,a="hour"){return H6(s,({created_at:l})=>{const u=new Date(l);return a==="hour"?u.getHours():a==="day"?u.getDay():a==="month"?u.getMonth()+1:"Unknown"})}const Ll={hour:Array.from({length:24},(s,a)=>`${a}:00`),day:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},G6=({children:s,className:a})=>A.jsx("div",{className:`rounded-xl border border-gray-300 bg-white p-6 mb-8 shadow-none ${a||""}`,style:{pageBreakInside:"avoid"},children:s}),iS=({label:s,value:a,description:l})=>A.jsxs("div",{className:"flex flex-col items-center justify-center border border-gray-300 rounded-lg bg-white px-6 py-10",style:{height:"130px",minWidth:"170px",maxWidth:"220px"},children:[A.jsx("div",{className:"uppercase text-xs text-gray-500 font-medium mb-2 tracking-widest letter-spacing-wider",children:s}),A.jsx("div",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:a}),A.jsx("div",{className:"text-xs text-gray-500 font-normal text-center",children:l})]}),ob=({children:s})=>A.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-3 tracking-tight",style:{marginTop:"24px"},children:s}),bm=({labels:s,data:a,title:l,color:u})=>A.jsxs(G6,{className:"p-4 mb-6",style:{width:"100%",maxWidth:"650px",margin:"0 auto",boxShadow:"none"},children:[A.jsx("h4",{className:"font-semibold text-md mb-3 text-gray-700",children:l}),A.jsx(Zj,{data:{labels:s,datasets:[{label:l,data:a,backgroundColor:u,borderRadius:8}]},options:{plugins:{legend:{display:!1}},responsive:!1,maintainAspectRatio:!1,layout:{padding:{top:10,bottom:10,left:0,right:0}},scales:{x:{ticks:{color:"#444",font:{size:12}},grid:{color:"#e5e5e5"}},y:{beginAtZero:!0,ticks:{stepSize:1,color:"#444",font:{size:12}}}}},width:650,height:145})]}),q6=({idx:s,product:a})=>A.jsxs("div",{className:`p-4 rounded-xl border-2 flex items-center gap-4 bg-white shadow mb-3 ${s===0?"border-yellow-300":s===1?"border-gray-300":"border-orange-200"}`,style:{minHeight:90},children:[A.jsx("div",{className:"font-bold text-2xl w-8 text-center flex-shrink-0",children:s+1}),a.image?A.jsx("img",{src:a.image,alt:a.name,className:"w-16 h-16 object-cover rounded-lg border border-gray-100",style:{background:"#f3f3f3"}}):A.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400",children:A.jsx(Zo,{className:"text-2xl"})}),A.jsxs("div",{className:"flex flex-col justify-center flex-1 min-w-0",children:[A.jsx("div",{className:"truncate font-semibold text-gray-900",children:a.name}),A.jsxs("div",{className:"flex items-center mt-1 text-yellow-500 font-medium text-base",children:[A.jsx(Zo,{className:"mr-1"}),a.avg_rating.toFixed(1)]})]})]}),W6=()=>{const[s,a]=pe.useState(null),[l,u]=pe.useState(null),{vendor_id:f}=ul();pe.useEffect(()=>{(async()=>{try{const Ee=await fetch(`${oM}/vendor/${f}/statistic`);Ee.ok&&a(await Ee.json());const et=await fetch(`${oM}/vendor/${f}`);et.ok&&u(await et.json())}catch(Ee){console.error(Ee)}})()},[]);const y=s?.profile_click||[],w=s?.account_follow||[],i=s?.products?.flatMap(Be=>(Be.reviews||[]).map(Ee=>({...Ee,product:Be.product})))||[],C=y.length,P=w.length;let D=0;if(s?.products?.length>0){const Be=s.products.map(Ee=>!Ee.reviews||Ee.reviews.length===0?null:Ee.reviews.reduce((at,He)=>at+He.rating,0)/Ee.reviews.length).filter(Boolean);Be.length>0&&(D=Be.reduce((Ee,et)=>Ee+et,0)/Be.length)}const $=pe.useMemo(()=>xm(i,"hour"),[i]),G=pe.useMemo(()=>xm(i,"day"),[i]),X=pe.useMemo(()=>xm(i,"month"),[i]),te=pe.useMemo(()=>xm(y,"hour"),[y]),le=pe.useMemo(()=>xm(y,"day"),[y]),re=pe.useMemo(()=>xm(y,"month"),[y]),fe=pe.useMemo(()=>xm(w,"hour"),[w]),xe=pe.useMemo(()=>xm(w,"day"),[w]),be=pe.useMemo(()=>xm(w,"month"),[w]),Ne=pe.useMemo(()=>s?.products?.map(Be=>{if(!Be.reviews||Be.reviews.length===0)return null;const Ee=Be.reviews.reduce((et,at)=>et+at.rating,0)/Be.reviews.length;return{...Be.product,avg_rating:Ee,image:Be.product?.image}}).filter(Boolean).sort((Be,Ee)=>Ee.avg_rating-Be.avg_rating).slice(0,3)||[],[s]);return A.jsxs("div",{className:"bg-white text-black",style:{fontFamily:"Inter, Arial, sans-serif",width:"210mm",minHeight:"297mm",margin:"0 auto",boxSizing:"border-box",padding:"36px 30px",background:"#fff"},children:[A.jsxs("div",{className:"mb-8 pb-2 border-b border-gray-200",children:[A.jsxs("div",{className:"flex flex-row items-end gap-2",children:[A.jsx("img",{src:"/tamulokal.png",className:"w-8",alt:"TamuKinabalu Logo"}),A.jsx("h1",{className:"text-xl font-bold font-inter",children:"TamuKinabalu"})]}),A.jsx("h1",{className:"text-4xl font-bold text-gray-900 pb-2",children:"Vendor Statistical Report"}),A.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1 leading-tight",children:l?.fullname||A.jsx("span",{className:"text-gray-400",children:"Vendor Name"})}),A.jsxs("div",{className:"flex flex-row justify-between items-center",children:[A.jsxs("div",{className:"text-sm text-gray-500",children:["Joined: ",l?.created_at?$6(l.created_at):"-"]}),A.jsxs("div",{className:"text-sm text-gray-500 text-right",children:["Generated on: ",V6()]})]})]}),A.jsxs("div",{className:"flex flex-row gap-6 mb-8",style:{pageBreakInside:"avoid",alignItems:"stretch",justifyContent:"center"},children:[A.jsx(iS,{label:"Profile Clicks",value:C,description:"Total click counts on your profile"}),A.jsx(iS,{label:"Followers",value:P,description:"Current number of followers"}),A.jsx(iS,{label:"Review Score",value:D?D.toFixed(1):"-",description:"Overall average rating of your products"})]}),A.jsx(ob,{children:"Review Trends"}),A.jsx(bm,{labels:Ll.hour,data:Ll.hour.map((Be,Ee)=>$[Ee]||0),title:"Reviews by Hour",color:"#fb923c"}),A.jsx(bm,{labels:Ll.day,data:Ll.day.map((Be,Ee)=>G[Ee]||0),title:"Reviews by Day of Week",color:"#60a5fa"}),A.jsx(bm,{labels:Ll.month,data:Ll.month.map((Be,Ee)=>X[Ee+1]||0),title:"Reviews by Month",color:"#34d399"}),A.jsx(ob,{children:"Profile Click Trends"}),A.jsx(bm,{labels:Ll.hour,data:Ll.hour.map((Be,Ee)=>te[Ee]||0),title:"Profile Clicks by Hour",color:"#fbbf24"}),A.jsx(bm,{labels:Ll.day,data:Ll.day.map((Be,Ee)=>le[Ee]||0),title:"Profile Clicks by Day of Week",color:"#818cf8"}),A.jsx(bm,{labels:Ll.month,data:Ll.month.map((Be,Ee)=>re[Ee+1]||0),title:"Profile Clicks by Month",color:"#67e8f9"}),A.jsx(ob,{children:"Follower Trends"}),A.jsx(bm,{labels:Ll.hour,data:Ll.hour.map((Be,Ee)=>fe[Ee]||0),title:"Followers by Hour",color:"#a7f3d0"}),A.jsx(bm,{labels:Ll.day,data:Ll.day.map((Be,Ee)=>xe[Ee]||0),title:"Followers by Day of Week",color:"#f472b6"}),A.jsx(bm,{labels:Ll.month,data:Ll.month.map((Be,Ee)=>be[Ee+1]||0),title:"Followers by Month",color:"#f9fafb"}),Ne.length>0&&A.jsxs("div",{style:{marginTop:60},children:[A.jsx(ob,{children:"Top 3 Products"}),Ne.map((Be,Ee)=>A.jsx(q6,{idx:Ee,product:Be},Be.id))]})]})},lM="/v1",Z6=[{id:1,name:"Fresh Produce",emoji:""},{id:2,name:"Street Food",emoji:""},{id:3,name:"Snacks & Drinks",emoji:""},{id:4,name:"Clothing",emoji:""},{id:5,name:"Handicrafts",emoji:""},{id:6,name:"Fruits",emoji:""},{id:7,name:"Seafood",emoji:""},{id:8,name:"Performance",emoji:""}],cM=({isOwnProfile:s=!1})=>{const a=$c();console.log(s);const l=Ma(),{product_id:u}=ul(),[f,y]=pe.useState(null),[w,i]=pe.useState(!0);if(console.log(f),pe.useEffect(()=>{(async()=>{try{const te=await(await fetch(`${lM}/product/${u}`)).json();y(te)}catch(X){console.error("Failed to fetch product",X)}finally{i(!1)}})()},[u]),w)return A.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loading..."});if(!f||!f.product)return A.jsx("div",{className:"p-6 text-center text-red-500",children:"Product not found"});const{product:C,categories:P}=f,D=P.map(G=>Z6.find(X=>X.id===G.category_id)),$=async(G,X)=>{try{await fetch(`${lM}/product/${u}/review?id=${G}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({hide:X})}),y(te=>({...te,product:{...te.product,reviews:te.product.reviews.map(le=>le.id===G?{...le,hide:X}:le)}}))}catch(te){console.error("Failed to update review visibility",te),alert("Failed to update review visibility")}};return A.jsxs("div",{className:"relative w-full h-screen",children:[A.jsx(hc,{title:C.name}),A.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[A.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:A.jsxs("div",{className:"flex flex-col md:flex-row",children:[A.jsx("div",{className:"w-full md:w-1/4 aspect-square flex-shrink-0",children:A.jsx("img",{src:C.image||"/default-product.png",alt:C.name,className:"w-full h-full object-cover"})}),A.jsxs("div",{className:"p-4 space-y-2 flex-1",children:[A.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:C.name}),A.jsxs("p",{className:"text-lg font-bold text-[#FF8225]",children:["RM ",C.price]}),A.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:D.map(G=>G&&A.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded-full",children:[G.emoji," ",G.name]},G.id))})]})]})}),A.jsxs("div",{className:"space-y-4",children:[A.jsxs("div",{className:"flex justify-between items-center",children:[A.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Customer Reviews"}),A.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[A.jsx(Zo,{className:"text-yellow-500",size:16}),C.reviews.length>0?A.jsxs("span",{className:"text-gray-700 font-medium",children:[(C.reviews.reduce((G,X)=>G+X.rating,0)/C.reviews.length).toFixed(1)," ","(",C.reviews.length," reviews)"]}):A.jsx("span",{className:"text-gray-500",children:"No reviews yet"})]})]}),C.reviews.length===0?A.jsx("div",{className:"text-sm text-gray-500",children:"No reviews yet for this product."}):C.reviews.filter(G=>!G.hide||s).map(G=>A.jsxs("div",{className:`relative rounded-lg p-4 pr-12 space-y-3 shadow-sm
  ${G.hide?"bg-gray-50 border border-dashed border-gray-300 opacity-80":"bg-white"}`,children:[s&&A.jsx("button",{onClick:()=>$(G.id,!G.hide),className:"absolute top-3 right-3 bg-white p-1.5 rounded-full shadow hover:bg-gray-100 transition",title:G.hide?"Unhide review":"Hide review",children:G.hide?A.jsx($S,{className:"text-red-500",size:18}):A.jsx(wx,{className:"text-green-600",size:18})}),s&&G.hide&&A.jsx("span",{className:"absolute top-3 right-12 text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:"Hidden"}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("img",{src:G.visitor_image||"/default-avatar.png",alt:G.visitor_fullname||G.visitor_username||"Visitor",className:"w-10 h-10 object-cover rounded-full"}),A.jsxs("div",{className:"flex flex-col text-sm",children:[A.jsx("span",{className:"font-medium text-gray-800",children:G.visitor_fullname||"Anonymous"}),G.visitor_username&&A.jsxs("span",{className:"text-gray-500",children:["@",G.visitor_username]})]}),A.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[A.jsx(Zo,{className:"text-yellow-500",size:14}),A.jsxs("span",{className:"font-medium text-gray-700",children:[G.rating,".0"]})]})]}),A.jsx("p",{className:"text-gray-700 text-sm",children:G.review}),G.image&&A.jsx("img",{src:G.image,alt:"Review",className:"w-24 h-24 object-cover rounded"}),A.jsx("p",{className:"text-xs text-gray-400",children:new Date(G.created_at).toLocaleDateString()})]},G.id)),!s&&A.jsx("div",{className:"mt-4",children:A.jsx("button",{onClick:()=>l(`${a.pathname}/review`),className:"w-full bg-[#FF8225] text-white px-4 py-3 rounded-lg shadow hover:bg-orange-600 transition text-center font-medium",children:"Leave a review"})})]})]})]})},lb="/v1",uM=250,X6=({product_id:s,review_id:a})=>{const u=Lr(!0)?.user?.id,[f,y]=pe.useState(0),[w,i]=pe.useState(""),[C,P]=pe.useState(null),[D,$]=pe.useState(null),[G,X]=pe.useState(!1),te=a!=null&&s==null;pe.useEffect(()=>{if(!u||!te)return;(async()=>{try{const Ne=await fetch(`${lb}/visitor/${u}/product-review?id=${a}`);if(!Ne.ok)return;const Be=await Ne.json();y(Be.rating),i(Be.review),$(Be.image||null)}catch(Ne){console.error("Failed to fetch review",Ne)}})()},[u,a,te]);const le=be=>{const Ne=be.target.files[0];Ne&&(P(Ne),$(URL.createObjectURL(Ne)))},re=async be=>{try{const Ne=await be.json();return Ne?.id||Ne?.review_id||Ne?.data?.id||Ne?.data?.review_id}catch{return null}},fe=async be=>{if(be.preventDefault(),!(!f||!w)){X(!0);try{let Ne=a;if(te){if(!(await fetch(`${lb}/visitor/${u}/product-review?id=${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:f,review:w})})).ok)throw new Error("Failed to update review")}else{const Be=await fetch(`${lb}/product/${s}/review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:u,rating:f,review:w})});if(!Be.ok)throw new Error("Failed to create review");Ne=await re(Be)}if(C&&Ne){const Be=await createImageBitmap(C),Ee=document.createElement("canvas");Ee.width=Be.width,Ee.height=Be.height,Ee.getContext("2d").drawImage(Be,0,0);const at=await new Promise(jt=>Ee.toBlob(jt,"image/jpeg",.9)),He=`product-reviews/${s}/${Ne}.jpg`,{error:lt}=await Vs.storage.from("tamulokal").upload(He,at,{upsert:!0,contentType:"image/jpeg"});if(lt)throw lt;const{data:pt}=Vs.storage.from("tamulokal").getPublicUrl(He),Zt=`${pt.publicUrl}?t=${new Date().getTime()}`;await fetch(`${lb}/visitor/${u}/product-review?id=${Ne}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:Zt})})}}catch(Ne){console.error("Failed to submit review",Ne)}finally{X(!1)}}},xe=w.length>uM?"text-red-500":"text-gray-500";return A.jsxs("form",{onSubmit:fe,className:"py-6 md:py-8",children:[A.jsx("div",{className:"bg-white md:rounded-xl md:border md:border-gray-200 md:shadow-sm px-4 md:px-6 py-4 md:py-6",children:A.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[A.jsx("div",{className:"md:w-1/2",children:A.jsxs("label",{className:"block cursor-pointer",children:[A.jsx("input",{type:"file",accept:"image/*",onChange:le,className:"hidden"}),A.jsx("div",{className:"w-full aspect-square overflow-hidden rounded-lg border border-dashed border-gray-300 bg-gray-50 flex items-center justify-center",children:D?A.jsx("img",{src:D,alt:"Review",className:"w-full h-full object-cover"}):A.jsxs("div",{className:"flex flex-col items-center text-gray-400",children:[A.jsx(eP,{className:"text-3xl mb-2"}),A.jsx("span",{className:"text-sm md:text-base",children:"No image"})]})})]})}),A.jsxs("div",{className:"md:w-1/2 flex flex-col items-center md:justify-between gap-6",children:[A.jsx("div",{className:"w-full flex justify-center md:justify-center gap-3 md:gap-4 md:mt-10",children:[1,2,3,4,5].map(be=>A.jsx("button",{type:"button",onClick:()=>y(be),className:"text-3xl md:text-4xl text-orange-500",children:f>=be?A.jsx(Zo,{}):A.jsx(Ty,{})},be))}),A.jsxs("div",{className:"w-full max-w-xl",children:[A.jsx("textarea",{value:w,onChange:be=>i(be.target.value),rows:6,placeholder:"Share your experience...",className:"w-full border border-gray-300 rounded-lg px-3 py-3 text-sm md:text-base bg-white focus:outline-none focus:ring-2 focus:ring-orange-400"}),A.jsxs("div",{className:`mt-2 text-xs md:text-sm text-right ${xe}`,children:[w.length," / ",uM]})]})]})]})}),A.jsx("div",{className:"mt-6 flex justify-end px-4 md:px-0",children:A.jsx("button",{type:"submit",disabled:G,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-3.5 bg-[#FF8225] text-white rounded-md font-semibold text-sm md:text-base hover:bg-[#e6731f] transition disabled:opacity-60",children:G?"Saving...":te?"Save":"Create"})})]})},dM=()=>{Ma();const{review_id:s,product_id:a}=ul();return A.jsxs("div",{className:"w-screen min-h-screen flex flex-col",children:[A.jsx(hc,{title:"Product Review"}),A.jsx("div",{className:"flex-1 w-full px-4 md:px-8 pb-10",children:A.jsx("div",{className:"max-w-3xl mx-auto overflow-hidden",children:A.jsx(X6,{product_id:a,review_id:s})})})]})},Y6="/v1",K6=()=>{const s=Lr(!0),[a,l]=pe.useState([]),[u,f]=pe.useState(!0),y=s?.user?.id,w=Ma(),i=$c();return pe.useEffect(()=>{(async()=>{if(y){f(!0);try{const D=await(await fetch(`${Y6}/visitor/${y}/product-review`)).json();l(D)}catch(P){console.error("Failed to fetch reviews",P)}finally{f(!1)}}})()},[y]),u?A.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loading reviews..."}):A.jsxs("div",{className:"relative w-full min-h-screen",children:[A.jsx(hc,{title:"Your Product Reviews"}),A.jsx("div",{className:"max-w-6xl mx-auto p-4 grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:a.length===0?A.jsx("div",{className:"text-gray-500 text-center py-10 col-span-full",children:"You haven't reviewed any products yet."}):a.map(C=>A.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden flex flex-col gap-4",children:[A.jsxs("div",{className:"flex items-center gap-3 p-4",children:[A.jsx("img",{src:C.image||"/default-product.png",alt:C.name,className:"w-24 h-24 md:w-28 md:h-28 object-cover rounded"}),A.jsxs("div",{className:"flex flex-col",children:[A.jsx("h3",{className:"text-lg md:text-xl font-semibold text-gray-800",children:C.name}),A.jsxs("p",{className:"text-sm md:text-base text-gray-600",children:["Price: RM ",C.price," | Quantity: ",C.quantity]})]})]}),A.jsxs("div",{className:"p-4 flex flex-col justify-between space-y-3 border-t border-gray-100 relative",children:[A.jsx("p",{className:"text-xs md:text-sm text-gray-400 absolute top-4 right-4",children:new Date(C.review_created_at).toLocaleDateString()}),A.jsxs("div",{children:[A.jsxs("div",{className:"flex items-center gap-2 mb-2 text-base md:text-base",children:[A.jsxs("span",{className:"font-medium text-gray-700",children:["Rating: ",C.rating,".0"]}),A.jsx(Zo,{className:"text-yellow-500",size:18})]}),A.jsx("div",{className:"mb-2 text-base md:text-base",children:A.jsxs("p",{className:"text-gray-700",children:[A.jsx("span",{className:"font-medium",children:"Review: "}),C.review_text]})}),C.review_image&&A.jsx("img",{src:C.review_image,alt:"Review",className:"w-32 h-32 md:w-36 md:h-36 object-cover rounded mt-2"})]}),A.jsx("div",{className:"mt-4",children:A.jsx("button",{className:"w-full px-4 py-3 bg-[#FF8225] text-white rounded-md text-sm md:text-base font-medium hover:bg-[#e6731f] transition",onClick:()=>w(`${i.pathname}/${C.review_id}`),children:"Edit Review"})})]})]},C.review_id))})]})},nS=()=>{const s=Lr(!1),a=Ma(),{id:l}=ul(),u=$c(),f="/v1",[y,w]=pe.useState([]),[i,C]=pe.useState("main"),[P,D]=pe.useState([]),[$,G]=pe.useState(!0),X=l;pe.useEffect(()=>{if(!X)return;(async()=>{G(!0);try{const Be=await fetch(`${f}/visitor/${X}/post`);if(!Be.ok)throw new Error("Failed to fetch visitor posts");const Ee=await Be.json();D(Ee)}catch(Be){console.error("[Visitor Posts] Error:",Be),D([])}finally{G(!1)}})()},[f,X]),pe.useEffect(()=>{(async()=>{if(!(!s||!s.user))try{const Be=await fetch(`${f}/user/${s.user.id}/roles`),Ee=await Be.json();Be.ok&&Ee.roles&&w(Ee.roles)}catch(Be){console.error("Error fetching roles:",Be),w([])}})()},[s,f]);const te=u.pathname,le=te.match(/\/(vendor|visitor|organizer)\//);let re=le?le[1]:null;re||(y.includes("Vendor")?re="vendor":y.includes("Organizer")?re="organizer":re="visitor");const fe=te==="/profile"||(l?l===s?.user?.id:!0);pe.useEffect(()=>{if(!s?.user||!l||fe)return;(async()=>{try{await fetch(`${f}/user/${l}/click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({viewer_id:s.user.id})})}catch(Be){console.error("[Profile Click] Error:",Be)}})(),console.log("here")},[l,fe,s,f]);const xe={visitor:{icon:KO,key:"visited"},vendor:{icon:cx,key:"products"},organizer:{icon:Cm,key:"markets"}},be=Array.isArray(P)?P.filter(Ne=>Ne.type===1):[];return A.jsxs("div",{className:"relative flex flex-col items-center min-h-screen bg-[#FFFDFA] font-inter",children:[A.jsxs("div",{className:"absolute top-4 w-full px-4 md:px-8 flex justify-between items-center",children:[fe?A.jsx("div",{}):A.jsx("div",{className:"flex items-center gap-3",children:A.jsx("button",{onClick:()=>a(-1),className:"text-[var(--black)] hover:text-[var(--orange)] transition",children:A.jsx(Mm,{className:"text-2xl"})})}),fe&&A.jsx(ZP,{})]}),A.jsxs("div",{className:"w-full max-w-5xl mt-16 px-4 md:px-8 pb-10",children:[A.jsx(WP,{userId:X,isOwnProfile:fe}),A.jsx("hr",{className:"mt-6 border-gray-200"}),!fe&&A.jsxs("div",{className:"flex justify-center mb-6 border-b border-gray-200 py-3 gap-2",children:[A.jsx("button",{onClick:()=>C("main"),className:`flex-1 max-w-[200px] flex justify-center py-2 rounded-md ${i==="main"?"text-orange-500 bg-orange-50":"text-gray-400"}`,children:A.jsx(FO,{size:22})}),re&&xe[re]&&A.jsx("button",{onClick:()=>C(xe[re].key),className:`flex-1 max-w-[200px] flex justify-center py-2 rounded-md ${i===xe[re].key?"text-orange-500 bg-orange-50":"text-gray-400"}`,children:Up.createElement(xe[re].icon,{size:22})})]}),i==="main"&&be.length>0&&A.jsx("div",{className:"mt-6 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 md:gap-4",children:be.map(Ne=>A.jsx("div",{className:"w-full aspect-square overflow-hidden shadow-sm hover:shadow-md transition cursor-pointer rounded-lg bg-white",onClick:()=>console.log("Clicked post:",Ne.id),children:A.jsx("img",{src:Ne.image,alt:Ne.caption||"Visitor post",className:"w-full h-full object-cover"})},Ne.id))}),re==="visitor"&&i==="visited"&&A.jsx("div",{className:"mt-6",children:A.jsx(a4,{visitorId:X})}),re==="vendor"&&i==="products"&&A.jsx("div",{className:"mt-6",children:A.jsx(KS,{vendorId:X,isOwnProfile:fe})}),re==="organizer"&&i==="markets"&&A.jsx("div",{className:"mt-6",children:A.jsx(YP,{organizerId:X})})]})]})},J6=iO(LD(A.jsxs(wa,{path:"/",children:[A.jsxs(wa,{path:"/",element:A.jsx(CF,{}),children:[A.jsx(wa,{index:!0,element:A.jsx(NB,{})}),A.jsx(wa,{path:"/search",element:A.jsx(FB,{})}),A.jsx(wa,{path:"/map",element:A.jsx(eU,{})}),A.jsx(wa,{path:"/profile",element:A.jsx(s4,{})}),A.jsx(wa,{path:"/community",element:A.jsx(f4,{})})]}),A.jsx(wa,{path:"/category/:id",element:A.jsx(A4,{})}),A.jsx(wa,{path:"/hello",element:A.jsx(q5,{})}),A.jsx(wa,{path:"/notifications",element:A.jsx(k5,{})}),A.jsx(wa,{path:"/business/marketspace",element:A.jsx(LA,{})}),A.jsx(wa,{path:"/business/marketspace/application",element:A.jsx(O5,{})}),A.jsx(wa,{path:"/business/marketspace/available",element:A.jsx(I5,{})}),A.jsx(wa,{path:"/business/marketspace/:id",element:A.jsx(R5,{})}),A.jsx(wa,{path:"/business/marketspace/:id/apply",element:A.jsx(D5,{})}),A.jsx(wa,{path:"/community/add",element:A.jsx(w4,{})}),A.jsx(wa,{path:"/business/product",element:A.jsx(y4,{})}),A.jsx(wa,{path:"/business/product/add",element:A.jsx(BA,{})}),A.jsx(wa,{path:"/business/product/:id/edit",element:A.jsx(BA,{})}),A.jsx(wa,{path:"/business/product/:product_id",element:A.jsx(cM,{isOwnProfile:!0})}),A.jsx(wa,{path:"/admin/market/add",element:A.jsx(I1,{})}),A.jsx(wa,{path:"/:role/registration",element:A.jsx(_4,{})}),A.jsx(wa,{path:"/auth",element:A.jsx(t4,{})}),A.jsx(wa,{path:"/market-review/:review_id",element:A.jsx(VA,{})}),A.jsx(wa,{path:"/market",element:A.jsx(T4,{})}),A.jsx(wa,{path:"/market/history",element:A.jsx(F5,{})}),A.jsx(wa,{path:"/market/bookmark",element:A.jsx(U5,{})}),A.jsx(wa,{path:"/market/:market_id/review",element:A.jsx(VA,{})}),A.jsx(wa,{path:"/market/:id",element:A.jsx(JB,{})}),A.jsx(wa,{path:"/admin",element:A.jsx(R4,{})}),A.jsx(wa,{path:"/product-review",element:A.jsx(K6,{})}),A.jsx(wa,{path:"/product-review/:review_id",element:A.jsx(dM,{})}),A.jsx(wa,{path:"/vendor/:id",element:A.jsx(nS,{})}),A.jsx(wa,{path:"/vendor/:vendor_id/product/:product_id",element:A.jsx(cM,{})}),A.jsx(wa,{path:"/vendor/:vendor_id/product/:product_id/review",element:A.jsx(dM,{})}),A.jsx(wa,{path:"/visitor/:id",element:A.jsx(nS,{})}),A.jsx(wa,{path:"/organizer/:id",element:A.jsx(nS,{})}),A.jsx(wa,{path:"/business/vendor/:vendor_id/statistic",element:A.jsx(G5,{})}),A.jsx(wa,{path:"/business/vendor/:vendor_id/statistic-download",element:A.jsx(W6,{})}),A.jsx(wa,{path:"/business/market",element:A.jsx(LA,{})}),A.jsx(wa,{path:"/business/market/apply",element:A.jsx(I1,{})}),A.jsx(wa,{path:"/business/market/:id/edit",element:A.jsx(I1,{})}),A.jsx(wa,{path:"/business/market/:id/plan",element:A.jsx(FA,{})}),A.jsx(wa,{path:"/business/market/:id/space",element:A.jsx(M5,{})}),A.jsx(wa,{path:"/business/market/:id/edit-plan",element:A.jsx(FA,{edit:!0})}),A.jsx(wa,{path:"/business/market/:market_id/review",element:A.jsx($5,{})}),A.jsx(wa,{path:"/business/market/:market_id/statistic",element:A.jsx(V5,{})}),A.jsx(wa,{path:"/business/market/:market_id/statistic-download",element:A.jsx(U6,{})})]}))),Q6=()=>A.jsx(nN,{children:A.jsx(mO,{router:J6})}),e8={en:{translation:{"Product Categories":"Product Categories","Browse by category to quickly find food, crafts, fashion, and more from local vendors.":"Browse by category to quickly find food, crafts, fashion, and more from local vendors.","Street Markets":"Street Markets","Filter by distance, ratings, whats open now, and tags to find the perfect market to visit.":"Filter by distance, ratings, whats open now, and tags to find the perfect market to visit.",Filters:"Filters",Distance:"Distance",Any:"Any",Rating:"Rating","Open Only":"Open Only",Tags:"Tags",Reset:"Reset",Apply:"Apply",Enabled:"Enabled",Disabled:"Disabled"}},ms:{translation:{"Product Categories":"Kategori Produk","Browse by category to quickly find food, crafts, fashion, and more from local vendors.":"Semak mengikut kategori untuk mencari makanan, kraftangan, fesyen, dan banyak lagi daripada peniaga tempatan.","Street Markets":"Pasar Jalanan","Filter by distance, ratings, whats open now, and tags to find the perfect market to visit.":"Tapis mengikut jarak, penilaian, yang dibuka sekarang, dan tag untuk mencari pasar yang sesuai untuk dikunjungi.",Filters:"Penapis",Distance:"Jarak",Any:"Bebas",Markets:"Tamu",Products:"Produk",Rating:"Penilaian","Open Only":"Hanya Dibuka",Tags:"Tag",Reset:"Set Semula",Apply:"Terapkan",Enabled:"Dihidupkan",Disabled:"Dimatikan","Your Tamu Adventure":"Pengembaraan Tamu Anda","Starts Here":"Bermula Di Sini","Learn More":"Ketahui Lebih Lanjut","Explore Now":"Jelajah Sekarang",Features:"Ciri-ciri","Find nearby markets":"Cari pasar berdekatan","Navigate easily":"Navigasi dengan mudah","Engage with others":"Berinteraksi dengan komuniti","By the Numbers":"Statistik",Vendors:"Peniaga",Organizers:"Penganjur","Join as Vendor":"Sertai sebagai Peniaga","Start as Organizer":"Mula sebagai Penganjur","Ready to Explore?":"Bersedia untuk Meneroka?","All rights reserved.":"Hak cipta terpelihara.","Discover street markets near you in Kota Kinabalucheck whats happening today, navigate easily, and plan your visit before you arrive.":"Temui pasar jalanan berhampiran anda di Kota Kinabalusemak apa yang berlaku hari ini, navigasi dengan mudah dan rancang lawatan anda sebelum anda tiba.","Designed for visitors exploring Kota Kinabalu":"Direka bentuk untuk pelawat meneroka Kota Kinabalu","Find the best Tamu nearby, see whats live right now, and plan your route before you head out.":"Cari Tamu terbaik berdekatan, lihat tamu yang sudah mula dan rancang laluan anda sebelum anda keluar.","See Tamu around you with distance and open/close times at a glance.":"Lihat Tamu di sekeliling anda dengan jarak dan masa buka/tutup dengan sepintas lalu.","One-tap directions to markets, optimized for walking or driving.":"Arah satu ketik ke pasar, dioptimumkan untuk berjalan kaki atau memandu.","Share your posts, tips, and join forum discussions with other market-goers.":"Kongsi siaran, petua anda dan sertai perbincangan forum dengan pengunjung pasaran yang lain.","A thriving community of markets, vendors, and products":"Komuniti pasaran, vendor dan produk yang berkembang maju","Real-time snapshots of Tamukinabalus ecosystemgrowing every day to help visitors discover, vendors thrive, and organizers succeed.":"Gambar masa nyata ekosistem Tamukinabaluberkembang setiap hari untuk membantu pelawat menemui, vendor berkembang maju dan penganjur berjaya.","Partner with Tamukinabalu":"Bekerjasama dengan Tamukinabalu","Grow your presence as a Vendor or Organizer":"Tingkatkan tarikan anda sebagai Vendor atau Penganjur","Showcase products, manage applications, and run smoother events with our tools built for local markets.":"Pamerkan produk, urus aplikasi dan jalankan acara yang lebih lancar dengan alatan kami yang dibina untuk pasaran tempatan.","Apply to markets and secure spots":"Daftar ke Tamu dan tempah tempat","Showcase products and offers":"Tunjukkan produk dan tawaran","Engage with visitors directly":"Berhubung dengan pelawat secara langsung","Create and manage market events":"Buat dan urus pasar","Approve vendors and assign slots":"Luluskan vendor dan tetapkan slot","Track performance and attendance":"Dapatkan prestasi dan kehadiran","Jump into Kota Kinabalus street markets and start your adventure today.":"Pergi ke pasar jalanan Kota Kinabalu dan mulakan pengembaraan anda hari ini.","Browse food, crafts, fashion, and more from local vendors by category.":"Cari makanan, kraf, fesyen dan banyak lagi daripada vendor tempatan mengikut kategori","Explore nearby street markets and tamu. Filter by distance, rating, and availability.":"Terokai pasar jalanan dan tamu yang berdekatan. Tapis mengikut jarak, penilaian dan ketersediaan.","Fresh Produce":"Barangan Segar","Street Food":"Makanan Jalan","Snacks & Drinks":"Jajan & Minuman",Clothing:"Pakaian",Handicrafts:"Kraftangan",Fruits:"Buah",Seafood:"Makanan Laut",Performance:"Persembahan"}}};Vc.use(AB).init({resources:e8,lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});tz.createRoot(document.getElementById("root")).render(A.jsx(pe.StrictMode,{children:A.jsx(Q6,{})}));
